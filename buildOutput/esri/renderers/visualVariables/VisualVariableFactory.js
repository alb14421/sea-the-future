// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/jsonMap","../../core/Logger","../../core/Warning","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./ColorVariable","./OpacityVariable","./RotationVariable","./SizeVariable"],function(e,a,s,t,r,o,i,l,n,c,u,p,b,h){"use strict";const V={color:u,size:h,opacity:p,rotation:b},f=new t.JSONMap({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),d=/^\[([^\]]+)\]$/i;return e.default=class extends s{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e?.filter(e=>!!e),e?.length){for(const a of e)switch(a.type){case"color":this.colorVariables.push(a);break;case"opacity":this.opacityVariables.push(a);break;case"rotation":this.rotationVariables.push(a);break;case"size":this.sizeVariables.push(a)}this.sizeVariables.length&&this.sizeVariables.some(e=>!!e.target)&&e.sort((e,a)=>{let s=null;return s=e.target===a.target?0:e.target?1:-1,s});for(let a=0;a<e.length;a++)e[a].index=a;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,a,s){const{rotationExpression:t,rotationType:i}=a,l=t?.match(d),n=l?.[1];if(n&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:i,field:n})),e)return e.map(e=>{const a=f.read(e.type),t=V[a];t||(r.getLogger(this).warn(`Unknown variable type: ${a}`),s?.messages&&s.messages.push(new o("visual-variable:unsupported",`visualVariable of type '${a}' is not supported`,{definition:e,context:s})));const i=new t;return i.read(e,s),i})}writeVariables(e,a){const s=[];for(const t of e){const e=t.toJSON(a);e&&s.push(e)}return s}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}},a.__decorate([i.property()],e.default.prototype,"visualVariables",null),e.default=a.__decorate([c.subclass("esri.renderers.visualVariables.VisualVariableFactory")],e.default),e.default});