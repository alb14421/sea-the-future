// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../geometry/SpatialReference","../support/TileInfo","../support/TileInfoTilemapCache","../support/TilemapCache"],function(e,t,r,i,s,n,o,a,l,u,c,h){"use strict";e.ArcGISCachedService=e=>{const i=e;let s=class extends i{constructor(){super(...arguments),this.copyright=null,this.minScale=0,this.maxScale=0,this.spatialReference=null,this.tileInfo=null,this.tilemapCache=null}destroy(){this.tilemapCache?.destroy?.()}readMinScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}readMaxScale(e,t){return null!=t.minLOD&&null!=t.maxLOD?e:0}get supportsBlankTile(){return this.version>=10.2}readTilemapCache(e,t,r){const i=t.capabilities?.includes("Tilemap");let{minLOD:s,maxLOD:n,minScale:o,maxScale:a}=t;if(null==s&&null==n&&(0!==o||0!==a)){const e=e=>Math.round(1e4*e)/1e4;o=e(o||t.tileInfo.lods[0].scale),a=e(a||t.tileInfo.lods[t.tileInfo.lods.length-1].scale);for(const r of t.tileInfo.lods){const t=e(r.scale);s=t>=o?r.level:s,n=t>=a?r.level:n}}if(i)return new h.TilemapCache({layer:this,minLOD:s,maxLOD:n});if(t.tileInfo){const e=new u;return e.read(t.tileInfo,r),new c(e,s,n)}return null}};return t.__decorate([r.property({json:{read:{source:"copyrightText"}}})],s.prototype,"copyright",void 0),t.__decorate([r.property()],s.prototype,"minScale",void 0),t.__decorate([o.reader("service","minScale")],s.prototype,"readMinScale",null),t.__decorate([r.property()],s.prototype,"maxScale",void 0),t.__decorate([o.reader("service","maxScale")],s.prototype,"readMaxScale",null),t.__decorate([r.property({type:l})],s.prototype,"spatialReference",void 0),t.__decorate([r.property({readOnly:!0})],s.prototype,"supportsBlankTile",null),t.__decorate([r.property({type:u})],s.prototype,"tileInfo",void 0),t.__decorate([r.property()],s.prototype,"tilemapCache",void 0),t.__decorate([o.reader("service","tilemapCache",["capabilities","tileInfo"])],s.prototype,"readTilemapCache",null),t.__decorate([r.property()],s.prototype,"version",void 0),s=t.__decorate([a.subclass("esri.layers.mixins.ArcGISCachedService")],s),s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/unitUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../geometry/Point","../../geometry/SpatialReference","../../geometry/support/aaBoundingRect","../../geometry/support/spatialReferenceUtils","../../geometry/support/webMercatorUtils","./LOD","./TileKey"],function(e,t,r,i,s,n,o,a,l,u,c,h,p,y,f,d,m,g,_){"use strict";var b;const x=new r.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return e.default=class extends i.JSONSupport{static{b=this}static create(e={}){const{resolutionFactor:t=1,scales:r,size:i=256,spatialReference:n=y.WebMercator,numLODs:o=24}=e;if(!d.isValid(n)){const e=[];if(r)for(let t=0;t<r.length;t++){const i=r[t];e.push(new g({level:t,scale:i,resolution:i}))}else{let t=5e-4;for(let r=o-1;r>=0;r--)e.unshift(new g({level:r,scale:t,resolution:t})),t*=2}return new b({dpi:96,lods:e,origin:new p(0,0,n),size:[i,i],spatialReference:n})}const a=d.getInfo(n),l=e.origin?new p({x:e.origin.x,y:e.origin.y,spatialReference:n}):new p(a?{x:a.origin[0],y:a.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),u=1/(39.37*s.getMetersPerUnitForSR(n)*96),c=[];if(r)for(let e=0;e<r.length;e++){const t=r[e],i=t*u;c.push(new g({level:e,scale:t,resolution:i}))}else{let e=d.isGeographic(n)?512/i*591657527.5917094:256/i*591657527.591555;const r=Math.ceil(o/t);c.push(new g({level:0,scale:e,resolution:e*u}));for(let i=1;i<r;i++){const r=e/2**t,s=r*u;c.push(new g({level:i,scale:r,resolution:s})),e=r}}return new b({dpi:96,lods:c,origin:l,size:[i,i],spatialReference:n})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=d.getInfo(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return p.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const i=[],s=this._levelToLOD={};e&&(t=-1/0,r=1/0,e.forEach(e=>{i.push(e.scale),t=e.scale>t?e.scale:t,r=e.scale<r?e.scale:r,s[e.level]=e})),this._set("scales",i),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const r=Math.floor(e),i=r+1;return t[r]/(t[r]/t[i])**(e-r)}scaleToZoom(e){const t=this.scales,r=t.length-1;let i=0;for(;i<r;i++){const r=t[i],s=t[i+1];if(r<=e)return i;if(s===e)return i+1;if(r>e&&s<e)return i+Math.log(r/e)/Math.log(r/s)}return i}tileAt(e,t,r,i){const s=this.lodAt(e);if(!s)return null;let n,o;if("number"==typeof t)n=t,o=r;else if(d.equals(t.spatialReference,this.spatialReference))n=t.x,o=t.y,i=r;else{const e=m.project(t,this.spatialReference);if(null==e)return null;n=e.x,o=e.y,i=r}const a=s.resolution*this.size[0],l=s.resolution*this.size[1];return i||(i=new _.TileKey(null,0,0,0,f.create())),i.level=e,i.row=Math.floor((this.origin.y-o)/l+.001),i.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(i),i}updateTileInfo(e,t=0){let r=this.lodAt(e.level);if(!r&&1===t){const t=this.lods[this.lods.length-1];t.level<e.level&&(r=t)}if(!r)return;const i=e.level-r.level,s=r.resolution*this.size[0]/2**i,n=r.resolution*this.size[1]/2**i;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=f.create()),e.extent[0]=this.origin.x+e.col*s,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+s,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const r=this.lodAt(t.level);if(null==r)return null;const{resolution:i}=r,s=i*this.size[0],n=i*this.size[1];return e[0]=this.origin.x+t.col*s,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+s,e[3]=e[1]+n,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return b.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const r=[],i=this.lods.length-t;for(let e=0;e<i;e++){const i=e+t,{scale:s,resolution:n}=i>=0?this.lods[i]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};r.push(new g({level:e,scale:s,resolution:n}))}return new b({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const i=e[r];this._upsampleLevels[i.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/i.resolution:0},t=i}}},t.__decorate([n.property({type:Number,json:{write:!0}})],e.default.prototype,"compressionQuality",void 0),t.__decorate([n.property({type:Number,json:{write:!0}})],e.default.prototype,"dpi",void 0),t.__decorate([n.property({type:String,json:{read:x.read,write:x.write,origins:{"web-scene":{read:!1,write:!1}}}})],e.default.prototype,"format",void 0),t.__decorate([n.property({readOnly:!0})],e.default.prototype,"isWrappable",null),t.__decorate([n.property({type:p,json:{write:!0}})],e.default.prototype,"origin",void 0),t.__decorate([u.reader("origin")],e.default.prototype,"readOrigin",null),t.__decorate([n.property({type:[g],value:null,json:{write:!0}})],e.default.prototype,"lods",null),t.__decorate([n.property({readOnly:!0})],e.default.prototype,"scales",void 0),t.__decorate([n.property({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],e.default.prototype,"size",void 0),t.__decorate([u.reader("size",["rows","cols"])],e.default.prototype,"readSize",null),t.__decorate([h.writer("size",{cols:{type:o.Integer},rows:{type:o.Integer}})],e.default.prototype,"writeSize",null),t.__decorate([n.property({type:y,json:{write:!0}})],e.default.prototype,"spatialReference",void 0),e.default=b=t.__decorate([c.subclass("esri.layers.support.TileInfo")],e.default),e.default})},"esri/layers/support/LOD":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,n,o,a){"use strict";var l;return e.default=class extends r.JSONSupport{static{l=this}constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new l({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}},t.__decorate([i.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.default.prototype,"cols",void 0),t.__decorate([i.property({type:s.Integer,json:{write:!0}})],e.default.prototype,"level",void 0),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"levelValue",void 0),t.__decorate([i.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.default.prototype,"origin",void 0),t.__decorate([i.property({type:Number,json:{write:!0}})],e.default.prototype,"resolution",void 0),t.__decorate([i.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.default.prototype,"rows",void 0),t.__decorate([i.property({type:Number,json:{write:!0}})],e.default.prototype,"scale",void 0),e.default=l=t.__decorate([a.subclass("esri.layers.support.LOD")],e.default),e.default})},"esri/layers/support/TileKey":function(){define(["exports"],function(e){"use strict";e.TileKey=class{constructor(e,t,r,i,s=void 0){this.id=e,this.level=t,this.row=r,this.col=i,this.extent=s}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfoTilemapCache":function(){define(["../../core/Error","../../core/promiseUtils"],function(e,t){"use strict";return class{constructor(e,t=0,r=e.lods[e.lods.length-1].level){this.tileInfo=e,this.minLOD=t,this.maxLOD=r,e.lodAt(t)||(this.minLOD=e.lods[0].level),e.lodAt(r)||(this.maxLOD=e.lods[e.lods.length-1].level)}get effectiveMinLOD(){return this.minLOD??this.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}getAvailability(e,t,r){const i=this.tileInfo?.lodAt(e);return!i||e<this.minLOD||e>this.maxLOD?"unavailable":i.cols&&i.rows?r>=i.cols[0]&&r<=i.cols[1]&&t>=i.rows[0]&&t<=i.rows[1]?"unknown":"unavailable":"unknown"}async fetchAvailability(r,i,s,n){await t.waitTick(n);const o=this.getAvailability(r,i,s);if("unavailable"===o)throw new e("tile-map:tile-unavailable","Tile is not available",{level:r,row:i,col:s});return o}async fetchAvailabilityUpsample(e,r,i,s,n){await t.waitTick(n),s.level=e,s.row=r,s.col=i;const o=this.tileInfo;return o.updateTileInfo(s),this.fetchAvailability(e,r,i,n).catch(e=>{if(t.isAbortError(e))throw e;if(o.upsampleTile(s))return this.fetchAvailabilityUpsample(s.level,s.row,s.col,s,n);throw e})}}})},"esri/layers/support/TilemapCache":function(){define(["exports","../../chunks/tslib.es6","../../request","../../core/Accessor","../../core/Error","../../core/handleUtils","../../core/has","../../core/LRUCache","../../core/PooledArray","../../core/promiseUtils","../../core/reactiveUtils","../../core/scheduling","../../core/urlUtils","../../core/accessorSupport/decorators/property","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./TileKey","./Tilemap"],function(e,t,r,i,s,n,o,a,l,u,c,h,p,y,f,d,m,g,_){"use strict";var b;function x(e,t,r){return new s("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:r})}e.TilemapCache=class extends i{static{b=this}constructor(e){super(e),this._pendingTilemapRequests={},this.request=r,this.size=32,this._prefetchingEnabled=!0}initialize(){this._tilemapCache=new a.LRUCache(2097152),this.addHandles(c.watch(()=>{const{layer:e}=this;return[e?.parsedUrl,e?.tileServers,e?.apiKey,e?.customParameters]},()=>this._initializeTilemapDefinition(),c.initial))}get effectiveMinLOD(){return this.minLOD??this.layer.tileInfo.lods[0].level}get effectiveMaxLOD(){return this.maxLOD??this.layer.tileInfo.lods[this.layer.tileInfo.lods.length-1].level}getAvailability(e,t,r){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return"unavailable";const i=this._tilemapFromCache(e,t,r,this._tmpTilemapDefinition);return i?i.getAvailability(t,r):"unknown"}fetchAvailability(e,t,r,i){return!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD?Promise.reject(x(e,t,r)):this._fetchTilemap(e,t,r,i).catch(e=>e).then(i=>{if(i instanceof _.Tilemap){const s=i.getAvailability(t,r);if("unavailable"===s)throw x(e,t,r);return s}if(u.isAbortError(i))throw i;return"unknown"})}fetchAvailabilityUpsample(e,t,r,i,s){i.level=e,i.row=t,i.col=r;const n=this.layer.tileInfo;n.updateTileInfo(i);const o=this.fetchAvailability(e,t,r,s).catch(e=>{if(u.isAbortError(e))throw e;if(n.upsampleTile(i))return this.fetchAvailabilityUpsample(i.level,i.row,i.col,i,s);throw e});return this._fetchAvailabilityUpsamplePrefetch(i.id,e,t,r,s,o),o}async _fetchAvailabilityUpsamplePrefetch(e,t,r,i,s,o){if(!this._prefetchingEnabled||null==e)return;const a=`prefetch-${e}`;if(this.hasHandles(a))return;const l=new AbortController;o.then(()=>l.abort(),()=>l.abort());let c=!1;const p=n.makeHandle(()=>{c||(c=!0,l.abort())});if(this.addHandles(p,a),await h.waitTicks(10,l.signal).catch(()=>{}),c||(c=!0,this.removeHandles(a)),u.isAborted(l))return;const y=new g.TileKey(e,t,r,i),f={...s,signal:l.signal},d=this.layer.tileInfo;for(let e=0;b._prefetches.length<b._maxPrefetch&&d.upsampleTile(y);++e){const e=this.fetchAvailability(y.level,y.row,y.col,f);b._prefetches.push(e);const t=()=>{b._prefetches.removeUnordered(e)};e.then(t,t)}}static{this._maxPrefetch=4}static{this._prefetches=new l({initialSize:b._maxPrefetch})}static cleanupTilemapCache(){this._prefetches.prune()}_fetchTilemap(e,t,r,i){if(!this.layer.tileInfo.lodAt(e)||e<this.effectiveMinLOD||e>this.effectiveMaxLOD)return Promise.reject(new s("tilemap-cache:level-unavailable",`Level ${e} is unavailable in the service`));const n=this._tmpTilemapDefinition,o=this._tilemapFromCache(e,t,r,n);if(o)return Promise.resolve(o);const a=i?.signal;return i={...i,signal:null},new Promise((e,t)=>{u.onAbort(a,()=>t(u.createAbortError()));const r=_.tilemapDefinitionId(n);let s=this._pendingTilemapRequests[r];if(!s){s=_.Tilemap.fromDefinition(n,i).then(e=>(this._tilemapCache.put(r,e,e.byteSize),e));const e=()=>{delete this._pendingTilemapRequests[r]};this._pendingTilemapRequests[r]=s,s.then(e,e)}s.then(e,t)})}_initializeTilemapDefinition(){if(!this.layer.parsedUrl)return;const{parsedUrl:e,apiKey:t,customParameters:r}=this.layer;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:p.objectToQuery({...e.query,...r,token:t??e.query?.token}),tileServers:this.layer.tileServers,request:this.request},width:this.size,height:this.size,level:0,row:0,col:0}}_tilemapFromCache(e,t,r,i){i.level=e,i.row=t-t%this.size,i.col=r-r%this.size;const s=_.tilemapDefinitionId(i);return this._tilemapCache.get(s)}get test(){}},t.__decorate([y.property({constructOnly:!0})],e.TilemapCache.prototype,"layer",void 0),t.__decorate([y.property({constructOnly:!0})],e.TilemapCache.prototype,"minLOD",void 0),t.__decorate([y.property({constructOnly:!0})],e.TilemapCache.prototype,"maxLOD",void 0),t.__decorate([y.property({constructOnly:!0})],e.TilemapCache.prototype,"request",void 0),t.__decorate([y.property({constructOnly:!0})],e.TilemapCache.prototype,"size",void 0),e.TilemapCache=b=t.__decorate([m.subclass("esri.layers.support.TilemapCache")],e.TilemapCache),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Tilemap":function(){define(["exports","../../request","../../core/Error","../../core/lang","../../core/memoryEstimations","../../geometry/support/UintArray"],function(e,t,r,i,s,n){"use strict";class o{constructor(e){!function(e){if(!e?.location)throw new r("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new r("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new r("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new r("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new r("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}(e);const{location:t,data:o}=e;this.location=Object.freeze(i.clone(t));const a=this.location.width,l=this.location.height;let u=!0,c=!0;const h=Math.ceil(a*l/32),p=n.newUintArray(h);let y=0;for(let e=0;e<o.length;e++){const t=e%32;o[e]?(c=!1,p[y]|=1<<t):u=!1,31===t&&++y}c?(this._availability="unavailable",this.byteSize=40):u?(this._availability="available",this.byteSize=40):(this._availability=p,this.byteSize=40+s.estimateNumberArrayMemory(p))}getAvailability(e,t){if("unavailable"===this._availability||"available"===this._availability)return this._availability;const r=(e-this.location.top)*this.location.width+(t-this.location.left),i=r%32,s=r>>5,n=this._availability;return s<0||s>n.length?"unknown":n[s]&1<<i?"available":"unavailable"}static fromDefinition(e,i){const s=e.service.request||t,{row:n,col:a,width:l,height:u}=e,c={query:{f:"json"}};return i=i?{...c,...i}:c,s(function(e){let t;if(e.service.tileServers?.length){const r=e.service.tileServers;t=`${r&&r.length?r[e.row%r.length]:e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`}else t=`${e.service.url}/tilemap/${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`;const r=e.service.query;return r&&(t=`${t}?${r}`),t}(e),i).then(e=>e.data).catch(e=>{if(422===e?.details?.httpStatus)return{location:{top:n,left:a,width:l,height:u},valid:!0,data:new Array(l*u).fill(0)};throw e}).then(e=>{if(e.location&&(e.location.top!==n||e.location.left!==a||e.location.width!==l||e.location.height!==u))throw new r("tilemap:location-mismatch","Tilemap response for different location than requested",{response:e,definition:{top:n,left:a,width:l,height:u}});return o.fromJSON(e)})}static fromJSON(e){return Object.freeze(new o(e))}}e.Tilemap=o,e.tilemapDefinitionId=function(e){return`${e.level}/${e.row}/${e.col}/${e.width}/${e.height}`},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/UintArray":function(){define(["exports","../../core/typedArrayUtil"],function(e,t){"use strict";e.newUintArray=function(e,r=!1){return e<=t.nativeArrayMaxSize?r?new Array(e).fill(0):new Array(e):new Uint32Array(e)},e.uintSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/imageUtils":function(){define(["exports"],function(e){"use strict";let t=null;e.checkWebPSupport=function(e){if(t)return t;const r={lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};return t=new Promise(t=>{const i=new Image;i.onload=()=>{i.onload=i.onerror=null,t(i.width>0&&i.height>0)},i.onerror=()=>{i.onload=i.onerror=null,t(!1)},i.src="data:image/webp;base64,"+r[e]}),t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/SpriteSource":function(){define(["../../request","../../core/Error","../../core/Logger","../../core/typedArrayUtil","../../core/urlUtils"],function(e,t,r,i,s){"use strict";function n(e){const t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height);return{width:e.width,height:e.height,data:new Uint8Array(i.data)}}return class{constructor(e,t){this._spriteSource=e,this._maxTextureSize=t,this.devicePixelRatio=1,this._spriteImageFormat="png",this._isRetina=!1,this._spritesData={},this.image=null,this.width=null,this.height=null,this.loadStatus="not-loaded","url"===e.type&&e.spriteFormat&&(this._spriteImageFormat=e.spriteFormat),e.pixelRatio&&(this.devicePixelRatio=e.pixelRatio),this.baseURL=e.spriteUrl}get spriteNames(){const e=[];for(const t in this._spritesData)e.push(t);return e.sort(),e}getSpriteInfo(e){return this._spritesData?this._spritesData[e]:null}async load(e){if(this.baseURL){this.loadStatus="loading";try{await this._loadSprites(e),this.loadStatus="loaded"}catch{this.loadStatus="failed"}}else this.loadStatus="failed"}async _loadSprites(e){this._isRetina=this.devicePixelRatio>1.15;const{width:i,height:s,data:n,json:o}=await this._getSpriteData(this._spriteSource,e),a=Object.keys(o);if(!a||0===a.length||!n)return this._spritesData=this.image=null,void(this.width=this.height=0);this._spritesData=o,this.width=i,this.height=s;const l=Math.max(this._maxTextureSize,4096);if(i>l||s>l){const e=`Sprite resource for style ${this.baseURL} is bigger than the maximum allowed of ${l} pixels}`;throw r.getLogger("esri.layers.support.SpriteSource").error(e),new t("SpriteSource",e)}let u;for(let e=0;e<n.length;e+=4)u=n[e+3]/255,n[e]=n[e]*u,n[e+1]=n[e+1]*u,n[e+2]=n[e+2]*u;this.image=n}async _getSpriteData(r,o){if("image"===r.type){let e,s;if(this.devicePixelRatio<1.15){if(!r.spriteSource1x)throw new t("SpriteSource","no image data provided for low resolution sprites!");e=r.spriteSource1x.image,s=r.spriteSource1x.json}else{if(!r.spriteSource2x)throw new t("SpriteSource","no image data provided for high resolution sprites!");e=r.spriteSource2x.image,s=r.spriteSource2x.json}return"width"in e&&"height"in e&&"data"in e&&(i.isArrayBuffer(e.data)||i.isUint8ClampedArray(e.data))?{width:e.width,height:e.height,data:new Uint8Array(e.data),json:s}:{...n(e),json:s}}const a=s.urlToObject(this.baseURL),l=a.query?"?"+s.objectToQuery(a.query):"",u=this._isRetina?"@2x":"",c=`${a.path}${u}.${this._spriteImageFormat}${l}`,h=`${a.path}${u}.json${l}`,[p,y]=await Promise.all([e(h,o),e(c,{responseType:"image",...o})]);return{...n(y.data),json:p.data}}}})},"esri/layers/support/vectorTileLayerLoader":function(){define(["exports","../../request","../../core/lang","../../core/promiseUtils","../../core/urlUtils","../../geometry/support/spatialReferenceUtils","../../geometry/support/webMercatorUtils","../../views/2d/engine/vectorTiles/style/VectorTileSource"],function(e,t,r,i,s,n,o,a){"use strict";function l(...e){let t;for(const r of e)if(null!=r)if(s.isProtocolRelative(r)){if(t){const e=t.split("://")[0];t=e+":"+r.trim()}}else t=s.isAbsolute(r)?r:s.join(t,r);return t?s.removeTrailingSlash(t):void 0}async function u(e,r,n,o,a){let c,y,f;if(i.throwIfAborted(a),"string"==typeof n){const e=s.normalize(n);f=await t(e,{...a,responseType:"json",query:{f:"json",...a?.query}}),f.ssl&&(c&&(c=c.replace(/^http:/i,"https:")),y&&(y=y.replace(/^http:/i,"https:"))),c=e,y=e}else null!=n&&(f={data:n},c=n.jsonUrl||null,y=o);const d=f?.data;if(h(d))return e.styleUrl=c||null,async function(e,t,r,i){const n=r?s.removeFile(r):s.getAppBaseUrl();e.styleBase=n,e.style=t,t["sprite-format"]&&"webp"===t["sprite-format"].toLowerCase()&&(e.spriteFormat="webp");const o=[];if(t.sources&&t.sources.esri){const r=t.sources.esri;r.url?await u(e,"esri",l(n,r.url),void 0,i):o.push(u(e,"esri",r,n,i))}for(const r of Object.keys(t.sources))"esri"!==r&&"vector"===t.sources[r].type&&(t.sources[r].url?o.push(u(e,r,l(n,t.sources[r].url),void 0,i)):t.sources[r].tiles&&o.push(u(e,r,t.sources[r],n,i)));await Promise.all(o)}(e,d,y,a);if(!h(d))return e.sourceUrl?p(e,d,y,!1,r,a):(e.sourceUrl=c||null,p(e,d,y,!0,r,a));throw new Error("You must specify the URL or the JSON for a service or for a style.")}function c(e){return"object"==typeof e&&!!e&&"tilejson"in e&&null!=e.tilejson}function h(e){return!!e&&"sources"in e&&!!e.sources}async function p(e,t,i,h,p,y){const f=i?s.removeTrailingSlash(i)+"/":s.getAppBaseUrl(),d=function(e){const t=512;if(function(e){return e.hasOwnProperty("tileInfo")}(e)){const r=e?.tileInfo;return null!=r&&(null==r.rows&&(r.rows=t),null==r.cols&&(r.cols=t)),e}const i={xmin:-20037507.067161843,ymin:-20037507.067161843,xmax:20037507.067161843,ymax:20037507.067161843,spatialReference:{wkid:102100,latestWkid:3857}};let s=null;if(c(e)){const{bounds:t}=e;if(t){const e=o.geographicToWebMercator({x:t[0],y:t[1],spatialReference:r.clone(n.wgs84)}),i=o.geographicToWebMercator({x:t[2],y:t[3],spatialReference:r.clone(n.wgs84)});s={xmin:e.x,ymin:e.y,xmax:i.x,ymax:i.y,spatialReference:r.clone(n.webMercator)}}}null===s&&(s=i);let a=78271.51696400007,l=295828763.7957775;const u=[],h=e.hasOwnProperty("maxzoom")&&null!=e.maxzoom?+e.maxzoom:22;for(let e=0;e<=h;e++)u.push({level:e,scale:l,resolution:a}),a/=2,l/=2;return{capabilities:"TilesOnly",initialExtent:s,fullExtent:i,minScale:0,maxScale:0,tiles:e.tiles,tileInfo:{rows:t,cols:t,dpi:96,format:"pbf",origin:{x:-20037508.342787,y:20037508.342787},lods:u,spatialReference:r.clone(n.webMercator)}}}(t),m=new a(p,s.addQueryParameters(f,y?.query??{}),d);if(!h&&e.primarySourceName in e.sourceNameToSource){const t=e.sourceNameToSource[e.primarySourceName];if(!t.isCompatibleWith(m))return;null!=m.fullExtent&&(null!=t.fullExtent?t.fullExtent.union(m.fullExtent):t.fullExtent=m.fullExtent.clone()),t.tileInfo&&m.tileInfo&&t.tileInfo.lods.length<m.tileInfo.lods.length&&(t.tileInfo=m.tileInfo)}if(h&&(e.sourceBase=f,e.source=t,e.validatedSource=d,e.primarySourceName=p),e.sourceNameToSource[p]=m,!c(e)&&"defaultStyles"in t&&!e.style){if(null==t.defaultStyles)throw new Error;return"string"==typeof t.defaultStyles?u(e,"",l(f,t.defaultStyles,"root.json"),void 0,y):u(e,"",t.defaultStyles,l(f,"root.json"),y)}}e.loadMetadata=async function(e,t){const r={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[i,s]="string"==typeof e?[e,null]:[null,e.jsonUrl];return await u(r,"esri",e,s,t),{layerDefinition:r.validatedSource,url:i,serviceUrl:r.sourceUrl,style:r.style,styleUrl:r.styleUrl,spriteUrl:r.style.sprite&&l(r.styleBase,r.style.sprite),spriteFormat:r.spriteFormat,glyphsUrl:r.style.glyphs&&l(r.styleBase,r.style.glyphs),sourceNameToSource:r.sourceNameToSource,primarySourceName:r.primarySourceName}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/VectorTileSource":function(){define(["../../../../../core/lang","../../../../../core/urlUtils","../../../../../geometry/Extent","../../../../../layers/support/TileInfo","../../../../../layers/support/TilemapCache","../TilemapIndex","../TilemapRequest","./VectorTilesRequestManager"],function(e,t,r,i,s,n,o,a){"use strict";return class{constructor(a,l,u){this.tilemap=null,this.tileInfo=null,this.capabilities=null,this.fullExtent=null,this.initialExtent=null,this.name=a,this.sourceUrl=l;const c=t.urlToObject(this.sourceUrl),h=e.clone(u),p=h.tiles;if(c)for(let e=0;e<p.length;e++){const r=t.urlToObject(p[e]);r&&(t.isAbsolute(r.path)||(r.path=t.join(c.path,r.path)),p[e]=t.addQueryParameters(r.path,{...c.query,...r.query}))}this.tileServers=p;const y=u.capabilities&&u.capabilities.split(",").map(e=>e.toLowerCase().trim()),f=!0===u?.exportTilesAllowed,d=!0===y?.includes("tilemap"),m=f&&u.hasOwnProperty("maxExportTilesCount")?u.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:f,supportsTileMap:d},exportTiles:f?{maxExportTilesCount:+m}:null},this.tileInfo=i.fromJSON(h.tileInfo);const g=u.tileMap?t.addQueryParameters(t.join(c.path,u.tileMap),c.query??{}):null;d?(this.type="vector-tile",this.tilemap=new o(new s.TilemapCache({layer:{parsedUrl:c,tileInfo:this.tileInfo},minLOD:h.minLOD??this.tileInfo.lods[0].level,maxLOD:h.maxLOD??this.tileInfo.lods[this.tileInfo.lods.length-1].level}),g)):g&&(this.tilemap=new n(g)),this.fullExtent=r.fromJSON(u.fullExtent),this.initialExtent=r.fromJSON(u.initialExtent)}destroy(){this.tilemap?.destroy()}async getRefKey(e,t){return this.tilemap?this.tilemap.dataKey(e,t):e}requestTile(e,t,r,i){const s=this.tileServers[t%this.tileServers.length];return a.request(s,e,t,r,i)}isCompatibleWith(e){const t=this.tileInfo,r=e.tileInfo;if(!t.spatialReference.equals(r.spatialReference))return!1;if(!t.origin.equals(r.origin))return!1;if(Math.round(t.dpi)!==Math.round(r.dpi))return!1;const i=t.lods,s=r.lods,n=Math.min(i.length,s.length);for(let e=0;e<n;e++){const t=i[e],r=s[e];if(t.level!==r.level||Math.round(t.scale)!==Math.round(r.scale))return!1}return!0}}})},"esri/views/2d/engine/vectorTiles/TilemapIndex":function(){define(["../../../../request","../../../../core/promiseUtils","../../tiling/TileKey"],function(e,t,r){"use strict";return class{constructor(e){this.url=e}destroy(){this._tileIndexPromise=null}async fetchTileIndex(){return this._tileIndexPromise||(this._tileIndexPromise=e(this.url).then(e=>e.data.index)),this._tileIndexPromise}async dataKey(e,r){const i=await this.fetchTileIndex();return t.throwIfAborted(r),this._getIndexedDataKey(i,e)}_getIndexedDataKey(e,t){const i=[t];if(t.level<0||t.row<0||t.col<0||t.row>>t.level>0||t.col>>t.level>0)return null;let s=t;for(;0!==s.level;)s=new r(s.level-1,s.row>>1,s.col>>1,s.world),i.push(s);let n,o,a=e,l=i.pop();if(1===a)return l;for(;i.length;)if(n=i.pop(),o=(1&n.col)+((1&n.row)<<1),a){if(0===a[o]){l=null;break}if(1===a[o]){l=n;break}l=n,a=a[o]}return l}}})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],function(e){"use strict";class t{static{this.pool=new e(t,null,null,25,50)}static getId(e,t,r,i){return"object"==typeof e?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${t}/${r}/${i}`}constructor(e,t,r,i){this.set(e,t,r,i)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,t=4095&this.col,r=63&this.level;return(3&this.world)<<30|t<<22|e<<8|r}acquire(e,t,r,i){this.set(e,t,r,i)}contains(e){const t=e.level-this.level;return t>=0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}containsChild(e){const t=e.level-this.level;return t>0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new t(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,r,i){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){const[t,r,i,s]=e.split("/");this.level=parseFloat(t),this.row=parseFloat(r),this.col=parseFloat(i),this.world=parseFloat(s)}else this.level=+e,this.row=+t,this.col=+r,this.world=+i||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new t(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(e,t,r){const i=this.clone();return i.col+=e,i.row+=t,r.normalizeKey(i),i}getChildKeys(){const e=this.level+1,r=this.row<<1,i=this.col<<1,s=this.world;return[new t(e,r,i,s),new t(e,r,i+1,s),new t(e,r+1,i,s),new t(e,r+1,i+1,s)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}return t})},"esri/views/2d/engine/vectorTiles/TilemapRequest":function(){define(["../../../../request","../../../../core/maybe","../../../../core/promiseUtils","../../tiling/TileKey"],function(e,t,r,i){"use strict";return class{constructor(e,t){this._tilemap=e,this._tileIndexUrl=t}destroy(){this._tilemap=t.destroyMaybe(this._tilemap),this._tileIndexPromise=null}async fetchTileIndex(t){return this._tileIndexPromise||(this._tileIndexPromise=e(this._tileIndexUrl,{query:{...t?.query}}).then(e=>e.data.index)),this._tileIndexPromise}dataKey(e,t){const{level:s,row:n,col:o}=e,a=new i(e);return this._tilemap.fetchAvailabilityUpsample(s,n,o,a,t).then(()=>(a.world=e.world,a)).catch(e=>{if(r.isAbortError(e))throw e;return null})}}})},"esri/views/2d/engine/vectorTiles/style/VectorTilesRequestManager":function(){define(["exports","../../../../../request","../../../../../core/lang","../../../../../core/MapUtils","../../../../../core/promiseUtils","../../../../../core/urlUtils"],function(e,t,r,i,s,n){"use strict";class o{constructor(e){this._tileUrl=e,this._promise=null,this._abortController=null,this._abortOptions=[]}getData(e){(null==this._promise||s.isAborted(this._abortController?.signal))&&(this._promise=this._makeRequest(this._tileUrl));const t=this._abortOptions;return t.push(e),s.onAbort(e,()=>{t.every(e=>s.isAborted(e))&&this._abortController.abort()}),this._promise.then(e=>r.clone(e))}async _makeRequest(e){this._abortController=new AbortController;const{data:r}=await t(e,{responseType:"array-buffer",signal:this._abortController.signal});return r}}const a=new Map;e.request=function(e,t,r,s,l){const u=n.urlToObject(e),c=u.query;if(c)for(const[e,i]of Object.entries(c))switch(i){case"{x}":c[e]=s.toString();break;case"{y}":c[e]=r.toString();break;case"{z}":c[e]=t.toString()}const h=u.path;return function(e,t){return i.getOrCreateMapValue(a,e,()=>new o(e)).getData(t).finally(()=>a.delete(e))}(n.addQueryParameters(h.replaceAll(/\{z\}/gi,t.toString()).replaceAll(/\{y\}/gi,r.toString()).replaceAll(/\{x\}/gi,s.toString()),{...u.query}),l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/jsonContext":function(){define(["exports","../../core/urlUtils","../Portal"],function(e,t,r){"use strict";function i(e,i){return{origin:i,url:t.urlToObject(e.itemUrl),portal:e.portal||r.getDefault(),portalItem:e}}e.createForItemRead=function(e,t){return{...i(e,t),readResourcePaths:[]}},e.createForItemWrite=function(e,r,s){const n=t.urlToObject(e.itemUrl);return{...i(e,r),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:s?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/tileInfoUtils":function(){define(["exports","../../../../geometry/Point","../../../../layers/support/LOD","../../../../layers/support/TileInfo"],function(e,t,r,i){"use strict";const s=1e-6;e.areSchemasOverlapping=function(e,t){if(e===t)return!0;if(null==e&&null!=t)return!1;if(null!=e&&null==t)return!1;if(null==e||null==t)return!1;if(!e.spatialReference.equals(t.spatialReference)||e.dpi!==t.dpi)return!1;const r=e.origin,i=t.origin;if(Math.abs(r.x-i.x)>=s||Math.abs(r.y-i.y)>=s)return!1;let n,o;e.lods[0].scale>t.lods[0].scale?(n=e,o=t):(o=e,n=t);for(let e=n.lods[0].scale;e>=o.lods[o.lods.length-1].scale-s;e/=2)if(Math.abs(e-o.lods[0].scale)<s)return!0;return!1},e.unionTileInfos=function(e,s){if(e===s)return e;if(null==e&&null!=s)return s;if(null!=e&&null==s)return e;if(null==e||null==s)return null;const n=e.size[0],o=e.format,a=e.dpi,l=new t({x:e.origin.x,y:e.origin.y}),u=e.spatialReference,c=e.lods[0].scale>s.lods[0].scale?e.lods[0]:s.lods[0],h=e.lods[e.lods.length-1].scale<=s.lods[s.lods.length-1].scale?e.lods[e.lods.length-1]:s.lods[s.lods.length-1],p=c.scale,y=c.resolution,f=h.scale,d=[];let m=p,g=y,_=0;for(;m>=f;)d.push(new r({level:_,resolution:g,scale:m})),_++,m/=2,g/=2;return new i({size:[n,n],dpi:a,format:o||"pbf",origin:l,lods:d,spatialReference:u})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["../../../../../core/lang","./StyleLayer"],function(e,t){"use strict";class r{constructor(t,r=!0){if(this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,this._style=r?e.clone(t):t,this._style.layers||(this._style.layers=[]),this.version=parseFloat(this._style.version),this.layers=this._style.layers.map((e,t,r)=>this._create(e,t,r)).filter(e=>!!e),this.layers)for(let e=0;e<this.layers.length;e++){const t=this.layers[e];this._layerByName[t.id]=t,this._uidToLayer.set(t.uid,t),0===t.type&&this.backgroundBucketIds.push(t.id)}this._identifyRefLayers()}getLayerStyleProperties(e,t){const r=this.getStyleLayerByUID(e),i=0!==r?.getLayoutValue("symbol-placement",t);let s=r?.getLayoutValue("icon-rotation-alignment",t);2===s&&(s=i?0:1);let n=r?.getLayoutValue("text-rotation-alignment",t);2===n&&(n=i?0:1);const o=r?.getPaintValue("icon-translate",t),a=r?.getPaintValue("icon-translate-anchor",t),l=r?.getPaintValue("text-translate",t),u=r?.getPaintValue("text-translate-anchor",t);return{geometryType:null,iconAllowOverlap:r?.getLayoutValue("icon-allow-overlap",t),iconIgnorePlacement:r?.getLayoutValue("icon-ignore-placement",t),textAllowOverlap:r?.getLayoutValue("text-allow-overlap",t),textIgnorePlacement:r?.getLayoutValue("text-ignore-placement",t),iconRotationAlignment:s,textRotationAlignment:n,iconTranslateAnchor:a,iconTranslate:o,textTranslateAnchor:u,textTranslate:l}}isPainterDataDriven(e){const t=this._layerByName[e];return!!t&&t.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){return this._uidToLayer.get(e)??null}getStyleLayerIndex(e){const t=this._layerByName[e];return t?this.layers.indexOf(t):-1}setStyleLayer(e,t){if(!e?.id)return;const i=this._style;null!=t&&t>=this.layers.length&&(t=this.layers.length-1);let s,n=!0;const o=this._layerByName[e.id];if(o){const a=this.layers.indexOf(o);t||(t=a),t===a?(n=!1,s=r._recreateLayer(e,o),this.layers[t]=s,i.layers[t]=e):(this.layers.splice(a,1),i.layers.splice(a,1),s=this._create(e,t,this.layers),this.layers.splice(t,0,s),i.layers.splice(t,0,e))}else s=this._create(e,t,this.layers),!t||t>=this.layers.length?(this.layers.push(s),i.layers.push(e)):(this.layers.splice(t,0,s),i.layers.splice(t,0,e));this._layerByName[e.id]=s,this._uidToLayer.set(s.uid,s),n&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(e){const t=this._layerByName[e];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null}deleteStyleLayer(e){const t=this._layerByName[e];if(t){delete this._layerByName[e],this._uidToLayer.delete(t.uid);const r=this.layers.indexOf(t);this.layers.splice(r,1),this._style.layers.splice(r,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e]}getLayoutProperties(e){const t=this._layerByName[e];return t?t.layout:null}getPaintProperties(e){const t=this._layerByName[e];return t?t.paint:null}setPaintProperties(e,t){const i=this._layerByName[e];if(!i)return;const s={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:i.layout,paint:t},n=r._recreateLayer(s,i),o=this.layers.indexOf(i);this.layers[o]=n,this._style.layers[o].paint=t,this._layerByName[i.id]=n,this._uidToLayer.set(i.uid,n)}setLayoutProperties(e,t){const i=this._layerByName[e];if(!i)return;const s={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:t,paint:i.paint},n=r._recreateLayer(s,i),o=this.layers.indexOf(i);this.layers[o]=n,this._style.layers[o].layout=t,this._layerByName[i.id]=n,this._uidToLayer.set(i.uid,n)}setStyleLayerVisibility(e,t){const i=this._layerByName[e];if(!i)return;const s=i.layout||{};s.visibility=t;const n={type:i.typeName,id:i.id,source:i.source,"source-layer":i.sourceLayer,minzoom:i.minzoom,maxzoom:i.maxzoom,filter:i.filter,layout:s,paint:i.paint},o=r._recreateLayer(n,i),a=this.layers.indexOf(i);this.layers[a]=o,this._style.layers[a].layout=s,this._layerByName[i.id]=o,this._uidToLayer.set(i.uid,o)}getStyleLayerVisibility(e){const t=this._layerByName[e];if(!t)return"none";const r=t.layout;return r?.visibility??"visible"}_recomputeZValues(){const e=this.layers,t=1/(e.length+1);for(let r=0;r<e.length;r++)e[r].z=1-(1+r)*t}_identifyRefLayers(){const e=[],t=[];let r=0;for(const i of this.layers){const s=i.layout;if(1===i.type){const t=i;let n=i.source+"|"+i.sourceLayer;n+="|"+(s?.visibility??""),n+="|"+i.minzoom,n+="|"+i.maxzoom,n+="|"+JSON.stringify(i.filter),(t.hasDataDrivenFill||t.hasDataDrivenOutline)&&(n+="|"+r),e.push({key:n,layer:i})}else if(2===i.type){const e=i,n=i.paint,o=null!=n&&(null!=n["line-pattern"]||null!=n["line-dasharray"]);let a=i.source+"|"+i.sourceLayer;a+="|"+(s?.visibility??""),a+="|"+i.minzoom,a+="|"+i.maxzoom,a+="|"+JSON.stringify(i.filter),a+="|"+(void 0!==s?s["line-cap"]:""),a+="|"+(void 0!==s?s["line-join"]:""),(e.hasDataDrivenLine||o)&&(a+="|"+r),t.push({key:a,layer:i})}++r}this._assignRefLayers(e),this._assignRefLayers(t)}_assignRefLayers(e){let t,r;e.sort((e,t)=>e.key<t.key?-1:e.key>t.key?1:0);const i=e.length;for(let s=0;s<i;s++){const n=e[s];if(n.key===t)n.layer.refLayerId=r;else if(t=n.key,r=n.layer.id,1===n.layer.type){if(!n.layer.getPaintProperty("fill-outline-color"))for(let o=s+1;o<i;o++){const i=e[o];if(i.key!==t)break;if(i.layer.getPaintProperty("fill-outline-color")){e[s]=i,e[o]=n,r=i.layer.id;break}}}else if(2===n.layer.type){let o=n.layer;for(let a=s+1;a<i;a++){const i=e[a];if(i.key!==t)break;const l=i.layer;(o.canUseThinTessellation&&!l.canUseThinTessellation||!o.canUseThinTessellation&&(l.getPaintProperty("line-pattern")||l.getPaintProperty("line-dasharray")))&&(o=l,e[s]=i,e[a]=n,r=i.layer.id)}}}}_create(e,r,i){const s=1-(1+r)*(1/(i.length+1)),n=this._runningId++;switch(e.type){case"background":return new t.BackgroundStyleLayer(0,e,s,n);case"fill":return new t.FillStyleLayer(1,e,s,n);case"line":return new t.LineStyleLayer(2,e,s,n);case"symbol":return new t.SymbolStyleLayer(3,e,s,n);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new t.CircleStyleLayer(4,e,s,n)}return null}static _recreateLayer(e,r){switch(e.type){case"background":return new t.BackgroundStyleLayer(0,e,r.z,r.uid);case"fill":return new t.FillStyleLayer(1,e,r.z,r.uid);case"line":return new t.LineStyleLayer(2,e,r.z,r.uid);case"symbol":return new t.SymbolStyleLayer(3,e,r.z,r.uid);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new t.CircleStyleLayer(4,e,r.z,r.uid)}return null}}return r})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define(["exports","../../../../../geometry/support/aaBoundingRect","../constants","../GeometryUtils","../shaders/VTLBackgroundMaterial","../shaders/VTLCircleMaterial","../shaders/VTLFillMaterial","../shaders/VTLLineMaterial","../shaders/VTLSymbolMaterial","./Filter","./StyleDefinition","./StyleProperty","../../webgl/definitions"],function(e,t,r,i,s,n,o,a,l,u,c,h,p){"use strict";class y{constructor(e,t,r,i){switch(this.type=e,this.typeName=t.type,this.id=t.id,this.source=t.source,this.sourceLayer=t["source-layer"],this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.filter=t.filter,this.layout=t.layout,this.paint=t.paint,this.z=r,this.uid=i,e){case 0:this._layoutDefinition=c.StyleDefinition.backgroundLayoutDefinition,this._paintDefinition=c.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=c.StyleDefinition.fillLayoutDefinition,this._paintDefinition=c.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=c.StyleDefinition.lineLayoutDefinition,this._paintDefinition=c.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=c.StyleDefinition.symbolLayoutDefinition,this._paintDefinition=c.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=c.StyleDefinition.circleLayoutDefinition,this._paintDefinition=c.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=u.createFilter(this.filter)}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,t,r){let i;const s=this._layoutProperties[e];return s&&(i=s.getValue(t,r)),void 0===i&&(i=this._layoutDefinition[e].default),i}getPaintValue(e,t,r){let i;const s=this._paintProperties[e];return s&&(i=s.getValue(t,r)),void 0===i&&(i=this._paintDefinition[e].default),i}isPainterDataDriven(){const e=this._paintProperties;if(e)for(const t in e)if(e[t].isDataDriven)return!0;return!1}isIntersectingFeature(e,t,r,i,s,n,o){return!1}getFeatureInflatedBounds(e,t,r,i){return null}_parseLayout(e){const t={};for(const r in e){const i=this._layoutDefinition[r];i&&(t[r]=new h(i,e[r]))}return t}_parsePaint(e){const t={};for(const r in e){const i=this._paintDefinition[r];i&&(t[r]=new h(i,e[r]))}return t}computeAttributesKey(e,t,r,i){let s=0,n=0;for(const e of t){let t=3;if(!e||e!==i){const i=r[e],{isLayout:s,isOptional:n}=i,o=s?this.getLayoutProperty(e):this.getPaintProperty(e);t=o?.interpolator?2:o?.isDataDriven?1:n&&!o?3:0}n|=t<<s,s+=2}return n<<3|e}}function f(e){const r=e?.getGeometry();if(null==r)return null;let i=1/0,s=1/0,n=-1/0,o=-1/0;for(const e of r)if(e)for(const t of e)i=Math.min(i,t.x),s=Math.min(s,t.y),n=Math.max(n,t.x),o=Math.max(o,t.y);return t.fromValues(i,s,n,o)}e.BackgroundStyleLayer=class extends y{constructor(e,t,r,i){super(e,t,r,i),this.backgroundMaterial=new s.VTLBackgroundMaterial(this.computeAttributesKey(0,s.VTLBackgroundMaterial.ATTRIBUTES,s.VTLBackgroundMaterial.ATTRIBUTES_INFO))}},e.CircleStyleLayer=class extends y{constructor(e,t,r,i){super(e,t,r,i),this.circleMaterial=new n.VTLCircleMaterial(this.computeAttributesKey(5,n.VTLCircleMaterial.ATTRIBUTES,n.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(e,t,i,s){const n=f(e);if(!n)return null;const o=this.getPaintValue("circle-translate",t,e),a=Math.max(o[0],o[1]);n[0]-=a,n[2]-=a,n[1]+=a,n[3]+=a;const l=s*(r.tilePixelRatio*(this.getPaintValue("circle-radius",t,e)+this.getPaintValue("circle-stroke-width",t,e))/2);return n[0]-=l,n[1]-=l,n[2]+=l,n[3]+=l,n}isIntersectingFeature(e,t,s,n,o,a,l){const u=n.getGeometry();if(!u)return!1;const c=r.tilePixelRatio/l.normalizationRatio;e=e/l.normalizationRatio+l.normalizationOffsetX,t=t/l.normalizationRatio+l.normalizationOffsetY,s*=c;const h=i.translateAnchor(this.getPaintValue("circle-translate",o,n),this.getPaintValue("circle-translate-anchor",o,n),a,c),p=c*(this.getPaintValue("circle-radius",o,n)+this.getPaintValue("circle-stroke-width",o,n));let y,f;for(const r of u)if(r)for(const i of r)if(y=i.x+h.x,f=i.y+h.y,Math.sqrt((e-y)*(e-y)+(t-f)*(t-f))-s<=p)return!0;return!1}},e.FillStyleLayer=class extends y{constructor(e,t,r,i){super(e,t,r,i);const s=this.getPaintProperty("fill-color"),n=this.getPaintProperty("fill-opacity"),a=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=s?.isDataDriven,this.hasDataDrivenOpacity=n?.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||a?.isDataDriven;const l=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!l,this.hasDataDrivenOutlineColor=l?.isDataDriven,this.hasDataDrivenOutline=l?l.isDataDriven:!!s&&s.isDataDriven,this.hasDataDrivenOutline=(l?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new o.VTLFillMaterial(this.computeAttributesKey(1,o.VTLFillMaterial.ATTRIBUTES,o.VTLFillMaterial.ATTRIBUTES_INFO)),this.outlineMaterial=new o.VTLOutlineMaterial(this.computeAttributesKey(2,this.outlineUsesFillColor?o.VTLOutlineMaterial.ATTRIBUTES_FILL:o.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?o.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:o.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(e,t,r,i){const s=f(e);if(!s)return null;const n=this.getPaintValue("fill-translate",t,e),o=i*Math.max(n[0],n[1]);return s[0]-=o,s[2]-=o,s[1]+=o,s[3]+=o,s}isIntersectingFeature(e,t,s,n,o,a,l){const u=n.getGeometry();if(!u)return!1;const c=r.tilePixelRatio/l.normalizationRatio;e=e/l.normalizationRatio+l.normalizationOffsetX,t=t/l.normalizationRatio+l.normalizationOffsetY;const h=i.translateAnchor(this.getPaintValue("fill-translate",o,n),this.getPaintValue("fill-translate-anchor",o,n),a,r.tilePixelRatio);return e-=c*h.x,t-=c*h.y,!!i.pointInPolygon(e,t,u)||i.distanceFromToPolylineWithinThreshold(e,t,u,c*s)}},e.IconLayout=class{constructor(e,t,r){let i;this.allowOverlap=e.getLayoutValue("icon-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",t),this.keepUpright=e.getLayoutValue("icon-keep-upright",t),this.optional=e.getLayoutValue("icon-optional",t),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1),i=e.getLayoutProperty("icon-anchor"),i?.isDataDriven?this._anchorProp=i:this.anchor=e.getLayoutValue("icon-anchor",t),i=e.getLayoutProperty("icon-offset"),i?.isDataDriven?this._offsetProp=i:this.offset=e.getLayoutValue("icon-offset",t),i=e.getLayoutProperty("icon-padding"),i?.isDataDriven?this._paddingProp=i:this.padding=e.getLayoutValue("icon-padding",t),i=e.getLayoutProperty("icon-rotate"),i?.isDataDriven?this._rotateProp=i:this.rotate=e.getLayoutValue("icon-rotate",t),i=e.getLayoutProperty("icon-size"),i?.isDataDriven?this._sizeProp=i:this.size=e.getLayoutValue("icon-size",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t))}},e.IndexItem=class{constructor(e,t,r,i,s,n){this.layer=e,this.feature=t,this.bounds=r,this.normalizationRatio=i,this.normalizationOffsetX=s,this.normalizationOffsetY=n}},e.LineStyleLayer=class extends y{constructor(e,t,r,i){super(e,t,r,i);const s=this.getPaintProperty("line-pattern");if(this.lineMaterial=new a.VTLLineMaterial(this.computeAttributesKey(3,a.VTLLineMaterial.ATTRIBUTES,a.VTLLineMaterial.ATTRIBUTES_INFO,s?"line-dasharray":"")),this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven,this.canUseThinTessellation=!1,!this.hasDataDrivenLine){const e=this.getPaintProperty("line-width");if(!e||"number"==typeof e&&.5*e<p.thinLineHalfWidthThreshold){const e=this.getPaintProperty("line-offset");(!e||"number"==typeof e&&0===e)&&(this.canUseThinTessellation=!0)}}}getDashKey(e,t){let r;switch(t){case 0:default:r="Butt";break;case 1:r="Round";break;case 2:r="Square"}return`dasharray-[${e.toString()}]-${r}`}getFeatureInflatedBounds(e,t,r,i){const s=f(e);if(!s)return null;const n=this.getPaintValue("line-translate",t,e),o=i*Math.max(n[0],n[1]);s[0]-=o,s[2]-=o,s[1]+=o,s[3]+=o;const a=i*Math.abs(this.getPaintValue("line-offset",t,e)||0),l=i*(this.getPaintValue("line-width",t,e)/2);return s[0]-=a+l,s[1]-=a+l,s[2]+=a+l,s[3]+=a+l,s}isIntersectingFeature(e,t,s,n,o,a,l){let u=n.getGeometry();if(!u)return!1;const c=r.tilePixelRatio/l.normalizationRatio;e=e/l.normalizationRatio+l.normalizationOffsetX,t=t/l.normalizationRatio+l.normalizationOffsetY;const h=i.translateAnchor(this.getPaintValue("line-translate",o,n),this.getPaintValue("line-translate-anchor",o,n),a,r.tilePixelRatio);e-=c*h.x,t-=c*h.y;const p=c*this.getPaintValue("line-offset",o,n)||0;0!==p&&(u=i.offsetLine(u,-p));const y=this.getPaintValue("line-width",o,n)/2;return i.distanceFromToPolylineWithinThreshold(e,t,u,c*(s+y))}},e.StyleLayer=y,e.SymbolStyleLayer=class extends y{constructor(e,t,r,i){super(e,t,r,i),this.iconMaterial=new l.VTLIconMaterial(this.computeAttributesKey(4,l.VTLIconMaterial.ATTRIBUTES,l.VTLIconMaterial.ATTRIBUTES_INFO)),this.textMaterial=new l.VTLTextMaterial(this.computeAttributesKey(6,l.VTLTextMaterial.ATTRIBUTES,l.VTLTextMaterial.ATTRIBUTES_INFO)),this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven,this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}},e.TextLayout=class{constructor(e,t,r){let i;this.allowOverlap=e.getLayoutValue("text-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",t),this.keepUpright=e.getLayoutValue("text-keep-upright",t),this.optional=e.getLayoutValue("text-optional",t),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=r?0:1),i=e.getLayoutProperty("text-anchor"),i?.isDataDriven?this._anchorProp=i:this.anchor=e.getLayoutValue("text-anchor",t),i=e.getLayoutProperty("text-justify"),i?.isDataDriven?this._justifyProp=i:this.justify=e.getLayoutValue("text-justify",t),i=e.getLayoutProperty("text-letter-spacing"),i?.isDataDriven?this._letterSpacingProp=i:this.letterSpacing=e.getLayoutValue("text-letter-spacing",t),i=e.getLayoutProperty("text-line-height"),i?.isDataDriven?this._lineHeightProp=i:this.lineHeight=e.getLayoutValue("text-line-height",t),i=e.getLayoutProperty("text-max-angle"),i?.isDataDriven?this._maxAngleProp=i:this.maxAngle=e.getLayoutValue("text-max-angle",t),i=e.getLayoutProperty("text-max-width"),i?.isDataDriven?this._maxWidthProp=i:this.maxWidth=e.getLayoutValue("text-max-width",t),i=e.getLayoutProperty("text-offset"),i?.isDataDriven?this._offsetProp=i:this.offset=e.getLayoutValue("text-offset",t),i=e.getLayoutProperty("text-padding"),i?.isDataDriven?this._paddingProp=i:this.padding=e.getLayoutValue("text-padding",t),i=e.getLayoutProperty("text-rotate"),i?.isDataDriven?this._rotateProp=i:this.rotate=e.getLayoutValue("text-rotate",t),i=e.getLayoutProperty("text-size"),i?.isDataDriven?this._sizeProp=i:this.size=e.getLayoutValue("text-size",t),i=e.getLayoutProperty("text-writing-mode"),i?.isDataDriven?this._writingModeProp=i:this.writingMode=e.getLayoutValue("text-writing-mode",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,t)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,t)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,t)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,t)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,t))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/constants":function(){define(["exports"],function(e){"use strict";e.tileCoordSize=4096,e.tileCoordinateScale=.125,e.tilePixelRatio=8,e.tilePixelSize=512,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports","../../../../geometry/support/coordsUtils","../../../../geometry/support/TileClipper"],function(e,t,r){"use strict";const i=Number.POSITIVE_INFINITY,s=Math.PI,n=2*s,o=128/s,a=256/360,l=s/180,u=1/Math.LN2;function c(e,t){return(e%=t)>=0?e:e+t}e.between=function(e,t,r){return e>=t&&e<=r||e>=r&&e<=t},e.c2pi=n,e.cDegTo256=a,e.cDegToRad=l,e.cInfinity=i,e.cPi=s,e.cRadTo256=o,e.degToByte=function(e){return c(e*a,256)},e.distanceFromToPolylineWithinThreshold=function(e,r,i,s){let n,o,a,l;const u=s*s;for(const s of i){const i=s.length;if(!(i<2)){n=s[0].x,o=s[0].y;for(let c=1;c<i;++c){if(a=s[c].x,l=s[c].y,t.distanceToSegmentSquared(e,r,n,o,a,l)<u)return!0;n=a,o=l}}}return!1},e.getTileMargins=function(e){return 8+Math.max(16*(e-14),0)},e.interpolate=function(e,t,r){return e*(1-r)+t*r},e.isCircleOverlapingRect=function(e,t,r,i,s,n,o){const a=Math.max(i,Math.min(t,n))-t,l=Math.max(s,Math.min(r,o))-r;return a*a+l*l<=e*e},e.log2=function(e){return Math.log(e)*u},e.offsetLine=function(e,t){if(0===t||Number.isNaN(t))return e;const i=[],s=new r.Point(0,0),n=new r.Point(0,0),o=new r.Point(0,0);for(let a=0;a<e.length;a++){const l=e[a],u=[];for(let e=0;e<l.length;e++){const i=l[e-1],a=l[e],c=l[e+1];0===e?s.setCoords(0,0):s.assignSub(a,i).normalize().rightPerpendicular(),e===l.length-1?n.setCoords(0,0):n.assignSub(c,a).normalize().rightPerpendicular(),o.assignAdd(s,n).normalize();const h=o.x*n.x+o.y*n.y;0!==h&&o.scale(1/h),u.push(r.Point.add(a,o.scale(t)))}i.push(u)}return i},e.pointInPolygon=function(e,t,r){let i,s,n,o=0;for(const a of r){i=a.length;for(let r=1;r<i;++r)s=a[r-1],n=a[r],s.y>t!=n.y>t&&((n.x-s.x)*(t-s.y)-(n.y-s.y)*(e-s.x)>0?o++:o--)}return 0!==o},e.positiveMod=c,e.radToByte=function(e){return c(e*o,256)},e.sqr=function(e){return e*e},e.translateAnchor=function(e,t,i,s){const n=new r.Point(e[0],e[1]);if(n.scale(s),"viewport"===t){const e=-i*(Math.PI/180),t=Math.cos(e),r=Math.sin(e);n.rotate(t,r)}return n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(e){"use strict";class t{constructor(e,t){this.x=e,this.y=t}static fromArray(e){return new t(e[0],e[1])}clone(){return new t(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){return this.x=e,this.y=t,this}normalize(){const e=this.x,t=this.y,r=Math.sqrt(e*e+t*t);return this.x/=r,this.y/=r,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,t){return this.x+=e,this.y+=t,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}assignSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}rotate(e,t){const r=this.x,i=this.y;return this.x=r*e-i*t,this.y=r*t+i*e,this}rotateReverse(e,t){const r=this.x,i=this.y;return this.x=r*e+i*t,this.y=-r*t+i*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,t){const r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}static add(e,r){return new t(e.x+r.x,e.y+r.y)}static sub(e,r){return new t(e.x-r.x,e.y-r.y)}}class r{constructor(e,t,r){this.ratio=e,this.x=t,this.y=r}}class i{static simplify(e,t,r){if(!r)return;const s=-t,n=e+t,o=-t,a=e+t,l=[],u=[],c=r.length;for(let e=0;e<c;++e){const t=r[e];if(!t||t.length<2)continue;let i,c=t[0];const h=t.length;for(let r=1;r<h;++r)i=t[r],c.x===i.x&&(c.x<=s&&(c.y>i.y?(l.push(e),l.push(r),l.push(0),l.push(-1)):(u.push(e),u.push(r),u.push(0),u.push(-1))),c.x>=n&&(c.y<i.y?(l.push(e),l.push(r),l.push(1),l.push(-1)):(u.push(e),u.push(r),u.push(1),u.push(-1)))),c.y===i.y&&(c.y<=o&&(c.x<i.x?(l.push(e),l.push(r),l.push(2),l.push(-1)):(u.push(e),u.push(r),u.push(2),u.push(-1))),c.y>=a&&(c.x>i.x?(l.push(e),l.push(r),l.push(3),l.push(-1)):(u.push(e),u.push(r),u.push(3),u.push(-1)))),c=i}if(0===l.length||0===u.length)return;i.fillParent(r,u,l),i.fillParent(r,l,u);const h=[];i.calcDeltas(h,u,l),i.calcDeltas(h,l,u),i.addDeltas(h,r)}static fillParent(e,t,r){const i=r.length,n=t.length;for(let o=0;o<n;o+=4){const n=t[o],a=t[o+1],l=t[o+2],u=e[n][a-1],c=e[n][a];let h=8092,p=-1;for(let t=0;t<i;t+=4){if(r[t+2]!==l)continue;const i=r[t],n=r[t+1],o=e[i][n-1],a=e[i][n];switch(l){case 0:case 1:if(s(u.y,o.y,a.y)&&s(c.y,o.y,a.y)){const e=Math.abs(a.y-o.y);e<h&&(h=e,p=t)}break;case 2:case 3:if(s(u.x,o.x,a.x)&&s(c.x,o.x,a.x)){const e=Math.abs(a.x-o.x);e<h&&(h=e,p=t)}}}t[o+3]=p}}static calcDeltas(e,t,r){const s=t.length;for(let n=0;n<s;n+=4){const s=[],o=i.calcDelta(n,t,r,s);e.push(t[n]),e.push(t[n+1]),e.push(t[n+2]),e.push(o)}}static calcDelta(e,t,r,s){const n=t[e+3];if(-1===n)return 0;const o=s.length;return o>1&&s[o-2]===n?0:(s.push(n),i.calcDelta(n,r,t,s)+1)}static addDeltas(e,t){const r=e.length;let i=0;for(let t=0;t<r;t+=4){const r=e[t+3];r>i&&(i=r)}for(let s=0;s<r;s+=4){const r=t[e[s]],n=e[s+1],o=i-e[s+3];switch(e[s+2]){case 0:r[n-1].x-=o,r[n].x-=o,1===n&&(r[r.length-1].x-=o),n===r.length-1&&(r[0].x-=o);break;case 1:r[n-1].x+=o,r[n].x+=o,1===n&&(r[r.length-1].x+=o),n===r.length-1&&(r[0].x+=o);break;case 2:r[n-1].y-=o,r[n].y-=o,1===n&&(r[r.length-1].y-=o),n===r.length-1&&(r[0].y-=o);break;case 3:r[n-1].y+=o,r[n].y+=o,1===n&&(r[r.length-1].y+=o),n===r.length-1&&(r[0].y+=o)}}}}const s=(e,t,r)=>e>=t&&e<=r||e>=r&&e<=t;e.Point=t,e.SimpleBuilder=class{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,r){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new t(e*i,r*i))}lineTo(e,r){const i=this._ratio;this._line.push(new t(e*i,r*i))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}},e.TileClipper=class{constructor(e,t,r,i=8,s=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=i,this._pixelMargin=s,this._tileSize=512*i,this._dz=e,this._yPos=t,this._xPos=r}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;const r=e>>this._dz;t>r&&(t=r),this._margin=t,this._xmin=r*this._xPos-t,this._ymin=r*this._yPos-t,this._xmax=this._xmin+r+2*t,this._ymax=this._ymin+r+2*t}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,r){this._pushLine(),this._prevIsIn=this._isIn(e,r),this._moveTo(e,r,this._prevIsIn),this._prevPt=new t(e,r),this._firstPt=new t(e,r),this._dist=0}lineTo(e,i){const s=this._isIn(e,i),n=new t(e,i),o=t.distance(this._prevPt,n);let a,l,u,c,h,p,y,f;if(s)this._prevIsIn?this._lineTo(e,i,!0):(a=this._prevPt,l=n,u=this._intersect(l,a),this._start=this._dist+o*(1-this._r),this._lineTo(u.x,u.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,a=n,u=this._intersect(l,a),this._lineTo(u.x,u.y,!0),this._lineTo(a.x,a.y,!1);else{const e=this._prevPt,t=n;if(e.x<=this._xmin&&t.x<=this._xmin||e.x>=this._xmax&&t.x>=this._xmax||e.y<=this._ymin&&t.y<=this._ymin||e.y>=this._ymax&&t.y>=this._ymax)this._lineTo(t.x,t.y,!1);else{const i=[];if((e.x<this._xmin&&t.x>this._xmin||e.x>this._xmin&&t.x<this._xmin)&&(c=(this._xmin-e.x)/(t.x-e.x),f=e.y+c*(t.y-e.y),f<=this._ymin?p=!1:f>=this._ymax?p=!0:i.push(new r(c,this._xmin,f))),(e.x<this._xmax&&t.x>this._xmax||e.x>this._xmax&&t.x<this._xmax)&&(c=(this._xmax-e.x)/(t.x-e.x),f=e.y+c*(t.y-e.y),f<=this._ymin?p=!1:f>=this._ymax?p=!0:i.push(new r(c,this._xmax,f))),(e.y<this._ymin&&t.y>this._ymin||e.y>this._ymin&&t.y<this._ymin)&&(c=(this._ymin-e.y)/(t.y-e.y),y=e.x+c*(t.x-e.x),y<=this._xmin?h=!1:y>=this._xmax?h=!0:i.push(new r(c,y,this._ymin))),(e.y<this._ymax&&t.y>this._ymax||e.y>this._ymax&&t.y<this._ymax)&&(c=(this._ymax-e.y)/(t.y-e.y),y=e.x+c*(t.x-e.x),y<=this._xmin?h=!1:y>=this._xmax?h=!0:i.push(new r(c,y,this._ymax))),0===i.length)h?p?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):p?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(i.length>1&&i[0].ratio>i[1].ratio)this._start=this._dist+o*i[1].ratio,this._lineTo(i[1].x,i[1].y,!0),this._lineTo(i[0].x,i[0].y,!0);else{this._start=this._dist+o*i[0].ratio;for(let e=0;e<i.length;e++)this._lineTo(i[e].x,i[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=o,this._prevIsIn=s,this._prevPt=n}close(){if(this._line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const r=this._line;let i=r.length;for(;i>=4&&(r[0].x===r[1].x&&r[0].x===r[i-2].x||r[0].y===r[1].y&&r[0].y===r[i-2].y);)r.pop(),r[0].x=r[i-2].x,r[0].y=r[i-2].y,--i}}result(e=!0){return this._pushLine(),0===this._lines.length?null:(3===this._type&&e&&i.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(2!==this._type)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,t=e.length;if(0===t)return null;const r=[];for(let i=0;i<t;i++)r.push({line:e[i],start:this._starts[i]||0});return r}_isIn(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_intersect(e,r){let i,s,n;if(r.x>=this._xmin&&r.x<=this._xmax)s=r.y<=this._ymin?this._ymin:this._ymax,n=(s-e.y)/(r.y-e.y),i=e.x+n*(r.x-e.x);else if(r.y>=this._ymin&&r.y<=this._ymax)i=r.x<=this._xmin?this._xmin:this._xmax,n=(i-e.x)/(r.x-e.x),s=e.y+n*(r.y-e.y);else{s=r.y<=this._ymin?this._ymin:this._ymax,i=r.x<=this._xmin?this._xmin:this._xmax;const t=(i-e.x)/(r.x-e.x),o=(s-e.y)/(r.y-e.y);t<o?(n=t,s=e.y+t*(r.y-e.y)):(n=o,i=e.x+o*(r.x-e.x))}return this._r=n,new t(i,s)}_pushLine(){this._line&&(1===this._type?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):2===this._type?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):3===this._type&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,r,i){3!==this._type?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.push(new t(e,r))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),r<this._ymin&&(r=this._ymin),r>this._ymax&&(r=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.push(new t(e,r)),this._isH=!1,this._isV=!1)}_lineTo(e,r,i){let s,n;if(3!==this._type)if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(s=this._line[this._line.length-1],s.equals(e,r)))return;this._line.push(new t(e,r))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),r<this._ymin&&(r=this._ymin),r>this._ymax&&(r=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),r=Math.round((r-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){s=this._line[this._line.length-1];const i=s.x===e,o=s.y===r;if(i&&o)return;this._isH&&i||this._isV&&o?(s.x=e,s.y=r,n=this._line[this._line.length-2],n.x===e&&n.y===r?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===r)):(this._isH=n.x===e,this._isV=n.y===r)):(this._line.push(new t(e,r)),this._isH=i,this._isV=o)}else this._line.push(new t(e,r))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,r,i){"use strict";class s extends t.VTLMaterial{static{this.ATTRIBUTES=[]}static{this.GEOMETRY_LAYOUT=[new i.VertexElementDescriptor("a_pos",2,r.DataType.BYTE,0,2)]}static{this.ATTRIBUTES_INFO={}}constructor(e){super(e),this.baseGeometryLayout=s.GEOMETRY_LAYOUT,this.attributes=s.ATTRIBUTES,this.attributesInfo=s.ATTRIBUTES_INFO}}e.VTLBackgroundMaterial=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports","../MemoryBuffer","../../../../webgl/enums","../../../../webgl/VertexAttributeLocations","../../../../webgl/VertexElementDescriptor"],function(e,t,r,i,s){"use strict";class n{constructor(e){this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._geometryLayout||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return this._geometryLayout||this._buildAttributesInfo(),this._locations}get geometryLayout(){return this._geometryLayout||this._buildAttributesInfo(),this._geometryLayout}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,t,r,i,s){const n=this.getUniforms();for(const o of n){const{name:n,type:a,getValue:l}=o,u=l(r,t,i,s);if(null!==u)switch(a){case"float":e.setUniform1f(n,u);break;case"vec2":e.setUniform2fv(n,u);break;case"vec4":e.setUniform4fv(n,u)}}}encodeAttributes(e,t,r,i){const s=this.attributesInfo,n=this.getEncodingInfos(),o=[];let a=0,l=0;for(const u of Object.keys(n)){const c=n[u],{type:h,precisionFactor:p,isLayout:y}=s[u],f=y?r.getLayoutProperty(u):r.getPaintProperty(u),d=f.interpolator?.getInterpolationRange(t);let m=0;for(const r of c){const{offset:s,bufferElementsToAdd:n}=r;if(n>0){for(let e=0;e<n;e++)o.push(0);a+=l,l=r.bufferElementsToAdd}const u=i??f.getValue(d?d[m]:t,e);switch(h){case 0:case 1:o[a]|=this._encodeByte(u*(p||1),8*s);break;case 2:case 3:o[a]|=this._encodeShort(u*(p||1),8*s);break;case 4:case 5:o[a]|=this._encodeByte(u*(p||1),8*s),o[a]|=this._encodeByte(u*(p||1),8*s+8);break;case 6:case 7:o[a]|=this._encodeShort(u*(p||1),8*s),o[a]|=this._encodeShort(u*(p||1),8*s+16);break;case 8:case 9:o[a]|=this._encodeByte(u*(p||1),8*s),o[a]|=this._encodeByte(u*(p||1),8*s+8),o[a]|=this._encodeByte(u*(p||1),8*s+16),o[a]|=this._encodeByte(u*(p||1),8*s+24);break;case 10:o[a]=this._encodeColor(u);break;case 11:case 12:this._encodePattern(a,o,u);break;default:throw new Error("Unsupported encoding type")}m++}}return o}getAtributeState(e){let t=0;const r=3+2*e;return t|=this._bit(r),t|=this._bit(r+1)<<1,t}static{this._encodingInfo={0:{dataType:r.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},1:{dataType:r.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},2:{dataType:r.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},3:{dataType:r.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},4:{dataType:r.DataType.BYTE,bytesPerElement:1,count:2,normalized:!1},5:{dataType:r.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},6:{dataType:r.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},7:{dataType:r.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},8:{dataType:r.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},9:{dataType:r.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},10:{dataType:r.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},11:{dataType:r.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},12:{dataType:r.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}}}_buildAttributesInfo(){const e=[],t={},{attributesInfo:i,attributes:s}=this,o={};let a=-1,l=-1;for(const r of s){l++;const s=this.getAtributeState(l);if(0===s||3===s)continue;const u=i[r],c=[];t[r]=c;const h=u.type;for(let t=0;t<s;t++){const{dataType:t,bytesPerElement:r,count:i,normalized:s}=n._encodingInfo[h],l=r*i,u=`${t}-${!0===s}`;let p=o[u],y=0;if(!p||p.count+i>4)a++,p={dataIndex:a,count:0,offset:0},4!==i&&(o[u]=p),e.push({location:-1,name:"a_data_"+a,count:i,type:t,normalized:s}),y=Math.ceil(Math.max(l/4,1));else{const t=e[p.dataIndex];t.count+=i,y=Math.ceil(Math.max(t.count*r/4,1))-Math.ceil(Math.max(p.offset/4,1))}c.push({dataIndex:p.dataIndex,offset:p.offset,bufferElementsToAdd:y}),p.offset+=l,p.count+=i}}for(const t of e)switch(t.type){case r.DataType.BYTE:case r.DataType.UNSIGNED_BYTE:t.count=4;break;case r.DataType.SHORT:case r.DataType.UNSIGNED_SHORT:t.count+=t.count%2}this._buildVertexBufferLayout(e),this._buildShaderInfo(e,t),this._propertyEncodingInfo=t}_buildVertexBufferLayout(e){const t=this.baseGeometryLayout;let r=t[0].stride;if(0===e.length)this._geometryLayout=t;else{const i=[];let n=r;for(const t of e)r+=o(t.type)*t.count;for(const e of t)i.push(new s.VertexElementDescriptor(e.name,e.count,e.type,e.offset,r,e.normalized));for(const t of e)i.push(new s.VertexElementDescriptor(t.name,t.count,t.type,n,r,t.normalized)),n+=o(t.type)*t.count;this._geometryLayout=i}this.opacityLayout?this._locations=i.fromLayouts([this._geometryLayout,this.opacityLayout]):this._locations=i.fromLayout(this._geometryLayout),this._stride=r}_buildShaderInfo(e,t){let r="\n",i="\n";const s=[];for(const t of e)r+=`attribute ${this._getType(t.count)} ${t.name};\n`;const{attributesInfo:o,attributes:l}=this;let u=-1;for(const e of l){u++;const{name:l,type:c,precisionFactor:h,isLayout:p}=o[e],y=h&&1!==h?" * "+1/h:"",{bytesPerElement:f,count:d}=n._encodingInfo[c],m=e=>`a_data_${e.dataIndex}${a(d,e.offset,f)}`;switch(this.getAtributeState(u)){case 0:{const t=this._getType(d),n=`u_${l}`;s.push({name:n,type:t,getValue:(t,r,i,s)=>{const n=p?t.getLayoutValue(e,r):t.getPaintValue(e,r);if(11===c){const e=t.getDashKey(n,t.getLayoutValue("line-cap",r)),i=s.getMosaicItemPosition(e,!1);if(null==i)return null;const{tl:o,br:a}=i;return[o[0],a[1],a[0],o[1]]}if(12===c){const t=s.getMosaicItemPosition(n,!e.includes("line-"));if(null==t)return null;const{tl:r,br:i}=t;return[r[0],i[1],i[0],r[1]]}if(10===c){const e=n[3];return[e*n[0],e*n[1],e*n[2],e]}return n}}),r+=`uniform ${t} ${n};\n`,i+=`${t} ${l} = ${n};\n`}break;case 1:{const r=m(t[e][0]);i+=`${this._getType(d)} ${l} = ${r}${y};\n`}break;case 2:{const n=`u_t_${l}`;s.push({name:n,type:"float",getValue:(t,r,i,s)=>(p?t.getLayoutProperty(e):t.getPaintProperty(e)).interpolator.interpolationUniformValue(i,r)}),r+=`uniform float ${n};\n`;const o=m(t[e][0]),a=m(t[e][1]);i+=`${this._getType(d)} ${l} = mix(${o}${y}, ${a}${y}, ${n});\n`}}}this._shaderHeader=r,this._shaderMain=i,this._uniforms=s}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(e){const r=255*e[3];return t.i8888to32(e[0]*r,e[1]*r,e[2]*r,r)}_encodePattern(e,t,r){if(!r?.rect)return;const i=r.rect,s=r.width,n=r.height;t[e]=this._encodeShort(i.x+2,0),t[e]|=this._encodeShort(i.y+2+n,16),t[e+1]=this._encodeShort(i.x+2+s,0),t[e+1]|=this._encodeShort(i.y+2,16)}_encodeByte(e,t){return(255&e)<<t}_encodeShort(e,t){return(65535&e)<<t}}const o=e=>{switch(e){case r.DataType.FLOAT:case r.DataType.INT:case r.DataType.UNSIGNED_INT:return 4;case r.DataType.SHORT:case r.DataType.UNSIGNED_SHORT:case r.DataType.HALF_FLOAT:return 2;case r.DataType.BYTE:case r.DataType.UNSIGNED_BYTE:return 1}},a=(e,t,r)=>{const i=t/r;if(1===e)switch(i){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===e)switch(i){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===e)switch(i){case 0:return".xyz";case 1:return".yzw"}return""};e.VTLMaterial=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../core/has"],function(e){"use strict";return class{constructor(e){this._array=[],this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,t){return 65535&e|t<<16}static i8888to32(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24}static i8816to32(e,t,r){return 255&e|(255&t)<<8|r<<16}}})},"esri/views/webgl/enums":function(){define(["exports"],function(e){"use strict";const t={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:5131},r={RGBA4:32854,R16F:33325,RG16F:33327,RGB32F:34837,RGBA16F:34842,R32F:33326,RG32F:33328,RGBA32F:34836,R11F_G11F_B10F:35898,RGB8:32849,RGBA8:32856,RGB5_A1:32855,R8:33321,RG8:33323,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,RGB16F:34843,RGB9_E5:35901,SRGB8:35905,SRGB8_ALPHA8:35907,RGB565:36194,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2:32857,RGB10_A2UI:36975},i=Object.values(r),s={FLOAT:t.FLOAT,UNSIGNED_BYTE:t.UNSIGNED_BYTE,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,BYTE:t.BYTE,UNSIGNED_SHORT:t.UNSIGNED_SHORT,SHORT:t.SHORT,UNSIGNED_INT:t.UNSIGNED_INT,INT:t.INT,HALF_FLOAT:5131,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269};e.ColorAttachment0=36064,e.ColorAttachment1=36065,e.ColorAttachment10=36074,e.ColorAttachment11=36075,e.ColorAttachment12=36076,e.ColorAttachment13=36077,e.ColorAttachment14=36078,e.ColorAttachment15=36079,e.ColorAttachment2=36066,e.ColorAttachment3=36067,e.ColorAttachment4=36068,e.ColorAttachment5=36069,e.ColorAttachment6=36070,e.ColorAttachment7=36071,e.ColorAttachment8=36072,e.ColorAttachment9=36073,e.CompressedTextureFormat={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497},e.DataType=t,e.DepthAttachment=36096,e.DepthStencilAttachment=33306,e.PixelType=s,e.PrimitiveType={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},e.ResourceType={Texture:0,TileTexture:1,BufferObject:2,VertexArrayObject:3,Shader:4,Program:5,FramebufferObject:6,Renderbuffer:7,TransformFeedback:8,Sync:9,UNCOUNTED:10,LinesOfCode:10,Uniform:11,COUNT:12},e.SizedDepthFormat={DEPTH_COMPONENT16:33189,DEPTH_COMPONENT24:33190,DEPTH_COMPONENT32F:36012},e.SizedDepthStencilFormat={DEPTH24_STENCIL8:35056,DEPTH32F_STENCIL8:36013},e.SizedPixelFormat=r,e.StencilAttachment=36128,e.baseTextureUnit=33984,e.sizedPixelFormatValues=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexAttributeLocations":function(){define(["exports"],function(e){"use strict";function t(e){const t=new Map;let r=0;return e.forEach(e=>e.forEach(({name:e,count:i})=>{t.set(e,r),16===i?r+=4:9===i?r+=3:++r})),t}e.fromBuffers=function(e){return t(Array.from(e.values()).map(({layout:e})=>e))},e.fromLayout=function(e){let t=0;return new Map(e.map(({name:e,count:r})=>{const i=[e,t];return 16===r?t+=4:9===r?t+=3:++t,i}))},e.fromLayouts=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(e){"use strict";e.VertexElementDescriptor=class{constructor(e,t,r,i,s,n=!1,o=0){this.name=e,this.count=t,this.type=r,this.offset=i,this.stride=s,this.normalized=n,this.divisor=o}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,r,i){"use strict";class s extends t.VTLMaterial{static{this.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"]}static{this.GEOMETRY_LAYOUT=[new i.VertexElementDescriptor("a_pos",2,r.DataType.SHORT,0,4)]}static{this.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:1},"circle-color":{name:"color",type:10},"circle-opacity":{name:"opacity",type:1,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:1,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:10},"circle-stroke-opacity":{name:"stroke_opacity",type:1,precisionFactor:100},"circle-blur":{name:"blur",type:1,precisionFactor:32}}}constructor(e){super(e),this.baseGeometryLayout=s.GEOMETRY_LAYOUT,this.attributes=s.ATTRIBUTES,this.attributesInfo=s.ATTRIBUTES_INFO}}e.VTLCircleMaterial=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,r,i){"use strict";class s extends t.VTLMaterial{static{this.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"]}static{this.GEOMETRY_LAYOUT=[new i.VertexElementDescriptor("a_pos",2,r.DataType.SHORT,0,4)]}static{this.ATTRIBUTES_INFO={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100},"fill-pattern":{name:"tlbr",type:12,isOptional:!0}}}constructor(e){super(e),this.baseGeometryLayout=s.GEOMETRY_LAYOUT,this.attributes=s.ATTRIBUTES,this.attributesInfo=s.ATTRIBUTES_INFO}}class n extends t.VTLMaterial{static{this.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"]}static{this.ATTRIBUTES_FILL=["fill-color","fill-opacity"]}static{this.GEOMETRY_LAYOUT=[new i.VertexElementDescriptor("a_pos",2,r.DataType.SHORT,0,8),new i.VertexElementDescriptor("a_offset",2,r.DataType.BYTE,4,8),new i.VertexElementDescriptor("a_xnormal",2,r.DataType.BYTE,6,8)]}static{this.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}}}static{this.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}}}constructor(e,t){super(e),this.baseGeometryLayout=n.GEOMETRY_LAYOUT,this.attributes=t?n.ATTRIBUTES_FILL:n.ATTRIBUTES_OUTLINE,this.attributesInfo=t?n.ATTRIBUTES_INFO_FILL:n.ATTRIBUTES_INFO_OUTLINE}}e.VTLFillMaterial=s,e.VTLOutlineMaterial=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,r,i){"use strict";class s extends t.VTLMaterial{static{this.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width","line-pattern","line-dasharray"]}static{this.GEOMETRY_LAYOUT=[new i.VertexElementDescriptor("a_pos",2,r.DataType.SHORT,0,16),new i.VertexElementDescriptor("a_extrude_offset",4,r.DataType.BYTE,4,16),new i.VertexElementDescriptor("a_dir_normal",4,r.DataType.BYTE,8,16),new i.VertexElementDescriptor("a_accumulatedDistance",2,r.DataType.UNSIGNED_SHORT,12,16)]}static{this.ATTRIBUTES_INFO={"line-width":{name:"width",type:1,precisionFactor:2},"line-gap-width":{name:"gap_width",type:1,precisionFactor:2},"line-offset":{name:"offset",type:0,precisionFactor:2},"line-color":{name:"color",type:10},"line-opacity":{name:"opacity",type:1,precisionFactor:100},"line-blur":{name:"blur",type:1,precisionFactor:4},"line-pattern":{name:"tlbr",type:12,isOptional:!0},"line-dasharray":{name:"tlbr",type:11,isOptional:!0}}}constructor(e){super(e),this.baseGeometryLayout=s.GEOMETRY_LAYOUT,this.attributes=s.ATTRIBUTES,this.attributesInfo=s.ATTRIBUTES_INFO}}e.VTLLineMaterial=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,r,i){"use strict";const s=[new i.VertexElementDescriptor("a_pos",2,r.DataType.SHORT,0,16),new i.VertexElementDescriptor("a_vertexOffset",2,r.DataType.SHORT,4,16),new i.VertexElementDescriptor("a_texAngleRange",4,r.DataType.UNSIGNED_BYTE,8,16),new i.VertexElementDescriptor("a_levelInfo",4,r.DataType.UNSIGNED_BYTE,12,16)],n=[new i.VertexElementDescriptor("a_opacityInfo",1,r.DataType.UNSIGNED_BYTE,0,1)];class o extends t.VTLMaterial{static{this.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"]}static{this.ATTRIBUTES_INFO={"icon-color":{name:"color",type:10},"icon-opacity":{name:"opacity",type:1,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:10},"icon-halo-width":{name:"halo_width",type:1,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"icon-size":{name:"size",type:1,precisionFactor:32,isLayout:!0}}}constructor(e){super(e),this.baseGeometryLayout=s,this.opacityLayout=n,this.attributes=o.ATTRIBUTES,this.attributesInfo=o.ATTRIBUTES_INFO}}class a extends t.VTLMaterial{static{this.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"]}static{this.ATTRIBUTES_INFO={"text-color":{name:"color",type:10},"text-opacity":{name:"opacity",type:1,precisionFactor:100},"text-halo-color":{name:"halo_color",type:10},"text-halo-width":{name:"halo_width",type:1,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"text-size":{name:"size",type:1,isLayout:!0}}}constructor(e){super(e),this.baseGeometryLayout=s,this.opacityLayout=n,this.attributes=a.ATTRIBUTES,this.attributesInfo=a.ATTRIBUTES_INFO}}e.VTLIconMaterial=o,e.VTLTextMaterial=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(e,t){"use strict";class r{constructor(e){this._expression=e}filter(e,t){if(!this._expression)return!0;try{return this._expression.evaluate(e,t)}catch(e){return console.log(e.message),!0}}static createFilter(i){if(!i)return null;this.isLegacyFilter(i)&&(i=this.convertLegacyFilter(i));try{const s=e.createExpression(i,null,t.booleanType);return new r(s)}catch(e){return console.log(e.message),null}}static isLegacyFilter(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":case"none":case"!has":return!0;case"any":case"all":for(let t=1;t<e.length;t++)if(this.isLegacyFilter(e[t]))return!0;return!1;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||0===e.length)return!0;const t=e[0];if(1===e.length)return"any"!==t;switch(t){case"==":return r.convertComparison("==",e[1],e[2]);case"!=":return r.negate(r.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return r.convertComparison(t,e[1],e[2]);case"in":return r.convertIn(e[1],e.slice(2));case"!in":return r.negate(r.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return r.convertCombining(t,e.slice(1));case"has":return r.convertHas(e[1]);case"!has":return r.negate(r.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(e,t,r){switch(t){case"$type":return[e,["geometry-type"],r];case"$id":return[e,["id"],r];default:return[e,["get",t],r]}}static convertIn(e,t){switch(e){case"$type":return["in",["geometry-type"],["literal",t]];case"$id":return["in",["id"],["literal",t]];default:return["in",["get",e],["literal",t]]}}static convertHas(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}static convertCombining(e,t){return[e].concat(t.map(this.convertLegacyFilter))}static negate(e){return["!",e]}}return r})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define(["exports","../../../../../Color","../../../../../core/colorUtils","../../../unitBezier","../GeometryUtils","./types"],function(e,t,r,i,s,n){"use strict";class o{constructor(e){this._parent=e,this._vars={}}add(e,t){this._vars[e]=t}get(e){return this._vars[e]?this._vars[e]:this._parent?this._parent.get(e):null}}class a{constructor(){this.type=n.valueType}static parse(e){if(e.length>1)throw new Error('"id" does not expect arguments');return new a}evaluate(e,t){return e?.id}}class l{constructor(){this.type=n.stringType}static parse(e){if(e.length>1)throw new Error('"geometry-type" does not expect arguments');return new l}evaluate(e,t){if(!e)return null;switch(e.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}}}class u{constructor(){this.type=n.objectType}static parse(e){if(e.length>1)throw new Error('"properties" does not expect arguments');return new u}evaluate(e,t){return e?.values}}class c{constructor(){this.type=n.numberType}static parse(e){if(e.length>1)throw new Error('"zoom" does not expect arguments');return new c}evaluate(e,t){return t}}class h{constructor(e,t,r){this._lhs=e,this._rhs=t,this._compare=r,this.type=n.booleanType}static parse(e,t,r){if(3!==e.length&&4!==e.length)throw new Error(`"${e[0]}" expects 2 or 3 arguments`);if(4===e.length)throw new Error(`"${e[0]}" collator not supported`);return new h(ee(e[1],t),ee(e[2],t),r)}evaluate(e,t){return this._compare(this._lhs.evaluate(e,t),this._rhs.evaluate(e,t))}}class p extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e===t)}}class y extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e!==t)}}class f extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e<t)}}class d extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e<=t)}}class m extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e>t)}}class g extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e>=t)}}class _{constructor(e){this._arg=e,this.type=n.booleanType}static parse(e,t){if(2!==e.length)throw new Error('"!" expects 1 argument');return new _(ee(e[1],t))}evaluate(e,t){return!this._arg.evaluate(e,t)}}class b{constructor(e){this._args=e,this.type=n.booleanType}static parse(e,t){const r=[];for(let i=1;i<e.length;i++)r.push(ee(e[i],t));return new b(r)}evaluate(e,t){for(const r of this._args)if(!r.evaluate(e,t))return!1;return!0}}class x{constructor(e){this._args=e,this.type=n.booleanType}static parse(e,t){const r=[];for(let i=1;i<e.length;i++)r.push(ee(e[i],t));return new x(r)}evaluate(e,t){for(const r of this._args)if(r.evaluate(e,t))return!0;return!1}}class T{constructor(e){this._args=e,this.type=n.booleanType}static parse(e,t){const r=[];for(let i=1;i<e.length;i++)r.push(ee(e[i],t));return new T(r)}evaluate(e,t){for(const r of this._args)if(r.evaluate(e,t))return!1;return!0}}class v{constructor(e,t,r){this.type=e,this._args=t,this._fallback=r}static parse(e,t,r){if(e.length<4)throw new Error('"case" expects at least 3 arguments');if(e.length%2==1)throw new Error('"case" expects an odd number of arguments');let i;const s=[];for(let n=1;n<e.length-1;n+=2){const o=ee(e[n],t),a=ee(e[n+1],t,r);i||(i=a.type),s.push({condition:o,output:a})}const n=ee(e[e.length-1],t,r);return i||(i=n.type),new v(i,s,n)}evaluate(e,t){for(const r of this._args)if(r.condition.evaluate(e,t))return r.output.evaluate(e,t);return this._fallback.evaluate(e,t)}}class w{constructor(e,t){this.type=e,this._args=t}static parse(e,t){if(e.length<2)throw new Error('"coalesce" expects at least 1 argument');let r;const i=[];for(let s=1;s<e.length;s++){const n=ee(e[s],t);r||(r=n.type),i.push(n)}return new w(r,i)}evaluate(e,t){for(const r of this._args){const i=r.evaluate(e,t);if(null!==i)return i}return null}}class S{constructor(e,t,r,i,s){this.type=e,this._input=t,this._labels=r,this._outputs=i,this._fallback=s}static parse(e,t){if(e.length<3)throw new Error('"match" expects at least 3 arguments');if(e.length%2==0)throw new Error('"case" expects an even number of arguments');let r;const i=ee(e[1],t),s=[],n={};let o;for(let i=2;i<e.length-1;i+=2){let a=e[i];Array.isArray(a)||(a=[a]);for(const e of a){const t=typeof e;if("string"!==t&&"number"!==t)throw new Error('"match" requires string or number literal as labels');if(o){if(t!==o)throw new Error('"match" requires labels to have the same type')}else o=t;n[e]=s.length}const l=ee(e[i+1],t);r||(r=l.type),s.push(l)}return new S(r,i,n,s,ee(e[e.length-1],t))}evaluate(e,t){const r=this._input.evaluate(e,t);return(this._outputs[this._labels[r]]||this._fallback).evaluate(e,t)}}class A{constructor(e,t,r,i,s){this._operator=e,this.type=t,this.interpolation=r,this.input=i,this._stops=s}static parse(e,t,r){const i=e[0];if(e.length<5)throw new Error(`"${i}" expects at least 4 arguments`);const s=e[1];if(!Array.isArray(s)||0===s.length)throw new Error(`"${s}" is not a valid interpolation`);switch(s[0]){case"linear":if(1!==s.length)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(2!==s.length||"number"!=typeof s[1])throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(5!==s.length)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(let e=1;e<5;e++){const t=s[e];if("number"!=typeof t||t<0||t>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error(`"${e[0]}" unknown interpolation type "${s[0]}"`)}if(e.length%2!=1)throw new Error(`"${i}" expects an even number of arguments`);const o=ee(e[2],t,n.numberType);let a;"interpolate-hcl"===i||"interpolate-lab"===i?a=n.colorType:r&&"value"!==r.kind&&(a=r);const l=[];for(let r=3;r<e.length;r+=2){const s=e[r];if("number"!=typeof s)throw new Error(`"${i}" requires stop inputs as literal numbers`);if(l.length&&l[l.length-1][0]>=s)throw new Error(`"${i}" requires strictly ascending stop inputs`);const n=ee(e[r+1],t,a);a||(a=n.type),l.push([s,n])}if(a&&a!==n.colorType&&a!==n.numberType&&("array"!==a.kind||a.itemType!==n.numberType))throw new Error(`"${i}" cannot interpolate type ${n.typeToString(a)}`);return new A(i,a,s,o,l)}evaluate(e,i){const o=this._stops;if(1===o.length)return o[0][1].evaluate(e,i);const a=this.input.evaluate(e,i);if(a<=o[0][0])return o[0][1].evaluate(e,i);if(a>=o[o.length-1][0])return o[o.length-1][1].evaluate(e,i);let l=0;for(;++l<o.length&&!(a<o[l][0]););const u=o[l-1][0],c=o[l][0],h=A.interpolationRatio(this.interpolation,a,u,c),p=o[l-1][1].evaluate(e,i),y=o[l][1].evaluate(e,i);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(p)&&Array.isArray(y))return p.map((e,t)=>s.interpolate(e,y[t],h));if("color"===this.type.kind&&p instanceof t&&y instanceof t){const e=new t(p),r=new t(y);return new t([s.interpolate(e.r,r.r,h),s.interpolate(e.g,r.g,h),s.interpolate(e.b,r.b,h),s.interpolate(e.a,r.a,h)])}if("number"===this.type.kind&&"number"==typeof p&&"number"==typeof y)return s.interpolate(p,y,h);throw new Error(`"${this._operator}" cannot interpolate type ${n.typeToString(this.type)}`)}if("interpolate-hcl"===this._operator){const e=r.toLCH(p),i=r.toLCH(y),n=i.h-e.h,o=r.toRGB({h:e.h+h*(n>180||n<-180?n-360*Math.round(n/360):n),c:s.interpolate(e.c,i.c,h),l:s.interpolate(e.l,i.l,h)});return new t({a:s.interpolate(p.a,y.a,h),...o})}if("interpolate-lab"===this._operator){const e=r.toLAB(p),i=r.toLAB(y),n=r.toRGB({l:s.interpolate(e.l,i.l,h),a:s.interpolate(e.a,i.a,h),b:s.interpolate(e.b,i.b,h)});return new t({a:s.interpolate(p.a,y.a,h),...n})}throw new Error(`Unexpected operator "${this._operator}"`)}interpolationUniformValue(e,t){const r=this._stops;if(1===r.length)return 0;if(e>=r[r.length-1][0])return 0;let i=0;for(;++i<r.length&&!(e<r[i][0]););const s=r[i-1][0],n=r[i][0];return A.interpolationRatio(this.interpolation,t,s,n)}getInterpolationRange(e){const t=this._stops;if(1===t.length){const e=t[0][0];return[e,e]}const r=t[t.length-1][0];if(e>=r)return[r,r];let i=0;for(;++i<t.length&&!(e<t[i][0]););return[t[i-1][0],t[i][0]]}static interpolationRatio(e,t,r,s){let n=0;return"linear"===e[0]?n=A._exponentialInterpolationRatio(t,1,r,s):"exponential"===e[0]?n=A._exponentialInterpolationRatio(t,e[1],r,s):"cubic-bezier"===e[0]&&(n=i.unitBezier(e[1],e[2],e[3],e[4])(A._exponentialInterpolationRatio(t,1,r,s),1e-5)),n<0?n=0:n>1&&(n=1),n}static _exponentialInterpolationRatio(e,t,r,i){const s=i-r;if(0===s)return 0;const n=e-r;return 1===t?n/s:(t**n-1)/(t**s-1)}}class E{constructor(e,t,r){this.type=e,this._input=t,this._stops=r}static parse(e,t){if(e.length<5)throw new Error('"step" expects at least 4 arguments');if(e.length%2!=1)throw new Error('"step" expects an even number of arguments');const r=ee(e[1],t,n.numberType);let i;const s=[];s.push([-1/0,ee(e[2],t)]);for(let r=3;r<e.length;r+=2){const n=e[r];if("number"!=typeof n)throw new Error('"step" requires stop inputs as literal numbers');if(s.length&&s[s.length-1][0]>=n)throw new Error('"step" requires strictly ascending stop inputs');const o=ee(e[r+1],t);i||(i=o.type),s.push([n,o])}return new E(i,r,s)}evaluate(e,t){const r=this._stops;if(1===r.length)return r[0][1].evaluate(e,t);const i=this._input.evaluate(e,t);let s=0;for(;++s<r.length&&!(i<r[s][0]););return this._stops[s-1][1].evaluate(e,t)}}class I{constructor(e,t){this.type=e,this._output=t}static parse(e,t,r){if(e.length<4)throw new Error('"let" expects at least 3 arguments');if(e.length%2==1)throw new Error('"let" expects an odd number of arguments');const i=new o(t);for(let r=1;r<e.length-1;r+=2){const s=e[r];if("string"!=typeof s)throw new Error(`"let" requires a string to define variable names - found ${s}`);i.add(s,ee(e[r+1],t))}const s=ee(e[e.length-1],i,r);return new I(s.type,s)}evaluate(e,t){return this._output.evaluate(e,t)}}class L{constructor(e,t){this.type=e,this.output=t}static parse(e,t,r){if(2!==e.length||"string"!=typeof e[1])throw new Error('"var" requires just one literal string argument');const i=t.get(e[1]);if(!i)throw new Error(`${e[1]} must be defined before being used in a "var" expression`);return new L(r||n.valueType,i)}evaluate(e,t){return this.output.evaluate(e,t)}}class P{constructor(e,t,r){this.type=e,this._index=t,this._array=r}static parse(e,t){if(3!==e.length)throw new Error('"at" expects 2 arguments');const r=ee(e[1],t,n.numberType),i=ee(e[2],t);return new P(i.type.itemType,r,i)}evaluate(e,t){const r=this._index.evaluate(e,t),i=this._array.evaluate(e,t);if(r<0||r>=i.length)throw new Error('"at" index out of bounds');if(r!==Math.floor(r))throw new Error('"at" index must be an integer');return i[r]}}class D{constructor(e,t){this._key=e,this._obj=t,this.type=n.valueType}static parse(e,t){let r,i;switch(e.length){case 2:return r=ee(e[1],t),new D(r);case 3:return r=ee(e[1],t),i=ee(e[2],t),new D(r,i);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(e,t){const r=this._key.evaluate(e,t);return this._obj?this._obj.evaluate(e,t)[r]:e?.values[r]}}class R{constructor(e,t){this._key=e,this._obj=t,this.type=n.booleanType}static parse(e,t){let r,i;switch(e.length){case 2:return r=ee(e[1],t),new R(r);case 3:return r=ee(e[1],t),i=ee(e[2],t),new R(r,i);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(e,t){const r=this._key.evaluate(e,t);return this._obj?r in this._obj.evaluate(e,t):!!e?.values[r]}}class M{constructor(e,t){this._key=e,this._vals=t,this.type=n.booleanType}static parse(e,t){if(3!==e.length)throw new Error('"in" expects 2 arguments');return new M(ee(e[1],t),ee(e[2],t))}evaluate(e,t){const r=this._key.evaluate(e,t);return this._vals.evaluate(e,t).includes(r)}}class O{constructor(e,t,r){this._item=e,this._array=t,this._from=r,this.type=n.numberType}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"index-of" expects 3 or 4 arguments');const r=ee(e[1],t),i=ee(e[2],t);if(4===e.length){const s=ee(e[3],t,n.numberType);return new O(r,i,s)}return new O(r,i)}evaluate(e,t){const r=this._item.evaluate(e,t),i=this._array.evaluate(e,t);if(this._from){const s=this._from.evaluate(e,t);if(s!==Math.floor(s))throw new Error('"index-of" index must be an integer');return i.indexOf(r,s)}return i.indexOf(r)}}class U{constructor(e){this._arg=e,this.type=n.numberType}static parse(e,t){if(2!==e.length)throw new Error('"length" expects 2 arguments');const r=ee(e[1],t);return new U(r)}evaluate(e,t){const r=this._arg.evaluate(e,t);if("string"==typeof r)return r.length;if(Array.isArray(r))return r.length;throw new Error('"length" expects string or array')}}class B{constructor(e,t,r,i){this.type=e,this._array=t,this._from=r,this._to=i}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"slice" expects 2 or 3 arguments');const r=ee(e[1],t),i=ee(e[2],t,n.numberType);if(i.type!==n.numberType)throw new Error('"slice" index must return a number');if(4===e.length){const s=ee(e[3],t,n.numberType);if(s.type!==n.numberType)throw new Error('"slice" index must return a number');return new B(r.type,r,i,s)}return new B(r.type,r,i)}evaluate(e,t){const r=this._array.evaluate(e,t);if(!Array.isArray(r)&&"string"!=typeof r)throw new Error('"slice" input must be an array or a string');const i=this._from.evaluate(e,t);if(i<0||i>=r.length)throw new Error('"slice" index out of bounds');if(i!==Math.floor(i))throw new Error('"slice" index must be an integer');if(this._to){const s=this._to.evaluate(e,t);if(s<0||s>=r.length)throw new Error('"slice" index out of bounds');if(s!==Math.floor(s))throw new Error('"slice" index must be an integer');return r.slice(i,s)}return r.slice(i)}}class N{constructor(){this.type=n.booleanType}static parse(e){if(1!==e.length)throw new Error('"has-id" expects no arguments');return new N}evaluate(e,t){return void 0!==e?.id}}class C{constructor(e,t){this._args=e,this._calculate=t,this.type=n.numberType}static parse(e,t,r){const i=e.slice(1).map(e=>ee(e,t));return new C(i,r)}evaluate(e,t){let r;return this._args&&(r=this._args.map(r=>r.evaluate(e,t))),this._calculate(r)}}class V extends C{static parse(e,t){switch(e.length){case 2:return C.parse(e,t,e=>-e[0]);case 3:return C.parse(e,t,e=>e[0]-e[1]);default:throw new Error('"-" expects 1 or 2 arguments')}}}class k extends C{static parse(e,t){return C.parse(e,t,e=>{let t=1;for(const r of e)t*=r;return t})}}class F extends C{static parse(e,t){if(3===e.length)return C.parse(e,t,e=>e[0]/e[1]);throw new Error('"/" expects 2 arguments')}}class z extends C{static parse(e,t){if(3===e.length)return C.parse(e,t,e=>e[0]%e[1]);throw new Error('"%" expects 2 arguments')}}class G extends C{static parse(e,t){if(3===e.length)return C.parse(e,t,e=>e[0]**e[1]);throw new Error('"^" expects 1 or 2 arguments')}}class j extends C{static parse(e,t){return C.parse(e,t,e=>{let t=0;for(const r of e)t+=r;return t})}}class ${constructor(e,t){this._args=e,this._calculate=t,this.type=n.numberType}static{this.ops={abs:e=>Math.abs(e[0]),acos:e=>Math.acos(e[0]),asin:e=>Math.asin(e[0]),atan:e=>Math.atan(e[0]),ceil:e=>Math.ceil(e[0]),cos:e=>Math.cos(e[0]),e:()=>Math.E,floor:e=>Math.floor(e[0]),ln:e=>Math.log(e[0]),ln2:()=>Math.LN2,log10:e=>Math.log(e[0])/Math.LN10,log2:e=>Math.log(e[0])/Math.LN2,max:e=>Math.max(...e),min:e=>Math.min(...e),pi:()=>Math.PI,round:e=>Math.round(e[0]),sin:e=>Math.sin(e[0]),sqrt:e=>Math.sqrt(e[0]),tan:e=>Math.tan(e[0])}}static parse(e,t){const r=e.slice(1).map(e=>ee(e,t));return new $(r,$.ops[e[0]])}evaluate(e,t){let r;return this._args&&(r=this._args.map(r=>r.evaluate(e,t))),this._calculate(r)}}class H{constructor(e){this._args=e,this.type=n.stringType}static parse(e,t){return new H(e.slice(1).map(e=>ee(e,t)))}evaluate(e,t){return this._args.map(r=>r.evaluate(e,t)).join("")}}class q{constructor(e,t){this._arg=e,this._calculate=t,this.type=n.stringType}static{this.ops={downcase:e=>e.toLowerCase(),upcase:e=>e.toUpperCase()}}static parse(e,t){if(2!==e.length)throw new Error(`${e[0]} expects 1 argument`);const r=ee(e[1],t);return new q(r,q.ops[e[0]])}evaluate(e,t){return this._calculate(this._arg.evaluate(e,t))}}class Y{constructor(e){this._args=e,this.type=n.colorType}static parse(e,t){if(4!==e.length)throw new Error('"rgb" expects 3 arguments');const r=e.slice(1).map(e=>ee(e,t));return new Y(r)}evaluate(e,r){const i=this._validate(this._args[0].evaluate(e,r)),s=this._validate(this._args[1].evaluate(e,r)),n=this._validate(this._args[2].evaluate(e,r));return new t({r:i,g:s,b:n})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}}class W{constructor(e){this._args=e,this.type=n.colorType}static parse(e,t){if(5!==e.length)throw new Error('"rgba" expects 4 arguments');const r=e.slice(1).map(e=>ee(e,t));return new W(r)}evaluate(e,r){const i=this._validate(this._args[0].evaluate(e,r)),s=this._validate(this._args[1].evaluate(e,r)),n=this._validate(this._args[2].evaluate(e,r)),o=this._validateAlpha(this._args[3].evaluate(e,r));return new t({r:i,g:s,b:n,a:o})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}_validateAlpha(e){if("number"!=typeof e||e<0||e>1)throw new Error(`${e}: invalid alpha color component`);return e}}class K{constructor(e){this._color=e,this.type=n.arrayType(n.numberType,4)}static parse(e,t){if(2!==e.length)throw new Error('"to-rgba" expects 1 argument');const r=ee(e[1],t);return new K(r)}evaluate(e,r){return new t(this._color.evaluate(e,r)).toRgba()}}class Q{constructor(e,t){this.type=e,this._args=t}static parse(e,t){const r=e[0];if(e.length<2)throw new Error(`${r} expects at least one argument`);let i,s=1;if("array"===r){if(e.length>2){switch(e[1]){case"string":i=n.stringType;break;case"number":i=n.numberType;break;case"boolean":i=n.booleanType;break;default:throw new Error('"array" type argument must be string, number or boolean')}s++}else i=n.valueType;let t;if(e.length>3){if(t=e[2],null!==t&&("number"!=typeof t||t<0||t!==Math.floor(t)))throw new Error('"array" length argument must be a positive integer literal');s++}i=n.arrayType(i,t)}else switch(r){case"string":i=n.stringType;break;case"number":i=n.numberType;break;case"boolean":i=n.booleanType;break;case"object":i=n.objectType}const o=[];for(;s<e.length;s++){const r=ee(e[s],t);o.push(r)}return new Q(i,o)}evaluate(e,t){let r;for(const i of this._args){const s=i.evaluate(e,t);if(r=n.getType(s),n.matchType(r,this.type))return s}throw new Error(`Expected ${n.typeToString(this.type)} but got ${n.typeToString(r)}`)}}class J{static{this.types={"to-boolean":n.booleanType,"to-color":n.colorType,"to-number":n.numberType,"to-string":n.stringType}}constructor(e,t){this.type=e,this._args=t}static parse(e,t){const r=e[0],i=J.types[r];if(i===n.booleanType||i===n.stringType){if(2!==e.length)throw new Error(`${r} expects one argument`)}else if(e.length<2)throw new Error(`${r} expects at least one argument`);const s=[];for(let r=1;r<e.length;r++){const i=ee(e[r],t);s.push(i)}return new J(i,s)}evaluate(e,r){if(this.type===n.booleanType)return Boolean(this._args[0].evaluate(e,r));if(this.type===n.stringType)return n.valueToString(this._args[0].evaluate(e,r));if(this.type===n.numberType){for(const t of this._args){const i=Number(t.evaluate(e,r));if(!isNaN(i))return i}return null}if(this.type===n.colorType){for(const i of this._args)try{const s=J.toColor(i.evaluate(e,r));if(s instanceof t)return s}catch{}return null}}static toBoolean(e){return Boolean(e)}static toString(e){return n.valueToString(e)}static toNumber(e){const t=Number(e);if(isNaN(t))throw new Error(`"${e}" is not a number`);return t}static toColor(e){if(e instanceof t)return e;if("string"==typeof e){const r=t.fromString(e);if(r)return r;throw new Error(`"${e}" is not a color`)}if(Array.isArray(e))return t.fromArray(e);throw new Error(`"${e}" is not a color`)}}class X{constructor(e){this._val=e,this.type=n.getType(e)}static parse(e){if(2!==e.length)throw new Error('"literal" expects 1 argument');return new X(e[1])}evaluate(e,t){return this._val}}class Z{constructor(e){this._arg=e,this.type=n.stringType}static parse(e,t){if(2!==e.length)throw new Error('"typeof" expects 1 argument');return new Z(ee(e[1],t))}evaluate(e,t){return n.typeToString(n.getType(this._arg.evaluate(e,t)))}}function ee(e,t,r){const i=typeof e;if("string"===i||"boolean"===i||"number"===i||null===e){if(r)switch(r.kind){case"string":"string"!==i&&(e=J.toString(e));break;case"number":"number"!==i&&(e=J.toNumber(e));break;case"color":e=J.toColor(e)}e=["literal",e]}if(!Array.isArray(e)||0===e.length)throw new Error("Expression must be a non empty array");const s=e[0];if("string"!=typeof s)throw new Error("First element of expression must be a string");const n=te[s];if(void 0===n)throw new Error(`Invalid expression operator "${s}"`);if(!n)throw new Error(`Unimplemented expression operator "${s}"`);return n.parse(e,t,r)}const te={array:Q,boolean:Q,collator:null,format:null,image:null,literal:X,number:Q,"number-format":null,object:Q,string:Q,"to-boolean":J,"to-color":J,"to-number":J,"to-string":J,typeof:Z,accumulated:null,"feature-state":null,"geometry-type":l,id:a,"line-progress":null,properties:u,at:P,get:D,has:R,in:M,"index-of":O,length:U,slice:B,"!":_,"!=":y,"<":f,"<=":d,"==":p,">":m,">=":g,all:b,any:x,case:v,coalesce:w,match:S,within:null,interpolate:A,"interpolate-hcl":A,"interpolate-lab":A,step:E,let:I,var:L,concat:H,downcase:q,"is-supported-script":null,"resolved-locale":null,upcase:q,rgb:Y,rgba:W,"to-rgba":K,"-":V,"*":k,"/":F,"%":z,"^":G,"+":j,abs:$,acos:$,asin:$,atan:$,ceil:$,cos:$,e:$,floor:$,ln:$,ln2:$,log10:$,log2:$,max:$,min:$,pi:$,round:$,sin:$,sqrt:$,tan:$,zoom:c,"heatmap-density":null,"has-id":N,none:T};e.ALL=b,e.ANY=x,e.Add=j,e.Assert=Q,e.At=P,e.Calculate=$,e.Case=v,e.Coalesce=w,e.Coerce=J,e.Concat=H,e.Div=F,e.EQ=p,e.GE=g,e.GT=m,e.GeomType=l,e.Get=D,e.Has=R,e.HasID=N,e.ID=a,e.In=M,e.IndexOf=O,e.Interpolate=A,e.LE=d,e.LT=f,e.Length=U,e.Let=I,e.Literal=X,e.Match=S,e.Mod=z,e.Mul=k,e.NE=y,e.NONE=T,e.NOT=_,e.Pow=G,e.Properties=u,e.Rgb=Y,e.Rgba=W,e.Slice=B,e.Step=E,e.String=q,e.Sub=V,e.ToRgba=K,e.TypeOf=Z,e.Var=L,e.Zoom=c,e.createExpression=ee,e.ops=te,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define(["exports","../Color","./arrayUtils","./lang","./mathUtils","../chunks/vec42","./libs/gl-matrix-2/factories/vec4f64"],function(e,t,r,i,s,n,o){"use strict";function a(e){return"r"in e&&"g"in e&&"b"in e}function l(e){return"h"in e&&"s"in e&&"v"in e}function u(e){return"l"in e&&"a"in e&&"b"in e}function c(e){return"l"in e&&"c"in e&&"h"in e}const h=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],p=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function y(e,t){const r=[];let i,s;if(e[0].length!==t.length)throw new Error("dimensions do not match");const n=e.length,o=e[0].length;let a=0;for(i=0;i<n;i++){for(a=0,s=0;s<o;s++)a+=e[i][s]*t[s];r.push(a)}return r}function f(e){const t=[e.r/255,e.g/255,e.b/255].map(e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4),r=y(h,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function d(e){const t=y(p,[e.x/100,e.y/100,e.z/100]).map(e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function m(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function g(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(e=>e>6/29?e**3:3*(6/29)**2*(e-4/29));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function _(e){return a(e)?e:c(e)?function(e){return d(g(function(e){const t=e.l,r=e.c,i=e.h;return{l:t,a:r*Math.cos(i),b:r*Math.sin(i)}}(e)))}(e):u(e)?function(e){return d(g(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?d(e):l(e)?function(e){const t=(e.h+360)%360/60,r=e.s/100,i=e.v/100*255,s=i*r,n=s*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:s,g:n,b:0};break;case 1:o={r:n,g:s,b:0};break;case 2:o={r:0,g:s,b:n};break;case 3:o={r:0,g:n,b:s};break;case 4:o={r:n,g:0,b:s};break;case 5:case 6:o={r:s,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-s),o.g=Math.round(o.g+i-s),o.b=Math.round(o.b+i-s),o}(e):e}function b(e){return l(e)?e:function(e){const t=e.r,r=e.g,i=e.b,s=Math.max(t,r,i),n=s-Math.min(t,r,i);let o=s,a=0===n?0:s===t?(r-i)/n%6:s===r?(i-t)/n+2:(t-r)/n+4,l=0===n?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(_(e))}function x(e){return u(e)?e:function(e){return m(f(e))}(_(e))}function T(e){let{r,g:i,b:s,a:n}=e;return n<1&&(r=Math.round(n*r+255*(1-n)),i=Math.round(n*i+255*(1-n)),s=Math.round(n*s+255*(1-n))),new t({r,g:i,b:s})}function v(e,t){const{r,g:i,b:s}=t?.ignoreAlpha?e:T(e);return.2126*r+.7152*i+.0722*s}function w(e){return e[0]??=0,e[1]??=0,e[2]??=0,e}const S=(e,t)=>{const r=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+r))};function A(e,i,s,n={}){const o=e.r,a=e.g,l=e.b,u=i.r,c=i.g,h=i.b,p=Math.round(o+(u-o)*s),y=Math.round(a+(c-a)*s),f=Math.round(l+(h-l)*s);if(!n.offset)return new t([p,y,f]);const d=r.getRandomNumberGenerator(n.seed);return new t([S(p,d),S(y,d),S(f,d)])}e.colorEquals=function(e,t){return e===t||null!=e&&e.equals(t)},e.colorVectorEquals=function(e,t){return e===t||null!=e&&null!=t&&n.equals(e,t)},e.colorVectorToColorAndOpacity=function(e){return o.fromValues(e[0],e[1],e[2],e.length>3?e[3]:1)},e.createUniqueColors=function(e,s,n={}){if(0===e.length||s<=0)return[];if(1===(e=e.map(e=>"string"==typeof e?new t(e):e)).length||1===s){const t=[],r=e[0];for(let e=0;e<s;e++)t.push(r.clone());return t}if(n.shuffle&&(e=r.shuffle(i.clone(e),n.seed)),e.length>=s){const t=[],r=(e.length-1)/(s-1);for(let i=0;i<s;i++){const s=Math.round(i*r);t.push(e[s].clone())}return t}return function(e,t,i={}){const s=[],n=e.length-1,o=Math.ceil((t-e.length)/n);e:for(let r=0;r<n;r++){const n=e[r],a=e[r+1];for(let r=1;r<=o;r++){const l=r/(o+1);if(s.push(A(n,a,l,i)),s.length+e.length===t)break e}}return[...e.map(e=>e.clone()),...r.shuffle(s,i.seed??1)]}(e,s,n)},e.darken=function(e,t){const r=x(e);r.l*=1-t;const i=_(r),s=e.clone();return s.setColor(i),s.a=e.a,s},e.desaturate=function(e,t){const r=b(e);r.s*=t;const i=_(r),s=e.clone();return s.setColor(i),s.a=e.a,s},e.getColorLuminance=v,e.getColorTheme=function(e){return T(e).isBright?"light":"dark"},e.getContrast=function(e,r=225){return v(e,{ignoreAlpha:!0})>r?new t([0,0,0,e.a]):new t([255,255,255,e.a])},e.isRGB=a,e.multiplyOpacity=function(e,t){const r=e.clone();return r.a*=t,r},e.multiplyOpacityToUnitRGBA=function(e,r){const i=t.toUnitRGBA(e);return i[3]*=r,i},e.toHSV=b,e.toLAB=x,e.toLCH=function(e){return c(e)?e:function(e){return function(e){const t=e.l,r=e.a,i=e.b,s=Math.sqrt(r*r+i*i);let n=Math.atan2(i,r);return n=n>0?n:n+2*Math.PI,{l:t,c:s,h:n}}(m(f(e)))}(_(e))},e.toRGB=_,e.unitRGBAFromColor=function(e){return t.toUnitRGBA(e)},e.validateColor=w,e.validateColorAndOpacity=function(e){return e.length=4,w(e),e[3]??=1,s.clamp(e[3],0,1),e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/unitBezier":function(){define(["exports"],function(e){"use strict";function t(e,t,r,i){const s=3*e,n=3*(r-e)-s,o=1-s-n,a=3*t,l=3*(i-t)-a,u=1-a-l;function c(e){return((o*e+n)*e+s)*e}function h(e){return(3*o*e+2*n)*e+s}return function(e,t=1e-6){return r=function(e,t){let r,i,s,n,o,a;for(s=e,a=0;a<8;a++){if(n=c(s)-e,Math.abs(n)<t)return s;if(o=h(s),Math.abs(o)<1e-6)break;s-=n/o}if(r=0,i=1,s=e,s<r)return r;if(s>i)return i;for(;r<i;){if(n=c(s),Math.abs(n-e)<t)return s;e>n?r=s:i=s,s=.5*(i-r)+r}return s}(e,t),((u*r+l)*r+a)*r;var r}}const r=/^cubic-bezier\((.*)\)/,i={};i.ease=t(.25,.1,.25,1),i.linear=t(0,0,1,1),i.easeIn=i["ease-in"]=t(.42,0,1,1),i.easeOut=i["ease-out"]=t(0,0,.58,1),i.easeInOut=i["ease-in-out"]=t(.42,0,.58,1),e.easingFunctions=i,e.parse=function(e){let s=i[e]||null;if(!s){const i=r.exec(e);if(i){const e=i[1].split(",").map(e=>parseFloat(e.trim()));4!==e.length||e.some(e=>isNaN(e))||(s=t.apply(t,e))}}return s},e.unitBezier=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(e,t){"use strict";const r={kind:"null"},i={kind:"number"},s={kind:"string"},n={kind:"boolean"},o={kind:"color"},a={kind:"object"},l={kind:"value"};function u(e,t){return{kind:"array",itemType:e,n:t}}const c=[r,i,s,n,o,a,u(l)];e.arrayType=u,e.booleanType=n,e.colorType=o,e.getType=function e(c){if(null===c)return r;if("string"==typeof c)return s;if("boolean"==typeof c)return n;if("number"==typeof c)return i;if(c instanceof t)return o;if(Array.isArray(c)){let t;for(const r of c){const i=e(r);if(t){if(t!==i){t=l;break}}else t=i}return u(t||l,c.length)}return"object"==typeof c?a:l},e.matchType=function e(t,r){if("array"===r.kind)return"array"===t.kind&&(0===t.n&&"value"===t.itemType.kind||e(t.itemType,r.itemType))&&("number"!=typeof r.n||r.n===t.n);if("value"===r.kind)for(const r of c)if(e(t,r))return!0;return r.kind===t.kind},e.nullType=r,e.numberType=i,e.objectType=a,e.stringType=s,e.typeToString=function e(t){if("array"===t.kind){const r=e(t.itemType);return"number"==typeof t.n?`array<${r}, ${t.n}>`:"value"===t.itemType.kind?"array":`array<${r}>`}return t.kind},e.valueToString=function(e){if(null===e)return"";const r=typeof e;return"string"===r?e:"number"===r||"boolean"===r?String(e):e instanceof t?e.toString():JSON.stringify(e)},e.valueType=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports"],function(e){"use strict";class t{static{this.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}}}static{this.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}}}static{this.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}}}static{this.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[0]}}}static{this.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}}}static{this.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}}}static{this.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}}}static{this.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}}}static{this.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:0}}}static{this.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}}}static{this.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:0}}}}e.StyleDefinition=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../../../../../colorUtils","../GeometryUtils","../expression/expression","../expression/types"],function(e,t,r,i,s){"use strict";class n{constructor(e,t){let r;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case"number":case"color":r=!0;break;case"array":r="number"===e.value;break;default:r=!1}if((null==t||""===t&&"color"===e.type)&&(t=e.default),Array.isArray(t)&&t.length>0&&i.ops[t[0]]){const r={number:s.numberType,color:s.colorType,string:s.stringType,boolean:s.booleanType,enum:s.stringType};try{const n="array"===e.type?s.arrayType(r[e.value]||s.valueType,e.length):r[e.type],o=i.createExpression(t,null,n);this.getValue=this._buildExpression(o,e),this.isDataDriven=!0,o instanceof i.Interpolate&&o.input instanceof i.Zoom&&(this.interpolator=o)}catch(t){console.log(t.message),this.getValue=this._buildSimple(e.default)}return}r&&"interval"===t.type&&(r=!1);const n=t?.stops&&t.stops.length>0;if(n)for(const r of t.stops)r[1]=this._validate(r[1],e);if(this.isDataDriven=!!t&&!!t.property,this.isDataDriven)if(void 0!==t.default&&(t.default=this._validate(t.default,e)),n)switch(t.type){case"identity":this.getValue=this._buildIdentity(t,e);break;case"categorical":this.getValue=this._buildCategorical(t,e);break;default:this.getValue=r?this._buildInterpolate(t,e):this._buildInterval(t,e)}else this.getValue=this._buildIdentity(t,e);else n?this.getValue=r?this._buildZoomInterpolate(t):this._buildZoomInterval(t):(t=this._validate(t,e),this.getValue=this._buildSimple(t))}_validate(e,t){if("number"===t.type){if(null!=t.minimum&&e<t.minimum)return t.minimum;if(null!=t.maximum&&e>t.maximum)return t.maximum}else"color"===t.type?e=n._parseColor(e):"enum"===t.type?"string"==typeof e&&(e=t.values.indexOf(e)):"array"===t.type&&"enum"===t.value?e=e.map(e=>"string"==typeof e?t.values.indexOf(e):e):"string"===t.type&&(e=s.valueToString(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,t){return(r,i)=>{try{const s=e.evaluate(i,r);return void 0===s?t.default:this._validate(s,t)}catch(e){return console.log(e.message),t.default}}}_buildIdentity(e,t){return(r,i)=>{let s;return i&&(s=i.values[e.property]),void 0!==s&&(s=this._validate(s,t)),null!=s?s:void 0!==e.default?e.default:t.default}}_buildCategorical(e,t){return(r,i)=>{let s;return i&&(s=i.values[e.property]),s=this._categorical(s,e.stops),void 0!==s?s:void 0!==e.default?e.default:t.default}}_buildInterval(e,t){return(r,i)=>{let s;return i&&(s=i.values[e.property]),"number"==typeof s?this._interval(s,e.stops):void 0!==e.default?e.default:t.default}}_buildInterpolate(e,t){return(r,i)=>{let s;return i&&(s=i.values[e.property]),"number"==typeof s?this._interpolate(s,e.stops,e.base||1):void 0!==e.default?e.default:t.default}}_buildZoomInterpolate(e){return t=>this._interpolate(t,e.stops,e.base||1)}_buildZoomInterval(e){return t=>this._interval(t,e.stops)}_categorical(e,t){const r=t.length;for(let i=0;i<r;i++)if(t[i][0]===e)return t[i][1]}_interval(e,t){const r=t.length;let i=0;for(let s=0;s<r&&t[s][0]<=e;s++)i=s;return t[i][1]}_interpolate(e,t,i){let s,n;const o=t.length;for(let r=0;r<o;r++){const i=t[r];if(!(i[0]<=e)){n=i;break}s=i}if(s&&n){const t=n[0]-s[0],o=e-s[0],a=1===i?o/t:(i**o-1)/(i**t-1);if(Array.isArray(s[1])){const e=s[1],t=n[1],i=[];for(let s=0;s<e.length;s++)i.push(r.interpolate(e[s],t[s],a));return i}return r.interpolate(s[1],n[1],a)}return s?s[1]:n?n[1]:void 0}static _isEmpty(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}static _parseColor(r){return Array.isArray(r)?r:"string"==typeof r?t.parseToUnitRgba(r)??void 0:r instanceof e&&!this._isEmpty(r)?e.toUnitRGBA(r):void 0}}return n})},"esri/views/2d/engine/webgl/definitions":function(){define(["exports"],function(e){"use strict";e.MAX_TILE_RESHUFFLES_PER_FRAME=1,e.RESHUFFLING_EXEMPT_DRAW_CALLS=10,e.RESHUFFLING_EXEMPT_MEMORY_BYTES=1<<20,e.RESHUFFLING_TARGET_DRAW_EFFICIENCY=.75,e.RESHUFFLING_TARGET_MEMORY_EFFICIENCY=.75,e.angleFactor256=256/360,e.animationUnit=2,e.attributeStoreInitialSize=256,e.attributeStoreTextureSize=1024,e.averageGlyphMosaicItem={metrics:{width:15,height:17,left:0,top:-7,advance:14}},e.backbufferStencilClipped=1,e.backbufferStencilVisible=0,e.bitsetFillHasPatternHeightPrecisionFactor=32,e.bitsetFillHasPatternWidthPrecisionFactor=64,e.bitsetFillHasUnresolvedReplacementColor=8,e.bitsetFillRandomPatternOffset=4,e.bitsetGenericConsiderAlphaOnly=16,e.bitsetGenericLockColor=2,e.bitsetLineScaleDash=4,e.bitsetMarkerAlignmentMap=1,e.bitsetMarkerAlignmentScreen=0,e.bitsetMarkerOutlineAllowColorOverride=4,e.bitsetMarkerScaleSymbolsProportionally=8,e.bitsetTypeFillOutline=1,e.bufferDataMinimumSize=128,e.bufferDataPoolSize=4,e.chartMaxFields=10,e.collisionBoxPadding=16,e.collisionBucketSize=128,e.collisionEarlyRejectBucketSize=16,e.collisionMaxZoomDelta=1,e.collisionPlacementPadding=8,e.collisionTileBoxSize=4,e.compressionFactorForU16=128,e.dataDrivenUnit0=4,e.dataDrivenUnit1=5,e.dataDrivenUnit2=6,e.debugLabels=!1,e.defaultSdfTextureSize=128,e.displayRecordIntPerElement=8,e.dotDensityMaxFields=8,e.effectFlag0=128,e.enableEarlyLabelDiscard=!1,e.extrudeScale=64,e.filterFlag0=64,e.filterFlagsUnit=1,e.glyphSize=24,e.gpgpuUnit=12,e.gradientTextureExternalPadding=1,e.heuristicGlyphsPerFeature=10,e.heuristicGlyphsPerLine=50,e.hittestSmallSymbolThreshold=3,e.hittestToleranceDesktop=1,e.hittestToleranceMobile=3,e.hittestToleranceSmallSymbol=3,e.labelPlacementOffsetPadding=4,e.localTimeOriginUnit=13,e.magicLabelLineHeight=29,e.maxGeohashLevel=12,e.maxGpuUploadsPerFrame=2,e.maxHighlightReasons=6,e.maxRepresentableInt=16777216,e.maxTextLineWidth=512,e.minMaxZoomPrecisionFactor=10,e.minTextLineWidth=32,e.nanMagicNumber=1e-30,e.patchPixelBufferAllocSize=500,e.patternFillRasterizationScale=2,e.pictureFillColor=4294967295,e.randomInsidePolygonTextureSize=1024,e.rasterTileSize=256,e.rasterizedVectorMarkerMinSize=128,e.spritePadding=4,e.svgSdfTextureInnerSize=248,e.svgSdfTextureSize=256,e.textureBindingBitmap=0,e.textureBindingGlyphAtlas=0,e.textureBindingHighlight0=5,e.textureBindingHighlight1=6,e.textureBindingRenderer0=5,e.textureBindingRenderer1=6,e.textureBindingSpriteAtlas=0,e.textureUploadManagerBudget=4,e.textureUploadManagerChunkSize=128,e.thinLineHalfWidthThreshold=1.05,e.tileSize=512,e.visualVariableUnit=3,e.vtlHighResCutoff=1.15,e.vtlTextureBindingUnitGlyphs=6,e.vtlTextureBindingUnitSprites=5,e.webglMaxInnerStops=6,e.webglMaxStops=8,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities":function(){define(["exports","./capabilities/DebugRendererInfo"],function(e,t){"use strict";let r;class i{constructor(){this.available=!1,this.majorPerformanceCaveat=!1,this.maxTextureSize=0,this.supportsVertexShaderSamplers=!1,this.supportsHighPrecisionFragment=!1,this.supportsColorBufferFloat=!1,this.supportsColorBufferFloatBlend=!1,this.supportsColorBufferHalfFloat=!1,this.unmaskedRenderer="unloaded"}}e.getWebGLCapabilities=function(){return r??=function(){const e=new i,r=function(e){if("undefined"==typeof WebGL2RenderingContext)return null;const r=document.createElement("canvas");if(!r)return null;let i=r.getContext("webgl2",{failIfMajorPerformanceCaveat:!0});if(null==i&&(i=r.getContext("webgl2"),null!=i&&(e.majorPerformanceCaveat=!0,e.unmaskedRenderer=t.loadRendererInfo(i)?.getUnmaskedRenderer()??"unknown")),null==i)return i;e.available=!0,e.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),e.supportsVertexShaderSamplers=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;const s=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);return s&&(e.supportsHighPrecisionFragment=s.precision>0),i}(e);return null==r||(e.supportsColorBufferFloat=null!==r.getExtension("EXT_color_buffer_float"),e.supportsColorBufferFloatBlend=null!==r.getExtension("EXT_float_blend"),e.supportsColorBufferHalfFloat=e.supportsColorBufferFloat||null!==r.getExtension("EXT_color_buffer_half_float")),e}(),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DebugRendererInfo":function(){define(["exports"],function(e){"use strict";class t{constructor(e){this.getUnmaskedRenderer=e}}e.RendererInfo=t,e.loadRendererInfo=function(e){const r=e.getExtension("WEBGL_debug_renderer_info");return r?new t(()=>e.getParameter(r.UNMASKED_RENDERER_WEBGL)):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["../chunks/tslib.es6","../request","../core/asyncUtils","../core/Error","../core/lang","../core/MultiOriginJSONSupport","../core/promiseUtils","../core/urlUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../geometry/Extent","../geometry/SpatialReference","./Layer","./mixins/APIKeyMixin","./mixins/ArcGISCachedService","./mixins/ArcGISService","./mixins/BlendLayer","./mixins/CustomParametersMixin","./mixins/OperationalLayer","./mixins/PortalLayer","./mixins/RefreshableLayer","./mixins/ScaleRangeLayer","./support/imageUtils","./support/SpriteSource","./support/TileInfo","./support/TilemapCache","./support/vectorTileLayerLoader","../portal/support/jsonContext","../portal/support/urlUtils","../chunks/persistableUrlUtils","../views/2d/engine/vectorTiles/tileInfoUtils","../views/2d/engine/vectorTiles/style/StyleRepository","../views/webgl/capabilities"],function(e,t,r,i,s,n,o,a,l,u,c,h,p,y,f,d,m,g,_,b,x,T,v,w,S,A,E,I,L,P,D,R,M,O,U,B,N){"use strict";let C=class extends(x.BlendLayer(A.ScaleRangeLayer(S.RefreshableLayer(_.ArcGISCachedService(b.ArcGISService(v.OperationalLayer(w.PortalLayer(T.CustomParametersMixin(g.APIKeyMixin(n.MultiOriginJSONMixin(m))))))))))){constructor(...e){super(...e),this._spriteSourceMap=new Map,this.currentStyleInfo=null,this.isReference=null,this.operationalLayerType="VectorTileLayer",this.path=null,this.refreshInterval=0,this.style=null,this.tilemapCache=null,this.type="vector-tile",this.url=null}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}destroy(){if(this.sourceNameToSource)for(const e of Object.values(this.sourceNameToSource))e?.destroy();this.primarySource?.destroy(),this._spriteSourceMap.clear()}async prefetchResources(e){await this.loadSpriteSource(globalThis.devicePixelRatio||1,e)}load(e){const r=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},e).catch(o.throwIfAbortError).then(async()=>{if(!this.portalItem?.id)return;const r=`${this.portalItem.itemCdnUrl}/resources/styles/root.json`;(await t(r,{...e,query:{f:"json",...this.customParameters,token:this.apiKey},authMode:this.portalItem.portal.authMode})).data&&this.read({url:r},R.createForItemRead(this.portalItem,"portal-item"))}).catch(o.throwIfAbortError).then(()=>this._loadStyle(e));return this.addResolvingPromise(r),Promise.resolve(this)}get apiKey(){return super.apiKey}set apiKey(e){super.apiKey=e}set portalItem(e){super.portalItem=e}get attributionDataUrl(){const e=this.currentStyleInfo,t=e?.serviceUrl&&a.urlToObject(e.serviceUrl);if(!t)return null;const r=this._getDefaultAttribution(t.path);return r?a.addQueryParameters(r,{...this.customParameters,token:this.apiKey}):null}get capabilities(){const e=this.primarySource;return e?e.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}}get fullExtent(){return this.primarySource?.fullExtent||null}get initialExtent(){return this.primarySource?.initialExtent||null}get parsedUrl(){return this.serviceUrl?a.urlToObject(this.serviceUrl):null}get serviceUrl(){return this.currentStyleInfo?.serviceUrl||null}get spatialReference(){return this.tileInfo?.spatialReference??null}get styleUrl(){return this.currentStyleInfo?.styleUrl||null}writeStyleUrl(e,t){e&&a.isProtocolRelative(e)&&(e=`https:${e}`);const r=M.parseKnownArcGISOnlineDomain(e);t.styleUrl=O.ensureMainOnlineDomain(e,r)}get tileInfo(){const e=[];for(const t in this.sourceNameToSource)e.push(this.sourceNameToSource[t]);let t=this.primarySource?.tileInfo||new L;if(e.length>1)for(let r=0;r<e.length;r++)U.areSchemasOverlapping(t,e[r].tileInfo)&&(t=U.unionTileInfos(t,e[r].tileInfo));return t}readTilemapCache(e,t){const r=t.capabilities?.includes("Tilemap");return r?new P.TilemapCache({layer:this}):null}readVersion(e,t){return t.version?parseFloat(t.version):parseFloat(t.currentVersion)}async loadSpriteSource(e=1,t){if(!this._spriteSourceMap.has(e)){const r=N.getWebGLCapabilities().maxTextureSize,i=this.currentStyleInfo?.spriteUrl?a.addQueryParameters(this.currentStyleInfo.spriteUrl,{...this.customParameters,token:this.apiKey}):null,s=new I({type:"url",spriteUrl:i,pixelRatio:e,spriteFormat:this.currentStyleInfo?.spriteFormat},r);await s.load(t),this._spriteSourceMap.set(e,s)}return this._spriteSourceMap.get(e)}async setSpriteSource(e,t){if(!e)return null;const r=N.getWebGLCapabilities().maxTextureSize,i=e.spriteUrl,s=i?a.addQueryParameters(i,{...this.customParameters,token:this.apiKey}):null;if(!s&&"url"===e.type)return null;const n=new I(e,r);try{await n.load(t);const r=e.pixelRatio||1;return this._spriteSourceMap.clear(),this._spriteSourceMap.set(r,n),s&&this.currentStyleInfo&&(this.currentStyleInfo.spriteUrl=s),this.emit("spriteSource-change",{spriteSource:n}),n}catch(e){o.throwIfAbortError(e)}return null}async loadStyle(e,t){const i=e||this.style||this.url;return this._loadingTask&&"string"==typeof i&&this.url===i||(this._loadingTask?.abort(),this._loadingTask=r.createTask(e=>(this._spriteSourceMap.clear(),this._getSourceAndStyle(i,{signal:e})),t)),this._loadingTask.promise}getStyleLayerId(e){return this.styleRepository.getStyleLayerId(e)}getStyleLayerIndex(e){return this.styleRepository.getStyleLayerIndex(e)}getPaintProperties(e){return s.clone(this.styleRepository?.getPaintProperties(e))}setPaintProperties(e,t){const r=this.styleRepository.isPainterDataDriven(e);this.styleRepository.setPaintProperties(e,t);const i=this.styleRepository.isPainterDataDriven(e);this.emit("paint-change",{layer:e,paint:t,isDataDriven:r||i})}getStyleLayer(e){return s.clone(this.styleRepository.getStyleLayer(e))}setStyleLayer(e,t){this.styleRepository.setStyleLayer(e,t),this.emit("style-layer-change",{layer:e,index:t})}deleteStyleLayer(e){this.styleRepository.deleteStyleLayer(e),this.emit("delete-style-layer",{layer:e})}getLayoutProperties(e){return s.clone(this.styleRepository.getLayoutProperties(e))}setLayoutProperties(e,t){this.styleRepository.setLayoutProperties(e,t),this.emit("layout-change",{layer:e,layout:t})}setStyleLayerVisibility(e,t){this.styleRepository.setStyleLayerVisibility(e,t),this.emit("style-layer-visibility-change",{layer:e,visibility:t})}getStyleLayerVisibility(e){return this.styleRepository.getStyleLayerVisibility(e)}write(e,t){return t?.origin&&!this.styleUrl?(t.messages&&t.messages.push(new i("vectortilelayer:unsupported",`VectorTileLayer (${this.title}, ${this.id}) with style defined by JSON only are not supported`,{layer:this})),null):super.write(e,t)}getTileUrl(e,t,r){return null}async _getSourceAndStyle(e,t){if(!e)throw new Error("invalid style!");const r=await D.loadMetadata(e,{...t,query:{...this.customParameters,token:this.apiKey}});"webp"===r.spriteFormat&&(await E.checkWebPSupport("lossy")||(r.spriteFormat="png")),this._set("currentStyleInfo",{...r}),"string"==typeof e?(this.url=e,this.style=null):(this.url=null,this.style=e),this._set("sourceNameToSource",r.sourceNameToSource),this._set("primarySource",r.sourceNameToSource[r.primarySourceName]),this._set("styleRepository",new B(r.style,!1)),this.read(r.layerDefinition,{origin:"service"}),this.emit("load-style")}_getDefaultAttribution(e){const t=e.match(/^https?:\/\/(?:basemaps|basemapsbeta|basemapsdev)(?:-api)?\.arcgis\.com(\/[^/]+)?\/arcgis\/rest\/services\/([^/]+(\/[^/]+)*)\/vectortileserver/i),r=["OpenBasemap_v2","OpenBasemap_GCS_v2","OpenStreetMap_v2","OpenStreetMap_Daylight_v2","OpenStreetMap_Export_v2","OpenStreetMap_FTS_v2","OpenStreetMap_GCS_v2","World_Basemap","World_Basemap_v2","World_Basemap_Export_v2","World_Basemap_GCS_v2","World_Basemap_WGS84","World_Contours_v2","World_Hillshade_v2"];if(!t)return;const i=t[2]&&t[2].toLowerCase();if(!i)return;const s=t[1]||"";for(const e of r)if(e.toLowerCase().includes(i))return a.normalize(`//static.arcgis.com/attribution/Vector${s}/${e}`)}async _loadStyle(e){return this._loadingTask?.promise??this.loadStyle(null,e)}};return e.__decorate([l.property({readOnly:!0})],C.prototype,"attributionDataUrl",null),e.__decorate([l.property({type:["show","hide"]})],C.prototype,"listMode",void 0),e.__decorate([l.property({json:{read:!0,write:!0}})],C.prototype,"blendMode",void 0),e.__decorate([l.property({readOnly:!0,json:{read:!1}})],C.prototype,"capabilities",null),e.__decorate([l.property({readOnly:!0})],C.prototype,"currentStyleInfo",void 0),e.__decorate([l.property({json:{read:!1},readOnly:!0,type:f})],C.prototype,"fullExtent",null),e.__decorate([l.property({json:{read:!1},readOnly:!0,type:f})],C.prototype,"initialExtent",null),e.__decorate([l.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],C.prototype,"isReference",void 0),e.__decorate([l.property({type:["VectorTileLayer"]})],C.prototype,"operationalLayerType",void 0),e.__decorate([l.property({readOnly:!0})],C.prototype,"parsedUrl",null),e.__decorate([l.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],C.prototype,"path",void 0),e.__decorate([l.property({type:Number,json:{write:!1,origins:{"web-map":{write:!1},"web-scene":{write:!1},"portal-item":{write:!1}}}})],C.prototype,"refreshInterval",void 0),e.__decorate([l.property()],C.prototype,"style",void 0),e.__decorate([l.property({readOnly:!0})],C.prototype,"serviceUrl",null),e.__decorate([l.property({type:d,readOnly:!0})],C.prototype,"spatialReference",null),e.__decorate([l.property({readOnly:!0})],C.prototype,"styleRepository",void 0),e.__decorate([l.property({readOnly:!0})],C.prototype,"sourceNameToSource",void 0),e.__decorate([l.property({readOnly:!0})],C.prototype,"primarySource",void 0),e.__decorate([l.property({type:String,readOnly:!0,json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],C.prototype,"styleUrl",null),e.__decorate([y.writer(["portal-item","web-document"],"styleUrl")],C.prototype,"writeStyleUrl",null),e.__decorate([l.property({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:L})],C.prototype,"tileInfo",null),e.__decorate([l.property()],C.prototype,"tilemapCache",void 0),e.__decorate([h.reader("service","tilemapCache",["capabilities","tileInfo"])],C.prototype,"readTilemapCache",null),e.__decorate([l.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],C.prototype,"type",void 0),e.__decorate([l.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],C.prototype,"url",void 0),e.__decorate([l.property({readOnly:!0})],C.prototype,"version",void 0),e.__decorate([h.reader("version",["version","currentVersion"])],C.prototype,"readVersion",null),C=e.__decorate([p.subclass("esri.layers.VectorTileLayer")],C),C});