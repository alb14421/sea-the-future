// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/Collection","../../core/reactiveUtils","../../core/accessorSupport/trackingUtils"],function(e,r,t,n){"use strict";const o=new r,s=new WeakMap;function f(e){return null!=e&&"object"==typeof e&&"refreshInterval"in e&&"refresh"in e}function c(e,r){return Number.isFinite(e)&&Number.isFinite(r)?r<=0?e:c(r,e%r):0}let i=0,a=0;function l(){const e=Date.now();let r=!1;for(const t of o){const n=t.deref();n?n.refreshInterval&&e-(s.get(n)??0)+5>=6e4*n.refreshInterval&&(s.set(n,e),n.refresh(e)):r=!0}if(r)for(let e=o.length-1;e>=0;e--)o.at(e).deref()||o.removeAt(e)}n.autorun(()=>{const e=Date.now();let r=0;for(const t of o){const n=t.deref();n&&(r=c(Math.round(6e4*n.refreshInterval),r),n.refreshInterval?s.get(n)||s.set(n,e):s.delete(n))}if(r!==a){if(a=r,clearInterval(i),0===a)return void(i=0);i=setInterval(l,a)}},t.sync);const u={get hasRefreshTimer(){return i>0},get tickInterval(){return a},forceRefresh(){l()},hasLayer:e=>f(e)&&o.some(r=>r.deref()===e),clear(){for(const e of o){const r=e.deref();r&&s.delete(r)}o.removeAll()}};e.registerLayer=function(e){f(e)&&o.push(new WeakRef(e))},e.test=u,e.unregisterLayer=function(e){const r=o.find(r=>r.deref()===e);r&&o.remove(r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});