// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/tslib.es6","../../core/Error","../../core/urlUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../core/accessorSupport/layerContainerType","../../core/accessorSupport/read","../../core/accessorSupport/write","./operationalLayers","../support/commonProperties","../../chunks/TimeExtent"],function(e,r,t,i,o,a,s,n,l,p,y,c,d,u,w,b,m){"use strict";e.OperationalLayer=e=>{const s=e;let n=class extends s{constructor(){super(...arguments),this.persistenceEnabled=!0,this.title=null}readId(e,r,t){return"Group Layer"===t?.portalItem?.type?void 0:e}writeListMode(e,r,t,i){(i&&"ground"===i.layerContainerType||e&&u.willPropertyWrite(this,t,{},i))&&(r[t]=e)}writeOperationalLayerType(e,r,t){e&&(r[t]=e)}writeTitle(e,r){r.title=e??"Layer"}readVisibilityTimeExtent(e){return e?m.TimeExtent.fromArray(e):null}writeVisibilityTimeExtent(e,r,i,o){e&&"tables"!==o.layerContainerType&&(e.isEmpty?o?.messages&&o.messages.push(new t("layer:invalid-visibilityTimeExtent","visibilityTimeExtent cannot be empty")):r[i]=e.toArray())}read(e,r){r&&(r.layer=this),d.readLoadable(this,e,r=>super.read(e,r),r)}write(e,r){if(!this.persistenceEnabled&&!r?.ignorePersistenceEnabled)return null;if(r?.origin){const e=`${r.origin}/${r.layerContainerType||"operational-layers"}`,i=w.supportedTypes[e];let o=!!i?.[this.operationalLayerType];if("ArcGISTiledElevationServiceLayer"===this.operationalLayerType&&"web-scene/operational-layers"===e&&(o=!1),"ArcGISDimensionLayer"===this.operationalLayerType&&"web-map/operational-layers"===e&&(o=!1),!o)return r.messages?.push(new t("layer:unsupported",`Layers (${this.title}, ${this.id}) of type '${this.declaredClass}' are not supported in the context of '${e}'`,{layer:this})),null}const o=super.write(e,{...r,layer:this}),a=!!r&&!!r.messages&&!!r.messages.filter(e=>e instanceof t&&"web-document-write:property-required"===e.name).length;return i.isBlobProtocol(o?.url)?(r?.messages?.push(new t("layer:invalid-url",`Layer (${this.title}, ${this.id}) of type '${this.declaredClass}' using a Blob URL cannot be written to web scenes and web maps`,{layer:this})),null):!this.url&&a?null:o}beforeSave(){}};return r.__decorate([o.property({type:String,json:{write:{ignoreOrigin:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0}},"portal-item":{write:!1}}}})],n.prototype,"id",void 0),r.__decorate([l.reader("id",["id"])],n.prototype,"readId",null),r.__decorate([o.property(b.listMode)],n.prototype,"listMode",void 0),r.__decorate([y.writer("listMode")],n.prototype,"writeListMode",null),r.__decorate([o.property({type:String,readOnly:!0,json:{read:!1,write:{target:"layerType",ignoreOrigin:!0},origins:{"portal-item":{write:!1},"web-scene":{name:"layerType",read:!1,write:{enabled:!0,ignoreOrigin:!0,layerContainerTypes:c.excludeTables,isRequired:!0}}}}})],n.prototype,"operationalLayerType",void 0),r.__decorate([y.writer("operationalLayerType")],n.prototype,"writeOperationalLayerType",null),r.__decorate([o.property(b.opacity)],n.prototype,"opacity",void 0),r.__decorate([o.property({type:Boolean,readOnly:!1})],n.prototype,"persistenceEnabled",void 0),r.__decorate([o.property({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0},origins:{"web-scene":{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}},"portal-item":{write:!1}}},value:"Layer"})],n.prototype,"title",void 0),r.__decorate([y.writer("title"),y.writer(["web-scene"],"title")],n.prototype,"writeTitle",null),r.__decorate([o.property({type:m.TimeExtent,json:{origins:{"web-scene":{write:{layerContainerTypes:c.excludeTables}}}}})],n.prototype,"visibilityTimeExtent",void 0),r.__decorate([l.reader("visibilityTimeExtent")],n.prototype,"readVisibilityTimeExtent",null),r.__decorate([y.writer(["portal-item","web-map","web-scene"],"visibilityTimeExtent",{visibilityTimeExtent:{type:[[a.Integer,a.Null]]}})],n.prototype,"writeVisibilityTimeExtent",null),r.__decorate([o.property({type:Boolean,json:{name:"visibility",write:{layerContainerTypes:c.excludeTables}}})],n.prototype,"visible",void 0),n=r.__decorate([p.subclass("esri.layers.mixins.OperationalLayer")],n),n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});