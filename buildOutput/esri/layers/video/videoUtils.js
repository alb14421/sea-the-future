// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../support/TelemetryData","../support/VideoTimeExtent","../../symbols/support/cimSymbolUtils","../../symbols/support/utils"],function(e,t,r,n,o,i,a,u){"use strict";const s="application/x-mpegURL",l={UASDatalinkLocalSet:1e4,PrecisionTimeStamp:10002,MissionId:10003,PlatformTailNumber:10004,PlatformHeadingAngle:10005,PlatformPitchAngle:10006,PlatformRollAngle:10007,PlatformTrueAirspeed:10008,PlatformIndicatedAirspeed:10009,PlatformDesignation:10010,ImageSourceSensor:10011,ImageCoordinateSystem:10012,SensorLatitude:10013,SensorLongitude:10014,SensorTrueAltitude:10015,SensorHorizontalFOV:10016,SensorVerticalFOV:10017,SensorAzimuthAngle:10018,SensorElevationAngle:10019,SensorRollAngle:10020,PlatformSlantRange:10021,TargetWidth:10022,FrameCenterLatitude:10023,FrameCenterLongitude:10024,FrameCenterElevation:10025,OffsetCorner1Latitude:10026,OffsetCorner1Longitude:10027,OffsetCorner2Latitude:10028,OffsetCorner2Longitude:10029,OffsetCorner3Latitude:10030,OffsetCorner3Longitude:10031,OffsetCorner4Latitude:10032,OffsetCorner4Longitude:10033,TargetLocationLatitude:10040,TargetLocationLongitude:10041,TargetLocationElevation:10042,TargetTrackGateWidth:10043,TargetTrackGateHeight:10044,TargetErrorEstimateHorizontal:10045,TargetErrorEstimateLateral:10046,GenericFlagData:10047,PlatformGroundSpeed:10056,PlatformGroundRange:10057,PlatformRemainingFuel:10058,PlatformCallSign:10059,SensorFOVName:10063,PlatformMagneticHeading:10064,LDSVersionNumber:10065,AlternatePlatformName:10070,EventStartTimeUTC:10072,VMTIDataSet:10074,SensorEllipsoidHeight:10075,OperationalMode:10077,FrameCenterAboveEllipsoid:10078,CornerLatitudePoint1:10082,CornerLongitudePoint1:10083,CornerLatitudePoint2:10084,CornerLongitudePoint2:10085,CornerLatitudePoint3:10086,CornerLongitudePoint3:10087,CornerLatitudePoint4:10088,CornerLongitudePoint4:10089,SARMotionImageryMetadata:10095,SecurityClassification:20001,SecurityClassifyingAuthority:20002,SecurityClassifyingCountry:20003,SecuritySCI:20004,SecurityCaveats:20005,SecurityReleaseInstructions:20006,SecurityLDSVersion:20022,EsriVideoWidth:90001,EsriVideoHeight:90002,EsriFrameCenterLatitude:90050,EsriFrameCenterLongitude:90051,EsriCornerLatitudePt1:90052,EsriCornerLongitudePt1:90053,EsriCornerLatitudePt2:90054,EsriCornerLongitudePt2:90055,EsriCornerLatitudePt3:90056,EsriCornerLongitudePt3:90057,EsriCornerLatitudePt4:90058,EsriCornerLongitudePt4:90059,EsriFrameOutline:90060,EsriSensorPosition:90061,EsriHorizonPixelPack:90063,EsriGroundControlPoints:90064};function d(e){return function(e){return e&&e.has(l.EsriFrameCenterLatitude)&&e.has(l.EsriFrameCenterLongitude)?new t({x:e.get(l.EsriFrameCenterLongitude).value,y:e.get(l.EsriFrameCenterLatitude).value,z:e.get(l.FrameCenterAboveEllipsoid)?.value??e.get(l.FrameCenterElevation)?.value}):null}(e)??function(e){return e&&e.has(l.FrameCenterLatitude)&&e.has(l.FrameCenterLongitude)?new t({x:e.get(l.FrameCenterLongitude)?.value,y:e.get(l.FrameCenterLatitude)?.value,z:e.get(l.FrameCenterElevation)?.value}):null}(e)}e.getFrameCenter=d,e.getFrameHorizonPoints=function(e){return e?.size?e.get(l.EsriHorizonPixelPack)?.value??null:null},e.getGroundControlPoints=function(e){return e?.size?e.get(l.EsriGroundControlPoints)?.value??null??null:null},e.getSensorTrailPoints=function(e,t){const r=[...t],n=r.findIndex(t=>t.equals(e));return n>-1&&r.splice(n),r.push(e),r},e.getServiceLayersInfo=function(e){const t=e?.layers;return t?.length?t.map(e=>({layerId:e.id,posterUrl:e.poster,sourceType:e.serviceType,title:e.name,type:e.type||"Video Layer"})):[]},e.getStyledTelemetrySymbol=function(e,t,r){if(!e)return null;const n=e.clone();switch(n.type){case"simple-fill":u.applyColorToSymbol(n,r),n.outline.color=t;break;case"simple-line":u.applyColorToSymbol(n,t);break;case"simple-marker":u.applyColorToSymbol(n,t),n?.outline?.color&&(n.outline.color=t);break;case"cim":a.applyCIMSymbolColor(n,t)}return n},e.getSymbolDisplayAngle=function(e){const{cameraAzimuth:t,platformHeading:r,source:n=null,symbolOffset:o=0}=e||{};let i=0;if(!n)return i;i="platformHeading"===n?r+o:r+t+o;const a=i>360?i-360:i;return Math.round(Math.abs(a))},e.getTelemetryData=function(e){if(!e?.size)return new o;const i=function(e){if(!e?.size)return null;if(e.has(l.EsriSensorPosition)){const r=e.get(l.EsriSensorPosition)?.value;if(r)return t.fromJSON(r.geometry)}return e.has(l.SensorLongitude)&&e.has(l.SensorLatitude)?new t({x:e.get(l.SensorLongitude)?.value,y:e.get(l.SensorLatitude)?.value,z:e.get(l.SensorTrueAltitude)?.value}):null}(e),a=d(e),u=function(e){if(!e)return null;const t=e.get(l.EsriFrameOutline)?.value;return t?r.fromJSON(t.geometry):function(e){if(!(e.has(l.EsriCornerLatitudePt1)&&e.has(l.EsriCornerLongitudePt1)&&e.has(l.EsriCornerLatitudePt2)&&e.has(l.EsriCornerLongitudePt2)&&e.has(l.EsriCornerLatitudePt3)&&e.has(l.EsriCornerLongitudePt3)&&e.has(l.EsriCornerLatitudePt4)&&e.has(l.EsriCornerLongitudePt4)))return null;const t=[e.get(l.EsriCornerLongitudePt1)?.value,e.get(l.EsriCornerLatitudePt1)?.value],n=[e.get(l.EsriCornerLongitudePt2)?.value,e.get(l.EsriCornerLatitudePt2)?.value],o=[e.get(l.EsriCornerLongitudePt3)?.value,e.get(l.EsriCornerLatitudePt3)?.value],i=[e.get(l.EsriCornerLongitudePt4)?.value,e.get(l.EsriCornerLatitudePt4)?.value];return new r({rings:[[t,n,o,i]]})}(e)??function(e){if(!(e.has(l.OffsetCorner1Latitude)&&e.has(l.OffsetCorner1Longitude)&&e.has(l.OffsetCorner2Latitude)&&e.has(l.OffsetCorner2Longitude)&&e.has(l.OffsetCorner3Latitude)&&e.has(l.OffsetCorner3Longitude)&&e.has(l.OffsetCorner4Latitude)&&e.has(l.OffsetCorner4Longitude)&&e.has(l.FrameCenterLatitude)&&e.has(l.FrameCenterLongitude)))return null;const t=e.get(l.FrameCenterLatitude)?.value,n=e.get(l.FrameCenterLongitude)?.value,o=t+e.get(l.OffsetCorner1Latitude)?.value,i=n+e.get(l.OffsetCorner1Longitude)?.value,a=t+e.get(l.OffsetCorner2Latitude)?.value,u=n+e.get(l.OffsetCorner2Longitude)?.value,s=t+e.get(l.OffsetCorner3Latitude)?.value,d=n+e.get(l.OffsetCorner3Longitude)?.value,g=t+e.get(l.OffsetCorner4Latitude)?.value,f=n+e.get(l.OffsetCorner4Longitude)?.value;return new r({rings:[[[i,o],[u,a],[d,s],[f,g]]]})}(e)}(e),s=function(e,t){if(!e||!t)return null;const r=[e.x,e.y,e.z??0],o=[t.x,t.y,t.z??0];return new n({paths:[[r,o]]})}(i,a);return new o({frameCenter:a,frameOutline:u,lineOfSight:s,sensorLocation:i})},e.getVideoMetadataFromCueList=function(e,t=1e4){if(!e||!e.length)return[];let r=[],n=[];for(let t=0;t<e.length;t++){const n=e[t],o=n?.text?JSON.parse(n.text):null;"EsriVideoServer"===o?.source&&(r=[...o.data])}const o=r.find(e=>e.tagId===t);return Array.isArray(o?.value)&&(n=[...o.value]),n},e.getVideoMimeType=function(e){if(!e)return s;const t=e.match(/\.(\w{3,4})(?:$|\?)/i);if(!t)return s;switch(t[1].toLowerCase()){case"mp4":return"video/mp4";case"webm":return"video/webm";default:return s}},e.readVideoTimeExtent=function(e){const{duration:t,end:r,start:n,timezone:o="UTC"}=e||{};return"number"!=typeof t?null:new i({duration:t||null,end:"number"==typeof r?new Date(r):null,start:"number"==typeof n?new Date(n):null,timezone:o})},e.videoMetadataEntryId=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});