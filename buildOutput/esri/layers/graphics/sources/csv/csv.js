// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/date","../../../../core/number","../../../support/fieldUtils","../../../support/locationUtils"],function(e,t,n,i,r){"use strict";const o=/^\s*"([\S\s]*)"\s*$/,l=/""/g,s=[","," ",";","|","\t"];function*u(e,t,n){let i=0;for(;i<=e.length;){const r=e.indexOf(t,i),o=e.slice(i,r>-1?r:void 0);i+=o.length+t.length,n&&!o.trim()||(yield o)}}function c(e){const t=e.includes("\r\n")?"\r\n":"\n";return u(e,t,!0)}function a(e,t){return u(e,t,!1)}function*f(e,t,n,i=()=>Object.create(null)){const r=c(e);r.next();let s="",u="",f=0,d=i(),g=0;e:for(const e of r){const r=a(e,n);for(const e of r)if(s+=u+e,u="",f+=p(e),f%2==0){if(f>0){const e=o.exec(s);if(!e){d=i(),g=0,s="",f=0;continue e}d[t[g]]=e[1].replaceAll(l,'"'),g++}else d[t[g]]=s,g++;s="",f=0}else u=n;0===f?(yield d,d=i(),g=0):u="\n"}}function d(e,t){const n=g(e,t).filter(e=>null!=e),r=n.map(e=>i.normalizeFieldName(e));for(let e=r.length-1;e>=0;e--)r[e]||(r.splice(e,1),n.splice(e,1));return{names:r,aliases:n}}function g(e,t){if(!e?.length)return[];const n=[];let i="",r="",s=0;const u=a(e,t);for(const e of u)if(i+=r+e,r="",s+=p(e),s%2==0){if(s>0){const e=o.exec(i);e&&n.push(e[1].replaceAll(l,'"'))}else n.push(i);i="",s=0}else r=t;return n}function p(e){let t=0,n=0;for(n=e.indexOf('"',n);n>=0;)t++,n=e.indexOf('"',n+1);return t}function m(e){if(!e.length)return"string";const n=/[^+\-.,0-9]/;return e.map(e=>{if(""!==e){if(!n.test(e)){let t=N(e);if(!isNaN(t))return/[.,]/.test(e)||!Number.isInteger(t)||t>214783647||t<-214783648?"double":"integer";if(e.includes("E")){if(t=Number(e),!Number.isNaN(t))return"double";if(e.includes(",")&&(e=e.replace(",","."),t=Number(e),!Number.isNaN(t)))return"double"}}return t.isDateString(e)?"date":"string"}}).reduce((e,t)=>void 0===e?t:void 0===t?e:e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0)}const N=function(){const e=n._parseInfo(),t=new RegExp("^"+e.regexp+"$"),i=new RegExp("["+e.group+"\\s\\xa0]","g"),r=e.factor;return n=>{const o=t.exec(n);if(e.factor=r,!o)return NaN;let l=o[1];if(!o[1]){if(!o[2])return NaN;l=o[2],e.factor*=-1}return l=l.replace(i,"").replace(e.decimal,"."),+l*e.factor}}();e.extractFieldNamesAndAliasesFromRow=d,e.inferDelimiterAndLocationInfo=function(e,t,n){e=e.trim(),t=t?.trim();const i=[],o=Array.from(new Set([n?.delimiter,...s])).filter(e=>null!=e);for(const n of o){const r=g(e,n).length,o=g(t,n).length??r;r>1&&i.push({weight:Math.min(r,o),delimiter:n})}const l=i.sort(({weight:e},{weight:t})=>t-e).map(({delimiter:e})=>e);for(const t of l){const i=d(e,t).names,o=r.inferLocationInfo(i,n?.longitudeField,n?.latitudeField);if(o.longitudeFieldName&&o.latitudeFieldName)return{delimiter:t,locationInfo:o}}return{delimiter:l[0],locationInfo:null}},e.inferFieldType=m,e.inferFields=function(e,t,n,r,o){const l=[],s=f(e,n,t),u=[];for(const e of s){if(10===u.length)break;u.push(e)}for(let e=0;e<n.length;e++){const t=n[e],s=r[e];if(t===o.longitudeFieldName||t===o.latitudeFieldName)l.push({name:t,type:"esriFieldTypeDouble",alias:s});else{let e;switch(m(u.map(e=>e[t]))){case"integer":e="esriFieldTypeInteger";break;case"double":e="esriFieldTypeDouble";break;case"date":e="esriFieldTypeDate";break;default:e="esriFieldTypeString"}l.push({name:t,type:e,alias:s,length:i.getFieldDefaultLength(e)})}}return l},e.parseNumber=N,e.parseRows=f,e.readRowParts=a,e.readRows=c,e.severSlicedString=function(e){return JSON.parse(JSON.stringify(e))},e.splitSingleRow=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});