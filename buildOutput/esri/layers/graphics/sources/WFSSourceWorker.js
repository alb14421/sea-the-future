// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/asyncUtils":function(){define(["exports","../chunks/tslib.es6","./Accessor","./maybe","./promiseUtils","./accessorSupport/decorators/property","./accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,a){"use strict";function o(e){return{ok:!0,value:e}}function l(e){return{ok:!1,error:e}}function u(e){return null!=e&&!0===e.ok?e.value:null}function c(e){return null!=e&&!1===e.ok?e.error:null}let d=class extends r{get value(){return u(this._result)}get error(){return c(this._result)}get finished(){return null!=this._result}constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=s.abortMaybe(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(e=>{this._result=o(e),this._cleanup()},e=>{this._result=l(e),this._cleanup()}),this._abortHandle=i.onAbort(t,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=s.removeMaybe(this._abortHandle),this._abortController=null}};t.__decorate([n.property()],d.prototype,"value",null),t.__decorate([n.property()],d.prototype,"error",null),t.__decorate([n.property()],d.prototype,"finished",null),t.__decorate([n.property()],d.prototype,"promise",void 0),t.__decorate([n.property()],d.prototype,"_result",void 0),d=t.__decorate([a.subclass("esri.core.asyncUtils.ReactiveTask")],d),e.assertResult=function(e){if(!0===e.ok)return e.value;throw e.error},e.createTask=function(e,t){return new d(e,t)},e.forEach=function(e,t,r){return i.eachAlways(e.map((e,s)=>t.apply(r,[e,s])))},e.makeResultError=l,e.makeResultOk=o,e.map=async function(e,t,r){return(await i.eachAlways(e.map((e,s)=>t.apply(r,[e,s])))).map(e=>e.value)},e.result=async function(e){if(null==e)return{ok:!1,error:new Error("no promise provided")};try{return o(await e)}catch(e){return l(e)}},e.resultError=c,e.resultOrAbort=async function(e){try{return o(await e)}catch(e){return i.throwIfAbortError(e),l(e)}},e.resultValue=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/featureConversionUtils":function(){define(["exports","../../core/Error","../../core/Logger","../../core/maybe","../../geometry/support/aaBoundingBox","../../geometry/support/aaBoundingRect","../../geometry/support/jsonUtils","./OptimizedFeature","./OptimizedFeatureSet","./OptimizedGeometry","./data/createFeatureId"],function(e,t,r,s,i,n,a,o,l,u,c){"use strict";function d(e,t){return e?t?4:3:t?3:2}const h=()=>r.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},f=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n},m=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[s+2]},y=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[s+3]},g=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[s+2],e[r+3]=t[s+3]};function _(e,t,r,s){if(e){if(r)return t&&s?g:m;if(t&&s)return y}else if(t&&s)return m;return f}function b({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function S({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function x({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function v({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function T({scale:e,translate:t},r,s){return r*e[s]+t[s]}function M(e){const t=e.coords;return{x:t[0],y:t[1]}}function F(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function I(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function w(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function R(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function E(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function A(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function P(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function O(e,t){return e&&t?P:e?w:t?E:F}function N(e,t,r,s,i){const n=O(r,s);for(const r of t){const t=null!=r.geometry?n(new u,r.geometry):null;e.push(new o.OptimizedFeature(t,r.attributes,null,c.createFeatureId(r,i)))}return e}function C(e,t,r=O(null!=t.z,null!=t.m)){return r(e,t)}function z(e,t,r,s){for(const{geometry:i,attributes:n}of t)e.push({attributes:n,geometry:null!=i?B(i,r,s):null});return e}function B(e,t,r){if(null==e)return null;const s=d(t,r),i=[];for(let t=0;t<e.coords.length;t+=s){const r=[];for(let i=0;i<s;i++)r.push(e.coords[t+i]);i.push(r)}return t?r?{points:i,hasZ:t,hasM:r}:{points:i,hasZ:t}:r?{points:i,hasM:r}:{points:i}}function k(e,t,r,s,i){const n=d(r,s);for(const r of t){const t=null!=r.geometry?L(new u,r.geometry,n):null;e.push(new o.OptimizedFeature(t,r.attributes,null,c.createFeatureId(r,i)))}return e}function L(e,t,r=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const s=e.coords;let i=0;for(const e of t.points)for(let t=0;t<r;t++)s[i++]=e[t];return e}function U(e,t,r){if(!e)return null;const s=d(t,r),{coords:i,lengths:n}=e,a=[];let o=0;for(const e of n){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(i[o++]);t.push(e)}a.push(t)}return t?r?{paths:a,hasZ:t,hasM:r}:{paths:a,hasZ:t}:r?{paths:a,hasM:r}:{paths:a}}function j(e,t,r,s,i){const n=d(r,s);for(const r of t){const t=null!=r.geometry?D(new u,r.geometry,n):null,s=null!=r.centroid?C(new u,r.centroid):null;e.push(new o.OptimizedFeature(t,r.attributes,s,c.createFeatureId(r,i)))}return e}function D(e,t,r=d(t.hasZ,t.hasM)){const{lengths:s,coords:i}=e;let n=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)i[n++]=t[e];s.push(e.length)}return e}function G(e,t,r){if(!e)return null;const s=d(t,r),{coords:i,lengths:n}=e,a=[];let o=0;for(const e of n){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(i[o++]);t.push(e)}a.push(t)}return t?r?{rings:a,hasZ:t,hasM:r}:{rings:a,hasZ:t}:r?{rings:a,hasM:r}:{rings:a}}function q(e,t,r=t.hasZ,s=t.hasM){return V(e,t.rings,r,s)}function V(e,t,r,s){const i=d(r,s),{lengths:n,coords:a}=e;let o=0;re(e);for(const e of t){for(const t of e)for(let e=0;e<i;e++)a[o++]=t[e];n.push(e.length)}return e}const Q=[],Z=[];function Y(e,r,s,i,n,a){if(se(e),!s){for(const t of r){const r=c.createFeatureId(t,a);e.push(new o.OptimizedFeature(null,t.attributes,null,r))}return e}switch(s){case"esriGeometryPoint":return N(e,r,i,n,a);case"esriGeometryMultipoint":return k(e,r,i,n,a);case"esriGeometryPolyline":return j(e,r,i,n,a);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,r,s,i){for(const n of t){const t=null!=n.geometry?q(new u,n.geometry,r,s):null,a=c.createFeatureId(n,i);null!=n.centroid?e.push(new o.OptimizedFeature(t,n.attributes,F(new u,n.centroid),a)):e.push(new o.OptimizedFeature(t,n.attributes,null,a))}return e}(e,r,i,n,a);default:h().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${s}'`)),se(e)}return e}function $(e,r,s,i){const n=e&&("coords"in e?e:e.geometry);if(null==n)return null;switch(r){case"esriGeometryPoint":{let e=M;return s&&i?e=A:s?e=I:i&&(e=R),e(n)}case"esriGeometryMultipoint":return B(n,s,i);case"esriGeometryPolyline":return U(n,s,i);case"esriGeometryPolygon":return G(n,s,i);default:return h().error("convertToGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${r}'`)),null}}function W(e,r,s,i,n){if(se(e),null==s)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,r);switch(s){case"esriGeometryPoint":return function(e,t,r,s){let i=M;r&&s?i=A:r?i=I:s&&(i=R);for(const r of t){const{geometry:t,attributes:s}=r,n=null!=t?i(t):null;e.push({attributes:s,geometry:n})}return e}(e,r,i,n);case"esriGeometryMultipoint":return z(e,r,i,n);case"esriGeometryPolyline":return function(e,t,r,s){for(const{geometry:i,attributes:n}of t)e.push({attributes:n,geometry:null!=i?U(i,r,s):null});return e}(e,r,i,n);case"esriGeometryPolygon":return function(e,t,r,s){for(const{geometry:i,attributes:n,centroid:a}of t){const t=null!=i?G(i,r,s):null;if(null!=a){const r=M(a);e.push({attributes:n,centroid:r,geometry:t})}else e.push({attributes:n,geometry:t})}return e}(e,r,i,n);default:h().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${s}'`))}return e}function X(e,t,r,s,i,n,a=r,o=s){if(re(e),!t?.coords.length)return null;const l=p[i],{coords:u,lengths:c}=t,h=d(r,s),f=d(r&&a,s&&o),m=_(r,s,a,o);if(!c.length)return m(e.coords,u,0,0,b(n,u[0]),S(n,u[1])),re(e,h,0),e;let y,g,x,v,T=0,M=0,F=M;for(const t of c){if(t<l)continue;let r=0;M=F,x=y=b(n,u[T]),v=g=S(n,u[T+1]),m(e.coords,u,M,T,x,v),r++,T+=h,M+=f;for(let s=1;s<t;s++,T+=h)x=b(n,u[T]),v=S(n,u[T+1]),x===y&&v===g||(m(e.coords,u,M,T,x-y,v-g),M+=f,r++,y=x,g=v);r>=l&&(e.lengths.push(r),F=M)}return se(e.coords,F),e.coords.length?e:null}function H(e,t,r,s){const i=e[t],n=e[t+1],a=e[r],o=e[r+1],l=e[s],u=e[s+1];let c=a,d=o,h=l-c,p=u-d;if(0!==h||0!==p){const e=((i-c)*h+(n-d)*p)/(h*h+p*p);e>1?(c=l,d=u):e>0&&(c+=h*e,d+=p*e)}return h=i-c,p=n-d,h*h+p*p}function J(e,t,r,s,i,n,a){let o,l=s,u=0;for(let e=n+r;e<a;e+=r)o=H(t,e,n,a),o>l&&(u=e,l=o);l>s&&(u-n>r&&J(e,t,r,s,i,n,u),i(e,t,e.length,u,t[u],t[u+1]),a-u>r&&J(e,t,r,s,i,u,a))}function K(e,t,r,i,n){const{coords:a,lengths:o}=t,l=d(r,i);if(!a.length)return e!==t&&re(e),e;s.assertIsSome(n);const{originPosition:u,scale:c,translate:h}=n,p=ie;p.originPosition=u;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!o.length){for(let t=0;t<l;++t)e.coords[t]=T(p,a[t],t);return e!==t&&re(e,l,0),e}let y=0;for(let t=0;t<o.length;t++){const r=o[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[y+t]=T(p,a[y+t],t);let s=e.coords[y],i=e.coords[y+1];y+=l;for(let t=1;t<r;t++,y+=l){s+=a[y]*f[0],i+=a[y+1]*f[1],e.coords[y]=s,e.coords[y+1]=i;for(let t=2;t<l;++t)e.coords[y+t]=T(p,a[y+t],t)}}return e!==t&&re(e,a.length,o.length),e}function ee(e,t,r,s){let i=0,n=e[s*t],a=e[s*(t+1)];for(let o=1;o<r;o++){const r=n+e[s*(t+o)],l=a+e[s*(t+o)+1],u=(r-n)*(l+a);n=r,a=l,i+=u}return.5*i}function te(e,t,r,s){return 0===e*s-r*t&&e*r+t*s>0}function re(e,t=0,r=0){se(e.lengths,r),se(e.coords,t)}function se(e,t=0){e.length!==t&&(e.length=t)}const ie={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};e.convertFromFeature=function(e,t,r,s,i){Q[0]=e;const[n]=Y(Z,Q,t,r,s,i);return se(Q),se(Z),n},e.convertFromFeatureSet=function(e,t){const r=new l,{hasM:s,hasZ:i,features:n,spatialReference:a,geometryType:o,exceededTransferLimit:u,transform:c,fields:d}=e;return d&&(r.fields=d),r.geometryType=o??null,r.spatialReference=a??null,n&&Y(r.features,n,o,i,s,t),u&&(r.exceededTransferLimit=u),s&&(r.hasM=s),i&&(r.hasZ=i),c&&(r.transform=c),r},e.convertFromFeatures=Y,e.convertFromGeometry=function(e,r,s){if(null==e)return null;const i=new u;return"hasZ"in e&&null==r&&(r=e.hasZ),"hasM"in e&&null==s&&(s=e.hasM),a.isPoint(e)?O(null!=r?r:null!=e.z,null!=s?s:null!=e.m)(i,e):a.isPolygon(e)?q(i,e,r,s):a.isPolyline(e)?D(i,e,d(r,s)):a.isMultipoint(e)?L(i,e,d(r,s)):void h().error("convertFromGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${e}'`))},e.convertFromMultipoint=L,e.convertFromMultipointFeatures=k,e.convertFromNestedArray=V,e.convertFromPoint=C,e.convertFromPointFeatures=N,e.convertFromPolygon=q,e.convertFromPolyline=D,e.convertFromPolylineFeatures=j,e.convertToFeature=function(e,t,r,s){Z[0]=e,W(Q,Z,t,r,s);const i=Q[0];return se(Q),se(Z),i},e.convertToFeatureSet=function(e){const{spatialReference:t,transform:r,fields:s,hasM:i,hasZ:n,features:a,geometryType:o,exceededTransferLimit:l,queryGeometry:u,queryGeometryType:c}=e,d={features:W([],a,o,n,i),fields:s,geometryType:o,spatialReference:t,queryGeometry:$(u,c,!1,!1)};return r&&(d.transform=r),l&&(d.exceededTransferLimit=l),i&&(d.hasM=i),n&&(d.hasZ=n),d},e.convertToFeatures=W,e.convertToGeometry=$,e.convertToMultipoint=B,e.convertToMultipointFeatures=z,e.convertToPoint=function(e,t,r){return e?t?r?A(e):I(e):r?R(e):M(e):null},e.convertToPolygon=G,e.convertToPolyline=U,e.generalizeOptimizedGeometry=function(e,t,r,s,i,n,a=r,o=s){if(re(e),!t?.coords.length)return null;const l=p[i],{coords:u,lengths:c}=t,h=d(r,s),f=d(r&&a,s&&o),m=_(r,s,a,o);if(!c.length)return m(e.coords,u,0,0,u[0],u[1]),re(e,h,0),e;let y=0;const g=n*n;for(const t of c){if(t<l){y+=t*h;continue}const r=e.coords.length/f,s=y,i=y+(t-1)*h;m(e.coords,u,e.coords.length,s,u[s],u[s+1]),J(e.coords,u,h,g,m,s,i),m(e.coords,u,e.coords.length,i,u[i],u[i+1]);const n=e.coords.length/f-r;n>=l?e.lengths.push(n):se(e.coords,r*f),y+=t*h}return e.coords.length?e:null},e.getBoundsOptimizedGeometry=function(e,t,r,s){if(!t?.coords?.length)return null;const a=d(r,s);let o=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=a){const r=e[t],s=e[t+1];o=Math.min(o,r),u=Math.max(u,r),l=Math.min(l,s),c=Math.max(c,s)}}return i.is(e)?i.fromRectValues(e,o,l,u,c):n.fromValues(o,l,u,c,e),e},e.getQuantizedArea=function(e,t){const{coords:r,lengths:s}=e;let i=0,n=0;for(let e=0;e<s.length;e++){const a=s[e];n+=ee(r,i,a,t),i+=a}return Math.abs(n)},e.getQuantizedBoundsOptimizedGeometry=function(e,t,r,s){const i=d(r,s),{lengths:n,coords:a}=t;let o=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,h=0;for(const e of n){let t=a[h],r=a[h+1];o=Math.min(t,o),l=Math.min(r,l),u=Math.max(t,u),c=Math.max(r,c),h+=i;for(let s=1;s<e;s++,h+=i){const e=a[h],s=a[h+1];t+=e,r+=s,e<0&&(o=Math.min(o,t)),e>0&&(u=Math.max(u,t)),s<0?l=Math.min(l,r):s>0&&(c=Math.max(c,r))}}return e[0]=o,e[1]=l,e[2]=u,e[3]=c,e},e.getSignedQuantizedRingArea=ee,e.quantizeForDisplay=function(e,t,r,s,i){const n=d(s,i);if(!e.lengths.length){if(e.coords.length<2)return null;const[r,s]=e.coords,i=x(t,r),n=v(t,s);return new u([],[i,n])}const a=new u([],[0,0]),o=p[r],l="esriGeometryPolygon"===r||"esriGeometryPolyline"===r;let c=0,h=0;for(let r=0;r<e.lengths.length;r++){const s=e.lengths[r],i=h;let u=x(t,e.coords[n*c]),d=v(t,e.coords[n*c+1]);a.coords[h++]=u,a.coords[h++]=d;let p=0,f=0,m=1;for(let r=1;r<s;r++){const s=x(t,e.coords[n*(r+c)]),i=v(t,e.coords[n*(r+c)+1]);if(s!==u||i!==d){const e=s-u,t=i-d;l&&te(p,f,e,t)?(a.coords[h-2]+=e,a.coords[h-1]+=t,u+=e,d+=t):(a.coords[h++]=s,a.coords[h++]=i,u=s,d=i,p=e,f=t,m+=1)}}m<o?h=i:a.lengths.push(m),c+=s}return 0===a.lengths.length?null:a},e.quantizeOptimizedFeatureSet=function(e,t){const{geometryType:r,features:s,hasM:i,hasZ:n}=t;if(!e)return t;for(let t=0;t<s.length;t++){const a=s[t],o=a.weakClone();o.geometry=new u,X(o.geometry,a.geometry,i,n,r,e),a.centroid&&(o.centroid=new u,X(o.centroid,a.centroid,i,n,"esriGeometryPoint",e)),s[t]=o}return t.transform=e,t},e.quantizeOptimizedGeometry=X,e.quantizeX=b,e.quantizeY=S,e.removeCollinearVertices=function(e,t,r,s,i){if(!t?.coords?.length)return null;const n=p[r],{coords:a,lengths:o}=t,l=_(s,i,s,i),u=d(s,i);let c=0,h=0,f=0,m=0;for(const t of o){h=m,l(e.coords,a,h,c,a[c],a[c+1]),c+=u;let r=a[c],s=a[c+1],i=r,o=s,d=s/r;h+=u,l(e.coords,a,h,c,i,o),c+=u;for(let n=2;n<t;n++){r=a[c],s=a[c+1];const t=s/r,n=d===t||!isFinite(d)&&!isFinite(t),p=n&&isFinite(t)?d>=0&&t>=0||d<=0&&t<=0:o>=0&&s>=0||o<=0&&s<=0;n&&p?(i+=r,o+=s):(i=r,o=s,h+=u),l(e.coords,a,h,c,i,o),c+=u,d=t}h+=u;const p=(h-m)/u;p>=n&&(e.lengths[f]=p,m=h,f++)}return e.coords.length>m&&(e.coords.length=m),e.lengths.length>f&&(e.lengths.length=f),e.coords.length&&e.lengths.length?e:null},e.removeZMValues=function(e,t,r,s,i,n){if(re(e),e.lengths.push(...t.lengths),r===i&&s===n)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const a=d(r,s),o=_(r,s,i,n),l=t.coords;for(let t=0;t<l.length;t+=a)o(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e},e.unquantizeOptimizedFeatureSet=function(e){const{transform:t,features:r,hasM:s,hasZ:i}=e;if(!t)return e;for(const e of r)null!=e.geometry&&K(e.geometry,e.geometry,s,i,t),null!=e.centroid&&K(e.centroid,e.centroid,s,i,t);return e.transform=null,e},e.unquantizeOptimizedGeometry=K,e.unquantizeValue=T,e.unquantizeX=function(e,t){return T(e,t,0)},e.unquantizeY=function(e,t){return T(e,-t,1)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../Extent","./aaBoundingRect","./DoubleArray"],function(e,t,r,s){"use strict";function i(e=m){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function n(e,t,r,s,n,a,o=i()){return o[0]=e,o[1]=t,o[2]=r,o[3]=s,o[4]=n,o[5]=a,o}function a(e,t,r,s=i()){return h(s,f),o(s,e,t,r),s}function o(e,t,r=0,s=t.length/3){let i=e[0],n=e[1],a=e[2],o=e[3],l=e[4],u=e[5];for(let e=0;e<s;e++)i=Math.min(i,t[r+3*e]),n=Math.min(n,t[r+3*e+1]),a=Math.min(a,t[r+3*e+2]),o=Math.max(o,t[r+3*e]),l=Math.max(l,t[r+3*e+1]),u=Math.max(u,t[r+3*e+2]);e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=l,e[5]=u}function l(e){return e[0]>=e[3]?0:e[3]-e[0]}function u(e){return e[1]>=e[4]?0:e[4]-e[1]}function c(e){return e[2]>=e[5]?0:e[5]-e[2]}function d(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function h(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function p(e){return 6===e.length}const f=[1/0,1/0,1/0,-1/0,-1/0,-1/0],m=[0,0,0,0,0,0],y=i();e.allFinite=function(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0},e.center=function(e,t=[0,0,0]){return t[0]=e[0]+l(e)/2,t[1]=e[1]+u(e)/2,t[2]=e[2]+c(e)/2,t},e.contains=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]},e.containsPoint=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]},e.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[2]>=e[2]-r&&t[0]<=e[3]+r&&t[1]<=e[4]+r&&t[2]<=e[5]+r},e.create=i,e.depth=u,e.diameter=function(e){const t=l(e),r=c(e),s=u(e);return Math.sqrt(t*t+r*r+s*s)},e.empty=function(e){return e?h(e,f):i(f)},e.equals=function(e,t,r){if(null==e||null==t)return e===t;if(!p(e)||!p(t))return!1;if(r){for(let s=0;s<e.length;s++)if(!r(e[s],t[s]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},e.expandWithAABB=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])},e.expandWithBuffer=o,e.expandWithNestedArray=function(e,t,r){const s=t.length;let i=e[0],n=e[1],a=e[2],o=e[3],l=e[4],u=e[5];if(r)for(let e=0;e<s;e++){const r=t[e];i=Math.min(i,r[0]),n=Math.min(n,r[1]),a=Math.min(a,r[2]),o=Math.max(o,r[0]),l=Math.max(l,r[1]),u=Math.max(u,r[2])}else for(let e=0;e<s;e++){const r=t[e];i=Math.min(i,r[0]),n=Math.min(n,r[1]),o=Math.max(o,r[0]),l=Math.max(l,r[1])}e[0]=i,e[1]=n,e[2]=a,e[3]=o,e[4]=l,e[5]=u},e.expandWithOffset=function(e,t,r,s){e[0]=Math.min(e[0],e[0]+t),e[3]=Math.max(e[3],e[3]+t),e[1]=Math.min(e[1],e[1]+r),e[4]=Math.max(e[4],e[4]+r),e[2]=Math.min(e[2],e[2]+s),e[5]=Math.max(e[5],e[5]+s)},e.expandWithRect=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])},e.expandWithVec3=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])},e.fromBuffer=function(e,t=i()){return a(e,0,e.length/3,t)},e.fromExtent=function(e,t=i()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.hasZ?e.zmin:-1/0,t[3]=e.xmax,t[4]=e.ymax,t[5]=e.hasZ?e.zmax:1/0,t},e.fromMinMax=function(e,t,r=i()){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},e.fromRect=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e},e.fromRectValues=function(e,t,r,s,i){return e[0]=t,e[1]=r,e[2]=Number.NEGATIVE_INFINITY,e[3]=s,e[4]=i,e[5]=Number.POSITIVE_INFINITY,e},e.fromSubBuffer=a,e.fromValues=n,e.getMax=function(e,t){return t[0]=e[3],t[1]=e[4],t[2]=e[5],t},e.getMin=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.height=c,e.intersects=d,e.intersectsClippingArea=function(e,t){return null==t||d(e,t)},e.intersectsSegment=function(e,t,r){let s=0,i=1;for(let n=0;n<3;++n){const a=e[n],o=e[n+3],l=t[n],u=r[n],c=u<l,d=c?u:l,h=c?l:u,p=Math.max(a,d),f=Math.min(o,h);if(p>f)return!1;if(h===d)break;const m=h-d,y=(p-d)/m,g=(f-d)/m;if(s=Math.max(s,c?1-g:y),i=Math.min(i,c?1-y:g),s>i)return!1}return!0},e.is=p,e.isPoint=function(e){return 0===l(e)&&0===u(e)&&0===c(e)},e.maximumDimension=function(e){return Math.max(l(e),c(e),u(e))},e.negativeInfinity=f,e.offset=function(e,t,r,s,i=e){return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+s,i[3]=e[3]+t,i[4]=e[4]+r,i[5]=e[5]+s,i},e.positiveInfinity=[-1/0,-1/0,-1/0,1/0,1/0,1/0],e.scale=function(e,t,r=e){const s=e[0]+l(e)/2,i=e[1]+u(e)/2,n=e[2]+c(e)/2;return r[0]=s+(e[0]-s)*t,r[1]=i+(e[1]-i)*t,r[2]=n+(e[2]-n)*t,r[3]=s+(e[3]-s)*t,r[4]=i+(e[4]-i)*t,r[5]=n+(e[5]-n)*t,r},e.set=h,e.setMax=function(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e},e.setMin=function(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r},e.size=function(e,t=[0,0,0]){return t[0]=l(e),t[1]=u(e),t[2]=c(e),t},e.toCorners=function(e,t=s.newDoubleArray(24)){const[r,i,n,a,o,l]=e;return t[0]=r,t[1]=i,t[2]=n,t[3]=r,t[4]=i,t[5]=l,t[6]=r,t[7]=o,t[8]=n,t[9]=r,t[10]=o,t[11]=l,t[12]=a,t[13]=i,t[14]=n,t[15]=a,t[16]=i,t[17]=l,t[18]=a,t[19]=o,t[20]=n,t[21]=a,t[22]=o,t[23]=l,t},e.toExtent=function(e,r){const s=isFinite(e[2])||isFinite(e[5]);return new t(s?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:r}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:r})},e.toRect=function(e,t){return t||(t=r.create()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t},e.width=l,e.wrap=function(e,t,r,s,i,a){return n(e,t,r,s,i,a,y)},e.zero=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(e,t){"use strict";e.copyInto=function(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e},e.doubleArrayFrom=function(e){return(t.isTypedArray(e)?e.byteLength/8:e.length)<=t.nativeArrayMaxSize?Array.from(e):new Float64Array(e)},e.doubleSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},e.ensurePackedArray=function(e){return[...e]},e.newDoubleArray=function(e,r=!1){return e<=t.nativeArrayMaxSize?r?new Array(e).fill(0):new Array(e):new Float64Array(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeature":function(){define(["exports","../../core/memoryEstimations","./centroid","./OptimizedGeometry"],function(e,t,r,s){"use strict";class i{constructor(e=null,t={},r,s,i=0){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=s,this.displayId=i}static fromJSON(e){const t=e.geometry?s.fromJSON(e.geometry):null,r=e.centroid?s.fromJSON(e.centroid):null,n=e.objectId;return new i(t,e.attributes,r,n)}weakClone(){const e=new i(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),t=new i(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t}ensureCentroid(e){return this.centroid??=r.getCentroidOptimizedGeometry(new s,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+t.estimateAttributesMemory(this.attributes)+(this.geometry?.usedMemory??0)}}e.OptimizedFeature=i,e.OptimizedFeatureWithGeometry=class extends i{},e.hasGeometry=function(e){return!!e.geometry?.coords?.length},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,s,i,n,a){const o=t(n,a);let l=s,u=s+o,c=0,d=0,h=0,p=0,f=0;for(let t=0,s=i-1;t<s;t++,l+=o,u+=o){const t=r[l],s=r[l+1],i=r[l+2],a=r[u],o=r[u+1],m=r[u+2];let y=t*o-a*s;p+=y,c+=(t+a)*y,d+=(s+o)*y,n&&(y=t*m-a*i,h+=(i+m)*y,f+=y),t<e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),s<e[2]&&(e[2]=s),s>e[3]&&(e[3]=s),n&&(i<e[4]&&(e[4]=i),i>e[5]&&(e[5]=i))}if(p>0&&(p*=-1),f>0&&(f*=-1),!p)return null;const m=[c,d,.5*p];return n&&(m[3]=h,m[4]=.5*f),m}function s(e,r,s,l,u){const c=t(l,u);let d=r,h=r+c,p=0,f=0,m=0,y=0;for(let t=0,r=s-1;t<r;t++,d+=c,h+=c){const t=e[d],r=e[d+1],s=e[d+2],u=e[h],c=e[h+1],g=e[h+2],_=l?n(t,r,s,u,c,g):i(t,r,u,c);if(_)if(p+=_,l){const e=o(t,r,s,u,c,g);f+=_*e[0],m+=_*e[1],y+=_*e[2]}else{const e=a(t,r,u,c);f+=_*e[0],m+=_*e[1]}}return p>0?l?[f/p,m/p,y/p]:[f/p,m/p]:s>0?l?[e[r],e[r+1],e[r+2]]:[e[r],e[r+1]]:null}function i(e,t,r,s){const i=r-e,n=s-t;return Math.sqrt(i*i+n*n)}function n(e,t,r,s,i,n){const a=s-e,o=i-t,l=n-r;return Math.sqrt(a*a+o*o+l*l)}function a(e,t,r,s){return[e+.5*(r-e),t+.5*(s-t)]}function o(e,t,r,s,i,n){return[e+.5*(s-e),t+.5*(i-t),r+.5*(n-r)]}e.getCentroidOptimizedGeometry=function(e,i,n,a){if(!i?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const o=e.coords,l=[],u=n?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:d}=i,h=t(n,a);let p=0;for(const e of c){const t=r(u,d,p,e,n,a);t&&l.push(t),p+=e*h}if(l.sort((e,t)=>{let r=e[2]-t[2];return 0===r&&n&&(r=e[4]-t[4]),r}),l.length){let e=6*l[0][2];o[0]=l[0][0]/e,o[1]=l[0][1]/e,n&&(e=6*l[0][4],o[2]=0!==e?l[0][3]/e:0),(o[0]<u[0]||o[0]>u[1]||o[1]<u[2]||o[1]>u[3]||n&&(o[2]<u[4]||o[2]>u[5]))&&(o.length=0)}if(!o.length){const e=i.lengths[0]?s(d,0,c[0],n,a):null;if(!e)return null;o[0]=e[0],o[1]=e[1],n&&e.length>2&&(o[2]=e[2])}return e},e.lineCentroid=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedGeometry":function(){define(["../../core/memoryEstimations"],function(e){"use strict";class t{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new t(e.lengths,e.coords)}static fromRect(e){const[r,s,i,n]=e,a=i-r,o=n-s;return new t([5],[r,s,a,0,0,o,-a,0,0,-o])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,t)=>e+t)}get usedMemory(){return 64+e.estimateNumberArrayMemory(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];if(s<3)continue;let i=this.coords[2*t],n=this.coords[2*t+1];for(let r=1;r<s;r+=1){const s=this.coords[2*(r+t)],a=this.coords[2*(r+t)+1];e+=-.5*(s-i)*(a+n),i=s,n=a}t+=s}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let r=0;r<s;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=s}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let s=0;for(const e of r){for(let r=1;r<e;r++)t[2*(s+r)]+=t[2*(s+r)-2],t[2*(s+r)+1]+=t[2*(s+r)-1];s+=e}return e}clone(e){if(0===this.lengths.length)return new t([],[this.coords[0],this.coords[1]]);const r=2*(0===this.lengths.length?1:this.lengths.reduce((e,t)=>e+t)),s=this.coords.slice(0,r);return e?(e.set(s),new t(this.lengths,e)):new t(Array.from(this.lengths),Array.from(s))}}return t})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(function(){"use strict";class e{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new e;return t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}return e})},"esri/layers/graphics/data/createFeatureId":function(){define(["exports"],function(e){"use strict";e.createFeatureId=function(e,t){switch(t.type){case"object-id":case"unique-id-simple":return e.attributes[t.fieldName];case"unique-id-composite":{const r=[];for(const s of t.fieldNames)r.push(e.attributes[s]??null);return JSON.stringify(r)}}},e.createFeatureIdFromLayer=function(e,t){if("uniqueIdFields"in t&&t.uniqueIdFields?.length){if(1===t.uniqueIdFields.length)return e.attributes?.[t.uniqueIdFields[0]];const r=t.uniqueIdFields.map(t=>e.attributes?.[t]);return JSON.stringify(r)}return"objectIdField"in t&&t.objectIdField?e.attributes?.[t.objectIdField]:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/executeQueryForSnapping":function(){define(["exports","../../../core/lang","../../../core/promiseUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","./projectionSupport","./QueryEngine","./QueryEngineResult","./queryUtils","./queryValidationUtils","./spatialQuerySupport"],function(e,t,r,s,i,n,a,o,l,u,c,d){"use strict";e.executeQueryForSnapping=async function(e,h,p){const f=r.signalFromSignalOrOptions(p),{point:m,distance:y,returnEdge:g,vertexMode:_}=h;if(!g&&"none"===_)return{candidates:[]};let b=t.clone(h.query);b=await e.schedule(()=>u.normalizeQueryLike(b,e.definitionExpression,e.spatialReference),f),b=await e.reschedule(()=>c.validateQuery(b,{availableFields:e.availableFields,fieldsIndex:e.fieldsIndex,geometryType:e.geometryType,spatialReference:e.spatialReference}),f);const S=!n.equals(m.spatialReference,e.spatialReference);S&&await a.checkProjectionSupport(m.spatialReference,e.spatialReference);const x="number"==typeof y?y:y.x,v="number"==typeof y?y:y.y,T={xmin:m.x-x,xmax:m.x+x,ymin:m.y-v,ymax:m.y+v,spatialReference:m.spatialReference},M=S?a.project(T,e.spatialReference):T;if(!M)return{candidates:[]};const F=(await i.normalizeCentralMeridian(s.fromJSON(m),null,{signal:f}))[0],I=(await i.normalizeCentralMeridian(s.fromJSON(M),null,{signal:f}))[0];if(null==F||null==I)return{candidates:[]};const w=new l.QueryEngineResult(await e.reschedule(()=>e.searchFeatures(o.getQueryBBoxes(I.toJSON())),f),b,e);await e.reschedule(()=>e.executeObjectIdsQuery(w),f),await e.reschedule(()=>e.executeTimeQuery(w),f),await e.reschedule(()=>e.executeAttributesQuery(w),f),await e.reschedule(()=>async function(e,t,r){const{query:s}=t,{spatialRel:i}=s;if(!t?.items?.length||!s.geometry||!i)return;const n=await d.getSpatialQueryOperator(i,s.geometry,e.geometryType,e.hasZ,e.hasM),a=await e.runSpatialFilter(t.items,e=>n(e.geometry),r);t.items=a}(e,w,f),f);const R=F.toJSON(),E=S?a.project(R,e.spatialReference):R,A=S?Math.max(M.xmax-M.xmin,M.ymax-M.ymin)/2:y;return w.createSnappingResponse({...h,point:E,distance:A},b.returnZ,m.spatialReference)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtils":function(){define(["exports","../../config","../../core/Error","../../core/Logger","../Polygon","../Polyline","./normalizeUtilsCommon","./spatialReferenceUtils","./webMercatorUtils","../../rest/geometryService/cut","../../rest/geometryService/simplify"],function(e,t,r,s,i,n,a,o,l,u,c){"use strict";const d=()=>s.getLogger("esri.geometry.support.normalizeUtils");function h(e){return"polygon"===e[0].type}function p(e){return"polyline"===e[0].type}function f(e){const t=[];let r=0,s=0;for(let i=0;i<e.length;i++){const n=e[i];let a=null;for(let e=0;e<n.length;e++)a=n[e],t.push(a),0===e?(r=a[0],s=r):(r=Math.min(r,a[0]),s=Math.max(s,a[0]));a&&t.push([(r+s)/2,0])}return t}function m(e,t){if(!(e instanceof n||e instanceof i)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw d().error(e),new r("internal:geometry",e)}const s=a.getGeometryParts(e),o=[];for(const e of s){const r=[];o.push(r),r.push([e[0][0],e[0][1]]);for(let s=0;s<e.length-1;s++){const i=e[s][0],n=e[s][1],a=e[s+1][0],o=e[s+1][1],l=Math.sqrt((a-i)*(a-i)+(o-n)*(o-n)),u=(o-n)/l,c=(a-i)/l,d=l/t;if(d>1){for(let e=1;e<=d-1;e++){const s=e*t,a=c*s+i,o=u*s+n;r.push([a,o])}const e=(l+Math.floor(d-1)*t)/2,s=c*e+i,a=u*e+n;r.push([s,a])}r.push([a,o])}}return function(e){return"polygon"===e.type}(e)?new i({rings:o,spatialReference:e.spatialReference}):new n({paths:o,spatialReference:e.spatialReference})}function y(e,t,r){if(t){const t=m(e,1e6);e=l.webMercatorToGeographic(t,!0)}return r&&(e=a.updatePolyGeometry(e,r)),e}function g(e,t,r){if(Array.isArray(e)){const s=e[0];if(s>t){const r=a.offsetMagnitude(s,t);e[0]=s+r*(-2*t)}else if(s<r){const t=a.offsetMagnitude(s,r);e[0]=s+t*(-2*r)}}else{const s=e.x;if(s>t){const r=a.offsetMagnitude(s,t);e=e.clone().offset(r*(-2*t),0)}else if(s<r){const t=a.offsetMagnitude(s,r);e=e.clone().offset(t*(-2*r),0)}}return e}e.getClosestDenormalizedXToReference=function(e,t,r){const s=o.getInfo(r);if(null==s)return e;const[i,n]=s.valid,a=2*n;let l=0,u=0;t>n?l=Math.ceil(Math.abs(t-n)/a):t<i&&(l=-Math.ceil(Math.abs(t-i)/a)),e>n?u=Math.ceil(Math.abs(e-n)/a):e<i&&(u=-Math.ceil(Math.abs(e-i)/a));let c=e+(l-u)*a;const d=c-t;return d>n?c-=a:d<i&&(c+=a),c},e.getDenormalizedExtent=function(e){if(!e)return null;const t=e.extent;if(!t)return null;const r=e.spatialReference&&o.getInfo(e.spatialReference);if(!r)return t;const[s,i]=r.valid,n=2*i,{width:a}=t;let l,{xmin:u,xmax:c}=t;if([u,c]=[c,u],"extent"===e.type||0===a||a<=i||a>n||u<s||c>i)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;l=f(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;l=f(e.paths);break;case"multipoint":l=e.points}const d=t.clone();for(let e=0;e<l.length;e++){let t=l[e][0];t<0?(t+=i,c=Math.max(t,c)):(t-=i,u=Math.min(t,u))}return d.xmin=u,d.xmax=c,d.width<a?(d.xmin-=i,d.xmax-=i,d):t},e.normalizeCentralMeridian=async function e(r,s,f){if(!Array.isArray(r))return e([r],s);s&&"string"!=typeof s&&d().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const m="string"==typeof s?s:s?.url??t.geometryServiceUrl;let _,b,S,x,v,T,M,F,I=0;const w=[],R=[];for(const e of r)if(null!=e)if(_||(_=e.spatialReference,b=o.getInfo(_),S=_.isWebMercator,T=S?102100:4326,x=a.cutParams[T].maxX,v=a.cutParams[T].minX,M=a.cutParams[T].plus180Line,F=a.cutParams[T].minus180Line),b)if("mesh"===e.type)R.push(e);else if("point"===e.type)R.push(g(e.clone(),x,v));else if("multipoint"===e.type){const t=e.clone();t.points=t.points.map(e=>g(e,x,v)),R.push(t)}else if("extent"===e.type){const t=e.clone()._normalize(!1,!1,b);R.push(t.rings?new i(t):t)}else if(e.extent){const t=e.extent,r=a.offsetMagnitude(t.xmin,v)*(2*x);let s=0===r?e.clone():a.updatePolyGeometry(e.clone(),r);t.offset(r,0);let{xmin:i,xmax:n}=t;i=Number(i.toFixed(9)),n=Number(n.toFixed(9)),t.intersects(M)&&n!==x?(I=n>I?n:I,s=y(s,S),w.push(s),R.push("cut")):t.intersects(F)&&i!==v?(I=n*(2*x)>I?n*(2*x):I,s=y(s,S,360),w.push(s),R.push("cut")):R.push(s)}else R.push(e.clone());else R.push(e);else R.push(e);let E=a.offsetMagnitude(I,x),A=-90;const P=E,O=new n;for(;E>0;){const e=360*E-180;O.addPath([[e,A],[e,-1*A]]),A*=-1,E--}if(w.length>0&&P>0){const e=function(e,t){let r=-1;for(let s=0;s<t.cutIndexes.length;s++){const i=t.cutIndexes[s],n=t.geometries[s],o=a.getGeometryParts(n);for(let e=0;e<o.length;e++){const t=o[e];t.some(r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const s=t[e][0];r=s>r?s:r}r=Number(r.toFixed(9));const s=-360*a.offsetMagnitude(r,180);for(let r=0;r<t.length;r++){const t=n.getPoint(e,r);n.setPoint(e,r,t.clone().offset(s,0))}return!0}})}if(i===r){if(h(e))for(const t of a.getGeometryParts(n))e[i]=e[i].addRing(t);else if(p(e))for(const t of a.getGeometryParts(n))e[i]=e[i].addPath(t)}else r=i,e[i]=n}return e}(w,await u.cut(m,w,O,f)),t=[],s=[];for(let i=0;i<R.length;i++){const n=R[i];if("cut"!==n)s.push(n);else{const n=e.shift(),a=r[i];null!=a&&"polygon"===a.type&&a.rings&&a.rings.length>1&&n.rings.length>=a.rings.length?(t.push(n),s.push("simplify")):s.push(S?l.geographicToWebMercator(n):n)}}if(!t.length)return s;const i=await c.simplify(m,t,f),n=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?n.push(t):n.push(S?l.geographicToWebMercator(i.shift()):i.shift())}return n}const N=[];for(let e=0;e<R.length;e++){const t=R[e];if("cut"!==t)N.push(t);else{const e=w.shift();N.push(!0===S?l.geographicToWebMercator(e):e)}}return N},e.normalizeMapX=function(e,t){const r=o.getInfo(t);if(r){const[t,s]=r.valid,i=s-t;if(e<t)for(;e<t;)e+=i;if(e>s)for(;e>s;)e-=i}return e},e.straightLineDensify=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsCommon":function(){define(["exports","../Polyline","../SpatialReference","./jsonUtils"],function(e,t,r,s){"use strict";const i={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new t({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator}),minus180Line:new t({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new t({paths:[[[180,-180],[180,180]]],spatialReference:r.WGS84}),minus180Line:new t({paths:[[[-180,-180],[-180,180]]],spatialReference:r.WGS84})}};function n(e){return s.isPolygon(e)?e.rings:e.paths}e.cutParams=i,e.getGeometryParts=n,e.offsetMagnitude=function(e,t){return Math.ceil((e-t)/(2*t))},e.updatePolyGeometry=function(e,t){const r=n(e);for(const e of r)for(const r of e)r[0]+=t;return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/cut":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","../utils"],function(e,t,r,s,i){"use strict";e.cut=async function(e,n,a,o){const l=i.parseUrl(e),u=n[0].spatialReference,c={...o,responseType:"json",query:{...l.query,f:"json",sr:s.srToRESTValue(u),target:JSON.stringify({geometryType:r.getJsonType(n[0]),geometries:n}),cutter:JSON.stringify(a)}},d=await t(l.path+"/cut",c),{cutIndexes:h,geometries:p=[]}=d.data;return{cutIndexes:h,geometries:p.map(e=>{const t=r.fromJSON(e);return t.spatialReference=u,t})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/utils":function(){define(["require","exports","../config","../kernel","../core/lang","../core/urlUtils","../support/apiKeyUtils"],function(e,t,r,s,i,n,a){"use strict";const o=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));function l(e,t){return e?t&&a.supportsApiKey(e)?t:a.getApiKey(e)??s.id?.findCredential(e)?.token:null}t.asValidOptions=function(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}},t.encode=function e(t,r,s){const i={};for(const n in t){if("declaredClass"===n)continue;const a=t[n];if(null!=a&&"function"!=typeof a)if(Array.isArray(a))i[n]=a.map(t=>e(t));else if("object"==typeof a)if(a.toJSON){const e=a.toJSON(s?.[n]);i[n]=r?e:JSON.stringify(e)}else i[n]=r?a:JSON.stringify(a);else i[n]=a}return i},t.findToken=l,t.getToken=async function(t,i,n){const a=l(t,i);if(a)return a;!s.id&&r.request.useIdentity&&await new Promise((t,r)=>e(["../identity/IdentityManager"],e=>t(o(e)),r));const u=await s.id.getCredential(t,n);return u?.token},t.parseUrl=function(e){return"string"==typeof e?n.urlToObject(e):i.clone(e)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/simplify":function(){define(["exports","../../request","../../core/urlUtils","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","./utils"],function(e,t,r,s,i,n){"use strict";e.simplify=async function(e,a,o){const l="string"==typeof e?r.urlToObject(e):e,u=a[0].spatialReference,c=s.getJsonType(a[0]),d={...o,query:{...l.query,f:"json",sr:i.srToRESTValue(u),geometries:JSON.stringify(n.encodeGeometries(a))}},{data:h}=await t(l.path+"/simplify",d);return n.decodeGeometries(h.geometries,c,u)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],function(e,t){"use strict";e.decodeGeometries=function(e,r,s){const i=t.getGeometryType(r);return e.map(e=>{const t=i.fromJSON(e);return t.spatialReference=s,t})},e.encodeGeometries=function(e){return{geometryType:t.getJsonType(e[0]),geometries:e.map(e=>e.toJSON())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define(["exports","../../../core/arrayUtils","../../../core/promiseUtils","../../../geometry/projectionUtils","../../../geometry/geometryAdapters/json","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils"],function(e,t,r,s,i,n,a){"use strict";const o=[0,0];function l(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,o),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,o),[r.xmax,r.ymax]=e(t.xmax,t.ymax,o),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:u(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:u(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:c(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function u(e,t){const r=[];for(const s of e)r.push(c(s,t));return r}function c(e,t){const r=[];for(const s of e){const e=t(s[0],s[1],[0,0]);r.push(e),s.length>2&&e.push(s[2]),s.length>3&&e.push(s[3])}return r}const d=l.bind(null,a.lngLatToXY),h=l.bind(null,a.xyToLngLat),p=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,s,i){if(!e?.length||!t||!s||n.equals(t,s))return e;const a={geometries:e,inSpatialReference:t,outSpatialReference:s,geographicTransformation:i,resolve:r.createResolver()};return this._jobs.push(a),this._timer??=setTimeout(this._process,10),a.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:o,resolve:l,geographicTransformation:u}=e;a.canProject(r,o)?n.isWebMercator(o)?l(t.map(d)):l(t.map(h)):l(s.projectMany(i.jsonAdapter,t,r,o,u,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};e.checkProjectionSupport=async function(e,r){if(!e||!r)return;const i=Array.isArray(e)?e.map(e=>null!=e.geometry?e.geometry.spatialReference:null).filter(t.isSome):[e];await s.initializeProjection(i.map(e=>({source:e,dest:r})))},e.project=function(e,t,r,o){if(!e)return null;if(r||(r=t,t=e.spatialReference),!n.isValid(t)||!n.isValid(r)||n.equals(t,r))return e;if(a.canProject(t,r)){const t=n.isWebMercator(r)?d(e):h(e);return t.spatialReference=r,t}return s.projectMany(i.jsonAdapter,[e],t,r,null,o)[0]},e.projectMany=function(e,t,r,s){return p.push(e,t,r,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(e){"use strict";const t={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,s){const i=new r(e.getPointX(t),e.getPointY(t),s),n=e.hasZ(t),a=e.hasM(t);return n&&(i.z=e.getPointZ(t)),a&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new s(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new i(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new n(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const s=e.hasZ(t),i=e.hasM(t),n=new a(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(s){const r=e.getZExtent(t);n.zmin=r.vmin,n.zmax=r.vmax}if(i){const r=e.getMExtent(t);n.mmin=r.vmin,n.mmax=r.vmax}return n}};class r{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class s{constructor(e,t,r,s){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class i{constructor(e,t,r,s){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class n{constructor(e,t,r,s){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class a{constructor(e,t,r,s,i){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=s,this.spatialReference=i,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}e.jsonAdapter=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define(["exports","../../../core/arrayUtils","../../../core/compilerUtils","../../../core/Error","../../../core/has","../../../core/lang","../../../core/maybe","../../../core/promiseUtils","../../../core/unitUtils","../../../core/support/jsonUtils","../../../geometry/projectionUtils","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../../../geometry/support/boundsUtils","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../featureConversionUtils","./attributeSupport","./geometryUtils","./projectionSupport","./QueryEngineCache","./QueryEngineCapabilities","./QueryEngineResult","./queryUtils","./queryValidationUtils","./spatialQuerySupport","./timeSupport","../../support/FieldsIndex","../../../views/support/Scheduler"],function(e,t,r,s,i,n,a,o,l,u,c,d,h,p,f,m,y,g,_,b,S,x,v,T,M,F,I,w,R){"use strict";function E(e){if(F.canQueryWithRBush(e)){if(f.isExtent(e))return[h.fromValues(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if(f.isPolygon(e))return e.rings.map(e=>h.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1])))}return[p.getBoundsXY(h.create(),e)]}function A(e,t,r,s,i){const n={xmin:e[0],ymin:e[1],xmax:e[3],ymax:e[4],spatialReference:_.cleanFromGeometryEngine(s)};i&&isFinite(e[2])&&isFinite(e[5])&&(n.zmin=e[2],n.zmax=e[5],n.hasZ=!0);const a=b.project(n,t,r);if(a.spatialReference=_.cleanFromGeometryEngine(r),a.xmax-a.xmin===0){const e=l.getMetersPerUnitForSR(a.spatialReference);a.xmin-=e,a.xmax+=e}if(a.ymax-a.ymin===0){const e=l.getMetersPerUnitForSR(a.spatialReference);a.ymin-=e,a.ymax+=e}if(i&&null!=a.zmin&&null!=a.zmax&&a.zmax-a.zmin===0){const e=l.getMetersPerUnitForSR(a.spatialReference);a.zmin-=e,a.zmax+=e}return a}e.Feature=class{constructor(e,t=null,r,s,i){this.attributes=e,this.geometry=r,this.centroid=s,this.filterFlags=i,this.groupId=-1,this.displayId=t}},e.QueryEngine=class{constructor(e){this._changeHandle=null,this.capabilities={query:x.queryCapabilities},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._cache=e.cache??new S.QueryEngineCache,this.timeInfo=e.timeInfo,this.featureIdInfo=e.featureIdInfo,"object-id"===e.featureIdInfo.type&&(this.objectIdField=e.featureIdInfo.fieldName),this._changeHandle=this.featureStore.events.on("changed",()=>this._clearCache()),this.fieldsIndex=u.isSerializable(e.fieldsIndex)?e.fieldsIndex:w.fromJSON(e.fieldsIndex),!e.availableFields||1===e.availableFields.length&&"*"===e.availableFields[0]?this.availableFields=new Set(this.fieldsIndex.fields.map(e=>e.name)):this.availableFields=new Set(e.availableFields.map(e=>this.fieldsIndex.get(e)?.name).filter(e=>null!=e)),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._changeHandle=a.removeMaybe(this._changeHandle),this._frameTask=a.removeMaybe(this._frameTask),this._clearCache(),a.destroyMaybe(this._cache)}get featureAdapter(){return this.featureStore.featureAdapter}_clearCache(){this._cache.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}async executeQuery(e,t){const r=o.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{},r);return await t.createQueryResponse()}catch(t){if(t!==T.queryEngineEmptyResult)throw t;return new v.QueryEngineResult([],e,this).createQueryResponse()}}async executeQueryForCount(e={},t){const r=o.signalFromSignalOrOptions(t);try{return(await this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},r)).createQueryResponseForCount()}catch(e){if(e!==T.queryEngineEmptyResult)throw e;return 0}}async executeQueryForExtent(e,t){const r=o.signalFromSignalOrOptions(t),s=e.outSR;try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),i=t.size;return i?{count:i,extent:await this._getBounds(t.items,t.spatialReference,s||this.spatialReference)}:{count:0,extent:null}}catch(e){if(e===T.queryEngineEmptyResult)return{count:0,extent:null};throw e}}async executeQueryForIds(e,t){return this.executeQueryForIdSet(e,t).then(e=>Array.from(e))}async executeQueryForIdSet(e,t){const r=o.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),s=t.items,i=new Set;return await this.reschedule(()=>{for(const e of s)i.add(t.featureAdapter.getObjectId(e))},r),i}catch(e){if(e===T.queryEngineEmptyResult)return new Set;throw e}}async executeQueryForLatestObservations(e,t){const r=o.signalFromSignalOrOptions(t);if(!this.timeInfo?.trackIdField)throw new s("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const t=await this._executeQuery(e,{},r);return await this.reschedule(()=>this._filterLatest(t),r),await t.createQueryResponse()}catch(t){if(t!==T.queryEngineEmptyResult)throw t;return new v.QueryEngineResult([],e,this).createQueryResponse()}}async executeQueryForOpaqueFeatures(e,t){const r=o.signalFromSignalOrOptions(t);return(await this._executeQuery(e,{},r)).items}async executeAttributeBinsQuery(e,t){const r=o.signalFromSignalOrOptions(t);let s;e=n.clone(e);try{e=await this.schedule(()=>T.normalizeAttributeBinsQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>M.validateAttributeBinsQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r);const t=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r);s=await this.reschedule(()=>this._executeGeometryQuery(e,t,r),r),await this.reschedule(()=>this._executeAggregateIdsQuery(s),r),await this.reschedule(()=>this.executeObjectIdsQuery(s),r),await this.reschedule(()=>this.executeTimeQuery(s),r),await this.reschedule(()=>this.executeAttributesQuery(s),r)}catch(t){if(t!==T.queryEngineEmptyResult)throw t;s=new v.QueryEngineResult([],e,this)}return s.createQueryBinsResponse(e)}async executeQueryForSummaryStatistics(e={},t,r){const s=o.signalFromSignalOrOptions(r),{field:i,normalizationField:n,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:n,valueExpression:a},s)).createSummaryStatisticsResponse(t)}async executeQueryForUniqueValues(e={},t,r){const s=o.signalFromSignalOrOptions(r),{field:i,field2:n,field3:a,valueExpression:l}=t;return(await this._executeQueryForStatistics(e,{field:i,field2:n,field3:a,valueExpression:l},s)).createUniqueValuesResponse(t)}async executeQueryForClassBreaks(e={},t,r){const s=o.signalFromSignalOrOptions(r),{field:i,normalizationField:n,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:n,valueExpression:a},s)).createClassBreaksResponse(t)}async executeQueryForHistogram(e={},t,r){const s=o.signalFromSignalOrOptions(r),{field:i,normalizationField:n,valueExpression:a}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:n,valueExpression:a},s)).createHistogramResponse(t)}async fetchRecomputedExtents(e){const t=o.signalFromSignalOrOptions(e);this._timeExtentPromise||=I.getTimeExtent(this.timeInfo,this.featureStore);const[r,s]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);return o.throwIfAborted(t),{fullExtent:r,timeExtent:s}}async _getBounds(e,t,r){const s=d.set(d.create(),d.negativeInfinity);return await this.featureStore.forEachBounds(e,e=>d.expandWithAABB(s,e)),A(s,t,r,this.spatialReference,this.hasZ)}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(e=>this._getBounds(e,this.spatialReference,this.spatialReference)),this._fullExtentPromise}async schedule(e,t){return this._frameTask?.schedule(e,t)??e(R.noBudget)}async reschedule(e,t){return this._frameTask?.reschedule(e,t)??e(R.noBudget)}async _getAllFeaturesQueryEngineResult(e){return new v.QueryEngineResult(await this._getAllFeatures(),e,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const e=[];this._allFeaturesPromise=(async()=>await this.featureStore.forEach(t=>e.push(t)))().then(()=>r.toConst(e))}const e=this._allFeaturesPromise,t=await e;return e===this._allFeaturesPromise?t.slice():this._getAllFeatures()}async _executeQuery(e,t,r){e=n.clone(e),e=await this.schedule(()=>T.normalizeQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>M.validateQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r),e={...e,...t};const s=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r),i=await this.reschedule(()=>this._executeGeometryQuery(e,s,r),r);return await this.reschedule(()=>this._executeAggregateIdsQuery(i),r),await this.reschedule(()=>this.executeObjectIdsQuery(i),r),await this.reschedule(()=>this.executeTimeQuery(i),r),await this.reschedule(()=>this.executeAttributesQuery(i),r),i}async _executeSceneFilterQuery(e,t){if(null==e.sceneFilter)return null;const{outSR:r,returnGeometry:s,returnCentroid:i}=e,n=this.featureStore.featureSpatialReference,a=e.sceneFilter.geometry,o=null==n||m.equals(n,a.spatialReference)?a:b.project(a,n);if(!o)return null;const l=s||i,u=m.isValid(r)&&!m.equals(this.spatialReference,r)&&l?async e=>this._project(e,r):e=>e,c=this.featureAdapter,d=await this.reschedule(()=>this.searchFeatures(E(o)),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!d.length)return null;const r=new Set;for(const e of d)r.add(c.getObjectId(e));const s=await this.reschedule(()=>this._getAllFeatures(),t);return u(await this.reschedule(async()=>{const i=await F.getSpatialQueryOperator("esriSpatialRelDisjoint",o,this.geometryType,this.hasZ,this.hasM),n=await this.runSpatialFilter(s,e=>!r.has(c.getObjectId(e))||i(c.getGeometry(e)),t);return new v.QueryEngineResult(n,e,this)},t))}if(!d.length)return new v.QueryEngineResult([],e,this);if(this._canExecuteSinglePass(o,e))return u(new v.QueryEngineResult(d,e,this));const h=await F.getSpatialQueryOperator("esriSpatialRelContains",o,this.geometryType,this.hasZ,this.hasM),p=await this.runSpatialFilter(d,e=>h(c.getGeometry(e)),t);return u(new v.QueryEngineResult(p,e,this))}async _executeGeometryQuery(e,r,s){if(null!=r&&0===r.items.length)return r;const{geometry:i,outSR:n,returnGeometry:a,returnCentroid:o}=e,l=r?null:this._getCacheKey(e),u=l?this._cache.get(l):null;if(u)return new v.QueryEngineResult(u,e,this);const c=m.isValid(n)&&!m.equals(this.spatialReference,n),d=a||o,h=async e=>(c&&d&&await this._project(e,n),l&&this._cache.put(l,e.items),e),p=this.featureStore.featureSpatialReference,f=!i||null==p||m.equals(p,i.spatialReference)?i:b.project(i,p);if(!f)return h(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const y=this.featureAdapter;let g=await this.reschedule(()=>this.searchFeatures(E(i)),s);const _=e.spatialRel??"esriSpatialRelIntersects";if("esriSpatialRelDisjoint"===_){if(!g.length)return h(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const t=new Set;for(const e of g)t.add(y.getObjectId(e));const i=null!=r?r.items:await this.reschedule(()=>this._getAllFeatures(),s);return h(await this.reschedule(async()=>{const r=await F.getSpatialQueryOperator(_,f,this.geometryType,this.hasZ,this.hasM),n=await this.runSpatialFilter(i,e=>!t.has(y.getObjectId(e))||r(y.getGeometry(e)),s);return new v.QueryEngineResult(n,e,this)},s))}if(null!=r){const e=new t.PositionHint;g=g.filter(s=>t.indexOf(r.items,s,r.items.length,e)>=0)}if(!g.length){const t=new v.QueryEngineResult([],e,this);return l&&this._cache.put(l,t.items),t}if(this._canExecuteSinglePass(f,e))return h(new v.QueryEngineResult(g,e,this));const S=await F.getSpatialQueryOperator(_,f,this.geometryType,this.hasZ,this.hasM),x=await this.runSpatialFilter(g,e=>S(y.getGeometry(e)),s);return h(new v.QueryEngineResult(x,e,this))}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const r of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach(e=>t.add(e));const r=this.featureAdapter.getObjectId;e.items=e.items.filter(e=>t.has(r(e)))}executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter(e=>t.has(r(e)))}executeTimeQuery(e){if(0===e.items.length)return;const t=I.getTimeOperator(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}executeAttributesQuery(e){if(0===e.items.length)return;const t=g.getWhereClause(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter(e=>t.testFeature(e,this.featureAdapter))}}async runSpatialFilter(e,t,r){if(!t)return e;if(null==this._frameTask)return e.filter(e=>t(e));let s=0;const i=new Array,n=async a=>{for(;s<e.length;){const o=e[s++];t(o)&&(i.push(o),a.madeProgress()),a.done&&await this.reschedule(e=>n(e),r)}};return this.reschedule(e=>n(e),r).then(()=>i)}_filterLatest(e){const{trackIdField:t,startTimeField:r,endTimeField:s}=this.timeInfo,i=s||r,n=new Map,a=this.featureAdapter.getAttribute;for(const r of e.items){const e=a(r,t),s=a(r,i),o=n.get(e);(!o||s>a(o,i))&&n.set(e,r)}e.items=Array.from(n.values())}_getCacheKey(e){const{geometry:t,spatialRel:r,returnGeometry:s,returnCentroid:i,outSR:n,resultType:a,cacheHint:o}=e;if("tile"!==a&&!o)return null;const l=s||i;return m.isValid(n)&&!m.equals(this.spatialReference,n)&&l?JSON.stringify([t,r,n]):JSON.stringify([t,r])}_canExecuteSinglePass(e,t){const{spatialRel:r}=t;return F.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}async _project(e,t){if(!t||m.equals(this.spatialReference,t))return e;const s=this.featureAdapter;let i;try{const e=await this._getFullExtent();i=c.getTransformation(this.spatialReference,t,e)}catch{}const n=await b.projectMany(e.items.map(e=>_.getGeometry(this.geometryType,this.hasZ,this.hasM,s.getGeometry(e))),this.spatialReference,t,i);return e.items=r.toConst(n.map((t,r)=>s.cloneWithGeometry(e.items[r],y.convertFromGeometry(t,this.hasZ,this.hasM)))),e}async searchFeatures(e){const t=new Set;await Promise.all(e.map(e=>this.featureStore.forEachInBounds(e,e=>t.add(e))));const r=Array.from(t.values());return t.clear(),r}async _executeQueryForStatistics(e,t,r){e=n.clone(e);try{e=await this.schedule(()=>T.normalizeQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>M.validateStatisticsQuery(e,t,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r);const s=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r),i=await this.reschedule(()=>this._executeGeometryQuery(e,s,r),r);return await this.reschedule(()=>this._executeAggregateIdsQuery(i),r),await this.reschedule(()=>this.executeObjectIdsQuery(i),r),await this.reschedule(()=>this.executeTimeQuery(i),r),await this.reschedule(()=>this.executeAttributesQuery(i),r),i}catch(t){if(t!==T.queryEngineEmptyResult)throw t;return new v.QueryEngineResult([],e,this)}}get test(){}},e.getQueryBBoxes=E,e.getQueryResultExtent=A,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(e,t,r,s){"use strict";const i=new r.WhereClauseCache(50,500),n="unsupported-query",a=" as ",o=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),l=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),u=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...o,...l]);function c(e,r,s={}){const a=d(r,e);if(!a){const s=i.getError(r,e);throw new t(n,"invalid SQL expression",{expression:r,error:s})}const o=s.expressionName||"expression";if(s.validateStandardized&&!a.isStandardized)throw new t(n,`${o} is not standard`,{expression:r});if(s.validateAggregate&&!a.isAggregate)throw new t(n,`${o} does not contain a valid aggregate function`,{expression:r});return a.fieldNames}function d(e,t){return e?i.get(e,t):null}function h(e){return/\((.*?)\)/.test(e)?e:e.split(a)[0]}function p(e,r,s,i={}){const a=new Map;if(function(e,t,r,s,i){const n=i.includes("*")?[...r,...i.filter(e=>"*"!==e)]:i;for(const i of n)if(t.get(i))f(e,t,r,s,i);else try{const n=c(t,h(i),{validateStandardized:!0});for(const i of n)f(e,t,r,s,i)}catch(t){e.set(i,{type:"expression-error",expression:i,error:t})}}(a,e,r,i.allowedFieldTypes??u,s),a.size){const e=i.expressionName??"expression";throw new t(n,`${e} contains invalid or missing fields`,{errors:Array.from(a.values()),query:i.query})}}function f(e,t,r,i,n){const a=t.get(n);a?r.has(a.name)?"all"!==i&&!1===i?.has(a.type)&&e.set(n,{type:"invalid-type",fieldName:a.name,fieldType:s.kebabDict.fromJSON(a.type),allowedFieldTypes:Array.from(i,e=>s.kebabDict.fromJSON(e))}):e.set(n,{type:"missing-field",fieldName:a.name}):e.set(n,{type:"invalid-field",fieldName:n})}e.allDateAndTimeFieldTypes=l,e.getAliasFromFieldName=function(e){return e.split(a)[1]},e.getExpressionFromFieldName=h,e.getWhereClause=d,e.numericFieldTypes=o,e.validateFields=p,e.validateHaving=function(e,r,s,i,a){if(!s)return!0;const o="having clause",l=c(e,s,{validateAggregate:!0,expressionName:o});p(e,r,l,{expressionName:o,query:a});const u=d(s,e),h=u?.getExpressions().every(t=>{const{aggregateType:r,field:s}=t,n=e.get(s)?.name;return i.some(t=>{const{onStatisticField:s,statisticType:i}=t,a=e.get(s)?.name;return a===n&&i.toLowerCase().trim()===r})});if(!h)throw new t(n,"expressions in having clause should also exist in outStatistics",{having:s});return!0},e.validateWhere=function(e,t,r,s){if(!r)return!0;const i="where clause";return p(e,t,c(e,r,{validateStandardized:!0,expressionName:i}),{expressionName:i,query:s}),!0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],function(e,t,r){"use strict";e.WhereClauseCache=class{constructor(e,r){this._cache=new t.LRUCache(e),this._invalidCache=new t.LRUCache(r)}get(e,t){const s=`${t?.uid}:${e}`,i=this._cache.get(s);if(i)return i;if(null!=this._invalidCache.get(s))return null;try{const i=r.create(e,{fieldsIndex:t});return this._cache.put(s,i),i}catch(e){return this._invalidCache.put(s,e),null}}getError(e,t){const r=`${t?.uid}:${e}`;return this._invalidCache.get(r)??null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/LRUCache":function(){define(["exports","./MemCache"],function(e,t){"use strict";e.LRUCache=class{constructor(e,r){this.removeFunc=r,this._storage=new t.MemCacheStorage,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy(),this._storage=null}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCache":function(){define(["exports","./has"],function(e,t){"use strict";const r=!!t("esri-tests-disable-gpu-memory-measurements");class s{constructor(e,t,r,s=0){this.name=e,this._storage=t,this.removeFunc=r,this._defaultPriority=s,this.id=`${i++}${a}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}set maxSize(e){this._storage.setMaxSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,r=this._defaultPriority){this._storage.put(this,e,t,t.cachedMemory,r)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t){this._storage.updateSize(this,e,t,t.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}let i=0;class n{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}const a=":";e.MemCache=s,e.MemCacheStorage=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear(),this._db=null}register(e){this._users.set(e.id.slice(0,-1),e)}deregister(e){this.clear(e),this._sizeLimits.delete(e),this._users.delete(e.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,s,i,a){t=e.id+t;const o=this._db.get(t);if(o&&(this._size-=o.size,e.size-=o.size,this._db.delete(t),o.entry!==s&&this._notifyRemove(t,o.entry,o.size,0)),i>this._maxSize)return void this._notifyRemove(t,s,i,0);if(void 0===s)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return r||console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,s,0,0);const l=1+Math.max(a,-4)- -3;this._db.set(t,new n(s,i,l)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,r,s){t=e.id+t;const i=this._db.get(t);if(i&&i.entry===r){for(this._size-=i.size,e.size-=i.size;s>this._maxSize;){const e=this._notifyRemove(t,r,s,1);if(!(null!=e&&e>0))return void this._db.delete(t);s=e}i.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach((e,s)=>{const i=e.lifetime;r[i]=(r[i]||0)+e.size,this._users.forEach(r=>{const{id:i,name:n}=r;if(s.startsWith(i)){const r=t[n]||0;t[n]=r+e.size}})});const s={};this._users.forEach(e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const i=t[r]||0;t[r]=i,s[r]=Math.round(100*e.hitRate)+"%"}else s[r]="0%"});const i=Object.keys(t);i.sort((e,r)=>t[r]-t[e]),i.forEach(r=>e[r]=Math.round(t[r]/2**20)+"MB / "+s[r]);for(let t=r.length-1;t>=0;--t){const s=r[t];s&&(e["Priority "+(t+-3-1)]=Math.round(s/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEach(e=>e.resetHitRate())}clear(e){const t=e.id;this._db.forEach((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,0))}),e.size=0}clearAll(){this._db.forEach((e,t)=>this._notifyRemove(t,e.entry,e.size,0)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}*values(e){for(const[t,r]of this._db)t.startsWith(e.id)&&(yield r.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,s){const i=this._users.get(e.split(a)[0])?.removeFunc,n=i?.(t,s,r);return"number"==typeof n?n:null}_checkSize(){this._sizeLimits.forEach((e,t)=>this._checkSizeLimits(e,t)),this._checkSizeLimits(this.maxSize)}setMaxSize(e,t){null==t||t<=0?this._sizeLimits.delete(e):this._sizeLimits.set(e,t)}_checkSizeLimits(e,t){const r=t??this;if(r.size<=e)return;const s=t?.id;let i=!0;for(;i;){i=!1;for(const[n,o]of this._db)if(0===o.lifetime&&(!s||n.startsWith(s))){const s=t??this._users.get(n.split(a)[0]);if(this._purgeItem(n,o,s),r.size<=.9*e)return;i||=this._db.has(n)}}for(const[i,n]of this._db)if(!s||i.startsWith(s)){const s=t??this._users.get(i.split(a)[0]);if(this._purgeItem(i,n,s),r.size<=.9*e)return}}_purgeItem(e,t,r){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const s=this._notifyRemove(e,t.entry,t.size,1);null!=s&&s>0&&(this._size+=s,r&&(r.size+=s),t.lives=t.lifetime,t.size=s,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}},e.MinPriority=-3,e.NoPriority=-4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(e,t,r){"use strict";const s=new r,i=new r,n=new r,a={esriGeometryPoint:t.convertToPoint,esriGeometryPolyline:t.convertToPolyline,esriGeometryPolygon:t.convertToPolygon,esriGeometryMultipoint:t.convertToMultipoint},o="_geVersion",l=(e,t)=>e===o?void 0:t;e.cleanFromGeometryEngine=function(e){return e&&o in e?JSON.parse(JSON.stringify(e,l)):e},e.getGeometry=function(e,r,o,l,u,c,d=r,h=o){const p=r&&d,f=o&&h,m=null!=l?"coords"in l?l:l.geometry:null;if(null==m)return null;if(u){let s=t.generalizeOptimizedGeometry(i,m,r,o,e,u,d,h);return c&&(s=t.quantizeOptimizedGeometry(n,s,p,f,e,c)),a[e]?.(s,p,f)??null}if(c){const s=t.quantizeOptimizedGeometry(n,m,r,o,e,c,d,h);return a[e]?.(s,p,f)??null}return t.removeZMValues(s,m,r,o,d,h),a[e]?.(s,p,f)??null},e.transformCentroid=function(e,r,s,i=e.hasZ,a=e.hasM){if(null==r)return null;const o=e.hasZ&&i,l=e.hasM&&a;if(s){const u=t.quantizeOptimizedGeometry(n,r,e.hasZ,e.hasM,"esriGeometryPoint",s,i,a);return t.convertToPoint(u,o,l)}return t.convertToPoint(r,o,l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCache":function(){define(["exports","../../../core/has"],function(e,t){"use strict";let r=0;class s{constructor(e){this.items=e,this.time=performance.now(),this.id=r++}}e.QueryEngineCache=class{constructor(){this._storage=new Map,this._purgeInterval=5,this._sweep=()=>{if(this._timer=void 0,!this._storage)return;const e=1e3*this._purgeInterval,t=performance.now()-e;for(const[r,s]of this._storage){if(!(s.time<t))return void(this._storage.size>0&&(this._timer=setTimeout(this._sweep,e)));this._storage.delete(r)}}}destroy(){this._storage?.clear(),this._storage=null,clearTimeout(this._timer)}put(e,t){this._storage?.set(e,new s(t)),this._scheduleSweep()}get(e){const t=this._storage?.get(e);if(t)return this._storage?.delete(e),t.time=performance.now(),this._storage?.set(e,t),t.items}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??=setTimeout(this._sweep,1e3*this._purgeInterval))}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(e){"use strict";e.queryBinsCapabilities={supportsDate:!0,supportsFixedInterval:!0,supportsAutoInterval:!0,supportsFixedBoundaries:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!0,supportedStatistics:{count:!0,sum:!0,avg:!0,var:!0,stddev:!0,min:!0,max:!0,percentileContinuous:!0,percentileDiscrete:!0,envelope:!0,centroid:!0,convexHull:!0},supportedNormalizationTypes:{field:!0,log:!0,naturalLog:!0,percentOfTotal:!0,squareRoot:!0}},e.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsCurrentUser:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsPaginationOnAggregatedQueries:!1,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsReturnMesh:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0,supportsTrueCurve:!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define(["require","exports","../../../core/lang","../../../geometry/support/centroid","../../../geometry/support/extentUtils","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","./AttributesBuilder","./geometryUtils","./projectionSupport","./queryUtils","./SnappingCandidate","../../support/fieldUtils","../../../rest/support/AutoIntervalBinParameters","../../../rest/support/DateBinParameters","../../../rest/support/DateBinUtils","../../../rest/support/FixedBoundariesBinParameters","../../../rest/support/FixedIntervalBinParameters","../../../statistics/utils","../../../time/constants","../../../chunks/datetime"],function(e,t,r,s,i,n,a,o,l,u,c,d,h,p,f,m,y,g,_,b,S){"use strict";const x="bin";function v(e,t,r,s){const i=s.x-r.x,n=s.y-r.y,a=t.x-r.x,o=t.y-r.y,l=i*i+n*n;if(0===l)return!1;const u=a*i+o*n,c=Math.min(1,Math.max(0,u/l));return e.x=r.x+i*c,e.y=r.y+n*c,!0}function T(e,t){return e?t?4:3:t?3:2}class M{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}const F=[1];t.QueryEngineResult=class{constructor(e,t,r){this.items=e,this.query=t,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new o(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:r,outStatistics:s}=this.query,i=t?.length;if(!i)return 1;const n=new Map,a=new Map,l=new Set;for(const i of s){const{statisticType:s}=i,o="exceedslimit"!==s?i.onStatisticField:void 0;if(!a.has(o)){const r=[];for(const s of t){const t=this._getAttributeValues(e,s,this.items,n);r.push(t)}a.set(o,this._calculateUniqueValues(r,this.items,e.returnDistinctValues))}const u=a.get(o);for(const t in u){const{data:s,items:i}=u[t],n=s.join(",");r&&!e.validateItems(i,r)||l.add(n)}}return l.size}async createQueryResponse(){let e;if(e=this.query.outStatistics?this.query.outStatistics.some(e=>"exceedslimit"===e.statisticType)?this._createExceedsLimitQueryResponse():await this._createStatisticsQueryResponse(this.query,this.items):this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry){const t=this.query.geometry;a.isValid(this.query.outSR)&&!a.equals(t.spatialReference,this.query.outSR)?e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...u.project(t,t.spatialReference,this.query.outSR)}):e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...t})}return e}createSnappingResponse(e,t,r){const s=this.featureAdapter,i=T(this.hasZ,this.hasM),{point:n,mode:a}=e,o="number"==typeof e.distance?e.distance:e.distance.x,l="number"==typeof e.distance?e.distance:e.distance.y,u={candidates:[]},c="esriGeometryPolygon"===this.geometryType,h="esriGeometryPolyline"===this.geometryType||"esriGeometryPoint"===this.geometryType,p=this._getPointCreator(a,t,this.spatialReference,r),f=new M(null,0),m=new M(null,0),y={x:0,y:0,z:0};for(const t of this.items){const r=s.getGeometry(t);if(null==r)continue;const{coords:a}=r,g=r.isPoint?F:r.lengths;if(f.coords=a,m.coords=a,e.returnEdge){let e=0;for(let r=0;r<g.length;r++){const a=g[r],h=e;for(let r=0;r<a;r++,e+=i){if(!c&&r===a-1)continue;const g=f;g.coordsIndex=e;const _=m;_.coordsIndex=r===a-1?h:e+i;const b=y;if(!v(y,n,g,_))continue;const S=(n.x-b.x)/o,x=(n.y-b.y)/l,T=S*S+x*x;T<=1&&u.candidates.push(d.makeEdgeCandidate(s.getObjectId(t),p(b),Math.sqrt(T),p(g),p(_)))}}}if("all"===e.vertexMode){let e=0;for(let r=0;r<g.length;r++){const a=g[r],h=e,y=m;y.coordsIndex=h;for(let r=0;r<a;r++,e+=i){const i=f;if(i.coordsIndex=e,c&&r===a-1&&i.x===y.x&&i.y===y.y)continue;const h=(n.x-i.x)/o,m=(n.y-i.y)/l,g=h*h+m*m;g<=1&&u.candidates.push(d.makeVertexCandidate(s.getObjectId(t),p(i),Math.sqrt(g)))}}}else if(h&&"ends"===e.vertexMode){let e=0;const r=[];for(let t=0;t<g.length;t++){r.push(e);const s=g[t];e+=s*i,!c&&s>1&&r.push(e-i)}for(const e of r){const r=f;r.coordsIndex=e;const i=(n.x-r.x)/o,a=(n.y-r.y)/l,c=i*i+a*a;c<=1&&u.candidates.push(d.makeVertexCandidate(s.getObjectId(t),p(r),Math.sqrt(c)))}}}return u.candidates.sort((e,t)=>e.distance-t.distance),u}_getPointCreator(e,t,r,s){const i=null==s||a.equals(r,s)?e=>e:e=>u.project(e,r,s),{hasZ:n}=this;return"3d"===e?n&&t?({x:e,y:t,z:r})=>i({x:e,y:t,z:r}):({x:e,y:t})=>i({x:e,y:t,z:0}):({x:e,y:t})=>i({x:e,y:t})}async createSummaryStatisticsResponse(e){const{field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,minValue:a,maxValue:o,scale:l,timeZone:u,outStatisticTypes:c}=e,d=this.fieldsIndex.get(t),p=h.isDateField(d)||h.isDateOnlyField(d)||h.isTimestampOffsetField(d),f=await this._getDataValues({field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,scale:l,timeZone:u},this.items),m=_.isNullCountSupported({normalizationType:i,normalizationField:s,minValue:a,maxValue:o}),y={value:.5,fieldType:d?.type},g=h.isStringField(d)?_.calculateStringStatistics({values:f,supportsNullCount:m,percentileParams:y,outStatisticTypes:c}):_.calculateStatistics({values:f,minValue:a,maxValue:o,useSampleStdDev:!i,supportsNullCount:m,percentileParams:y,outStatisticTypes:c});return _.processSummaryStatisticsResult(g,c,p)}async createUniqueValuesResponse(e){const{field:t,valueExpression:r,domains:s,returnAllCodedValues:i,scale:n,timeZone:a}=e,o=await this._getDataValues({field:t,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:r,scale:n,timeZone:a},this.items,!1),l=_.calculateUniqueValuesCount(o);return _.createUVResult(l,s,i,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numClasses:c,scale:d,timeZone:h}=e,p=await this._getDataValues({field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,scale:d,timeZone:h},this.items),f=_.calculateClassBreaks(p,{field:t,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numClasses:c});return _.resolveCBResult(f,a)}async createHistogramResponse(e){const{field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numBins:c,scale:d,timeZone:h}=e,p=await this._getDataValues({field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,scale:d,timeZone:h},this.items);return _.calculateHistogram(p,{field:t,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:a,standardDeviationInterval:o,minValue:l,maxValue:u,numBins:c})}_sortFeatures(e,t,r){if(e.length>1&&t?.length)for(const s of t.slice().reverse()){const t=s.split(" "),i=t[0],n=this.fieldsIndex.get(i),a=!!t[1]&&"desc"===t[1].toLowerCase(),o=_.getAttributeComparator(n?.type,a);e.sort((e,t)=>{const s=r(e,i,n),a=r(t,i,n);return o(s,a)})}}_createFeatureQueryResponse(e){const{items:t,geometryType:r,hasM:s,hasZ:i,objectIdField:a,spatialReference:o}=this,{outFields:u,outSR:c,quantizationParameters:d,resultRecordCount:h,resultOffset:p,returnZ:f,returnM:m}=e,y=null!=h&&t.length>(p||0)+h,g=u&&(u.includes("*")?[...this.fieldsIndex.fields]:u.map(e=>this.fieldsIndex.get(e)));return{exceededTransferLimit:y,features:this._createFeatures(e,t),fields:g,geometryType:r,hasM:s&&m,hasZ:i&&f,objectIdFieldName:a,spatialReference:l.cleanFromGeometryEngine(c||o),transform:d&&n.toQuantizationTransform(d)||null}}_createFeatures(e,t){const r=new o(e,this.featureAdapter,this.fieldsIndex),{hasM:s,hasZ:i}=this,{orderByFields:a,quantizationParameters:u,returnGeometry:c,returnCentroid:d,maxAllowableOffset:h,resultOffset:p,resultRecordCount:f,returnZ:m=!1,returnM:y=!1}=e,g=i&&m,_=s&&y;let b=[],S=0;const x=[...t];if(this._sortFeatures(x,a,(e,t,s)=>r.getFieldValue(e,t,s)),this.geometryType&&(c||d)){const e=n.toQuantizationTransform(u)??void 0,t="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(c&&!d)for(const s of x){const i=this.featureAdapter.getGeometry(s),n={attributes:r.getAttributes(s),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,i,h,e,g,_),metadata:this.featureAdapter.getMetadata?.(s)};t&&i&&!n.geometry&&(n.centroid=l.transformCentroid(this,this.featureAdapter.getCentroid(s,this),e)),b[S++]=n}else if(!c&&d)for(const t of x)b[S++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of x)b[S++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),h,e,g,_),metadata:this.featureAdapter.getMetadata?.(t)}}else for(const e of x){const t=r.getAttributes(e);t&&(b[S++]={attributes:t})}const v=p||0;if(null!=f){const e=v+f;b=b.slice(v,Math.min(b.length,e))}return b}_createExceedsLimitQueryResponse(){let e=!1,t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(const e of this.query.outStatistics??[])if("exceedslimit"===e.statisticType){t=null!=e.maxPointCount?e.maxPointCount:Number.POSITIVE_INFINITY,r=null!=e.maxRecordCount?e.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=e.maxVertexCount?e.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)e=this.items.length>t;else if(this.items.length>r)e=!0;else{const t=T(this.hasZ,this.hasM),r=this.featureAdapter;e=this.items.reduce((e,t)=>{const s=r.getGeometry(t);return e+(null!=s&&s.coords.length||0)},0)/t>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(e)}}]}}async _createStatisticsQueryResponse(e,t,r={attributes:{}}){const s=[],i=new Map,n=new Map,a=new Map,l=new Map,u=new o(e,this.featureAdapter,this.fieldsIndex),c=e.outStatistics,{groupByFieldsForStatistics:d,having:p,orderByFields:f,resultRecordCount:m}=e,y=d?.length,g=!!y,_=g?d[0]:null,b=g&&!this.fieldsIndex.get(_);for(const e of c??[]){const{outStatisticFieldName:o,statisticType:c}=e,f=e,m="exceedslimit"!==c?e.onStatisticField:void 0,S="percentile_disc"===c||"percentile_cont"===c,x="EnvelopeAggregate"===c||"CentroidAggregate"===c||"ConvexHullAggregate"===c,v=g&&1===y&&(m===_||b)&&"count"===c;if(g){if(!a.has(m)){const e=[];for(const r of d){const s=this._getAttributeValues(u,r,t,i);e.push(s)}a.set(m,this._calculateUniqueValues(e,t,!x&&u.returnDistinctValues))}const e=a.get(m);if(!e)continue;const r=Object.keys(e);for(const s of r){const{count:r,data:n,items:a,itemPositions:c}=e[s],h=n.join(",");if(!p||u.validateItems(a,p)){const e=l.get(h)||{attributes:{}};if(x){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:t,outStatisticFieldName:r}=await this._getAggregateGeometry(f,a);e.aggregateGeometries[r]=t}else{let s=null;if(v)s=r;else{const e=this._getAttributeValues(u,m,t,i),r=c.map(t=>e[t]);s=S&&"statisticParameters"in f?this._getPercentileValue(f,r):this._getStatisticValue(f,r,null,u.returnDistinctValues)}e.attributes[o]=s}let s=0;d.forEach((t,r)=>e.attributes[this.fieldsIndex.get(t)?t:"EXPR_"+ ++s]=n[r]),l.set(h,e)}}}else if(x){r.aggregateGeometries||(r.aggregateGeometries={});const{aggregateGeometries:e,outStatisticFieldName:s}=await this._getAggregateGeometry(f,t);r.aggregateGeometries[s]=e}else{const e=this._getAttributeValues(u,m,t,i);r.attributes[o]=S&&"statisticParameters"in f?this._getPercentileValue(f,e):this._getStatisticValue(f,e,n,u.returnDistinctValues)}const T="min"!==c&&"max"!==c||!h.isStringField(this.fieldsIndex.get(m))&&!this._isAnyDateField(m)?null:this.fieldsIndex.get(m)?.type;s.push({name:o,alias:o,type:T||"esriFieldTypeDouble"})}const S=g?Array.from(l.values()):[r];return this._sortFeatures(S,f,(e,t)=>e.attributes[t]),m&&(S.length=Math.min(m,S.length)),{fields:s,features:S}}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return h.isDateField(t)||h.isDateOnlyField(t)||h.isTimestampOffsetField(t)||h.isTimeOnlyField(t)}async _getAggregateGeometry(t,r){const{convexHull:n,union:a}=await new Promise((t,r)=>e(["../../../geometry/geometryEngineJSON"],t,r)),{statisticType:o,outStatisticFieldName:u}=t,{featureAdapter:c,spatialReference:d,geometryType:h,hasZ:p,hasM:f}=this,m=r.map(e=>l.getGeometry(h,p,f,c.getGeometry(e))),y=n(d,m,!0)[0],g={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===o){const e=y?i.getPolygonExtent(y):i.getGeometryExtent(a(d,m));g.aggregateGeometries={...e,spatialReference:d},g.outStatisticFieldName=u||"extent"}else if("CentroidAggregate"===o){const e=y?s.polygonCentroid(y):s.extentCentroid(i.getGeometryExtent(a(d,m)));g.aggregateGeometries={x:e[0],y:e[1],spatialReference:d},g.outStatisticFieldName=u||"centroid"}else"ConvexHullAggregate"===o&&(g.aggregateGeometries=y,g.outStatisticFieldName=u||"convexHull");return g}_getStatisticValue(e,t,r,s){const{onStatisticField:i,statisticType:n}=e;let a=null;return a=r?.has(i)?r.get(i):h.isStringField(this.fieldsIndex.get(i))||this._isAnyDateField(i)?_.calculateStringStatistics({values:t,returnDistinct:s}):_.calculateStatistics({values:s?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(i,a),a["var"===n?"variance":n]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:s,statisticType:i}=e,{value:n,orderBy:a}=s,o=this.fieldsIndex.get(r),l={value:n,orderBy:a,fieldType:o?.type,isDiscrete:"percentile_disc"===i};return _.calculatePercentile(t,l)}_getAttributeValues(e,t,r,s){if(s.has(t))return s.get(t);const i=this.fieldsIndex.get(t),n=r.map(r=>e.getFieldValue(r,t,i));return s.set(t,n),n}_calculateUniqueValues(e,t,r){const s={},i=t.length;for(let n=0;n<i;n++){const i=t[n],a=[];for(const t of e)a.push(t[n]);const o=a.join(",");null==s[o]?s[o]={count:1,data:a,items:[i],itemPositions:[n]}:(r||s[o].count++,s[o].items.push(i),s[o].itemPositions.push(n))}return s}async _getDataValues(e,t,s=!0){const i=new o(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:n,scale:a,timeZone:l}=e;return n?i.getExpressionValues(t,n,{viewingMode:"map",scale:a,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},l):i.getDataValues(t,r.clone(e),s)}_calculateHistogramBins(e,t,r){if(null==t.min&&null==t.max)return[];const s=t.intervals,i=t.min??0,n=t.max??0,a=s.map(([e,t])=>({minValue:e,maxValue:t,count:0,items:[]}));for(let t=0;t<e.length;t++){const o=e[t],l=r[t];if(null!=o&&o>=i&&o<=n){const e=_.binIndex(s,o);e>-1&&(a[e].count++,a[e].items.push(l))}}return a}async createQueryBinsResponse(e){const t=e.bin?.splitBy;if(!t)return this._createBinsResponse(e);const{value:r,outAlias:s,valueType:i}=t,n=[],a=[{name:s??r,alias:s??r,type:i??"esriFieldTypeString"},{name:x,alias:x,type:"esriFieldTypeInteger"}],l=new o(e,this.featureAdapter,this.fieldsIndex),u=new Map,c=[...this.items];this._sortFeatures(c,[r],(e,t,r)=>l.getFieldValue(e,t,r));const d=this._getAttributeValues(l,r,c,u),h=this._calculateUniqueValues([d],c,l.returnDistinctValues);for(const t in h){const{items:i}=h[t],o=await this._createBinsResponse(e,i);if(n.push(...o.features.map(e=>({...e,attributes:{...e.attributes,[s??r]:t}}))),o.fields)for(const e of o.fields)a.some(t=>t.name===e.name)||a.push(e)}return{fields:a,features:n}}async _createBinsResponse(e,t){const r=e.bin;switch(t=t??this.items,r.type){case"autoIntervalBin":return this._createAutoIntervalBinsResponse(p.fromJSON(r),e,t);case"dateBin":return this._createDateBinsResponse(f.fromJSON(r),e,t);case"fixedBoundariesBin":return this._createFixedBoundariesBinsResponse(y.fromJSON(r),e,t);case"fixedIntervalBin":return this._createFixedIntervalBinsResponse(g.fromJSON(r),e,t)}}async _createAutoIntervalBinsResponse(e,t,r){const{field:s,normalizationField:i,numBins:n,normalizationType:a,normalizationTotal:o,start:l,end:u}=e,d=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),h=_.getBinParams(d,{field:s,normalizationField:i,normalizationType:a,normalizationTotal:o,numBins:n,minValue:c.getDateInNumber(l,!1),maxValue:c.getDateInNumber(u,!1)}),p=this._calculateHistogramBins(d,h,r);return this._createFeaturesFromHistogramBins(p,t)}async _createDateBinsResponse(e,t,r){const{field:s,interval:i,start:n,end:a,snapToData:o,returnFullIntervalBin:l}=e,u=i.unit,d=await this._getDataValues({field:e.field,timeZone:t.outTimeReference?.ianaTimeZone},r),p=h.isTimeOnlyField(this.fieldsIndex.get(s)),f=m.unitsDict.toJSON(u),y=d.filter(Boolean).sort((e,t)=>e-t),g=null!=n?c.getDateInNumber(n,p):y[0],_=null!=a?c.getDateInNumber(a,p):y[y.length-1],x={zone:t.outTimeReference?.ianaTimeZone??b.utc},v=S.DateTime.fromMillis(g,x),T=S.DateTime.fromMillis(_,x),M=[];if("last"===o){let e=T;for(;e>v;){const t=e.minus({[f]:i.value});if(t<v){M.unshift([l?t.toMillis():v.toMillis(),e.toMillis()]);break}M.unshift([t.toMillis(),e.toMillis()]),e=t}}else{let e="first"===o?v:v.startOf(f);for(;e<=T;){const t=e.plus({[f]:i.value});if(t>T){M.push([e.toMillis(),l?t.toMillis():T.toMillis()]);break}M.push([e.toMillis(),t.toMillis()]),e=t}}const F=this._calculateHistogramBins(d,{intervals:M,min:g,max:_},r);return this._createFeaturesFromHistogramBins(F,t)}async _createFixedBoundariesBinsResponse(e,t,r){const{field:s}=e,i=await this._getDataValues({field:s,timeZone:t.outTimeReference?.ianaTimeZone},r),n=h.isTimeOnlyField(this.fieldsIndex.get(s)),a=e.boundaries.map(e=>c.getDateInNumber(e,n)).sort((e,t)=>e-t),o=[];for(let e=0;e<a.length-1;e++)o.push([a[e],a[e+1]]);const l={intervals:o,min:a.at(0),max:a.at(-1)},u=this._calculateHistogramBins(i,l,r);return this._createFeaturesFromHistogramBins(u,t)}async _createFixedIntervalBinsResponse(e,t,r){const{field:s,interval:i,start:n,end:a}=e,o=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),l=h.isTimeOnlyField(this.fieldsIndex.get(s)),u=_.getBinParams(o,{field:s,classificationMethod:"defined-interval",definedInterval:i,minValue:c.getDateInNumber(n,l),maxValue:c.getDateInNumber(a,l)},!0),d=this._calculateHistogramBins(o,u,r);return this._createFeaturesFromHistogramBins(d,t)}async _createFeaturesFromHistogramBins(e,t){const{upperBoundaryAlias:r,lowerBoundaryAlias:s}=t,i=s||"lowerBoundary",n=r||"upperBoundary",a=[],o=[{name:i,alias:i,type:"esriFieldTypeDouble"},{name:n,alias:n,type:"esriFieldTypeDouble"}],l=t.bin?.stackBy?.value,u=t.bin?.stackBy?.outAlias;l&&o.push({name:x,alias:x,type:"esriFieldTypeInteger"},{name:u??l,alias:u??l,type:"esriFieldTypeString"});let c=0;const d="dateBin"===t.bin.type,h=t.outTimeReference?.ianaTimeZone;for(const r of e){const{minValue:e,maxValue:s,items:p}=r,f={attributes:{}};let m;if(f.attributes[i]=d&&h&&null!=e?S.DateTime.fromMillis(e,{zone:h}).toISO():e,f.attributes[n]=d&&h&&null!=s?S.DateTime.fromMillis(s,{zone:h}).toISO():s,l?(m=await this._createStatisticsQueryResponse({...t,groupByFieldsForStatistics:[l],orderByFields:[l]},p),f.attributes[x]=++c,"flat"===t.bin.jsonStyle?a.push(...m.features.map(({attributes:{EXPR_1:e,...t},...r})=>({...r,attributes:u??e?{...t,[u??e]:e,...f.attributes}:{...t,...f.attributes}}))):(f.stackedAttributes=m.features.map(({attributes:{EXPR_1:e,...t}})=>u??e?{...t,[u??e]:e}:t),a.push(f))):(t.bin?.splitBy&&(f.attributes[x]=++c),m=await this._createStatisticsQueryResponse(t,p,f),a.push(f)),m.fields)for(const e of m.fields)o.some(t=>t.name===e.name)||o.push(e)}return"desc"===t.binOrder&&a.reverse(),{fields:o,features:a}}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(e,t){"use strict";function r(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:s}=e,i=r[0]??1,n=r[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===t?n:-n,r[2]??1,r[3]??1],translate:[s[0]??0,s[1]??0,s[2]??0,s[3]??0]}}function s({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function i({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function n({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}function a({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}function o(e,t){return e&&t?d:e&&!t?u:!e&&t?c:l}const l=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let a=s(e,n[0]),o=i(e,n[1]);r.push([a,o]);for(let n=1;n<t.length;n++){const[l,u]=t[n],c=s(e,l),d=i(e,u);c===a&&d===o||r.push([c-a,d-o]),a=c,o=d}return r},u=(e,t)=>{const r=[];if(!t.length)return null;const a=t[0];let o=s(e,a[0]),l=i(e,a[1]),u=n(e,a[2]);r.push([o,l,u]);for(let a=1;a<t.length;a++){const[c,d,h]=t[a],p=s(e,c),f=i(e,d),m=n(e,h);p===o&&f===l&&m===u||r.push([p-o,f-l,m]),o=p,l=f,u=m}return r},c=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let o=s(e,n[0]),l=i(e,n[1]),u=a(e,n[2]);r.push([o,l,u]);for(let n=1;n<t.length;n++){const[c,d,h]=t[n],p=s(e,c),f=i(e,d),m=a(e,h);p===o&&f===l&&m===u||r.push([p-o,f-l,m]),o=p,l=f,u=m}return r},d=(e,t)=>{const r=[];if(!t.length)return null;const o=t[0];let l=s(e,o[0]),u=i(e,o[1]),c=n(e,o[2]),d=a(e,o[3]);r.push([l,u,c,d]);for(let o=1;o<t.length;o++){const[h,p,f,m]=t[o],y=s(e,h),g=i(e,p),_=n(e,f),b=a(e,m);y===l&&g===u&&_===c&&b===d||r.push([y-l,g-u,_,b]),l=y,u=g,c=_,d=b}return r};function h({scale:e,translate:t},r){return r*e[0]+t[0]}function p({scale:e,translate:t},r){return r*e[1]+t[1]}function f({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function m({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function y(e,t){return e&&t?S:e&&!t?_:!e&&t?b:g}const g=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=h(e,s[0]),n=p(e,s[1]);r[0]=[i,n];const{scale:a,originPosition:o}=e,l=a[0],u="lowerLeft"===o?a[1]:-a[1];for(let e=1;e<t.length;e++){const[s,a]=t[e];i+=l*s,n+=u*a,r[e]=[i,n]}return r},_=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=h(e,s[0]),n=p(e,s[1]);r[0]=[i,n,f(e,s[2])];const{scale:a,originPosition:o}=e,l=a[0],u="lowerLeft"===o?a[1]:-a[1];for(let s=1;s<t.length;s++){const[a,o,c]=t[s];i+=l*a,n+=u*o,r[s]=[i,n,f(e,c)]}return r},b=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=h(e,s[0]),n=p(e,s[1]);r[0]=[i,n,m(e,s[2])];const{scale:a,originPosition:o}=e,l=a[0],u="lowerLeft"===o?a[1]:-a[1];for(let s=1;s<t.length;s++){const[a,o,c]=t[s];i+=l*a,n+=u*o,r[s]=[i,n,m(e,c)]}return r},S=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=h(e,s[0]),n=p(e,s[1]);r[0]=[i,n,f(e,s[2]),m(e,s[3])];const{scale:a,originPosition:o}=e,l=a[0],u="lowerLeft"===o?a[1]:-a[1];for(let s=1;s<t.length;s++){const[a,o,c,d]=t[s];i+=l*a,n+=u*o,r[s]=[i,n,f(e,c),m(e,d)]}return r};function x(e,t,r){const s=new Array(r.length);for(let i=0;i<r.length;i++)s[i]=t(e,r[i]);return s}function v(e,t,r){let[s,i]=r[0],n=Math.min(s,t[0]),a=Math.min(i,t[1]),o=Math.max(s,t[2]),l=Math.max(i,t[3]);for(let e=1;e<r.length;e++){const[t,u]=r[e];s+=t,i+=u,t<0&&(n=Math.min(n,s)),t>0&&(o=Math.max(o,s)),u<0?a=Math.min(a,i):u>0&&(l=Math.max(l,i))}return e[0]=n,e[1]=a,e[2]=o,e[3]=l,e}function T(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++)v(e,e,t[r]);return e}function M(e,t,o){const l=r(e);return t.xmin=s(l,o.xmin),t.ymin=i(l,o.ymin),t.xmax=s(l,o.xmax),t.ymax=i(l,o.ymax),o.hasZ&&(t.zmin=n(l,o.zmin),t.zmax=n(l,o.zmax)),o.hasM&&(t.mmin=a(l,o.mmin),t.mmax=a(l,o.mmax)),t.hasZ=o.hasZ??!1,t.hasM=o.hasM??!1,t}function F(e,t,s){const i=r(e);return t.points=o(s.hasZ,s.hasM)(i,s.points)??[],t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t}function I(e,t,o){const l=r(e);return t.x=s(l,o.x),t.y=i(l,o.y),null!=o.z&&(t.z=n(l,o.z)),null!=o.m&&(t.m=a(l,o.m)),t}function w(e,t,s){const i=function(e,t,r,s){const i=[],n=o(r,s);for(let r=0;r<t.length;r++){const s=n(e,t[r]);s&&s.length>=3&&i.push(s)}return i.length?i:null}(r(e),s.rings,s.hasZ,s.hasM);return i?(t.rings=i,t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t):null}function R(e,t,s){const i=function(e,t,r,s){const i=[],n=o(r,s);for(let r=0;r<t.length;r++){const s=n(e,t[r]);s&&s.length>=2&&i.push(s)}return i.length?i:null}(r(e),s.paths,s.hasZ,s.hasM);return i?(t.paths=i,t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t):null}e.getQuantizedBoundsCoordsArray=v,e.getQuantizedBoundsCoordsArrayArray=T,e.getQuantizedBoundsPaths=function(e){return T([0,0,0,0],e)},e.getQuantizedBoundsPoints=function(e){const t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return v(t,t,e)},e.getQuantizedBoundsRings=function(e){return T([0,0,0,0],e)},e.normalizeTransform=r,e.quantizeBounds=function(e,t,n){const a=r(e);return t[0]=s(a,n[0]),t[3]=i(a,n[1]),t[2]=s(a,n[2]),t[1]=i(a,n[3]),t},e.quantizeCoordsArrayXY=l,e.quantizeCoordsArrayXYM=c,e.quantizeCoordsArrayXYZ=u,e.quantizeCoordsArrayXYZM=d,e.quantizeExtent=M,e.quantizeGeometry=function(e,r){return e&&r?t.isPoint(r)?I(e,{},r):t.isPolyline(r)?R(e,{},r):t.isPolygon(r)?w(e,{},r):t.isMultipoint(r)?F(e,{},r):t.isExtent(r)?M(e,{},r):null:null},e.quantizeM=a,e.quantizeMultipoint=F,e.quantizePoint=I,e.quantizePolygon=w,e.quantizePolyline=R,e.quantizeX=s,e.quantizeY=i,e.quantizeZ=n,e.toQuantizationTransform=function(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null},e.unquantizeBounds=function(e,t,s){const i=r(e);return s?(t[0]=h(i,s[0]),t[1]=p(i,s[3]),t[2]=h(i,s[2]),t[3]=p(i,s[1]),t):[h(i,t[0]),p(i,t[3]),h(i,t[2]),p(i,t[1])]},e.unquantizeCoordsArrayArray=x,e.unquantizeCoordsArrayXY=g,e.unquantizeCoordsArrayXYM=b,e.unquantizeCoordsArrayXYZ=_,e.unquantizeCoordsArrayXYZM=S,e.unquantizeExtent=function(e,t,s,i=s.hasZ??!1,n=s.hasM??!1){const a=r(e);return t.xmin=h(a,s.xmin),t.xmax=h(a,s.xmax),t.ymin=p(a,s.ymin),t.ymax=p(a,s.ymax),i&&(t.zmin=f(a,s.zmin),t.zmax=f(a,s.zmax)),n&&(t.mmin=m(a,s.mmin),t.mmax=m(a,s.mmax)),t.hasZ=i,t.hasM=n,t},e.unquantizeM=m,e.unquantizeMultipoint=function(e,t,s,i=s?.hasZ??!1,n=s?.hasM??!1){if(null!=s){const a=r(e);t.points=y(i,n)(a,s.points),t.hasZ=i,t.hasM=n}return t},e.unquantizePoint=function(e,t,s,i=null!=s?.z,n=null!=s?.m){if(null==s)return t;const a=r(e);return t.x=h(a,s.x),t.y=p(a,s.y),i&&(t.z=f(a,s.z)),n&&(t.m=m(a,s.m)),t},e.unquantizePolygon=function(e,t,s,i=s?.hasZ??!1,n=s?.hasM??!1){if(null!=s){const a=r(e);t.rings=x(a,y(i,n),s.rings),t.hasZ=i,t.hasM=n}return t},e.unquantizePolyline=function(e,t,s,i=s?.hasZ??!1,n=s?.hasM??!1){if(null!=s){const a=r(e);t.paths=x(a,y(i,n),s.paths),t.hasZ=i,t.hasM=n}return t},e.unquantizeX=h,e.unquantizeY=p,e.unquantizeZ=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["./attributeSupport","./geometryUtils","../../support/fieldUtils","../../../smartMapping/statistics/support/utils","../../../statistics/utils","../../../support/loadArcade"],function(e,t,r,s,i,n){"use strict";return class{constructor(t,r,s){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues??!1,this.fieldsIndex=s,this.featureAdapter=r;const i=t.outFields;if(i&&!i.includes("*")){this.outFields=i;let t=0;for(const r of i){const i=e.getExpressionFromFieldName(r),n=this.fieldsIndex.get(i),a=n?null:e.getWhereClause(i,s),o=n?n.name:e.getAliasFromFieldName(r)||"FIELD_EXP_"+t++;this._fieldDataCache.set(r,{alias:o,clause:a})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach(e=>this.getAttributes(e)),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(t,r,s){const i=s?s.name:r;let n=null;return this._fieldDataCache.has(i)?n=this._fieldDataCache.get(i)?.clause:s||(n=e.getWhereClause(r,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:n})),s?this.featureAdapter.getAttribute(t,i):n?.calculateValue(t,this.featureAdapter)}getDataValues(e,t,n=!0){const a=t.normalizationType,o=t.normalizationTotal,l=this.fieldsIndex.get(t.field),u=r.isDateOnlyField(l)||r.isTimestampOffsetField(l),c=r.isTimeOnlyField(l);return e.map(e=>{let r=t.field&&this.getFieldValue(e,t.field,this.fieldsIndex.get(t.field));if(t.field2?(r=`${i.processNullValue(r)}${t.fieldDelimiter}${i.processNullValue(this.getFieldValue(e,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(r=`${r}${t.fieldDelimiter}${i.processNullValue(this.getFieldValue(e,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof r&&n&&(u?r=r?new Date(r).getTime():null:c&&(r=r?s.timeOnlyToMilliseconds(r):null)),a&&Number.isFinite(r)){const s="field"===a&&t.normalizationField?this.getFieldValue(e,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;r=i.getNormalizedValue(r,a,s,o)}return r})}async getExpressionValues(e,r,s,i,a){const{arcadeUtils:o}=await n.loadArcade(),l=o.hasGeometryOperations(r);l&&await o.enableGeometryOperations();const u=o.createFunction(r),c=o.getViewInfo(s),d={fields:this.fieldsIndex.fields};return e.map(e=>{const r={attributes:this.featureAdapter.getAttributes(e),layer:d,geometry:l?{...t.getGeometry(i.geometryType,i.hasZ,i.hasM,this.featureAdapter.getGeometry(e)),spatialReference:s?.spatialReference}:null},n=o.createExecContext(r,c,a);return o.executeFunction(u,n)})}validateItem(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testFeature(t,this.featureAdapter)??!1}validateItems(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testSet(t,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const r={};for(const s of t){const{alias:t,clause:i}=this._fieldDataCache.get(s);r[t]=i?i.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const s of t){const{alias:t}=this._fieldDataCache.get(s);r.push(e[t])}else for(const t in e)r.push(e[t]);const s=`${(t||["*"]).join(",")}=${r.join(",")}`;let i=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++i),i>1?null:e}}})},"esri/smartMapping/statistics/support/utils":function(){define(["exports","../../../core/Error","../../../core/screenUtils","../../../core/timeUtils","../../../geometry/Point","../../../geometry/SpatialReference","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/support/fieldUtils","../../../renderers/support/heatmapUtils","../../support/utils","../../../statistics/utils","../../../support/loadArcade"],function(e,t,r,s,i,n,a,o,l,u,c,d,h){"use strict";let p=null;const f=/^(?<hh>([01][0-9])|(2[0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?(\.(?<ms>\d+))?$/;function m(e){const t=f.exec(e);if(!t)return null;const{hh:r,mm:i,ss:n,ms:a}=t.groups;return Number(r)*s.millisecondsPerTimeUnit.hours+Number(i)*s.millisecondsPerTimeUnit.minutes+Number(n)*s.millisecondsPerTimeUnit.seconds+Number(a||0)}function y(e,t){let r=null!=e?e:"";return null!=t&&t&&(r=r?"("+r+") AND ("+t+")":t),r}e.calculateHeatmapStats=function(e,t=18,s,i,n){const a=new Float64Array(i*n);t=Math.round(r.pt2px(t));let o=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const c=u.createValueFunction(s);for(const{geometry:r,attributes:s}of e){const{x:e,y:d}=r,h=Math.max(0,e-t),p=Math.max(0,d-t),f=Math.min(n,d+t),m=Math.min(i,e+t),y=+c(s);for(let r=p;r<f;r++)for(let s=h;s<m;s++){const n=r*i+s,c=u.evaluateDensityKernel(s-e,r-d,t)*y,h=a[n]+=c;o=Math.min(o,h),l=Math.max(l,h)}}return{min:o,max:l}},e.getDataValues=async function(e,t,r=!0){if(!t)return[];const{field:s,field2:i,field3:a,fieldDelimiter:o,fieldInfos:u,timeZone:f}=e,y=s&&u?.find(e=>e.name.toLowerCase()===s.toLowerCase()),g=!!y&&l.isTimeOnlyField(y),_=!!y&&c.isAnyDateField(y),b=e.valueExpression,S=e.normalizationType,x=e.normalizationField,v=e.normalizationTotal,T=[],M=e.viewInfoParams;let F=null,I=null;if(b){if(!p){const{arcadeUtils:e}=await h.loadArcade();p=e}p.hasGeometryOperations(b)&&await p.enableGeometryOperations(),F=p.createFunction(b),I=M?p.getViewInfo({viewingMode:M.viewingMode,scale:M.scale,spatialReference:new n(M.spatialReference)}):null}const w=e.fieldInfos,R=t[0]&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass||!w?null:{fields:w};return t.forEach(e=>{const t=e.attributes;let n;if(b){const t=R?Object.assign({},e,{layer:R}):e,r=p.createExecContext(t,I,f);n=p.executeFunction(F,r)}else t&&(n=t[s],i?(n=`${d.processNullValue(n)}${o}${d.processNullValue(t[i])}`,a&&(n=`${n}${o}${d.processNullValue(t[a])}`)):"string"==typeof n&&r&&(_?n=n?new Date(n).getTime():null:g&&(n=n?m(n):null)));if(S&&"number"==typeof n&&isFinite(n)){const e=t&&parseFloat(t[x]);n=d.getNormalizedValue(n,S,e,v)}T.push(n)}),T},e.getRangeExpr=function(e,t,r){const s=null!=t?e+" >= "+t:"",i=null!=r?e+" <= "+r:"";let n="";return n=s&&i?y(s,i):s||i,n?"("+n+")":""},e.getSQLFilterForNormalization=function(e){const t=e.field,r=e.normalizationType,s=e.normalizationField;let i;return"field"===r?i="(NOT "+s+" = 0)":"log"!==r&&"natural-log"!==r&&"square-root"!==r||(i=`(${t} > 0)`),i},e.getSumOfAttributesExpr=function(e,t,r){const s=[],i=[],n=[],a=[],o=[];e.forEach((e,t)=>{const l=e.field?"field":"expression",u=e.field||e.valueExpression;e.field?(o.push(u),i.push(`var ${l}${t} = Number($feature["${u}"]);`)):(s.push(`function getValueForExpr${t}() {\n  ${u} \n}`),i.push(`var ${l}${t} = Number(getValueForExpr${t}());`)),r||n.push(`${l}${t} = IIf(${l}${t} < 0, 0, ${l}${t});`),a.push(`${l}${t}`)});const l=s.length?null:o.reduce((e,t)=>`${e} + ${t}`);let u=null;return t||r?t?r||l&&(u=`(( ${l} ) >= 0)`):l&&(u=`(( ${l} ) <> 0)`):l&&(u=`(( ${l} ) > 0)`),{valueExpression:[s.length?s.join("\n"):"",i.join("\n"),n.join("\n"),`var total = ${a.join(" + ")};`,"return total;"].filter(Boolean).join("\n\n"),sqlExpression:l,sqlWhere:u}},e.mergeWhereClauses=y,e.quantizeFeatures=function(e,t,r,s){const n=o.isWrappable(r)?o.getInfo(r):null,l=n?Math.round((n.valid[1]-n.valid[0])/t.scale[0]):null;return e.map(e=>{const r=new i(e.geometry);return a.quantizePoint(t,r,r),e.geometry=n?function(e,t,r){return e.x<0?e.x+=t:e.x>r&&(e.x-=t),e}(r,l??0,s[0]):r,e})},e.timeOnlyToMilliseconds=m,e.verifyBasicFieldValidity=function(e,r,s){const i=function(e){const t=e.layer;return e.fields.filter(e=>!t.getField(e))}({layer:e,fields:r});if(i.length)return new t(s,"Unknown fields: "+i.join(", ")+". You can only use fields defined in the layer schema");const n=function(e){const t=e.layer;return e.fields.filter(e=>{const r=t.getFieldUsageInfo(e);return!r||!r.supportsStatistics})}({layer:e,fields:r});return n.length?new t(s,"Unsupported fields: "+n.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0},e.verifyFieldType=function(e,r,s,i){let n;return r?r.name!==e.objectIdField&&i.includes(r.type)||(n=new t(s,"'field' should be one of these types: "+i.join(","))):n=new t(s,"'field' is not defined in the layer schema"),n},e.verifyFilterValidity=function(e,r){if(e&&"intersects"!==e.spatialRelationship)return new t(r,"Only 'intersects' spatialRelationship is supported for featureFilter")},e.verifyNumericField=function(e,r,s){let i;return r?r.name!==e.objectIdField&&l.isNumericField(r)||(i=new t(s,"'field' should be one of these numeric types: "+l.numericTypes.join(","))):i=new t(s,"'field' is not defined in the layer schema"),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/screenUtils":function(){define(["exports"],function(e){"use strict";const t=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function r(e){return e?72*e/96:0}function s(e=0,t=0){return{x:e,y:t}}e.castRenderScreenPointArray=function(e){return e},e.castRenderScreenPointArray3=function(e){return e},e.castScreenPointArray=function(e){return e},e.cloneScreenPoint=function(e){return e?s(e.x,e.y):null},e.createRenderScreenPoint=function(e=0,t=0){return{x:e,y:t}},e.createRenderScreenPointArray=function(e=0,t=0){return[e,t]},e.createRenderScreenPointArray3=function(e=0,t=0,r=0){return[e,t,r]},e.createScreenPoint=s,e.createScreenPointArray=function(e=0,t=0){return[e,t]},e.pt2px=function(e){return e?e/72*96:0},e.px2pt=r,e.screenPointArrayToObject=function(e,t){return t?(t.x=e[0],t.y=e[1],t):{x:e[0],y:e[1]}},e.screenPointObjectToArray=function(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]},e.toPt=function(e){if("string"==typeof e){const s=e.match(t);if(s){const t=Number(s[1]),i=s[3]&&s[3].toLowerCase(),n=e.startsWith("-"),a="px"===i?r(t):t;return n?-a:a}return console.warn("screenUtils.toPt: input not recognized!"),null}return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64"],function(e,t,r,s,i){"use strict";function n(e,r,i,n){let{color:a,ratio:o}=r,{color:l,ratio:u}=i;if(u===o){const e=1e-6;1===u?o-=e:u+=e}const c=t.clamp((n-o)/(u-o),0,1);s.lerp(e,a.toArray(),l.toArray(),c)}e.createValueFunction=function(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1},e.evaluateDensityKernel=function(e,t,r){const s=Math.sqrt(e**2+t**2)/r;return s>1?0:3/(Math.PI*r**2)*(1-s**2)**2},e.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(e){return r.px2pt(2.4*e)},e.generateGradient=function(e){const t=new Uint8ClampedArray(2048);if((e=e.filter(({ratio:e})=>e>=0&&e<=1).sort((e,t)=>e.ratio-t.ratio).map(({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)}))).length<1)return t;let r=e[0],s=e[0],a=1;const o=i.create();for(let i=0;i<512;i++){const l=(i+.5)/512;for(;l>s.ratio&&a<e.length;)r=s,s=e[a++];n(o,r,s,l),t.set(o,4*i)}return t},e.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(e){return r.pt2px(e)/2.4},e.magicKernelDensityRadiusInflationFactor=2.4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define(["exports","../../intl/date","../../layers/support/fieldUtils","../../support/basemapUtils","../../support/loadArcade","../../time/constants","../../time/timeZoneUtils"],function(e,t,r,s,i,n,a){"use strict";const o={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},u=new Set(["integer","small-integer"]);let c=null;function d(e){return String(e).padStart(2,"0")}function h(e,t,r){let s;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),s=`TIMESTAMP'${r?e.getFullYear():e.getUTCFullYear()}-${d((r?e.getMonth():e.getUTCMonth())+1)}-${d(r?e.getDate():e.getUTCDate())} ${d(r?e.getHours():e.getUTCHours())}:${d(r?e.getMinutes():e.getUTCMinutes())}:${d(r?e.getSeconds():e.getUTCSeconds())}'`):s=e,s}function p(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const s=e.getField(t);if("<now>"===t.toLowerCase())return;if(r.isDateField(s))return"field"}}e.castIntegerFieldToFloat=function(e){return`cast(${e} as float)`},e.dateTypes=["date","date-only","timestamp-offset"],e.defaultBasemapGroups=o,e.defaultStatisticTypes={exclude:["median"]},e.fieldDelimiter=",",e.formatAnyDate=function(e,r){const{format:s,timeZoneOptions:i,fieldType:o}=r??{};let l,u;if(i&&({timeZone:l,timeZoneName:u}=a.getTimeZoneFormattingOptions(i.layerTimeZone,i.datesInUnknownTimezone,i.viewTimeZone,t.convertDateFormatToIntlOptions(s||"short-date-short-time"),o)),"string"==typeof e&&isNaN(Date.parse("time-only"===o?`1970-01-01T${e}Z`:e)))return e;switch(o){case"date-only":{const r=t.convertDateFormatToIntlOptions(s||"short-date");return"string"==typeof e?t.formatDateOnly(e,{...r}):t.formatDate(e,{...r,timeZone:n.utc})}case"time-only":{const r=t.convertDateFormatToIntlOptions(s||"short-time");return"string"==typeof e?t.formatTimeOnly(e,r):t.formatDate(e,{...r,timeZone:n.utc})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const r=s||i?t.convertDateFormatToIntlOptions(s||"short-date-short-time"):void 0,n=r?{...r,timeZone:l,timeZoneName:u}:void 0;return"string"==typeof e?t.formatTimestamp(e,n):t.formatDate(e,n)}default:{const r=s||i?t.convertDateFormatToIntlOptions(s||"short-date-short-time"):void 0;return t.formatDate("string"==typeof e?new Date(e):e,r?{...r,timeZone:l,timeZoneName:u}:void 0)}}},e.getBasemapGroup=function(e,t=o){for(const r in t)if(t[r].includes(e))return r},e.getBasemapId=function(e,t,r=!0){let i=null;return e&&("string"==typeof e?t.includes(e)&&(i=e):i=s.getWellKnownBasemapId(e)),r?i||"gray":i},e.getDateDiffSQL=function(e,t,r,s){const{hasQueryEngine:i}=e,n=`(${h(r,p(e,r),i)} - ${h(t,p(e,t),i)})`;let a=l[s],o="/";return a<1&&(a=1/a,o="*"),{sqlExpression:1===a?n:`(${n} ${o} ${a})`,sqlWhere:null}},e.getDateType=p,e.getFieldsList=async function(e){const{field:t,field2:r,field3:s,normalizationField:n,valueExpression:a}=e;let o=[];if(a){if(!c){const{arcadeUtils:e}=await i.loadArcade();c=e}o=c.extractFieldNames(a)}return t&&o.push(t),r&&o.push(r),s&&o.push(s),n&&o.push(n),o},e.getNormalizationType=function(e){let t=e.normalizationType;return t||(e.normalizationField?t="field":null!=e.normalizationTotal&&(t="percent-of-total")),t??void 0},e.isAnyDateField=function(e){return r.isDateField(e)||r.isDateOnlyField(e)||r.isTimestampOffsetField(e)},e.isIntegerField=function(e,t){const r=t&&e.getField(t);return!!r&&u.has(r.type)},e.unitValueInDays=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapUtils":function(){define(["exports","../core/Collection","../core/maybe","../core/urlUtils","../layers/effects/utils","./basemapDefinitions"],function(e,t,r,s,i,n){"use strict";let a;function o(e){if(a)return a(e);let t=null;const r=d(e),s=!r?.baseLayers.length;for(const e in n.esriBasemapDefinitions){const i=g(r,m(n.esriBasemapDefinitions[e]),{mustMatchReferences:s});if("equal"===i){t=e;break}"base-layers-equal"===i&&(t=e)}return t}function l(e){if(c(e.url))return!0;if("vector-tile"===e.type)for(const t in e.sourceNameToSource){const r=e.sourceNameToSource[t];if(c(r?.sourceUrl))return!0}return!1}const u=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function c(e){if(!e)return!1;const t=new s.Url(s.makeAbsolute(e));return!!t.authority&&u.test(t.authority)}function d(e){return e?!e.loaded&&e.resourceInfo?m(e.resourceInfo.data):{baseLayers:h(e.baseLayers),referenceLayers:h(e.referenceLayers)}:null}function h(e){return(t.isCollection(e)?e.toArray():e).map(p)}function p(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:S("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers?void 0:e.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function f(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function m(e){return e?{baseLayers:y((e.baseMapLayers??[]).filter(e=>!f(e))),referenceLayers:y((e.baseMapLayers??[]).filter(e=>f(e)))}:null}function y(e){return e.map(e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:S(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e))}function g(e,t,r){return null!=e!=(null!=t)?"not-equal":e&&t?_(e.baseLayers,t.baseLayers)?_(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function _(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!b(e[r],t[r]))return!1;return!0}function b(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(!i.effectEquals(e.effect,t.effect))return!1;if(null!=e.activeLayerId||null!=t.activeLayerId)return e.activeLayerId===t.activeLayerId;if(null!=e.sublayers||null!=t.sublayers){if(null==e.sublayers||null==t.sublayers||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const s=e.sublayers.at(r),i=t.sublayers.at(r);if(s?.id!==i?.id||s?.visible!==i?.visible)return!1}}return!0}function S(e){return e?s.normalize(e).replace(/^\s*https?:/i,"").toLowerCase():""}function x(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}e.contentEquals=function(e,t){return e===t||null!=e?.portalItem?.id&&e.portalItem.id===t?.portalItem?.id||"equal"===g(d(e),d(t),{mustMatchReferences:!0})},e.findSpatialReference=function(e,t){if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};const r=t.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const s=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),i=e.spatialReference;return i?{spatialReference:s.find(e=>i.equals(e))??s[0]??null,updating:!1}:{spatialReference:s[0],updating:!1}},e.getBasemapThumbnailUrl=function(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const s=o(e);return s?n.esriBasemapDefinitions[s].thumbnailUrl:r.mappedFind(e.baseLayers,x)},e.getWellKnownBasemapId=o,e.hasDeveloperBasemapLayer=function(e){return!!e?.baseLayers.concat(e.referenceLayers).some(l)},e.isBasemap3D=function(e){return"Web Scene"===e.portalItem?.type||e.referenceLayers.some(e=>"scene"===e.type)},e.isBasemapInBeta=function(e){return!!e?.portalItem?.tags?.some(e=>"beta"===e.toLowerCase())},e.isBasemapLayerView=function(e,t){const r=e.allLayerViews.find(e=>e.uid===t);return r?.layer.parent===e.map?.basemap},e.isDeveloperBasemapLayer=l,e.layerDefinitionEquals=b,e.layerToDefinition=p,e.overrideGetWellKnownBasemapId=function(e){a=e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/Collection":function(){define(["../chunks/tslib.es6","./ArrayPool","./Evented","./handleUtils","./lang","./ObjectPool","./scheduling","./accessorSupport/ensureType","./accessorSupport/tracking","./accessorSupport/decorators/property","./accessorSupport/decorators/shared","./accessorSupport/decorators/subclass","./accessorSupport/tracking/SimpleObservable","./support/jsonUtils"],function(e,t,r,s,i,n,a,o,l,u,c,d,h,p){"use strict";var f;class m{constructor(e,t,r,s,i){this.target=e,this.added=t,this.removed=r,this.start=s,this.deleteCount=i}}const y=new n(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1});function g(e){e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy&&e.destroy()}function _(e){return e?e instanceof w?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function b(e){if(e?.length)return e[0]}function S(e,t,r,s){const i=Math.min(e.length-r,t.length-s);let n=0;for(;n<i&&e[r+n]===t[s+n];)n++;return n}function x(e,t,r,s){t&&t.forEach((t,i,n)=>{e.push(t),x(e,r.call(s,t,i,n),r,s)})}const v=new Set,T=new Set,M=new Set,F=new Map;let I=0,w=class extends r.EventedAccessor{static{f=this}static{this.ofType=t=>{if(!t)return f;if(F.has(t))return F.get(t);let r=null;if("function"==typeof t)r=t.prototype.declaredClass;else if(t.base)r=t.base.prototype.declaredClass;else for(const e in t.typeMap){const s=t.typeMap[e].prototype.declaredClass;r?r+=` | ${s}`:r=s}let s=class extends f{};return e.__decorate([c.shared({Type:t,ensureType:"function"==typeof t?o.ensureType(t):o.ensureOneOfType(t)})],s.prototype,"itemType",void 0),s=e.__decorate([d.subclass(`esri.core.Collection<${r}>`)],s),F.set(t,s),s}}static isCollection(e){return null!=e&&e instanceof f}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new h.SimpleObservable,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:I++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof f?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),super.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return l.trackAccess(this._observable),this._items}set items(e){this._emitBeforeChanges(1)||(this._splice(0,this.length,_(e)),this._emitAfterChanges(1))}hasEventListener(e){return!this.destroyed&&("change"===e?this._chgListeners.length>0:super.hasEventListener(e))}on(e,t){if(this.destroyed)return s.makeHandle();if("change"===e){const e=this._chgListeners,r={removed:!1,callback:t};return e.push(r),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),s.makeHandle(()=>{r.removed=!0,e.splice(e.indexOf(r),1)})}return super.on(e,t)}once(e,t){const r="deref"in t?()=>t.deref():()=>t,s=this.on(e,e=>{r()?.call(null,e),s.remove()});return s}add(e,t){if(l.trackAccess(this._observable),this._emitBeforeChanges(1))return this;const r=this.getNextIndex(t??null);return this._splice(r,0,[e]),this._emitAfterChanges(1),this}addMany(e,t=this._items.length){if(l.trackAccess(this._observable),!e?.length)return this;if(this._emitBeforeChanges(1))return this;const r=this.getNextIndex(t);return this._splice(r,0,_(e)),this._emitAfterChanges(1),this}at(e){if(l.trackAccess(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return[];const e=this._removeAllRaw();return this._emitAfterChanges(2),e}_removeAllRaw(){return 0===this.length?[]:this._splice(0,this.length)||[]}clone(){return l.trackAccess(this._observable),this._createNewInstance({items:this._items.map(i.clone)})}concat(...e){l.trackAccess(this._observable);const t=e.map(_);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const r=this._splice(0,this.length),s=r.length;for(let i=0;i<s;i++)e.call(t,r[i],i,r);this._emitAfterChanges(2)}destroyAll(){this.drain(g)}destroyMany(e){const t=this.removeMany(e);return t.forEach(g),t}every(e,t){return l.trackAccess(this._observable),this._items.every(e,t)}filter(e,t){l.trackAccess(this._observable);const r=2===arguments.length?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:r})}find(e,t){return l.trackAccess(this._observable),this._items.find(e,t)}findIndex(e,t){return l.trackAccess(this._observable),this._items.findIndex(e,t)}flatten(e,t){l.trackAccess(this._observable);const r=[];return x(r,this,e,t),new f(r)}forEach(e,t){return l.trackAccess(this._observable),this._items.forEach(e,t)}getItemAt(e){return l.trackAccess(this._observable),this._items[e]}getNextIndex(e){l.trackAccess(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return l.trackAccess(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return l.trackAccess(this._observable),this._items.indexOf(e,t)}join(e=","){return l.trackAccess(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return l.trackAccess(this._observable),this._items.lastIndexOf(e,t)}map(e,t){l.trackAccess(this._observable);const r=this._items.map(e,t);return new f({items:r})}reorder(e,t=this.length-1){l.trackAccess(this._observable);const r=this.indexOf(e);if(-1!==r){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(4))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(4)}return e}}pop(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=b(this._splice(this.length-1,1));return this._emitAfterChanges(2),e}push(...e){return l.trackAccess(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,e),this._emitAfterChanges(1)),this.length}reduce(e,t){l.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){l.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return l.trackAccess(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(l.trackAccess(this._observable),e<0||e>=this.length||this._emitBeforeChanges(2))return;const t=b(this._splice(e,1));return this._emitAfterChanges(2),t}removeMany(e){if(l.trackAccess(this._observable),!e?.length||this._emitBeforeChanges(2))return[];const t=e instanceof f?e.toArray():e,r=this._items,s=[],i=t.length;for(let e=0;e<i;e++){const i=t[e],n=r.indexOf(i);if(n>-1){const i=1+S(t,r,e+1,n+1),a=this._splice(n,i);a&&a.length>0&&s.push.apply(s,a),e+=i-1}}return this._emitAfterChanges(2),s}reverse(){if(l.trackAccess(this._observable),this._emitBeforeChanges(4))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(4),this}shift(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=b(this._splice(0,1));return this._emitAfterChanges(2),e}slice(e=0,t=this.length){return l.trackAccess(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return l.trackAccess(this._observable),this._items.some(e,t)}sort(e){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(4)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(4),this}_requiresSort(e=(e,t)=>e===t?0:e<t?-1:1){const t=this.length-1;for(let r=0;r<t;r++)if(e(this.items[r],this.items[r+1])>0)return!0;return!1}splice(e,t,...r){l.trackAccess(this._observable),1===arguments.length&&(t=this.length),t??=0;const s=(t?2:0)|(r.length?1:0);if(this._emitBeforeChanges(s))return[];const i=this._splice(e,t,r)||[];return this._emitAfterChanges(s),i}toArray(){return l.trackAccess(this._observable),this._items.slice()}toJSON(e){return l.trackAccess(this._observable),this.toArray().map(t=>p.isSerializable(t)?t.toJSON(e):t)}toLocaleString(){return l.trackAccess(this._observable),this._items.toLocaleString()}toString(){return l.trackAccess(this._observable),this._items.toString()}unshift(...e){return l.trackAccess(this._observable),!e.length||this._emitBeforeChanges(1)||(this._splice(0,0,e),this._emitAfterChanges(1)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const s=this._items,i=this.itemType;let n,o;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=a.schedule(()=>this._dispatchChange())),e<0&&(e+=this.length),t){if(o=s.splice(e,t),this.hasEventListener("before-remove")){const t=y.acquire();t.target=this,t.cancellable=!0;for(let r=0,i=o.length;r<i;r++)n=o[r],t.reset(n),this.emit("before-remove",t),t.defaultPrevented&&(o.splice(r,1),s.splice(e,0,n),e+=1,r-=1,i-=1);y.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=y.acquire();e.target=this,e.cancellable=!1;const t=o.length;for(let r=0;r<t;r++)e.reset(o[r]),this.emit("after-remove",e);y.release(e)}}if(r?.length){if(i){const e=[];for(const t of r){const r=i.ensureType(t);null==r&&null!=t||e.push(r)}r=e}const t=this.hasEventListener("before-add"),n=this.hasEventListener("after-add"),a=e===this.length;if(t||n){const i=y.acquire();i.target=this,i.cancellable=!0;const o=y.acquire();o.target=this,o.cancellable=!1;for(const l of r)t?(i.reset(l),this.emit("before-add",i),i.defaultPrevented||(a?s.push(l):s.splice(e++,0,l),this._set("length",s.length),n&&(o.reset(l),this.emit("after-add",o)))):(a?s.push(l):s.splice(e++,0,l),this._set("length",s.length),o.reset(l),this.emit("after-add",o));y.release(o),y.release(i)}else{if(a)for(const e of r)s.push(e);else s.splice(e,0,...r);this._set("length",s.length)}}if((r?.length||o?.length)&&this._notifyChangeEvent(r,o),this.hasEventListener("after-splice")){const s=new m(this,r,o,e,t);this.emit("after-splice",s)}return o}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=y.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,y.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=y.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),y.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const r of e){const e=r.changes;v.clear(),T.clear(),M.clear();for(const{added:t,removed:r}of e){if(t)if(0===M.size&&0===T.size)for(const e of t)v.add(e);else for(const e of t)T.has(e)?(M.add(e),T.delete(e)):M.has(e)||v.add(e);if(r)if(0===M.size&&0===v.size)for(const e of r)T.add(e);else for(const e of r)v.has(e)?v.delete(e):(M.delete(e),T.add(e))}const s=t.acquire();v.forEach(e=>{s.push(e)});const i=t.acquire();T.forEach(e=>{i.push(e)});const n=this._items,a=r.items,o=t.acquire();if(M.forEach(e=>{a.indexOf(e)!==n.indexOf(e)&&o.push(e)}),r.listeners&&(s.length||i.length||o.length)){const e={target:this,added:s,removed:i,moved:o},t=r.listeners.length;for(let s=0;s<t;s++){const t=r.listeners[s];t.removed||t.callback.call(this,e)}}t.release(s),t.release(i),t.release(o)}v.clear(),T.clear(),M.clear()}};return e.__decorate([u.property()],w.prototype,"_updating",void 0),e.__decorate([u.property()],w.prototype,"length",void 0),e.__decorate([u.property()],w.prototype,"items",null),e.__decorate([u.property({readOnly:!0})],w.prototype,"updating",null),w=f=e.__decorate([d.subclass("esri.core.Collection")],w),w})},"esri/core/Evented":function(){define(["exports","./Accessor","./handleUtils"],function(e,t,r){"use strict";const s=e=>{const t=e;return class extends t{constructor(){super(...arguments),this._listenersMap=null}clearEvents(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clearEvents()}emit(e,t){let r=this._listenersMap?.get(e);if(!r)return!1;let s=!1;for(const e of r.slice()){const r="deref"in e?e.deref():e;r?r?.call(this,t):s=!0}return s&&(r=r.filter(e=>!("deref"in e)||null!=e.deref()),this._listenersMap.set(e,r)),r.length>0}on(e,t){if(Array.isArray(e)){const s=e.map(e=>this.on(e,t));return r.handlesGroup(s)}if(e.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const s=this._listenersMap.get(e)||[];return s.push(t),this._listenersMap.set(e,s),r.makeHandle(()=>{const r=this._listenersMap?.get(e),s=r?.indexOf(t)??-1;s>=0&&r.splice(s,1)})}once(e,t){const r=this.on(e,e=>{r.remove();const s="deref"in t?t.deref():t;s?.call(null,e)});return r}hasEventListener(e){const t=this._listenersMap?.get(e);return null!=t&&t.length>0}}},i=s(class{}),n=i,a=s(t);e.EventEmitter=n,e.Evented=i,e.EventedAccessor=a,e.EventedMixin=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/accessorSupport/decorators/shared":function(){define(["exports"],function(e){"use strict";e.shared=function(e){return(t,r)=>{t[r]=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/utils":function(){define(["exports","./effects"],function(e,t){"use strict";e.canInterpolateEffects=function(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every((e,t)=>e.type===r[t].type)},e.effectEquals=function(e,t){return JSON.stringify(e??null)===JSON.stringify(t??null)},e.isEffectFunctions=function(e){const t=e[0];return!!t&&"type"in t},e.normalizeEffects=function(e,r){const s=e.length>r.length?e:r,i=e.length>r.length?r:e;for(let e=i.length;e<s.length;e++)i.push(t.createEffectWithInitialValues(s[e]))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/effects":function(){define(["exports","../../colorUtils","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/mat4f32","./colorMatrixFunctions"],function(e,t,r,s,i){"use strict";class n{constructor(e,t,r){this.strength=e,this.radius=t,this.threshold=r,this.type="bloom"}interpolate(e,t,r){this.strength=d(e.strength,t.strength,r),this.radius=d(e.radius,t.radius,r),this.threshold=d(e.threshold,t.threshold,r)}clone(){return new n(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:h(this.radius),strength:this.strength,threshold:this.threshold}}}class a{constructor(e){this.radius=e,this.type="blur"}interpolate(e,t,r){this.radius=Math.round(d(e.radius,t.radius,r))}clone(){return new a(this.radius)}toJSON(){return{type:"blur",radius:h(this.radius)}}}class o{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.amount=d(e.amount,t.amount,r),this._updateMatrix()}clone(){return new o(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||s.create();switch(this.type){case"brightness":this._colorMatrix=i.brightness(e,this.amount);break;case"contrast":this._colorMatrix=i.contrast(e,this.amount);break;case"grayscale":this._colorMatrix=i.grayscale(e,this.amount);break;case"invert":this._colorMatrix=i.invert(e,this.amount);break;case"saturate":this._colorMatrix=i.saturate(e,this.amount);break;case"sepia":this._colorMatrix=i.sepia(e,this.amount)}}}class l{constructor(e,t,r,s){this.offsetX=e,this.offsetY=t,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,t,r){this.offsetX=d(e.offsetX,t.offsetX,r),this.offsetY=d(e.offsetY,t.offsetY,r),this.blurRadius=d(e.blurRadius,t.blurRadius,r),this.color[0]=Math.round(d(e.color[0],t.color[0],r)),this.color[1]=Math.round(d(e.color[1],t.color[1],r)),this.color[2]=Math.round(d(e.color[2],t.color[2],r)),this.color[3]=d(e.color[3],t.color[3],r)}clone(){return new l(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:h(this.offsetX),yoffset:h(this.offsetY),blurRadius:h(this.blurRadius),color:e}}}class u{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.angle=d(e.angle,t.angle,r),this._updateMatrix()}clone(){return new u(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||s.create();this._colorMatrix=i.rotateHue(e,this.angle)}}class c{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,r){this.amount=d(e.amount,t.amount,r)}clone(){return new c(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function d(e,t,r){return e+(t-e)*r}function h(e){return Math.round(1e3*r.px2pt(e))/1e3}e.BloomEffect=n,e.BlurEffect=a,e.ColorMatrixEffect=o,e.DropShadowEffect=l,e.HueRotateEffect=u,e.OpacityEffect=c,e.createEffectWithInitialValues=function(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new o(e.type,0);case"saturate":case"brightness":case"contrast":return new o(e.type,1);case"opacity":return new c(1);case"hue-rotate":return new u(0);case"blur":return new a(0);case"drop-shadow":return new l(0,0,0,[...t.getNamedColor("transparent")]);case"bloom":return new n(0,0,1)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["exports"],function(e){"use strict";function t(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function r(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function s(e,t,r,s,i,n,a,o,l,u,c,d,h,p,f,m){const y=new Float32Array(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=s,y[4]=i,y[5]=n,y[6]=a,y[7]=o,y[8]=l,y[9]=u,y[10]=c,y[11]=d,y[12]=h,y[13]=p,y[14]=f,y[15]=m,y}const i=t(),n=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:i,clone:r,create:t,fromValues:s},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=i,e.clone=r,e.create=t,e.fromValues=s,e.mat4f32=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/colorMatrixFunctions":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(e,t){"use strict";e.brightness=(e,r)=>{const s=t.set(e,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return t.transpose(s,s)},e.contrast=(e,r)=>{const s=t.set(e,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return t.transpose(s,s)},e.grayscale=(e,r)=>{const s=1-r,i=t.set(e,.2126+.7874*s,.7152-.7152*s,.0722-.0722*s,0,.2126-.2126*s,.7152+.2848*s,.0722-.0722*s,0,.2126-.2126*s,.7152-.7152*s,.0722+.9278*s,0,0,0,0,1);return t.transpose(i,i)},e.invert=(e,r)=>{const s=1-2*r,i=r,n=t.set(e,s,0,0,i,0,s,0,i,0,0,s,i,0,0,0,1);return t.transpose(n,n)},e.rotateHue=(e,r)=>{const s=Math.sin(r*Math.PI/180),i=Math.cos(r*Math.PI/180),n=t.set(e,.213+.787*i-.213*s,.715-.715*i-.715*s,.072-.072*i+.928*s,0,.213-.213*i+.143*s,.715+.285*i+.14*s,.072-.072*i-.283*s,0,.213-.213*i-.787*s,.715-.715*i+.715*s,.072+.928*i+.072*s,0,0,0,0,1);return t.transpose(n,n)},e.saturate=(e,r)=>{const s=r,i=t.set(e,.213+.787*s,.715-.715*s,.072-.072*s,0,.213-.213*s,.715+.285*s,.072-.072*s,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,1);return t.transpose(i,i)},e.sepia=(e,r)=>{const s=1-r,i=t.set(e,.393+.607*s,.769-.769*s,.189-.189*s,0,.349-.349*s,.686+.314*s,.168-.168*s,0,.272-.272*s,.534-.534*s,.131+.869*s,0,0,0,0,1);return t.transpose(i,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["exports","../factories/vec3f64","./common"],function(e,t,r){"use strict";function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function i(e,t,r,s,i,n,a,o,l,u,c,d,h,p,f,m,y){return e[0]=t,e[1]=r,e[2]=s,e[3]=i,e[4]=n,e[5]=a,e[6]=o,e[7]=l,e[8]=u,e[9]=c,e[10]=d,e[11]=h,e[12]=p,e[13]=f,e[14]=m,e[15]=y,e}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function a(e,t){if(e===t){const r=t[1],s=t[2],i=t[3],n=t[6],a=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=n,e[11]=t[14],e[12]=i,e[13]=a,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function o(e,t){return l(e,t)||n(e),e}function l(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],f=t[12],m=t[13],y=t[14],g=t[15],_=r*o-s*a,b=r*l-i*a,S=r*u-n*a,x=s*l-i*o,v=s*u-n*o,T=i*u-n*l,M=c*m-d*f,F=c*y-h*f,I=c*g-p*f,w=d*y-h*m,R=d*g-p*m,E=h*g-p*y;let A=_*E-b*R+S*w+x*I-v*F+T*M;return A?(A=1/A,e[0]=(o*E-l*R+u*w)*A,e[1]=(i*R-s*E-n*w)*A,e[2]=(m*T-y*v+g*x)*A,e[3]=(h*v-d*T-p*x)*A,e[4]=(l*I-a*E-u*F)*A,e[5]=(r*E-i*I+n*F)*A,e[6]=(y*S-f*T-g*b)*A,e[7]=(c*T-h*S+p*b)*A,e[8]=(a*R-o*I+u*M)*A,e[9]=(s*I-r*R-n*M)*A,e[10]=(f*v-m*S+g*_)*A,e[11]=(d*S-c*v-p*_)*A,e[12]=(o*F-a*w-l*M)*A,e[13]=(r*w-s*F+i*M)*A,e[14]=(m*b-f*x-y*_)*A,e[15]=(c*x-d*b+h*_)*A,e):null}function u(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],a=t[4],o=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],f=t[12],m=t[13],y=t[14],g=t[15];return e[0]=o*(h*g-p*y)-d*(l*g-u*y)+m*(l*p-u*h),e[1]=-(s*(h*g-p*y)-d*(i*g-n*y)+m*(i*p-n*h)),e[2]=s*(l*g-u*y)-o*(i*g-n*y)+m*(i*u-n*l),e[3]=-(s*(l*p-u*h)-o*(i*p-n*h)+d*(i*u-n*l)),e[4]=-(a*(h*g-p*y)-c*(l*g-u*y)+f*(l*p-u*h)),e[5]=r*(h*g-p*y)-c*(i*g-n*y)+f*(i*p-n*h),e[6]=-(r*(l*g-u*y)-a*(i*g-n*y)+f*(i*u-n*l)),e[7]=r*(l*p-u*h)-a*(i*p-n*h)+c*(i*u-n*l),e[8]=a*(d*g-p*m)-c*(o*g-u*m)+f*(o*p-u*d),e[9]=-(r*(d*g-p*m)-c*(s*g-n*m)+f*(s*p-n*d)),e[10]=r*(o*g-u*m)-a*(s*g-n*m)+f*(s*u-n*o),e[11]=-(r*(o*p-u*d)-a*(s*p-n*d)+c*(s*u-n*o)),e[12]=-(a*(d*y-h*m)-c*(o*y-l*m)+f*(o*h-l*d)),e[13]=r*(d*y-h*m)-c*(s*y-i*m)+f*(s*h-i*d),e[14]=-(r*(o*y-l*m)-a*(s*y-i*m)+f*(s*l-i*o)),e[15]=r*(o*h-l*d)-a*(s*h-i*d)+c*(s*l-i*o),e}function c(e){const t=e[0],r=e[1],s=e[2],i=e[3],n=e[4],a=e[5],o=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],y=e[15];return(t*a-r*n)*(d*y-h*m)-(t*o-s*n)*(c*y-h*f)+(t*l-i*n)*(c*m-d*f)+(r*o-s*a)*(u*y-h*p)-(r*l-i*a)*(u*m-d*p)+(s*l-i*o)*(u*f-c*p)}function d(e,t,r){const s=t[0],i=t[1],n=t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],f=t[11],m=t[12],y=t[13],g=t[14],_=t[15];let b=r[0],S=r[1],x=r[2],v=r[3];return e[0]=b*s+S*o+x*d+v*m,e[1]=b*i+S*l+x*h+v*y,e[2]=b*n+S*u+x*p+v*g,e[3]=b*a+S*c+x*f+v*_,b=r[4],S=r[5],x=r[6],v=r[7],e[4]=b*s+S*o+x*d+v*m,e[5]=b*i+S*l+x*h+v*y,e[6]=b*n+S*u+x*p+v*g,e[7]=b*a+S*c+x*f+v*_,b=r[8],S=r[9],x=r[10],v=r[11],e[8]=b*s+S*o+x*d+v*m,e[9]=b*i+S*l+x*h+v*y,e[10]=b*n+S*u+x*p+v*g,e[11]=b*a+S*c+x*f+v*_,b=r[12],S=r[13],x=r[14],v=r[15],e[12]=b*s+S*o+x*d+v*m,e[13]=b*i+S*l+x*h+v*y,e[14]=b*n+S*u+x*p+v*g,e[15]=b*a+S*c+x*f+v*_,e}function h(e,t,r){const s=r[0],i=r[1],n=r[2];if(t===e)e[12]=t[0]*s+t[4]*i+t[8]*n+t[12],e[13]=t[1]*s+t[5]*i+t[9]*n+t[13],e[14]=t[2]*s+t[6]*i+t[10]*n+t[14],e[15]=t[3]*s+t[7]*i+t[11]*n+t[15];else{const r=t[0],a=t[1],o=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7],p=t[8],f=t[9],m=t[10],y=t[11];e[0]=r,e[1]=a,e[2]=o,e[3]=l,e[4]=u,e[5]=c,e[6]=d,e[7]=h,e[8]=p,e[9]=f,e[10]=m,e[11]=y,e[12]=r*s+u*i+p*n+t[12],e[13]=a*s+c*i+f*n+t[13],e[14]=o*s+d*i+m*n+t[14],e[15]=l*s+h*i+y*n+t[15]}return e}function p(e,t,r){const s=r[0],i=r[1],n=r[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,i,n){let a=n[0],o=n[1],l=n[2],u=Math.sqrt(a*a+o*o+l*l);if(u<=r.getEpsilon())return void s(e,t);u=1/u,a*=u,o*=u,l*=u;const c=Math.sin(i),d=Math.cos(i),h=1-d,p=t[0],f=t[1],m=t[2],y=t[3],g=t[4],_=t[5],b=t[6],S=t[7],x=t[8],v=t[9],T=t[10],M=t[11],F=a*a*h+d,I=o*a*h+l*c,w=l*a*h-o*c,R=a*o*h-l*c,E=o*o*h+d,A=l*o*h+a*c,P=a*l*h+o*c,O=o*l*h-a*c,N=l*l*h+d;e[0]=p*F+g*I+x*w,e[1]=f*F+_*I+v*w,e[2]=m*F+b*I+T*w,e[3]=y*F+S*I+M*w,e[4]=p*R+g*E+x*A,e[5]=f*R+_*E+v*A,e[6]=m*R+b*E+T*A,e[7]=y*R+S*E+M*A,e[8]=p*P+g*O+x*N,e[9]=f*P+_*O+v*N,e[10]=m*P+b*O+T*N,e[11]=y*P+S*O+M*N,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}function m(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[4],a=t[5],o=t[6],l=t[7],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*i+u*s,e[5]=a*i+c*s,e[6]=o*i+d*s,e[7]=l*i+h*s,e[8]=u*i-n*s,e[9]=c*i-a*s,e[10]=d*i-o*s,e[11]=h*i-l*s,e}function y(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[0],a=t[1],o=t[2],l=t[3],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i-u*s,e[1]=a*i-c*s,e[2]=o*i-d*s,e[3]=l*i-h*s,e[8]=n*s+u*i,e[9]=a*s+c*i,e[10]=o*s+d*i,e[11]=l*s+h*i,e}function g(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[0],a=t[1],o=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i+u*s,e[1]=a*i+c*s,e[2]=o*i+d*s,e[3]=l*i+h*s,e[4]=u*i-n*s,e[5]=c*i-a*s,e[6]=d*i-o*s,e[7]=h*i-l*s,e}function _(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function b(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t,s){if(0===t)return n(e);let i=s[0],a=s[1],o=s[2],l=Math.sqrt(i*i+a*a+o*o);if(l<=r.getEpsilon())return null;l=1/l,i*=l,a*=l,o*=l;const u=Math.sin(t),c=Math.cos(t),d=1-c;return e[0]=i*i*d+c,e[1]=a*i*d+o*u,e[2]=o*i*d-a*u,e[3]=0,e[4]=i*a*d-o*u,e[5]=a*a*d+c,e[6]=o*a*d+i*u,e[7]=0,e[8]=i*o*d+a*u,e[9]=a*o*d-i*u,e[10]=o*o*d+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function M(e,t,r){const s=t[0],i=t[1],n=t[2],a=t[3],o=s+s,l=i+i,u=n+n,c=s*o,d=s*l,h=s*u,p=i*l,f=i*u,m=n*u,y=a*o,g=a*l,_=a*u;return e[0]=1-(p+m),e[1]=d+_,e[2]=h-g,e[3]=0,e[4]=d-_,e[5]=1-(c+m),e[6]=f+y,e[7]=0,e[8]=h+g,e[9]=f-y,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function F(e,t){const r=I,s=-t[0],i=-t[1],n=-t[2],a=t[3],o=t[4],l=t[5],u=t[6],c=t[7],d=s*s+i*i+n*n+a*a;return d>0?(r[0]=2*(o*a+c*s+l*n-u*i)/d,r[1]=2*(l*a+c*i+u*s-o*n)/d,r[2]=2*(u*a+c*n+o*i-l*s)/d):(r[0]=2*(o*a+c*s+l*n-u*i),r[1]=2*(l*a+c*i+u*s-o*n),r[2]=2*(u*a+c*n+o*i-l*s)),M(e,t,r),e}const I=t.create();function w(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function R(e,t){const r=t[0],s=t[1],i=t[2],n=t[4],a=t[5],o=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.sqrt(r*r+s*s+i*i),e[1]=Math.sqrt(n*n+a*a+o*o),e[2]=Math.sqrt(l*l+u*u+c*c),e}function E(e,t){const r=t[0]+t[5]+t[10];let s=0;return r>0?(s=2*Math.sqrt(r+1),e[3]=.25*s,e[0]=(t[6]-t[9])/s,e[1]=(t[8]-t[2])/s,e[2]=(t[1]-t[4])/s):t[0]>t[5]&&t[0]>t[10]?(s=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/s,e[0]=.25*s,e[1]=(t[1]+t[4])/s,e[2]=(t[8]+t[2])/s):t[5]>t[10]?(s=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/s,e[0]=(t[1]+t[4])/s,e[1]=.25*s,e[2]=(t[6]+t[9])/s):(s=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/s,e[0]=(t[8]+t[2])/s,e[1]=(t[6]+t[9])/s,e[2]=.25*s),e}function A(e,t,r,s){const i=t[0],n=t[1],a=t[2],o=t[3],l=i+i,u=n+n,c=a+a,d=i*l,h=i*u,p=i*c,f=n*u,m=n*c,y=a*c,g=o*l,_=o*u,b=o*c,S=s[0],x=s[1],v=s[2];return e[0]=(1-(f+y))*S,e[1]=(h+b)*S,e[2]=(p-_)*S,e[3]=0,e[4]=(h-b)*x,e[5]=(1-(d+y))*x,e[6]=(m+g)*x,e[7]=0,e[8]=(p+_)*v,e[9]=(m-g)*v,e[10]=(1-(d+f))*v,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function P(e,t,r,s,i){const n=t[0],a=t[1],o=t[2],l=t[3],u=n+n,c=a+a,d=o+o,h=n*u,p=n*c,f=n*d,m=a*c,y=a*d,g=o*d,_=l*u,b=l*c,S=l*d,x=s[0],v=s[1],T=s[2],M=i[0],F=i[1],I=i[2],w=(1-(m+g))*x,R=(p+S)*x,E=(f-b)*x,A=(p-S)*v,P=(1-(h+g))*v,O=(y+_)*v,N=(f+b)*T,C=(y-_)*T,z=(1-(h+m))*T;return e[0]=w,e[1]=R,e[2]=E,e[3]=0,e[4]=A,e[5]=P,e[6]=O,e[7]=0,e[8]=N,e[9]=C,e[10]=z,e[11]=0,e[12]=r[0]+M-(w*M+A*F+N*I),e[13]=r[1]+F-(R*M+P*F+C*I),e[14]=r[2]+I-(E*M+O*F+z*I),e[15]=1,e}function O(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],a=r+r,o=s+s,l=i+i,u=r*a,c=s*a,d=s*o,h=i*a,p=i*o,f=i*l,m=n*a,y=n*o,g=n*l;return e[0]=1-d-f,e[1]=c+g,e[2]=h-y,e[3]=0,e[4]=c-g,e[5]=1-u-f,e[6]=p+m,e[7]=0,e[8]=h+y,e[9]=p-m,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,t,r,s,i,n,a){const o=1/(r-t),l=1/(i-s),u=1/(n-a);return e[0]=2*n*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*o,e[9]=(i+s)*l,e[10]=(a+n)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*n*2*u,e[15]=0,e}function C(e,t,r,s,i){const n=1/Math.tan(t/2);let a;return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(a=1/(s-i),e[10]=(i+s)*a,e[14]=2*i*s*a):(e[10]=-1,e[14]=-2*s),e}function z(e,t,r,s){const i=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(a+o),u=2/(i+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(a-o)*l*.5,e[9]=(i-n)*u*.5,e[10]=s/(r-s),e[11]=-1,e[12]=0,e[13]=0,e[14]=s*r/(r-s),e[15]=0,e}function B(e,t,r,s,i,n,a){const o=1/(t-r),l=1/(s-i),u=1/(n-a);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*o,e[13]=(i+s)*l,e[14]=(a+n)*u,e[15]=1,e}function k(e,t,s,i){const a=t[0],o=t[1],l=t[2];let u=a-s[0],c=o-s[1],d=l-s[2];const h=r.getEpsilon();if(Math.abs(u)<h&&Math.abs(c)<h&&Math.abs(d)<h)return void n(e);let p=1/Math.sqrt(u*u+c*c+d*d);u*=p,c*=p,d*=p;const f=i[0],m=i[1],y=i[2];let g=m*d-y*c,_=y*u-f*d,b=f*c-m*u;p=Math.sqrt(g*g+_*_+b*b),p?(p=1/p,g*=p,_*=p,b*=p):(g=0,_=0,b=0);let S=c*b-d*_,x=d*g-u*b,v=u*_-c*g;p=Math.sqrt(S*S+x*x+v*v),p?(p=1/p,S*=p,x*=p,v*=p):(S=0,x=0,v=0),e[0]=g,e[1]=S,e[2]=u,e[3]=0,e[4]=_,e[5]=x,e[6]=c,e[7]=0,e[8]=b,e[9]=v,e[10]=d,e[11]=0,e[12]=-(g*a+_*o+b*l),e[13]=-(S*a+x*o+v*l),e[14]=-(u*a+c*o+d*l),e[15]=1}function L(e,t,r,s){const i=t[0],n=t[1],a=t[2],o=s[0],l=s[1],u=s[2];let c=i-r[0],d=n-r[1],h=a-r[2],p=c*c+d*d+h*h;p>0&&(p=1/Math.sqrt(p),c*=p,d*=p,h*=p);let f=l*h-u*d,m=u*c-o*h,y=o*d-l*c;return p=f*f+m*m+y*y,p>0&&(p=1/Math.sqrt(p),f*=p,m*=p,y*=p),e[0]=f,e[1]=m,e[2]=y,e[3]=0,e[4]=d*y-h*m,e[5]=h*f-c*y,e[6]=c*m-d*f,e[7]=0,e[8]=c,e[9]=d,e[10]=h,e[11]=0,e[12]=i,e[13]=n,e[14]=a,e[15]=1,e}function U(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function j(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function D(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function G(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function q(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function V(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e[6]=t[6]+r[6]*s,e[7]=t[7]+r[7]*s,e[8]=t[8]+r[8]*s,e[9]=t[9]+r[9]*s,e[10]=t[10]+r[10]*s,e[11]=t[11]+r[11]*s,e[12]=t[12]+r[12]*s,e[13]=t[13]+r[13]*s,e[14]=t[14]+r[14]*s,e[15]=t[15]+r[15]*s,e}function Q(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Z(e,t){if(e===t)return!0;const s=e[0],i=e[1],n=e[2],a=e[3],o=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=e[9],p=e[10],f=e[11],m=e[12],y=e[13],g=e[14],_=e[15],b=t[0],S=t[1],x=t[2],v=t[3],T=t[4],M=t[5],F=t[6],I=t[7],w=t[8],R=t[9],E=t[10],A=t[11],P=t[12],O=t[13],N=t[14],C=t[15],z=r.getEpsilon();return Math.abs(s-b)<=z*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(i-S)<=z*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(n-x)<=z*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-v)<=z*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(o-T)<=z*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(l-M)<=z*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(u-F)<=z*Math.max(1,Math.abs(u),Math.abs(F))&&Math.abs(c-I)<=z*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(d-w)<=z*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(h-R)<=z*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(p-E)<=z*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(f-A)<=z*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(m-P)<=z*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(y-O)<=z*Math.max(1,Math.abs(y),Math.abs(O))&&Math.abs(g-N)<=z*Math.max(1,Math.abs(g),Math.abs(N))&&Math.abs(_-C)<=z*Math.max(1,Math.abs(_),Math.abs(C))}function Y(e){const t=r.getEpsilon(),s=e[0],i=e[1],n=e[2],a=e[4],o=e[5],l=e[6],u=e[8],c=e[9],d=e[10];return Math.abs(1-(s*s+a*a+u*u))<=t&&Math.abs(1-(i*i+o*o+c*c))<=t&&Math.abs(1-(n*n+l*l+d*d))<=t}function $(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}const W=d,X=G,H=Object.freeze(Object.defineProperty({__proto__:null,add:D,adjoint:u,copy:s,determinant:c,equals:Z,exactEquals:Q,frob:j,fromQuat:O,fromQuat2:F,fromRotation:S,fromRotationTranslation:M,fromRotationTranslationScale:A,fromRotationTranslationScaleOrigin:P,fromScaling:b,fromTranslation:_,fromXRotation:x,fromYRotation:v,fromZRotation:T,frustum:N,getRotation:E,getScale:R,getTranslation:w,hasIdentityRotation:$,identity:n,invert:l,invertOrIdentity:o,isOrthoNormal:Y,lookAt:k,mul:W,multiply:d,multiplyScalar:q,multiplyScalarAndAdd:V,ortho:B,perspective:C,perspectiveFromFieldOfView:z,rotate:f,rotateX:m,rotateY:y,rotateZ:g,scale:p,set:i,str:U,sub:X,subtract:G,targetTo:L,translate:h,transpose:a},Symbol.toStringTag,{value:"Module"}));e.add=D,e.adjoint=u,e.copy=s,e.determinant=c,e.equals=Z,e.exactEquals=Q,e.frob=j,e.fromQuat=O,e.fromQuat2=F,e.fromRotation=S,e.fromRotationTranslation=M,e.fromRotationTranslationScale=A,e.fromRotationTranslationScaleOrigin=P,e.fromScaling=b,e.fromTranslation=_,e.fromXRotation=x,e.fromYRotation=v,e.fromZRotation=T,e.frustum=N,e.getRotation=E,e.getScale=R,e.getTranslation=w,e.hasIdentityRotation=$,e.identity=n,e.invert=l,e.invertOrIdentity=o,e.isOrthoNormal=Y,e.lookAt=k,e.mat4=H,e.mul=W,e.multiply=d,e.multiplyScalar=q,e.multiplyScalarAndAdd=V,e.ortho=B,e.perspective=C,e.perspectiveFromFieldOfView=z,e.rotate=f,e.rotateX=m,e.rotateY=y,e.rotateZ=g,e.scale=p,e.set=i,e.str=U,e.sub=X,e.subtract=G,e.targetTo=L,e.translate=h,e.transpose=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapDefinitions":function(){define(["exports","../assets","../intl/messages"],function(e,t,r){"use strict";const s={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}};e.esriBasemapDefinitions=s,e.getBasemapTitle=async function(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,s=await r.fetchMessageBundle("esri/t9n/basemaps");return s[e]||s[t]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl/messages":function(){define(["exports","../core/Error","../core/handleUtils","../core/promiseUtils","./locale"],function(e,t,r,s,i){"use strict";const n={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function a(e){if(function(e){return e in n}(e)){const t=n[e];return!0===t?e:t}return null}const o=[],l=new Map;function u(e){for(const t of l.keys())c(e.pattern,t)&&l.delete(t)}function c(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}i.beforeLocaleChange(()=>{l.clear()});const d=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=s.createResolver())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}},h={cache:l,loaders:o};e.fetchMessageBundle=async function(e){const r=i.getLocale();l.has(e)||l.set(e,async function(e,r){const s=[];for(const t of o)if(c(t.pattern,e))try{return await t.fetchMessageBundle(e,r)}catch(e){s.push(e)}if(s.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:s});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,r));const s=l.get(e);return s&&await d.add(s),s},e.messageBundlesLocaleMap=n,e.normalizeMessageBundleLocale=function(e){const t=i.getLocaleLanguage(e);return t?a(e)??a(t):null},e.registerMessageBundleLoader=function(e){return o.includes(e)||(u(e),o.unshift(e)),r.makeHandle(()=>{const t=o.indexOf(e);t>-1&&(o.splice(t,1),u(e))})},e.test=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(e,t,r){"use strict";const s=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,i=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),n=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),a=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function o(e){return null==e||"string"==typeof e&&!e?"<Null>":e}function l(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,s=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!s}function u(e){const{values:t,useSampleStdDev:r,supportsNullCount:s,outStatisticTypes:i}=e;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY,o=null,l=null,u=null,d=null,h=0;const p=null==e.minValue?-1/0:e.minValue,f=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=p&&e<=f&&(o=null===o?e:o+e,n=Math.min(n,e),a=Math.max(a,e),h++):"string"==typeof e&&h++;if(h&&null!=o){l=o/h;let e=0;for(const r of t)Number.isFinite(r)&&r>=p&&r<=f&&(e+=(r-l)**2);d=r?h>1?e/(h-1):0:h>0?e/h:0,u=Math.sqrt(d)}else n=null,a=null;const m={avg:l,count:h,max:a,min:n,stddev:u,sum:o,variance:d};return s&&(m.nullcount=t.length-h),!e.percentileParams||i?.include?.length&&!i.include.includes("median")||i?.exclude?.length&&i.exclude.includes("median")||(m.median=c(t,e.percentileParams)),m}function c(e,t){const{fieldType:r,value:s,orderBy:i,isDiscrete:n}=t,a=d(r,"desc"===i);if(0===(e=[...e].filter(e=>null!=e).sort((e,t)=>a(e,t))).length)return null;if(s<=0)return e[0];if(s>=1)return e[e.length-1];const o=(e.length-1)*s,l=Math.floor(o),u=l+1,c=o%1,h=e[l],p=e[u];return u>=e.length||n||"string"==typeof h||"string"==typeof p?h:h*(1-c)+p*c}function d(e,t){if(e){if(i.has(e))return v(t);if(n.has(e))return b(t,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?y:m}(t);const r=b(t,!0);if("esriFieldTypeString"===e)return r;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,t)=>r(T(e),T(t))}const r=t?1:-1,s=v(t),a=b(t,!0),o=f(t);return(e,t)=>"number"==typeof e&&"number"==typeof t?s(e,t):"string"==typeof e&&"string"==typeof t?a(e,t):o(e,t)??r}const h=(e,t)=>null==e?null==t?0:1:null==t?-1:null,p=(e,t)=>null==e?null==t?0:-1:null==t?1:null;function f(e){return e?h:p}const m=(e,t)=>p(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),y=(e,t)=>h(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime()),g=(e,t)=>p(e,t)??(e===t?0:e<t?-1:1),_=(e,t)=>h(e,t)??(e===t?0:e<t?1:-1);function b(e,t){if(!t)return e?_:g;const r=f(e);return e?(e,t)=>{const s=r(e,t);return null!=s?s:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const s=r(e,t);return null!=s?s:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}const S=(e,t)=>h(e,t)??t-e,x=(e,t)=>p(e,t)??e-t;function v(e){return e?S:x}function T(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function M(e){return"coded-value"!==e?.type?[]:e.codedValues.map(e=>e.code)}function F(e,t,s){const i=I({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,definedInterval:t.definedInterval,breakCount:t.numClasses||5});return e=function(e,t,r){const s=t??-1/0,i=r??1/0;return e.filter(e=>Number.isFinite(e)&&e>=s&&e<=i)}(e,t.minValue,t.maxValue),r.createGenerateRendererClassBreaks({definition:i,values:e,normalizationTotal:t.normalizationTotal},s)}function I(e){const{breakCount:r,field:s,normalizationField:i,normalizationType:n}=e,a=e.classificationMethod||"equal-interval",o="standard-deviation"===a?e.standardDeviationInterval||1:void 0,l="defined-interval"===a?e.definedInterval:void 0;return new t({breakCount:r,classificationField:s,classificationMethod:a,normalizationField:"field"===n?i:void 0,normalizationType:n,standardDeviationInterval:o,definedInterval:l})}function w(e,t,r=!1){const{field:s,classificationMethod:i,standardDeviationInterval:n,definedInterval:a,normalizationType:o,normalizationField:c,normalizationTotal:d,minValue:h,maxValue:p}=t,f=t.numBins||10;let m=null,y=null,g=null;if(i&&"equal-interval"!==i||o){const{classBreaks:t}=F(e,{field:s,normalizationType:o,normalizationField:c,normalizationTotal:d,classificationMethod:i,standardDeviationInterval:n,definedInterval:a,minValue:h,maxValue:p,numClasses:f},null!=h&&null!=p?[h,p]:void 0);m=t[0]?.minValue,y=t[t.length-1]?.maxValue,g=t.map(e=>[e.minValue,e.maxValue])}else{if(null!=h&&null!=p)m=h,y=p;else{const t=u({values:e,minValue:h,maxValue:p,useSampleStdDev:!o,supportsNullCount:l({normalizationType:o,normalizationField:c,minValue:h,maxValue:p})});m=t.min??null,y=t.max??null}g=E(m??0,y??0,f)}if(r&&g.length){const e=g.at(-1)[1];g.push([e,e])}return{min:m,max:y,intervals:g}}function R(e,t){let r=-1;for(let s=e.length-1;s>=0;s--)if(t>=e[s][0]){r=s;break}return r}function E(e,t,r){const s=(t-e)/r,i=[];let n,a=e;for(let e=1;e<=r;e++)n=a+s,n=Number(n.toFixed(16)),i.push([a,e===r?t:n]),a=n;return i}e.binIndex=R,e.calculateClassBreaks=F,e.calculateHistogram=function(e,t){const r=w(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};const s=r.intervals,i=r.min??0,n=r.max??0,a=s.map((e,t)=>({minValue:s[t][0],maxValue:s[t][1],count:0}));for(const t of e)if(null!=t&&t>=i&&t<=n){const e=R(s,t);e>-1&&a[e].count++}return{bins:a,minValue:i,maxValue:n,normalizationTotal:t.normalizationTotal}},e.calculatePercentile=c,e.calculateStatistics=u,e.calculateStringStatistics=function(e){const{outStatisticTypes:t}=e,r=e.returnDistinct?[...new Set(e.values)]:e.values,s=r.filter(e=>null!=e).sort(),i=s.length,n={count:i,min:s[0],max:s[i-1]};return e.supportsNullCount&&(n.nullcount=r.length-i),!e.percentileParams||t?.include?.length&&!t.include.includes("median")||t?.exclude?.length&&t.exclude.includes("median")||(n.median=c(r,e.percentileParams)),n},e.calculateUniqueValuesCount=function(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}},e.createClassBreaksDefinition=I,e.createUVResult=function(e,t,r,s){const i=e.count,n=[];if(r&&t){const e=[],r=M(t[0]);for(const i of r)if(t[1]){const r=M(t[1]);for(const n of r)if(t[2]){const r=M(t[2]);for(const t of r)e.push(`${o(i)}${s}${o(n)}${s}${o(t)}`)}else e.push(`${o(i)}${s}${o(n)}`)}else e.push(i);for(const t of e)i.hasOwnProperty(t)||(i[t]={data:t,count:0})}for(const e in i){const t=i[e];n.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:n}},e.getAttributeComparator=d,e.getBinParams=w,e.getEqualIntervalBins=E,e.getNormalizedValue=function(e,t,r,s){let i=null;switch(t){case"log":0!==e&&(i=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(s)&&0!==s&&(i=e/s*100);break;case"field":Number.isFinite(r)&&0!==r&&(i=e/r);break;case"natural-log":e>0&&(i=Math.log(e));break;case"square-root":e>0&&(i=e**.5)}return i},e.isNullCountSupported=l,e.processNullValue=o,e.processSummaryStatisticsResult=function(e,t,r){let s;for(s in e)t?.include?.length&&!t.include.includes(s)||t?.exclude?.length&&t.exclude.includes(s)?delete e[s]:a.includes(s)&&(Number.isFinite(e[s])||(e[s]=null));return r?(["avg","stddev","variance"].forEach(t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]??0))}),e):e},e.resolveCBResult=function(e,t){let r=e.classBreaks;const i=r.length,n=r[0]?.minValue,a=r[i-1]?.maxValue,o="standard-deviation"===t,l=s;return r=r.map(e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(o&&t){const e=t.match(l),s=e?.map(e=>+e.trim())??[];2===s.length?(r.minStdDev=s[0],r.maxStdDev=s[1],s[0]<0&&s[1]>0&&(r.hasAvg=!0)):1===s.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=s[0]):t.includes(">")&&(r.minStdDev=s[0],r.maxStdDev=null))}return r}),{minValue:n,maxValue:a,classBreakInfos:r,normalizationTotal:e.normalizationTotal}},e.statisticTypes=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,a,o,l,u){"use strict";const c=new r.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),d=new r.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});return e.default=class extends s.JSONSupport{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}},t.__decorate([l.enumeration({classBreaksDef:"class-breaks-definition"})],e.default.prototype,"type",void 0),t.__decorate([i.property({json:{write:!0}})],e.default.prototype,"breakCount",void 0),t.__decorate([i.property({json:{write:!0}})],e.default.prototype,"classificationField",void 0),t.__decorate([i.property({type:String,json:{read:c.read,write:c.write}})],e.default.prototype,"classificationMethod",void 0),t.__decorate([i.property({json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([i.property({json:{read:d.read,write:d.write}})],e.default.prototype,"normalizationType",void 0),t.__decorate([i.property({value:null,json:{write:!0}})],e.default.prototype,"standardDeviationInterval",null),t.__decorate([i.property({value:null,json:{write:!0}})],e.default.prototype,"definedInterval",null),e.default=t.__decorate([u.subclass("esri.rest.support.ClassBreaksDefinition")],e.default),e.default})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(e,t){"use strict";function r(e,t){return Number(e.toFixed(t))}function s(e,t,r){let s=null;return s=e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t,s}function i(e){const t=[],r=[];let s=Number.MIN_VALUE,i=1,n=-1;for(let a=0;a<e.length;a++){const o=e[a];o===s?(i++,r[n]=i):null!==o&&(t.push(o),s=o,i=1,r.push(i),n++)}return{uniqueValues:t,valueFrequency:r}}function n(e,t,r,s){let i=[],n=[],o=[],l=0;const u=[],c=[];for(let i=0;i<s;i++){const s=a(i,e,t,r);u.push(s.sbMean),c.push(s.sbSdcm),l+=c[i]}let d,h=l,p=!0;for(;p||l<h;){p=!1,i=[];for(let t=0;t<s;t++)i.push(e[t]);for(let r=0;r<s;r++)for(let i=e[r]+1;i<=e[r+1];i++)if(d=t[i],r>0&&i!==e[r+1]&&Math.abs(d-u[r])>Math.abs(d-u[r-1]))e[r]=i;else if(r<s-1&&e[r]!==i-1&&Math.abs(d-u[r])>Math.abs(d-u[r+1])){e[r+1]=i-1;break}h=l,l=0,n=[],o=[];for(let i=0;i<s;i++){n.push(u[i]),o.push(c[i]);const s=a(i,e,t,r);u[i]=s.sbMean,c[i]=s.sbSdcm,l+=c[i]}}if(l>h){for(let t=0;t<s;t++)e[t]=i[t],u[t]=n[t],c[t]=o[t];l=h}return{mean:u,sdcm:c}}function a(e,r,s,i){let n=0,a=0;for(let t=r[e]+1;t<=r[e+1];t++){const e=i[t];n+=s[t]*e,a+=e}a<=0&&t.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");const o=n/a;let l=0;for(let t=r[e]+1;t<=r[e+1];t++)l+=i[t]*(s[t]-o)**2;return{sbMean:o,sbSdcm:l}}e.createGenerateRendererClassBreaks=function(e,t){const{normalizationTotal:o}=e;return{classBreaks:function(e,t){const o=e.definition,{classificationMethod:l,normalizationType:u,definedInterval:c}=o,d=o.breakCount??1,h=[];let p=e.values;if(0===p.length)return[];p=p.sort((e,t)=>e-t);const[f,m]=t??[p.at(0),p.at(-1)];if("equal-interval"===l)if(p.length>=d){const e=(m-f)/d;let t=f;for(let i=1;i<d;i++){const n=r(f+i*e,6);h.push({minValue:t,maxValue:n,label:s(t,n,u)}),t=n}h.push({minValue:t,maxValue:m,label:s(t,m,u)})}else p.forEach(e=>{h.push({minValue:e,maxValue:e,label:s(e,e,u)})});else if("natural-breaks"===l){const t=i(p),o=e.valueFrequency||t.valueFrequency,l=function(e,t,r){const s=e.length,i=[];r>s&&(r=s);for(let e=0;e<r;e++)i.push(Math.round(e*s/r-1));i.push(s-1);let o=n(i,e,t,r);return function(e,t,r,s,i,n){let o=0,l=0,u=0,c=0,d=!0;for(let h=0;h<2&&d;h++){0===h&&(d=!1);for(let h=0;h<n-1;h++)for(;r[h+1]+1!==r[h+2];){r[h+1]=r[h+1]+1;const n=a(h,r,s,i);u=n.sbMean,o=n.sbSdcm;const p=a(h+1,r,s,i);if(c=p.sbMean,l=p.sbSdcm,!(o+l<t[h]+t[h+1])){r[h+1]=r[h+1]-1;break}t[h]=o,t[h+1]=l,e[h]=u,e[h+1]=c,d=!0}for(let h=n-1;h>0;h--)for(;r[h]!==r[h-1]+1;){r[h]=r[h]-1;const n=a(h-1,r,s,i);u=n.sbMean,o=n.sbSdcm;const p=a(h,r,s,i);if(c=p.sbMean,l=p.sbSdcm,!(o+l<t[h-1]+t[h])){r[h]=r[h]+1;break}t[h-1]=o,t[h]=l,e[h-1]=u,e[h]=c,d=!0}}return d}(o.mean,o.sdcm,i,e,t,r)&&(o=n(i,e,t,r)),i}(t.uniqueValues,o,d);let c=f;for(let e=1;e<d;e++)if(t.uniqueValues.length>e){const i=r(t.uniqueValues[l[e]],6);h.push({minValue:c,maxValue:i,label:s(c,i,u)}),c=i}h.push({minValue:c,maxValue:m,label:s(c,m,u)})}else if("quantile"===l)if(p.length>=d&&f!==m){let e=f,t=Math.ceil(p.length/d),r=0;for(let i=1;i<d;i++){let n=t+r-1;n>p.length&&(n=p.length-1),n<0&&(n=0),h.push({minValue:e,maxValue:p[n],label:s(e,p[n],u)}),e=p[n],r+=t,t=Math.ceil((p.length-r)/(d-i))}h.push({minValue:e,maxValue:m,label:s(e,m,u)})}else{let e=-1;for(let t=0;t<p.length;t++){const r=p[t];r!==e&&(e=r,h.push({minValue:e,maxValue:r,label:s(e,r,u)}),e=r)}}else if("standard-deviation"===l){const e=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(p),t=function(e,t){let r=0;for(let s=0;s<e.length;s++){const i=e[s];r+=(i-t)*(i-t)}return r/=e.length,Math.sqrt(r)}(p,e);if(0===t)h.push({minValue:p[0],maxValue:p[0],label:s(p[0],p[0],u)});else{const i=function(e,t,r,s,i){let n=Math.max(s-e,t-s)/i/r;return n=n>=1?1:n>=.5?.5:.25,n}(f,m,d,e,t),n=i*t;let a=0,o=f;for(let t=d;t>=1;t--){const i=r(e-(t-.5)*n,6);h.push({minValue:o,maxValue:i,label:s(o,i,u)}),o=i,a++}let l=r(e+.5*n,6);h.push({minValue:o,maxValue:l,label:s(o,l,u)}),o=l,a++;for(let t=1;t<=d;t++)l=a===2*d?m:r(e+(t+.5)*n,6),h.push({minValue:o,maxValue:l,label:s(o,l,u)}),o=l,a++}}else if("defined-interval"===l){if(!c)return h;const[e,i]=t??[p.at(0),p.at(-1)],n=Math.ceil((i-e)/c);let a=e;for(let t=1;t<n;t++){const i=r(e+t*c,6);h.push({minValue:a,maxValue:i,label:s(a,i,u)}),a=i}h.push({minValue:a,maxValue:i,label:s(a,i,u)})}return h}(e,t),normalizationTotal:o}},e.createGenerateRendererUniqueValues=function(e){const t=i(e),r=[],s=t.uniqueValues.length;for(let e=0;e<s;e++){const s=t.uniqueValues[e],i=t.valueFrequency[e],n=s.toString();r.push({value:s,count:i,label:n})}return{uniqueValues:r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define(["require","exports","../../../core/Error","../../../core/jsonMap","../../../core/unitUtils","../../../geometry/projectionUtils","../../../geometry/support/extentUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","./projectionSupport"],function(e,t,r,s,i,n,a,o,l,u,c){"use strict";const d=new s.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),h=Object.freeze({});async function p(e,t,r){const{outFields:s,orderByFields:i,groupByFieldsForStatistics:n,outStatistics:a}=e;if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),f(e,t,r)}async function f(t,s,n){if(!t)return null;let{where:p}=t;if(t.where=p=p?.trim(),(!p||/^1 *= *1$/.test(p)||s&&s===p)&&(t.where=null),!t.geometry)return t;let f=await async function(t){const{distance:s,units:n}=t,a=t.geometry;if(null==s||"vertexAttributes"in a)return a;const l=a.spatialReference,h=n?d.fromJSON(n):i.getUnitString(l),p=l&&(u.isGeographic(l)||u.isWebMercator(l))?a:await c.checkProjectionSupport(l,u.wgs84).then(()=>c.project(a,u.wgs84)),f=await new Promise((t,r)=>e(["../../../geometry/operators/json/geodesicBufferOperator"],t,r));await f.load();const m=f.execute(p,s||1,{unit:h})??void 0;if(!m||!o.isPolygon(m)||0===m.rings.length)throw new r("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return m}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;f=a.getGeometryExtent(f),f.spatialReference=e}if(f){await c.checkProjectionSupport(f.spatialReference,n),f=function(e,t){const r=e.spatialReference;return m(e,t)&&o.isExtent(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(f,n);const e=(await l.normalizeCentralMeridian(o.fromJSON(f)))[0];if(null==e)throw h;const r="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,s=r&&m(f,n)?{densificationStep:8*r}:void 0,i=e.toJSON(),a=c.project(i,i.spatialReference,n,s);if(!a)throw h;a.spatialReference=n,t.geometry=a}return t}function m(e,t){if(!e)return!1;const r=e.spatialReference;return(o.isExtent(e)||o.isPolygon(e)||o.isPolyline(e))&&!u.equals(r,t)&&!n.canProjectWithoutEngine(r,t)}t.getDateInNumber=function(e,t){return null==e?null:"string"==typeof e?t?new Date(`1970-01-01T${e}Z`).getTime():new Date(e).getTime():e instanceof Date?e.getTime():e},t.normalizeAttributeBinsQuery=async function(e,t,r){const s=e.bin;return s.onField&&(s.onField=s.onField.trim()),s.onExpression?.value&&(s.onExpression.value=s.onExpression.value.trim()),s.splitBy&&(s.splitBy.value&&(s.splitBy.value=s.splitBy.value.trim()),s.splitBy.outAlias&&(s.splitBy.outAlias=s.splitBy.outAlias.trim())),s.stackBy&&(s.stackBy.value&&(s.stackBy.value=s.stackBy.value.trim()),s.stackBy.outAlias&&(s.stackBy.outAlias=s.stackBy.outAlias.trim())),"normalizationField"in s.parameters&&s.parameters.normalizationField&&(s.parameters.normalizationField=s.parameters.normalizationField.trim()),e.outStatistics?.length||(e.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:"frequency"}]),p(e,t,r)},t.normalizeQuery=p,t.normalizeQueryLike=f,t.queryEngineEmptyResult=h,t.unitsKebabDict=d,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(e){"use strict";e.makeEdgeCandidate=function(e,t,r,s,i,n=!1){return{objectId:e,target:t,distance:r,type:"edge",start:s,end:i,draped:n}},e.makeVertexCandidate=function(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/AutoIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,s,i,n,a,o,l,u,c){"use strict";function d(e,t,s){r.setDeepValue(s,e instanceof Date?e.getTime():e,t)}return e.default=class extends(c.NormalizationBinParametersMixin(u)){constructor(e){super(e),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}},t.__decorate([s.property({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],e.default.prototype,"numBins",void 0),t.__decorate([s.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([s.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([o.enumeration({autoIntervalBin:"auto-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.AutoIntervalBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/rest/support/BinParametersBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./AttributeBinsGrouping"],function(e,t,r,s,i,n,a,o,l,u,c,d){"use strict";const h=new s.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),p=new s.JSONMap({naturalLog:"natural-log",squareRoot:"square-root"});return e.default=class extends(r.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}},t.__decorate([n.property({type:String,json:{name:"onExpression.value",write:!0}})],e.default.prototype,"expression",void 0),t.__decorate([u.enumeration(h,{name:"onExpression.valueType"})],e.default.prototype,"expressionValueType",void 0),t.__decorate([n.property({type:String,json:{name:"onField",write:!0}})],e.default.prototype,"field",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"firstDayOfWeek",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"hideUpperBound",void 0),t.__decorate([n.property({type:d,json:{write:{overridePolicy(){return{enabled:null!=this.splitBy?.value||null!=this.splitBy?.type}}}}})],e.default.prototype,"splitBy",void 0),t.__decorate([n.property({type:d,json:{write:{target:{stackBy:{type:d},jsonStyle:{type:String}},writer:(e,t)=>{e&&(t.stackBy=e.toJSON(),null!=e.responseType&&(t.jsonStyle=e.responseType))},overridePolicy(){return{enabled:null!=this.stackBy?.value||null!=this.stackBy?.type}}},read:{source:["stackBy","jsonStyle"],reader:(e,t)=>d.fromJSON({...t.stackBy,responseType:t.jsonStyle})}}})],e.default.prototype,"stackBy",void 0),t.__decorate([u.enumeration(p)],e.default.prototype,"transformation",void 0),e.default=t.__decorate([c.subclass("esri.rest.support.BinParametersBase")],e.default),e.default})},"esri/rest/support/AttributeBinsGrouping":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,a,o,l,u){"use strict";const c=new r.JSONMap({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let d=class extends(t.ClonableMixin(s.JSONSupport)){constructor(e){super(e),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};e.__decorate([i.property({type:String,json:{name:"outAlias",write:!0}})],d.prototype,"alias",void 0),e.__decorate([i.property({type:String})],d.prototype,"responseType",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"type",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"value",void 0),e.__decorate([l.enumeration(c)],d.prototype,"valueType",void 0),d=e.__decorate([u.subclass("esri.rest.support.AttributeBinsGrouping")],d);const h=d;return d.from=n.ensureType(d),h})},"esri/rest/support/NormalizationBinParametersMixin":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,a,o,l){"use strict";const u=r.strict()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),c="percent-of-total",d="field";e.NormalizationBinParametersMixin=e=>{const r=e;let n=class extends r{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&d||r&&c||null,t&&r&&s.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==d&&e!==c||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}};return t.__decorate([i.property({type:String,json:{name:"parameters.normalizationField",write:!0}})],n.prototype,"normalizationField",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],n.prototype,"normalizationMaxValue",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],n.prototype,"normalizationMinValue",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],n.prototype,"normalizationTotal",void 0),t.__decorate([o.enumeration(u,{name:"parameters.normalizationType"})],n.prototype,"normalizationType",null),n=t.__decorate([l.subclass("esri.rest.support.NormalizationBinParametersMixin")],n),n},e.normalizationTypeJsonMap=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/DateBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./DateBinTimeInterval"],function(e,t,r,s,i,n,a,o,l,u,c){"use strict";function d(e,t,s){r.setDeepValue(s,"string"==typeof e?e:e?.getTime(),t)}function h(e,t){const r=e.parameters[t];return r?"string"==typeof r?r:new Date(r):null}return e.default=class extends u{constructor(e){super(e),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=!1,this.start=null,this.snapToData=null,this.type="date"}},t.__decorate([s.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.end",read:{reader:(e,t)=>h(t,"end")},write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([s.property({type:c,json:{name:"parameters",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([s.property({type:c,json:{name:"parameters.offset",write:!0}})],e.default.prototype,"offset",void 0),t.__decorate([s.property({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],e.default.prototype,"returnFullIntervalBin",void 0),t.__decorate([s.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.start",read:{reader:(e,t)=>h(t,"start")},write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([s.property({type:String,json:{name:"parameters.snapToData",write:!0}})],e.default.prototype,"snapToData",void 0),t.__decorate([o.enumeration({dateBin:"date"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.DateBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/rest/support/DateBinTimeInterval":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./DateBinUtils"],function(e,t,r,s,i,n,a,o,l,u){"use strict";let c=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.value=null,this.unit=null}};e.__decorate([s.property({type:Number,json:{name:"number",write:!0}})],c.prototype,"value",void 0),e.__decorate([o.enumeration(u.unitsDict)],c.prototype,"unit",void 0),c=e.__decorate([l.subclass("esri.rest.support.DateBinTimeInterval")],c);const d=c;return c.from=i.ensureType(c),d})},"esri/rest/support/DateBinUtils":function(){define(["exports","../../core/jsonMap"],function(e,t){"use strict";const r=t.strict()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"});e.unitsDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/FixedBoundariesBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase"],function(e,t,r,s,i,n,a,o,l,u){"use strict";return e.default=class extends u{constructor(e){super(e),this.boundaries=[],this.type="fixed-boundaries"}},t.__decorate([s.property({json:{name:"parameters.boundaries",write:{writer:function(e,t,s){r.setDeepValue(s,e&&e[0]instanceof Date?e.map(e=>e.getTime()):e,t)}}}})],e.default.prototype,"boundaries",void 0),t.__decorate([o.enumeration({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedBoundariesBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/rest/support/FixedIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,s,i,n,a,o,l,u,c){"use strict";function d(e,t,s){r.setDeepValue(s,e instanceof Date?e.getTime():e,t)}return e.default=class extends(c.NormalizationBinParametersMixin(u)){constructor(e){super(e),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}},t.__decorate([s.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([s.property({type:Number,json:{name:"parameters.interval",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([s.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([o.enumeration({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedIntervalBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/layers/graphics/data/queryValidationUtils":function(){define(["exports","../../../core/Error","./attributeSupport","./projectionSupport","./spatialQuerySupport","../../../support/loadArcade"],function(e,t,r,s,i,n){"use strict";const a="unsupported-query";async function o(e,{fieldsIndex:n,geometryType:o,spatialReference:c,availableFields:d}){if(null!=e.geometryPrecision||e.multipatchOption&&"xyFootprint"!==e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new t(a,"Unsupported query options",{query:e});return l(n,d,e),function(e,s,i){const{outStatistics:n,groupByFieldsForStatistics:o,having:l}=i,c=o?.length,d=n?.length;if(l){if(!c||!d)throw new t(a,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:i});r.validateHaving(e,s,l,n,i)}if(d){if(!function(e){return null!=e&&e.every(e=>"exceedslimit"!==e.statisticType)}(n))return;const l=n.map(e=>e.onStatisticField).filter(Boolean);r.validateFields(e,s,l,{expressionName:"onStatisticFields",query:i}),c&&r.validateFields(e,s,o,{expressionName:"groupByFieldsForStatistics",query:i});for(const o of n){const{onStatisticField:n,statisticType:l}=o;if("percentile_disc"!==l&&"percentile_cont"!==l||!("statisticParameters"in o))e.get(n)&&"count"!==l&&"min"!==l&&"max"!==l&&r.validateFields(e,s,[n],{expressionName:`outStatistics with '${l}' statistic type`,allowedFieldTypes:u,query:i});else{const{statisticParameters:e}=o;if(!e)throw new t(a,"statisticParameters should be set for percentile type",{definition:o,query:i})}}}}(n,d,e),Promise.all([i.checkSpatialQuerySupport(e,o,c),s.checkProjectionSupport(c,e.outSR)]).then(()=>e)}function l(e,s,i){const{returnDistinctValues:n,outStatistics:o}=i,l=o?o.map(e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if("orderByFields"in i&&i.orderByFields&&i.orderByFields.length>0){const t=" asc",n=" desc",a=i.orderByFields.map(e=>{const r=e.toLowerCase();return r.includes(t)?r.split(t)[0]:r.includes(n)?r.split(n)[0]:e}).filter(e=>!l.includes(e));r.validateFields(e,s,a,{expressionName:"orderByFields",query:i})}if("outFields"in i)if(i.outFields?.length)r.validateFields(e,s,i.outFields,{expressionName:"outFields",query:i,allowedFieldTypes:"all"});else if(n)throw new t(a,"outFields should be specified for returnDistinctValues",{query:i});r.validateWhere(e,s,i.where,i)}const u=new Set([...r.numericFieldTypes,...r.allDateAndTimeFieldTypes]);async function c(e,s,i,o){let l=[];if(i.valueExpression){const{arcadeUtils:e}=await n.loadArcade();l=e.extractFieldNames(i.valueExpression)}if(i.field&&l.push(i.field),i.field2&&l.push(i.field2),i.field3&&l.push(i.field3),i.normalizationField&&l.push(i.normalizationField),!l.length&&!i.valueExpression)throw new t(a,"field or valueExpression is required",{params:i});r.validateFields(e,s,l,{expressionName:"statistics",query:o})}e.validateAttributeBinsQuery=async function(e,r){const s=e.bin;if(!s.onField&&!s.onExpression?.value||"autoIntervalBin"===s.type&&null==s.parameters.numberOfBins||"dateBin"===s.type&&(null==s.parameters.number||null==s.parameters.unit)||"fixedBoundariesBin"===s.type&&null==s.parameters.boundaries||"fixedIntervalBin"===s.type&&null==s.parameters.interval)throw new t(a,"Unsupported query options",{query:e});return o(e,r)},e.validateQuery=o,e.validateStatisticsQuery=async function(e,r,{fieldsIndex:n,geometryType:o,spatialReference:u,availableFields:d}){if(null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new t(a,"Unsupported query options",{query:e});return l(n,d,e),Promise.all([c(n,d,r,e),i.checkSpatialQuerySupport(e,o,u),s.checkProjectionSupport(u,e.outSR)]).then(()=>e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define(["require","exports","../../../core/Error","../../../geometry/support/contains","../../../geometry/support/intersects","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../contains","../featureConversionUtils","../OptimizedGeometry","./geometryUtils","./projectionSupport"],function(e,t,r,s,i,n,a,o,l,u,c,d){"use strict";const h="unsupported-query",p={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},f={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1},y={esriSpatialRelIntersects:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/intersectsOperator"],t,r)),esriSpatialRelContains:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/containsOperator"],t,r)),esriSpatialRelCrosses:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/crossesOperator"],t,r)),esriSpatialRelDisjoint:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/disjointOperator"],t,r)),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/overlapsOperator"],t,r)),esriSpatialRelTouches:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/touchesOperator"],t,r)),esriSpatialRelWithin:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/withinOperator"],t,r)),esriSpatialRelRelation:null};t.canQueryWithRBush=function(e){if(n.isExtent(e))return!0;if(n.isPolygon(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1},t.checkSpatialQuerySupport=async function(e,t,s){const{spatialRel:i,geometry:o}=e;if(o){if(null==(l=i)||!0!==p[l])throw new r(h,"Unsupported query spatial relationship",{query:e});var l;if(a.isValid(o.spatialReference)&&a.isValid(s)){if(!function(e){return null!=e&&!0===f[n.getJsonType(e)]}(o))throw new r(h,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===m[e]}(t))throw new r(h,"Unsupported layer geometry type",{query:e});if(e.outSR)return d.checkProjectionSupport(e.geometry?.spatialReference,e.outSR)}}},t.getSpatialQueryOperator=async function(e,t,r,a,d){if(n.isPolygon(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=l.convertFromPolygon(new u,t,!1,!1);return t=>o.polygonContainsPoint(e,!1,!1,t)}if("esriGeometryMultipoint"===r){const r=l.convertFromPolygon(new u,t,!1,!1);if("esriSpatialRelContains"===e)return e=>o.polygonContainsMultipoint(r,!1,!1,e,a,d)}}if(n.isExtent(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return e=>s.extentContainsPoint(t,c.getGeometry(r,a,d,e));if("esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return e=>s.extentContainsMultipoint(t,c.getGeometry(r,a,d,e));if("esriSpatialRelIntersects"===e){const e=i.getExtentIntersector(r);return s=>e(t,c.getGeometry(r,a,d,s))}}"esriSpatialRelEnvelopeIntersects"===e&&(e="esriSpatialRelIntersects");const h=await function(e){const t=y[e];if(null==t)throw new Error(`Cannot load unsupported spatial operator: ${e}`);return t()}(e);return e=>h.execute(t,c.getGeometry(r,a,d,e))},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(e,t){"use strict";e.extentIntersectsExtent=t.extentIntersectsExtent,e.extentIntersectsMultipoint=t.extentIntersectsMultipoint,e.extentIntersectsPoint=t.extentIntersectsPoint,e.extentIntersectsPolygon=t.extentIntersectsPolygon,e.extentIntersectsPolyline=t.extentIntersectsPolyline,e.getFeatureExtentIntersector=t.getFeatureExtentIntersector,e.isSelfIntersecting=t.isSelfIntersecting,e.segmentIntersects=t.segmentIntersects,e.getExtentIntersector=function(e){return"mesh"===e?t.extentIntersectsExtent:t.getFeatureExtentIntersector(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,i,n,a){if(!e)return!1;const o=t(r,i),{coords:l,lengths:u}=e;let c=!1,d=0;for(const e of u)c=s(c,l,o,d,e,n,a),d+=e*o;return c}function s(e,t,r,s,i,n,a){let o=e,l=s;for(let e=s,u=s+i*r;e<u;e+=r){l=e+r,l===u&&(l=s);const i=t[e],c=t[e+1],d=t[l],h=t[l+1];(c<a&&h>=a||h<a&&c>=a)&&i+(a-c)/(h-c)*(d-i)<n&&(o=!o)}return o}e.polygonContainsCoords=r,e.polygonContainsMultipoint=function(e,s,i,n,a,o){const l=t(a,o),{coords:u,lengths:c}=n;if(!c)return!1;for(let t=0,n=0;t<c.length;t++,n+=l)if(!r(e,s,i,u[n],u[n+1]))return!1;return!0},e.polygonContainsPoint=function(e,t,s,i){return r(e,t,s,i.coords[0],i.coords[1])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports","../../../core/compilerUtils"],function(e,t){"use strict";e.getTimeExtent=async function(e,r){if(!e)return null;const s=r.featureAdapter,{startTimeField:i,endTimeField:n}=e;let a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY;if(i&&n)await r.forEach(e=>{const r=s.getAttribute(t.toConst(e),i),l=s.getAttribute(t.toConst(e),n);null==r||isNaN(r)||(a=Math.min(a,r)),null==l||isNaN(l)||(o=Math.max(o,l))});else{const e=i||n;await r.forEach(r=>{const i=s.getAttribute(t.toConst(r),e);null==i||isNaN(i)||(a=Math.min(a,i),o=Math.max(o,i))})}return{start:a,end:o}},e.getTimeOperator=function(e,t,r){if(!t||!e)return null;const{startTimeField:s,endTimeField:i}=e;if(!s&&!i)return null;const{start:n,end:a}=t;if(null===n&&null===a)return null;if(void 0===n&&void 0===a)return()=>!1;const o=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return s&&i?function(e,t,r,s,i){return null!=s&&null!=i?n=>{const a=e(n,t),o=e(n,r);return(null==a||a<=i)&&(null==o||o>=s)}:null!=s?t=>{const i=e(t,r);return null==i||i>=s}:null!=i?r=>{const s=e(r,t);return null==s||s<=i}:void 0}(o,s,i,n,a):function(e,t,r,s){return null!=r&&null!=s&&r===s?s=>e(s,t)===r:null!=r&&null!=s?i=>{const n=e(i,t);return null!=n&&n>=r&&n<=s}:null!=r?s=>{const i=e(s,t);return null!=i&&i>=r}:null!=s?r=>{const i=e(r,t);return null!=i&&i<=s}:void 0}(o,s||i,n,a)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FieldsIndex":function(){define(["../../core/Error","../../core/Logger","../../core/MapUtils","../../core/sql/UnknownTimeZone","../../core/support/jsonUtils","./fieldUtils","../../time/constants","../../time/timeZoneUtils","../../chunks/datetime"],function(e,t,r,s,i,n,a,o,l){"use strict";const u=new Map;class c{static fromJSON(e){return new c(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new c(e.fields??[],f(e))}static fromLayerJSON(e){return new c(e.fields??[],f(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const e of this.fields){const t=e?.name,s=h(t);if(t&&s){const i=d(t);this._fieldsMap.set(t,e),this._fieldsMap.set(i,e),this._normalizedFieldsMap.set(s,e),r.push(`${i}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),n.isDateField(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):n.isNumericField(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),n.isObjectIDField(e)||n.isGlobalIDField(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)n.isObjectIDField(e)||n.isGlobalIDField(e)||e.nullable||void 0!==n.getFieldDefaultValue(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(d(e))??this._normalizedFieldsMap.get(h(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(r){const s=this.get(r&&"string"!=typeof r?r.name:r);return s?this._timeZoneByFieldName?this._timeZoneByFieldName.get(s.name):"date"===s.type||"esriFieldTypeDate"===s.type?(t.getLogger("esri.layers.support.FieldsIndex").errorOnce(new e("getTimeZone:no-timezone-information",`no time zone information for field '${s.name}'`)),a.utc):p.has(s.type)?a.unknown:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===a.unknown?s.UnknownTimeZone.instance:t===a.utc?l.FixedOffsetZone.utcInstance:r.getOrCreateMapValue(u,t,()=>l.IANAZone.create(t)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return n.isTimeOnlyField(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>i.isSerializable(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function d(e){return e.trim().toLowerCase()}function h(e){return n.normalizeFieldName(e)?.toLowerCase()??""}const p=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function f(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:s,editFieldsInfo:i}=e,n=(s?"startField"in s?s.startField:s.startTimeField:"")??"",l=(s?"endField"in s?s.endField:s.endTimeField:"")??"",u="dateFieldsTimeZone"in e?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?o.fromTimeReference(e.dateFieldsTimeReference):null,c=i?"timeZone"in i?i.timeZone??u:i.dateFieldsTimeReference?o.fromTimeReference(i.dateFieldsTimeReference):u??a.utc:null,h=s?"timeZone"in s?s.timeZone??u:s.timeReference?o.fromTimeReference(s.timeReference):u:null,f=new Map([[d(i?.creationDateField??""),c],[d(i?.editDateField??""),c],[d(n),h],[d(l),h]]);for(const{name:s,type:i}of e.fields)if(p.has(i))t.set(s,a.unknown);else if("date"!==i&&"esriFieldTypeDate"!==i)t.set(s,null);else if(r)t.set(s,a.unknown);else{const e=f.get(d(s??""))??u;t.set(s,e)}return t}return c})},"esri/views/support/Scheduler":function(){define(["exports","../../core/arrayUtils","../../core/Handles","../../core/has","../../core/Logger","../../core/maybe","../../core/PerformanceSampler","../../core/promiseUtils","../../core/reactiveUtils","../../core/signal","../../core/time","../../layers/support/PromiseQueue","./debugFlags","./Yield"],function(e,t,r,s,i,n,a,o,l,u,c,d,h,p){"use strict";const f={RESOURCE_CONTROLLER_IMMEDIATE:"immediate",RESOURCE_CONTROLLER:"schedule",SLIDE:"slide",STREAM_DATA_LOADER:"stream loader",ELEVATION_QUERY:"elevation query",TERRAIN_SURFACE:"terrain",SURFACE_GEOMETRY_UPDATES:"surface geometry updates",LOD_RENDERER:"LoD renderer",GRAPHICS_CORE:"Graphics3D",I3S_CONTROLLER:"I3S",POINT_CLOUD_LAYER:"point cloud",FEATURE_TILE_FETCHER:"feature fetcher",STREAM_CONTROLLER:"stream controller",OVERLAY:"overlay",OVERLAY_RENDERER:"overlay renderer",STAGE:"stage",GRAPHICS_DECONFLICTOR:"graphics deconflictor",FILTER_VISIBILITY:"Graphics3D filter visibility",SCALE_VISIBILITY:"Graphics3D scale visibility",FRUSTUM_VISIBILITY:"Graphics3D frustum visibility",POINT_OF_INTEREST_FREQUENT:"POI frequent",POINT_OF_INTEREST_INFREQUENT:"POI infrequent",LABELER:"labeler",FEATURE_QUERY_ENGINE:"feature query",FEATURE_TILE_TREE:"feature tile tree",FEATURE_TILE_TREE_ACTIVE:"fast feature tile tree",ELEVATION_ALIGNMENT:"elevation alignment",ELEVATION_ALIGNMENT_SCENE:"elevation alignment scene",TEXT_TEXTURE_ATLAS:"text texture atlas",TEXTURE_UNLOAD:"texture unload",LINE_OF_SIGHT_TOOL:"line of sight tool",LINE_OF_SIGHT_TOOL_INTERACTIVE:"interactive line of sight tool",ELEVATION_PROFILE:"elevation profile",SNAPPING:"snapping",SHADOW_ACCUMULATOR:"shadow accumulator",CLOUDS_GENERATOR:"clouds generator",FLOW_GENERATOR:"flow generator",MAPVIEW_FETCH_QUEUE:"mapview fetch queue",MAPVIEW_LAYERVIEW_UPDATE:"mapview layerview update",MAPVIEW_VECTOR_TILE_PARSING_QUEUE:"mapview vector tile parsing queue",NONE:0,TEST_PRIO:1},m=new Map([[f.RESOURCE_CONTROLLER_IMMEDIATE,0],[f.RESOURCE_CONTROLLER,4],[f.SLIDE,0],[f.STREAM_DATA_LOADER,0],[f.ELEVATION_QUERY,0],[f.TERRAIN_SURFACE,1],[f.SURFACE_GEOMETRY_UPDATES,1],[f.LOD_RENDERER,2],[f.GRAPHICS_CORE,2],[f.I3S_CONTROLLER,2],[f.POINT_CLOUD_LAYER,2],[f.FEATURE_TILE_FETCHER,2],[f.STREAM_CONTROLLER,2],[f.CLOUDS_GENERATOR,2],[f.OVERLAY,4],[f.OVERLAY_RENDERER,4],[f.STAGE,4],[f.GRAPHICS_DECONFLICTOR,4],[f.FILTER_VISIBILITY,4],[f.SCALE_VISIBILITY,4],[f.FRUSTUM_VISIBILITY,4],[f.POINT_OF_INTEREST_FREQUENT,6],[f.POINT_OF_INTEREST_INFREQUENT,30],[f.LABELER,8],[f.FEATURE_QUERY_ENGINE,8],[f.FEATURE_TILE_TREE,16],[f.FEATURE_TILE_TREE_ACTIVE,0],[f.ELEVATION_ALIGNMENT,12],[f.ELEVATION_ALIGNMENT_SCENE,14],[f.TEXT_TEXTURE_ATLAS,12],[f.TEXTURE_UNLOAD,12],[f.LINE_OF_SIGHT_TOOL,16],[f.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[f.SNAPPING,0],[f.SHADOW_ACCUMULATOR,30],[f.FLOW_GENERATOR,12],[f.MAPVIEW_FETCH_QUEUE,0],[f.MAPVIEW_LAYERVIEW_UPDATE,2],[f.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function y(e){return m.has(e)?m.get(e):"number"==typeof e?e:1}const g=c.Milliseconds(6.5),_=c.Milliseconds(1),b=c.Milliseconds(30),S=c.Milliseconds(1e3/30),x=c.Milliseconds(100);class v{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(e=>e.needsUpdate)}constructor(){this._updating=u.signal(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new a("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new M,this._state=1,this._tasks=new Array,this._runQueue=new Array,this._load=0,this._idleStateCallbacks=new Array,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=l.watch(()=>h.SCHEDULER_LOG_SLOW_TASKS,e=>this._debug=e,l.initial);for(const e of Object.keys(f))this.performanceInfo.tasks.set(f[e],new a(String(f[e])))}destroy(){this._tasks.forEach(e=>e.remove()),this._tasks.length=0,this._idleStateCallbacks.length=0,this._runQueue.length=0,n.removeMaybe(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())}))}registerTask(e,t){const r=new T(this,e,t);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new a(e)),r}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),2===this.state&&this._idleUpdatesStartFired&&r.idleBegin();const s=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){s._idleUpdatesStartFired&&(r.idleEnd(),2===s._state&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forEach(e=>e.idleEnd())))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=g,r=e.frameDuration,s=_;switch(this.state){case 2:t=c.Milliseconds(0),r=c.Milliseconds(Math.max(x,e.frameDuration)),s=b;break;case 1:r=c.Milliseconds(Math.max(S,e.frameDuration))}return r=c.Milliseconds(r-e.elapsedFrameTime-t),2!==this.state&&r<_&&!this._forceTask?(this._forceTask=!0,!1):(r=c.Milliseconds(Math.max(r,s)),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forEach(e=>e.idleBegin())),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(c.Milliseconds(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),t.removeUnordered(this._idleStateCallbacks,e)}removeTask(e){t.removeUnordered(this._tasks,e),t.removeUnordered(this._runQueue,e),this._updatingChanged()}_updateTask(e){this._tasks.forEach(t=>{t.name===e&&t.setPriority(e)})}_getState(e){if(this._runQueue.some(t=>t.name===e))return"s";let t="i";return this._tasks.forEach(r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t="r":"r"!==t&&(t="w"))}),t}_getRuntime(e){let t=0;return this._tasks.forEach(r=>{r.name===e&&(t+=r.runtime)}),t}_resetRuntimes(){this._tasks.forEach(e=>e.runtime=0)}_getRunning(){const e=new Map;if(this._tasks.forEach(t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)}),0===e.size)return null;let t="";return e.forEach((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`}),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce((e,t)=>t.needsUpdate?++e:e,0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(t.filterInPlace(this._runQueue,e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)),this._tasks.forEach(e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)});0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forEach(r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)}),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const e=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.task.runTask(this._budget)===p.Yield&&(t.blockFrame=this._frameNumber)}catch(e){i.getLogger("esri.views.support.Scheduler").error(`Exception in task "${t.name}"`,e),t.blockFrame=this._frameNumber}!this._budget.hasProgressed&&t.blockFrame!==this._frameNumber&&t.needsUpdate&&(t.name,t.blockFrame=this._frameNumber),t.schedulePriority=t.basePriority;const r=this._budget.now()-e;if(t.runtime+=r,this._frameTaskTimes.set(t.priority,this._frameTaskTimes.get(t.priority)+r),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(f))this._frameTaskTimes.set(f[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach((e,t)=>this.performanceInfo.tasks.get(t).push(e)),this.performanceInfo.total.push(e)}get test(){return this._test}}class T{get task(){return this._task.value}get readyToRun(){return this._queue.readyToRun}get updating(){return this._queue.updating}constructor(e,t,s){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new d.PromiseQueue,this._handles=new r,this._basePriority=y(t),this.schedulePriority=this._basePriority,this._task=u.signal(null!=s?s:this._queue),this._handles.add(l.when(()=>this.task.readyToRun,t=>e.taskRunningChanged(t)))}remove(){this.processQueue(F),this._scheduler.removeTask(this),this.schedule=I.schedule,this.reschedule=I.reschedule,this.scheduleGenerator=I.scheduleGenerator,this.rescheduleGenerator=I.rescheduleGenerator,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=y(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.readyToRun||!this.task.destroyed&&this.task.readyToRun}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}scheduleGenerator(e,t,r){return this._queue.pushGenerator(e,t,r)}rescheduleGenerator(e,t,r){return this._queue.unshiftGenerator(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class M{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}const F=new M;F.enabled=!1;const I=new class{remove(){}processQueue(){}schedule(e,t,r){try{if(o.isAborted(t)){const e=o.createAbortError();return r?Promise.resolve(r(e)):Promise.reject(e)}return o.when(e(F))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}async scheduleGenerator(e,t,r){if(o.isAborted(t)){const e=o.createAbortError();if(r)return r(e);throw e}const s=e(F);for(;;){const e=s.next(F),i=o.isPromiseLike(e)?await e:e;if(o.isAborted(t)){const e=o.createAbortError();if(r)return r(e);throw e}if(i.done)return i.value}}rescheduleGenerator(e,t,r){return this.rescheduleGenerator(e,t,r)}};e.ImmediateTask=I,e.TaskPriority=f,e.getTaskPriority=y,e.makeBudget=function(e){const t=new M;return t.reset(e),t},e.newScheduler=function(){return new v},e.noBudget=F,e.taskPriorities=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/signal":function(){define(["exports","./lang","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t,r,s){"use strict";class i{constructor(e,t){this._observable=new s.SimpleObservable,this._value=e,this._equalityFunction=t}get value(){return r.trackAccess(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}}e.signal=function(e,r=t.equalsShallow){return new i(e,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/compilerUtils","../../core/Logger","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(e,t,r,s,i,n){"use strict";function a(e){s.isPromiseLike(e)?e.then(o):o(e)}function o(e){e.done||r.getLogger("esri.layers.support.PromiseQueue").warn("Generator iterator was aborted, but it is not done.")}class l{constructor(e,t,r=void 0,s=void 0){this.resolve=e,this.reject=t,this.signal=r,this.abortCallback=s}}class u extends l{constructor(e,t,r,s,i){super(e,t,s,i),this.callback=r,this.type=0}}class c extends l{constructor(e,t,r,s,i,n){super(e,t,s,i),this.generatorFunction=r,this.scheduleFunction=n,this.type=1}}class d extends l{constructor(e,t,r,s,i,n){super(e,t,s,i),this.iterator=r,this.scheduleFunction=n,this.type=2}}e.PromiseQueue=class{constructor(){this._tasks=new Array,this._numPendingTasks=i.signal(0),this._readyToRun=i.signal(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get readyToRun(){return this._readyToRun.value}_updateReadyToRun(){this._readyToRun.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return n.Yield;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return this._addTask((s,i)=>new u(s,i,e,t,r),Array.prototype.push)}unshift(e,t,r){return this._addTask((s,i)=>new u(s,i,e,t,r),Array.prototype.unshift)}pushGenerator(e,t,r){const s=Array.prototype.push;return this._addTask((i,n)=>new c(i,n,e,t,r,s),s)}unshiftGenerator(e,t,r){const s=Array.prototype.unshift;return this._addTask((i,n)=>new c(i,n,e,t,r,s),s)}_process(e){if(0===this._tasks.length)return!1;const r=this._tasks.shift();this._updateReadyToRun();try{if(s.isAborted(r.signal))this._cancelTask(r,s.createAbortError());else switch(r.type){case 0:this._processSimple(r,e);break;case 1:this._processGenerator(r,e);break;case 2:this._processIterator(r,e);break;default:t.neverReached(r)}}catch(e){r.reject(e)}return!0}cancelAll(){const e=s.createAbortError();for(const t of this._tasks)this._cancelTask(t,e);this._tasks.length=0,this._updateReadyToRun()}_cancelTask(e,t){if(e.abortCallback){const r=e.abortCallback(t);2===e.type&&e.iterator.return&&a(e.iterator.return()),s.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}else 2===e.type&&e.iterator.throw&&a(e.iterator.throw(t)),e.reject(t)}_onIteratorResult(e,t){t.done?e.resolve(t.value):(e.scheduleFunction.call(this._tasks,e),this._updateReadyToRun())}_processSimple(e,t){const r=e.callback(t);s.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}_processGenerator(e,t){const r=e.generatorFunction(t),s=new d(e.resolve,e.reject,r,e.signal,e.abortCallback,e.scheduleFunction);this._processIterator(s,t)}_processIterator(e,t){const r=e.iterator.next(t);s.isPromiseLike(r)?r.then(t=>this._onIteratorResult(e,t),e.reject):this._onIteratorResult(e,r)}_addTask(e,t){return new Promise((r,s)=>{const i=e(r,s);t.call(this._tasks,i),++this._numPendingTasks.value,this._updateReadyToRun()}).finally(()=>--this._numPendingTasks.value)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Yield":function(){define(["exports"],function(e){"use strict";const t=Symbol("Yield");e.Yield=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,a){"use strict";let o=class extends t{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};return e.__decorate([r.property()],o.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),e.__decorate([r.property()],o.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),o=e.__decorate([a.subclass("esri.views.support.debugFlags")],o),new o})},"esri/layers/graphics/data/FeatureStore":function(){define(["../../../core/arrayUtils","../../../core/Error","../../../core/Evented","../../../core/Logger","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../featureConversionUtils","./BoundsStore","./geometryUtils","./optimizedFeatureQueryEngineAdapter"],function(e,t,r,s,i,n,a,o,l,u){"use strict";const c=i.create();return class{constructor(e){this.geometryInfo=e,this._boundsStore=new o.BoundsStore,this._featuresById=new Map,this._usedMemory=0,this.events=new r.EventEmitter,this.featureAdapter=u.optimizedFeatureQueryEngineAdapter}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach(t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,r,s,i]=this.fullBounds;return{xmin:t,ymin:r,xmax:s,ymax:i,spatialReference:l.cleanFromGeometryEngine(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(t){const r=t.map(e=>this._upsert(e));return this._emitChanged(),r.filter(e.isSome)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const r of e){const e=this._boundsStore.get(r.objectId);e&&t(i.fromRect(c,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach(t=>e(t))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,e=>{t(this._featuresById.get(e))})}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const r=e.objectId;if(null==r)return void s.getLogger("esri.layers.graphics.data.FeatureStore").error(new t("featurestore:invalid-feature","feature id is missing",{feature:e}));const i=this._featuresById.get(r);let o;if(i?(e.displayId=i.displayId,o=this._boundsStore.get(r),this._boundsStore.delete(r),this._usedMemory-=this.estimateFeatureUsedMemory?.(i)??0):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(r,null),void this._featuresById.set(r,e);o=a.getBoundsOptimizedGeometry(null!=o?o:n.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=o&&this._boundsStore.set(r,o),this._featuresById.set(r,e),this._usedMemory+=this.estimateFeatureUsedMemory?.(e)??0}_upsert(e){const r=e?.objectId;if(null==r)return s.getLogger("esri.layers.graphics.data.FeatureStore").error(new t("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const i=this._featuresById.get(r);if(!i)return this._add(e),e;this._usedMemory-=this.estimateFeatureUsedMemory?.(i)??0;const{geometry:o,attributes:l}=e;for(const e in l)i.attributes[e]=l[e];return o&&(i.geometry=o,this._boundsStore.set(r,a.getBoundsOptimizedGeometry(n.create(),o,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),this._usedMemory+=this.estimateFeatureUsedMemory?.(i)??0,i}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(e)??0,e}}})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(e,t,r,s){"use strict";const i={minX:0,minY:0,maxX:0,maxY:0};e.BoundsStore=class{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new r.PooledRBush(9,t("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach((r,s)=>{e[t++]=s}),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(e=>this._idByBounds.has(e))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=s.empty();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),function(e,t,r){!function(e){i.minX=e[0],i.minY=e[1],i.maxX=e[2],i.maxY=e[3]}(t),e.search(i,r)}(this._index,e,e=>t(this._idByBounds.get(e)))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../compilerUtils","../../has","../../PooledArray","../../../chunks/quickselect"],function(e,t,r,s,i,n){"use strict";function a(e,t){let s=e;for(S.clear();s;){if(!0===s.leaf)for(const e of s.children)t(r.toConst(e));else S.pushArray(s.children);s=S.pop()??null}}function o(e,t){l(e,0,e.children.length,t,e)}function l(e,t,r,s,i){i||(i=new F([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let n,a=t;a<r;a++)n=e.children[a],u(i,e.leaf?s(n):n);return i}function u(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function c(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function p(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function m(e,t){const r=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,n-s)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function _(e,t,r,s,i){const a=[t,r];for(;a.length;){const t=a.pop(),r=a.pop();if(t-r<=s)continue;const o=r+Math.ceil((t-r)/s/2)*s;n.quickselect(e,o,r,t,i),a.push(r,o,o,t)}}const b=new i,S=new i,x=new i,v=new i({deallocator:void 0});class T{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class M extends T{constructor(){super(...arguments),this.height=1,this.indexHint=new t.PositionHint}}class F extends M{constructor(e){super(),this.children=e,this.leaf=!0}}class I extends M{constructor(e){super(),this.children=e,this.leaf=!1}}e.BBox=T,e.PooledRBush=class{constructor(e=9,t){this._compareMinX=c,this._compareMinY=d,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),S.prune(),x.prune(),v.prune()}all(e){a(this._data,e)}search(e,t){let r=this._data;const s=this._toBBox;if(g(e,r))for(b.clear();r;){for(let i=0,n=r.children.length;i<n;i++){const n=r.children[i],o=r.leaf?s(n):n;g(e,o)&&(r.leaf?t(n):y(e,o)?a(n,t):b.push(n))}r=b.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!g(e,t))return!1;for(b.clear();t;){for(let s=0,i=t.children.length;s<i;s++){const i=t.children[s],n=t.leaf?r(i):i;if(g(e,n)){if(t.leaf||y(e,n))return!0;b.push(i)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new F([]),this}remove(e){if(!e)return this;let s,i=this._data,n=null,a=0,o=!1;const l=this._toBBox(e);for(x.clear(),v.clear();i||x.length>0;){if(i||(i=x.pop(),n=x.data[x.length-1],a=v.pop()??0,o=!0),i.leaf&&(s=t.indexOf(i.children,r.toConst(e),i.children.length,i.indexHint),-1!==s))return i.children.splice(s,1),x.push(i),this._condense(x),this;o||i.leaf||!y(i,l)?n?(a++,i=n.children[a],o=!1):i=null:(x.push(i),v.push(a),a=0,n=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,s){const i=r-t+1;let n=this._maxEntries;if(i<=n){const s=new F(e.slice(t,r+1));return o(s,this._toBBox),s}s||(s=Math.ceil(Math.log(i)/Math.log(n)),n=Math.ceil(i/n**(s-1)));const a=new I([]);a.height=s;const l=Math.ceil(i/n),u=l*Math.ceil(Math.sqrt(n));_(e,t,r,u,this._compareMinX);for(let i=t;i<=r;i+=u){const t=Math.min(i+u-1,r);_(e,i,t,l,this._compareMinY);for(let r=i;r<=t;r+=l){const i=Math.min(r+l-1,t);a.children.push(this._build(e,r,i,s-1))}}return o(a,this._toBBox),a}_insert(e,t,r){const s=this._toBBox,i=r?e:s(e);x.clear();const n=function(e,t,r,s){for(;s.push(t),!0!==t.leaf&&s.length-1!==r;){let r,s=1/0,i=1/0;for(let n=0,a=t.children.length;n<a;n++){const a=t.children[n],o=h(a),l=f(e,a)-o;l<i?(i=l,s=o<s?o:s,r=a):l===i&&o<s&&(s=o,r=a)}t=r||t.children[0]}return t}(i,this._data,t,x);for(n.children.push(e),u(n,i);t>=0&&x.data[t].children.length>this._maxEntries;)this._split(x,t),t--;!function(e,t,r){for(let s=r;s>=0;s--)u(t.data[s],e)}(i,x,t)}_split(e,t){const r=e.data[t],s=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,s);const n=this._chooseSplitIndex(r,i,s);if(!n)return;const a=r.children.splice(n,r.children.length-n),l=r.leaf?new F(a):new I(a);l.height=r.height,o(r,this._toBBox),o(l,this._toBBox),t?e.data[t-1].children.push(l):this._splitRoot(r,l)}_splitRoot(e,t){this._data=new I([e,t]),this._data.height=e.height+1,o(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let s,i,n;s=i=1/0;for(let a=t;a<=r-t;a++){const t=l(e,0,a,this._toBBox),o=l(e,a,r,this._toBBox),u=m(t,o),c=h(t)+h(o);u<s?(s=u,n=a,i=c<i?c:i):u===s&&c<i&&(i=c,n=a)}return n}_chooseSplitAxis(e,t,r){const s=e.leaf?this._compareMinX:c,i=e.leaf?this._compareMinY:d;this._allDistMargin(e,t,r,s)<this._allDistMargin(e,t,r,i)&&e.children.sort(s)}_allDistMargin(e,t,r,s){e.children.sort(s);const i=this._toBBox,n=l(e,0,t,i),a=l(e,r-t,r,i);let o=p(n)+p(a);for(let s=t;s<r-t;s++){const t=e.children[s];u(n,e.leaf?i(t):t),o+=p(n)}for(let s=r-t-1;s>=t;s--){const t=e.children[s];u(a,e.leaf?i(t):t),o+=p(a)}return o}_condense(e){for(let r=e.length-1;r>=0;r--){const s=e.data[r];if(0===s.children.length)if(r>0){const i=e.data[r-1],n=i.children;n.splice(t.indexOf(n,s,n.length,i.indexHint),1)}else this.clear();else o(s,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},e.cleanupPooledRBush=function(){b.prune(),S.prune(),x.prune(),v.prune()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports"],function(e){"use strict";function t(e,s,i,n,a){for(;n>i;){if(n-i>600){var o=n-i+1,l=s-i+1,u=Math.log(o),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(o-c)/o)*(l-o/2<0?-1:1);t(e,s,Math.max(i,Math.floor(s-l*c/o+d)),Math.min(n,Math.floor(s+(o-l)*c/o+d)),a)}var h=e[s],p=i,f=n;for(r(e,i,s),a(e[n],h)>0&&r(e,i,n);p<f;){for(r(e,p,f),p++,f--;a(e[p],h)<0;)p++;for(;a(e[f],h)>0;)f--}0===a(e[i],h)?r(e,i,f):r(e,++f,n),f<=s&&(i=f+1),s<=f&&(n=f-1)}}function r(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function s(e,t){return e<t?-1:e>t?1:0}e.quickselect=function(e,r,i,n,a){t(e,r,i||0,n||e.length-1,a||s)}})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../OptimizedFeature"],function(e,t){"use strict";const r={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,r)=>new t.OptimizedFeature(r,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)};e.optimizedFeatureQueryEngineAdapter=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/geojson/geojson":function(){define(["exports","../../../../core/date","../../../../core/Error","../../../../geometry/support/spatialReferenceUtils","../../OptimizedFeature","../../OptimizedGeometry","../../../support/fieldUtils"],function(e,t,r,s,i,n,a){"use strict";const o={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function l(e){return o[e]}function*u(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*c(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function d(e){for(const t of e)if(t.length>2)return!0;return!1}function h(e){let t=0;for(let r=0;r<e.length;r++){const s=e[r],i=e[(r+1)%e.length];t+=s[0]*i[1]-i[0]*s[1]}return t<=0}function p(e){const t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function f(e,t,r){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,r){return g(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(const s of t.coordinates)g(e,s,r);return e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(const s of t.coordinates){m(e,s[0],r);for(let t=1;t<s.length;t++)y(e,s[t],r)}return e}(e,t,r);case"Point":return function(e,t,r){return b(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){const s=t.coordinates;m(e,s[0],r);for(let t=1;t<s.length;t++)y(e,s[t],r);return e}(e,t,r)}}function m(e,t,r){const s=p(t);h(s)?g(e,s,r):_(e,s,r)}function y(e,t,r){const s=p(t);h(s)?_(e,s,r):g(e,s,r)}function g(e,t,r){for(const s of t)b(e,s,r);e.lengths.push(t.length)}function _(e,t,r){for(let s=t.length-1;s>=0;s--)b(e,t[s],r);e.lengths.push(t.length)}function b(e,t,r){const[s,i,n]=t;e.coords.push(s,i),r.hasZ&&e.coords.push(n||0)}function S(e){switch(typeof e){case"string":return t.isISO8601Date(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}e.createOptimizedFeatures=function(e,t){return Array.from(function*(e,t={}){const{geometryType:r,objectIdField:s}=t;for(const a of e){const{geometry:e,properties:o,id:u}=a;if(e&&l(e.type)!==r)continue;const c=o||{};let d;s&&(d=c[s],null==u||d||(c[s]=d=u));const h=new i.OptimizedFeature(e?f(new n,e,t):null,c,null,d);yield h}}(u(e),t))},e.getGeometryType=l,e.inferLayerProperties=function(e,t={}){const r=[],s=new Set,i=new Set;let n,o=!1,h=null,p=!1,{geometryType:f=null}=t;for(const t of u(e)){const{geometry:e,properties:u,id:m}=t;if((!e||(f||(f=l(e.type)),l(e.type)===f))&&(o||(o=d(c(e))),p||(p=null!=m,p&&(n=typeof m,u&&(h=Object.keys(u).filter(e=>u[e]===m)))),u&&h&&p&&null!=m&&(h.length>1?h=h.filter(e=>u[e]===m):1===h.length&&(h=u[h[0]]===m?h:[])),u))for(const e in u){if(s.has(e))continue;const t=S(u[e]);if("unknown"===t){i.add(e);continue}i.delete(e),s.add(e);const n=a.normalizeFieldName(e);n&&r.push({name:n,alias:e,type:t})}}const m=a.normalizeFieldName(1===h?.length&&h[0]||null)??void 0;if(m)for(const e of r)if(e.name===m&&a.isNumericField(e)){e.type="esriFieldTypeOID";break}return{fields:r,geometryType:f,hasZ:o,objectIdFieldName:m,objectIdFieldType:n,unknownFields:Array.from(i)}},e.validateGeoJSON=function(e,t=4326){if(!e)throw new r("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new r("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:i}=e;if(!i)return;const n="string"==typeof i?i:"name"===i.type?i.properties.name:"EPSG"===i.type?i.properties.code:null,a=s.isWGS84({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!n||!a.test(n))throw new r("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:i})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/date":function(){define(["exports"],function(e){"use strict";function t(e){const t=new Date(e);return function(e,t){if(Number.isNaN(e.getTime()))return!1;let r=!0;if(n&&/\d+\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,s=0;for(;!t&&s<=e.length;)t=!i.test(e[s]),s++;r=!t}}return r}(t,e)?Number.isNaN(t.getTime())?null:t.getTime()-6e4*t.getTimezoneOffset():null}function r(e){const t=s.exec(e);if(!t?.groups)return null;const r=t.groups,i=+r.year,n=+r.month-1,a=+r.day,o=+(r.hours??"0"),l=+(r.minutes??"0"),u=+(r.seconds??"0");if(o>23)return null;if(l>59)return null;if(u>59)return null;const c=r.ms??"0",d=c?+c.padEnd(3,"0").slice(0,3):0;let h;if(r.isUTC||!r.offsetSign)h=Date.UTC(i,n,a,o,l,u,d);else{const e=+r.offsetHours,t=+r.offsetMinutes;h=6e4*("+"===r.offsetSign?-1:1)*(60*e+t)+Date.UTC(i,n,a,o,l,u,d)}return Number.isNaN(h)?null:h}const s=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,i=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,n=!Number.isNaN(new Date("technology 10").getTime());e.isDateString=function(e){return null!=r(e)||null!=t(e)},e.isISO8601Date=function(e){return s.test(e)},e.parseDate=function(e){return r(e)??t(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/sourceUtils":function(){define(["require","exports","../../../../core/date","../../../../geometry/support/spatialReferenceUtils","../../../support/fieldUtils"],function(e,t,r,s,i){"use strict";class n{constructor(e){this.description=e,this.code=null}}class a{constructor(e){this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error=new n(e)}}function o(e){return new a(e)}class l{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}const u=new Set;function c(e,t){let s=t;return i.isNumericField(e)&&"string"==typeof t?s=parseFloat(t):i.isStringField(e)&&null!=t&&"string"!=typeof t?s=String(t):i.isDateField(e)&&"string"==typeof t&&(s=r.parseDate(t)),i.sanitizeNullFieldValue(s)}let d;t.createFeatureEditErrorResult=o,t.createFeatureEditSuccessResult=function(e){return new l(e)},t.loadGeometryEngineForSimplify=async function(t,r){!s.isValid(t)||"esriGeometryPolygon"!==r&&"esriGeometryPolyline"!==r||await async function(){return null==d&&(d=await new Promise((t,r)=>e(["../../../../geometry/geometryEngineJSON"],t,r))),d}()},t.mixAttributes=function(e,t,r,s=!1){u.clear();for(const n in r){const a=e.get(n);if(!a)continue;const l=c(a,r[n]);if(u.add(a.name),a&&(s||a.editable)){const e=i.validateFieldValue(a,l);if(e)return o(i.validationErrorToString(e,a,l));t[a.name]=l}}for(const t of e.requiredFields??[])if(!u.has(t.name))return o(`missing required field "${t.name}"`);return null},t.queryBinsCapabilities={supportsAutoIntervalBin:!0,supportsFixedIntervalBin:!0,supportsFixedBoundariesBin:!0,supportsDateBin:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsNormalization:!0,supportedStatisticTypes:["COUNT","SUM","AVG","VAR","STDDEV","MIN","MAX","PERCENTILE_CONT","PERCENTILE_DISC","CentroidAggregate","EnvelopeAggregate","ConvexHullAggregate"],supportedNormalizationTypes:["field","log","naturalLog","percentOfTotal","squareRoot"]},t.simplify=function(e,t){if(!e||!s.isValid(t))return e;if("rings"in e||"paths"in e){if(null==d)throw new TypeError("geometry engine not loaded");return d.simplify(t,e)}return e},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/layers/ogc/wfsUtils":function(){define(["exports","../../request","../../core/Error","../../core/iteratorUtils","../../core/urlUtils","../../geometry/Extent","../../geometry/projectionUtils","../../geometry/SpatialReference","../../geometry/support/spatialReferenceUtils","../../geometry/support/typeUtils","../graphics/sources/geojson/geojson","./xmlUtils","../support/arcgisLayerUrl","../support/Field","../support/fieldUtils"],function(e,t,r,s,i,n,a,o,l,u,c,d,h,p,f){"use strict";const m="xlink:href",y="2.0.0",g="__esri_wfs_id__",_="wfs-layer:feature-type-not-found",b="wfs-layer:unknown-geometry-type";function S(e){const t=C(e);!function(e){const t=e.firstElementChild?.getAttribute("version");if(t&&t!==y)throw new r("wfs-layer:unsupported-wfs-version",`Unsupported WFS version ${t}. Supported version: ${y}`)}(t),B(t);const i=t.firstElementChild,a=s.cache((o=i,d.iterateXML(o,{FeatureTypeList:{FeatureType:e=>{const t={typeName:"undefined:undefined",name:"",title:"",description:"",extent:null,namespacePrefix:"",namespaceUri:"",defaultSpatialReference:4326,supportedSpatialReferences:[]},r=new Set;return d.visitXML(e,{Name:e=>{const{name:r,prefix:s}=z(e.textContent);t.typeName=`${s}:${r}`,t.name=r,t.namespacePrefix=s,t.namespaceUri=e.lookupNamespaceURI(s)},Abstract:e=>{t.description=e.textContent},Title:e=>{t.title=e.textContent},WGS84BoundingBox:e=>{t.extent=n.fromJSON(function(e){let t,r,s,i;for(const n of e.children)switch(n.localName){case"LowerCorner":[t,r]=n.textContent.split(" ").map(e=>Number.parseFloat(e));break;case"UpperCorner":[s,i]=n.textContent.split(" ").map(e=>Number.parseFloat(e))}return{xmin:t,ymin:r,xmax:s,ymax:i,spatialReference:l.wgs84}}(e))},DefaultCRS:e=>{const s=M(e);s&&(t.defaultSpatialReference=s,r.add(s))},OtherCRS:e=>{const t=M(e);t&&r.add(t)}}),t.title||(t.title=t.name),r.add(4326),t.supportedSpatialReferences.push(...r),t}}})));var o;return{operations:T(i),get featureTypes(){return Array.from(a())},readFeatureTypes:a}}const x=["json","application/json; subtype=geojson; charset=utf-8","application/json; subtype=geojson","application/json","geojson","application/geo+json"];function v(e){for(const t of x){const r=e.findIndex(e=>e.toLowerCase()===t);if(r>=0)return e[r]}return null}function T(e){let t=!0;const s={GetCapabilities:{url:""},DescribeFeatureType:{url:""},GetFeature:{url:"",outputFormat:null,supportsPagination:!1}},i=[],n=[];if(d.visitXML(e,{OperationsMetadata:{Parameter:e=>{if("outputformat"===e.getAttribute("name")?.toLowerCase())return{AllowedValues:{Value:({textContent:e})=>{e&&i.push(e)}}}},Operation:e=>{switch(e.getAttribute("name")){case"GetCapabilities":return{DCP:{HTTP:{Get:e=>{s.GetCapabilities.url=e.getAttribute(m)}}}};case"DescribeFeatureType":return{DCP:{HTTP:{Get:e=>{s.DescribeFeatureType.url=e.getAttribute(m)}}}};case"GetFeature":return{DCP:{HTTP:{Get:e=>{s.GetFeature.url=e.getAttribute(m)}}},Parameter:e=>{if("outputformat"===e.getAttribute("name")?.toLowerCase())return{AllowedValues:{Value:({textContent:e})=>{e&&n.push(e)}}}}}}},Constraint:e=>{switch(e.getAttribute("name")){case"KVPEncoding":return{DefaultValue:e=>{t="true"===e.textContent.toLowerCase()}};case"ImplementsResultPaging":return{DefaultValue:e=>{s.GetFeature.supportsPagination="true"===e.textContent.toLowerCase()}}}}}}),s.GetFeature.outputFormat=v(n)??v(i),!t)throw new r("wfs-layer:kvp-encoding-not-supported","WFS service doesn't support key/value pair (KVP) encoding");if(null==s.GetFeature.outputFormat)throw new r("wfs-layer:geojson-not-supported","WFS service doesn't support GeoJSON output format");return s}function M(e){const t=parseInt(e.textContent?.match(/(?<wkid>\d+$)/i)?.groups?.wkid??"",10);if(!Number.isNaN(t))return t}function F(e,t,r){return s.find(e,e=>r?e.name===t&&e.namespaceUri===r:e.typeName===t||e.name===t)}async function I(e,t,s,i={}){const n=e.readFeatureTypes(),u=t?F(n,t,s):n.next().value,{spatialReference:c=new o({wkid:u?.defaultSpatialReference})}=i;if(null==u)throw t?new r(_,`The type '${t}' could not be found in the service`):new r("wfs-layer:empty-service","The service is empty");let d=u.extent;if(d&&!l.equals(d.spatialReference,c))try{await a.initializeProjection(d.spatialReference,c,void 0,i),d=a.project(d,c)}catch{throw new r("wfs-layer:unsupported-spatial-reference","Projection not supported")}return{extent:d,spatialReference:c,featureType:u}}function w(e){const t=e.find(e=>"geometry"===e.type);let r=e.find(e=>"oid"===e.type);return e=e.filter(e=>"geometry"!==e.type),r||(r=new p({name:g,type:"oid",alias:g}),e.unshift(r)),{geometryField:t?.name??null,objectIdField:r.name,fields:e}}async function R(e,r,s,i={}){let n,a=!1;const[o,l]=await Promise.all([O(e.operations.GetFeature.url,r,s,e.operations.GetFeature.outputFormat,{...i,count:1}),t(e.operations.GetFeature.url,{responseType:"text",query:N(r,s,void 0,{...i,count:1}),signal:i?.signal})]),d="FeatureCollection"===o.type&&o.features[0]?.geometry;if(d){let e;switch(n=u.featureGeometryTypeKebabDictionary.fromJSON(c.getGeometryType(d.type)),d.type){case"Point":e=d.coordinates;break;case"LineString":case"MultiPoint":e=d.coordinates[0];break;case"MultiLineString":case"Polygon":e=d.coordinates[0][0];break;case"MultiPolygon":e=d.coordinates[0][0][0]}const t=/<[^>]*pos[^>]*> *(-?\d+(?:\.\d+)?) (-?\d+(?:\.\d+)?)/.exec(l.data);if(t){const r=e[0].toFixed(3),s=e[1].toFixed(3),i=parseFloat(t[1]).toFixed(3);r===parseFloat(t[2]).toFixed(3)&&s===i&&(a=!0)}}return{geometryType:n,swapXY:a}}async function E(e,r,s){return A(r,(await t(e,{responseType:"text",query:{SERVICE:"WFS",REQUEST:"DescribeFeatureType",VERSION:y,TYPENAME:r,TYPENAMES:r,...s?.customParameters},signal:s?.signal})).data)}function A(e,t){const{name:i}=z(e),n=C(t);B(n);const a=s.find(d.iterateXML(n.firstElementChild,{element:e=>e}),e=>e.getAttribute("name")===i);if(null!=a){const e=a.getAttribute("type"),t=e?s.find(d.iterateXML(n.firstElementChild,{complexType:e=>e}),t=>t.getAttribute("name")===z(e).name):s.find(d.iterateXML(a,{complexType:e=>e}),()=>!0);if(t)return function(e){const t=[],s=[];let i;const n=d.iterateXML(e,{complexContent:{extension:{sequence:{element:e=>e}}}});for(const a of n){const n=a.getAttribute("name");if(!n)continue;let o,l;if(a.hasAttribute("type")?o=z(a.getAttribute("type")).name:d.visitXML(a,{simpleType:{restriction:e=>(o=z(e.getAttribute("base")).name,{maxLength:e=>{l=+e.getAttribute("value")}})}}),!o)continue;const u="true"===a.getAttribute("nillable");let c=!1;switch(o.toLowerCase()){case"integer":case"nonpositiveinteger":case"negativeinteger":case"long":case"int":case"short":case"byte":case"nonnegativeinteger":case"unsignedlong":case"unsignedint":case"unsignedshort":case"unsignedbyte":case"positiveinteger":s.push(new p({name:n,alias:n,type:"integer",nullable:u,length:f.getFieldDefaultLength("integer")}));break;case"float":case"double":case"decimal":s.push(new p({name:n,alias:n,type:"double",nullable:u,length:f.getFieldDefaultLength("double")}));break;case"boolean":case"string":case"gyearmonth":case"gyear":case"gmonthday":case"gday":case"gmonth":case"anyuri":case"qname":case"notation":case"normalizedstring":case"token":case"language":case"idrefs":case"entities":case"nmtoken":case"nmtokens":case"name":case"ncname":case"id":case"idref":case"entity":case"duration":case"time":s.push(new p({name:n,alias:n,type:"string",nullable:u,length:l??f.getFieldDefaultLength("string")}));break;case"datetime":case"date":s.push(new p({name:n,alias:n,type:"date",nullable:u,length:l??f.getFieldDefaultLength("date")}));break;case"pointpropertytype":i="point",c=!0;break;case"multipointpropertytype":i="multipoint",c=!0;break;case"curvepropertytype":case"multicurvepropertytype":case"multilinestringpropertytype":i="polyline",c=!0;break;case"surfacepropertytype":case"multisurfacepropertytype":case"multipolygonpropertytype":i="polygon",c=!0;break;case"geometrypropertytype":case"multigeometrypropertytype":c=!0,t.push(new r(b,`geometry type '${o}' is not supported`,{type:(new XMLSerializer).serializeToString(e)}));break;default:t.push(new r("wfs-layer:unknown-field-type",`Unknown field type '${o}'`,{type:(new XMLSerializer).serializeToString(e)}))}c&&s.push(new p({name:n,alias:n,type:"geometry",nullable:u}))}for(const e of s)if("integer"===e.type&&!e.nullable&&P.has(e.name.toLowerCase())){e.type="oid";break}return{geometryType:i,fields:s,errors:t}}(t)}throw new r(_,`Type '${e}' not found in document`,{document:(new XMLSerializer).serializeToString(n)})}const P=new Set(["objectid","fid"]);async function O(e,s,i,n,a){let{data:o}=await t(e,{responseType:"text",query:N(s,i,n,a),signal:a?.signal});o=o.replaceAll(/": +(-?\d+),(\d+)(,)?/g,'": $1.$2$3');try{return JSON.parse(o)}catch(e){throw new r("wfs-layer:malformed-json","Error while parsing the response",{response:o,error:e})}}function N(e,t,r,s){const i="number"==typeof t?t:t.wkid;return{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:y,TYPENAMES:e,OUTPUTFORMAT:r,SRSNAME:"EPSG:"+i,STARTINDEX:s?.startIndex,COUNT:s?.count,...s?.customParameters}}function C(e){return(new DOMParser).parseFromString(e.trim(),"text/xml")}function z(e){const[t,r]=e.split(":");return{prefix:r?t:"",name:r??t}}function B(e){let t="",s="";if(d.visitXML(e.firstElementChild,{Exception:e=>(t=e.getAttribute("exceptionCode"),{ExceptionText:e=>{s=e.textContent}})}),t)throw new r(`wfs-layer:${t}`,s)}function k(e,t,r){const s={wkid:t.defaultSpatialReference},i=null!=r?.wkid?{wkid:r.wkid}:s;return{spatialReference:i,getFeatureSpatialReference:h.isArcGISUrl(e)||i.wkid&&t.supportedSpatialReferences.includes(i.wkid)?{wkid:i.wkid}:{wkid:t.defaultSpatialReference}}}e.describeFeatureType=E,e.findFeatureType=F,e.getCapabilities=async function(e,r){const s=S((await t(e,{responseType:"text",query:{SERVICE:"WFS",REQUEST:"GetCapabilities",VERSION:y,...r?.customParameters},signal:r?.signal})).data);return function(e,t){i.isHTTPSProtocol(e)&&(i.hasSameOrigin(e,t.operations.DescribeFeatureType.url,!0)&&(t.operations.DescribeFeatureType.url=i.toHTTPS(t.operations.DescribeFeatureType.url)),i.hasSameOrigin(e,t.operations.GetFeature.url,!0)&&(t.operations.GetFeature.url=i.toHTTPS(t.operations.GetFeature.url)))}(e,s),s},e.getFeature=O,e.getFeatureCount=async function(e,r,s){const i=await t(e,{responseType:"text",query:{SERVICE:"WFS",REQUEST:"GetFeature",VERSION:y,TYPENAMES:r,RESULTTYPE:"hits",...s?.customParameters},signal:s?.signal}),n=/numberMatched=["'](?<numberMatched>\d+)["']/gi.exec(i.data);if(n?.groups)return+n.groups.numberMatched},e.getFeatureTypeInfo=I,e.getGetFeatureSpatialReference=k,e.getWFSLayerInfo=async function(e,t,s,i={}){const{featureType:n,extent:a}=await I(e,t,s,i),{spatialReference:l}=k(e.operations.GetFeature.url,n,i.spatialReference),{fields:u,geometryType:c,swapXY:d,objectIdField:h,geometryField:p}=await async function(e,t,s,i={}){const{typeName:n}=t,[a,o]=await Promise.allSettled([E(e.operations.DescribeFeatureType.url,n,i),R(e,n,s,i)]),l=e=>new r("wfs-layer:getWFSLayerTypeInfo-error",`An error occurred while getting info about the feature type '${n}'`,{error:e});if("rejected"===a.status)throw l(a.reason);if("rejected"===o.status)throw l(o.reason);const{fields:u,errors:c}=a.value??{},d=a.value?.geometryType||o.value?.geometryType,h=o.value?.swapXY??!1;if(null==d)throw new r(b,`The geometry type could not be determined for type '${n}`,{typeName:n,geometryType:d,fields:u,errors:c});return{...w(u??[]),geometryType:d,swapXY:h}}(e,n,l,i);return{url:e.operations.GetCapabilities.url,name:n.name,namespaceUri:n.namespaceUri,fields:u,geometryField:p,geometryType:c,objectIdField:h,spatialReference:i.spatialReference??new o({wkid:n.defaultSpatialReference}),extent:a,swapXY:d,wfsCapabilities:e,customParameters:i.customParameters}},e.parseDescribeFeatureTypeResponse=A,e.parseGetCapabilitiesResponse=S,e.prepareWFSLayerFields=w,e.wfsOidFieldName=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/ogc/xmlUtils":function(){define(["exports"],function(e){"use strict";e.iterateXML=function*e(t,r){for(const s of t.children)if(s.localName in r){const t=r[s.localName];"function"==typeof t?yield t(s):yield*e(s,t)}},e.visitXML=function e(t,r){if(t&&r)for(const s of t.children)if(s.localName in r){const t=r[s.localName];if("function"==typeof t){const r=t(s);r&&e(s,r)}else e(s,t)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["../../../core/asyncUtils","../../../core/Error","../../../core/Logger","../../../core/mathUtils","../../../core/promiseUtils","../../../core/Warning","../../../geometry/support/spatialReferenceUtils","../featureConversionUtils","../data/executeQueryForSnapping","../data/FeatureStore","../data/projectionSupport","../data/QueryEngine","./geojson/geojson","./support/sourceUtils","../../ogc/wfsUtils","../../support/FieldsIndex","../../../support/guards","../../../time/constants"],function(e,t,r,s,i,n,a,o,l,u,c,d,h,p,f,m,y,g){"use strict";const _="esri.layers.WFSLayer";function b(e){const t=[];return null!=e.totalRecordCount&&(e.features.length<e.totalRecordCount&&t.push({name:"wfs-layer:maxRecordCount-too-low",message:`Could only fetch ${e.features.length} of ${e.totalRecordCount} in ${e.maxPageCount} queries. Try increasing the value of WFSLayer.maxRecordCount.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount}}),e.totalRecordCount>e.maxTotalRecordCount&&t.push({name:"wfs-layer:large-dataset",message:`The number of ${e.totalRecordCount} features exceeds the maximum allowed of ${e.maxTotalRecordCount}.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount,maxTotalRecordCount:e.maxTotalRecordCount}})),t}return class{constructor(){this._customParameters=null,this._queryEngine=null,this._supportsPagination=!0}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,r={}){const{getFeatureUrl:s,getFeatureOutputFormat:n,fields:a,geometryType:o,featureType:l,maxRecordCount:h,maxTotalRecordCount:p,maxPageCount:y,objectIdField:_,customParameters:S}=e,{spatialReference:x,getFeatureSpatialReference:v}=f.getGetFeatureSpatialReference(s,l,e.spatialReference);try{await c.checkProjectionSupport(v,x)}catch{throw new t("unsupported-projection","Projection not supported",{inSpatialReference:v,outSpatialReference:x})}i.throwIfAborted(r),this._customParameters=S,this._featureType=l,this._fieldsIndex=m.fromLayerJSON({fields:a,dateFieldsTimeReference:a.some(e=>"esriFieldTypeDate"===e.type)?{timeZoneIANA:g.utc}:null}),this._geometryType=o,this._getFeatureUrl=s,this._getFeatureOutputFormat=n,this._getFeatureSpatialReference=v,this._maxRecordCount=h,this._maxTotalRecordCount=p,this._maxPageCount=y,this._objectIdField=_,this._spatialReference=x;let T=await this._snapshotFeatures(r);if(T.errors.length>0&&(this._supportsPagination=!1,T=await this._snapshotFeatures(r),T.errors.length>0))throw T.errors[0];const M={type:"object-id",fieldName:_};return this._queryEngine=new d.QueryEngine({fieldsIndex:this._fieldsIndex,geometryType:o,hasM:!1,hasZ:!1,featureIdInfo:M,spatialReference:x,timeInfo:null,featureStore:new u({geometryType:o,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(T.features),{warnings:b(T),extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t("wfs-source:editing-not-supported","applyEdits() is not supported on WFSLayer")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){return await this._waitSnapshotComplete(),(await this._queryEngine.executeQueryForIds(e,t.signal)).filter(y.isNumber)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),l.executeQueryForSnapping(this._queryEngine,e,t.signal)}async queryAttributeBins(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeAttributeBinsQuery(e,t.signal)}async refresh(t){return this._customParameters=t.customParameters,this._maxRecordCount=t.maxRecordCount,this._maxTotalRecordCount=t.maxTotalRecordCount,this._maxPageCount=t.maxPageCount,this._snapshotTask?.abort(),this._snapshotTask=e.createTask(e=>this._snapshotFeatures({signal:e})),this._snapshotTask.promise.then(e=>{this._queryEngine.featureStore.clear(),this._queryEngine.featureStore.addMany(e.features);for(const t of b(e))r.getLogger(_).warn(new n("wfs-layer:refresh-warning",t.message,t.details));e.errors?.length&&r.getLogger(_).warn(new n("wfs-layer:refresh-error","Refresh completed with errors",{errors:e.errors}))},()=>{this._queryEngine.featureStore.clear()}),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures(e){const t=e?.signal,r=this._maxTotalRecordCount,n=this._maxPageCount,a=this._supportsPagination&&n>1?await f.getFeatureCount(this._getFeatureUrl,this._featureType.typeName,{customParameters:this._customParameters,signal:t}):void 0;let o=[];const l=[];if(null==a)try{o=await this._singleQuery(t)}catch(e){i.isAbortError(e)||l.push(e)}else{const e=Math.min(a,r),u=function*(e,t,r){for(let s=0;s<t;s++)yield e._pageQuery(s,r)}(this,s.clamp(Math.ceil(e/this._maxRecordCount),1,n),t);await Promise.allSettled(Array.from({length:10}).map(()=>async function(e,t,r){let s=e.next();for(;!s.done;){try{const e=await s.value;t.push(...e)}catch(e){i.isAbortError(e)||r.push(e)}s=e.next()}}(u,o,l)))}return i.throwIfAborted(t),{features:o,totalRecordCount:a,maxTotalRecordCount:r,maxPageCount:n,errors:l}}async _singleQuery(e){const t=Number.isFinite(this._maxRecordCount)&&this._maxRecordCount>0?this._maxRecordCount:void 0,r=await f.getFeature(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,count:t,signal:e});return this._processGeoJSON(r,{signal:e})}async _pageQuery(e,t){const r=e*this._maxRecordCount,s=await f.getFeature(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,startIndex:r,count:this._maxRecordCount,signal:t});return this._processGeoJSON(s,{startIndex:r,signal:t})}_processGeoJSON(e,t){h.validateGeoJSON(e,this._getFeatureSpatialReference.wkid);const{startIndex:r,signal:s}=t;i.throwIfAborted(s);const n=h.createOptimizedFeatures(e,{geometryType:this._geometryType,hasZ:!1,objectIdField:this._objectIdField});if(!a.equals(this._spatialReference,this._getFeatureSpatialReference))for(const e of n)null!=e.geometry&&(e.geometry=o.convertFromGeometry(c.project(o.convertToGeometry(e.geometry,this._geometryType,!1,!1),this._getFeatureSpatialReference,this._spatialReference)));let l=r??1;for(const e of n){const t={};p.mixAttributes(this._fieldsIndex,t,e.attributes,!0),e.attributes=t,null==t[this._objectIdField]&&(e.objectId=t[this._objectIdField]=l++)}return n}}});