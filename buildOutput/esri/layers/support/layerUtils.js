// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../kernel","../../request","../../core/Collection","../../core/urlUtils","../catalog/catalogUtils"],function(e,t,r,n,i,a){"use strict";function s(e){return"scene"===e?.type}function u(e){return null!=e&&"object"==typeof e&&"type"in e&&"subtype-group"===e.type&&"sublayers"in e}function o(e){const t=e?.type;return"imagery-tile"===t||"tile"===t||"open-street-map"===t||"vector-tile"===t||"web-tile"===t||"wmts"===t}function l(e,t){return null!=e?.parent&&"declaredClass"in e.parent&&"esri.Basemap"===e.parent.declaredClass&&e.parent[t].includes(e)}function c(e){if(!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function y(e){return!e||"Feature Service"===e.type&&!e.sourceUrl}e.applyPreferredHostToPortalItem=function(e,t){if(!t||!y(e))return;const r=(e.url,null);r&&(e.url=r)},e.getEffectiveEditingEnabled=function(e){return!!function(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)},e.getEffectiveLayerCapabilities=function(e){return c(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null},e.getLayersWithChartSupport=function(e){const t=new n;for(const r of e.allLayers.concat(e.allTables))"csv"===r.type||a.isLayerFromCatalog(r)||("charts"in r&&t.push(r),"subtype-group"===r.type&&t.push(...r.sublayers));return t},e.getOwningPortalUrl=async function(e,n){const i=t.id?.findServerInfo(e);if(null!=i?.currentVersion)return i.owningSystemUrl||null;const a=e.toLowerCase().indexOf("/rest/services");if(-1===a)return null;const s=`${e.slice(0,a)}/rest/info`,u=null!=n?n.signal:null,{data:o}=await r(s,{query:{f:"json"},responseType:"json",signal:u});return o?.owningSystemUrl||null},e.getPreferredHost=function(e){return null},e.getPreferredUrl=function(e,t){return null},e.getSubtypesFromLayer=function(e){return e?("subtypes"in e?e.subtypes:u(e.parent)?e.parent.subtypes:[])??[]:[]},e.getTileMaxtrixSetFromActiveLayer=function(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const r=e.activeLayer.tileMatrixSets;if(r)return r}return null},e.isBaseLayer=function(e){return l(e,"baseLayers")},e.isBasemap3DSupportedLayer=function(e){return o(e)||s(e)},e.isBasemapSupportedTiledLayer=o,e.isFeatureCollectionLayer=function(e){return"feature"===e?.type&&!e.url&&"memory"===e.source?.type},e.isFeatureLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"feature"===e.type},e.isFeatureServiceLayer=function(e){return"feature"===e?.type&&"feature-layer"===e.source?.type},e.isGraphicsLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"graphics"===e.type},e.isGroupLayer=function(e){return null!=e&&"type"in e&&"group"===e.type},e.isImageryTileLayer=function(e){return"imagery-tile"===e?.type},e.isIntegratedMeshLayer=function(e){return"integrated-mesh"===e||"integrated-mesh-3dtiles"===e},e.isIntegratedMeshOperationalLayer=function(e){return"IntegratedMeshLayer"===e||"IntegratedMesh3DTilesLayer"===e},e.isKnowledgeGraphLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"knowledge-graph"===e.type&&"layers"in e},e.isKnowledgeGraphSublayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"knowledge-graph-sublayer"===e.type},e.isLayerWithFeatureCapabilities=c,e.isLayerWithFeatureLayerSource=function(e){const t=e?.type;return("feature"===t||"subtype-group"===t||"oriented-imagery"===t)&&"feature-layer"===e?.source?.type},e.isLayerWithFlowRenderer=function(e){return("imagery"===e.type||"imagery-tile"===e.type)&&"flow"===e.renderer?.type},e.isLinkChartLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"link-chart"===e.type&&"layers"in e},e.isMapImageLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"map-image"===e.type},e.isMapNotesLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"map-notes"===e.type&&"sublayers"in e},e.isPreferredUrlApplicable=y,e.isReferenceLayer=function(e){return l(e,"referenceLayers")},e.isSceneLayer=s,e.isSceneServiceLayer=function(e){const t=e?.type;return"building-scene"===t||"integrated-mesh"===t||"point-cloud"===t||"scene"===t},e.isSubtypeGroupLayer=u,e.isSubtypeSublayer=function(e){return"subtype-sublayer"===e?.type},e.isTable=function(e){return null!=e&&"object"==typeof e&&"isTable"in e&&!!e.isTable},e.isTiledLayer=function(e){const t=e?.type;return"base-tile"===t||"tile"===t||"elevation"===t||"imagery-tile"===t||"base-elevation"===t||"open-street-map"===t||"wcs"===t||"web-tile"===t||"wmts"===t||"vector-tile"===t},e.isVoxelLayer=function(e){return"voxel"===e?.type},e.sceneServiceLayerTypeToClassName={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"},e.serializeLayerDefinitions=function(e){const t=/[:;]/,r=[];let n=!1;if(e&&(e.forEach((e,i)=>{r.push([i,e]),!n&&t.test(e)&&(n=!0)}),r.length>0)){let e;if(n){const t={};r.forEach(e=>{t[e[0]]=e[1]}),e=JSON.stringify(t)}else{const t=[];r.forEach(e=>{t.push(e[0]+":"+e[1])}),e=t.join(";")}return e}return null},e.serializeTimeOptions=function(e){if(!e)return;const t=[];return e.forEach((e,r)=>{t.push('"'+r+'":'+JSON.stringify(e))}),t.length?"{"+t.join(",")+"}":void 0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});