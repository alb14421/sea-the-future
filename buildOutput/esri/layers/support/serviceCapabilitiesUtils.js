// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/has","./arcgisLayerUrl","./infoFor3D","../../rest/support/jsonUtils"],function(e,t,o,s,r){"use strict";const a={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function p(e){const t=e?.supportedSpatialAggregationStatistics?.map(e=>e.toLowerCase());return{envelope:!!t?.includes("envelopeaggregate"),centroid:!!t?.includes("centroidaggregate"),convexHull:!!t?.includes("convexhullaggregate")}}function n(e,t){const o=e?.supportedOperationsWithCacheHint?.map(e=>e.toLowerCase());return!!o?.includes(t.toLowerCase())}function u(e){const t=e?.supportedStatisticTypes?.map(e=>e.toLowerCase());return{count:!!t?.includes("count"),sum:!!t?.includes("sum"),min:!!t?.includes("min"),max:!!t?.includes("max"),avg:!!t?.includes("avg"),var:!!t?.includes("var"),stddev:!!t?.includes("stddev"),percentileContinuous:!!t?.includes("percentile_cont"),percentileDiscrete:!!t?.includes("percentile_disc"),envelope:!!t?.includes("envelopeaggregate"),centroid:!!t?.includes("centroidaggregate"),convexHull:!!t?.includes("convexhullaggregate")}}function i(e){const t=e?.supportedNormalizationTypes?.map(e=>e.toLowerCase());return{field:!!t?.includes("field"),log:!!t?.includes("log"),naturalLog:!!t?.includes("naturallog"),percentOfTotal:!!t?.includes("percentoftotal"),squareRoot:!!t?.includes("squareroot")}}function l(e){return{supportsCacheHint:n(e.advancedQueryCapabilities,"queryAnalytics")}}function d(e){const t=e.attachmentProperties,o={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:n(e.advancedQueryCapabilities,"queryAttachments"),supportsOrderByFields:r.readBoolean(e.advancedQueryCapabilities,"supportsQueryAttachmentOrderByFields",!1),supportsResize:r.readBoolean(e,"supportsAttachmentsResizing",!1)};return t&&Array.isArray(t)&&t.forEach(e=>{const t=a[e.name];t&&(o[t]=!!e.isEnabled)}),o}function c(e){return{isVersioned:r.readBoolean(e,"isDataVersioned",!1),isBranchVersioned:r.readBoolean(e,"isDataBranchVersioned",!1),supportsAttachment:r.readBoolean(e,"hasAttachments",!1),supportsM:r.readBoolean(e,"hasM",!1),supportsZ:r.readBoolean(e,"hasZ",!1)}}function y(e){return{supportsAdvancedFieldProperties:r.readBoolean(e,"supportsFieldDescriptionProperty",!1)}}function B(e,t,s){const a=e?.toLowerCase().split(",").map(e=>e.trim())??[],p=s?o.parse(s):null,n=a.includes("MapServer"===p?.serverType?"data":"query"),u=a.includes("editing")&&!t.datesInUnknownTimezone&&!(!0===t.uniqueIdInfo?.OIDFieldContainsHashValue);let i=u&&a.includes("create"),l=u&&a.includes("delete"),d=u&&a.includes("update");const c=a.includes("changetracking"),y=t.advancedQueryCapabilities;return u&&!(i||l||d)&&(i=l=d=!0),{supportsCalculate:r.readBoolean(t,"supportsCalculate",!1),supportsTruncate:r.readBoolean(t,"supportsTruncate",!1),supportsValidateSql:r.readBoolean(t,"supportsValidateSql",!1),supportsAdd:i,supportsDelete:l,supportsEditing:u,supportsChangeTracking:c,supportsQuery:n,supportsQueryAnalytics:r.readBoolean(y,"supportsQueryAnalytic",!1),supportsQueryAttachments:r.readBoolean(y,"supportsQueryAttachments",!1),supportsQueryBins:r.readBoolean(y,"supportsQueryBins",!1)||!!t.queryBinsCapabilities,supportsQueryTopFeatures:r.readBoolean(y,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:r.readBoolean(t,"supportsAttachmentsResizing",!1),supportsSync:a.includes("sync"),supportsUpdate:d,supportsExceedsLimitStatistics:r.readBoolean(t,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:r.readBoolean(t,"supportsAsyncConvert3D",!1)}}function m(e,a){const u=e.advancedQueryCapabilities,i=e.ownershipBasedAccessControlForFeatures,l=e.archivingInfo,d=e.currentVersion,c=a?.includes("MapServer"),y=!c||d>=t("mapserver-pbf-version-support"),B=o.isHostedAgolService(a),m=new Set((e.supportedQueryFormats??"").split(",").map(e=>e.toLowerCase().trim()));return{maxRecordCount:r.readNumber(e,"maxRecordCount",void 0),maxRecordCountFactor:r.readNumber(e,"maxRecordCountFactor",void 0),maxUniqueIDCount:r.readNumber(e,"maxUniqueIDCount",void 0),standardMaxRecordCount:r.readNumber(e,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:p(u),supportsCacheHint:r.readBoolean(u,"supportsQueryWithCacheHint",!1)||n(u,"query"),supportsCentroid:r.readBoolean(u,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:B,supportsCurrentUser:r.readBoolean(u,"supportsCurrentUserQueries",!1),supportsDefaultSpatialReference:r.readBoolean(u,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:r.readBoolean(u,"supportsDisjointSpatialRel",!1),supportsDistance:r.readBoolean(u,"supportsQueryWithDistance",!1),supportsDistinct:r.readBoolean(u,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:r.readBoolean(u,"supportsReturningQueryExtent",!1),supportsFormatPBF:y&&m.has("pbf"),supportsFullTextSearch:r.readBoolean(u,"supportsFullTextSearch",!1),supportsGeometryProperties:r.readBoolean(u,"supportsReturningGeometryProperties",!1),supportsHavingClause:r.readBoolean(u,"supportsHavingClause",!1),supportsHistoricMoment:r.readBoolean(l,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:r.readBoolean(u,"supportsMaxRecordCountFactor",!1),supportsOrderBy:r.readBoolean(u,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:r.readBoolean(u,"supportsPagination",!1),supportsPaginationOnAggregatedQueries:r.readBoolean(u,"supportsPaginationOnAggregatedQueries",!1),supportsPercentileStatistics:r.readBoolean(u,"supportsPercentileStatistics",!1),supportsQuantization:r.readBoolean(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:r.readBoolean(e,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:r.readBoolean(i,"allowAnonymousToQuery",!0),supportsQueryByOthers:r.readBoolean(i,"allowOthersToQuery",!0),supportsQueryGeometry:r.readBoolean(e,"supportsReturningQueryGeometry",!1),supportsResultType:r.readBoolean(u,"supportsQueryWithResultType",!1),supportsReturnMesh:!!s.getGltfQueryFormat(e.infoFor3D),supportsSpatialAggregationStatistics:r.readBoolean(u,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:r.readBoolean(u,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:r.readBoolean(e,"useStandardizedQueries",!1),supportsStatistics:r.readBoolean(u,"supportsStatistics",e.supportsStatistics),supportsTopFeaturesQuery:r.readBoolean(u,"supportsTopFeaturesQuery",!1),supportsTrueCurve:r.readBoolean(u,"supportsTrueCurve",!1),tileMaxRecordCount:r.readNumber(e,"tileMaxRecordCount",void 0)}}function g(e){const t=e.advancedQueryCapabilities,o=r.readBoolean(t,"supportsAdvancedQueryRelated",!1);return{supportsPagination:r.readBoolean(t,"supportsQueryRelatedPagination",!1),supportsCount:o,supportsOrderBy:o,supportsCacheHint:n(t,"queryRelated")}}function C(e){return{supportsCacheHint:n(e.advancedQueryCapabilities,"queryTopFilter")}}function v(e){const t=e?e.queryBinsCapabilities:void 0;return{supportsDate:r.readBoolean(t,"supportsDateBin",!1),supportsFixedInterval:r.readBoolean(t,"supportsFixedIntervalBin",!1),supportsAutoInterval:r.readBoolean(t,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:r.readBoolean(t,"supportsFixedBoundariesBin",!1),supportsStackBy:r.readBoolean(t,"supportsStackBy",!1),supportsSplitBy:r.readBoolean(t,"supportsSplitBy",!1),supportsSnapToData:r.readBoolean(t,"supportsSnapToData",!1),supportsReturnFullIntervalBin:r.readBoolean(t,"supportsReturnFullIntervalBin",!1),supportsFirstDayOfWeek:r.readBoolean(t,"supportsFirstDayOfWeek",!1),supportsNormalization:r.readBoolean(t,"supportsNormalization",!1),supportedStatistics:u(t),supportedNormalizationTypes:i(t)}}function h(e){const t=e.ownershipBasedAccessControlForFeatures,o=e?e.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:r.readBoolean(e,"allowGeometryUpdates",!0),supportsGlobalId:r.readBoolean(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:r.readBoolean(e,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:r.readBoolean(e,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:r.readBoolean(e,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:r.readBoolean(e,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:r.readBoolean(t,"allowAnonymousToDelete",!0),supportsDeleteByOthers:r.readBoolean(t,"allowOthersToDelete",!0),supportsUpdateByAnonymous:r.readBoolean(t,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:r.readBoolean(t,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:r.readBoolean(o,"supportsAsyncApplyEdits",!1),zDefault:r.readNumber(e,"zDefault",void 0)}}e.getFeatureLayerCapabilities=function(e,t){return{analytics:l(e),attachment:d(e),data:c(e),metadata:y(e),operations:B(e.capabilities,e,t),query:m(e,t),queryAttributeBins:v(e),queryRelated:g(e),queryTopFeatures:C(e),editing:h(e)}},e.getVideoLayerCapabilities=function(e){return{operations:{supportsAppend:r.readBoolean(e,"supportsAppend",!1),supportsCoverageQuery:e?.playbackInfo?.klv["0601"]??!1,supportsExportClip:r.readBoolean(e,"supportsExportClip",!1),supportsExportFrameset:r.readBoolean(e,"supportsExportFrameset",!1),supportsMensuration:r.readBoolean(e,"supportsMensuration",!1),supportsPreviews:r.readBoolean(e,"supportsPreviews",!1),supportsUpdate:r.readBoolean(e,"supportsUpdate",!1)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});