// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["./byteStreamUtils"],function(e){"use strict";return class{static get supportedVersions(){return[5]}static parse(t){const n=new DataView(t),r=3&n.getUint8(0);if(3!==r)return{header:{version:r},recordSet:null};const i=n.getUint32(4,!0),s=n.getUint16(8,!0),a=n.getUint16(10,!0),o={version:r,recordCount:i,headerByteCount:s,recordByteCount:a};let l=32;const p=[],c=[];let d;if(3===r){for(;13!==n.getUint8(l);)d=String.fromCharCode(n.getUint8(l+11)).trim(),p.push({name:e.bytesToUTF8(new Uint8Array(t,l,11)),type:d,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(d)],length:n.getUint8(l+16)}),l+=32;if(l+=1,p.length>0)for(;c.length<i&&t.byteLength-l>a;){const r=[];32===n.getUint8(l)?(l+=1,p.forEach(n=>{if("C"===n.type)r.push(e.bytesToUTF8(new Uint8Array(t,l,n.length)).trim());else if("N"===n.type)r.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(t,l,n.length)).trim(),10));else if("F"===n.type)r.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(t,l,n.length)).trim()));else if("D"===n.type){const e=String.fromCharCode.apply(null,new Uint8Array(t,l,n.length)).trim();r.push(new Date(parseInt(e.slice(0,4),10),parseInt(e.slice(4,6),10)-1,parseInt(e.slice(6,8),10)))}l+=n.length}),c.push(r)):l+=a}}const g=function(e){const t=e.fields,n=e.records,r=t.some(e=>"oid"===e.name.toLowerCase())?"OBJECTID":"OID",i=[{name:r,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map(e=>({name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}))),s=i.map(e=>e.name),a=[];let o=0,l=0;return n.forEach(e=>{const t={};for(t[r]=o++,l=1;l<s.length;l++)t[s[l]]=e[l-1];a.push({attributes:t})}),{displayFieldName:"",fields:i,features:a}}({fields:p,records:c});return{header:o,fields:p,records:c,recordSet:g}}}});