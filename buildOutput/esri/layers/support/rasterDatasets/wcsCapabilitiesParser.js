// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Error","../../../geometry/Extent","./xmlUtilities"],function(e,t,r,n){"use strict";function i(e){return e.endsWith("?")?e.slice(0,-1):e}function o(e){return e.filter(({coverageSubType:e})=>null==e||""===e||/^rectified(grid|dataset)/i.test(e))}function a(e){const t={};for(let i=0;i<e.childNodes.length;i++){const o=e.childNodes[i];if(1!==o.nodeType)continue;const l=n.getNodeNameIgnoreNS(o).toLowerCase();switch(l){case"title":case"abstract":t[l]=n.getElementValue(o);break;case"identifier":t.id=n.getElementValue(o);break;case"wgs84boundingbox":{const e=n.getSpaceDelimitedNumericValues(o,"LowerCorner"),i=n.getSpaceDelimitedNumericValues(o,"UpperCorner");t.lonLatEnvelope=new r({xmin:e[0],ymin:e[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":t.coverageSummaries=t.coverageSummaries||[],t.coverageSummaries.push(a(o))}}return t}function l(e,t){if(e.coverageSummaries)for(let r=0;r<e.coverageSummaries.length;r++)e.coverageSummaries[r].abstract=e.coverageSummaries[r].abstract||e.abstract,e.coverageSummaries[r].lonLatEnvelope=e.coverageSummaries[r].lonLatEnvelope||e.lonLatEnvelope,e.coverageSummaries[r].title=e.coverageSummaries[r].title||e.title,l(e.coverageSummaries[r],t);null!=e.id&&t.push(e)}function s(e){const t=n.getElement(e.querySelector("Operation[name=GetCapabilities]"),"Get")?.getAttribute("xlink:href")||"",r=n.getElement(e.querySelector("Operation[name=DescribeCoverage]"),"Get")?.getAttribute("xlink:href")||"",o=n.getElement(e.querySelector("Operation[name=GetCoverage]"),"Get")?.getAttribute("xlink:href")||"";return{getCapabilities:i(t),describeCoverage:i(r),getCoverage:i(o)}}e.isSupportedVersion=function(e){let t=null;t="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e;const r=t.documentElement.getAttribute("version"),n=r?.slice(0,3);return null!=n&&n<"2.1"},e.parseCapabilities=function(e,c=null){let u=null;u="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e;let m=u.documentElement.getAttribute("version");"1.0"===m?m="1.0.0":"1.1"===m&&(m="1.1.0");const g=m||c||"1.0.0",p=g.slice(0,3);let d;if("2.0"===p)d=function(e){const t=n.getElement(e,"ServiceIdentification"),i=n.getElementValue(t,"Title"),a=n.getElementValues(t,"ServiceTypeVersion"),l=n.getElementValues(t,"Profile"),c=s(n.getElement(e,"OperationsMetadata")),u=n.getElements(e,"Contents/CoverageSummary"),m=[];for(let e=0;e<u.length;e++){const t=u[e],i=n.getElementValue(t,"CoverageId"),o=n.getElement(t,"WGS84BoundingBox");let a;if(o){const e=n.getSpaceDelimitedNumericValues(o,"LowerCorner"),t=n.getSpaceDelimitedNumericValues(o,"UpperCorner");a=new r({xmin:e[0],ymin:e[1],xmax:t[0],ymax:t[1],spatialReference:{wkid:4326}})}const l=n.getElementValue(t,"CoverageSubtype")||"RectifiedGridCoverage";m.push({id:i,lonLatEnvelope:a,coverageSubType:l})}const g=n.getElement(e,"ServiceMetadata");return{name:i,supportedVersions:a,supportedFormats:n.getElementValues(g,"formatSupported"),supportedInterpolations:n.getElementValues(g,"interpolationSupported").concat(n.getElementValues(g,"InterpolationSupported")),onlineResources:c,profiles:l,coverages:m,gridCoverages:o(m),version:"2.0.1"}}(u);else if("1.1"===p)d=function(e){const t=n.getElementValue(e,"ServiceIdentification/Title"),r=n.getElementValues(e,"ServiceIdentification/ServiceTypeVersion"),i=s(n.getElement(e,"OperationsMetadata")),c=[],u=n.getElement(e,"Contents");for(let e=0;e<u.childNodes.length;e++){const t=u.childNodes[e];1===t.nodeType&&n.isSameTagIgnoreNS(t,"CoverageSummary")&&l(a(t),c)}const m=n.getElementValues(u,"SupportedFormat");return{name:t,onlineResources:i,coverages:c,gridCoverages:o(c),supportedVersions:r,supportedFormats:m,version:"1.1.0"}}(u);else{if("1.0"!==p)throw new t("wcsraster:parsecapabilities","the capabilities version is not supported");d=function(e){const t=n.getElementValue(e,"Service/name"),a=n.getElement(e,"Capability"),l=n.getElement(a,"GetCapabilities/Get/OnlineResource")?.getAttribute("xlink:href")??"",s=n.getElement(a,"DescribeCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",c=n.getElement(a,"GetCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",u={getCapabilities:i(l),describeCoverage:i(s),getCoverage:i(c)},m=n.getElements(e,"CoverageOfferingBrief"),g=[];for(let e=0;e<m.length;e++){const t=m[e],i=n.getElementValue(t,"name"),o=n.getElements(t,"pos"),a=n.getSpaceDelimitedNumericValues(o[0]),l=n.getSpaceDelimitedNumericValues(o[1]),s=new r({xmin:a[0],ymin:a[1],xmax:l[0],ymax:l[1],spatialReference:{wkid:4326}});g.push({id:i,lonLatEnvelope:s})}return{name:t,onlineResources:u,coverages:g,gridCoverages:o(g),supportedVersions:["1.0.0"],version:"1.0.0"}}(u)}return d.version=g,d},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});