// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports"],function(t){"use strict";function n(t,n,r=0){const o="--"+n.boundary,i=[];for(let t=0;t<o.length;t++)i.push(o.charCodeAt(t));const a=[],s="\n--"+n.boundary+"--";for(let t=0;t<s.length;t++)a.push(s.charCodeAt(t));const l=[10],c=[13,10],f=[],u=i.length,h=new Uint8Array(t,r),g=h.length-u;let d=0,p=0;for(let t=0;t<g;t++){for(p=0;p<u&&h[t+p]===i[p];p++);if(p!==u)continue;let r=!1;if(d){const o=e(h.subarray(d,t),n);f.push(o),r=!!o.isValidImage}if(t+=u-1,h[t+1]===l[0]?t+=1:h[t+1]===c[0]&&h[t+2]===c[1]&&(t+=2),d=t+1,r)break}const y=a.length;for(let t=h.length-y-10;t<h.length-y;t++){for(p=0;p<y&&h[t+p]===a[p];p++);if(p===y){f.push(e(h.subarray(d,t),n));break}}return f}function e(t,n){const e=String.fromCharCode.apply(null,t.subarray(0,Math.min(300,t.length))).split("\n"),r=Math.min(e.length,7),o={contentDisposition:"inline"};let i=0;for(let a=0;a<r;a++)if(e[a].length<4)i=i+e[a].length+1;else if("content"===e[a].slice(0,7).toLowerCase()){i=i+e[a].length+1;const t=e[a].indexOf(":");if(-1===t)continue;const n=e[a].slice(0,t).trim(),r=e[a].slice(t+1).trim();switch(n.toLowerCase()){case"content-type":o.contentType=r;break;case"content-description":o.contentDescription=r;break;case"content-transfer-encoding":o.contentTransferEncoding=r;break;case"content-id":o.contentID=r;break;case"content-disposition":o.contentDisposition=r;break;case"content-location":o.contentLocation=r}}else{if(o.contentDisposition.toLowerCase().includes("inline")&&e[a].length>=4&&o.contentType?.toLowerCase().includes("image")){let n=!0,e=t.subarray(i,t.length);if(o.contentType.toLowerCase().indexOf("tif")>0){if("base64"===o.contentTransferEncoding){let t="";const n=e;for(let e=0;e<n.length;e+=65535){const r=n.subarray(e,e+65535>n.length-1?n.length-1:e+65535);t+=String.fromCharCode.apply(null,r)}const r=atob(t);e=new Uint8Array(r.length);for(let t=0;t<e.length;t++)e[t]=r.charCodeAt(t)}n=73===e[0]&&73===e[1]||77===e[0]&&77===e[1]}if(n){let n=e.buffer;"base64"!==o.contentTransferEncoding&&(n=new ArrayBuffer(t.length-i),e=new Uint8Array(n),e.set(t.subarray(i,t.length))),o.contentData=n,o.isValidImage=!0}break}if((""===n.start||o.contentID===n.start)&&o.contentType){if(o.contentType.includes("text")||o.contentType.includes("xml")){o.contentData=String.fromCharCode.apply(null,t.subarray(i,t.length));break}o.contentData=t.subarray(i,t.length)}}return o}t.parse=function(t){const e=function(t){const n=t.getHeader?.("Content-Type")?.split(";");if(!n)return null;if(!(n[0].trim()??"").startsWith("multipart/"))return null;const e={boundary:"",start:"",type:""};for(let t=1;t<n.length;t++){const r=n[t].indexOf("=");if(r>0){const o=n[t].slice(0,r).trim(),i=n[t].slice(r+1).trim();e[o]=i.startsWith('"')?i.slice(1,-1):i}}return e}(t);return e?{isMultipart:!0,data:e.boundary?n(t.data,e,0):null}:{isMultipart:!1,data:null}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});