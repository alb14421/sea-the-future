// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../assets"],function(e,t,n){"use strict";const r=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,127]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-34027999387901484e22,34027999387901484e22]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-17976931348623157e292,17976931348623157e292]}];let a=null;const o={getBlobInfo:null,decode:null};function l(e,t,n){n.set(e.slice(t,t+n.length))}function s(e,t,n,r,a){if(n<2)return e;const o=new r(t*n);for(let r=0,a=0;r<t;r++)for(let l=0,s=r;l<n;l++,s+=t)o[s]=e[a++];return o}t.decode=function(e,t={}){const n=t.inputOffset??0,a=e instanceof Uint8Array?e.subarray(n):new Uint8Array(e,n),l=o.getBlobInfo(a),{data:i,maskData:u,noDataValues:c}=o.decode(a,l),{width:f,height:y,bandCount:h,depthCount:p,dataType:d,maskCount:g,statistics:b}=l,w=r[d],A=new w.ctor(i.buffer),m=[],U=[],x=f*y,T=x*p;for(let e=0;e<h;e++){const n=A.subarray(e*T,(e+1)*T);if(t.returnInterleaved)m.push(n);else{const e=s(n,x,p,w.ctor);m.push(e)}U.push(u.subarray(e*T,(e+1)*T))}const C=0===g?null:1===g?U[0]:new Uint8Array(x);if(g>1){C.set(U[0]);for(let e=1;e<U.length;e++){const t=U[e];for(let e=0;e<x;e++)C[e]=C[e]&t[e]}}const{noDataValue:V}=t,I=null!=V&&w.range[0]<=V&&w.range[1]>=V;if(g>0&&I)for(let e=0;e<h;e++){const t=m[e],n=U[e]||C;for(let e=0;e<x;e++)0===n[e]&&(t[e]=V)}const D=g===h&&h>1?U:null,{pixelType:z}=w;return{width:f,height:y,bandCount:h,pixelType:z,depthCount:p,statistics:b,pixels:m,mask:C,bandMasks:D,noDataValues:c}},t.getBlobInfo=function(e,t={}){const n=e instanceof Uint8Array?e.subarray(t.inputOffset??0):new Uint8Array(e,t.inputOffset??0);return o.getBlobInfo(n)},t.load=function(){return a||(a=new Promise((t,n)=>e(["../../../chunks/lerc-wasm"],t,n)).then(e=>e.lercWasm).then(({default:e})=>e({locateFile:e=>n.getAssetUrl(`esri/layers/support/rasterFormats/${e}`)})).then(e=>{!function(e){const{_malloc:t,_free:n,_lerc_getBlobInfo:a,_lerc_getDataRanges:s,_lerc_decode_4D:i,asm:u}=e;let c;const f=Object.values(u).find(t=>t&&"buffer"in t&&t.buffer===e.HEAPU8.buffer),y=e=>{const n=e.map(e=>16+(e>>3<<3)),r=n.reduce((e,t)=>e+t),a=t(r);c=new Uint8Array(f.buffer);let o=n[0];n[0]=a;for(let e=1;e<n.length;e++){const t=n[e];n[e]=n[e-1]+o,o=t}return n};o.getBlobInfo=e=>{const t=new Uint8Array(48),r=new Uint8Array(24),[o,i,u]=y([e.length,t.length,r.length]);c.set(e,o),c.set(t,i),c.set(r,u);let h=a(o,e.length,i,u,12,3);if(h)throw n(o),new Error(`lerc-getBlobInfo: error code is ${h}`);c=new Uint8Array(f.buffer),l(c,i,t),l(c,u,r);const p=new Uint32Array(t.buffer),d=new Float64Array(r.buffer),[g,b,,w,A,m,U,x,T,C,V]=p,I={version:g,depthCount:C,width:w,height:A,validPixelCount:U,bandCount:m,blobSize:x,maskCount:T,dataType:b,minValue:d[0],maxValue:d[1],maxZerror:d[2],statistics:[],bandCountWithNoData:V};if(V&&C>1)return n(o),I;if(1===C&&1===m)return n(o),I.statistics.push({minValue:d[0],maxValue:d[1]}),I;const D=C*m*8,z=new Uint8Array(D),F=new Uint8Array(D);let _=o,k=0,B=0,S=!1;if(c.byteLength<o+2*D?(n(o),S=!0,[_,k,B]=y([e.length,D,D]),c.set(e,_)):[k,B]=y([D,D]),c.set(z,k),c.set(F,B),h=s(_,e.length,C,m,k,B),h)throw n(_),S||n(k),new Error(`lerc-getDataRanges: error code is ${h}`);c=new Uint8Array(f.buffer),l(c,k,z),l(c,B,F);const v=new Float64Array(z.buffer),M=new Float64Array(F.buffer),O=I.statistics;for(let e=0;e<m;e++)if(C>1){const t=v.slice(e*C,(e+1)*C),n=M.slice(e*C,(e+1)*C),r=Math.min.apply(null,t),a=Math.max.apply(null,n);O.push({minValue:r,maxValue:a,depthStats:{minValues:t,maxValues:n}})}else O.push({minValue:v[e],maxValue:M[e]});return n(_),S||n(k),I},o.decode=(e,t)=>{const{maskCount:a,depthCount:o,bandCount:s,width:u,height:h,dataType:p,bandCountWithNoData:d}=t,g=r[p],b=u*h,w=new Uint8Array(b*s),A=b*o*s*g.size,m=new Uint8Array(A),U=new Uint8Array(s),x=new Uint8Array(8*s),[T,C,V,I,D]=y([e.length,w.length,m.length,U.length,x.length]);c.set(e,T),c.set(w,C),c.set(m,V),c.set(U,I),c.set(x,D);const z=i(T,e.length,a,C,o,u,h,s,p,V,I,D);if(z)throw n(T),new Error(`lerc-decode: error code is ${z}`);c=new Uint8Array(f.buffer),l(c,V,m),l(c,C,w);let F=null;if(d){l(c,I,U),l(c,D,x),F=[];const e=new Float64Array(x.buffer);for(let t=0;t<U.length;t++)F.push(U[t]?e[t]:null)}return n(T),{data:m,maskData:w,noDataValues:F}}}(e)}),a)},t.pixelTypeInfoMap=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});