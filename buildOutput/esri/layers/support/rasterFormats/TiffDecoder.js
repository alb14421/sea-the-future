// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/has","../rasterDatasets/byteStreamUtils","../../../chunks/Jpg","./Lerc","./Lzw","./pixelRangeUtils","./tiffTag","./utils","../../../chunks/Zlib"],function(e,t,n,a,i,r,s,l,o,f){"use strict";const u=[0,1,1,2,4,8,1,1,2,4,8,4,8,-1,-1,-1,8,8,8],c=4294967296,h=new Set([1,5,6,7,8,34712,34887]);function g(e,t){let n="unknown";return 3===e?n=64===t?"f64":"f32":1===e?1===t?n="u1":2===t?n="u2":4===t?n="u4":t<=8?n="u8":t<=16?n="u16":t<=32&&(n="u32"):2===e&&(t<=8?n="s8":t<=16?n="s16":t<=32&&(n="s32")),n}function E(e){let t=null;switch(e?e.toLowerCase():"f32"){case"u1":case"u2":case"u4":case"u8":t=Uint8Array;break;case"u16":t=Uint16Array;break;case"u32":t=Uint32Array;break;case"s8":t=Int8Array;break;case"s16":t=Int16Array;break;case"s32":t=Int32Array;break;case"f64":t=Float64Array;break;default:t=Float32Array}return t}function T(e,t){return{x:t[0]*e.x+t[1]*e.y+t[2],y:t[3]*e.x+t[4]*e.y+t[5]}}function I(e,t){return e.get(t)?.values}function d(e,t){return e.get(t)?.values}function w(e,t){return e.get(t)?.values?.[0]}function p(e,t){return e.get(t)?.values?.[0]}function y(e,t,n,a=0,i=l.tiffTags,r=4){const s=8===r,o=s?N(new DataView(e,n,8),0,t):new DataView(e,n,2).getUint16(0,t),f=4+2*r,u=s?8:2,c=u+o*f;if(n+c>e.byteLength)return{success:!1,ifd:null,nextIFD:null,requiredBufferSize:c};const h=8===r?8:4,g=n+c+h<=e.byteLength?k(new DataView(e,n+c,h),0,t,8===r):null,E=n+u,T=new Map;let I,d,w,p,y,S=0,A=0;for(let n=0;n<o;n++){d=new DataView(e,E+f*n,f),w=d.getUint16(0,t),y=d.getUint16(2,t),p=l.getTagName(w,i);const s=[];2===r?(S=d.getUint16(4,t),A=d.getUint16(6,t)):4===r?(S=d.getUint32(4,t),A=d.getUint32(8,t)):8===r&&(S=k(d,4,t,!0),A=k(d,12,t,!0),s.push(d.getUint32(12,t)),s.push(d.getUint32(16,t))),I={id:w,type:y,valueCount:S,valueOffset:A,valueOffsets:s,values:null},b(e,t,I,a,!1,r),T.set(p,I)}return{success:!0,ifd:T,nextIFD:g,requiredBufferSize:c}}function S(e,t){if(t%8==0)return e;const n=t>16?32:t>8?16:8;n>8&&(e=M(e,32===n?4:2));const a=32===n?Uint32Array:16===n?Uint16Array:Uint8Array,i=new a(e),r=Math.floor(8*e.byteLength/t+1e-6),s=new a(r),l=(1<<t)-1;let o=0,f=0,u=0;for(let e=0;e<r;e++)if(0===f&&(u=i[o++],f=n),f>=t)s[e]=u>>>f-t&l,f-=t;else{const a=t-f;let r=(u&l)<<a&l;u=i[o++],f=n-a,r+=u>>>f,s[e]=r}return s.buffer}function A(e,t,n){const i=new a.JpegImage;i.parse(e),i.colorTransform=6===n?-1:0;const r=i.getData(i.width,i.height,1!==t&&4!==t);return new Uint8Array(r.buffer)}function m(e){const t=new f.Zlib(e).getBytes(),n=new ArrayBuffer(t.length),a=new Uint8Array(n);return a.set(t),a}function M(e,t){const n=new Uint8Array(e),a=new Uint8Array(n.length);if(2===t)for(let e=0;e<n.length;e+=2)a[e]=n[e+1],a[e+1]=n[e];else if(4===t)for(let e=0;e<n.length;e+=4)a[e]=n[e+3],a[e+1]=n[e+2],a[e+2]=n[e+1],a[e+3]=n[e];else for(let e=0;e<n.length;e+=8)a[e]=n[e+7],a[e+1]=n[e+6],a[e+2]=n[e+5],a[e+3]=n[e+4],a[e+4]=n[e+3],a[e+5]=n[e+2],a[e+6]=n[e+1],a[e+7]=n[e];return a.buffer}async function P(e,t,n,a,s){const l=o.isPlatformLittleEndian===t,f=p(n,"BITSPERSAMPLE"),u=p(n,"SAMPLESPERPIXEL")??1,c=p(n,"PHOTOMETRICINTERPRETATION"),h=p(n,"SAMPLEFORMAT")??1,T=g(h,f),I=p(n,"COMPRESSION")??1,d=E(T);let w,y,P;if(34887===I)return await i.load(),((e,t)=>i.decode(e,{inputOffset:t}).pixels[0])(e,a);if(1===I)w=e.slice(a,a+s),y=new Uint8Array(w);else if(8===I||32946===I)y=new Uint8Array(e,a,s),y=m(y),w=y.buffer;else if(6===I)y=new Uint8Array(e,a,s),y=A(y,u,c),w=y.buffer;else if(7===I){const t=n.get("JPEGTABLES").values,i=t.length-2;y=new Uint8Array(i+s-2);for(let e=0;e<i;e++)y[e]=t[e];const r=new Uint8Array(e,a+2,s-2);for(let e=0;e<r.length;e++)y[i+e]=r[e];y=A(y,u,c),w=y.buffer}else{if(5!==I)throw new Error("tiff-decode: unsupport compression "+I);y=r.decode(e,a,s,t),w=y.buffer}if(w=S(w,f),l||f<=8)P=new d(w);else{const e=f>32?8:f>16?4:2;P=new d(M(y.buffer,e))}const b=p(n,"PREDICTOR")??1,O=p(n,"TILEWIDTH"),L=p(n,"TILELENGTH");if(b>1&&(5===I||8===I||32946===I)&&O&&L){const e=D(n),t=new d(P.length);t.set(P),P=function(e,t,n,a,i){const r=a?4:1,s=n*r*i;a&&(e=new Uint8Array(e.buffer));for(let n=0;n<t;n++){const t=n*s;for(let n=i;n<s;n++)e[t+n]+=e[t+n-i]}if(!a)return e;const l=new Uint8Array(e.length),o=n*i;for(let n=0;n<t;n++){const t=n*s;for(let n=0;n<o;n++)for(let a=0;a<r;a++)l[t+n*r+a]=e[t+n+(r-a-1)*o]}return new Float32Array(l.buffer)}(t,L,O,3===h&&3===b,e?1:u)}return P}function b(e,t,n,a=0,i=!1,r=4){if(n.values)return!0;const s=n.type,l=n.valueCount;let o=n.valueOffset,f=[];const h=u[s],g=8*h,E=l*h,T=l*u[s]*8;let I,d;const w=8===r?64:32,p=n.valueOffsets;if(T>w&&E>(i?e.byteLength:e?e.byteLength-o+a:0))return n.offlineOffsetSize=[o,E],n.values=null,!1;if(T<=w){if(!t)if(w<=32)o>>>=32-T;else{const e=p?.length?p[0]:o>>>0,t=p?.length?p[1]:Math.round((o-e)/c);T<=32?(o=e>>>32-T,p[0]=o):(o=e*2**(32-T)+(t>>>32-T),p[0]=e,p[1]=t>>>32-T)}if(1===l&&g===w)f=[o];else if(64===w){const e=p?.length?p[0]:o>>>0,t=p?.length?p[1]:Math.round((o-e)/c);let n=e,a=32;for(d=1;d<=l;d++){const e=32-g*d%32;if(a<g){const i=n<<e>>>32-a,r=t<<32-a>>>32-a;n=t,f.push(i+r*2**(g-a)),a-=32-(g-a)}else f.push(n<<e>>>32-g),a-=g;0===a&&(a=32,n=t)}}else for(d=1;d<=l;d++){const e=32-g*d;f.push(o<<e>>>32-g)}}else{o-=a,i&&(o=0);for(let n=o;n<o+E;n+=h){switch(s){case 1:case 2:case 7:I=new DataView(e,n,1).getUint8(0);break;case 3:I=new DataView(e,n,2).getUint16(0,t);break;case 4:case 13:I=new DataView(e,n,4).getUint32(0,t);break;case 5:I=new DataView(e,n,4).getUint32(0,t)/new DataView(e,n+4,4).getUint32(0,t);break;case 6:I=new DataView(e,n,1).getInt8(0);break;case 8:I=new DataView(e,n,2).getInt16(0,t);break;case 9:I=new DataView(e,n,4).getInt32(0,t);break;case 10:I=new DataView(e,n,4).getInt32(0,t)/new DataView(e,n+4,4).getInt32(0,t);break;case 11:I=new DataView(e,n,4).getFloat32(0,t);break;case 12:I=new DataView(e,n,8).getFloat64(0,t);break;case 16:case 18:I=N(new DataView(e,n,8),0,t);break;case 17:I=U(new DataView(e,n,8),0,t);break;default:I=null}f.push(I)}}if(2===s){let e="";const t=f;for(f=[],d=0;d<t.length;d++)0===t[d]&&""!==e?(f.push(e),e=""):e+=String.fromCharCode(t[d]);""===e&&0!==f.length||f.push(e)}return n.values=f,!0}function O(e){const t=e[0],n=p(t,"TILEWIDTH"),a=p(t,"TILELENGTH"),i=p(t,"IMAGEWIDTH"),r=p(t,"IMAGELENGTH"),s=p(t,"BITSPERSAMPLE"),l=p(t,"SAMPLESPERPIXEL"),o=p(t,"SAMPLEFORMAT")??1,f=g(o,s),u=D(t),c=I(t,"GDAL_NODATA");let E=null;c?.length&&(E=c.map(e=>parseFloat(e)),E.some(e=>isNaN(e))&&(E=null));const y=p(t,"COMPRESSION")??1;let S;switch(y){case 1:S="NONE";break;case 2:case 3:case 4:case 32771:S="CCITT";break;case 5:S="LZW";break;case 6:case 7:S="JPEG";break;case 32773:S="PACKBITS";break;case 8:case 32946:S="DEFLATE";break;case 34712:S="JPEG2000";break;case 34887:S="LERC";break;default:S=String(y)}let A=!0,m="";h.has(y)||(A=!1,m+="unsupported tag compression "+y),o>3&&(A=!1,m+="unsupported tag sampleFormat "+o),s>32&&64!==s&&(A=!1,m+="unsupported tag bitsPerSample "+s);const M=w(t,"GEOASCIIPARAMS");let P;if(M){const e=M.split("|").find(e=>e.includes("ESRI PE String = ")),t=e?e.replace("ESRI PE String = ",""):"";P=t.startsWith("COMPD_CS")||t.startsWith("PROJCS")||t.startsWith("GEOGCS")?{wkid:null,wkt:t}:null}const b=d(t,"GEOTIEPOINTS"),O=d(t,"GEOPIXELSCALE"),R=d(t,"GEOTRANSMATRIX"),N=t.has("GEOKEYDIRECTORY")?t.get("GEOKEYDIRECTORY").data:null;let U,k,C=!1,v=!1;if(N){C=2===p(N,"GTRasterTypeGeoKey");const e=p(N,"GTModelTypeGeoKey");if(2===e){const e=p(N,"GeographicTypeGeoKey");e>=1024&&e<=32766&&(P={wkid:e}),P||32767!==e||(v=!0,P={wkid:4326})}else if(1===e){const e=p(N,"ProjectedCSTypeGeoKey");e>=1024&&e<=32766&&(P={wkid:e})}}if(O&&b&&b.length>=6?(U=[O[0],0,b[3]-b[0]*O[0],0,-Math.abs(O[1]),b[4]-b[1]*O[1]],C&&(U[2]-=.5*U[0]+.5*U[1],U[5]-=.5*U[3]+.5*U[4])):R&&16===R.length&&(U=C?[R[0],R[1],R[3]-.5*R[0],R[4],R[5],R[7]-.5*R[5]]:[R[0],R[1],R[3],R[4],R[5],R[7]]),U){const e=[{x:0,y:r},{x:0,y:0},{x:i,y:r},{x:i,y:0}];let t,n=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,l=Number.NEGATIVE_INFINITY;for(let i=0;i<e.length;i++)t=T(e[i],U),n=t.x>n?n:t.x,s=t.x<s?s:t.x,a=t.y>a?a:t.y,l=t.y<l?l:t.y;k={xmin:n,xmax:s,ymin:a,ymax:l,spatialReference:P}}else k={xmin:-.5,ymin:.5-r,xmax:i-.5,ymax:.5,spatialReference:P};v&&(k.xmax-k.xmin>400||Math.max(Math.abs(k.xmin),Math.abs(k.xmax))>361)&&(P=null,k.spatialReference=null);const G=L(e);let B,V,H,W,Y;if(G.length>0){H=Math.round(Math.log(i/p(G[0],"IMAGEWIDTH"))/Math.LN2);const e=G[G.length-1];W=G.length,B=p(e,"TILEWIDTH"),V=p(e,"TILELENGTH")}B=null!=W&&W>0?B||n:null,V=null!=W&&W>0?V||a:null,n&&(Y=[{maxCol:Math.ceil(i/n)-1,maxRow:Math.ceil(r/a)-1,minRow:0,minCol:0}],G.forEach(e=>{Y.push({maxCol:Math.ceil(p(e,"IMAGEWIDTH")/p(e,"TILEWIDTH"))-1,maxRow:Math.ceil(p(e,"IMAGELENGTH")/p(e,"TILELENGTH"))-1,minRow:0,minCol:0})}));const _=(e=>{if(!e)return null;const t=e.match(/<Item(.*?)Item>/gi);if(!t||0===t.length)return null;const n=new Map;let a,i,r,s,l;for(let e=0;e<t.length;e++)a=t[e],i=a.slice(6,a.indexOf(">")),s=a.indexOf("sample="),s>-1&&(l=a.slice(s+8,a.indexOf('"',s+8))),s=a.indexOf("name="),s>-1&&(i=a.slice(s+6,a.indexOf('"',s+6))),i&&(r=a.slice(a.indexOf(">")+1,a.indexOf("</Item>")).trim(),null!=l?n.has(i)?n.get(i)[l]=r:n.set(i,[r]):n.set(i,r)),l=null;const o=n.get("STATISTICS_MINIMUM"),f=n.get("STATISTICS_MAXIMUM"),u=n.get("STATISTICS_MEAN"),c=n.get("STATISTICS_STDDEV");let h=null;if(o&&f){h=[];for(let e=0;e<o.length;e++)h.push({min:parseFloat(o[e]),max:parseFloat(f[e]),avg:u&&parseFloat(u[e]),stddev:c&&parseFloat(c[e])})}const g=n.get("BandName"),E=n.get("WavelengthMin"),T=n.get("WavelengthMax");let I=null;if(g){I=[];for(let e=0;e<g.length;e++)I.push({BandName:g[e],WavelengthMin:E&&parseFloat(E[e]),WavelengthMax:T&&parseFloat(T[e])})}return{statistics:h,bandProperties:I,dataType:n.get("DataType"),rawMetadata:n}})(w(e[0],"GDAL_METADATA"));m+=" "+F({width:i,height:r,tileWidth:n,tileHeight:a,planes:l,ifds:e});const K=x(e).length===G.length+1,X=G?.length?G.map(e=>({x:i/p(e,"IMAGEWIDTH"),y:r/p(e,"IMAGELENGTH")})):void 0;return{width:i,height:r,tileWidth:n,tileHeight:a,planes:l,isBSQ:u,pixelType:f,compression:S,noData:E,hasMaskBand:K,isSupported:A,pyramidResolutions:X,message:m,extent:k,isPseudoGeographic:v,affine:O?null:U,firstPyramidLevel:H,maximumPyramidLevel:W,pyramidBlockWidth:B,pyramidBlockHeight:V,tileBoundary:Y,metadata:_}}function D(e,t){const n=I(e,"PLANARCONFIGURATION");return n?2===n[0]:!!t&&t.isBSQ}function L(e){return e.filter(e=>1===p(e,"NEWSUBFILETYPE"))}function x(e){return e.filter(e=>{const t=!(4&~(p(e,"NEWSUBFILETYPE")??0)),n=4===p(e,"PHOTOMETRICINTERPRETATION");return t&&n})}function R(e){const{littleEndian:t,isBigTiff:n,firstIFDPos:a}=C(e);let i=a;const r=[];do{const a=v(e,t,i,0,l.tiffTags,n?8:4);if(!a.success)break;r.push(a.ifd),i=a.nextIFD}while(i>0);return{...O(r),littleEndian:t,isBigTiff:n,ifds:r,pyramidIFDs:L(r),maskIFDs:x(r)}}function N(e,t,n){const a=e.getUint32(t,n),i=e.getUint32(t+4,n);return n?i*c+a:a*c+i}function U(e,t,n){let a=n?e.getInt32(t,n):e.getUint32(t,n),i=n?e.getUint32(t+4,n):e.getInt32(t+4,n);const r=(n?a:i)>=0?1:-1;return n?a*=r:i*=r,r*(n?i*c+a:a*c+i)}function k(e,t,n,a){return a?N(e,t,n):e.getUint32(t,n)}function C(e){const t=new DataView(e,0,16),n=t.getUint16(0,!1);let a=null;if(18761===n)a=!0;else{if(19789!==n)throw new Error("unexpected endianess byte");a=!1}const i=t.getUint16(2,a);if(42!==i&&43!==i)throw new Error("unexpected tiff identifier");let r=4;const s=43===i;if(s){const e=t.getUint16(r,a);if(r+=2,8!==e)throw new Error("unsupported bigtiff version");if(0!==t.getUint16(r,a))throw new Error("unsupported bigtiff version");r+=2}return{littleEndian:a,isBigTiff:s,firstIFDPos:k(t,r,a,s)}}function v(e,t,a,i=0,r=l.tiffTags,s=4){const o=y(e,t,a,i,r,s);let f;const u=o.ifd;if(u){if(l.ifdTags.forEach((n,a)=>{u.has(a)&&(f=u.get(a),f.data=y(e,t,f.valueOffset-i,i,n).ifd)}),u.has("GEOKEYDIRECTORY")){f=u.get("GEOKEYDIRECTORY");const n=f.values;if(n&&n.length>4){const a=n[0]+"."+n[1]+"."+n[2];f.data=y(e,t,f.valueOffset+6-i,i,l.geoKeys,2).ifd,f.data&&f.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[a]})}}if(u.has("XMP")){f=u.get("XMP");const e=f.values;"number"==typeof e[0]&&7===f.type&&(f.values=[n.bytesToUTF8(new Uint8Array(e))])}}return o}function F(e){const{width:t,height:n,tileHeight:a,tileWidth:i}=e,r=e.planes,s=i?i*a:t*n,l=p(e.ifds[0],"BITSPERSAMPLE");let o="";return s*r>2**30/(l>8?l/8:1)&&(o=i?"tiled tiff exceeding 1 gigabits per tile is not supported":"scanline tiff exceeding 1 gigabits is not supported"),o}e.decode=async function(e,t={}){const n=t.pyramidLevel||0,a=t.headerInfo||R(e),{ifds:i,noData:l}=a;if(0===i.length)throw new Error("no valid image file directory");const f=F(a);if(f)throw f;let u=null;const c=-1===n?i[i.length-1]:i[n],h=l??t.noDataValue;if(u=a.tileWidth?await async function(e,t,n){const a=d(n,"TILEOFFSETS");if(void 0===a)return null;const i=d(n,"TILEBYTECOUNTS"),{width:r,height:s,pixelType:l,tileWidth:o,tileHeight:f}=O([n]),u=D(n,t),c=p(n,"SAMPLESPERPIXEL")||t.planes,h=r*s,g=p(n,"BITSPERSAMPLE"),T=34887===(p(n,"COMPRESSION")??1),I=E(l),w=[];for(let e=0;e<c;e++)w.push(new I(h));let y,S,A,m,M,b,L,x,R,N,U,k,C;const v=Math.ceil(r/o),F=new Uint8Array(h).fill(255);let G=!1;if(g%8==0)if(T&&u&&c>1){const l=Math.round(a.length/c);for(y=0;y<l;y++){b=Math.floor(y/v)*f,L=y%v*o,x=b*r+L;for(let l=0;l<c;l++){const u=y*c+l;for(0===i[u]?(A=null,G=!0):A=await P(e,t.littleEndian,n,a[u],i[u]),N=0,R=x,k=Math.min(o,r-L),U=Math.min(f,s-b),C=w[l],m=0;m<U;m++)for(R=x+m*r,N=m*o,M=0;M<k;M++,R++,N++)A?C[R]=A[N]:F[R]=0}}}else for(y=0;y<a.length;y++)for(b=Math.floor(y/v)*f,L=y%v*o,x=b*r+L,0===i[y]?(A=null,G=!0):A=await P(e,t.littleEndian,n,a[y],i[y]),N=0,R=x,k=Math.min(o,r-L),U=Math.min(f,s-b),S=0;S<c;S++)if(C=w[S],u||T)for(m=0;m<U;m++)for(R=x+m*r,N=o*f*S+m*o,M=0;M<k;M++,R++,N++)A?C[R]=A[N]:F[R]=0;else for(m=0;m<U;m++)for(R=x+m*r,N=m*o*c+S,M=0;M<k;M++,R++,N+=c)A?C[R]=A[N]:F[R]=0;return{width:r,height:s,pixelType:l,pixels:w,mask:G?F:void 0}}(e,a,c):((e,t,n)=>{const a=o.isPlatformLittleEndian===t.littleEndian,i=d(n,"STRIPOFFSETS");if(void 0===i)return null;const{width:s,height:l,pixelType:f}=O([n]),u=p(n,"SAMPLESPERPIXEL")||t.planes,c=p(n,"PHOTOMETRICINTERPRETATION"),h=s*l,g=p(n,"BITSPERSAMPLE"),T=E(f),I=new T(h*u),w=d(n,"STRIPBYTECOUNTS"),y=p(n,"ROWSPERSTRIP"),M=p(n,"COMPRESSION")??1;let P,b,D,L,x,R,N,U,k;if(g%8==0)for(P=0;P<i.length;P++){if(x=P*(y*s)*u,"u8"===f||"s8"===f||a)8===M||32946===M?(N=new Uint8Array(e,i[P],w[P]),N=m(N),R=N.buffer):6===M?(N=new Uint8Array(e,i[P],w[P]),N=A(N,u,c),R=N.buffer):5===M?(N=r.decode(e,i[P],w[P],t.littleEndian),R=N.buffer):R=e.slice(i[P],i[P]+w[P]),R=S(R,g),L=new T(R);else{switch(6===M||8===M||32946===M?(N=new Uint8Array(e,i[P],w[P]),U=m(N),R=U.buffer):(R=new ArrayBuffer(w[P]),N=new Uint8Array(e,i[P],w[P]),U=new Uint8Array(R)),f){case"u16":case"s16":for(D=0;D<N.length;D+=2)U[D]=N[D+1],U[D+1]=N[D];break;case"u32":case"s32":case"f32":for(D=0;D<N.length;D+=4)U[D]=N[D+3],U[D+1]=N[D+2],U[D+2]=N[D+1],U[D+3]=N[D]}R=S(R,g),L=new T(R)}I.set(L,x)}const C=[];if(1===u)C.push(I);else for(P=0;P<u;P++){for(k=new T(h),b=0;b<h;b++)k[b]=I[b*u+P];C.push(k)}return{width:s,height:l,pixelType:f,pixels:C}})(e,a,c),!u)return u;if(null!=h){const e=null==l&&t?.matchAllNoData;s.convertNoDataToMask(u,h,{matchAllNoData:e})}return u},e.decodeTileOrStrip=async function(e,t){const{headerInfo:n,ifd:a,offsets:i,sizes:r}=t,l=[];for(let t=0;t<i.length;t++){r[t];const s=await P(e,n.littleEndian,a,i[t],r[t]||e.byteLength);l.push(s)}const o=D(a,n),f=p(a,"BITSPERSAMPLE"),u=g(p(a,"SAMPLEFORMAT")??1,f),c=p(a,"SAMPLESPERPIXEL")||n.planes,h=E(u),T=p(a,"TILEWIDTH"),I=p(a,"TILELENGTH"),d=p(a,"COMPRESSION")??1,w=T*I;let y;const S=[];let A=l[0];const m=34887===d;for(let e=0;e<c;e++){if(y=new h(w),l.length===c)A=l[e],A.length===w&&(y=A);else if(A.length)if(o||m)y=A.length===w?A:A.slice(w*e,w*(e+1));else for(let t=0;t<w;t++)y[t]=A[t*c+e];S.push(y)}const M=n.noData?n.noData[0]:t.noDataValue,b=n.metadata?n.metadata.statistics:null,O=b?b.map(e=>e.min):null,L=b?b.map(e=>e.max):null,x={pixelType:u,width:T,height:I,pixels:S,noDataValue:M};return null!=M?s.convertNoDataToMask(x,M,{matchAllNoData:t?.matchAllNoData}):O&&L&&t.applyMinMaxConstraint&&(x.mask=((e,t,n)=>{if(!(e&&e.length>0&&t&&n))return null;let a,i,r;const s=e[0].length,l=e.length,o=new Uint8Array(s);for(let f=0;f<l;f++)if(a=e[f],i=t[f],r=n[f],0===f)for(let e=0;e<s;e++)o[e]=a[e]<i||a[e]>r?0:1;else for(let e=0;e<s;e++)o[e]&&(o[e]=a[e]<i||a[e]>r?0:1);return o})(S,O,L)),x},e.getImageInfo=O,e.getMaskIFDs=x,e.getPyramidIFDs=L,e.isBSQConfig=D,e.parseFieldValues=b,e.parseHeader=R,e.parseIFD=v,e.parseSignature=C,e.unpackBits=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});