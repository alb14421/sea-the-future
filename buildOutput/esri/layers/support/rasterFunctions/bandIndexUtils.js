// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/jsonMap","../PixelBlock","../rasterFormats/pixelRangeUtils","./customBandIndexUtils","./pixelUtils"],function(n,e,t,r,a,i){"use strict";const l=new e.JSONMap({0:"custom",1:"ndvi",2:"savi",3:"tsavi",4:"msavi",5:"gemi",6:"pvi",7:"gvitm",8:"sultan",9:"vari",10:"gndvi",11:"sr",12:"ndvi-re",13:"sr-re",14:"mtvi2",15:"rtvi-core",16:"ci-re",17:"ci-g",18:"ndwi",19:"evi",20:"iron-oxide",21:"ferrous-minerals",22:"clay-minerals",23:"wndwi",24:"bai",25:"nbr",26:"ndbi",27:"ndmi",28:"ndsi",29:"mndwi"},{useNumericKeys:!0});function o(n,e,t){const r=t.length,a=new Float32Array(r);for(let i=0;i<r;i++)if(null==n||n[i]){const n=e[i],r=t[i],l=n+r;l&&(a[i]=(n-r)/l)}return[a]}n.bandIndexMethodMap=l,n.calculateBandIndex=function(n,e){if(!i.isValidPixelBlock(n))return n;const{equation:l,method:s}=e,c=e.bandIndexes.map(n=>n-1),{pixels:u,mask:f}=n;let d;switch(s){case"gndvi":case"nbr":case"ndbi":case"ndvi":case"ndvi-re":case"ndsi":case"ndmi":case"mndwi":d=o(f,u[c[0]],u[c[1]]);break;case"ndwi":d=o(f,u[c[1]],u[c[0]]);break;case"sr":case"sr-re":case"iron-oxide":case"ferrous-minerals":case"clay-minerals":d=function(n,e,t){const r=t.length,a=new Float32Array(r);for(let i=0;i<r;i++)if(null==n||n[i]){const n=e[i],r=t[i];r&&(a[i]=n/r)}return[a]}(f,u[c[0]],u[c[1]]);break;case"ci-g":case"ci-re":d=function(n,e,t){const r=e.length,a=new Float32Array(r);for(let i=0;i<r;i++)if(null==n||n[i]){const n=e[i],r=t[i];r&&(a[i]=n/r-1)}return[a]}(f,u[c[0]],u[c[1]]);break;case"savi":d=function(n,e,t,r){const a=t.length,i=new Float32Array(a);for(let l=0;l<a;l++)if(null==n||n[l]){const n=t[l],a=e[l],o=a+n+r;o&&(i[l]=(a-n)/o*(1+r))}return[i]}(f,u[c[0]],u[c[1]],c[2]+1);break;case"tsavi":d=function(n,e,t,r,a,i){const l=t.length,o=new Float32Array(l),s=-a*r+i*(1+r*r);for(let i=0;i<l;i++)if(null==n||n[i]){const n=t[i],l=e[i],c=a*l+n+s;c&&(o[i]=r*(l-r*n-a)/c)}return[o]}(f,u[c[0]],u[c[1]],c[2]+1,c[3]+1,c[4]+1);break;case"msavi":d=function(n,e,t){const r=t.length,a=new Float32Array(r);for(let i=0;i<r;i++)if(null==n||n[i]){const n=t[i],r=e[i],l=2*r+1;a[i]=.5*(l-Math.sqrt(l*l-8*(r-n)))}return[a]}(f,u[c[0]],u[c[1]]);break;case"gemi":d=function(n,e,t){const r=t.length,a=new Float32Array(r);for(let i=0;i<r;i++)if(null==n||n[i]){const n=t[i],r=e[i];if(1!==n&&r+n+.5!==0){const e=(2*(r*r-n*n)+1.5*r+.5*n)/(r+n+.5);a[i]=e*(1-.25*e)-(n-.125)/(1-n)}}return[a]}(f,u[c[0]],u[c[1]]);break;case"pvi":d=function(n,e,t,r,a){const i=t.length,l=new Float32Array(i),o=1/Math.sqrt(1+r*r);for(let s=0;s<i;s++)if(null==n||n[s]){const n=t[s],i=e[s];l[s]=(i-r*n-a)*o}return[l]}(f,u[c[0]],u[c[1]],c[2]+1,c[3]+1);break;case"gvitm":d=function(n,e){const[t,r,a,i,l,o]=e,s=t.length,c=new Float32Array(s);for(let e=0;e<s;e++)(null==n||n[e])&&(c[e]=-.2848*t[e]-.2435*r[e]-.5436*a[e]+.7243*i[e]+.084*l[e]-.18*o[e]);return[c]}(f,[u[c[0]],u[c[1]],u[c[2]],u[c[3]],u[c[4]],u[c[5]]]);break;case"sultan":d=function(n,e){const[t,r,a,i,l]=e,o=t.length,s=new Float32Array(o),c=new Float32Array(o),u=new Float32Array(o);for(let e=0;e<o;e++)(null==n||n[e])&&(s[e]=l[e]?i[e]/l[e]*100:0,c[e]=t[e]?i[e]/t[e]*100:0,u[e]=a[e]?r[e]/a[e]*(i[e]/a[e])*100:0);return[s,c,u]}(f,[u[c[0]],u[c[1]],u[c[2]],u[c[3]],u[c[4]]]);break;case"vari":d=function(n,e){const[t,r,a]=e,i=t.length,l=new Float32Array(i);for(let e=0;e<i;e++)if(null==n||n[e])for(e=0;e<i;e++){const n=t[e],i=r[e],o=i+n-a[e];o&&(l[e]=(i-n)/o)}return[l]}(f,[u[c[0]],u[c[1]],u[c[2]]]);break;case"mtvi2":d=function(n,e){const[t,r,a]=e,i=t.length,l=new Float32Array(i);for(let e=0;e<i;e++)if(null==n||n[e])for(e=0;e<i;e++){const n=t[e],i=r[e],o=a[e],s=Math.sqrt((2*n+1)**2-(6*n-5*Math.sqrt(i))-.5);if(s){const t=1.5*(1.2*(n-o)-2.5*(i-o));l[e]=t/s}}return[l]}(f,[u[c[0]],u[c[1]],u[c[2]]]);break;case"rtvi-core":d=function(n,e){const[t,r,a]=e,i=t.length,l=new Float32Array(i);for(let e=0;e<i;e++)if(null==n||n[e])for(e=0;e<i;e++){const n=t[e],i=r[e],o=a[e];l[e]=100*(n-i)-10*(n-o)}return[l]}(f,[u[c[0]],u[c[1]],u[c[2]]]);break;case"evi":d=function(n,e){const[t,r,a]=e,i=t.length,l=new Float32Array(i);for(let e=0;e<i;e++)if(null==n||n[e])for(e=0;e<i;e++){const n=t[e],i=r[e],o=n+6*i-7.5*a[e]+1;o&&(l[e]=2.5*(n-i)/o)}return[l]}(f,[u[c[0]],u[c[1]],u[c[2]]]);break;case"wndwi":d=function(n,e,t=.5){const[r,a,i]=e,l=a.length,o=new Float32Array(l);for(let e=0;e<l;e++)if(null==n||n[e])for(e=0;e<l;e++){const n=r[e],l=a[e],s=i[e],c=n+t*l+(1-t)*s;c&&(o[e]=(n-t*l-(1-t)*s)/c)}return[o]}(f,[u[c[0]],u[c[1]],u[c[2]]],c[3]?c[3]+1:.5);break;case"bai":d=function(n,e,t){const r=t.length,a=new Float32Array(r);for(let i=0;i<r;i++)if(null==n||n[i])for(i=0;i<r;i++){const n=(.1-e[i])**2+(.06-t[i])**2;n&&(a[i]=1/n)}return[a]}(f,u[c[0]],u[c[1]]);break;case"custom":d=a.calculateCustomBandIndex(f,u,l);break;default:return n}const{outputPixelType:h="f32"}=e,w=null!=h&&r.isIntegerPixelType(h);let g;f?(g=new Uint8Array(n.width*n.height),g.set(f)):w&&(g=new Uint8Array(n.width*n.height).fill(255)),w&&(d=d.map(n=>{const e=t.createEmptyBand(h,n.length);return r.clipBandToPixelTypeRange(n,g,h,e),e}));const y=new t({width:n.width,height:n.height,pixelType:h,pixels:d,mask:g});return y.updateStatistics(),y},n.calculateNDVI=function(n,e,r,a){const{mask:i,pixels:l,width:o,height:s}=n,c=l[r],u=l[e],f=u.length,d=a?new Uint8Array(f):new Float32Array(f),h=a?100:1,w=a?100.5:0;for(let n=0;n<f;n++)if(null==i||i[n]){const e=c[n],t=u[n],r=e+t;r&&(d[n]=(e-t)/r*h+w)}const g=new t({width:o,height:s,mask:i,pixelType:a?"u8":"f32",pixels:[d]});return g.updateStatistics(),g},n.getBandMatrix3=function(n){const e=new Float32Array(9);return e[3*n[0]]=1,e[3*n[1]+1]=1,e[3*n[2]+2]=1,e},Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});