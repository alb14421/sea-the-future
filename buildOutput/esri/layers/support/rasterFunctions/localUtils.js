// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../PixelBlock","../rasterFunctionConstants","../rasterFormats/pixelRangeUtils"],function(t,e,n,o){"use strict";const r=new Map([[n.localTrigonometricOperation.acos,{domain:[0,Math.PI],isInteger:!1}],[n.localTrigonometricOperation.asin,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[n.localTrigonometricOperation.atan,{domain:[-Math.PI/2,Math.PI/2],isInteger:!1}],[n.localTrigonometricOperation.cos,{domain:[-1,1],isInteger:!1}],[n.localTrigonometricOperation.sin,{domain:[-1,1],isInteger:!1}],[n.localLogicalOperation.booleanAnd,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.booleanNot,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.booleanOr,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.booleanXOr,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.equalTo,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.notEqual,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.greaterThan,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.greaterThanEqual,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.lessThan,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.lessThanEqual,{domain:[0,1],isInteger:!0}],[n.localLogicalOperation.isNull,{domain:[0,1],isInteger:!0}]]);function a(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]+a[t]);return c}function l(t,n,o){const[r]=t,a=r.length,l=e.createEmptyBand("f32",a);return l.set(r),l}function c(t,n,o){const[r]=t,a=r.length,l=e.createEmptyBand(o,a);for(let t=0;t<a;t++)n&&!n[t]||(l[t]=r[t]*r[t]);return l}function s(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]-a[t]);return c}function i(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]*a[t]);return c}function f(t,n,o){const[r]=t,a=r.length,l=e.createEmptyBand(o,a);for(let t=0;t<a;t++)n&&!n[t]||(l[t]=Math.sign(r[t])*Math.floor(Math.abs(r[t])));return l}function u(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]/a[t]);return c}function h(t,e,n){return u(t,e,"f32")}function g(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=Math.floor(r[t]/a[t]));return c}function p(t,o,r,a){const l=t[0],c=l.length,s=e.createEmptyBand(r,c);if(a===n.localTrigonometricOperation.atanh){for(let t=0;t<c;t++)if(o[t]){const e=l[t];Math.abs(e)>=1?o[t]=0:s[t]=Math.atanh(e)}return s}const i=a===n.localTrigonometricOperation.asin?Math.asin:Math.acos;for(let t=0;t<c;t++)if(o[t]){const e=l[t];Math.abs(e)>1?o[t]=0:s[t]=i(e)}return s}function m(t,n,o,r){const[a]=t,l=a.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r(a[t]));return c}function d(t,n,o,r){const[a,l]=t,c=a.length,s=e.createEmptyBand(o,c);for(let t=0;t<c;t++)n&&!n[t]||(s[t]=r(a[t],l[t]));return s}function y(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]&a[t]);return c}function E(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]<<a[t]);return c}function M(t,n,o){const[r]=t,a=r.length,l=e.createEmptyBand(o,a);for(let t=0;t<a;t++)n&&!n[t]||(l[t]=~r[t]);return l}function B(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]|a[t]);return c}function O(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]>>a[t]);return c}function I(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]^a[t]);return c}function T(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]&&a[t]?1:0);return c}function w(t,n,o){const[r]=t,a=r.length,l=e.createEmptyBand(o,a);for(let t=0;t<a;t++)n&&!n[t]||(l[t]=r[t]?0:1);return l}function x(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]||a[t]?1:0);return c}function b(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=(r[t]?1:0)^(a[t]?1:0));return c}function L(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]===a[t]?1:0);return c}function P(t,n,o,r){const[a]=t,l=a.length,c=e.createEmptyBand(o,l),s=r===Math.E;for(let t=0;t<l;t++)n&&!n[t]||(c[t]=s?Math.exp(a[t]):r**a[t]);return c}function A(t,e,n){return P(t,e,n,10)}function k(t,e,n){return P(t,e,n,2)}function N(t,e,n){return P(t,e,n,Math.E)}function q(t,n,o,r){const[a]=t,l=a.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(a[t]<=0?n[t]=0:c[t]=r(a[t]));return c}function U(t,e,n){return q(t,e,n,Math.log10)}function F(t,e,n){return q(t,e,n,Math.log2)}function C(t,e,n){return q(t,e,n,Math.log)}function S(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]>a[t]?1:0);return c}function z(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]>=a[t]?1:0);return c}function R(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]<a[t]?1:0);return c}function j(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]<=a[t]?1:0);return c}function v(t,n,o){const[r]=t,a=r.length,l=e.createEmptyBand(o,a);if(!n)return l;for(let t=0;t<a;t++)l[t]=n[t]?0:1;return l}function D(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]%a[t]);return c}function X(t,n,o){const[r]=t,a=r.length,l=e.createEmptyBand(o,a);for(let t=0;t<a;t++)n&&!n[t]||(l[t]=-r[t]);return l}function G(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]===a[t]?0:1);return c}function H(t,n,o){const[r,a]=t,l=r.length,c=e.createEmptyBand(o,l),s=new Uint8Array(l);for(let t=0;t<l;t++)null!=n&&!n[t]||0!==r[t]||(c[t]=a[t],s[t]=255);return{band:c,mask:s}}function J(t,n,o){const[r,a,l]=t,c=r.length,s=e.createEmptyBand(o,c);for(let t=0;t<c;t++)n&&!n[t]||(s[t]=r[t]?a[t]:l[t]);return s}function K(t,n,o){const r=t.length;if(r<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(o,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=a[e];for(let o=1;o<r;o++){const r=t[o][e];n<r&&(n=r)}c[e]=n}return c}function Q(t,n,o){const r=t.length;if(r<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(o,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=a[e];for(let o=1;o<r;o++){const r=t[o][e];n>r&&(n=r)}c[e]=n}return c}function V(t,n,o){const r=t.length;if(r<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(o,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=a[e],o=n;for(let a=1;a<r;a++){const r=t[a][e];o<r?o=r:n>r&&(n=r)}c[e]=o-n}return c}function W(t,n,o){const r=t.length;if(r<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(o,l);for(let e=0;e<l;e++)if(!n||n[e]){let n=0;for(let o=0;o<r;o++)n+=t[o][e];c[e]=n/r}return c}function Y(t,n,o){const r=t.length;if(r<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(o,l);for(let e=0;e<l;e++)if(!n||n[e])for(let n=0;n<r;n++){const o=t[n];c[e]+=o[e]}return c}function Z(t,n,o){const r=t.length;if(r<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(o,l);for(let e=0;e<l;e++)if(!n||n[e]){const n=new Float32Array(r);let o=0;for(let a=0;a<r;a++){const r=t[a];o+=r[e],n[a]=r[e]}o/=r;let a=0;for(let t=0;t<r;t++)a+=(n[t]-o)**2;c[e]=Math.sqrt(a/r)}return c}function $(t,n,o){const r=t.length;if(r<2)return t[0];const a=Math.floor(r/2),[l]=t,c=l.length,s=e.createEmptyBand(o,c),i=new Float32Array(r),f=r%2==1;for(let e=0;e<c;e++)if(!n||n[e]){for(let n=0;n<r;n++)i[n]=t[n][e];i.sort(),s[e]=f?i[a]:(i[a]+i[a-1])/2}return s}function _(t,n,o){const[r,a]=t;if(null==a)return r;const l=r.length,c=e.createEmptyBand(o,l);for(let t=0;t<l;t++)n&&!n[t]||(c[t]=r[t]<a[t]?r[t]:a[t]);return c}function tt(t,n,o){const r=t.length;if(r<=2)return _(t,n,o);const a=t[0].length,l=e.createEmptyBand(o,a),c=new Map;for(let e=0;e<a;e++)if(!n||n[e]){c.clear();for(let n=0;n<r;n++){const o=t[n][e];c.set(o,c.has(o)?c.get(o)+1:1)}let n=0,o=0;const a=[];for(const t of c.keys())n=c.get(t),n>o?(o=n,a.length=0,a.push(t)):n===o&&a.push(t);a.length>1&&a.sort((t,e)=>t-e),l[e]=a[0]}return l}function et(t,n,o){const r=t.length;if(r<=2)return _(t,n,o);const a=t[0].length,l=e.createEmptyBand(o,a),c=new Map;for(let e=0;e<a;e++)if(!n||n[e]){c.clear();for(let n=0;n<r;n++){const o=t[n][e];c.set(o,c.has(o)?c.get(o)+1:1)}let n=0,o=t.length;const a=[];for(const t of c.keys())n=c.get(t),n<o?(o=n,a.length=0,a.push(t)):n===o&&a.push(t);a.length>1&&a.sort((t,e)=>t-e),l[e]=a[0]}return l}function nt(t,n,o){const r=t.length;if(r<2)return t[0];const[a]=t,l=a.length,c=e.createEmptyBand(o,l),s=new Set;for(let e=0;e<l;e++)if(!n||n[e]){let n;s.clear();for(let o=0;o<r;o++)n=t[o][e],s.add(n);c[e]=s.size}return c}const ot=new Map,rt=new Map,at=new Map,lt=new Map;function ct(t,P,q={}){ot.size||(ot.set(4,Math.sqrt),ot.set(6,Math.acos),ot.set(7,Math.asin),ot.set(8,Math.atan),ot.set(9,Math.atanh),ot.set(10,Math.abs),ot.set(21,Math.cos),ot.set(22,Math.cosh),ot.set(48,Math.floor),ot.set(49,Math.ceil),ot.set(51,Math.sin),ot.set(52,Math.sinh),ot.set(56,Math.tan),ot.set(57,Math.tanh),ot.set(59,Math.acosh),ot.set(60,Math.asinh),ot.set(65,Math.floor),rt.set(5,Math.pow),rt.set(61,Math.atan2),at.set(1,a),at.set(2,s),at.set(3,i),at.set(11,y),at.set(12,E),at.set(13,M),at.set(14,B),at.set(15,O),at.set(16,I),at.set(17,T),at.set(18,w),at.set(19,x),at.set(20,b),at.set(23,u),at.set(24,L),at.set(25,N),at.set(26,A),at.set(27,k),at.set(28,S),at.set(29,z),at.set(30,f),at.set(31,v),at.set(32,l),at.set(33,R),at.set(34,j),at.set(35,C),at.set(36,U),at.set(37,F),at.set(44,D),at.set(45,X),at.set(46,G),at.set(53,c),at.set(64,h),at.set(65,g),at.set(76,J),at.set(78,J),lt.set(38,tt),lt.set(39,K),lt.set(40,W),lt.set(41,$),lt.set(42,Q),lt.set(43,et),lt.set(47,V),lt.set(54,Z),lt.set(55,Y),lt.set(58,nt),lt.set(66,tt),lt.set(67,K),lt.set(68,W),lt.set(69,$),lt.set(70,Q),lt.set(71,et),lt.set(72,V),lt.set(73,Z),lt.set(74,Y),lt.set(75,nt));let _=function(t,e=!1){const n=t.map(t=>t.mask),o=n.filter(t=>null!=t),r=t[0].pixels[0].length;if(0===o.length||e&&o.length!==n.length)return new Uint8Array(r).fill(255);const a=o[0],l=new Uint8Array(a);if(1===o.length)return l;if(!e){for(let t=1;t<o.length;t++){const e=o[t];for(let t=0;t<l.length;t++)l[t]&&(l[t]=e[t]?255:0)}return l}for(let t=1;t<o.length;t++){const e=o[t];for(let t=0;t<l.length;t++)0===l[t]&&(l[t]=e[t]?255:0)}return l}(t,P>=66&&P<=75);const{outputPixelType:ct="f32"}=q,st=!lt.has(P)||q.processAsMultiband,it=st?t[0].pixels.length:1,ft=[];for(let a=0;a<it;a++){const l=lt.has(P)&&!st?t.flatMap(t=>t.pixels):t.map(t=>t.pixels[a]);let c,s=!0;if(P===n.localConditionalOperation.setNull){const t=H(l,_,ct);c=t.band,_=t.mask,s=!1}else at.has(P)?c=at.get(P)(l,_,"f64"):ot.has(P)?c=P===n.localTrigonometricOperation.asin||P===n.localTrigonometricOperation.acos||P===n.localTrigonometricOperation.atanh?p(l,_,"f64",P):m(l,_,"f64",ot.get(P)):rt.has(P)?c=d(l,_,"f64",rt.get(P)):lt.has(P)?c=lt.get(P)(l,_,"f64"):(c=l[0],s=!1);if(s&&P!==n.localLogicalOperation.isNull&&!r.has(P)){const t=e.createEmptyBand(ct,c.length);_||(_=new Uint8Array(c.length).fill(255)),o.fixNaN(c,_),o.clipBandToPixelTypeRange(c,_,ct,t),c=t}ft.push(c)}const ut=t[0];return new e({width:ut.width,height:ut.height,pixelType:ct,mask:P===n.localLogicalOperation.isNull?null:_,pixels:ft})}t.arithmetic=function(t,e,n){return ct(t,e=[null,1,2,3,23,5,44][e]??1,{outputPixelType:n})},t.getOutputDomain=function(t){return r.get(t)},t.local=ct,t.operandsCount=[0,2,2,2,1,2,1,1,1,1,1,2,2,1,2,2,2,2,1,2,2,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,999,999,999,999,999,999,2,1,2,999,1,1,2,1,1,1,999,999,1,1,999,1,1,2,999,999,2,2,999,999,999,999,999,999,999,999,999,999,3,999,3],Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});