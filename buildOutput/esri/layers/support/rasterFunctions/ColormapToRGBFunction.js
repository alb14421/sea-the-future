// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../SimpleBandStatistics","./BaseRasterFunction","./ColormapToRGBFunctionArguments","./pixelUtils","../../../renderers/support/rasterRendererChecks"],function(t,e,o,r,s,n,i,a,p,c,u){"use strict";let l=class extends a{constructor(){super(...arguments),this.functionName="ColormapToRGB",this.functionArguments=null,this.rasterArgumentNames=["raster"]}_bindSourceRasters(){const t=this.sourceRasterInfos[0];if(t.bandCount>1||!t.colormap?.length)return{success:!1,supportsGPU:!1,error:"colormap-to-rgb-function: source data must be single band with a colormap"};const e=t.clone();e.pixelType=this.outputPixelType=this._getOutputPixelType("u8"),this._removeStatsHistColormapVAT(e),e.bandCount=3,e.statistics=[{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20},{min:0,max:255,avg:100,stddev:20}],this.rasterInfo=e;const o=[...t.colormap].sort((t,e)=>t[0]-e[0]),{indexedColormap:r,offset:s}=c.createColormapLUT({colormap:o});return r?(this.lookup={indexedColormap:r,offset:s},{success:!0,supportsGPU:u.isColormapSupportedByWebGL(r)}):{success:!1,supportsGPU:!1,error:"colormap-to-rgb-function: the colormap is not supported"}}_processPixels(t){let e=t.pixelBlocks?.[0];if(!e||!this.lookup)return e;e=e.clone();const o=e.pixels[0],r=e.mask??new Uint8Array(o.length).fill(255),s=new Uint8Array(o.length),n=new Uint8Array(o.length),a=new Uint8Array(o.length),{indexedColormap:p,offset:c}=this.lookup,u=p.length;for(let t=0;t<o.length;t++)if(r[t]){let e=4*(o[t]-c);e<0||e>u-4?r[t]=0:(s[t]=p[e++],n[t]=p[e++],a[t]=p[e++])}return e.pixels=[s,n,a],e.statistics=[new i.SimpleBandStatistics(0,255),new i.SimpleBandStatistics(0,255),new i.SimpleBandStatistics(0,255)],e.pixelType=this.outputPixelType,e}_getWebGLParameters(){return this.lookup}};return t.__decorate([e.property({json:{write:!0,name:"rasterFunction"}})],l.prototype,"functionName",void 0),t.__decorate([e.property({type:p,json:{write:!0,name:"rasterFunctionArguments"}})],l.prototype,"functionArguments",void 0),t.__decorate([e.property()],l.prototype,"rasterArgumentNames",void 0),t.__decorate([e.property({json:{write:!0}})],l.prototype,"lookup",void 0),l=t.__decorate([n.subclass("esri.layers.support.rasterFunctions.ColormapToRGBFunction")],l),l});