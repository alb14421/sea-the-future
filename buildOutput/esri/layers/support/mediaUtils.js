// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/screenUtils","../../core/accessorSupport/PropertyOrigin","../../geometry/Extent","../../geometry/Point","../../geometry/support/spatialReferenceUtils","./ControlPointsGeoreference","./CornersGeoreference","./ExtentAndRotationGeoreference","./GeoreferenceBase"],function(e,n,t,o,r,i,c,a,s,l){"use strict";const p=100;function y(e,n){const o=t.nameToId(n);return function(e){return"media"===e?.type}(e)&&!!e.portalItem&&null!=o&&o>3}function P(e,n,t){return{enabled:!y(t?.layer,t?.origin),ignoreOrigin:!0}}const f={json:{name:"url",type:String,write:{overridePolicy:P}}},u={readOnly:!0,json:{read:!1,write:{target:"mediaType",overridePolicy:P}}},d={types:{key:"type",base:l,typeMap:{"control-points":c,corners:a,"extent-and-rotation":s}},json:{types:{key:"type",base:l,typeMap:{"control-points":c}},write:{overridePolicy:()=>({enabled:!0,ignoreOrigin:!0})}}};e.createDefaultControlPointsGeoreference=async function(e,n){e.loaded||await e.load();const{contentWidth:t,contentHeight:a}=e,{spatialReference:s}=n,l=i.getInfo(s);let y=!1;if(l){const e=l.valid[1]-l.valid[0];n.width>e&&(n=new o({xmin:l.valid[0],ymin:n.ymin,xmax:l.valid[1],ymax:n.ymax,spatialReference:n.spatialReference}),y=!0)}const P=n.expand(.5),{center:f,width:u,height:d}=P,m=t/a,x=y||m>1,g=x?p:p*m,w=x?p/m:p,h=x?u:d*m,R=x?u/m:d,v=f.x-h/2,G=f.x+h/2,S=f.y+R/2,b=f.y-R/2;return new c({controlPoints:[{sourcePoint:{x:g,y:a-w},mapPoint:new r({x:v,y:b,spatialReference:s})},{sourcePoint:{x:g,y:w},mapPoint:new r({x:v,y:S,spatialReference:s})},{sourcePoint:{x:t-g,y:w},mapPoint:new r({x:G,y:S,spatialReference:s})},{sourcePoint:{x:t-g,y:a-w},mapPoint:new r({x:G,y:b,spatialReference:s})}],width:t,height:a})},e.createLocalModeControlPointsGeoreference=function(e){const n=e.georeference;if("control-points"!==n.type)return null;const t={wkid:0},{width:o,height:i}=n,a=n.controlPoints;return new c({controlPoints:a.map(e=>{const{x:n,y:o}=e.sourcePoint;return{sourcePoint:{x:n,y:o},mapPoint:new r({x:n,y:i-o,spatialReference:t})}}),width:o,height:i})},e.isWritingLayerFromItemToWebDocument=y,e.mediaElementUrlProperty=f,e.mediaGeoreferenceProperty=d,e.mediaTypeProperty=u,e.toControlPointsGeoreference=function(e,t,o){if(!e||"control-points"===e.type)return e;const{coords:i}=e;if(5!==i?.rings[0]?.length)return null;const[a,s,l,p]=i.rings[0],{spatialReference:y}=i;return new c({controlPoints:[{mapPoint:new r({x:a[0],y:a[1],spatialReference:y}),sourcePoint:n.createScreenPoint(0,o)},{mapPoint:new r({x:s[0],y:s[1],spatialReference:y}),sourcePoint:n.createScreenPoint(0,0)},{mapPoint:new r({x:l[0],y:l[1],spatialReference:y}),sourcePoint:n.createScreenPoint(t,0)},{mapPoint:new r({x:p[0],y:p[1],spatialReference:y}),sourcePoint:n.createScreenPoint(t,o)}],width:t,height:o})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});