// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/Error","../../core/promiseUtils","../../geometry/SpatialReference","../../geometry/support/typeUtils","../OrientedImageryLayer","./core/ExposurePoint","./core/utils","../../rest/support/Query","../../widgets/OrientedImageryViewer/navigation/utils"],function(e,r,t,o,a,n,i,s,u,c){"use strict";const l={};function y(e){return r=>(r.features.forEach(r=>{const t=i.fromJSON({...r.toJSON(),layer:e});t&&(r.attributes=t)}),r)}e.getSortedLayerFeatures=async function(e,r){const t=new u;t.where="1=1",t.outFields=["*"],t.orderByFields=["OffsetFromStart ASC"],t.outSpatialReference=r,t.returnGeometry=!0;const o=await e.queryFeatures(t);return y(e)(o)},e.searchImages=async function(e,i){const{point:m,queryParams:d}=e;!function(e,t){if(!a.isPoint(e)&&null==t?.geometry)throw new r("invalid-parameters","searchImages requires a point and query parameters to be provided.")}(m,d);const p="string"!=typeof(f=e.layerInstanceOrURL)?f:(l.layer?.url!==f&&(l.layer?.destroy(),l.layer=new n({url:f})),l.layer);var f;await p.load(i);const g=function(e,r,t){const a=r?s.convertGeographicToWebMercator(r):null,n=t?.maximumDistance??e.maximumDistance??1e3,i=t?.geometry??(a?c.createExtentAroundPoint(a,n):null);return new u({outSpatialReference:t?.outSpatialReference??e.spatialReference.isGeographic?o.WebMercator:e.spatialReference,returnGeometry:t?.returnGeometry??!0,outFields:t?.outFields??["*"],geometry:i,where:t?.where??"1=1",returnZ:e.hasZ,orderByFields:t?.orderByFields,maxRecordCountFactor:t?.maxRecordCountFactor??5})}(p,m,d),w=await p.queryFeatures(g,i);return t.throwIfAborted(i),y(p)(w)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});