// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/ControlPointsGeoreference":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/Error","../../core/JSONSupport","../../core/Logger","../../core/perspectiveUtils","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../core/libs/gl-matrix-2/math/mat3","../../core/libs/gl-matrix-2/factories/mat3f64","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64","../../geometry/Point","../../geometry/Polygon","../../geometry/projectionUtils","../../geometry/SpatialReference","./GeoreferenceBase"],function(e,t,r,n,o,i,s,a,c,l,u,d,p,h,m,f,y,g,_,x,b,P,M){"use strict";const v=f.create(),w=g.create();let S=class extends o.JSONSupport{};t.__decorate([c.property({type:Number,json:{write:{isRequired:!0}}})],S.prototype,"x",void 0),t.__decorate([c.property({type:Number,json:{write:{isRequired:!0}}})],S.prototype,"y",void 0),S=t.__decorate([p.subclass("esri.layers.support.ControlPointsGeoreference.ControlPointJSONType")],S);let R=class extends r.Clonable{constructor(){super(...arguments),this.sourcePoint=null,this.mapPoint=null}};function I(e){return null!=e?.sourcePoint&&null!=e.mapPoint}t.__decorate([c.property()],R.prototype,"sourcePoint",void 0),t.__decorate([c.property({type:_})],R.prototype,"mapPoint",void 0),R=t.__decorate([p.subclass("esri.layers.support.ControlPointsGeoreference.ControlPoint")],R),e.default=class extends(o.JSONSupportMixin(M)){constructor(e){super(e),this.controlPoints=null,this.height=0,this.type="control-points",this.width=0}readControlPoints(e,t){const r=P.fromJSON(t.spatialReference),n=f.fromValues(...t.coefficients,1);return e.map(e=>(y.set(w,e.x,e.y),s.transformProjective(w,w,n),{sourcePoint:e,mapPoint:new _({x:w[0],y:w[1],spatialReference:r})}))}writeControlPoints(e,t,r,o){if(null==this.transform){const e=new n("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration. Make sure the parent media element is loaded i.e. the ImageElement or VideoElement set as 'MediaLayer.source'.",{layer:o?.layer,georeference:this});return void(o?.messages?o.messages.push(e):i.getLogger(this).error(e.name,e.message))}null!=e&&I(e[0])&&(t.controlPoints=e.map(e=>{const t=e.sourcePoint;return{x:t.x,y:t.y}}),t.spatialReference=e[0].mapPoint.spatialReference.toJSON(),t.coefficients=this.transform.slice(0,8))}get coords(){if(null==this.controlPoints)return null;const e=this._updateTransform(v);if(null==e||!I(this.controlPoints[0]))return null;const t=this.controlPoints[0].mapPoint.spatialReference;return function(e,t,r,n){const o=g.fromValues(0,r),i=g.fromValues(0,0),a=g.fromValues(t,0),c=g.fromValues(t,r);return s.transformProjective(o,o,e),s.transformProjective(i,i,e),s.transformProjective(a,a,e),s.transformProjective(c,c,e),new x({rings:[[o,i,a,c,o]],spatialReference:n})}(e,this.width,this.height,t)}set coords(e){if(null==this.controlPoints||!I(this.controlPoints[0]))return;const t=this.controlPoints[0].mapPoint.spatialReference;if(null==(e=this.projectOrWarn(e,t)))return;const{width:r,height:n}=this,{rings:[[o,i,c,l]]}=e,u={sourcePoint:a.createScreenPoint(0,n),mapPoint:new _({x:o[0],y:o[1],spatialReference:t})},d={sourcePoint:a.createScreenPoint(0,0),mapPoint:new _({x:i[0],y:i[1],spatialReference:t})},p={sourcePoint:a.createScreenPoint(r,0),mapPoint:new _({x:c[0],y:c[1],spatialReference:t})},h={sourcePoint:a.createScreenPoint(r,n),mapPoint:new _({x:l[0],y:l[1],spatialReference:t})};I(u)&&I(d)&&I(p)&&I(h)&&(N(v,u,d,p,h),this.controlPoints=this.controlPoints.map(({sourcePoint:e})=>(y.set(w,e.x,e.y),s.transformProjective(w,w,v),{sourcePoint:e,mapPoint:new _({x:w[0],y:w[1],spatialReference:t})})))}get inverseTransform(){return null==this.transform?null:m.invert(f.create(),this.transform)}get transform(){return this._updateTransform()}toMap(e){if(null==e||null==this.transform||null==this.controlPoints||!I(this.controlPoints[0]))return null;y.set(w,e.x,e.y);const t=this.controlPoints[0].mapPoint.spatialReference;return s.transformProjective(w,w,this.transform),new _({x:w[0],y:w[1],spatialReference:t})}toSource(e){if(null==e||null==this.inverseTransform||null==this.controlPoints||!I(this.controlPoints[0]))return null;const t=this.controlPoints[0].mapPoint.spatialReference;return e=e.normalize(),null==(e=b.projectOrLoad(e,t).geometry)?null:(y.set(w,e.x,e.y),s.transformProjective(w,w,this.inverseTransform),a.createScreenPoint(w[0],w[1]))}toSourceNormalized(e){const t=this.toSource(e);return null!=t&&(t.x/=this.width,t.y/=this.height),t}_updateTransform(e){const{controlPoints:t,width:r,height:n}=this;if(!(null!=t&&r>0&&n>0))return null;const[o,i,s,a]=t;if(!I(o))return null;const c=o.mapPoint.spatialReference,l=this._projectControlPoint(i,c),u=this._projectControlPoint(s,c),d=this._projectControlPoint(a,c);if(!l.valid||!u.valid||!d.valid)return null;if(!I(l.controlPoint))return null;null==e&&(e=f.create());let p=null;return p=I(u.controlPoint)&&I(d.controlPoint)?N(e,o,l.controlPoint,u.controlPoint,d.controlPoint):I(u.controlPoint)?function(e,t,r,n){return X(E,T,t),X(O,j,r),X(L,C,n),y.lerp(B,E,O,.5),y.rotate(B,L,B,Math.PI),y.lerp(U,T,j,.5),y.rotate(U,C,U,Math.PI),q(e,E,O,L,B,T,j,C,U)}(e,o,l.controlPoint,u.controlPoint):function(e,t,r){return X(E,T,t),X(O,j,r),y.rotate(L,O,E,V),y.rotate(B,E,O,V),y.rotate(C,j,T,-V),y.rotate(U,T,j,-V),q(e,E,O,L,B,T,j,C,U)}(e,o,l.controlPoint),p.every(e=>0===e)?null:p}_projectControlPoint(e,t){if(!I(e))return{valid:!0,controlPoint:e};const{sourcePoint:r,mapPoint:n}=e,{geometry:o,pending:s}=b.projectOrLoad(n,t);return s?{valid:!1,controlPoint:null}:s||o?{valid:!0,controlPoint:{sourcePoint:r,mapPoint:o}}:(i.getLogger(this).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:e,sourceSpatialReference:n.spatialReference,targetSpatialReference:t}),{valid:!1,controlPoint:null})}},t.__decorate([c.property({type:[R],json:{write:{allowNull:!1,isRequired:!0,target:{controlPoints:{type:[S],isRequired:!0},coefficients:{type:[Number],isRequired:!0},spatialReference:{type:P,isRequired:!0}}}}})],e.default.prototype,"controlPoints",void 0),t.__decorate([d.reader("controlPoints")],e.default.prototype,"readControlPoints",null),t.__decorate([h.writer("controlPoints")],e.default.prototype,"writeControlPoints",null),t.__decorate([c.property({clonable:!1})],e.default.prototype,"coords",null),t.__decorate([c.property({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],e.default.prototype,"height",void 0),t.__decorate([c.property({readOnly:!0})],e.default.prototype,"inverseTransform",null),t.__decorate([c.property({readOnly:!0})],e.default.prototype,"transform",null),t.__decorate([c.property({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],e.default.prototype,"width",void 0),e.default=t.__decorate([p.subclass("esri.layers.support.ControlPointsGeoreference")],e.default);const E=g.create(),O=g.create(),L=g.create(),B=g.create(),T=g.create(),j=g.create(),C=g.create(),U=g.create(),V=Math.PI/2;function X(e,t,r){y.set(e,r.sourcePoint.x,r.sourcePoint.y),y.set(t,r.mapPoint.x,r.mapPoint.y)}function N(e,t,r,n,o){return X(E,T,t),X(O,j,r),X(L,C,n),X(B,U,o),q(e,E,O,L,B,T,j,C,U)}const Y=new Array(8).fill(0),A=new Array(8).fill(0);function G(e,t,r,n,o){return e[0]=t[0],e[1]=t[1],e[2]=r[0],e[3]=r[1],e[4]=n[0],e[5]=n[1],e[6]=o[0],e[7]=o[1],e}function q(e,t,r,n,o,i,a,c,l){return s.getProjectiveTransform(e,G(Y,t,r,n,o),G(A,i,a,c,l))}return e.default})},"esri/core/perspectiveUtils":function(){define(["exports","./libs/gl-matrix-2/math/mat3","./libs/gl-matrix-2/factories/mat3f64","./libs/gl-matrix-2/math/vec2","../chunks/vec32","./libs/gl-matrix-2/factories/vec3f64"],function(e,t,r,n,o,i){"use strict";const s=i.create(),a=r.create(),c=r.create(),l=r.create();function u(e,r,n,i,c,l,u,d,p){t.set(e,r,i,l,n,c,u,1,1,1),o.set(s,d,p,1),t.adjoint(a,e);const[h,m,f]=o.transformMat3(s,s,t.transpose(a,a));return t.set(a,h,0,0,0,m,0,0,0,f),t.multiply(e,a,e)}e.getProjectiveTransform=function(e,r,n){return u(c,r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]),u(l,n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7]),t.multiply(e,t.adjoint(c,c),l),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e},e.transformProjective=function(e,r,i){return o.set(s,r[0],r[1],1),o.transformMat3(s,s,t.transpose(a,i)),0===s[2]?n.set(e,s[0],s[1]):n.set(e,s[0]/s[2],s[1]/s[2])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function n(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function o(e,t,r,n,o,i,s,a,c,l){return e[0]=t,e[1]=r,e[2]=n,e[3]=o,e[4]=i,e[5]=s,e[6]=a,e[7]=c,e[8]=l,e}function i(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function s(e,t){if(e===t){const r=t[1],n=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=n,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function a(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],s=t[4],a=t[5],c=t[6],l=t[7],u=t[8],d=u*s-a*l,p=-u*i+a*c,h=l*i-s*c;let m=r*d+n*p+o*h;return m?(m=1/m,e[0]=d*m,e[1]=(-u*n+o*l)*m,e[2]=(a*n-o*s)*m,e[3]=p*m,e[4]=(u*r-o*c)*m,e[5]=(-a*r+o*i)*m,e[6]=h*m,e[7]=(-l*r+n*c)*m,e[8]=(s*r-n*i)*m,e):null}function c(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],s=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return e[0]=s*u-a*l,e[1]=o*l-n*u,e[2]=n*a-o*s,e[3]=a*c-i*u,e[4]=r*u-o*c,e[5]=o*i-r*a,e[6]=i*l-s*c,e[7]=n*c-r*l,e[8]=r*s-n*i,e}function l(e){const t=e[0],r=e[1],n=e[2],o=e[3],i=e[4],s=e[5],a=e[6],c=e[7],l=e[8];return t*(l*i-s*c)+r*(-l*o+s*a)+n*(c*o-i*a)}function u(e,t,r){const n=t[0],o=t[1],i=t[2],s=t[3],a=t[4],c=t[5],l=t[6],u=t[7],d=t[8],p=r[0],h=r[1],m=r[2],f=r[3],y=r[4],g=r[5],_=r[6],x=r[7],b=r[8];return e[0]=p*n+h*s+m*l,e[1]=p*o+h*a+m*u,e[2]=p*i+h*c+m*d,e[3]=f*n+y*s+g*l,e[4]=f*o+y*a+g*u,e[5]=f*i+y*c+g*d,e[6]=_*n+x*s+b*l,e[7]=_*o+x*a+b*u,e[8]=_*i+x*c+b*d,e}function d(e,t,r){const n=t[0],o=t[1],i=t[2],s=t[3],a=t[4],c=t[5],l=t[6],u=t[7],d=t[8],p=r[0],h=r[1];return e[0]=n,e[1]=o,e[2]=i,e[3]=s,e[4]=a,e[5]=c,e[6]=p*n+h*s+l,e[7]=p*o+h*a+u,e[8]=p*i+h*c+d,e}function p(e,t,r){const n=t[0],o=t[1],i=t[2],s=t[3],a=t[4],c=t[5],l=t[6],u=t[7],d=t[8],p=Math.sin(r),h=Math.cos(r);return e[0]=h*n+p*s,e[1]=h*o+p*a,e[2]=h*i+p*c,e[3]=h*s-p*n,e[4]=h*a-p*o,e[5]=h*c-p*i,e[6]=l,e[7]=u,e[8]=d,e}function h(e,t,r){const n=r[0],o=r[1],i=r[2];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=i*t[6],e[7]=i*t[7],e[8]=i*t[8],e}function m(e,t,r){const n=r[0],o=r[1];return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e}function f(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function y(e,t){const r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function _(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function x(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],s=r+r,a=n+n,c=o+o,l=r*s,u=n*s,d=n*a,p=o*s,h=o*a,m=o*c,f=i*s,y=i*a,g=i*c;return e[0]=1-d-m,e[3]=u-g,e[6]=p+y,e[1]=u+g,e[4]=1-l-m,e[7]=h-f,e[2]=p-y,e[5]=h+f,e[8]=1-l-d,e}function b(e,t){const r=t[0],n=t[1],o=t[2],i=t[4],s=t[5],a=t[6],c=t[8],l=t[9],u=t[10],d=u*s-a*l,p=-u*i+a*c,h=l*i-s*c,m=r*d+n*p+o*h;if(!m)return null;const f=1/m;return e[0]=d*f,e[1]=(-u*n+o*l)*f,e[2]=(a*n-o*s)*f,e[3]=p*f,e[4]=(u*r-o*c)*f,e[5]=(-a*r+o*i)*f,e[6]=h*f,e[7]=(-l*r+n*c)*f,e[8]=(s*r-n*i)*f,e}function P(e,t){const r=t[0],n=t[1],o=t[2],i=t[3],s=t[4],a=t[5],c=t[6],l=t[7],u=t[8],d=t[9],p=t[10],h=t[11],m=t[12],f=t[13],y=t[14],g=t[15],_=r*a-n*s,x=r*c-o*s,b=r*l-i*s,P=n*c-o*a,M=n*l-i*a,v=o*l-i*c,w=u*f-d*m,S=u*y-p*m,R=u*g-h*m,I=d*y-p*f,E=d*g-h*f,O=p*g-h*y;let L=_*O-x*E+b*I+P*R-M*S+v*w;return L?(L=1/L,e[0]=(a*O-c*E+l*I)*L,e[1]=(c*R-s*O-l*S)*L,e[2]=(s*E-a*R+l*w)*L,e[3]=(o*E-n*O-i*I)*L,e[4]=(r*O-o*R+i*S)*L,e[5]=(n*R-r*E-i*w)*L,e[6]=(f*v-y*M+g*P)*L,e[7]=(y*b-m*v-g*x)*L,e[8]=(m*M-f*b+g*_)*L,e):null}function M(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function v(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function w(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function S(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function R(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function I(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function E(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e[3]=t[3]+r[3]*n,e[4]=t[4]+r[4]*n,e[5]=t[5]+r[5]*n,e[6]=t[6]+r[6]*n,e[7]=t[7]+r[7]*n,e[8]=t[8]+r[8]*n,e}function O(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function L(e,r){const n=e[0],o=e[1],i=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],d=e[8],p=r[0],h=r[1],m=r[2],f=r[3],y=r[4],g=r[5],_=r[6],x=r[7],b=r[8],P=t.getEpsilon();return Math.abs(n-p)<=P*Math.max(1,Math.abs(n),Math.abs(p))&&Math.abs(o-h)<=P*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(i-m)<=P*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(s-f)<=P*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(a-y)<=P*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(c-g)<=P*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(l-_)<=P*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(u-x)<=P*Math.max(1,Math.abs(u),Math.abs(x))&&Math.abs(d-b)<=P*Math.max(1,Math.abs(d),Math.abs(b))}function B(e){const r=t.getEpsilon(),n=e[0],o=e[1],i=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],d=e[8];return Math.abs(1-(n*n+s*s+l*l))<=r&&Math.abs(1-(o*o+a*a+u*u))<=r&&Math.abs(1-(i*i+c*c+d*d))<=r}const T=u,j=R,C=Object.freeze(Object.defineProperty({__proto__:null,add:S,adjoint:c,copy:n,determinant:l,equals:L,exactEquals:O,frob:w,fromMat2d:_,fromMat4:r,fromQuat:x,fromRotation:y,fromScaling:g,fromTranslation:f,identity:i,invert:a,isOrthoNormal:B,mul:T,multiply:u,multiplyScalar:I,multiplyScalarAndAdd:E,normalFromMat4:P,normalFromMat4Legacy:b,projection:M,rotate:p,scale:h,scaleByVec2:m,set:o,str:v,sub:j,subtract:R,translate:d,transpose:s},Symbol.toStringTag,{value:"Module"}));e.add=S,e.adjoint=c,e.copy=n,e.determinant=l,e.equals=L,e.exactEquals=O,e.frob=w,e.fromMat2d=_,e.fromMat4=r,e.fromQuat=x,e.fromRotation=y,e.fromScaling=g,e.fromTranslation=f,e.identity=i,e.invert=a,e.isOrthoNormal=B,e.mat3=C,e.mul=T,e.multiply=u,e.multiplyScalar=I,e.multiplyScalarAndAdd=E,e.normalFromMat4=P,e.normalFromMat4Legacy=b,e.projection=M,e.rotate=p,e.scale=h,e.scaleByVec2=m,e.set=o,e.str=v,e.sub=j,e.subtract=R,e.translate=d,e.transpose=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e}function n(e,t,r){return e[0]=t,e[1]=r,e}function o(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function i(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function a(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function c(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function l(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function u(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function d(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function p(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function h(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function m(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e}function f(e,t){const r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function y(e,t){const r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function g(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function _(e){const t=e[0],r=e[1];return t*t+r*r}function x(e,t){return e[0]=-t[0],e[1]=-t[1],e}function b(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function P(e,t){const r=t[0],n=t[1];let o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o),e}function M(e,t){return e[0]*t[0]+e[1]*t[1]}function v(e,t,r){const n=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=n,e}function w(e,t,r,n){const o=t[0],i=t[1];return e[0]=o+n*(r[0]-o),e[1]=i+n*(r[1]-i),e}function S(e,r=1){const n=2*t.RANDOM()*Math.PI;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e}function R(e,t,r){const n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o,e[1]=r[1]*n+r[3]*o,e}function I(e,t,r){const n=t[0],o=t[1];return e[0]=r[0]*n+r[2]*o+r[4],e[1]=r[1]*n+r[3]*o+r[5],e}function E(e,t,r){const n=t[0],o=t[1];return e[0]=r[0]*n+r[3]*o+r[6],e[1]=r[1]*n+r[4]*o+r[7],e}function O(e,t,r){const n=t[0],o=t[1];return e[0]=r[0]*n+r[4]*o+r[12],e[1]=r[1]*n+r[5]*o+r[13],e}function L(e,t,r,n){const o=t[0]-r[0],i=t[1]-r[1],s=Math.sin(n),a=Math.cos(n);return e[0]=o*a-i*s+r[0],e[1]=o*s+i*a+r[1],e}function B(e,t){const r=e[0],n=e[1],o=t[0],i=t[1];let s=r*r+n*n;s>0&&(s=1/Math.sqrt(s));let a=o*o+i*i;a>0&&(a=1/Math.sqrt(a));const c=(r*o+n*i)*s*a;return c>1?0:c<-1?Math.PI:Math.acos(c)}function T(e){return"vec2("+e[0]+", "+e[1]+")"}function j(e,t){return e[0]===t[0]&&e[1]===t[1]}function C(e,r){const n=e[0],o=e[1],i=r[0],s=r[1],a=t.getEpsilon();return Math.abs(n-i)<=a*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(o-s)<=a*Math.max(1,Math.abs(o),Math.abs(s))}function U(e,t,r,n,o){let i=t[0]-r[0],s=t[1]-r[1];const a=(n[0]*i+n[1]*s)*(o-1);return i=n[0]*a,s=n[1]*a,e[0]=t[0]+i,e[1]=t[1]+s,e}const V=g,X=i,N=s,Y=a,A=f,G=y,q=_,z=Object.freeze(Object.defineProperty({__proto__:null,add:o,angle:B,ceil:c,copy:r,cross:v,dist:A,distance:f,div:Y,divide:a,dot:M,equals:C,exactEquals:j,floor:l,inverse:b,len:V,length:g,lerp:w,max:d,min:u,mul:N,multiply:s,negate:x,normalize:P,projectAndScale:U,random:S,rotate:L,round:p,scale:h,scaleAndAdd:m,set:n,sqrDist:G,sqrLen:q,squaredDistance:y,squaredLength:_,str:T,sub:X,subtract:i,transformMat2:R,transformMat2d:I,transformMat3:E,transformMat4:O},Symbol.toStringTag,{value:"Module"}));e.add=o,e.angle=B,e.ceil=c,e.copy=r,e.cross=v,e.dist=A,e.distance=f,e.div=Y,e.divide=a,e.dot=M,e.equals=C,e.exactEquals=j,e.floor=l,e.inverse=b,e.len=V,e.length=g,e.lerp=w,e.max=d,e.min=u,e.mul=N,e.multiply=s,e.negate=x,e.normalize=P,e.projectAndScale=U,e.random=S,e.rotate=L,e.round=p,e.scale=h,e.scaleAndAdd=m,e.set=n,e.sqrDist=G,e.sqrLen=q,e.squaredDistance=y,e.squaredLength=_,e.str=T,e.sub=X,e.subtract=i,e.transformMat2=R,e.transformMat2d=I,e.transformMat3=E,e.transformMat4=O,e.vec2=z,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(e){"use strict";function t(){return[0,0]}function r(e){return[e[0],e[1]]}function n(e,t){return[e,t]}function o(e,t){return[e,t]}function i(e,t=[0,0]){const r=Math.min(2,e.length);for(let n=0;n<r;++n)t[n]=e[n];return t}function s(){return[0,0]}function a(){return n(1,1)}function c(){return n(1,0)}function l(){return n(0,1)}const u=[0,0],d=a(),p=c(),h=l(),m=Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:h,ZEROS:u,clone:r,create:t,freeze:o,fromArray:i,fromValues:n,ones:a,unitX:c,unitY:l,zeros:s},Symbol.toStringTag,{value:"Module"}));e.ONES=d,e.UNIT_X=p,e.UNIT_Y=h,e.ZEROS=u,e.clone=r,e.create=t,e.freeze=o,e.fromArray=i,e.fromValues=n,e.ones=a,e.unitX=c,e.unitY=l,e.vec2f64=m,e.zeros=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/GeoreferenceBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/Logger","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/subclass","../../geometry/projectionUtils"],function(e,t,r,n,o,i,s,a,c){"use strict";return e.default=class extends r.Clonable{projectOrWarn(e,t){if(null==e)return e;const{geometry:r,pending:o}=c.projectOrLoad(e,t);return o?null:o||r?r:(n.getLogger(this).warn("geometry could not be projected to the spatial reference",{georeference:this,geometry:e,sourceSpatialReference:e.spatialReference,targetSpatialReference:t}),null)}},e.default=t.__decorate([a.subclass("esri.layers.support.GeoreferenceBase")],e.default),e.default})},"esri/layers/support/ImageElement":function(){define(["exports","../../chunks/tslib.es6","../../request","../../core/Error","../../core/imageUtils","../../core/urlUtils","../../core/uuid","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./MediaElementBase","./mediaUtils","../../portal/support/resourceExtension","../../support/mediaLayerUtils","../../chunks/persistableUrlUtils"],function(e,t,r,n,o,i,s,a,c,l,u,d,p,h,m,f,y,g,_){"use strict";var x;return e.default=class extends m{static{x=g.ImageElementSymbol}constructor(e){super(e),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this[x]=!0,this.image=null}load(){const e=this.image;if("string"==typeof e){const t=o.getImageData(e).then(e=>{this._set("content",e)});this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){const t=e.decode().then(()=>{this._set("content",e)});this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new n("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}get contentWidth(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(e,t,r){return _.fromJSON(t.url,r)}writeImage(e,t,n,o){if(null==e)return;const a=o?.portalItem,c=o?.resources;if(!a||!c)return void("string"==typeof e&&(t[n]=_.toJSON(e,o)));const l=function(e){return"string"==typeof e&&!i.isDataProtocol(e)&&!i.isBlobProtocol(e)}(e)?e:null;if(l){if(null==_.itemIdFromResourceUrl(l))return void(t[n]=l);const e=_.toJSON(l,{...o,verifyItemRelativeUrls:o?.verifyItemRelativeUrls?{writtenUrls:o.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},1);if(a&&e&&!i.isAbsolute(e))return c.toKeep.push({resource:a.resourceFromPath(e),compress:!1}),void(t[n]=e)}t[n]="<pending>",c.pendingOperations.push(async function(e){return"string"==typeof e?i.isDataProtocol(e)?i.dataToBlob(e):(await r(e,{responseType:"blob"})).data:new Promise(t=>function(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,r=e instanceof HTMLImageElement?e.naturalHeight:e.height,n=document.createElement("canvas"),o=n.getContext("2d");return n.width=t,n.height=r,e instanceof HTMLImageElement?o.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&o.putImageData(e,0,0),n}(e).toBlob(t))}(e).then(e=>{const r=function(e,t){const r=s.generateUUID(),n=`${i.join("media",r)}.${y.getResourceContentExtension({type:"blob",blob:e})}`;return t.resourceFromPath(n)}(e,a);t[n]=r.itemRelativeUrl,c.toAdd.push({resource:r,content:{type:"blob",blob:e},compress:!1,finish:e=>{this.image=e.url}})}))}},t.__decorate([a.property()],e.default.prototype,"animationOptions",void 0),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"content",void 0),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"contentWidth",null),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"contentHeight",null),t.__decorate([a.property(f.mediaElementUrlProperty)],e.default.prototype,"image",void 0),t.__decorate([d.reader("image",["url"])],e.default.prototype,"readImage",null),t.__decorate([h.writer("image")],e.default.prototype,"writeImage",null),t.__decorate([a.property(f.mediaTypeProperty)],e.default.prototype,"type",void 0),e.default=t.__decorate([p.subclass("esri.layers.support.ImageElement")],e.default),e.default})},"esri/core/imageUtils":function(){define(["require","exports","../request","./Error","./promiseUtils","./urlUtils","../support/base64Utils"],function(e,t,r,n,o,i,s){"use strict";let a=null,c=!0;function l(e,t,r){return r||(a||(a=document.createElement("canvas"),a.width=1,a.height=1),r=a),r.getContext("2d").createImageData(e,t)}t.createEmptyImageData=function(e,t,r){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t)}catch(e){c=!1}return l(e,t,r)},t.getImageData=async function(t,a){const{arrayBuffer:c,mediaType:l}=await async function(e,t){const n=i.dataComponents(e);if(n?.isBase64)return{arrayBuffer:s.base64ToArrayBuffer(n.data),mediaType:n.mediaType};const o=await r(e,{responseType:"array-buffer",...t});return{arrayBuffer:o.data,mediaType:o.getHeader?.("Content-Type")??""}}(t,a),u="image/png"===l;if("image/gif"===l){const{isAnimatedGIF:t,parseGif:r}=await new Promise((t,r)=>e(["./image/gif"],t,r));if(t(c))return r(c,a)}if(u){const{isAnimatedPNG:t,parseApng:r}=await new Promise((t,r)=>e(["./image/apng"],t,r));if(t(c))return r(c,a)}return async function(e,t){const i=window.URL.createObjectURL(e);try{const{data:e}=await r(i,{...t,responseType:"image"});return e}catch(e){if(!o.isAbortError(e))throw new n("invalid-image",`Could not fetch requested image at ${i}`);throw e}finally{window.URL.revokeObjectURL(i)}}(new Blob([c],{type:l}),a)},t.wrapImageData=function(e,t,r,n){if(!t||!r)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t,r)}catch(e){c=!1}const o=l(t,r,n);return o.data.set(e,0),o},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/MediaElementBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Error","../../core/Identifiable","../../core/Loadable","../../core/Logger","../../core/MultiOriginJSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./ControlPointsGeoreference","./mediaUtils"],function(e,t,r,n,o,i,s,a,c,l,u,d,p,h,m){"use strict";return e.default=class extends(n.NumericIdentifiableMixin(s.MultiOriginJSONMixin(o.Loadable))){constructor(e){super(e),this.georeference=null,this.opacity=1}readGeoreference(e){return h.fromJSON(e)}writeGeoreference(e,t,n,o){const s=o?.resources?.pendingOperations,a=()=>{const s=m.toControlPointsGeoreference(this.georeference,this.contentWidth,this.contentHeight);if(s){if("control-points"!==e.type&&i.getLogger(this).warn(`only georeference of type 'control-points' may be persisted. The georeference of type '${e.type}' has been automatically converted.`),4!==s.controlPoints?.length&&o?.messages)return void o.messages.push(new r("property:unsupported","only 'control-points' georeference with 4 control points may be persisted."));t[n]=s.write({},o)}};if("control-points"!==e.type&&!this.loaded&&s)return t[n]={},void s.push(this.load().then(a));a()}get contentWidth(){return 0}get contentHeight(){return 0}toSource(e){const{georeference:t,contentWidth:r,contentHeight:n}=this;if(null==e||null==t||0===r||0===n)return null;const o=t.toSourceNormalized(e);return null==o?null:(o.x*=r,o.y*=n,o)}},t.__decorate([a.property(m.mediaGeoreferenceProperty)],e.default.prototype,"georeference",void 0),t.__decorate([u.reader("georeference")],e.default.prototype,"readGeoreference",null),t.__decorate([p.writer("georeference")],e.default.prototype,"writeGeoreference",null),t.__decorate([a.property({json:{read:!1,write:!1}})],e.default.prototype,"opacity",void 0),e.default=t.__decorate([d.subclass("esri.layers.support.MediaElementBase")],e.default),e.default})},"esri/layers/support/mediaUtils":function(){define(["exports","../../core/screenUtils","../../core/accessorSupport/PropertyOrigin","../../geometry/Extent","../../geometry/Point","../../geometry/support/spatialReferenceUtils","./ControlPointsGeoreference","./CornersGeoreference","./ExtentAndRotationGeoreference","./GeoreferenceBase"],function(e,t,r,n,o,i,s,a,c,l){"use strict";const u=100;function d(e,t){const n=r.nameToId(t);return function(e){return"media"===e?.type}(e)&&!!e.portalItem&&null!=n&&n>3}function p(e,t,r){return{enabled:!d(r?.layer,r?.origin),ignoreOrigin:!0}}const h={json:{name:"url",type:String,write:{overridePolicy:p}}},m={readOnly:!0,json:{read:!1,write:{target:"mediaType",overridePolicy:p}}},f={types:{key:"type",base:l,typeMap:{"control-points":s,corners:a,"extent-and-rotation":c}},json:{types:{key:"type",base:l,typeMap:{"control-points":s}},write:{overridePolicy:()=>({enabled:!0,ignoreOrigin:!0})}}};e.createDefaultControlPointsGeoreference=async function(e,t){e.loaded||await e.load();const{contentWidth:r,contentHeight:a}=e,{spatialReference:c}=t,l=i.getInfo(c);let d=!1;if(l){const e=l.valid[1]-l.valid[0];t.width>e&&(t=new n({xmin:l.valid[0],ymin:t.ymin,xmax:l.valid[1],ymax:t.ymax,spatialReference:t.spatialReference}),d=!0)}const p=t.expand(.5),{center:h,width:m,height:f}=p,y=r/a,g=d||y>1,_=g?u:u*y,x=g?u/y:u,b=g?m:f*y,P=g?m/y:f,M=h.x-b/2,v=h.x+b/2,w=h.y+P/2,S=h.y-P/2;return new s({controlPoints:[{sourcePoint:{x:_,y:a-x},mapPoint:new o({x:M,y:S,spatialReference:c})},{sourcePoint:{x:_,y:x},mapPoint:new o({x:M,y:w,spatialReference:c})},{sourcePoint:{x:r-_,y:x},mapPoint:new o({x:v,y:w,spatialReference:c})},{sourcePoint:{x:r-_,y:a-x},mapPoint:new o({x:v,y:S,spatialReference:c})}],width:r,height:a})},e.createLocalModeControlPointsGeoreference=function(e){const t=e.georeference;if("control-points"!==t.type)return null;const r={wkid:0},{width:n,height:i}=t,a=t.controlPoints;return new s({controlPoints:a.map(e=>{const{x:t,y:n}=e.sourcePoint;return{sourcePoint:{x:t,y:n},mapPoint:new o({x:t,y:i-n,spatialReference:r})}}),width:n,height:i})},e.isWritingLayerFromItemToWebDocument=d,e.mediaElementUrlProperty=h,e.mediaGeoreferenceProperty=f,e.mediaTypeProperty=m,e.toControlPointsGeoreference=function(e,r,n){if(!e||"control-points"===e.type)return e;const{coords:i}=e;if(5!==i?.rings[0]?.length)return null;const[a,c,l,u]=i.rings[0],{spatialReference:d}=i;return new s({controlPoints:[{mapPoint:new o({x:a[0],y:a[1],spatialReference:d}),sourcePoint:t.createScreenPoint(0,n)},{mapPoint:new o({x:c[0],y:c[1],spatialReference:d}),sourcePoint:t.createScreenPoint(0,0)},{mapPoint:new o({x:l[0],y:l[1],spatialReference:d}),sourcePoint:t.createScreenPoint(r,0)},{mapPoint:new o({x:u[0],y:u[1],spatialReference:d}),sourcePoint:t.createScreenPoint(r,n)}],width:r,height:n})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/CornersGeoreference":function(){define(["../../chunks/tslib.es6","../../core/perspectiveUtils","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/libs/gl-matrix-2/factories/mat3f64","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64","../../geometry/Point","../../geometry/Polygon","../../geometry/projectionUtils","./GeoreferenceBase"],function(e,t,r,n,o,i,s,a,c,l,u,d,p,h,m){"use strict";const f=u.create();let y=class extends m{constructor(e){super(e),this.bottomLeft=null,this.bottomRight=null,this.topLeft=null,this.topRight=null,this.type="corners"}get coords(){let{topLeft:e,topRight:t,bottomLeft:r,bottomRight:n}=this;if(null==e||null==t||null==r||null==n)return null;const o=e.spatialReference;return t=this.projectOrWarn(t,o),r=this.projectOrWarn(r,o),n=this.projectOrWarn(n,o),null==t||null==r||null==n?null:new p({rings:[[[r.x,r.y],[e.x,e.y],[t.x,t.y],[n.x,n.y],[r.x,r.y]]],spatialReference:o})}set coords(e){const{topLeft:t}=this;if(null==t)return;const r=t.spatialReference;if(null==(e=this.projectOrWarn(e,r)))return;const{rings:[[n,o,i,s]]}=e;this.bottomLeft=new d({x:n[0],y:n[1],spatialReference:r}),this.topLeft=new d({x:o[0],y:o[1],spatialReference:r}),this.topRight=new d({x:i[0],y:i[1],spatialReference:r}),this.bottomRight=new d({x:s[0],y:s[1],spatialReference:r})}toSourceNormalized(e){const{topLeft:n,topRight:o,bottomRight:i,bottomLeft:s}=this;if(null==e||null==n||null==o||null==i||null==s)return null;const a=n.spatialReference;e=e.normalize();const u=h.projectOrLoad(e,a).geometry;if(null==u)return null;l.set(f,u.x,u.y);const d=t.getProjectiveTransform(c.create(),[n.x,n.y,s.x,s.y,o.x,o.y,i.x,i.y],[0,0,0,1,1,0,1,1]);return t.transformProjective(f,f,d),r.createScreenPoint(f[0],f[1])}};return e.__decorate([n.property({clonable:!1})],y.prototype,"coords",null),e.__decorate([n.property({type:d})],y.prototype,"bottomLeft",void 0),e.__decorate([n.property({type:d})],y.prototype,"bottomRight",void 0),e.__decorate([n.property({type:d})],y.prototype,"topLeft",void 0),e.__decorate([n.property({type:d})],y.prototype,"topRight",void 0),y=e.__decorate([a.subclass("esri.layers.support.CornersGeoreference")],y),y})},"esri/layers/support/ExtentAndRotationGeoreference":function(){define(["../../chunks/tslib.es6","../../core/mathUtils","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/libs/gl-matrix-2/math/common","../../geometry/Extent","../../geometry/Polygon","../../geometry/projectionUtils","./GeoreferenceBase"],function(e,t,r,n,o,i,s,a,c,l,u,d,p){"use strict";let h=class extends p{constructor(e){super(e),this.extent=null,this.rotation=0,this.type="extent-and-rotation"}get coords(){if(null==this.extent)return null;const{xmin:e,ymin:t,xmax:r,ymax:n,spatialReference:o}=this.extent;let i;if(this.rotation){const{x:o,y:s}=this.extent.center,a=m(o,s,this.rotation);i=[a(e,t),a(e,n),a(r,n),a(r,t)],i.push(i[0])}else i=[[e,t],[e,n],[r,n],[r,t],[e,t]];return new u({rings:[i],spatialReference:o})}set coords(e){if(null==e||null==this.extent)return;const r=this.extent.spatialReference;if(e=this.projectOrWarn(e,r),null==e?.extent)return;const{rings:[[n,o,i]],extent:{center:{x:s,y:a}}}=e,c=t.rad2deg(Math.PI/2-Math.atan2(o[1]-n[1],o[0]-n[0])),u=m(s,a,-c),[d,p]=u(n[0],n[1]),[h,f]=u(i[0],i[1]);this.extent=new l({xmin:d,ymin:p,xmax:h,ymax:f,spatialReference:r}),this.rotation=c}toSourceNormalized(e){const{extent:n,rotation:o}=this;if(null==e||null==n)return null;const{xmin:i,ymin:s,xmax:a,ymax:c,center:l,spatialReference:u}=n;e=e.normalize();const p=d.projectOrLoad(e,u).geometry;if(null==p)return null;let h=p.x,f=p.y;return o&&([h,f]=m(l.x,l.y,-o)(h,f)),r.createScreenPoint(t.scale(h,i,a,0,1),t.scale(f,c,s,0,1))}};function m(e,t,r){const n=c.toRadian(r),o=Math.cos(n),i=Math.sin(n);return(r,n)=>[o*(r-e)+i*(n-t)+e,o*(n-t)-i*(r-e)+t]}return e.__decorate([n.property({clonable:!1})],h.prototype,"coords",null),e.__decorate([n.property({type:l})],h.prototype,"extent",void 0),e.__decorate([n.property({type:Number})],h.prototype,"rotation",void 0),h=e.__decorate([a.subclass("esri.layers.support.ExtentAndRotationGeoreference")],h),h})},"esri/support/mediaLayerUtils":function(){define(["exports"],function(e){"use strict";const t=Symbol("ImageElementInstance"),r=Symbol("VideoElementInstance");function n(e){return null!=e&&"object"==typeof e&&t in e}function o(e){return null!=e&&"object"==typeof e&&r in e}e.ImageElementSymbol=t,e.VideoElementSymbol=r,e.isImageElement=n,e.isMediaElement=function(e){return n(e)||o(e)},e.isVideoElement=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LocalMediaElementSource":function(){define(["exports","../../chunks/tslib.es6","../../core/Collection","../../core/collectionUtils","../../core/Evented","../../core/Loadable","../../core/Logger","../../core/Promise","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/Extent","../../geometry/projectionUtils","../../geometry/SpatialReference","../../geometry/support/aaBoundingRect","../../geometry/support/intersectsBase","../../geometry/support/spatialReferenceUtils","../graphics/data/BoundsStore","./ImageElement","./MediaElementBase","./MediaElementView","./VideoElement"],function(e,t,r,n,o,i,s,a,c,l,u,d,p,h,m,f,y,g,_,x,b,P,M,v,w){"use strict";const S={key:"type",defaultKeyValue:"image",base:M,typeMap:{image:P,video:w}},R=r.ofType(S);return e.default=class extends(i.LoadableMixin(a.EsriPromiseMixin(o.EventedAccessor))){constructor(e){super(e),this._index=new b.BoundsStore,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=e=>{for(const t of e.removed){const e=this._elementViewsMap.get(t);this._elementViewsMap.delete(t),this._index.delete(e),this.removeHandles(e),e.destroy(),this.notifyChange("fullExtent")}const{spatialReference:t}=this;for(const r of e.added){if(this._elementViewsMap.get(r))continue;const e=new v.MediaElementView({spatialReference:t,element:r});this._elementViewsMap.set(r,e);const n=l.watch(()=>e.coords,()=>this._updateIndexForElement(e,!1));this._updateIndexForElement(e,!0),this.addHandles(n,e)}this._elementsIndexes.clear(),this.elements.forEach((e,t)=>this._elementsIndexes.set(e,t)),this.emit("refresh")},this.elements=new R}async load(e){if(c.throwIfAborted(e),!this.spatialReference){const e=this.elements.find(e=>null!=e.georeference?.coords);this._set("spatialReference",e?e.georeference.coords.spatialReference:y.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.addHandles(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",n.referenceSetter(e,this._get("elements"),R))}get fullExtent(){if("not-loaded"===this.loadStatus)return null;const e=this._index.fullBounds;return null==e?null:new m({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){"not-loaded"===this.loadStatus?this._set("spatialReference",e):s.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}async queryElements(e,t){await this.load(),await f.initializeProjection(e.spatialReference,this.spatialReference,null,t);const r=x.equals(e.spatialReference,this.spatialReference)?e:f.project(e,this.spatialReference);if(!r)return[];const n=r.normalize(),o=[];for(const e of n)this._index.forEachInBounds(g.fromExtent(e),({normalizedCoords:t,element:r})=>{null!=t&&_.extentIntersectsPolygon(e,t)&&o.push(r)});return o.sort((e,t)=>this._elementsIndexes.get(e)-this._elementsIndexes.get(t)),o}hasElement(e){return this.elements.includes(e)}_updateIndexForElement(e,t){const r=e.normalizedBounds,n=this._index.has(e),o=null!=r;this._index.delete(e),o&&this._index.set(e,r),this.notifyChange("fullExtent"),t||(n!==o?this.emit("refresh"):this.emit("change",{element:e.element}))}},t.__decorate([u.property()],e.default.prototype,"elements",null),t.__decorate([u.property({readOnly:!0})],e.default.prototype,"fullExtent",null),t.__decorate([u.property()],e.default.prototype,"spatialReference",null),e.default=t.__decorate([h.subclass("esri.layers.support.LocalMediaElementSource")],e.default),e.default})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(e,t,r,n){"use strict";const o={minX:0,minY:0,maxX:0,maxY:0};e.BoundsStore=class{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new r.PooledRBush(9,t("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach((r,n)=>{e[t++]=n}),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(e=>this._idByBounds.has(e))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=n.empty();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),function(e,t,r){!function(e){o.minX=e[0],o.minY=e[1],o.maxX=e[2],o.maxY=e[3]}(t),e.search(o,r)}(this._index,e,e=>t(this._idByBounds.get(e)))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../compilerUtils","../../has","../../PooledArray","../../../chunks/quickselect"],function(e,t,r,n,o,i){"use strict";function s(e,t){let n=e;for(b.clear();n;){if(!0===n.leaf)for(const e of n.children)t(r.toConst(e));else b.pushArray(n.children);n=b.pop()??null}}function a(e,t){c(e,0,e.children.length,t,e)}function c(e,t,r,n,o){o||(o=new S([])),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let i,s=t;s<r;s++)i=e.children[s],l(o,e.leaf?n(i):i);return o}function l(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function u(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function f(e,t){const r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),o=Math.min(e.maxX,t.maxX),i=Math.min(e.maxY,t.maxY);return Math.max(0,o-r)*Math.max(0,i-n)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function _(e,t,r,n,o){const s=[t,r];for(;s.length;){const t=s.pop(),r=s.pop();if(t-r<=n)continue;const a=r+Math.ceil((t-r)/n/2)*n;i.quickselect(e,a,r,t,o),s.push(r,a,a,t)}}const x=new o,b=new o,P=new o,M=new o({deallocator:void 0});class v{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class w extends v{constructor(){super(...arguments),this.height=1,this.indexHint=new t.PositionHint}}class S extends w{constructor(e){super(),this.children=e,this.leaf=!0}}class R extends w{constructor(e){super(),this.children=e,this.leaf=!1}}e.BBox=v,e.PooledRBush=class{constructor(e=9,t){this._compareMinX=u,this._compareMinY=d,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),x.prune(),b.prune(),P.prune(),M.prune()}all(e){s(this._data,e)}search(e,t){let r=this._data;const n=this._toBBox;if(g(e,r))for(x.clear();r;){for(let o=0,i=r.children.length;o<i;o++){const i=r.children[o],a=r.leaf?n(i):i;g(e,a)&&(r.leaf?t(i):y(e,a)?s(i,t):x.push(i))}r=x.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!g(e,t))return!1;for(x.clear();t;){for(let n=0,o=t.children.length;n<o;n++){const o=t.children[n],i=t.leaf?r(o):o;if(g(e,i)){if(t.leaf||y(e,i))return!0;x.push(o)}}t=x.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new S([]),this}remove(e){if(!e)return this;let n,o=this._data,i=null,s=0,a=!1;const c=this._toBBox(e);for(P.clear(),M.clear();o||P.length>0;){if(o||(o=P.pop(),i=P.data[P.length-1],s=M.pop()??0,a=!0),o.leaf&&(n=t.indexOf(o.children,r.toConst(e),o.children.length,o.indexHint),-1!==n))return o.children.splice(n,1),P.push(o),this._condense(P),this;a||o.leaf||!y(o,c)?i?(s++,o=i.children[s],a=!1):o=null:(P.push(o),M.push(s),s=0,i=o,o=o.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,n){const o=r-t+1;let i=this._maxEntries;if(o<=i){const n=new S(e.slice(t,r+1));return a(n,this._toBBox),n}n||(n=Math.ceil(Math.log(o)/Math.log(i)),i=Math.ceil(o/i**(n-1)));const s=new R([]);s.height=n;const c=Math.ceil(o/i),l=c*Math.ceil(Math.sqrt(i));_(e,t,r,l,this._compareMinX);for(let o=t;o<=r;o+=l){const t=Math.min(o+l-1,r);_(e,o,t,c,this._compareMinY);for(let r=o;r<=t;r+=c){const o=Math.min(r+c-1,t);s.children.push(this._build(e,r,o,n-1))}}return a(s,this._toBBox),s}_insert(e,t,r){const n=this._toBBox,o=r?e:n(e);P.clear();const i=function(e,t,r,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==r;){let r,n=1/0,o=1/0;for(let i=0,s=t.children.length;i<s;i++){const s=t.children[i],a=p(s),c=m(e,s)-a;c<o?(o=c,n=a<n?a:n,r=s):c===o&&a<n&&(n=a,r=s)}t=r||t.children[0]}return t}(o,this._data,t,P);for(i.children.push(e),l(i,o);t>=0&&P.data[t].children.length>this._maxEntries;)this._split(P,t),t--;!function(e,t,r){for(let n=r;n>=0;n--)l(t.data[n],e)}(o,P,t)}_split(e,t){const r=e.data[t],n=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,n);const i=this._chooseSplitIndex(r,o,n);if(!i)return;const s=r.children.splice(i,r.children.length-i),c=r.leaf?new S(s):new R(s);c.height=r.height,a(r,this._toBBox),a(c,this._toBBox),t?e.data[t-1].children.push(c):this._splitRoot(r,c)}_splitRoot(e,t){this._data=new R([e,t]),this._data.height=e.height+1,a(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let n,o,i;n=o=1/0;for(let s=t;s<=r-t;s++){const t=c(e,0,s,this._toBBox),a=c(e,s,r,this._toBBox),l=f(t,a),u=p(t)+p(a);l<n?(n=l,i=s,o=u<o?u:o):l===n&&u<o&&(o=u,i=s)}return i}_chooseSplitAxis(e,t,r){const n=e.leaf?this._compareMinX:u,o=e.leaf?this._compareMinY:d;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,o)&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);const o=this._toBBox,i=c(e,0,t,o),s=c(e,r-t,r,o);let a=h(i)+h(s);for(let n=t;n<r-t;n++){const t=e.children[n];l(i,e.leaf?o(t):t),a+=h(i)}for(let n=r-t-1;n>=t;n--){const t=e.children[n];l(s,e.leaf?o(t):t),a+=h(s)}return a}_condense(e){for(let r=e.length-1;r>=0;r--){const n=e.data[r];if(0===n.children.length)if(r>0){const o=e.data[r-1],i=o.children;i.splice(t.indexOf(i,n,i.length,o.indexHint),1)}else this.clear();else a(n,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},e.cleanupPooledRBush=function(){x.prune(),b.prune(),P.prune(),M.prune()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports"],function(e){"use strict";function t(e,n,o,i,s){for(;i>o;){if(i-o>600){var a=i-o+1,c=n-o+1,l=Math.log(a),u=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*u*(a-u)/a)*(c-a/2<0?-1:1);t(e,n,Math.max(o,Math.floor(n-c*u/a+d)),Math.min(i,Math.floor(n+(a-c)*u/a+d)),s)}var p=e[n],h=o,m=i;for(r(e,o,n),s(e[i],p)>0&&r(e,o,i);h<m;){for(r(e,h,m),h++,m--;s(e[h],p)<0;)h++;for(;s(e[m],p)>0;)m--}0===s(e[o],p)?r(e,o,m):r(e,++m,i),m<=n&&(o=m+1),n<=m&&(i=m-1)}}function r(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function n(e,t){return e<t?-1:e>t?1:0}e.quickselect=function(e,r,o,i,s){t(e,r,o||0,i||e.length-1,s||n)}})},"esri/layers/support/MediaElementView":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/Polygon","../../geometry/projectionUtils","../../geometry/support/aaBoundingRect","../../geometry/support/normalizeUtilsSync"],function(e,t,r,n,o,i,s,a,c,l,u,d){"use strict";e.MediaElementView=class extends r{constructor(e){super(e)}get bounds(){const e=this.coords;return null==e?.extent?null:u.fromExtent(e.extent)}get coords(){const e=this.element.georeference?.coords;return l.projectOrLoad(e,this.spatialReference).geometry}get normalizedCoords(){return c.fromJSON(d.normalizeCentralMeridianSync(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?u.fromExtent(e):null}},t.__decorate([n.property()],e.MediaElementView.prototype,"spatialReference",void 0),t.__decorate([n.property()],e.MediaElementView.prototype,"element",void 0),t.__decorate([n.property()],e.MediaElementView.prototype,"bounds",null),t.__decorate([n.property()],e.MediaElementView.prototype,"coords",null),t.__decorate([n.property()],e.MediaElementView.prototype,"normalizedCoords",null),t.__decorate([n.property()],e.MediaElementView.prototype,"normalizedBounds",null),e.MediaElementView=t.__decorate([a.subclass("esri.layers.support.MediaElementView")],e.MediaElementView),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsSync":function(){define(["exports","../../core/support/jsonUtils","./aaBoundingRect","./boundsUtils","./coordsUtils","./jsonUtils","./normalizeUtilsCommon","./spatialReferenceUtils"],function(e,t,r,n,o,i,s,a){"use strict";function c(e,r){if(null==e)return null;const o=e.spatialReference,c=a.getInfo(o),p=t.isSerializable(e)?e.toJSON():e;if(!c)return p;const y=a.isWebMercator(o)?102100:4326,g=s.cutParams[y].maxX,_=s.cutParams[y].minX;if(i.isPoint(p))return l(p,g,_);if(i.isMultipoint(p))return p.points=p.points.map(e=>l(e,g,_)),p;if(i.isExtent(p))return function(e,t){if(!t)return e;const r=function(e,t){const r=[],{ymin:n,ymax:o,xmin:i,xmax:s}=e,a=e.xmax-e.xmin,[c,l]=t.valid,{x:p,frameId:h}=u(e.xmin,t),{x:f,frameId:y}=u(e.xmax,t),g=p===f&&a>0;if(a>2*l){const e={xmin:i<s?p:f,ymin:n,xmax:l,ymax:o},t={xmin:c,ymin:n,xmax:i<s?f:p,ymax:o},a={xmin:0,ymin:n,xmax:l,ymax:o},u={xmin:c,ymin:n,xmax:0,ymax:o},g=[],_=[];d(e,a)&&g.push(h),d(e,u)&&_.push(h),d(t,a)&&g.push(y),d(t,u)&&_.push(y);for(let e=h+1;e<y;e++)g.push(e),_.push(e);r.push(new m(e,[h]),new m(t,[y]),new m(a,g),new m(u,_))}else p>f||g?r.push(new m({xmin:p,ymin:n,xmax:l,ymax:o},[h]),new m({xmin:c,ymin:n,xmax:f,ymax:o},[y])):r.push(new m({xmin:p,ymin:n,xmax:f,ymax:o},[h]));return r}(e,t).map(e=>e.extent);return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}}(p,c);if(i.isPolygon(p)||i.isPolyline(p)){const e=n.getBoundsXY(f,p),t={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},o=s.offsetMagnitude(t.xmin,_)*(2*g),i=0===o?p:s.updatePolyGeometry(p,o);return t.xmin+=o,t.xmax+=o,t.xmax>g?h(i,g,r):t.xmin<_?h(i,_,r):i}return p}function l(e,t,r){if(Array.isArray(e)){const n=e[0];if(n>t){const r=s.offsetMagnitude(n,t);e[0]=n+r*(-2*t)}else if(n<r){const t=s.offsetMagnitude(n,r);e[0]=n+t*(-2*r)}}else{const n=e.x;if(n>t){const r=s.offsetMagnitude(n,t);e.x+=r*(-2*t)}else if(n<r){const t=s.offsetMagnitude(n,r);e.x+=t*(-2*r)}}return e}function u(e,t){const[r,n]=t.valid,o=2*n;let i,s=0;return e>n?(i=Math.ceil(Math.abs(e-n)/o),e-=i*o,s=i):e<r&&(i=Math.ceil(Math.abs(e-r)/o),e+=i*o,s=-i),{x:e,frameId:s}}function d(e,t){const{xmin:r,ymin:n,xmax:o,ymax:i}=t;return p(e,r,n)&&p(e,r,i)&&p(e,o,i)&&p(e,o,n)}function p(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function h(e,t,r=!0){const n=!i.isPolyline(e);if(n&&o.closeRings(e),r)return(new y).cut(e,t);const s=n?e.rings:e.paths,a=n?4:2,c=s.length,l=-2*t;for(let e=0;e<c;e++){const t=s[e];if(t&&t.length>=a){const e=[];for(const r of t)e.push([r[0]+l,r[1]]);s.push(e)}}return n?e.rings=s:e.paths=s,e}class m{constructor(e,t){this.extent=e,this.frameIds=t}}const f=r.create();class y{constructor(){this._linesIn=[],this._linesOut=[]}cut(e,t){let r;if(this._xCut=t,e.rings)this._closed=!0,r=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,r=e.paths,this._minPts=2}for(const e of r){if(!e||e.length<this._minPts)continue;let t=!0;for(const r of e)t?(this.moveTo(r),t=!1):this.lineTo(r);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),r=[];for(const e of this._linesIn)e&&e.length>=this._minPts&&r.push(e);const n=-2*this._xCut;for(const e of this._linesOut)if(e&&e.length>=this._minPts){for(const t of e)t[0]+=n;r.push(e)}return this._closed?e.rings=r:e.paths=r,e}moveTo(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}lineTo(e){const t=this._side(e[0]);if(t*this._prevSide===-1){const r=this._intersect(this._prevPt,e);this._lineTo(this._xCut,r,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}close(){const e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(e,t,r){this._closed?(this._lineIn.push([r<=0?e:this._xCut,t]),this._lineOut.push([r>=0?e:this._xCut,t])):(r<=0&&this._lineIn.push([e,t]),r>=0&&this._lineOut.push([e,t]))}_lineTo(e,t,r){this._closed?(g(this._lineIn,r<=0?e:this._xCut,t),g(this._lineOut,r>=0?e:this._xCut,t)):r<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):r>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}_checkClosingPt(e){const t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}_side(e){return e<this._xCut?-1:e>this._xCut?1:0}_intersect(e,t){const r=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+r*(t[1]-e[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function g(e,t,r){const n=e.length;n>1&&e[n-1][0]===t&&e[n-2][0]===t?e[n-1][1]=r:e.push([t,r])}e.CutVertical=y,e.normalizeCentralMeridianForDisplay=function(e){return c(e,!1)},e.normalizeCentralMeridianSync=function(e){return c(e,!0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/VideoElement":function(){define(["exports","../../chunks/tslib.es6","../../request","../../core/Error","../../core/Logger","../../core/mathUtils","../../core/sanitizerUtils","../../core/urlUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./MediaElementBase","./mediaUtils","./videoUtils","../../support/mediaLayerUtils","../../chunks/persistableUrlUtils"],function(e,t,r,n,o,i,s,a,c,l,u,d,p,h,m,f,y,g){"use strict";var _;const x=Symbol("canplay");return e.default=class extends h{static{_=y.VideoElementSymbol}constructor(e){super(e),this.autoplay=!0,this.content=null,this.type="video",this[_]=!0}load(){const e=this.video;return"string"==typeof e?this.addResolvingPromise(this._preProcessVideoUrl(e).then(async e=>{const t=document.createElement("video");return t.src=s.renderingSanitizer.sanitizeUrl(a.makeAbsolute(e)),t.crossOrigin="anonymous",t.autoplay=this.autoplay,t.muted=!0,t.loop=!0,t.playsInline=!0,this._loadVideo(t).then(()=>{this._set("content",t)})})):e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then(()=>{this._set("content",e)})):this.addResolvingPromise(Promise.reject(new n("video-element:invalid-video-type","Invalid video type",{video:e}))),Promise.resolve(this)}get contentWidth(){return this.content?.videoWidth??0}get contentHeight(){return this.content?.videoHeight??0}get currentTime(){return this.content?.currentTime}set currentTime(e){if(!this.content)return;const t=i.clamp(e,0,this.content.duration);"fastSeek"in this.content?this.content.fastSeek(t):this.content.currentTime=t,this.content.play().then(()=>{this.content?.pause()}).catch(()=>{})}get duration(){return this.content?.duration}set video(e){"not-loaded"===this.loadStatus?this._set("video",e):o.getLogger(this).error("#video","video cannot be changed after the element is loaded.")}writeVideo(e,t,r,o){if(!e)return void(o?.messages&&o.messages.push(new n("video-element:unsupported-video","video source is missing")));const i=function(e){return"string"==typeof e&&!a.isDataProtocol(e)&&!a.isBlobProtocol(e)}(e)?e:null;if(!i)return void(o?.messages&&o.messages.push(new n("video-element:unsupported-video","video source must be an absolute url")));!a.isAbsolute(i)&&o?.blockedRelativeUrls&&o.blockedRelativeUrls.push(i);const s=a.makeAbsolute(i);g.itemIdFromResourceUrl(s)?o?.messages&&o.messages.push(new n("video-element:unsupported-video","video source cannot be an item resource")):t[r]=s}async _preProcessVideoUrl(e){if(a.getProxyRule(e))return a.addProxy(e);try{return await r(e,{method:"head"}),e}catch{try{return a.addProxy(e,!0)}catch{return e}}}async _loadVideo(e){"anonymous"!==e.crossOrigin&&(e.crossOrigin="anonymous",a.isBlobProtocol(e.src)||(e.src=e.src));try{await f.whenVideoPlayable(e,e=>this.addHandles(e,x)),this.autoplay&&await e.play().catch(e=>{throw console.error(e),e})}finally{this.removeHandles(x)}}},t.__decorate([c.property()],e.default.prototype,"autoplay",void 0),t.__decorate([c.property({readOnly:!0})],e.default.prototype,"content",void 0),t.__decorate([c.property({readOnly:!0})],e.default.prototype,"contentWidth",null),t.__decorate([c.property({readOnly:!0})],e.default.prototype,"contentHeight",null),t.__decorate([c.property({type:Number})],e.default.prototype,"currentTime",null),t.__decorate([c.property({type:Number})],e.default.prototype,"duration",null),t.__decorate([c.property(m.mediaElementUrlProperty)],e.default.prototype,"video",null),t.__decorate([p.writer("video")],e.default.prototype,"writeVideo",null),t.__decorate([c.property(m.mediaTypeProperty)],e.default.prototype,"type",void 0),e.default=t.__decorate([d.subclass("esri.layers.support.VideoElement")],e.default),e.default})},"esri/layers/support/videoUtils":function(){define(["exports","../../core/events"],function(e,t){"use strict";e.whenVideoPlayable=function(e,r){return new Promise((n,o)=>{e.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?n():(r(t.once(e,"canplay",n)),r(t.once(e,"error",o)))})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["require","../chunks/tslib.es6","../core/Collection","../core/Error","../core/Logger","../core/MultiOriginJSONSupport","../core/promiseUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./Layer","./mixins/BlendLayer","./mixins/OperationalLayer","./mixins/PortalLayer","./mixins/ScaleRangeLayer","./support/ControlPointsGeoreference","./support/ImageElement","./support/LocalMediaElementSource","./support/mediaUtils","./support/VideoElement","../support/mediaLayerUtils"],function(e,t,r,n,o,i,s,a,c,l,u,d,p,h,m,f,y,g,_,x,b,P,M,v,w){"use strict";let S=class extends(f.BlendLayer(_.ScaleRangeLayer(y.OperationalLayer(g.PortalLayer(i.MultiOriginJSONMixin(m)))))){constructor(t){super(t),this.effectiveSource=null,this.georeference=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this._debouncedSaveOperations=s.debounce(async(t,r,n)=>{const{save:o,saveAs:i}=await new Promise((t,r)=>e(["./save/mediaLayerUtils"],t,r));switch(t){case 0:return o(this,r);case 1:return i(this,n,r)}}),this.source=new P}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}async _doLoad(e){await this.loadFromPortal({supportedTypes:["Media Layer"]},e);let t=this.source;if(!t)throw new n("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer.");const o=this._getSourceOverride(t,this.georeference);o&&(this.setAtOrigin("source",o,"web-map"),this.setAtOrigin("source",o,"web-scene"),t=o);const i=w.isMediaElement(t)?new P({elements:new r([t])}):t;this._set("effectiveSource",i),this.spatialReference&&(i.spatialReference=this.spatialReference),await i.load(e),this.spatialReference=i.spatialReference}destroy(){this.effectiveSource?.destroy(),this.effectiveSource!==this.source&&this.source?.destroy()}readGeoreference(e,t){return e&&"itemId"in t&&t.itemId?e:void 0}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}get loaded(){return super.loaded}get source(){return this._get("source")}set source(e){"loaded"!==this.loadStatus&&"failed"!==this.loadStatus?this._set("source",e):o.getLogger(this).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)?new P({elements:new r(e)}):e instanceof r?new P({elements:e}):e:null}readSource(e,t,r){if("itemId"in t&&t.itemId)return;const n=this._createSource(t);return n?.read(t,r),n}writeSource(e,t,r,o){if(e&&e instanceof P){const t=e.elements.length;if(1!==t)return void(o?.messages&&o.messages.push(new n("media-layer:unsupported-source",`local media element source can only be persisted if it contains exactly one ImageElement, but it has ${t}.`)));e=e.elements.at(0)}w.isMediaElement(e)?e.write(t,o):o?.messages&&(e?o.messages.push(new n("media-layer:unsupported-source","only media elements of type 'ImageElement' or 'VideoElement' can be persisted")):o.messages.push(new n("media-layer:unsupported-source","the media layer is missing a source")))}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}_createSource(e){if("mediaType"in e)switch(e.mediaType){case"image":return new b;case"video":return new v}return null}_getSourceOverride(e,t){if(w.isMediaElement(e)&&3===this.originIdOf("source")&&t&&(5===this.originIdOf("georeference")||4===this.originIdOf("georeference"))){const r=e.toJSON(),n=this._createSource(r);return n.read({...r},{origin:"portal-item"}),n.read({georeference:t},{origin:"web-map"}),n.read({georeference:t},{origin:"web-scene"}),n}return null}};return t.__decorate([a.property({readOnly:!0})],S.prototype,"effectiveSource",void 0),t.__decorate([a.property({readOnly:!0,json:{read:!1,write:!1,origins:{"web-document":{read:!0}}}})],S.prototype,"georeference",void 0),t.__decorate([d.reader("web-document","georeference")],S.prototype,"readGeoreference",null),t.__decorate([a.property({type:String})],S.prototype,"copyright",void 0),t.__decorate([a.property({readOnly:!0})],S.prototype,"fullExtent",null),t.__decorate([a.property({type:["MediaLayer"]})],S.prototype,"operationalLayerType",void 0),t.__decorate([a.property({type:["show","hide"]})],S.prototype,"listMode",void 0),t.__decorate([a.property({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1,target:{url:{type:String},mediaType:{type:["image","video"]},georeference:{type:x}},overridePolicy(e,t,r){return{enabled:!0,allowNull:!1,ignoreOrigin:M.isWritingLayerFromItemToWebDocument(this,r?.origin)&&w.isMediaElement(e)&&!!e.georeference&&e.originIdOf("georeference")>3}}}}})],S.prototype,"source",null),t.__decorate([c.cast("source")],S.prototype,"castSource",null),t.__decorate([d.reader("source",["url"])],S.prototype,"readSource",null),t.__decorate([h.writer("source")],S.prototype,"writeSource",null),t.__decorate([a.property()],S.prototype,"spatialReference",void 0),t.__decorate([a.property({readOnly:!0})],S.prototype,"type",void 0),S=t.__decorate([p.subclass("esri.layers.MediaLayer")],S),S});