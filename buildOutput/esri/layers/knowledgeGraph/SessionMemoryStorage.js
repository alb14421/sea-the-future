// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../geometry/support/jsonUtils","../graphics/featureConversionUtils","../graphics/OptimizedFeature","./constants"],function(e,t,r,i){"use strict";class s{constructor(){this._featureLookup=new Map}static getInstance(){return s.instance||(s.instance=new s),s.instance}static resetInstance(){s.instance&&(s.instance=null)}deleteFromStore(e){e.forEach(e=>{this._featureLookup.delete(e)})}readFromStoreByList(e){const t=[];return e.forEach(e=>{const r=this.readFromStoreById(e);r&&t.push(r)}),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(s,o,n){const p=[];return s.forEach(s=>{if(!s?.id)return;s.properties||(s.properties=[]);let a,u=null;if(n&&s.properties[n]&&(u=t.convertFromGeometry(s.properties[n])),"originId"in s&&"destinationId"in s&&(s.properties[i.systemOriginIdFieldName]=s.originId,s.properties[i.systemDestinationIdFieldName]=s.destinationId),s.properties[o]=s.id,s.id&&this._featureLookup.has(s.id)&&this._featureLookup.get(s.id).attributes){const t=this._featureLookup.get(s.id),i=JSON.parse(JSON.stringify(Object.assign(t.attributes,s.properties)));n&&s.properties[n]&&(i[n]=e.fromJSON(s.properties[n])),a=new r.OptimizedFeature(u?JSON.parse(JSON.stringify(u)):t?.geometry?JSON.parse(JSON.stringify(t.geometry)):null,i,null,s.properties[o])}else a=new r.OptimizedFeature(u?JSON.parse(JSON.stringify(u)):null,s.properties,null,s.properties[o]);this._featureLookup.set(`${s.typeName?`${s.typeName}__${s.id}`:s.id}`,a),p.push(a)}),p}}return s});