// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../Color","../support/LabelClass","../support/LabelExpressionInfo","../../rest/knowledgeGraphService","../../symbols/CIMSymbol","../../symbols/TextSymbol"],function(e,n,a,o,l,t,r){"use strict";const i={initializeLayersFromClientData:async(e,n,a)=>{if(n||(n=[...e.layers,...e.tables].map(e=>e.graphTypeName)),0===n?.length)return;const o=new Map;for(const a of n)o.set(a,s(e,a));const t=await l.fetchClientDataAtKeys(e.dataManager.knowledgeGraph,Array.from(o.values()),{requestOptions:{signal:a?.signal}});for(const n of[...e.layers,...e.tables]){const a=n.objectType.name;if(null==a)continue;const o=t.get(s(e,a));if(o){const e=JSON.parse(o);null===e||"object"!=typeof e||e.hasOwnProperty("showLabels")||(e.showLabels=!1),n.read(e,{origin:"service"})}}}},s=(e,n)=>"knowledge-graph"===e.type?`${n}/Map`:`${n}/LinkChart/LinkChartSubLayer`,b=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],c="#8f8f82";e.fallbackKGSublayerSymbolHexColor=c,e.getDefaultLCRelationshipSublayerSymbol=function(e){const n=e.toArray();return new t({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:n},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:n}]}}]}]}}})},e.getDisplayLabelProperty=function(e){let n="ESRI__ID",a=4;for(const o of e)if(o.name){if("name"===o.name.toLowerCase()){n=o.name;break}o.name.toLowerCase().includes("name")?(n=o.name,a=2):"esriFieldTypeString"===o.fieldType&&a>3&&(n=o.name,a=3)}return n},e.getKGSublayerSymbolColor=function(e){return new n(e<0||e>=b.length?c:b[e])},e.getLinkChartDefaultLabelingInfo=function(e,n,l){const t={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},i=new a({labelExpressionInfo:new o({expression:"ESRI__ID"===l?`${n}`:`$feature.${l}`}),labelPlacement:"above-center",symbol:new r(t)}),s=new a({labelExpressionInfo:new o({expression:`'${n}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new r({...t,yoffset:"12px"})});return"entity"===e?[i]:[s]},e.getMapDefaultLabelingInfo=function(e,n,l){const t={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},i="ESRI__ID"===l?`${e}`:`$feature.${l}`;return"point"===n?[new a({labelExpressionInfo:new o({expression:i}),labelPlacement:"above-center",symbol:new r(t)})]:"polyline"===n?[new a({labelExpressionInfo:new o({expression:i}),labelPlacement:"center-along",repeatLabel:!0,symbol:new r(t)})]:"polygon"===n?[new a({labelExpressionInfo:new o({expression:i}),labelPlacement:"always-horizontal",symbol:new r(t)})]:null},e.initializeLayersFromClientData=async function(e,n,a){return i.initializeLayersFromClientData(e,n,a)},e.layerUtils=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});