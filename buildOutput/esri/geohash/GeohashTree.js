// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./GeohashCell"],function(t,e){"use strict";t.GeohashTree=class{constructor(t){this._fields=t,this._size=0,this._depth=0,this._root=e.GeohashCell.create(this._fields,0,0,0)}destroy(){}get size(){return this._size}get depth(){return this._depth}find(t,e,s){return this._root.find(t,e,s,0,0,0)}insert(t,s,o,h,i,n,l){let r=this._root,d=0,c=0,a=0;for(;null!==r;){if(r.insert(t,s,o,h,i,l),d>=n)return;const u=Math.ceil((d+1)/2),f=Math.floor((d+1)/2),x=1-d%2,_=30-(3*u+2*f),p=30-(2*u+3*f),M=(h&7*x+3*(1-x)<<_)>>_,g=(i&3*x+7*(1-x)<<p)>>p,m=M+g*(8*x+4*(1-x));c=c<<3*x+2*(1-x)|M,a=a<<2*x+3*(1-x)|g,null==r.children[m]&&(r.children[m]=e.GeohashCell.create(this._fields,c,a,d+1),this._depth=Math.max(this._depth,d+1),this._size+=1),d+=1,r=r.children[m]}}putBins(t,e){for(const s of this.getNodes(e)){const e=t.get(s.id);e?e.merge(s):t.set(s.id,s.clone())}}getNodes(t){const e=[],{geohashBounds:s,level:o}=t;let h=this._root;for(;null!==h;){const t=h.depth,i=h.xNode,n=h.yNode;if(t>=o){e.push(h),h=h.next;continue}const l=Math.ceil((t+1)/2),r=Math.floor((t+1)/2),d=1-t%2,c=30-(3*l+2*r),a=30-(2*l+3*r),u=~((1<<c)-1),f=~((1<<a)-1),x=(s.xLL&u)>>c,_=(s.yLL&f)>>a,p=(s.xTR&u)>>c,M=(s.yTR&f)>>a,g=i<<3*d+2*(1-d),m=n<<2*d+3*(1-d),y=g+8*d+4*(1-d),z=m+4*d+8*(1-d),G=Math.max(g,x),L=Math.max(m,_),N=Math.min(y,p),T=Math.min(z,M);let C=null,b=null;for(let t=L;t<=T;t++)for(let e=G;e<=N;e++){const s=e-g+(t-m)*(8*d+4*(1-d)),o=h.children[s];o&&(C||(C=o,C.next=h.next),b&&(b.next=o),b=o,o.next=h.next)}h=C||h.next}return e}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});