// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../core/Error","../../geometry/support/scaleUtils","../../renderers/visualVariables/SizeVariable","../../renderers/visualVariables/support/SizeStop","../statistics/spatialStatistics","../support/binningUtils","../support/adapters/support/layerUtils"],function(e,i,t,a,n,r,s){"use strict";const o=[{size:10,width:0},{size:20,width:.5},{size:80,width:1},{size:250,width:2}];return async function(l){const{layerAdapter:u,...p}=await async function(i){const{view:t}=i;if(!(i&&t&&i.layer))throw new e("outline:missing-parameters","'view' and 'layer' parameters are required");i.forBinning&&r.verifyBinningParams(i,"outline");const{layer:a,...n}=i,o=i.forBinning?s.binningCapableLayerTypes:s.featureCapableLayerTypes,l=s.createLayerAdapter(a,o,i.forBinning);if(!l)throw new e("outline:invalid-parameters","'layer' must be one of these types: "+s.getLayerTypeLabels(o).join(", "));const u={layerAdapter:l,...n,view:t};await t.when();const p=null!=u.signal?{signal:u.signal}:null;if(await l.load(p),"polygon"!==l.geometryType)throw new e("outline:not-supported",`outline is not supported for geometryType: ${l.geometryType}`);return u}(l),y=await u.getSampleFeatures({sampleSize:-1,returnGeometry:!0,...p},"json");if(!y?.length)throw new e("outline:insufficient-info","No features are available to calculate statistics");const c=await n({features:y,geometryType:u.geometryType});if(!(c&&"avgSize"in c&&c.avgSize))throw new e("outline:insufficient-info","average polygon size is invalid");return function(e,n){const r=e.avgSize,s=i.getScaleForResolution(1,n.spatialReference),l=o.map(e=>new a({size:e.width,value:Math.round(r/e.size*s)}));return l.sort((e,i)=>e.value-i.value),{visualVariables:[new t({target:"outline",valueExpression:"$view.scale",stops:l})],opacity:.25}}({...c,avgSize:c.avgSize},p.view)}});