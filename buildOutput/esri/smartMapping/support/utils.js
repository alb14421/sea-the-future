// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../intl/date","../../layers/support/fieldUtils","../../support/basemapUtils","../../support/loadArcade","../../time/constants","../../time/timeZoneUtils"],function(t,e,n,o,i,r,a){"use strict";const s={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},d=new Set(["integer","small-integer"]);let m=null;function u(t){return String(t).padStart(2,"0")}function f(t,e,n){let o;return"date"===e||"number"===e?("number"===e&&(t=new Date(t)),o=`TIMESTAMP'${n?t.getFullYear():t.getUTCFullYear()}-${u((n?t.getMonth():t.getUTCMonth())+1)}-${u(n?t.getDate():t.getUTCDate())} ${u(n?t.getHours():t.getUTCHours())}:${u(n?t.getMinutes():t.getUTCMinutes())}:${u(n?t.getSeconds():t.getUTCSeconds())}'`):o=t,o}function c(t,e){if(e instanceof Date)return"date";if("number"==typeof e)return"number";if("string"==typeof e){const o=t.getField(e);if("<now>"===e.toLowerCase())return;if(n.isDateField(o))return"field"}}t.castIntegerFieldToFloat=function(t){return`cast(${t} as float)`},t.dateTypes=["date","date-only","timestamp-offset"],t.defaultBasemapGroups=s,t.defaultStatisticTypes={exclude:["median"]},t.fieldDelimiter=",",t.formatAnyDate=function(t,n){const{format:o,timeZoneOptions:i,fieldType:s}=n??{};let l,d;if(i&&({timeZone:l,timeZoneName:d}=a.getTimeZoneFormattingOptions(i.layerTimeZone,i.datesInUnknownTimezone,i.viewTimeZone,e.convertDateFormatToIntlOptions(o||"short-date-short-time"),s)),"string"==typeof t&&isNaN(Date.parse("time-only"===s?`1970-01-01T${t}Z`:t)))return t;switch(s){case"date-only":{const n=e.convertDateFormatToIntlOptions(o||"short-date");return"string"==typeof t?e.formatDateOnly(t,{...n}):e.formatDate(t,{...n,timeZone:r.utc})}case"time-only":{const n=e.convertDateFormatToIntlOptions(o||"short-time");return"string"==typeof t?e.formatTimeOnly(t,n):e.formatDate(t,{...n,timeZone:r.utc})}case"timestamp-offset":{if(!l&&"string"==typeof t&&new Date(t).toISOString()!==t)return t;const n=o||i?e.convertDateFormatToIntlOptions(o||"short-date-short-time"):void 0,r=n?{...n,timeZone:l,timeZoneName:d}:void 0;return"string"==typeof t?e.formatTimestamp(t,r):e.formatDate(t,r)}default:{const n=o||i?e.convertDateFormatToIntlOptions(o||"short-date-short-time"):void 0;return e.formatDate("string"==typeof t?new Date(t):t,n?{...n,timeZone:l,timeZoneName:d}:void 0)}}},t.getBasemapGroup=function(t,e=s){for(const n in e)if(e[n].includes(t))return n},t.getBasemapId=function(t,e,n=!0){let i=null;return t&&("string"==typeof t?e.includes(t)&&(i=t):i=o.getWellKnownBasemapId(t)),n?i||"gray":i},t.getDateDiffSQL=function(t,e,n,o){const{hasQueryEngine:i}=t,r=`(${f(n,c(t,n),i)} - ${f(e,c(t,e),i)})`;let a=l[o],s="/";return a<1&&(a=1/a,s="*"),{sqlExpression:1===a?r:`(${r} ${s} ${a})`,sqlWhere:null}},t.getDateType=c,t.getFieldsList=async function(t){const{field:e,field2:n,field3:o,normalizationField:r,valueExpression:a}=t;let s=[];if(a){if(!m){const{arcadeUtils:t}=await i.loadArcade();m=t}s=m.extractFieldNames(a)}return e&&s.push(e),n&&s.push(n),o&&s.push(o),r&&s.push(r),s},t.getNormalizationType=function(t){let e=t.normalizationType;return e||(t.normalizationField?e="field":null!=t.normalizationTotal&&(e="percent-of-total")),e??void 0},t.isAnyDateField=function(t){return n.isDateField(t)||n.isDateOnlyField(t)||n.isTimestampOffsetField(t)},t.isIntegerField=function(t,e){const n=e&&t.getField(e);return!!n&&d.has(n.type)},t.unitValueInDays=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});