// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/arrayUtils","../../core/MD5","../../renderers/visualVariables/support/sizeVariableUtils","../popup/support/utils","./utils"],function(n,e,t,i,l,o){"use strict";function r(n,e){const l=function(n){if(!n)return null;const{field:e,valueExpression:t,normalizationField:l,normalizationType:r,normalizationTotal:a}=n;let u=null;if(t)u=t;else if(e){const n=o.getNormalizationType({normalizationType:r,normalizationField:l,normalizationTotal:a});if(n){const t=n.toLowerCase();if(u=e.toLowerCase()+",norm:"+t,l)u+=","+l.toLowerCase();else if("percent-of-total"===t){let n=a;i.isValidNumber(n)&&0!==n||(n=null),u+=","+n}}}return u}(n),r=null!=l?function(n){return t.createMD5Hash(n)}(l):n.field;return`${e}_${r}`}function a(n,e){const t=e.getField(n);return t?.type}function u(n,e){const t="field"in e?e.field:null,i=t?a(t,n):null;return{field:t,fieldType:null!=i?i:null,valueExpression:"valueExpression"in e?e.valueExpression:null,valueExpressionTitle:"valueExpressionTitle"in e?e.valueExpressionTitle:null,normalizationField:"normalizationField"in e?e.normalizationField:null,normalizationType:"normalizationType"in e?e.normalizationType:null,normalizationTotal:"normalizationTotal"in e?e.normalizationTotal:null}}function s(n,e){const t="rotation"===e.type?e.rotationType:null,i=e.legendOptions?.title,l=e.field,o=l?a(l,n):null;return{field:l,fieldType:null!=o?o:null,rotationType:t,valueExpression:e.valueExpression,valueExpressionTitle:e.valueExpressionTitle||e.valueExpression&&i,normalizationField:"normalizationField"in e?e.normalizationField:null,vvType:e.type}}function p(n){return n?n.replaceAll('"','\\"'):""}function f(n,e){const t=[r(n,e)];return"date"===n.fieldType&&t.push(n.fieldType.toLowerCase()),n.rotationType&&t.push(n.rotationType.toLowerCase()),t.join("_")}function c(n,e){return{statisticHash:f(n,e),attributeInfo:n,statisticType:e}}n.clusterCountField="cluster_count",n.getClusterField=function(n,e){return`cluster_${r(n,e)}`},n.getClusterFieldHash=function(n,e){return n.split(`cluster_${e}_`).pop()},n.getPredominantTypeExpression=function(n,e,t){return`\n  var uvInfos = [${function(n){return n.map(n=>`{\n        "value": "${String(n.value)}",\n        "label": "${p(String(n.label))}"\n      }`)}(n).join(", ")}];\n  var predominantType = Text($feature["${e}"]);\n  var label = "${p(t)}";\n\n  for (var i = 0; i < Count(uvInfos); i++) {\n    if (uvInfos[i].value == predominantType) {\n      label = uvInfos[i].label;\n      break;\n    }\n  }\n\n  return label;\n  `},n.getRendererAttributeInfo=u,n.getStatisticId=r,n.getStatisticInfo=c,n.getStatisticInfos=function(n,t,i=!0){const o=[],r=u(n,t);"class-breaks"===t.type?o.push(c(r,"avg")):"unique-value"===t.type&&o.push(c(r,"type"));const a=l.getPrimaryVisualVariables(t);for(const e of a){const t=s(n,e);o.push(c(t,"avg"))}return i?e.unique(o,(n,e)=>n.statisticHash===e.statisticHash):o},n.getVariableAttributeInfo=s,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});