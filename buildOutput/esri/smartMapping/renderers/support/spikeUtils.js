// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../Color","../../../core/lang","../../../core/screenUtils","../../../symbols/CIMSymbol"],function(e,o,t,r,i){"use strict";const l="spike-height-override",n=r.px2pt(8),a=r.px2pt(20);function s(e){const{strokeColor:o,strokeWidth:t,symbolStyle:i}=e,l=i?.includes("solid-fill")||i?.includes("gradient-fill");let n=o?.toArray(),a=!1;return i?.includes("outline")&&l?a=!0:n=e.color?.toArray(),{type:"CIMSolidStroke",effects:c(i),enable:!0,colorLocked:a,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:4,width:t??r.px2pt(1),color:n}}function c(e){if(!e?.includes("closed"))return[{type:"CIMGeometricEffectAddControlPoints",angleTolerance:90,primitiveName:"spike-control-points"},{type:"CIMGeometricEffectSuppress",suppress:!0,invert:!0,primitiveName:"spike-stroke-suppress"}]}function u(e){const{color:o,symbolStyle:t}=e,r=t?.includes("solid-fill"),i=t?.includes("gradient-fill");if(!r&&!i||!o)return;if(r)return{type:"CIMSolidFill",enable:!0,colorLocked:!1,color:o?.toArray()};const l=o.clone();return l.a=0,{type:"CIMGradientFill",enable:!0,angle:90,colorRamp:{type:"CIMMultipartColorRamp",colorRamps:[{type:"CIMLinearContinuousColorRamp",fromColor:o.toArray(),toColor:l.toArray()}],weights:[1]},gradientMethod:"Linear",gradientSize:70,gradientSizeUnits:"Relative",gradientType:"Continuous"}}function f(e,o){if(!o)return;const t=e.indexOf(o);-1!==t&&e.splice(t,1)}e.createPrimitiveOverrides=function(e){const{field:o,normalizationField:t,sizeStops:r}=e,{value:i,size:n}=r[0],{value:a,size:s}=r[1];let c,u=0;return o&&(u=`$feature["${o}"]`,c=`\n      if(!HasValue($feature, "${o}")){\n        return 0;\n      }\n      $feature["${o}"];\n    `),t&&(u=`$feature["${o}"] / $feature["${t}"]`,c=`if(!HasValue($feature, "${o}") || !HasValue($feature, "${t}") || $feature["${t}"] <= 0){\n        return 0;\n      }\n      $feature["${o}"];\n      $feature["${t}"];`),[{type:"CIMPrimitiveOverride",primitiveName:l,propertyName:"Length",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Custom",expression:`\n        ${c}\n        var value = ${u};\n\n        var maxSize = ${s};\n        var minSize = ${n};\n\n        var minDataValue = ${i};\n        var maxDataValue = ${a};\n\n        var ratio = Constrain(( value - minDataValue ) / ( maxDataValue - minDataValue ), 0, 1);\n\n        var size = Constrain(maxSize * ratio, minSize, maxSize);\n        return size;\n      `,returnType:"Default"}}]},e.createSpikeSymbol=function(e){const{primitiveOverrides:o,baseWidth:t,defaultHeight:r}=e,c=function(e){const o=[s(e)],t=u(e);return t&&o.push(t),o}(e);return new i({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",effects:[{type:"CIMGeometricEffectRadial",primitiveName:l,angle:90,length:r??a},{type:"CIMGeometricEffectTaperedPolygon",fromWidth:t??n,toWidth:1,length:5}],symbolLayers:c,haloSize:1,scaleX:1,angleAlignment:"Display"},primitiveOverrides:o}})},e.defaultSpikeSymbolStyle="triangle-solid-fill-open-outline",e.updateSpikeSymbol=function(e,r){const{defaultHeight:i,baseWidth:n,color:a,strokeColor:c,primitiveOverrides:p,symbolStyle:d,strokeWidth:m}=r,y="CIMPointSymbol"===e.data.symbol?.type?e.data.symbol:null,C=y?.symbolLayers;if(!C)return e;const v=y.effects,S=v?.find(e=>"CIMGeometricEffectTaperedPolygon"===e.type),g=v?.find(e=>"CIMGeometricEffectRadial"===e.type&&e.primitiveName===l);null!=n&&S&&(S.fromWidth=n),null!=i&&g&&(g.length=i);const M=C?.find(e=>"CIMSolidStroke"===e.type),$=C?.find(e=>"CIMSolidFill"===e.type),h=C?.find(e=>"CIMGradientFill"===e.type),I="CIMMultipartColorRamp"===h?.colorRamp?.type&&"CIMLinearContinuousColorRamp"===h.colorRamp.colorRamps[0]?.type?h.colorRamp.colorRamps[0]:null;if(d){const e=$?.color??I?.fromColor??M?.color,t=a??(e?new o(e):void 0),i=M?.color??e,l=c??(i?new o(i):void 0),n=d.includes("solid-fill"),p=d.includes("gradient-fill");if(n||p||f(C,$??h),t)if(n)f(C,h),$?$.color=t?.toArray():C.push(u({...r,color:t}));else if(p)if(f(C,$),h){if(I&&a){const e=t.clone();e.a=0,I.fromColor=t.toArray(),I.toColor=e.toArray()}}else C.push(u({...r,color:t}));if(M){const e=s({...r,strokeColor:l,color:t});M.effects=e.effects,M.color=e.color,M.width=e.width,M.colorLocked=e.colorLocked}}else if(M&&(c&&(M.color=c.toArray()),null!=m&&(M.width=m)),$&&a&&($.color=a.toArray()),I&&a){const e=a.clone();e.a=0,I.fromColor=a.toArray(),I.toColor=e.toArray()}return void 0!==p&&(e.data.primitiveOverrides=t.clone(p)),e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});