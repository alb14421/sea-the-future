// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Error"],function(e,n){"use strict";function i(e,n,i){const r=e?.authoringInfo?.visualVariables;return r?.find(e=>"reference-size"===i?e.type===n&&"reference-size"===e.theme:"spike"===i?e.type===n&&"spike"===e.theme:e.type===n)}function r(e){return"color"===e.type}function t(e){return"opacity"===e.type}function a(e){return"size"===e.type&&"outline"!==e.target&&"$view.scale"!==e.valueExpression}function s(e){return"size"===e.type&&"outline"===e.target}function o(e){return"size"===e.type&&"$view.scale"===e.valueExpression&&"outline"!==e.target&&Array.isArray(e.stops)}e.findColorVVIndex=function(e){return e?.findIndex(r)??-1},e.findOpacityVVIndex=function(e){return e?.findIndex(t)??-1},e.findOutlineVVIndex=function(e){return e?.findIndex(s)??-1},e.findScaleDependentSizeVVIndex=function(e){return e?.findIndex(o)??-1},e.findSizeVVIndex=function(e){return e?.findIndex(a)??-1},e.getAuthoringInfoVisualVariable=i,e.getRendererToUpdate=async function(e){const{layer:i,forBinning:r,renderer:t}=e;await i.load();const a="featureReduction"in i?i.featureReduction:null,s=t?.clone()??(r&&"binning"===a?.type?a?.renderer?.clone():"renderer"in i?i.renderer?.clone():null);if(!s)throw new n("get-renderer-to-update:invalid-parameters","renderer not available");return s},e.getStyleType=function(e){if(!e)return null;const n=e.type,t="visualVariables"in e?e.visualVariables:null,s=t?.find(r),o=t?.find(a),u=e.authoringInfo,l=i(e,"color"),c=i(e,"size"),p=i(e,"size","reference-size"),f=i(e,"size","spike");if("class-breaks"===n){if("univariate-color-size"===u?.type)return"univariate-color-size";if(s)return o?c?.units?"color-size-age":l?.units?"color-age-size":"color-size":l?.units?"color-age":p||f?"color-size":"color-continuous";if(o)return c?.units?"size-age":"size-continuous";if(e.classBreakInfos.length>1)return"class-breaks-color"===u?.type?"color-class-breaks":"class-breaks-size"===u?.type?"size-class-breaks":null;if(p||f)return"size-continuous"}return"unique-value"===n?e.valueExpression?"predominance"===u?.type?"predominance":"relationship"===u?.type?o||p||f?"relationship-size":"relationship":o||p||f?"type-size":"type":o?c?.units?"type-size-age":"type-size":p||f?"type-size":"type":"pie-chart"===n?"pie-chart":"dot-density"===n?"dot-density":"heatmap"===n?"heatmap":null},e.hasOutlineVV=function(e){return!!e.visualVariables?.some(s)},e.hasScaleDependentSizeVV=function(e){return!!e.visualVariables?.some(o)},e.isColorVV=r,e.isOpacityVV=t,e.isOutlineVV=s,e.isScaleDependentSizeVV=o,e.isSizeVV=a,e.processRegenerateParams=async function(e,i){const{layer:r,view:t,forBinning:a,filter:s}=e;if(!r||!t)throw new n(`${i}:missing-parameters`,"'layer' and 'view' parameters are required");await r.load();const o="featureReduction"in r?r.featureReduction:null;if(a){if("binning"!==o?.type)throw new n(`${i}:invalid-parameters`,"'layer' must have 'featureReduction' property defined with 'binning' type when 'forBinning' parameter is true");if(s)throw new n(`${i}:invalid-parameters`,"'filter' parameter is not supported when 'forBinning' parameter is true")}return e},e.spliceVisualVariables=function(e,n,i){const r=e.visualVariables,t=i(r);if(!n||Array.isArray(n)&&!n.length)return;Array.isArray(n)||(n=[n]);const a=n.map(e=>e.clone());r?t>-1?r.splice(t,1,...a):r.push(...a):e.visualVariables=a},e.updateAuthoringInfoVisualVariable=function(e,n,r){const t=n?.visualVariables.find(e=>e.type===r),a=i(e,r);a&&t&&(a.minSliderValue=t.minSliderValue,a.maxSliderValue=t.maxSliderValue,"size"===r&&("reference-size"!==a.theme&&"spike"!==a.theme||(a.sizeStops=t.sizeStops?.map(e=>e.clone()),"reference-size"===a.theme&&(a.referenceSizeScale=t.referenceSizeScale))))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});