// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/Error","../../core/accessorSupport/ensureType","../../renderers/support/AuthoringInfo","../../renderers/support/AuthoringInfoVisualVariable","../../renderers/visualVariables/OpacityVariable","../../renderers/visualVariables/support/OpacityStop","../../renderers/visualVariables/support/VisualVariableLegendOptions","./support/utils","../support/binningUtils","../support/utils","../support/adapters/support/layerUtils"],function(e,i,a,l,r,s,n,t,o,u,p,d){"use strict";e.createVisualVariable=async function(e){const y=await async function(e){if(!e?.layer||!(e.field||e.valueExpression||e.sqlExpression))throw new i("opacity-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.view)throw new i("opacity-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&u.verifyBinningParams(e,"opacity-visual-variable");const a={...e,layer:e.layer},l=e.forBinning?d.binningCapableLayerTypes:d.featureCapableLayerTypes,r=d.createLayerAdapter(a.layer,l,e.forBinning);if(!r)throw new i("opacity-visual-variable:invalid-parameters","'layer' must be one of these types: "+d.getLayerTypeLabels(l).join(", "));a.layer=r;const s=null!=a.signal?{signal:a.signal}:null;await r.load(s);const n=await p.getFieldsList({field:a.field,normalizationField:a.normalizationField,valueExpression:a.valueExpression}),t=o.verifyBasicFieldValidity(r,n,"opacity-visual-variable:invalid-parameters");if(t)throw t;return a}(e);let v=null;return v=y.statistics?y.statistics:await o.getSummaryStatistics({layer:y.layer,field:y.field,valueExpression:y.valueExpression,sqlExpression:y.sqlExpression,sqlWhere:y.sqlWhere,normalizationType:y.normalizationField?"field":void 0,normalizationField:y.normalizationField,minValue:y.minValue,maxValue:y.maxValue,filter:y.filter,view:y.view,signal:y.signal}),function(e,i){const u=i.layer,d=i.field,y=d&&"function"!=typeof d?u.getField(d):null,v=p.isAnyDateField(y),c=o.createStopValues(e),f=o.getDefaultDataRange(e,v,!0),m=f||[c[0],c[4]],g=new s({field:d??void 0,valueExpression:i.valueExpression,valueExpressionTitle:i.valueExpressionTitle,normalizationField:i.normalizationField,stops:[new n({value:m[0],opacity:.3}),new n({value:m[1],opacity:1})],legendOptions:a.ensureClass(t,i.legendOptions)}),V=new r({type:"opacity",minSliderValue:null!=i.minValue?i.minValue:e.min,maxSliderValue:null!=i.maxValue?i.maxValue:e.max}),x=new l({visualVariables:[V]});return Promise.resolve({visualVariable:g,statistics:e,defaultValuesUsed:!!f,authoringInfo:x})}(v,y)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});