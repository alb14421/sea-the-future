// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Point","../../../../layers/support/rasterFunctions/stretchUtils","../../../../rest/support/ImageHistogramParameters","./RasterLayerAdapter"],function(t,e,s,r,a,i,o,n,c,l){"use strict";let u=class extends l{generateRasterInfo(t){const e=t?.rasterFunction;try{return this.layer.generateRasterInfo(e,{signal:t?.signal})}catch{return Promise.resolve(this.layer.serviceRasterInfo)}}async estimateStatisticsHistograms(t){const{layer:e}=this,s=e.mosaicRule?.multidimensionalDefinition?.[0]?.variableName??"",r=`${t?.rasterFunction?.functionName??"default"}${s}`,a=this._statsCache.get(r);if(a)return a;let{width:i,height:l,pixelSize:u}=e.rasterInfo,p=1;for(;i>2e3||l>2e3;)i/=2,l/=2,p*=2;const m=t?.rasterFunction??e.rasterFunction,{fullExtent:g,mosaicRule:h}=e;u=new o(u.x*p,u.y*p,g.spatialReference);const d=new c({geometry:g,pixelSize:u,renderingRule:m,mosaicRule:h});let y;if(e.capabilities.operations.supportsComputeStatisticsHistograms)y=await e.computeStatisticsHistograms(d,t);else{const{histograms:s}=await e.computeHistograms(d,t);y={statistics:n.estimateStatisticsFromHistograms(s),histograms:s}}return y&&this._statsCache.put(r,y),y}supportsMultidirectionalHillshade(){return this.layer.version>=10.81}load(t){return this.addResolvingPromise(this.layer.load(t).then(async()=>{const e=t?.signal;this.rasterInfo=await this.generateRasterInfo({rasterFunction:this.rasterFunction,signal:e})})),Promise.resolve(this)}};return t.__decorate([e.property()],u.prototype,"layer",void 0),u=t.__decorate([i.subclass("esri.smartMapping.raster.support.adapters.ImageryLayerAdapter")],u),u});