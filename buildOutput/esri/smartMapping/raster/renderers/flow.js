// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/colorUtils","../../../core/Error","../../../renderers/support/AuthoringInfo","../../../renderers/support/AuthoringInfoVisualVariable","../../../renderers/support/rasterRendererHelper","../../../renderers/support/RendererLegendOptions","../../../renderers/visualVariables/ColorVariable","../../../renderers/visualVariables/OpacityVariable","../../../renderers/visualVariables/SizeVariable","../../../renderers/visualVariables/support/ColorStop","../../../renderers/visualVariables/support/OpacityStop","../../../renderers/visualVariables/support/SizeStop","../support/utils","../../renderers/support/utils","../../symbology/flow"],function(e,a,r,n,i,t,l,s,o,u,m,p,c,d,h,f){"use strict";e.createRenderer=async function(e){e=await async function(e){const a={...e};return a.theme||(a.theme="flow-line"),d.processRasterRendererParameters(a)}(e);const w=t.createFlowRenderer(e.layer.serviceRasterInfo);if(null==w)throw new r("flow-renderer:not-supported","Only vector data is supported");return async function(e,d){d.flowRepresentation&&(e.flowRepresentation=d.flowRepresentation);const w=await async function(e){let a=e.flowScheme,r=null,n=null;const i=await h.getBasemapInfo(null,e.view);if(r=null!=i.basemapId?i.basemapId:null,n=null!=i.basemapTheme?i.basemapTheme:null,a)return{scheme:f.cloneScheme(a),basemapId:r,basemapTheme:n};const t=f.getSchemes({basemapTheme:n,theme:e.theme,hasSizeVariable:e.hasSizeVariable});return t&&(a=t.primaryScheme,r=t.basemapId,n=t.basemapTheme),{scheme:a,basemapId:r,basemapTheme:n}}({theme:d.theme,flowScheme:d.flowScheme,view:d.view,hasSizeVariable:d.includeSizeVariable}),b=w.scheme;if(!b)throw new r("flow-renderer:insufficient-info","Unable to find flow scheme");e.flowSpeed=b.flowSpeed,e.density=b.density,e.trailLength=b.trailLength,e.trailWidth=b.trailWidth,e.trailCap=b.trailCap,e.color=b.color;const y=[],g=[],S="Magnitude",V=d.layer.serviceRasterInfo,v=null==V?.statistics||"vector-magdir"!==V.dataType&&"vector-uv"!==V.dataType?{minMagnitude:0,maxMagnitude:10}:t.estimateMagnitudeRange(V.dataType,V.statistics);if(null==v?.minMagnitude||null==v.maxMagnitude)throw new r("flow-renderer:insufficient-info","stats not available");const x={min:v.minMagnitude,max:v.maxMagnitude},I={min:x.min,max:null!=x.max?x.max/2:null},R=h.getDataRange(I,null,null),T=h.createDataValues(R,I,null);if(d.includeColorVariable){const e=a.createUniqueColors(b.colors,5);if(e.length<5)throw new r("flow-renderer:insufficient-info","Flow scheme does not have enough colors");const n=new s({field:S,stops:T.map((a,r)=>new m({value:a,color:e[r]}))});y.push(n);const t=new i({type:"color",minSliderValue:x.min,maxSliderValue:x.max,theme:"high-to-low"});g.push(t)}if(d.includeOpacityVariable){const e=new o({field:S,stops:[new p({value:T[0],opacity:b.minOpacity}),new p({value:T[4],opacity:b.maxOpacity})]});y.push(e);const a=new i({type:"opacity",minSliderValue:x.min,maxSliderValue:x.max});g.push(a)}if(d.includeSizeVariable){const e=new u({field:S,stops:[new c({value:x.min,size:b.minSize}),new c({value:x.max,size:b.maxSize})]});y.push(e);const a=new i({type:"size",minSliderValue:x.min,maxSliderValue:x.max,theme:"high-to-low"});g.push(a)}const z=new n({type:"flow",visualVariables:g.length?g:void 0,flowTheme:b.theme});return e.visualVariables=y,e.authoringInfo=z,e.legendOptions=l.from(d.legendOptions),{renderer:e,visualVariables:y.map(e=>e.clone()),flowScheme:f.cloneScheme(b),basemapId:w.basemapId,basemapTheme:w.basemapTheme,layerEffect:b.layerEffect,statistics:x}}(w,e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});