// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../PopupTemplate","../../core/Error","../../intl/messages","../../intl/substitute","../../popup/ExpressionInfo","../../popup/FieldInfo","../../popup/support/FieldInfoFormat","./support/utils","../statistics/support/predominanceUtils"],function(e,n,o,t,i,r,s,f,a,d){"use strict";function l(e,n){return e.legendOptions?.title??n.competingFields}function p(e,n){return{fieldInfo:new s({fieldName:"expression/predominant-category"}),expressionInfo:new r({name:"predominant-category",title:n.predominantCategory,expression:d.getArcadeForPredominantCategoryAlias(e)})}}function m(e,n){const o=d.fieldNamesFromFieldInfos(e);return{fieldInfo:new s({fieldName:"expression/predominant-value",format:new f({digitSeparator:!0,places:1})}),expressionInfo:new r({name:"predominant-value",title:n.predominantCategoryValue,expression:d.getArcadeForPredominantCategoryValue(o),returnType:"number"})}}function u(e,n){const o=d.fieldNamesFromFieldInfos(e);return{fieldInfo:new s({fieldName:"expression/predominant-strength",format:new f({digitSeparator:!0,places:0})}),expressionInfo:new r({name:"predominant-strength",title:n.strengthOfPredominance,expression:d.getArcadeForStrengthOfPredominance(o),returnType:"number"})}}function I(e,o){const t=p(e.fieldInfos,o),r=new n({expressionInfos:[t.expressionInfo],fieldInfos:[t.fieldInfo],content:i.substitute(o.predominantCategoryContent,{expression:`<b>{${t.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category",title:o.predominantCategory,value:r}}function c(e,o){const{fieldInfos:t}=e,r=p(t,o),s=m(t,o),f=new n({expressionInfos:[s.expressionInfo,r.expressionInfo],fieldInfos:[s.fieldInfo,r.fieldInfo],content:i.substitute(o.predominantCategoryValueContent,{expression1:`<b>{${r.fieldInfo.fieldName}}</b>`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value",title:o.predominantCategoryValue,value:f}}function g(e,o){const{fieldInfos:t}=e,a=p(t,o),l=m(t,o),u=function(e,n){const o=d.fieldNamesFromFieldInfos(e);return{fieldInfo:new s({fieldName:"expression/predominant-margin",format:new f({digitSeparator:!0,places:0})}),expressionInfo:new r({name:"predominant-margin",title:n.marginOfVictory,expression:d.getArcadeForPredominanceMargin(o),returnType:"number"})}}(t,o),I=new n({expressionInfos:[l.expressionInfo,a.expressionInfo,u.expressionInfo],fieldInfos:[l.fieldInfo,a.fieldInfo,u.fieldInfo],title:i.substitute(o.mostCommon,{expression:"{expression/predominant-category}"}),content:i.substitute(o.predominantCategoryValueMarginContent,{expression1:`<b>{${a.fieldInfo.fieldName}}</b>`,expression2:`<b>{${l.fieldInfo.fieldName}}</b>`,expression3:`<b>{${u.fieldInfo.fieldName}}</b>`})});return{name:"predominant-category-value-margin",title:o.marginOfVictory,value:I}}function x(e,o){const{fieldInfos:t}=e,r=p(t,o),s=m(t,o),f=u(t,o),a=new n({expressionInfos:[s.expressionInfo,r.expressionInfo,f.expressionInfo],fieldInfos:[s.fieldInfo,r.fieldInfo,f.fieldInfo],content:i.substitute(o.predominantCategoryStrengthContent,{expression1:`{${s.fieldInfo.fieldName}}`,expression2:`<b>{${r.fieldInfo.fieldName}}</b>`,expression3:`<b>{${f.fieldInfo.fieldName}}%</b>`})});return{name:"predominant-category-strength",title:o.strengthOfPredominance,value:a}}function y(e,o){const{renderer:t,fieldInfos:f}=e,a=p(f,o),I=m(f,o),c=u(f,o),g=function(e,n){return{fieldInfo:new s({fieldName:"expression/predominant-categories-list"}),expressionInfo:new r({name:"predominant-categories-list",title:n.listOfCategories,expression:d.getArcadeForOrderedFields(e)})}}(f,o),x=new n({expressionInfos:[a.expressionInfo,I.expressionInfo,c.expressionInfo,g.expressionInfo],fieldInfos:[a.fieldInfo,I.fieldInfo,c.fieldInfo,g.fieldInfo],title:l(t,o),content:[{type:"text",text:i.substitute(o.predominantCategoryStrengthContent,{expression1:`{${I.fieldInfo.fieldName}}`,expression2:`<b>{${a.fieldInfo.fieldName}}</b>`,expression3:`<b>{${c.fieldInfo.fieldName}}%</b>`})},{type:"text",text:`{${g.fieldInfo.fieldName}}`}]});return{name:"predominant-categories-list",title:o.orderedListOfValues,value:x}}function b(e,o){const{fieldInfos:t}=e,a=p(t,o),l=m(t,o),I=u(t,o),c=function(e,n){const o=d.fieldNamesFromFieldInfos(e);return{fieldInfo:new s({fieldName:"expression/predominant-total",format:new f({digitSeparator:!0,places:0})}),expressionInfo:new r({name:"predominant-total",title:n.sumOfCategories,expression:d.getArcadeForSumOfFields(o),returnType:"number"})}}(t,o),g=new n({expressionInfos:[l.expressionInfo,a.expressionInfo,c.expressionInfo,I.expressionInfo],fieldInfos:[l.fieldInfo,a.fieldInfo,c.fieldInfo,I.fieldInfo],content:i.substitute(o.predominantCategoryTotalStrengthContent,{expression1:`{${l.fieldInfo.fieldName}}`,expression2:`<b>{${a.fieldInfo.fieldName}}</b>`,expression3:`<b>{${I.fieldInfo.fieldName}}%</b>`,expression4:`{${c.fieldInfo.fieldName}}`})});return{name:"predominant-category-total-strength",title:o.predominantCategoryWithTotalAndStrength,value:g}}function w(e,o){const{renderer:t,fieldInfos:r}=e,s=p(r,o),f=m(r,o),a=u(r,o),d=new n({expressionInfos:[f.expressionInfo,s.expressionInfo,a.expressionInfo],fieldInfos:[f.fieldInfo,s.fieldInfo,a.fieldInfo],title:l(t,o),content:[{type:"text",text:i.substitute(o.predominantCategoryStrengthContent,{expression1:`{${f.fieldInfo.fieldName}}`,expression2:`<b>{${s.fieldInfo.fieldName}}</b>`,expression3:`<b>{${a.fieldInfo.fieldName}}%</b>`})},{type:"media",mediaInfos:{type:"pie-chart",value:{fields:r.map(e=>e.fieldName)}}}]});return{name:"predominant-category-chart",title:o.predominantCategoryWithChart,value:d}}async function N(e){const{layer:n,renderer:t}=e;await n.load();const i=t??("renderer"in n?n.renderer:void 0);if("unique-value"!==i?.type)throw new o("predominance-popup:invalid-parameters","renderer.type must be 'unique-value'");const r=function(e,n){const t=e.authoringInfo,i="predominance"===t?.type?t.fields:[];if(!i?.length)throw new o("predominance-popup:insufficient-info","unable to find input fields in authoringInfo");return i.map(e=>a.getFieldInfo(n,e))}(i,n);return{renderer:i,fieldInfos:r}}async function C(e){const[n,o]=await Promise.all([N(e),t.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]);return[I(n,o),c(n,o),g(n,o),b(n,o),y(n,o),x(n,o),w(n,o)]}e.getAllTemplates=C,e.getTemplates=async function(e){const[n,o]=await Promise.all([N(e),t.fetchMessageBundle("esri/smartMapping/t9n/smartMapping")]),i=y(n,o),r=await C(e);return{primaryTemplate:i,secondaryTemplates:r.filter(e=>e.name!==i.name)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});