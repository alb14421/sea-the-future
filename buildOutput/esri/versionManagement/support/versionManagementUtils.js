// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../request","../../core/uuid"],function(e,r,t,n){"use strict";const o=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),s=n.generateLowercaseBracedUUID(),i=new Map,a=new Map,c=new Map;r.currentSessionId=s,r.defaultVersionNameLookup=i,r.isHistoricVersion=async function(e,r,n){if(!e||!n)return!1;if(!r)return!0;const o=new URL(e).host;let s=i.get(o);if(!s){const r=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");s=(await t(r,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return s===r},r.isSafeToEditVersion=async function(r,t,n=!1){if(!r||!t)return!0;const i=r.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),c=a.get(i)?.entries();if(c)for(const[r,a]of c)if(a.name===t){const t=!a.stack?.hasForwardEdits();if(!t&&n){const[{deleteForwardEdits:t},{default:n}]=await Promise.all([new Promise((r,t)=>e(["../../rest/versionManagement/gdbVersion/deleteForwardEdits"],r,t)),new Promise((r,t)=>e(["../../rest/versionManagement/gdbVersion/support/DeleteForwardEditsParameters"],e=>r(o(e)),t))]),c=await t(i,r,new n({sessionId:s,moment:a.moment}));return c.success&&a.stack?.clearForwardEdits(),c.success}return t}return!0},r.isVersionInEditSession=function(e,r){if(!e)return!1;const t=e.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),n=a.get(t)?.entries();if(n)for(const[e,t]of n)if(t.name===r)return"edit"===t.lockType;return!1},r.versionCollection=a,r.versionCollectionCount=c,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});