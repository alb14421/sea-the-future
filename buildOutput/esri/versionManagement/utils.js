// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../core/Collection","../core/handleUtils","../core/Logger","../core/MapUtils","../rest/featureService/FeatureService","./VersioningState","./VersionManagementService","./versionAdapters/utils"],function(e,t,r,n,a,o,s,i,c){"use strict";async function l(e,r){let n;if("layers"in e){const t=c.createVersionAdapters(e.allTables.concat(e.allLayers).filter(e=>"group"!==e.type).toArray());e.utilityNetworks&&e.utilityNetworks.forEach(e=>{const r=c.createVersionAdapters([e]);t.push(...r)}),n=t}else n=new t(e);const a=new Map;for(const e of n){const r=a.get(e.featureServiceUrl);r?r.push(e):a.set(e.featureServiceUrl,new t([e]))}const l=new t;for(const[e,t]of a){const n=new o({url:e});if(await n.load(),!n.versionManagementServiceUrl)continue;const a=new i({url:n.versionManagementServiceUrl});l.push(new s({versionManagementService:a,versionableItems:t,usePersistentReadSessions:r}))}return l}const u=new Map;e.createVersioningStates=l,e.getVersioningStates=async function(e,t=!1){const o=e.map;o.loaded||await o.load();const s=await l(o,t);return a.getOrCreateMapValue(u,e,()=>(e.addHandles(r.makeHandle(()=>{u.delete(e),s.forEach(e=>e.destroy())})),s.forEach(e=>e.load().catch(e=>{n.getLogger("esri.versionManagement.VersioningState").error("Failed to load Versioning State",e)})),s))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});