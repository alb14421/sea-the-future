// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(e,t){"use strict";e.updateOrigins=function(e){e?.writtenProperties&&e.writtenProperties.forEach(({target:e,propName:r,newOrigin:o})=>{t.isMultiOriginJSONMixin(e)&&o&&e.originOf(r)!==o&&e.updateOrigin(r,o)})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/jsonContext":function(){define(["exports","../../core/urlUtils","../Portal"],function(e,t,r){"use strict";function o(e,o){return{origin:o,url:t.urlToObject(e.itemUrl),portal:e.portal||r.getDefault(),portalItem:e}}e.createForItemRead=function(e,t){return{...o(e,t),readResourcePaths:[]}},e.createForItemWrite=function(e,r,s){const i=t.urlToObject(e.itemUrl);return{...o(e,r),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:i?{rootPath:i.path,writtenUrls:[]}:null,resources:s?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/MapFloorInfo":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../layers/support/FacilityLayerInfo","../layers/support/LevelLayerInfo","../layers/support/SiteLayerInfo"],function(e,t,r,o,s,i,n,a,c,l){"use strict";let p=class extends t.JSONSupport{constructor(e){super(e),this.levelLayer=null,this.facilityLayer=null,this.siteLayer=null}};return e.__decorate([r.property({type:c,json:{write:{isRequired:!0}}})],p.prototype,"levelLayer",void 0),e.__decorate([r.property({type:a,json:{write:{isRequired:!0}}})],p.prototype,"facilityLayer",void 0),e.__decorate([r.property({type:l,json:{write:!0}})],p.prototype,"siteLayer",void 0),p=e.__decorate([n.subclass("esri.support.MapFloorInfo")],p),p})},"esri/layers/support/FacilityLayerInfo":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";let a=class extends t.JSONSupport{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};return e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"facilityIdField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"layerId",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"nameField",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"siteIdField",void 0),e.__decorate([r.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0),a=e.__decorate([n.subclass("esri.layers.support.FacilityLayerInfo")],a),a})},"esri/layers/support/LevelLayerInfo":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";let a=class extends t.JSONSupport{constructor(e){super(e),this.facilityIdField=null,this.layerId=null,this.levelIdField=null,this.levelNumberField=null,this.longNameField=null,this.shortNameField=null,this.sublayerId=null,this.verticalOrderField=null}};return e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"facilityIdField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"layerId",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"levelIdField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"levelNumberField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"longNameField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"shortNameField",void 0),e.__decorate([r.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"verticalOrderField",void 0),a=e.__decorate([n.subclass("esri.layers.support.LevelLayerInfo")],a),a})},"esri/layers/support/SiteLayerInfo":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";let a=class extends t.JSONSupport{constructor(e){super(e),this.layerId=null,this.nameField=null,this.siteIdField=null,this.sublayerId=null}};return e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"layerId",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"nameField",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],a.prototype,"siteIdField",void 0),e.__decorate([r.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],a.prototype,"sublayerId",void 0),a=e.__decorate([n.subclass("esri.layers.support.SiteLayerInfo")],a),a})},"esri/support/tagSymbols":function(){define(["exports"],function(e){"use strict";const t=Symbol("WebScene");e.WebSceneTag=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/webSceneUtils":function(){define(["exports","../core/Error"],function(e,t){"use strict";const r="webscene:schema-validation";e.createCopyError=function(){return new t("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")},e.createSchemaValidationError=function(e){return new t(r,"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:e})},e.schemaValidationErrorName=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports"],function(e){"use strict";e.isSpatialReferenceSupported=function(e,t){return null!=e&&(null==t||(2===t?!e.isGeographic||e.isWGS84||4490===e.wkid:e.isWebMercator||e.isWGS84||4490===e.wkid||104971===e.wkid||104905===e.wkid||104903===e.wkid))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/Widgets":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","./widgets/FloorFilter","./widgets/Range","./widgets/TimeSlider"],function(e,t,r,o,s,i,n,a,c,l){"use strict";var p;let u=p=class extends t.JSONSupport{constructor(e){super(e),this.range=null,this.timeSlider=null,this.floorFilter=null}clone(){return new p(r.clone({range:this.range,timeSlider:this.timeSlider,floorFilter:this.floorFilter}))}};return e.__decorate([o.property({type:c,json:{write:!0}})],u.prototype,"range",void 0),e.__decorate([o.property({type:l,json:{write:!0}})],u.prototype,"timeSlider",void 0),e.__decorate([o.property({type:a,json:{write:!0}})],u.prototype,"floorFilter",void 0),u=p=e.__decorate([n.subclass("esri.webdoc.Widgets")],u),u})},"esri/webdoc/widgets/FloorFilter":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";var a;let c=a=class extends t.JSONSupport{constructor(e){super(e),this.enabled=!1,this.longNames=!1,this.minimized=!1,this.pinnedLevels=!1,this.site=null,this.facility=null,this.level=null}clone(){return new a(r.clone({enabled:this.enabled,longNames:this.longNames,minimized:this.minimized,pinnedLevels:this.pinnedLevels,site:this.site,facility:this.facility,level:this.level}))}};return e.__decorate([o.property({type:Boolean,json:{read:{source:"enabled"},write:{target:"enabled"}}})],c.prototype,"enabled",void 0),e.__decorate([o.property({type:Boolean,json:{read:{source:"longNames"},write:{target:"longNames"}}})],c.prototype,"longNames",void 0),e.__decorate([o.property({type:Boolean,json:{read:{source:"minimized"},write:{target:"minimized"}}})],c.prototype,"minimized",void 0),e.__decorate([o.property({type:Boolean,json:{read:{source:"pinnedLevels"},write:{target:"pinnedLevels"}}})],c.prototype,"pinnedLevels",void 0),e.__decorate([o.property({type:String,json:{read:{source:"site"},write:{target:"site"}}})],c.prototype,"site",void 0),e.__decorate([o.property({type:String,json:{read:{source:"facility"},write:{target:"facility"}}})],c.prototype,"facility",void 0),e.__decorate([o.property({type:String,json:{read:{source:"level"},write:{target:"level"}}})],c.prototype,"level",void 0),c=a=e.__decorate([n.subclass("esri.webdoc.widgets.FloorFilter")],c),c})},"esri/webdoc/widgets/Range":function(){define(["../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a){"use strict";var c;const l=new t.JSONMap({slider:"slider",picker:"picker"});let p=c=class extends r.JSONSupport{constructor(e){super(e),this.interactionMode=null,this.numStops=null,this.stopInterval=null}clone(){return new c({interactionMode:this.interactionMode,numStops:this.numStops,stopInterval:this.stopInterval})}};return e.__decorate([o.property({type:l.apiValues,nonNullable:!0,json:{type:l.jsonValues,default:null,read:{reader:l.read},write:{isRequired:!0,writer:l.write}}})],p.prototype,"interactionMode",void 0),e.__decorate([o.property({type:s.Integer,json:{read:{source:"numberOfStops"},write:{target:"numberOfStops",overridePolicy(){const e=null!=this.stopInterval;return{enabled:!e,isRequired:!e}}}}})],p.prototype,"numStops",void 0),e.__decorate([o.property({type:Number,json:{write:{overridePolicy(){return{isRequired:null==this.numStops}}}}})],p.prototype,"stopInterval",void 0),p=c=e.__decorate([a.subclass("esri.webdoc.widgets.Range")],p),p})},"esri/webdoc/widgets/TimeSlider":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../portal/timeUnitKebabDictionary","../../chunks/TimeExtent","../../chunks/TimeInterval"],function(e,t,r,o,s,i,n,a,c,l,p,u){"use strict";var d;let h=d=class extends t.JSONSupport{constructor(e){super(e),this.currentTimeExtent=null,this.fullTimeExtent=null,this.loop=!1,this.numStops=null,this.numThumbs=null,this.stopDelay=null,this.stopInterval=null,this.stops=null}readCurrentTimeExtent(e){return e?p.TimeExtent.fromArray(e):void 0}writeCurrentTimeExtent(e,t,r){e&&o.setDeepValue(r,e.toArray(),t)}readFullTimeExtent(e,t){const r=t.properties;if(!r)return;const o=null!=r.endTime?new Date(r.endTime):null,s=null!=r.startTime?new Date(r.startTime):null;return new p.TimeExtent({start:s,end:o})}writeFullTimeExtent(e,t){if(!e)return;const r=t.properties=t.properties||{},o=e.end,s=e.start;o&&(r.endTime=null!=o?o.getTime():null),s&&(r.startTime=null!=s?s.getTime():null)}readStopInterval(e,t,r){return e?u.TimeInterval.fromJSON({value:e.interval,unit:e.units},r):null}writeStopInterval(e,t,r,s){if(!e)return;const i=e.toJSON(s);o.setDeepValue("properties.timeStopInterval",{interval:i.value,units:i.unit},t)}readStops(e){return e?.length?e.map(e=>new Date(e)):null}writeStops(e,t,r){e?.length&&o.setDeepValue(r,e.map(e=>e.getTime()),t)}clone(){return new d(r.clone({currentTimeExtent:this.currentTimeExtent,fullTimeExtent:this.fullTimeExtent,loop:this.loop,numStops:this.numStops,numThumbs:this.numThumbs,stopDelay:this.stopDelay,stopInterval:this.stopInterval,stops:this.stops}))}};return e.__decorate([s.property({type:p.TimeExtent,json:{type:[[i.Integer,i.Null]],read:{source:"properties.currentTimeExtent"},write:{target:"properties.currentTimeExtent"}}})],h.prototype,"currentTimeExtent",void 0),e.__decorate([n.reader("currentTimeExtent")],h.prototype,"readCurrentTimeExtent",null),e.__decorate([c.writer("currentTimeExtent")],h.prototype,"writeCurrentTimeExtent",null),e.__decorate([s.property({type:p.TimeExtent,json:{read:{source:["properties.endTime","properties.startTime"]},write:{target:{"properties.endTime":{type:Number},"properties.startTime":{type:Number}}}}})],h.prototype,"fullTimeExtent",void 0),e.__decorate([n.reader("fullTimeExtent")],h.prototype,"readFullTimeExtent",null),e.__decorate([c.writer("fullTimeExtent")],h.prototype,"writeFullTimeExtent",null),e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{default:!1,read:{source:"properties.loop"},write:{target:"properties.loop"}}})],h.prototype,"loop",void 0),e.__decorate([s.property({type:i.Integer,json:{read:{source:"properties.numberOfStops"},write:{target:"properties.numberOfStops",overridePolicy(){const e=!!this.stopInterval,t=!!this.stops?.length,r=!(e||t);return{enabled:r,isRequired:r}}}}})],h.prototype,"numStops",void 0),e.__decorate([s.property({type:[1,2],nonNullable:!0,json:{type:i.Integer,read:{source:"properties.thumbCount"},write:{target:"properties.thumbCount",isRequired:!0}}})],h.prototype,"numThumbs",void 0),e.__decorate([s.property({type:Number,nonNullable:!0,json:{read:{source:"properties.thumbMovingRate"},write:{target:"properties.thumbMovingRate",isRequired:!0}}})],h.prototype,"stopDelay",void 0),e.__decorate([s.property({type:u.TimeInterval,json:{read:{source:"properties.timeStopInterval"},write:{target:{"properties.timeStopInterval.interval":{type:Number},"properties.timeStopInterval.units":{type:l.timeUnitKebabDictionary.jsonValues.filter(e=>"esriTimeUnitsUnknown"!==e)}},overridePolicy(){const e=null!=this.numStops,t=!!this.stops?.length;return{enabled:!t,isRequired:!(e||t)}}}}})],h.prototype,"stopInterval",void 0),e.__decorate([n.reader("stopInterval")],h.prototype,"readStopInterval",null),e.__decorate([c.writer("stopInterval")],h.prototype,"writeStopInterval",null),e.__decorate([s.property({type:[Date],json:{type:[i.Integer],read:{source:"properties.stops"},write:{target:"properties.stops",overridePolicy(){return{isRequired:null==this.numStops&&!this.stopInterval}}}}})],h.prototype,"stops",void 0),e.__decorate([n.reader("stops")],h.prototype,"readStops",null),e.__decorate([c.writer("stops")],h.prototype,"writeStops",null),h=d=e.__decorate([a.subclass("esri.webdoc.widgets.TimeSlider")],h),h})},"esri/webdoc/support/resourceUtils":function(){define(["require","exports","../../core/Error","../../core/promiseUtils","../../core/uuid","../../portal/support/resourceUtils"],function(e,t,r,o,s,i){"use strict";async function n(t,n,a){if(!n?.resources)return;const c=n.portalItem===t.portalItem?new Set(t.paths):new Set;t.paths.length=0,t.portalItem=n.portalItem;const l=new Set(n.resources.toKeep.map(e=>e.resource.path)),p=new Set,u=[];l.forEach(e=>{c.delete(e),t.paths.push(e)});const d=[],h=[],y=[];for(const e of n.resources.toUpdate)if(c.delete(e.resource.path),l.has(e.resource.path)||p.has(e.resource.path)){const{resource:r,content:o,finish:n}=e,a=i.getSiblingOfSameTypeI(r,s.generateUUID());t.paths.push(a.path),d.push({resource:a,content:await i.contentToBlob(o),compress:e.compress}),n&&y.push(()=>n(a))}else{t.paths.push(e.resource.path),h.push({resource:e.resource,content:await i.contentToBlob(e.content),compress:e.compress});const r=e.finish;r&&y.push(()=>r(e.resource)),p.add(e.resource.path)}for(const e of n.resources.toAdd)if(t.paths.push(e.resource.path),c.has(e.resource.path))c.delete(e.resource.path);else{d.push({resource:e.resource,content:await i.contentToBlob(e.content),compress:e.compress});const t=e.finish;t&&y.push(()=>t(e.resource))}if(d.length||h.length){const{addOrUpdateResources:t}=await new Promise((t,r)=>e(["../../portal/support/resourceUtils"],t,r));await t(n.portalItem,d,"add",a),await t(n.portalItem,h,"update",a)}if(y.forEach(e=>e()),0===u.length)return c;const m=await o.allSettledErrors(u);if(o.throwIfAborted(a),m.length>0)throw new r("save:resources","Failed to save one or more resources",{errors:m});return c}async function a(e,t,r){if(!e||!t.portalItem)return;const s=[];for(const o of e){const e=t.portalItem.resourceFromPath(o);s.push(e.portalItem.removeResource(e,r))}await o.eachAlways(s)}t.saveResources=async function(e,t,r){const o=await n(e,t,r);await a(o,t,r)},t.updateItemWithResources=async function(e,t,r,o,s){const i=await n(r,o,s);await e.update({data:t}),await a(i,o,s)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../request","../../core/Error","../../core/urlUtils"],function(e,t,r,o){"use strict";function s(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function i(e){const[t,r]=function(e){const t=o.getPathExtension(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[i,n]=s(t);return[i,n,r]}e.addOrUpdateResources=async function(e,t,i,n){const a=new Map;for(const{resource:e,content:o,compress:n,access:c}of t){if(!e.hasPath())throw new r(`portal-item-resource-${i}:invalid-path`,"Resource does not have a valid path");const[t,l]=s(e.path),p=`${t}/${n??""}/${c??""}`;a.has(p)||a.set(p,{prefix:t,compress:n,access:c,files:[]}),a.get(p).files.push({fileName:l,content:o})}await e.load(n);const c=o.join(e.userItemUrl,"add"===i?"addResources":"updateResources");for(const{prefix:t,compress:r,access:o,files:s}of a.values()){const i=25;for(let a=0;a<s.length;a+=i){const l=s.slice(a,a+i),p=new FormData;t&&"."!==t&&p.append("resourcesPrefix",t),r&&p.append("compress","true"),o&&p.append("access",o);let u=0;for(const{fileName:e,content:t}of l)p.append("file"+ ++u,t,e);p.append("f","json"),await e.portal.request(c,{method:"post",body:p,signal:n?.signal})}}},e.contentToBlob=async function(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await t(e.url,{responseType:"blob"})).data},e.fetchResources=async function(e,t={},r){await e.load(r);const s=o.join(e.itemUrl,"resources"),{start:i=1,num:n=10,sortOrder:a="asc",sortField:c="resource"}=t,l={query:{start:i,num:n,sortOrder:a,sortField:c,token:e.apiKey},signal:r?.signal},p=await e.portal.request(s,l);return{total:p.total,nextStart:p.nextStart,resources:p.resources.map(({created:t,size:r,resource:o})=>({created:new Date(t),size:r,resource:e.resourceFromPath(o)}))}},e.getSiblingOfSameType=function(e,t){if(!e.hasPath())return null;const[r,,s]=i(e.path);return e.portalItem.resourceFromPath(o.join(r,t+s))},e.getSiblingOfSameTypeI=function(e,t){if(!e.hasPath())return null;const[r,,s]=i(e.path);return e.portalItem.resourceFromPath(o.join(r,t+s))},e.removeAllResources=async function(e,t){await e.load(t);const r=o.join(e.userItemUrl,"removeResources");return e.portal.request(r,{method:"post",query:{deleteAll:!0},signal:t?.signal})},e.removeResource=async function(e,t,s){if(!t.hasPath())throw new r("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(s);const i=o.join(e.userItemUrl,"removeResources");await e.portal.request(i,{method:"post",query:{resource:t.path},signal:s?.signal}),t.portalItem=null},e.splitPrefixFileNameAndExtension=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define(["exports","../../core/Error","../../layers/support/layerUtils"],function(e,t,r){"use strict";const o=new Set(["layer:unsupported","property:unsupported","symbol:unsupported","symbol-layer:unsupported","url:unsupported"]);e.beforeSave=async function(e){const t=[];for(const r of e.allLayers)if("beforeSave"in r&&"function"==typeof r.beforeSave){const e=r.beforeSave();e&&t.push(e)}await Promise.allSettled(t)},e.evaluateWriteErrors=function(e,r,s){let i=(e.messages??[]).filter(({type:e})=>"error"===e).map(({name:e,message:r,details:o})=>new t(e,r,o));if(e.blockedRelativeUrls&&(i=i.concat(e.blockedRelativeUrls.map(e=>new t("url:unsupported",`Relative url '${e}' is not supported`)))),s){const{ignoreUnsupported:e,supplementalUnsupportedErrors:t=[],requiredPropertyChecksDisabled:r}=s;e&&(i=i.filter(({name:e})=>!(o.has(e)||t.includes(e)))),r&&(i=i.filter(e=>"web-document-write:property-required"!==e.name))}if(i.length>0)throw new t(r.errorName,"Failed to save due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:i})},e.hasCharts=function(e){return r.getLayersWithChartSupport(e).some(e=>!!e.charts?.length)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/thumbnailUtils":function(){define(["exports"],function(e){"use strict";const t={width:600,height:400},r=1.5;e.getOptimalThumbnailSize=function(e,o){o=o||t;let{width:s,height:i}=o;const n=s/i;return n<r?i=s/r:n>r&&(s=i*r),s>e.width&&(i*=e.width/s,s=e.width),i>e.height&&(s*=e.height/i,i=e.height),{width:Math.round(s),height:Math.round(i)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/webdocSaveUtils":function(){define(["require","exports","../../core/Error","../../core/MultiOriginJSONSupport","../../core/reactiveUtils","../../core/urlUtils","../../core/accessorSupport/originUtils","../../geometry/SpatialReference","../../geometry/support/spatialReferenceUtils","../../geometry/support/webMercatorUtils","../../layers/support/arcgisLayerUrl","../../layers/support/layerUtils","../../portal/Portal","../../portal/PortalItem","../../portal/support/jsonContext","../../portal/support/portalItemUtils","../../rest/geometryService/project","../../rest/support/ProjectParameters","../../support/basemapUtils","./resourceUtils","./saveUtils"],function(e,t,r,o,s,i,n,a,c,l,p,u,d,h,y,m,g,b,_,w,f){"use strict";const S=["NatGeo_World_Map","Ocean_Basemap","USA_Topo_Maps","World_Imagery","World_Street_Map","World_Terrain_Base","World_Topo_Map","World_Hillshade","Canvas/World_Light_Gray_Base","Canvas/World_Light_Gray_Reference","Canvas/World_Dark_Gray_Base","Canvas/World_Dark_Gray_Reference","Ocean/World_Ocean_Base","Ocean/World_Ocean_Reference","Reference/World_Boundaries_and_Places","Reference/World_Reference_Overlay","Reference/World_Transportation"].map(e=>e.toLowerCase());async function v(e,t,r){const o=y.createForItemWrite(t,r,!0),s=e.write({},o);return await Promise.all(o.resources.pendingOperations),{json:s,jsonContext:o}}function T(e,t){if(t.type!==e.itemType)throw new r(`${e.name}:portal-item-wrong-type`,`Portal item needs to have type "${e.itemType}"`)}async function E(e,t){if("linkchart"===e.name)return;if(!t.basemap?.baseLayers.length)throw new r(`${e.name}:save`,"Map does not have a valid basemap with a base layer.");let o=null;if(await s.whenOnce(()=>{const e=_.findSpatialReference(t.initialViewProperties,t.basemap);return o=e.spatialReference,!e.updating}),!c.equals(o,t.initialViewProperties.spatialReference))throw new r(`${e.name}:save`,"The spatial reference of the basemap is not compatible with the one from the map.",{expected:t.initialViewProperties.spatialReference,actual:o})}function R(e){const t=[];return e.basemap&&t.push(e.basemap.load()),e.ground&&t.push(e.ground.load()),Promise.allSettled(t).then(()=>{})}async function I(t,r){r.extent=await async function(t,r){const o=r.clone().normalize();let s;if(o.length>1)for(const e of o)s?e.width>s.width&&(s=e):s=e;else s=o[0];return async function(t,r){const o=r.spatialReference;if(o.isWGS84)return r.clone();if(o.isWebMercator)return l.webMercatorToGeographic(r);const{getGeometryServiceURL:s}=await new Promise((t,r)=>e(["../../portal/support/geometryServiceUtils"],t,r)),i=await s(t),n=new b({geometries:[r],outSpatialReference:a.WGS84});return(await g.project(i,n))[0]}(t,s)}(t.portalItem,t.initialViewProperties.viewpoint.targetGeometry),await async function(e,t){m.addTypeKeyword(t,L),await function(e){const t=V(e).map(e=>e.load()).toArray();return Promise.allSettled(t).then(()=>{})}(e),function(e,t){m.hasTypeKeyword(t,O)||m.hasTypeKeyword(t,j)||m.hasTypeKeyword(t,k)||m.hasTypeKeyword(t,U)||!G(e)?m.removeTypeKeyword(t,C):m.addTypeKeyword(t,C)}(e,t),function(e,t){G(e)?m.addTypeKeyword(t,P):m.removeTypeKeyword(t,P)}(e,t),function(e,t){!m.hasTypeKeyword(t,A)&&function(e){return V(e).filter(e=>"group"!==e.type).every(t=>t.loaded&&function(e,t){return u.isLayerWithFeatureLayerSource(t)&&t.capabilities.operations.supportsSync||function(e){return u.isFeatureCollectionLayer(e)||"map-notes"===e.type||"route"===e.type}(t)&&!t.portalItem||function(e){return("tile"===e.type||"vector-tile"===e.type)&&(e.capabilities.operations.supportsExportTiles||function(e){return"tile"===e.type&&p.isServerOrServicesAGOLUrl(e.url)&&S.some(t=>e.url?.toLowerCase().includes("/"+t+"/"))}(e)||_.isDeveloperBasemapLayer(e))}(t)&&!function(e){return"vector-tile"===e.type&&Object.keys(e.sourceNameToSource).length>1}(t)&&t.spatialReference.equals(e.initialViewProperties.spatialReference)}(e,t))}(e)?m.addTypeKeyword(t,N):m.removeTypeKeyword(t,N)}(e,t),function(e,t){_.hasDeveloperBasemapLayer(e.basemap)?m.addTypeKeyword(t,x):m.removeTypeKeyword(t,x)}(e,t),function(e,t){e.utilityNetworks?.length?m.addTypeKeyword(t,M):m.removeTypeKeyword(t,M)}(e,t),function(e,t){e.ipsInfo?m.addTypeKeyword(t,F):m.removeTypeKeyword(t,F)}(e,t),function(e,t){m.toggleTypeKeyword(t,m.typeKeyword.CHARTS,f.hasCharts(e))}(e,t),t.typeKeywords&&(t.typeKeywords=t.typeKeywords.filter((e,t,r)=>r.indexOf(e)===t))}(t,r)}const L=m.typeKeyword.JSAPI,O="CollectorDisabled",C="Collector",P="Data Editing",A="OfflineDisabled",N="Offline",j="Workforce Project",k="Workforce Worker",U="Workforce Dispatcher",x=m.typeKeyword.DEVELOPER_BASEMAP,M="UtilityNetwork",F="IPS";function V(e){return e.allLayers.concat(e.allTables)}function G(e){return V(e).some(e=>e.loaded&&u.isLayerWithFeatureLayerSource(e)&&e.capabilities.operations.supportsEditing&&e.editingEnabled&&("subtype-group"!==e.type||e.sublayers.some(e=>e.editingEnabled)))}async function J(e,t){const{item:r,authenticated:o}=e;return r?.id&&r.typeKeywords?.includes("useOnly")?r.portal.portalHostname!==t.portalHostname?{copyAllowed:!1,itemReloaded:!1}:(o||await r.reload(),{copyAllowed:"admin"===r.itemControl||"update"===r.itemControl,itemReloaded:!0}):{copyAllowed:!0,itemReloaded:!1}}async function W(e,t,r,o){const s=e.portal,{item:n}=t,{folder:a,copyAllResources:c}=o;let l=!1;if(c&&n?.id&&i.hasSameCanonicalPortal(n.portal.url,s.url)&&parseInt(n.portal.currentVersion,10)>=2023){const{total:e}=await n.fetchResources();l=!!e}if(l){const t=await n.copy({copyResources:"all",folder:a});e.id=t.id,e.portal=t.portal;const o=e.toJSON();await e.load(),e.read(o),await e.update({data:r})}else await s.user.addItem({item:e,folder:a,data:r});return l}function q(e,t,r,s,a){o.MultiOriginJSONSupport.prototype.read.call(t,{version:s.version,authoringApp:s.authoringApp,authoringAppVersion:s.authoringAppVersion},{origin:e.origin,ignoreDefaults:!0,url:r.itemUrl?i.urlToObject(r.itemUrl):void 0}),n.updateOrigins(a),t.resourceInfo=s}t.createJSON=v,t.initializeNewItem=W,t.isCopyAllowed=J,t.save=async function(e,t,o){o??={},function(e,t){if(!t.portalItem)throw new r(`${e.name}:portal-item-not-set`,"Portal item to save to has not been set on the WebMap");T(e,t.portalItem)}(e,t),await s.whenOnce(()=>!t.updatingFromView),await t.load(),await R(t),await f.beforeSave(t),await E(e,t);const i=t.portalItem,{json:n,jsonContext:a}=await v(t,i,e.origin);return f.evaluateWriteErrors(a,{errorName:`${e.name}:save`},o),await I(t,i),await async function(e,t,r,o,s){await r.update({data:o}),q(e,t,r,o,s)}(e,t,i,n,a),await Promise.all([t.updateItemThumbnail(),w.saveResources(t.resourceReferences,a)]),i},t.saveAs=async function(e,t,o,i){i??={};const n=function(e,t){let r=h.from(t);return r.id&&(r=r.clone(),r.id=null),r.type||(r.type=e.itemType),r.portal||(r.portal=d.getDefault()),T(e,r),r}(e,o);await s.whenOnce(()=>!t.updatingFromView),await t.load(),await R(t),await f.beforeSave(t),await E(e,t);const{json:a,jsonContext:c}=await v(t,n,e.origin);f.evaluateWriteErrors(c,{errorName:`${e.name}:save`},i),await async function(e,t){m.removeTypeKeyword(t,O),m.removeTypeKeyword(t,"FieldMapsDisabled"),m.removeTypeKeyword(t,m.typeKeyword.METADATA),m.removeTypeKeyword(t,A),m.removeTypeKeyword(t,"Offline Map Areas"),m.removeTypeKeyword(t,U),m.removeTypeKeyword(t,j),m.removeTypeKeyword(t,k),await I(e,t)}(t,n);const l=t.getThumbnailState();return await async function(e,t,o,s,i,n){const a=t.portalItem,c={item:a,authenticated:!(!a?.id||!a.portal.user)},l=o.portal;await l.signIn();const{copyAllowed:p,itemReloaded:u}=await J(c,l);if(c.authenticated||=u,!p)throw new r(`${e.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const d=await W(o,c,s,n);return t.portalItem=o,q(e,t,o,s,i),d}(e,t,n,a,c,i)&&(t.resourceReferences.portalItem=n),t.restoreThumbnailFromState(l),await Promise.all([t.updateItemThumbnail(),w.saveResources(t.resourceReferences,c)]),n},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/project":function(){define(["exports","../../request","../../core/accessorSupport/ensureType","../../geometry/support/jsonUtils","../utils","./utils","../support/ProjectParameters"],function(e,t,r,o,s,i,n){"use strict";const a=r.ensureType(n);e.project=async function(e,r,n){r=a(r);const c=s.parseUrl(e),l={...c.query,f:"json",...r.toJSON()},p=r.outSpatialReference,u=o.getJsonType(r.geometries[0]),d=s.asValidOptions(l,n);return t(c.path+"/project",d).then(({data:{geometries:e}})=>i.decodeGeometries(e,u,p))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/SpatialReference","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils"],function(e,t,r,o,s,i,n,a,c,l,p){"use strict";return e.default=class extends r.JSONSupport{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(e=>e.toJSON()),t=this.geometries[0],r={};return r.outSR=p.srToRESTValue(this.outSpatialReference),r.inSR=p.srToRESTValue(t.spatialReference),r.geometries=JSON.stringify({geometryType:l.getJsonType(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}},t.__decorate([o.property()],e.default.prototype,"geometries",void 0),t.__decorate([o.property({type:c,json:{read:{source:"outSR"}}})],e.default.prototype,"outSpatialReference",void 0),t.__decorate([o.property()],e.default.prototype,"transformation",void 0),t.__decorate([o.property()],e.default.prototype,"transformForward",void 0),e.default=t.__decorate([a.subclass("esri.rest.support.ProjectParameters")],e.default),e.default})},"esri/webscene/ApplicationProperties":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../webdoc/applicationProperties/Viewing"],function(e,t,r,o,s,i,n,a){"use strict";var c;let l=c=class extends t.JSONSupport{constructor(e){super(e),this.viewing=null}clone(){return new c({viewing:this.viewing?.clone()??null})}};return e.__decorate([r.property({type:a,json:{write:!0}})],l.prototype,"viewing",void 0),l=c=e.__decorate([n.subclass("esri.webscene.ApplicationProperties")],l),l})},"esri/webdoc/applicationProperties/Viewing":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./Search"],function(e,t,r,o,s,i,n,a){"use strict";var c;let l=c=class extends t.JSONSupport{constructor(e){super(e),this.search=null}clone(){return new c(r.clone({search:this.search}))}};return e.__decorate([o.property({type:a,json:{write:!0}})],l.prototype,"search",void 0),l=c=e.__decorate([n.subclass("esri.webdoc.applicationProperties.Viewing")],l),l})},"esri/webdoc/applicationProperties/Search":function(){define(["../../chunks/tslib.es6","../../core/Collection","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../core/accessorSupport/extensions/serializableProperty/writePolicyUtils","./SearchLayer","./SearchTable"],function(e,t,r,o,s,i,n,a,c,l,p,u,d){"use strict";var h;const y=t.ofType(u),m=t.ofType(d);let g=h=class extends r.JSONSupport{constructor(e){super(e),this.addressSearchEnabled=!0,this.enabled=!0,this.hintText=null,this.layers=new y,this.tables=new m}readAddressSearchEnabled(e){return!e}writeAddressSearchEnabled(e,t,r){t[r]=!e}clone(){return new h(o.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,tables:this.tables}))}};return e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],g.prototype,"addressSearchEnabled",void 0),e.__decorate([a.reader("addressSearchEnabled")],g.prototype,"readAddressSearchEnabled",null),e.__decorate([l.writer("addressSearchEnabled")],g.prototype,"writeAddressSearchEnabled",null),e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],g.prototype,"enabled",void 0),e.__decorate([s.property({type:String,json:{write:!0}})],g.prototype,"hintText",void 0),e.__decorate([s.property({type:y,json:{write:{overridePolicy:p.writeNonEmptyCollectionPolicy},origins:{"web-scene":{write:{isRequired:!0}}}}})],g.prototype,"layers",void 0),e.__decorate([s.property({type:m,json:{read:!0,write:{overridePolicy:p.writeNonEmptyCollectionPolicy}}})],g.prototype,"tables",void 0),g=h=e.__decorate([c.subclass("esri.webdoc.applicationProperties.Search")],g),g})},"esri/core/accessorSupport/extensions/serializableProperty/writePolicyUtils":function(){define(["exports"],function(e){"use strict";e.writeNonEmptyCollectionPolicy=function(e){return{enabled:!!e?.length}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/applicationProperties/SearchLayer":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/subclass","./SearchLayerField"],function(e,t,r,o,s,i,n){"use strict";var a;let c=a=class extends t.JSONSupport{constructor(e){super(e),this.field=null,this.id=null,this.subLayer=null}clone(){return new a(r.clone({field:this.field,id:this.id,subLayer:this.subLayer}))}};return e.__decorate([o.property({type:n,json:{write:{isRequired:!0}}})],c.prototype,"field",void 0),e.__decorate([o.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0),e.__decorate([o.property({type:s.Integer,json:{write:!0}})],c.prototype,"subLayer",void 0),c=a=e.__decorate([i.subclass("esri.webdoc.applicationProperties.SearchLayer")],c),c})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../layers/support/fieldType"],function(e,t,r,o,s,i,n,a,c){"use strict";var l;let p=l=class extends t.JSONSupport{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new l({exactMatch:this.exactMatch,type:this.type,name:this.name})}};return e.__decorate([r.property({type:Boolean,json:{write:!0}})],p.prototype,"exactMatch",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],p.prototype,"name",void 0),e.__decorate([n.enumeration(c.kebabDict)],p.prototype,"type",void 0),p=l=e.__decorate([a.subclass("esri.webdoc.applicationProperties.SearchLayerField")],p),p})},"esri/webdoc/applicationProperties/SearchTable":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./SearchTableField"],function(e,t,r,o,s,i,n,a){"use strict";var c;let l=c=class extends t.JSONSupport{constructor(e){super(e),this.field=null,this.id=null}clone(){return new c(r.clone({field:this.field,id:this.id}))}};return e.__decorate([o.property({type:a,json:{write:{isRequired:!0}}})],l.prototype,"field",void 0),e.__decorate([o.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"id",void 0),l=c=e.__decorate([n.subclass("esri.webdoc.applicationProperties.SearchTable")],l),l})},"esri/webdoc/applicationProperties/SearchTableField":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../layers/support/fieldType"],function(e,t,r,o,s,i,n,a,c){"use strict";var l;let p=l=class extends t.JSONSupport{constructor(e){super(e),this.exactMatch=!1,this.name=null,this.type=null}clone(){return new l({exactMatch:this.exactMatch,type:this.type,name:this.name})}};return e.__decorate([r.property({type:Boolean,json:{write:!0}})],p.prototype,"exactMatch",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],p.prototype,"name",void 0),e.__decorate([n.enumeration(c.kebabDict)],p.prototype,"type",void 0),p=l=e.__decorate([a.subclass("esri.webdoc.applicationProperties.SearchTableField")],p),p})},"esri/webscene/Environment":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/lang","../core/Logger","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/decorators/subclass","../views/3d/environment/SunnyWeather","../views/3d/environment/weather","./lightingTypes","./SunLighting","./VirtualLighting","./background/utils"],function(e,t,r,o,s,i,n,a,c,l,p,u,d){"use strict";var h;const y=(e,t,r)=>({enabled:!r?.isPresentation});let m=class extends t.JSONSupport{static{h=this}constructor(e){super(e),this.lighting=new p,this.background=null,this.atmosphereEnabled=!0,this.starsEnabled=!0}set weather(e){c.validateWeatherType(e?.type,o.getLogger(this))&&this._set("weather",e)}clone(){return new h(this.cloneConstructProperties())}cloneConstructProperties(){return{lighting:this.lighting&&"virtual"===this.lighting.type?u.prototype.clone.call(this.lighting):p.prototype.clone.call(this.lighting),background:r.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}}};return e.__decorate([s.property({types:l.lightingTypes,nonNullable:!0,json:{write:!0}})],m.prototype,"lighting",void 0),e.__decorate([s.property(d.backgroundProperty)],m.prototype,"background",void 0),e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:y}}})],m.prototype,"atmosphereEnabled",void 0),e.__decorate([s.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:y}}})],m.prototype,"starsEnabled",void 0),e.__decorate([s.property({types:c.weatherTypes,nonNullable:!0,json:{write:!0},value:new a})],m.prototype,"weather",null),m=h=e.__decorate([n.subclass("esri.webscene.Environment")],m),m})},"esri/views/3d/environment/SunnyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a){"use strict";var c;let l=c=class extends t.JSONSupport{constructor(e){super(e),this.type="sunny",this.cloudCover=.5}clone(){return new c({cloudCover:this.cloudCover})}};return e.__decorate([n.enumeration({sunny:"sunny"}),r.property({json:{write:{isRequired:!0}}})],l.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"cloudCover",void 0),l=c=e.__decorate([a.subclass("esri.views.3d.environment.SunnyWeather")],l),l})},"esri/views/3d/environment/weather":function(){define(["exports","./CloudyWeather","./FoggyWeather","./RainyWeather","./SnowyWeather","./SunnyWeather"],function(e,t,r,o,s,i){"use strict";const n={key:"type",base:i,typeMap:{sunny:i,cloudy:t,rainy:o,snowy:s,foggy:r}},a=Object.keys(n.typeMap);e.cloudsHeight=1e5,e.heightLimit=1e4,e.validateWeatherType=function(e,t){return!!a.includes(e)||(t.error(`"${e}" is not a valid weather type`),!1)},e.weatherTypes=n,e.weatherTypesArray=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a){"use strict";var c;let l=c=class extends t.JSONSupport{constructor(e){super(e),this.type="cloudy",this.cloudCover=.5}clone(){return new c({cloudCover:this.cloudCover})}};return e.__decorate([n.enumeration({cloudy:"cloudy"}),r.property({json:{write:{isRequired:!0}}})],l.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"cloudCover",void 0),l=c=e.__decorate([a.subclass("esri.views.3d.environment.CloudyWeather")],l),l})},"esri/views/3d/environment/FoggyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a){"use strict";var c;let l=c=class extends t.JSONSupport{constructor(e){super(e),this.type="foggy",this.fogStrength=.5}clone(){return new c({fogStrength:this.fogStrength})}};return e.__decorate([n.enumeration({foggy:"foggy"}),r.property({json:{write:{isRequired:!0}}})],l.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"fogStrength",void 0),l=c=e.__decorate([a.subclass("esri.views.3d.environment.FoggyWeather")],l),l})},"esri/views/3d/environment/RainyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a){"use strict";var c;let l=c=class extends t.JSONSupport{constructor(e){super(e),this.type="rainy",this.cloudCover=.5,this.precipitation=.5}clone(){return new c({cloudCover:this.cloudCover,precipitation:this.precipitation})}};return e.__decorate([n.enumeration({rainy:"rainy"}),r.property({json:{write:{isRequired:!0}}})],l.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"cloudCover",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"precipitation",void 0),l=c=e.__decorate([a.subclass("esri.views.3d.environment.RainyWeather")],l),l})},"esri/views/3d/environment/SnowyWeather":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/enumeration","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a){"use strict";var c;let l=c=class extends t.JSONSupport{constructor(e){super(e),this.type="snowy",this.cloudCover=.5,this.precipitation=.5,this.snowCover="disabled"}clone(){return new c({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})}};return e.__decorate([n.enumeration({snowy:"snowy"}),r.property({json:{write:{isRequired:!0}}})],l.prototype,"type",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"cloudCover",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],l.prototype,"precipitation",void 0),e.__decorate([r.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],l.prototype,"snowCover",void 0),l=c=e.__decorate([a.subclass("esri.views.3d.environment.SnowyWeather")],l),l})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(e,t,r){"use strict";const o={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:t,virtual:r}};e.lightingTypes=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/SunLighting":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer"],function(e,t,r,o,s,i,n,a,c){"use strict";var l;let p=class extends t.JSONSupport{static{l=this}constructor(...e){super(...e),this.type="sun",this.date=null,this.directShadowsEnabled=!1,this.displayUTCOffset=null}readDate(e,t){return null!=t.datetime&&new Date(t.datetime)||null}writeDate(e,t,r){t[r]=e.getTime()}readDirectShadowsEnabled(e,t){return!!t.directShadows}writedirectShadowsEnabled(e,t,r){e&&(t[r]=e)}writeDisplayUTCOffset(e,t){null!=e&&(t.displayUTCOffset=e)}clone(){return new l(this.cloneConstructProperties())}cloneConstructProperties(){const e={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};return null!=this.date&&(e.date=new Date(this.date.getTime())),e}};return e.__decorate([r.property({readOnly:!0,type:["sun"],json:{write:!0}})],p.prototype,"type",void 0),e.__decorate([r.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],p.prototype,"date",void 0),e.__decorate([n.reader("date",["datetime"])],p.prototype,"readDate",null),e.__decorate([c.writer("date")],p.prototype,"writeDate",null),e.__decorate([r.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],p.prototype,"directShadowsEnabled",void 0),e.__decorate([n.reader("directShadowsEnabled",["directShadows"])],p.prototype,"readDirectShadowsEnabled",null),e.__decorate([c.writer("directShadowsEnabled")],p.prototype,"writedirectShadowsEnabled",null),e.__decorate([r.property({type:Number,json:{write:!0}})],p.prototype,"displayUTCOffset",void 0),e.__decorate([c.writer("displayUTCOffset")],p.prototype,"writeDisplayUTCOffset",null),p=l=e.__decorate([a.subclass("esri.webscene.SunLighting")],p),p})},"esri/webscene/VirtualLighting":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";var a;let c=class extends t.JSONSupport{static{a=this}constructor(...e){super(...e),this.type="virtual",this.directShadowsEnabled=!1}clone(){return new a(this.cloneConstructProperties())}cloneConstructProperties(){return{directShadowsEnabled:this.directShadowsEnabled}}};return e.__decorate([r.property({readOnly:!0,type:["virtual"],json:{write:{isRequired:!0}}})],c.prototype,"type",void 0),e.__decorate([r.property({type:Boolean,json:{default:!1,name:"directShadows",write:!0}})],c.prototype,"directShadowsEnabled",void 0),c=a=e.__decorate([n.subclass("esri.webscene.VirtualLighting")],c),c})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(e,t,r){"use strict";const o={base:t,key:"type",typeMap:{color:r}},s={types:o,json:{read:(i=o,(e,t,r)=>{if(!e)return e;for(const t in i.typeMap)if(e.type===t){const o=new i.typeMap[t];return o.read(e,r),o}}),write:{overridePolicy:(e,t,r)=>({enabled:!r?.isPresentation})}}};var i;e.backgroundProperty=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/Background":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";let a=class extends t.JSONSupport{constructor(e){super(e)}clone(){throw new Error("Subclasses of Background should implement their own clone method.")}};return e.__decorate([r.property({readOnly:!0,json:{read:!1}})],a.prototype,"type",void 0),a=e.__decorate([n.subclass("esri.webscene.background.Background")],a),a})},"esri/webscene/background/ColorBackground":function(){define(["../../chunks/tslib.es6","../../Color","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../symbols/support/materialUtils","./Background"],function(e,t,r,o,s,i,n,a,c,l){"use strict";var p;let u=p=class extends l{constructor(e){super(e),this.type="color",this.color=new t([0,0,0,1])}clone(){return new p(this.cloneProperties())}cloneProperties(){return{color:this.color.clone()}}};return e.__decorate([n.enumeration({color:"color"},{readOnly:!0}),r.property({json:{write:{isRequired:!0}}})],u.prototype,"type",void 0),e.__decorate([r.property(c.colorAndTransparencyProperty({nonNullable:!0,colorRequiredOnWrite:!0}))],u.prototype,"color",void 0),u=p=e.__decorate([a.subclass("esri.webscene.background.ColorBackground")],u),u})},"esri/webscene/InitialViewProperties":function(){define(["../chunks/tslib.es6","../Viewpoint","../core/Clonable","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../geometry/SpatialReference","../webdoc/support/timeProperties","./Environment","./support/analysisUtils"],function(e,t,r,o,s,i,n,a,c,l,p,u,d){"use strict";let h=class extends(r.ClonableMixin(o.JSONSupport)){constructor(e){super(e),this.analyses=new d.WebSceneAnalysesCollection,this.environment=new u,this.spatialReference=null,this.viewpoint=null,this.timeExtent=null}set viewingMode(e){this._set("viewingMode",e)}};return e.__decorate([s.property(d.webSceneAnalysisCollectionProperty("analyses"))],h.prototype,"analyses",void 0),e.__decorate([s.property({type:u,json:{write:{isRequired:!0}}})],h.prototype,"environment",void 0),e.__decorate([s.property({type:l,json:{default:()=>l.WebMercator}})],h.prototype,"spatialReference",void 0),e.__decorate([s.property({type:["local","global"],json:{default:"global"}})],h.prototype,"viewingMode",null),e.__decorate([s.property({type:t,json:{write:{isRequired:!0}}})],h.prototype,"viewpoint",void 0),e.__decorate([s.property(p.timeExtent)],h.prototype,"timeExtent",void 0),h=e.__decorate([c.subclass("esri.webscene.InitialViewProperties")],h),h})},"esri/webdoc/support/timeProperties":function(){define(["exports","../../core/Error","../../core/accessorSupport/ensureType","../../chunks/TimeExtent"],function(e,t,r,o){"use strict";const s={type:o.TimeExtent,json:{read:{source:"timeExtent",reader:e=>e?Array.isArray(e)?o.TimeExtent.fromArray(e):o.TimeExtent.fromJSON(e):null},write:{writer:(e,r,o,s)=>{e&&(e.isEmpty?s?.messages&&s.messages.push(new t("invalid-timeExtent","TimeExtent cannot be empty")):r[o]=e.toArray())},target:{timeExtent:{type:[[r.Integer,r.Null]]}}}}};e.timeExtent=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/analysisUtils":function(){define(["require","exports","../../chunks/tslib.es6","../../analysis/support/AnalysisOriginWebScene","../../core/Collection","../../core/collectionUtils","../../core/Logger","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a,c,l,p){"use strict";const u=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),d=["slice"];function h(e){return d.includes(e.type)&&e.valid}t.WebSceneAnalysesCollection=class extends s{constructor(e){super(e),this.addHandles([this.on("after-add",e=>{this._setOrigin(e.item)}),this.on("before-remove",e=>{const{origin:t}=e.item;"web-scene"===t?.type&&this._setOrigin(e.item,null)})])}initialize(){for(const e of this.items)this._setOrigin(e)}_setOrigin(e,t=new o){e.origin=t}updateFrom(e){const t=e.analyses.filter(e=>h(e));this.removeAll(),t.length&&this.addMany(t.map(e=>(e.origin=new o,e.clone())))}applyTo(e){e.analyses.destroyMany(e.analyses.filter(({origin:e})=>"web-scene"===e?.type)),e.analyses.addMany(this.map(e=>e.clone()))}toJSON(e){return this.items.filter(h).map(t=>t.toJSON(e))}},t.WebSceneAnalysesCollection=r.__decorate([p.subclass("esri.webscene.support.analysisUtils.WebSceneAnalysesCollection")],t.WebSceneAnalysesCollection);const y={slice:async()=>{const{default:t}=await new Promise((t,r)=>e(["../../analysis/SliceAnalysis"],e=>t(u(e)),r));return t}};t.webSceneAnalysisCollectionProperty=function(e){return{type:t.WebSceneAnalysesCollection,cast:i.castForReferenceSetter,clonable:e=>new t.WebSceneAnalysesCollection({items:e.items.map(e=>e.clone())}),set(r){this._set(e,i.referenceSetter(r,this._get(e),t.WebSceneAnalysesCollection))},json:{read(t,r,o){o?.hooks?.onAfterLoad(()=>async function(e,t,r){if(!t)return;const o=await Promise.allSettled(t.map(e=>async function(e,t){const r=new(await y[e.type]());return r.read(e,t),r}(e,r)));for(const t of o)"fulfilled"===t.status&&e.add(t.value)}(this[e],t,o))},write:{overridePolicy:e=>({enabled:e.length>0})}}}},t.webSceneAnalysisRegistry=y,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/analysis/support/AnalysisOriginWebScene":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";let a=class extends t.Clonable{constructor(e){super(e),this.type="web-scene"}equals(e){return this.type===e.type}};return e.__decorate([r.property()],a.prototype,"type",void 0),a=e.__decorate([n.subclass("esri.analysis.support.AnalysisOriginWebScene")],a),a})},"esri/webscene/Presentation":function(){define(["../chunks/tslib.es6","../core/Clonable","../core/Collection","../core/collectionUtils","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Slide"],function(e,t,r,o,s,i,n,a,c,l,p){"use strict";const u=r.ofType(p);let d=class extends(t.ClonableMixin(s.JSONSupport)){constructor(e){super(e),this.slides=new u}destroy(){this.slides.forEach(e=>e.destroy()),this.slides.removeAll()}set slides(e){e&&(e=e.filter(e=>!!e.viewpoint)),this._set("slides",o.referenceSetter(e,this._get("slides"),u))}};return e.__decorate([i.property({type:u,nonNullable:!0,json:{write:!0}}),n.cast(o.castForReferenceSetter)],d.prototype,"slides",null),d=e.__decorate([l.subclass("esri.webscene.Presentation")],d),d})},"esri/webscene/Slide":function(){define(["require","../chunks/tslib.es6","../Basemap","../Viewpoint","../core/asyncUtils","../core/Clonable","../core/Collection","../core/collectionUtils","../core/JSONSupport","../core/Logger","../core/mathUtils","../core/maybe","../core/promiseUtils","../core/reactiveUtils","../core/time","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/accessorSupport/ensureType","../chunks/vec32","../core/libs/gl-matrix-2/factories/vec3f64","../layers/Layer","../support/basemapEnsureType","../views/support/Scheduler","../webdoc/support/SlideThumbnail","../webdoc/support/timeProperties","./SunLighting","./VirtualLighting","./support/Description","./support/SlideElements","./support/SlideEnvironment","./support/SlideGround","./support/SlideVisibleLayer","./support/Title"],function(e,t,r,o,s,i,n,a,c,l,p,u,d,h,y,m,g,b,_,w,f,S,v,T,E,R,I,L,O,C,P,A,N,j,k,U){"use strict";let x=0;const M=n.ofType(k.SlideVisibleLayer);let F=class extends(i.ClonableMixin(c.JSONSupport)){constructor(e){super(e),this.id=Date.now().toString(16)+"-slide-"+x++,this.title=new U,this.description=new P,this.hidden=!1,this.thumbnail=new I.SlideThumbnail,this.viewpoint=null,this.basemap=null,this.ground=null,this.layout="caption",this.enabledFocusAreas=null,this.environment=new N.SlideEnvironment,this.timeExtent=null,this.elements=new A,this.visibleLayers=new M}destroy(){this.visibleLayers.removeAll(),this.enabledFocusAreas=null,this.basemap=null,this.thumbnail=u.destroyMaybe(this.thumbnail),this.description=null,this.title=null,this.thumbnail=null,this.elements=null}castTitle(e){return"string"==typeof e?new U({text:e}):f.ensureType(U,e)}castDescription(e){return"string"==typeof e?new P({text:e}):f.ensureType(P,e)}castThumbnail(e){return"string"==typeof e?new I.SlideThumbnail({url:e}):f.ensureType(I.SlideThumbnail,e)}castBasemap(e){return E.basemapEnsureType(e)}set visibleLayers(e){this._set("visibleLayers",a.referenceSetter(e,this._get("visibleLayers"),M))}castVisibleLayers(e){return e&&"function"==typeof e.map?e.map(e=>{if("string"==typeof e)return{id:e};if(e instanceof T){const t=J(e);return{id:e.id,sublayerIds:t}}return e.id?{id:e.id,sublayerIds:"sublayerIds"in e?e.sublayerIds:void 0}:(l.getLogger(this).warn('Invalid visible layer, expected { id }, Layer or "id"'),e)}):null}async _updateVisibleLayers(e){const t=[];await Promise.allSettled(this._getLayers(e.map).map(r=>e.whenLayerView(r).then(e=>{if(e.visible){const o=J(r);t.push(new k.SlideVisibleLayer({id:e.layer.id,sublayerIds:o}))}})).toArray()),this.visibleLayers.removeAll(),this.visibleLayers.addMany(t)}async updateFrom(e,t){const r={format:"png",quality:80,width:120,height:75,disableDecorations:!0,...t?.screenshot};await e.when(),this.viewpoint=e.viewpoint.clone(),this.environment.lighting="virtual"===e.environment.lighting.type?C.prototype.clone.apply(e.environment.lighting):O.prototype.clone.apply(e.environment.lighting),this.environment.weather=e.environment.weather.clone(),this.enabledFocusAreas=new n(e.focusAreasView?.enabledAreas.map(({id:e})=>e)??[]),this.basemap=e.map.basemap?.clone()||null,this.ground=e.map.ground?j.fromGround(e.map.ground):null,this.timeExtent=e.timeExtent?.clone()??null,this.elements.analyses.updateFrom(e),await this._updateVisibleLayers(e);const o=await e.takeScreenshot(r);return this.thumbnail=new I.SlideThumbnail({url:o.dataUrl}),this}async applyTo(e,t){null!=this._applyToController&&this._applyToController.abort();let r=new AbortController;this._applyToController=r;const o=d.onAbortOrThrow(t,()=>r?.abort()),i=()=>{this._applyToController===r&&(this._applyToController=null),r=null,o?.remove()};try{await h.whenOnce(()=>e.ready,r.signal)}catch(e){throw i(),e}if(r.signal.aborted)throw i(),d.createAbortError();const n=e.resourceController.scheduler.registerTask(R.TaskPriority.SLIDE);let a=!1;const c={animate:!0,...t,signal:this._applyToController.signal},l=await s.result(e.addUpdatingPromise((async()=>{await Promise.all([n.schedule(async()=>a=await this._setViewpointOfInterest(e,c)),n.schedule(()=>this._applyBasemap(e,c),c.signal),n.schedule(()=>this._loadLayersWithSublayerVisibility(e))]),await Promise.all([n.schedule(()=>this._applyLayerVisibility(e),c.signal),n.schedule(()=>this._applyFocusAreaEnabled(e.map?.focusAreas.areas)),n.schedule(()=>this._applyGround(e),c.signal),n.schedule(()=>this.elements.analyses.applyTo(e),c.signal),n.schedule(()=>this._applyViewpoint(e,c),c.signal),n.schedule(()=>e.timeExtent=this.timeExtent?.clone()??null,c.signal),n.schedule(()=>e.environment.weather=this.environment.weather.clone())])})()));if(a&&(e.contentCamera=null),n.remove(),i(),!1===l.ok)throw l.error;return this}async _applyBasemap(e,t){if(this.basemap){try{await this.basemap.load(t)}catch(e){if(d.isAbortError(e))throw e}e.map.basemap=E.clonePreservingTiledLayers(this.basemap,e.map.basemap)}}_applyGround(e){this.ground&&(e.map.ground=this.ground.cloneAndApplyTo(e.map.ground))}_applyFocusAreaEnabled(e){if(e&&this.enabledFocusAreas)for(const t of e)t.enabled=this.enabledFocusAreas.includes(t.id)}_getLayers(e){const t=new n;return this._collectLayers(e,t),this._collectLayers(e.ground,t),t}_collectLayers(e,t){e.layers.forEach(e=>{e.persistenceEnabled&&(t.add(e),"layers"in e&&this._collectLayers(e,t))})}async _loadLayersWithSublayerVisibility(e){this.visibleLayers&&await Promise.allSettled(this._getLayers(e.map).items.map(e=>{const t=this.visibleLayers.find(t=>t.id===e.id)?.sublayerIds;return t?e.load():null}))}_applyLayerVisibility(e){this.visibleLayers&&this._getLayers(e.map).forEach(e=>{const t=this.visibleLayers.find(t=>t.id===e.id);e.visible=null!=t;const r=t?.sublayerIds,o=G(e);r&&o&&o.forEach(e=>e.visible=r.includes(e.id))})}async _setViewpointOfInterest(t,r){if(t.state.fixedContentCamera||!this.viewpoint||r?.ignoreViewpoint||!r?.useDestinationCamera)return!1;const{toCameraAsync:o}=await new Promise((t,r)=>e(["../views/3d/support/viewpointUtils"],t,r)),s=await o(t,this.viewpoint);return t.contentCamera=s,null!=s}async _applyViewpoint(e,t){if(this._applyCachedCameraTrackingEnabled(e),this.viewpoint&&!t.ignoreViewpoint){const r=this.environment.lighting;if(t.animate&&"sun"===r.type&&r.date)return this._animateToLighting(e,t);t.animate&&(e.environment.applyLighting(r.clone()),await e.goTo(this.viewpoint,t)),e.viewpoint=this.viewpoint}e.environment.applyLighting(this.environment.lighting.clone())}async _animateToLighting(e,t){let r=null;return"virtual"!==e.environment.lighting.type&&"virtual"!==this.environment.lighting.type&&("global"===e.viewingMode&&(r=this._animateLightingWithCamera(e,e.environment.lighting,this.environment.lighting)),e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1),e.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled,"virtual"===this.environment.lighting.type||"virtual"===e.environment.lighting.type?(e.environment.applyLighting(this.environment.lighting.clone()),"virtual"!==e.environment.lighting.type&&(e.environment.cachedCameraTrackingEnabled=e.environment.lighting.cameraTrackingEnabled,e.environment.lighting.cameraTrackingEnabled=!1)):null!=this.environment.lighting.displayUTCOffset&&(e.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset),e.goTo(this.viewpoint,t).then(()=>{this._applyCachedCameraTrackingEnabled(e),e.environment.applyLighting(this.environment.lighting.clone())}).catch(t=>{throw null==e.animation&&this._applyCachedCameraTrackingEnabled(e),t}).finally(()=>{u.removeMaybe(r)})}_applyCachedCameraTrackingEnabled(e){null!=e.environment.cachedCameraTrackingEnabled&&(e.environment.lighting.cameraTrackingEnabled=e.environment.cachedCameraTrackingEnabled,e.environment.cachedCameraTrackingEnabled=null)}_getTime(e){return[y.Milliseconds(e.getTime()),y.Seconds(3600*e.getUTCHours()+60*e.getUTCMinutes()+e.getUTCSeconds())]}_setTime(e,t,r){return e.setTime(t),e.setUTCHours(r/3600),e.setUTCMinutes(r%3600/60),e.setUTCSeconds(r%3600%60),e}_animateLightingWithCamera(e,t,r){const o=new Date(t.date.toString()),[s,i]=this._getTime(o),[n,a]=this._getTime(r.date),c=function(e,t){let r=t-e;return r>q&&(r-=W),r<-q&&(r+=W),y.Seconds(r)}(i,a),l=e.renderCoordsHelper,u=v.create();l.toRenderCoords(e.camera.position,u);const d=v.create(),m=v.create();null!=this.viewpoint.camera&&l.toRenderCoords(this.viewpoint.camera.position,d);const g=new Date;return h.when(()=>e.camera,e=>{l.toRenderCoords(e.position,m);const r=S.squaredDistance(u,m),o=S.squaredDistance(d,m);let a=0;r+o!==0&&(a=r/(r+o));const h=s+(n-s)*a,b=function(e,t){return y.Seconds(p.moduloPositive(e+t,W))}(i,y.Seconds(c*a));t.date=this._setTime(g,h,b)})}write(e,t){const r=super.write(e,t);return r?.elements&&0===Object.keys(r.elements).length&&delete r.elements,r}static createFrom(e,t){return(new this).updateFrom(e,t)}};t.__decorate([m.property({type:String,json:{write:{isRequired:!0}}})],F.prototype,"id",void 0),t.__decorate([m.property({type:U,json:{default:()=>new U({text:""}),write:{isRequired:!0}}})],F.prototype,"title",void 0),t.__decorate([g.cast("title")],F.prototype,"castTitle",null),t.__decorate([m.property({type:P,json:{write:{overridePolicy:e=>({enabled:!(!e||!e.text)})}}})],F.prototype,"description",void 0),t.__decorate([g.cast("description")],F.prototype,"castDescription",null),t.__decorate([m.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!1}})],F.prototype,"hidden",void 0),t.__decorate([m.property({type:I.SlideThumbnail,json:{default:()=>new I.SlideThumbnail({url:""}),write:{isRequired:!0}}})],F.prototype,"thumbnail",void 0),t.__decorate([g.cast("thumbnail")],F.prototype,"castThumbnail",null),t.__decorate([m.property({type:o,nonNullable:!0,json:{write:{isRequired:!0}}})],F.prototype,"viewpoint",void 0),t.__decorate([m.property({type:r,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],F.prototype,"basemap",void 0),t.__decorate([g.cast("basemap")],F.prototype,"castBasemap",null),t.__decorate([m.property({type:j,json:{write:!0}})],F.prototype,"ground",void 0),t.__decorate([m.property({type:["caption","cover","none"],json:{write:!0,default:"caption"},nonNullable:!0})],F.prototype,"layout",void 0),t.__decorate([m.property({type:M,json:{write:{isRequired:!0}}})],F.prototype,"visibleLayers",null),t.__decorate([g.cast("visibleLayers")],F.prototype,"castVisibleLayers",null),t.__decorate([m.property({type:n.ofType(String),json:{write:!0},clonable:e=>e?new n(e.items):null})],F.prototype,"enabledFocusAreas",void 0),t.__decorate([m.property({type:N.SlideEnvironment,json:{write:!0}})],F.prototype,"environment",void 0),t.__decorate([m.property(L.timeExtent)],F.prototype,"timeExtent",void 0),t.__decorate([m.property({type:A,nonNullable:!0,json:{write:!0}})],F.prototype,"elements",void 0),F=t.__decorate([w.subclass("esri.webscene.Slide")],F);const V=F;function G(e){if("building-scene"===e.type||"map-image"===e.type)return e.allSublayers.toArray()}function J(e){const t=G(e);if(t)return t.filter(e=>e.visible).map(e=>e.id)}const W=y.Seconds(86400),q=y.Seconds(43200);return V})},"esri/views/support/Scheduler":function(){define(["exports","../../core/arrayUtils","../../core/Handles","../../core/has","../../core/Logger","../../core/maybe","../../core/PerformanceSampler","../../core/promiseUtils","../../core/reactiveUtils","../../core/signal","../../core/time","../../layers/support/PromiseQueue","./debugFlags","./Yield"],function(e,t,r,o,s,i,n,a,c,l,p,u,d,h){"use strict";const y={RESOURCE_CONTROLLER_IMMEDIATE:"immediate",RESOURCE_CONTROLLER:"schedule",SLIDE:"slide",STREAM_DATA_LOADER:"stream loader",ELEVATION_QUERY:"elevation query",TERRAIN_SURFACE:"terrain",SURFACE_GEOMETRY_UPDATES:"surface geometry updates",LOD_RENDERER:"LoD renderer",GRAPHICS_CORE:"Graphics3D",I3S_CONTROLLER:"I3S",POINT_CLOUD_LAYER:"point cloud",FEATURE_TILE_FETCHER:"feature fetcher",STREAM_CONTROLLER:"stream controller",OVERLAY:"overlay",OVERLAY_RENDERER:"overlay renderer",STAGE:"stage",GRAPHICS_DECONFLICTOR:"graphics deconflictor",FILTER_VISIBILITY:"Graphics3D filter visibility",SCALE_VISIBILITY:"Graphics3D scale visibility",FRUSTUM_VISIBILITY:"Graphics3D frustum visibility",POINT_OF_INTEREST_FREQUENT:"POI frequent",POINT_OF_INTEREST_INFREQUENT:"POI infrequent",LABELER:"labeler",FEATURE_QUERY_ENGINE:"feature query",FEATURE_TILE_TREE:"feature tile tree",FEATURE_TILE_TREE_ACTIVE:"fast feature tile tree",ELEVATION_ALIGNMENT:"elevation alignment",ELEVATION_ALIGNMENT_SCENE:"elevation alignment scene",TEXT_TEXTURE_ATLAS:"text texture atlas",TEXTURE_UNLOAD:"texture unload",LINE_OF_SIGHT_TOOL:"line of sight tool",LINE_OF_SIGHT_TOOL_INTERACTIVE:"interactive line of sight tool",ELEVATION_PROFILE:"elevation profile",SNAPPING:"snapping",SHADOW_ACCUMULATOR:"shadow accumulator",CLOUDS_GENERATOR:"clouds generator",FLOW_GENERATOR:"flow generator",MAPVIEW_FETCH_QUEUE:"mapview fetch queue",MAPVIEW_LAYERVIEW_UPDATE:"mapview layerview update",MAPVIEW_VECTOR_TILE_PARSING_QUEUE:"mapview vector tile parsing queue",NONE:0,TEST_PRIO:1},m=new Map([[y.RESOURCE_CONTROLLER_IMMEDIATE,0],[y.RESOURCE_CONTROLLER,4],[y.SLIDE,0],[y.STREAM_DATA_LOADER,0],[y.ELEVATION_QUERY,0],[y.TERRAIN_SURFACE,1],[y.SURFACE_GEOMETRY_UPDATES,1],[y.LOD_RENDERER,2],[y.GRAPHICS_CORE,2],[y.I3S_CONTROLLER,2],[y.POINT_CLOUD_LAYER,2],[y.FEATURE_TILE_FETCHER,2],[y.STREAM_CONTROLLER,2],[y.CLOUDS_GENERATOR,2],[y.OVERLAY,4],[y.OVERLAY_RENDERER,4],[y.STAGE,4],[y.GRAPHICS_DECONFLICTOR,4],[y.FILTER_VISIBILITY,4],[y.SCALE_VISIBILITY,4],[y.FRUSTUM_VISIBILITY,4],[y.POINT_OF_INTEREST_FREQUENT,6],[y.POINT_OF_INTEREST_INFREQUENT,30],[y.LABELER,8],[y.FEATURE_QUERY_ENGINE,8],[y.FEATURE_TILE_TREE,16],[y.FEATURE_TILE_TREE_ACTIVE,0],[y.ELEVATION_ALIGNMENT,12],[y.ELEVATION_ALIGNMENT_SCENE,14],[y.TEXT_TEXTURE_ATLAS,12],[y.TEXTURE_UNLOAD,12],[y.LINE_OF_SIGHT_TOOL,16],[y.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[y.SNAPPING,0],[y.SHADOW_ACCUMULATOR,30],[y.FLOW_GENERATOR,12],[y.MAPVIEW_FETCH_QUEUE,0],[y.MAPVIEW_LAYERVIEW_UPDATE,2],[y.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function g(e){return m.has(e)?m.get(e):"number"==typeof e?e:1}const b=p.Milliseconds(6.5),_=p.Milliseconds(1),w=p.Milliseconds(30),f=p.Milliseconds(1e3/30),S=p.Milliseconds(100);class v{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(e=>e.needsUpdate)}constructor(){this._updating=l.signal(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new n("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new E,this._state=1,this._tasks=new Array,this._runQueue=new Array,this._load=0,this._idleStateCallbacks=new Array,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=c.watch(()=>d.SCHEDULER_LOG_SLOW_TASKS,e=>this._debug=e,c.initial);for(const e of Object.keys(y))this.performanceInfo.tasks.set(y[e],new n(String(y[e])))}destroy(){this._tasks.forEach(e=>e.remove()),this._tasks.length=0,this._idleStateCallbacks.length=0,this._runQueue.length=0,i.removeMaybe(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())}))}registerTask(e,t){const r=new T(this,e,t);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new n(e)),r}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),2===this.state&&this._idleUpdatesStartFired&&r.idleBegin();const o=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){o._idleUpdatesStartFired&&(r.idleEnd(),2===o._state&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forEach(e=>e.idleEnd())))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=b,r=e.frameDuration,o=_;switch(this.state){case 2:t=p.Milliseconds(0),r=p.Milliseconds(Math.max(S,e.frameDuration)),o=w;break;case 1:r=p.Milliseconds(Math.max(f,e.frameDuration))}return r=p.Milliseconds(r-e.elapsedFrameTime-t),2!==this.state&&r<_&&!this._forceTask?(this._forceTask=!0,!1):(r=p.Milliseconds(Math.max(r,o)),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forEach(e=>e.idleBegin())),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(p.Milliseconds(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),t.removeUnordered(this._idleStateCallbacks,e)}removeTask(e){t.removeUnordered(this._tasks,e),t.removeUnordered(this._runQueue,e),this._updatingChanged()}_updateTask(e){this._tasks.forEach(t=>{t.name===e&&t.setPriority(e)})}_getState(e){if(this._runQueue.some(t=>t.name===e))return"s";let t="i";return this._tasks.forEach(r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t="r":"r"!==t&&(t="w"))}),t}_getRuntime(e){let t=0;return this._tasks.forEach(r=>{r.name===e&&(t+=r.runtime)}),t}_resetRuntimes(){this._tasks.forEach(e=>e.runtime=0)}_getRunning(){const e=new Map;if(this._tasks.forEach(t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)}),0===e.size)return null;let t="";return e.forEach((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`}),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce((e,t)=>t.needsUpdate?++e:e,0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(t.filterInPlace(this._runQueue,e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)),this._tasks.forEach(e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)});0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forEach(r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)}),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const e=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.task.runTask(this._budget)===h.Yield&&(t.blockFrame=this._frameNumber)}catch(e){s.getLogger("esri.views.support.Scheduler").error(`Exception in task "${t.name}"`,e),t.blockFrame=this._frameNumber}!this._budget.hasProgressed&&t.blockFrame!==this._frameNumber&&t.needsUpdate&&(t.name,t.blockFrame=this._frameNumber),t.schedulePriority=t.basePriority;const r=this._budget.now()-e;if(t.runtime+=r,this._frameTaskTimes.set(t.priority,this._frameTaskTimes.get(t.priority)+r),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(y))this._frameTaskTimes.set(y[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach((e,t)=>this.performanceInfo.tasks.get(t).push(e)),this.performanceInfo.total.push(e)}get test(){return this._test}}class T{get task(){return this._task.value}get readyToRun(){return this._queue.readyToRun}get updating(){return this._queue.updating}constructor(e,t,o){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new u.PromiseQueue,this._handles=new r,this._basePriority=g(t),this.schedulePriority=this._basePriority,this._task=l.signal(null!=o?o:this._queue),this._handles.add(c.when(()=>this.task.readyToRun,t=>e.taskRunningChanged(t)))}remove(){this.processQueue(R),this._scheduler.removeTask(this),this.schedule=I.schedule,this.reschedule=I.reschedule,this.scheduleGenerator=I.scheduleGenerator,this.rescheduleGenerator=I.rescheduleGenerator,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=g(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.readyToRun||!this.task.destroyed&&this.task.readyToRun}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}scheduleGenerator(e,t,r){return this._queue.pushGenerator(e,t,r)}rescheduleGenerator(e,t,r){return this._queue.unshiftGenerator(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class E{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}const R=new E;R.enabled=!1;const I=new class{remove(){}processQueue(){}schedule(e,t,r){try{if(a.isAborted(t)){const e=a.createAbortError();return r?Promise.resolve(r(e)):Promise.reject(e)}return a.when(e(R))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}async scheduleGenerator(e,t,r){if(a.isAborted(t)){const e=a.createAbortError();if(r)return r(e);throw e}const o=e(R);for(;;){const e=o.next(R),s=a.isPromiseLike(e)?await e:e;if(a.isAborted(t)){const e=a.createAbortError();if(r)return r(e);throw e}if(s.done)return s.value}}rescheduleGenerator(e,t,r){return this.rescheduleGenerator(e,t,r)}};e.ImmediateTask=I,e.TaskPriority=y,e.getTaskPriority=g,e.makeBudget=function(e){const t=new E;return t.reset(e),t},e.newScheduler=function(){return new v},e.noBudget=R,e.taskPriorities=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/compilerUtils","../../core/Logger","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(e,t,r,o,s,i){"use strict";function n(e){o.isPromiseLike(e)?e.then(a):a(e)}function a(e){e.done||r.getLogger("esri.layers.support.PromiseQueue").warn("Generator iterator was aborted, but it is not done.")}class c{constructor(e,t,r=void 0,o=void 0){this.resolve=e,this.reject=t,this.signal=r,this.abortCallback=o}}class l extends c{constructor(e,t,r,o,s){super(e,t,o,s),this.callback=r,this.type=0}}class p extends c{constructor(e,t,r,o,s,i){super(e,t,o,s),this.generatorFunction=r,this.scheduleFunction=i,this.type=1}}class u extends c{constructor(e,t,r,o,s,i){super(e,t,o,s),this.iterator=r,this.scheduleFunction=i,this.type=2}}e.PromiseQueue=class{constructor(){this._tasks=new Array,this._numPendingTasks=s.signal(0),this._readyToRun=s.signal(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get readyToRun(){return this._readyToRun.value}_updateReadyToRun(){this._readyToRun.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return i.Yield;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return this._addTask((o,s)=>new l(o,s,e,t,r),Array.prototype.push)}unshift(e,t,r){return this._addTask((o,s)=>new l(o,s,e,t,r),Array.prototype.unshift)}pushGenerator(e,t,r){const o=Array.prototype.push;return this._addTask((s,i)=>new p(s,i,e,t,r,o),o)}unshiftGenerator(e,t,r){const o=Array.prototype.unshift;return this._addTask((s,i)=>new p(s,i,e,t,r,o),o)}_process(e){if(0===this._tasks.length)return!1;const r=this._tasks.shift();this._updateReadyToRun();try{if(o.isAborted(r.signal))this._cancelTask(r,o.createAbortError());else switch(r.type){case 0:this._processSimple(r,e);break;case 1:this._processGenerator(r,e);break;case 2:this._processIterator(r,e);break;default:t.neverReached(r)}}catch(e){r.reject(e)}return!0}cancelAll(){const e=o.createAbortError();for(const t of this._tasks)this._cancelTask(t,e);this._tasks.length=0,this._updateReadyToRun()}_cancelTask(e,t){if(e.abortCallback){const r=e.abortCallback(t);2===e.type&&e.iterator.return&&n(e.iterator.return()),o.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}else 2===e.type&&e.iterator.throw&&n(e.iterator.throw(t)),e.reject(t)}_onIteratorResult(e,t){t.done?e.resolve(t.value):(e.scheduleFunction.call(this._tasks,e),this._updateReadyToRun())}_processSimple(e,t){const r=e.callback(t);o.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}_processGenerator(e,t){const r=e.generatorFunction(t),o=new u(e.resolve,e.reject,r,e.signal,e.abortCallback,e.scheduleFunction);this._processIterator(o,t)}_processIterator(e,t){const r=e.iterator.next(t);o.isPromiseLike(r)?r.then(t=>this._onIteratorResult(e,t),e.reject):this._onIteratorResult(e,r)}_addTask(e,t){return new Promise((r,o)=>{const s=e(r,o);t.call(this._tasks,s),++this._numPendingTasks.value,this._updateReadyToRun()}).finally(()=>--this._numPendingTasks.value)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Yield":function(){define(["exports"],function(e){"use strict";const t=Symbol("Yield");e.Yield=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";let a=class extends t{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};return e.__decorate([r.property()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),e.__decorate([r.property()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=e.__decorate([n.subclass("esri.views.support.debugFlags")],a),new a})},"esri/webdoc/support/SlideThumbnail":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/urlUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a,c){"use strict";var l;e.SlideThumbnail=l=class extends r.JSONSupport{constructor(){super(...arguments),this.url=""}destroy(){this.url=""}get isSecureUrl(){return o.isHTTPSProtocol(this.url)}get isDataURI(){return o.isDataProtocol(this.url)}clone(){return new l({url:this.url})}},t.__decorate([s.property({type:String,json:{write:{isRequired:!0}}})],e.SlideThumbnail.prototype,"url",void 0),t.__decorate([s.property()],e.SlideThumbnail.prototype,"isSecureUrl",null),t.__decorate([s.property()],e.SlideThumbnail.prototype,"isDataURI",null),e.SlideThumbnail=l=t.__decorate([c.subclass("esri.webdoc.support.SlideThumbnail")],e.SlideThumbnail),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/Description":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a){"use strict";let c=class extends(t.ClonableMixin(r.JSONSupport)){constructor(){super(...arguments),this.text=""}};return e.__decorate([o.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"text",void 0),c=e.__decorate([a.subclass("esri.webscene.support.Description")],c),c})},"esri/webscene/support/SlideElements":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../SlideLegendInfo","./analysisUtils","./SlidePopupInfo"],function(e,t,r,o,s,i,n,a,c,l,p){"use strict";let u=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.analyses=new l.WebSceneAnalysesCollection,this.legendInfo=null,this.popupInfo=null}};return e.__decorate([o.property(l.webSceneAnalysisCollectionProperty("analyses"))],u.prototype,"analyses",void 0),e.__decorate([o.property({type:c,json:{write:!0}})],u.prototype,"legendInfo",void 0),e.__decorate([o.property({type:p,json:{write:!0}})],u.prototype,"popupInfo",void 0),u=e.__decorate([a.subclass("esri.webscene.support.SlideElements")],u),u})},"esri/webscene/SlideLegendInfo":function(){define(["../chunks/tslib.es6","../core/Clonable","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s){"use strict";let i=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.visible=!1}};return e.__decorate([o.property({type:Boolean,json:{default:!1,write:!0}})],i.prototype,"visible",void 0),i=e.__decorate([s.subclass("esri.webscene.SlideLegendInfo")],i),i})},"esri/webscene/support/SlidePopupInfo":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/Collection","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","../../geometry/Point","./FeatureReference"],function(e,t,r,o,s,i,n,a){"use strict";const c=r.ofType(a);let l=class extends(t.ClonableMixin(o.JSONSupport)){constructor(e){super(e),this.features=new c,this.selectedFeatureIndex=0,this.location=null}};return e.__decorate([s.property({type:c,nonNullable:!0,json:{read:!0,write:{isRequired:!0}}})],l.prototype,"features",void 0),e.__decorate([s.property({type:Number,nonNullable:!0,json:{write:!0}})],l.prototype,"selectedFeatureIndex",void 0),e.__decorate([s.property({type:n,json:{write:{isRequired:!0}}})],l.prototype,"location",void 0),l=e.__decorate([i.subclass("esri.webscene.support.SlidePopupInfo")],l),l})},"esri/webscene/support/FeatureReference":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./FeatureReferenceObjectId","./featureReferenceUtils","./LayerReference"],function(e,t,r,o,s,i,n,a,c,l,p){"use strict";let u=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.layerReference=new p,this.id=new c}};return e.__decorate([o.property({nonNullable:!0,json:{write:{isRequired:!0}},type:p})],u.prototype,"layerReference",void 0),e.__decorate([o.property({json:{read:!0,write:{isRequired:!0}},nonNullable:!0,types:l.featureReferenceIdType})],u.prototype,"id",void 0),u=e.__decorate([a.subclass("esri.webscene.support.FeatureReference")],u),u})},"esri/webscene/support/FeatureReferenceObjectId":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","./FeatureReferenceId"],function(e,t,r,o,s){"use strict";let i=class extends s{constructor(e){super(e),this.type="object-id",this.value=null}};return e.__decorate([t.enumeration({objectId:"object-id"}),r.property({type:["object-id"],json:{read:!1,write:{isRequired:!0}},nonNullable:!0})],i.prototype,"type",void 0),e.__decorate([r.property({type:[Number,String],json:{read:!0,write:{isRequired:!0}}})],i.prototype,"value",void 0),i=e.__decorate([o.subclass("esri.webscene.support.FeatureReferenceObjectId")],i),i})},"esri/webscene/support/FeatureReferenceId":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i){"use strict";const n=new r.JSONMap({globalId:"global-id",objectId:"object-id"},{ignoreUnknown:!0});let a=class extends(t.ClonableMixin(o.JSONSupport)){constructor(e){super(e),this.type=null}};return e.__decorate([s.property({type:n.apiValues,readOnly:!0,json:{type:n.jsonValues,read:!1,write:!0}})],a.prototype,"type",void 0),a=e.__decorate([i.subclass("esri.webscene.support.FeatureReferenceId")],a),a})},"esri/webscene/support/featureReferenceUtils":function(){define(["exports","./FeatureReferenceGlobalId","./FeatureReferenceId","./FeatureReferenceObjectId"],function(e,t,r,o){"use strict";const s={key:"type",base:r,typeMap:{"object-id":o,"global-id":t}};e.featureReferenceIdType=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/FeatureReferenceGlobalId":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","./FeatureReferenceId"],function(e,t,r,o,s){"use strict";let i=class extends s{constructor(e){super(e),this.type="global-id",this.value=null}};return e.__decorate([t.enumeration({globalId:"global-id"}),r.property({type:["global-id"],json:{read:!1,write:{isRequired:!0}},nonNullable:!0})],i.prototype,"type",void 0),e.__decorate([r.property({type:String,json:{read:!0,write:{isRequired:!0}}})],i.prototype,"value",void 0),i=e.__decorate([o.subclass("esri.webscene.support.FeatureReferenceGlobalId")],i),i})},"esri/webscene/support/LayerReference":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s){"use strict";let i=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.layerId=null,this.sublayerId=null}};return e.__decorate([o.property({type:String,json:{write:{isRequired:!0}},nonNullable:!0})],i.prototype,"layerId",void 0),e.__decorate([o.property({type:Number,json:{write:!0}})],i.prototype,"sublayerId",void 0),i=e.__decorate([s.subclass("esri.webscene.support.LayerReference")],i),i})},"esri/webscene/support/SlideEnvironment":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../views/3d/environment/SunnyWeather","../../views/3d/environment/weather","../lightingTypes","../SunLighting"],function(e,t,r,o,s,i,n,a,c,l,p,u,d){"use strict";e.SlideEnvironment=class extends(r.ClonableMixin(o.JSONSupport)){constructor(){super(...arguments),this.lighting=new d,this.weather=new l}},t.__decorate([s.property({types:u.lightingTypes,json:{write:!0}})],e.SlideEnvironment.prototype,"lighting",void 0),t.__decorate([s.property({types:p.weatherTypes,json:{write:!0}})],e.SlideEnvironment.prototype,"weather",void 0),e.SlideEnvironment=t.__decorate([c.subclass("esri.webscene.support.SlideEnvironment")],e.SlideEnvironment),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/SlideGround":function(){define(["../../chunks/tslib.es6","../../Ground","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../webdoc/support/opacityUtils"],function(e,t,r,o,s,i,n,a,c,l){"use strict";var p;const u={type:Number,json:{type:i.Integer,name:"transparency",read:l.transparencyToOpacity,write:(e,t,r)=>{t[r]=l.opacityToTransparency(e)}}};let d=p=class extends(r.ClonableMixin(o.JSONSupport)){constructor(){super(...arguments),this.opacity=null}cloneAndApplyTo(e){return null==this.opacity||((e=e?.clone()??new t).opacity=this.opacity),e}static fromGround(e){return new p({opacity:e.opacity})}};return e.__decorate([s.property(u)],d.prototype,"opacity",void 0),d=p=e.__decorate([c.subclass("esri.webscene.support.SlideGround")],d),d})},"esri/webscene/support/SlideVisibleLayer":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a,c){"use strict";e.SlideVisibleLayer=class extends(r.ClonableMixin(o.JSONSupport)){constructor(e){super(e),this.id="",this.sublayerIds=null}},t.__decorate([s.property({type:String,json:{write:!0}})],e.SlideVisibleLayer.prototype,"id",void 0),t.__decorate([s.property({type:[i.Integer],json:{name:"subLayerIds",write:!0}})],e.SlideVisibleLayer.prototype,"sublayerIds",void 0),e.SlideVisibleLayer=t.__decorate([c.subclass("esri.webscene.support.SlideVisibleLayer")],e.SlideVisibleLayer),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/Title":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a){"use strict";let c=class extends(t.ClonableMixin(r.JSONSupport)){constructor(){super(...arguments),this.text=""}};return e.__decorate([o.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"text",void 0),c=e.__decorate([a.subclass("esri.webscene.support.Title")],c),c})},"esri/webscene/TransportationNetwork":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";var a;let c=a=class extends t.JSONSupport{constructor(e){super(e)}clone(){return new a({name:this.name,path:this.path,title:this.title})}};return e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"name",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"path",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"title",void 0),c=a=e.__decorate([n.subclass("esri.webscene.TransportationNetwork")],c),c})},"esri/webscene/Version":function(){define(["exports","../core/Version"],function(e,t){"use strict";class r extends t.Version{constructor(e,t){super(e,t,"webscene")}get supportsGround(){return this.greaterEqual(1,8)}get supportsVisibleElevationLayersInSlides(){return this.lessThan(1,8)}}e.Version=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/AlphaCutoff":function(){define(["exports"],function(e){"use strict";e.alphaCutoff=1/255.5,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/schemaValidatorLoader":function(){define(["exports"],function(e){"use strict";let t=null;e.getLoader=function(){return t},e.registerLoader=function(e){t=e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["require","./chunks/tslib.es6","./kernel","./Map","./core/Collection","./core/Error","./core/lang","./core/Loadable","./core/loadAll","./core/Logger","./core/maybe","./core/MultiOriginJSONSupport","./core/Promise","./core/promiseUtils","./core/reactiveUtils","./core/urlUtils","./core/Warning","./core/accessorSupport/decorators/property","./core/has","./core/accessorSupport/decorators/reader","./core/accessorSupport/decorators/subclass","./core/accessorSupport/decorators/writer","./core/accessorSupport/originUtils","./core/accessorSupport/read","./geometry/Extent","./geometry/HeightModelInfo","./geometry/projectionUtils","./geometry/SpatialReference","./geometry/support/heightModelInfoUtils","./geometry/support/jsonUtils","./geometry/support/spatialReferenceUtils","./portal/Portal","./portal/PortalItem","./portal/support/jsonContext","./portal/support/portalItemUtils","./support/basemapUtils","./support/MapFloorInfo","./support/tagSymbols","./support/webSceneUtils","./views/support/spatialReferenceSupport","./webdoc/Widgets","./webdoc/support/resourceUtils","./webdoc/support/saveUtils","./webdoc/support/thumbnailUtils","./webdoc/support/webdocSaveUtils","./webscene/ApplicationProperties","./webscene/Environment","./webscene/InitialViewProperties","./webscene/Presentation","./webscene/TransportationNetwork","./webscene/Version","./webscene/support/AlphaCutoff","./webscene/support/schemaValidatorLoader"],function(e,t,r,o,s,i,n,a,c,l,p,u,d,h,y,m,g,b,_,w,f,S,v,T,E,R,I,L,O,C,P,A,N,j,k,U,x,M,F,V,G,J,W,q,D,B,K,H,$,Q,Y,z,X){"use strict";var Z;const ee=new Y.Version(1,38),te="Web Scene";let re=class extends(a.LoadableMixin(d.EsriPromiseMixin(u.MultiOriginJSONMixin(o)))){static{Z=M.WebSceneTag}constructor(e){super(e),this[Z]=!0,this._layersIdGCTimeoutId=void 0,this._updateFromPromise=null,this._afterLoadHooks=[],this.applicationProperties=null,this.clippingArea=null,this.clippingEnabled=!1,this.floorInfo=null,this.heightModelInfo=void 0,this.sourceVersion=null,this.transportationNetworks=null,this.presentation=new $,this.initialViewProperties=new H,this.portalItem=null,this.resourceInfo=null,this.widgets=null,this._debouncedSaveOperations=h.debounce(async(e,t,r)=>{switch(e){case 0:return this._saveImpl(t);case 1:return this._saveAsImpl(r,t)}}),this._loadContext={origin:"web-scene",initiator:this,hooks:{onAfterLoad:e=>this._afterLoadHooks.push(e)}},this._resourceReferences={portalItem:null,paths:[]},this.authoringApp=null,this.authoringAppVersion=null,this._isAuthoringAppSetByUser=!1,this._isAuthoringAppVersionSetByUser=!1}initialize(){if(this.when().catch(e=>{l.getLogger(this).error("#load()","Failed to load web scene",e)}),this.resourceInfo){let e;try{e=this._validateJSON(this.resourceInfo)}catch(e){return void this.addResolvingPromise(Promise.reject(e))}this.read(e),this.addResolvingPromise(this._validateSpatialReference()),this.addResolvingPromise(this._validateHeightModelInfo())}this.addHandles(y.on(()=>this.allLayers,"change",()=>this._scheduleLayersIdGC()))}destroy(){this._unscheduleLayersIdGC(),this.presentation&&this.presentation.destroy(),this.portalItem=p.destroyMaybe(this.portalItem)}writeClippingArea(e,t){t.clippingArea||(t.clippingArea={}),t.clippingArea.geometry=e.toJSON()}readClippingEnabled(e,t){return!!t.clippingArea&&!!t.clippingArea.clip}writeClippingEnabled(e,t){this.clippingArea&&(t.clippingArea||(t.clippingArea={}),t.clippingArea.clip=e)}writeLayers(e,t,r,o){t[r]=this._layersToJSON(e,"operational-layers",o)}get loaded(){return super.loaded}readSourceVersion(e,t){const[r,o]=t.version.split(".");return new Y.Version(parseInt(r,10),parseInt(o,10))}writeSourceVersion(e,t,r){t[r]=`${ee.major}.${ee.minor}`}writeTables(e,t,r,o){const s=this._layersToJSON(e,"tables",o);s.length&&(t[r]=s)}get thumbnailUrl(){return this.portalItem?.thumbnailUrl??null}set thumbnailUrl(e){e?this._override("thumbnailUrl",e):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}set authoringApp(e){this._isAuthoringAppSetByUser=!0,this._set("authoringApp",e)}writeAuthoringApp(e,t){e&&this._isAuthoringAppSetByUser?t.authoringApp=e:t.authoringApp="ArcGIS API for JavaScript"}set authoringAppVersion(e){this._isAuthoringAppVersionSetByUser=!0,this._set("authoringAppVersion",e)}writeAuthoringAppVersion(e,t){e&&this._isAuthoringAppVersionSetByUser?t.authoringAppVersion=e:t.authoringAppVersion=r.version}writeGround(e,t,r,o){t[r]=e?e.write({},o):{transparency:0,layers:[]}}readInitialViewProperties(e,t,r){const{viewingMode:o,spatialReference:s}=t,i=new H,n={...t.initialState};return void 0!==s&&(n.spatialReference=s),void 0!==o&&(n.viewingMode=o),i.read(n,r),i}get spatialReference(){return this.initialViewProperties?.spatialReference??L.WebMercator}get viewingMode(){return this.initialViewProperties?.viewingMode??"global"}load(e){const t=this.ground;return this.addResolvingPromise(this._loadFromSource().then(()=>{t&&t!==this.ground&&t.destroy(),this._validateFeatureLayerSymbolVisibility()})),Promise.resolve(this)}loadAll(){return c.loadAll(this,e=>{const t=this.presentation&&this.presentation.slides;e(this.ground,this.basemap,this.layers,t&&t.map(e=>e.basemap),this.tables)})}read(e,t){t??=this._loadContext,t.origin="web-scene";const r=this._isAuthoringAppVersionSetByUser,o=this._isAuthoringAppSetByUser;if(T.readLoadable(this,e,t=>super.read(e,t),t),o||(this._isAuthoringAppSetByUser=!1),r||(this._isAuthoringAppVersionSetByUser=!1),e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion?.supportsVisibleElevationLayersInSlides){const t=e.baseMap.elevationLayers.map(e=>({id:e.id})),r=this.presentation.slides,o=t.filter(e=>!r.some(t=>t.visibleLayers.some(t=>t.id===e.id)));r.forEach(e=>e.visibleLayers.addMany(o))}}_writeBasemapElevationLayers(e){const t=e.ground?.layers;!e.baseMap&&t?.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]}),e.baseMap&&(e.baseMap.elevationLayers=n.clone(t))}_layersToJSON(e,t,r){const o={...r,layerContainerType:t};return e.map(e=>this._verifyWritableLayer(e,r)?e.write({},o):null).filter(e=>!!e).toArray()}_verifyWritableLayer(e,t){return!!e.persistenceEnabled&&("write"in e||(t?.messages&&t.messages.push(new i("layer:unsupported",`Layers (${e.title}, ${e.id}) of type '${e.declaredClass}' cannot be persisted in web scenes`,{layer:e})),!1))}write(e,t){if("loaded"!==this.loadStatus){const e=new i("webscene:not-loaded","Web scene must be loaded before it can be serialized");throw l.getLogger(this).error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),e}this._runLayersIdGC();const r=!t?.messages;t={messages:[],...t,origin:"web-scene"};const o=super.write(e,t);if(r){const e=t.messages?.filter(e=>"web-document-write:property-required"===e.name)??[];if(e.length){const t=new i("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:e});throw l.getLogger(this).error("#toJSON()","One or more properties that are required in the webscene JSON are missing",e),t}}return this._writeBasemapElevationLayers(o),o}async save(e){return this._debouncedSaveOperations(0,e)}async _saveImpl(e){if(!this.portalItem)throw new i("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene");if(this.portalItem?.type!==te)throw new i("webscene:portal-item-wrong-type",`Portal item needs to have type "${te}"`);const t=this._updateFromPromise;await this._ensureLoadBeforeSave();const r=this._enableVerifyItemRelativeUrls(j.createForItemWrite(this.portalItem,"web-scene",!0)),o=this.write({},r);return await Promise.all(r.resources.pendingOperations),await this._verifySave(o,r,0,e),this._updateTypeKeywords(this.portalItem),await J.updateItemWithResources(this.portalItem,o,this._resourceReferences,r),v.updateOrigins(r),t&&await t,await this._saveThumbnail(),this.portalItem}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}async _saveAsImpl(e,t){let r=N.from(e);if(!r)throw new i("webscene:portal-item-required","saveAs requires a portal item to save to");r.id&&(r=r.clone(),r.id=null);const o=r.portal||A.getDefault();await this._ensureLoadBeforeSave(),r.type=te,r.portal=o;const s=this._enableVerifyItemRelativeUrls(j.createForItemWrite(r,"web-scene",!0)),n=this.write({},s);await Promise.all(s.resources.pendingOperations),await this._verifySaveAs(n,s,t);const a=this.thumbnailUrl,c=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(r),await o.signIn();const l=this.portalItem,p={item:l,authenticated:!(!l?.id||!l.portal.user)},{copyAllowed:d,itemReloaded:h}=await D.isCopyAllowed(p,o);if(p.authenticated||=h,!d)throw new i(`${s.name}:save-as-copy-not-allowed`,"Owner of this map does not allow others to save a copy");const y={...t,copyAllResources:!0};return await D.initializeNewItem(r,p,n,y)&&(this._resourceReferences.portalItem=r),await J.saveResources(this._resourceReferences,s),this.portalItem=r,u.MultiOriginJSONSupport.prototype.read.call(this,{version:n.version,authoringApp:n.authoringApp,authoringAppVersion:n.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:r.itemUrl?m.urlToObject(r.itemUrl):void 0}),v.updateOrigins(s),a&&(this.thumbnailUrl=c?m.addQueryParameter(a,"w","8192"):a),s.portalItem=r,await this._saveThumbnail(),r}async _saveThumbnail(){this._isOverridden("thumbnailUrl")&&(await(this.portalItem?.updateThumbnail({thumbnail:this.thumbnailUrl})),this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}async _verifySave(e,t,r,o){if(!P.isEarth(this.spatialReference))throw new i("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently.");const{ignoreUnsupported:s,requiredPropertyChecksDisabled:n,strictSchemaValidationEnabled:a}=o||{};W.evaluateWriteErrors(t,{errorName:"webscene:save"},{ignoreUnsupported:s,supplementalUnsupportedErrors:["scenemodification:unsupported"],requiredPropertyChecksDisabled:n});const c=X.getLoader();if(a&&c){const t=(await c()).validate(e);if(!t.length)return;const o=`webscene did not validate:\n${t.join("\n")}`;l.getLogger(this).error(`${1===r?"saveAs":"save"}(): ${o}`);const s=t.map(e=>new i("webscene:schema-validation",e));throw F.createSchemaValidationError(s)}}_verifySaveAs(e,t,r){return this._verifySave(e,t,1,r)}verifySaveAs(e){const t=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),r=this.write({},t);return this._verifySaveAs(r,t,e)}canNotSaveAs(){return!1}async updateFrom(e,t={}){const r=this._updateFrom(e,t);this._updateFromPromise=r,await r,this._updateFromPromise===r&&(this._updateFromPromise=null)}async _updateFrom(e,t={}){if(await e.whenReady(),!t.environmentExcluded&&e.environment&&(this.initialViewProperties.environment=K.prototype.clone.apply(e.environment)),!t.viewpointExcluded&&e.viewpoint&&(this.initialViewProperties.viewpoint=e.viewpoint.clone()),this.initialViewProperties.spatialReference=e.spatialReference.clone(),this.initialViewProperties.viewingMode=e.viewingMode,this.initialViewProperties.timeExtent=e.timeExtent?.clone()??null,this.initialViewProperties.analyses.updateFrom(e),null!=e.clippingArea?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone()),e.map===this)for(const t of e.allLayerViews){const e="visible";e in t&&e in t.layer&&t._isOverridden(e)&&(t.layer[e]=t[e])}if(!t.widgetsExcluded)for(const t of e.persistableViewModels)t.updateWebDocument(this);(!1===t.thumbnailExcluded||null==t.thumbnailExcluded&&!t.viewpointExcluded)&&await this.updateThumbnail(e,{size:t.thumbnailSize})}async updateThumbnail(e,t){const r=q.getOptimalThumbnailSize(e,t?.size),o=await e.takeScreenshot({format:"jpg",width:r.width,height:r.height,disableDecorations:!0});this.thumbnailUrl=o.dataUrl}async _loadFromSource(){this.resourceInfo?await this._loadFromJSON(this.resourceInfo):this.portalItem?.id?await this._loadFromItem(this.portalItem):await this._loadObjectsWithLayers(),await this._afterLoad()}async _afterLoad(){for(;this._afterLoadHooks.length;){const e=this._afterLoadHooks.slice();this._afterLoadHooks.length=0,await Promise.allSettled(e.map(e=>e(this._loadContext)))}}_readAndLoadFromJSON(e){const t=this._loadContext,r=this._validateJSON(e);return this.read(r,t),this._loadFromJSON(r)}_extractOperationalLayers(e){const t=[];if(!this.sourceVersion?.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(const r of e.baseMap.elevationLayers)t.push(r);const r=[],o=e=>(e.layers&&(e.layers=e.layers.filter(o)),"ArcGISTiledElevationServiceLayer"!==e.layerType||(this.sourceVersion?.supportsGround||r.push(e),!1));return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(o):[],operationalElevationLayers:r,basemapElevationLayers:t}}async _loadFromJSON(t){const r=new s;await this._validateSpatialReference(),await this._validateHeightModelInfo();const{populateOperationalLayers:o}=await new Promise((t,r)=>e(["./layers/support/layersCreator"],t,r)),{operationalLayers:i,operationalElevationLayers:n,basemapElevationLayers:a}=this._extractOperationalLayers(t),c=[],l={context:{...this._loadContext,layerContainerType:"operational-layers"}};if(this.portalItem&&(l.context.portal=this.portalItem.portal||A.getDefault()),a.length>0){const e={...l,context:{...l.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",c.push(o(this.ground.layers,a,e))}if(n.length>0){const e={...l,context:{...l.context,layerContainerType:"ground"}};e.defaultLayerType="ArcGISTiledElevationServiceLayer",c.push(o(r,n,e))}i&&i.length>0&&c.push(o(this.layers,i,l)),t.tables?.length&&c.push(o(this.tables,t.tables,{...l,context:{...l.context,layerContainerType:"tables"},defaultLayerType:"ArcGISFeatureLayer"})),await Promise.allSettled(c),await this._loadObjectsWithLayers(),this.ground.layers.addMany(r.filter(e=>"base-elevation"===e.type||"elevation"===e.type))}async _ensureLoadBeforeSave(){await this.load(),await this._loadObjectsWithLayers();const e=[],t=[...this.allLayers.items];for(const{basemap:e}of this.presentation.slides.items)e&&(t.push(...e.baseLayers.items),t.push(...e.referenceLayers.items));for(const r of t)if("beforeSave"in r&&"function"==typeof r.beforeSave){const t=r.beforeSave();t&&e.push(t)}await Promise.allSettled(e)}async _loadObjectsWithLayers(){const e=[];this.ground&&e.push(this.ground.load()),this.basemap&&e.push(this.basemap.load()),this.presentation.slides.forEach(t=>{t.basemap&&e.push(t.basemap.load())}),await Promise.allSettled(e)}async _loadFromItem(e){if(await e.load().catch(e=>{throw new i("webscene:load-portal-item","Failed to load portal item",{error:e})}),"Web Scene"!==e.type)throw new i("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});const t=await e.fetchData();this.resourceInfo=t;const r=this._loadContext;r.url=m.urlToObject(e.itemUrl),r.portal=e.portal||A.getDefault(),r.portalItem=e,r.readResourcePaths=[],await this._readAndLoadFromJSON(t),this._resourceReferences={portalItem:e,paths:r.readResourcePaths??[]}}_validateSpatialReference(){const e=this.initialViewProperties,t=this._sceneSpatialReference;let r;if("local"!==e.viewingMode){if(!V.isSpatialReferenceSupported(t,1))return Promise.reject(new i("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||I.canProjectWithoutEngine(e,t)}else{if(!V.isSpatialReferenceSupported(t,2))return Promise.reject(new i("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:t,viewingMode:e.viewingMode}));r=e=>!e||e.equals(t)}const o=e=>e?.camera?.position.spatialReference??e?.targetGeometry?.spatialReference,s=e.viewpoint,n=o(s);if(n&&!r(n))return Promise.reject(new i("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:n,sceneSpatialReference:t,viewingMode:e.viewingMode}));const a=this.presentation.slides.find(e=>!r(o(e.viewpoint)));if(a){const r=o(a.viewpoint);return Promise.reject(new i("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:r,sceneSpatialReference:t,viewingMode:e.viewingMode}))}return Promise.resolve()}_validateHeightModelInfo(){const e=this._sceneSpatialReference,t=O.validateWebSceneError(this.heightModelInfo,e);return t?Promise.reject(t):Promise.resolve()}_validateFeatureLayerSymbolVisibility(){this.sourceVersion?.greaterEqual(1,35)||this.layers.forEach(e=>{"feature"===e.type&&e.addHandles(y.watch(()=>e.loaded,()=>{"on-the-ground"===e.elevationInfo?.mode&&"simple"===e.renderer?.type&&"polygon-3d"===e.renderer.symbol?.type&&e.renderer.symbol.symbolLayers.some(t=>"fill"===t.type&&null!=t.material&&(!t.material.color||t.material.color.a*e.opacity<z.alphaCutoff)&&(e.loadWarnings.push(new g("feature-layer:invisible-draped-symbols","FeatureLayer has fully transparent symbols which will no longer render or highlight",{layer:e})),!0))},{once:!0,sync:!0}))})}_validateJSON(e){const t=Y.Version.parse(e.version||"","webscene");return ee.validate(t),e.version=`${t.major}.${t.minor}`,1===t.major&&t.minor<=2&&(e.spatialReference=L.WebMercator.toJSON()),e}_updateTypeKeywords(e){k.toggleTypeKeyword(e,k.typeKeyword.LOCAL_SCENE,"local"===this.initialViewProperties.viewingMode),k.toggleTypeKeyword(e,k.typeKeyword.DEVELOPER_BASEMAP,U.hasDeveloperBasemapLayer(this.basemap)||this.presentation.slides.some(({basemap:e})=>!!e&&U.hasDeveloperBasemapLayer(e))),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((e,t,r)=>r.indexOf(e)===t))}get _sceneSpatialReference(){return this.initialViewProperties.spatialReference||L.WebMercator}get _verifyItemRelativeRootPath(){return this.portalItem?.itemUrl?m.urlToObject(this.portalItem.itemUrl).path:null}_enableVerifyItemRelativeUrls(e){const t=this._verifyItemRelativeRootPath;return t&&(e.verifyItemRelativeUrls={rootPath:t,writtenUrls:[]}),e}_unscheduleLayersIdGC(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)}_scheduleLayersIdGC(){this._unscheduleLayersIdGC(),this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0,this._runLayersIdGC()},3e3)}_runLayersIdGC(){this._unscheduleLayersIdGC();const e=this.applicationProperties?.viewing?.search,t=e=>this.allLayers.some(t=>t.id===e&&t.persistenceEnabled);e?.layers&&(e.layers=e.layers.filter(e=>t(e.id)));const r=this.presentation&&this.presentation.slides;r&&r.forEach(e=>{e.visibleLayers&&(e.visibleLayers=e.visibleLayers.filter(e=>t(e.id)))})}static fromJSON(e){if(!e)throw new i("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:e})}static{this.version=`${ee.major}.${ee.minor}`}};return t.__decorate([b.property({type:B,json:{write:!0}})],re.prototype,"applicationProperties",void 0),t.__decorate([b.property({type:E,json:{read:{source:"clippingArea.geometry",reader:C.fromJSON},write:{target:"clippingArea.geometry"}}})],re.prototype,"clippingArea",void 0),t.__decorate([S.writer("clippingArea")],re.prototype,"writeClippingArea",null),t.__decorate([b.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],re.prototype,"clippingEnabled",void 0),t.__decorate([w.reader("clippingEnabled",["clippingArea"])],re.prototype,"readClippingEnabled",null),t.__decorate([S.writer("clippingEnabled")],re.prototype,"writeClippingEnabled",null),t.__decorate([b.property({type:x,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],re.prototype,"floorInfo",void 0),t.__decorate([b.property({type:R,json:{write:!0}})],re.prototype,"heightModelInfo",void 0),t.__decorate([b.property({json:{write:{target:"operationalLayers",ignoreOrigin:!0}}})],re.prototype,"layers",void 0),t.__decorate([S.writer("layers")],re.prototype,"writeLayers",null),t.__decorate([b.property({readOnly:!0,type:Y.Version,json:{type:(()=>{const e=[],t=ee.major;for(let r=8;r<=ee.minor;r++)e.push(`${t}.${r}`);return e})(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],re.prototype,"sourceVersion",void 0),t.__decorate([w.reader("sourceVersion",["version"])],re.prototype,"readSourceVersion",null),t.__decorate([S.writer("sourceVersion")],re.prototype,"writeSourceVersion",null),t.__decorate([b.property({json:{read:!1,write:{enabled:!0,ignoreOrigin:!0}}})],re.prototype,"tables",void 0),t.__decorate([S.writer("tables")],re.prototype,"writeTables",null),t.__decorate([b.property()],re.prototype,"thumbnailUrl",null),t.__decorate([b.property({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],re.prototype,"authoringApp",null),t.__decorate([S.writer("authoringApp")],re.prototype,"writeAuthoringApp",null),t.__decorate([b.property({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],re.prototype,"authoringAppVersion",null),t.__decorate([S.writer("authoringAppVersion")],re.prototype,"writeAuthoringAppVersion",null),t.__decorate([b.property({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],re.prototype,"ground",void 0),t.__decorate([S.writer("ground")],re.prototype,"writeGround",null),t.__decorate([b.property({type:s.ofType(Q),json:{write:!0}})],re.prototype,"transportationNetworks",void 0),t.__decorate([b.property({type:$,nonNullable:!0,json:{write:{ignoreOrigin:!0,writer:(e,t,r,o)=>{if(e.slides&&e.slides.length>0){const r={...o,isPresentation:!0};t.presentation=e.write({},r)}}}}})],re.prototype,"presentation",void 0),t.__decorate([b.property({type:H,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new H({viewingMode:"global",spatialReference:L.WebMercator})}})],re.prototype,"initialViewProperties",void 0),t.__decorate([w.reader("initialViewProperties",["initialState","spatialReference","viewingMode"])],re.prototype,"readInitialViewProperties",null),t.__decorate([b.property({type:L,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],re.prototype,"spatialReference",null),t.__decorate([b.property({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],re.prototype,"viewingMode",null),t.__decorate([b.property({type:N})],re.prototype,"portalItem",void 0),t.__decorate([b.property()],re.prototype,"resourceInfo",void 0),t.__decorate([b.property({type:G,json:{write:!0}})],re.prototype,"widgets",void 0),re=t.__decorate([f.subclass("esri.WebScene")],re),re});