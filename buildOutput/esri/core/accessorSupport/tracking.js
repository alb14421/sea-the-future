// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../has","../Logger","./utils","./tracking/Flags","./tracking/TrackingTarget"],function(t,n,e,r,i,c){"use strict";const a=new c.TrackingTarget,s=[];let o=a;function l(t){o.onAccessed(t)}let g=!1,u=!1;function f(t,n,e){if(g)return p(t,n,e);let r=null;return d(t),r=n.call(e),k(),r}function p(t,n,r){const i=g;g=!0,d(t);let c=null;try{c=n.call(r)}catch(t){u&&e.getLogger("esri.core.accessorSupport.tracking").error(t)}return k(),g=i,c}function d(t){o=t,s.push(t)}function k(){const t=s.length;if(t>1){const n=s.pop();o=s[t-2],n.onTrackingEnd()}else if(1===t){const t=s.pop();o=a,t.onTrackingEnd()}else o=a}function T(t,n){if(n.flags&i.Flags.DepTrackingInitialized)return;n.flags|=i.Flags.DepTrackingInitialized;const e=u;u=!1,n.flags&i.Flags.AutoTracked?p(n.trackingTarget,n.metadata.get,t):h(t,n),u=e}const y=[];function h(t,n){n.flags&i.Flags.ExplicitlyTracking||(n.flags|=i.Flags.ExplicitlyTracking,p(n.trackingTarget,()=>{const e=n.metadata.dependsOn||y;for(const n of e)if("string"!=typeof n||n.includes(".")){const e=r.pathToArray(n);for(let n=0,r=t;n<e.length&&null!=r&&"object"==typeof r;++n)r=A(r,e[n],n!==e.length-1)}else A(t,n,!1)}),n.flags&=~i.Flags.ExplicitlyTracking)}function A(t,n,e){const i=n.endsWith("?")?n.slice(0,-1):n;if(null!=t.getItemAt||Array.isArray(t)){const n=parseInt(i,10);if(!isNaN(n))return Array.isArray(t)?t[n]:t.at(n)}const c=r.getProperties(t);if(c){const n=c.propertiesByName.get(i);n&&(l(n),T(t,n))}return e?t[i]:void 0}t.initializeDependencyTracking=T,t.runTracked=f,t.runTrackedNoThrow=p,t.runUntracked=function(t,n){return f(a,t,n)},t.trackAccess=l,t.trackExplicitDependencies=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});