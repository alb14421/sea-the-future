// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../Error","../../../Logger","../../../object","./type"],function(e,r,t,n,i){"use strict";function o(e,n,i){for(const r in n.typeMap)if(e instanceof n.typeMap[r])return!0;if(i?.messages){const o=n.errorContext??"type",s=`Values of type '${("function"!=typeof n.key?e[n.key]:e.declaredClass)??"Unknown"}' cannot be written`;i&&i.messages&&e&&i.messages.push(new r(`${o}:unsupported`,s,{definition:e,context:i})),t.getLogger("esri.core.accessorSupport.extensions.serializableProperty.writer").error(s)}return!1}function s(e,r,t,i){n.setDeepValue(t,u(e,i),r)}function u(e,r){return e&&"function"==typeof e.write?e.write({},r):e&&"function"==typeof e.toJSON?e.toJSON():"number"==typeof e?a(e):e}function a(e){return e===-1/0?-Number.MAX_VALUE:e===1/0?Number.MAX_VALUE:isNaN(e)?null:e}function f(e,r,t,i){let o;null===e?o=null:e&&"function"==typeof e.map?(o=e.map(e=>u(e,i)),"function"==typeof o.toArray&&(o=o.toArray())):o=[u(e,i)],n.setDeepValue(t,o,r)}function y(e,r,t){return 0!==t&&Array.isArray(e)?e.map(e=>y(e,r,t-1)):u(e,r)}e.create=function(e,r){if(!r.write||r.write.writer||!1===r.write.enabled&&!r.write.overridePolicy)return;const t=e?.ndimArray??0;var u,a;e&&(1===t||"type"in e&&i.isCollection(e.type))?r.write.writer=f:t>1?r.write.writer=(a=t,(e,r,t,i)=>{let o;if(null===e)o=null;else{o=y(e,i,a);let r=a,t=o;for(;r>0&&Array.isArray(t);)r--,t=t[0];if(void 0!==t)for(let e=0;e<r;e++)o=[o]}n.setDeepValue(t,o,r)}):r.types?Array.isArray(r.types)?r.write.writer=(u=r.types[0],(e,r,t,n)=>e&&Array.isArray(e)?s(e.filter(e=>o(e,u,n)),r,t,n):s(e,r,t,n)):r.write.writer=function(e){return(r,t,n,i)=>r?o(r,e,i)?s(r,t,n,i):void 0:s(r,t,n,i)}(r.types):r.write.writer=s},e.numberToJSON=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});