// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../has","../Logger","../MapUtils"],function(e,n,r,t){"use strict";const u=()=>r.getLogger("esri.core.accessorSupport.ensureTypes");function o(e){if(null==e)return e;const n=new Date(e);return isNaN(n.getTime())?(u().error("Accessor#set",`Invalid date value: '${e}', falling back to current date`),new Date):n}function a(e){return null==e?e:!!e}function s(e){return null==e?e:e.toString()}function l(e,n=0){return null==e?e:(e=parseFloat(e),isNaN(e)?n:e)}function i(e){return null==e?e:Math.round(parseFloat(e))}function c(e){return null}function f(e){return e?.constructor&&void 0!==e.constructor.__accessorMetadata__}function p(e,n){return null!=n&&e&&!(n instanceof e)}function y(e){return e&&"isCollection"in e}function g(e){return e?.Type?"function"==typeof e.Type?e.Type:e.Type.base:null}function v(e,n){return!!f(n)&&(u().error("Accessor#set","Assigning an instance of '"+(n.declaredClass||"unknown")+"' which is not a subclass of '"+h(e)+"'"),!0)}function d(e,n){return null==n?n:y(e)?function(e,n){if(!n?.constructor||!y(n.constructor))return v(e,n)?n:new e(n);const r=g(e.prototype.itemType),t=g(n.constructor.prototype.itemType);return r?t?r===t?n:r.prototype.isPrototypeOf(t.prototype)?new e(n):(v(e,n),n):new e(n):n}(e,n):p(e,n)?v(e,n)?n:new e(n):n}function h(e){return e?.prototype?.declaredClass||"unknown"}const m=new WeakMap;function b(e,n){const r=function(e){switch(e){case Number:return e=>l(e);case $:return i;case Boolean:return a;case String:return s;case Date:return o;case N:return c;default:return t.getOrCreateMapValue(m,e,()=>d.bind(null,e))}}(e);return 1===arguments.length?r:r(n)}function A(e,n,r){return 1===arguments.length?A.bind(null,e):n?Array.isArray(n)?n.map(n=>e(n,r)):[e(n,r)]:n}function w(e,n,r){return 0!==n&&Array.isArray(r)?r.map(r=>w(e,n-1,r)):e(r)}function T(e,n,r){if(2===arguments.length)return r=>T(e,n,r);if(!r)return r;r=w(e,n,r);let t=n,u=r;for(;t>0&&Array.isArray(u);)t--,u=u[0];if(void 0!==u)for(let e=0;e<t;e++)r=[r];return r}class ${}class N{}function M(e){switch(e.type){case"native":switch(e.value){case Number:return"number";case String:return"string";case Boolean:return"boolean";case $:return"integer";case Date:return"date";case N:return"null";default:return h(e.value)}case"array":return`array of ${M(e.value)}`;case"one-of":{const n=e.values.map(e=>M(e));return`one of ${n.slice(0,-1)} or ${n[n.length-1]}`}}return"unknown"}function k(e,n){if(null==e)return!0;switch(n.type){case"native":switch(n.value){case Number:case $:return"number"==typeof e;case Boolean:return"boolean"==typeof e;case String:return"string"==typeof e;case N:return null===e}return e instanceof n.value;case"array":return!!Array.isArray(e)&&!e.some(e=>!k(e,n.value));case"one-of":return n.values.some(n=>k(e,n))}}e.Integer=$,e.Null=N,e.ensureArray=function(e,n){return 1===arguments.length?A(n=>b(e,n)):A(n=>b(e,n),n)},e.ensureArrayTyped=A,e.ensureBoolean=a,e.ensureClass=d,e.ensureDate=o,e.ensureInteger=i,e.ensureLongFormType=function e(n){switch(n.type){case"native":return b(n.value);case"array":return A(e(n.value));case"one-of":return function(e){let n=null;return(r,t)=>k(r,e)?r:(null==n&&(n=M(e)),u().error("Accessor#set",`Invalid property value, value needs to be of type ${n}`),t&&(t.valid=!1),null)}(n);default:return null}},e.ensureNArray=function(e,n,r){return 2===arguments.length?T(n=>b(e,n),n):T(n=>b(e,n),n,r)},e.ensureNArrayTyped=T,e.ensureNull=c,e.ensureNumber=l,e.ensureOneOf=function e(n,r){if(2===arguments.length)return e(n).call(null,r);const t=new Set,o=n.filter(e=>"function"!=typeof e),a=n.filter(e=>"function"==typeof e);for(const e of n)"string"!=typeof e&&"number"!=typeof e||t.add(e);let s=null,l=null;return(e,n)=>{if(null==e)return e;const r=typeof e,i="string"===r||"number"===r;return i&&(t.has(e)||a.some(e=>"string"===r&&e===String||"number"===r&&e===Number))||"object"===r&&a.some(n=>!p(n,e))?e:(i&&o.length?(s||(s=o.map(e=>"string"==typeof e?`'${e}'`:`${e}`).join(", ")),u().error("Accessor#set",`'${e}' is not a valid value for this property, only the following values are valid: ${s}`)):"object"==typeof e&&a.length?(l||(l=a.map(e=>h(e)).join(", ")),u().error("Accessor#set",`'${e}' is not a valid value for this property, value must be one of ${l}`)):u().error("Accessor#set",`'${e}' is not a valid value for this property`),n&&(n.valid=!1),null)}},e.ensureOneOfType=function e(n,r){if(2===arguments.length)return e(n).call(null,r);const t={},o=[],a=[];for(const e in n.typeMap){const r=n.typeMap[e];t[e]=b(r),o.push(h(r)),a.push(e)}const s="string"==typeof n.key?e=>e[n.key]:n.key;return e=>{if(n.base&&!p(n.base,e))return e;if(null==e)return e;const r=s(e)||n.defaultKeyValue,l=t[r];if(!l)return u().error("Accessor#set",`Invalid property value, value needs to be one of '${o.join("', '")}', or a plain object that can autocast (having .type = '${a.join("', '")}')`),null;if(!p(n.typeMap[r],e))return e;if("string"==typeof n.key&&!f(e)){const r={};for(const t in e)t!==n.key&&(r[t]=e[t]);return l(r)}return l(e)}},e.ensureRange=function(e,n){return r=>{let t=e(r);return null!=n.step&&(t=Math.round(t/n.step)*n.step),null!=n.min&&(t=Math.max(n.min,t)),null!=n.max&&(t=Math.min(n.max,t)),t}},e.ensureString=s,e.ensureType=b,e.isClassedType=f,e.isLongFormType=function(e){if(!e||!("type"in e))return!1;switch(e.type){case"native":case"array":case"one-of":return!0}return!1},e.isOneOf=function(e){return!!Array.isArray(e)&&!e.some(n=>{const r=typeof n;return!("string"===r||"number"===r||"function"===r&&e.length>1)})},e.requiresType=p,e.types={native:e=>({type:"native",value:e}),array:e=>({type:"array",value:e}),oneOf:e=>({type:"one-of",values:e})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});