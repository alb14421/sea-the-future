// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../mathUtils","../string","./DateOnly","./errorSupport","./sqlCompareUtils","./sqlDateParsingUtils","./TimeOnly","../../support/guards","../../chunks/datetime"],function(a,e,n,r,t,l,s,u,i,m){"use strict";function o(a){return!(i.isDate(a)||s.isDateOnly(a)||s.isDateTime(a)||s.isTimeOnly(a)||s.isTimestampOffset(a))}function c(a){return s.isDateOnly(a)||s.isTimeOnly(a)?a.toString():s.isTimestampOffset(a)?a.toSQLValue():s.isDateTime(a)?0===a.millisecond?a.toFormat("yyyy-LL-dd HH:mm:ss"):a.toSQL({includeOffset:!1}):i.isDate(a)?c(m.DateTime.fromJSDate(a)):a.toString()}const f={extract:{minParams:2,maxParams:2,evaluate:([a,e])=>{if(null==e)return null;if(i.isDate(e))switch(a.toUpperCase()){case"SECOND":return e.getSeconds();case"MINUTE":return e.getMinutes();case"HOUR":return e.getHours();case"DAY":return e.getDate();case"MONTH":return e.getMonth()+1;case"YEAR":return e.getFullYear();case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":return 0;case"DOW":return m.DateTime.fromJSDate(e,{zone:"system"}).weekday;case"DOY":return m.DateTime.fromJSDate(e,{zone:"system"}).ordinal;case"WEEK":return m.DateTime.fromJSDate(e,{zone:"system"}).weekNumber}else if(s.isDateTime(e))switch(a.toUpperCase()){case"SECOND":return e.second;case"MINUTE":return e.minute;case"HOUR":return e.hour;case"DAY":return e.day;case"MONTH":return e.month;case"YEAR":return e.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new t.SqlError("InvalidFunctionParameters",{function:"EXTRACT"});case"DOW":return e.weekday;case"DOY":return e.ordinal;case"WEEK":return e.weekNumber}else if(s.isDateOnly(e))switch(a.toUpperCase()){case"DAY":return e.day;case"MONTH":return e.month;case"YEAR":return e.year;case"TIMEZONE_HOUR":case"TIMEZONE_MINUTE":throw new t.SqlError("InvalidFunctionParameters",{function:"EXTRACT"});case"DOW":return e.toDateTime("unknown").weekday;case"DOY":return e.toDateTime("unknown").ordinal;case"WEEK":return e.toDateTime("unknown").weekNumber}else if(s.isTimeOnly(e))switch(a.toUpperCase()){case"SECOND":return e.second;case"MINUTE":return e.minute;case"HOUR":return e.hour}else if(s.isTimestampOffset(e))switch(a.toUpperCase()){case"SECOND":return e.second;case"MINUTE":return e.minute;case"HOUR":return e.hour;case"DAY":return e.day;case"MONTH":return e.month;case"YEAR":return e.year;case"TIMEZONE_HOUR":return e.timezoneOffsetHour;case"TIMEZONE_MINUTE":return e.timezoneOffsetMinutes;case"DOW":return e.toDateTime().weekday;case"DOY":return e.toDateTime().ordinal;case"WEEK":return e.toDateTime().weekNumber}throw new t.SqlError("InvalidFunctionParameters",{function:"EXTRACT"})}},substring:{minParams:2,maxParams:3,evaluate:a=>{if(2===a.length){const[e,n]=a;return null==e||null==n?null:e.toString().substring(n-1)}if(3===a.length){const[e,n,r]=a;return null==e||null==n||null==r?null:r<=0?"":e.toString().substring(n-1,n+r-1)}}},position:{minParams:2,maxParams:2,evaluate:([a,e])=>null==a||null==e?null:e.indexOf(a)+1},trim:{minParams:2,maxParams:3,evaluate:a=>{const e=3===a.length,r=e?a[1]:" ",l=e?a[2]:a[1];if(null==r||null==l)return null;const s=`(${n.escapeRegExpString(r)})`;switch(a[0]){case"BOTH":return l.replaceAll(new RegExp(`^${s}*|${s}*$`,"g"),"");case"LEADING":return l.replaceAll(new RegExp(`^${s}*`,"g"),"");case"TRAILING":return l.replaceAll(new RegExp(`${s}*$`,"g"),"")}throw new t.SqlError("InvalidFunctionParameters",{function:"TRIM"})}},abs:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.abs(a[0])},ceiling:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.ceil(a[0])},floor:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.floor(a[0])},log:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.log(a[0])},log10:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.log(a[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.sin(a[0])},cos:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.cos(a[0])},tan:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.tan(a[0])},asin:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.asin(a[0])},acos:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.acos(a[0])},atan:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.atan(a[0])},sign:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0]>0?1:a[0]<0?-1:0},power:{minParams:2,maxParams:2,evaluate:a=>null==a[0]||null==a[1]?null:a[0]**a[1]},mod:{minParams:2,maxParams:2,evaluate:a=>null==a[0]||null==a[1]?null:a[0]%a[1]},round:{minParams:1,maxParams:2,evaluate:a=>{const e=a[0],n=2===a.length?10**a[1]:1;return null==e?null:Math.round(e*n)/n}},truncate:{minParams:1,maxParams:2,evaluate:a=>null==a[0]?null:1===a.length||0===a[1]?Math.trunc(a[0]):e.decimalAdjust("trunc",a[0],-Number(a[1]))},char_length:{minParams:1,maxParams:1,evaluate:a=>i.isString(a[0])?a[0].length:0},concat:{minParams:1,maxParams:1/0,evaluate:a=>{let e="";for(let n=0;n<a.length;n++){if(null==a[n])return null;e+=a[n].toString()}return e}},lower:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:a[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:1/0,evaluate:a=>{for(const e of a)if(null!==e)return e;return null}},cosh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.cosh(a[0])},sinh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.sinh(a[0])},tanh:{minParams:1,maxParams:1,evaluate:a=>null==a[0]?null:Math.tanh(a[0])},nullif:{minParams:2,maxParams:2,evaluate:a=>l.sqlCompare(a[0],a[1],"=")?null:a[0]},cast:{minParams:2,maxParams:2,evaluate:(a,e)=>{const n=a[0],l=a[1];if(null===n)return null;switch(l.type){case"integer":{if(!o(n))throw new t.SqlError("CannotCastValue");const a=parseInt(n,10);if(isNaN(a))throw new t.SqlError("CannotCastValue");return a}case"smallint":{if(!o(n))throw new t.SqlError("CannotCastValue");const a=parseInt(n,10);if(isNaN(a))throw new t.SqlError("CannotCastValue");if(a>32767||a<-32767)throw new t.SqlError("CannotCastValue");return a}case"float":case"real":{if(!o(n))throw new t.SqlError("CannotCastValue");const a=parseFloat(n);if(isNaN(a))throw new t.SqlError("CannotCastValue");return a}case"time":return function(a){if(i.isDate(a))return u.TimeOnly.fromDateJS(a);if(s.isDateTime(a))return u.TimeOnly.fromDateTime(a);if(s.isDateOnly(a))throw new t.SqlError("CannotCastValue");if(s.isTimeOnly(a))return a;if(s.isTimestampOffset(a))return u.TimeOnly.fromSqlTimeStampOffset(a);if(i.isString(a))return s.parseTime(a);throw new t.SqlError("CannotCastValue")}(n);case"date":return function(a){if(i.isDate(a))return r.DateOnly.fromDateJS(a);if(s.isDateTime(a))return r.DateOnly.fromParts(a.year,a.month,a.day);if(s.isDateOnly(a))return a;if(s.isTimeOnly(a))throw new t.SqlError("CannotCastValue");if(s.isTimestampOffset(a)&&null===r.DateOnly.fromParts(a.year,a.month,a.day))throw new t.SqlError("CannotCastValue");if(i.isString(a)){const e=r.DateOnly.fromReader(a);if(null!==e&&e.isValid)return e}throw new t.SqlError("CannotCastValue")}(n);case"timestamp":return function(a,e,n){if(i.isDate(a))return s.convertToExecutingTimeZone(a,e);if(s.isDateTime(a))return a;if(s.isDateOnly(a))return a.toDateTimeLuxon("unknown");if(s.isTimeOnly(a))throw new t.SqlError("CannotCastValue");if(s.isTimestampOffset(a))return a;if(i.isString(a))return s.parseTimestamp(a,"unknown",n);throw new t.SqlError("CannotCastValue")}(n,e,!0===l.withtimezone);case"varchar":{const a=c(n);if(a.length>l.size)throw new t.SqlError("CannotCastValue");return a}default:throw new t.SqlError("InvalidDataType")}}}};a.evaluateFunction=function(a,e,n){const r=f[a.toLowerCase()];if(null==r)throw new t.SqlError("FunctionNotRecognized");if(e.length<r.minParams||e.length>r.maxParams)throw new t.SqlError("InvalidParameterCount",{name:a.toUpperCase()});return r.evaluate(e,n)},a.isStandardized=function(a,e){const n=f[a.toLowerCase()];return null!=n&&e>=n.minParams&&e<=n.maxParams},Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});