// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../request","./Error","./promiseUtils","./urlUtils","../support/base64Utils"],function(e,t,a,r,n,i,o){"use strict";let s=null,c=!0;function u(e,t,a){return a||(s||(s=document.createElement("canvas"),s.width=1,s.height=1),a=s),a.getContext("2d").createImageData(e,t)}t.createEmptyImageData=function(e,t,a){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t)}catch(e){c=!1}return u(e,t,a)},t.getImageData=async function(t,s){const{arrayBuffer:c,mediaType:u}=await async function(e,t){const r=i.dataComponents(e);if(r?.isBase64)return{arrayBuffer:o.base64ToArrayBuffer(r.data),mediaType:r.mediaType};const n=await a(e,{responseType:"array-buffer",...t});return{arrayBuffer:n.data,mediaType:n.getHeader?.("Content-Type")??""}}(t,s),f="image/png"===u;if("image/gif"===u){const{isAnimatedGIF:t,parseGif:a}=await new Promise((t,a)=>e(["./image/gif"],t,a));if(t(c))return a(c,s)}if(f){const{isAnimatedPNG:t,parseApng:a}=await new Promise((t,a)=>e(["./image/apng"],t,a));if(t(c))return a(c,s)}return async function(e,t){const i=window.URL.createObjectURL(e);try{const{data:e}=await a(i,{...t,responseType:"image"});return e}catch(e){if(!n.isAbortError(e))throw new r("invalid-image",`Could not fetch requested image at ${i}`);throw e}finally{window.URL.revokeObjectURL(i)}}(new Blob([c],{type:u}),s)},t.wrapImageData=function(e,t,a,r){if(!t||!a)throw new Error("Cannot construct image data without dimensions");if(c)try{return new ImageData(e,t,a)}catch(e){c=!1}const n=u(t,a,r);return n.data.set(e,0),n},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});