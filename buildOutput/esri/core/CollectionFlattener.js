// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../chunks/tslib.es6","./Collection","./reactiveUtils","./accessorSupport/decorators/property","./accessorSupport/decorators/subclass","./accessorSupport/trackingUtils"],function(t,e,o,s,r,i,l){"use strict";return t.default=class extends o{constructor(t){super(t),this.getCollections=null}initialize(){this.addHandles(l.autorun(()=>this._refresh(),s.sync))}destroy(){this.getCollections=null}_refresh(){const t=null!=this.getCollections?this.getCollections():null;if(null==t)return void this.removeAll();let e=0;for(const o of t)null!=o&&(e=this._processCollection(e,o));this.splice(e)}_createNewInstance(t){return new o(t)}_processCollection(t,e){if(!e)return t;const o=this.itemFilterFunction??(t=>!!t);for(const s of e)if(s){if(o(s)){const e=this.indexOf(s,t);e>=0?e!==t&&this.reorder(s,t):this.add(s,t),++t}if(this.getChildrenFunction){const e=this.getChildrenFunction(s);if(Array.isArray(e))for(const o of e)t=this._processCollection(t,o);else t=this._processCollection(t,e)}}return t}},e.__decorate([r.property()],t.default.prototype,"getCollections",void 0),e.__decorate([r.property()],t.default.prototype,"getChildrenFunction",void 0),e.__decorate([r.property()],t.default.prototype,"itemFilterFunction",void 0),t.default=e.__decorate([i.subclass("esri.core.CollectionFlattener")],t.default),t.default});