// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./clock","./Error","./events","./Logger","./maybe"],function(t,e,r,o,n,i){"use strict";function u(t="Aborted"){return new r("AbortError",t)}function l(t,e="Aborted"){if(c(t))throw u(e)}function s(t){return t instanceof AbortSignal?t:t?.signal??void 0}function c(t){const e=s(t);return null!=e&&e.aborted}function a(t,e){const r=s(t);if(null!=r){if(!r.aborted)return o.once(r,"abort",()=>e());e()}}function f(t){return"AbortError"===t?.name}async function m(t){if(!t)return;if("function"!=typeof t.forEach){const e=Object.keys(t),r=e.map(e=>t[e]),o=await m(r),n={};return e.map((t,e)=>n[t]=o[e]),n}const e=t;return Promise.allSettled(e).then(t=>Array.from(e,(e,r)=>{const o=t[r];return"fulfilled"===o.status?{promise:e,value:o.value}:{promise:e,error:o.reason}}))}function w(t,e=void 0,r){const o=new AbortController;return a(r,()=>o.abort()),new Promise((r,n)=>{let i=setTimeout(()=>{i=0,r(e)},t);a(o,()=>{i&&(clearTimeout(i),n(u()))})})}function b(t){return t&&"function"==typeof t.then}function h(t){return b(t)?t:Promise.resolve(t)}function d(){let t,r;const o=new Promise((e,o)=>{t=e,r=o}),n=e=>{t(e)};return n.resolve=e=>t(e),n.reject=t=>r(t),n.timeout=(t,r)=>e.clock.setTimeout(()=>n.reject(r),t),n.promise=o,n}t.after=w,t.allSettledErrors=async function(t){return(await Promise.allSettled(t)).filter(t=>"rejected"===t.status).map(t=>t.reason)},t.allSettledValues=async function(t){return(await Promise.allSettled(t)).filter(t=>"fulfilled"===t.status).map(t=>t.value)},t.always=function(t,e){return t.then(e,e)},t.createAbortError=u,t.createResolver=d,t.debounce=function(t,e=-1){let r,o,n,i,l=null;const s=(...c)=>{if(r){o=c,i&&i.reject(u()),i=d();const t=i.promise;if(l){const t=l;l=null,t.abort()}return t}if(n=i||d(),i=null,e>0){const o=new AbortController;r=h(t(...c,o.signal));const n=r;w(e).then(()=>{r===n&&(i?o.abort():l=o)})}else r=1,r=h(t(...c));const a=()=>{const t=o;o=n=r=l=null,null!=t&&s(...t)},f=r,m=n;return f.then(a,a),f.then(m.resolve,m.reject),m.promise};return s},t.eachAlways=m,t.eachAlwaysValues=async function(t){return(await m(t)).filter(t=>!!t.value).map(t=>t.value)},t.filter=async function(t,e){const r=t.slice(),o=await Promise.all(t.map((t,r)=>e(t,r)));return r.filter((t,e)=>o[e])},t.ignoreAbortErrors=async function(t){try{return await t}catch(t){if(!f(t))throw t;return}},t.isAbortError=f,t.isAborted=c,t.isPromiseLike=b,t.logOnError=async function(t,e=n.getLogger("esri")){try{return await t}catch(t){f(t)||e.error(t)}},t.onAbort=a,t.onAbortOrThrow=function(t,e){const r=s(t);if(null!=r)return l(r),o.once(r,"abort",()=>e(u()))},t.settleWithPromise=function(t,e){e.then(t.resolve,t.reject)},t.signalFromSignalOrOptions=s,t.throwIfAbortError=function(t){if(f(t))throw t},t.throwIfAborted=l,t.throwIfDestroyed=function(t,e="Aborted"){if(t?.destroyed)throw u(e)},t.throwIfNotAbortError=function(t){if(!f(t))throw t},t.timeout=function(t,e,o,n){const i=o&&"abort"in o?o:null;null!=n||i||(n=o);let u=setTimeout(()=>{u=0,i?.abort()},e);const l=()=>n||new r("promiseUtils:timeout","The wrapped promise did not resolve within "+e+" ms");return t.then(t=>{if(0===u)throw l();return clearTimeout(u),t},t=>{throw clearTimeout(u),0===u?l():t})},t.waitTick=async function(t){await Promise.resolve(),l(t)},t.when=h,t.whenOrAbort=function(t,e){return null==s(e)?t:new Promise((r,o)=>{let n=a(e,()=>o(u()));const l=()=>{n=i.removeMaybe(n)};t.then(l,l),t.then(r,o)})},t.whenOrTimeout=function(t,e,o){return Promise.race([t,w(e).then(()=>{throw new r("timeout",`Did not resolve within ${e} milliseconds (${o??"timeout"})`)})])},t.wrapAbortWithTimeout=function(t,e){const r=new AbortController,o=setTimeout(()=>r.abort(),e);return a(t,()=>{r.abort(),clearTimeout(o)}),{...t,signal:r.signal}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});