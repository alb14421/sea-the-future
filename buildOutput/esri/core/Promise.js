// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../chunks/tslib.es6","./Accessor","./handleUtils","./promiseUtils","./accessorSupport/decorators/subclass"],function(s,e,r,i,t,o){"use strict";class l{constructor(){this._resolver=t.createResolver(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=1,this._cleanUp()},()=>{this._status=2,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(s){this._resolvingPromises.push(s),this._tryResolve()}isResolved(){return 1===this._status}isRejected(){return 2===this._status}isFulfilled(){return 0!==this._status}abort(){this._resolver.reject(t.createAbortError())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const s=t.createResolver(),e=[...this._resolvingPromises,s.promise],r=this._allPromise=Promise.all(e);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},s=>{this.isFulfilled()||this._allPromise!==r||t.isAbortError(s)||this._resolver.reject(s)}),s.resolve()}}const h=s=>{const r=s;let t=class extends r{constructor(...s){super(...s),this._promiseProps=new l,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(s,e){return this._promiseProps.promise.then(()=>this).then(s,e)}catch(s){return this.when(null,s)}addResolvingPromise(s){s&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in s?s.when():s)}addResolvingTask(s){s&&!this._promiseProps.isFulfilled()&&(this.addHandles(i.abortHandle(s)),this._promiseProps.addResolvingPromise(s.promise))}};return t=e.__decorate([o.subclass("esri.core.Promise")],t),t},n=h(r);s.EsriPromise=n,s.EsriPromiseMixin=h,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});