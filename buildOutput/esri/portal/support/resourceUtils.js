// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../request","../../core/Error","../../core/urlUtils"],function(e,t,o,r){"use strict";function s(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function n(e){const[t,o]=function(e){const t=r.getPathExtension(e);return null==t?[e,""]:[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[n,a]=s(t);return[n,a,o]}e.addOrUpdateResources=async function(e,t,n,a){const c=new Map;for(const{resource:e,content:r,compress:a,access:i}of t){if(!e.hasPath())throw new o(`portal-item-resource-${n}:invalid-path`,"Resource does not have a valid path");const[t,l]=s(e.path),u=`${t}/${a??""}/${i??""}`;c.has(u)||c.set(u,{prefix:t,compress:a,access:i,files:[]}),c.get(u).files.push({fileName:l,content:r})}await e.load(a);const i=r.join(e.userItemUrl,"add"===n?"addResources":"updateResources");for(const{prefix:t,compress:o,access:r,files:s}of c.values()){const n=25;for(let c=0;c<s.length;c+=n){const l=s.slice(c,c+n),u=new FormData;t&&"."!==t&&u.append("resourcesPrefix",t),o&&u.append("compress","true"),r&&u.append("access",r);let p=0;for(const{fileName:e,content:t}of l)u.append("file"+ ++p,t,e);u.append("f","json"),await e.portal.request(i,{method:"post",body:u,signal:a?.signal})}}},e.contentToBlob=async function(e){return"blob"===e.type?e.blob:"json"===e.type?new Blob([e.jsonString],{type:"application/json"}):(await t(e.url,{responseType:"blob"})).data},e.fetchResources=async function(e,t={},o){await e.load(o);const s=r.join(e.itemUrl,"resources"),{start:n=1,num:a=10,sortOrder:c="asc",sortField:i="resource"}=t,l={query:{start:n,num:a,sortOrder:c,sortField:i,token:e.apiKey},signal:o?.signal},u=await e.portal.request(s,l);return{total:u.total,nextStart:u.nextStart,resources:u.resources.map(({created:t,size:o,resource:r})=>({created:new Date(t),size:o,resource:e.resourceFromPath(r)}))}},e.getSiblingOfSameType=function(e,t){if(!e.hasPath())return null;const[o,,s]=n(e.path);return e.portalItem.resourceFromPath(r.join(o,t+s))},e.getSiblingOfSameTypeI=function(e,t){if(!e.hasPath())return null;const[o,,s]=n(e.path);return e.portalItem.resourceFromPath(r.join(o,t+s))},e.removeAllResources=async function(e,t){await e.load(t);const o=r.join(e.userItemUrl,"removeResources");return e.portal.request(o,{method:"post",query:{deleteAll:!0},signal:t?.signal})},e.removeResource=async function(e,t,s){if(!t.hasPath())throw new o("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(s);const n=r.join(e.userItemUrl,"removeResources");await e.portal.request(n,{method:"post",query:{resource:t.path},signal:s?.signal}),t.portalItem=null},e.splitPrefixFileNameAndExtension=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});