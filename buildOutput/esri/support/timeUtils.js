// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../core/arrayUtils","../core/lang","../core/timeUtils","../chunks/TimeExtent","../webmap/utils","../webscene/utils"],function(t,e,n,i,l,r,s){"use strict";function u(t){return void 0!==t.timeInfo}async function o(t,n){if(0===t.length)return l.TimeExtent.allTime;await Promise.all(t.map(t=>t.load({signal:n})));const i=t.filter(u),r=t.filter(t=>!u(t)&&null!=t.visibilityTimeExtent);if(0===i.length&&0===r.length)return l.TimeExtent.allTime;const s=[],o=[];for(const t of i)"feature"!==t?.type&&"map-image"!==t?.type||!t.timeInfo?.hasLiveData?o.push(t):s.push(t);const m=t=>null==t||t.isAllTime,a=[...o.map(t=>{const e=t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:n}=t;return e?.intersection(n)??n}),...r.map(t=>t.visibilityTimeExtent)];if(a.some(m))return l.TimeExtent.allTime;const c=s.map(async t=>{const e=(await t.fetchRecomputedExtents({signal:n}))?.timeExtent??t.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=t;return e?.intersection(i)??i}),f=(await Promise.allSettled(c)).map(t=>"fulfilled"===t.status?t.value:null);if(f.some(m))return l.TimeExtent.allTime;const T=[...f,...a].filter(e.isSome);return 0===T.length?l.TimeExtent.allTime:T.reduce((t,e)=>t.union(e))}t.getTimeExtentFromLayers=o,t.getTimeSliderSettingsFromWebDocument=async function(t,e){if(!r.isWebMap(t)&&!s.isWebScene(t))return null;await t.load({signal:e});const i=t?.widgets?.timeSlider;if(!i)return null;const u=await async function(t,e){return t.widgets?.timeSlider?.fullTimeExtent??o(t.allLayers,e)}(t,e),m=i.loop,a=function(t){const e=t.numThumbs??2,n=t.currentTimeExtent;if(n){const{start:t,end:i}=n;return null!=t&&null!=i&&t.getTime()===i.getTime()?"instant":2===e?"time-window":null==t||0===t.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===e?"time-window":"cumulative-from-start"}(i),c=i.stopDelay??2e3,f=function(t){const{numStops:e,stopInterval:i,stops:l}=t;return l?{dates:n.clone(l)}:i?{interval:i.clone()}:{count:e??5}}(i),T=function(t,e){const n=t.currentTimeExtent;if(!n)return null;const{start:i,end:r}=n,s=i??r??null;switch(e){case"time-window":return new l.TimeExtent({start:i,end:r});case"cumulative-from-start":return new l.TimeExtent({start:null,end:s});case"cumulative-from-end":return new l.TimeExtent({start:s,end:null});case"instant":return new l.TimeExtent({start:s,end:s})}}(i,a);return{fullTimeExtent:u,loop:m,mode:a,playRate:c,stops:f,timeExtent:T}},t.toLocalTimeExtent=function(t){if(!t)return t;const{start:e,end:n}=t;return new l.TimeExtent({start:null!=e?i.offsetDate(e,e.getTimezoneOffset(),"minutes"):e,end:null!=n?i.offsetDate(n,n.getTimezoneOffset(),"minutes"):n})},t.toUTCTimeExtent=function(t){if(!t)return t;const{start:e,end:n}=t;return new l.TimeExtent({start:null!=e?i.offsetDate(e,-e.getTimezoneOffset(),"minutes"):e,end:null!=n?i.offsetDate(n,-n.getTimezoneOffset(),"minutes"):n})},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});