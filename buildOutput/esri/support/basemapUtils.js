// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../core/Collection","../core/maybe","../core/urlUtils","../layers/effects/utils","./basemapDefinitions"],function(e,a,r,t,n,l){"use strict";let i;function s(e){if(i)return i(e);let a=null;const r=f(e),t=!r?.baseLayers.length;for(const e in l.esriBasemapDefinitions){const n=L(r,b(l.esriBasemapDefinitions[e]),{mustMatchReferences:t});if("equal"===n){a=e;break}"base-layers-equal"===n&&(a=e)}return a}function u(e){if(o(e.url))return!0;if("vector-tile"===e.type)for(const a in e.sourceNameToSource){const r=e.sourceNameToSource[a];if(o(r?.sourceUrl))return!0}return!1}const c=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function o(e){if(!e)return!1;const a=new t.Url(t.makeAbsolute(e));return!!a.authority&&c.test(a.authority)}function f(e){return e?!e.loaded&&e.resourceInfo?b(e.resourceInfo.data):{baseLayers:p(e.baseLayers),referenceLayers:p(e.referenceLayers)}:null}function p(e){return(a.isCollection(e)?e.toArray():e).map(y)}function y(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:g("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers?void 0:e.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function m(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function b(e){return e?{baseLayers:d((e.baseMapLayers??[]).filter(e=>!m(e))),referenceLayers:d((e.baseMapLayers??[]).filter(e=>m(e)))}:null}function d(e){return e.map(e=>function(e){let a;switch(e.layerType){case"VectorTileLayer":a="vector-tile";break;case"ArcGISTiledMapServiceLayer":a="tile";break;case"ArcGISSceneServiceLayer":a="scene";break;default:a="unknown"}return{type:a,effect:e.effect,url:g(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e))}function L(e,a,r){return null!=e!=(null!=a)?"not-equal":e&&a?v(e.baseLayers,a.baseLayers)?v(e.referenceLayers,a.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function v(e,a){if(e.length!==a.length)return!1;for(let r=0;r<e.length;r++)if(!S(e[r],a[r]))return!1;return!0}function S(e,a){if(e.type!==a.type||e.url!==a.url||e.minScale!==a.minScale||e.maxScale!==a.maxScale||e.visible!==a.visible||e.opacity!==a.opacity)return!1;if(!n.effectEquals(e.effect,a.effect))return!1;if(null!=e.activeLayerId||null!=a.activeLayerId)return e.activeLayerId===a.activeLayerId;if(null!=e.sublayers||null!=a.sublayers){if(null==e.sublayers||null==a.sublayers||e.sublayers.length!==a.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const t=e.sublayers.at(r),n=a.sublayers.at(r);if(t?.id!==n?.id||t?.visible!==n?.visible)return!1}}return!0}function g(e){return e?t.normalize(e).replace(/^\s*https?:/i,"").toLowerCase():""}function I(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}e.contentEquals=function(e,a){return e===a||null!=e?.portalItem?.id&&e.portalItem.id===a?.portalItem?.id||"equal"===L(f(e),f(a),{mustMatchReferences:!0})},e.findSpatialReference=function(e,a){if(null==a||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===a.loadStatus)return a.load(),{spatialReference:null,updating:!0};if(a.spatialReference)return{spatialReference:a.spatialReference,updating:!1};if(0===a.baseLayers.length)return{spatialReference:null,updating:!1};const r=a.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const t=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),n=e.spatialReference;return n?{spatialReference:t.find(e=>n.equals(e))??t[0]??null,updating:!1}:{spatialReference:t[0],updating:!1}},e.getBasemapThumbnailUrl=function(e){if(!e)return null;const{thumbnailUrl:a}=e;if(a)return a;const t=s(e);return t?l.esriBasemapDefinitions[t].thumbnailUrl:r.mappedFind(e.baseLayers,I)},e.getWellKnownBasemapId=s,e.hasDeveloperBasemapLayer=function(e){return!!e?.baseLayers.concat(e.referenceLayers).some(u)},e.isBasemap3D=function(e){return"Web Scene"===e.portalItem?.type||e.referenceLayers.some(e=>"scene"===e.type)},e.isBasemapInBeta=function(e){return!!e?.portalItem?.tags?.some(e=>"beta"===e.toLowerCase())},e.isBasemapLayerView=function(e,a){const r=e.allLayerViews.find(e=>e.uid===a);return r?.layer.parent===e.map?.basemap},e.isDeveloperBasemapLayer=u,e.layerDefinitionEquals=S,e.layerToDefinition=y,e.overrideGetWellKnownBasemapId=function(e){i=e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});