// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../Graphic","../../../../core/Error","../../../../core/uuid","../../../templateUtils","./executorUtils","../../../../geometry/Multipoint","../../../../geometry/Point","../../../../geometry/Polygon","../../../../geometry/Polyline","../../../../layers/support/layerUtils"],function(e,a,t,s,i,r,n,o,l,h,u){"use strict";function p(e,a,t,s,i,r,n){const o=[];for(const l of e)o.push(c(l,a,t,s,i,r,n));return o}function c(e,a,t,s,i,r,n){const o=[];for(const l of e){const e=[l[0],l[1]];a&&(e[2]=n>-1?l[2]:s),t&&(e[a?3:2]=r>-1?l[r]:i),o.push(e)}return o}function d(e){return e.capabilities.editing?.zDefault??0}function f(e){return e.capabilities.editing.supportsUpdateWithoutM?void 0:0}function y(e,a){u.isSubtypeGroupLayer(a)&&(e.sourceLayer=a.findSublayerForFeature(e))}e.createFeatureServiceEdit=function e({edits:u,geometry:g,relationships:m,tag:M="",template:Z}){if(r.isRadial(g)){const a=g.geometry.clone();for(const t of a.paths)e({geometry:new h({spatialReference:a.spatialReference,paths:[t],hasZ:a.hasZ,hasM:a.hasM}),template:Z,edits:u,relationships:m,tag:M});return}const{definition:b,layer:R}=Z;g=function(e,a){if(!e)return null;if(e.hasZ===a.hasZ&&e.hasM===a.hasM)return e;switch(e.type){case"point":return new o({spatialReference:e.spatialReference,x:e.x,y:e.y,...a.hasZ?e.hasZ?{z:e.z}:{z:d(a)}:{},...a.hasM?e.hasM?{m:e.m}:{m:f(a)}:{}});case"polygon":return new l({spatialReference:e.spatialReference,rings:p(e.rings,a.hasZ,a.hasM,d(a),f(a),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:a.hasZ,hasM:a.hasM});case"polyline":return new h({spatialReference:e.spatialReference,paths:p(e.paths,a.hasZ,a.hasM,d(a),f(a),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1),hasZ:a.hasZ,hasM:a.hasM});case"multipoint":return new n({spatialReference:e.spatialReference,hasZ:a.hasZ,hasM:a.hasM,points:c(e.points,a.hasZ,a.hasM,d(a),f(a),e.hasM?e.hasZ?3:2:-1,e.hasZ?2:-1)});default:return e}}(g,R);const w=new a({attributes:b.defaultValues?{...b.defaultValues}:{},geometry:g,sourceLayer:R});if(y(w,R),R.globalIdField&&(w.attributes[R.globalIdField]=s.generateBracedUUID()),u.push({id:R.layerId,graphic:w,tag:M,layer:R}),0!==b.relationships.length)for(const e of b.relationships||[]){const r=e.template;if(null==e.relationshipMetadata||!i.isLoadedSharedTemplate(r))throw new t("shared-template:missing-relationship-metadata-or-definition","Relationship part must have metadata and a fully loaded template with definition");const{layer:n}=r,o=new a({attributes:{...b.defaultValues},sourceLayer:n});y(o,n),n.globalIdField&&(o.attributes[n.globalIdField]=s.generateBracedUUID()),u.push({graphic:o,id:n.layerId,tag:"",layer:n}),m.push({...e.relationshipMetadata,sourceGraphic:w,destinationGraphic:o})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});