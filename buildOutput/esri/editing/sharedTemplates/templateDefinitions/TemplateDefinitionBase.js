// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/tslib.es6","../../../core/Error","../../../core/JSONSupport","../../../core/Loadable","../../../core/Promise","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/reader","../../../core/accessorSupport/decorators/subclass","../SharedTemplateProvider","../support/sharedTemplateErrors","../support/toolNames"],function(e,t,o,r,a,i,l,s,p,n,d,m,c,u,f){"use strict";e.TemplateDefinitionBase=class extends(a.LoadableMixin(i.EsriPromiseMixin(r.JSONSupport))){constructor(){super(...arguments),this.excludedTools=[],this.featureService=null,this.makeSharedTemplateFromJSON=null,this.view=null}readExcludedTools(e){return e.map(e=>f.namedEditingToolGUIDDict.fromJSON(e))}load(e){return this.addResolvingPromise(this._load(e)),Promise.resolve(this)}async _load(e){const t=this.allParts,{featureService:r,makeSharedTemplateFromJSON:a,view:i}=this;if(null==r||null==a||null==i)throw new u.SharedTemplateDefinitionRequiredPropsNotSetError;for(const e of t)e.assertIsSupportedPart();const l=c.getSharedTemplateProvider(i,{makeSharedTemplateFromJSON:a}),s=t.filter(e=>null==e.template),p=await l.getTemplates({templateIds:s.map(e=>e.templateId),featureService:r,signal:e?.signal}),n=new Map(p.map(e=>[e.templateId,e]));for(const e of s){const t=n.get(e.templateId);if(null==t)throw new o("internal:missing-template",`Failed to retrieve template for template ID ${e.templateId}`);e.template=t}await Promise.all(t.map(t=>t.template?.load(e)))}},t.__decorate([l.property({readOnly:!0})],e.TemplateDefinitionBase.prototype,"type",void 0),t.__decorate([l.property({constructOnly:!0})],e.TemplateDefinitionBase.prototype,"excludedTools",void 0),t.__decorate([d.reader("excludedTools")],e.TemplateDefinitionBase.prototype,"readExcludedTools",null),t.__decorate([l.property()],e.TemplateDefinitionBase.prototype,"featureService",void 0),t.__decorate([l.property()],e.TemplateDefinitionBase.prototype,"makeSharedTemplateFromJSON",void 0),t.__decorate([l.property()],e.TemplateDefinitionBase.prototype,"view",void 0),e.TemplateDefinitionBase=t.__decorate([m.subclass("esri.editing.sharedTemplates.templateDefinitions.TemplateDefinitionBase")],e.TemplateDefinitionBase),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});