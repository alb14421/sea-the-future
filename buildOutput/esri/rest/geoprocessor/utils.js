// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../request","../../geometry/SpatialReference","../../geometry/support/normalizeUtils","../../layers/support/Field","../../layers/support/MapImage","../utils","../support/ArealUnit","../support/DataFile","../support/FeatureSet","../support/LinearUnit","../support/ParameterValue","../support/parameterValueUtils","../support/RasterData"],function(e,t,r,a,n,o,u,i,s,l,c,p,f,m,d){"use strict";const y=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));function S(e,t,r){for(const a in e){const n=e[a];if(n&&"object"==typeof n&&n instanceof c){const{features:e}=n;r[a]=[t.length,t.length+e.length],e.forEach(e=>{t.push(e.geometry)})}}}async function g(t,r){switch(t){case"areal-unit":return s.fromJSON(r);case"boolean":case"double":case"long":case"string":case"value-table":return r;case"date":return new Date(r);case"data-file":return l.fromJSON(r);case"linear-unit":return p.fromJSON(r);case"feature-record-set-layer":if("url"in r)return l.fromJSON(r);if("layerDefinition"in r){const t=new(0,(await new Promise((t,r)=>e(["../../layers/FeatureLayer"],e=>t(y(e)),r))).default),{layerDefinition:n,featureSet:o}=r;return t.read({layerDefinition:n,featureSet:o},{origin:"portal-item"}),t.spatialReference=a.fromJSON(o.spatialReference??n.spatialReference??n.extent.spatialReference),t}return c.fromJSON(r);case"record-set":return"url"in r?l.fromJSON(r):c.fromJSON(r);case"raster-data":case"raster-data-layer":return"mapImage"in r?u.fromJSON(r.mapImage):d.fromJSON(r);case"field":return o.fromJSON(r)}}function N(e,t,r){for(const t in e){const r=e[t];Array.isArray(r)?e[t]=JSON.stringify(r.map(e=>N({item:e},!0).item)):r instanceof Date&&(e[t]=r.getTime())}return i.encode(e,t,r)}t.collectGeometries=S,t.constructRequest=async function(e,t,a,o,u){const s={},l={},c=[];return S(o,c,s),n.normalizeCentralMeridian(c).then(n=>{const{outSpatialReference:c,processExtent:p,processSpatialReference:f,returnColumnName:m,returnFeatureCollection:d,returnM:y,returnZ:S}=a,{path:g}=i.parseUrl(e);for(const e in s){const[t,r]=s[e];l[e]=n.slice(t,r)}const O=c?c.wkid||c:null,J=f?f.wkid||f:null,v="execute"===t?{returnColumnName:m||void 0,returnFeatureCollection:d||void 0,returnM:y||void 0,returnZ:S||void 0}:null,R=N({...p?{context:{extent:p,outSR:O,processSR:J}}:{"env:outSR":O,"env:processSR":J},...o,...v,f:"json"},null,l),w={...u,query:R};return r(`${g}/${t}`,w)})},t.decode=async function(e){const t=m.dataTypeJsonMap.fromJSON(e.dataType),{paramName:r}=e,a=function(e){return e.startsWith(m.multiValuePrefix)}(t)?await async function(e,t){const r=function(e){return e.replace(m.multiValuePrefix,"")}(e),a="composite"===r?t.map(e=>g(m.dataTypeJsonMap.fromJSON(e.dataType),e.value)):t.map(e=>g(r,e));return Promise.all(a)}(t,e.value):await g(t,e.value);return new f({dataType:t,paramName:r,value:a})},t.gpEncode=N,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});