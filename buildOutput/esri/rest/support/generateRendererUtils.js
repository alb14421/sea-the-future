// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/Logger"],function(e,t){"use strict";function l(e,t){return Number(e.toFixed(t))}function n(e,t,l){let n=null;return n=e===t?l&&"percent-of-total"===l?e+"%":e.toString():l&&"percent-of-total"===l?e+"% - "+t+"%":e+" - "+t,n}function a(e){const t=[],l=[];let n=Number.MIN_VALUE,a=1,u=-1;for(let r=0;r<e.length;r++){const s=e[r];s===n?(a++,l[u]=a):null!==s&&(t.push(s),n=s,a=1,l.push(a),u++)}return{uniqueValues:t,valueFrequency:l}}function u(e,t,l,n){let a=[],u=[],s=[],o=0;const i=[],c=[];for(let a=0;a<n;a++){const n=r(a,e,t,l);i.push(n.sbMean),c.push(n.sbSdcm),o+=c[a]}let f,h=o,m=!0;for(;m||o<h;){m=!1,a=[];for(let t=0;t<n;t++)a.push(e[t]);for(let l=0;l<n;l++)for(let a=e[l]+1;a<=e[l+1];a++)if(f=t[a],l>0&&a!==e[l+1]&&Math.abs(f-i[l])>Math.abs(f-i[l-1]))e[l]=a;else if(l<n-1&&e[l]!==a-1&&Math.abs(f-i[l])>Math.abs(f-i[l+1])){e[l+1]=a-1;break}h=o,o=0,u=[],s=[];for(let a=0;a<n;a++){u.push(i[a]),s.push(c[a]);const n=r(a,e,t,l);i[a]=n.sbMean,c[a]=n.sbSdcm,o+=c[a]}}if(o>h){for(let t=0;t<n;t++)e[t]=a[t],i[t]=u[t],c[t]=s[t];o=h}return{mean:i,sdcm:c}}function r(e,l,n,a){let u=0,r=0;for(let t=l[e]+1;t<=l[e+1];t++){const e=a[t];u+=n[t]*e,r+=e}r<=0&&t.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");const s=u/r;let o=0;for(let t=l[e]+1;t<=l[e+1];t++)o+=a[t]*(n[t]-s)**2;return{sbMean:s,sbSdcm:o}}e.createGenerateRendererClassBreaks=function(e,t){const{normalizationTotal:s}=e;return{classBreaks:function(e,t){const s=e.definition,{classificationMethod:o,normalizationType:i,definedInterval:c}=s,f=s.breakCount??1,h=[];let m=e.values;if(0===m.length)return[];m=m.sort((e,t)=>e-t);const[b,V]=t??[m.at(0),m.at(-1)];if("equal-interval"===o)if(m.length>=f){const e=(V-b)/f;let t=b;for(let a=1;a<f;a++){const u=l(b+a*e,6);h.push({minValue:t,maxValue:u,label:n(t,u,i)}),t=u}h.push({minValue:t,maxValue:V,label:n(t,V,i)})}else m.forEach(e=>{h.push({minValue:e,maxValue:e,label:n(e,e,i)})});else if("natural-breaks"===o){const t=a(m),s=e.valueFrequency||t.valueFrequency,o=function(e,t,l){const n=e.length,a=[];l>n&&(l=n);for(let e=0;e<l;e++)a.push(Math.round(e*n/l-1));a.push(n-1);let s=u(a,e,t,l);return function(e,t,l,n,a,u){let s=0,o=0,i=0,c=0,f=!0;for(let h=0;h<2&&f;h++){0===h&&(f=!1);for(let h=0;h<u-1;h++)for(;l[h+1]+1!==l[h+2];){l[h+1]=l[h+1]+1;const u=r(h,l,n,a);i=u.sbMean,s=u.sbSdcm;const m=r(h+1,l,n,a);if(c=m.sbMean,o=m.sbSdcm,!(s+o<t[h]+t[h+1])){l[h+1]=l[h+1]-1;break}t[h]=s,t[h+1]=o,e[h]=i,e[h+1]=c,f=!0}for(let h=u-1;h>0;h--)for(;l[h]!==l[h-1]+1;){l[h]=l[h]-1;const u=r(h-1,l,n,a);i=u.sbMean,s=u.sbSdcm;const m=r(h,l,n,a);if(c=m.sbMean,o=m.sbSdcm,!(s+o<t[h-1]+t[h])){l[h]=l[h]+1;break}t[h-1]=s,t[h]=o,e[h-1]=i,e[h]=c,f=!0}}return f}(s.mean,s.sdcm,a,e,t,l)&&(s=u(a,e,t,l)),a}(t.uniqueValues,s,f);let c=b;for(let e=1;e<f;e++)if(t.uniqueValues.length>e){const a=l(t.uniqueValues[o[e]],6);h.push({minValue:c,maxValue:a,label:n(c,a,i)}),c=a}h.push({minValue:c,maxValue:V,label:n(c,V,i)})}else if("quantile"===o)if(m.length>=f&&b!==V){let e=b,t=Math.ceil(m.length/f),l=0;for(let a=1;a<f;a++){let u=t+l-1;u>m.length&&(u=m.length-1),u<0&&(u=0),h.push({minValue:e,maxValue:m[u],label:n(e,m[u],i)}),e=m[u],l+=t,t=Math.ceil((m.length-l)/(f-a))}h.push({minValue:e,maxValue:V,label:n(e,V,i)})}else{let e=-1;for(let t=0;t<m.length;t++){const l=m[t];l!==e&&(e=l,h.push({minValue:e,maxValue:l,label:n(e,l,i)}),e=l)}}else if("standard-deviation"===o){const e=function(e){let t=0;for(let l=0;l<e.length;l++)t+=e[l];return t/=e.length,t}(m),t=function(e,t){let l=0;for(let n=0;n<e.length;n++){const a=e[n];l+=(a-t)*(a-t)}return l/=e.length,Math.sqrt(l)}(m,e);if(0===t)h.push({minValue:m[0],maxValue:m[0],label:n(m[0],m[0],i)});else{const a=function(e,t,l,n,a){let u=Math.max(n-e,t-n)/a/l;return u=u>=1?1:u>=.5?.5:.25,u}(b,V,f,e,t),u=a*t;let r=0,s=b;for(let t=f;t>=1;t--){const a=l(e-(t-.5)*u,6);h.push({minValue:s,maxValue:a,label:n(s,a,i)}),s=a,r++}let o=l(e+.5*u,6);h.push({minValue:s,maxValue:o,label:n(s,o,i)}),s=o,r++;for(let t=1;t<=f;t++)o=r===2*f?V:l(e+(t+.5)*u,6),h.push({minValue:s,maxValue:o,label:n(s,o,i)}),s=o,r++}}else if("defined-interval"===o){if(!c)return h;const[e,a]=t??[m.at(0),m.at(-1)],u=Math.ceil((a-e)/c);let r=e;for(let t=1;t<u;t++){const a=l(e+t*c,6);h.push({minValue:r,maxValue:a,label:n(r,a,i)}),r=a}h.push({minValue:r,maxValue:a,label:n(r,a,i)})}return h}(e,t),normalizationTotal:s}},e.createGenerateRendererUniqueValues=function(e){const t=a(e),l=[],n=t.uniqueValues.length;for(let e=0;e<n;e++){const n=t.uniqueValues[e],a=t.valueFrequency[e],u=n.toString();l.push({value:n,count:a,label:u})}return{uniqueValues:l}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});