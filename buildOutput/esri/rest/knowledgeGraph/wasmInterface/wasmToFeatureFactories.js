// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/object","../ProtoFeatureCollection","./WasmDataModelWrapperInterfaces","./WasmSerializedLayerData"],function(e,t,s,a,o){"use strict";function r(e){const o=new s.CompressedGeometry;o.geometryType=t.getKey(a.EsriGeometryTypes,e.geometry_type.value);const r=[],n=[];for(let t=0;t<e.lengths.length;t++)r.push(e.lengths[t]);for(let t=0;t<e.coords.length;t++)n.push(e.coords[t]);return o.lengths=r,o.coords=n,o}function n(e){const r=new s.Field;return r.name=e.name,r.alias=e.alias,r.fieldType=t.getKey(a.EsriFieldTypes,e.field_type.value),r.sqlType=t.getKey(o.SqlTypeCode,e.sql_type.value),r.domain=e.domain,r.defaultValue=e.default_value,r}function i(e){const s=n(e);return s.geometryType=t.getKey(a.EsriGeometryTypes,e.geometry_type.value),s}function l(e){const a=new s.Transform;a.quantizeOriginPosition=t.getKey(o.WasmQuantizeOriginPositionTypeCode,e.quantizeOriginPosition.value);const r=a.scale,n=e.scale;r.xScale=n.xScale,r.yScale=n.yScale,r.mScale=n.mScale,r.zScale=n.zScale;const i=a.translate,l=e.translate;return i.xTranslate=l.xTranslate,i.yTranslate=l.yTranslate,i.mTranslate=l.mTranslate,i.zTranslate=l.zTranslate,a}e.wasmToCompressedGeometry=r,e.wasmToField=n,e.wasmToGeometryField=i,e.wasmToProtoFeatureCollection=function(e){const o=new s.ProtoFeatureCollection;o.version=e.version;const d=e.get_query_result();if(0!==d.results_type.value)throw new Error("Got a non-feature collection type");const u=d.get_feature_result(),c=o.queryResult.featureResult;c.objectIdFieldName=u.objectid_field_name,c.exceededTransferLimit=u.exceeded_transfer_limit,c.hasM=u.has_m,c.hasZ=u.has_z,c.geometryType=t.getKey(a.EsriGeometryTypes,u.geometry_type.value),c.globalIdFieldName=u.globalid_field_name,c.geohashFieldName=u.geohash_field_name;const m=c.uniqueIdField,y=u.unique_id_field;m.name=y.name,m.isSystemMaintained=y.isSystemMaintained;const g=c.geometryProperties,f=u.geometry_properties;g.shapeAreaFieldName=f.shapeAreaFieldName,g.shapeLengthFieldName=f.shapeLengthFieldName,g.units=f.units;const p=c.spatialReference,_=u.spatial_reference;p.wkid=_.wkid,p.latestWkid=_.latestWkid,p.vcsWkid=_.vcsWkid,p.latestVcsWkid=_.latestVcsWkid,p.wkt=_.wkt,c.transform=l(u.transform);const h=c.fields,T=c.fieldNameToAttributeIndexMap,F=u.fields,w=F.size();for(let e=0;e<w;e++){const t=F.get(e),s=n(t);h.push(s),T[s.name]=e,t.delete()}F.delete();const v=c.values,b=u.values_count();for(let e=0;e<b;e++)v.push(u.get_value_at(e));const S=c.features,z=u.features,q=z.size();if(q>0)for(const e of s.ProtoInboundFeatureCollectionRequiredAttributes)if(void 0===T[e])throw new Error(`Feature collection missing required attribute: ${e}`);for(let e=0;e<q;e++){const t=new s.Feature,a=z.get(e),o=t.attributes,n=a.attributes_count();for(let e=0;e<n;e++)o.push(a.get_attribute_at(e));const i=a.get_compressed_geometry();i&&(t.compressedGeometry=r(i),t.centroid=r(a.get_centroid()));const l=t.aggregateGeometries,d=a.aggregate_geometries,u=d.size();for(let e=0;e<u;e++){const t=d.get(e),s=r(t);l.push(s),t.delete()}d.delete(),S.push(t),a.delete()}z.delete();const k=c.geometryFields,W=u.geometry_fields,G=W.size();for(let e=0;e<G;e++){const t=W.get(e),s=i(t);k.push(s),t.delete()}return W.delete(),o},e.wasmToTransform=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});