// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../request","../renderers/support/jsonUtils","./utils","./query/executeQuery","./support/Query","./support/StatisticDefinition"],function(e,t,n,a,i,l,s){"use strict";function r(e,t,a){if("classBreaks"===e.type){const i=n.fromJSON(e);return{classBreaks:i.classBreakInfos.map((e,n)=>(0===n&&null!=t&&(e.minValue=t),n===i.classBreakInfos.length-1&&null!=a&&(e.maxValue=a),{minValue:e.minValue,maxValue:e.maxValue,label:e.label})),normalizationTotal:i.normalizationTotal}}const{uniqueValueInfos:i}=e;return{uniqueValues:i?.map((e,n)=>(0===n&&null!=t&&(e.value=t),n===i.length-1&&null!=a&&(e.value=a),{count:e.count,value:e.value,label:e.label}))??[]}}e.generateRenderer=async function(e,n,u,o){const c=a.parseUrl(e),{source:f,checkValueRange:p}=n,{classificationDefinition:m}=u,y={...u.toJSON(),f:"json"};let d=null;if(d="class-breaks-definition"===m?.type?m.classificationField:m?.attributeField,f){const e={source:f?.toJSON()};y.layer=JSON.stringify(e)}y.classificationDef&&(y.classificationDef=JSON.stringify(y.classificationDef));let g={query:y};o&&(g={...o,...g});const S={url:c.path,field:d,checkValueRange:p},V=c.path+"/generateRenderer";return t(V,g).then(e=>function(e,t){const{field:n,checkValueRange:a,url:u}=e,o=t?.data;if(!o)return;if(!a){const e=r(o);return Promise.resolve(e)}const c=new s({statisticType:"min",onStatisticField:n}),f=new s({statisticType:"max",onStatisticField:n}),p=new l({outStatistics:[c,f]});return i.executeQuery(u,p).then(e=>{const t=e.features[0].attributes;let n=null,a=null;for(const e in t)e.toLowerCase().startsWith("min")?n=t[e]:a=t[e];return r(o,n,a)})}(S,e))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});