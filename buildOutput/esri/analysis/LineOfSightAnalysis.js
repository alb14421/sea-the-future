// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../chunks/tslib.es6","./Analysis","./LineOfSightAnalysisObserver","./LineOfSightAnalysisTarget","../core/arrayUtils","../core/Collection","../core/collectionUtils","../core/maybe","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","../geometry/projectionUtils","../geometry/support/aaBoundingBox","../support/elevationInfoUtils"],function(e,t,r,o,s,n,i,l,a,p,u,c,d,y,g,f,h){"use strict";const v=i.ofType(s);return e.default=class extends r{constructor(e){super(e),this.type="line-of-sight",this.observer=null,this.extent=null}initialize(){this.addHandles(p.watch(()=>this._computeExtent(),e=>{null==e?.pending&&this._set("extent",null!=e?e.extent:null)},p.syncAndInitial))}get targets(){return this._get("targets")||new v}set targets(e){this._set("targets",l.referenceSetter(e,this.targets,v))}get spatialReference(){return null!=this.observer?.position?this.observer.position.spatialReference:null}get valid(){return null!=this.observer?.position}async waitComputeExtent(){const e=this._computeExtent();return null!=e?e.pending:Promise.resolve()}_computeExtent(){const e=this.spatialReference;if(null==this.observer?.position||null==e)return null;const t=e=>"absolute-height"===h.getGeometryEffectiveElevationMode(e.position,e.elevationInfo),r=this.observer.position,o=f.fromValues(r.x,r.y,r.z,r.x,r.y,r.z);for(const t of this.targets)if(null!=t.position){const r=g.projectOrLoad(t.position,e);if(null!=r.pending)return{pending:r.pending,extent:null};if(null!=r.geometry){const{x:e,y:t,z:s}=r.geometry;f.expandWithVec3(o,[e,t,s])}}const s=f.toExtent(o,e);return t(this.observer)&&this.targets.every(t)||(s.zmin=void 0,s.zmax=void 0),{pending:null,extent:s}}clear(){this.observer=null,this.targets.removeAll()}equals(e){return this===e||super.equals(e)&&a.equalsMaybe(this.observer,e.observer)&&n.equals(this.targets.toArray(),e.targets.toArray(),(e,t)=>e.equals(t))}},t.__decorate([u.property({type:["line-of-sight"]})],e.default.prototype,"type",void 0),t.__decorate([u.property({type:o,json:{read:!0,write:!0}})],e.default.prototype,"observer",void 0),t.__decorate([u.property({cast:l.castForReferenceSetter,type:v,nonNullable:!0,json:{read:!0,write:!0}})],e.default.prototype,"targets",null),t.__decorate([u.property({value:null,readOnly:!0})],e.default.prototype,"extent",void 0),t.__decorate([u.property()],e.default.prototype,"spatialReference",null),t.__decorate([u.property({readOnly:!0})],e.default.prototype,"valid",null),e.default=t.__decorate([y.subclass("esri.analysis.LineOfSightAnalysis")],e.default),e.default});