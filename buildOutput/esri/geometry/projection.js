// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../core/deprecate","../core/Error","../core/Logger","../core/promiseUtils","../core/accessorSupport/tracking/SimpleObservable","../core/libs/gl-matrix-2/factories/vec3f64","./asserts","./ellipsoidUtils","./Extent","./Multipoint","../chunks/pe","./Point","./Polygon","./Polyline","./SpatialReference","./projection/projectBuffer","./projection/projectors","./projection/projectXYZToVector","./support/GeographicTransformation","./support/spatialReferenceUtils","./support/zscale"],function(e,n,r,t,o,i,l,s,a,c,u,p,f,h,m,d,g,y,x,j,P,w,S){"use strict";r.deprecatedModule(o.getLogger("esri.geometry.projection"),"esri.geometry.projection",{replacement:"esri.geometry.operators.projectOperator",version:"4.32",warnOnce:!0});let M=null,Z=null,v=null;const z={},R=new l.SimpleObservable;function b(e,n,r=null,t=null){return Array.isArray(e)?0===e.length?[]:(a.assertNotMeshes(e),E(Z,e,e[0].spatialReference,n,r,t)):(a.assertNotMesh(e),E(Z,[e],e.spatialReference,n,r,t)[0])}function E(e,n,r,t,o=null,i=null){if(null==r||null==t)return n;if(function(e,n,r){return!r&&(!!w.equals(e,n)||w.isValid(e)&&w.isValid(n)&&!!x.getProjector(e,n))}(r,t,o))return n.map(e=>A(e,r,t));if(null==o&&c.isSphericalECEF(r))return n.map(e=>A(e,r,g.WGS84)).map(e=>F(e,t));if(null==o&&c.isSphericalECEF(t))return n.map(e=>F(e,g.WGS84)).map(e=>A(e,g.WGS84,t));if(null==o){const e=P.cacheKey(r,t);void 0!==z[e]?o=z[e]:(null==(o=T(r,t,void 0))&&(o=new P),z[e]=o)}if(null==M||null==e)throw new C;return null!=i?M._project(e,n,r,t,o,i):M._project(e,n,r,t,o)}function T(e,n,r=null){if(null==e||null==n)return null;if(null==M||null==Z)throw new C;const t=M._getTransformation(Z,e,n,r,r?.spatialReference);return null!==t?P.fromGE(t):null}class C extends t{constructor(){super("projection:not-loaded","projection engine not fully loaded yet, please call load()")}}function F(e,n){try{const r=b(e,n);if(null==r)return null;"xmin"in e&&"xmin"in r&&(r.zmin=e.zmin,r.zmax=e.zmax);const t=S.getGeometryZScaler(r.type,e.spatialReference,n);return null!=t&&t(r),r}catch(e){if(!(e instanceof C))throw e;return null}}function A(e,n,r){return e?"x"in e?function(e,n,r,t){G[0]=e.x,G[1]=e.y;const o=e.z;return G[2]=void 0!==o?o:0,y.projectBuffer(G,n,0,G,t,0)?(r.x=G[0],r.y=G[1],r.spatialReference=t,void 0!==o||c.isSphericalPCPF(t)?(r.z=G[2],r.hasZ=!0):(r.z=void 0,r.hasZ=!1),void 0===e.m?(r.m=void 0,r.hasM=!1):(r.m=e.m,r.hasM=!0),r):null}(e,n,new h,r):"xmin"in e?function(e,n,r,t){const{xmin:o,ymin:i,xmax:l,ymax:s,hasZ:a,hasM:u}=e,p=a?e.zmin:0;if(!j.projectXYZToVector(o,i,p,n,G,t))return null;const f=a||c.isSphericalPCPF(t);r.xmin=G[0],r.ymin=G[1],f&&(r.zmin=G[2]);const h=a?e.zmax:0;return j.projectXYZToVector(l,s,h,n,G,t)?(r.xmax=G[0],r.ymax=G[1],f&&(r.zmax=G[2]),u&&(r.mmin=e.mmin,r.mmax=e.mmax),r.spatialReference=t,r):null}(e,n,new u,r):"rings"in e?function(e,n,r,t){const{rings:o,hasZ:i,hasM:l}=e,s=[];if(!B(o,i??!1,l??!1,n,s,t,0))return null;const a=i||c.isSphericalPCPF(t);return r.rings=s,r.spatialReference=t,r.hasZ=a,r.hasM=l,r}(e,n,new m,r):"paths"in e?function(e,n,r,t){const{paths:o,hasZ:i,hasM:l}=e,s=[];if(!B(o,i??!1,l??!1,n,s,t,0))return null;const a=i||c.isSphericalPCPF(t);return r.paths=s,r.spatialReference=t,r.hasZ=a,r.hasM=l,r}(e,n,new d,r):"points"in e?function(e,n,r,t){const{points:o,hasZ:i,hasM:l}=e,s=[],a=o.length,u=[];for(const e of o)u.push(e[0],e[1],i?e[2]:0);if(!y.projectBuffer(u,n,0,u,t,0,a))return null;const p=i||c.isSphericalPCPF(t);for(let e=0;e<a;++e){const n=3*e,r=u[n],t=u[n+1];p&&l?s.push([r,t,u[n+2],o[e][3]]):p?s.push([r,t,u[n+2]]):l?s.push([r,t,o[e][2]]):s.push([r,t])}return r.points=s,r.spatialReference=t,r.hasZ=i,r.hasM=l,r}(e,n,new p,r):null:null}function B(e,n,r,t,o,i,l=0){const s=new Array;for(const r of e)for(const e of r)s.push(e[0],e[1],n?e[2]:l);if(!y.projectBuffer(s,t,0,s,i,0))return!1;let a=0;o.length=0;const u=n||c.isSphericalPCPF(i);for(const n of e){const e=new Array;for(const t of n)u&&r?e.push([s[a++],s[a++],s[a++],t[3]]):u?e.push([s[a++],s[a++],s[a++]]):r?(e.push([s[a++],s[a++],t[2]]),a++):(e.push([s[a++],s[a++]]),a++);o.push(e)}return!0}const G=s.create();n.getTransformation=T,n.getTransformations=function(e,n,r=null){if(null==M||null==Z)throw new C;const t=M._getTransformationBySuitability(Z,e,n,r,r?.spatialReference);if(null!==t){const e=[];for(const n of t)e.push(P.fromGE(n));return e}return[]},n.isLoaded=function(){return!!M&&f.isLoaded()},n.load=function(n){return null==v&&(v=Promise.all([f.load(),new Promise((n,r)=>e(["../chunks/geometryEngineBase"],n,r)).then(e=>e.geometryEngineBase),new Promise((n,r)=>e(["./geometryAdapters/hydrated"],n,r))])),v.then(([,e,{hydratedAdapter:r}])=>{i.throwIfAborted(n),Z=r,M=e.default,M._enableProjection(f.pe),R.notify()})},n.project=b,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});