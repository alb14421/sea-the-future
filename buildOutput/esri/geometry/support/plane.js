// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../chunks/vec42","./vector","./vectorStacks","../../views/3d/support/mathUtils"],function(t,n,e,r,c,o,i,u){"use strict";function s(t=j){return[t[0],t[1],t[2],t[3]]}const a=c.exactEquals,f=c.equals;function d(t,n){return l(n[0],n[1],n[2],n[3],t)}function l(t,n,e,r,c=s()){return c[0]=t,c[1]=n,c[2]=e,c[3]=r,c}function g(t,n,e){const r=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],c=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return e[0]=n[0]*c,e[1]=n[1]*c,e[2]=n[2]*c,e[3]=-(e[0]*t[0]+e[1]*t[1]+e[2]*t[2]),e}function m(t,n,e,r=s()){const c=e[0]-n[0],o=e[1]-n[1],i=e[2]-n[2],u=t[0]-n[0],a=t[1]-n[1],f=t[2]-n[2],d=o*f-i*a,l=i*u-c*f,g=c*a-o*u,m=d*d+l*l+g*g,p=Math.abs(m-1)>1e-5&&m>1e-12?1/Math.sqrt(m):1;return r[0]=d*p,r[1]=l*p,r[2]=g*p,r[3]=-(r[0]*t[0]+r[1]*t[1]+r[2]*t[2]),r}function p(t,n,r,c=0,o=Math.floor(r*(1/3)),i=Math.floor(r*(2/3))){if(r<3)return!1;n(h,c);let u=o,s=!1;for(;u<r-1&&!s;)n(b,u),u++,s=!e.exactEquals(h,b);if(!s)return!1;for(u=Math.max(u,i),s=!1;u<r&&!s;)n(y,u),u++,e.subtract(P,h,b),e.normalize(P,P),e.subtract(M,b,y),e.normalize(M,M),s=!e.exactEquals(h,y)&&!e.exactEquals(b,y)&&Math.abs(e.dot(P,M))<v;return s?(m(h,b,y,t),!0):(0!==c||1!==o||2!==i)&&p(t,n,r,0,1,2)}const v=.99619469809,h=r.create(),b=r.create(),y=r.create(),P=r.create(),M=r.create();function q(t,n,r){const c=e.scale(i.sv3d.get(),t,e.dot(t,n));return e.subtract(r,n,c),r}function x(t,n){return e.dot(t,n)+t[3]}function L(t){return 0===t||1===t}function S(t,r,c,o,i){const u=e.dot(t,c),s=x(t,r);if(0===u)return s>=0?2:3;let a=-s/u;return 1&o&&(a=n.clamp(a,0,1)),!(4&o)&&a<0||!(8&o)&&a>1?s>=0?2:3:(e.add(i,r,e.scale(i,c,a)),s>=0?0:1)}const j=[0,0,1,0];t.clip=function(t,n){const r=e.dot(t,n.ray.direction),c=-x(t,n.ray.origin);if(c<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return c>0;if((c<0||r<0)&&!(c<0&&r<0))return!0;const o=c/r;return r>0?o<n.c1&&(n.c1=o):o>n.c0&&(n.c0=o),n.c0<=n.c1},t.clipInfinite=function(t,n){const r=e.dot(t,n.ray.direction),c=-x(t,n.ray.origin);if(r>-1e-6&&r<1e-6)return c>0;const o=c/r;return r>0?o<n.c1&&(n.c1=o):o>n.c0&&(n.c0=o),n.c0<=n.c1},t.copy=d,t.create=s,t.distance=function(t,n){return Math.abs(x(t,n))},t.equals=f,t.exactEquals=a,t.fromArray=function(t,n,r=!0){const c=n.length/3;return p(t,(t,r)=>e.set(t,n[3*r+0],n[3*r+1],n[3*r+2]),r?c-1:c)},t.fromManyPoints=p,t.fromNormalAndOffset=function(t,n,r){return e.copy(r,t),r[3]=n,r},t.fromPoints=m,t.fromPositionAndNormal=g,t.fromValues=l,t.fromVectorsAndPoint=function(t,n,r,c){return e.cross(y,n,t),g(r,y,c)},t.getNormal=function(t){return t},t.intersectLine=function(t,n,r,c){return L(S(t,n,e.subtract(i.sv3d.get(),r,n),12,c))},t.intersectLineOrRay=S,t.intersectLineSegment=function(t,n,e){return L(S(t,n.origin,n.vector,0,e))},t.intersectLineSegmentClamp=function(t,n,e){return L(S(t,n.origin,n.vector,1,e))},t.intersectRay=function(t,n,e){return null!=n&&L(S(t,n.origin,n.direction,8,e))},t.isPointInside=function(t,n){return x(t,n)>=0},t.negate=function(t,n){return n[0]=-t[0],n[1]=-t[1],n[2]=-t[2],n[3]=-t[3],n},t.projectPoint=function(t,n,r){const c=e.scale(i.sv3d.get(),t,-t[3]),o=q(t,e.subtract(i.sv3d.get(),n,c),i.sv3d.get());return e.add(r,o,c),r},t.projectPointLocal=function(t,n,r,c){const s=t,a=i.sv3d.get(),f=i.sv3d.get();u.tangentFrame(s,a,f);const d=e.subtract(i.sv3d.get(),r,n),l=o.projectPointSignedLength(a,d),g=o.projectPointSignedLength(f,d),m=o.projectPointSignedLength(s,d);return e.set(c,l,g,m)},t.projectVector=q,t.setOffsetFromPoint=function(t,n,r){return n!==t&&d(t,n),t[3]=-e.dot(t,r),t},t.signedDistance=x,t.up=j,t.wrap=function(t=j[0],n=j[1],e=j[2],r=j[3]){return l(t,n,e,r,i.sv4d.get())},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});