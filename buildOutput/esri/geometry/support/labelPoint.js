// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/PriorityQueue","./aaBoundingRect","./boundsUtils","./centroid","./coordsUtils","./intersectsBase"],function(e,t,n,i,r,a,o){"use strict";function s(e,t){let n,i,r,a,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(n=t.x,i=t.y;t.nextPoint();n=r,i=a)r=t.x,a=t.y,i>e[1]!=a>e[1]&&((r-n)*(e[1]-i)-(a-i)*(e[0]-n)>0?o++:o--);return 0!==o}function u(e,t,n){if(n&&s(e,t))return{coord:e,distance:0};let i=1/0,r=0,o=0,u=[0,0],c=[0,0];const l=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(u[0]=t.x,u[1]=t.y;t.nextPoint();u=c){c=[t.x,t.y],a.projectPointOnLineSeg(l,e,u,c);const n=g(e,l);n<i&&(i=n,r=l[0],o=l[1])}return{coord:[r,o],distance:Math.sqrt(i)}}function c(e,t,i,r){const a=[t,0];let s=1/0,u=1/0,c=!1,N=!1;const f=[[t,r[1]-1],[t,r[3]+1]],h=[0,0],d=[0,0],P=[0,0],y=[[0,0],[0,0]],g=n.create();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(y[0][0]=e.x,y[0][1]=e.y;e.nextPoint();y[0][0]=y[1][0],y[0][1]=y[1][1]){if(y[1][0]=e.x,y[1][1]=e.y,null===l(g,y))continue;if(d[0]=f[0][0],d[1]=f[0][1],P[0]=f[1][0],P[1]=f[1][1],0===x(g,d,P))continue;if(!o.segmentIntersects(f[0],f[1],y[0],y[1],h))continue;const t=h[1];s>u?t<s&&(s=t,c=!0):t<u&&(u=t,N=!0)}return c&&N?a[1]=(s+u)/2:a[0]=a[1]=NaN,a}function l(e,t){if(t.length<2)return null;e||(e=n.create());const[i,r]=t[0],[a,o]=t[1];return e[0]=Math.min(i,a),e[1]=Math.min(r,o),e[2]=Math.max(i,a),e[3]=Math.max(r,o),e}const N=1,f=4,h=3,d=12;function x(e,t,n){let i=P(t,e),r=P(n,e);const a=e[0],o=e[1],s=e[2],u=e[3];if(i&r)return 0;if(!(i|r))return 4;const c=(i?1:0)|(r?2:0);do{const c=n[0]-t[0],l=n[1]-t[1];if(c>l)i&h?(i&N?(t[1]+=l*(a-t[0])/c,t[0]=a):(t[1]+=l*(s-t[0])/c,t[0]=s),i=P(t,e)):r&h?(r&N?(n[1]+=l*(a-n[0])/c,n[0]=a):(n[1]+=l*(s-n[0])/c,n[0]=s),r=P(n,e)):i?(i&f?(t[0]+=c*(o-t[1])/l,t[1]=o):(t[0]+=c*(u-t[1])/l,t[1]=u),i=P(t,e)):(r&f?(n[0]+=c*(o-n[1])/l,n[1]=o):(n[0]+=c*(u-n[1])/l,n[1]=u),r=P(n,e));else if(i&d?(i&f?(t[0]+=c*(o-t[1])/l,t[1]=o):(t[0]+=c*(u-t[1])/l,t[1]=u),i=P(t,e)):r&d?(r&f?(n[0]+=c*(o-n[1])/l,n[1]=o):(n[0]+=c*(u-n[1])/l,n[1]=u),r=P(n,e)):i?(i&N?(t[1]+=l*(a-t[0])/c,t[0]=a):(t[1]+=l*(s-t[0])/c,t[0]=s),i=P(t,e)):(r&N?(n[1]+=l*(a-n[0])/c,n[0]=a):(n[1]+=l*(s-n[0])/c,n[0]=s),r=P(n,e)),i&r)return 0}while(i|r);return c}function P(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function y(e,t,n){return e+(t-e)*n}function g(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function m(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;const n=isNaN(e),i=isNaN(t);return n<i?-1:n>i?1:0}class C{constructor(e,t,n,i){this.x=e,this.y=t,this.cellSize=n,this.distancefromCellCenter=a.distanceFromPointToPolygon(e,t,i),this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}}e.getLabelPoint=function(e){if(0===e.totalSize)return null;const t=i.getCursorBoundsXY(e);if(!t)return null;const a=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*222045e-19;let o=0,l=0;e.reset();for(let t=0;e.nextPath();t++){const n=e.getCurrentRingArea();n>l&&(l=n,o=t)}if(e.seekPath(o),0===e.pathSize)return null;e.seekPathStart();const N=i.getCursorPathBounds(e);if(Math.abs(l)<=2*a*a)return[(N[0]+N[2])/2,(N[1]+N[3])/2];e.seekPathStart();const f=r.ringCentroidCursorXY(e,n.create());if(null===f)return null;if(e.totalPoints<4)return f;const h=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],d=[NaN,NaN,NaN,NaN],x=[NaN,NaN,NaN,NaN];let P=!1,C=u(f,e,!0);0===C.distance&&(P=!0,h[0][0]=f[0],h[0][1]=f[1],C=u(f,e,!1)),d[0]=C.distance,x[0]=0;const b=[NaN,NaN];let M=!1,S=.25,w=-1,k=NaN;do{if(k=NaN,h[1]=c(e,y(N[0],N[2],S),0,t),isNaN(h[1][0])||isNaN(h[1][1])||(C=u(h[1],e,!1),k=C.distance),!isNaN(k)&&k>a&&s(h[1],e))M=!0,d[1]=k,x[1]=g(h[1],f);else if(!isNaN(k)&&k>w&&(w=k,b[0]=h[1][0],b[1]=h[1][1]),S-=.01,S<.1){if(!(w>=0))break;M=!0,d[1]=w,h[1][0]=b[0],h[1][1]=b[1],x[1]=g(h[1],f)}}while(!M);M=!1,S=.5,w=-1;let z=.01,p=1;do{if(k=NaN,h[2]=c(e,y(N[0],N[2],S),0,t),isNaN(h[2][0])||isNaN(h[2][1])||(C=u(h[2],e,!1),k=C.distance),!isNaN(k)&&k>a&&s(h[2],e))M=!0,d[2]=k,x[2]=g(h[2],f);else if(!isNaN(k)&&k>w)w=k,b[0]=h[2][0],b[1]=h[2][1];else if(k>w&&(w=k,b[0]=h[2][0],b[1]=h[2][1]),S=.5+z*p,z+=.01,p*=-1,S<.3||S>.7){if(!(w>=0))break;M=!0,d[2]=w,h[2][0]=b[0],h[2][1]=b[1],x[2]=g(h[2],f)}}while(!M);M=!1,S=.75,w=-1;do{if(k=NaN,h[3]=c(e,y(N[0],N[2],S),0,t),isNaN(h[3][0])||isNaN(h[3][1])||(C=u(h[3],e,!1),k=C.distance),!isNaN(k)&&k>a&&s(h[3],e))M=!0,d[3]=k,x[3]=g(h[3],f);else if(k>w&&(w=k,b[0]=h[3][0],b[1]=h[3][1]),S+=.01,S>.9){if(!(w>=0))break;M=!0,d[3]=w,h[3][0]=b[0],h[3][1]=b[1],x[3]=g(h[3],f)}}while(!M);const q=[0,1,2,3],T=P?0:1;let B;for(let e=T;e<4;e++)for(let e=T;e<3;e++){const t=x[e],n=x[e+1];m(t,n)>0&&(B=q[e],q[e]=q[e+1],q[e+1]=B,x[e]=n,x[e+1]=t)}let D=T,R=0,j=0;for(let e=T;e<4;e++){switch(e){case 0:j=2*d[q[e]];break;case 1:j=1.66666666*d[q[e]];break;case 2:j=1.33333333*d[q[e]];break;case 3:j=d[q[e]]}j>R&&(R=j,D=q[e])}return h[D]},e.getPolylabelPoint=function(e){if(!e.nextPath()||!e.pathSize)return null;const n=i.getCursorPathBounds(e),a=n[2]-n[0],o=n[3]-n[1];if(0===a||0===o)return[n[0]+a/2,n[1]+o/2];const s=Math.max(Math.min(a,o)/100,1),u=new t((e,t)=>t.maxDistanceToPolygon-e.maxDistanceToPolygon),c=Math.min(a,o);let l=c/2,N=0,f=0;for(N=n[0];N<n[2];N+=c)for(f=n[1];f<n[3];f+=c)u.enqueue(new C(N+l,f+l,l,e));e.reset(),e.nextPath();const h=r.ringsCentroidCursor(e);if(null===h)return null;let d,x=new C(h[0],h[1],0,e);for(;u.size>0;)d=u.dequeue(),d.distancefromCellCenter>x.distancefromCellCenter&&(x=d),d.maxDistanceToPolygon-x.distancefromCellCenter<=s||(l=d.cellSize/2,u.enqueue(new C(d.x-l,d.y-l,l,e)),u.enqueue(new C(d.x+l,d.y-l,l,e)),u.enqueue(new C(d.x-l,d.y+l,l,e)),u.enqueue(new C(d.x+l,d.y+l,l,e)));return[x.x,x.y]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});