// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./jsonUtils"],function(n,t){"use strict";function e(n){if(function(n){return"lowerLeft"===n.originPosition&&4===n.scale.length&&4===n.translate.length}(n))return n;const{originPosition:t,scale:e,translate:r}=n,o=e[0]??1,u=e[1]??1;return{originPosition:"lowerLeft",scale:[o,"lowerLeft"===t?u:-u,e[2]??1,e[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function r({scale:n,translate:t},e){return Math.round((e-t[0])/n[0])}function o({scale:n,translate:t},e){return Math.round((e-t[1])/n[1])}function u({scale:n,translate:t},e){return Math.round(((e??0)-t[2])/n[2])}function i({scale:n,translate:t},e){return e?Math.round((e-t[3])/n[3]):0}function s(n,t){return n&&t?h:n&&!t?l:!n&&t?c:a}const a=(n,t)=>{const e=[];if(!t.length)return null;const u=t[0];let i=r(n,u[0]),s=o(n,u[1]);e.push([i,s]);for(let u=1;u<t.length;u++){const[a,l]=t[u],c=r(n,a),h=o(n,l);c===i&&h===s||e.push([c-i,h-s]),i=c,s=h}return e},l=(n,t)=>{const e=[];if(!t.length)return null;const i=t[0];let s=r(n,i[0]),a=o(n,i[1]),l=u(n,i[2]);e.push([s,a,l]);for(let i=1;i<t.length;i++){const[c,h,f]=t[i],m=r(n,c),g=o(n,h),z=u(n,f);m===s&&g===a&&z===l||e.push([m-s,g-a,z]),s=m,a=g,l=z}return e},c=(n,t)=>{const e=[];if(!t.length)return null;const u=t[0];let s=r(n,u[0]),a=o(n,u[1]),l=i(n,u[2]);e.push([s,a,l]);for(let u=1;u<t.length;u++){const[c,h,f]=t[u],m=r(n,c),g=o(n,h),z=i(n,f);m===s&&g===a&&z===l||e.push([m-s,g-a,z]),s=m,a=g,l=z}return e},h=(n,t)=>{const e=[];if(!t.length)return null;const s=t[0];let a=r(n,s[0]),l=o(n,s[1]),c=u(n,s[2]),h=i(n,s[3]);e.push([a,l,c,h]);for(let s=1;s<t.length;s++){const[f,m,g,z]=t[s],x=r(n,f),M=o(n,m),y=u(n,g),d=i(n,z);x===a&&M===l&&y===c&&d===h||e.push([x-a,M-l,y,d]),a=x,l=M,c=y,h=d}return e};function f({scale:n,translate:t},e){return e*n[0]+t[0]}function m({scale:n,translate:t},e){return e*n[1]+t[1]}function g({scale:n,translate:t},e){return(e??0)*n[2]+t[2]}function z({scale:n,translate:t},e){return e?e*n[3]+t[3]:0}function x(n,t){return n&&t?q:n&&!t?y:!n&&t?d:M}const M=(n,t)=>{const e=new Array(t.length);if(!t.length)return e;const r=t[0];let o=f(n,r[0]),u=m(n,r[1]);e[0]=[o,u];const{scale:i,originPosition:s}=n,a=i[0],l="lowerLeft"===s?i[1]:-i[1];for(let n=1;n<t.length;n++){const[r,i]=t[n];o+=a*r,u+=l*i,e[n]=[o,u]}return e},y=(n,t)=>{const e=new Array(t.length);if(!t.length)return e;const r=t[0];let o=f(n,r[0]),u=m(n,r[1]);e[0]=[o,u,g(n,r[2])];const{scale:i,originPosition:s}=n,a=i[0],l="lowerLeft"===s?i[1]:-i[1];for(let r=1;r<t.length;r++){const[i,s,c]=t[r];o+=a*i,u+=l*s,e[r]=[o,u,g(n,c)]}return e},d=(n,t)=>{const e=new Array(t.length);if(!t.length)return e;const r=t[0];let o=f(n,r[0]),u=m(n,r[1]);e[0]=[o,u,z(n,r[2])];const{scale:i,originPosition:s}=n,a=i[0],l="lowerLeft"===s?i[1]:-i[1];for(let r=1;r<t.length;r++){const[i,s,c]=t[r];o+=a*i,u+=l*s,e[r]=[o,u,z(n,c)]}return e},q=(n,t)=>{const e=new Array(t.length);if(!t.length)return e;const r=t[0];let o=f(n,r[0]),u=m(n,r[1]);e[0]=[o,u,g(n,r[2]),z(n,r[3])];const{scale:i,originPosition:s}=n,a=i[0],l="lowerLeft"===s?i[1]:-i[1];for(let r=1;r<t.length;r++){const[i,s,c,h]=t[r];o+=a*i,u+=l*s,e[r]=[o,u,g(n,c),z(n,h)]}return e};function p(n,t,e){const r=new Array(e.length);for(let o=0;o<e.length;o++)r[o]=t(n,e[o]);return r}function I(n,t,e){let[r,o]=e[0],u=Math.min(r,t[0]),i=Math.min(o,t[1]),s=Math.max(r,t[2]),a=Math.max(o,t[3]);for(let n=1;n<e.length;n++){const[t,l]=e[n];r+=t,o+=l,t<0&&(u=Math.min(u,r)),t>0&&(s=Math.max(s,r)),l<0?i=Math.min(i,o):l>0&&(a=Math.max(a,o))}return n[0]=u,n[1]=i,n[2]=s,n[3]=a,n}function P(n,t){if(!t.length)return null;n[0]=n[1]=Number.POSITIVE_INFINITY,n[2]=n[3]=Number.NEGATIVE_INFINITY;for(let e=0;e<t.length;e++)I(n,n,t[e]);return n}function Z(n,t,s){const a=e(n);return t.xmin=r(a,s.xmin),t.ymin=o(a,s.ymin),t.xmax=r(a,s.xmax),t.ymax=o(a,s.ymax),s.hasZ&&(t.zmin=u(a,s.zmin),t.zmax=u(a,s.zmax)),s.hasM&&(t.mmin=i(a,s.mmin),t.mmax=i(a,s.mmax)),t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t}function A(n,t,r){const o=e(n);return t.points=s(r.hasZ,r.hasM)(o,r.points)??[],t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t}function N(n,t,s){const a=e(n);return t.x=r(a,s.x),t.y=o(a,s.y),null!=s.z&&(t.z=u(a,s.z)),null!=s.m&&(t.m=i(a,s.m)),t}function Y(n,t,r){const o=function(n,t,e,r){const o=[],u=s(e,r);for(let e=0;e<t.length;e++){const r=u(n,t[e]);r&&r.length>=3&&o.push(r)}return o.length?o:null}(e(n),r.rings,r.hasZ,r.hasM);return o?(t.rings=o,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}function T(n,t,r){const o=function(n,t,e,r){const o=[],u=s(e,r);for(let e=0;e<t.length;e++){const r=u(n,t[e]);r&&r.length>=2&&o.push(r)}return o.length?o:null}(e(n),r.paths,r.hasZ,r.hasM);return o?(t.paths=o,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}n.getQuantizedBoundsCoordsArray=I,n.getQuantizedBoundsCoordsArrayArray=P,n.getQuantizedBoundsPaths=function(n){return P([0,0,0,0],n)},n.getQuantizedBoundsPoints=function(n){const t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return I(t,t,n)},n.getQuantizedBoundsRings=function(n){return P([0,0,0,0],n)},n.normalizeTransform=e,n.quantizeBounds=function(n,t,u){const i=e(n);return t[0]=r(i,u[0]),t[3]=o(i,u[1]),t[2]=r(i,u[2]),t[1]=o(i,u[3]),t},n.quantizeCoordsArrayXY=a,n.quantizeCoordsArrayXYM=c,n.quantizeCoordsArrayXYZ=l,n.quantizeCoordsArrayXYZM=h,n.quantizeExtent=Z,n.quantizeGeometry=function(n,e){return n&&e?t.isPoint(e)?N(n,{},e):t.isPolyline(e)?T(n,{},e):t.isPolygon(e)?Y(n,{},e):t.isMultipoint(e)?A(n,{},e):t.isExtent(e)?Z(n,{},e):null:null},n.quantizeM=i,n.quantizeMultipoint=A,n.quantizePoint=N,n.quantizePolygon=Y,n.quantizePolyline=T,n.quantizeX=r,n.quantizeY=o,n.quantizeZ=u,n.toQuantizationTransform=function(n){return n?{originPosition:"upper-left"===n.originPosition?"upperLeft":"lower-left"===n.originPosition?"lowerLeft":n.originPosition,scale:n.tolerance?[n.tolerance,n.tolerance,1,1]:[1,1,1,1],translate:null!=n.extent?[n.extent.xmin,n.extent.ymax,n.extent.zmin??0,n.extent.mmin??0]:[0,0,0,0]}:null},n.unquantizeBounds=function(n,t,r){const o=e(n);return r?(t[0]=f(o,r[0]),t[1]=m(o,r[3]),t[2]=f(o,r[2]),t[3]=m(o,r[1]),t):[f(o,t[0]),m(o,t[3]),f(o,t[2]),m(o,t[1])]},n.unquantizeCoordsArrayArray=p,n.unquantizeCoordsArrayXY=M,n.unquantizeCoordsArrayXYM=d,n.unquantizeCoordsArrayXYZ=y,n.unquantizeCoordsArrayXYZM=q,n.unquantizeExtent=function(n,t,r,o=r.hasZ??!1,u=r.hasM??!1){const i=e(n);return t.xmin=f(i,r.xmin),t.xmax=f(i,r.xmax),t.ymin=m(i,r.ymin),t.ymax=m(i,r.ymax),o&&(t.zmin=g(i,r.zmin),t.zmax=g(i,r.zmax)),u&&(t.mmin=z(i,r.mmin),t.mmax=z(i,r.mmax)),t.hasZ=o,t.hasM=u,t},n.unquantizeM=z,n.unquantizeMultipoint=function(n,t,r,o=r?.hasZ??!1,u=r?.hasM??!1){if(null!=r){const i=e(n);t.points=x(o,u)(i,r.points),t.hasZ=o,t.hasM=u}return t},n.unquantizePoint=function(n,t,r,o=null!=r?.z,u=null!=r?.m){if(null==r)return t;const i=e(n);return t.x=f(i,r.x),t.y=m(i,r.y),o&&(t.z=g(i,r.z)),u&&(t.m=z(i,r.m)),t},n.unquantizePolygon=function(n,t,r,o=r?.hasZ??!1,u=r?.hasM??!1){if(null!=r){const i=e(n);t.rings=p(i,x(o,u),r.rings),t.hasZ=o,t.hasM=u}return t},n.unquantizePolyline=function(n,t,r,o=r?.hasZ??!1,u=r?.hasM??!1){if(null!=r){const i=e(n);t.paths=p(i,x(o,u),r.paths),t.hasZ=o,t.hasM=u}return t},n.unquantizeX=f,n.unquantizeY=m,n.unquantizeZ=g,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});