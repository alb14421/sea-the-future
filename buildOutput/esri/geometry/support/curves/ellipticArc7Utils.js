// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/math/vec2","../aaBoundingRect","./curveUtils","./mathUtils"],function(t,n,s,a,e,i,r){"use strict";class c{constructor(t,n,s,a,e,i,r,c,o){this.cx=t,this.cy=n,this.a=s,this.b=a,this.cosR=e,this.sinR=i,this.u1=r,this.u2=c,this.isInvalid=o}}function o(t,n){const[s,a,e,i,o,l,u]=n.a,[h,f]=t,[p,M]=s,[d,m]=a,P=l*u,b=Math.cos(o),g=Math.sin(o),v=r.wrapAtan2(1/P*(f-m)*b-1/P*(h-d)*g,1/l*(f-m)*g+1/l*(h-d)*b),A=r.correctSweepAndWinding(r.wrapAtan2(1/P*(M-m)*b-1/P*(p-d)*g,1/l*(M-m)*g+1/l*(p-d)*b),v,n);return new c(d,m,l,P,b,g,v,A,0===l||0===P)}function l(t,n){const{a:s,b:a,cosR:e,sinR:i,cx:r,cy:c}=t,o=Math.cos(n),l=Math.sin(n);return[s*o*e-a*l*i+r,s*o*i+a*l*e+c]}function u(t,n){const{u1:s,u2:a}=t;return l(t,s*(1-n)+a*n)}const h=s.create(),f=s.create(),p=s.create(),M=s.create();t.DerivedEllipse=c,t.closestPointOnEllipse=function(t,n){const{a:s,b:a,cosR:e,sinR:i,u1:c,u2:o}=t,u=Math.PI/6,h=[1*u,2*u,4*u,5*u,7*u,8*u,10*u,11*u],f=r.findClosestAndFurthestCurveParametersToPoint(n,h,n=>{const r=Math.cos(n),c=Math.sin(n),[o,u]=l(t,n);return[o,u,-s*e*c-a*i*r,-s*i*c+a*e*r,-s*e*r+a*i*c,-s*i*r-a*e*c]}).map(t=>r.matchWindingAndWrap(t,c,o));f.push(c,o);let p,M,d=1/0;for(const s of f){const a=(s-c)/(o-c);if(a<0||a>1)continue;const e=l(t,s),[i,r]=e,u=n[0]-i,h=n[1]-r,f=u*u+h*h;f<d&&(p=a,M=e,d=f)}return{t:p,curvePoint:M,distance:Math.sqrt(d)}},t.deriveEllipse=o,t.ellipticArcExtent=function(t,n,s){const a=o(n,s),{a:i,b:c,u1:u,u2:h,cosR:f,sinR:p,isInvalid:M}=a,d=h-u,m=s.a[0];if(e.expandPointInPlace(t,n),e.expandPointInPlace(t,m),M)return t;const P=Math.atan2(-c*p,i*f),b=P+Math.PI,g=Math.atan2(c*f,i*p),v=g+Math.PI;for(const n of[P,b,g,v]){const s=r.matchWindingAndWrap(n,u,h),i=(s-u)/d;i>0&&i<1&&e.expandPointInPlace(t,l(a,s))}return t},t.ellipticArcLength=function(t,n,s){const[a,e,i,c,h,f,p]=n.a,M=o(t,n),{u1:d,u2:m,isInvalid:P}=M,b=m-d;if(P)return Math.sqrt(r.distance2(t,a));const g=[0,0];let v=0,A=[u(M,0),u(M,.25),u(M,.5),u(M,.75),u(M,1)];for(let t=0;t<14;t++){const t=A.length-1,n=b/(2*t),a=[];for(let s=0;s<t;s++)a.push(A[s]),a.push(l(M,d+(2*s+1)*n));a.push(A[A.length-1]),A=a,v=0;let i=0;for(let t=1;t<A.length;t++){const n=A[t-1],s=A[t];if(v+=Math.sqrt(r.distance2(n,s)),t>1){const a=A[t-2],c=r.intersectLineLine(g,a,n,e,s);i+=c?Math.sqrt(r.distance2(n,c)):Math.abs(s[0]-n[0])+Math.abs(s[1]-n[1])}else i+=v}if(i-v<s)return v}return v},t.interpolateEllipse=u,t.splitEllipticArc7=function(t,n,s){if(s<0||s>1)return[];if(0===s||1===s)return[i.cloneCurve(n)];const[a,[e,r],c,o,l,h,f]=n.a,{u1:p,u2:M}=t,d=p*(1-s)+M*s;return[{a:[[...u(t,s)],[e,r],Math.abs(d-p)<Math.PI?1:0,o,l,h,f]},{a:[[...a],[e,r],Math.abs(M-d)<Math.PI?1:0,o,l,h,f]}]},t.transformEllipticArc=function(t,s,e){const[i,c,l,u,d,m,P]=s.a,b=o(t,s),{cosR:g,sinR:v,a:A,b:x,cx:I,cy:R}=b,q=a.transformMat3([0,0],i,e),y=a.transformMat3([0,0],c,e),E=e[0]*e[4]<0?1-u:u;{const t=A*A*v*v+x*x*g*g,s=2*(x*x-A*A)*v*g,a=A*A*g*g+x*x*v*v,e=-2*t*I-s*R,i=-s*I-2*a*R,r=t*I*I+s*I*R+a*R*R-A*A*x*x;n.set(h,t,s/2,e/2,s/2,a,i/2,e/2,i/2,r)}if(n.invert(f,e),null==f){const n=a.transformMat3([0,0],t,e);return{a:[q,y,l,u,r.wrapAtan2(q[1],q[0]),Math.sqrt(r.distance2(q,n))/2,0]}}n.transpose(p,f),n.multiply(M,n.multiply(M,p,h),f);{const t=M[0],n=2*M[1],s=M[4],a=2*M[2],e=2*M[5],i=n*n-4*t*s,c=2*(t*e*e+s*a*a-n*a*e+i*M[8]),o=Math.sqrt((t-s)**2+n*n),u=-Math.sqrt(c*(t+s+o))/i,h=-Math.sqrt(c*(t+s-o))/i;return{a:[q,y,l,E,.5*r.wrapAtan2(-n,s-t),u,h/u]}}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});