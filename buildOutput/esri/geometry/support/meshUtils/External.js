// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../request","../../../core/arrayUtils","../../../core/has","../../../core/promiseUtils","../../../layers/support/infoFor3D"],function(e,t,s,r,a,i){"use strict";const n=/^(model\/gltf\+json)|(model\/gltf-binary)$/,o=/\.(gltf|glb)/i;function l(e){switch(e?.type){case"client":return Array.isArray(e.files)?e.files.some(c):c(e.files);case"service":return e.assets.some(c);case"loadable":return!0;default:return!1}}function c(e){if(e instanceof File){const{type:t,name:s}=e;return n.test(t)||o.test(s)}return n.test(e.assetMimeType)||o.test(e.assetName)}e.ServiceAsset=class{constructor(e,t,s){this.assetName=e,this.assetMimeType=t,this.parts=s}equals(e){return this===e||this.assetName===e.assetName&&this.assetMimeType===e.assetMimeType&&s.equals(this.parts,e.parts,(e,t)=>e.equals(t))}isOnService(e){return this.parts.every(t=>t.isOnService(e))}makeHash(){let e="";for(const t of this.parts)e+=t.partHash;return e}async toBlob(e){const{parts:t}=this;if(1===t.length)return t[0].toBlob(e);const s=await Promise.all(t.map(t=>t.toBlob(e)));return a.throwIfAborted(e),new Blob(s)}},e.ServiceAssetPart=class{constructor(e,t){this.partUrl=e,this.partHash=t}equals(e){return this===e||this.partUrl===e.partUrl&&this.partHash===e.partHash}isOnService(e){return this.partUrl.startsWith(`${e.path}/assets/`)}async toBlob(e){const{data:s}=await t(this.partUrl,{responseType:"blob"});return a.throwIfAborted(e),s}},e.assetFormatId=function(e,t){return e instanceof File?i.getFileFormatId(e,t):i.getMimeTypeOrFilenameFormatId(e.assetMimeType,e.assetName,t)},e.externalIsOnService=function(e,t){if(!e)return!1;const{source:s}=e;return function(e,t){return"service"===e.type&&e.assets.every(e=>e.isOnService(t))}(s,t)},e.externalSourceToMultiPart=function(e){switch(e.type){case"client":return Array.isArray(e.files)?e.files:[e.files];case"service":return e.assets;case"loadable":return}},e.externalSourcesAreEqual=function(e,t){if(e===t)return!0;const{source:s}=e,{source:r}=t;if(s===r)return!0;if("service"===s.type&&"service"===r.type){if(s.assets.length!==r.assets.length)return!1;const e=(e,t)=>e.assetName<t.assetName?-1:e.assetName>t.assetName?1:0,t=[...s.assets].sort(e),a=[...r.assets].sort(e);for(let e=0;e<t.length;++e)if(!t[e].equals(a[e]))return!1;return!0}return!1},e.isDisplayAsset=c,e.isDisplayExternal=function(e){return l(e?.source)},e.isDisplaySource=l,e.isOriginalExternal=function(e){return!!e.original},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});