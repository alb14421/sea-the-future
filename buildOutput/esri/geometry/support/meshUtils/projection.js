// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/math/mat4","../../../core/libs/gl-matrix-2/factories/mat4f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../projection/computeTranslationToOriginAndRotation","../../projection/projectBuffer","../Ellipsoid","../spatialReferenceUtils","../webMercatorUtils","../buffer/BufferView","../../../chunks/vec3","../../../chunks/vec4"],function(r,e,t,o,f,n,a,c,i,u,l,s,m,V,y,p){"use strict";function d(r,e,t,o,f){const n=0===e?3:4,a=[0,0];for(let e=0,c=1;e<r.length;e+=n,c+=3){o(t[c],a);const i=r[e]*a[0],u=r[e+1]*a[1],l=r[e+2],s=1/Math.sqrt(i*i+u*u+l*l);f[e]=i*s,f[e+1]=u*s,f[e+2]=l*s,4===n&&(f[e+3]=r[e+3])}return f}function T(r,e,o,n,a){switch(i.computeTranslationToOriginAndRotation(n,o,A,n),1===r&&f.invert(A,A),e){case 0:return t.normalFromMat4(a,A);case 1:return t.fromMat4(a,A)}}function g(r,e,t,o,f,n,c,i){if(!e)return;const u=o.count;if(function(r){return r.isWGS84||s.isCGCS2000(r)||s.isMars(r)||s.isMoon(r)}(f))for(let o=0;o<u;o++)n.getVec(o,w),e.getVec(o,B),a.transformMat3(B,B,T(r,t,w,c,M)),i.setVec(o,B);else for(let f=0;f<u;f++){n.getVec(f,w),e.getVec(f,B);const u=m.y2lat(o.get(f,1));let l=Math.cos(u);1===t!=(0===r)&&(l=1/l),T(r,t,w,c,M),0===r?(M[0]*=l,M[1]*=l,M[2]*=l,M[3]*=l,M[4]*=l,M[5]*=l):(M[0]*=l,M[3]*=l,M[6]*=l,M[1]*=l,M[4]*=l,M[7]*=l),a.transformMat3(B,B,M),a.normalize(B,B),i.setVec(f,B)}return i}const w=c.create(),B=c.create(),A=n.create(),M=o.create();r.loadProjectErrorMessage="Projection may be possible after calling projection.load().",r.logProjectionError=function(r,e,t,o){r.error(`Failed to project from (wkid:${e.wkid}) to (wkid:${t.wkid}).${o?" ":""}${o}`)},r.projectFromPCPF=function(r,e,t,o){return u.projectBuffer(r,e,0,t,o,0)?t:null},r.projectNormalFromPCPF=function(r,e,t,o,f,n){return g(1,V.BufferViewVec3f.fromTypedArray(r),0,V.BufferViewVec3f64.fromTypedArray(e),t,V.BufferViewVec3f64.fromTypedArray(o),f,V.BufferViewVec3f.fromTypedArray(n))?n:null},r.projectNormalToPCPF=function(r,e,t,o,f,n){return g(0,V.BufferViewVec3f.fromTypedArray(r),0,V.BufferViewVec3f64.fromTypedArray(e),t,V.BufferViewVec3f64.fromTypedArray(o),f,V.BufferViewVec3f.fromTypedArray(n))?n:null},r.projectTangentFromPCPF=function(r,e,t,o,f,n){if(!g(1,V.BufferViewVec3f.fromTypedArray(r,16),1,V.BufferViewVec3f64.fromTypedArray(e),t,V.BufferViewVec3f64.fromTypedArray(o),f,V.BufferViewVec3f.fromTypedArray(n,16)))return null;for(let e=3;e<r.length;e+=4)n[e]=r[e];return n},r.projectTangentToPCPF=function(r,e,t,o,f,n){if(!g(0,V.BufferViewVec3f.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),1,V.BufferViewVec3f64.fromTypedArray(e),t,V.BufferViewVec3f64.fromTypedArray(o),f,V.BufferViewVec3f.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let e=3;e<r.length;e+=4)n[e]=r[e];return n},r.projectToPCPF=function(r,e,t,o){return u.projectBuffer(r,e,0,t,o,0)?t:null},r.transformNormal=function(r,o,f){return t.normalFromMat4(M,f),y.transformMat3(o,r,M),e.hasScaling(M)&&y.normalize(o,o),o},r.transformTangent=function(r,o,f){return t.fromMat4(M,f),p.transformMat3(o,r,M),e.hasScaling(M)&&y.normalize(o,o,4),o},r.transformVectorENUPlateCarree=function(r,t,o,f){const n=0===t;return d(r,t,o,(r,t)=>{const o=Math.cos(e.deg2rad(r));t[0]=n?o:1/o,t[1]=1},f)},r.transformVectorWMPlateCarree=function(r,e,t,o){const f=0===e;return d(r,e,t,(r,e)=>{const t=Math.cosh(-r/l.earth.radius);e[0]=1,e[1]=f?t:1/t},o)},Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});