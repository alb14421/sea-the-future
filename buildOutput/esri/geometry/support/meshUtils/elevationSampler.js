// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/workers/workers","../../../core/libs/gl-matrix-2/factories/vec3f64","../ray","../triangle","./ElevationSamplerWorker","../../../layers/support/ElevationSampler"],function(e,t,a,n,r,l,o){"use strict";class i extends o.ElevationSamplerBase{constructor(e,t,a){super(),this._rindex=t,this.demResolution={min:0,max:0},this.spatialReference=e.spatialReference.clone(),this.extent=e.extent.clone(),this.noDataValue=a?.noDataValue||0}elevationAt(e,t){let a=Number.NEGATIVE_INFINITY;return n.fromValues([e,t,0],[0,0,-1],p),this._rindex.search({minX:e,maxX:e,minY:t,maxY:t},e=>{r.intersectRay(e,p,f)&&f[2]>a&&(a=f[2])}),a===Number.NEGATIVE_INFINITY?this.noDataValue:a}}const s=new l;let c=0,u=null,m=0;const p=n.fromValues([0,0,0],[0,0,-1]),f=a.create();e.create=async function(e,a){const n=await(++c,m&&(clearTimeout(m),m=0),u||(u=t.open("ElevationSamplerWorker").catch(()=>null),u)),r=await s.createIndex(e,n);return function(e){--c,null!=e&&0===c&&(m=setTimeout(()=>{e.close(),u=null,m=0},1e4))}(n),new i(e,r,a)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});