// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../MeshComponent","../MeshVertexAttributes","../meshVertexSpaceUtils","./vertexSpaceConversion"],function(e,t,n,r,o,a,i,s){"use strict";const l={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[3,1,2],west:[-3,-1,2],north:[-1,3,2],south:[1,-3,2],up:[1,2,3],down:[1,-2,-3]}},c={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},f={south:0,east:1,north:2,west:3,up:4,down:5},u=r.create(),h=t.create();e.boxFaceOrder=f,e.convertPlaneSizeParameter=function(e,t){const n="number"==typeof t?t:null!=t?t.width:1,r="number"==typeof t?t:null!=t?t.height:1;switch(e){case"up":case"down":return{width:n,depth:r};case"north":case"south":return{width:n,height:r};case"east":case"west":return{depth:n,height:r}}},e.convertUnitGeometry=function(e,t,r){e.isPlane||function(e){for(let t=0;t<e.position.length;t+=3)e.position[t+2]+=.5}(e),function(e,t){if(null!=t){h[0]=t[0],h[4]=t[1],h[8]=t[2];for(let t=0;t<e.position.length;t+=3){for(let n=0;n<3;n++)u[n]=e.position[t+n];n.transformMat3(u,u,h);for(let n=0;n<3;n++)e.position[t+n]=u[n]}if(t[0]!==t[1]||t[1]!==t[2]){h[0]=1/t[0],h[4]=1/t[1],h[8]=1/t[2];for(let t=0;t<e.normal.length;t+=3){for(let n=0;n<3;n++)u[n]=e.normal[t+n];n.transformMat3(u,u,h),n.normalize(u,u);for(let n=0;n<3;n++)e.normal[t+n]=u[n]}}}}(e,function(e,t,n){const r=s.getUnitToSpatialReferenceScaleConversion(t,n);if(null==e&&1===r)return null;if(null==e)return[r,r,r];if("number"==typeof e){const t=e*r;return[t,t,t]}return[null!=e.width?e.width*r:r,null!=e.depth?e.depth*r:r,null!=e.height?e.height*r:r]}(r?.size,r?.unit,t.spatialReference));const l=i.selectVertexSpace(t,r),c=t.spatialReference.isGeographic?i.selectVertexSpace(t):l,f=s.convertVertexSpace({vertexAttributes:e,vertexSpace:c,spatialReference:t.spatialReference},l,{allowBufferReuse:!0});return{vertexAttributes:new a.MeshVertexAttributes({...f,uv:e.uv}),vertexSpace:l,components:[new o({faces:e.faces,material:r?.material||null})],spatialReference:t.spatialReference}},e.createUnitSizeBox=function(){const{faceDescriptions:e,faceVertexOffsets:t,uvScales:n}=c,r=4*e.length,o=new Float64Array(3*r),a=new Float32Array(3*r),i=new Float32Array(2*r),s=new Uint32Array(2*e.length*3);let l=0,f=0,u=0,h=0;for(let r=0;r<e.length;r++){const c=e[r],p=l/3;for(const e of t)s[h++]=p+e;const w=c.corners;for(let e=0;e<4;e++){const t=w[e];let r=0;i[u++]=.25*n[e][0]+c.uvOrigin[0],i[u++]=c.uvOrigin[1]-.25*n[e][1];for(let e=0;e<3;e++)0!==c.axis[e]?(o[l++]=.5*c.axis[e],a[f++]=c.axis[e]):(o[l++]=.5*t[r++],a[f++]=0)}}return{position:o,normal:a,uv:i,faces:s}},e.createUnitSizeCylinder=function(e=0){const t=Math.round(16*2**e),n=4*(t+1)+2*t,r=new Float64Array(3*n),o=new Float32Array(3*n),a=new Float32Array(2*n),i=new Uint32Array(4*t*3);let s=0,l=0,c=0,f=0,h=0;for(let e=0;e<=5;e++){const n=0===e||5===e,p=e<=1||e>=4,w=2===e||4===e,v=n?t-1:t;for(let x=0;x<=v;x++){const g=x/v*2*Math.PI,m=n?0:.5;u[0]=m*Math.sin(g),u[1]=m*-Math.cos(g),u[2]=e<=2?.5:-.5;for(let t=0;t<3;t++)r[s++]=u[t],o[l++]=p?2===t?e<=1?1:-1:0:2===t?0:u[t]/m;a[c++]=(x+(n?.5:0))/t,a[c++]=e<=1?1*e/3:e<=3?1*(e-2)/3+1/3:1*(e-4)/3+2/3,w||0===e||x===t||(5!==e&&(i[f++]=h,i[f++]=h+1,i[f++]=h-t),1!==e&&(i[f++]=h,i[f++]=h-t,i[f++]=h-t-1)),h++}}return{position:r,normal:o,uv:a,faces:i}},e.createUnitSizePlane=function(e){const t=l.facingAxisOrderSwap[e],n=l.position,r=l.normal,o=new Float64Array(n.length),a=new Float32Array(r.length);let i=0;for(let e=0;e<4;e++){const e=i;for(let s=0;s<3;s++){const l=t[s],c=Math.abs(l)-1,f=l>=0?1:-1;o[i]=n[e+c]*f,a[i]=r[e+c]*f,i++}}return{position:o,normal:a,uv:new Float32Array(l.uv),faces:new Uint32Array(l.faces),isPlane:!0}},e.createUnitSizeSphere=function(e=0){const t=Math.round(8*2**e),n=2*t,r=(t-1)*(n+1)+2*n,o=new Float64Array(3*r),a=new Float32Array(3*r),i=new Float32Array(2*r),s=new Uint32Array((t-1)*n*2*3);let l=0,c=0,f=0,h=0;for(let e=0;e<=t;e++){const r=e/t*Math.PI+.5*Math.PI,p=Math.cos(r),w=Math.sin(r);u[2]=w;const v=0===e||e===t,x=v?n-1:n;for(let r=0;r<=x;r++){const w=r/x*2*Math.PI;u[0]=-Math.sin(w)*p,u[1]=Math.cos(w)*p;for(let e=0;e<3;e++)o[l]=.5*u[e],a[l]=u[e],++l;i[c++]=(r+(v?.5:0))/n,i[c++]=e/t,0!==e&&r!==n&&(e!==t&&(s[f++]=h,s[f++]=h+1,s[f++]=h-n),1!==e&&(s[f++]=h,s[f++]=h-n,s[f++]=h-n-1)),h++}}return{position:o,normal:a,uv:i,faces:s}},e.extractSingleFaceOfBox=function(e,t){const n=e.components[0],r=n.faces,a=f[t],i=6*a,s=new Array(6),l=new Array(r.length-6);let c=0,u=0;for(let e=0;e<r.length;e++)e>=i&&e<i+6?s[c++]=r[e]:l[u++]=r[e];if(null!=e.vertexAttributes.uv){const t=new Float32Array(e.vertexAttributes.uv),n=4*a*2,r=[0,1,1,1,1,0,0,0];for(let e=0;e<r.length;e++)t[n+e]=r[e];e.vertexAttributes.uv=t}return e.components=[new o({faces:s,material:n.material}),new o({faces:l})],e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});