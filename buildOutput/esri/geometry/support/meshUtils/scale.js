// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Logger","../../../core/libs/gl-matrix-2/math/mat4","../../../core/libs/gl-matrix-2/factories/mat4f64","../../../core/libs/gl-matrix-2/factories/quatf64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../Point","../../spatialReferenceEllipsoidUtils","../../projection/projectPointToVector","../axisAngleDegrees","../MeshTransform","../meshVertexSpaceUtils","./geographicUtils","./projection","./vertexSpaceConversion"],function(e,t,r,o,n,i,a,l,c,s,g,p,f,u,P,m){"use strict";const x=()=>t.getLogger("esri.geometry.support.meshUtils.scale");function j(e,t,r=a.ZEROS){if(e)for(let o=0;o<e.length;o+=3){for(let t=0;t<3;t++)v[t]=e[o+t]-r[t];i.scale(v,v,t);for(let t=0;t<3;t++)e[o+t]=v[t]+r[t]}}const v=a.create(),h=a.create(),T=o.create(),b=a.create();e.scale=function(e,t,o){if(!e.vertexAttributes?.position)return;const{vertexSpace:R,spatialReference:A}=e,F=o?.origin??e.origin,S=o?.geographic,E=u.performGlobalOperation(x,R,A,S);f.isMeshWithRelativeVertexSpace(e)?function(e,t,o){e.transform??=new p;const{vertexSpace:c,transform:s,spatialReference:f}=e,[u,j,b]=c.origin,R=new l({x:u,y:j,z:b,spatialReference:f}),A=v;if(R.equals(o))i.set(A,0,0,0);else if(!m.projectPointToVertexSpace(A,o,e))return void P.logProjectionError(x(),o.spatialReference,f,P.loadProjectErrorMessage);const F=i.set(h,t,t,t),S=r.fromRotationTranslationScaleOrigin(T,n.IDENTITY,a.ZEROS,F,A),{localMatrix:E}=s,d=r.multiply(T,S,E);s.scale=r.getScale(a.create(),d),r.scale(d,d,i.inverse(v,s.scale));const C=s.rotationAxis;s.rotation=g.fromMatrix(d),0===s.rotationAngle&&(s.rotationAxis=C),s.translation=r.getTranslation(a.create(),d)}(e,t,F):E?function(e,t,r){const o=e.spatialReference,n=c.getSphericalPCPF(o),i=b;if(!s.projectPointToVector(r,i,n)&&(P.logProjectionError(x(),r.spatialReference,n,"Falling back to mesh origin"),!s.projectPointToVector(e.origin,i,n)))return void P.logProjectionError(x(),e.origin.spatialReference,n);const a=e.vertexAttributes.position,l=e.vertexAttributes.normal,g=e.vertexAttributes.tangent,p=new Float64Array(a.length),f=null!=l?new Float32Array(l.length):null,u=null!=g?new Float32Array(g.length):null;!P.projectToPCPF(a,o,p,n)||null!=l&&null!=f&&!P.projectNormalToPCPF(l,a,o,p,n,f)||null!=g&&null!=u&&!P.projectTangentToPCPF(g,a,o,p,n,u)?P.logProjectionError(x(),o,n):(j(p,t,i),!P.projectFromPCPF(p,n,a,o)||null!=l&&null!=f&&!P.projectNormalFromPCPF(f,a,o,p,n,l)||null!=g&&null!=u&&!P.projectTangentFromPCPF(u,a,o,p,n,g)?P.logProjectionError(x(),n,o):e.vertexAttributesChanged())}(e,t,F):function(e,t,r){const o=b;if(!s.projectPointToVector(r,o,e.spatialReference)){const t=e.origin;return o[0]=t.x,o[1]=t.y,o[2]=t.z,void P.logProjectionError(x(),r.spatialReference,e.spatialReference,P.loadProjectErrorMessage)}j(e.vertexAttributes.position,t,o),e.vertexAttributesChanged()}(e,t,F)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});