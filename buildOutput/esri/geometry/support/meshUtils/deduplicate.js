// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/mathUtils","../Indices"],function(t,e,n){"use strict";function r(t,e,n,r){for(let l=0;l<r;l++)if(t[e+l]!==t[n+l])return!1;return!0}function l(t,e,n,r,l){for(let o=0;o<l;o++)n[r+o]=t[e+o]}function o(t,e,n){let r=0;for(let l=0;l<n;l++)r=t[e+l]+r|0,r=r+(r<<11)+(r>>>2)|0;return r>>>0}let i=null;t.deduplicate=function(t,f,c){const s=Array.isArray(t),u=s?t.length/f:t.byteLength/(4*f),a=s?t:new Uint32Array(t,0,u*f),h=c?.minReduction??0,y=c?.originalIndices||null,d=y?y.length:0,g=c?.componentOffsets||null;let A=0;if(g)for(let t=0;t<g.length-1;t++){const e=g[t+1]-g[t];e>A&&(A=e)}else A=u;const w=Math.floor(1.1*A)+1;(null==i||i.length<2*w)&&(i=new Uint32Array(e.nextHighestPowerOfTwo(2*w)));for(let t=0;t<2*w;t++)i[t]=0;let b=0;const m=!!g&&!!y,p=m?d:u;let M=n.newIndexArray(u);const U=new Uint32Array(d),I=1.96;let x=0!==h?Math.ceil(4*I*I/(h*h)*h*(1-h)):p,O=1,q=g?g[1]:p;for(let t=0;t<p;t++){if(t===x){const e=1-b/t;if(e+I*Math.sqrt(e*(1-e)/t)<h)return null;x*=2}if(t===q){for(let t=0;t<2*w;t++)i[t]=0;if(y)for(let t=g[O-1];t<g[O];t++)U[t]=M[y[t]];q=g[++O]}const e=m?y[t]:t,n=e*f,l=o(a,n,f);let c=l%w,s=b;for(;0!==i[2*c+1];){if(i[2*c]===l){const t=i[2*c+1]-1;if(r(a,n,t*f,f)){s=M[t];break}}c++,c>=w&&(c-=w)}s===b&&(i[2*c]=l,i[2*c+1]=e+1,b++),M[e]=s}if(0!==h&&1-b/u<h)return null;if(m){for(let t=g[O-1];t<U.length;t++)U[t]=M[y[t]];M=n.compactMeshIndices(U)}const P=s?new Array(b):new Uint32Array(b*f);b=0;for(let t=0;t<p;t++)M[t]===b&&(l(a,(m?y[t]:t)*f,P,b*f,f),b++);if(y&&!m){const t=new Uint32Array(d);for(let e=0;e<t.length;e++)t[e]=M[y[e]];M=n.compactMeshIndices(t)}return{buffer:Array.isArray(P)?P:P.buffer,indices:M,uniqueCount:b}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});