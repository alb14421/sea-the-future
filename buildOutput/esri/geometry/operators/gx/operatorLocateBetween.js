// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/Point2D","../../../chunks/Envelope","../../../chunks/MultiPathImpl"],function(e,t,n,r,o,i){"use strict";class s{constructor(e,t,r,i){this.m_interval=r,this.m_progressTracker=i,this.m_attribute=e,this.m_ord=t,(o.VertexDescription.getComponentCount(this.m_attribute)<=t||t<0)&&n.throwInvalidArgumentException("LocateBetween: ordinate"),2===o.VertexDescription.getInterpolation(this.m_attribute)&&n.throwInvalidArgumentException("LocateBetween: angular interpolation")}processGeometry(e){const t=e.getGeometryType();if(t===n.GeometryType.enumGeometryCollection)return this.processGeometryCollection(e);if(n.isArea(t)&&n.throwInvalidArgumentException("LocateBetween does not support Polygons and Envelopes."),e.isEmpty()||!e.hasAttribute(this.m_attribute))return new o.Point({vd:e.getDescription()});if(n.isSegment(t))return this.processSegment(e);switch(t){case n.GeometryType.enumPoint:return this.processPoint(e);case n.GeometryType.enumMultiPoint:return this.processMultiPoint(e);case n.GeometryType.enumPolyline:return this.processPolyline(e);default:n.throwInternalErrorException("LocateBetween")}}processPoint(e){const t=e.getAttributeAsDbl(this.m_attribute,this.m_ord);return this.m_interval.containsCoordinate(t)?new i.MultiPoint({point:e}):new o.Point({vd:e.getDescription()})}processMultiPoint(e){let t=null,n=-1;const r=e.getAttributeStreamRef(this.m_attribute),s=o.VertexDescription.getComponentCount(this.m_attribute);for(let o=0,u=0,l=e.getPointCount();o<l;++o,u+=s){const s=r.readAsDbl(u);this.m_interval.containsCoordinate(s)?-1===n&&(n=o):n>=0&&(t||(t=new i.MultiPoint({vd:e.getDescription()})),t.addPoints(e,n,o),n=-1)}return n>=0&&(t||(t=new i.MultiPoint({vd:e.getDescription()})),t.addPoints(e,n,-1)),t||new o.Point({vd:e.getDescription()})}processPolyline(e){const t=e.queryInterval(this.m_attribute,this.m_ord);if(this.m_interval.contains(t))return e;if(!this.m_interval.isIntersecting(t))return new o.Point({vd:e.getDescription()});let r=null,s=null;const u=e.querySegmentIterator(),l=new i.SegmentBuffer,m=new o.Point,c=new o.Point,a=new o.Point;let p=!0,y=!1;for(;u.nextPath();)for(p=!0,y=!1;u.hasNextSegment();){const e=u.nextSegment(),t=[null],o=this.processSegmentHelper(e,l,t,m);if(o!==n.GeometryType.enumUnknown)if(o===n.GeometryType.enumPoint){if(!p&&(s.getPointByVal(s.getPointCount()-1,c),c.equals(m)))continue;if(p=!0,y&&(e.queryStart(c),m.equals(c)))continue;e.queryEnd(c),y=m.equals(c),r?r.add(m):r=new i.MultiPoint({point:m})}else o===n.GeometryType.enumLine&&(y=!1,s||(s=new i.Polyline),p&&(null===r||r.isEmpty()||(r.getPointByVal(r.getPointCount()-1,c),t[0].queryStart(m),c.equals(m)&&r.removePoint(r.getPointCount()-1))),s.addSegment(t[0],p),e.queryEnd(c),t[0].queryEnd(a),p=!c.equals(a));else p=!0,y=!1}if(null!==r&&r.isEmpty()&&(r=null),null!==r&&null!==s){const e=new i.GeometryCollection;return e.addGeometry(s),e.addGeometry(r),e}return null!==r?r:null!==s?s:new o.Point({vd:e.getDescription()})}processSegment(e){const t=e.getAttributeAsDbl(0,this.m_attribute,this.m_ord),n=e.getAttributeAsDbl(1,this.m_attribute,this.m_ord),i=Number.isNaN(t)?n:t,s=Number.isNaN(n)?t:n,u=new r.Envelope1D;u.setCoords(i,s);const l=u.clone();if(l.intersect(this.m_interval),l.isEmpty())return new o.Point({vd:e.getDescription()});if(u.equals(l))return e;const m=s-i,c=e.calculateLength2D();if(0===l.width()){const t=new o.Point({vd:e.getDescription()}),n=(l.vmin-i)/m,r=e.lengthToT(n*c);return e.queryCoord(r,t),t}let a=(l.vmin-i)/m,p=(l.vmax-i)/m;return a>p&&(p=r.swap(a,a=p)),a=e.lengthToT(a*c),p=e.lengthToT(p*c),e.cut(a,p)}processGeometryCollection(e){if(e.isEmpty()||!e.hasAttribute(this.m_attribute))return new o.Point({vd:e.getDescription()});const t=i.generateGeometryCursor(e),n=new i.GeometryCollection;for(let e=t.next();null!==e;e=t.next()){const t=this.processGeometry(e);t.isEmpty()||n.addGeometry(t)}return n.isEmpty()?new o.Point({vd:e.getDescription()}):n}processSegmentHelper(e,t,o,i){const s=e.getAttributeAsDbl(0,this.m_attribute,this.m_ord),u=e.getAttributeAsDbl(1,this.m_attribute,this.m_ord),l=Number.isNaN(s)?u:s,m=Number.isNaN(u)?s:u,c=new r.Envelope1D;c.setCoords(l,m);const a=c.clone();if(a.intersect(this.m_interval),a.isEmpty())return n.GeometryType.enumUnknown;if(c.equals(a))return o[0]=e,n.GeometryType.enumLine;const p=m-l,y=e.calculateLength2D();if(0===a.width()){const t=(a.vmin-l)/p,r=1===t?1:e.lengthToT(t*y);return e.queryCoord(r,i),n.GeometryType.enumPoint}let h=(a.vmin-l)/p,g=(a.vmax-l)/p;return h>g&&(g=r.swap(h,h=g)),h=1===h?1:e.lengthToT(h*y),g=1===g?1:e.lengthToT(g*y),e.queryCut(h,g,t),o[0]=t.get(),n.GeometryType.enumLine}}class u extends t.GeometryCursor{constructor(e,t,n){super(),this.m_collectionCursor=null,this.m_interval=t,this.m_progressTracker=n,this.m_inputGeoms=e,this.m_index=-1}tock(){return!0}getRank(){return 1}next(){if(this.m_collectionCursor){const e=this.m_collectionCursor.next();if(e)return e;this.m_collectionCursor=null}const e=this.m_inputGeoms.next();if(null===e)return null;n.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID();const t=(r=e,o=this.m_interval,u=this.m_progressTracker,new s(2,0,o,u).processGeometry(r));var r,o,u;return t.getGeometryType()===n.GeometryType.enumGeometryCollection?(this.m_collectionCursor=i.generateGeometryCursor(t),this.m_collectionCursor.next()):t}getGeometryID(){return this.m_index}}const l=new class{getOperatorType(){return 10801}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,t,n){return new u(e,t,n)}};e.executeMany=function(e,n){const r=l.executeMany(new t.SimpleGeometryCursor(e),n,null);return Array.from(r)},e.supportsCurves=function(){return l.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});