// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/Geometry","../../chunks/Envelope2D","../../chunks/Envelope","../../chunks/MultiPathImpl","../../chunks/Point2D","./support/apiConverter"],function(e,t,n,o,r,s,a){"use strict";function i(e,t){return{m_path:e,m_pointIndex:t}}const u=new class{getOperatorType(){return 10007}supportsCurves(){return!1}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}execute(e,a,u,m,g){return function(e,a,u,m){if(e.isEmpty()||a.isEmpty())return null;if(8&m&&16&m)return null;2&m&&4&m&&t.throwInvalidArgumentException("");const g=new n.Envelope2D,l=new n.Envelope2D;return e.queryEnvelope(g),a.queryEnvelope(l),g.mergeEnvelope2D(l),function(e,n,a,u){t.throwIfCurves(e),t.throwIfCurves(n);let m,g=!1;const l=e.querySegmentIterator(),c=n.querySegmentIterator();let p=0;const d=new r.SegmentBuffer,h=new o.Point({vd:e.getDescription()}),f=new o.Point({vd:e.getDescription()}),y=[],P=[];for(function(e,t,n){const r=[],a=[],u=e.querySegmentIterator();for(;u.nextPath();){u.resetToFirstSegment();const e=u.nextSegment().getStartXY(),t=u.getPathIndex(),n=u.getStartPointIndex();r.push(e),a.push(i(t,n)),u.resetToLastSegment();const o=u.previousSegment().getEndXY(),s=u.getPathIndex(),m=u.getEndPointIndex();r.push(o),a.push(i(s,m))}const m=new o.AttributeStreamOfInt32(0);for(let e=0;e<r.length;e++)m.add(e);const g={userSort(e,t,n){n.sort(e,t,(e,t)=>r[e].compare(r[t]))},getValue:e=>r[e].y};(new o.BucketSort).sort(m,0,m.size(),g);for(let e=0;e<m.size()-1;e++){const t=r[m.read(e)];if(t.equals(r[m.read(e+1)])){do{const t=a[m.read(e)];n.push(t),e++}while(e<m.size()&&t.equals(r[m.read(e)]));e--}}s.initializePrimitiveArray(t,n.length,0);for(let e=0;e<n.length;e++)t[e]=e;t.sort((e,t)=>{const o=n[e],r=n[t];return o.m_path<r.m_path?-1:o.m_path>r.m_path?1:o.m_pointIndex<r.m_pointIndex?-1:1})}(e,y,P);l.nextPath();){let n=!0,o=0;for(;2!==o;){if(0===o)l.nextSegment().getGeometryType()!==t.GeometryType.enumLine&&t.throwNotImplementedException(""),o++;else{if(l.resetToLastSegment(),l.previousSegment().getGeometryType()!==t.GeometryType.enumLine&&t.throwNotImplementedException(""),g&&n){const t=l.getPathIndex();m.addSegmentsFromPath(e,t,0,e.getSegmentCountPath(t),!0),n=!1}o++}let s=!1;if(p<P.length){const e=P[y[p]],t=l.getPathIndex();if(e.m_path===t){const t=1===o?l.getStartPointIndex():l.getEndPointIndex();e.m_pointIndex===t&&(s=!0,p++)}}if(1===o){if(8&u)continue}else if(16&u)continue;if(!s){1===o?l.previousSegment():l.nextSegment();const s=1===o?l.nextSegment():l.previousSegment(),i=s,p=i.calculateLength2D();c.resetToFirstPath();let y=!1,P=Number.NaN;for(;c.nextPath();){for(;c.hasNextSegment();){const e=c.nextSegment();e.getGeometryType()!==t.GeometryType.enumLine&&t.throwNotImplementedException("");const n=e,{bIntersect:s,t1:u,t2:m}=r.intersectInfiniteLines(i,n);if(s){const e=n.calculateLength2D();if(m*e>=-a&&(1-m)*e>=-a)if(1===o){if(u*p<=-a)(Number.isNaN(P)||u>P)&&(P=u);else if(u*p<=a){P=Number.NaN,y=!0;break}}else if((1-u)*p<=-a)(Number.isNaN(P)||u<P)&&(P=u);else if((1-u)*p<=a){P=Number.NaN,y=!0;break}}}if(y)break}if(!Number.isNaN(P)){if(!g){m=e.createInstance();for(let t=0;t<l.getPathIndex();t++)m.addPath(e,t,!0)}if(1===o){s.queryCoord(P,h);const t=l.getPathIndex();if(2&u?e.getPointByVal(e.getPathStart(t),f):4&u&&f.setEmpty(),1&u||(d.create(s.getGeometryType()),s.copyTo(d.get()),d.get().setEnd(h),d.get().reverse(),m.addSegment(d.get(),!0),n=!1),m.addSegmentsFromPath(e,t,0,e.getSegmentCountPath(t),n),1&u){const e=m.getPathStart(t);m.setPointByVal(e,h)}if(2&u||4&u){const e=m.getPathStart(t),n=h.getXY();f.setXY(n),m.setPointByVal(e,f)}g=!0,n=!1}else{const t=l.getPathIndex();if(n&&(m.addSegmentsFromPath(e,t,0,e.getSegmentCountPath(t),!0),n=!1),2&u?e.getPointByVal(e.getPathEnd(t)-1,f):4&u&&f.setEmpty(),s.queryCoord(P,h),1&u){const e=m.getPathEnd(t);m.setPointByVal(e-1,h)}else d.create(s.getGeometryType()),s.copyTo(d.get()),d.get().setEnd(h),m.addSegment(d.get(),!1);if(2&u||4&u){const e=m.getPathEnd(t),n=h.getXY();f.setXY(n),m.setPointByVal(e-1,f)}g=!0}}}}}return g?m:null}(e,a,o.calculateToleranceFromGeometryForOp(u,g,!0).total(),m)}(e,a,u,m)}},m=u.supportsCurves();e.execute=function(e,t,n){let o=0;n&&(n.relocateEnds&&(o|=1),n.keepEndAttributes&&(o|=2),n.noEndAttributes&&(o|=4),n.noExtendAtFrom&&(o|=8),n.noExtendAtTo&&(o|=16));const r=a.getSpatialReference(e),s=u.execute(a.fromPolyline(e),a.fromPolyline(t),a.fromSpatialReference(r),o,null);return s?a.toPolyline(s,r):null},e.supportsCurves=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});