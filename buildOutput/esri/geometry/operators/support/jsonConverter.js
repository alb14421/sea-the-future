// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/Geometry","../../../chunks/Point2D","../../../chunks/ProjectionTransformation","../../../chunks/Envelope","../../../chunks/MultiPathImpl","./initNoPeFactory"],function(e,t,n,r,i,o,a){"use strict";function s(){if(-1===this.m_i)return this.m_i=0,{value:{m_token:1,m_value:null},done:!1};if(this.m_i<this.m_keys.length){const e=this.m_bReturnKey,t=Math.trunc(this.m_i);return this.m_bReturnKey=!this.m_bReturnKey,this.m_i+=.5,e?{value:{m_token:5,m_value:this.m_keys[t]},done:!1}:{value:{m_token:6,m_value:this.m_o[this.m_keys[t]]},done:!1}}return{value:{m_token:3,m_value:null},done:!0}}function m(){if(-1===this.m_i)return this.m_i=0,{value:{m_token:2,m_value:null},done:!1};if(this.m_i<this.m_a.length){const e={value:{m_token:6,m_value:this.m_a[this.m_i++]},done:!1};return this.m_strict||void 0===e.value.m_value&&(e.value.m_value=Number.NaN),e}return{value:{m_token:4,m_value:null},done:!0}}class u{createJSONObjectIterator(e){return{m_iteratorType:"object",m_o:e,m_keys:this.m_options.strict?Object.keys(e):Object.keys(e).filter(t=>void 0!==e[t]),m_i:-1,m_bReturnKey:!0,next:s}}createJSONArrayIterator(e){return{m_iteratorType:"array",m_strict:this.m_options.strict,m_i:-1,m_a:e,next:m}}constructor(e,t){this.m_currentToken=0,this.m_options=t?{...t}:{strict:!0};const n=e;this.m_iteratorStack=[n instanceof Array?this.createJSONArrayIterator(n):this.createJSONObjectIterator(n)],this.m_nextFlatToken={m_value:null,m_token:0}}nextToken(){if(0===this.m_iteratorStack.length)return this.m_currentToken=0;switch(this.m_nextFlatToken=this.m_iteratorStack.at(-1).next().value,this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_currentToken=1;case 3:return this.m_iteratorStack.pop(),this.m_currentToken=3;case 2:return this.m_currentToken=2;case 4:return this.m_iteratorStack.pop(),this.m_currentToken=4;case 5:return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=5;case 6:if(this.m_nextFlatToken.m_value instanceof Array)return this.m_iteratorStack.push(this.createJSONArrayIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(this.m_nextFlatToken.m_value instanceof Object)return this.m_iteratorStack.push(this.createJSONObjectIterator(this.m_nextFlatToken.m_value)),this.nextToken();if("number"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,Number.isSafeInteger(this.m_currentValue)&&this.m_currentValue>=n.intMin()&&this.m_currentValue<=n.intMax()?this.m_currentToken=8:this.m_currentToken=7;if("string"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=6;if("boolean"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=this.m_nextFlatToken.m_value?11:12;if("object"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=null,this.m_currentToken=10;t.throwInternalErrorException("unrecognized json element type")}return t.throwInternalErrorException("unrecognized json element type"),0}currentToken(){return this.m_currentToken}skipChildren(){if(0!==this.m_iteratorStack.length)switch(this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=3,void(this.m_currentToken=3);case 2:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=4,void(this.m_currentToken=4)}}currentString(){return 6!==this.m_currentToken&&5!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}currentDoubleValue(){return 7!==this.m_currentToken&&8!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}currentInt32Value(){return 8!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}currentInt64Value(){return t.geometryReleaseAssert(0),0n}currentBoolValue(){return 12!==this.m_currentToken&&11!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}isError(){return 0}}class l{constructor(e){return this.m_buffer=null,this.m_view=null,this.m_sz=0,this.m_offset=0,this.m_bOwnsBuffer=!0,this.m_bLittleEndian=!0,this.m_element=new ArrayBuffer(8),this.m_elementBytes=new Uint8Array(this.m_element),this.m_elementView=new DataView(this.m_element),this.m_elementDouble=new Float64Array(this.m_element),this.m_elementFloat=new Float32Array(this.m_element),this.m_elementInt64=new BigInt64Array(this.m_element),this.m_elementInt32=new Int32Array(this.m_element),this.m_elementInt16=new Int16Array(this.m_element),void 0!==e.sz?(this.m_sz=e.sz,e.buffer?(this.m_sz<0&&t.throwOutOfRangeException("size out of range"),this.m_buffer=e.buffer,this.m_offset=void 0!==e.offset?e.offset:0,this.m_view=void 0!==e.offset?new DataView(e.buffer,e.offset,e.sz):new DataView(this.m_buffer),this.m_bOwnsBuffer=!1,void(this.m_bLittleEndian=!0)):(this.m_sz<0&&t.throwOutOfRangeException("size out of range"),void(this.m_sz>0&&(this.m_buffer=new ArrayBuffer(this.m_sz),this.m_view=new DataView(this.m_buffer))))):e.move?(this.m_sz=e.move.m_sz,this.m_buffer=e.move.m_buffer,this.m_view=e.move.m_view,this.m_bOwnsBuffer=e.move.m_bOwnsBuffer,this.m_bLittleEndian=e.move.m_bLittleEndian,e.move.m_buffer=null,e.move.m_view=null,e.move.m_sz=0,void(e.move.m_bOwnsBuffer=!0)):void t.throwInternalErrorException("unrecognized constructor options")}swapBytesDouble(){this.doSwap()&&(this.m_elementDouble[0]=this.m_elementBytes[0]<<56|this.m_elementBytes[1]<<48|this.m_elementBytes[2]<<40|this.m_elementBytes[3]<<32|this.m_elementBytes[4]<<24|this.m_elementBytes[5]<<16|this.m_elementBytes[6]<<8|this.m_elementBytes[7])}swapBytesInt32(){this.doSwap()&&(this.m_elementInt32[0]=this.m_elementBytes[0]<<24|this.m_elementBytes[1]<<16|this.m_elementBytes[2]<<8|this.m_elementBytes[3])}getOffset(){return this.m_offset}assignMove(e){return this===e||(this.clear(),this.m_sz=e.m_sz,this.m_buffer=e.m_buffer,this.m_view=e.m_view,this.m_bOwnsBuffer=e.m_bOwnsBuffer,this.m_bLittleEndian=e.m_bLittleEndian,e.m_buffer=null,e.m_sz=0,e.m_bOwnsBuffer=!0),this}doSwap(){return this.m_bLittleEndian!==(1===l.getNativeByteOrder())}setNativeByteOrder(){this.m_bLittleEndian=1===l.getNativeByteOrder()}setOrder(e){this.m_bLittleEndian=1===e}getOrder(){return this.m_bLittleEndian?1:0}getView(){return this.m_view||t.throwInvalidCallException("buffer not defined"),this.m_view}static getNativeByteOrder(){return 1}clear(){this.m_buffer=null,this.m_sz=0,this.m_bOwnsBuffer=!0}size(){return this.m_sz}readDouble(e){return this.doSwap()?(this.m_elementDouble[0]=this.m_view.getFloat64(e,this.m_bLittleEndian),this.swapBytesDouble(),this.m_elementDouble[0]):this.m_view.getFloat64(e,this.m_bLittleEndian)}writeDouble(e,t){this.m_elementDouble[0]=t,this.swapBytesDouble(),this.m_view.setFloat64(e,this.m_elementDouble[0],this.m_bLittleEndian)}readInt32(e){return this.doSwap()?(this.m_elementInt32[0]=this.m_view.getInt32(e,this.m_bLittleEndian),this.swapBytesInt32(),this.m_elementInt32[0]):this.m_view.getInt32(e,this.m_bLittleEndian)}writeInt32(e,t){this.m_elementInt32[0]=t,this.swapBytesInt32(),this.m_view.setInt32(e,this.m_elementInt32[0],this.m_bLittleEndian)}getPtr(){return this.m_buffer}setSizeNoRealloc(e){t.geometryReleaseAssert(e>=0&&e<=this.m_sz),this.m_sz=e}}function c(e){let t=!1;for(;3!==e.nextToken();){const n=e.currentString();e.nextToken(),"uwkid"===n?t||(t=!0,8===e.currentToken()&&e.currentInt32Value()):e.skipChildren()}return null}function d(e){let t=!1,n=!1,i=!1,o=!1,a=!1,s=!1,m=!1,u=!1,l=!1,d=!1,h=!1,_=!1,p=!1,f=!1,y=!1,k=!1,g=!1,b=-1,T=-1,v=-1,N=-1,x=0,A=0,w=0,S=0,E=0,I=0,D=0,C=0,F=0,O=0,j="",P="",z=null;for(;3!==e.nextToken();){const r=e.currentString();e.nextToken(),"wkid"===r?t||(t=!0,8===e.currentToken()&&(b=e.currentInt32Value())):"latestWkid"===r?n||(n=!0,8===e.currentToken()&&(T=e.currentInt32Value())):"wkt"===r?a||(a=!0,6===e.currentToken()&&(j=e.currentString())):"wkt2"===r?a||6===e.currentToken()&&(P=e.currentString()):"vcsWkid"===r?i||(i=!0,8===e.currentToken()&&(v=e.currentInt32Value())):"latestVcsWkid"===r?o||(o=!0,8===e.currentToken()&&(N=e.currentInt32Value())):"xyTolerance"===r?m||(m=!0,s=!0,x=e.currentDoubleValue()):"zTolerance"===r?u||(u=!0,s=!0,A=e.currentDoubleValue()):"mTolerance"===r?l||(l=!0,s=!0,w=e.currentDoubleValue()):"falseX"===r?d||(d=!0,s=!0,D=e.currentDoubleValue()):"falseY"===r?h||(h=!0,s=!0,C=e.currentDoubleValue()):"falseZ"===r?_||(_=!0,s=!0,F=e.currentDoubleValue()):"falseM"===r?p||(p=!0,s=!0,O=e.currentDoubleValue()):"xyUnits"===r?f||(f=!0,s=!0,S=e.currentDoubleValue()):"zUnits"===r?y||(y=!0,s=!0,E=e.currentDoubleValue()):"mUnits"===r?k||(k=!0,s=!0,I=e.currentDoubleValue()):"unit"===r?g||(g=!0,z=c(e)):e.skipChildren()}N<=0&&v>0&&(N=v),v<=0&&N>0&&(v=N);let G=null,R=!0;if(0!==j.length&&(R=!1,r.isValidWkt$1(j)&&(G=r.createFromWKT$2(j))),G||0===P.length||(R=!1,r.isValidWkt$1(P)&&(G=r.createFromWKT$2(P))),!G&&T>0&&(R=!1,r.isValidWkid$1(T)&&(N<=0||r.isValidWkid$2())&&(G=r.create$2(T,N))),!G&&b>0&&(R=!1,r.isValidWkid$1(b)&&(v<=0||r.isValidWkid$2())&&(G=r.create$2(b,v))),R&&(G=r.createLocal(z)),s&&G){const e=new r.SpatialReferencePrecisionDescriptor;G.queryPrecisionDescriptorWithoutFalseXY(e),m&&e.setTolerance(0,x),u&&e.setTolerance(1,A),l&&e.setTolerance(2,w),f&&d&&h&&e.setGridParams(D,C,S),y&&_&&e.setZParams(F,E),k&&p&&e.setMParams(O,I),G=r.createWithNewPrecision(G,e)}return G}function h(e,r,a,s){2!==s.currentToken()&&t.throwInvalidArgumentException("failed to parse multipath: array of array of vertices is expected");const m=e?new o.Polygon:new o.Polyline,u=m,l=i.createIndexStream(0),c=i.createDoubleStream(2,0),d=i.createByteStream(0);let h=null,_=null,p=null,y=null,T=null,v=0,N=0,x=0;const A=new o.SegmentBuffer,w=n.Point2D.getNAN();let S=0,E=0;const I=e?1:0;for(;4!==s.nextToken();){2!==s.currentToken()&&t.throwInvalidArgumentException("failed to parse multipath: ring/path array is expected");let a=2,m=0,D=!0;const C=4;let F=0,O=0;const j=n.Point2D.getNAN(),P=n.makePrimitiveArray(C,Number.NaN),z=n.makePrimitiveArray(C,Number.NaN);let G=!1;for(s.nextToken();4!==s.currentToken();){if(r&&1===s.currentToken())D&&t.throwInvalidArgumentException("failed to parse multipath: starting vertex array is expected"),p||(p=i.createByteStream(S-1,1),y=i.createIndexStream(S-1,-1),T=i.createDoubleStream(0)),G=!0,a=1,({segFlag:x,toPointSz:F}=b(A,P,w,s));else{for(G=!1,2!==s.currentToken()&&t.throwInvalidArgumentException("failed to parse multipath: array is expected, rings/paths vertices consist of arrays of coordinates"),F=0;4!==s.nextToken();)F===C&&t.throwInvalidArgumentException("failed to parse multipath: each vertex array has to have at most 4 elements"),P[F++]=f(s);F<2&&t.throwInvalidArgumentException("failed to parse multipath: each vertex array has to have at least 2 elements"),i.checkFinite(P[0],P[1])||t.throwInvalidArgumentException("failed to parse multipath: x and y must be finite")}s.nextToken();do{if(c.size()===2*S&&c.resize(k(S)),c.writePoint2D(2*S,j.setCoords(P[0],P[1])),h&&h.size()===S&&h.resize(g(S)),F>2?(h||(h=i.createDoubleStream(S+1,Number.NaN)),h.write(S,P[2])):h&&h.write(S,Number.NaN),_&&_.size()===S&&_.resize(g(S)),F>3?(_||(_=i.createDoubleStream(S+1,Number.NaN)),_.write(S,P[3])):_&&_.write(S,Number.NaN),D)E++,l.add(S),d.add(I),D=!1,O=F,n.memcpy(z,P,0,0,O);else if(null!==p)if(G){const e=o.sizeInBuffer(x),t=T.size();T.resize(t+e),p.add(x),y.add(v),A.get().writeInBufferStream(T,v),v+=e,u.incCurveType(x,1),N++}else p.add(1),y.add(-1);S++,m++,w.setCoords(P[0],P[1])}while(m<a&&4===s.currentToken())}0!==m&&(e&&m>a&&F===O&&0===n.memcmp(P,z,F)?(S--,m--):null!==p&&(p.add(1),y.add(-1)))}return S&&(l.resize(E),d.resize(E),S>0&&(l.add(S),d.add(0)),u.setAttributeStreamRef(0,c),u.setPathFlagsStreamRef(d),u.setPathStreamRef(l),null!==p&&(u.updateCurveCounter(N),u.setSegmentData(y,T,p,v)),u.notifyModifiedFlags(65535)),{geometry:m,as:h,bs:_}}function _(e,r){2!==r.currentToken()&&t.throwInvalidArgumentException("failed to parse multipoint: array of vertices is expected");let a=0;const s=new o.MultiPoint,m=i.createDoubleStream(2,0);let u=0;const l=n.makePrimitiveArray(4,Number.NaN),c=new n.Point2D;let d=null,h=null;for(;4!==r.nextToken();){for(2!==r.currentToken()&&t.throwInvalidArgumentException("failed to parse multipoint: array is expected, multipoint vertices consist of arrays of cooridinates"),u=0;4!==r.nextToken();)4===u&&t.throwInvalidArgumentException("failed to parse multipoint: each vertex array has to have at most 4 elements"),l[u++]=f(r);u<2&&t.throwInvalidArgumentException("failed to parse multipoint: each vertex array has to have at least 2 elements"),i.checkFinite(l[0],l[1])||t.throwInvalidArgumentException("failed to parse multipoint: x and y must be finite"),m.size()===2*a&&m.resize(k(a)),m.writePoint2D(2*a,c.setCoords(l[0],l[1])),d&&d.size()===a&&d.resize(g(a)),u>2?(d||(d=i.createDoubleStream(a+1,Number.NaN)),d.write(a,l[2])):d&&d.write(a,Number.NaN),h&&h.size()===a&&h.resize(g(a)),u>3?(h||(h=i.createDoubleStream(a+1,Number.NaN)),h.write(a,l[3])):h&&h.write(a,Number.NaN),a++}if(a){const e=s.getImpl();e.setAttributeStreamRef(0,m),e.resizeNoInit(a),e.notifyModifiedFlags(65535)}return{geometry:s,as:d,bs:h}}function p(e,n){2!==n.currentToken()&&t.throwInvalidArgumentException("failed to parse array of IDs: array of array of integers is expected");const r=i.createAttributeStream(2,0);let o=0,a=-1;for(;4!==n.nextToken();){const e=o;r.size()===o&&r.resize(g(o)),o++;let i=0;for(-1===a?a=2===n.currentToken()?1:0:1===a&&2!==n.currentToken()&&t.throwInvalidArgumentException("failed to parse array of IDs: array of array of integers is expected"),0===a&&(r.size()===o&&r.resize(g(o)),r.write(o,y(n)),i++,o++);4!==n.nextToken();)r.size()===o&&r.resize(g(o)),r.write(o,y(n)),i++,o++;if(r.write(e,i),0===a)break}return r.resize(o),r}function f(e){const t=e.currentToken();if(10===t||6===t&&"NaN"===e.currentString())return Number.NaN;{const t=e.currentDoubleValue();return Number.isNaN(t)?Number.NaN:t}}function y(e){return e.currentInt32Value()}function k(e){let t=2*Math.trunc(3*(e+1)/2);return t<8?t=8:t<32&&(t=32),t}function g(e){let t=Math.trunc(3*(e+1)/2);return t<4?t=4:t<16&&(t=16),t}function b(e,r,i,a,s){const m={segFlag:0,toPointSz:0};let u=a.currentToken();u=a.nextToken();const c=a.currentString(),d=c[0];for((1!==c.length||"a"!==d&&"b"!==d&&"c"!==d&&"n"!==d&&"q"!==d)&&t.throwInvalidArgumentException('failed to parse curve: expecting "a", "b", "n", "q", or "c"'),u=a.nextToken(),2!==u&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for curve parameters"),u=a.nextToken(),2!==u&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for to point"),m.toPointSz=0;4!==a.nextToken();)4===m.toPointSz&&t.throwInvalidArgumentException("failed to parse curve: vertex array cannot have more than 4 elements"),r[m.toPointSz++]=f(a);m.toPointSz<2&&t.throwInvalidArgumentException("failed to parse curve: vertex array must have at least 2 elements");const h=n.Point2D.construct(r[0],r[1]),_=n.Point2D.getNAN();let p=-1,y=-1,k=!1,g=Number.NaN,b=Number.NaN,v=Number.NaN;const N=[n.Point2D.getNAN(),n.Point2D.getNAN(),n.Point2D.getNAN()],x=n.Point2D.getNAN();if("a"===d){u=a.nextToken(),2!==u&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for center point"),u=a.nextToken();const e=f(a);u=a.nextToken();const n=f(a);u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for center point"),_.setCoords(e,n),u=a.nextToken(),p=a.currentInt32Value(),u=a.nextToken(),y=a.currentInt32Value(),u=a.nextToken(),4!==u?(k=!1,g=f(a),u=a.nextToken(),b=f(a),u=a.nextToken(),v=f(a),u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters")):k=!0,m.segFlag=4}else if("b"===d){for(let e=0;e<2;e++){u=a.nextToken(),2!==u&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for control point"),u=a.nextToken();const n=f(a);u=a.nextToken();const r=f(a);u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for control point"),N[e].setCoords(n,r)}u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),m.segFlag=2}else if("n"===d){{u=a.nextToken(),2!==u&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for control point"),u=a.nextToken();const e=f(a);u=a.nextToken();const n=f(a);u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for control point"),N[0].setCoords(e,n)}u=a.nextToken();const e=f(a);u=a.nextToken();const n=f(a);u=a.nextToken();const r=f(a);N[1].setCoords(e,n),N[2].setCoords(r,r),u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),m.segFlag=8}else if("q"===d){for(let e=0;e<1;e++){u=a.nextToken(),2!==u&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for control point"),u=a.nextToken();const n=f(a);u=a.nextToken();const r=f(a);u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for control point"),N[e].setCoords(n,r)}u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),m.segFlag=16}else{u=a.nextToken(),2!==u&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for interior point"),u=a.nextToken();const e=f(a);u=a.nextToken();const n=f(a);u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for interior point"),x.setCoords(e,n),u=a.nextToken(),4!==u&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),m.segFlag=4}if(u=a.nextToken(),3!==u&&t.throwInvalidArgumentException("failed to parse curve: end object is expected for curve"),"a"===d)if(e.createEllipticArc(),k){const t=!0;T(e.get(),i,h,_,t,p,y)}else!function(e,t,n,r,i,a,s,m,u){e.dropAllAttributes();const c=new ArrayBuffer(44),d=new l({sz:44,buffer:c});let h=0;d.writeDouble(h,r.x),h+=8,d.writeDouble(h,r.y),h+=8,d.writeDouble(h,s),h+=8,d.writeDouble(h,m),h+=8,d.writeDouble(h,u),h+=8;let _=0;a||(_|=2048),i&&(_|=4096),d.writeInt32(h,_),h+=4,function(e,t,n,r){e.m_bits=0,e.m_center.x=r.readDouble(0),e.m_center.y=r.readDouble(8),e.m_rotation=r.readDouble(16),e.m_semiMajorAxis=r.readDouble(24),e.m_minorMajorRatio=r.readDouble(32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y;const i=r.readInt32(40);if(1&i)return!1;let a=!!(64&i),s=!!(128&i);const m=!!(2048&i),u=!!(4096&i);!(512&i)&&!(1024&i)||s||(a=!0),s&&!t.equals(n)?(s=!1,a=!0):a&&t.equals(n)&&(s=!0,a=!1),s?(e.m_center.assign(t),e.m_startAngle=e.m_center.x,e.m_sweepAngle=e.m_center.y,o.arcimpl_NormalizeAngles(e,Number.NaN,m,u),e.m_semiMajorAxis=0,e.m_interior.setCoordsPoint2D(t)):a?(e.m_center.setNAN(),e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,o.clearEndPointModified(e),e.queryCoord2D(.5,e.m_interior)):e.constructEllipticArcEndPointsCenter(t,n,e.m_semiMajorAxis,e.m_minorMajorRatio,e.m_rotation,!u,m,e.m_center),e.setProjectionBehavior(1),o.clearEndPointModified(e)}(e,t,n,d)}(e.get(),i,h,_,p,y,g,b,v);else if("b"===d)e.createCubicBezier(),function(e,r,i,o){e.dropAllAttributes();const a=new ArrayBuffer(32),s=new l({sz:32,buffer:a});let m=0;s.writeDouble(m,o[0].x),m+=8,s.writeDouble(m,o[0].y),m+=8,s.writeDouble(m,o[1].x),m+=8,s.writeDouble(m,o[1].y),m+=8,function(e,r,i,o){t.geometryReleaseAssert(32<=o.size()),e.m_cp=n.makeObjectArray(n.Point2D,2),e.m_cp[0].x=o.readDouble(0),e.m_cp[0].y=o.readDouble(8),e.m_cp[1].x=o.readDouble(16),e.m_cp[1].y=o.readDouble(24),e.m_XStart=r.x,e.m_YStart=r.y,e.m_XEnd=i.x,e.m_YEnd=i.y}(e,r,i,s)}(e.get(),i,h,N);else if("n"===d)e.createQuadraticRationalBezier(),function(e,t,n,r,i,o,a){e.dropAllAttributes();const s=new ArrayBuffer(40),m=new l({sz:40,buffer:s});let u=0;m.writeDouble(u,r.x),u+=8,m.writeDouble(u,r.y),u+=8,m.writeDouble(u,i),u+=8,m.writeDouble(u,o),u+=8,m.writeDouble(u,a),u+=8,function(e,t,n,r){e.m_cp.x=r.readDouble(0),e.m_cp.y=r.readDouble(8),e.m_weights[0]=r.readDouble(16),e.m_weights[1]=r.readDouble(24),e.m_weights[2]=r.readDouble(32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=n.x,e.m_YEnd=n.y}(e,t,n,m)}(e.get(),i,h,N[0],N[1].x,N[1].y,N[2].x);else if("q"===d)e.createQuadraticBezier(),e.get().construct(i,N[0],h);else{e.createEllipticArc();const t=!1;T(e.get(),i,h,x,t,-1,-1)}return m}function T(e,r,i,a,s,m,u){e.dropAllAttributes();const c=new ArrayBuffer(20),d=new l({sz:20,buffer:c});let h=0;d.writeDouble(h,a.x),h+=8,d.writeDouble(h,a.y),h+=8;let _=0;s?(u||(_|=8),m&&(_|=16)):_|=128,d.writeInt32(h,_),h+=4,function(e,r,i,a){0>=a.size()&&t.throwOutOfRangeException("Byte_buffer out of range access"),e.m_bits=0,e.m_rotation=0,e.m_cosr=1,e.m_sinr=0,e.setStartXY(r),e.setEndXY(i);const s=n.Point2D.getNAN();s.x=a.readDouble(0),s.y=a.readDouble(8);const m=a.readInt32(16);if(1&m)return e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.assign(s),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,o.clearEndPointModified(e),!1;let u=!!(64&m);const l=!!(128&m);let c=!!(32&m);const d=!!(8&m),h=!!(16&m),_=r.equals(i);u&&!_&&(u=!1,c=!0),c&&_&&(u=!0,c=!1,s.setCoords(0,0)),u||(l?c?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_interior.assign(s),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0):(e.constructCircularArcThreePoint(r,i,s),_&&d===e.isClockwise()&&e.reverse()):c?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,o.clearEndPointModified(e),e.queryCoord2D(.5,e.m_interior)):o.constructCircularArcHelperForOldFormat(e,r,i,s,d,h)),u&&(e.m_center.assign(r),e.m_startAngle=s.x,e.m_sweepAngle=s.y,o.arcimpl_NormalizeAngles(e,Number.NaN,d,h),e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.setCoordsPoint2D(r)),e.setProjectionBehavior(0),o.clearEndPointModified(e)}(e,r,i,d)}function v(e,n,r,i,a){const s=e.getGeometryType();if(s===t.GeometryType.enumEllipticArc)return function(e,n,r,i,a){t.geometryReleaseAssert(!o.isEndPointModified(e));const s=e.getEndXY(),m=e.hasAttribute(1)&&!n,u=e.hasAttribute(2)&&!r;let l=Number.NaN,c=Number.NaN;if(m&&(l=e.getEndAttributeAsDbl(1,0)),u&&(c=e.getEndAttributeAsDbl(2,0)),e.isDegenerateToLine()||e.isDegenerate(0))return x(m,u,s.x,s.y,l,c,i,a),!0;const d=0===e.projectionBehavior(),h=!!d&&e.isClosed();if(d&&!h)a.startObject(),a.addFieldName("c"),a.startArray(),x(m,u,s.x,s.y,l,c,i,a),A(e.m_interior.x,e.m_interior.y,17,a),a.endArray(),a.endObject();else if(d){a.startObject(),a.addFieldName("a"),a.startArray(),x(m,u,s.x,s.y,l,c,i,a);const t=0,n=0;A(e.m_center.x+t,e.m_center.y+n,17,a);const r=!e.isMajor();a.addInt32(r?1:0);const o=e.isClockwise();a.addInt32(o?1:0),a.endArray(),a.endObject()}else{a.startObject(),a.addFieldName("a"),a.startArray(),x(m,u,s.x,s.y,l,c,i,a);const t=e;A(t.m_center.x,t.m_center.y,17,a);const n=!t.isMajor();a.addInt32(n?1:0);const r=t.isClockwise();a.addInt32(r?1:0),a.addDouble(t.m_rotation,17),a.addDouble(t.m_semiMajorAxis,17),a.addDouble(t.m_minorMajorRatio,17),a.endArray(),a.endObject()}return!1}(e,n,r,i,a);if(s===t.GeometryType.enumBezier)return N(e,n,r,i,a);if(s===t.GeometryType.enumRationalBezier2)return function(e,t,n,r,i){const o=e.getEndXY(),a=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n;let m=Number.NaN,u=Number.NaN;a&&(m=e.getEndAttributeAsDbl(1,0)),s&&(u=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName("n"),i.startArray(),x(a,s,o.x,o.y,m,u,r,i),A(e.m_cp.x,e.m_cp.y,r,i);const l=r;return i.addDouble(e.m_weights[0],l),i.addDouble(e.m_weights[1],l),i.addDouble(e.m_weights[2],l),i.endArray(),i.endObject(),!1}(e,n,r,i,a);if(s===t.GeometryType.enumBezier2){const t=new o.CubicBezier;return t.constructFromQuadraticSegment(e),N(t,n,r,i,a)}t.throwNotImplementedException("")}function N(e,t,n,r,i){const o=e.getEndXY(),a=e.hasAttribute(1)&&!t,s=e.hasAttribute(2)&&!n;let m=Number.NaN,u=Number.NaN;return a&&(m=e.getEndAttributeAsDbl(1,0)),s&&(u=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName("b"),i.startArray(),x(a,s,o.x,o.y,m,u,r,i),A(e.m_cp[0].x,e.m_cp[0].y,r,i),A(e.m_cp[1].x,e.m_cp[1].y,r,i),i.endArray(),i.endObject(),!1}function x(e,t,n,r,i,o,a,s){s.startArray(),s.addDouble(n,a),s.addDouble(r,a),e&&s.addDouble(i,a),t&&s.addDouble(o,a),s.endArray()}function A(e,t,n,r){r.startArray(),r.addDouble(e,n),r.addDouble(t,n),r.endArray()}function w(e,n,r,a){const s=r.getImpl(),m=!!(2&n),u=!!(4&n),l=!!(8&n),c=s.hasAttribute(1)&&!m,d=s.hasAttribute(2)&&!u,h=s.hasAttribute(3)&&!l,_=s.hasNonLinearSegments();c&&(a.addFieldName("hasZ"),a.addBool(!0)),d&&(a.addFieldName("hasM"),a.addBool(!0)),e?_?a.addFieldName("curveRings"):a.addFieldName("rings"):_?a.addFieldName("curvePaths"):a.addFieldName("paths");let p=null;const f=[];if(r.isEmpty())a.startArray(),a.endArray();else{const e=17-(31&n>>13);a.startArray();const l=r.getPathCount();let y=0;const k=s.getAttributeStreamRef(0);let g=null,b=null,T=null;const N=new o.SegmentBuffer;let x=null,A=null,w=null;_&&(x=s.getSegmentFlagsStreamRef(),A=s.getSegmentIndexStreamRef(),w=s.getSegmentDataStreamRef()),c&&(g=s.getAttributeStreamRef(1)),d&&(b=s.getAttributeStreamRef(2)),h&&(T=s.getAttributeStreamRef(3),p=i.createAttributeStreamFromSemantics(3,0));for(let n=0;n<l;n++){a.startArray(),h&&f.push(0);const i=r.getPathEnd(n);if(y===i){a.endArray();continue}const o=r.isClosedPath(n);let s=k.read(2*y),l=k.read(2*y+1),_=c?g.read(y):Number.NaN,E=d?b.read(y):Number.NaN,I=h?T.read(y):0;S(c,d,s,l,_,E,e,a);let D=1;h&&(p.add(I),f[f.length-1]++);const C=s,F=l,O=_,j=E,P=I;let z=!1,G=0,R=Number.NaN,B=Number.NaN,V=0;for(let n=y+1,r=y,M=o?i+1:i;n<M;n++,r++){const o=null!==x?31&x.read(r):1;let y,M;if(n<i?(y=k.read(2*n),M=k.read(2*n+1),c&&(R=g.read(n)),d&&(B=b.read(n)),h&&(V=T.read(n))):(y=C,M=F,R=O,B=j,V=P),1!==o){z=!0,4===o?N.createEllipticArc():2===o?N.createCubicBezier():16===o?N.createQuadraticBezier():8===o?N.createQuadraticRationalBezier():t.throwNotImplementedException("JSON export.unsupported curve");const n=N.get(),i=A.read(r);n.setStartXYCoords(s,l),n.setEndXYCoords(y,M),c&&(n.setStartAttribute(1,0,_),n.setEndAttribute(1,0,R)),d&&(n.setStartAttribute(2,0,E),n.setEndAttribute(2,0,B)),n.readFromBufferStream(w,i),v(N.get(),m,u,e,a)&&G++}else S(c,d,y,M,R,B,e,a);h&&(p.add(V),f[f.length-1]++),D++,s=y,l=M,_=R,E=B,I=V}z&&0===G||(D<2&&G<1&&(S(c,d,s,l,_,E,e,a),D++,h&&(p.add(I),f[f.length-1]++)),o&&D<3&&G<2&&(S(c,d,C,F,O,j,e,a),D++,s=C,l=F,_=O,E=j,I=P,h&&(p.add(P),f[f.length-1]++))),a.endArray(),y=i}a.endArray()}if(h){a.addFieldName("ids"),a.startArray();let e=0;for(let n=0,r=f.length;n<r;++n){const r=f[n];t.geometryReleaseAssert(0===r||null!==p&&e+r<=p.size()),a.startArray();for(let t=0;t<r;++t)a.addInt32(p.read(e)),e++;a.endArray()}a.endArray()}}function S(e,t,n,r,i,o,a,s){s.startArray(),s.addDouble(n,a),s.addDouble(r,a),e&&s.addDouble(i,a),t&&s.addDouble(o,a),s.endArray()}const E="a".charCodeAt(0),I="A".charCodeAt(0),D="*".charCodeAt(0),C="b".charCodeAt(0),F="\\".charCodeAt(0),O="[".charCodeAt(0),j="{".charCodeAt(0),P=":".charCodeAt(0),z=".".charCodeAt(0),G=",".charCodeAt(0),R='"'.charCodeAt(0),B="]".charCodeAt(0),V="}".charCodeAt(0),M="e".charCodeAt(0),U="E".charCodeAt(0),W="f".charCodeAt(0),X="F".charCodeAt(0),L="/".charCodeAt(0),Y="-".charCodeAt(0),K="+".charCodeAt(0),q="n".charCodeAt(0),Z="N".charCodeAt(0),$="r".charCodeAt(0),J="t".charCodeAt(0),H="u".charCodeAt(0),Q="0".charCodeAt(0),ee="9".charCodeAt(0);class te{constructor(e){this.m_functionStack=[],this.m_pushPositions=[],this.m_utf8Decoder=new TextDecoder("utf-8",{fatal:!0}),void 0===e?(this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_endToken=0,this.m_currentTokenType=0,this.m_functionStack.push(()=>this.accept_()),this.m_jsonString=null,this.m_bHasEscapes=!1):e.jsonString?this.resetParserFromString(e.jsonString):e.jsonStream?t.throwNotImplementedException("streaming json parsing not yet impl"):t.throwInternalErrorException("invalid constructor parameter")}prepSubstrString_(){}getCurrentSubstrString_(){return this.m_jsonString.slice(this.m_startToken,this.m_endToken)}stepOverCharString_(){this.m_endToken++}peekCharString_(){return this.m_jsonString.charCodeAt(this.m_endToken)}getString_(e){const t=this.m_jsonString?.slice(this.m_startToken,this.m_startToken+e-1);return this.m_endToken+=e-1,{s:t,bDone:this.m_endToken>=this.m_jsonString.length}}incrementString_(){this.m_endToken++}eofString_(){return this.m_endToken>=this.m_jsonString.length}setStringFunctions_(){this.m_prepSubstr=this.prepSubstrString_,this.m_getCurrentSubstr=this.getCurrentSubstrString_,this.m_stepOverChar=this.stepOverCharString_,this.m_peekChar=this.peekCharString_,this.m_get=this.getString_,this.m_increment=this.incrementString_,this.m_eof=this.eofString_}setStreamFunctions_(){t.throwNotImplementedException("streaming json parsing not yet impl")}reset_(){this.m_jsonString=null,this.m_endToken=0,this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_currentTokenType=0,this.m_bHasEscapes=!1,this.m_functionStack.length=0,this.m_functionStack.push(()=>this.start_()),this.m_pushPositions.length=0}resetParserFromString(e){this.reset_(),this.setStringFunctions_(),this.m_jsonString=e}resetParserFromStream(e){t.throwNotImplementedException("streaming json parsing not yet impl")}resetToPosition(e){return!!this.m_jsonString&&(this.m_endToken=e,this.m_startToken=Number.MAX_VALUE,this.m_currentTokenType=0,this.m_functionStack.length=0,e>=this.m_jsonString.length?(this.m_functionStack.push(()=>this.accept_()),!1):(this.m_functionStack.push(()=>this.start_()),!0))}nextToken(){return this.m_functionStack.at(-1)(),this.m_currentTokenType}currentToken(){return this.m_currentTokenType}currentTokenStartIndex(){return this.m_startToken}currentTokenEndIndex(){return this.m_endToken}currentText(){return t.geometryReleaseAssert(0),""}childrenAsString(){return t.geometryReleaseAssert(0),""}skipChildren(){this.skipChildren_()}skipChildren_(){if(1===this.m_currentTokenType){let e=1;do{this.m_currentTokenType=this.nextToken(),1===this.m_currentTokenType?e++:3===this.m_currentTokenType&&e--}while(3!==this.m_currentTokenType||0!==e);return}if(2===this.m_currentTokenType){let e=1;do{this.m_currentTokenType=this.nextToken(),2===this.m_currentTokenType?e++:4===this.m_currentTokenType&&e--}while(4!==this.m_currentTokenType||0!==e);return}}currentTerminalAsString_(){switch(this.m_currentTokenType){case 7:case 8:case 9:return this.m_getCurrentSubstr().slice(0,this.m_endToken-this.m_startToken);case 10:return"null";case 11:return"true";case 12:return"false"}t.throwInvalidArgumentException("invalid token")}toUTF8_(e,t){let n=0,r=e;for(;t.charCodeAt(r)===F&&t.charCodeAt(r+1)===H;)n++,r+=6;r=e;const i=new Uint8Array(n);let o=0;for(;t.charCodeAt(r)===F&&t.charCodeAt(r+1)===H;)i[o++]=Number.parseInt(t.slice(r+2,r+6),16),r+=6;return{u8s:this.m_utf8Decoder.decode(i),end:r}}unquoteCurrentString_(){let e="",t=1;const n=this.m_endToken-this.m_startToken-1;let r=0;const i=this.m_getCurrentSubstr();for(let o=t;o<n;o++)if(i.charCodeAt(o)!==F)r++;else{switch(r>0&&(e+=i.slice(t,t+r)),i.charCodeAt(++o)){case R:e+='"';break;case H:{const{u8s:t,end:n}=this.toUTF8_(o-1,i);o=n-1,e+=t;break}case F:e+="\\";break;case L:e+="/";break;case C:e+="\b";break;case W:e+="\f";break;case q:e+="\n";break;case $:e+="\r";break;case J:e+="\t"}t=o+1,r=0}return r>0&&(e+=i.slice(t,t+r)),e}currentString(){return 5!==this.m_currentTokenType&&6!==this.m_currentTokenType?this.currentTerminalAsString_():this.m_bHasEscapes?this.unquoteCurrentString_():this.m_getCurrentSubstr().slice(1,this.m_endToken-this.m_startToken-2+1)}currentDoubleValue(){if(7!==this.m_currentTokenType&&8!==this.m_currentTokenType&&9!==this.m_currentTokenType&&6!==this.m_currentTokenType&&10!==this.m_currentTokenType&&t.throwInvalidArgumentException("invalid token"),10===this.m_currentTokenType)return Number.NaN;let e=this.m_getCurrentSubstr(),n=this.m_endToken-this.m_startToken;if(6===this.m_currentTokenType){if("NaN"===this.currentString())return Number.NaN;e=e.slice(1),n-=2,0===n&&t.throwInvalidArgumentException("invalid token")}const r=Number.parseFloat(e);if(6===this.m_currentTokenType)Number.isNaN(r)&&t.throwInvalidArgumentException("invalid token");else if(Number.isNaN(r))return Number.NaN;return r}currentInt32Value(){8!==this.m_currentTokenType&&6!==this.m_currentTokenType&&t.throwInvalidArgumentException("invalid token");let e=this.m_getCurrentSubstr(),n=this.m_endToken-this.m_startToken;6===this.m_currentTokenType&&(e=e.slice(1),n-=2,0===n&&t.throwInvalidArgumentException("invalid token"));const r=parseInt(e);return Number.isNaN(r)&&t.throwInvalidArgumentException("invalid token"),r}currentInt64Value(){return t.geometryReleaseAssert(0),0n}currentBoolValue(){return t.geometryReleaseAssert(0),!1}isError(){return 0}JSONString(){return t.geometryReleaseAssert(0),""}pushPosition(){return t.geometryReleaseAssert(0),!1}popPosition(){return t.geometryReleaseAssert(0),!1}skipCStyleComments_(){t.geometryReleaseAssert(0)}skipCppStyleComments_(){t.geometryReleaseAssert(0)}skipComments_(){this.m_prepSubstr();let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e===D?this.skipCStyleComments_():e===L?this.skipCppStyleComments_():t.throwInvalidArgumentException("invalid token")}skipWhiteSpace_(){let e;do{this.m_eof()&&t.throwInvalidArgumentException("invalid token");let n=this.m_peekChar();for(;n>=9&&n<=13||32===n;)this.m_increment(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),n=this.m_peekChar();n===L?(this.m_startToken=this.m_endToken,e=!0,this.skipComments_()):e=!1}while(e)}rightBracket_(){return this.m_peekChar()===B&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=4,!0)}rightBrace_(){return this.m_peekChar()===V&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=3,!0)}string_(){this.m_prepSubstr(),this.m_bHasEscapes=!1,this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token");let e=this.m_peekChar();for(;e!==R;){const n=e===F;if(this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),n)if(this.m_bHasEscapes=!0,e===R||e===F||e===L||e===C||e===W||e===q||e===$||e===J)this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar();else if(e===H)for(let n=0;n<4;n++)this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e>=Q&&e<=ee||e>=E&&e<=W||e>=I&&e<=X||t.throwInvalidArgumentException("invalid token");else t.throwInvalidArgumentException("invalid token")}this.m_stepOverChar()}comma_(){return this.m_peekChar()===G&&(this.m_increment(),!0)}colon_(){return this.m_peekChar()===P&&(this.m_increment(),!0)}fieldNameEnd_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.colon_()?(this.skipWhiteSpace_(),this.value_()):t.throwInvalidArgumentException("invalid token")}fieldNameStart_(){this.m_startToken=this.m_endToken,this.m_peekChar()!==R&&t.throwInvalidArgumentException("invalid token"),this.string_(),this.m_currentTokenType=5,this.m_functionStack.push(()=>this.fieldNameEnd_())}pairEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.fieldNameStart_()):this.rightBrace_()?this.m_functionStack.pop():t.throwInvalidArgumentException("invalid token")}arrayStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBracket_()||(this.m_functionStack.push(()=>this.elementEnd_()),this.value_())}elementEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.value_()):this.rightBracket_()?this.m_functionStack.pop():t.throwInvalidArgumentException("invalid token")}objectStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBrace_()||(this.m_functionStack.push(()=>this.pairEnd_()),this.fieldNameStart_())}valueStartObject_(){this.m_increment(),this.m_currentTokenType=1,this.m_functionStack.push(()=>this.objectStart_())}valueStartArray_(){this.m_increment(),this.m_currentTokenType=2,this.m_functionStack.push(()=>this.arrayStart_())}valueString_(){this.string_(),this.m_currentTokenType=6}int_(){this.m_peekChar()!==Q?this.digits_():this.m_stepOverChar()}digits_(){let e=this.m_peekChar();do{this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar()}while(e>=Q&&e<=ee)}frac_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e>=Q&&e<=ee||t.throwInvalidArgumentException("invalid token"),this.digits_()}exp_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e!==K&&e!==Y||(this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar()),e>=Q&&e<=ee||t.throwInvalidArgumentException("invalid token"),this.digits_()}valueNumber_(){this.m_prepSubstr();let e=!1,n=this.m_peekChar();if(n===Y?(this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),n=this.m_peekChar(),e=!0,n>=Q&&n<=ee||t.throwInvalidArgumentException("invalid token"),this.int_()):this.int_(),n=this.m_peekChar(),n===z)this.m_currentTokenType=7,this.frac_(),n=this.m_peekChar(),n!==M&&n!==U||this.exp_();else if(n===M||n===U)this.m_currentTokenType=7,this.exp_();else{let t=0;e&&t++;const n=this.m_endToken-this.m_startToken-t;if(n<10)this.m_currentTokenType=8;else if(10===n){const n=this.m_getCurrentSubstr();e?n.slice(t)<="2147483648"?this.m_currentTokenType=8:this.m_currentTokenType=9:n.slice(t)<="2147483647"?this.m_currentTokenType=8:this.m_currentTokenType=9}else if(n<19)this.m_currentTokenType=9;else if(19===n){const n=this.m_getCurrentSubstr();e?n.slice(t)<="9223372036854775808"?this.m_currentTokenType=9:this.m_currentTokenType=7:n.slice(t)<="9223372036854775807"?this.m_currentTokenType=9:this.m_currentTokenType=7}else this.m_currentTokenType=7}}valueNull_(){const{s:e,bDone:n}=this.m_get(5);n&&t.throwInvalidArgumentException("invalid token"),"null"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=10}valueTrue_(){const{s:e,bDone:n}=this.m_get(5);n&&t.throwInvalidArgumentException("invalid token"),"true"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=11}valueFalse_(){const{s:e,bDone:n}=this.m_get(6);n&&t.throwInvalidArgumentException("invalid token"),"false"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=12}valueNan_(){const{s:e,bDone:n}=this.m_get(4);n&&t.throwInvalidArgumentException("invalid token"),"NaN"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=7}value_(){this.m_startToken=this.m_endToken;const e=this.m_peekChar();e===j?this.valueStartObject_():e===O?this.valueStartArray_():e===R?this.valueString_():e===Y||e>=Q&&e<=Q+9?this.valueNumber_():e===q?this.valueNull_():e===J?this.valueTrue_():e===W?this.valueFalse_():e===Z?this.valueNan_():t.throwInvalidArgumentException("invalid token")}start_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.m_functionStack.push(()=>this.accept_());const e=this.m_peekChar();e!==j&&e!==O&&t.throwInvalidArgumentException("invalid token"),this.value_()}accept_(){this.m_startToken=this.m_endToken,this.m_currentTokenType=0}}const ne=new class{constructor(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject=[]}reset(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject.length=0}startObject(){const e={};this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}startArray(){const e=[];this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}endObject(){this.m_acceptedObject=this.m_currentObject.at(-1),this.m_currentObject.pop()}endArray(){this.m_currentObject.pop()}addFieldName(e){this.m_pendingKey=e}addValue_(e){this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):this.m_currentObject.at(-1).push(e)}addString(e){this.addValue_(e)}addDouble(e,t){this.addValue_(e)}addInt64(e){t.geometryReleaseAssert(0)}addInt32(e){this.addValue_(e)}addBool(e){this.addValue_(e)}addNull(){this.addValue_(null)}getObject(){return this.m_acceptedObject}},re=new class{getOperatorType(){return 10405}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,n,i,o,a,s){!function(e,n,i,o){if(n||i){if(o.startObject(),null!==n)switch(n.getGeometryType()){case t.GeometryType.enumPolygon:w(!0,e,n,o);break;case t.GeometryType.enumPolyline:w(!1,e,n,o);break;case t.GeometryType.enumMultiPoint:!function(e,n,r){const i=n.getImpl(),o=i.hasAttribute(1)&&!(2&e),a=i.hasAttribute(2)&&!(4&e),s=i.hasAttribute(3)&&!(8&e);o&&(r.addFieldName("hasZ"),r.addBool(!0)),a&&(r.addFieldName("hasM"),r.addBool(!0)),r.addFieldName("points");const m=n.getPointCount();if(n.isEmpty())r.startArray(),r.endArray();else{const t=17-(31&e>>13);r.startArray();const n=i.getAttributeStreamRef(0);let s=null,u=null;o&&(s=i.getAttributeStreamRef(1)),a&&(u=i.getAttributeStreamRef(2));for(let e=0;e<m;e++){const i=n.read(2*e),m=n.read(2*e+1);let l=Number.NaN,c=Number.NaN;o&&(l=s.read(e)),a&&(c=u.read(e)),S(o,a,i,m,l,c,t,r)}r.endArray()}if(s){let e=null;i.isEmpty()||(e=i.getAttributeStreamRef(3)),t.geometryReleaseAssert(0===m||null!==e&&e.size()>=m),r.addFieldName("ids"),r.startArray();for(let t=0;t<m;t++)r.addInt32(e.read(t));r.endArray()}}(e,n,o);break;case t.GeometryType.enumPoint:!function(e,t,n){const r=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),o=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return n.addFieldName("x"),n.addNull(),n.addFieldName("y"),n.addNull(),r&&(n.addFieldName("z"),n.addNull()),i&&(n.addFieldName("m"),n.addNull()),void(o&&(n.addFieldName("id"),n.addInt32(0)));const a=17-(31&e>>13);n.addFieldName("x"),n.addDouble(t.getX(),a),n.addFieldName("y"),n.addDouble(t.getY(),a),r&&(n.addFieldName("z"),n.addDouble(t.getZ(),a)),i&&(n.addFieldName("m"),n.addDouble(t.getM(),a)),o&&(n.addFieldName("id"),n.addInt32(t.getID()))}(e,n,o);break;case t.GeometryType.enumEnvelope:!function(e,t,n){const r=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),o=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return n.addFieldName("xmin"),n.addNull(),n.addFieldName("ymin"),n.addNull(),n.addFieldName("xmax"),n.addNull(),n.addFieldName("ymax"),n.addNull(),r&&(n.addFieldName("zmin"),n.addNull(),n.addFieldName("zmax"),n.addNull()),i&&(n.addFieldName("mmin"),n.addNull(),n.addFieldName("mmax"),n.addNull()),void(o&&(n.addFieldName("idmin"),n.addInt32(0),n.addFieldName("idmax"),n.addInt32(0)));const a=17-(31&e>>13);if(n.addFieldName("xmin"),n.addDouble(t.getXMin(),a),n.addFieldName("ymin"),n.addDouble(t.getYMin(),a),n.addFieldName("xmax"),n.addDouble(t.getXMax(),a),n.addFieldName("ymax"),n.addDouble(t.getYMax(),a),r){const e=t.queryInterval(1,0);n.addFieldName("zmin"),n.addDouble(e.vmin,a),n.addFieldName("zmax"),n.addDouble(e.vmax,a)}if(i){const e=t.queryInterval(2,0);n.addFieldName("mmin"),n.addDouble(e.vmin,a),n.addFieldName("mmax"),n.addDouble(e.vmax,a)}if(o){const e=t.queryInterval(3,0);n.addFieldName("idmin"),n.addInt32(e.vmin),n.addFieldName("idmax"),n.addInt32(e.vmax)}}(e,n,o);break;case t.GeometryType.enumMultipatch:t.geometryReleaseAssert(0);break;default:t.throwInternalErrorException("exportToJSON")}null!==i&&(o.addFieldName("spatialReference"),function(e,n,i){i.startObject();let o=0;n.isCustomWkid()||(o=n.getOldID());let a=0;const s=n.getVCS();if(null!==s&&(s.isCustomWkid()||(a=s.getOldID()),a<=0&&(o=0)),o>0){i.addFieldName("wkid"),i.addInt32(o);const e=n.getLatestID();if(e>0&&e!==o&&(i.addFieldName("latestWkid"),i.addInt32(e)),a>0){i.addFieldName("vcsWkid"),i.addInt32(a);const e=n.getLatestVerticalID();e!==a&&(i.addFieldName("latestVcsWkid"),i.addInt32(e))}}if(0===n.getCoordinateSystemType())i.addFieldName("wkid"),i.addNull(),null!==n.getUnit()&&(i.addFieldName("unit"),function(e,n,r){r.startObject();const i=n.getID();i<=0&&t.throwInvalidArgumentException("cannot export unit that has no valid WKID"),r.addFieldName("uwkid"),r.addInt32(i),r.endObject()}(0,n.getUnit(),i));else if(o<=0||1&e){let t="";64&e&&(t=n.getText2(),i.addFieldName("wkt2"),i.addString(t));const r=n.getText();r!==t&&(i.addFieldName("wkt"),i.addString(r))}if(16&e){const e=new r.SpatialReferencePrecisionDescriptor;n.queryPrecisionDescriptor(e),i.addFieldName("xyTolerance"),i.addDouble(e.getTolerance(0)),i.addFieldName("zTolerance"),i.addDouble(e.getTolerance(1)),i.addFieldName("mTolerance"),i.addDouble(e.getTolerance(2)),i.addFieldName("falseX"),i.addDouble(e.getFalseX()),i.addFieldName("falseY"),i.addDouble(e.getFalseY()),i.addFieldName("xyUnits"),i.addDouble(e.getGridUnitsXY()),i.addFieldName("falseZ"),i.addDouble(e.getFalseZ()),i.addFieldName("zUnits"),i.addDouble(e.getGridUnitsZ()),i.addFieldName("falseM"),i.addDouble(e.getFalseM()),i.addFieldName("mUnits"),i.addDouble(e.getGridUnitsM())}i.endObject()}(e,i,o)),o.endObject()}}(e,n,i,o)}exportSpatialReference(e,n,r,i){t.geometryReleaseAssert(0)}exportProjectionTransformation(e,n,r,i){t.geometryReleaseAssert(0)}exportDatumTransformation(e,n,r,i){t.geometryReleaseAssert(0)}static geometryTypeToString(e){return t.geometryReleaseAssert(0),""}},ie=new class{getOperatorType(){return 10404}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,n,a,s,m,u,l){let c;"string"==typeof a?(c=new te({jsonString:a}),c.nextToken()):c=a,1!==c.currentToken()&&t.throwInvalidArgumentException("failed to import map geometry: start of object is expected");const k=function(e,n,r,a,s){let m=!1,u=!1,l=!1,c=!1,k=!1,g=!1,b=!1,T=!1,v=!1,N=!1,x=!1,A=!1,w=!1,S=!1,E=!1,I=!1,D=!1,C=!1,F=!1,O=!1,j=!1,P=!1,z=!1,G=!1,R=Number.NaN,B=Number.NaN,V=Number.NaN,M=Number.NaN,U=0,W=Number.NaN,X=Number.NaN,L=Number.NaN,Y=Number.NaN,K=Number.NaN,q=Number.NaN,Z=Number.NaN,$=Number.NaN,J=0,H=0,Q=!1,ee=!1,te=null,ne=null,re=null,ie=null,oe=null;for(;3!==r.nextToken();){const n=r.currentString();if(r.nextToken(),"spatialReference"===n){if(s&&!m){m=!0,1===r.currentToken()?ie=d(r):10!==r.currentToken()&&t.throwInvalidArgumentException("failed to parse spatial reference: object or null is expected");continue}}else if(a)if("hasZ"===n){if(!u){u=!0,Q=11===r.currentToken();continue}}else if("hasM"===n){if(!l){l=!0,ee=11===r.currentToken();continue}}else if("rings"===n){if(!(k||g||e!==t.GeometryType.enumUnknown&&e!==t.GeometryType.enumPolygon)){k=!0,({geometry:oe,as:te,bs:ne}=h(!0,!1,0,r));continue}}else if("curveRings"===n){if(!g&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPolygon)){g=!0,({geometry:oe,as:te,bs:ne}=h(!0,!0,0,r));continue}}else if("paths"===n){if(!(b||T||e!==t.GeometryType.enumUnknown&&e!==t.GeometryType.enumPolyline)){b=!0,({geometry:oe,as:te,bs:ne}=h(!1,!1,0,r));continue}}else if("curvePaths"===n){if(!T&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPolyline)){T=!0,({geometry:oe,as:te,bs:ne}=h(!1,!0,0,r));continue}}else if("points"===n){if(!v&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumMultiPoint)){v=!0,({geometry:oe,as:te,bs:ne}=_(0,r));continue}}else if("ids"===n){if(!c){c=!0,re=p(0,r);continue}}else if("x"===n){if(!N&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){N=!0,R=f(r);continue}}else if("y"===n){if(!x&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){x=!0,B=f(r);continue}}else if("z"===n){if(!A&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){A=!0,V=f(r);continue}}else if("m"===n){if(!w&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){w=!0,M=f(r);continue}}else if("id"===n){if(!S&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){S=!0,U=y(r);continue}}else if("xmin"===n){if(!E&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){E=!0,W=f(r);continue}}else if("ymin"===n){if(!I&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){I=!0,X=f(r);continue}}else if("mmin"===n){if(!j&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){j=!0,Z=f(r);continue}}else if("zmin"===n){if(!F&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){F=!0,K=f(r);continue}}else if("idmin"===n){if(!z&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){z=!0,J=y(r);continue}}else if("xmax"===n){if(!D&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){D=!0,L=f(r);continue}}else if("ymax"===n){if(!C&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){C=!0,Y=f(r);continue}}else if("mmax"===n){if(!P&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){P=!0,$=f(r);continue}}else if("zmax"===n){if(!O&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){O=!0,q=f(r);continue}}else if("idmax"===n){if(!G&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){G=!0,H=y(r);continue}}else"materials"===n&&t.geometryReleaseAssert(0);r.skipChildren()}if(k||g||b||T||v){let e=null,n=null;const r=oe;Q&&(oe.addAttribute(1),e=te,e||(e=i.createDoubleStream(r.getPointCount(),Number.NaN))),ee&&(oe.addAttribute(2),n=Q?ne:te),null!=re&&oe.addAttribute(3),Q&&null!=e&&r.setAttributeStreamRef(1,e),ee&&null!=n&&r.setAttributeStreamRef(2,n),null!=re&&function(e,n){if(e.isEmpty())return;const r=i.createAttributeStream(2,0),a=e.getGeometryType();let s=0;a===o.MultiPoint.type?s=1:a===o.Polyline.type||a===o.Polygon.type?s=e.getPathCount():t.throwInternalErrorException("not implemented"),r.resize(e.getPointCount(),0);let m=0;for(let i=0;i<s;++i){const s=n.read(m);m++;const u=m+s;let l=0,c=0;a===o.MultiPoint.type?l=e.getPointCount():a===o.Polyline.type||a===o.Polygon.type?(l=e.getPathSize(i),c=e.getPathStart(i)):t.throwInternalErrorException("not implemented");for(let e=0,t=Math.min(s,l);e<t;++e)r.write(c,n.read(m)),m++,c++;m=u}e.getImpl().setAttributeStreamRef(3,r)}(r,re)}else if(N||x||w||A||S){i.checkNanOrFinite(R,B)||t.throwInvalidArgumentException("failed to parse point: x and y must be finite or nan"),(Number.isNaN(B)||Number.isNaN(R))&&(R=Number.NaN,B=Number.NaN);const e=new i.Point({x:R,y:B});A&&e.setZ(V),w&&e.setM(M),S&&e.setID(U),oe=e}else if(E||I||D||C||F||O||j||P||z||G){(Number.isNaN(X)||Number.isNaN(L)||Number.isNaN(Y))&&(W=Number.NaN);const e=new i.Envelope({xmin:W,ymin:X,xmax:L,ymax:Y});F&&O&&e.setInterval(1,0,K,q),j&&P&&e.setInterval(2,0,Z,$),z&&G&&e.setInterval(3,0,J,H),oe=e}return{...oe?{geom:oe}:{},...ie?{sr:ie}:{}}}(n,0,c,s,m);return new r.MapGeometry(k)}importSpatialReference(e){const n=d(e);return null===n&&t.throwInternalErrorException("failed to import spatial reference"),n}importProjectionTransformation(e,n){return t.geometryReleaseAssert(0),{}}importDatumTransformation(e,n){return t.geometryReleaseAssert(0),{}}static stringToGeometryType(e){return(e=e.toLowerCase()).startsWith("esrigeometry")||t.throwInvalidArgumentException("string_to_geometry_type"),e.endsWith("point")?t.GeometryType.enumPoint:e.endsWith("envelope")?t.GeometryType.enumEnvelope:e.endsWith("multipoint")?t.GeometryType.enumMultiPoint:e.endsWith("polyline")?t.GeometryType.enumPolyline:e.endsWith("polygon")?t.GeometryType.enumPolygon:void t.throwInvalidArgumentException("string_to_geometry_type")}};function oe(e,n){const r=new u(e,{strict:!1});return r.nextToken(),ie.execute(0,t.GeometryType.enumUnknown,r,!0,n)}function ae(e){return oe(e,!0)}function se(e){return oe(e,!1).getGeometry()}e.fromGeometries=function(e){let t=null;return[e.map(e=>{if(null==t){const n=ae(e);return t=n.getSpatialReference(),n.getGeometry()}return se(e)}),t]},e.fromGeometry=ae,e.fromGeometryToGXGeometry=se,e.getSpatialReference=function(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference},e.toGeometry=function(e,t){return e instanceof r.MapGeometry&&(t=e.getSpatialReference(),e=e.getGeometry()),e?.isEmpty()?null:(ne.reset(),re.execute(0,e,t,ne),ne.getObject())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});