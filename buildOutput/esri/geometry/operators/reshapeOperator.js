// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/Geometry","../../chunks/MultiPathImpl","../../chunks/Envelope2D","../../chunks/Envelope","../../chunks/ProjectionTransformation","./support/apiConverter"],function(e,t,r,n,s,a,m){"use strict";class i{constructor(e){this.m_progressTracker=e,this.clearIndicesAndScalars()}setIndicesAndScalars(e,r,s){const a=new n.Envelope2D,m=new n.Envelope2D;if(e.queryEnvelope(a),e.queryEnvelope(m),a.inflateCoords(s,s),!a.intersect(m))return!1;const i=e.getImpl().querySegmentIterator(),o=r.getImpl().querySegmentIterator(),l=[0,0],h=[0,0];let c=-1,u=-1,g=-1,d=-1,_=-1,p=-1,x=Number.NaN,A=Number.NaN,S=Number.NaN,y=Number.NaN;for(o.nextPath();o.hasNextSegment();){const e=o.nextSegment(),t=new n.Envelope2D;for(e.queryEnvelope(t),t.inflateCoords(s,s),i.resetToFirstPath();i.nextPath();){for(;i.hasNextSegment();){const r=i.nextSegment(),a=new n.Envelope2D;if(r.queryEnvelope(a),t.isIntersecting(a)&&0!==e.intersect(r,null,h,l,s)&&(Number.isNaN(S)||h[0]<S)&&(c=i.getPathIndex(),g=i.getStartPointIndex(),_=o.getStartPointIndex(),x=l[0],S=h[0],0===S))break}if(0===S)break}if(!Number.isNaN(S)&&1!==S)break}if(Number.isNaN(S))return!1;this.m_pathA0=c,this.m_vertexA0=g,this.m_vertexB0=_,this.m_scalarA0=x,this.m_scalarB0=S;const v=e.getGeometryType();for(o.resetToLastSegment();o.hasPreviousSegment();){const e=o.previousSegment(),r=new n.Envelope2D;for(e.queryEnvelope(r),r.inflateCoords(s,s),v===t.GeometryType.enumPolygon?i.resetToPath(c):i.resetToFirstPath();i.nextPath();){for(;i.hasNextSegment();){const t=i.nextSegment(),a=new n.Envelope2D;if(t.queryEnvelope(a),r.isIntersecting(a)){const r=e.intersect(t,null,h,l,s);if(0!==r&&(Number.isNaN(y)||h[r-1]>y)&&(o.getStartPointIndex()!==this.m_vertexB0||h[r-1]!==this.m_scalarB0)&&(u=i.getPathIndex(),d=i.getStartPointIndex(),p=o.getStartPointIndex(),A=l[r-1],y=h[r-1],1===y))break}}if(1===y)break;if(v===t.GeometryType.enumPolygon)break}if(!Number.isNaN(y))break}return!Number.isNaN(y)&&(this.m_pathA1=u,this.m_vertexA1=d,this.m_vertexB1=p,this.m_scalarA1=A,this.m_scalarB1=y,!0)}getTrimmedPolyline(e,t){const n=new r.SegmentBuffer,a=t.createInstance();let m=!0;const i=t.getImpl().querySegmentIterator();if(i.resetToVertex(this.m_vertexB0,0),this.m_vertexB0>this.m_vertexB1)return a;if(this.m_vertexB0===this.m_vertexB1)i.nextSegment().queryCut(this.m_scalarB0,this.m_scalarB1,n,!1),a.addSegment(n.get(),!0);else for(;;){const e=i.nextSegment(),t=i.getStartPointIndex();if(t===this.m_vertexB0)1!==this.m_scalarB0&&(e.queryCut(this.m_scalarB0,1,n,!1),a.addSegment(n.get(),m),m=!1);else{if(t===this.m_vertexB1){0!==this.m_scalarB1&&(e.queryCut(0,this.m_scalarB1,n),a.addSegment(n.get(),m),m=!1);break}a.addSegment(e,m)}}if(a.isEmpty())return a;if(e.getDescription().getAttributeCount()>1){const t=e.getImpl().querySegmentIterator(),r=new s.Point,n=a.getPointCount();t.resetToVertex(this.m_vertexA0,this.m_pathA0),t.nextSegment().queryCoord(this.m_scalarA0,r),a.setPointByVal(0,r),t.resetToVertex(this.m_vertexA1,this.m_pathA1),t.nextSegment().queryCoord(this.m_scalarA1,r),a.setPointByVal(n-1,r),a.interpolateAttributesRange(0,0,0,n-1)}return a}getReshapedMultiPath(e,r,n){let s;return s=e.getGeometryType()===t.GeometryType.enumPolygon?this.getReshapedPolygon(e,r,n):this.getReshapedPolyline(e,r),s}getReshapedPolygon(e,t,n){const m=e.getImpl().querySegmentIterator();m.setCirculator(!0);const i=new r.SegmentBuffer;new s.Point;const o=new r.Polygon({vd:e.getDescription()});if(o.addSegmentsFromPath(t,0,0,t.getSegmentCountPath(0),!0),m.resetToVertex(this.m_vertexA1,this.m_pathA0),this.m_vertexA1===this.m_vertexA0&&this.m_scalarA1<=this.m_scalarA0)m.nextSegment().queryCut(this.m_scalarA1,this.m_scalarA0,i),o.addSegment(i.get(),!1);else{{const e=m.nextSegment();1!==this.m_scalarA1&&(e.queryCut(this.m_scalarA1,1,i),o.addSegment(i.get(),!1))}for(;;){const e=m.nextSegment();if(m.getStartPointIndex()===this.m_vertexA0){0!==this.m_scalarA0&&(e.queryCut(0,this.m_scalarA0,i),o.addSegment(i.get(),!1));break}o.addSegment(e,!1)}}const l=new r.Polygon({vd:e.getDescription()}),h=t.clone();if(h.reversePath(0),l.addSegmentsFromPath(h,0,0,h.getSegmentCountPath(0),!0),m.resetToVertex(this.m_vertexA0,this.m_pathA0),this.m_vertexA0===this.m_vertexA1&&this.m_scalarA0<this.m_scalarA1)m.nextSegment().queryCut(this.m_scalarA0,this.m_scalarA1,i),l.addSegment(i.get(),!1);else{{const e=m.nextSegment();1!==this.m_scalarA0&&(e.queryCut(this.m_scalarA0,1,i),l.addSegment(i.get(),!1))}for(;;){const e=m.nextSegment();if(m.getStartPointIndex()===this.m_vertexA1){0!==this.m_scalarA1&&(e.queryCut(0,this.m_scalarA1,i),l.addSegment(i.get(),!1));break}l.addSegment(e,!1)}}const c=Math.abs(o.calculateArea2D()),u=Math.abs(l.calculateArea2D());let g=e.createInstance();for(let t=0;t<e.getPathCount();t++)t===this.m_pathA0?c>=u?g.add(o,!1):g.add(l,!1):g.addPath(e,t,!0);return g=(new a.OperatorSimplify).execute(g,n,!1,this.m_progressTracker),g}getReshapedPolyline(e,n){const s=e.getImpl().querySegmentIterator(),a=new r.Polyline,m=new r.SegmentBuffer;let i=!1,o=-1,l=Number.NaN;i=this.m_pathA0>this.m_pathA1||this.m_pathA0===this.m_pathA1&&(this.m_vertexA0>this.m_vertexA1||this.m_vertexA0===this.m_vertexA1&&this.m_scalarA0>this.m_scalarA1),i?(o=this.m_vertexA1,l=this.m_scalarA1,s.resetToPath(this.m_pathA1)):(o=this.m_vertexA0,l=this.m_scalarA0,s.resetToPath(this.m_pathA0));let h=!0;for(s.nextPath()||t.throwInternalErrorException("reshaper");;){const e=s.nextSegment();if(s.getStartPointIndex()===o){0!==l&&(e.queryCut(0,l,m),a.addSegment(m.get(),h),h=!1);break}a.addSegment(e,h),h=!1}if(i){const e=n.clone();e.reversePath(0),a.addSegmentsFromPath(e,0,0,e.getSegmentCount(),h)}else a.addSegmentsFromPath(n,0,0,n.getSegmentCount(),h);i?(l=this.m_scalarA0,s.resetToVertex(this.m_vertexA0,this.m_pathA0)):(l=this.m_scalarA1,s.resetToVertex(this.m_vertexA1,this.m_pathA1));{const e=s.nextSegment();1!==l&&(e.queryCut(l,1,m),a.addSegment(m.get(),!1))}for(;s.hasNextSegment();){const e=s.nextSegment();a.addSegment(e,!1)}const c=e.createInstance();let u=!1;for(let t=0;t<e.getPathCount();t++)t===this.m_pathA0||t===this.m_pathA1?u||(c.add(a,!1),u=!0):c.addPath(e,t,!0);return c}clearIndicesAndScalars(){this.m_pathA0=-1,this.m_pathA1=-1,this.m_vertexA0=-1,this.m_vertexA1=-1,this.m_vertexB0=-1,this.m_vertexB1=-1,this.m_scalarA0=Number.NaN,this.m_scalarA1=Number.NaN,this.m_scalarB0=Number.NaN,this.m_scalarB1=Number.NaN}}const o=new class{getOperatorType(){return 10006}accelerateGeometry(e,t,r){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!1}execute(e,a,m,o){return function(e,a,m,o){if(a.getPathCount()>1&&t.throwNotImplementedException(""),e.isEmpty()||a.isEmpty())return null;t.throwIfCurves(e),t.throwIfCurves(a);let l=null;const h=new n.Envelope2D;e.queryEnvelope(h);const c=new n.Envelope2D;a.queryEnvelope(c);const u=new n.Envelope2D;u.setCoords({env2D:h}),u.mergeEnvelope2D(c);const g=s.calculateToleranceFromGeometryForOp(m,u,!1).total(),d=new i(o);let _=d.setIndicesAndScalars(e,a,g);if(_){const t=d.getTrimmedPolyline(e,a);if(t.isEmpty())return null;l=d.getReshapedMultiPath(e,t,m)}else{if(Number.isNaN(d.m_scalarB0)||e.getGeometryType()===t.GeometryType.enumPolyline)return null;const n=new r.Polyline;if(n.add(a,!0),d.clearIndicesAndScalars(),_=d.setIndicesAndScalars(e,n,g),!_)return null;const s=d.getTrimmedPolyline(e,n);if(s.isEmpty())return null;l=d.getReshapedMultiPath(e,s,m)}return l}(e,a,m,o)}},l=o.supportsCurves();e.execute=function(e,t){const r=m.getSpatialReference(e),n=o.execute(m.fromGeometry(e),m.fromPolyline(t),m.fromSpatialReference(r),null);return m.toGeometry(n,r)},e.supportsCurves=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});