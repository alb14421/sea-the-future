// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../chunks/tslib.es6","../core/string","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Geometry","./Point","./SpatialReference","./support/contains","./support/intersectsBase","./support/spatialReferenceUtils","./support/webMercatorUtils"],function(t,e,i,s,r,n,a,m,h,o,x,l,c,p,u){"use strict";var y;function f(t,e,i){return null==e?i:null==i?e:t(e,i)}function d(t,e){const[i,s]=e.valid,r=2*s;let n,a=0;return t>s?(n=Math.ceil(Math.abs(t-s)/r),t-=n*r,a=n):t<i&&(n=Math.ceil(Math.abs(t-i)/r),t+=n*r,a=-n),{x:t,frameId:a}}return t.default=y=class extends h{constructor(...t){super(...t),this.type="extent",this.xmin=0,this.ymin=0,this.mmin=void 0,this.zmin=void 0,this.xmax=0,this.ymax=0,this.mmax=void 0,this.zmax=void 0}normalizeCtorArgs(t,e,i,s,r){return!(n=t)||"esri.geometry.SpatialReference"!==n.declaredClass&&null==n.wkid?"object"==typeof t?(t.spatialReference=null==t.spatialReference?x.WGS84:t.spatialReference,t):{xmin:t,ymin:e,xmax:i,ymax:s,spatialReference:r??x.WGS84}:{spatialReference:t,xmin:0,ymin:0,xmax:0,ymax:0};var n}static fromPoint(t){return new y({xmin:t.x,ymin:t.y,zmin:t.z,xmax:t.x,ymax:t.y,zmax:t.z,spatialReference:t.spatialReference})}get cache(){return this.commitProperty("xmin"),this.commitProperty("ymin"),this.commitProperty("zmin"),this.commitProperty("mmin"),this.commitProperty("xmax"),this.commitProperty("ymax"),this.commitProperty("zmax"),this.commitProperty("mmax"),this.commitProperty("spatialReference"),{}}get center(){const t=new o({x:.5*(this.xmin+this.xmax),y:.5*(this.ymin+this.ymax),spatialReference:this.spatialReference});return this.hasZ&&(t.z=.5*(this.zmin+this.zmax)),this.hasM&&(t.m=.5*(this.mmin+this.mmax)),t}get extent(){return this.clone()}get hasM(){return null!=this.mmin&&null!=this.mmax}get hasZ(){return null!=this.zmin&&null!=this.zmax}get height(){return Math.abs(this.ymax-this.ymin)}get width(){return Math.abs(this.xmax-this.xmin)}centerAt(t){const e=this.center;return null!=t.z&&this.hasZ?this.offset(t.x-e.x,t.y-e.y,t.z-e.z):this.offset(t.x-e.x,t.y-e.y)}clone(){const t=new y;return t.xmin=this.xmin,t.ymin=this.ymin,t.xmax=this.xmax,t.ymax=this.ymax,t.spatialReference=this.spatialReference,null!=this.zmin&&(t.zmin=this.zmin,t.zmax=this.zmax),null!=this.mmin&&(t.mmin=this.mmin,t.mmax=this.mmax),t}contains(t){if(!t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&u.canProject(e,i)&&(t=e.isWebMercator?u.geographicToWebMercator(t):u.webMercatorToGeographic(t,!0)),"point"===t.type?l.extentContainsPoint(this,t):"extent"===t.type&&l.extentContainsExtent(this,t)}equals(t){if(this===t)return!0;if(null==t)return!1;const e=this.spatialReference,i=t.spatialReference;return e&&i&&!e.equals(i)&&u.canProject(e,i)&&(t=e.isWebMercator?u.geographicToWebMercator(t):u.webMercatorToGeographic(t,!0)),this.xmin===t.xmin&&this.ymin===t.ymin&&this.zmin===t.zmin&&this.mmin===t.mmin&&this.xmax===t.xmax&&this.ymax===t.ymax&&this.zmax===t.zmax&&this.mmax===t.mmax}expand(t){const e=.5*(1-t),i=this.width*e,s=this.height*e;if(this.xmin+=i,this.ymin+=s,this.xmax-=i,this.ymax-=s,this.hasZ){const t=(this.zmax-this.zmin)*e;this.zmin+=t,this.zmax-=t}if(this.hasM){const t=(this.mmax-this.mmin)*e;this.mmin+=t,this.mmax-=t}return this}intersects(t){if(null==t)return!1;"mesh"===t.type&&(t=t.extent);const e=this.spatialReference,i=t.spatialReference;return e&&i&&!p.equals(e,i)&&u.canProject(e,i)&&(t=e.isWebMercator?u.geographicToWebMercator(t):u.webMercatorToGeographic(t,!0)),c.getFeatureExtentIntersector(t.type)(this,t)}normalize(){const t=this._normalize(!1,!0);return Array.isArray(t)?t:[t]}offset(t,e,i){return this.xmin+=t,this.ymin+=e,this.xmax+=t,this.ymax+=e,null!=i&&(this.zmin+=i,this.zmax+=i),this}shiftCentralMeridian(){return this._normalize(!0)}union(t){return this===t||(this.xmin=Math.min(this.xmin,t.xmin),this.ymin=Math.min(this.ymin,t.ymin),this.xmax=Math.max(this.xmax,t.xmax),this.ymax=Math.max(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=f(Math.min,this.zmin,t.zmin),this.zmax=f(Math.max,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=f(Math.min,this.mmin,t.mmin),this.mmax=f(Math.max,this.mmax,t.mmax))),this}intersection(t){return this===t?this:null!=t&&this.intersects(t)?(this.xmin=Math.max(this.xmin,t.xmin),this.ymin=Math.max(this.ymin,t.ymin),this.xmax=Math.min(this.xmax,t.xmax),this.ymax=Math.min(this.ymax,t.ymax),(this.hasZ||t.hasZ)&&(this.zmin=f(Math.max,this.zmin,t.zmin),this.zmax=f(Math.min,this.zmax,t.zmax)),(this.hasM||t.hasM)&&(this.mmin=f(Math.max,this.mmin,t.mmin),this.mmax=f(Math.min,this.mmax,t.mmax)),this):null}toJSON(t){return this.write({},t)}_shiftCM(t=p.getInfo(this.spatialReference)){if(!t||!this.spatialReference)return this;const e=this.spatialReference,s=this._getCM(t);if(s){const r=e.isWebMercator?u.webMercatorToGeographic(s):s;this.xmin-=s.x,this.xmax-=s.x,e.isWebMercator||(r.x=d(r.x,t).x),this.spatialReference=new x(i.replace((e.isWGS84?t.altTemplate:null)??t.wkTemplate,{Central_Meridian:r.x}))}return this}_getCM(t){let e=null;const[i,s]=t.valid,r=this.xmin,n=this.xmax;return r>=i&&r<=s&&n>=i&&n<=s||(e=this.center),e}_normalize(t,e,i){const s=this.spatialReference;if(!s)return this;const r=i??p.getInfo(s);if(null==r)return this;const n=this._getParts(r).map(t=>t.extent);if(n.length<2)return n[0]||this;if(n.length>2)return t?this._shiftCM(r):this.set({xmin:r.valid[0],xmax:r.valid[1]});if(t)return this._shiftCM(r);if(e)return n;let a=!0,m=!0;return n.forEach(t=>{t.hasZ||(a=!1),t.hasM||(m=!1)}),{rings:n.map(t=>{const e=[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]];if(a){const i=(t.zmax-t.zmin)/2;for(let t=0;t<e.length;t++)e[t].push(i)}if(m){const i=(t.mmax-t.mmin)/2;for(let t=0;t<e.length;t++)e[t].push(i)}return e}),hasZ:a,hasM:m,spatialReference:s}}_getParts(t){let e=this.cache._parts;if(!e){e=[];const{ymin:i,ymax:s,spatialReference:r}=this,n=this.width,a=this.xmin,m=this.xmax;let h;t=t||p.getInfo(r);const[o,x]=t.valid;h=d(this.xmin,t);const l=h.x,c=h.frameId;h=d(this.xmax,t);const u=h.x,f=h.frameId,z=l===u&&n>0;if(n>2*x){const t=new y(a<m?l:u,i,x,s,r),n=new y(o,i,a<m?u:l,s,r),h=new y(0,i,x,s,r),p=new y(o,i,0,s,r),d=[],z=[];t.contains(h)&&d.push(c),t.contains(p)&&z.push(c),n.contains(h)&&d.push(f),n.contains(p)&&z.push(f);for(let t=c+1;t<f;t++)d.push(t),z.push(t);e.push({extent:t,frameIds:[c]},{extent:n,frameIds:[f]},{extent:h,frameIds:d},{extent:p,frameIds:z})}else l>u||z?e.push({extent:new y(l,i,x,s,r),frameIds:[c]},{extent:new y(o,i,u,s,r),frameIds:[f]}):e.push({extent:new y(l,i,u,s,r),frameIds:[c]});this.cache._parts=e}const i=this.hasZ,s=this.hasM;if(i||s){const t={};i&&(t.zmin=this.zmin,t.zmax=this.zmax),s&&(t.mmin=this.mmin,t.mmax=this.mmax);for(let i=0;i<e.length;i++)e[i].extent.set(t)}return e}},e.__decorate([s.property({readOnly:!0})],t.default.prototype,"cache",null),e.__decorate([s.property({readOnly:!0})],t.default.prototype,"center",null),e.__decorate([s.property({readOnly:!0})],t.default.prototype,"extent",null),e.__decorate([s.property({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],t.default.prototype,"hasM",null),e.__decorate([s.property({readOnly:!0,json:{write:{enabled:!1,overridePolicy:null}}})],t.default.prototype,"hasZ",null),e.__decorate([s.property({readOnly:!0})],t.default.prototype,"height",null),e.__decorate([s.property({readOnly:!0})],t.default.prototype,"width",null),e.__decorate([s.property({type:Number,json:{type:[Number,String],write:{enabled:!0,allowNull:!0}}})],t.default.prototype,"xmin",void 0),e.__decorate([s.property({type:Number,json:{write:!0}})],t.default.prototype,"ymin",void 0),e.__decorate([s.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],t.default.prototype,"mmin",void 0),e.__decorate([s.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],t.default.prototype,"zmin",void 0),e.__decorate([s.property({type:Number,json:{write:!0}})],t.default.prototype,"xmax",void 0),e.__decorate([s.property({type:Number,json:{write:!0}})],t.default.prototype,"ymax",void 0),e.__decorate([s.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasM}}}}})],t.default.prototype,"mmax",void 0),e.__decorate([s.property({type:Number,json:{origins:{"web-scene":{write:!1}},write:{overridePolicy(){return{enabled:this.hasZ}}}}})],t.default.prototype,"zmax",void 0),t.default=y=e.__decorate([m.subclass("esri.geometry.Extent")],t.default),t.default.prototype.toJSON.isDefaultToJSON=!0,t.default});