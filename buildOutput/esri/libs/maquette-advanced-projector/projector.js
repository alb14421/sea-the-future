// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../maquette/dom","../maquette/projector","./advanced-projector-options","./utils"],function(e,t,r,o,n){"use strict";const d=(e,t,r=!1)=>{let o=e;return t.forEach((e,n)=>{const d=o?.children?(c=t=>t.domNode===e,o.children.find(c)):void 0;var c;r&&!d&&n!==t.length-1||(o=d)}),o};e.createAdvancedProjector=e=>{let r;const c={...o.defaultAdvancedProjectorOptions,...e},s=n.applyDefaultProjectionOptions(c),a=s.performanceLogger;let i,l=!0,p=!1;const m=[],u=[],f=(e,t,o)=>{let n;s.eventHandlerInterceptor=(e,t,o,s)=>function(e){let t;a("domEvent",e);const o=((e,t)=>{const r=[];for(;e&&e!==t;)r.push(e),e=e.parentNode;return r})(e.currentTarget,n.domNode),s=o.some(e=>customElements.get(e?.tagName?.toLowerCase()));if(e.eventPhase!==Event.CAPTURING_PHASE&&s){const r=e.composedPath(),o=r.slice(r.indexOf(e.currentTarget),r.indexOf(n.domNode)).reverse();t=d(n.getLastRender(),o,!0)}else o.reverse(),t=d(n.getLastRender(),o);let i;return t&&(i=c.handleInterceptedEvent(r,t,this,e)),a("domEventProcessed",e),i},c.postProcessProjectionOptions?.(s);const i=o();n=e(t,i,s),s.eventHandlerInterceptor=void 0,m.push(n),u.push(o),c.afterFirstVNodeRendered&&c.afterFirstVNodeRendered(n,i)};let v=()=>{if(i=void 0,l){l=!1,a("renderStart",void 0);for(let e=0;e<m.length;e++){const t=u[e]();a("rendered",void 0);try{m[e].update(t)}catch(e){console.error(e)}a("patched",void 0)}a("renderDone",void 0),l=!0}};return c.modifyDoRenderImplementation&&(v=c.modifyDoRenderImplementation(v,m,u)),r={renderNow:v,scheduleRender:()=>{i||p||(i=requestAnimationFrame(v))},stop:()=>{i&&(cancelAnimationFrame(i),i=void 0),p=!0},resume:()=>{p=!1,l=!0,r.scheduleRender()},append:(e,r)=>{f(t.dom.append,e,r)},insertBefore:(e,r)=>{f(t.dom.insertBefore,e,r)},merge:(e,r)=>{f(t.dom.merge,e,r)},replace:(e,r)=>{f(t.dom.replace,e,r)},detach:e=>{for(let t=0;t<u.length;t++)if(u[t]===e)return u.splice(t,1),m.splice(t,1)[0];throw new Error("renderFunction was not found")}},r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});