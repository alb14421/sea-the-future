// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./chunks/tslib.es6","./core/Accessor","./core/Collection","./core/reactiveUtils","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/RandomLCG","./core/accessorSupport/decorators/subclass","./core/support/UpdatingHandles","./undoredo/UndoRedoError"],function(t,o,s,e,i,a,n,d,r,c,h,p){"use strict";t.UndoRedo=class extends s{constructor(){super(...arguments),this._stack=new e,this._stackPosition=-1,this._updatingHandles=new h.UpdatingHandles}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new p.UndoInvalidError;if(this.updating)throw new p.UndoRedoUpdatingError;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(1),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new p.RedoInvalidError;if(this.updating)throw new p.UndoRedoUpdatingError;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new p.RedoInvalidError;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(2),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new p.UndoRedoUpdatingError;await this._updatingHandles.addPromise((async()=>{0===t.status&&await t.executeUndoRedoOperation(0),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(t=>t.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new p.UndoRedoUpdatingError;await this._updatingHandles.addPromise((async()=>{0===t.status&&await t.executeUndoRedoOperation(0),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,o=!1){if(this.updating&&!o)return;await i.whenOnce(()=>!this.updating);const s=new e;for(let o=0;o<this._stack.length;o++){const e=this._stack.getItemAt(o);e&&(e.tag===t?(e.destroy(),o===this._stackPosition&&(this._stackPosition=s.length-1)):s.push(e))}this._stack=s,this._stackPosition>s.length-1&&(this._stackPosition=s.length-1)}async clear(t=!1){if(this.updating&&!t)throw new p.UndoRedoUpdatingError;await i.whenOnce(()=>!this.updating),this._drainStack()}},o.__decorate([a.property()],t.UndoRedo.prototype,"_stack",void 0),o.__decorate([a.property()],t.UndoRedo.prototype,"_stackPosition",void 0),o.__decorate([a.property()],t.UndoRedo.prototype,"updating",null),o.__decorate([a.property({readOnly:!0})],t.UndoRedo.prototype,"canUndo",null),o.__decorate([a.property({readOnly:!0})],t.UndoRedo.prototype,"hasUndo",null),o.__decorate([a.property({readOnly:!0})],t.UndoRedo.prototype,"canRedo",null),o.__decorate([a.property({readOnly:!0})],t.UndoRedo.prototype,"hasRedo",null),t.UndoRedo=o.__decorate([c.subclass("esri.UndoRedo")],t.UndoRedo),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});