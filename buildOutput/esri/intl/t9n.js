// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../request","../core/Error","./messages"],function(e,t,n,r){"use strict";async function o(e){if(null!=a.fetchBundleAsset)return a.fetchBundleAsset(e);const n=await t(e,{responseType:"text"});return JSON.parse(n.data)}class s{constructor({base:e="",pattern:t,location:n=new URL(window.location.href)}){let r;r="string"==typeof n?e=>new URL(e,new URL(n,window.location.href)).href:n instanceof URL?e=>new URL(e,n).href:n,this.pattern="string"==typeof t?new RegExp(`^${t}`):t,this.getAssetUrl=r,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,t){return async function(e,t,s,a){const i=t.exec(s);if(!i)throw new n("esri-intl:invalid-bundle",`Bundle id "${s}" is not compatible with the pattern "${t}"`);const c=i[1]?`${i[1]}/`:"",l=i[2],u=r.normalizeMessageBundleLocale(a),d=`${c}${l}.json`,w=u?`${c}${l}_${u}.json`:d;let h;try{h=await o(e(w))}catch(t){if(w===d)throw new n("intl:unknown-bundle",`Bundle "${s}" cannot be loaded`,{error:t});try{h=await o(e(d))}catch(e){throw new n("intl:unknown-bundle",`Bundle "${s}" cannot be loaded`,{error:e})}}return h}(this.getAssetUrl,this.matcher,e,t)}}const a={};e.JSONLoader=s,e.createJSONLoader=function(e){return new s(e)},e.test=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});