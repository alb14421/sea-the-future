// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../containerUtils","../Dictionary","../executionError","../Feature","../ImmutablePointArray","../../chunks/languageUtils","./centroid","../geometry/constructors","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/coordsUtils","../../geometry/support/jsonUtils","../../support/guards"],function(e,r,t,n,i,a,o,c,l,s,f,u,m,p,y,d,h,w){"use strict";e.registerFunctions=function(e,x){e.ringisclockwise=function(e,r){return x(e,r,(t,i,c)=>{o.pcCheck(c,1,1,e,r);let l=[];if(null===c[0])return!1;if(w.isArray(c[0]))for(const t of c[0]){if(!(t instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);l.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}else if(c[0]instanceof a)l=c[0]._elements;else{if(!o.isImmutableArray(c[0]))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);for(const t of c[0].toArray()){if(!(t instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);l.push(t.hasZ?t.hasM?[t.x,t.y,t.z,t.m]:[t.x,t.y,t.z]:[t.x,t.y])}}return!(l.length<3)&&d.isClockwise(l)})},e.polygon=function(e,r){return x(e,r,(i,a,c)=>{let s;if(o.pcCheck(c,1,1,e,r),c[0]instanceof t){const r=o.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference,"polygon"),e.spatialReference);if(null==r)return null;s=r}else if(c[0]instanceof p)s=h.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=o.fixSpatialReference(new p(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,"WrongSpatialReference",r);return o.fixNullGeometry(s)})},e.polyline=function(e,r){return x(e,r,(i,a,c)=>{let s;if(o.pcCheck(c,1,1,e,r),c[0]instanceof t){const r=o.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference,"polyline"),e.spatialReference);if(null==r)return null;s=r}else if(c[0]instanceof y)s=h.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=o.fixSpatialReference(new y(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,"WrongSpatialReference",r);return o.fixNullGeometry(s)})},e.point=function(e,r){return x(e,r,(i,a,c)=>{let s;if(o.pcCheck(c,1,1,e,r),c[0]instanceof t){const r=o.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference,"point"),e.spatialReference);if(null==r)return null;s=r}else if(c[0]instanceof m)s=h.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=o.fixSpatialReference(new m(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,"WrongSpatialReference",r);return o.fixNullGeometry(s)})},e.multipoint=function(e,r){return x(e,r,(i,a,c)=>{let s;if(o.pcCheck(c,1,1,e,r),c[0]instanceof t){const r=o.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference,"multipoint"),e.spatialReference);if(null==r)return null;s=r}else if(c[0]instanceof u)s=h.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=o.fixSpatialReference(new u(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,"WrongSpatialReference",r);return o.fixNullGeometry(s)})},e.extent=function(e,r){return x(e,r,(i,a,c)=>{c=o.autoCastFeatureToGeometry(c),o.pcCheck(c,1,1,e,r);let f=null;if(c[0]instanceof t)f=o.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference),e.spatialReference);else if(c[0]instanceof m){const e={xmin:c[0].x,ymin:c[0].y,xmax:c[0].x,ymax:c[0].y,spatialReference:c[0].spatialReference.toJSON()},r=c[0];r.hasZ&&(e.zmin=r.z,e.zmax=r.z),r.hasM&&(e.mmin=r.m,e.mmax=r.m),f=h.fromJSON(e)}else if(c[0]instanceof p)f=h.fromJSON(c[0].extent?.toJSON());else if(c[0]instanceof y)f=h.fromJSON(c[0].extent?.toJSON());else if(c[0]instanceof u)f=h.fromJSON(c[0].extent?.toJSON());else if(c[0]instanceof s)f=h.fromJSON(c[0].toJSON());else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),f=o.fixSpatialReference(new s(r),e.spatialReference)}if(null!==f&&!1===f.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,"WrongSpatialReference",r);return o.fixNullGeometry(f)})},e.geometry=function(e,r){return x(e,r,(i,a,c)=>{o.pcCheck(c,1,1,e,r);let s=null;if(null===c[0])return null;if(o.isFeature(c[0]))s=o.fixSpatialReference(c[0].geometry(),e.spatialReference);else if(c[0]instanceof t)s=o.fixSpatialReference(l.constructGeometryFromDictionary(c[0],e.spatialReference),e.spatialReference);else{const r=JSON.parse(c[0]);r&&!r.spatialReference&&(r.spatialReference=e.spatialReference),s=o.fixSpatialReference(h.fromJSON(r),e.spatialReference)}if(null!==s&&!1===s.spatialReference.equals(e.spatialReference))throw new n.ArcadeExecutionError(e,"WrongSpatialReference",r);return o.fixNullGeometry(s)})},e.setgeometry=function(e,r){return x(e,r,(t,i,a)=>{if(o.pcCheck(a,2,2,e,r),!o.isFeature(a[0]))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(!0===a[0].immutable)throw new n.ArcadeExecutionError(e,"Immutable",r);if(!(a[1]instanceof f||null===a[1]))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return a[0]._geometry=a[1],o.voidOperation})},e.feature=function(e,r){return x(e,r,(a,c,s)=>{if(0===s.length)throw new n.ArcadeExecutionError(e,"WrongNumberOfParameters",r);let u;if(1===s.length)if(w.isString(s[0]))u=i.fromJson(JSON.parse(s[0]),e.timeZone);else if(o.isFeature(s[0]))u=i.createFromArcadeFeature(s[0]);else if(s[0]instanceof f)u=i.createFromGraphicLikeObject(s[0],null,null,e.timeZone);else{if(!(s[0]instanceof t))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);{const t=s[0].hasField("geometry")?s[0].field("geometry"):null,a=s[0].hasField("attributes")?s[0].field("attributes"):null;let c,f;if(o.isDictionary(t))c=l.constructGeometryFromDictionary(t,e.spatialReference);else{if(null!=t&&!o.isGeometry(t))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);c=t}if(o.isDictionary(a))f=i.parseAttributesFromDictionary(a);else{if(null!=a)throw new n.ArcadeExecutionError(e,"InvalidParameter",r);f=null}u=i.createFromGraphicLikeObject(c,f,null,e.timeZone)}}else if(2===s.length){let a=null,o=null;if(null!==s[0])if(s[0]instanceof f)a=s[0];else{if(!(s[0]instanceof t))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);a=l.constructGeometryFromDictionary(s[0],e.spatialReference)}if(null!==s[1]){if(!(s[1]instanceof t))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);o=i.parseAttributesFromDictionary(s[1])}u=i.createFromGraphicLikeObject(a,o,null,e.timeZone)}else{let a=null;const c={};if(null!==s[0])if(s[0]instanceof f)a=s[0];else{if(!(s[0]instanceof t))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);a=l.constructGeometryFromDictionary(s[0],e.spatialReference)}for(let t=1;t<s.length;t+=2){const i=o.toString(s[t]),a=s[t+1];if(!(null==a||w.isString(a)||isNaN(a)||o.isDate(a)||w.isNumber(a)||o.isTime(a)||o.isDateOnly(a)||w.isBoolean(a)))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(o.isFunctionParameter(a)||!1===o.isSimpleType(a))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);a===o.voidOperation?c[i]=null:c[i]=a}u=i.createFromGraphicLikeObject(a,c,null,e.timeZone)}return u._geometry=o.fixSpatialReference(u.geometry(),e.spatialReference),u.immutable=!1,u})},e.dictionary=function(e,r){return x(e,r,(i,a,c)=>{if(0===c.length||1===c.length&&null===c[0]){const e=new t;return e.immutable=!1,e}if(1===c.length&&w.isString(c[0]))try{const r=JSON.parse(c[0]),n=t.convertObjectToArcadeDictionary(r,o.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(t){throw new n.ArcadeExecutionError(e,"InvalidParameter",r)}if(1===c.length&&c[0]instanceof f)try{const r=c[0].toJSON();r.hasZ=!0===c[0].hasZ,r.hasM=!0===c[0].hasM;const n=t.convertObjectToArcadeDictionary(r,o.defaultTimeZone(e),!1);return n.immutable=!1,n}catch(t){throw new n.ArcadeExecutionError(e,"InvalidParameter",r)}if(1===c.length&&o.isFeature(c[0]))try{const e=new t;e.immutable=!1,e.setField("geometry",c[0].geometry());const r=new t;r.immutable=!1,e.setField("attributes",r);for(const e of c[0].keys())r.setField(e,c[0].field(e));return e}catch(t){throw new n.ArcadeExecutionError(e,"InvalidParameter",r)}if(1===c.length&&(o.isDictionary(c[0])||o.isVoxel(c[0])))try{const e=new t;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}catch(t){throw new n.ArcadeExecutionError(e,"InvalidParameter",r)}if(2===c.length&&c[0]instanceof t&&w.isBoolean(c[1]))try{if(!0!==c[1]){const e=new t;e.immutable=!1;for(const r of c[0].keys())e.setField(r,c[0].field(r));return e}return c[0].deepClone()}catch(t){throw new n.ArcadeExecutionError(e,"InvalidParameter",r)}if(c.length%2!=0)throw new n.ArcadeExecutionError(e,"WrongNumberOfParameters",r);const l=Object.create(null);for(let t=0;t<c.length;t+=2){const i=o.toString(c[t]),a=c[t+1];if(!(null==a||w.isString(a)||isNaN(a)||o.isDate(a)||w.isNumber(a)||w.isBoolean(a)||o.isDateOnly(a)||o.isTime(a)||w.isArray(a)||o.isImmutableArray(a)))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(o.isFunctionParameter(a))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);a===o.voidOperation?l[i]=null:l[i]=a}const s=new t(l);return s.immutable=!1,s})},e.haskey=function(e,i){return x(e,i,(a,c,l)=>{o.pcCheck(l,2,2,e,i);const s=o.toString(l[1]);if(o.isDictionaryLike(l[0])||l[0]instanceof t)return l[0].hasField(s);if(l[0]instanceof f){const e=r.geometryMember(l[0],s,null,null,2);return!e||"notfound"!==e.keystate}throw new n.ArcadeExecutionError(e,"InvalidParameter",i)})},e.hasvalue=function(e,t){return x(e,t,(n,i,a)=>(o.pcCheck(a,2,2,e,t),null!=r.getNestedOptionalValue(a[0],a[1])))},e.indexof=function(e,r){return x(e,r,(t,i,a)=>{o.pcCheck(a,2,2,e,r);const c=a[1];if(w.isArray(a[0])){for(let e=0;e<a[0].length;e++)if(o.equalityTest(c,a[0][e]))return e;return-1}if(o.isImmutableArray(a[0])){const e=a[0].length();for(let r=0;r<e;r++)if(o.equalityTest(c,a[0].get(r)))return r;return-1}throw new n.ArcadeExecutionError(e,"InvalidParameter",r)})},e.angle=function(e,r){return x(e,r,(t,i,a)=>{if(a=o.autoCastFeatureToGeometry(a),o.pcCheck(a,2,3,e,r),!(a[0]instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(!(a[1]instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(a.length>2&&!(a[2]instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return 2===a.length?c.angle2D(a[0],a[1]):c.angleBetween2D(a[0],a[1],a[2])})},e.bearing=function(e,r){return x(e,r,(t,i,a)=>{if(a=o.autoCastFeatureToGeometry(a),o.pcCheck(a,2,3,e,r),!(a[0]instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(!(a[1]instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(a.length>2&&!(a[2]instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return 2===a.length?c.bearing2D(a[0],a[1]):c.bearingBetween2D(a[0],a[1],a[2])})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});