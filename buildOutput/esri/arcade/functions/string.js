// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../ArcadePortal","../Attachment","../Dictionary","../enum","../executionError","../../chunks/languageUtils","./convertdirection","./hash","../../core/urlUtils","../../core/uuid","../../geometry/Extent","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/SpatialReference","../../portal/Portal","../../support/guards"],function(t,e,r,n,o,a,i,u,c,l,p,d,s,f,h,g,y,A,m){"use strict";function w(t,e){if(!t||!e)return t===e;if(t.x===e.x&&t.y===e.y){if(t.hasZ){if(t.z!==e.z)return!1}else if(e.hasZ)return!1;if(t.hasM){if(t.m!==e.m)return!1}else if(e.hasM)return!1;return!0}return!1}function I(t,o,u){if(null!==t)if(m.isArray(t)){if(o.updateUint8Array([61]),u.map.has(t)){const e=u.map.get(t);o.updateIntArray([61237541^e])}else{u.map.set(t,u.currentLength++);for(const e of t)I(e,o,u);u.map.delete(t),u.currentLength--}o.updateUint8Array([199])}else if(i.isImmutableArray(t)){if(o.updateUint8Array([61]),u.map.has(t)){const e=u.map.get(t);o.updateIntArray([61237541^e])}else{u.map.set(t,u.currentLength++);for(const e of t.toArray())I(e,o,u);u.map.delete(t),u.currentLength--}o.updateUint8Array([199])}else{if(i.isDate(t))return o.updateIntArray([t.toNumber()]),void o.updateUint8Array([241]);if(i.isDateOnly(t))return o.updateIntArray([t.toNumber()]),void o.updateIntArray([257]);if(i.isTime(t))return o.updateIntArray([t.toNumber()]),void o.updateIntArray([263]);if(m.isString(t))return o.updateIntArray([t.length]),o.updateWithString(t),void o.updateUint8Array([41]);if(m.isBoolean(t))o.updateUint8Array([!0===t?1:0,113]);else{if(m.isNumber(t))return o.updateFloatArray([t]),void o.updateUint8Array([173]);if(t instanceof r)throw new a.ArcadeExecutionError(u.context,"UnsupportedHashType",u.node);if(t instanceof e)throw new a.ArcadeExecutionError(u.context,"UnsupportedHashType",u.node);if(!(t instanceof n)){if(i.isFeature(t))throw new a.ArcadeExecutionError(u.context,"UnsupportedHashType",u.node);if(t instanceof f)return o.updateIntArray([3833836621]),o.updateIntArray([0]),o.updateFloatArray([t.x]),o.updateIntArray([1]),o.updateFloatArray([t.y]),t.hasZ&&(o.updateIntArray([2]),o.updateFloatArray([t.z])),t.hasM&&(o.updateIntArray([3]),o.updateFloatArray([t.m])),o.updateIntArray([3765347959]),void I(t.spatialReference.wkid,o,u);if(t instanceof h){o.updateIntArray([1266616829]);for(let e=0;e<t.rings.length;e++){const r=t.rings[e],n=[];let a=null,i=null;for(let o=0;o<r.length;o++){const u=t.getPoint(e,o);if(0===o)a=u;else if(w(i,u))continue;i=u,o===r.length-1&&w(a,u)||n.push(u)}o.updateIntArray([1397116793,n.length]);for(let t=0;t<n.length;t++){const e=n[t];o.updateIntArray([3962308117,t]),I(e,o,u),o.updateIntArray([2716288009])}o.updateIntArray([2278822459])}return o.updateIntArray([3878477243]),void I(t.spatialReference.wkid,o,u)}if(t instanceof g){o.updateIntArray([4106883559]);for(let e=0;e<t.paths.length;e++){const r=t.paths[e];o.updateIntArray([1397116793,r.length]);for(let n=0;n<r.length;n++)o.updateIntArray([3962308117,n]),I(t.getPoint(e,n),o,u),o.updateIntArray([2716288009]);o.updateIntArray([2278822459])}return o.updateIntArray([2568784753]),void I(t.spatialReference.wkid,o,u)}if(t instanceof s){o.updateIntArray([588535921,t.points.length]);for(let e=0;e<t.points.length;e++){const r=t.getPoint(e);o.updateIntArray([e]),I(r,o,u)}return o.updateIntArray([1700171621]),void I(t.spatialReference.wkid,o,u)}if(t instanceof d)return o.updateIntArray([3483648373]),o.updateIntArray([0]),o.updateFloatArray([t.xmax]),o.updateIntArray([1]),o.updateFloatArray([t.xmin]),o.updateIntArray([2]),o.updateFloatArray([t.ymax]),o.updateIntArray([3]),o.updateFloatArray([t.ymin]),t.hasZ&&(o.updateIntArray([4]),o.updateFloatArray([t.zmax]),o.updateIntArray([5]),o.updateFloatArray([t.zmin])),t.hasM&&(o.updateIntArray([6]),o.updateFloatArray([t.mmax]),o.updateIntArray([7]),o.updateFloatArray([t.mmin])),o.updateIntArray([3622027469]),void I(t.spatialReference.wkid,o,u);if(t instanceof y)return o.updateIntArray([14]),void 0!==t.wkid&&null!==t.wkid&&o.updateIntArray([t.wkid]),t.wkt&&o.updateWithString(t.wkt),void(t.wkt2&&o.updateWithString(t.wkt2));if(i.isFunctionParameter(t))throw new a.ArcadeExecutionError(u.context,"UnsupportedHashType",u.node);if(i.isFeatureSet(t))throw new a.ArcadeExecutionError(u.context,"UnsupportedHashType",u.node);if(i.isFeatureSetCollection(t))throw new a.ArcadeExecutionError(u.context,"UnsupportedHashType",u.node);if(t===i.voidOperation)throw new a.ArcadeExecutionError(u.context,"UnsupportedHashType",u.node);throw new a.ArcadeExecutionError(u.context,"UnsupportedHashType",u.node)}if(o.updateUint8Array([223]),u.map.has(t)){const e=u.map.get(t);o.updateIntArray([61237541^e])}else{u.map.set(t,u.currentLength++);for(const e of t.keys())o.updateIntArray([e.length]),o.updateWithString(e),o.updateUint8Array([251]),I(t.field(e),o,u),o.updateUint8Array([239]);u.map.delete(t),u.currentLength--}o.updateUint8Array([73])}}else o.updateUint8Array([0,139])}t.registerFunctions=function(t,r){t.portal=function(t,n){return r(t,n,(r,o,a)=>(i.pcCheck(a,1,1,t,n),new e(i.toString(a[0]))))},t.typeof=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,1,1,t,e);const u=i.getType(o[0]);if("Unrecognized Type"===u)throw new a.ArcadeExecutionError(t,"UnrecognizedType",e);return u})},t.trim=function(t,e){return r(t,e,(r,n,o)=>(i.pcCheck(o,1,1,t,e),i.toString(o[0]).trim()))},t.tohex=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,1,1,t,e);const a=i.toNumber(o[0]);return isNaN(a)?a:a.toString(16)})},t.upper=function(t,e){return r(t,e,(r,n,o)=>(i.pcCheck(o,1,1,t,e),i.toString(o[0]).toUpperCase()))};const d=new o.StringEnum(["every-word","first-word"]);t.proper=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,1,2,t,e);const a=(o.length>=2?d.lookup(i.toString(o[1])):null)??"every-word",u=/\s/,c=i.toString(o[0]);let l="",p=!0;for(let t=0;t<c.length;t++){let e=c[t];u.test(e)?"every-word"===a&&(p=!0):e.toUpperCase()!==e.toLowerCase()&&(p?(e=e.toUpperCase(),p=!1):e=e.toLowerCase()),l+=e}return l})},t.lower=function(t,e){return r(t,e,(r,n,o)=>(i.pcCheck(o,1,1,t,e),i.toString(o[0]).toLowerCase()))};const s=new o.StringEnum(["digits","digits-hyphen","digits-hyphen-braces","digits-hyphen-parentheses"]);t.guid=function(t,e){return r(t,e,(r,n,o)=>{switch(i.pcCheck(o,0,1,t,e),o.length>0?s.lookup(i.toString(o[0])):null){case"digits":return p.generateUUID().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return p.generateUUID();case"digits-hyphen-parentheses":return"("+p.generateUUID()+")";default:return"{"+p.generateUUID()+"}"}})},t.standardizeguid=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,2,2,t,e);let a=i.toString(o[0]);if(""===a||null===a)return"";const u=/^(\{|\()?(?<partA>[0-9a-z]{8})(-?)(?<partB>[0-9a-z]{4})(-?)(?<partC>[0-9a-z]{4})(-?)(?<partD>[0-9a-z]{4})(-?)(?<partE>[0-9a-z]{12})(\}|\))?$/gim.exec(a);if(!u)return"";const c=u.groups;switch(a=c.partA+"-"+c.partB+"-"+c.partC+"-"+c.partD+"-"+c.partE,s.lookup(i.toString(o[1]))){case"digits":return a.replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return a;case"digits-hyphen-parentheses":return"("+a+")";default:return"{"+a+"}"}})},t.console=function(t,e){return r(t,e,(e,r,n)=>(0===n.length||(1===n.length?t.console(i.toString(n[0])):t.console(i.toString(n))),i.voidOperation))},t.mid=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,2,3,t,e);let a=i.toNumber(o[1]);if(isNaN(a))return"";if(a=Math.max(0,a),2===o.length)return i.toString(o[0]).slice(a);let u=i.toNumber(o[2]);return isNaN(u)?"":(u<0&&(u=0),i.toString(o[0]).slice(a,a+u))})},t.find=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,2,3,t,e);let a=0;if(o.length>2){if(a=i.toNumber(i.defaultUndefined(o[2],0)),isNaN(a))return-1;a<0&&(a=0)}return i.toString(o[1]).indexOf(i.toString(o[0]),a)})},t.left=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,2,2,t,e);let a=i.toNumber(o[1]);return isNaN(a)?"":(a<0&&(a=0),i.toString(o[0]).slice(0,a))})},t.right=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,2,2,t,e);const a=i.toNumber(o[1]);return isNaN(a)||a<=0?"":i.toString(o[0]).slice(-a)})},t.split=function(t,e){return r(t,e,(r,n,o)=>{let a;i.pcCheck(o,2,4,t,e);let u=i.toNumber(i.defaultUndefined(o[2],-1));const c=i.toBoolean(i.defaultUndefined(o[3],!1));if(-1===u||null===u||!0===c?a=i.toString(o[0]).split(i.toString(o[1])):(isNaN(u)&&(u=-1),u<-1&&(u=-1),a=i.toString(o[0]).split(i.toString(o[1]),u)),!1===c)return a;const l=[];for(let t=0;t<a.length&&!(-1!==u&&l.length>=u);t++)""!==a[t]&&void 0!==a[t]&&l.push(a[t]);return l})},t.text=function(t,e){return r(t,e,(r,n,o)=>(i.pcCheck(o,1,2,t,e),i.toStringExplicit(o[0],o[1])))},t.concatenate=function(t,e){return r(t,e,(t,e,r)=>{const n=[];if(r.length<1)return"";if(m.isArray(r[0])){const t=i.defaultUndefined(r[2],"");for(let e=0;e<r[0].length;e++)n[e]=i.toStringExplicit(r[0][e],t);return r.length>1?n.join(r[1]):n.join("")}if(i.isImmutableArray(r[0])){const t=i.defaultUndefined(r[2],"");for(let e=0;e<r[0].length();e++)n[e]=i.toStringExplicit(r[0].get(e),t);return r.length>1?n.join(r[1]):n.join("")}for(let t=0;t<r.length;t++)n[t]=i.toStringExplicit(r[t]);return n.join("")})},t.reverse=function(t,e){return r(t,e,(r,n,o)=>{if(i.pcCheck(o,1,1,t,e),m.isArray(o[0])){const t=o[0].slice();return t.reverse(),t}if(i.isImmutableArray(o[0])){const t=o[0].toArray().slice();return t.reverse(),t}throw new a.ArcadeExecutionError(t,"InvalidParameter",e)})},t.replace=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,3,4,t,e);const a=i.toString(o[0]),u=i.toString(o[1]),c=i.toString(o[2]);return 4!==o.length||i.toBoolean(o[3])?i.multiReplace(a,u,c):a.replace(u,c)})},t.urlencode=function(t,e){return r(t,e,(r,o,a)=>{if(i.pcCheck(a,1,1,t,e),null===a[0])return"";if(a[0]instanceof n){let t="";for(const e of a[0].keys()){const r=a[0].field(e);""!==t&&(t+="&"),t+=null===r?encodeURIComponent(e)+"=":encodeURIComponent(e)+"="+encodeURIComponent(r)}return t}return encodeURIComponent(i.toString(a[0]))})},t.hash=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,1,1,t,e);const a=new c.XXH(0);return I(o[0],a,{context:t,node:e,map:new Map,currentLength:0}),a.digest()})},t.convertdirection=function(t,e){return r(t,e,(r,n,o)=>(i.pcCheck(o,3,3,t,e),u.convertDirection(o[0],o[1],o[2])))},t.fromjson=function(t,e){return r(t,e,(r,o,u)=>{if(i.pcCheck(u,1,1,t,e),!1===m.isString(u[0]))throw new a.ArcadeExecutionError(t,"InvalidParameter",e);return n.convertJsonToArcade(JSON.parse(i.toString(u[0])),i.defaultTimeZone(t))})},t.tocharcode=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,1,2,t,e);const u=i.toNumber(i.defaultUndefined(o[1],0)),c=i.toString(o[0]);if(0===c.length&&1===o.length)return null;if(c.length<=u||u<0)throw new a.ArcadeExecutionError(t,"OutOfBounds",e);return c.charCodeAt(u)})},t.tocodepoint=function(t,e){return r(t,e,(r,n,o)=>{i.pcCheck(o,1,2,t,e);const u=i.toNumber(i.defaultUndefined(o[1],0)),c=i.toString(o[0]);if(0===c.length&&1===o.length)return null;if(c.length<=u||u<0)throw new a.ArcadeExecutionError(t,"OutOfBounds",e);return c.codePointAt(u)})},t.fromcharcode=function(t,e){return r(t,e,(r,n,o)=>{if(o.length<1)throw new a.ArcadeExecutionError(t,"WrongNumberOfParameters",e);const u=o.map(t=>Math.trunc(i.toNumber(t))).filter(t=>t>=0&&t<=65535);return 0===u.length?null:String.fromCharCode.apply(null,u)})},t.fromcodepoint=function(t,e){return r(t,e,(r,n,o)=>{if(o.length<1)throw new a.ArcadeExecutionError(t,"WrongNumberOfParameters",e);let u;try{u=o.map(t=>Math.trunc(i.toNumber(t))).filter(t=>t<=1114111&&t>>>0===t)}catch(t){return null}return 0===u.length?null:String.fromCodePoint.apply(null,u)})},t.getuser=function(t,o){return r(t,o,(r,u,c)=>{i.pcCheck(c,0,2,t,o);let p=i.defaultUndefined(c[1],"");if(p=!0===p||!1===p?"":i.toString(p),null!==p&&""!==p)return null;if(0===c.length||c[0]instanceof e){let e=null;if(e=t.services?.portal?t.services.portal:A.getDefault(),c.length>0&&(f=e,!(s=c[0].field("url"))||!l.hasSamePortal(s,f?.restUrl||"")))return null;if(!e)return null;if(""===p){const r="loaded"===(d=e).loadStatus&&d.user?.sourceJSON?d.user.sourceJSON:null;if(r){const e=JSON.parse(JSON.stringify(r));for(const t of["lastLogin","created","modified"])void 0!==e[t]&&null!==e[t]&&(e[t]=new Date(e[t]));return n.convertObjectToArcadeDictionary(e,i.defaultTimeZone(t))}}return null}var d,s,f;throw new a.ArcadeExecutionError(t,"InvalidParameter",o)})},t.getenvironment=function(t,e){return r(t,e,(r,o,a)=>(i.pcCheck(a,0,0,t,e),n.convertObjectToArcadeDictionary(i.defaultExecutingContext(i.defaultTimeZone(t),t.spatialReference),i.defaultTimeZone(t),!0)))},t.standardizefilename=function(t,e){return r(t,e,(t,e,r)=>{i.pcCheck(r,1,1,t,e);const[n]=r;if(null==n)return"";if(!m.isString(n))throw new a.ArcadeExecutionError(t,"InvalidParameter",e);return n.replaceAll(/[<>"?*]/g,"_").replaceAll(/[/\\|]/g,"-").replaceAll(":",", ")})}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});