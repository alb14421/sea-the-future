// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../ArcadePortal","../Dictionary","../executionError","../kernel","../../chunks/languageUtils","../portalUtils","../geometry/functions","../geometry/operatorsWorkerConnection","../../core/arrayUtils","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/jsonUtils","../../portal/Portal","../../portal/support/utils","../../support/guards"],function(e,t,n,r,o,a,i,c,u,s,l,f,m,d,y,p,w,h,O,A,N){"use strict";function S(e){if(null==e)return e;switch(typeof e){case"string":case"number":return e;default:throw new o.ArcadeExecutionError(null,"InvalidParameter",null)}}t.registerFunctions=function(t){"async"===t.mode&&(t.functions.disjoint=function(e,n){return t.standardFunctionAsync(e,n,(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null===o[0]||null===o[1]||s.invokeRemoteGeometryOp("disjoint",[o[0].toJSON(),o[1].toJSON()])))},t.functions.intersects=function(e,n){return t.standardFunctionAsync(e,n,(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null!==o[0]&&null!==o[1]&&s.invokeRemoteGeometryOp("intersects",[o[0].toJSON(),o[1].toJSON()])))},t.functions.touches=function(e,n){return t.standardFunctionAsync(e,n,(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null!==o[0]&&null!==o[1]&&s.invokeRemoteGeometryOp("touches",[o[0].toJSON(),o[1].toJSON()])))},t.functions.crosses=function(e,n){return t.standardFunctionAsync(e,n,(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null!==o[0]&&null!==o[1]&&s.invokeRemoteGeometryOp("crosses",[o[0].toJSON(),o[1].toJSON()])))},t.functions.within=function(e,n){return t.standardFunctionAsync(e,n,(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null!==o[0]&&null!==o[1]&&s.invokeRemoteGeometryOp("within",[o[0].toJSON(),o[1].toJSON()])))},t.functions.contains=function(e,n){return t.standardFunctionAsync(e,n,(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null!==o[0]&&null!==o[1]&&s.invokeRemoteGeometryOp("contains",[o[0].toJSON(),o[1].toJSON()])))},t.functions.overlaps=function(e,n){return t.standardFunctionAsync(e,n,(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null!==o[0]&&null!==o[1]&&s.invokeRemoteGeometryOp("overlaps",[o[0].toJSON(),o[1].toJSON()])))},t.functions.equals=function(e,n){return t.standardFunctionAsync(e,n,(t,r,o)=>(i.pcCheck(o,2,2,e,n),o[0]===o[1]||(o[0]instanceof m&&o[1]instanceof m?s.invokeRemoteGeometryOp("equals",[o[0].toJSON(),o[1].toJSON()]):(i.isDate(o[0])&&i.isDate(o[1])||!!(i.isTime(o[0])&&i.isTime(o[1])||i.isDateOnly(o[0])&&i.isDateOnly(o[1])))&&o[0].equals(o[1]))))},t.functions.relate=function(e,n){return t.standardFunctionAsync(e,n,(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,3,3,e,n),a[0]instanceof m&&a[1]instanceof m)return s.invokeRemoteGeometryOp("relate",[a[0].toJSON(),a[1].toJSON(),i.toString(a[2])]);if(a[0]instanceof m&&null===a[1])return!1;if(a[1]instanceof m&&null===a[0])return!1;if(null===a[0]&&null===a[1])return!1;throw new o.ArcadeExecutionError(e,"InvalidParameter",n)})},t.functions.intersection=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null===o[0]||null===o[1]?null:h.fromJSON(await s.invokeRemoteGeometryOp("intersection",[o[0].toJSON(),o[1].toJSON()]))))},t.functions.union=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,c)=>{if(0===(c=i.autoCastFeatureToGeometry(c)).length)throw new o.ArcadeExecutionError(e,"WrongNumberOfParameters",n);const u=[];if(1===c.length)if(N.isArray(c[0])){for(const t of i.autoCastFeatureToGeometry(c[0]))if(null!==t){if(!(t instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);u.push(t.toJSON())}}else{if(!i.isImmutableArray(c[0])){if(c[0]instanceof m)return i.fixSpatialReference(a.cloneGeometry(c[0]),e.spatialReference);if(null===c[0])return null;throw new o.ArcadeExecutionError(e,"InvalidParameter",n)}for(const t of i.autoCastFeatureToGeometry(c[0].toArray()))if(null!==t){if(!(t instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);u.push(t.toJSON())}}else for(const t of c)if(null!==t){if(!(t instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);u.push(t.toJSON())}return 0===u.length?null:h.fromJSON(await s.invokeRemoteGeometryOp("union",[u]))})},t.functions.difference=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null===o[0]?null:null===o[1]?a.cloneGeometry(o[0]):h.fromJSON(await s.invokeRemoteGeometryOp("difference",[o[0].toJSON(),o[1].toJSON()]))))},t.functions.symmetricdifference=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,o)=>(o=i.autoCastFeatureToGeometry(o),u.commonRelationsCheck(o,e,n),null===o[0]&&null===o[1]?null:null===o[0]?a.cloneGeometry(o[1]):null===o[1]?a.cloneGeometry(o[0]):h.fromJSON(await s.invokeRemoteGeometryOp("symmetricDifference",[o[0].toJSON(),o[1].toJSON()]))))},t.functions.clip=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,2,e,n),!(a[1]instanceof f)&&null!==a[1])throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(null===a[0])return null;if(!(a[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return null===a[1]?null:h.fromJSON(await s.invokeRemoteGeometryOp("clip",[a[0].toJSON(),a[1].toJSON()]))})},t.functions.cut=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,2,e,n),!(c[1]instanceof w)&&null!==c[1])throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(null===c[0])return[];if(!(c[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return null===c[1]?[a.cloneGeometry(c[0])]:(await s.invokeRemoteGeometryOp("cut",[c[0].toJSON(),c[1].toJSON()])).map(e=>h.fromJSON(e))})},t.functions.area=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(i.pcCheck(a,1,2,e,n),a=i.autoCastFeatureToGeometry(a),i.isFeatureSet(a[0])){const t=await a[0].sumArea(S(a[1]),null,e.abortSignal);if(e.abortSignal.aborted)throw new o.ArcadeExecutionError(e,"Cancelled",n);return t}let c=a[0];if((N.isArray(c)||i.isImmutableArray(c))&&(c=i.autoCastArrayOfPointsToPolygon(a[0],e.spatialReference)),null===c)return 0;if(!(c instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return s.invokeRemoteGeometryOp("area",[c.toJSON(),S(a[1])])})},t.functions.areageodetic=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{i.pcCheck(a,1,3,e,n);let c=(a=i.autoCastFeatureToGeometry(a))[0];(N.isArray(c)||i.isImmutableArray(c))&&(c=i.autoCastArrayOfPointsToPolygon(c,e.spatialReference));const l=S(a[1]),f=u.toCurveType(a[2]);if(i.isFeatureSet(c)){const t=await c.sumArea(l,f,e.abortSignal);if(e.abortSignal.aborted)throw new o.ArcadeExecutionError(e,"Cancelled",n);return t}if(null==c)return 0;if(!i.isGeometry(c))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return s.invokeRemoteGeometryOp("geodeticArea",[c.toJSON(),l,f])})},t.functions.length=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(i.pcCheck(a,1,2,e,n),a=i.autoCastFeatureToGeometry(a),i.isFeatureSet(a[0])){const t=await a[0].sumLength(S(a[1]),null,e.abortSignal);if(e.abortSignal.aborted)throw new o.ArcadeExecutionError(e,"Cancelled",n);return t}let c=a[0];if((N.isArray(a[0])||i.isImmutableArray(a[0]))&&(c=i.autoCastArrayOfPointsToPolyline(a[0],e.spatialReference)),null===c)return 0;if(!(c instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return s.invokeRemoteGeometryOp("length",[c.toJSON(),S(a[1])])})},t.functions.length3d=function(n,r){return t.standardFunctionAsync(n,r,async(t,a,c)=>{if(i.pcCheck(c,1,2,n,r),null===(c=i.autoCastFeatureToGeometry(c))[0])return 0;let l=c[0];if((N.isArray(c[0])||i.isImmutableArray(c[0]))&&(l=i.autoCastArrayOfPointsToPolyline(c[0],n.spatialReference)),null===l)return 0;if(!(l instanceof m))throw new o.ArcadeExecutionError(n,"InvalidParameter",r);if(!0===l.hasZ){const{convertFromSpatialReferenceUnit:t,toLengthUnit:n}=await new Promise((t,n)=>e(["../geometry/unitConversion"],t,n)),r=u.planarLength3D(l);return t(l.spatialReference,n(c[1]),r)}return s.invokeRemoteGeometryOp("length",[l.toJSON(),S(c[1])])})},t.functions.lengthgeodetic=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{i.pcCheck(a,1,3,e,n);let c=(a=i.autoCastFeatureToGeometry(a))[0];(N.isArray(a[0])||i.isImmutableArray(a[0]))&&(c=i.autoCastArrayOfPointsToPolyline(a[0],e.spatialReference));const l=S(a[1]),f=u.toCurveType(a[2]);if(i.isFeatureSet(c)){const t=await c.sumLength(l,f,e.abortSignal);if(e.abortSignal.aborted)throw new o.ArcadeExecutionError(e,"Cancelled",n);return t}if(null===c)return 0;if(!i.isGeometry(c))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return s.invokeRemoteGeometryOp("geodeticLength",[c.toJSON(),l,f])})},t.functions.distance=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,3,e,n);let c=a[0];if((N.isArray(a[0])||i.isImmutableArray(a[0]))&&(c=i.autoCastArrayOfPointsToMultiPoint(a[0],e.spatialReference)),!(c instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);let u=a[1];if((N.isArray(a[1])||i.isImmutableArray(a[1]))&&(u=i.autoCastArrayOfPointsToMultiPoint(a[1],e.spatialReference)),!(u instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return s.invokeRemoteGeometryOp("distance",[c.toJSON(),u.toJSON(),S(a[2])])})},t.functions.distancegeodetic=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,4,e,n);const c=a[0];if(!(c instanceof y))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const l=a[1];if(!(l instanceof y))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const f=new w({paths:[],spatialReference:c.spatialReference});return f.addPath([c,l]),s.invokeRemoteGeometryOp("geodeticLength",[f.toJSON(),S(a[2]),u.toCurveType(a[3])])})},t.functions.densify=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,3,e,n),null===a[0])return null;if(!(a[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const c=i.toNumber(a[1]);if(isNaN(c))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(c<=0)throw new o.ArcadeExecutionError(e,"InvalidParameter",n);switch(a[0].type){case"polygon":case"polyline":case"extent":return h.fromJSON(await s.invokeRemoteGeometryOp("densify",[a[0].toJSON(),c,S(a[2])]));default:return a[0]}})},t.functions.densifygeodetic=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,4,e,n);const c=a[0];if(null==c)return null;if(!i.isGeometry(c))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const l=i.toNumber(a[1]);if(isNaN(l))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(l<=0)throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const f=S(a[2]),m=u.toCurveType(a[3]);switch(c.type){case"polygon":case"polyline":case"extent":return h.fromJSON(await s.invokeRemoteGeometryOp("geodeticDensify",[c.toJSON(),l,f,m]));default:return c}})},t.functions.generalize=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,4,e,n),null===a[0])return null;if(!(a[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const c=i.toNumber(a[1]);if(isNaN(c))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const u=i.toBoolean(i.defaultUndefined(a[2],!0));return h.fromJSON(await s.invokeRemoteGeometryOp("generalize",[a[0].toJSON(),c,S(a[3]),{removeDegenerateParts:u}]))})},t.functions.buffer=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,3,e,n),null===c[0])return null;if(!(c[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const u=i.toNumber(c[1]);if(isNaN(u))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return 0===u?a.cloneGeometry(c[0]):h.fromJSON(await s.invokeRemoteGeometryOp("buffer",[c[0].toJSON(),u,S(c[2])]))})},t.functions.buffergeodetic=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,c)=>{c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,4,e,n);const l=c[0];if(null==l)return null;if(!i.isGeometry(l))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const f=i.toNumber(c[1]);if(isNaN(f))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(0===f)return a.cloneGeometry(l);const m=S(c[2]),d=u.toCurveType(c[3]);return h.fromJSON(await s.invokeRemoteGeometryOp("geodesicBuffer",[l.toJSON(),f,m,d]))})},t.functions.offset=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,6,e,n),null===a[0])return null;if(!(a[0]instanceof p||a[0]instanceof w))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const c=i.toNumber(a[1]);if(isNaN(c))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const l=u.toOffsetJoinType(a[3]),f=i.toNumber(i.defaultUndefined(a[4],10));if(isNaN(f))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const m=i.toNumber(i.defaultUndefined(a[5],0));if(isNaN(m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return h.fromJSON(await s.invokeRemoteGeometryOp("offset",[a[0].toJSON(),c,S(a[2]),{joins:l,miterLimit:f,flattenError:m}]))})},t.functions.rotate=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,2,3,e,n),null===a[0])return null;if(!(a[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const c=a[0]instanceof f?p.fromExtent(a[0]):a[0],u=i.toNumber(a[1]);if(isNaN(u))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);const l=i.defaultUndefined(a[2],null);if(null===l){const e="point"===c.type?c:c.extent?.center;return h.fromJSON(await s.invokeRemoteGeometryOp("rotate",[c.toJSON(),u,e?.x,e?.y]))}if(l instanceof y)return h.fromJSON(await s.invokeRemoteGeometryOp("rotate",[c.toJSON(),u,l.x,l.y]));throw new o.ArcadeExecutionError(e,"InvalidParameter",n)})},t.functions.centroid=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,1,2,e,n),null===a[0])return null;const c=u.toCentroidAlgorithm(a[1]);let l=a[0];if((N.isArray(a[0])||i.isImmutableArray(a[0]))&&(l="geometric"===c?i.autoCastArrayOfPointsToMultiPoint(a[0],e.spatialReference):i.autoCastArrayOfPointsToPolygon(a[0],e.spatialReference),null===l))return null;if(!(l instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return"geometric"===c?h.fromJSON(await s.invokeRemoteGeometryOp("centroid",[l.toJSON()])):h.fromJSON(await s.invokeRemoteGeometryOp("labelPoint",[l.toJSON()]))})},t.functions.measuretocoordinate=function(e,n){return t.standardFunctionAsync(e,n,u.measureToCoordinateFunc)},t.functions.pointtocoordinate=function(e,n){return t.standardFunctionAsync(e,n,u.pointToCoordinateFunc)},t.functions.distancetocoordinate=function(e,n){return t.standardFunctionAsync(e,n,u.distanceToCoordinateFunc)},t.functions.multiparttosinglepart=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,1,1,e,n),null===c[0])return null;if(!(c[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(c[0]instanceof y)return[i.fixSpatialReference(a.cloneGeometry(c[0]),e.spatialReference)];if(c[0]instanceof f)return[i.fixSpatialReference(a.cloneGeometry(c[0]),e.spatialReference)];const u=h.fromJSON(await s.invokeRemoteGeometryOp("simplify",[c[0].toJSON()]));if(u instanceof p){const e=[],t=[];for(let n=0;n<u.rings.length;n++)if(u.isClockwise(u.rings[n])){const t=h.fromJSON({rings:[u.rings[n]],hasZ:!0===u.hasZ,hasM:!0===u.hasM,spatialReference:u.spatialReference.toJSON()});e.push(t)}else t.push({ring:u.rings[n],pt:u.getPoint(n,0)});for(let n=0;n<t.length;n++)for(let r=0;r<e.length;r++)if(e[r].contains(t[n].pt)){e[r].addRing(t[n].ring);break}return e}if(u instanceof w){const e=[];for(let t=0;t<u.paths.length;t++){const n=h.fromJSON({paths:[u.paths[t]],hasZ:!0===u.hasZ,hasM:!0===u.hasM,spatialReference:u.spatialReference.toJSON()});e.push(n)}return e}if(c[0]instanceof d){const t=[],n=i.fixSpatialReference(a.cloneGeometry(c[0]),e.spatialReference);for(let e=0;e<n.points.length;e++)t.push(n.getPoint(e));return t}return null})},t.functions.isselfintersecting=function(e,n){return t.standardFunctionAsync(e,n,async(e,t,n)=>{i.pcCheck(n,1,1,e,t);let r=(n=i.autoCastFeatureToGeometry(n))[0];if((N.isArray(n[0])||i.isImmutableArray(n[0]))&&(r=i.autoCastArrayOfPointsToPolyline(n[0],e.spatialReference)),r instanceof d){const e=r.points;for(let t=0;t<e.length;t++)for(let n=t+1;n<e.length;n++)if(l.equals(e[t],e[n]))return!0;return!1}return(r instanceof w||r instanceof p)&&await s.invokeRemoteGeometryOp("isSelfIntersecting",[r.toJSON()])})},t.functions.issimple=function(e,n){return t.standardFunctionAsync(e,n,(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,1,1,e,n),null===a[0])return!0;if(!(a[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return s.invokeRemoteGeometryOp("isSimple",[a[0].toJSON()])})},t.functions.simplify=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,1,1,e,n),null===a[0])return null;if(!(a[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return h.fromJSON(await s.invokeRemoteGeometryOp("simplify",[a[0].toJSON()]))})},t.functions.convexhull=function(e,n){return t.standardFunctionAsync(e,n,async(t,r,a)=>{if(a=i.autoCastFeatureToGeometry(a),i.pcCheck(a,1,1,e,n),null===a[0])return null;if(!(a[0]instanceof m))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);return h.fromJSON(await s.invokeRemoteGeometryOp("convexHull",[a[0].toJSON()]))})},t.functions.getuser=function(e,a){return t.standardFunctionAsync(e,a,async(t,u,s)=>{i.pcCheck(s,0,2,e,a);let l=i.defaultUndefined(s[1],""),f=!0===l;if(l=!0===l||!1===l?"":i.toString(l),0===s.length||s[0]instanceof n){let t;t=e.services?.portal?e.services.portal:O.getDefault(),s.length>0&&(t=c.getPortal(s[0],t));const n=await A.lookupUser(t,l,f);if(n){const t=JSON.parse(JSON.stringify(n));for(const e of["lastLogin","created","modified"])void 0!==t[e]&&null!==t[e]&&(t[e]=new Date(t[e]));return r.convertObjectToArcadeDictionary(t,i.defaultTimeZone(e))}return null}let m=null;if(i.isFeatureSet(s[0])&&(m=s[0]),m){if(f=!1,l)return null;await m.load();const t=await m.getOwningSystemUrl();if(!t){if(!l){const t=await m.getIdentityUser();return t?r.convertObjectToArcadeDictionary({username:t},i.defaultTimeZone(e)):null}return null}let o;o=e.services?.portal?e.services.portal:O.getDefault(),o=c.getPortal(new n(t),o);const a=await A.lookupUser(o,l,f);if(a){const t=JSON.parse(JSON.stringify(a));for(const e of["lastLogin","created","modified"])void 0!==t[e]&&null!==t[e]&&(t[e]=new Date(t[e]));return r.convertObjectToArcadeDictionary(t,i.defaultTimeZone(e))}return null}throw new o.ArcadeExecutionError(e,"InvalidParameter",a)})},t.functions.nearestcoordinate=function(e,n){return t.standardFunctionAsync(e,n,async(t,a,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,2,e,n),!(c[0]instanceof m||null===c[0]))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(!(c[1]instanceof y||null===c[1]))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(null===c[0]||null===c[1])return null;const u=c[0]instanceof f?p.fromExtent(c[0]):c[0],l=await s.invokeRemoteGeometryOp("getNearestCoordinate",[u.toJSON(),c[1].toJSON(),{calculateLeftRightSide:!0}]);return null===l?null:r.convertObjectToArcadeDictionary({coordinate:h.fromJSON(l.coordinate),distance:l.distance,sideOfLine:0===l.distance?"straddle":l.isRightSide?"right":"left"},i.defaultTimeZone(e),!1,!0)})},t.functions.nearestvertex=function(e,n){return t.standardFunctionAsync(e,n,async(t,a,c)=>{if(c=i.autoCastFeatureToGeometry(c),i.pcCheck(c,2,2,e,n),!(c[0]instanceof m||null===c[0]))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(!(c[1]instanceof y||null===c[1]))throw new o.ArcadeExecutionError(e,"InvalidParameter",n);if(null===c[0]||null===c[1])return null;const u=c[0]instanceof f?p.fromExtent(c[0]):c[0],l=await s.invokeRemoteGeometryOp("getNearestVertex",[u.toJSON(),c[1].toJSON()]);return null===l?null:r.convertObjectToArcadeDictionary({coordinate:h.fromJSON(l.coordinate),distance:l.distance,sideOfLine:0===l.distance?"straddle":l.isRightSide?"right":"left"},i.defaultTimeZone(e),!1,!0)})})},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});