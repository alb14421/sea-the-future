// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../ArcadeDate","../arcadeEnvironment","../executionError","../../chunks/languageUtils"],function(t,e,r,n,o,c){"use strict";function a(t){const e=t.track;if(null==e)throw new o.ArcadeExecutionError(t,"InvalidParameter",null);return e}function i(t,e,r,n){const o=Math.max(0,u(t,e)),c=Math.max(0,u(t,r));return t.observations.slice(o,c).map((t,e)=>n(t,e+o))}function u(t,e){return t.currentObservationIndex+e}function s(t,e){const r=u(t,e);if(r<0||r>=t.observations.length)throw new o.ArcadeExecutionError(null,"InvalidParameter",null);return r}function d(t,e){const{stats:r}=t.observations[e];if(null!=r.totalDistance)return r.totalDistance;if(0===e)return r.totalDistance=0;let n,o=0;for(n=e-1;n>0;n--){const e=t.observations[n].stats;if(null!=e.totalDistance){o=e.totalDistance;break}}for(let r=n+1;r<=e;r++){const e=t.observations[r];o+=l(t,r),e.stats.totalDistance=o}return o}function l(t,r){const n=t.observations[r],o=n.stats;if(null!=o.distance)return o.distance;if(0===r)return o.distance=0;const c=t.observations[r-1];return o.distance=e.geodeticDistance.execute(c.feature.geometry(),n.feature.geometry())}function m(t,e){const r=t.observations[e],n=r.stats;if(null!=n.speed)return n.speed;if(0===e)return n.speed=0;const o=t.observations[e-1],c=r.endTime-o.startTime;if(c<=0)return n.speed=0;const a=l(t,e);return n.speed=a/(c/1e3)}function b(t,e){const r=t.observations[e],n=r.stats;if(null!=n.acceleration)return n.acceleration;if(0===e)return n.acceleration=0;const o=t.observations[e-1],c=r.endTime-o.startTime;if(c<=0)return n.acceleration=0;const a=m(t,e),i=m(t,e-1);return n.acceleration=(a-i)/(c/1e3)}e.geodeticDistance=void 0,e.loadOperators=async function(){null==e.geodeticDistance&&(e.geodeticDistance=await new Promise((e,r)=>t(["../../geometry/operators/geodeticDistanceOperator"],e,r)),await e.geodeticDistance.load())},e.registerFunctions=function(t,e){t[n.toSymbolId("TrackIndex")]=function(t,r){return e(t,r,(t,e,r)=>(c.pcCheck(r,0,0,t,e),a(t).currentObservationIndex))},t[n.toSymbolId("TrackWindow")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,2,2,t,e);const n=c.toNumber(r[0]),o=c.toNumber(r[1]);return i(a(t),n,o,t=>t.feature)})},t[n.toSymbolId("TrackFieldWindow")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,3,3,t,e);const n=c.toString(r[0]),o=c.toNumber(r[1]),u=c.toNumber(r[2]);return i(a(t),o,u,t=>t.feature.field(n))})},t[n.toSymbolId("TrackGeometryWindow")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,2,2,t,e);const n=c.toNumber(r[0]),o=c.toNumber(r[1]);return i(a(t),n,o,t=>t.feature.geometry())})},t[n.toSymbolId("TrackStartTime")]=function(t,n){return e(t,n,(t,e,n)=>(c.pcCheck(n,0,0,t,e),r.ArcadeDate.epochToArcadeDate(a(t).observations[0].startTime,t.timeZone??"system")))},t[n.toSymbolId("TrackCurrentTime")]=function(t,n){return e(t,n,(t,e,n)=>{c.pcCheck(n,0,0,t,e);const o=a(t);return r.ArcadeDate.epochToArcadeDate(o.observations[o.currentObservationIndex].startTime,t.timeZone??"system")})},t[n.toSymbolId("TrackDuration")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,0,0,t,e);const n=a(t);return n.observations[n.currentObservationIndex].startTime-n.observations[0].startTime})},t[n.toSymbolId("TrackCurrentDistance")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,0,0,t,e);const n=a(t);return d(n,n.currentObservationIndex)})},t[n.toSymbolId("TrackDistanceAt")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,1,1,t,e);const n=c.toNumber(r[0]),o=a(t);return d(o,s(o,n))})},t[n.toSymbolId("TrackDistanceWindow")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,2,2,t,e);const n=c.toNumber(r[0]),o=c.toNumber(r[1]),u=a(t);return i(u,n,o,(t,e)=>d(u,e))})},t[n.toSymbolId("TrackCurrentSpeed")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,0,0,t,e);const n=a(t);return m(n,n.currentObservationIndex)})},t[n.toSymbolId("TrackSpeedAt")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,1,1,t,e);const n=c.toNumber(r[0]),o=a(t);return m(o,s(o,n))})},t[n.toSymbolId("TrackSpeedWindow")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,2,2,t,e);const n=c.toNumber(r[0]),o=c.toNumber(r[1]),u=a(t);return i(u,n,o,(t,e)=>m(u,e))})},t[n.toSymbolId("TrackCurrentAcceleration")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,0,0,t,e);const n=a(t);return b(n,n.currentObservationIndex)})},t[n.toSymbolId("TrackAccelerationAt")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,1,1,t,e);const n=c.toNumber(r[0]),o=a(t);return b(o,s(o,n))})},t[n.toSymbolId("TrackAccelerationWindow")]=function(t,r){return e(t,r,(t,e,r)=>{c.pcCheck(r,2,2,t,e);const n=c.toNumber(r[0]),o=c.toNumber(r[1]),u=a(t);return i(u,n,o,(t,e)=>b(u,e))})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});