// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./centroid","../../core/unitUtils","../../geometry/Point","../../geometry/Polygon"],function(e,t,n,s,a){"use strict";function r(e,t,n){const s=t[0]-e[0],a=t[1]-e[1];return Math.sqrt(s*s+a*a)}function l(e,t,n,s){const a=function(e){const t=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}(e);return[e[0]/t,e[1]/t,e[2]/t]}([t[0]-e[0],t[1]-e[1],t[2]*s-e[2]*s]);return[e[0]+a[0]*n,e[1]+a[1]*n,e[2]+a[2]*n]}function i(e,t,n,s){return e+(t-e)/n*s}function c(e,t,n){let s=t[0]-e[0],a=t[1]-e[1];const r=Math.sqrt(s*s+a*a);return s/=r,a/=r,s*=n,a*=n,[e[0]+s,e[1]+a]}e.distanceToCoordinate=function(e,a){if(!e)return null;switch(e.type){case"extent":case"multipoint":case"mesh":case"point":return null}const o="polygon"===e.type?e.rings:e.paths;if(a<0)return null;let h=1;(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid)&&(h=t.getMetersPerVerticalUnitForSR(e.spatialReference)/n.getMetersPerUnitForSR(e.spatialReference));let u=0;const f=e.hasZ?3:2,g=e.hasZ?t.segmentLength3d:r;let p=-1;if(0===a)return 0===o.length||0===o[0].length?null:{partId:0,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:o[0][0][0],y:o[0][0][1],...e.hasZ?{z:o[0][0][2]}:{},...e.hasM?{m:o[0][0][f]}:{}}),segmentId:0};for(const t of o){p++;let n=-1;for(let r=1;r<t.length;r++){n++;const o=g(t[r-1],t[r],h),d=u+o;if(d===a)return{partId:p,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:t[r][0],y:t[r][1],...e.hasZ?{z:t[r][2]}:{},...e.hasM?{m:t[r][f]}:{}}),segmentId:n};if(d>a){let g=e.hasZ?l(t[r-1],t[r],a-u,h):c(t[r-1],t[r],a-u);return g=[...g,i(t[r-1][f],t[r][f],o,a-u)],{partId:p,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:g[0],y:g[1],...e.hasZ?{z:g[2]}:{},...e.hasM?{m:g[f]}:{}}),segmentId:n}}u=d}}return null},e.measureToCoordinate=function(e,a){if(!e)return null;switch(e.type){case"extent":case"multipoint":case"mesh":case"point":return null}const i="polygon"===e.type?e.rings:e.paths;let o=1;if((e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid)&&(o=t.getMetersPerVerticalUnitForSR(e.spatialReference)/n.getMetersPerUnitForSR(e.spatialReference)),0===i.length)return null;if(0===i[0].length)return null;if(!1===e.hasM)return null;let h=-1,u=0;const f=e.hasZ?t.segmentLength3d:r,g=e.hasZ?3:2;for(const t of i){if(h++,t.length>0&&t[0][g]===a)return{partId:h,distanceAlong:u,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:t[0][0],y:t[0][1],...e.hasZ?{z:t[0][2]}:{},...e.hasM?{m:t[0][g]}:{}}),segmentId:0};let n=-1;for(let r=1;r<t.length;r++){const i=f(t[r-1],t[r],o);n++;const p=t[r][g]-t[r-1][g],d=t[r][g];if(d===a)return{partId:h,distanceAlong:i+u,coordinate:new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:t[r][0],y:t[r][1],...e.hasZ?{z:t[r][2]}:{},...e.hasM?{m:t[r][g]}:{}}),segmentId:n};if(d>a&&a>t[r-1][g]){const d=(a-t[r-1][g])/p*i;let m=e.hasZ?l(t[r-1],t[r],d,o):c(t[r-1],t[r],d);m=[...m,a];const R=new s({hasZ:e.hasZ,hasM:e.hasM,spatialReference:e.spatialReference,x:m[0],y:m[1],...e.hasZ?{z:m[2]}:{},...e.hasM?{m:m[g]}:{}});return{partId:h,distanceAlong:u+f(t[r-1],[R.x,R.y,...R.hasZ?[R.z]:[],...R.hasM?[R.m]:[]],o),coordinate:R,segmentId:n}}u+=i}}return null},e.pointToCoordinate=function(e,r){if(!e)return null;if(!r)return null;if("extent"===e.type){const t=e;e=new a({spatialReference:e.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}switch(e.type){case"point":return function(e,s){if(!e)return null;if(!s)return null;let a=1;(s.spatialReference.vcsWkid||s.spatialReference.latestVcsWkid)&&(a=t.getMetersPerVerticalUnitForSR(s.spatialReference)/n.getMetersPerUnitForSR(s.spatialReference));let r=null,l=0;return r=e,l=e.hasZ&&s.hasZ?t.segmentLength3d([s.x,s.y,s.z],[e.x,e.y,e.z],a):t.segmentLength([s.x,s.y],[e.x,e.y],!1),{coordinate:r,distance:l}}(e,r)??null;case"multipoint":return function(e,s){if(!e)return null;if(!s)return null;let a=1;(s.spatialReference.vcsWkid||s.spatialReference.latestVcsWkid)&&(a=t.getMetersPerVerticalUnitForSR(s.spatialReference)/n.getMetersPerUnitForSR(s.spatialReference));let r=null,l=0,i=Number.MAX_VALUE,c=-1,o=-1;for(const n of e.points||[]){o++;const r=e.hasZ&&s.hasZ?t.segmentLength3dSqr([n[0],n[1],n[2]],[s.x,s.y,s.z],a):t.segmentLengthSqr([n[0],n[1]],[s.x,s.y],!1);r<i&&(i=r,c=o)}return c<0?null:(l=i,r=e.getPoint(c),{coordinate:r,distance:Math.sqrt(l)})}(e,r)??null;case"polygon":case"polyline":return function(e,a){if(!e)return null;if(!a)return null;const r="polygon"===e.type?e.rings:e.paths;let l=1;(a.spatialReference.vcsWkid||a.spatialReference.latestVcsWkid)&&(l=t.getMetersPerVerticalUnitForSR(a.spatialReference)/n.getMetersPerUnitForSR(a.spatialReference));let c=Number.MAX_VALUE,o=-1,h=-1,u=-1;const f=e.hasZ&&a.hasZ;let g=null;const p=f?[a.x,a.y,a.z]:[a.x,a.y];for(const e of r){h++;for(let n=1;n<e.length;n++){const s=f?t.closestPointOnLineSegmentWithZ(p,e[n-1],e[n]):t.closestPointOnLineSegment(p,e[n-1],e[n]),a=f?t.segmentLength3dSqr(s,p,l):t.segmentLengthSqr(s,p,!1);a<c&&(c=a,g=s,u=h,o=n-1)}}if(o<0)return null;const d=e.hasM&&e.hasZ?3:2,m=r[u][o],R=r[u][o+1];let M=null,y=null,Z=f?g[2]:null;e.hasM&&(y=i(m[d],R[d],f?t.segmentLength3d(m,R,l):t.segmentLength(m,R,!1),f?t.segmentLength3d(m,g,l):t.segmentLength(m,g,!1))),e.hasZ&&!1===a.hasZ&&(Z=i(m[2],R[2],f?t.segmentLength3d(m,R,l):t.segmentLength(m,R,!1),f?t.segmentLength3d(m,g,l):t.segmentLength(m,g,!1))),M=new s({hasZ:f,hasM:e.hasM,spatialReference:a.spatialReference,x:g[0],y:g[1],...e.hasZ?{z:Z}:{},...e.hasM?{m:y}:{}});let x=0;for(let n=0;n<=u;n++){const s=r[n],a=n===u?o:s.length-1;for(let n=1;n<=a;n++)x+=e.hasZ?t.segmentLength3d(s[n-1],s[n],l):t.segmentLength([s[n-1][0],s[n-1][1]],[s[n][0],s[n][1]],!1)}return x+=e.hasZ?t.segmentLength3d(m,[M.x,M.y,M.z],l):t.segmentLength(m,[M.x,M.y],!1),{partId:u,segmentId:o,coordinate:M,distance:Math.sqrt(c),distanceAlong:x}}(e,r)??null;default:return null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});