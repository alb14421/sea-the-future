// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../ArcadeDate","../arcadeEnvironment","../Dictionary","../executionError","../Feature","../../chunks/languageUtils","../featureset/support/shared","../../core/sql/SqlTimestampOffset","../../core/sql/WhereClause","../../layers/support/streamLayerUtils","../../support/guards"],function(e,r,t,n,i,a,o,u,c,d,s,l){"use strict";function f(e){const r=e?.fullSchema();return r?.datesInUnknownTimezone?"unknown":r?.dateFieldsTimeZone||"UTC"}function m(e){const r=e.fullSchema()?.fieldsIndex;return null==r&&e instanceof a?e.fieldsIndex:r}const p={getAttributeSQL(e,r){const t=e.field(r);if(null==t)return t;if(o.isDate(t)){const n=t.toDateTime(),i=m(e)?.get(r)?.type;return"esriFieldTypeTimestampOffset"===i||"timestamp-offset"===i?c.SqlTimeStampOffset.fromDateTime(n):n}return t}};e.registerFunctions=function(e,a,c){e.domain=function(e,r){return a(e,r,(t,a,c)=>{if(o.pcCheck(c,2,3,e,r),o.isFeature(c[0])){const r=o.featureFullDomain(c[0],o.toString(c[1]),void 0===c[2]?void 0:c[2]);return r&&r.domain?"coded-value"===r.domain.type||"codedValue"===r.domain.type?n.convertObjectToArcadeDictionary({type:"codedValue",name:r.domain.name,dataType:u.layerFieldEsriConstants[r.field.type],codedValues:r.domain.codedValues.map(e=>({name:e.name,code:e.code}))},o.defaultTimeZone(e)):n.convertObjectToArcadeDictionary({type:"range",name:r.domain.name,dataType:u.layerFieldEsriConstants[r.field.type],min:r.domain.minValue,max:r.domain.maxValue},o.defaultTimeZone(e)):null}throw new i.ArcadeExecutionError(e,"InvalidParameter",r)})},e.domaincode=function(e,r){return a(e,r,(t,n,a)=>{if(o.pcCheck(a,2,4,e,r),o.isFeature(a[0]))return o.featureDomainCodeLookup(a[0],o.toString(a[1]),a[2],void 0===a[3]?void 0:a[3]);throw new i.ArcadeExecutionError(e,"InvalidParameter",r)})},e.domainname=function(e,r){return a(e,r,(t,n,a)=>{if(o.pcCheck(a,2,4,e,r),o.isFeature(a[0]))return o.featureDomainValueLookup(a[0],o.toString(a[1]),a[2],void 0===a[3]?void 0:a[3]);throw new i.ArcadeExecutionError(e,"InvalidParameter",r)})},e.expects=function(e,r){return a(e,r,(t,n,a)=>{if(a.length<1)throw new i.ArcadeExecutionError(e,"WrongNumberOfParameters",r);return o.voidOperation})},e.featureinfilter=function(e,r){return a(e,r,(e,r,t)=>{o.pcCheck(t,2,2,e,r);const[n,a]=t;if(null==n)return!1;if(""===a||null==a)return!0;if(!o.isFeature(n)||!l.isString(a))throw new i.ArcadeExecutionError(e,"InvalidParameter",r);const u=d.create(a,{fieldsIndex:m(n),timeZone:f(n)}),s=u.getVariables();for(const r of s)u.parameters[r]=c(e,{name:r});return u.testFeature(n,p)})},e.gdbversion=function(e,r){return a(e,r,(t,n,a)=>{if(o.pcCheck(a,1,1,e,r),o.isFeature(a[0]))return a[0].gdbVersion();throw new i.ArcadeExecutionError(e,"InvalidParameter",r)})},e.schema=function(e,r){return a(e,r,(t,a,u)=>{if(o.isFeature(u[0])){const r=o.featureSchema(u[0]);return r?n.convertObjectToArcadeDictionary(r,o.defaultTimeZone(e)):null}throw new i.ArcadeExecutionError(e,"InvalidParameter",r)})},e.subtypecode=function(e,r){return a(e,r,(t,n,a)=>{if(o.pcCheck(a,1,1,e,r),o.isFeature(a[0])){const e=o.featureSubtypes(a[0]);if(!e)return null;if(e.subtypeField&&a[0].hasField(e.subtypeField)){const r=a[0].field(e.subtypeField);for(const t of e.subtypes)if(t.code===r)return t.code;return null}return null}throw new i.ArcadeExecutionError(e,"InvalidParameter",r)})},e.subtypename=function(e,r){return a(e,r,(t,n,a)=>{if(o.pcCheck(a,1,1,e,r),o.isFeature(a[0])){const e=o.featureSubtypes(a[0]);if(!e)return"";if(e.subtypeField&&a[0].hasField(e.subtypeField)){const r=a[0].field(e.subtypeField);for(const t of e.subtypes)if(t.code===r)return t.name;return""}return""}throw new i.ArcadeExecutionError(e,"InvalidParameter",r)})},e.subtypes=function(e,r){return a(e,r,(t,a,u)=>{if(o.pcCheck(u,1,1,e,r),o.isFeature(u[0])){const r=o.featureSubtypes(u[0]);return r?n.convertObjectToArcadeDictionary(r,o.defaultTimeZone(e)):null}throw new i.ArcadeExecutionError(e,"InvalidParameter",r)})},e[t.toSymbolId("TimeReceived")]=function(e,t){return a(e,t,(e,t,n)=>{if(o.pcCheck(n,1,1,e,t),o.isFeature(n[0])){if(n[0].hasField(s.internalTimeReceivedField)){const t=n[0].field(s.internalTimeReceivedField);return l.isNumber(t)?r.ArcadeDate.epochToArcadeDate(t,e.timeZone??"system"):o.isDate(t)?t:null}return null}throw new i.ArcadeExecutionError(e,"InvalidParameter",t)})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});