// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../ArcadeDate","../enum","../executionError","../../chunks/languageUtils","../../core/sql/DateOnly","../../core/sql/TimeOnly","../../intl/locale","../../chunks/datetime","../../support/guards"],function(e,t,n,r,o,u,i,a,l,c){"use strict";const m=[0,31,59,90,120,151,181,212,243,273,304,334],s=[0,31,60,91,121,152,182,213,244,274,305,335];function d(e){return null===e?e:!1===e.isValid?null:e}function f(e,t){switch(n.toStringEnumKey(e)){case"":case"default":return o.defaultTimeZone(t);case"z":return"UTC";default:return e}}function D(e,t){return o.isDateOnly(e)?e.toArcadeDate():o.toDate(e,o.defaultTimeZone(t))}const N=new n.StringEnum(["days","months","minutes","seconds","hours","years","milliseconds"],[["day","days"],["d","days"],["month","months"],["minute","minutes"],["m","minutes"],["second","seconds"],["s","seconds"],["hour","hours"],["h","hours"],["year","years"],["y","years"],["millisecond","milliseconds"],["ms","milliseconds"]]);function T(e){return"M"===e?"months":N.lookup(o.toString(e))??"milliseconds"}e.registerFunctions=function(e,n){e.today=function(e,r){return n(e,r,(n,u,i)=>{o.pcCheck(i,0,0,e,r);const a=new Date;return a.setHours(0,0,0,0),t.ArcadeDate.dateJSAndZoneToArcadeDate(a,o.defaultTimeZone(e))})},e.time=function(e,u){return n(e,u,(n,a,l)=>{switch(o.pcCheck(l,0,4,e,u),l.length){case 0:{const n=t.ArcadeDate.nowToArcadeDate(o.defaultTimeZone(e));return new i.TimeOnly(n.hour,n.minute,n.second,n.millisecond)}case 1:{if(o.isTime(l[0]))return l[0].clone();if(o.isDate(l[0]))return new i.TimeOnly(l[0].hour,l[0].minute,l[0].second,l[0].millisecond);if(o.isDateOnly(l[0]))return new i.TimeOnly(0,0,0,0);if(c.isString(l[0]))return i.TimeOnly.fromString(l[0]);const e=o.toNumber(l[0]);return!1===isNaN(e)?i.TimeOnly.fromMilliseconds(e):null}case 2:return c.isString(l[0])&&c.isString(l[1])?i.TimeOnly.fromString(l[0],l[1]):i.TimeOnly.fromParts(o.toNumber(l[0]),o.toNumber(l[1]),0,0);case 3:return i.TimeOnly.fromParts(o.toNumber(l[0]),o.toNumber(l[1]),o.toNumber(l[2]),0);case 4:return i.TimeOnly.fromParts(o.toNumber(l[0]),o.toNumber(l[1]),o.toNumber(l[2]),o.toNumber(l[3]))}throw new r.ArcadeExecutionError(e,"InvalidParameter",u)})},e.dateonly=function(e,r){return n(e,r,(n,i,a)=>{if(o.pcCheck(a,0,3,e,r),3===a.length)return u.DateOnly.fromParts(o.toNumber(a[0]),o.toNumber(a[1])+1,o.toNumber(a[2]));if(2===a.length){const e=o.toString(a[1]);return""===e?null:"X"===e?u.DateOnly.fromSeconds(o.toNumber(a[0])):"x"===e?u.DateOnly.fromMilliseconds(o.toNumber(a[0])):u.DateOnly.fromString(o.toString(a[0]),e)}if(1===a.length){if(c.isString(a[0])){if(""===a[0].replaceAll(/^\s+|\s+$/g,""))return null;if(!0===/^[0-9][0-9][0-9][0-9]$/.test(a[0]))return u.DateOnly.fromString(a[0]+"-01-01")}if(o.isDateOnly(a[0]))return a[0].clone();if(o.isDate(a[0]))return u.DateOnly.fromParts(a[0].year,a[0].monthJS+1,a[0].day);const e=o.toNumber(a[0]);return!1===isNaN(e)?u.DateOnly.fromMilliseconds(e):c.isString(a[0])?u.DateOnly.fromString(a[0]):null}if(0===a.length){const n=t.ArcadeDate.nowToArcadeDate(o.defaultTimeZone(e));return!1===n.isValid?null:u.DateOnly.fromParts(n.year,n.monthJS+1,n.day)}return null})},e.changetimezone=function(e,u){return n(e,u,(n,i,a)=>{if(o.pcCheck(a,2,2,e,u),null===a[0])return null;if(o.isDateOnly(a[0]))throw new r.ArcadeExecutionError(e,"CannotChangeTimeZoneDateOnly",u);if(o.isDateOnly(a[0]))throw new r.ArcadeExecutionError(e,"CannotChangeTimeZoneTime",u);const l=o.toDate(a[0],o.defaultTimeZone(e));if(null===l)throw new r.ArcadeExecutionError(e,"InvalidParameter",u);const c=t.createDateTimeZone(f(o.toString(a[1]),e),!1);if(null===c)return null;const m=t.ArcadeDate.arcadeDateAndZoneToArcadeDate(l,c);return!1===m.isValid?null:m})},e.timezone=function(e,r){return n(e,r,(n,u,i)=>{if(o.pcCheck(i,1,2,e,r),o.isTime(i[0]))return"Unknown";if(o.isDateOnly(i[0]))return"Unknown";const a=o.toDate(i[0],o.defaultTimeZone(e));if(null===a)return null;const l=a.timeZone;return"system"===l?t.ArcadeDate.systemTimeZoneCanonicalName:"utc"===l.toLowerCase()?"UTC":"unknown"===l.toLowerCase()?"Unknown":l})},e.timezoneoffset=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=o.toDate(u[0],o.defaultTimeZone(e));return null===i?null:60*i.timeZoneOffset*1e3})},e.now=function(e,r){return n(e,r,(n,u,i)=>{o.pcCheck(i,0,0,e,r);const a=t.ArcadeDate.nowToArcadeDate(o.defaultTimeZone(e));return!1===a.isValid?null:a})},e.timestamp=function(e,r){return n(e,r,(n,u,i)=>{o.pcCheck(i,0,0,e,r);const a=t.ArcadeDate.nowUTCToArcadeDate();return!1===a.isValid?null:a})},e.toutc=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=o.toDate(u[0],o.defaultTimeZone(e));return null===i?null:i.toUTC()})},e.tolocal=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=o.toDate(u[0],o.defaultTimeZone(e));return null===i?null:i.toLocal()})},e.day=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=D(u[0],o.defaultTimeZone(e));return null===i?NaN:i.day})},e.month=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=D(u[0],o.defaultTimeZone(e));return null===i?NaN:i.monthJS})},e.year=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=D(u[0],o.defaultTimeZone(e));return null===i?NaN:i.year})},e.hour=function(e,t){return n(e,t,(n,r,u)=>{if(o.pcCheck(u,1,1,e,t),o.isTime(u[0]))return u[0].hour;const i=o.toDate(u[0],o.defaultTimeZone(e));return null===i?NaN:i.hour})},e.second=function(e,t){return n(e,t,(n,r,u)=>{if(o.pcCheck(u,1,1,e,t),o.isTime(u[0]))return u[0].second;const i=o.toDate(u[0],o.defaultTimeZone(e));return null===i?NaN:i.second})},e.millisecond=function(e,t){return n(e,t,(n,r,u)=>{if(o.pcCheck(u,1,1,e,t),o.isTime(u[0]))return u[0].millisecond;const i=o.toDate(u[0],o.defaultTimeZone(e));return null===i?NaN:i.millisecond})},e.minute=function(e,t){return n(e,t,(n,r,u)=>{if(o.pcCheck(u,1,1,e,t),o.isTime(u[0]))return u[0].minute;const i=o.toDate(u[0],o.defaultTimeZone(e));return null===i?NaN:i.minute})},e.week=function(e,t){return n(e,t,(n,u,i)=>{o.pcCheck(i,1,2,e,t);const a=D(i[0],o.defaultTimeZone(e));if(null===a)return NaN;const l=o.toNumber(o.defaultUndefined(i[1],0));if(l<0||l>6)throw new r.ArcadeExecutionError(e,"InvalidParameter",t);const c=a.day,d=a.monthJS,f=a.year,N=a.dayOfWeekJS,T=function(e,t,n){const r=function(e){return e%4==0&&(e%100!=0||e%400==0)}(n)?s:m;return e+r[t]}(c,d,f)-1,h=Math.floor(T/7);return N-l+(N-l<0?7:0)<T-7*h?h+1:h})},e.weekday=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=D(u[0],o.defaultTimeZone(e));return null===i?NaN:i.dayOfWeekJS})},e.isoweekday=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=D(u[0],o.defaultTimeZone(e));return null===i?NaN:i.dayOfWeekISO})},e.isomonth=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=D(u[0],o.defaultTimeZone(e));return null===i?NaN:i.monthISO})},e.isoweek=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=D(u[0],o.defaultTimeZone(e));return null===i?NaN:i.weekISO})},e.isoyear=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,1,1,e,t);const i=D(u[0],o.defaultTimeZone(e));return null===i?NaN:i.yearISO})},e.date=function(e,r){return n(e,r,(n,u,i)=>{if(o.pcCheck(i,0,8,e,r),3===i.length){if(o.isDateOnly(i[0])&&o.isTime(i[1])&&c.isString(i[2])){const n=t.createDateTimeZone(f(o.toString(i[2])??"unknown",e),!1);return null===n?null:d(t.ArcadeDate.fromParts(i[0].year,i[0].month,i[0].day,i[1].hour,i[1].minute,i[1].second,i[1].millisecond,n))}return d(t.ArcadeDate.fromParts(o.toNumber(i[0]),o.toNumber(i[1])+1,o.toNumber(i[2]),0,0,0,0,o.defaultTimeZone(e)))}if(4===i.length)return d(t.ArcadeDate.fromParts(o.toNumber(i[0]),o.toNumber(i[1])+1,o.toNumber(i[2]),o.toNumber(i[3]),0,0,0,o.defaultTimeZone(e)));if(5===i.length)return d(t.ArcadeDate.fromParts(o.toNumber(i[0]),o.toNumber(i[1])+1,o.toNumber(i[2]),o.toNumber(i[3]),o.toNumber(i[4]),0,0,o.defaultTimeZone(e)));if(6===i.length)return d(t.ArcadeDate.fromParts(o.toNumber(i[0]),o.toNumber(i[1])+1,o.toNumber(i[2]),o.toNumber(i[3]),o.toNumber(i[4]),o.toNumber(i[5]),0,o.defaultTimeZone(e)));if(7===i.length)return d(t.ArcadeDate.fromParts(o.toNumber(i[0]),o.toNumber(i[1])+1,o.toNumber(i[2]),o.toNumber(i[3]),o.toNumber(i[4]),o.toNumber(i[5]),o.toNumber(i[6]),o.defaultTimeZone(e)));if(8===i.length){const n=t.createDateTimeZone(f(o.toString(i[7])??"unknown",e),!1);return null===n?null:d(t.ArcadeDate.fromParts(o.toNumber(i[0]),o.toNumber(i[1])+1,o.toNumber(i[2]),o.toNumber(i[3]),o.toNumber(i[4]),o.toNumber(i[5]),o.toNumber(i[6]),n))}if(2===i.length){if(o.isDateOnly(i[0])&&c.isString(i[1])){const n=t.createDateTimeZone(f(o.toString(i[1])??"unknown",e),!1);return null===n?null:d(t.ArcadeDate.fromParts(i[0].year,i[0].month,i[0].day,0,0,0,0,n))}if(o.isDateOnly(i[0])&&o.isTime(i[1]))return d(t.ArcadeDate.fromParts(i[0].year,i[0].month,i[0].day,i[1].hour,i[1].minute,i[1].second,i[1].millisecond,"unknown"));let n,r=o.toString(i[1]);return""===r?null:(r=o.standardiseDateFormat(r,!0),n="X"===r?l.DateTime.fromSeconds(o.toNumber(i[0])):"x"===r?l.DateTime.fromMillis(o.toNumber(i[0])):l.DateTime.fromFormat(o.toString(i[0]),r,{locale:a.getLocale(),numberingSystem:"latn"}),n.isValid?t.ArcadeDate.dateTimeToArcadeDate(n):null)}if(1===i.length){if(o.isDateOnly(i[0]))return d(t.ArcadeDate.fromParts(i[0].year,i[0].month,i[0].day,0,0,0,0,"unknown"));if(c.isString(i[0])){if(""===i[0].replaceAll(/^\s+|\s+$/g,""))return null;if(!0===/^[0-9][0-9][0-9][0-9]$/.test(i[0]))return o.toDate(i[0]+"-01-01",o.defaultTimeZone(e))}const n=o.toNumber(i[0]);if(!1===isNaN(n)){const r=l.DateTime.fromMillis(n);return r.isValid?t.ArcadeDate.dateTimeAndZoneToArcadeDate(r,o.defaultTimeZone(e)):null}return o.toDate(i[0],o.defaultTimeZone(e))}return 0===i.length?t.ArcadeDate.nowToArcadeDate(o.defaultTimeZone(e)):null})},e.datediff=function(e,r){return n(e,r,(n,u,i)=>{if(o.pcCheck(i,2,4,e,r),o.isTime(i[0]))return o.isTime(i[1])?i[0].difference(i[1],o.toString(i[2])):NaN;if(o.isTime(i[1]))return NaN;if(o.isDateOnly(i[0]))return o.isDateOnly(i[1])?i[0].difference(i[1],o.toString(i[2])):NaN;if(o.isDateOnly(i[1]))return NaN;let a=o.toDate(i[0],o.defaultTimeZone(e)),l=o.toDate(i[1],o.defaultTimeZone(e));if(null===a||null===l)return NaN;let c=o.defaultUndefined(i[3],"");return""!==c&&null!==c?(c=f(o.toString(c),e),a=t.ArcadeDate.arcadeDateAndZoneToArcadeDate(a,c),l=t.ArcadeDate.arcadeDateAndZoneToArcadeDate(l,c)):a.timeZone!==l.timeZone&&(a.isUnknownTimeZone?a=t.ArcadeDate.arcadeDateAndZoneToArcadeDate(a,l.timeZone):(l.isUnknownTimeZone,l=t.ArcadeDate.arcadeDateAndZoneToArcadeDate(l,a.timeZone))),a.diff(l,T(i[2]))})},e.dateadd=function(e,t){return n(e,t,(n,r,u)=>{o.pcCheck(u,2,3,e,t);let i=o.toNumber(u[1]);if(isNaN(i)||i===1/0||i===-1/0)return o.isTime(u[0])||o.isDateOnly(u[0])?u[0].clone():o.toDate(u[0],o.defaultTimeZone(e));const a=T(u[2]);if("days"!==a&&"months"!==a||(i=o.isDateOnly(u[0])?i:o.absRound(i)),o.isTime(u[0]))return u[0].plus(a,i);if(o.isDateOnly(u[0]))return u[0].plus(a,i);const l=o.toDate(u[0],o.defaultTimeZone(e));return null===l?null:l.plus({[a]:i})})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});