// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../Dictionary","../executionError","../kernel","../../chunks/languageUtils","../geometry/functions","../geometry/unitConversion","../../core/arrayUtils","../../geometry/Extent","../../geometry/Geometry","../../geometry/Multipoint","../../geometry/Point","../../geometry/Polygon","../../geometry/Polyline","../../geometry/support/jsonUtils","../geometry/extendedUnitData","../../support/guards"],function(e,t,r,n,o,a,i,u,c,l,s,f,m,d,h,y,p,w){"use strict";let x;t.loadOperators=async function(){null==x&&(x=await new Promise((t,r)=>e(["../geometry/operators"],t,r)),await x.loadAll())},t.registerFunctions=function(e,t){e.disjoint=function(e,r){return t(e,r,(t,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,r),null===o[0]||null===o[1]||x.disjoint.execute(o[0],o[1])))},e.intersects=function(e,r){return t(e,r,(t,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,r),null!==o[0]&&null!==o[1]&&x.intersects.execute(o[0],o[1])))},e.touches=function(e,r){return t(e,r,(t,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,r),null!==o[0]&&null!==o[1]&&x.touches.execute(o[0],o[1])))},e.crosses=function(e,r){return t(e,r,(t,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,r),null!==o[0]&&null!==o[1]&&x.crosses.execute(o[0],o[1])))},e.within=function(e,r){return t(e,r,(t,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,r),null!==o[0]&&null!==o[1]&&x.within.execute(o[0],o[1])))},e.contains=function(e,r){return t(e,r,(t,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,r),null!==o[0]&&null!==o[1]&&x.contains.execute(o[0],o[1])))},e.overlaps=function(e,r){return t(e,r,(t,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,r),null!==o[0]&&null!==o[1]&&x.overlaps.execute(o[0],o[1])))},e.equals=function(e,r){return t(e,r,(t,n,o)=>(a.pcCheck(o,2,2,e,r),o[0]===o[1]||(o[0]instanceof s&&o[1]instanceof s?x.equals.execute(o[0],o[1]):(a.isDate(o[0])&&a.isDate(o[1])||a.isTime(o[0])&&a.isTime(o[1])||!(!a.isDateOnly(o[0])||!a.isDateOnly(o[1])))&&o[0].equals(o[1]))))},e.relate=function(e,r){return t(e,r,(t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,3,3,e,r),i[0]instanceof s&&i[1]instanceof s)return x.relate.execute(i[0],i[1],a.toString(i[2]));if(i[0]instanceof s&&null===i[1])return!1;if(i[1]instanceof s&&null===i[0])return!1;if(null===i[0]&&null===i[1])return!1;throw new n.ArcadeExecutionError(e,"InvalidParameter",r)})},e.intersection=function(e,r){return t(e,r,(t,n,o)=>(o=a.autoCastFeatureToGeometry(o),i.commonRelationsCheck(o,e,r),null===o[0]||null===o[1]?null:x.intersection.execute(o[0],o[1])))},e.union=function(e,r){return t(e,r,(t,i,u)=>{if(0===(u=a.autoCastFeatureToGeometry(u)).length)throw new n.ArcadeExecutionError(e,"WrongNumberOfParameters",r);const c=[];if(1===u.length)if(w.isArray(u[0])){for(const t of a.autoCastFeatureToGeometry(u[0]))if(null!==t){if(!(t instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);c.push(t)}}else{if(!a.isImmutableArray(u[0])){if(u[0]instanceof s)return a.fixSpatialReference(o.cloneGeometry(u[0]),e.spatialReference);if(null===u[0])return null;throw new n.ArcadeExecutionError(e,"InvalidParameter",r)}for(const t of a.autoCastFeatureToGeometry(u[0].toArray()))if(null!==t){if(!(t instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);c.push(t)}}else for(const t of u)if(null!==t){if(!(t instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);c.push(t)}return 0===c.length?null:x.union.executeMany(c)})},e.difference=function(e,r){return t(e,r,(t,n,u)=>(u=a.autoCastFeatureToGeometry(u),i.commonRelationsCheck(u,e,r),null===u[0]?null:null===u[1]?o.cloneGeometry(u[0]):x.difference.execute(u[0],u[1])))},e.symmetricdifference=function(e,r){return t(e,r,(t,n,u)=>(u=a.autoCastFeatureToGeometry(u),i.commonRelationsCheck(u,e,r),null===u[0]&&null===u[1]?null:null===u[0]?o.cloneGeometry(u[1]):null===u[1]?o.cloneGeometry(u[0]):x.symmetricDifference.execute(u[0],u[1])))},e.clip=function(e,r){return t(e,r,(t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,2,e,r),!(i[1]instanceof l)&&null!==i[1])throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return null===i[1]?null:x.clip.execute(i[0],i[1])})},e.cut=function(e,r){return t(e,r,(t,i,u)=>{if(u=a.autoCastFeatureToGeometry(u),a.pcCheck(u,2,2,e,r),!(u[1]instanceof h)&&null!==u[1])throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(null===u[0])return[];if(!(u[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return null===u[1]?[o.cloneGeometry(u[0])]:x.cut.execute(u[0],u[1])})},e.area=function(e,r){return t(e,r,(t,o,i)=>{a.pcCheck(i,1,2,e,r);let c=(i=a.autoCastFeatureToGeometry(i))[0];if((w.isArray(i[0])||a.isImmutableArray(i[0]))&&(c=a.autoCastArrayOfPointsToPolygon(i[0],e.spatialReference)),null===c)return 0;if(!(c instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return u.convertFromSpatialReferenceUnit(c.spatialReference,u.toAreaUnit(i[1]),x.area.execute(c))})},e.areageodetic=function(e,r){return t(e,r,(t,o,c)=>{a.pcCheck(c,1,3,e,r);let l=(c=a.autoCastFeatureToGeometry(c))[0];(w.isArray(l)||a.isImmutableArray(l))&&(l=a.autoCastArrayOfPointsToPolygon(l,e.spatialReference));const s=u.toAreaUnit(c[1]),f=i.toCurveType(c[2]);if(null==l)return 0;if(!a.isGeometry(l))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return u.convert(p.squareMeters,s,x.geodeticArea.execute(l,{curveType:f}))})},e.length=function(e,r){return t(e,r,(t,o,i)=>{a.pcCheck(i,1,2,e,r);let c=(i=a.autoCastFeatureToGeometry(i))[0];if((w.isArray(i[0])||a.isImmutableArray(i[0]))&&(c=a.autoCastArrayOfPointsToPolyline(i[0],e.spatialReference)),null===c)return 0;if(!(c instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return u.convertFromSpatialReferenceUnit(c.spatialReference,u.toLengthUnit(i[1]),x.length.execute(c))})},e.length3d=function(e,r){return t(e,r,(t,o,c)=>{a.pcCheck(c,1,2,e,r);let l=(c=a.autoCastFeatureToGeometry(c))[0];if((w.isArray(c[0])||a.isImmutableArray(c[0]))&&(l=a.autoCastArrayOfPointsToPolyline(c[0],e.spatialReference)),null===l)return 0;if(!(l instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return!0===l.hasZ?u.convertFromSpatialReferenceUnit(l.spatialReference,u.toLengthUnit(c[1]),i.planarLength3D(l)):u.convertFromSpatialReferenceUnit(l.spatialReference,u.toLengthUnit(c[1]),x.length.execute(l))})},e.lengthgeodetic=function(e,r){return t(e,r,(t,o,c)=>{a.pcCheck(c,1,3,e,r);let l=(c=a.autoCastFeatureToGeometry(c))[0];(w.isArray(c[0])||a.isImmutableArray(c[0]))&&(l=a.autoCastArrayOfPointsToPolyline(c[0],e.spatialReference));const s=i.toCurveType(c[2]);if(null==l)return 0;if(null!=l&&!a.isGeometry(l))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const f=u.toLengthUnit(c[1]);return u.convert(p.meters,f,x.geodeticLength.execute(l,{curveType:s}))})},e.distance=function(e,r){return t(e,r,(t,o,i)=>{i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,r);let c=i[0];if((w.isArray(i[0])||a.isImmutableArray(i[0]))&&(c=a.autoCastArrayOfPointsToMultiPoint(i[0],e.spatialReference)),!(c instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);let l=i[1];if((w.isArray(i[1])||a.isImmutableArray(i[1]))&&(l=a.autoCastArrayOfPointsToMultiPoint(i[1],e.spatialReference)),!(l instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return u.convertFromSpatialReferenceUnit(c.spatialReference,u.toLengthUnit(i[2]),x.distance.execute(c,l))})},e.distancegeodetic=function(e,r){return t(e,r,(t,o,c)=>{c=a.autoCastFeatureToGeometry(c),a.pcCheck(c,2,4,e,r);const l=c[0];if(!(l instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const s=c[1];if(!(s instanceof m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const f=u.toLengthUnit(c[2]),d=i.toCurveType(c[3]),y=new h({paths:[],spatialReference:l.spatialReference});return y.addPath([l,s]),u.convert(p.meters,f,x.geodeticLength.execute(y,{curveType:d}))})},e.densify=function(e,r){return t(e,r,(t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,r),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const c=a.toNumber(i[1]);if(isNaN(c))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(c<=0)throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const l=u.convertToSpatialReferenceUnit(u.toLengthUnit(i[2]),i[0].spatialReference,c);switch(i[0].type){case"polygon":case"polyline":case"extent":return x.densify.execute(i[0],l);default:return i[0]}})},e.densifygeodetic=function(e,r){return t(e,r,(t,o,c)=>{c=a.autoCastFeatureToGeometry(c),a.pcCheck(c,2,4,e,r);const l=c[0];if(null==l)return null;if(!a.isGeometry(l))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const s=a.toNumber(c[1]);if(isNaN(s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(s<=0)throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const f=u.toLengthUnit(c[2]),m=i.toCurveType(c[3]),d=u.convert(f,p.meters,s);switch(l.type){case"polygon":case"polyline":case"extent":return x.geodeticDensify.execute(l,d,{curveType:m});default:return l}})},e.generalize=function(e,r){return t(e,r,(t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,4,e,r),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const c=a.toNumber(i[1]);if(isNaN(c))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const l=u.convertToSpatialReferenceUnit(u.toLengthUnit(i[3]),i[0].spatialReference,c);return x.generalize.execute(i[0],l,{removeDegenerateParts:a.toBoolean(a.defaultUndefined(i[2],!0))})})},e.buffer=function(e,r){return t(e,r,(t,i,c)=>{if(c=a.autoCastFeatureToGeometry(c),a.pcCheck(c,2,3,e,r),null===c[0])return null;if(!(c[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const l=a.toNumber(c[1]);if(isNaN(l))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return 0===l?o.cloneGeometry(c[0]):x.buffer.execute(c[0],u.convertToSpatialReferenceUnit(u.toLengthUnit(c[2]),c[0].spatialReference,l))})},e.buffergeodetic=function(e,r){return t(e,r,(t,c,l)=>{l=a.autoCastFeatureToGeometry(l),a.pcCheck(l,2,4,e,r);const s=l[0];if(null==s)return null;if(!a.isGeometry(s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const f=a.toNumber(l[1]);if(isNaN(f))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(0===f)return o.cloneGeometry(s);const m=u.toLengthUnit(l[2]),d=i.toCurveType(l[3]);return x.geodesicBuffer.execute(s,u.convert(m,p.meters,f),{curveType:d})})},e.offset=function(e,r){return t(e,r,(t,o,c)=>{if(c=a.autoCastFeatureToGeometry(c),a.pcCheck(c,2,6,e,r),null===c[0])return null;if(!(c[0]instanceof d||c[0]instanceof h))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const l=a.toNumber(c[1]);if(isNaN(l))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const s=u.convertToSpatialReferenceUnit(u.toLengthUnit(c[2]),c[0].spatialReference,l),f=i.toOffsetJoinType(c[3]),m=a.toNumber(a.defaultUndefined(c[4],10));if(isNaN(m))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const y=a.toNumber(a.defaultUndefined(c[5],0));if(isNaN(y))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return x.offset.execute(c[0],s,{joins:f,miterLimit:m,flattenError:y})})},e.rotate=function(e,r){return t(e,r,(t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,2,3,e,r),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const u=i[0]instanceof l?d.fromExtent(i[0]):i[0],c=a.toNumber(i[1]);if(isNaN(c))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);const f=a.defaultUndefined(i[2],null);if(null===f){const e="point"===u.type?u:u.extent?.center;return x.rotate(u,c,e?.x,e?.y)}if(f instanceof m)return x.rotate(u,c,f.x,f.y);throw new n.ArcadeExecutionError(e,"InvalidParameter",r)})},e.centroid=function(e,r){return t(e,r,(e,t,r)=>{if(r=a.autoCastFeatureToGeometry(r),a.pcCheck(r,1,2,e,t),null===r[0])return null;const o=i.toCentroidAlgorithm(r[1]);let u=r[0];if((w.isArray(r[0])||a.isImmutableArray(r[0]))&&(u="geometric"===o?a.autoCastArrayOfPointsToMultiPoint(r[0],e.spatialReference):a.autoCastArrayOfPointsToPolygon(r[0],e.spatialReference),null===u))return null;if(!(u instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",t);return"geometric"===o?x.centroid.execute(u):x.labelPoint.execute(u)})},e.measuretocoordinate=function(e,r){return t(e,r,i.measureToCoordinateFunc)},e.pointtocoordinate=function(e,r){return t(e,r,i.pointToCoordinateFunc)},e.distancetocoordinate=function(e,r){return t(e,r,i.distanceToCoordinateFunc)},e.multiparttosinglepart=function(e,r){return t(e,r,(t,i,u)=>{if(u=a.autoCastFeatureToGeometry(u),a.pcCheck(u,1,1,e,r),null===u[0])return null;if(!(u[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);if(u[0]instanceof m)return[a.fixSpatialReference(o.cloneGeometry(u[0]),e.spatialReference)];if(u[0]instanceof l)return[a.fixSpatialReference(o.cloneGeometry(u[0]),e.spatialReference)];const c=x.simplify.execute(u[0]);if(c instanceof d){const e=[],t=[];for(let r=0;r<c.rings.length;r++)if(c.isClockwise(c.rings[r])){const t=y.fromJSON({rings:[c.rings[r]],hasZ:!0===c.hasZ,hasM:!0===c.hasM,spatialReference:c.spatialReference.toJSON()});e.push(t)}else t.push({ring:c.rings[r],pt:c.getPoint(r,0)});for(let r=0;r<t.length;r++)for(let n=0;n<e.length;n++)if(e[n].contains(t[r].pt)){e[n].addRing(t[r].ring);break}return e}if(c instanceof h){const e=[];for(let t=0;t<c.paths.length;t++){const r=y.fromJSON({paths:[c.paths[t]],hasZ:!0===c.hasZ,hasM:!0===c.hasM,spatialReference:c.spatialReference.toJSON()});e.push(r)}return e}if(u[0]instanceof f){const t=[],r=a.fixSpatialReference(o.cloneGeometry(u[0]),e.spatialReference);for(let e=0;e<r.points.length;e++)t.push(r.getPoint(e));return t}return null})},e.isselfintersecting=function(e,r){return t(e,r,(e,t,r)=>{a.pcCheck(r,1,1,e,t);let n=(r=a.autoCastFeatureToGeometry(r))[0];if((w.isArray(r[0])||a.isImmutableArray(r[0]))&&(n=a.autoCastArrayOfPointsToPolyline(r[0],e.spatialReference)),n instanceof f){const e=n.points;for(let t=0;t<e.length;t++)for(let r=t+1;r<e.length;r++)if(c.equals(e[t],e[r]))return!0;return!1}return(n instanceof h||n instanceof d)&&x.isSelfIntersecting(n)})},e.issimple=function(e,r){return t(e,r,(t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,1,1,e,r),null===i[0])return!0;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return x.simplify.isSimple(i[0])})},e.simplify=function(e,r){return t(e,r,(t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,1,1,e,r),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return x.simplify.execute(i[0])})},e.convexhull=function(e,r){return t(e,r,(t,o,i)=>{if(i=a.autoCastFeatureToGeometry(i),a.pcCheck(i,1,1,e,r),null===i[0])return null;if(!(i[0]instanceof s))throw new n.ArcadeExecutionError(e,"InvalidParameter",r);return x.convexHull.execute(i[0])})},e.nearestcoordinate=function(e,o){return t(e,o,(t,i,u)=>{if(u=a.autoCastFeatureToGeometry(u),a.pcCheck(u,2,2,e,o),!(u[0]instanceof s||null===u[0]))throw new n.ArcadeExecutionError(e,"InvalidParameter",o);if(!(u[1]instanceof m||null===u[1]))throw new n.ArcadeExecutionError(e,"InvalidParameter",o);if(null===u[0]||null===u[1])return null;const c=u[0]instanceof l?d.fromExtent(u[0]):u[0],f=x.proximity.getNearestCoordinate(c,u[1],{calculateLeftRightSide:!0});return null===f||f.isEmpty?null:r.convertObjectToArcadeDictionary({coordinate:f.coordinate,distance:f.distance,sideOfLine:0===f.distance?"straddle":f.isRightSide?"right":"left"},a.defaultTimeZone(e),!1,!0)})},e.nearestvertex=function(e,o){return t(e,o,(t,i,u)=>{if(u=a.autoCastFeatureToGeometry(u),a.pcCheck(u,2,2,e,o),!(u[0]instanceof s||null===u[0]))throw new n.ArcadeExecutionError(e,"InvalidParameter",o);if(!(u[1]instanceof m||null===u[1]))throw new n.ArcadeExecutionError(e,"InvalidParameter",o);if(null===u[0]||null===u[1])return null;const c=u[0]instanceof l?d.fromExtent(u[0]):u[0],f=x.proximity.getNearestVertex(c,u[1]);return null===f||f.isEmpty?null:r.convertObjectToArcadeDictionary({coordinate:f.coordinate,distance:f.distance,sideOfLine:0===f.distance?"straddle":f.isRightSide?"right":"left"},a.defaultTimeZone(e),!1,!0)})}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});