// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../Dictionary","../enum","../executionError","../../chunks/languageUtils","../../core/maybe","../../support/guards"],function(e,r,n,t,o,i,s){"use strict";const c=e=>(r,n,t=14)=>+e(r,n).toFixed(t),a=(e,r)=>e+r,u=(e,r)=>e-r,l=(e,r)=>e*r,d=(e,r)=>e/r,h=(e,r,n)=>c(a)(e,r,n),g=(e,r,n)=>c(l)(e,r,n),m=(e,r,n)=>c(d)(e,r,n),f=2*Math.PI,E=3600,A=60,w=648e3/Math.PI,D=1296e3,p=324e3,S=648e3,T=String.fromCharCode(7501);function x(e){if(!1===s.isString(e))throw new t.ArcadeExecutionError(null,"InvalidParameter",null);return e}function _(e,r){const n=10**r;return Math.round(e*n)/n}function R(e){const r=parseFloat(e.toString().replace(Math.trunc(e).toString(),"0"))*Math.sign(e);return e<0?{fraction:r,integer:Math.ceil(e)}:{fraction:r,integer:Math.floor(e)}}function F(e,r){switch(e){case 0:return"SHORT"===r?"N":"North";case 1:return"SHORT"===r?"E":"East";case 2:return"SHORT"===r?"S":"South";case 3:return"SHORT"===r?"W":"West"}}function M(e,r){return e-Math.floor(e/r)*r}function v(e){switch(e){case 6:case 1:return 360;case 4:return f;case 5:return 400;case 2:return D;case 7:return 60;case 8:return A;default:throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"unsupported evaluations"})}}const L=new n.StringEnum([],[["NORTH",1],["NORTH AZIMUTH",1],["POLAR",2],["QUADRANT",3],["SOUTH",4],["SOUTH AZIMUTH",4]]);function b(e){const r=L.lookup(e);if(null==r)throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"unsupported directionType"});return r}const N=new n.StringEnum([],[["D",1],["DD",1],["DECIMAL DEGREE",1],["DEGREE",1],["DECIMAL DEGREES",1],["DEGREES",1],["DMS",3],["DEGREES MINUTES SECONDS",3],["R",4],["RAD",4],["RADS",4],["RADIAN",4],["RADIANS",4],["G",5],["GON",5],["GONS",5],["GRAD",5],["GRADS",5],["GRADIAN",5],["GRADIANS",5]]);function U(e){const r=N.lookup(e);if(null==r)throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"unsupported units"});return r}class y{constructor(e,r,n){this.m_degrees=e,this.m_minutes=r,this.m_seconds=n}getField(e){switch(e){case 1:case 6:return this.m_degrees;case 7:return this.m_minutes;case 2:case 8:return this.m_seconds;default:throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"unexpected evaluation"})}}static secondsToDMS(e){const r=R(e).fraction;let n=R(e).integer;const t=Math.floor(n/E);n-=t*E;const o=Math.floor(n/A);return n-=o*A,new y(t,o,n+r)}static numberToDms(e){const r=R(e).fraction,n=R(e).integer,t=g(R(100*r).fraction,100),o=R(100*r).integer;return new y(n,o,t)}format(e,r){let n=_(this.m_seconds,r),t=this.m_minutes,o=this.m_degrees;if(2===e||8===e)A<=n&&(n-=A,++t),60<=t&&(t=0,++o),360<=o&&(o=0);else if(7===e)n=0,t=30<=this.m_seconds?this.m_minutes+1:this.m_minutes,o=this.m_degrees,60<=t&&(t=0,++o),360<=o&&(o=0);else if(1===e||6===e){const e=m(this.m_seconds,E),r=m(this.m_minutes,60);o=Math.round(this.m_degrees+r+e),t=0,n=0}return new y(o,t,n)}static dmsToSeconds(e,r,n){return e*E+r*A+n}}class O{constructor(e,r,n){this.meridian=e,this.angle=r,this.direction=n}fetchAzimuth(e){return 0===e?this.meridian:this.direction}}class G{constructor(e){this._angle=e}static createFromAngleAndDirection(e,r){return new G(new H(G._convertDirectionFormat(e.extractAngularUnits(2),r,1)))}getAngle(e){const r=this._angle.extractAngularUnits(2);switch(e){case 1:case 4:case 2:return new H(G._convertDirectionFormat(r,1,e));case 3:{const e=G.secondsNorthAzimuthToQuadrant(r);return new H(e.angle)}}}getMeridian(e){const r=this._angle.extractAngularUnits(2);switch(e){case 1:return 0;case 4:return 2;case 2:return 1;case 3:return G.secondsNorthAzimuthToQuadrant(r).meridian}}getDirection(e){const r=this._angle.extractAngularUnits(2);switch(e){case 1:return 1;case 4:return 3;case 2:return 0;case 3:return G.secondsNorthAzimuthToQuadrant(r).direction}}static secondsNorthAzimuthToQuadrant(e){const r=e<=p||e>=972e3?0:2,n=0===r?Math.min(D-e,e):Math.abs(e-S);return new O(r,n,e>S?3:1)}static createFromAngleMeridianAndDirection(e,r,n){return new G(new H(G.secondsQuadrantToNorthAzimuth(e.extractAngularUnits(2),r,n)))}static secondsQuadrantToNorthAzimuth(e,r,n){return 0===r?1===n?e:D-e:1===n?S-e:S+e}static _convertDirectionFormat(e,r,n){let o=0;switch(r){case 1:o=e;break;case 2:o=p-e;break;case 3:throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"unexpected evaluation"});case 4:o=e+S}let i=0;switch(n){case 1:i=o;break;case 2:i=p-o;break;case 3:throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"unexpected evaluation"});case 4:i=o-S}return i%=D,i<0?D+i:i}}function I(e,r,n){let o=null;switch(r){case 1:o=g(e,E);break;case 2:o=e;break;case 5:o=g(e,3240);break;case 4:o=g(e,w);break;default:throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"unexpected evaluation"})}switch(n){case 1:return m(o,E);case 2:return o;case 5:return m(o,3240);case 4:return o/w;default:throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"unexpected evaluation"})}}class H{constructor(e){this._seconds=e}static createFromAngleAndUnits(e,r){return new H(I(e,r,2))}extractAngularUnits(e){return I(this._seconds,2,k(e))}static createFromDegreesMinutesSeconds(e,r,n){return new H(h(h(g(e,E),g(r,A)),n))}}function k(e){switch(i.assertIsSome(e),e){case 1:case 6:case 3:return 1;case 5:return 5;case 7:return 7;case 4:return 4;case 2:case 8:return 2}}class P{constructor(e,r,n,t){this.view=e,this.angle=r,this.merdian=n,this.direction=t,this._dms=null,this._formattedDms=null}static createFromStringAndBearing(e,r,n){return new P(e,r.getAngle(n),r.getMeridian(n),r.getDirection(n))}fetchAngle(){return this.angle}fetchMeridian(){return this.merdian}fetchDirection(){return this.direction}fetchView(){return this.view}fetchDms(){return null===this._dms&&this._calculateDms(),this._dms}fetchFormattedDms(){return null===this._formattedDms&&this._calculateDms(),this._formattedDms}_calculateDms(){let e=null,r=6,n=0;for(let t=0;t<this.view.length;t++){const o=this.view[t];switch(o){case"m":e=B(this.view,t,o),r=6===r?7:r,t=e.newpos;continue;case"s":e=B(this.view,t,o),r=8,n=n<e.rounding?e.rounding:n,t=e.newpos;continue;default:continue}}this._dms=y.secondsToDMS(this.angle.extractAngularUnits(2)),this._formattedDms=y.secondsToDMS(this.angle.extractAngularUnits(2)).format(r,n)}}function z(e,r,n,o,i){let s=null;switch(r){case 1:case 4:case 5:return s=M(_(e.extractAngularUnits(r),o),v(r)),s.toFixed(o).padStart(n+o+(o>0?1:0),"0");case 6:case 7:return s=M(i.fetchFormattedDms().getField(r),v(r)),s.toFixed(o).padStart(n+o+(o>0?1:0),"0");case 8:return s=M(_(i.fetchDms().getField(r),o),v(r)),s.toFixed(o).padStart(n+o+(o>0?1:0),"0");default:throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"unexpected evaluation"})}}function Q(e){switch(e.toUpperCase().trim()){case"N":case"NORTH":return 0;case"E":case"EAST":return 1;case"S":case"SOUTH":return 2;case"W":case"WEST":return 3}return null}function C(e){const r=parseFloat(e);if(s.isNumber(r)){if(isNaN(r))throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"invalid conversion"});return r}throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"invalid conversion"})}function W(e,r,n){const i=3===n;let s=null,c=null,a=0,u=0,l=0;if(i){if(e.length<2)throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"conversion error"});l=1;const r=function(e){switch(o.toNumber(e)){case 1:return{first:0,second:1};case 2:return{first:2,second:1};case 3:return{first:2,second:3};case 4:return{first:0,second:3}}return null}(o.toString(e[e.length-1]));if(r?(s=r.first,c=r.second):(a=1,s=Q(o.toString(e[0])),c=Q(o.toString(e[e.length-1]))),null===s||null===c)throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"invalid conversion"})}switch(r){case 1:case 4:case 5:if(0===e.length)throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"invalid conversion"});return i?G.createFromAngleMeridianAndDirection(H.createFromAngleAndUnits(C(e[a]),k(r)),s,c):G.createFromAngleAndDirection(H.createFromAngleAndUnits(C(e[a]),k(r)),n);case 3:if(u=e.length-l-a,3===u){const r=H.createFromDegreesMinutesSeconds(C(e[a]),C(e[a+1]),C(e[a+2]));return i?G.createFromAngleMeridianAndDirection(r,s,c):G.createFromAngleAndDirection(r,n)}if(1===u){const r=C(e[a]),t=y.numberToDms(r),o=H.createFromDegreesMinutesSeconds(t.m_degrees,t.m_minutes,t.m_seconds);return i?G.createFromAngleMeridianAndDirection(o,s,c):G.createFromAngleAndDirection(o,n)}}throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"invalid conversion"})}function B(e,r,n){const t={padding:0,rounding:0,newpos:r};let o=!1;for(;r<e.length;){const i=e[r];if(i===n)o?t.rounding++:t.padding++,r++;else{if("."!==i)break;o=!0,r++}}return t.newpos=r-1,t}function V(e,r,n){const t={escaped:"",newpos:r};for(r++;r<e.length;){const n=e[r];if(r++,"]"===n)break;t.escaped+=n}return t.newpos=r-1,t}const X=new n.StringEnum(["TEXT","VALUE"]);e.convertDirection=function(e,n,i){if(!(n instanceof r))throw new t.ArcadeExecutionError(null,"InvalidParameter",null);if(!1===n.hasField("directionType"))throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"missing directionType"});if(!1===n.hasField("angleType"))throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"missing angleType"});const c=b(x(n.field("directiontype"))),a=function(e,r,n){if(s.isNumber(e))return function(e,r,n){if(3===n)throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"conversion error"});if(3===r){const r=y.numberToDms(e);return G.createFromAngleAndDirection(H.createFromDegreesMinutesSeconds(r.m_degrees,r.m_minutes,r.m_seconds),n)}return G.createFromAngleAndDirection(H.createFromAngleAndUnits(e,k(r)),n)}(o.toNumber(e),r,n);if(s.isString(e))return W(function(e){const r=new Set([" ","-","/","'",'"',"\\","^","°",T,"\t","\r","\n","*"]);let n="";for(let t=0;t<e.length;t++){const o=e.charAt(t);r.has(o)?n+="RRSPLITRRSPLITRR":n+=o}return n.split("RRSPLITRRSPLITRR").filter(e=>""!==e)}(e),r,n);if(s.isArray(e))return W(e,r,n);if(o.isImmutableArray(e))return W(e.toArray(),r,n);throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"conversion error"})}(e,U(x(n.field("angletype"))),c);if(!(i instanceof r))throw new t.ArcadeExecutionError(null,"InvalidParameter",null);if(!1===i.hasField("directionType"))throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"missing directionType"});if(!1===i.hasField("outputType"))throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"missing angleType"});const u=b(x(i.field("directiontype"))),l=i.hasField("angleType")?U(x(i.field("angletype"))):null,d=X.get(x(i.field("outputType")));if(!u||!d)throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"conversion error"});if(!(l||"TEXT"===d&&i.hasField("format")))throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"invalid unit"});switch(d){case"VALUE":return 3===u||3===l?function(e,r,n){const t=e.getAngle(r);if(3===r&&3===n){const n=y.secondsToDMS(t.extractAngularUnits(2));return[F(e.getMeridian(r),"SHORT"),n.m_degrees,n.m_minutes,n.m_seconds,F(e.getDirection(r),"SHORT")]}if(3===n){const e=y.secondsToDMS(t.extractAngularUnits(2));return[e.m_degrees,e.m_minutes,e.m_seconds]}return 3===r?[F(e.getMeridian(r),"SHORT"),t.extractAngularUnits(n),F(e.getDirection(r),"SHORT")]:[t.extractAngularUnits(n)]}(a,u,l):function(e,r,n){const o=k(n);if(o&&3!==n)return e.getAngle(r).extractAngularUnits(o);throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"conversion error"})}(a,u,l);case"TEXT":{let e="";return i.hasField("format")&&(e=o.toString(i.field("format"))),null!==e&&""!==e||(e=function(e,r){let n="";switch(e){case 1:n=3===r?"DD.DD°":"DDD.DD°";break;case 3:n=3===r?"dd° mm' ss\"":"ddd° mm' ss.ss\"";break;case 4:n="R.RR";break;case 5:n="GGG.GG"+T;break;default:throw new t.ArcadeExecutionError(null,"LogicError",null,{reason:"conversion error"})}return 3===r&&(n="p "+n+" b"),n}(l,u)),function(e,r,n){let t="",o=null,i=null;const s=P.createFromStringAndBearing(r,e,n),c={D:1,d:6,m:7,s:8,R:4,G:5};for(let a=0;a<r.length;a++){const u=r[a];switch(u){case"[":o=V(r,a),t+=o.escaped,a=o.newpos;continue;case"D":case"d":case"m":case"s":case"R":case"G":o=B(r,a,u),i=e.getAngle(n),t+=z(i,c[u],o.padding,o.rounding,s),a=o.newpos;continue;case"P":case"p":t+=F(s.fetchMeridian(),"p"===u?"SHORT":"LONG");continue;case"B":case"b":t+=F(s.fetchDirection(),"b"===u?"SHORT":"LONG");continue;default:t+=u}}return t}(a,e,u)}default:throw new t.ArcadeExecutionError(null,"InvalidParameter",null)}},e.preciseAdd=h,e.preciseDivide=m,e.preciseMinus=(e,r,n)=>c(u)(e,r,n),e.preciseMultiply=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});