// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../ArcadeDate","../executionError","../../chunks/languageUtils","./fieldStats","../../core/sql/SqlTimestampOffset","../../core/sql/WhereClause","../../support/guards"],function(t,e,n,a,r,i,u,c){"use strict";async function s(t,e,n,i){if(1===n.length){if(c.isArray(n[0]))return r.calculateStat(t,n[0],a.defaultUndefined(n[1],-1));if(a.isImmutableArray(n[0]))return r.calculateStat(t,n[0].toArray(),a.defaultUndefined(n[1],-1))}else if(2===n.length){if(c.isArray(n[0]))return r.calculateStat(t,n[0],a.defaultUndefined(n[1],-1));if(a.isImmutableArray(n[0]))return r.calculateStat(t,n[0].toArray(),a.defaultUndefined(n[1],-1));if(a.isFeatureSet(n[0])){const r=await n[0].load(),c=await d(u.create(n[1],{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}),i,e);return o(e,await n[0].calculateStatistic(t,c,a.defaultUndefined(n[2],1e3),e.abortSignal))}}else if(3===n.length&&a.isFeatureSet(n[0])){const r=await n[0].load(),c=await d(u.create(n[1],{fieldsIndex:r.getFieldsIndex(),timeZone:r.dateFieldsTimeZoneDefaultUTC}),i,e);return o(e,await n[0].calculateStatistic(t,c,a.defaultUndefined(n[2],1e3),e.abortSignal))}return r.calculateStat(t,n,-1)}function o(t,n){return n instanceof i.SqlTimeStampOffset?e.ArcadeDate.fromReaderAsTimeStampOffset(n.toStorageFormat()):n instanceof Date?e.ArcadeDate.dateJSAndZoneToArcadeDate(n,a.defaultTimeZone(t)):n}async function d(t,e,n){const a=t.getVariables();if(a.length>0){const r={};for(const t of a)r[t]=e.evaluateIdentifier(n,{name:t});t.parameters=r}return t}t.registerFunctions=function(t){"async"===t.mode&&(t.functions.stdev=function(e,n){return t.standardFunctionAsync(e,n,(n,a,r)=>s("stdev",e,r,t))},t.functions.variance=function(e,n){return t.standardFunctionAsync(e,n,(n,a,r)=>s("variance",e,r,t))},t.functions.average=function(e,n){return t.standardFunctionAsync(e,n,(n,a,r)=>s("mean",e,r,t))},t.functions.mean=function(e,n){return t.standardFunctionAsync(e,n,(n,a,r)=>s("mean",e,r,t))},t.functions.sum=function(e,n){return t.standardFunctionAsync(e,n,(n,a,r)=>s("sum",e,r,t))},t.functions.min=function(e,n){return t.standardFunctionAsync(e,n,(n,a,r)=>s("min",e,r,t))},t.functions.max=function(e,n){return t.standardFunctionAsync(e,n,(n,a,r)=>s("max",e,r,t))},t.functions.count=function(e,r){return t.standardFunctionAsync(e,r,async(t,i,u)=>{if(a.pcCheck(u,1,1,e,r),a.isFeatureSet(u[0]))return u[0].count(t.abortSignal);if(c.isArray(u[0])||c.isString(u[0]))return u[0].length;if(a.isImmutableArray(u[0]))return u[0].length();throw new n.ArcadeExecutionError(e,"InvalidParameter",r)})})},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});