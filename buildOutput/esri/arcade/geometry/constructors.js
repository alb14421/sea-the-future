// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../executionError","../../chunks/languageUtils","../../core/accessorSupport/ensureType","../../geometry/Point","../../geometry/support/jsonUtils"],function(r,n,e,t,a,l){"use strict";function u(r,n=!1){const t={};for(const a of r.keys()){const l=n?a.toLowerCase():a,s=r.attributes[a];t[l]=e.isDictionary(s)?u(s):s}return t}const s=Symbol("NoValue");function i(r){return Array.isArray(r)&&r.length>0?r[0]:e.isImmutableArray(r)&&r.length()>0?r.get(0):s}function o(r){return t.ensureNumber(r,0)??0}function c(r){return"number"==typeof r&&!Number.isNaN(r)}const h=null;function f(r){return t.ensureNumber(r,h)??h}function y(r){return"number"==typeof r&&!Number.isNaN(r)||null===r}function m(r){return!(r.length<2||"number"!=typeof r[0]||Number.isNaN(r[0])||"number"!=typeof r[1]||Number.isNaN(r[1]))}function d(r){return m(r)?r.length>2?r.slice(0,2):r:null}function A(r){return m(r)?c(r[2])?r.length>3?r.slice(0,3):r:[r[0],r[1],o(r[2])]:null}function g(r){return m(r)?r.length>=3&&!y(r[2])?[r[0],r[1],f(r[2])]:r.length>3?r.slice(0,3):r:null}function p(r){return m(r)?c(r[2])&&y(r[3])?r.length>4?r.slice(0,4):r:[r[0],r[1],o(r[2]),f(r[3])]:null}function b(r){return[r.x,r.y]}function v(r){return[r.x,r.y,r.z??0]}function M(r){return[r.x,r.y,r.m??h]}function Z(r){return[r.x,r.y,r.z??0,r.m??h]}function N(r,n){return r?n?p:A:n?g:d}function w(r,n){return r?n?Z:v:n?M:b}function E(r,n,t){return Array.isArray(r)?t(r):r instanceof a?n(r):e.isImmutableArray(r)?t(r.toArray()):null}function I(r,t,l){return Array.isArray(r)?l(r):e.isDictionary(r)?r.hasField("c")?function(r,t,a){if(e.isImmutableArray(r)&&(r=r.toArray()),!Array.isArray(r)||2!==r.length)throw new n.ArcadeExecutionError(null,"InvalidParameter",null);const l=E(r[0],t,a);if(null==l)return null;const u=E(r[1],b,d);return null==u?null:{c:[l,u]}}(r.field("c"),t,l):r.hasField("a")?function(r,t,a){if(e.isImmutableArray(r)&&(r=r.toArray()),!Array.isArray(r)||4!==r.length&&7!==r.length)throw new n.ArcadeExecutionError(null,"InvalidParameter",null);const l=E(r[0],t,a);if(null==l)return null;const u=E(r[1],b,d);if(null==u)return null;const s=r[2];if(0!==s&&1!==s)throw new n.ArcadeExecutionError(null,"InvalidParameter",null);const i=r[3];if(0!==i&&1!==i)throw new n.ArcadeExecutionError(null,"InvalidParameter",null);if(4===r.length)return{a:[l,u,s,i]};const o=r[4];if("number"!=typeof o)throw new n.ArcadeExecutionError(null,"InvalidParameter",null);if(Number.isNaN(o))return null;const c=r[5];if("number"!=typeof c)throw new n.ArcadeExecutionError(null,"InvalidParameter",null);if(Number.isNaN(c))return null;const h=r[6];if("number"!=typeof h)throw new n.ArcadeExecutionError(null,"InvalidParameter",null);return Number.isNaN(h)?null:{a:[l,u,s,i,o,c,h]}}(r.field("a"),t,l):r.hasField("b")?function(r,t,a){if(e.isImmutableArray(r)&&(r=r.toArray()),!Array.isArray(r)||3!==r.length)throw new n.ArcadeExecutionError(null,"InvalidParameter",null);const l=E(r[0],t,a);if(null==l)return null;const u=E(r[1],b,d);if(null==u)return null;const s=E(r[2],b,d);return null==s?null:{b:[l,u,s]}}(r.field("b"),t,l):null:r instanceof a?t(r):e.isImmutableArray(r)?l(r.toArray()):null}function x(r,n,t,a){const l=[];if(Array.isArray(r))for(const e of r){const r=n(e,t,a);null!=r&&l.push(r)}else if(e.isImmutableArray(r))for(let e=0;e<r.length();e++){const u=n(r.get(e),t,a);null!=u&&l.push(u)}return l}function P(r,n,t){return Array.isArray(r)?r.length>=n:e.isImmutableArray(r)?r.length()>=n:r instanceof a&&r[t]}function z(r,n,e){return void 0===r&&void 0===n?{hasZ:P(e,3,"hasZ"),hasM:P(e,4,"hasM")}:void 0===r?!0===n?{hasZ:P(e,4,"hasZ"),hasM:!0}:{hasZ:P(e,3,"hasZ"),hasM:!1}:void 0===n?!0===r?{hasZ:!0,hasM:P(e,4,"hasM")}:{hasZ:!1,hasM:P(e,3,"hasM")}:{hasZ:!0===r,hasM:!0===n}}function S(r,n,t,l){r=function(r){const n=i(i(r));return n===s||Array.isArray(n)||e.isImmutableArray(n)||n instanceof a?r:[r]}(r);const u=i(i(r));if(u===s)return null;const{hasZ:o,hasM:c}=z(n,t,u),h=w(o,c),f=N(o,c),y=[];if(Array.isArray(r))for(let n=0;n<r.length;n++)y.push(x(r[n],l,h,f));else if(e.isImmutableArray(r))for(let n=0;n<r.length();n++)y.push(x(r.get(n),l,h,f));return{arrays:y,hasZ:o,hasM:c}}r.constructGeometryFromDictionary=function(r,e,t=null){const a=u(r,!0);if(void 0!==a.hasm&&(a.hasM=a.hasm,delete a.hasm),void 0!==a.hasz&&(a.hasZ=a.hasz,delete a.hasz),void 0!==a.spatialreference&&(a.spatialReference=a.spatialreference,delete a.spatialreference),a.spatialReference||(a.spatialReference=e),void 0!==a.curverings){const r=S(a.curverings,a.hasZ,a.hasM,I);if(null==r)return null;a.curveRings=r.arrays,delete a.curverings,delete a.rings,a.hasZ=r.hasZ,a.hasM=r.hasM}else if(void 0!==a.rings){const r=S(a.rings,a.hasZ,a.hasM,E);if(null==r)return null;a.rings=r.arrays,a.hasZ=r.hasZ,a.hasM=r.hasM}if(void 0!==a.curvepaths){const r=S(a.curvepaths,a.hasZ,a.hasM,I);if(null==r)return null;a.curvePaths=r.arrays,delete a.curvepaths,delete a.paths,a.hasZ=r.hasZ,a.hasM=r.hasM}else if(void 0!==a.paths){const r=S(a.paths,a.hasZ,a.hasM,E);if(null==r)return null;a.paths=r.arrays,a.hasZ=r.hasZ,a.hasM=r.hasM}if(void 0!==a.points){const r=function(r,n,e){const t=i(r);if(t===s)return null;const{hasZ:a,hasM:l}=z(n,e,t);return{array:x(r,E,w(a,l),N(a,l)),hasZ:a,hasM:l}}(a.points,a.hasZ,a.hasM);if(null==r)return null;a.points=r.array,a.hasZ=r.hasZ,a.hasM=r.hasM}const o=l.fromJSON(a);if(null!=t&&o?.type!==t)throw new n.ArcadeExecutionError(null,"InvalidParameter",null);return o},Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});