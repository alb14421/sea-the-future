// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/chunks/OperatorDefinitions":function(){define(["exports"],function(e){"use strict";e.NonSimpleResult=class{assign(e){this.m_reason=e.m_reason,this.m_vertexIndex1=e.m_vertexIndex1,this.m_vertexIndex2=e.m_vertexIndex2}constructor(e,t,s){void 0!==e?(this.m_reason=e,this.m_vertexIndex1=t,this.m_vertexIndex2=s):(this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-2)}clear(){this.m_reason=0,this.m_vertexIndex1=-1,this.m_vertexIndex2=-1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/operators/affineTransformOperator":function(){define(["exports","../../core/arrayUtils","./gx/operatorAffineTransform","./support/apiConverter"],function(e,t,s,n){"use strict";const i=s.supportsCurves();e.execute=function(e,t){const i=n.getSpatialReference(e);return n.toGeometry(s.execute(n.fromGeometry(e),t.transform),i)},e.executeMany=function(e,i){const r=e.map(n.fromGeometry),o=n.getSpatialReference(e);return s.executeMany(r,i.transform).map(e=>n.toGeometry(e,o)).filter(t.isSome)},e.supportsCurves=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/operators/gx/operatorAffineTransform":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry"],function(e,t,s){"use strict";class n extends t.GeometryCursor{constructor(e,t,s){super(),this.m_index=-1,this.m_transformation=t.clone(),this.m_inputGeometryCursor=e}next(){let e;if(e=this.m_inputGeometryCursor.next()){s.throwIfMesh(e),this.m_index=this.m_inputGeometryCursor.getGeometryID();const t=e.clone();return t.applyTransformation(this.m_transformation),t}return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}const i=new class{getOperatorType(){return 10303}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s){return new n(e,t,s)}execute(e,t,s){const n=e.clone();return n.applyTransformation(t),n}};e.execute=function(e,t){return i.execute(e,t,null)},e.executeMany=function(e,s){const n=i.executeMany(new t.SimpleGeometryCursor(e),s,null);return Array.from(n)},e.supportsCurves=function(){return i.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleGeometryCursor":function(){define(["exports"],function(e){"use strict";class t{*[Symbol.iterator](){let e=this.next();for(;e;)yield e,e=this.next()}}e.GeometryCursor=t,e.OverlayGeometryCursor=class extends t{},e.SimpleGeometryCursor=class extends t{constructor(e){super(),this.m_iGeom=-1,this.m_aGeoms=e?e.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const e=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,e}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}})},"esri/chunks/Geometry":function(){define(["exports"],function(e){"use strict";class t extends Error{constructor(e,t){super(t),this.m_AdditionalMessage=t,this.m_ErrorType=e,this.name="GeometryError"}what(){return function(e){switch(e){case 1:return"Unknown error";case 2:return"Corrupted geometry";case 3:return"Empty geometry";case 4:return"Math singularity";case 5:return"Buffer is too small";case 6:return"Invalid shape type";case 7:return"Projection out of supported range";case 8:return"Non simple geometry";case 9:return"Cannot calculate geodesic";case 10:return"Notation conversion";case 11:return"Missing grid file";case 12:return"Invalid call";case 13:return"Internal error";case 14:return"Not implemented";case 15:return"IO error";case 16:return"Invalid 3D";case 17:return"An ambiguous geography edge with antipodal points";case 18:return"Geocentric coordinates require ellipsoidal height";case 19:return"Geography cannot be projected into a gnomonic plane or a result of an operation cannot fit into a gnomonic plane";case 20:return"Geometry is too large to be exported in to a given format";case 22:return"Operation is canceled by the user";case 21:return"The operation, such as projection or geodetic computation, cannot be performed without pe-wasm loaded";default:return"unknown error"}}(this.m_ErrorType)}additionalMessage(){return this.m_AdditionalMessage?this.m_AdditionalMessage:""}code(){return this.m_ErrorType}}class s extends t{constructor(e){super(2,e),this.name="CorruptedGeometryError"}}class n extends t{constructor(e){super(3,e),this.name="EmptyGeometryError"}}class i extends t{constructor(e){super(4,e),this.name="MathSingularityError"}}class r extends t{constructor(e){super(21,e),this.name="ProjectionEngineNotLoadedError"}}class o extends t{constructor(e){super(8,e),this.name="NonSimpleGeometryError"}}var a;e.GeometryType=void 0,(a=e.GeometryType||(e.GeometryType={}))[a.enumUnknown=0]="enumUnknown",a[a.enumPoint=513]="enumPoint",a[a.enumLine=5122]="enumLine",a[a.enumBezier=5123]="enumBezier",a[a.enumEllipticArc=5124]="enumEllipticArc",a[a.enumEnvelope=3077]="enumEnvelope",a[a.enumMultiPoint=8710]="enumMultiPoint",a[a.enumPolyline=25607]="enumPolyline",a[a.enumPolygon=27656]="enumPolygon",a[a.enumMultipatch=40969]="enumMultipatch",a[a.enumGeometryCollection=3594]="enumGeometryCollection",a[a.enumRationalBezier2=5134]="enumRationalBezier2",a[a.enumBezier2=5135]="enumBezier2",a[a.enumRationalBezier23d=5392]="enumRationalBezier23d",a[a.enumGreatArc3d=5393]="enumGreatArc3d";const m=[0,0,1,1,1,2,0,1,2,3,-1,-1,-1,-1,1,1];function h(e){return!!(4096&e)}function l(e){return!!(8192&e)}function u(e){return!!(16384&e)}function c(e){return!!(32768&e)}function g(t){const s=t.getGeometryType();if(u(s))return t.hasNonLinearSegments();if(s===e.GeometryType.enumGeometryCollection){const e=t;for(let t=0,s=e.getGeometryCount();t<s;t++)if(g(e.getGeometry(t)))return!0;return!1}return!!h(s)&&s!==e.GeometryType.enumLine}function d(e){throw new Error(e)}function p(e){throw new t(14,e)}function _(e){throw new t(13,e)}function f(t){t===e.GeometryType.enumGeometryCollection&&d("Geometry_collection instances are not supported in this operation")}e.checkAndThrow=function(e,t){e||d(t)},e.geometryReleaseAssert=function(e,t){try{if(!e)throw new Error(t)}catch(e){throw e}},e.getDimensionFromType=function(e){return m[15&e]},e.hasNonLinearSegments=g,e.isArea=function(e){return!!(2048&e)},e.isLinear=function(e){return!!(1024&e)},e.isMesh=c,e.isMultiPath=u,e.isMultiVertex=l,e.isPoint=function(e){return!!(512&e)},e.isSegment=h,e.throwCorruptedGeometryException=function(e){throw new s(e)},e.throwEmptyGeometryException=function(e){throw new n(e)},e.throwIfCurves=function(e){e&&g(e)&&p("Operation does not support curves.")},e.throwIfGeometryCollection=function(e){f(e.getGeometryType())},e.throwIfGeometryCollectionType=f,e.throwIfMesh=function(e){e&&c(e.getGeometryType())&&p("Unsupported geometry type.")},e.throwInternalErrorException=_,e.throwInvalidArgumentException=d,e.throwInvalidCallException=function(e){throw new t(12,e)},e.throwInvalidGeometryTypeFor3DOps=function(){d("Geometry type is not supported for 3D operations.")},e.throwInvalidWkidException=function(e){d(`bad wkid: ${e}`)},e.throwInvalidWktException=function(e){let t="bad wkt: ";t+=e,t+="...",d(t)},e.throwLogicErrorException=function(e){throw new Error(e)},e.throwMathSingularityException=function(e){throw new i(e)},e.throwNonSimpleGeometryException=function(e){throw new o(e)},e.throwNotImplementedException=p,e.throwOutOfRangeException=function(e){throw new Error(e)},e.throwProjectionEngineNotLoadedException=function(e){throw new r(e)},e.vertexCount=function(t){const s=t.getGeometryType();return l(s)?t.getPointCount():t.isEmpty()?0:s===e.GeometryType.enumEnvelope?4:s===e.GeometryType.enumPoint?1:h(s)?2:void _("missing type")}})},"esri/geometry/operators/support/apiConverter":function(){define(["exports","../../../chunks/Point2D","../../../chunks/Envelope2D","../../../chunks/Geometry","../../../chunks/Envelope","../../../chunks/MultiPathImpl","../../../chunks/ProjectionTransformation","../../Extent","../../Multipoint","../../Point","../../Polygon","../../Polyline","./initNoPeFactory","./jsonConverter"],function(e,t,s,n,i,r,o,a,m,h,l,u,c,g){"use strict";const d="_gxVersion";function p(e){if(!e.getCacheValue(d)){const t=new i.Envelope;t.setCoords(e.xmin,e.ymin,e.xmax,e.ymax),e.hasM&&t.setInterval(2,0,e.mmin,e.mmax),e.hasZ&&t.setInterval(1,0,e.zmin,e.zmax),e.setCacheValue(d,t)}return e.getCacheValue(d)}function _(e){if(!e.getCacheValue(d)){const t=new r.MultiPoint,s=new i.Point,n=e.points,o=e.hasM,a=e.hasZ,m=a?3:2;for(let e=0,i=n.length;e<i;e++){const i=n[e];s.setXYCoords(i[0],i[1]),a&&s.setZ(i[2]??0),o&&s.setM(i[m]??NaN),t.add(s)}e.setCacheValue(d,t)}return e.getCacheValue(d)}function f(e){if(!e.getCacheValue(d)){const t=new i.Point;t.setXYCoords(e.x,e.y),e.hasM&&t.setM(e.m),e.hasZ&&t.setZ(e.z),e.setCacheValue(d,t)}return e.getCacheValue(d)}function y(e){if(!e.getCacheValue(d)){const{curveRings:t,hasM:s,hasZ:n,rings:i}=e,r=g.fromGeometryToGXGeometry({curveRings:t,hasM:s,hasZ:n,rings:i});e.setCacheValue(d,r)}return e.getCacheValue(d)}function x(e){if(!e.getCacheValue(d)){const{curvePaths:t,hasM:s,hasZ:n,paths:i}=e,r=g.fromGeometryToGXGeometry({curvePaths:t,hasM:s,hasZ:n,paths:i});e.setCacheValue(d,r)}return e.getCacheValue(d)}function P(e,t){if(e.isEmpty())return null;const s=new a({xmin:e.getXMin(),ymin:e.getYMin(),xmax:e.getXMax(),ymax:e.getYMax(),spatialReference:t}),n=e.getDescription();if(n.hasM()){const t=e.queryInterval(2,0);s.mmin=t.vmin,s.mmax=t.vmax}if(n.hasZ()){const t=e.queryInterval(1,0);s.zmin=t.vmin,s.zmax=t.vmax}return s.setCacheValue(d,e),s}function E(e,t){if(e.isEmpty())return null;const s=e.getDescription(),n=s.hasM(),r=s.hasZ(),o=[],a=new i.Point;for(let t=0,s=e.getPointCount();t<s;t++){e.getPointByVal(t,a);const s=[a.getX(),a.getY()];r&&s.push(a.getZ()),n&&s.push(a.getM()),o.push(s)}const h=new m({hasM:n,hasZ:r,points:o,spatialReference:t});return h.setCacheValue(d,e),h}function v(e,s){if(e instanceof t.Point2D)return new h({x:e.x,y:e.y,spatialReference:s});if(e.isEmpty())return null;const n=new h({x:e.getX(),y:e.getY(),spatialReference:s}),i=e.getDescription();return i.hasM()&&(n.m=e.getM()),i.hasZ()&&(n.z=e.getZ()),n.setCacheValue(d,e),n}function C(e,t){if(e.isEmpty())return null;const s=l.fromJSON({spatialReference:t,...g.toGeometry(e,null)});return s.setCacheValue(d,e),s}function D(e,t){if(e.isEmpty())return null;const s=u.fromJSON({spatialReference:t,...g.toGeometry(e,null)});return s.setCacheValue(d,e),s}e.fromExtent=p,e.fromGeometry=function(e){switch(e.type){case"point":return f(e);case"multipoint":return _(e);case"polyline":return x(e);case"polygon":return y(e);case"extent":return p(e);default:throw new Error(`Unsupported geometry type: ${e.type}`)}},e.fromMultipoint=_,e.fromPoint=f,e.fromPolygon=y,e.fromPolyline=x,e.fromSpatialReference=function(e){if(e.wkid)return o.create$2(e.wkid);const t=e.wkt2||e.wkt;return t?o.createFromWKT$2(t):null},e.getSpatialReference=function(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference},e.toExtent=P,e.toGeometry=function(e,t){if(e)switch(e.getGeometryType()){case n.GeometryType.enumPoint:return v(e,t);case n.GeometryType.enumEnvelope:return P(e,t);case n.GeometryType.enumMultiPoint:return E(e,t);case n.GeometryType.enumPolyline:return D(e,t);case n.GeometryType.enumPolygon:return C(e,t)}return null},e.toMultipoint=E,e.toPoint=v,e.toPolygon=C,e.toPolyline=D,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Point2D":function(){define(["exports","./Geometry"],function(e,t){"use strict";class s{constructor(e){this.sum=e,this.compensation=0}assign(e){return this.compensation=e.compensation,this.sum=e.sum,this}reset(){this.sum=this.compensation=0}resetToStart(e){this.sum=e,this.compensation=0}normalize(){const e=[Number.NaN];this.sum=R(this.sum,this.compensation,e),this.compensation=e[0]}add(e){const t=this.sum+e;let s;if(Math.abs(this.sum)>=Math.abs(e)){const n=this.sum-t+e;s=this.compensation+n}else{const n=e-t+this.sum;s=this.compensation+n}this.sum=t,this.compensation=s}sub(e){this.add(-e)}addProduct(e,t){const s=[0],n=A(e,t,s);this.add(n),this.add(s[0])}mul(e){const t=new s(0);t.addProduct(this.sum,e),t.addProduct(this.compensation,e),this.assign(t)}getResult(){return this.sum+this.compensation}pe(e){return this.add(e),this}me(e){return this.add(-e),this}}const n=[5,1,2,1,3,1,2,1,4,1,2,1,3,1,2,1],i=[-1,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3];function r(e){let t=0;return 65535n&e||(t+=16,e>>=16n),255n&e||(t+=8,e>>=8n),15n&e||(t+=4,e>>=4n),t+n[Number(BigInt.asUintN(4,e))]}function o(e){let t=0;return 4294967295n&e||(t=32,e>>=32n),t+r(BigInt.asUintN(32,e))}class a{constructor(e,t){if(this.m_EnvelopeType=1,void 0!==e){if(e instanceof a)return this.vmin=e.vmin,void(this.vmax=e.vmax);this.vmin=e,this.vmax=t,this.normalize()}else this.setEmpty()}static construct(e,t){return new a(e,t)}static constructEmpty(){return new a}setCoords(e,t){this.vmin=e,this.vmax=t,this.normalize()}setCoordsFromEnvelope(e){this.vmin=e.vmin,this.vmax=e.vmax}setEmpty(){this.vmin=Number.NaN,this.vmax=Number.NaN}getCenter(){return.5*(this.vmin+this.vmax)}equalsRange(e,t){return ae(this.vmin,e)&&ae(this.vmax,t)}equals(e,t){return!(!this.isEmpty()||!e.isEmpty())||(void 0!==t?Math.abs(this.vmin-e.vmin)<=t&&Math.abs(this.vmax-e.vmax)<=t:this.vmin===e.vmin&&this.vmax===e.vmax)}width(){return this.vmax-this.vmin}isEmpty(){return Number.isNaN(this.vmin)||Number.isNaN(this.vmax)}isZero(){return this.vmin===this.vmax}setInfinite(){this.vmin=Number.NEGATIVE_INFINITY,this.vmax=Number.POSITIVE_INFINITY}move(e){this.isEmpty()||(this.vmin+=e,this.vmax+=e)}contains(e){return e.vmin>=this.vmin&&e.vmax<=this.vmax}containsCoordinate(e){return e>=this.vmin&&e<=this.vmax}containsRightExclusive(e){return e>=this.vmin&&e<this.vmax}containsExclusiveCoordinate(e){return e>this.vmin&&e<this.vmax}containsExclusive(e){return e.vmin>this.vmin&&e.vmax<this.vmax}isIntersecting(e){return this.vmin<=e.vmin?this.vmax>=e.vmin:e.vmax>=this.vmin}mergeCoordinate(e){if(this.isEmpty())return this.vmin=e,void(this.vmax=e);this.mergeNeCoordinate(e)}merge(e){if(e.isEmpty())return;const t=e.vmin,s=e.vmax;this.mergeCoordinate(t),this.mergeCoordinate(s)}mergeNe(e){const t=e.vmin,s=e.vmax;this.mergeNeCoordinate(t),this.mergeNeCoordinate(s)}mergeNeCoordinate(e){e<this.vmin?this.vmin=e:e>this.vmax&&(this.vmax=e)}intersect(e){this.isEmpty()||e.isEmpty()?this.setEmpty():(this.vmin<e.vmin&&(this.vmin=e.vmin),this.vmax>e.vmax&&(this.vmax=e.vmax),this.vmin>this.vmax&&this.setEmpty())}inflate(e){this.isEmpty()||(this.vmin-=e,this.vmax+=e,this.vmax<this.vmin&&this.setEmpty())}normalize(){this.vmin<=this.vmax||(this.vmin>this.vmax?this.vmax=B(this.vmin,this.vmin=this.vmax):this.setEmpty())}isValid(){return this.isEmpty()||this.vmin<=this.vmax}snapClip(e){return xe(e,this.vmin,this.vmax)}calculateToleranceFromEnvelope(){return this.isEmpty()?fe():(Math.abs(this.vmin)+Math.abs(this.vmax)+1)*fe()}static unit(){return m}normalizeNoNAN(){this.vmin>this.vmax&&(this.vmax=B(this.vmin,this.vmin=this.vmax))}setCoordsNoNAN(e,t){this.vmin=e,this.vmax=t,this.normalizeNoNAN()}clone(){return new a(this.vmin,this.vmax)}}const m=new a(0,1);class h{static getNAN(){return new h(Number.NaN)}constructor(e,t){this.m_value=e??0,this.m_eps=t??0}[Symbol.toPrimitive](e){return this}clone(){return new h(this.m_value,this.m_eps)}assign(e){return this.m_value=e.m_value,this.m_eps=e.m_eps,this}scaleError(e){this.m_eps*=e}setError(e){this.m_eps=e}set(e,t){return this.m_value=e,this.m_eps=t??0,this}setWithEps(e,t){return void 0===t&&(t=1),this.m_value=e,this.m_eps=h.ulp(e)*t,this}setE(e){return this.m_value=e.m_value,this.m_eps=e.m_eps,this}precise(){return new h(this.m_value)}value(){return this.m_value}toDouble(){return this.m_value}eps(){return this.m_eps}resetError(){return this.m_eps=0,this}absThis(){return this.m_value=Math.abs(this.m_value),this}add(e){return this.clone().addThis(e)}addE(e){return this.clone().addThisE(e)}addThisE(e){const t=this.m_value+e.m_value,s=this.m_eps+e.m_eps+h.ulp(t);return this.m_value=t,this.m_eps=s,this}addThis(e){const t=this.m_value+e,s=this.m_eps+h.ulp(t);return this.m_value=t,this.m_eps=s,this}subE(e){return this.clone().subThisE(e)}sub(e){return this.clone().subThis(e)}subThisE(e){const t=this.m_value-e.m_value,s=this.m_eps+e.m_eps+h.ulp(t);return this.m_value=t,this.m_eps=s,this}subThis(e){const t=this.m_value-e,s=this.m_eps+h.ulp(t);return this.m_value=t,this.m_eps=s,this}setAddE(e,t){return this.m_value=e.m_value+t.m_value,this.m_eps=e.m_eps+t.m_eps+h.ulp(this.m_value),this}setAdd(e,t){return this.m_value=e+t,this.m_eps=h.ulp(this.m_value),this}setAddEN(e,t){return this.m_value=e.m_value+t,this.m_eps=e.m_eps+h.ulp(this.m_value),this}setAddNE(e,t){return this.m_value=e+t.m_value,this.m_eps=t.m_eps+h.ulp(this.m_value),this}setSubE(e,t){return this.m_value=e.m_value-t.m_value,this.m_eps=e.m_eps+t.m_eps+h.ulp(this.m_value),this}setSub(e,t){return this.m_value=e-t,this.m_eps=h.ulp(this.m_value),this}setSubEN(e,t){return this.m_value=e.m_value-t,this.m_eps=e.m_eps+h.ulp(this.m_value),this}setSubNE(e,t){return this.m_value=e-t.m_value,this.m_eps=t.m_eps+h.ulp(this.m_value),this}mulThisE(e){const t=this.m_value*e.m_value;return this.m_eps=this.m_eps*Math.abs(e.m_value)+e.m_eps*Math.abs(this.m_value)+this.m_eps*e.m_eps+h.ulp(t),this.m_value=t,this}mulThis(e){const t=this.m_value*e;return this.m_eps=this.m_eps*Math.abs(e)+h.ulp(t),this.m_value=t,this}mul(e){return this.clone().mulThis(e)}mulE(e){return this.clone().mulThisE(e)}setMulE(e,t){const s=e.m_value*t.m_value;return this.m_eps=e.m_eps*Math.abs(t.m_value)+t.m_eps*Math.abs(e.m_value)+e.m_eps*t.m_eps+h.ulp(s),this.m_value=s,this}setMul(e,t){return this.m_value=e*t,this.m_eps=h.ulp(this.m_value),this}setMulEN(e,t){return this.setE(e),this.mulThis(t)}setMulNE(e,t){return this.setE(t),this.mulThis(e)}mulThisByPower2(e){return this.m_value*=e,this.m_eps*=Math.abs(e),this}static st_mulByPower2(e,t){return new h(e.m_value,e.m_eps).mulThisByPower2(t)}divE(e){return this.clone().divThisE(e)}divThisE(e){const t=Math.abs(e.m_value),s=this.m_value/e.m_value;let n=(this.m_eps+Math.abs(s)*e.m_eps)/t;if(e.m_eps>.01*t){const s=e.m_eps/t;n*=1+(1+s)*s}return this.m_value=s,this.m_eps=n+h.ulp(s),this}divThis(e){const t=Math.abs(e);return this.m_value/=e,this.m_eps=this.m_eps/t+h.ulp(this.m_value),this}setDivE(e,t){return this.setE(e),this.divThisE(t)}setDiv(e,t){return this.m_value=e/t,this.m_eps=h.ulp(this.m_value),this}setDivEN(e,t){return this.setE(e),this.divThis(t)}setDivNE(e,t){return this.set(e),this.divThisE(t)}divThisByPower2(e){return this.m_value/=e,this.m_eps/=Math.abs(e),this}invThis(){return this.setE(_.clone().divThisE(this)),this}sqrt(){return this.clone().sqrtThis()}sqrtThis(){let e,t;return this.m_value>=0?(e=Math.sqrt(this.m_value),t=this.m_value>10*this.m_eps?.5*this.m_eps/e:this.m_value>this.m_eps?e-Math.sqrt(this.m_value-this.m_eps):Math.max(e,Math.sqrt(this.m_value+this.m_eps)-e),t+=h.ulp(e)):this.m_value<-this.m_eps?(e=Number.NaN,t=Number.NaN):(e=0,t=Math.sqrt(this.m_eps)),this.m_value=e,this.m_eps=t,this}sqr(){return this.clone().sqrThis()}sqrThis(){const e=this.m_value*this.m_value;return this.m_eps=2*this.m_eps*Math.abs(this.m_value)+this.m_eps*this.m_eps+h.ulp(e),this.m_value=e,this}setSin(e){const t=Math.sin(e.m_value),s=Math.cos(e.m_value);this.m_value=t;const n=Math.abs(t),i=Math.abs(e.value());return this.m_eps=(Math.abs(s)+.5*n*e.m_eps)*e.m_eps+h.ulp(n+i),this}static ulp(e){let t=ne(e);const s=((0x7ff0000000000000n&t)>>52n)-1075n;return s>-1023n?(t=s+0x3ffn<<52n,n=t,te[0]=n,ee[0]):0===e?0:Number.MIN_VALUE;var n}setCos(e){const t=Math.sin(e.m_value),s=Math.cos(e.m_value);this.m_value=s;const n=Math.abs(s),i=Math.abs(e.value());return this.m_eps=(Math.abs(t)+.5*n*e.m_eps)*e.m_eps+h.ulp(n+i),this}static st_cosAndSin(e,t,s){const n=Math.sin(e.m_value),i=Math.cos(e.m_value);s.m_value=n,t.m_value=i;const r=Math.abs(n),o=Math.abs(i),a=Math.abs(e.value());s.m_eps=(Math.abs(i)+.5*r*e.m_eps)*e.m_eps+h.ulp(r+a),t.m_eps=(Math.abs(n)+.5*o*e.m_eps)*e.m_eps+h.ulp(o+a)}negate(){return this.clone().negateThis()}negateThis(){return this.m_value=-this.m_value,this}setAbs(){return this.m_value=Math.abs(this.m_value),this}isInInterval(e){return a.construct(this.m_value-this.m_eps,this.m_value+this.m_eps).isIntersecting(e)}eq(e){return Math.abs(this.m_value-e.m_value)<=this.m_eps+e.m_eps}ne(e){return!this.eq(e)}gt(e){return this.m_value-e.m_value>this.m_eps+e.m_eps}lt(e){return e.m_value-this.m_value>this.m_eps+e.m_eps}ge(e){return!this.lt(e)}le(e){return!this.gt(e)}tolEQ(e,t){return Math.abs(this.m_value-e.m_value)<=t||this.eq(e)}tolNE(e,t){return!this.tolEQ(e,t)}tolGT(e,t){return this.m_value-e.m_value>t&&this.gt(e)}tolLT(e,t){return e.m_value-this.m_value>t&&this.lt(e)}tolGE(e,t){return!this.tolLT(e,t)}tolLE(e,t){return!this.tolGT(e,t)}isZero(){return Math.abs(this.m_value)<=this.m_eps}isFuzzyZero(){return this.isZero()&&0!==this.m_eps}tolIsZero(e){return Math.abs(this.m_value)<=Math.max(this.m_eps,e)}setPi(){this.setE(d)}setEuler(){this.set(2.718281828459045,g())}static size(){return 1}}function l(e,t){const s=ie(e),n=ie(t),i=53-o(s),r=53-o(n);return(i>=0?i:0)+(r>=0?r:0)<=52}function u(e,t){const s=e+t;return s-e===t&&s-t===e}function c(e,t){const s=e-t;return e-s===t&&t+s===e}function g(){return ye()}h.dimensions=1;const d=new h(Math.PI,.5*g()),p=new h(0,0),_=new h(1,0),f=new h(4,0);function y(e){const t=Math.PI*Math.PI/6;let s;if(1===e)s=t;else if(e>1)s=t;else if(0===e)s=e;else if(e<0){const t=1+(e=Math.abs(e)),n=Math.log(t);s=n*n/-2-y(e/t)}else if(e>.5){const n=1-e,i=Math.log(e)*Math.log(n);s=t-y(n)-i}else{s=0;const t=1+Math.trunc(-16*Math.log(10)/Math.log(e)+1.5);let n=t;for(let i=t;i>0;i--,n-=1)s*=e,s+=1/(n*n);s*=e}return s}function x(e,t,s,n,i){i[0]=t[0]+(s[0]-t[0])*n,i[1]=t[1]+(s[1]-t[1])*n,3===e&&(i[2]=t[2]+(s[2]-t[2])*n)}function P(e,t,s,n,i){i[0]=s[0]-(s[0]-t[0])*(1-n),i[1]=s[1]-(s[1]-t[1])*(1-n),3===e&&(i[2]=s[2]-(s[2]-t[2])*(1-n))}function E(e,t,s){let n;return n=s<=.5?e+(t-e)*s:t-(t-e)*(1-s),n}function v(e,t,s,n){s<=.5?(n.x=e.x+(t.x-e.x)*s,n.y=e.y+(t.y-e.y)*s):(n.x=t.x-(t.x-e.x)*(1-s),n.y=t.y-(t.y-e.y)*(1-s))}function C(e){return e*e}const D=[0],b=[0],S=[0],I=[0],w=[0],T=[0];function A(e,t,s){const n=e*t;return N(e,S,I),N(t,w,T),s[0]=I[0]*T[0]-(n-S[0]*w[0]-I[0]*w[0]-S[0]*T[0]),n}function N(e,t,s){const n=134217729*e;t[0]=n-(n-e),s[0]=e-t[0]}const G=[0],M=[0];function R(e,t,s){const n=e+t;return Math.abs(e)>Math.abs(t)?s[0]=e-n+t:s[0]=t-n+e,n}function k(e){const t=1-e;if(0===t)return 1;let s;if(t<=.01){const e=t,n=Math.log(e);s=1+e*(.4431471805599453-.25*n+e*(.05680519270997949-.09375*n+e*(.02183137044373718-.05859375*n+e*(.011544521417308362-.042724609375*n+e*(.00714200031339596-.0336456298828125*n+e*(.004854743337164948-.027757644653320312*n+e*(.003514687963781376-.023627042770385742*n)))))))}else{if(e<.016){const t=e,s=.25,n=.046875,i=.01953125,r=.01068115234375,o=.0067291259765625,a=.004626274108886719,m=.0033752918243408203,h=.0025710230693221092;return Ee()*(1-t*(s+t*(n+t*(i+t*(r+t*(o+t*(a+t*(m+t*h))))))))}s=q(0,t,1)-e*V(0,t,1)/3}return xe(s,1,Ee())}function F(e,s,n=Number.NaN){if(t.geometryReleaseAssert(s>=0&&s<=1),0===s)return e;let i=1,r=e;if(r<0&&(r=-r,i=-1),1===s){const e=Math.round(r/Pe()),t=r-e*Pe();return i*(2*e+Math.sin(t))}const o=Ee(),a=Math.floor(r/o);1&a?r=(a+1)*o-r:r-=a*o;const m=Math.sin(r),h=Number.isNaN(n)?k(s):n;let l;if(1===m)l=h+Math.sqrt(1-s)*(r-o);else{const e=r*r;if(.01424*Math.pow(e,4)<=2*ye())l=r*(1+e*s*(-1/6+e*((4-3*s)/120-(16+(45*s-60)*s)/5040*e)));else if(s<=.01){const e=Math.sin(2*r),t=Math.sin(4*r),n=Math.sin(6*r),i=Math.sin(8*r),o=Math.sin(10*r);l=r+s*((2*-r+e)/8+s*((-3*r+2*e-.25*t)/64+s*((-20*r+15*e-3*t+n/3)/1024+s*(5*(-140*r+112*e-28*t+16/3*n-.5*i)/65536+7*s*((-63*r+52.5*e-15*t+3.75*n-.625*i+.05*o)/65536+s*(-693*r+594*e-185.625*t+1.375*n-12.375*i+1.8*o-.125*Math.sin(12*r))/1048576)))))}else{const e=m*m,t=Math.cos(r),n=t*t,i=H(m,t,s);l=m*(q(n,i,1)-s*e*V(n,i,1)/3)}}return 1&a?l=h*(a+1)-l:l+=h*a,i*l}function q(e,s,n){t.geometryReleaseAssert((0!==e?1:0)+(0!==s?1:0)+1>1);let i=e,r=s,o=n;for(;;){const e=Math.sqrt(i*r)+Math.sqrt(r*o)+Math.sqrt(o*i);i=.25*(i+e),r=.25*(r+e),o=.25*(o+e);const t=(i+r+o)/3,s=(t-i)/t,n=(t-r)/t,a=(t-o)/t;if(Math.abs(s)<=.0024&&Math.abs(n)<=.0024&&Math.abs(a)<=.0024){const e=s*n-a*a,i=s*n*a;return(1+(1/24*e-.1-3/44*i-5*e*e/208+e*i/16)*e+(1/14+3*i/104)*i)/Math.sqrt(t)}}}function V(e,n,i){t.geometryReleaseAssert(0!==e||0!==n);let r=e,o=n,a=i;const m=new s(0);let h=1;for(;;){const e=.2*(r+o+3*a),t=(e-r)/e,s=(e-o)/e,n=(e-a)/e;if(Math.abs(t)<=.0015&&Math.abs(s)<=.0015&&Math.abs(n)<=.0015){const i=t*s,r=n*n,o=i-r,a=i-6*r,l=a+o+o,u=3/26,c=a*(9/22*.25*a-.21428571428571427-1.5*u*n*l),g=n*(1/6*l+n*(-.4090909090909091*o+n*u*i));return 3*m.getResult()+h*(1+c+g)/(e*Math.sqrt(e))}const i=Math.sqrt(r),l=Math.sqrt(o),u=Math.sqrt(a),c=i*(l+u)+l*u;m.add(h/(u*(a+c))),h*=.25,r=.25*(r+c),o=.25*(o+c),a=.25*(a+c)}}function H(e,t,s){return e<.999?1-s*C(e):1-s+s*C(t)}const O=new class{constructor(e){for(this.values=[[1]];this.values.length<e+1;){const e=this.values.at(-1),t=j(e.length+1,1);for(let s=1;s<e.length;++s)t[s]=e[s-1]+e[s];this.values.push(t)}}get(e,t){return this.values[e][t]}}(32);function Y(e,s){if(e<O.values.length)return O.get(e,s);const n=Math.exp((t.geometryReleaseAssert(0),0));return n+.01>2147483647&&t.throwOutOfRangeException("The result value of n choose k is out of range"),n+.01}function X(e,t){if(e.isZero())return e.clone();const s=e.clone().divThis(e);if(t<0)return s.divThis(X(e,-t));for(e=e.clone(),t=Math.trunc(t);1&t&&s.mulThis(e),t>>=1;)e.mulThis(e);return s}function L(e,t,s,n,i){if(0===i)return;let r=0,o=s,a=n;for(;r++<i;)e[o++]=t[a++]}function B(e,t){return e}function z(e){e.sort((e,t)=>e<t?-1:e>t?1:0)}function U(e,t){const s=new Array(t);for(let n=0;n<t;++n)s[n]=new e;return s}function j(e,t){const s=new Array(e);return s.fill(t),s}class W{constructor(...e){this.m_elts=e}get length(){return this.m_elts.length}at(e){return this.m_elts[e]}[Symbol.dispose](){for(const e of this.m_elts)e[Symbol.dispose]()}}function Z(e,t){return{first:e,second:t}}const Q=Math.PI,K=2*Math.PI,$=.5*Math.PI,J=new ArrayBuffer(8),ee=new Float64Array(J),te=new BigUint64Array(J),se=0x0fffffffffffffn;function ne(e){return ee[0]=e,te[0]}function ie(e){return ne(e)&se}function re(e){return Number((9218868437227405312n&ne(e))>>52n)}function oe(e){if(0n===e)return-1n;if(1n===e||-1n===e)return 0n;e<0n&&(e=-e);let t=0n,s=512n,n=1n<<t+s;for(;e>=n;)t+=s,s<<=1n,n<<=s;let i=t;s>>=1n;let r=i+s;for(;s>0n;)e<1n<<r||(i=r),s>>=1n,r=i+s;return i}function ae(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}const me=2147483647,he=BigInt(me),le=2166136261,ue=16777619,ce=1099511628211n;function ge(e,t){return t+2654435769+(e<<6)+(e>>2)&me}function de(e){return ge(3735928559,e)}function pe(e){return Number(function(e){let t=14695981039346656037n,s=e;return t=(t^0xffn&s)*ce,s>>=8n,t=(t^0xffn&s)*ce,s>>=8n,t=(t^0xffn&s)*ce,s>>=8n,t=(t^0xffn&s)*ce,s>>=8n,t=(t^0xffn&s)*ce,s>>=8n,t=(t^0xffn&s)*ce,s>>=8n,t=(t^0xffn&s)*ce,t&he}(e))}const _e=100;function fe(){return Number.EPSILON*_e}function ye(){return Number.EPSILON}function xe(e,t,s){return e>=t?e<=s?e:s:t}function Pe(){return Q}function Ee(){return $}const ve=3*Ee();function Ce(e){return e+0}function De(e){return{v:e}}class be{constructor(){this.m_rn=De(0n),this.m_rd=De(1n),this.m_bNaN=!1,this.m_bNormalized=!1,this.m_power=0,this.m_sign=0}static constructAssign(e,t){const s=e.clone();return void 0!==t&&s.limitPrecisionThis(t),s}static constructDouble(e){return(new be).setDouble(e)}static constructInt64(e){return(new be).setInt64(e)}static constructRational(e,t){return(new be).setRational(e,t)}static constructInt32(e){return this.constructInt64(BigInt(Math.trunc(e)))}[Symbol.toPrimitive](e){return this}compare(e){return this.lt(e)?-1:this.gt(e)?1:0}assignCopy(e){return this.setThis(e)}abs(){return this.clone().absThis()}absThis(){return this.isNAN()||(this.m_sign*=this.m_sign),this}clone(){return(new be).setThis(this)}setThis(e){return this.m_bNaN=e.m_bNaN,this.m_bNormalized=e.m_bNormalized,this.m_rn.v=e.m_rn.v,this.m_rd.v=e.m_rd.v,this.m_power=e.m_power,this.m_sign=e.m_sign,this}setZero(){return this.m_rn.v=0n,this.m_rd.v=1n,this.m_bNaN=!1,this.m_power=0,this.m_bNormalized=!0,this.m_sign=0,this}setDouble(e){if(this.setZero(),0===e)return this;if(Number.isInteger(e)&&Math.abs(e)<2147483647)return this.setInt32(e);const s=ne(e),n=(s&be.s_em)>>52n,i=!!(s&be.s_sm),r=s&be.s_fm;if(n===be.s_emax)return r?(this.m_rn.v=this.m_rd.v=0n,this.m_bNaN=!0,this):(this.m_rn.v=i?-1n:1n,this.m_rd.v=0n,this);0n===n&&t.throwNotImplementedException("denormalized numbers not yet implemented");const o=n-1023n,a=o>=0n?o:0n,m=o<0n?-o:0n;return this.m_rn.v=(1n<<52n|r)<<a,this.m_rd.v=1n<<52n+m,this.m_sign=i?-1:1,this.m_bNormalized=!1,this.normalizeThis()}setInt64(e){return 0n===e?this.setZero():(this.m_bNaN=!1,this.m_sign=e>0n?1:-1,this.m_rn.v=e>0n?e:-e,this.m_rd.v=1n,this.m_power=0,this.m_bNormalized=!1,this.normalizeThis())}setRational(e,t){return 0n===e?0n===t?this.setNAN():this.setZero():0n===t?e>0n?this.setPositiveInf():this.setNegativeInf():(this.m_sign=(e>0n?1:-1)*(t>0n?1:-1),this.m_rn.v=e>0n?e:-e,this.m_rd.v=t>0n?t:-t,this.m_power=0,this.m_bNormalized=!1,this.normalizeThis())}setInt32(e){return this.setInt64(BigInt(Math.trunc(e)))}getDouble(){return this.convertToDouble()}toDouble(){return this.convertToDouble()}value(){return this.convertToDouble()}isNAN(){return this.m_bNaN}isPositiveInf(){return!this.isNAN()&&0n===this.m_rd.v&&1===this.m_sign}isNegativeInf(){return!this.isNAN()&&0n===this.m_rd.v&&-1===this.m_sign}isFinite(){return!this.isNAN()&&0n!==this.m_rd.v}setNAN(){return this.m_bNaN=!0,this.m_rn.v=0n,this.m_rd.v=0n,this.m_power=0,this.m_bNormalized=!0,this}setPositiveInf(){return this.m_rn.v=1n,this.m_rd.v=0n,this.m_bNaN=!1,this.m_bNormalized=!0,this.m_sign=1,this.m_power=0,this}setNegativeInf(){return this.m_rn.v=1n,this.m_rd.v=0n,this.m_bNaN=!1,this.m_bNormalized=!0,this.m_sign=-1,this.m_power=0,this}subThis(e){if(e.isNAN()&&this.setNAN(),this.isPositiveInf()&&e.isPositiveInf())this.setNAN();else{if(this.isPositiveInf()&&e.isNegativeInf())return this.setPositiveInf(),this;if(this.isNegativeInf()&&e.isNegativeInf())this.setNAN();else if(this.isNegativeInf()&&e.isPositiveInf())return this.setNegativeInf(),this}return this.isNAN()?this:this.opPlusMinus(e,!1)}thisSubAbs(e){return t.geometryReleaseAssert(0),this}mulThis(e){return e.isNAN()&&this.setNAN(),this.isNAN()?this:(this.m_sign*=e.m_sign,0===this.m_sign?this.setZero():(this.m_rn.v*=e.m_rn.v,this.m_rd.v*=e.m_rd.v,this.m_power+=e.m_power,this.m_bNormalized=!1,this.normalizeThis(),this))}mulDoubleThis(e){return this.mulThis(be.constructDouble(e))}thisMulInt64(e){return t.geometryReleaseAssert(0),this}thisMulInt32(e){return t.geometryReleaseAssert(0),this}divThis(e){return this.mulThis(e.clone().invertThis())}divDoubleThis(e){return this.divThis(be.constructDouble(e))}addDoubleThis(e){return this.addThis(be.constructDouble(e))}subDoubleThis(e){return this.subThis(be.constructDouble(e))}mul(e){return this.clone().mulThis(e)}mulBigIntThis(e){return this.mulThis(be.constructInt64(e))}mulDouble(e){return this.clone().mulThis(be.constructDouble(e))}div(e){return this.clone().divThis(e)}divDouble(e){return this.clone().divDoubleThis(e)}add(e){return this.clone().addThis(e)}fmSubThis(e,t){return this.subThis(e.clone().mulThis(t))}fmAddThis(e,t){return this.addThis(e.clone().mulThis(t))}addThis(e){if(e.isNAN()&&this.setNAN(),this.isPositiveInf()&&e.isPositiveInf())return this.setPositiveInf(),this;if(this.isPositiveInf()&&e.isNegativeInf())this.setNAN();else{if(this.isNegativeInf()&&e.isNegativeInf())return this.setNegativeInf(),this;this.isNegativeInf()&&e.isPositiveInf()&&this.setNAN()}return this.isNAN()?this:this.opPlusMinus(e,!0)}addDouble(e){return this.clone().addThis(be.constructDouble(e))}sub(e){return this.clone().subThis(e)}subDouble(e){return this.clone().subThis(be.constructDouble(e))}isZero(){return 0===this.m_sign}equals(e){return this.clone().subThis(e).isZero()}lt(e){return!this.isNAN()&&!e.isNAN()&&!(this.isPositiveInf()&&e.isPositiveInf()||this.isNegativeInf()&&e.isNegativeInf())&&!this.isPositiveInf()&&(!!e.isPositiveInf()||this.clone().sub(e).LZ())}absLessAbs(e){return this.abs().lt(e.abs())}gt(e){return this.clone().sub(e).GZ()}lte(e){return this.sub(e).LEZ()}gte(e){return this.sub(e).GEZ()}normalizeThis(){if(this.m_bNormalized)return this;if(0n===this.m_rn.v)return this.setZero();let e=0,t=0xffffffffn;for(;0n===(this.m_rn.v&t)&&t<=this.m_rn.v;)t<<=32n,e+=32;t&=this.m_rn.v,t>>=BigInt(e),e+=r(BigInt.asUintN(32,t))-1;let s=0;for(t=0xffffffffn;0n===(this.m_rd.v&t)&&t<=this.m_rd.v;)t<<=32n,s+=32;return t&=this.m_rd.v,t>>=BigInt(s),s+=r(BigInt.asUintN(32,t))-1,this.m_rn.v>>=BigInt(e),this.m_rd.v>>=BigInt(s),this.m_power+=e-s,this.m_rn.v>1n&&this.m_rd.v>1n&&(this.m_rn.v%this.m_rd.v===0n?(this.m_rn.v/=this.m_rd.v,this.m_rd.v=1n):this.m_rd.v%this.m_rn.v===0n&&(this.m_rd.v/=this.m_rn.v,this.m_rn.v=1n)),this.m_bNormalized=!0,this}negateThis(){return this.isNAN()||(this.m_sign*=-1),this}negate(){return this.clone().negateThis()}invertThis(){return this.isNAN()?this:this.isPositiveInf()||this.isNegativeInf()?(this.setZero(),this):0n===this.m_rn.v?(this.setPositiveInf(),this):(this.m_rd=B(this.m_rn,this.m_rn=this.m_rd),this.m_power=-this.m_power,this)}limitPrecisionThis(e){if(0===e)return this;if(this.isZero())return this.setZero();if(!this.isFinite())return this;this.normalizeThis();let t=Number(oe(this.m_rn.v));if(t>e){const s=t-e;this.m_rn.v>>=BigInt(t-e),this.m_power+=s}if(t=Number(oe(this.m_rd.v)),t>e){const s=t-e;this.m_rd.v>>=BigInt(t-e),this.m_power-=s}return this}hiBitIndex(){return Math.max(Number(oe(this.m_rn.v)),Number(oe(this.m_rd.v)))}ldexp(e){return this.clone().ldexpThis(e)}ldexpThis(e){return e&&(this.m_bNormalized=!1,this.m_power+=e,this.normalizeThis()),this}static lerp(e,t,s){return be.lerpLo(t,t,s)}static lerpLo(e,t,s){return t.sub(e).mulThis(s).addThis(e)}static lerpHi(e,t,s){return t.sub(e).mulThis(Se.sub(s)).addThis(e)}LZ(){return!this.isNAN()&&-1===this.m_sign}GZ(){return!this.isNAN()&&1===this.m_sign}LEZ(){return!this.isNAN()&&this.m_sign<=0}GEZ(){return!this.isNAN()&&this.m_sign>=0}toString(){return this.toDouble().toString()}sqr(){return this.clone().sqrThis()}sqrThis(){return this.mulThis(this.clone())}static sqrt(e,s){if(e.m_sign<0n&&t.throwOutOfRangeException("MP_value: sqrt(-1)"),e.isZero())return e.clone();let n=52,i=2220446049250313e-31;for(;n<s;)2*n<=s?(i*=i,n*=2):(i*=2220446049250313e-31,n+=52);n+=52;const r=oe(e.m_rn.v),o=oe(e.m_rd.v);let a,m=e.m_power+Number(r-o);const h=new be;Math.abs(m)>200?(1&Math.abs(m)&&(m+=1),a=be.constructAssign(e,53).ldexpThis(-m).value(),h.setThis(e).ldexpThis(-m),t.geometryReleaseAssert(Number.isFinite(a))):(h.setThis(e),a=h.value(),t.geometryReleaseAssert(Number.isFinite(a)),m=0),a=Math.sqrt(a);const l=be.constructDouble(a),u=be.constructDouble(i);u.mulThis(l).ldexpThis(1);const c=i*a*2,g=l.clone(),d=new be;let p;for(let e=0;e<10;++e){g.mulThis(l),d.setThis(h).subThis(g).absThis();let e=d.value();if(p=1,e<.9)for(;e>c;)e*=e,++p;else p=4;if(d.lte(u))break;for(let e=0;e<p;e++)g.setThis(l).divThis(h).invertThis().addThis(l).ldexpThis(-1).limitPrecisionThis(n),l.setThis(g)}return l.ldexpThis(m/2)}static cubicRoot(e,t){if(e.isZero())return e.clone();let s=52,n=2220446049250313e-31;for(;s<t;)2*s<=t?(n*=n,s*=2):(n*=2220446049250313e-31,s+=52);s+=52;const i=Math.pow(Math.abs(e.value()),1/3),r=be.constructDouble(i),o=r.clone();o.sqrThis().mulDoubleThis(3).mulDoubleThis(n),o.limitPrecisionThis(32),e.LZ()&&r.negateThis();for(let t=0;t<10;++t){const t=r.clone();t.sqrThis().mulThis(r);const n=t.clone();if(n.subThis(e),n.absThis().limitPrecisionThis(32),n.lte(o))break;n.setThis(e),n.ldexpThis(1),n.addThis(t);const i=t.clone();i.ldexpThis(1),i.addThis(e),n.divThis(i),r.mulThis(n),r.limitPrecisionThis(s)}return r}isInTheRangeOfDouble(){return t.geometryReleaseAssert(0),!1}sign(){return this.m_sign}cosAndSin(e,s){t.geometryReleaseAssert(0)}pow(e){return X(this,e)}static nan(){return t.geometryReleaseAssert(0),new be}convertToDouble(){if(this.m_bNaN)return Number.NaN;if(this.isZero())return 0;if(0n===this.m_rd.v)return 1===this.m_sign?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY;const e=-1===this.m_sign,t=this.m_rn.v<<(this.m_power>=0?BigInt(this.m_power):0n);let s=this.m_rd.v<<(this.m_power<0?BigInt(-this.m_power):0n);const n=t/s;let i=Number(n);if(BigInt(i)!==n)return e?-i:i;let r=t-n*s;if(r){let e=oe(s)-1023n;e>0n&&(s>>=e,r<<=52n,r>>=e);let t=Number(r);Number.isFinite(t)||(r>>=52n,t=Number(r),e=0n),e>0n&&(t/=Math.pow(2,52)),i+=t/Number(s)}return e?-i:i}signVal(){return 1===this.m_sign?1n:-1===this.m_sign?-1n:0n}opPlusMinus(e,t){const s=Math.min(this.m_power,e.m_power);let n,i;this.m_power>s?(n=BigInt(this.m_power-s),i=0n):(n=0n,i=BigInt(e.m_power-s));const r=this.signVal()*this.m_rn.v*e.m_rd.v<<n,o=e.signVal()*e.m_rn.v*this.m_rd.v<<i;return this.m_rn.v=t?r+o:r-o,this.m_rd.v*=e.m_rd.v,this.m_power=s,this.m_sign=1,this.m_rn.v<0n&&(this.m_sign=-1,this.m_rn.v=-this.m_rn.v),this.m_bNormalized=!1,this.normalizeThis(),this}}be.s_sm=0x8000000000000000n,be.s_em=0x7ff0000000000000n,be.s_fm=0x000fffffffffffffn,be.s_emax=0x7ffn;const Se=be.constructInt32(1),Ie=be.constructInt32(0),we=be.constructDouble(.5);function Te(e,t){let s=re(e);const n=re(t);if(s===n){const n=53-function(e,t){return function(e){let t=0;return 0xffffffff00000000n&e&&(t=32,e>>=32n),t+function(e){let t=0;return 4294901760n&e&&(t+=16,e>>=16n),65280n&e&&(t+=8,e>>=8n),240n&e&&(t+=4,e>>=4n),t+i[Number(BigInt.asUintN(4,e))]+1}(e)}(e^t)}(ie(e),ie(t));return s-=n,s}return s>n?s:n}class Ae{static construct(e,t){return new Ae(e,t)}constructor(e,t){void 0!==e?(this.x=e,this.y=t):this.x=this.y=Number.NaN}clone(){return new Ae(this.x,this.y)}assign(e){this.setCoordsPoint2D(e)}setCoords(e,t){return this.x=e,this.y=t,this}setCoordsPoint2D(e){this.x=e.x,this.y=e.y}isEqualPoint2D(e,t){return void 0!==t?Math.abs(this.x-e.x)<=t&&Math.abs(this.y-e.y)<=t:this.x===e.x&&this.y===e.y}isEqual(e,t,s){return void 0!==s?Math.abs(this.x-e)<=s&&Math.abs(this.y-t)<=s:this.x===e&&this.y===t}equalsPoint2D(e,t){return this.isEqualPoint2D(e,t)}setSub(e,t){this.x=e.x-t.x,this.y=e.y-t.y}addThis(e){return this.x+=e.x,this.y+=e.y,this}setAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}absoluteOther(e){}absolute(){return t.geometryReleaseAssert(0),this}setNegate(){this.x=-this.x,this.y=-this.y}setNegateOther(e){this.x=-e.x,this.y=-e.y}interpolateThis(e,t){}interpolate(e,s,n){t.geometryReleaseAssert(0)}scaleAddThis(e,t){this.x=this.x*e+t.x,this.y=this.y*e+t.y}setScaleAdd(e,t,s){this.x=t.x*e+s.x,this.y=t.y*e+s.y}scaleOther(e,s){t.geometryReleaseAssert(0)}scale(e){this.x*=e,this.y*=e}compare(e){return this.y<e.y?-1:this.y>e.y?1:this.x<e.x?-1:this.x>e.x?1:0}compareX(e){return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0}normalizeOther(e){t.geometryReleaseAssert(0)}normalize(){const e=this.length();return e?(this.x/=e,this.y/=e):(this.x=1,this.y=0),this}getUnitVector(){return this.clone().normalize()}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}sqrLength(){return this.x*this.x+this.y*this.y}static averageFast(e,s){return t.geometryReleaseAssert(0),{}}static average(e,t){const n=new Ae;if(0===t)return n.setNAN(),n;if(1===t)return n.assign(e[0]),n;const i=new s(e[0].x),r=new s(e[0].y);for(let s=1;s<t;s++)i.add(e[s].x),r.add(e[s].y),255&s||(i.normalize(),r.normalize());return n.x=i.getResult()/t,n.y=r.getResult()/t,n}static calculateLength(e,t){const n=new s(0);for(let s=1;s<t;s++)n.add(Ae.distance(e[s],e[s-1]));return n.getResult()}offset(e,t){const s=Ae.distance(e,t),n=Ae.construct(this.x,this.y);if(0===s)return Ae.distance(n,e);const i=t.clone();return i.subThis(e),n.subThis(e),n.crossProduct(i)/s}side(e,t){return e.equals(t)?this.equals(e)?0:1:Ae.orientationRobust(t,e,this)}static sqrDistance(e,t){const s=e.x-t.x,n=e.y-t.y;return s*s+n*n}static sqrDistanceCoords(e,t,s,n){const i=s-e,r=n-t;return i*i+r*r}static distance(e,t){return Math.sqrt(Ae.sqrDistance(e,t))}dotProduct(e){return this.x*e.x+this.y*e.y}dotProductAbs(e){return Math.abs(this.x*e.x)+Math.abs(this.y*e.y)}crossProduct(e){return this.x*e.y-this.y*e.x}crossProductAbs(e){return t.geometryReleaseAssert(0),0}rotateDirect(e,t){const s=this.x*e-this.y*t,n=this.x*t+this.y*e;this.x=s,this.y=n}rotateReverse(e,t){const s=this.x*e+this.y*t,n=-this.x*t+this.y*e;this.x=s,this.y=n}leftPerpendicularThis(){const e=this.x;this.x=-this.y,this.y=e}leftPerpendicularOther(e){const t=e.x;this.x=-e.y,this.y=t}rightPerpendicularThis(){const e=this.x;this.x=this.y,this.y=-e}rightPerpendicularOther(e){const t=e.x;this.x=e.y,this.y=-t}equals(e){return this.x===e.x&&this.y===e.y}notequals(e){return this.x!==e.x||this.y!==e.y}not(){return!this.x&&!this.y}gt(e){return this.y>e.y||this.y===e.y&&this.x>e.x}gte(e){return!this.lt(e)}lt(e){return this.y<e.y||this.y===e.y&&this.x<e.x}lte(e){return!this.gt(e)}subThis(e){return this.x-=e.x,this.y-=e.y,this}divThis(e){return this.x/=e,this.y/=e,this}add(e){return new Ae(this.x+e.x,this.y+e.y)}sub(e){return new Ae(this.x-e.x,this.y-e.y)}negateThis(){return this.x=-this.x,this.y=-this.y,this}negate(){return new Ae(-this.x,-this.y)}mul(e){return new Ae(this.x*e,this.y*e)}mulThis(e){return this.x*=e,this.y*=e,this}divide(e){return new Ae(this.x/e,this.y/e)}setNAN(){this.x=this.y=Number.NaN}isNAN(){return Number.isNaN(this.x)||Number.isNaN(this.y)}static getNAN(){return new Ae(Number.NaN,Number.NaN)}isFinite(){return Number.isFinite(this.x)&&Number.isFinite(this.y)}isZero(){return 0===this.x&&0===this.y}norm(e){switch(e){case 0:{const e=Math.abs(this.x),t=Math.abs(this.y),s=e-t;return s>=0?e:s<=0?t:Number.NaN}case 1:return Math.abs(this.x)+Math.abs(this.y);case 2:return Math.sqrt(this.x*this.x+this.y*this.y);default:t.throwInvalidArgumentException("norm")}}getQuarter(){return Ae.getQuarterCoords(this.x,this.y)}static getQuarterCoords(e,t){return e>0?t>=0?1:4:t>0?2:0===e?4:3}static compareVectors(e,t){const s=e.getQuarter(),n=t.getQuarter();return n===s?Ae.orientationRobustImpl(Ae.construct(0,0),t,e,!0):s<n?-1:1}static compareVectorsOrigin(e,t,s){const n=t.sub(e),i=s.sub(e),r=n.getQuarter(),o=i.getQuarter();return o===r?Ae.orientationRobustImpl(e,s,t,!0):r<o?-1:1}static orientationRobust(e,t,s){return Ae.orientationRobustImpl(e,t,s,!1)}static orientationRobustEx(e,t,s,n){if(e.equals(t)||s.equals(n))return 0;const i=t.x-e.x,r=t.y-e.y,o=n.x-s.x,a=n.y-s.y;{const e=Ae.getQuarterCoords(i,r)-1,t=Ae.getQuarterCoords(o,a)-1,s=Ae.d[e][t];if(0!==s)return s}const m=i*a,h=r*o,l=4*ye()*(Math.abs(m)+Math.abs(h)),u=m-h;return Math.abs(u)>=l?u<0?-1:u>0?1:0:Ae.orientationRobustExMp(e,t,s,n)}static orientationRobustExMp(e,t,s,n){const i=be.constructDouble(t.x),r=be.constructDouble(n.x);i.subThis(be.constructDouble(e.x)),r.subThis(be.constructDouble(s.x));const o=be.constructDouble(t.y),a=be.constructDouble(n.y);return o.subThis(be.constructDouble(e.y)),a.subThis(be.constructDouble(s.y)),i.mulThis(a),o.mulThis(r),i.subThis(o),i.LZ()?-1:i.GZ()?1:0}static orientationNonRobust(e,t,s){const n=t.sub(e).crossProduct(s.sub(e));return n<0?-1:n>0?1:0}static orientationRobustImpl(e,t,s,n){if(t.isEqualPoint2D(e)||s.isEqualPoint2D(e)||t.isEqualPoint2D(s))return 0;const i=t.x-e.x,r=t.y-e.y,o=s.x-e.x,a=s.y-e.y;if(!n){const e=Ae.getQuarterCoords(i,r)-1,t=Ae.getQuarterCoords(o,a)-1,s=Ae.d[e][t];if(0!==s)return s}const m=(Math.abs(i)+Math.abs(r)+Math.abs(o)+Math.abs(a))*(Math.abs(t.x)+Math.abs(t.y)+Math.abs(s.x)+Math.abs(s.y))*8*g(),h=i*a-r*o;if(Math.abs(h)>m)return h<0?-1:1;if(c(t.x,e.x)&&c(s.y,e.y)&&c(t.y,e.y)&&c(s.x,e.x)&&l(i,a)&&l(r,o)){const e=i*a,t=r*o;if(c(e,t)){const s=e-t;return s<0?-1:s>0?1:0}}return Ae.orientationRobustMp(e,t,s)}static orientationRobustMp(e,t,s){const n=be.constructDouble(t.x),i=be.constructDouble(s.x);{const t=be.constructDouble(e.x);n.subThis(t),i.subThis(t)}const r=be.constructDouble(s.y),o=be.constructDouble(t.y);{const t=be.constructDouble(e.y);r.subThis(t),o.subThis(t)}return n.mulThis(r),o.mulThis(i),n.subThis(o),n.LZ()?-1:n.GZ()?1:0}static inCircleRobust(e,t,s,n){const i=new h,r=new h;i.set(e.x),i.subThis(n.x),r.set(e.y),r.subThis(n.y);const o=new h,a=new h;o.set(t.x),o.subThis(n.x),a.set(t.y),a.subThis(n.y);const m=new h,l=new h;m.set(s.x),m.subThis(n.x),l.set(s.y),l.subThis(n.y);const u=i.mulE(a).subE(r.mulE(o)),c=o.mulE(l).subE(a.mulE(m)),g=i.mulE(l).subE(r.mulE(m)),d=i.mulE(i).addE(r.mulE(r)),p=o.mulE(o).addE(a.mulE(a)),_=m.mulE(m).addE(l.mulE(l)),f=d.mulE(c).subE(p.mulE(g)).addE(_.mulE(u));if(!f.isFuzzyZero()){const e=f.value();return e<0?-1:e>0?1:0}return Ae.inCircleRobustMp(e,t,s,n)}static inCircleRobustMp(e,t,s,n){do{if(!c(e.x,n.x)||!c(e.y,n.y))break;if(!c(t.x,n.x)||!c(t.y,n.y))break;if(!c(s.x,n.x)||!c(s.y,n.y))break;const i=e.x-n.x,r=e.y-n.y,o=t.x-n.x,a=t.y-n.y,m=s.x-n.x,h=s.y-n.y;if(!l(i,a)||!l(r,o))break;if(!l(o,h)||!l(a,m))break;if(!l(i,h)||!l(r,m))break;if(!l(i,i)||!l(r,r))break;if(!l(o,o)||!l(a,a))break;if(!l(m,m)||!l(h,h))break;const g=i*a,d=r*o,p=o*h,_=a*m,f=i*h,y=r*m,x=i*i,P=r*r,E=o*o,v=a*a,C=m*m,D=h*h;if(!c(g,d))break;if(!c(p,_))break;if(!c(f,y))break;if(!u(x,P))break;if(!u(E,v))break;if(!u(C,D))break;const b=g-d,S=p-_,I=f-y,w=x+P,T=E+v,A=C+D;if(!l(w,S))break;if(!l(T,I))break;if(!l(A,b))break;const N=w*S,G=T*I,M=A*b;if(!c(N,G))break;const R=N-G;if(!u(R,M))break;const k=R+M;return k<0?-1:k>0?1:0}while(0);const i=be.constructDouble(n.x),r=be.constructDouble(n.y),o=be.constructDouble(e.x),a=be.constructDouble(e.y);o.subThis(i),a.subThis(r);const m=be.constructDouble(t.x),h=be.constructDouble(t.y);m.subThis(i),h.subThis(r);const g=be.constructDouble(s.x),d=be.constructDouble(s.y);g.subThis(i),d.subThis(r);const p=o.mul(h).sub(a.mul(m)),_=m.mul(d).sub(h.mul(g)),f=o.mul(d).sub(a.mul(g)),y=o.mul(o).add(a.mul(a)),x=m.mul(m).add(h.mul(h)),P=g.mul(g).add(d.mul(d)),E=y.mul(_).sub(x.mul(f)).add(P.mul(p));return E.LZ()?-1:E.GZ()?1:0}static inCircleRobustMp3Point(e,t,s){const n=be.constructDouble(e.x),i=be.constructDouble(e.y),r=be.constructDouble(t.x),o=be.constructDouble(t.y),a=be.constructDouble(s.x),m=be.constructDouble(s.y),h=a.mul(a).add(m.mul(m)).sub(a.mul(n).add(m.mul(i)).add(a.mul(r)).add(m.mul(o))).add(n.mul(r).add(i.mul(o)));return h.LZ()?-1:h.GZ()?1:0}static inCircleRobust3Point(e,t,s){const n=new h(e.x),i=new h(e.y),r=new h(t.x),o=new h(t.y),a=new h(s.x),m=new h(s.y),l=a.mulE(a).addE(m.mulE(m)).subE(a.mulE(n).addE(m.mulE(i)).addE(a.mulE(r)).addE(m.mulE(o))).addE(n.mulE(r).addE(i.mulE(o)));if(!l.isFuzzyZero()){const e=l.value();return e<0?-1:e>0?1:0}return Ae.inCircleRobustMp3Point(e,t,s)}static calculateCircleCenterFromThreePoints(e,t,s){if(e.equals(s)||e.equals(t)||s.equals(t))return Ae.getNAN();const n=function(e,t,s){const n=new h(t.x);n.subThis(e.x);const i=new h(t.y);i.subThis(e.y);const r=new h(s.x);r.subThis(e.x);const o=new h(s.y);o.subThis(e.y);const a=n.clone();a.mulThisE(o);let m=i.clone();if(m.mulThisE(r),a.subThisE(m),0===a.value())return Ae.getNAN();a.mulThis(2);const l=n.clone();l.mulThisE(n);const u=i.clone();u.mulThisE(i);const c=l.clone();c.addThisE(u);const g=r.clone();g.mulThisE(r);const d=o.clone();d.mulThisE(o);const p=g.clone();p.addThisE(d);const _=i.clone();_.mulThisE(p),m=o.clone(),m.mulThisE(c),_.subThisE(m),_.divThisE(a);const f=n.clone();f.mulThisE(p),m=r.clone(),m.mulThisE(c),f.subThisE(m),f.divThisE(a);const y=Ae.construct(e.x-_.value(),e.y+f.value()),x=e.sub(y).length(),P=t.sub(y).length(),E=s.sub(y).length(),v=1e-15*(x+Math.abs(e.x)+Math.abs(t.x)+Math.abs(s.x)+Math.abs(e.y)+Math.abs(t.y)+Math.abs(s.y));return Math.abs(x-P)<=v&&Math.abs(x-E)<=v&&_.eps()<v&&f.eps()<v?y:Ae.getNAN()}(e,t,s);return n.isNAN()?function(e,t,s){const n=be.constructDouble(t.x);n.subDoubleThis(e.x);const i=be.constructDouble(t.y);i.subDoubleThis(e.y);const r=be.constructDouble(s.x);r.subDoubleThis(e.x);const o=be.constructDouble(s.y);o.subDoubleThis(e.y);const a=n.clone();a.mulThis(o);let m=i.clone();if(m.mulThis(r),a.subThis(m),a.isZero())return Ae.getNAN();a.mulDoubleThis(2);const h=n.clone();h.mulThis(n);const l=i.clone();l.mulThis(i);const u=h.clone();u.addThis(l);const c=r.clone();c.mulThis(r);const g=o.clone();g.mulThis(o);const d=c.clone();d.addThis(g);const p=i.clone();p.mulThis(d),m=o.clone(),m.mulThis(u),p.subThis(m),p.divThis(a);const _=n.clone();return _.mulThis(d),m=r.clone(),m.mulThis(u),_.subThis(m),_.divThis(a),Ae.construct(e.x-p.value(),e.y+_.value())}(e,t,s):n}static calculateAngle(e,t){return Math.atan2(e.crossProduct(t),e.dotProduct(t))}static isBisectorRobust(e,s,n){return t.geometryReleaseAssert(0),!1}static size(){return 2}get 0(){return this.x}get 1(){return this.y}set 0(e){this.x=e}set 1(e){this.y=e}static compareZorder(e,t){const s=Ae.c_compare_zorder_xx[e.x<0?1:0]|Ae.c_compare_zorder_yy[e.y<0?1:0],n=Ae.c_compare_zorder_xx[t.x<0?1:0]|Ae.c_compare_zorder_yy[t.y<0?1:0];if(s===n){let s=0,n=0;for(let i=0;i<2;++i){const r=Te(e[i],t[i]);r>s&&(s=r,n=i)}return e[n]<t[n]}return s<n}static lerp(e,t,s){const n=new Ae;return v(e,t,s,n),n}static getClosestCoordinate(e,t,s,n=!1){const i=Ae.getNAN();i.setSub(t,e);const r=i.sqrLength();if(0===r)return.5;if(t.isEqualPoint2D(s))return 1;const o=Ae.getNAN();o.setSub(s,e);let a=o.dotProduct(i)/r;return n||(a<0?a=0:a>1&&(a=1)),a}static intersectLinesAtOnePoint(e,t,s,n){if(e.equals(t)||s.equals(n))return Ae.getNAN();const i=t.x-e.x,r=s.x-n.x,o=t.y-e.y,a=s.y-n.y,m=i*a-r*o;if(!m)return Ae.getNAN();const h=m;if(0===h)return Ae.getNAN();let l=(s.x-e.x)*a-(s.y-e.y)*r;l/=h;const u=new Ae;return v(e,t,l,u),u.isFinite()?u:Ae.getNAN()}toString(){return`[${this.x},${this.y}]`}}Ae.dimensions=2,Ae.d=[[0,1,0,-1],[-1,0,1,0],[0,-1,0,1],[1,0,-1,0]],Ae.c_compare_zorder_xx=[2,0],Ae.c_compare_zorder_yy=[1,0],e.ECoordinate=h,e.Envelope1D=a,e.KahanSummator=s,e.MPValue=be,e.Point2D=Ae,e.SimpleDisposableArray=W,e.SmallMatrix=class{constructor(e,t){this.m_cr=e,this.m_cc=t,this.m_v=j(e*t,0)}get(e,t){return this.m_v[e*this.m_cc+t]}set(e,t,s){this.m_v[e*this.m_cc+t]=s}inc(e,t){return++this.m_v[e*this.m_cc+t]}},e.assignObjectArray=function(e,t,s){for(let n=0;n<s;++n)e[n].assign(t[n]);return s},e.atanhUOverU=function(e){let t;if(0===e)t=1;else if(Math.abs(e)>.01)t=function(e){return Math.atanh(e)}(e)/e;else{let s;const n=-36.841361487904734;t=0;const i=e*e;for(let e=2*Math.trunc(n/Math.log(i)+2.5)-1;e>1;e-=2)s=1/e,t=(t+s)*i;t+=1}return t},e.choose=Y,e.cloneObjectArray=function(e,t){const s=e.slice(0,t);for(let e=0;e<t;++e)s[e]=s[e].clone();return s},e.compareNoNANs=function(e,t){return e<t?-1:e>t?1:0},e.compareWithNANs=function(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;{const s=Number.isNaN(e),n=Number.isNaN(t);return s<n?-1:s>n?1:0}},e.compensatedDot=function(e,t,s,n){const i=[0],r=[0],o=[0];return R(A(e,s,i),A(t,n,r),o)+(i[0]+r[0]+o[0])},e.completeEllipticE=k,e.constructBernsteinCoefficientsFromStandardForm=function(e,t){if(0===t)return[];const s=e[0].clone().mulDoubleThis(0),n=[];n.length=t;const i=t-1;for(let t=0;t<=i;++t){n[t]=s.clone();for(let s=0;s<=t;++s)n[t].addThis(e[s].clone().mulDoubleThis(Y(t,s)/Y(i,s)))}return n},e.coordinateArrayToPoint2DArray=function(e){const t=U(Ae,e.length);for(let s=0,n=e.length;s<n;++s)t[s].setCoords(e[s][0],e[s][1]);return t},e.copySign=function(e,t){const s=Math.abs(e);return t>=0?s:-s},e.cube=function(e){return e*e*e},e.dilogarithmEzOverE=function(e,t){const s=t*e;if(Math.abs(t)<.1){let t=0;for(let e=60;e>=1;e--)t*=s,t+=1/e/e;return t*=e,t}return y(s)/t},e.doubleEps=ye,e.ellipticE=F,e.float64ArrayToPoint2DArray2=function(e,t){for(let s=0,n=0,i=e.length;s<i;s+=2,n++)t[n].x=e[s],t[n].y=e[s+1]},e.fma=function(e,t,s){return function(e,t,s,n){const i=R(e,t,G),r=R(i,s,M);return R(r,G[0]+M[0],n)}(A(e,t,D),s,D[0],b)},e.fmod=function(e,t){return e%t},e.geographyEpsFactor=function(){return 100*Number.EPSILON},e.geomEpsFactor=fe,e.geometry2Pi=K,e.geometryHalfPi=$,e.geometryPi=Q,e.goldenRatio=function(){return.38196601125010515},e.halfPi=Ee,e.hashCombine=ge,e.hashCombineInt64=function(e,t){return ge(e,pe(t))},e.hashDouble=function(e){return pe(ne(Ce(e)))},e.hashForClustering=de,e.hashForClustering2=function(e,t){return ge(e,de(t))},e.hashInt32=function(e){return function(e){let t=le,s=e;return t=(t^255&s)*ue,s>>=8,t=(t^255&s)*ue,s>>=8,t=(t^255&s)*ue,s>>=8,t=(t^255&s)*ue,t&me}(e)},e.hashString=function(e){let t=le;for(let s=0,n=e.length;s<n;++s)t=(t^e.charCodeAt(s))*ue;return t&me},e.indexTypeMax=function(){return 2147483647},e.initializeObjectArray=function(e,t,s){e.length=s;for(let n=0;n<s;++n)e[n]=new t},e.initializePrimitiveArray=function(e,t,s){e.length=t,e.fill(s)},e.intMax=function(){return 2147483647},e.intMin=function(){return-2147483648},e.interpolate=function(e,s,n,i,r){return 0===e?0===i?s:1===i?n:r:1===e?0===i?s:1===i?n:E(s,n,i):(2===e&&t.throwNotImplementedException("angular interpolation"),void t.throwNotImplementedException(""))},e.interpolateArray=function(e,s,n,i,r,o,a,m){if(0===e)for(let e=0;e<o;++e)i[e+r]=0===a?s[e]:1===a?n[e]:m;else if(1===e)if(0===a)L(i,s,r,0,o);else if(1===a)L(i,n,r,0,o);else for(let e=0;e<o;++e)i[e+r]=E(s[e],n[e],a);else if(2===e)if(0===a)L(i,s,r,0,o);else if(1===a)L(i,n,r,0,o);else{let e=0;for(let t=0,m=r;t<o;++t,++m)i[m]=E(s[t],n[t],a),e+=i[m]*i[m];if(e>0){e=Math.sqrt(e);for(let t=r;t<r+o;++t)i[t]/=e}else{for(let e=r;e<r+o;++e)i[e]=0;i[r]=1}}else t.throwNotImplementedException("")},e.inverseEllipticE=function(e,t,s=Number.NaN){if(0===e)return 0;let n=1,i=e;e<0&&(i=-i,n=-1);const r=Number.isNaN(s)?k(t):s,o=Math.floor(i/r);1&o?i=(o+1)*r-i:i-=o*r;let a=i<=0?0:i>=r?Ee():function(e,t,s){if(0===t)return e;if(1===t)return Math.asin(e);let n=0,i=!0;if(e<.2){const s=e*e,r=e*(1+s*t*(1/6+s*((13*t-4)/120+(16-284*t+493*t*t)/5040*s))),o=Math.abs(t*(4944*t-64-31224*t*t+37369*t*t*t)/362880*Math.pow(e,9));if(o<Math.abs(r)*ye())return r;n=r,i=o>.1*r}if(i){const i=1-t,r=1-e/s,o=Math.sqrt(r*r+i*i),a=Math.atan2(i,e+ye());n=Ee()+Math.sqrt(o)*(a-Ee())}let r=0;for(let i=0;i<7;i++){r=F(n,t,s);const o=H(Math.sin(n),Math.cos(n),t);if(n-=(r-e)/Math.sqrt(o),i>0&&Math.abs(r-e)<=4*ye()*e)break}return n}(i,t,r);return 1&o?a=Ee()*(o+1)-a:a+=Ee()*o,n*a},e.isEqualNonIEEE=ae,e.isEqualNonIEEETol=function(e,t,s){return e===t||Math.abs(e-t)<=s||Number.isNaN(e)&&Number.isNaN(t)},e.isOneOf=function(e,t,s){return e===t||e===s},e.isOnlyProperty=function(e,t){return t in e&&1===Object.getOwnPropertyNames(e).length},e.lerp=E,e.lerpHi=function(e,t,s){return t-(t-e)*(1-s)},e.lerpHiE=function(e,t,s){return t.subE(t.subE(e).mulE(_.subE(s)))},e.lerpHiPointE=function(e,t,s,n,i){i[0]=s[0].subE(s[0].subE(t[0]).mulE(_.subE(n))),i[1]=s[1].subE(s[1].subE(t[1]).mulE(_.subE(n)))},e.lerpLo=function(e,t,s){return e+(t-e)*s},e.lerpLoE=function(e,t,s){return e.addE(t.subE(e).mulE(s))},e.lerpLoPointE=function(e,t,s,n,i){i[0]=t[0].addE(s[0].subE(t[0]).mulE(n)),i[1]=t[1].addE(s[1].subE(t[1]).mulE(n))},e.lerpPoint=function(e,t,s,n,i){n<=.5?x(e,t,s,n,i):P(e,t,s,n,i)},e.lerpPoint2D=v,e.lerpPoint3D=function(e,t,s,n){s<=.5?(n.x=e.x+(t.x-e.x)*s,n.y=e.y+(t.y-e.y)*s,n.z=e.z+(t.z-e.z)*s):(n.x=t.x-(t.x-e.x)*(1-s),n.y=t.y-(t.y-e.y)*(1-s),n.z=t.z-(t.z-e.z)*(1-s))},e.lerpPointHi=P,e.lerpPointLo=x,e.makeNullArray=function(e){return Array.from({length:e},()=>null)},e.makeObjectArray=U,e.makePair=Z,e.makePrimitiveArray=j,e.makeScopedCall=function(e,t=!1){return{[Symbol.dispose](){this.bForget||e()},bForget:t}},e.makeStructArray=function(e,t){return Array.from({length:t},()=>e())},e.memcmp=function(e,t,s){let n=0;for(let i=0;!n&&i<s;++i)n=e[i]-t[i];return n},e.memcpy=L,e.minMax=function(e,t){return e<t?Z(e,t):Z(t,e)},e.nextRand=function(e){return function(e){return 1103515245*e+12345&2147483647}(e)},e.normalizeSignedZero=Ce,e.numericSort=z,e.numericSortRange=function(e,t){const s=e.slice(0,t);z(s),L(e,s,0,0,t)},e.pi=Pe,e.point2DArrayToFloat64Array=function(e){const t=new Float64Array(2*e.length);for(let s=0,n=e.length;s<n;++s){const n=s<<1;t[n]=e[s].x,t[n+1]=e[s].y}return t},e.querySnap=function(e,t,s){const n=e[0];if(n>=t){if(n<=s)return!1;e[0]=s}else e[0]=t;return!0},e.round=function(e){return Math.round(e)},e.rsqrt=function(e){return 1/Math.sqrt(e)},e.s_four=f,e.s_half=we,e.s_one=_,e.s_one$1=Se,e.s_zero=p,e.s_zero$1=Ie,e.shortMax=function(){return 32767},e.sign=function(e){return e<0?-1:e>0?1:0},e.snap=xe,e.snapMagnitude=function(e,t){return e>=t?t:e<-t?-t:e},e.sortRange=function(e,t,s,n){const i=e.slice(t,t+s);i.sort(n),L(e,i,t,0,s)},e.sqr=C,e.sqrt2=function(){return 1.4142135623730951},e.standardNumericCompare=function(e,t){return e<t?-1:e>t?1:0},e.standardNumericCompare2=function(e,t,s,n){return e<s?-1:e>s?1:t<n?-1:t>n?1:0},e.swap=B,e.threeHalfPi=function(){return ve},e.twoPi=function(){return K},e.unique=function(e,t){if(e.length<2)return e.length;let s=0;for(let n=1;n<e.length;++n)t(e[n],e[s])||(s++,e[n]=B(e[s],e[s]=e[n]));return 1+s},e.unorderedPop=function(e,t){e[t]=e.at(-1),e.pop()}})},"esri/chunks/Envelope2D":function(){define(["exports","./Geometry","./Point2D"],function(e,t,s){"use strict";class n{static construct(e,t,s,i){return new n(e,t,s,i)}constructor(e,t,s,n){this.m_EnvelopeType=2,void 0===e?(this.xmin=Number.NaN,this.ymin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN):"number"==typeof e?(this.xmin=e,this.ymin=t,this.xmax=s,this.ymax=n):(this.xmin=e.xmin,this.ymin=e.ymin,this.xmax=e.xmax,this.ymax=e.ymax),this.normalize()}static constructEmpty(){return new n(Number.NaN,Number.NaN,Number.NaN,Number.NaN)}clone(){return new n(this)}assign(e){return this.xmin=e.xmin,this.xmax=e.xmax,this.ymin=e.ymin,this.ymax=e.ymax,this}width(){return this.xmax-this.xmin}height(){return this.ymax-this.ymin}maxDimension(){return Math.max(this.width(),this.height())}minDimension(){return Math.min(this.width(),this.height())}sqrDiagonal(){const e=this.width(),t=this.height();return e*e+t*t}diagonal(){return Math.sqrt(this.sqrDiagonal())}getCenterX(){return.5*(this.xmin+this.xmax)}getCenterY(){return.5*(this.ymin+this.ymax)}getCenter(){return s.Point2D.construct(this.getCenterX(),this.getCenterY())}queryCenter(e){e.x=.5*(this.xmin+this.xmax),e.y=.5*(this.ymin+this.ymax)}setEmpty(){this.xmin=Number.NaN,this.ymin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN}setInfinite(){this.xmin=Number.NEGATIVE_INFINITY,this.xmax=Number.POSITIVE_INFINITY,this.ymin=Number.NEGATIVE_INFINITY,this.ymax=Number.POSITIVE_INFINITY}isDegenerate(e){return!this.isEmpty()&&(this.width()<=e||this.height()<=e)}isZero(){return!(this.isEmpty()||this.width()&&this.height())}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}mergeNeCoords(e,t){this.xmin>e?this.xmin=e:this.xmax<e&&(this.xmax=e),this.ymin>t?this.ymin=t:this.ymax<t&&(this.ymax=t)}mergeNe(e){this.mergeNeCoords(e.x,e.y)}mergeCoords(e,t){this.isEmpty()?(this.xmin=e,this.ymin=t,this.xmax=e,this.ymax=t):(this.xmin>e?this.xmin=e:this.xmax<e&&(this.xmax=e),this.ymin>t?this.ymin=t:this.ymax<t&&(this.ymax=t))}merge(e){this.mergeCoords(e.x,e.y)}mergeEnvelope2D(e){e.isEmpty()||(this.mergeCoords(e.xmin,e.ymin),this.mergeNeCoords(e.xmax,e.ymax))}mergePoints(e,t){for(let s=0;s<t;){if(!this.isEmpty()){for(let n=s;n<t;n++)this.mergeNe(e[n]);break}this.setCoords(e[s]),s++}}mergePointsInterleaved(e,t,s){for(let n=2*t,i=n+2*s;n<i;n+=2)this.mergeCoords(e.read(n),e.read(n+1))}inflateCoords(e,t){this.isEmpty()||(this.xmin-=e,this.xmax+=e,this.ymin-=t,this.ymax+=t,(this.xmin>this.xmax||this.ymin>this.ymax)&&this.setEmpty())}getInflatedCoords(e,t){const s=this.clone();return s.inflateCoords(e,t),s}inflate(e){this.inflateCoords(e,e)}getInflated(e){const t=this.clone();return t.inflateCoords(e,e),t}zoom(e,t){this.isEmpty()||this.setCoords({center:this.getCenter(),width:e*this.width(),height:t*this.height()})}scale(e){e<0&&this.setEmpty(),this.xmin*=e,this.xmax*=e,this.ymin*=e,this.ymax*=e}equals(e,t){return!(!this.isEmpty()||!e.isEmpty())||(t?Math.abs(this.xmin-e.xmin)<=t&&Math.abs(this.ymin-e.ymin)<=t&&Math.abs(this.xmax-e.xmax)<=t&&Math.abs(this.ymax-e.ymax)<=t:this.xmin===e.xmin&&this.ymin===e.ymin&&this.xmax===e.xmax&&this.ymax===e.ymax)}setCoords(e){void 0!==e.xmin?(this.xmin=e.xmin,this.xmax=e.xmax,this.ymin=e.ymin,this.ymax=e.ymax):void 0!==e.x?(this.xmin=e.x,this.xmax=e.x,this.ymin=e.y,this.ymax=e.y):void 0!==e.pt1?(this.xmin=e.pt1.x,this.ymin=e.pt1.y,this.xmax=e.pt2.x,this.ymax=e.pt2.y,this.normalize()):void 0!==e.env2D?(this.xmin=e.env2D.xmin,this.xmax=e.env2D.xmax,this.ymin=e.env2D.ymin,this.ymax=e.env2D.ymax,this.normalize()):void 0!==e.pt?(this.xmin=e.pt.x,this.xmax=e.pt.x,this.ymin=e.pt.y,this.ymax=e.pt.y):void 0!==e.center?(this.xmin=e.center.x-.5*e.width,this.xmax=this.xmin+e.width,this.ymin=e.center.y-.5*e.height,this.ymax=this.ymin+e.height,this.normalize()):t.throwNotImplementedException("unrecognized input type for setCoords"),this.normalize()}queryIntervalX(e){this.isEmpty()?e.setEmpty():e.setCoords(this.xmin,this.xmax)}queryIntervalY(e){this.isEmpty()?e.setEmpty():e.setCoords(this.ymin,this.ymax)}setFromPoints(e,t){if(0===t)return void this.setEmpty();if(Array.isArray(e)){const s=e;this.setCoords(s[0]);for(let e=1;e<t;){if(!this.isEmpty()){for(let n=e;n<t;n++)this.mergeNe(s[n]);return}this.setCoords(s[e]),e++}return}const s=e;this.setCoords({x:s[0],y:s[1]});for(let e=1,n=2*t;e<n;e+=2){if(!this.isEmpty()){for(let n=e,i=2*t;n<i;n+=2)this.mergeNeCoords(s[n],s[n+1]);return}this.setCoords({x:s[e],y:s[e+1]}),e+=2}}normalize(){let e=!1;this.xmin<=this.xmax||([this.xmin,this.xmax]=[this.xmax,this.xmin],e=!0),this.ymin<=this.ymax||([this.ymin,this.ymax]=[this.ymax,this.ymin],e=!0),!e||this.xmin<=this.xmax&&this.ymin<=this.ymax||this.setEmpty()}isValid(){return this.isEmpty()||this.xmin<=this.xmax&&this.ymin<=this.ymax}getLowerLeft(){return new s.Point2D(this.xmin,this.ymin)}getLowerRight(){return new s.Point2D(this.xmax,this.ymin)}getUpperLeft(){return new s.Point2D(this.xmin,this.ymax)}getUpperRight(){return new s.Point2D(this.xmax,this.ymax)}move(e,t){this.isEmpty()||(this.xmin+=e,this.ymin+=t,this.xmax+=e,this.ymax+=t)}centerAtCoords(e,t){this.move(e-this.getCenterX(),t-this.getCenterY())}centerAt(e){this.centerAtCoords(e.x,e.y)}containsCoords(e,t){return e>=this.xmin&&e<=this.xmax&&t>=this.ymin&&t<=this.ymax}contains(e){return this.containsCoords(e.x,e.y)}containsEnvelope(e){return e.xmin>=this.xmin&&e.xmax<=this.xmax&&e.ymin>=this.ymin&&e.ymax<=this.ymax}containsExclusiveCoords(e,t){return e>this.xmin&&e<this.xmax&&t>this.ymin&&t<this.ymax}containsExclusive(e){return this.containsExclusiveCoords(e.x,e.y)}containsExclusiveEnvelope(e){return e.xmin>this.xmin&&e.xmax<this.xmax&&e.ymin>this.ymin&&e.ymax<this.ymax}isIntersecting(e){return(this.xmin<=e.xmin?this.xmax>=e.xmin:e.xmax>=this.xmin)&&(this.ymin<=e.ymin?this.ymax>=e.ymin:e.ymax>=this.ymin)}isIntersectingNe(e){return(this.xmin<=e.xmin?this.xmax>=e.xmin:e.xmax>=this.xmin)&&(this.ymin<=e.ymin?this.ymax>=e.ymin:e.ymax>=this.ymin)}intersect(e){if(this.isEmpty())return!1;if(e.isEmpty())return this.setEmpty(),!1;e.xmin>this.xmin&&(this.xmin=e.xmin),e.xmax<this.xmax&&(this.xmax=e.xmax),e.ymin>this.ymin&&(this.ymin=e.ymin),e.ymax<this.ymax&&(this.ymax=e.ymax);const t=this.xmin<=this.xmax&&this.ymin<=this.ymax;return t||this.setEmpty(),t}queryCorner(e){switch(3&e){case 0:return new s.Point2D(this.xmin,this.ymin);case 1:return new s.Point2D(this.xmin,this.ymax);case 2:return new s.Point2D(this.xmax,this.ymax);default:return new s.Point2D(this.xmax,this.ymin)}}queryCorners(e){e[0].setCoords(this.xmin,this.ymin),e[1].setCoords(this.xmin,this.ymax),e[2].setCoords(this.xmax,this.ymax),e[3].setCoords(this.xmax,this.ymin)}queryCornersReversed(e){e[0].setCoords(this.xmin,this.ymin),e[1].setCoords(this.xmax,this.ymin),e[2].setCoords(this.xmax,this.ymax),e[3].setCoords(this.xmin,this.ymax)}reaspect(e,t){if(this.isEmpty())return;const s=e/t,n=.5*this.width(),i=.5*this.height()*s;if(n<=i){const e=this.getCenterX();this.xmin=e-i,this.xmax=e+i}else{const e=n/s,t=this.getCenterY();this.ymin=t-e,this.ymax=t+e}this.normalize()}getArea(){return this.isEmpty()?0:this.width()*this.height()}getLength(){return this.isEmpty()?0:2*(this.width()+this.height())}clipCode(e){return(e.x<this.xmin?1:0)|(e.x>this.xmax?1:0)<<1|(e.y<this.ymin?1:0)<<2|(e.y>this.ymax?1:0)<<3}clipLine(e,t){let s=this.clipCode(e),i=this.clipCode(t);if(s&i)return 0;if(!(s|i))return 4;const r=(s?1:0)|(i?2:0);do{const r=t.x-e.x,o=t.y-e.y;if(Math.abs(r)>Math.abs(o)?s&n.XMASK?(s&n.XLESSXMIN?(e.y+=o*(this.xmin-e.x)/r,e.x=this.xmin):(e.y+=o*(this.xmax-e.x)/r,e.x=this.xmax),s=this.clipCode(e)):i&n.XMASK?(i&n.XLESSXMIN?(t.y+=o*(this.xmin-t.x)/r,t.x=this.xmin):(t.y+=o*(this.xmax-t.x)/r,t.x=this.xmax),i=this.clipCode(t)):s?(s&n.YLESSYMIN?(e.x+=r*(this.ymin-e.y)/o,e.y=this.ymin):(e.x+=r*(this.ymax-e.y)/o,e.y=this.ymax),s=this.clipCode(e)):(i&n.YLESSYMIN?(t.x+=r*(this.ymin-t.y)/o,t.y=this.ymin):(t.x+=r*(this.ymax-t.y)/o,t.y=this.ymax),i=this.clipCode(t)):s&n.YMASK?(s&n.YLESSYMIN?(e.x+=r*(this.ymin-e.y)/o,e.y=this.ymin):(e.x+=r*(this.ymax-e.y)/o,e.y=this.ymax),s=this.clipCode(e)):i&n.YMASK?(i&n.YLESSYMIN?(t.x+=r*(this.ymin-t.y)/o,t.y=this.ymin):(t.x+=r*(this.ymax-t.y)/o,t.y=this.ymax),i=this.clipCode(t)):s?(s&n.XLESSXMIN?(e.y+=o*(this.xmin-e.x)/r,e.x=this.xmin):(e.y+=o*(this.xmax-e.x)/r,e.x=this.xmax),s=this.clipCode(e)):(i&n.XLESSXMIN?(t.y+=o*(this.xmin-t.x)/r,t.x=this.xmin):(t.y+=o*(this.xmax-t.x)/r,t.x=this.xmax),i=this.clipCode(t)),s&i)return 0}while(s|i);return r}distanceFromEnvelope(e){return Math.sqrt(this.sqrDistanceEnvelope(e,null,null))}distance(e){return Math.sqrt(this.sqrDistance(e))}sqrDistanceEnvelope(e,t,s){if(!t&&!s){if(this.isEmpty()||e.isEmpty())return Number.NaN;let t,s=0,n=0;return t=this.xmin-e.xmax,t>s&&(s=t),t=this.ymin-e.ymax,t>n&&(n=t),t=e.xmin-this.xmax,t>s&&(s=t),t=e.ymin-this.ymax,t>n&&(n=t),s*s+n*n}if(this.isEmpty()||e.isEmpty())return t&&t.setNAN(),s&&s.setNAN(),Number.NaN;let n,i=0,r=0;const o=Math.max(this.xmin,e.xmin),a=Math.max(this.ymin,e.ymin);return t&&t.setCoords(o,a),s&&s.setCoords(o,a),n=this.xmin-e.xmax,n>i&&(i=n,t&&(t.x=this.xmin),s&&(s.x=e.xmax)),n=this.ymin-e.ymax,n>r&&(r=n,t&&(t.y=this.ymin),s&&(s.y=e.ymax)),n=e.xmin-this.xmax,n>i&&(i=n,t&&(t.x=this.xmax),s&&(s.x=e.xmin)),n=e.ymin-this.ymax,n>r&&(r=n,t&&(t.y=this.ymax),s&&(s.y=e.ymin)),i*i+r*r}sqrDistance(e,t){if(void 0===t){if(this.isEmpty()||e.isNAN())return Number.NaN;let t,s=0,n=0;return t=this.xmin-e.x,t>s&&(s=t),t=this.ymin-e.y,t>n&&(n=t),t=e.x-this.xmax,t>s&&(s=t),t=e.y-this.ymax,t>n&&(n=t),s*s+n*n}if(this.isEmpty()||e.isNAN())return t.setNAN(),Number.NaN;t.assign(e);let s,n=0,i=0;return s=this.xmin-e.x,s>n&&(n=s,t.x=this.xmin),s=this.ymin-e.y,s>i&&(i=s,t.y=this.ymin),s=e.x-this.xmax,s>n&&(n=s,t.x=this.xmax),s=e.y-this.ymax,s>i&&(i=s,t.y=this.ymax),n*n+i*i}sqrMaxMinDistanceEnvelope(e){if(this.isEmpty()||e.isEmpty())return Number.NaN;let t=Number.MAX_VALUE;{const n=s.Point2D.sqrDistanceCoords(this.xmin,this.ymin,e.xmax,e.ymin),i=s.Point2D.sqrDistanceCoords(this.xmin,this.ymin,e.xmax,e.ymax),r=s.Point2D.sqrDistanceCoords(this.xmin,this.ymax,e.xmax,e.ymin),o=s.Point2D.sqrDistanceCoords(this.xmin,this.ymax,e.xmax,e.ymax),a=Math.max(n,i),m=Math.max(r,o),h=Math.max(a,m);t=Math.min(h,t)}{const n=s.Point2D.sqrDistanceCoords(this.xmin,this.ymin,e.xmin,e.ymax),i=s.Point2D.sqrDistanceCoords(this.xmin,this.ymin,e.xmax,e.ymax),r=s.Point2D.sqrDistanceCoords(this.xmax,this.ymin,e.xmin,e.ymax),o=s.Point2D.sqrDistanceCoords(this.xmax,this.ymin,e.xmax,e.ymax),a=Math.max(n,i),m=Math.max(r,o),h=Math.max(a,m);t=Math.min(h,t)}{const n=s.Point2D.sqrDistanceCoords(this.xmax,this.ymin,e.xmin,e.ymin),i=s.Point2D.sqrDistanceCoords(this.xmax,this.ymin,e.xmin,e.ymax),r=s.Point2D.sqrDistanceCoords(this.xmax,this.ymax,e.xmin,e.ymin),o=s.Point2D.sqrDistanceCoords(this.xmax,this.ymax,e.xmin,e.ymax),a=Math.max(n,i),m=Math.max(r,o),h=Math.max(a,m);t=Math.min(h,t)}{const n=s.Point2D.sqrDistanceCoords(this.xmin,this.ymax,e.xmin,e.ymin),i=s.Point2D.sqrDistanceCoords(this.xmin,this.ymax,e.xmax,e.ymin),r=s.Point2D.sqrDistanceCoords(this.xmax,this.ymax,e.xmin,e.ymin),o=s.Point2D.sqrDistanceCoords(this.xmax,this.ymax,e.xmax,e.ymin),a=Math.max(n,i),m=Math.max(r,o),h=Math.max(a,m);t=Math.min(h,t)}return t}sqrMaxDistanceEnvelope(e){if(this.isEmpty()||e.isEmpty())return Number.NaN;let t=0;const n=s.makeObjectArray(s.Point2D,4);this.queryCorners(n);const i=s.makeObjectArray(s.Point2D,4);e.queryCorners(i);for(let e=0;e<4;e++)for(let r=0;r<4;r++){const o=s.Point2D.sqrDistance(n[e],i[r]);o>t&&(t=o)}return t}sqrMaxMinDistance(e){const t=s.Point2D.sqrDistance(e,this.getLowerLeft()),n=s.Point2D.sqrDistance(e,this.getUpperLeft()),i=s.Point2D.sqrDistance(e,this.getLowerRight()),r=s.Point2D.sqrDistance(e,this.getUpperRight());let o,a=Math.max(t,n);return o=Math.max(t,i),a>o&&(a=o),o=Math.max(n,r),a>o&&(a=o),o=Math.max(i,r),a>o&&(a=o),a}sqrMinDistance(e){return this.contains(e)?0:this.sqrDistance(e)}sqrMaxDistance(e){let t=s.Point2D.sqrDistance(e,this.getLowerLeft());return t=Math.max(s.Point2D.sqrDistance(e,this.getUpperLeft()),t),t=Math.max(s.Point2D.sqrDistance(e,this.getUpperRight()),t),t=Math.max(s.Point2D.sqrDistance(e,this.getLowerRight()),t),t}snapToBoundary(e){if(e.isNAN())return!1;if(this.isEmpty())return e.setNAN(),!0;let t=!0;if(e.x<this.xmin?e.x=this.xmin:e.x>this.xmax?e.x=this.xmax:t=!1,e.y<this.ymin?e.y=this.ymin:e.y>this.ymax?e.y=this.ymax:t=!1,t)return!0;if(e.x===this.xmin||e.x===this.xmax||e.y===this.ymin||e.y===this.ymax)return!1;const s=this.xmax-e.x,n=e.x-this.xmin,i=this.ymax-e.y,r=e.y-this.ymin;return Math.max(s,n)>Math.max(i,r)?e.y=r<i?this.ymin:this.ymax:e.x=n<s?this.xmin:this.xmax,!0}snapClip(e){const t=s.snap(e.x,this.xmin,this.xmax),n=s.snap(e.y,this.ymin,this.ymax);return s.Point2D.construct(t,n)}boundaryDistance(e){if(this.isEmpty()||e.isNAN())return Number.NaN;if(e.x===this.xmin)return e.y-this.ymin;const t=this.ymax-this.ymin,n=this.xmax-this.xmin;if(e.y===this.ymax)return t+e.x-this.xmin;if(e.x===this.xmax)return t+n+this.ymax-e.y;if(e.y===this.ymin)return 2*t+n+this.xmax-e.x;const i=new s.Point2D;return i.setCoordsPoint2D(e),this.snapToBoundary(i),this.boundaryDistance(i)}envelopeSide(e){if(this.isEmpty())return-1;let t=this.boundaryDistance(e);const s=this.ymax-this.ymin,n=this.xmax-this.xmin;return t<s?0:(t-=s)<n?1:t-n<s?2:3}querySide(e,s){switch(e){case 0:s.constructFromCoords(this.xmin,this.ymin,this.xmin,this.ymax);break;case 1:s.constructFromCoords(this.xmin,this.ymax,this.xmax,this.ymax);break;case 2:s.constructFromCoords(this.xmax,this.ymax,this.xmax,this.ymin);break;case 3:s.constructFromCoords(this.xmax,this.ymin,this.xmin,this.ymin);break;default:t.throwInvalidArgumentException("query_side")}return s}isPointOnBoundary(e,t){return Math.abs(e.x-this.xmin)<=t||Math.abs(e.x-this.xmax)<=t||Math.abs(e.y-this.ymin)<=t||Math.abs(e.y-this.ymax)<=t}calculateToleranceFromEnvelope(){return this.isEmpty()?s.geomEpsFactor():(Math.abs(this.xmin)+Math.abs(this.xmax)+Math.abs(this.ymin)+Math.abs(this.ymax)+1)*s.geomEpsFactor()}toString(){return`[${this.xmin}, ${this.ymin}, ${this.xmax}, ${this.ymax}]`}}n.XLESSXMIN=1,n.YLESSYMIN=4,n.XMASK=3,n.YMASK=12,e.Envelope2D=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Envelope":function(){define(["exports","./Point2D","./Envelope2D","./Geometry"],function(e,t,s,n){"use strict";const i=[0,0,Number.NaN,0,0,0,0,0,-1,-1,0,0,0,0],r=[2,1,1,1,3,1,2,3,2,4,1,1,2,1],o=[1,1,1,0,2,1,1,1,0,0,0,0,0,1],a=[1,1,1,2,0,0,0,0,2,2,4,2,2,1],m=[4,8,4,8,1];function h(){return t.makePrimitiveArray(25,Number.NaN)}let l=class e{getAttributeCount(){return this.m_attributeCount}getSemantics(e){return this.m_indexToSemantics[e]}getSemanticsBitArray(){return this.m_semanticsBitArray}getAttributeIndex(e){return this.m_semanticsToIndexMap[e]}static getInterpolation(e){return o[e]}static getPersistence(e){return a[e]}static getPersistenceSize(e){return m[e]}static getPersistenceSizeFromSemantics(t){return e.getPersistenceSize(e.getPersistence(t))*e.getComponentCount(t)}static getComponentCount(e){return r[e]}static maxComponentCount(){return 4}static isInteger(e){return 2===e||3===e||4===e}static isIntegerSemantics(t){return e.isInteger(e.getPersistence(t))}static isTexture(e){return 5===e||6===e||7===e}hasAttribute(e){return!!(this.m_semanticsBitArray&1<<e)}hasAttributesFrom(e){return(this.m_semanticsBitArray&e.m_semanticsBitArray)===e.m_semanticsBitArray}hasZ(){return this.hasAttribute(1)}hasM(){return this.hasAttribute(2)}hasID(){return this.hasAttribute(3)}getTotalComponentCount(){return this.m_totalComponentCount}static getDefaultValue(e){return i[e]}static isDefaultValue(e,s){return t.isEqualNonIEEE(i[e],s)}equals(e){return this===e}getDefaultPointAttributes(){return this.m_defaultPointAttributes}getPointAttributeOffset(e){return this.m_pointAttributeOffsets[e]}constructor(s){this.m_semanticsBitArray=s,this.m_attributeCount=0,this.m_totalComponentCount=0,this.m_semanticsToIndexMap=new Int32Array(14),this.m_indexToSemantics=new Int32Array(14),this.m_pointAttributeOffsets=new Int32Array(14),this.m_defaultPointAttributes=t.makePrimitiveArray(25,Number.NaN),this.m_semanticsToIndexMap.fill(-1),this.m_indexToSemantics.fill(-1);let n=0,i=1,r=14;for(;n<r;n++)s&i&&(this.m_semanticsToIndexMap[n]=this.m_attributeCount,this.m_indexToSemantics[this.m_attributeCount]=n,this.m_attributeCount++,this.m_totalComponentCount+=e.getComponentCount(n)),i<<=1;let o=0;for(n=0,r=this.getAttributeCount();n<r;n++){const t=this.getSemantics(n),s=e.getComponentCount(t),i=e.getDefaultValue(t);this.m_pointAttributeOffsets[n]=o;for(let e=0;e<s;e++)this.m_defaultPointAttributes[o]=i,o++}}};var u=l;function c(){return t.makePrimitiveArray(14,0)}class g{static getInstance(){return g.s_thisInstance}constructor(){this.m_map=new Map,this.m_vd2D=new u(1),this.m_map.set(1,this.m_vd2D),this.m_vd3D=new u(3),this.m_map.set(3,this.m_vd2D)}GetVD2D(){return this.m_vd2D}GetVD3D(){return this.m_vd3D}FindOrAdd(e){if(1===e)return this.GetVD2D();if(3===e)return this.GetVD3D();const t=this.m_map.get(e);if(t)return t;const s=new u(e);return this.m_map.set(e,s),s}}function d(e){return g.getInstance().FindOrAdd(e)}function p(e,t){if(!e||!t)return t||e;const s=e.getSemanticsBitArray()|t.getSemanticsBitArray();return(s&e.getSemanticsBitArray())===s?e:(s&t.getSemanticsBitArray())===s?t:d(s)}function _(e,t){const s=e.getSemanticsBitArray()|1<<t;return(s&e.getSemanticsBitArray())===s?e:d(s)}function f(e,t){const s=(e.getSemanticsBitArray()|1<<t)-(1<<t);return s===e.getSemanticsBitArray()?e:d(s)}function y(){return g.getInstance().GetVD2D()}function x(){return g.getInstance().GetVD3D()}function P(e,t,s){if(s.fill(-1),null!==e&&null!==t)for(let n=0,i=e.getAttributeCount();n<i;n++)s[n]=t.getAttributeIndex(e.getSemantics(n))}g.s_thisInstance=new g;class E{static construct(e,t,s){return new E(e,t,s)}constructor(e,t,s){void 0!==e?(this.x=e,this.y=t,this.z=s):this.x=this.y=this.z=Number.NaN}get 0(){return this.x}get 1(){return this.y}get 2(){return this.z}set 0(e){this.x=e}set 1(e){this.y=e}set 2(e){this.z=e}clone(){return new E(this.x,this.y,this.z)}assign(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}setCoords(e,t,s){return this.x=e,this.y=t,this.z=s,this}setCoordsPoint2DZ(e,t){return this.setCoords(e.x,e.y,t)}setCoordsPoint3D(e){this.x=e.x,this.y=e.y,this.z=e.z}setZero(){this.x=0,this.y=0,this.z=0}setNormalized(e){this.assign(e),this.normalizeThis()}normalizeThis(){const e=this.length();return e?(this.x/=e,this.y/=e,this.z/=e):(this.x=1,this.y=0,this.z=0),this}getUnitVector(){const e=new E;return e.setNormalized(this),e}sqrLength(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthXY(){return n.geometryReleaseAssert(0),0}static sqrDistance(e,s){return t.sqr(e.x-s.x)+t.sqr(e.y-s.y)+t.sqr(e.z-s.z)}static sqrDistanceCoords(e,s,n,i,r,o){return t.sqr(e-i)+t.sqr(s-r)+t.sqr(n-o)}static distance(e,t){return Math.sqrt(E.sqrDistance(e,t))}isEqual(e,s){return void 0===s&&(s=0),Math.abs(this.x-e.x)<=s&&Math.abs(this.y-e.y)<=s&&t.isEqualNonIEEETol(this.z,e.z,s)}static compareByLength(e,t,s,i){return n.geometryReleaseAssert(0),0}isEqualCoords(e,t,s,i){return n.geometryReleaseAssert(0),this.x===e&&this.y===t&&this.z===s}isEqualsTols(e,t,s){return n.geometryReleaseAssert(0),!1}isEqualCoordsTols(e,t,s,i,r){return n.geometryReleaseAssert(0),!1}static st_isEqual(e,t,s,i){return n.geometryReleaseAssert(0),!1}equals(e,t){return this.isEqual(e,t)}equalsTols(e,t,s){return n.geometryReleaseAssert(0),!1}divThis(e){return this.x/=e,this.y/=e,this.z/=e,this}subThis(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}setSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}sub(e){return E.construct(this.x-e.x,this.y-e.y,this.z-e.z)}addThis(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}add(e){return this.clone().addThis(e)}setAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}mul(e){return E.construct(this.x*e,this.y*e,this.z*e)}dotProduct(e){return this.x*e.x+this.y*e.y+this.z*e.z}crossProductVector(e){const t=this.y*e.z-e.y*this.z,s=e.x*this.z-this.x*e.z,n=this.x*e.y-e.x*this.y;return new E(t,s,n)}setCrossProductVector(e,t){const s=e.y*t.z-t.y*e.z,n=t.x*e.z-e.x*t.z,i=e.x*t.y-t.x*e.y;return this.x=s,this.y=n,this.z=i,this}setScaled(e,t){return this.x=e*t.x,this.y=e*t.y,this.z=e*t.z,this}scaleThis(e){return this.x*=e,this.y*=e,this.z*=e,this}scaleZThis(e){return this.z*=e,this}setNAN(){return n.geometryReleaseAssert(0),this}isNAN(){return Number.isNaN(this.x)||Number.isNaN(this.y)||Number.isNaN(this.z)}static getNAN(){return E.construct(Number.NaN,Number.NaN,Number.NaN)}isFinite(){return n.geometryReleaseAssert(0),!1}isZero(){return 0===this.x&&0===this.y&&0===this.z}norm(e){return n.geometryReleaseAssert(0),0}sqrDistanceFromCenterToSpheroidSurface(e,t){return n.geometryReleaseAssert(0),0}distanceFromCenterToSpheroidSurface(e,t){return Math.sqrt(this.sqrDistanceFromCenterToSpheroidSurface(e,t))}static getClosestCoordinate(e,t,s,i=!1){return n.geometryReleaseAssert(0),0}compare(e){return this.y<e.y?-1:this.y>e.y?1:this.x<e.x?-1:this.x>e.x?1:this.z<e.z?-1:this.z>e.z?1:0}compareXYZ(e){return n.geometryReleaseAssert(0),0}negateThis(){this.x=-this.x,this.y=-this.y,this.z=-this.z}static averageFast(e,t){return n.geometryReleaseAssert(0),{}}static average(e,t){return n.geometryReleaseAssert(0),{}}static size(){return E.dimensions}static lerp(e,s,n){const i=new E;return t.lerpPoint3D(e,s,n,i),i}static slerp(e,t,s){return n.geometryReleaseAssert(0),{}}static compareVectors(e,t){return n.geometryReleaseAssert(0),0}static selectRightHandedBasisFromNormal(e,t,s){const n=e.getUnitVector(),i=n.createAPerpendicular(),r=new E;r.setCrossProductVector(n,i),r.normalizeThis(),t.setCoordsPoint3D(i),s.setCoordsPoint3D(r)}createAPerpendicular(){const e=[this.crossProductVector(new E(0,0,1)),this.crossProductVector(new E(1,0,0)),this.crossProductVector(new E(0,1,0))],t=[e[0].sqrLength(),e[1].sqrLength(),e[2].sqrLength()],s=e[t.reduce((e,s,n)=>t[e]>t[n]?e:n,0)];return s.normalizeThis(),s}calculateAngle(e){return n.geometryReleaseAssert(0),0}static crossDotSign(e,t,s){return n.geometryReleaseAssert(0),0}static isBisectorRobust(e,t,s){return n.geometryReleaseAssert(0),0}static compareZOrder(e,t){return n.geometryReleaseAssert(0),!1}}E.dimensions=3;class v{static constructEmpty(){return new v(Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN,Number.NaN)}constructor(e,t,s,n,i,r){this.m_EnvelopeType=3,this.xmin=e,this.ymin=t,this.zmin=s,this.xmax=n,this.ymax=i,this.zmax=r,this.normalize()}inflate(e){this.inflateCoords(e,e,e)}inflateCoords(e,t,s){n.geometryReleaseAssert(0)}getEnvelope2D(){return new s.Envelope2D(this.xmin,this.ymin,this.xmax,this.ymax)}getEnvelopeZs(){return new t.Envelope1D(this.zmin,this.zmax)}setEmptyZ(){this.zmin=Number.NaN,this.zmax=Number.NaN}normalize(){let e=!1;this.xmin<=this.xmax||(this.xmax=t.swap(this.xmin,this.xmin=this.xmax),e=!0),this.ymin<=this.ymax||(this.ymax=t.swap(this.ymin,this.ymin=this.ymax),e=!0),!e||this.xmin<=this.xmax&&this.ymin<=this.ymax?this.zmin<=this.zmax||(this.zmax=t.swap(this.zmin,this.zmin=this.zmax),this.zmin<=this.zmax||this.setEmptyZ()):this.setEmpty()}isEmpty(){return Number.isNaN(this.xmin)||Number.isNaN(this.ymin)||Number.isNaN(this.xmax)||Number.isNaN(this.ymax)}isEmptyZ(){return Number.isNaN(this.zmin)||Number.isNaN(this.zmax)}setEmpty(){this.xmin=Number.NaN,this.ymin=Number.NaN,this.zmin=Number.NaN,this.xmax=Number.NaN,this.ymax=Number.NaN,this.zmax=Number.NaN}mergeEnv3D(e){e.isEmpty()||(this.mergeCoords(e.xmin,e.ymin,e.zmin),this.mergeCoords(e.xmax,e.ymax,e.zmax))}mergeNe(e){this.mergeNeCoords(e.x,e.y,e.z)}mergeNeCoords(e,t,s){this.xmin>e?this.xmin=e:this.xmax<e&&(this.xmax=e),this.ymin>t?this.ymin=t:this.ymax<t&&(this.ymax=t),this.zmin>s?this.zmin=s:this.zmax<s&&(this.zmax=s)}mergeCoords(e,t,s){this.isEmpty()?(this.xmin=e,this.xmax=e,this.ymin=t,this.ymax=t,this.zmin=s,this.zmax=s):(this.isEmptyZ()&&(this.zmin=s,this.zmax=s),this.mergeNeCoords(e,t,s))}setCoords(e,t,s,n,i,r){this.xmin=e,this.ymin=t,this.zmin=s,this.xmax=n,this.ymax=i,this.zmax=r,this.normalize()}sqrDistanceEnvelope3DAndPoints(e,t,s,i=1){return n.geometryReleaseAssert(0),0}sqrMaxDistance(e,t=1){return n.geometryReleaseAssert(0),0}}var C=l;function D(e,t,s){switch(e){case 0:return new w(t,s);case 1:return new T(t,s);case 2:return new I(t,s);case 3:throw new Error("64 bit int attribute stream not implemented");case 4:return new S(t,s);default:n.throwInvalidArgumentException("")}}class b{size(){return this.m_size}checkResize(e,t){e>this.m_size&&this.resize(e,t)}resize(e,t){if((e=Math.trunc(e))===this.m_size)return;const s=!!t||Number.isNaN(t);if(e<this.m_a.length)this.m_a.length>b.s_resizeMin&&1.25*e<this.m_a.length&&(this.m_a=this.m_a.slice(0,e)),s&&e>this.m_size&&this.m_a.fill(t,this.m_size,e);else if(e>=this.m_a.length){const n=1.25*e,i=new this.m_a.constructor(n);i.set(this.m_a),this.m_a=i,s&&this.m_a.fill(t,this.m_size,e)}this.m_size=e}resizeRounded(e,t){return this.resize(e,t)}reserve(e){}read(e){return this.m_a[e]}readAsDbl(e){return this.read(e)}write(e,t){this.m_a[e]=t}writeAsDbl(e,t){this.write(e,t)}setRange(e,t,s){(t<0||s<0||s+t>this.size())&&n.throwInvalidArgumentException(),this.m_a.fill(e,t,t+s)}add(e){this.resize(this.m_size+1),this.m_a[this.m_size-1]=e}addArray(e,t){const s=this.m_size;void 0===t?(this.resize(this.m_size+e.length),this.m_a.set(e,s)):(this.resize(this.m_size+t),this.m_a.set(e.slice(0,t),s))}equals(e,s,n,i){return this.getPersistence()===e.getPersistence()&&function(e,s,n,i,r){if(e.getPersistence()!==s.getPersistence())return!1;const o=e.getPersistence()<=1,a=e.size(),m=s.size();if(i>a||i>m)return!1;if(r)if(o){for(let o=n;o<i;o++)if(!t.isEqualNonIEEETol(e.read(o),s.read(o),r))return!1}else for(let t=n;t<i;t++){let n=e.read(t)-s.read(t);if(n<0&&(n=-n),n>r)return!1}else for(let t=n;t<i;t++){const n=e.read(t),i=s.read(t);if(n!==i){if(o&&Number.isNaN(n)&&Number.isNaN(i))continue;return!1}}return!0}(this,e,s,n,i)}insertRange(e,t,s,n){const i=this.m_size;this.checkResize(Math.max(0,n)+s),this.m_a.copyWithin(e+s,e,n>=0?n:i),this.m_a.fill(t,e,e+s)}readRange(e,t){return this.m_a.slice(e,e+t)}insertRangeFromStream(e,t,s,i,r,o,a){n.geometryReleaseAssert(this.getPersistence()===t.getPersistence());const m=t,h=this.m_size;i&&this.checkResize(Math.max(0,a)+i),this.m_a.copyWithin(e+i,e,a>=0?a:h),this.m_a.set(m.readRange(s,i),e),r||this.reverseRange(e,i,o)}writeRange(e,t,s,i,r,o){n.geometryReleaseAssert(this.getPersistence()===s.getPersistence());const a=s;if((e<0||t<0||i<0)&&n.throwInvalidArgumentException(),a.size()<i+t&&n.throwInvalidArgumentException(),0===t)return;this.size()<t+e&&this.resize(t+e);const m=a.m_a.subarray(i,i+t);!function(e,t,s,i){if((t<0||s<0)&&n.throwInvalidArgumentException(),0===s)return;if(1===s)return void(e[t]=i[0]);let r=i;s<i.length&&(r=i.subarray(0,s)),e.set(r,t)}(this.m_a,e,t,m)}insertAttributes(e,t,s,n){const i=C.getComponentCount(s);this.m_a.copyWithin(e+i,e,n>=0?n:this.m_size);for(let n=0;n<i;n++)this.m_a[e+n]=t.getAttributeAsDbl(s,n)}insertAttributesFromPoints(e,s,i,r,o){n.geometryReleaseAssert(C.getPersistence(r)===this.getPersistence());const a=C.getComponentCount(r),m=this.m_size;if(this.checkResize(Math.max(0,o)+a*i),this.m_a.copyWithin(e+a*i,e,o>=0?o:m),0===r){const n=new t.Point2D;for(let t=e,r=0;r<i;r++,t+=2)s[r].queryXY(n),this.m_a[t]=n.x,this.m_a[t+1]=n.y}else if(1===a)for(let t=e,n=0;n<i;n++,t++)this.m_a[t]=s[n].getAttributeAsDbl(r,0);else for(let t=e,n=0;n<i;n++,t+=a)for(let e=0;e<a;e++)this.m_a[t+e]=s[n].getAttributeAsDbl(r,e)}eraseRange(e,t,s){this.m_size<e+t&&n.throwInvalidArgumentException(),this.m_a.copyWithin(e,e+t),this.m_size-=t}reverseRange(e,t,s){if((s<1||t%s!==0)&&n.throwInvalidArgumentException(),this.m_a.subarray(e,e+t).reverse(),s>1)for(let n=e,i=e+t;n<i;n+=s){let e=n,t=n+s-1;for(;e<t;){const s=this.m_a[e];this.m_a[e]=this.m_a[t],this.m_a[t]=s,e++,t--}}}rotate(e,t,s){(t<e||t>s||e>s)&&n.throwOutOfRangeException("rotate"),t!==e&&t!==s&&(this.reverseRange(e,t-e,1),this.reverseRange(t,s-t,1),this.reverseRange(e,s-e,1))}sort(e,t,s){this.m_a.subarray(e,t).sort(s)}constructor(e){if(e.move)this.m_a=e.move.m_a,this.m_size=e.move.m_size,e.move.m_a=e.move.m_a.slice(0,0),e.move.m_size=0;else if(e.copy)this.m_size=e.copy.m_size,e.maxSize&&(this.m_size=Math.min(e.maxSize,this.m_size)),this.m_a=e.copy.m_a.slice(0,this.m_size);else{const t=Math.max(e.size,b.s_constructMin);this.m_a=new e.ctor(t),(e.defaultValue||Number.isNaN(e.defaultValue))&&this.m_a.fill(e.defaultValue),this.m_size=e.size}}}b.s_constructMin=2,b.s_resizeMin=30;class S extends b{setBits(e,t){this.m_a[e]|=t}clearBits(e,t){this.m_a[e]&=~t}getPersistence(){return 4}clone(){return new S({ctor:Int8Array,copy:this})}restrictedClone(e){return new S({ctor:Int8Array,copy:this,maxSize:e})}constructor(e,t){super("number"==typeof e?{ctor:Int8Array,size:e,defaultValue:t}:e)}}class I extends b{getPersistence(){return 2}clone(){return new I({ctor:Int32Array,copy:this})}restrictedClone(e){return new I({ctor:Int32Array,copy:this,maxSize:e})}write(e,s){n.geometryReleaseAssert(s<=t.intMax()),super.write(e,s)}constructor(e,t){super("number"==typeof e?{ctor:Int32Array,size:e,defaultValue:t}:e)}}class w extends b{getPersistence(){return 0}clone(){return new w({ctor:Float32Array,copy:this})}restrictedClone(e){return new w({ctor:Float32Array,copy:this,maxSize:e})}constructor(e,t){super("number"==typeof e?{ctor:Float32Array,size:e,defaultValue:t}:e)}}class T extends b{getPersistence(){return 1}getArray(){return this.m_a}applyTransformation(e,t,s){(1&t||t+2*s>this.size())&&n.throwInvalidArgumentException();const i=0===t?this.m_a:this.m_a.subarray(t);e.transformInterleavedPoints(i,s,i)}readPoint2D(e){const s=this.m_a[e],n=this.m_a[e+1];return new t.Point2D(s,n)}queryPoint2D(e,t){return t.x=this.m_a[e],t.y=this.m_a[e+1],t}writePoint2D(e,t){this.write(e,t.x),this.write(e+1,t.y)}insert(e,t,s){this.checkResize(s+2),this.m_a.copyWithin(e+2,e,s),this.m_a[e]=t.x,this.m_a[e+1]=t.y}insertRangeFromPoints(e,t,s,n,i,r){const o=this.m_size;if(this.checkResize(Math.max(r,0)+2*n),this.m_a.copyWithin(e+2*n,e,r>=0?r:o),i)for(let i=s,r=e,o=0;o<n;++o,++i){const e=t[i];this.m_a[r++]=e.x,this.m_a[r++]=e.y}else for(let i=s+n-1,r=e,o=0;o<n;++o,--i){const e=t[i];this.m_a[r++]=e.x,this.m_a[r++]=e.y}}queryRange(e,t,s,i,r){if((e<0||t<0)&&n.throwInvalidArgumentException(),!i&&(r<=0||t%r!==0)&&n.throwInvalidArgumentException(),0===t)return;if(1===t)return void(s[0]=this.m_a[e]);const o=this.m_a.subarray(e,e+t);s.set(o)}writeRangeFromArray(e,t,s,i,r){if((e<0||t<0)&&n.throwInvalidArgumentException(),0===t)return;if(1===t)return void(this.m_a[e]=s[0]);let o=s;t<s.length&&(o=s.subarray(0,t)),this.m_a.set(o,e)}clone(){return new T({ctor:Float64Array,copy:this})}restrictedClone(e){return new T({ctor:Float64Array,copy:this,maxSize:e})}constructor(e,t){super("number"==typeof e?{ctor:Float64Array,size:e,defaultValue:t}:e)}}class A{constructor(){this.m_minValue=-1,this.m_maxValue=-1,this.m_dy=Number.NaN,this.m_buckets=new I(0),this.m_bucketedIndices=new I(0)}static sortEx(e,t,s,n,i=32){s-t<=i?n.userSort(t,s,e):(new A).sort(e,t,s,n,i)}sort(e,t,s,n,i=32){if(s-t<=i)return void n.userSort(t,s,e);let r=!0,o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let i=t;i<s;i++){const t=n.getValue(e.read(i));t<o&&(o=t),t>a&&(a=t)}if(this.reset(s-t,o,a,s-t)){for(let i=t;i<s;i++){const s=e.read(i),r=n.getValue(s),o=this.getBucket(r);this.m_buckets.write(o,this.m_buckets.read(o)+1),this.m_bucketedIndices.write(i-t,s)}let i=this.m_buckets.read(0);this.m_buckets.write(0,0);for(let e=1,t=this.m_buckets.size();e<t;e++){const t=this.m_buckets.read(e);this.m_buckets.write(e,i),i+=t}for(let i=t;i<s;i++){const s=this.m_bucketedIndices.read(i-t),r=n.getValue(s),o=this.getBucket(r),a=this.m_buckets.read(o);e.write(a+t,s),this.m_buckets.write(o,a+1)}r=!1}if(r)return void n.userSort(t,s,e);let m=0;for(let s=0,i=this.m_buckets.size();s<i;s++){const i=m;m=this.m_buckets.read(s),m>i&&n.userSort(t+i,t+m,e)}this.m_buckets.size()>100&&(this.m_buckets.resize(0),this.m_bucketedIndices.resize(0))}reset(e,t,s,n){if(e<2||s===t)return!1;const i=Math.min(A.c_maxBuckets,e);return this.m_buckets.resize(i),this.m_buckets.setRange(0,0,this.m_buckets.size()),this.m_minValue=t,this.m_maxValue=s,this.m_bucketedIndices.resize(n),this.m_dy=(s-t)/(i-1),!0}getBucket(e){return Math.trunc((e-this.m_minValue)/this.m_dy)}getBucketCount(){return this.m_buckets.size()}}A.c_maxBuckets=65536;class N{capacity(){return this.capacity_}constructor(e){this.m_buffer=new Int32Array(0),this.m_firstFree=-1,this.m_last=0,this.size_=0,this.capacity_=0,this.stride=e}size(){return this.size_}deleteElement(e){e<this.m_last?(this.m_buffer[e*this.stride]=this.m_firstFree,this.m_firstFree=e):this.m_last--,this.size_--}getField(e,t){return this.m_buffer[e*this.stride+t]}setField(e,t,s){this.m_buffer[e*this.stride+t]=s}elementToIndex(e){return e}newElement(){let e=this.m_firstFree;if(-1===e){if(this.m_last===this.capacity_){let e=0!==this.capacity_?Math.trunc(3*(this.capacity_+1)/2):1;if(e>Number.MAX_SAFE_INTEGER&&(e=Number.MAX_SAFE_INTEGER),e===this.capacity_)throw new Error("index out of bounds");this.grow_(e)}e=this.m_last,this.m_last++}else this.m_firstFree=this.m_buffer[e*this.stride];this.size_++;for(let t=e*this.stride;t<e*this.stride+this.stride;t++)this.m_buffer[t]=-1;return e}newElementPset(e){let t=this.m_firstFree;if(-1===t){if(this.m_last===this.capacity_){let e=0!==this.capacity_?Math.trunc(3*(this.capacity_+1)/2):1;if(e>Number.MAX_SAFE_INTEGER&&(e=Number.MAX_SAFE_INTEGER),e===this.capacity_)throw new Error("index out of bounds");this.grow_(e)}t=this.m_last,this.m_last++}else this.m_firstFree=this.m_buffer[t*this.stride];this.size_++;const s=t*this.stride;for(let t=0;t<e.length;t++)this.m_buffer[s+t]=e[t];return t}deleteAll(e){this.m_firstFree=-1,this.m_last=0,this.size_=0,e&&(this.m_buffer=new Int32Array(0),this.capacity_=0)}setCapacity(e){e>this.capacity_&&this.grow_(e)}swap(e,t){const s=e*this.stride,n=t*this.stride;for(let e=0;e<this.stride;e++){const t=this.m_buffer[n+e];this.m_buffer[n+e]=this.m_buffer[s+e],this.m_buffer[s+e]=t}}swapField(e,t,s){const n=this.m_buffer[this.stride*t+s];this.m_buffer[this.stride*t+s]=this.m_buffer[this.stride*e+s],this.m_buffer[this.stride*e+s]=n}static impossibleIndex2(){return-2}static impossibleIndex3(){return-3}static isValidElement(e){return e>=0}grow_(e){null==this.m_buffer&&(this.m_buffer=new Int32Array(0));const t=this.stride*e,s=new Int32Array(t);s.set(this.m_buffer,0),this.m_buffer=s,this.capacity_=e}}class G{constructor(e,t,n){this.m_extent=new s.Envelope2D,this.m_dataExtent=new s.Envelope2D,this.m_childExtents=[new s.Envelope2D,new s.Envelope2D,new s.Envelope2D,new s.Envelope2D],this.m_elementNodes=new N(4),this.m_data=[],this.m_freeData=[],this.m_root=-1,this.m_height=8,void 0===n&&(n=!1),this.m_quadTreeNodes=new N(n?11:10),this.m_bStoreDuplicates=n,this.reset_(e,t)}reset(e,t){this.m_quadTreeNodes.deleteAll(!1),this.m_elementNodes.deleteAll(!1),this.m_data.length=0,this.m_freeData.length=0,this.reset_(e,t)}insert(e,t){if(-1===this.m_root&&this.createRoot_(),this.m_bStoreDuplicates){const s=this.insertDuplicates_(e,t,0,this.m_extent,this.m_root,!1,-1);return-1!==s&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),s}const s=this.insert_(e,t,0,this.m_extent,this.m_root,!1,-1);return-1!==s&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),s}insertEx(e,t,s){if(-1===this.m_root&&this.createRoot_(),this.m_bStoreDuplicates){const s=this.insertDuplicates_(e,t,0,this.m_extent,this.m_root,!1,-1);return-1!==s&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),s}let n;n=-1===s?this.m_root:this.getQuad_(s);const i=this.getHeight(n),r=this.getExtent(n),o=this.insert_(e,t,i,r,n,!1,-1);return-1!==o&&(this.m_dataExtent.isEmpty()?this.m_dataExtent.setCoords({env2D:t}):this.m_dataExtent.mergeEnvelope2D(t)),o}removeElement(e){n.geometryReleaseAssert(0)}getElement(e){return this.getElementValue_(this.getData_(e))}getElementAtIndex(e){return n.geometryReleaseAssert(0),0}getElementExtent(e){const t=this.getData_(e);return this.getBoundingBoxValue_(t).clone()}getElementExtentAtIndex(e){return n.geometryReleaseAssert(0),{}}getDataExtent(){return this.m_dataExtent.clone()}getQuadTreeExtent(){return n.geometryReleaseAssert(0),{}}getHeight(e){return this.m_quadTreeNodes.getField(e,6)>>G.m_heightBitShift}getMaxHeight(){return this.m_height}getExtent(e){const t=new s.Envelope2D;if(t.setCoords({env2D:this.m_extent}),e===this.m_root)return t;const n=[];let i=e;do{n.push(this.getQuadrant_(i)),i=this.getParent_(i)}while(i!==this.m_root);const r=n.length;for(let e=0;e<r;e++){const e=n.at(-1);n.pop(),0===e?(t.xmin=.5*(t.xmin+t.xmax),t.ymin=.5*(t.ymin+t.ymax)):1===e?(t.xmax=.5*(t.xmin+t.xmax),t.ymin=.5*(t.ymin+t.ymax)):2===e?(t.xmax=.5*(t.xmin+t.xmax),t.ymax=.5*(t.ymin+t.ymax)):(t.xmin=.5*(t.xmin+t.xmax),t.ymax=.5*(t.ymin+t.ymax))}return t}getQuad(e){return this.getQuad_(e)}getElementCount(){return-1===this.m_root?0:this.getSubTreeElementCount_(this.m_root)}getSubTreeElementCount(e){return this.getSubTreeElementCount_(e)}getContainedSubTreeElementCount(e){return this.m_bStoreDuplicates?this.getContainedSubTreeElementCount_(e):this.getSubTreeElementCount_(e)}getIntersectionCount(e,n,i){if(-1===this.m_root)return 0;const r=new s.Envelope2D;r.setCoords({env2D:e}),r.inflateCoords(n,n);const o=[],a=[];o.push(this.m_root),a.push(this.m_extent.clone());const m=t.makeObjectArray(s.Envelope2D,4);let h=0;for(;o.length>0;){let e=!1;const t=o.at(-1),s=a.at(-1);if(o.pop(),a.pop(),r.containsEnvelope(s)){if(h+=this.getSubTreeElementCount(t),i>0&&h>=i)return i}else if(r.isIntersecting(s)){for(let e=this.getFirstElement_(t);-1!==e;e=this.getNextElement_(e)){const t=this.getData_(e);if(this.getBoundingBoxValue_(t).isIntersecting(r)&&(h++,i>0&&h>=i))return i}e=this.getHeight(t)+1<=this.m_height}if(e){G.setChildExtents_(s,m);for(let e=0;e<4;e++){const s=this.getChild_(t,e);-1!==s&&this.getSubTreeElementCount_(s)>0&&r.isIntersecting(m[e])&&(o.push(s),a.push(m[e].clone()))}}}return h}hasData(e,t){return this.getIntersectionCount(e,t,1)>=1}getIterator(e,t){return new M(this,e,t)}getIteratorForQT(){return new M(this)}getSortedIterator(e,t){return new R(this.getIterator(e,t))}getSortedIteratorForQT(){return new R(this.getIteratorForQT())}visitLeavesNearest(e,t,s,i){n.geometryReleaseAssert(0)}reset_(e,t){(t<0||t>127)&&n.throwInvalidArgumentException("invalid height"),this.m_height=t,this.m_extent.setCoords({env2D:e}),this.m_dataExtent.setEmpty(),this.m_root=-1}insert_(e,t,n,i,r,o,a){if(!i.containsEnvelope(t))return 0===n?-1:this.insert_(e,t,0,this.m_extent,this.m_root,o,a);if(!o)for(let e=r;-1!==e;e=this.getParent_(e))this.setSubTreeElementCount_(e,this.getSubTreeElementCount_(e)+1);const m=new s.Envelope2D;m.setCoords({env2D:i});let h,l=r;for(h=n;h<this.m_height&&this.canPushDown_(l);h++){G.setChildExtents_(m,this.m_childExtents);let e=!1;for(let s=0;s<4;s++)if(this.m_childExtents[s].containsEnvelope(t)){e=!0;let t=this.getChild_(l,s);-1===t&&(t=this.createChild_(l,s)),this.setSubTreeElementCount_(t,this.getSubTreeElementCount_(t)+1),l=t,m.setCoords({env2D:this.m_childExtents[s]});break}if(!e)break}return this.insertAtQuad_(e,t,h,m,l,o,r,a,-1)}insertDuplicates_(e,n,i,r,o,a,m){if(!a){if(!r.containsEnvelope(n))return-1;this.setSubTreeElementCount_(o,this.getSubTreeElementCount_(o)+1),this.setContainedSubTreeElementCount_(o,this.getContainedSubTreeElementCount_(o)+1)}const h=Math.max(n.width(),n.height());let l=-1;const u=[],c=[],g=[];u.push(o),c.push(r.clone()),g.push(i);const d=t.makeObjectArray(s.Envelope2D,4);for(;u.length>0;){let t=!1;const s=u.at(-1),i=c.at(-1),r=g.at(-1);if(u.pop(),c.pop(),g.pop(),r+1<this.m_height&&this.canPushDown_(s)&&h<=Math.max(i.width(),i.height())/2&&(t=!0),t){G.setChildExtents_(i,d);let e=!1;for(let t=0;t<4;t++)if(e=d[t].containsEnvelope(n),e){let e=this.getChild_(s,t);-1===e&&(e=this.createChild_(s,t)),u.push(e),c.push(d[t].clone()),g.push(r+1),this.setSubTreeElementCount_(e,this.getSubTreeElementCount_(e)+1),this.setContainedSubTreeElementCount_(e,this.getContainedSubTreeElementCount_(e)+1);break}if(!e)for(let e=0;e<4;e++)if(d[e].isIntersecting(n)){let t=this.getChild_(s,e);-1===t&&(t=this.createChild_(s,e)),u.push(t),c.push(d[e].clone()),g.push(r+1),this.setSubTreeElementCount_(t,this.getSubTreeElementCount_(t)+1)}}else l=this.insertAtQuad_(e,n,r,i,s,a,o,m,l),a=!1}return 0}insertAtQuad_(e,t,s,n,i,r,o,a,m){this.getFirstElement_(i);const h=this.getLastElement_(i);let l=-1;if(r){if(i===o)return a;this.disconnectElementHandle_(a),l=a}else-1===m?(l=this.createElement_(),this.setDataValues_(this.getData_(l),e,t)):l=this.createElementFromDuplicate_(m);return this.setQuad_(l,i),-1!==h?(this.setPrevElement_(l,h),this.setNextElement_(h,l)):this.setFirstElement_(i,l),this.setLastElement_(i,l),this.setLocalElementCount_(i,this.getLocalElementCount_(i)+1),this.canFlush_(i)&&this.flush_(s,n,i),l}static setChildExtents_(e,t){const s=.5*(e.xmin+e.xmax),n=.5*(e.ymin+e.ymax);t[0].setCoords({xmin:s,ymin:n,xmax:e.xmax,ymax:e.ymax}),t[1].setCoords({xmin:e.xmin,ymin:n,xmax:s,ymax:e.ymax}),t[2].setCoords({xmin:e.xmin,ymin:e.ymin,xmax:s,ymax:n}),t[3].setCoords({xmin:s,ymin:e.ymin,xmax:e.xmax,ymax:n})}disconnectElementHandle_(e){const t=this.getQuad_(e),s=this.getFirstElement_(t),n=this.getLastElement_(t),i=this.getPrevElement_(e),r=this.getNextElement_(e);s===e?(-1!==r?this.setPrevElement_(r,-1):this.setLastElement_(t,-1),this.setFirstElement_(t,r)):n===e?(this.setNextElement_(i,-1),this.setLastElement_(t,i)):(this.setPrevElement_(r,i),this.setNextElement_(i,r)),this.setPrevElement_(e,-1),this.setNextElement_(e,-1),this.setLocalElementCount_(t,this.getLocalElementCount_(t)-1)}canFlush_(e){return this.getLocalElementCount_(e)===G.m_flushingCount&&!this.hasChildren_(e)}flush_(e,t,n){let i;const r=new s.Envelope2D;let o=this.getFirstElement_(n),a=-1,m=-1;do{m=this.getData_(o),i=this.getElementValue_(m),r.setCoords({env2D:this.getBoundingBoxValue_(m)}),a=this.getNextElement_(o),this.m_bStoreDuplicates?this.insertDuplicates_(i,r,e,t,n,!0,o):this.insert_(i,r,e,t,n,!0,o),o=a}while(-1!==o)}canPushDown_(e){return this.getLocalElementCount_(e)>=G.m_flushingCount||this.hasChildren_(e)}hasChildren_(e){return-1!==this.getChild_(e,0)||-1!==this.getChild_(e,1)||-1!==this.getChild_(e,2)||-1!==this.getChild_(e,3)}createChild_(e,t){const s=this.m_quadTreeNodes.newElement();return this.setChild_(e,t,s),this.setSubTreeElementCount_(s,0),this.setLocalElementCount_(s,0),this.setParent_(s,e),this.setHeightAndQuadrant_(s,this.getHeight_(e)+1,t),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(s,0),s}createRoot_(){this.m_root=this.m_quadTreeNodes.newElement(),this.setSubTreeElementCount_(this.m_root,0),this.setLocalElementCount_(this.m_root,0),this.setHeightAndQuadrant_(this.m_root,0,0),this.m_bStoreDuplicates&&this.setContainedSubTreeElementCount_(this.m_root,0)}createElement_(){const e=this.m_elementNodes.newElement();let t;return this.m_freeData.length>0?(t=this.m_freeData.at(-1),this.m_freeData.pop()):(t=this.m_data.length,this.m_data.length=t+1),this.setData_(e,t),e}createElementFromDuplicate_(e){const t=this.m_elementNodes.newElement(),s=this.getData_(e);return this.setData_(t,s),t}freeElementAndBoxNode_(e){n.geometryReleaseAssert(0)}getChild_(e,t){return this.m_quadTreeNodes.getField(e,t)}setChild_(e,t,s){this.m_quadTreeNodes.setField(e,t,s)}getFirstElement_(e){return this.m_quadTreeNodes.getField(e,4)}setFirstElement_(e,t){this.m_quadTreeNodes.setField(e,4,t)}getLastElement_(e){return this.m_quadTreeNodes.getField(e,5)}setLastElement_(e,t){this.m_quadTreeNodes.setField(e,5,t)}getQuadrant_(e){return this.m_quadTreeNodes.getField(e,6)&G.m_quadrantMask}getHeight_(e){return this.m_quadTreeNodes.getField(e,6)>>G.m_heightBitShift}setHeightAndQuadrant_(e,t,s){const n=t<<G.m_heightBitShift|s;this.m_quadTreeNodes.setField(e,6,n)}getLocalElementCount_(e){return this.m_quadTreeNodes.getField(e,7)}setLocalElementCount_(e,t){this.m_quadTreeNodes.setField(e,7,t)}getSubTreeElementCount_(e){return this.m_quadTreeNodes.getField(e,8)}setSubTreeElementCount_(e,t){this.m_quadTreeNodes.setField(e,8,t)}getParent_(e){return this.m_quadTreeNodes.getField(e,9)}setParent_(e,t){this.m_quadTreeNodes.setField(e,9,t)}getContainedSubTreeElementCount_(e){return this.m_quadTreeNodes.getField(e,10)}setContainedSubTreeElementCount_(e,t){this.m_quadTreeNodes.setField(e,10,t)}getData_(e){return this.m_elementNodes.getField(e,0)}setData_(e,t){this.m_elementNodes.setField(e,0,t)}getPrevElement_(e){return this.m_elementNodes.getField(e,1)}getNextElement_(e){return this.m_elementNodes.getField(e,2)}setPrevElement_(e,t){this.m_elementNodes.setField(e,1,t)}setNextElement_(e,t){this.m_elementNodes.setField(e,2,t)}getQuad_(e){return this.m_elementNodes.getField(e,3)}setQuad_(e,t){this.m_elementNodes.setField(e,3,t)}getElementValue_(e){return this.m_data[e].element}getBoundingBoxValue_(e){return this.m_data[e].box}setDataValues_(e,t,s){this.m_data[e]=function(e,t){return{element:e,box:t.clone()}}(t,s)}}G.m_quadrantMask=3,G.m_heightBitShift=2,G.m_flushingCount=5;class M{constructor(e,n,i){this.m_bLinear=!1,this.m_queryStart=new t.Point2D,this.m_queryEnd=new t.Point2D,this.m_queryBox=new s.Envelope2D,this.m_tolerance=0,this.m_currentElementHandle=-1,this.m_nextElementHandle=-1,this.m_quadsStack=[],this.m_extentsStack=[],this.m_childExtents=[new s.Envelope2D,new s.Envelope2D,new s.Envelope2D,new s.Envelope2D],this.m_quadTree=e,n&&this.resetIterator(n,i)}resetIterator(e,t){if(void 0===t&&(t=0),e instanceof s.Envelope2D)return this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,this.m_queryBox.setCoords({env2D:e}),this.m_queryBox.inflateCoords(t,t),this.m_tolerance=Number.NaN,void(-1!==this.m_quadTree.m_root&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)?(this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root),this.m_bLinear=!1):this.m_nextElementHandle=-1);if(this.m_quadsStack.length=0,this.m_extentsStack.length=0,this.m_currentElementHandle=-1,e.queryLooseEnvelope(this.m_queryBox),this.m_queryBox.inflateCoords(t,t),-1!==this.m_quadTree.m_root&&this.m_queryBox.isIntersecting(this.m_quadTree.m_extent)){const s=e.getGeometryType();if(this.m_bLinear=s===n.GeometryType.enumLine,this.m_bLinear){const s=e;this.m_queryStart.assign(s.getStartXY()),this.m_queryEnd.assign(s.getEndXY()),this.m_tolerance=t}else this.m_tolerance=Number.NaN;this.m_quadsStack.push(this.m_quadTree.m_root),this.m_extentsStack.push(this.m_quadTree.m_extent.clone()),this.m_nextElementHandle=this.m_quadTree.getFirstElement_(this.m_quadTree.m_root)}else this.m_nextElementHandle=-1}next(){if(0===this.m_quadsStack.length)return-1;this.m_currentElementHandle=this.m_nextElementHandle;const e=new t.Point2D,n=new t.Point2D,i=new s.Envelope2D;let r=!1;for(;!r;){for(;-1!==this.m_currentElementHandle;){const t=this.m_quadTree.getData_(this.m_currentElementHandle);if(i.setCoords({env2D:this.m_quadTree.getBoundingBoxValue_(t)}),i.isIntersecting(this.m_queryBox)){if(!this.m_bLinear){r=!0;break}if(e.setCoordsPoint2D(this.m_queryStart),n.setCoordsPoint2D(this.m_queryEnd),i.inflateCoords(this.m_tolerance,this.m_tolerance),i.clipLine(e,n)>0){r=!0;break}}this.m_currentElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle)}if(-1===this.m_currentElementHandle){const t=this.m_quadsStack.at(-1),i=this.m_extentsStack.at(-1);G.setChildExtents_(i,this.m_childExtents),this.m_quadsStack.pop(),this.m_extentsStack.pop();for(let i=0;i<4;i++){const r=this.m_quadTree.getChild_(t,i);if(-1!==r&&this.m_quadTree.getSubTreeElementCount(r)>0&&this.m_childExtents[i].isIntersecting(this.m_queryBox))if(this.m_bLinear){e.setCoordsPoint2D(this.m_queryStart),n.setCoordsPoint2D(this.m_queryEnd);const t=new s.Envelope2D;t.setCoords({env2D:this.m_childExtents[i]}),t.inflateCoords(this.m_tolerance,this.m_tolerance),t.clipLine(e,n)>0&&(this.m_quadsStack.push(r),this.m_extentsStack.push(this.m_childExtents[i].clone()))}else this.m_quadsStack.push(r),this.m_extentsStack.push(this.m_childExtents[i].clone())}if(0===this.m_quadsStack.length)return-1;this.m_currentElementHandle=this.m_quadTree.getFirstElement_(this.m_quadsStack.at(-1))}}return this.m_nextElementHandle=this.m_quadTree.getNextElement_(this.m_currentElementHandle),this.m_currentElementHandle}clone(){return n.geometryReleaseAssert(0),{}}}class R{constructor(e){this.m_bucketSort=new A,this.m_sortedHandles=new I(0),this.m_index=-1,this.m_quadTreeIteratorImpl=e}resetIterator(e,t){this.m_quadTreeIteratorImpl.resetIterator(e,t),this.m_sortedHandles.resize(0),this.m_index=-1}next(){if(-1===this.m_index){let e=-1;for(;-1!==(e=this.m_quadTreeIteratorImpl.next());)this.m_sortedHandles.add(e);const t=this,s={userSort(e,s,n){n.sort(e,s,(e,s)=>t.m_quadTreeIteratorImpl.m_quadTree.getElement(e)-t.m_quadTreeIteratorImpl.m_quadTree.getElement(s))},getValue:e=>t.m_quadTreeIteratorImpl.m_quadTree.getElement(e)};this.m_bucketSort.sort(this.m_sortedHandles,0,this.m_sortedHandles.size(),s)}return this.m_index===this.m_sortedHandles.size()-1?-1:(this.m_index++,this.m_sortedHandles.read(this.m_index))}clone(){return n.geometryReleaseAssert(0),{}}}class k{constructor(e=!1){this.m_bNotifyOnActions=e}onDelete(e){}onSet(e){}onEndSearch(e){}onAddUniqueElementFailed(e){}onDeleteImpl(e,t){this.m_bNotifyOnActions&&this.onDelete(e.getElement(t))}onSetImpl(e,t){this.m_bNotifyOnActions&&this.onSet(e.getElement(t))}onAddUniqueElementFailedImpl(e){this.m_bNotifyOnActions&&this.onAddUniqueElementFailed(e)}onEndSearchImpl(e){this.m_bNotifyOnActions&&this.onEndSearch(e)}}class F{static st_nullNode(){return-1}constructor(){this.m_defaultTreap=-1,this.m_random=124234251,this.m_comparator=null,this.m_treapData=new N(7),this.m_treapCount=0,this.m_maxDepthEver=0,this.m_bBalancing=!0}setComparator(e){this.m_comparator=e}getComparator(){return this.m_comparator}disableBalancing(){this.m_bBalancing=!1}enableBalancing(){this.m_bBalancing||(n.geometryReleaseAssert(this.m_treapCount<=1),this.rebalance(-1),this.m_bBalancing=!0)}isAutoBalancing(){return this.m_bBalancing}rebalance(e){if(this.m_bBalancing)return;if(-1===e&&(e=this.m_defaultTreap),0===this.size(e))return;const t=[];for(let s=this.getFirst(e);-1!==s;s=this.getNext(s))t.push(s),this.setParent_(s,-1),this.setRight_(s,-1),this.setLeft_(s,-1);this.setRoot_(-1,e),this.setFirst_(-1,e),this.setLast_(-1,e),this.setSize_(0,e),this.m_bBalancing=!0;for(const s of t)this.addBiggestElement_(s,e);this.m_bBalancing=!1}setCapacity(e){this.m_treapData.setCapacity(e)}createTreap(e){const t=this.m_treapData.newElement();return this.setSize_(0,t),this.setTreapData_(e,t),this.m_treapCount++,t}deleteTreap(e){this.m_treapData.deleteElement(e),this.m_treapCount--}addElement(e,t=-1){return-1===t&&(this.m_defaultTreap===F.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),t=this.m_defaultTreap),this.addElement_(e,0,t)}addUniqueElement(e,t=-1){return-1===t&&(this.m_defaultTreap===F.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),t=this.m_defaultTreap),this.addElement_(e,1,t)}addBiggestElement(e,t=-1){-1===t&&(this.m_defaultTreap===F.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),t=this.m_defaultTreap);const s=this.newNode_(e);return this.addBiggestElement_(s,t),s}addElementAtPosition(e,s,n,i,r,o=-1){if(-1===o&&(this.m_defaultTreap===F.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),o=this.m_defaultTreap),this.getRoot_(o)===F.st_nullNode()){const e=this.newNode_(n);return this.setRoot_(e,o),this.addToList_(-1,e,o),e}let a,m,h,l,u;if(r?(a=s!==F.st_nullNode()?this.m_comparator.compare(this,n,s):-1,m=e!==F.st_nullNode()?this.m_comparator.compare(this,n,e):1):(a=-1,m=1),i&&(0===a||0===m)){this.m_comparator.onAddUniqueElementFailedImpl(n);const t=0===a?s:e;return this.setDuplicateElement_(t,o),-1}u=s!==F.st_nullNode()&&e!==F.st_nullNode()?this.m_random>t.nextRand(this.m_random)>>1:s!==F.st_nullNode(),u?(l=a,h=s):(l=m,h=e);let c=-1,g=-1,d=!0;for(;;){if(l<0){const e=this.getLeft(h);if(e===F.st_nullNode()){g=h,c=this.newNode_(n),this.setLeft_(h,c),this.setParent_(c,h);break}h=e}else{const e=this.getRight(h);if(e===F.st_nullNode()){g=this.getNext(h),c=this.newNode_(n),this.setRight_(h,c),this.setParent_(c,h);break}h=e}d&&(l*=-1,d=!1)}return this.bubbleUp_(c),this.getParent(c)===F.st_nullNode()&&this.setRoot_(c,o),this.addToList_(g,c,o),c}replaceElementAtPosition(e,t,s,n,i=-1){if(n){const n=this.getNext(e);let r=-1;n!==F.st_nullNode()&&(r=this.m_comparator.compare(this,t,n));const o=this.getPrev(e);let a=-1;if(o!==F.st_nullNode()&&(a=this.m_comparator.compare(this,t,o)),s&&(0===r||0===a)){this.m_comparator.onAddUniqueElementFailedImpl(t);const e=0===r?n:o;return i===F.st_nullNode()&&(this.m_defaultTreap===F.st_nullNode()&&(this.m_defaultTreap=this.createTreap(-1)),i=this.m_defaultTreap),this.setDuplicateElement_(e,i),-1}}return this.setElement_(e,t),e}getDuplicateElement(e=-1){return-1===e?this.getDuplicateElement_(this.m_defaultTreap):this.getDuplicateElement_(e)}deleteNode(e,t=-1){this.m_comparator&&this.m_comparator.onDeleteImpl(this,e),-1===t&&(t=this.m_defaultTreap),this.m_bBalancing?this.deleteNode_(e,t):this.unbalancedDelete_(e,t)}search(e,t=-1){let s=this.getRoot(t);for(;s!==F.st_nullNode();){const t=this.m_comparator.compare(this,e,s);if(!t)return s;s=t<0?this.getLeft(s):this.getRight(s)}return this.m_comparator.onEndSearchImpl(e),F.st_nullNode()}searchLowerBound(e,t=-1){let s=this.getRoot(t),n=-1;for(;s!==F.st_nullNode();){const t=e.compare(this,s);if(!t)return s;t<0?s=this.getLeft(s):(n=s,s=this.getRight(s))}return n}searchUpperBound(e,t=-1){let s=this.getRoot(t),n=-1;for(;s!==F.st_nullNode();){const t=e.compare(this,s);if(!t)return s;t<0?(n=s,s=this.getLeft(s)):s=this.getRight(s)}return n}getElement(e){return this.m_treapData.getField(e,3)}getLeft(e){return this.m_treapData.getField(e,0)}getRight(e){return this.m_treapData.getField(e,1)}getParent(e){return this.m_treapData.getField(e,2)}getNext(e){return this.m_treapData.getField(e,6)}getPrev(e){return this.m_treapData.getField(e,5)}getFirst(e=-1){return-1===e?this.getFirst_(this.m_defaultTreap):this.getFirst_(e)}getLast(e=-1){return-1===e?this.getLast_(this.m_defaultTreap):this.getLast_(e)}getTreapData(e=-1){return-1===e?this.getTreapData_(this.m_defaultTreap):this.getTreapData_(e)}setElement(e,t){null!==this.m_comparator&&this.m_comparator.onSetImpl(this,e),this.setElement_(e,t)}getRoot(e=-1){return-1===e?this.getRoot_(this.m_defaultTreap):this.getRoot_(e)}clear(){this.m_treapData.deleteAll(!1),this.m_defaultTreap=F.st_nullNode(),this.m_treapCount=0,this.m_maxDepthEver=0}addToList_(e,t,s){let n;-1!==e?(n=this.getPrev(e),this.setPrev_(e,t)):n=this.getLast_(s),this.setPrev_(t,n),-1!==n&&this.setNext_(n,t),this.setNext_(t,e),e===this.getFirst_(s)&&this.setFirst_(t,s),-1===e&&this.setLast_(t,s),this.setSize_(this.getSize_(s)+1,s)}size(e=-1){return-1===e?this.getSize_(this.m_defaultTreap):this.getSize_(e)}getMaxDepth(e=-1){return this.getMaxDepthHelper_(this.getRoot(e))}getMaxDepthEver(){return this.m_maxDepthEver}static st_isValidNode(e){return N.isValidElement(e)}dbgCheck_(e){}getPriority_(e){return this.m_treapData.getField(e,4)}bubbleDown_(e){let s=this.getLeft(e),n=this.getRight(e);const i=this.getPriority_(e);for(;s!==F.st_nullNode()||n!==F.st_nullNode();){const r=s!==F.st_nullNode()?this.getPriority_(s):t.indexTypeMax(),o=n!==F.st_nullNode()?this.getPriority_(n):t.indexTypeMax();if(i<=Math.min(r,o))return;r<=o?this.rotateRight_(s):this.rotateLeft_(e),s=this.getLeft(e),n=this.getRight(e)}}bubbleUp_(e){if(!this.m_bBalancing)return;const t=this.getPriority_(e);let s=this.getParent(e);for(;s!==F.st_nullNode()&&this.getPriority_(s)>t;)this.getLeft(s)===e?this.rotateRight_(e):this.rotateLeft_(s),s=this.getParent(e)}rotateLeft_(e){const t=e,s=this.getRight(e);let n;this.setParent_(s,this.getParent(t)),this.setParent_(t,s),n=this.getLeft(s),this.setRight_(t,n),n!==F.st_nullNode()&&this.setParent_(n,t),this.setLeft_(s,t),n=this.getParent(s),n!==F.st_nullNode()&&(this.getLeft(n)===t?this.setLeft_(n,s):this.setRight_(n,s))}rotateRight_(e){const t=this.getParent(e),s=e;let n;this.setParent_(s,this.getParent(t)),this.setParent_(t,s),n=this.getRight(s),this.setLeft_(t,n),n!==F.st_nullNode()&&this.setParent_(n,t),this.setRight_(s,t),n=this.getParent(s),n!==F.st_nullNode()&&(this.getLeft(n)===t?this.setLeft_(n,s):this.setRight_(n,s))}setParent_(e,t){this.m_treapData.setField(e,2,t)}setLeft_(e,t){this.m_treapData.setField(e,0,t)}setRight_(e,t){this.m_treapData.setField(e,1,t)}setPriority_(e,t){this.m_treapData.setField(e,4,t)}setPrev_(e,t){this.m_treapData.setField(e,5,t)}setNext_(e,t){this.m_treapData.setField(e,6,t)}setRoot_(e,t){this.m_treapData.setField(t,0,e)}setFirst_(e,t){this.m_treapData.setField(t,1,e)}setLast_(e,t){this.m_treapData.setField(t,2,e)}setDuplicateElement_(e,t){this.m_treapData.setField(t,3,e)}setSize_(e,t){this.m_treapData.setField(t,4,e)}setTreapData_(e,t){this.m_treapData.setField(t,5,e)}getRoot_(e){return-1===e?F.st_nullNode():this.m_treapData.getField(e,0)}getFirst_(e){return-1===e?F.st_nullNode():this.m_treapData.getField(e,1)}getLast_(e){return-1===e?F.st_nullNode():this.m_treapData.getField(e,2)}getDuplicateElement_(e){return-1===e?F.st_nullNode():this.m_treapData.getField(e,3)}getSize_(e){return-1===e?0:this.m_treapData.getField(e,4)}getTreapData_(e){return this.m_treapData.getField(e,5)}newNode_(e){const t=this.m_treapData.newElement();return this.setPriority_(t,this.generatePriority_()),this.setElement_(t,e),t}freeNode_(e,t){e!==F.st_nullNode()&&this.m_treapData.deleteElement(e)}generatePriority_(){return this.m_random=t.nextRand(this.m_random),this.m_random&t.indexTypeMax()>>1}maxPriority(){return n.geometryReleaseAssert(0),0}getMaxDepthHelper_(e){return e===F.st_nullNode()?0:1+Math.max(this.getMaxDepthHelper_(this.getLeft(e)),this.getMaxDepthHelper_(this.getRight(e)))}addElement_(e,t,s){if(this.getRoot(s)===F.st_nullNode()){const t=this.newNode_(e);return this.setRoot_(t,s),this.addToList_(-1,t,s),this.m_maxDepthEver=Math.max(this.m_maxDepthEver,1),t}let n=this.getRoot_(s),i=-1,r=-1,o=1;for(;;){const a=-1===t?1:this.m_comparator.compare(this,e,n);if(a<0){const t=this.getLeft(n);if(t===F.st_nullNode()){r=n,i=this.newNode_(e),this.setLeft_(n,i),this.setParent_(i,n);break}n=t}else{if(1===t&&0===a)return this.m_comparator.onAddUniqueElementFailedImpl(e),this.setDuplicateElement_(n,s),-1;const o=this.getRight(n);if(o===F.st_nullNode()){r=this.getNext(n),i=this.newNode_(e),this.setRight_(n,i),this.setParent_(i,n);break}n=o}o++}return this.bubbleUp_(i),this.getParent(i)===F.st_nullNode()&&this.setRoot_(i,s),this.addToList_(r,i,s),this.m_maxDepthEver=Math.max(o,this.m_maxDepthEver),i}removeFromList_(e,t){const s=this.getPrev(e),n=this.getNext(e);-1!==s?this.setNext_(s,n):this.setFirst_(n,t),-1!==n?this.setPrev_(n,s):this.setLast_(s,t),this.setSize_(this.getSize_(t)-1,t)}unbalancedDelete_(e,s){this.removeFromList_(e,s);let n=this.getLeft(e),i=this.getRight(e),r=this.getParent(e),o=e;if(-1!==n&&-1!==i){let a;this.m_random=t.nextRand(this.m_random),a=this.m_random>t.indexTypeMax()>>1?this.getNext(e):this.getPrev(e);const m=this.getParent(a)===e;this.m_treapData.swapField(e,a,0),this.m_treapData.swapField(e,a,1),this.m_treapData.swapField(e,a,2),-1!==r?this.getLeft(r)===e?this.setLeft_(r,a):this.setRight_(r,a):this.setRoot_(a,s),m?(n===a?(this.setLeft_(a,e),this.setParent_(i,a)):i===a&&(this.setRight_(a,e),this.setParent_(n,a)),this.setParent_(e,a),r=a):(this.setParent_(n,a),this.setParent_(i,a),r=this.getParent(e),o=a),n=this.getLeft(e),i=this.getRight(e),-1!==n&&this.setParent_(n,e),-1!==i&&this.setParent_(i,e)}const a=-1!==n?n:i;-1===r?this.setRoot_(a,s):this.getLeft(r)===o?this.setLeft_(r,a):this.setRight_(r,a),-1!==a&&this.setParent_(a,r),this.freeNode_(e,s)}deleteNode_(e,s){this.setPriority_(e,t.indexTypeMax());let n=F.st_nullNode(),i=F.st_nullNode();const r=this.getRoot_(s),o=r===e;if(o&&(n=this.getLeft(r),i=this.getRight(r),n===F.st_nullNode()&&i===F.st_nullNode()))return this.removeFromList_(r,s),this.freeNode_(r,s),void this.setRoot_(F.st_nullNode(),s);this.bubbleDown_(e);const a=this.getParent(e);a!==F.st_nullNode()&&(this.getLeft(a)===e?this.setLeft_(a,F.st_nullNode()):this.setRight_(a,F.st_nullNode())),this.removeFromList_(e,s),this.freeNode_(e,s),o&&this.setRoot_(n===F.st_nullNode()||this.getParent(n)!==F.st_nullNode()?i:n,s)}setElement_(e,t){this.m_treapData.setField(e,3,t)}addBiggestElement_(e,t){if(this.getRoot_(t)===F.st_nullNode())return this.setRoot_(e,t),void this.addToList_(-1,e,t);const s=this.getLast_(t);this.setRight_(s,e),this.setParent_(e,s),this.bubbleUp_(e),this.getParent(e)===F.st_nullNode()&&this.setRoot_(e,t),this.addToList_(-1,e,t)}}class q{constructor(e){this.m_lists=new N(6),this.m_listOfLists=q.st_nullNode(),void 0===e?(this.m_listNodes=new N(3),this.m_bStoreListIndexWithNode=!1):(this.m_listNodes=new N(e?4:3),this.m_bStoreListIndexWithNode=e)}freeNode_(e){this.m_listNodes.deleteElement(e)}newNode_(){return this.m_listNodes.newElement()}freeList_(e){n.geometryReleaseAssert(0)}newList_(){return this.m_lists.newElement()}setPrev_(e,t){this.m_listNodes.setField(e,1,t)}setNext_(e,t){this.m_listNodes.setField(e,2,t)}setData_(e,t){n.geometryReleaseAssert(0)}setList_(e,t){return this.m_listNodes.setField(e,3,t)}setListSize_(e,t){this.m_lists.setField(e,4,t)}setNextList_(e,t){n.geometryReleaseAssert(0)}setPrevList_(e,t){this.m_lists.setField(e,2,t)}createList(e){const t=this.newList_();return this.m_lists.setField(t,3,this.m_listOfLists),this.m_lists.setField(t,4,0),this.m_lists.setField(t,5,e),this.m_listOfLists!==q.st_nullNode()&&this.setPrevList_(this.m_listOfLists,t),this.m_listOfLists=t,t}deleteList(e){this.clear(e);const t=this.m_lists.getField(e,2),s=this.m_lists.getField(e,3);return t!==q.st_nullNode()?this.setNextList_(t,s):this.m_listOfLists=s,s!==q.st_nullNode()&&this.setPrevList_(s,t),this.freeList_(e),s}reserveLists(e){n.geometryReleaseAssert(0)}getListData(e){return this.m_lists.getField(e,5)}getList(e){return n.geometryReleaseAssert(0),0}setListData(e,t){this.m_lists.setField(e,5,t)}addElement(e,t){return this.insertElement(e,-1,t)}insertElement(e,t,s){const n=this.newNode_();let i=-1;if(t!==q.st_nullNode()&&(i=this.getPrev(t),this.setPrev_(t,n)),this.setNext_(n,t),i!==q.st_nullNode()&&this.setNext_(i,n),t===this.m_lists.getField(e,0)&&this.m_lists.setField(e,0,n),t===q.st_nullNode()){const t=this.m_lists.getField(e,1);this.setPrev_(n,t),-1!==t&&this.setNext_(t,n),this.m_lists.setField(e,1,n)}return this.setData(n,s),this.setListSize_(e,this.getListSize(e)+1),this.m_bStoreListIndexWithNode&&this.setList_(n,e),n}deleteElement(e,t){const s=this.getPrev(t),n=this.getNext(t);return s!==q.st_nullNode()?this.setNext_(s,n):this.m_lists.setField(e,0,n),n!==q.st_nullNode()?this.setPrev_(n,s):this.m_lists.setField(e,1,s),this.freeNode_(t),this.setListSize_(e,this.getListSize(e)-1),n}reserveNodes(e){this.m_listNodes.setCapacity(e)}getData(e){return this.m_listNodes.getField(e,0)}getElement(e){return this.getData(e)}setData(e,t){this.m_listNodes.setField(e,0,t)}getNext(e){return this.m_listNodes.getField(e,2)}getPrev(e){return this.m_listNodes.getField(e,1)}getFirst(e){return this.m_lists.getField(e,0)}getLast(e){return this.m_lists.getField(e,1)}static st_nullNode(){return-1}clear(e){if(void 0!==e){let t=this.getLast(e);for(;t!==q.st_nullNode();){const e=t;t=this.getPrev(e),this.freeNode_(e)}return this.m_lists.setField(e,0,-1),this.m_lists.setField(e,1,-1),void this.setListSize_(e,0)}for(let e=this.getFirstList();-1!==e;)e=this.deleteList(e)}isEmpty(e){return n.geometryReleaseAssert(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getListSize(e){return this.m_lists.getField(e,4)}getFirstList(){return this.m_listOfLists}getNextList(e){return this.m_lists.getField(e,3)}}class V extends k{constructor(e){super(),this.m_intervalTree=e}compare(e,t,s){const n=e.getElement(s),i=this.m_intervalTree.getValue_(t),r=this.m_intervalTree.getValue_(n);return i<r?-1:i===r?H.isLeft_(t)&&H.isRight_(n)?-1:H.isLeft_(n)&&H.isRight_(t)?1:0:1}}class H{constructor(e){this.m_bEnvelopesRef=!1,this.m_intervals=[],this.m_envelopesRef=null,this.m_intervalNodes=new N(3),this.m_intervalHandles=[],this.m_endIndicesUnique=[],this.m_cCount=-1,this.m_root=-1,this.m_bSortIntervals=!1,this.m_bConstructing=!1,this.m_bConstructionEnded=!1,this.m_bOfflineDynamic=e,this.m_tertiaryNodes=new N(this.m_bOfflineDynamic?5:4),this.m_secondaryTreaps=new F,this.m_secondaryTreaps.setComparator(new V(this)),this.m_secondaryLists=new q}addEnvelopesRef(e){this.reset_(!0,!0),this.m_bEnvelopesRef=!0,this.m_envelopesRef=e,this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_envelopesRef.length)}startConstruction(){this.reset_(!0,!1)}addInterval(e){this.m_bConstructing||n.throwInvalidCallException(""),this.m_intervals.push(e.clone())}addIntervalCoords(e,t){n.geometryReleaseAssert(0)}endConstruction(){this.m_bConstructing||n.throwInvalidCallException(""),this.m_bConstructing=!1,this.m_bConstructionEnded=!0,this.m_bOfflineDynamic||(this.insertIntervalsStatic_(),this.m_cCount=this.m_intervals.length)}insert(e){if(this.m_bOfflineDynamic&&this.m_bConstructionEnded||n.throwInvalidCallException(""),-1===this.m_root){const e=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;if(this.m_bSortIntervals){const t=new I(0);this.querySortedEndPointIndices_(t),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(t),this.m_intervalHandles.length=e,this.m_intervalHandles.fill(-1),this.m_bSortIntervals=!1}else this.m_intervalHandles.fill(-1,0,e);this.m_root=this.createRoot_()}const t=this.insertIntervalEnd_(e<<1,this.m_root),s=this.getSecondaryFromInterval_(t),i=this.m_secondaryTreaps.addElement(1+(e<<1),s);this.setRightEnd_(t,i),this.m_intervalHandles[e]=t,this.m_cCount++}remove(e){this.m_bOfflineDynamic&&this.m_bConstructionEnded||n.throwInvalidCallException("");const t=this.m_intervalHandles[e];let s;-1===t&&n.throwInvalidArgumentException("the interval does not exist in the interval tree"),this.m_intervalHandles[e]=-1,this.m_cCount--;let i=this.getSecondaryFromInterval_(t),r=-1;r=this.m_secondaryTreaps.getTreapData(i),this.m_secondaryTreaps.deleteNode(this.getLeftEnd_(t),i),this.m_secondaryTreaps.deleteNode(this.getRightEnd_(t),i),s=this.m_secondaryTreaps.size(i),0===s&&(this.m_secondaryTreaps.deleteTreap(i),this.setSecondaryToTertiary_(r,-1)),this.m_intervalNodes.deleteElement(t);let o=this.getPptr_(r),a=this.getLptr_(r),m=this.getRptr_(r);for(;!(s>0||r===this.m_root||-1!==a&&-1!==m);)r===this.getLptr_(o)?-1!==a?(this.setLptr_(o,a),this.setPptr_(a,o),this.setLptr_(r,-1),this.setPptr_(r,-1)):-1!==m?(this.setLptr_(o,m),this.setPptr_(m,o),this.setRptr_(r,-1),this.setPptr_(r,-1)):(this.setLptr_(o,-1),this.setPptr_(r,-1)):-1!==a?(this.setRptr_(o,a),this.setPptr_(a,o),this.setLptr_(r,-1),this.setPptr_(r,-1)):-1!==m?(this.setRptr_(o,m),this.setPptr_(m,o),this.setRptr_(r,-1),this.setPptr_(r,-1)):(this.setRptr_(o,-1),this.setPptr_(r,-1)),this.m_tertiaryNodes.deleteElement(r),r=o,i=this.getSecondaryFromTertiary_(r),s=-1!==i?this.m_secondaryTreaps.size(i):0,a=this.getLptr_(r),m=this.getRptr_(r),o=this.getPptr_(r)}size(){return this.m_cCount}getIteratorQuery(e,s){return e instanceof t.Envelope1D?new O(this,e,s):(n.geometryReleaseAssert(0),{})}getIterator(){return new O(this)}querySortedEndPointIndices_(e){const t=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length;for(let s=0;s<2*t;s++)e.add(s);this.sortEndIndices_(e,0,2*t)}querySortedDuplicatesRemoved_(e){let t=Number.NaN;for(let s=0;s<e.size();s++){const n=e.read(s),i=this.getValue_(n);i!==t&&(this.m_endIndicesUnique.push(n),t=i)}}insertIntervalsStatic_(){const e=this.m_bEnvelopesRef?this.m_envelopesRef.length:this.m_intervals.length,s=new I(0);this.querySortedEndPointIndices_(s),this.m_endIndicesUnique.length=0,this.querySortedDuplicatesRemoved_(s),this.m_intervalNodes.setCapacity(e),this.m_secondaryLists.reserveNodes(2*e);const n=t.makePrimitiveArray(e,-1);this.m_root=this.createRoot_();for(let e=0;e<s.size();e++){const t=s.read(e);let i=n[t>>1];if(-1!==i){const e=this.getSecondaryFromInterval_(i);this.setRightEnd_(i,this.m_secondaryLists.addElement(e,t))}else i=this.insertIntervalEnd_(t,this.m_root),n[t>>1]=i}}createRoot_(){const e=this.calculateDiscriminantIndex1_(0,this.m_endIndicesUnique.length-1);return this.createTertiaryNode_(e)}insertIntervalEnd_(e,t){let s=-1,n=t,i=-1,r=-1,o=0,a=this.m_endIndicesUnique.length-1,m=0;const h=e>>1;let l=Number.NaN,u=Number.NaN,c=!0;const g=this.getMin_(h),d=this.getMax_(h);let p=-1;for(;c;){m=o+(a-o>>1),p=this.calculateDiscriminantIndex1_(o,a);const t=this.getDiscriminantFromIndex1_(p);if(d<t){if(-1!==n)if(p===this.getDiscriminantIndex1_(n))s=n,l=t,n=this.getLptr_(n),u=-1!==n?this.getDiscriminant_(n):Number.NaN;else if(u>t){const e=this.createTertiaryNode_(p);t<l?this.setLptr_(s,e):this.setRptr_(s,e),this.setRptr_(e,n),this.m_bOfflineDynamic&&(this.setPptr_(e,s),this.setPptr_(n,e)),s=e,l=t,n=-1,u=Number.NaN}a=m;continue}if(g>t){if(-1!==n)if(p===this.getDiscriminantIndex1_(n))s=n,l=t,n=this.getRptr_(n),u=-1!==n?this.getDiscriminant_(n):Number.NaN;else if(u<t){const e=this.createTertiaryNode_(p);t<l?this.setLptr_(s,e):this.setRptr_(s,e),this.setLptr_(e,n),this.m_bOfflineDynamic&&(this.setPptr_(e,s),this.setPptr_(n,e)),s=e,l=t,n=-1,u=Number.NaN}o=m+1;continue}let h=-1;h=-1===n||p!==this.getDiscriminantIndex1_(n)?this.createTertiaryNode_(p):n,i=this.getSecondaryFromTertiary_(h),-1===i&&(i=this.createSecondary_(h),this.setSecondaryToTertiary_(h,i));const _=this.addEndIndex_(i,e);r=this.createIntervalNode_(),this.setSecondaryToInterval_(r,i),this.setLeftEnd_(r,_),-1!==n&&p===this.getDiscriminantIndex1_(n)||(t<l?this.setLptr_(s,h):this.setRptr_(s,h),this.m_bOfflineDynamic&&this.setPptr_(h,s),-1!==n&&(u<t?this.setLptr_(h,n):this.setRptr_(h,n),this.m_bOfflineDynamic&&this.setPptr_(n,h))),c=!1;break}return r}createTertiaryNode_(e){const t=this.m_tertiaryNodes.newElement();return this.setDiscriminantIndex1_(t,e),t}createSecondary_(e){return this.m_bOfflineDynamic?this.m_secondaryTreaps.createTreap(e):this.m_secondaryLists.createList(e)}createIntervalNode_(){return this.m_intervalNodes.newElement()}reset(){this.m_bOfflineDynamic&&this.m_bConstructionEnded||n.throwInvalidCallException(""),this.reset_(!1,this.m_bEnvelopesRef)}reset_(e,t){e?(this.m_bEnvelopesRef=!1,this.m_envelopesRef=null,this.m_bSortIntervals=!0,this.m_bConstructing=!0,this.m_bConstructionEnded=!1,this.m_endIndicesUnique.length=0,t?(this.m_intervals.length=0,this.m_bEnvelopesRef=!0):this.m_intervals.length=0):this.m_bSortIntervals=!1,this.m_bOfflineDynamic?this.m_secondaryTreaps.clear():this.m_secondaryLists.clear(),this.m_intervalNodes.deleteAll(!1),this.m_tertiaryNodes.deleteAll(!1),this.m_root=-1,this.m_cCount=0}getDiscriminant_(e){const t=this.getDiscriminantIndex1_(e);return this.getDiscriminantFromIndex1_(t)}getDiscriminantFromIndex1_(e){if(-1===e)return Number.NaN;if(e>0){const t=e-2,s=this.m_endIndicesUnique[t],n=this.m_endIndicesUnique[t+1];return.5*(this.getValue_(s)+this.getValue_(n))}const t=-e-2,s=this.m_endIndicesUnique[t];return this.getValue_(s)}calculateDiscriminantIndex1_(e,t){let s;return s=e<t?e+(t-e>>1)+2:-(e+2),s}setDiscriminantIndex1_(e,t){this.m_tertiaryNodes.setField(e,0,t)}setSecondaryToTertiary_(e,t){this.m_tertiaryNodes.setField(e,1,t)}setLptr_(e,t){this.m_tertiaryNodes.setField(e,2,t)}setRptr_(e,t){this.m_tertiaryNodes.setField(e,3,t)}setPptr_(e,t){this.m_tertiaryNodes.setField(e,4,t)}setSecondaryToInterval_(e,t){this.m_intervalNodes.setField(e,0,t)}addEndIndex_(e,t){let s=-1;return s=this.m_bOfflineDynamic?this.m_secondaryTreaps.addElement(t,e):this.m_secondaryLists.addElement(e,t),s}setLeftEnd_(e,t){this.m_intervalNodes.setField(e,1,t)}setRightEnd_(e,t){this.m_intervalNodes.setField(e,2,t)}getFirst_(e){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getFirst(e):this.m_secondaryLists.getFirst(e)}getLast_(e){return this.m_bOfflineDynamic?this.m_secondaryTreaps.getLast(e):this.m_secondaryLists.getLast(e)}static isLeft_(e){return!(1&e)}static isRight_(e){return!(1&~e)}getDiscriminantIndex1_(e){return this.m_tertiaryNodes.getField(e,0)}getSecondaryFromTertiary_(e){return this.m_tertiaryNodes.getField(e,1)}getLptr_(e){return this.m_tertiaryNodes.getField(e,2)}getRptr_(e){return this.m_tertiaryNodes.getField(e,3)}getPptr_(e){return this.m_tertiaryNodes.getField(e,4)}getSecondaryFromInterval_(e){return this.m_intervalNodes.getField(e,0)}getLeftEnd_(e){return this.m_intervalNodes.getField(e,1)}getRightEnd_(e){return this.m_intervalNodes.getField(e,2)}getMin_(e){return this.m_bEnvelopesRef?this.m_envelopesRef[e].xmin:this.m_intervals[e].vmin}getMax_(e){return this.m_bEnvelopesRef?this.m_envelopesRef[e].xmax:this.m_intervals[e].vmax}sortEndIndices_(e,t,s){const n=this,i={userSort(e,t,s){n.sortEndIndicesHelper_(s,e,t)},getValue:e=>n.getValue_(e)};(new A).sort(e,t,s,i)}sortEndIndicesHelper_(e,t,s){e.sort(t,s,(e,t)=>{const s=this.getValue_(e),n=this.getValue_(t);return s<n||s===n&&H.isLeft_(e)&&H.isRight_(t)?-1:1})}getValue_(e){if(!this.m_bEnvelopesRef){const t=this.m_intervals[e>>1];return H.isLeft_(e)?t.vmin:t.vmax}const t=this.m_envelopesRef[e>>1];return H.isLeft_(e)?t.xmin:t.xmax}}class O{constructor(e,s,n){this.m_query=t.Envelope1D.constructEmpty(),this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_nextEndHandle=-1,this.m_tertiaryStack=[],this.m_functionIndex=0,this.m_intervalTree=e,this.m_functionStack=new Array(2),this.m_functionStack[0]=this.nullFunc_,this.m_functionStack[1]=this.nullFunc_,void 0!==s&&this.resetIterator(s,n)}nullFunc_(){return n.throwInternalErrorException("should not be called"),!1}resetIterator(e,s){if("number"==typeof e){const n=new t.Envelope1D;n.setCoords(e,e),this.resetIterator(n,s)}else void 0===s&&(s=0),this.m_query.vmin=e.vmin-s,this.m_query.vmax=e.vmax+s,this.m_tertiaryStack.length=0,this.m_functionIndex=0,this.m_functionStack[0]=this.initialize_}next(){if(this.m_intervalTree.m_bConstructionEnded||n.throwInvalidCallException(""),this.m_functionIndex<0)return-1;for(;this.m_fi=this.m_functionStack[this.m_functionIndex],this.m_fi(););return-1!==this.m_currentEndHandle?this.getCurrentEndIndex_()>>1:-1}initialize_(){return this.m_tertiaryHandle=-1,this.m_nextTertiaryHandle=-1,this.m_forkedHandle=-1,this.m_currentEndHandle=-1,this.m_intervalTree.m_tertiaryNodes.size()>0?(this.m_functionStack[0]=this.pIn_,this.m_nextTertiaryHandle=this.m_intervalTree.m_root,!0):(this.m_functionIndex=-1,!1)}pIn_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,-1===this.m_tertiaryHandle)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;const e=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<e){const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}if(e<this.m_query.vmin){const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(e),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}this.m_functionStack[this.m_functionIndex]=this.pL_,this.m_forkedHandle=this.m_tertiaryHandle;const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_),!0}pL_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,-1===this.m_tertiaryHandle)return this.m_functionStack[this.m_functionIndex]=this.pR_,this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_forkedHandle),!0;if(this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle)<this.m_query.vmin){const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getLast_(e),this.m_functionStack[++this.m_functionIndex]=this.right_),!0}const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_);const t=this.m_intervalTree.getRptr_(this.m_tertiaryHandle);return-1!==t&&this.m_tertiaryStack.push(t),!0}pR_(){if(this.m_tertiaryHandle=this.m_nextTertiaryHandle,-1===this.m_tertiaryHandle)return this.m_functionStack[this.m_functionIndex]=this.pT_,!0;const e=this.m_intervalTree.getDiscriminant_(this.m_tertiaryHandle);if(this.m_query.vmax<e){const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return this.m_nextTertiaryHandle=this.m_intervalTree.getLptr_(this.m_tertiaryHandle),-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.left_),!0}const t=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);this.m_nextTertiaryHandle=this.m_intervalTree.getRptr_(this.m_tertiaryHandle),-1!==t&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(t),this.m_functionStack[++this.m_functionIndex]=this.all_);const s=this.m_intervalTree.getLptr_(this.m_tertiaryHandle);return-1!==s&&this.m_tertiaryStack.push(s),!0}pT_(){if(0===this.m_tertiaryStack.length)return this.m_functionIndex=-1,this.m_currentEndHandle=-1,!1;this.m_tertiaryHandle=this.m_tertiaryStack.at(-1),this.m_tertiaryStack.pop();const e=this.m_intervalTree.getSecondaryFromTertiary_(this.m_tertiaryHandle);return-1!==e&&(this.m_nextEndHandle=this.m_intervalTree.getFirst_(e),this.m_functionStack[++this.m_functionIndex]=this.all_),-1!==this.m_intervalTree.getLptr_(this.m_tertiaryHandle)&&this.m_tertiaryStack.push(this.m_intervalTree.getLptr_(this.m_tertiaryHandle)),-1!==this.m_intervalTree.getRptr_(this.m_tertiaryHandle)&&this.m_tertiaryStack.push(this.m_intervalTree.getRptr_(this.m_tertiaryHandle)),!0}left_(){return this.m_currentEndHandle=this.m_nextEndHandle,-1!==this.m_currentEndHandle&&H.isLeft_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())<=this.m_query.vmax?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}right_(){return this.m_currentEndHandle=this.m_nextEndHandle,-1!==this.m_currentEndHandle&&H.isRight_(this.getCurrentEndIndex_())&&this.m_intervalTree.getValue_(this.getCurrentEndIndex_())>=this.m_query.vmin?(this.m_nextEndHandle=this.getPrev_(),!1):(this.m_functionIndex--,!0)}all_(){return this.m_currentEndHandle=this.m_nextEndHandle,-1!==this.m_currentEndHandle&&H.isLeft_(this.getCurrentEndIndex_())?(this.m_nextEndHandle=this.getNext_(),!1):(this.m_functionIndex--,!0)}getNext_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getNext(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getNext(this.m_currentEndHandle)}getPrev_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getPrev(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getPrev(this.m_currentEndHandle)}getCurrentEndIndex_(){return this.m_intervalTree.m_bOfflineDynamic?this.m_intervalTree.m_secondaryTreaps.getElement(this.m_currentEndHandle):this.m_intervalTree.m_secondaryLists.getData(this.m_currentEndHandle)}}class Y{constructor(){this.m_tolerance=0,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_intervalTreeRed=null,this.m_intervalTreeBlue=null,this.m_iteratorRed=null,this.m_iteratorBlue=null,this.m_envelopesRed=[],this.m_envelopesBlue=[],this.m_elementsRed=[],this.m_elementsBlue=[],this.m_sortedEndIndicesRed=new I(0),this.m_sortedEndIndicesBlue=new I(0),this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_queuedEnvelopes=new q,this.m_queuedIndicesRed=[],this.m_queuedIndicesBlue=[],this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_bDone=!0,this.m_function=this.nullFunc_,this.reset_()}startConstruction(){this.reset_(),this.m_bAddRedRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addEnvelope(e,t){this.m_bAddRedRed||n.throwInvalidCallException(""),this.m_elementsRed.push(e),this.m_envelopesRed.push(new s.Envelope2D(t))}endConstruction(){this.m_bAddRedRed||n.throwInvalidCallException(""),this.m_bAddRedRed=!1,this.m_envelopesRed.length>0&&(this.m_function=this.initialize_,this.m_bDone=!1)}startRedConstruction(){this.reset_(),this.m_bAddRed=!0,this.m_elementsRed.length=0,this.m_envelopesRed.length=0}addRedEnvelope(e,t){this.m_bAddRed||n.throwInvalidCallException(""),this.m_elementsRed.push(e),this.m_envelopesRed.push(t.clone())}endRedConstruction(){this.m_bAddRed||n.throwInvalidCallException(""),this.m_bAddRed=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeBlue_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeRed_),this.m_bDone=!1)}startBlueConstruction(){this.reset_(),this.m_bAddBlue=!0,this.m_elementsBlue.length=0,this.m_envelopesBlue.length=0}addBlueEnvelope(e,t){this.m_bAddBlue||n.throwInvalidCallException(""),this.m_elementsBlue.push(e),this.m_envelopesBlue.push(t.clone())}endBlueConstruction(){this.m_bAddBlue||n.throwInvalidCallException(""),this.m_bAddBlue=!1,this.m_envelopesRed.length>0&&this.m_envelopesBlue.length>0&&(this.m_function===this.nullFunc_||this.m_function===this.initializeRed_?this.m_function=this.initializeRedBlue_:this.m_function!==this.initializeRedBlue_&&(this.m_function=this.initializeBlue_),this.m_bDone=!1)}next(){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}getHandleA(){return this.m_envelopeHandleA}getHandleB(){return this.m_envelopeHandleB}setTolerance(e){this.m_tolerance=e}getElement(e){return this.m_elementsRed[e]}getRedEnvelope(e){return this.m_envelopesRed[e]}getBlueEnvelope(e){return this.m_envelopesBlue[e]}getRedElement(e){return this.m_elementsRed[e]}getBlueElement(e){return this.m_elementsBlue[e]}isTop_(e){return!(1&~e)}isBottom_(e){return!(1&e)}reset_(){this.m_bAddRed=!1,this.m_bAddBlue=!1,this.m_bAddRedRed=!1,this.m_sweepIndexRed=-1,this.m_sweepIndexBlue=-1,this.m_queuedListRed=-1,this.m_queuedListBlue=-1,this.m_bDone=!0}initialize_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new H(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let e=0;e<2*this.m_envelopesRed.length;e++)this.m_sortedEndIndicesRed.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,2*this.m_envelopesRed.length,!0),this.m_sweepIndexRed=2*this.m_envelopesRed.length,this.m_function=this.sweep_,!0}initializeRed_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new H(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),this.m_sortedEndIndicesRed.resize(0);for(let e=0;e<2*this.m_envelopesRed.length;e++)this.m_sortedEndIndicesRed.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_function=this.sweepRedBlue_,this.resetBlue_()}initializeBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new H(!0)),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),null==this.m_iteratorBlue&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator()),this.m_sortedEndIndicesBlue.resize(0);for(let e=0;e<2*this.m_envelopesBlue.length;e++)this.m_sortedEndIndicesBlue.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,this.resetRed_()}initializeRedBlue_(){if(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_envelopesRed.length<10||this.m_envelopesBlue.length<10)return this.m_sweepIndexRed=this.m_envelopesRed.length,this.m_function=this.sweepRedBlueBruteForce_,!0;this.m_intervalTreeRed||(this.m_intervalTreeRed=new H(!0)),this.m_intervalTreeBlue||(this.m_intervalTreeBlue=new H(!0)),this.m_intervalTreeRed.addEnvelopesRef(this.m_envelopesRed),this.m_intervalTreeBlue.addEnvelopesRef(this.m_envelopesBlue),null===this.m_iteratorRed&&(this.m_iteratorRed=this.m_intervalTreeRed.getIterator()),null===this.m_iteratorBlue&&(this.m_iteratorBlue=this.m_intervalTreeBlue.getIterator()),this.m_sortedEndIndicesRed.resize(0),this.m_sortedEndIndicesBlue.resize(0);for(let e=0;e<2*this.m_envelopesRed.length;e++)this.m_sortedEndIndicesRed.add(e);for(let e=0;e<2*this.m_envelopesBlue.length;e++)this.m_sortedEndIndicesBlue.add(e);return this.sortYEndIndices_(this.m_sortedEndIndicesRed,0,this.m_sortedEndIndicesRed.size(),!0),this.sortYEndIndices_(this.m_sortedEndIndicesBlue,0,this.m_sortedEndIndicesBlue.size(),!1),this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_function=this.sweepRedBlue_,!0}sweep_(){const e=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),s=e>>1;if(this.isBottom_(e))return this.m_intervalTreeRed.remove(s),0!==this.m_sweepIndexRed||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);const n=t.Envelope1D.construct(this.m_envelopesRed[s].xmin,this.m_envelopesRed[s].xmax);return this.m_iteratorRed.resetIterator(n,this.m_tolerance),this.m_envelopeHandleA=s,this.m_function=this.iterate_,!0}sweepBruteForce_(){return-1===--this.m_sweepIndexRed?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_sweepIndexRed,this.m_function=this.iterateBruteForce_,!0)}sweepRedBlueBruteForce_(){return-1===--this.m_sweepIndexRed?(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1):(this.m_envelopeHandleA=this.m_sweepIndexRed,this.m_sweepIndexBlue=this.m_envelopesBlue.length,this.m_function=this.iterateRedBlueBruteForce_,!0)}sweepRedBlue_(){const e=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed-1),t=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue-1),s=this.getAdjustedValue_(e,!0),n=this.getAdjustedValue_(t,!1);return s>n?this.sweepRed_():s<n?this.sweepBlue_():this.isTop_(e)?this.sweepRed_():this.isTop_(t)?this.sweepBlue_():this.sweepRed_()}sweepRed_(){const e=this.m_sortedEndIndicesRed.read(--this.m_sweepIndexRed),s=e>>1;if(this.isBottom_(e))return-1!==this.m_queuedListRed&&-1!==this.m_queuedIndicesRed[s]?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,this.m_queuedIndicesRed[s]),this.m_queuedIndicesRed[s]=-1):this.m_intervalTreeRed.remove(s),0!==this.m_sweepIndexRed||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(-1!==this.m_queuedListBlue&&this.m_queuedEnvelopes.getListSize(this.m_queuedListBlue)>0){let e=this.m_queuedEnvelopes.getFirst(this.m_queuedListBlue);for(;-1!==e;){const t=this.m_queuedEnvelopes.getData(e);this.m_intervalTreeBlue.insert(t),this.m_queuedIndicesBlue[t]=-1;const s=this.m_queuedEnvelopes.getNext(e);this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,e),e=s}}if(this.m_intervalTreeBlue.size()>0){const e=t.Envelope1D.construct(this.m_envelopesRed[s].xmin,this.m_envelopesRed[s].xmax);this.m_iteratorBlue.resetIterator(e,this.m_tolerance),this.m_envelopeHandleA=s,this.m_function=this.iterateBlue_}else-1===this.m_queuedListRed&&(t.initializePrimitiveArray(this.m_queuedIndicesRed,this.m_envelopesRed.length,-1),this.m_queuedListRed=this.m_queuedEnvelopes.createList(1)),this.m_queuedIndicesRed[s]=this.m_queuedEnvelopes.addElement(this.m_queuedListRed,s),this.m_function=this.sweepRedBlue_;return!0}sweepBlue_(){const e=this.m_sortedEndIndicesBlue.read(--this.m_sweepIndexBlue),s=e>>1;if(this.isBottom_(e))return-1!==this.m_queuedListBlue&&-1!==this.m_queuedIndicesBlue[s]?(this.m_queuedEnvelopes.deleteElement(this.m_queuedListBlue,this.m_queuedIndicesBlue[s]),this.m_queuedIndicesBlue[s]=-1):this.m_intervalTreeBlue.remove(s),0!==this.m_sweepIndexBlue||(this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1,this.m_bDone=!0,!1);if(-1!==this.m_queuedListRed&&this.m_queuedEnvelopes.getListSize(this.m_queuedListRed)>0){let e=this.m_queuedEnvelopes.getFirst(this.m_queuedListRed);for(;-1!==e;){const t=this.m_queuedEnvelopes.getData(e);this.m_intervalTreeRed.insert(t),this.m_queuedIndicesRed[t]=-1;const s=this.m_queuedEnvelopes.getNext(e);this.m_queuedEnvelopes.deleteElement(this.m_queuedListRed,e),e=s}}if(this.m_intervalTreeRed.size()>0){const e=t.Envelope1D.construct(this.m_envelopesBlue[s].xmin,this.m_envelopesBlue[s].xmax);this.m_iteratorRed.resetIterator(e,this.m_tolerance),this.m_envelopeHandleB=s,this.m_function=this.iterateRed_}else-1===this.m_queuedListBlue&&(t.initializePrimitiveArray(this.m_queuedIndicesBlue,this.m_envelopesBlue.length,-1),this.m_queuedListBlue=this.m_queuedEnvelopes.createList(0)),this.m_queuedIndicesBlue[s]=this.m_queuedEnvelopes.addElement(this.m_queuedListBlue,s),this.m_function=this.sweepRedBlue_;return!0}iterate_(){if(this.m_envelopeHandleB=this.m_iteratorRed.next(),-1!==this.m_envelopeHandleB)return!1;const e=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(e),this.m_function=this.sweep_,!0}iterateRed_(){if(this.m_envelopeHandleA=this.m_iteratorRed.next(),-1!==this.m_envelopeHandleA)return!1;this.m_envelopeHandleA=-1,this.m_envelopeHandleB=-1;const e=this.m_sortedEndIndicesBlue.read(this.m_sweepIndexBlue)>>1;return this.m_intervalTreeBlue.insert(e),this.m_function=this.sweepRedBlue_,!0}iterateBlue_(){if(this.m_envelopeHandleB=this.m_iteratorBlue.next(),-1!==this.m_envelopeHandleB)return!1;const e=this.m_sortedEndIndicesRed.read(this.m_sweepIndexRed)>>1;return this.m_intervalTreeRed.insert(e),this.m_function=this.sweepRedBlue_,!0}iterateBruteForce_(){if(-1===--this.m_sweepIndexBlue)return this.m_function=this.sweepBruteForce_,!0;const e=this.m_envelopesRed[this.m_sweepIndexRed].clone(),t=this.m_envelopesRed[this.m_sweepIndexBlue];return e.inflateCoords(this.m_tolerance,this.m_tolerance),!e.isIntersecting(t)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}iterateRedBlueBruteForce_(){if(-1===--this.m_sweepIndexBlue)return this.m_function=this.sweepRedBlueBruteForce_,!0;const e=this.m_envelopesRed[this.m_sweepIndexRed].clone(),t=this.m_envelopesBlue[this.m_sweepIndexBlue];return e.inflateCoords(this.m_tolerance,this.m_tolerance),!e.isIntersecting(t)||(this.m_envelopeHandleB=this.m_sweepIndexBlue,!1)}resetRed_(){return this.m_sweepIndexRed=this.m_sortedEndIndicesRed.size(),this.m_intervalTreeRed.size()>0&&this.m_intervalTreeRed.reset(),-1!==this.m_queuedListRed&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListRed),this.m_queuedIndicesRed.length=0,this.m_queuedListRed=-1),this.m_bDone=!1,!0}resetBlue_(){return this.m_sweepIndexBlue=this.m_sortedEndIndicesBlue.size(),this.m_intervalTreeBlue.size()>0&&this.m_intervalTreeBlue.reset(),-1!==this.m_queuedListBlue&&(this.m_queuedEnvelopes.deleteList(this.m_queuedListBlue),this.m_queuedIndicesBlue.length=0,this.m_queuedListBlue=-1),this.m_bDone=!1,!0}nullFunc_(){return n.throwInternalErrorException("should not be called"),!1}sortYEndIndices_(e,t,s,n){const i=this,r={userSort(e,t,s){i.sortYEndIndicesHelper_(s,e,t,n)},getValue:e=>i.getAdjustedValue_(e,n)};(new A).sort(e,t,s,r)}sortYEndIndicesHelper_(e,t,s,n){e.sort(t,s,(e,t)=>{const s=this.getAdjustedValue_(e,n),i=this.getAdjustedValue_(t,n);return s<i||s===i&&this.isBottom_(e)&&this.isTop_(t)?-1:1})}getAdjustedValue_(e,t){const s=.5*this.m_tolerance;if(t){const t=this.m_envelopesRed[e>>1];return this.isBottom_(e)?t.ymin-s:t.ymax+s}const n=this.m_envelopesBlue[e>>1];return this.isBottom_(e)?n.ymin-s:n.ymax+s}}var X=l;class L{constructor(e,t){this.tolerance=void 0!==e?e:Number.NaN,this.resolution=void 0!==t?t:Number.NaN}add(e){return new L(this.tolerance+e,this.resolution)}scale(e){return new L(this.tolerance*e,this.resolution*e)}total(){return this.tolerance+this.resolution}}function B(e,t,s){return n=>0===s?(n+e)*t:1*(n-e*t)/t}function z(e,t,s){return W(0,e,t.calculateToleranceFromEnvelope(),s,!1)}function U(e,t,s){return W(1,e,t.calculateToleranceFromEnvelope(),s,!1)}function j(e,t,s=!1){return W(0,e,t.calculateToleranceFromEnvelope(),s,!0).total()}function W(e,t,s,n,i){const r=new L(0,0);if(null!==t&&(r.tolerance=t.getTolerance(e),(!i||n)&&null!==t)){const s=t.getResolution(e);r.resolution=s,n&&(r.resolution*=2)}return n&&(s*=4,r.tolerance*=1.01,r.resolution*=1.01),r.total()<s?new L(s,0):r}function Z(e){return e>=3}function Q(e,t,s,n,i){let r=!1;const o=i.vmin,a=i.vmax;for(let i=s;i<t;i+=n){const t=e.read(i);t<o?(r=!0,e.write(i,o)):t>a&&(r=!0,e.write(i,a))}return r}var K=l;class ${constructor(e){if(this.m_description=null,this.x=Number.NaN,this.y=Number.NaN,this.m_attribs=null,e){if(!e.copy)return e.move?(this.m_description=e.move.m_description,e.move.m_description=null,this.m_attribs=e.move.m_attribs,e.move.m_attribs=null,this.x=e.move.x,void(this.y=e.move.y)):e.vd?(this.m_description=e.vd,void(e.attribBuffer?(this.m_attribs=e.attribBuffer,e.initDefaultValues&&this.setDefaultAttributeValues()):this.ensureAttributes())):e.pt?(this.m_description=y(),void this.setXY(e.pt)):void("x"in e&&("z"in e?(this.m_description=x(),this.ensureAttributes(),this.setXYZ(new E(e.x,e.y,e.z))):(this.m_description=y(),this.setXYCoords(e.x,e.y))));e.copy.copyTo(this)}else this.m_description=y()}assignCopy(e){return this.m_attribs=null,e.copyTo(this),this}assignMove(e){return this.m_attribs=null,e.copyTo(this),e.setEmpty(),this}getXY(){return new t.Point2D(this.x,this.y)}queryXY(e){e.x=this.x,e.y=this.y}setXY(e){this.x=e.x,this.y=e.y}setXYCoords(e,t){this.x=e,this.y=t}getXYZ(){const e=new E;return e.x=this.x,e.y=this.y,e.z=this.getZ(),e}setXYZ(e){this.addAttribute(1),this.x=e.x,this.y=e.y,this.m_attribs[0]=e.z}getX(){return this.x}setX(e){this.x=e}getY(){return this.y}setY(e){this.y=e}getZ(){return this.m_description.hasZ()?this.m_attribs[0]:K.getDefaultValue(1)}setZ(e){this.addAttribute(1),this.m_attribs[0]=e}getM(){return this.getAttributeAsDbl(2,0)}setM(e){this.addAttribute(2),this.m_description.hasZ()?this.m_attribs[1]=e:this.m_attribs[0]=e}getID(){return this.getAttributeAsInt(3,0)}setID(e){this.setAttributeBasic(3,0,e)}isEqualXY(e,t){return void 0===t&&(t=0),Math.abs(e.x-this.x)<=t&&Math.abs(e.y-this.y)<=t}isEqualXYCoords(e,t,s){return void 0===s&&(s=0),Math.abs(e-this.x)<=s&&Math.abs(t-this.y)<=s}getAttributeAsDbl(e,t){if(0===e){if(0===t)return this.x;if(1===t)return this.y;n.throwOutOfRangeException("")}const s=K.getComponentCount(e);(t<0||t>=s)&&n.throwOutOfRangeException("");const i=this.m_description.getAttributeIndex(e);return i>=0?this.m_attribs[this.m_description.getPointAttributeOffset(i)-2+t]:K.getDefaultValue(e)}getAttributeAsInt(e,t){return Math.trunc(this.getAttributeAsDbl(e,t))}setAttributeBasic(e,t,s){if(0===e)return void(0===t?this.x=s:1===t?this.y=s:n.throwOutOfRangeException(""));const i=K.getComponentCount(e);(t<0||t>=i)&&n.throwOutOfRangeException("");let r=this.m_description.getAttributeIndex(e);r<0&&(this.addAttribute(e),r=this.m_description.getAttributeIndex(e)),this.m_attribs[this.m_description.getPointAttributeOffset(r)-2+t]=s}copyAttributesFrom(e,t){if(this===e)return;const s=e.getDescription();for(let n=t&&s.hasZ()?2:1,i=s.getAttributeCount();n<i;++n){const t=s.getSemantics(n),i=K.getComponentCount(t);for(let s=0;s<i;++s){const n=e.getAttributeAsDbl(t,s);this.setAttributeBasic(t,s,n)}}}getAttributeArray(){return this.m_attribs}getDescription(){return this.m_description}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=_(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=f(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=y();e!==this.m_description&&this.assignVertexDescription(e)}getGeometryType(){return n.GeometryType.enumPoint}getDimension(){return 0}queryEnvelope(e){if(e instanceof se)return e.setEmpty(),e.assignVertexDescription(this.m_description),void e.merge(this);if(e instanceof v){if(this.isEmpty())return void e.setEmpty();const t=this.getXYZ();return e.xmin=t.x,e.ymin=t.y,e.zmin=t.z,e.xmax=t.x,e.ymax=t.y,void(e.zmax=t.z)}this.isEmpty()?e.setEmpty():(e.xmin=this.x,e.ymin=this.y,e.xmax=this.x,e.ymax=this.y)}queryLooseEnvelope(e){this.queryEnvelope(e)}queryInterval(e,s){const n=new t.Envelope1D;if(this.isEmpty())return n.setEmpty(),n;const i=this.getAttributeAsDbl(e,s);return n.vmin=i,n.vmax=i,n}applyTransformation(e){if(!this.isEmpty()){if(1===e.m_TransformationType){const t=this.getXY();return e.transformInPlace(t),void this.setXY(t)}n.throwNotImplementedException("3d not impl")}}transformAttribute(e,t,s,n,i){if(this.isEmpty())return;this.addAttribute(e);const r=this.getAttributeAsDbl(e,t),o=B(s,n,i);this.setAttributeBasic(e,t,o(r))}createInstance(){return new $({vd:this.m_description})}copyTo(e){if(this===e)return;e.getGeometryType()!==n.GeometryType.enumPoint&&n.throwInvalidArgumentException();const t=e;t.x=this.x,t.y=this.y,this.m_attribs?(t.assignVertexDescription(this.m_description),t.m_attribs=this.m_attribs.slice()):(t.releaseAttributes(),t.assignVertexDescription(this.m_description))}isEmpty(){return Number.isNaN(this.x)||Number.isNaN(this.y)}setEmpty(){this.m_description||(this.m_description=y(),this.releaseAttributes()),this.x=Number.NaN,this.y=Number.NaN,this.m_attribs&&t.memcpy(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,this.m_description.getTotalComponentCount()-2)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(e){return 0}equals(e,s){if(e===this)return!0;if(e.getGeometryType()!==n.GeometryType.enumPoint)return!1;const i=e;if(this.m_description!==i.m_description)return!1;if(this.isEmpty()!==i.isEmpty())return!1;if(this.isEmpty())return!0;if(void 0===s&&(s=0),Math.abs(this.x-i.x)>s)return!1;if(Math.abs(this.y-i.y)>s)return!1;for(let e=0,n=this.m_description.getTotalComponentCount()-2;e<n;e++)if(!t.isEqualNonIEEETol(this.m_attribs[e],i.m_attribs[e],s))return!1;return!0}getBoundary(){return null}clone(){const e=new $({vd:this.m_description});return this.copyTo(e),e}swap(e){if(this===e)return;e.getGeometryType()!==n.GeometryType.enumPoint&&n.throwInvalidArgumentException("wrong geometry type");const s=e;s.m_description=t.swap(this.m_description,this.m_description=s.m_description),s.x=t.swap(this.x,this.x=s.x),s.y=t.swap(this.y,this.y=s.y),s.m_attribs=t.swap(this.m_attribs,this.m_attribs=s.m_attribs)}replaceNaNs(e,t){if(this.addAttribute(e),this.isEmpty())return;const s=K.getComponentCount(e);for(let n=0;n<s;n++){const s=this.getAttributeAsDbl(e,n);Number.isNaN(s)&&this.setAttributeBasic(e,n,t)}}lerp(e,s,i){if(e.getDescription()!==s.getDescription()&&n.throwInvalidArgumentException("Point.lerp"),this.assignVertexDescription(e.getDescription()),e.isEmpty()||s.isEmpty())return this.setEmpty(),this;this.ensureAttributes();const r=h();e.queryValues(r,r.length);const o=h();s.queryValues(o,o.length);const a=h();let m=r,l=o;const u=a;let c=0;for(let e=0,s=this.m_description.getAttributeCount();e<s;e++){const s=this.m_description.getSemantics(e),n=K.getInterpolation(s),r=K.getComponentCount(s),o=K.getDefaultValue(s);t.interpolateArray(n,m,l,u,c,r,i,o),m=m.slice(r),l=l.slice(r),c+=r}return this.setValues(a,c),this}static lerp(e,t,s,n){n.lerp(e,t,s)}setDefaultAttributeValues(){const e=this.m_description.getTotalComponentCount()-2;e>0&&(this.m_attribs?t.memcpy(this.m_attribs,this.m_description.getDefaultPointAttributes(),0,2,e):this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}static sqrDistance2D(e,s){return t.Point2D.sqrDistanceCoords(e.x,e.y,s.x,s.y)}getImpl(){return this}mergeVertexDescriptionImpl(e){const t=p(this.getDescription(),e);this.assignVertexDescription(t)}releaseAttributes(){this.m_attribs=null}assignVertexDescriptionImpl(e){this.m_description||(this.m_description=y());const t=c();P(e,this.m_description,t);let s=null;e.getTotalComponentCount()-2>0&&(s=e.getDefaultPointAttributes().slice(2));for(let n=1,i=e.getAttributeCount();n<i;n++){const i=t[n];if(-1!==i){const t=this.m_description.getPointAttributeOffset(i)-2,r=e.getPointAttributeOffset(n)-2,o=K.getComponentCount(e.getSemantics(n));for(let e=0;e<o;e++)s[r+e]=this.m_attribs[t+e]}}this.m_attribs=s,this.m_description=e}ensureAttributes(){this.m_description.getTotalComponentCount()-2>0&&null===this.m_attribs&&(this.m_attribs=this.m_description.getDefaultPointAttributes().slice(2))}queryValues(e,s){const i=this.m_description.getTotalComponentCount();n.geometryReleaseAssert(i<=s),e[0]=this.x,e[1]=this.y,t.memcpy(e,this.m_attribs,2,0,i-2)}copyCommonAttributesTo(e){e.x=this.x,e.y=this.y;const s=e.getDescription();if(s===this.m_description)this.m_attribs&&t.memcpy(e.m_attribs,this.m_attribs,0,0,this.m_description.getTotalComponentCount()-2);else{let t=0;for(let n=1,i=s.getAttributeCount();n<i;n++){const i=s.getSemantics(n);let r=K.getComponentCount(i);if(this.m_description.hasAttribute(i)){let s=this.m_description.getPointAttributeOffset(this.m_description.getAttributeIndex(i))-2;for(;0!==r;)e.m_attribs[t++]=this.m_attribs[s++],r--}else{const s=K.getDefaultValue(i);for(;0!==r;)e.m_attribs[t++]=s,r--}}}}setValues(e,s){const i=this.m_description.getTotalComponentCount();n.geometryReleaseAssert(i<=s),this.x=e[0],this.y=e[1],t.memcpy(this.m_attribs,e,0,2,i-2)}dbgDefaultAttribs(){}}$.type=n.GeometryType.enumPoint;var J=l;function ee(e,t){return t*(e.getTotalComponentCount()-2)}class te{constructor(e){if(this.m_attributes=null,e)if(void 0!==e.xmin)this.m_envelope2D=new s.Envelope2D(e.xmin,e.ymin,e.xmax,e.ymax);else if(void 0!==e.env2D)this.m_envelope2D=new s.Envelope2D(e.env2D);else if(e.move)this.m_envelope2D=new s.Envelope2D(e.move.m_envelope2D),this.m_attributes=e.move.m_attributes,e.move.m_attributes=null;else{if(!e.moveEnv)throw new Error("unrecognized EnvelopeData constructor options");{const t=e.moveEnv.accessEnvelopeData();this.m_envelope2D=new s.Envelope2D(t.m_envelope2D),this.m_attributes=t.m_attributes,t.m_attributes=null}}else this.m_envelope2D=s.Envelope2D.constructEmpty()}ensureAttributes(e){const s=e.getTotalComponentCount()-2;!this.m_attributes&&s&&(this.m_attributes=t.makePrimitiveArray(2*s,Number.NaN),this.m_attributes.fill(Number.NaN))}copyTo(e,i){const r=i,o=e.getTotalComponentCount()-2;if(r.m_description!==e&&(r.releaseAttributes_(),r.m_description=e,o&&(r.m_data.m_attributes=t.makePrimitiveArray(2*o,Number.NaN))),o){n.geometryReleaseAssert(this.m_attributes&&r.m_data.m_attributes);const e=2*o;t.memcpy(r.m_data.m_attributes,this.m_attributes,0,0,e)}r.m_data.m_envelope2D=new s.Envelope2D(this.m_envelope2D)}copyToIfNotNull(e,t){t.m_envelope2D=new s.Envelope2D(this.m_envelope2D),t.releaseAttributes(),e.getTotalComponentCount()-2&&this.m_attributes&&(t.m_attributes=this.m_attributes.slice())}releaseAttributes(){this.m_attributes=null}isEmpty(){return this.m_envelope2D.isEmpty()}transformAttribute(e,t,s,i,r){n.geometryReleaseAssert(0)}queryInterval(e,t,s,i){if(this.isEmpty())return void i.setEmpty();if(0===t)return void(0===s?this.m_envelope2D.queryIntervalX(i):1===s?this.m_envelope2D.queryIntervalY(i):n.throwOutOfRangeException(""));const r=J.getComponentCount(t);(s<0||s>=r)&&n.throwOutOfRangeException("");const o=e.getAttributeIndex(t);if(o>=0)return i.vmin=this.m_attributes[ee(e,0)+e.getPointAttributeOffset(o)-2+s],void(i.vmax=this.m_attributes[ee(e,1)+e.getPointAttributeOffset(o)-2+s]);{const e=J.getDefaultValue(t);return void i.setCoords(e,e)}}queryEnvelope3D(e,s){const n=new t.Envelope1D;this.queryInterval(e,1,0,n),s.setCoords(this.m_envelope2D.xmin,this.m_envelope2D.ymin,n.vmin,this.m_envelope2D.xmax,this.m_envelope2D.ymax,n.vmax)}setEmpty(e){this.m_envelope2D.setEmpty();const s=e.getTotalComponentCount()-2;s&&(this.m_attributes?this.dbgAssertSize(s):this.m_attributes=t.makePrimitiveArray(2*s,Number.NaN),this.m_attributes.fill(Number.NaN))}dbgAssertSize(e){}}let se=class e{constructor(e){if(this.m_EnvelopeType=4,this.m_description=y(),void 0===e)this.m_data=new te;else if(void 0!==e.vd)this.m_description=e.vd,this.m_data=new te,this.ensureAttributes_();else if(e?.env2D)this.m_data=new te({env2D:e.env2D});else if(void 0!==e.xmin)this.m_data=new te({xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax});else if(e.copy)this.m_data=new te,e.copy.copyTo(this);else if(e.move)this.m_description=e.move.m_description,e.move.m_description=null,this.m_data=new te({move:e.move.m_data});else{if(!e.centerPoint)throw new Error("unrecognized Envelope constructor options");this.m_description=e.centerPoint.getDescription(),this.m_data=new te,this.ensureAttributes_(),this.setFromPoint(e.centerPoint,e.width,e.height)}}accessEnvelopeData(){return this.m_description=null,this.m_data}assignMove(e){return this===e||(this.m_description=e.m_description,e.m_description=null,this.m_data=new te({move:e.m_data})),this}assignCopy(e){return this===e||e.copyTo(this),this}transformAttribute(e,t,s,i,r){n.geometryReleaseAssert(0)}setAttributeBasic(e,t,s){if(this.addAttribute(e),this.m_data.isEmpty())return;const n=this.queryInterval(e,t);n.vmin=s,n.vmax=s,this.setIntervalEnvelope(e,t,n)}mergeVertexDescriptionImpl(e){const t=p(this.getDescription(),e);this.assignVertexDescription(t)}asEnvelope2D(){return new s.Envelope2D(this.m_data.m_envelope2D)}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}getGeometryType(){return n.GeometryType.enumEnvelope}getDimension(){return 2}getXMin(){return this.m_data.m_envelope2D.xmin}getYMin(){return this.m_data.m_envelope2D.ymin}getXMax(){return this.m_data.m_envelope2D.xmax}getYMax(){return this.m_data.m_envelope2D.ymax}width(){return this.m_data.isEmpty()?Number.NaN:this.m_data.m_envelope2D.width()}height(){return this.m_data.isEmpty()?Number.NaN:this.m_data.m_envelope2D.height()}getCenterXY(){return this.m_data.isEmpty()?new t.Point2D:this.m_data.m_envelope2D.getCenter()}getCenter(e){if(e.assignVertexDescription(this.m_description),this.m_data.isEmpty())return void e.setEmpty();const t=this.m_description.getAttributeCount();for(let s=1;s<t;s++){const t=this.m_description.getSemantics(s),n=J.getComponentCount(t);for(let s=0;s<n;s++){const n=.5*(this.getAttributeAsDblImpl(0,t,s)+this.getAttributeAsDblImpl(1,t,s));e.setAttributeBasic(t,s,n)}}e.setXY(this.m_data.m_envelope2D.getCenter())}setCoords(e,t,s,n){this.m_data.m_envelope2D.setCoords({xmin:e,ymin:t,xmax:s,ymax:n})}setEnvelope(e){if(e instanceof s.Envelope2D)this.m_data.m_envelope2D=new s.Envelope2D(e),this.m_data.m_envelope2D.normalize();else{this.addAttribute(1),this.m_data.m_envelope2D=e.getEnvelope2D(),this.m_data.m_envelope2D.normalize();const s=t.Envelope1D.constructEmpty();s.setCoords(e.zmin,e.zmax),this.setInterval(1,0,s.vmin,s.vmax)}}merge(t){if(t instanceof s.Envelope2D)return t.isValid()||n.throwInvalidArgumentException(""),void this.m_data.m_envelope2D.mergeEnvelope2D(t);if(t instanceof e){if(t.m_data.isEmpty())return;const e=t.getDescription();this.mergeVertexDescription(e),this.m_data.m_envelope2D.mergeEnvelope2D(t.m_data.m_envelope2D);for(let s=1,n=e.getAttributeCount();s<n;s++){const n=e.getSemantics(s),i=J.getComponentCount(n);for(let e=0;e<i;e++){const s=t.queryInterval(n,e),i=this.queryInterval(n,e);i.merge(s),this.setIntervalEnvelope(n,e,i)}}return}if(t instanceof $){const e=t;if(e.isEmpty())return;const s=e.getDescription();if(this.mergeVertexDescription(s),this.m_data.isEmpty())return void this.setFromPoint(e);this.m_data.m_envelope2D.merge(e.getXY());for(let t=1,n=s.getAttributeCount();t<n;t++){const n=s.getSemantics(t),i=J.getComponentCount(n);for(let t=0;t<i;t++){const s=e.getAttributeAsDbl(n,t),i=this.queryInterval(n,t);i.mergeCoordinate(s),this.setIntervalEnvelope(n,t,i)}}return}n.throwNotImplementedException("unrecognized type for envelope.merge")}intersect(e){if(!this.m_data.m_envelope2D.intersect(e.m_data.m_envelope2D))return this.setEmpty(),!1;const t=e.getDescription();this.mergeVertexDescription(t);for(let t=1,s=this.m_description.getAttributeCount();t<s;t++){const s=this.m_description.getSemantics(t),n=J.getComponentCount(s);for(let t=0;t<n;t++){const n=e.queryInterval(s,t),i=this.queryInterval(s,t);i.intersect(n),this.setIntervalEnvelope(s,t,i)}}return!0}intersectCommonAttributes(e){if(!this.m_data.m_envelope2D.intersect(e.m_data.m_envelope2D))return this.setEmpty(),!1;const t=e.getDescription();for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){const n=this.m_description.getSemantics(s);if(!t.hasAttribute(n))continue;const i=J.getComponentCount(n);for(let t=0;t<i;t++){const s=e.queryInterval(n,t),i=this.queryInterval(n,t);i.intersect(s),this.setIntervalEnvelope(n,t,i)}}return!0}move(e,t){this.m_data.m_envelope2D.move(e,t)}centerAt(e,t){this.m_data.m_envelope2D.centerAtCoords(e,t)}centerAtPoint(e){this.m_data.m_envelope2D.centerAt(e)}reaspect(e,t){this.m_data.m_envelope2D.reaspect(e,t)}inflateCoords(e,t){this.m_data.m_envelope2D.inflateCoords(e,t)}containsCoords(e,t){return this.m_data.m_envelope2D.containsCoords(e,t)}contains(e){return this.m_data.m_envelope2D.contains(e)}containsPoint(e){return!e.isEmpty()&&this.m_data.m_envelope2D.contains(e.getXY())}containsEnvelope(e){return this.m_data.m_envelope2D.containsEnvelope(e.m_data.m_envelope2D)}setIntervalEnvelope(e,s,i){if(this.addAttribute(e),this.m_data.isEmpty())return;const r=new t.Envelope1D(i);if(r.normalize(),0===e){if(r.isEmpty())return void this.setEmpty();0===s?(this.m_data.m_envelope2D.xmin=r.vmin,this.m_data.m_envelope2D.xmax=r.vmax):1===s?(this.m_data.m_envelope2D.ymin=r.vmin,this.m_data.m_envelope2D.ymax=r.vmax):n.throwOutOfRangeException("")}else this.setAttributeAsDblImpl(0,e,s,r.vmin),this.setAttributeAsDblImpl(1,e,s,r.vmax)}setInterval(e,s,n,i){this.setIntervalEnvelope(e,s,new t.Envelope1D(n,i))}queryInterval(e,s){const n=new t.Envelope1D;return this.m_data.queryInterval(this.m_description,e,s,n),n}queryEnvelope(e){2!==e.m_EnvelopeType?3!==e.m_EnvelopeType?4!==e.m_EnvelopeType?n.throwNotImplementedException("unrecognized type for queryEnveloper"):this.copyTo(e):this.m_data.queryEnvelope3D(this.m_description,e):e.setCoords({env2D:this.m_data.m_envelope2D})}applyTransformation(e){1!==e.m_TransformationType?n.geometryReleaseAssert(0):e.transformEnvInPlace(this.m_data.m_envelope2D)}createInstance(){return new e({vd:this.m_description})}copyTo(e){e!==this&&this.m_data.copyTo(this.m_description,e)}isEmpty(){return this.m_data.isEmpty()}setEmpty(){this.m_description||(this.m_description=y()),this.m_data.setEmpty(this.m_description)}calculateArea2D(){return this.m_data.m_envelope2D.getArea()}calculateLength2D(){return this.m_data.m_envelope2D.getLength()}calculateLength3D(e){return n.geometryReleaseAssert(0),0}equals(e,s){if(e===this)return!0;const n=e;if(this.m_description!==n.m_description)return!1;if(this.m_data.isEmpty()!==n.m_data.isEmpty())return!1;if(this.m_data.isEmpty())return!0;if(void 0===s&&(s=0),Math.abs(this.m_data.m_envelope2D.xmin-n.m_data.m_envelope2D.xmin)>s)return!1;if(Math.abs(this.m_data.m_envelope2D.ymin-n.m_data.m_envelope2D.ymin)>s)return!1;if(Math.abs(this.m_data.m_envelope2D.xmax-n.m_data.m_envelope2D.xmax)>s)return!1;if(Math.abs(this.m_data.m_envelope2D.ymax-n.m_data.m_envelope2D.ymax)>s)return!1;for(let e=0,i=2*(this.m_description.getTotalComponentCount()-2);e<i;e++)if(!t.isEqualNonIEEETol(this.m_data.m_attributes[e],n.m_data.m_attributes[e],s))return!1;return!0}getBoundary(){return n.throwNotImplementedException("getBoundary not available in this context. Use the boundary operator with an envelope parameter"),null}clone(){return new e({copy:this})}swap(e){if(this===e)return;e.getGeometryType()!==n.GeometryType.enumEnvelope&&n.throwInvalidArgumentException("wrong geometry type");const s=e;s.m_description=t.swap(this.m_description,this.m_description=s.m_description),s.m_data.m_envelope2D=t.swap(this.m_data.m_envelope2D,this.m_data.m_envelope2D=s.m_data.m_envelope2D),s.m_data.m_attributes=t.swap(this.m_data.m_attributes,this.m_data.m_attributes=s.m_data.m_attributes)}queryCoordinates(e){this.m_data.isEmpty()&&n.throwInvalidArgumentException(""),this.m_data.m_envelope2D.queryCorners(e)}queryCornerByVal(e,t){(e<0||e>3)&&n.throwOutOfRangeException(""),t.assignVertexDescription(this.m_description);const s=this.getDescription().getAttributeCount();for(let n=1;n<s;n++){const s=this.m_description.getSemantics(n),i=J.getComponentCount(s);for(let n=0;n<i;n++)t.setAttributeBasic(s,n,this.getAttributeAsDblImpl(e%2,s,n))}t.setXY(this.m_data.m_envelope2D.queryCorner(e))}queryCorner(e,t){t.assign(this.m_data.m_envelope2D.queryCorner(e))}getDescription(){return this.m_description}mergeVertexDescription(e){this.m_description!==e&&(this.m_description&&this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=_(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=f(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=y();e!==this.m_description&&this.assignVertexDescription(e)}queryLooseEnvelope(e){this.queryEnvelope(e)}replaceNaNs(e,t){if(this.addAttribute(e),this.m_data.isEmpty())return;const s=J.getComponentCount(e);for(let n=0;n<s;n++){const s=this.queryInterval(e,n);s.isEmpty()&&(s.vmin=t,s.vmax=t,this.setIntervalEnvelope(e,n,s))}}getImpl(){return this}setFromPoint(e,t,s){this.m_data.m_envelope2D.setCoords({center:e.getXY(),width:t??0,height:s??0});const n=e.getDescription();for(let t=1,s=n.getAttributeCount();t<s;t++){const s=n.getSemantics(t),i=J.getComponentCount(s);for(let t=0;t<i;t++){const n=e.getAttributeAsDbl(s,t);this.setInterval(s,t,n,n)}}}assignVertexDescriptionImpl(e){const s=c();P(e,this.m_description,s);let n=null;const i=e.getTotalComponentCount()-2,r=this.m_description?this.m_description.getTotalComponentCount()-2:0;i>0&&(n=t.makePrimitiveArray(2*i,Number.NaN));for(let o=1;o<e.getAttributeCount();o++){const a=s[o];if(-1!==a){const s=e.getPointAttributeOffset(o)-2,m=J.getComponentCount(e.getSemantics(o)),h=this.m_description.getPointAttributeOffset(a)-2;t.memcpy(n,this.m_data.m_attributes,s,h,m),t.memcpy(n,this.m_data.m_attributes,i+s,r+h,m)}}this.releaseAttributes_(),this.m_data.m_attributes=n,this.m_description=e}getAttributeAsDblImpl(e,t,s){if(this.m_data.isEmpty()&&n.throwEmptyGeometryException(""),0===t)return e?s?this.m_data.m_envelope2D.ymax:this.m_data.m_envelope2D.xmax:s?this.m_data.m_envelope2D.ymin:this.m_data.m_envelope2D.xmin;s>=J.getComponentCount(t)&&n.throwOutOfRangeException("");const i=this.m_description.getAttributeIndex(t);return i>=0?this.m_data.m_attributes[ee(this.m_description,e)+this.m_description.getPointAttributeOffset(i)-2+s]:l.getDefaultValue(t)}setAttributeAsDblImpl(e,t,s,i){0===t&&(e?1===s?this.m_data.m_envelope2D.ymax=i:0===s?this.m_data.m_envelope2D.xmax=i:n.throwOutOfRangeException(""):1===s?this.m_data.m_envelope2D.ymin=i:0===s?this.m_data.m_envelope2D.xmin=i:n.throwOutOfRangeException(""));const r=J.getComponentCount(t);(s<0||s>=r)&&n.throwOutOfRangeException(""),this.addAttribute(t);const o=this.m_description.getAttributeIndex(t);this.m_data.m_attributes[ee(this.m_description,e)+this.m_description.getPointAttributeOffset(o)-2+s]=i}releaseAttributes_(){this.m_data.releaseAttributes()}ensureAttributes_(){this.m_data.ensureAttributes(this.m_description)}};se.type=n.GeometryType.enumEnvelope;const ne=Object.freeze(Object.defineProperty({__proto__:null,Envelope:se,EnvelopeData:te},Symbol.toStringTag,{value:"Module"}));e.AttributeStreamOfDbl=T,e.AttributeStreamOfInt32=I,e.AttributeStreamOfInt8=S,e.BucketSort=A,e.CombinedTolerance=L,e.Comparator=k,e.Envelope=se,e.Envelope$1=ne,e.Envelope2DIntersector=Y,e.Envelope3D=v,e.EnvelopeData=te,e.IndexMultiDCList=q,e.OrdinateBufferLength=25,e.Point=$,e.Point3D=E,e.StridedIndexTypeCollection=N,e.Treap=F,e.VertexDescription=l,e.adjustToleranceForTEClustering=function(e){return Math.sqrt(2)*(2*e.tolerance+e.resolution)},e.adjustToleranceForTECracking=function(e){return Math.sqrt(2)*(e.tolerance+e.resolution)},e.applyShiftAndScale=B,e.buildQuadTree=function(e,t){if(!t){const t=new s.Envelope2D;e.queryLooseEnvelope(t);const i=new G(t,8);let r=-1;const o=new s.Envelope2D,a=e.querySegmentIterator();let m=!1;for(;a.nextPath();)for(;a.hasNextSegment();){const s=a.nextSegment(),h=a.getStartPointIndex();if(s.queryLooseEnvelope(o),r=i.insertEx(h,o,r),-1===r){m&&n.throwInternalErrorException(""),t.assign(e.calculateEnvelope2D(!1)),m=!0,i.reset(t,8),a.resetToFirstPath();break}}return i}const i=new s.Envelope2D;e.queryLooseEnvelope(i);const r=new G(i,8);let o=-1;const a=new s.Envelope2D,m=e.querySegmentIterator();let h=!1;for(;m.nextPath();)for(;m.hasNextSegment();){const s=m.nextSegment(),l=m.getStartPointIndex();if(s.queryLooseEnvelope(a),a.isIntersecting(t)&&(o=r.insertEx(l,a,o),-1===o)){h&&n.throwInternalErrorException(""),i.assign(e.calculateEnvelope2D(!1)),h=!0,r.reset(i,8),m.resetToFirstPath();break}}return r},e.buildQuadTreeForPaths=function(e){const t=new s.Envelope2D;return e.queryLooseEnvelope(t),t.inflateCoords(1,1),function(e,t){const i=new s.Envelope2D;if(e.queryLooseEnvelope(i),i.isEmpty())return null;e.getGeometryType();const r=new G(i,8);let o=-1;const a=new s.Envelope2D;let m=!1;do{for(let s=0,h=e.getPathCount();s<h;s++)if(e.queryLoosePathEnvelope(s,a),a.isIntersecting(t)){if(o=r.insertEx(s,a,o),-1===o){m&&n.throwInternalErrorException("build_quad_tree_for_paths"),i.assign(e.calculateEnvelope2D(!1)),m=!0,r.reset(i,8);break}m=!1}}while(m);return r}(e,t)},e.buildQuadTreeMpt=function(e,i){if(i){const r=new G(i,8),o=new t.Point2D,a=new s.Envelope2D;let m=!1;for(let t=0;t<e.getPointCount();t++)o.setCoordsPoint2D(e.getXY(t)),i.contains(o)&&(a.setCoords({pt:o}),-1!==r.insert(t,a)||(m&&n.throwInternalErrorException(""),m=!0,r.reset(e.calculateEnvelope2D(),8),t=-1));return r}return n.throwNotImplementedException("no-extent version not yet impl"),null},e.c_deadBeef=-559038737,e.calculateToleranceFromGeometryForOp=z,e.calculateToleranceFromGeometryForOpFromGeom=function(e,t,n){const i=s.Envelope2D.constructEmpty();return t.queryEnvelope(i),z(e,i,n)},e.calculateToleranceFromGeometryForRel=j,e.calculateToleranceFromGeometryForRelGeom=function(e,t,n){const i=s.Envelope2D.constructEmpty();return t.queryEnvelope(i),j(e,i,n)},e.calculateToleranceFromPointsForOps=function(e,t,n){const i=s.Envelope2D.constructEmpty();return i.setFromPoints(e,t),W(0,null,i.calculateToleranceFromEnvelope(),n,!1)},e.calculateZToleranceFromGeometryForOpEnv1D=U,e.calculateZToleranceFromGeometryForOpFromGeom=function(e,t,s){return U(e,t.queryInterval(1,0),s)},e.checkFinite=function(e,t){return Number.isFinite(e)&&Number.isFinite(t)},e.checkNanOrFinite=function(e,t){return(Number.isFinite(e)||Number.isNaN(e))&&(Number.isFinite(t)||Number.isNaN(t))},e.createAttributeMap=c,e.createAttributeStream=D,e.createAttributeStreamFromSemantics=function(e,t){const s=C.getComponentCount(e);return D(C.getPersistence(e),t*s,C.getDefaultValue(e))},e.createAttributeStreamUninitialized=function(e,t){const s=C.getComponentCount(e);return D(C.getPersistence(e),t*s)},e.createByteStream=function(e,t){return new S(e,t)},e.createDoubleStream=function(e,t){return new T(e,t)},e.createIndexStream=function(e,t){return new I(e,t)},e.getDefaultDescription2D=y,e.getDefaultDescription3D=x,e.getEnvelope2DIntersector=function(e,t,n){const i=s.Envelope2D.constructEmpty(),r=s.Envelope2D.constructEmpty();e.queryLooseEnvelope(i),t.queryLooseEnvelope(r),i.inflateCoords(n,n),r.inflateCoords(n,n);const o=s.Envelope2D.constructEmpty();o.setCoords({env2D:i}),o.intersect(r);const a=e.querySegmentIterator(),m=t.querySegmentIterator(),h=s.Envelope2D.constructEmpty(),l=s.Envelope2D.constructEmpty(),u=new Y;u.setTolerance(n);let c=!1;for(u.startRedConstruction();a.nextPath();)for(;a.hasNextSegment();)a.nextSegment().queryLooseEnvelope(h),h.isIntersecting(o)&&(c=!0,u.addRedEnvelope(a.getStartPointIndex(),h));if(u.endRedConstruction(),!c)return null;let g=!1;for(u.startBlueConstruction();m.nextPath();)for(;m.hasNextSegment();)m.nextSegment().queryLooseEnvelope(l),l.isIntersecting(o)&&(g=!0,u.addBlueEnvelope(m.getStartPointIndex(),l));return u.endBlueConstruction(),g?u:null},e.getEnvelope2DIntersectorForParts=function(e,t,n,i,r){e.getGeometryType(),t.getGeometryType();const o=s.Envelope2D.constructEmpty(),a=s.Envelope2D.constructEmpty();e.queryLooseEnvelope(o),t.queryLooseEnvelope(a),o.inflateCoords(n,n),a.inflateCoords(n,n);const m=s.Envelope2D.constructEmpty();m.setCoords({env2D:o}),m.intersect(a);const h=new Y;h.setTolerance(n);let l=!1;h.startRedConstruction();for(let t=0,s=e.getPathCount();t<s;t++)e.queryLoosePathEnvelope(t,o),o.isIntersecting(m)&&(l=!0,h.addRedEnvelope(t,o));if(h.endRedConstruction(),!l)return null;let u=!1;h.startBlueConstruction();for(let e=0,s=t.getPathCount();e<s;e++)t.queryLoosePathEnvelope(e,a),a.isIntersecting(m)&&(u=!0,h.addBlueEnvelope(e,a));return h.endBlueConstruction(),u?h:null},e.getEnvelope2DIntersectorMptMpt=function(e,n,i){const r=s.Envelope2D.constructEmpty(),o=s.Envelope2D.constructEmpty();e.queryEnvelope(r),n.queryEnvelope(o),r.inflateCoords(i,i),o.inflateCoords(i,i);const a=s.Envelope2D.constructEmpty();a.setCoords({env2D:r}),a.intersect(o);const m=new Y;m.setTolerance(i);let h=!1;m.startRedConstruction();const l=new t.Point2D;for(let t=0,n=e.getPointCount();t<n;t++)e.queryXY(t,l),a.contains(l)&&(h=!0,m.addRedEnvelope(t,s.Envelope2D.construct(l.x,l.y,l.x,l.y)));if(m.endRedConstruction(),!h)return null;let u=!1;m.startBlueConstruction();const c=new t.Point2D;for(let e=0,t=n.getPointCount();e<t;e++)n.queryXY(e,c),a.contains(c)&&(u=!0,m.addBlueEnvelope(e,s.Envelope2D.construct(c.x,c.y,c.x,c.y)));return m.endBlueConstruction(),u?m:null},e.getEnvelope2DIntersectorMpthMpt=function(e,t,n){const i=s.Envelope2D.constructEmpty(),r=s.Envelope2D.constructEmpty();e.queryLooseEnvelope(i),t.queryEnvelope(r),i.inflateCoords(n,n),r.inflateCoords(n,n);const o=s.Envelope2D.constructEmpty();o.setCoords({env2D:i}),o.intersect(r);const a=e.querySegmentIterator(),m=new Y;m.setTolerance(n);let h=!1;for(m.startRedConstruction();a.nextPath();)for(;a.hasNextSegment();)a.nextSegment().queryLooseEnvelope(i),i.isIntersecting(o)&&(h=!0,m.addRedEnvelope(a.getStartPointIndex(),i));if(m.endRedConstruction(),!h)return null;let l=!1;m.startBlueConstruction();for(let e=0,n=t.getPointCount();e<n;e++){const n=t.getXY(e);o.contains(n)&&(l=!0,m.addBlueEnvelope(e,s.Envelope2D.construct(n.x,n.y,n.x,n.y)))}return m.endBlueConstruction(),l?m:null},e.getMergedExtent=function(e,t){const n=s.Envelope2D.constructEmpty();e.queryLooseEnvelope(n);const i=s.Envelope2D.constructEmpty();return t.queryLooseEnvelope(i),n.mergeEnvelope2D(i),n},e.getMergedExtentEnv2D=function(e,t){const n=new s.Envelope2D;return e.queryLooseEnvelope(n),n.mergeEnvelope2D(t),n},e.getMergedVertexDescription=p,e.getMergedVertexDescriptionSemantics=_,e.isAngleTooSharp=function(e,s,n,i,r){const o=i*i,a=e.sub(s),m=n.sub(s),h=a.sqrLength(),l=m.sqrLength();if(h<=o||l<=o)return!0;const u=t.sqr(a.crossProduct(m));return(u<=o*h||u<=o*l)&&a.dotProduct(m)>=0},e.isAtLeastPlanarSimple=function(e){return e>=4},e.isAtLeastSimpleAsFeature=function(e,t){return e===n.GeometryType.enumPolygon?Z(t):t>=1},e.isAtLeastWeakSimple=Z,e.isAtLeastWeakSimpleGeom=function(e,t){return e.getImpl().getIsSimple(t,[0])>=3},e.isCoincidentForClustering=function(e,s,n,i){if(t.sqr(s.x-e.x)+t.sqr(s.y-e.y)<=n*n){const n=e.z,r=s.z;return t.isEqualNonIEEETol(n,r,i)}return!1},e.mapAttributes=P,e.newOrdinateBuffer=h,e.removeSemanticsFromVertexDescription=f,e.setWeakSimple=function(e,t){e.getImpl().setIsSimple(3,t)},e.snapCoordinate=function e(t,s,i,r){if(!t.hasAttribute(i))return!1;const o=t.getGeometryType();if(o===n.GeometryType.enumGeometryCollection){const n=t,o=n.getGeometryCount();let a=0;for(let t=0;t<o;++t)a|=e(n.getGeometry(t),s,i,r)?1:0;return!!a}if(n.isMultiVertex(o)){const e=t,o=X.getPersistence(i),a=X.getComponentCount(i),m=e.getPointCount();if(1===o){const t=Q(e.getAttributeStreamRef(i),m*a,r,a,s);return t&&e.notifyModified(),t}if(2===o){const t=Q(e.getAttributeStreamRef(i),m*a,r,a,s);return t&&e.notifyModified(),t}n.throwInternalErrorException("snap_coordinate not implemented")}if(o===n.GeometryType.enumEnvelope){const e=t,n=e.queryInterval(i,r);let o=!1;return n.vmin<s.vmin&&(o=!0,n.vmin=s.vmin),n.vmax>s.vmax&&(o=!0,n.vmax=s.vmax),o&&e.setIntervalEnvelope(i,r,n),o}if(o===n.GeometryType.enumPoint){const e=t;let n=e.getAttributeAsDbl(i,r),o=!1;return n<s.vmin&&(o=!0,n=s.vmin),n>s.vmax&&(o=!0,n=s.vmax),o&&e.setAttributeBasic(i,r,n),o}if(n.isSegment(o)){const e=t;let n=e.getStartAttributeAsDbl(i,r),o=!1;return n<s.vmin&&(o=!0,n=s.vmin),n>s.vmax&&(o=!0,n=s.vmax),o&&e.setStartAttribute(i,r,n),n=e.getEndAttributeAsDbl(i,r),n<s.vmin&&(o=!0,n=s.vmin),n>s.vmax&&(o=!0,n=s.vmax),o&&e.setEndAttribute(i,r,n),o}n.throwInternalErrorException("snap_coordinate not implemented")}})},"esri/chunks/MultiPathImpl":function(){define(["exports","./Geometry","./Envelope","./Point2D","./Envelope2D","./Transformation2D","./SimpleGeometryCursor"],function(e,t,s,n,i,r,o){"use strict";class a{constructor(){this.posStream=null,this.streams=null}get(e){return e>0?this.streams[e-1]:this.posStream}set(e,t){e>0?this.streams[e-1]=t:this.posStream=t}destroyAndSetSize(e){if(this.streams=null,e>1){this.streams=new Array(e-1);for(let t=0;t<e-1;++t)this.streams[t]=null}this.posStream=null}swap(e){[this.streams,e.streams]=[e.streams,this.streams],[this.posStream,e.posStream]=[e.posStream,this.posStream]}empty(){return null===this.posStream&&null===this.streams}}function m(e,t){let s=n.nextRand(e);const i=t.length/n.intMax();for(let e=0;e<t.length;++e){const e=Math.trunc(s*i);s=n.nextRand(s);const r=Math.trunc(s*i),o=t[e];t[e]=t[r],t[r]=o}}function h(e,t,s){if(!(s<=t))for(;t<s;)e[s]=n.swap(e[t],e[t]=e[s]),t++,s--}var l=s.VertexDescription;const u="can not assign an empty point to a vertex";class c{constructor(e){if(this.m_accelerators=null,void 0!==e&&e.move)this.m_description=e.move.m_description,e.move.m_description=s.getDefaultDescription2D(),this.m_vertexAttributes=e.move.m_vertexAttributes,e.move.m_vertexAttributes=new a,this.m_envelopeData=e.move.m_envelopeData,e.move.m_envelopeData=new s.EnvelopeData,this.m_pointCount=e.move.m_pointCount,this.m_reservedPointCount=e.move.m_reservedPointCount,this.m_flags=e.move.m_flags,this.m_bFillRule=e.move.m_bFillRule,this.m_bPathStarted=e.move.m_bPathStarted,this.m_bPolygon=e.move.m_bPolygon,this.m_simpleTolerance=e.move.m_simpleTolerance;else{const t=void 0!==e&&e.vd?e.vd:s.getDefaultDescription2D();this.m_description=t,this.m_vertexAttributes=new a,this.m_envelopeData=new s.EnvelopeData,this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_flags=4063,this.m_bFillRule=this.m_bPathStarted=this.m_bPolygon=!1,this.m_simpleTolerance=0,void 0!==e&&e.copy&&e.copy.copyTo(this)}}equalsBase(e,s){if(!t.isMultiVertex(e.getGeometryType()))return!1;const n=e;if(this===n)return!0;if(!this.m_description.equals(n.getDescription()))return!1;if(this.isEmptyImpl()!==n.isEmptyImpl())return!1;if(this.isEmptyImpl())return!0;const i=this.getPointCount();if(i!==n.getPointCount())return!1;for(let e=0;e<this.m_description.getAttributeCount();e++){const t=this.m_description.getSemantics(e),r=this.getAttributeStreamRef(t),o=n.getAttributeStreamRef(t),a=l.getComponentCount(t);if(!r.equals(o,0,i*a,s))return!1}if(s){if(!this.equalsImplTol(e,s))return!1}else if(!this.equalsImpl(e))return!1;return!0}transformAttribute(e,n,i,o,a){if(this.addAttribute(e),!this.isEmpty()&&(0!==i||1!==o)){if(0===e){const e=new r.Transformation2D;return 0===a?0===n?(e.setShiftCoords(i,0),e.scale(o,1)):1===n?(e.setShiftCoords(0,i),e.scale(1,o)):t.throwInvalidArgumentException(""):0===n?(e.setScaleCoords(1/o,1),e.shiftCoords(-i,0)):1===n?(e.setScaleCoords(1,1/o),e.shiftCoords(0,-i)):t.throwInvalidArgumentException(""),void this.applyTransformation(e)}!function(e,s,n,i,r){(s<0||n<0||i<1||s+i*(n-1)+1>e.size())&&t.throwInvalidArgumentException("Index out of bound");for(let t=s,o=s+i*(n-1)+1;t<o;t+=i)e.writeAsDbl(t,r(e.readAsDbl(t)))}(this.getAttributeStreamRef(e),n,this.getPointCount(),l.getComponentCount(e),s.applyShiftAndScale(i,o,a)),this.notifyModified()}}getDescription(){return this.m_description}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}mergeVertexDescriptionImpl(e){const t=this.getDescription(),n=s.getMergedVertexDescription(t,e);this.assignVertexDescription(n)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=s.getMergedVertexDescriptionSemantics(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=s.removeSemanticsFromVertexDescription(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=s.getDefaultDescription2D();e!==this.m_description&&this.assignVertexDescription(e)}getAttributeStreamRef(e){this.throwIfEmpty(),this.m_description.hasAttribute(e)||t.throwInvalidArgumentException("AttributeStream : Geometry does not have the attribute");const s=this.m_description.getAttributeIndex(e);return this.m_vertexAttributes.get(s)}setAttributeStreamRef(e,s){s||t.throwInvalidArgumentException("stream"),s&&l.getPersistence(e)!==s.getPersistence()&&t.throwInvalidArgumentException(""),this.addAttribute(e);const n=this.m_description.getAttributeIndex(e);this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_vertexAttributes.set(n,s),this.notifyModifiedFlags(2001)}notifyModifiedFlags(e){65535===e&&(this.m_reservedPointCount=-1,this.notifyModifiedAllImpl()),this.setDirtyFlagProtected(e,!0),this.clearAccelerators(),32&e&&this.verifyAllStreamsAfterSizeChange()}notifyModified(){this.notifyModifiedFlags(2001)}getPointCount(){return this.m_pointCount}getPointByVal(e,t){const s=t;s.assignVertexDescription(this.m_description);for(let t=0;t<this.m_description.getAttributeCount();t++){const n=this.m_description.getSemantics(t);for(let i=0,r=l.getComponentCount(n);i<r;i++){const o=this.m_vertexAttributes.get(t).readAsDbl(r*e+i);s.setAttributeBasic(n,i,o)}}}setPointByValNoCurves(e,s){const n=s;n.isEmpty()&&t.throwInvalidArgumentException(u);const i=n.getDescription();i!==this.m_description&&this.mergeVertexDescription(i);const r=this.m_vertexAttributes.get(0);r.write(2*e,n.getX()),r.write(2*e+1,n.getY());for(let t=1,s=this.m_description.getAttributeCount();t<s;t++){const s=this.m_description.getSemantics(t),i=l.getComponentCount(s);for(let r=0;r<i;r++){const o=n.getAttributeAsDbl(s,r);this.m_vertexAttributes.get(t).writeAsDbl(e*i+r,o)}}this.notifyModifiedFlags(2001)}setPointByValFromArrayNoCurves(e,s,n,i){t.geometryReleaseAssert(0)}getPointByValAsArray(e,s,n,i){t.geometryReleaseAssert(0)}isEmpty(){return this.isEmptyImpl()}isEmptyImpl(){return 0===this.m_pointCount}getAttributeAsDbl(e,s,n){const i=l.getComponentCount(e);n>=i&&t.throwOutOfRangeException("");const r=this.m_description.getAttributeIndex(e);return r>=0?this.m_vertexAttributes.get(r).readAsDbl(s*i+n):l.getDefaultValue(e)}queryAttributeAsDbl(e,s,n,i){const r=l.getComponentCount(e);i<r&&t.throwOutOfRangeException("");const o=this.m_description.getAttributeIndex(e);if(o>=0){const e=s*r,t=this.m_vertexAttributes.get(o);for(let s=0;s<r;s++)n[s]=t.readAsDbl(e+s)}else{const t=l.getDefaultValue(e);for(let e=0;e<r;e++)n[e]=t}}getAttributeAsInt(e,t,s){return Math.trunc(this.getAttributeAsDbl(e,t,s))}queryAttributeAsInt(e,s,n,i){t.geometryReleaseAssert(0)}setAttributeNoCurves(e,s,n,i){const r=l.getComponentCount(e);n>=r&&t.throwOutOfRangeException(""),this.addAttribute(e);const o=this.m_description.getAttributeIndex(e);this.notifyModifiedFlags(2001),this.m_vertexAttributes.get(o).writeAsDbl(s*r+n,i)}setAttributeFromArrayNoCurves(e,s,n,i){(s<0||s>=this.m_pointCount)&&t.throwOutOfRangeException("");const r=l.getComponentCount(e);i<r&&t.throwOutOfRangeException(""),this.addAttribute(e);const o=this.m_description.getAttributeIndex(e);this.notifyModifiedFlags(2001);const a=this.m_vertexAttributes.get(o);for(let e=0;e<r;++e)a.writeAsDbl(s*r+e,n[e])}getXY(e){return this.m_vertexAttributes.get(0).readPoint2D(2*e)}queryXY(e,t){return this.m_vertexAttributes.get(0).queryPoint2D(2*e,t)}setXYNoCurves(e,t){this.m_vertexAttributes.get(0).writePoint2D(2*e,t),this.notifyModifiedFlags(2001)}setXYCoordsNoCurves(e,t,s){const n=this.m_vertexAttributes.get(0);n.write(2*e,t),n.write(2*e+1,s),this.notifyModifiedFlags(2001)}getXYZ(e){const t=this.m_vertexAttributes.get(0),n=s.Point3D.getNAN();return n.x=t.read(2*e),n.y=t.read(2*e+1),this.m_description.hasAttribute(1)?n.z=this.m_vertexAttributes.get(1).read(e):n.z=l.getDefaultValue(1),n}setXYZNoCurves(e,t){this.addAttribute(1),this.notifyModifiedFlags(2001);const s=this.m_vertexAttributes.get(0);s.write(2*e,t.x),s.write(2*e+1,t.y),this.m_vertexAttributes.get(1).write(e,t.z)}queryEnvelope(e){e instanceof i.Envelope2D||e instanceof s.Envelope3D?this.updateEnvelope(e):(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,e))}queryLooseEnvelope(e){this.updateLooseEnvelope(e)}queryInterval(e,t){const s=n.Envelope1D.constructEmpty();return this.isEmptyImpl()||(this.updateAllDirtyIntervals(!0),this.m_envelopeData.queryInterval(this.m_description,e,t,s)),s}setAttributeBasic(e,t,s){this.setAttributeImpl(e,t,s)}setAttributeImpl(e,t,s){if(this.addAttribute(e),this.isEmpty())return;let n=!1;const i=l.getComponentCount(e),r=this.getAttributeStreamRef(e),o=Number.isNaN(s);if(1===r.getPersistence()){const e=r;for(let r=t,a=this.m_pointCount*i;r<a;r+=i){const t=e.read(r);(o||t===s)&&Number.isNaN(t)||(e.write(r,s),n=!0)}}else for(let e=t,o=this.m_pointCount*i;e<o;e+=i)r.readAsDbl(e)!==s&&(r.writeAsDbl(e,s),n=!0);n&&this.notifyModifiedFlags(2001)}replaceNaNs(e,t){if(this.addAttribute(e),this.isEmpty())return;let s=!1;const n=l.getComponentCount(e),i=this.getAttributeStreamRef(e);for(let e=0;e<n;e++)if(1===i.getPersistence()){const e=i;for(let i=0,r=this.m_pointCount*n;i<r;i++){const n=e.read(i);Number.isNaN(n)&&(e.write(i,t),s=!0)}}else for(let e=0,r=this.m_pointCount*n;e<r;e++){const n=i.readAsDbl(e);Number.isNaN(n)&&(i.writeAsDbl(e,t),s=!0)}s&&this.notifyModifiedFlags(2001)}calculateLength3D(e){return t.geometryReleaseAssert(0),0}setEnvelopeForImport(e){this.m_description.equals(e.getDescription())||t.throwInvalidArgumentException(""),this.m_envelopeData=new s.EnvelopeData({moveEnv:e}),this.setDirtyFlagProtected(192,!1)}copyTo(e){e.getGeometryType()!==this.getGeometryType()&&t.throwInvalidArgumentException(""),this!==e&&this.copyToUnchecked(e,!1)}queryCoordinates(e,s,n,i){let r=i<0?this.m_pointCount:i;if(r=Math.min(r,n+s),(n<0||r<n||this.m_pointCount>0&&n>=this.m_pointCount)&&t.throwInvalidArgumentException(""),0===this.m_pointCount)return r;const o=this.getAttributeStreamRef(0);for(let t=2*n,s=2*r,i=0;t<s;t+=2,i++)o.queryPoint2D(t,e[i]);return r}queryCoordinates3D(e,s,n,i){let r=i<0?this.m_pointCount:i;if(r=Math.min(r,n+s),(n<0||r<n||this.m_pointCount>0&&n>=this.m_pointCount)&&t.throwInvalidArgumentException(""),0===this.m_pointCount)return r;const o=this.getAttributeStreamRef(0);let a=null;const m=l.getDefaultValue(1),h=this.m_description.hasAttribute(1);h&&(a=this.getAttributeStreamRef(1));let u=0;for(let t=n;t<r;t++,u++)e[u].x=o.read(2*t),e[u].y=o.read(2*t+1),e[u].z=h?a.read(t):m;return r}clearAndSetDirtyFlagProtected(e,t){let s=0;const n=e&~t,i=t|n;s=this.m_flags,(s&i)!==t&&(this.m_flags=s&~n|t)}getIsSimple(e,t){t[0]=0;let s=-1;const n=this.m_flags,i=this.m_simpleTolerance;return 1&n||(s=(14&n)>>1,t[0]=i,i<e&&(s=-1)),s}setIsSimple(e,s,n=!1){if(2===e?t.geometryReleaseAssert(this.getGeometryType()===t.GeometryType.enumPolyline):1===e?t.geometryReleaseAssert(this.getGeometryType()===t.GeometryType.enumMultiPoint||this.getGeometryType()===t.GeometryType.enumPolyline):3===e&&t.geometryReleaseAssert(this.getGeometryType()===t.GeometryType.enumPolygon),-1===e)this.setDirtyFlagProtected(17,!0);else{let t=e<<1;n||(t|=16);const i=31;this.clearAndSetDirtyFlagProtected(i,t),this.m_simpleTolerance!==s&&(this.m_simpleTolerance=s)}}attributeStreamIsAllocated(e){this.throwIfEmpty();const t=this.m_description.getAttributeIndex(e);return t>=0&&null!==this.m_vertexAttributes.get(t)}capacity(){return-1===this.m_reservedPointCount&&0===this.m_pointCount?0:this.m_reservedPointCount}getDescriptionImpl(){return this.m_description}copyToUnchecked(e,s=!1){s&&this.hasDirtyFlag(32)&&t.throwLogicErrorException("Cannot do shallow clone on unprepared geometry");const n=e,i=this.getGeometryType(),r=n.getGeometryType();t.geometryReleaseAssert(i===r||i===t.GeometryType.enumPolygon&&r===t.GeometryType.enumPolyline,"failure in copyToUnchcked"),n.clearAccelerators(),n.m_description=this.m_description,n.m_vertexAttributes.destroyAndSetSize(0),n.m_envelopeData.releaseAttributes();const o=this.m_description.getAttributeCount(),m=new a;if(!this.m_vertexAttributes.empty()){m.destroyAndSetSize(o);for(let e=0;e<o;e++)if(this.m_vertexAttributes.get(e))if(s)m.set(e,this.m_vertexAttributes.get(e));else{const t=l.getComponentCount(this.m_description.getSemantics(e));m.set(e,this.m_vertexAttributes.get(e).restrictedClone(this.getPointCount()*t))}}if(this.m_envelopeData.copyToIfNotNull(this.m_description,n.m_envelopeData),n.m_flags=this.m_flags,n.m_simpleTolerance=this.m_simpleTolerance,i!==r){const e=[Number.NaN];n.getIsSimple(0,e)>=3?n.setIsSimple(1,e[0]):n.setIsSimple(-1,0)}n.m_vertexAttributes.swap(m),m.destroyAndSetSize(0),n.m_pointCount=this.m_pointCount,n.hasDirtyFlag(32)||n.m_vertexAttributes.empty()?(t.geometryReleaseAssert(!s||0===n.m_pointCount),n.m_reservedPointCount=-1):n.m_reservedPointCount=n.m_pointCount;try{this.copyToImpl(n,s)}catch(e){throw n.setEmpty(),e}n.verifyAllStreamsAfterSizeChange()}buildRasterizedGeometryAccelerator(e,t){return!1}getAccelerators(){return this.m_accelerators}clearAccelerators(){this.m_accelerators&&this.m_accelerators.release(),this.m_accelerators=null}ensureUniqueAccelerators(){if(this.m_accelerators&&!this.m_accelerators.uniqueUse()){const e=this.m_accelerators.clone();this.m_accelerators.release(),this.m_accelerators=e}}interpolateTwoVertices(e,i,r,o){(e<0||e>=this.m_pointCount)&&t.throwOutOfRangeException(""),(i<0||i>=this.m_pointCount)&&t.throwOutOfRangeException(""),o.assignVertexDescription(this.m_description);const a=n.makePrimitiveArray(l.maxComponentCount(),Number.NaN),m=n.makePrimitiveArray(l.maxComponentCount(),Number.NaN),h=s.newOrdinateBuffer();let u=0;for(let o=0;o<this.m_description.getAttributeCount();o++){const c=this.m_description.getSemantics(o),g=l.getInterpolation(c),d=l.getComponentCount(c),p=l.getDefaultValue(c);this.queryAttributeAsDbl(c,e,a,d),this.queryAttributeAsDbl(c,i,m,d),t.geometryReleaseAssert(u+d<=s.OrdinateBufferLength),n.interpolateArray(g,a,m,h,u,d,r,p),u+=d}!function(e,t){const s=e.getDescription().getTotalComponentCount();e.setX(t[0]),e.setY(t[1]),n.memcpy(e.getAttributeArray(),t,0,2,s-2)}(o,h)}getShortestDistance(e,t){return n.Point2D.distance(this.getXY(e),this.getXY(t))}getShortestSqrDistance(e,t){return n.Point2D.sqrDistance(this.getXY(e),this.getXY(t))}resizeImpl(e){if(e<0&&t.throwInvalidArgumentException(),(e=Math.ceil(e))===this.m_pointCount)return;this.m_pointCount=e;const s=this.m_pointCount<=this.m_reservedPointCount?2001:4095;this.notifyModifiedFlags(s)}assignVertexDescriptionImpl(e){if(!this.m_vertexAttributes.empty()){const t=s.createAttributeMap();s.mapAttributes(e,this.m_description,t);const n=new a;n.destroyAndSetSize(e.getAttributeCount());for(let s=0;s<e.getAttributeCount();s++){const e=t[s];-1!==e?n.set(s,this.m_vertexAttributes.get(e)):this.m_reservedPointCount=-1}n.swap(this.m_vertexAttributes)}this.m_description=e,this.m_envelopeData.releaseAttributes(),this.notifyModifiedFlags(4095)}hasDirtyFlag(e){return 0!==(this.m_flags&e)}setDirtyFlagProtected(e,t){t?this.m_flags|=e:this.m_flags&=~e}notifyModifiedAllImpl(){}verifyAllStreamsAfterSizeChange(){this.hasDirtyFlag(32)&&this.verifyAllStreamsAfterSizeChangeImpl()}verifyAllStreamsAfterSizeChangeImpl(){if(this.hasDirtyFlag(32)){if(this.m_reservedPointCount<this.m_pointCount){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),this.m_reservedPointCount=-1;let e=Number.MAX_SAFE_INTEGER,t=0;t=this.m_pointCount<4?3:this.m_pointCount<=128?2*this.m_pointCount:Math.trunc((4*this.m_pointCount+2)/3);for(let n=0;n<this.m_description.getAttributeCount();n++){const i=this.m_description.getSemantics(n);let r=0;if(null!==this.m_vertexAttributes.get(n)){const e=l.getComponentCount(i);r=this.m_vertexAttributes.get(n).size()/e,r<this.m_pointCount&&(this.m_vertexAttributes.get(n).resize(t*e,l.getDefaultValue(i)),r=t)}else this.m_vertexAttributes.set(n,s.createAttributeStreamFromSemantics(i,t)),r=t;r<e&&(e=r)}this.m_reservedPointCount=e}this.verifyStreamsAfterSizeChangeExtraImpl(),this.setDirtyFlagProtected(32,!1)}}verifyStreamsAfterSizeChangeExtraImpl(){}updateAllDirtyIntervals(e){if(e?this.hasDirtyFlag(192):this.hasDirtyFlag(128)){if(this.isEmpty())return this.hasDirtyFlag(192)&&this.m_envelopeData.setEmpty(this.m_description),void this.setDirtyFlagProtected(192,!1);const t=this.updateXYImpl(e),i=new s.Envelope({vd:this.m_description});i.setEnvelope(t);for(let e=1;e<this.m_description.getAttributeCount();e++){const t=this.m_description.getSemantics(e),s=l.getComponentCount(t),r=this.m_vertexAttributes.get(e);for(let e=0;e<s;e++){const o=new n.Envelope1D;o.setEmpty();for(let t=0;t<this.m_pointCount;t++){const n=r.readAsDbl(t*s+e);o.mergeCoordinate(n)}i.setIntervalEnvelope(t,e,o)}}(e?this.hasDirtyFlag(192):this.hasDirtyFlag(128))&&(this.m_envelopeData=new s.EnvelopeData({moveEnv:i}),this.clearDirtyIntervalsFlag(e))}}updateXYImpl(e){const t=i.Envelope2D.constructEmpty(),s=this.m_vertexAttributes.get(0);return t.mergePointsInterleaved(s,0,this.m_pointCount),t}updateEnvelope3D(e){t.geometryReleaseAssert(0)}updateLooseEnvelope(e){this.updateAllDirtyIntervals(!1),e instanceof i.Envelope2D?e.assign(this.m_envelopeData.m_envelope2D):this.m_envelopeData.queryEnvelope3D(this.m_description,e)}updateEnvelope(e){this.updateAllDirtyIntervals(!0),e.assign(this.m_envelopeData.m_envelope2D)}setEmptyImpl(){this.m_pointCount=0,this.m_reservedPointCount=-1,this.m_vertexAttributes.destroyAndSetSize(0),this.notifyModifiedFlags(4095)}clearDirtyIntervalsFlag(e){this.setDirtyFlagProtected(192,!1)}reserveImpl(e,n){if(e<0&&t.throwInvalidArgumentException(""),0===e)return;let i=e=Math.ceil(e);if(this.m_reservedPointCount<i){this.m_vertexAttributes.empty()&&this.m_vertexAttributes.destroyAndSetSize(this.m_description.getAttributeCount()),n?(null===this.m_vertexAttributes.get(0)&&this.m_vertexAttributes.set(0,s.createAttributeStreamUninitialized(0,0)),this.m_vertexAttributes.get(0).resizeRounded(2*i),i=this.m_vertexAttributes.get(0).size()>>1):null===this.m_vertexAttributes.get(0)?this.m_vertexAttributes.set(0,s.createAttributeStreamUninitialized(0,i)):this.m_vertexAttributes.get(0).resize(2*i);for(let e=1;e<this.m_description.getAttributeCount();e++){const t=this.m_description.getSemantics(e),n=l.getComponentCount(t);null!==this.m_vertexAttributes.get(e)?this.m_vertexAttributes.get(e).resize(i*n):this.m_vertexAttributes.set(e,s.createAttributeStreamUninitialized(t,i))}this.reserveImplImpl(i,n),this.m_reservedPointCount=i}}reserveRounded(e){e<0&&t.throwInvalidArgumentException(),e=Math.ceil(e),this.reserveImpl(e,!0)}reserveImplImpl(e,t){}throwIfEmpty(){this.isEmptyImpl()&&t.throwEmptyGeometryException("")}}class g extends c{constructor(e){super(e),e&&(e.points?this.addPoints2D(e.points,e.pointsSize,0,-1):e.point&&this.add(e.point))}assignCopy(e){return e.copyTo(this),this}assignMove(e){return e.copyTo(this),e.setEmpty(),this}insertPoint2D(e,n){e>this.getPointCount()&&t.throwInvalidArgumentException("invalid point index"),e<0&&(e=this.getPointCount());const i=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let t=0,r=this.m_description.getAttributeCount();t<r;t++){const r=this.m_description.getSemantics(t),o=s.VertexDescription.getComponentCount(r);if(0===r)this.m_vertexAttributes.get(t).insert(o*e,n,o*i);else{const n=s.VertexDescription.getDefaultValue(r);this.m_vertexAttributes.get(t).insertRange(o*e,n,o,o*i)}}this.notifyModifiedFlags(2001)}insertPoint(e,n){n.isEmpty()&&t.throwInvalidArgumentException(u),e<0&&(e=this.getPointCount()),this.mergeVertexDescription(n.getDescription());const i=this.m_pointCount;this.resizeNoInit(this.m_pointCount+1);for(let t=0,r=this.m_description.getAttributeCount();t<r;t++){const r=this.m_description.getSemantics(t),o=s.VertexDescription.getComponentCount(r);if(n.hasAttribute(r))this.m_vertexAttributes.get(t).insertAttributes(o*e,n,r,o*i);else{const n=s.VertexDescription.getDefaultValue(r);this.m_vertexAttributes.get(t).insertRange(o*e,n,o,o*i)}}this.notifyModifiedFlags(2001)}insertPoints(e,n,i){if((e>this.getPointCount()||i<0)&&t.throwOutOfRangeException(""),e<0&&(e=this.getPointCount()),0===i)return;const r=n[0].getDescription();this.mergeVertexDescription(r);const o=this.m_pointCount;this.resizeNoInit(this.m_pointCount+i);for(let t=0,a=this.m_description.getAttributeCount();t<a;t++){const a=this.m_description.getSemantics(t),m=s.VertexDescription.getComponentCount(a);if(this.m_vertexAttributes.get(t))if(r.hasAttribute(a))this.m_vertexAttributes.get(t).insertAttributesFromPoints(e*m,n,i,a,o*m);else{const n=s.VertexDescription.getDefaultValue(a);this.m_vertexAttributes.get(t).insertRange(m*e,n,m*i,m*o)}}this.notifyModifiedFlags(2001)}insertPoints2D(e,n,i){if((e>this.getPointCount()||i<0)&&t.throwInvalidArgumentException("invalid point index"),e<0&&(e=this.getPointCount()),0===i)return;const r=this.m_pointCount;this.resizeNoInit(this.m_pointCount+i);for(let t=0,o=this.m_description.getAttributeCount();t<o;t++){const o=this.m_description.getSemantics(t),a=s.VertexDescription.getComponentCount(o);if(this.m_vertexAttributes.get(t))if(0===o)this.m_vertexAttributes.get(t).insertRangeFromPoints(a*e,n,0,i,!0,a*r);else{const n=s.VertexDescription.getDefaultValue(o);this.m_vertexAttributes.get(t).insertRange(a*e,n,a,a*r)}}this.notifyModifiedFlags(2001)}removePoints(e,n){if((e<0||n<0||e+n>this.getPointCount())&&t.throwOutOfRangeException("remove_points"),0!==n){for(let t=0,i=this.m_description.getAttributeCount();t<i;t++)if(this.m_vertexAttributes.get(t)){const i=this.m_description.getSemantics(t),r=s.VertexDescription.getComponentCount(i);this.m_vertexAttributes.get(t).eraseRange(r*e,r*n,r*this.m_pointCount)}this.m_pointCount-=n,this.m_reservedPointCount>0&&(this.m_reservedPointCount-=n),this.notifyModifiedFlags(2001)}}removePoint(e){for(let t=0,n=this.m_description.getAttributeCount();t<n;t++)if(this.m_vertexAttributes.get(t)){const n=this.m_description.getSemantics(t),i=s.VertexDescription.getComponentCount(n);this.m_vertexAttributes.get(t).eraseRange(i*e,i,i*this.m_pointCount)}this.m_pointCount--,this.m_reservedPointCount>0&&this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}calculateEnvelope2D(){return this.updateXYImpl(!0)}resizeNoInit(e){this.resizeImpl(e)}resizeAndInitNonPositionAttributes(e){const t=this.m_pointCount;if(this.resizeImpl(e),this.m_pointCount>t)for(let e=1,n=this.m_description.getAttributeCount();e<n;e++){const n=this.m_description.getSemantics(e),i=s.VertexDescription.getDefaultValue(n),r=s.VertexDescription.getComponentCount(n);this.m_vertexAttributes.get(e).insertRange(r*t,i,r*(this.m_pointCount-t),r*t)}}queryCoordinates3D(e,n,i,r){let o=r<0?this.m_pointCount:r;if(o=Math.min(o,i+n),(i<0||o<i||this.m_pointCount>0&&i>=this.m_pointCount)&&t.throwInvalidArgumentException(""),0===this.m_pointCount)return o;const a=this.getAttributeStreamRef(0);let m=null;const h=s.VertexDescription.getDefaultValue(1),l=this.m_description.hasAttribute(1);l&&(m=this.getAttributeStreamRef(1));let u=0;for(let t=i;t<o;t++,u++)e[u].x=a.read(2*t),e[u].y=a.read(2*t+1),e[u].z=l?m.read(t):h;return o}queryAttributeAsInt(e,s,n,i){t.geometryReleaseAssert(0)}add(e){e.isEmpty()&&t.throwInvalidArgumentException(u),this.resizeAndInitNonPositionAttributes(this.m_pointCount+1),this.setPointByValNoCurves(this.m_pointCount-1,e)}addXY(e,t){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);const s=new n.Point2D(e,t);this.setXYNoCurves(this.m_pointCount-1,s)}addXYZ(e,t,n){this.resizeAndInitNonPositionAttributes(this.m_pointCount+1);const i=new s.Point3D;i.setCoords(e,t,n),this.setXYZNoCurves(this.m_pointCount-1,i)}addPoint2D(e){this.addXY(e.x,e.y)}addPoint3D(e){this.addXYZ(e.x,e.y,e.z)}addPoints(e,n,i){this===e&&t.throwInvalidArgumentException("Multi_point_impl.add");const r=i<0?e.getPointCount():i;if((n<0||n>e.getPointCount()||r<n)&&t.throwInvalidArgumentException(""),n===r)return;const o=e.getDescription();this.mergeVertexDescription(o);const a=r-n,m=this.m_pointCount;this.resizeNoInit(this.m_pointCount+a);for(let t=0,i=this.m_description.getAttributeCount();t<i;t++){const i=this.m_description.getSemantics(t),r=s.VertexDescription.getComponentCount(i),h=this.getAttributeStreamRef(i);if(o.hasAttribute(i)){const t=e.getAttributeStreamRef(i);h.insertRangeFromStream(m*r,t,n*r,a*r,!0,1,m*r)}else{const e=s.VertexDescription.getDefaultValue(i);h.insertRange(m*r,e,a*r,m*r)}}}addPoints2D(e,s,n,i){let r=s;const o=i<0?r:i;if((r<0||n<0||n>r||o<n)&&t.throwInvalidArgumentException(""),n===o)return;r=o-n;const a=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+r);const m=this.getAttributeStreamRef(0);for(let t=0;t<r;++t)m.writePoint2D(2*(a+t),e[n+t]);this.notifyModifiedFlags(2001)}addPoints3D(e,s,i,r){let o=s;const a=r<0?o:r;if((o<0||i<0||i>o||a<i)&&t.throwInvalidArgumentException(""),this.addAttribute(1),i===a)return;o=a-i;const m=this.m_pointCount;this.resizeAndInitNonPositionAttributes(this.m_pointCount+o);const h=this.getAttributeStreamRef(0),l=new n.Point2D;for(let t=0;t<o;t++)l.x=e[i+t].x,l.y=e[i+t].y,h.writePoint2D(2*(m+t),l);const u=this.getAttributeStreamRef(1);for(let t=0;t<o;t++)u.write(m+t,e[i+t].z);this.notifyModifiedFlags(2001)}setPointByVal(e,t){this.setPointByValNoCurves(e,t)}setXY(e,t){this.setXYNoCurves(e,t)}setXYCoords(e,t,s){this.setXYCoordsNoCurves(e,t,s)}setXYZ(e,t){this.setXYZNoCurves(e,t)}setAttribute(e,t,s,n){this.setAttributeNoCurves(e,t,s,n)}getGeometryType(){return t.GeometryType.enumMultiPoint}getDimension(){return 0}createInstance(){return new g({vd:this.getDescription()})}setEmpty(){this.setEmptyImpl()}applyTransformation(e){if(this.isEmpty())return;if(e.isIdentity())return;const s=this.m_vertexAttributes.get(0);1===e.m_TransformationType?s.applyTransformation(e,0,this.m_pointCount):t.throwNotImplementedException("3d xform not impl"),this.notifyModifiedFlags(2001)}calculateArea2D(){return 0}calculateLength2D(){return 0}calculateLength3D(e){return 0}equals(e,s){return e.getGeometryType()===t.GeometryType.enumMultiPoint&&this.equalsBase(e,s)}queryEnvelope(e){4===e.m_EnvelopeType?(this.updateAllDirtyIntervals(!0),this.m_envelopeData.copyTo(this.m_description,e)):2===e.m_EnvelopeType?this.updateEnvelope(e):t.throwNotImplementedException("")}getImpl(){return this}getBoundary(){return null}reserve(e){this.reserveImpl(e)}clone(){const e=this.createInstance();return this.copyTo(e),e}swap(e){t.geometryReleaseAssert(0)}buildQuadTreeAccelerator(e){return!1}getHashCodeImpl(){return t.geometryReleaseAssert(0),0}equalsImpl(e){return!0}equalsImplTol(e,t){return!0}copyToImpl(e,t){}}g.type=t.GeometryType.enumMultiPoint;class d{constructor(){this.m_EnvelopeType=5,this.envAabb=i.Envelope2D.constructEmpty(),this.envRot=i.Envelope2D.constructEmpty()}static constructEmpty(){return new d}width(){return this.envAabb.width()}height(){return this.envAabb.height()}maxDim(){return Math.max(this.width(),this.height())}setEmpty(){this.envAabb.setEmpty(),this.envRot.setEmpty()}setCoords(e){this.envAabb.setCoords(e),this.envRot.setCoords({x:p(e),y:_(e)})}setFromPoints(e,t){this.setEmpty(),this.mergePoints(e,t)}mergeNe(e){this.envAabb.mergeNe(e),this.envRot.mergeNeCoords(p(e),_(e))}mergePoints(e,t){this.envAabb.mergePoints(e,t);for(let s=0;s<t;){if(!this.envRot.isEmpty()){for(let n=s;n<t;n++){const t=p(e[n]),s=_(e[n]);this.envRot.mergeNeCoords(t,s)}break}{const t=p(e[s]),n=_(e[s]);this.envRot.setCoords({x:t,y:n}),s++}}}isIntersectingPoint2D(e){return!(!this.envAabb.contains(e)||!this.envRot.containsCoords(p(e),_(e)))}isIntersectingW(e){return this.envAabb.isIntersecting(e.envAabb)&&this.envRot.isIntersecting(e.envRot)}containsW(e){return!(!this.envAabb.containsEnvelope(e.envAabb)||!this.envRot.containsEnvelope(e.envRot))}containsPoint2D(e){return this.isIntersectingPoint2D(e)}intersectW(e){const t=this.envAabb.intersect(e.envAabb),s=this.envRot.intersect(e.envRot);return t&&!s&&this.envAabb.setEmpty(),s&&!t&&this.envRot.setEmpty(),t&&s}inflate(e){this.envAabb.inflateCoords(e,e);const t=e*n.sqrt2();this.envRot.inflateCoords(t,t),t<0&&d.st_reduceEmpty(this)}static st_reduceEmpty(e){const t=e.envAabb.isEmpty(),s=e.envRot.isEmpty();t&&!s?e.envRot.setEmpty():s&&!t&&e.envAabb.setEmpty()}sqrMaxMinDistance(e){const t=this.envAabb.sqrMaxMinDistance(e),s=this.envRot.sqrMaxMinDistance(f(e))/2;return Math.max(t,s)}sqrMinDistance(e){const t=this.envAabb.sqrMinDistance(e),s=this.envRot.sqrMinDistance(f(e))/2;return Math.max(t,s)}sqrMaxDistance(e){const t=this.envAabb.sqrMaxDistance(e),s=this.envRot.sqrMaxDistance(f(e))/2;return Math.max(t,s)}getEnvelope2D(){return this.envAabb}getRotatedEnvelope2D(){return this.envRot}xyRot(e,t){const s=e.x-e.y,n=(i=e.x,r=e.y,i+r);var i,r;t.setCoords(s,n)}}function p(e){return e.x-e.y}function _(e){return e.x+e.y}function f(e){return new n.Point2D(p(e),_(e))}class y{constructor(){this.x=n.ECoordinate.getNAN(),this.y=n.ECoordinate.getNAN()}static getNAN(){return new y}static constructPoint2D(e){const t=new y;return t.x.set(e.x),t.y.set(e.y),t}static constructCoords(e,t){const s=new y;return s.x.set(e),s.y.set(t),s}static constructCoordsE(e,t){const s=new y;return s.setCoordsE(e,t),s}get 0(){return this.x.clone()}set 0(e){this.x.setE(e)}get 1(){return this.y.clone()}set 1(e){this.y.setE(e)}clone(){return(new y).setE(this)}scaleThis(e){return this.x.mulThisE(e),this.y.mulThisE(e),this}setCoords(e,t){return this.x.set(e),this.y.set(t),this}setCoordsE(e,t){return this.x.setE(e),this.y.setE(t),this}set(e){return this.x.set(e.x),this.y.set(e.y),this}setE(e){return this.x.setE(e.x),this.y.setE(e.y),this}setWithEps(e,t){return this.x.setWithEps(e.x,t),this.y.setWithEps(e.y,t),this}getUnitVector(){const e=this.clone();return e.normalize(),e}sqrLength(){return this.x.sqr().addE(this.y.sqr())}length(){return this.sqrLength().sqrt()}mulE(e){const t=new y;return t.setCoordsE(this.x.mulE(e),this.y.mulE(e)),t}mul(e){const t=new y;return t.setCoordsE(this.x.mul(e),this.y.mul(e)),t}mulThis(e){return this.x.mulThis(e),this.y.mulThis(e),this}mulThisE(e){return this.x.mulThisE(e),this.y.mulThisE(e),this}divE(e){return this.clone().divThisE(e)}divThisE(e){return this.x.divThisE(e),this.y.divThisE(e),this}normalize(){const e=this.length();0===e.value()?(this.x=n.s_one.clone(),this.y=n.s_zero.clone()):(this.x.divThisE(e),this.y.divThisE(e))}addE(e){return this.clone().addThisE(e)}addThisE(e){return this.x.addThisE(e.x),this.y.addThisE(e.y),this}subE(e){return this.clone().subThisE(e)}subThisE(e){return this.x.subThisE(e.x),this.y.subThisE(e.y),this}static distance(e,t){return e.subE(t).length()}negateThis(){return this.x.negateThis(),this.y.negateThis(),this}eq(e){return this.x.eq(e.x)&&this.y.eq(e.y)}isZero(){return this.x.isZero()&&this.y.isZero()}isTrueZero(){return!this.x.value()&&!this.y.value()}rotateDirect(e,t){const s=this.x.mulE(e).subThisE(this.y.mulE(t)),n=this.x.mulE(t).addThisE(this.y.mulE(e));return this.x.setE(s),this.y.setE(n),this}rotateReverse(e,t){const s=this.x.mulE(e).addThisE(this.y.mulE(t)),n=this.x.negate().mulThisE(t).addThisE(this.y.mulE(e));return this.x.setE(s),this.y.setE(n),this}dotProduct(e){return this.x.mulE(e.x).addE(this.y.mulE(e.y))}crossProduct(e){return this.x.mulE(e.y).subE(this.y.mulE(e.x))}value(){return n.Point2D.construct(this.x.value(),this.y.value())}}class x{constructor(){this.a11=new n.ECoordinate(1),this.a12=new n.ECoordinate(0),this.a21=new n.ECoordinate(0),this.a22=new n.ECoordinate(1)}clone(){const e=new x;return e.a11.setE(this.a11),e.a12.setE(this.a12),e.a21.setE(this.a21),e.a22.setE(this.a22),e}assign(e){return this.a11.setE(e.a11),this.a12.setE(e.a12),this.a21.setE(e.a21),this.a22.setE(e.a22),this}mulThis(e){const t=this.a11.mulE(e.a11).addThisE(this.a12.mulE(e.a21)),s=this.a11.mulE(e.a12).addThisE(this.a12.mulE(e.a22)),n=this.a21.mulE(e.a11).addThisE(this.a22.mulE(e.a21)),i=this.a21.mulE(e.a12).addThisE(this.a22.mulE(e.a22));return this.a11=t,this.a12=s,this.a21=n,this.a22=i,this}mulLeftThis(e){const t=e.clone();return this.assign(t.mulThis(this)),this}det(){return this.a11.mulE(this.a22).subThisE(this.a12.mulE(this.a21))}invertThis(){const e=this.det();if(0!==e.value()){const t=this.a22.divE(e),s=this.a12.negate().divThisE(e),n=this.a21.negate().divThisE(e),i=this.a11.divE(e);this.a11=t,this.a12=s,this.a21=n,this.a22=i}else this.setZero();return!e.isZero()}transposeThis(){return this.a21=n.swap(this.a12,this.a12=this.a21),this}eigenSymmetric(e,t){const s=this.a12.clone();s.addThisE(this.a21),s.mulThisByPower2(.5);let i=new n.ECoordinate(1),r=new n.ECoordinate(0);if(s.isZero())e[0].setE(this.a11),e[1].setE(this.a22);else{const t=new n.ECoordinate(1);if(this.a11.ne(this.a22)){const o=this.a11.subE(this.a22).divE(s);o.mulThisByPower2(.5);const a=o.sqr();t.setE(o),t.absThis(),t.subThisE(a.add(1).sqrtThis()),o.gt(n.s_zero)&&t.negateThis();const m=t.sqr().addThis(1).sqrtThis().invThis();r=t.mulE(m),i.setE(m);const h=t.mulE(s);e[0]=this.a11.addE(h),e[1]=this.a22.subE(h)}else i=new n.ECoordinate(1/Math.sqrt(2)),r=i.clone(),e[0]=this.a11.addE(s),e[1]=this.a22.subE(s)}t[0].x=i.toDouble(),t[0].y=r.toDouble(),t[1].x=r.negate().toDouble(),t[1].y=i.toDouble(),Math.abs(e[0].toDouble())>Math.abs(e[1].toDouble())&&(e[1]=n.swap(e[0],e[0]=e[1]),t[1]=n.swap(t[0],t[0]=t[1]))}setZero(){this.a11.set(0),this.a21.set(0),this.a12.set(0),this.a22.set(0)}}class P{static constructPoint2D(e){return new P(n.MPValue.constructDouble(e.x),n.MPValue.constructDouble(e.y))}constructor(e,t){if(void 0===e)return this.x=(new n.MPValue).setNAN(),void(this.y=(new n.MPValue).setNAN());this.x=e.clone(),this.y=t.clone()}assignPoint2D(e){return this.x.setDouble(e.x),this.y.setDouble(e.y),this}setCoords(e,t){return this.x.setThis(e),this.y.setThis(t),this}asPoint2D(){return new n.Point2D(this.x.value(),this.y.value())}crossProduct(e){return this.x.mul(e.y).sub(this.y.mul(e.x))}leftPerpendicularThis(){const e=this.x.clone();this.x=this.y.clone().negate(),this.y=e}clone(){return new P(this.x,this.y)}dotProduct(e){return this.x.mul(e.x).add(this.y.mul(e.y))}add(e){return new P(this.x.add(e.x),this.y.add(e.y))}sub(e){return new P(this.x.sub(e.x),this.y.sub(e.y))}sqrLength(){return this.x.sqr().addThis(this.y.sqr())}mulThis(e){return this.x.mulThis(e),this.y.mulThis(e),this}mul(e){return this.clone().mulThis(e)}subThis(e){return this.x.subThis(e.x),this.y.subThis(e.y),this}addThis(e){return this.x.addThis(e.x),this.y.addThis(e.y),this}}var E=s.VertexDescription;function v(e){let t=!1;for(let s=0;s<2;s++){const i=n.compareNoNANs(e[0][s],e[3][s]);i>0?(n.compareNoNANs(e[0][s],e[1][s])<0&&(e[1][s]=e[0][s],t=!0),n.compareNoNANs(e[1][s],e[3][s])<0&&(e[1][s]=e[3][s],t=!0),n.compareNoNANs(e[0][s],e[2][s])<0&&(e[2][s]=e[0][s],t=!0),n.compareNoNANs(e[2][s],e[3][s])<0&&(e[2][s]=e[3][s],t=!0),n.compareNoNANs(e[1][s],e[2][s])<0&&(e[2][s]=e[1][s],t=!0)):i<0?(n.compareNoNANs(e[0][s],e[1][s])>0&&(e[1][s]=e[0][s],t=!0),n.compareNoNANs(e[1][s],e[3][s])>0&&(e[1][s]=e[3][s],t=!0),n.compareNoNANs(e[0][s],e[2][s])>0&&(e[2][s]=e[0][s],t=!0),n.compareNoNANs(e[2][s],e[3][s])>0&&(e[2][s]=e[3][s],t=!0),n.compareNoNANs(e[1][s],e[2][s])>0&&(e[2][s]=e[1][s],t=!0)):e[1][s]===e[0][s]&&e[2][s]===e[0][s]||(e[1][s]=e[0][s],e[2][s]=e[0][s],t=!0)}return t}function C(e,t){const s=e.getStartXY();if(s.equals(t.getStartXY()))return!0;if(s.equals(t.getEndXY()))return!0;const n=e.getEndXY();return!!n.equals(t.getStartXY())||!!n.equals(t.getEndXY())}function D(e,t){let s=e.calculateLowerLength2D();return!(s>t)&&(!!e.isLine()||(s=e.calculateUpperLength2D(),s<=t||0!==t&&e.calculateLength2D()<=t))}function b(e,s,i,r,o,a,m,h){let l=e.calculateUpperLength2D(),u=s.calculateUpperLength2D(),c=e,g=s,d=!1;l>u&&(g=n.swap(c,c=g),r=n.swap(i,i=r),u=n.swap(l,l=u),d=!0);const p=0===i;{m[0]=p?1:0;const e=c.getCoord2D(m[0]);h[0]=g.getClosestCoordinate(e,!1);const t=g.getCoord2D(h[0]);if(n.Point2D.distance(e,t)<=o){const t=[.5,.75,.25,.1,.9];let s=!0;for(let i=0;i<t.length;i++)if(e.assign(c.getCoord2D(t[i])),!g.isCloserThanDistance(e,new n.Envelope1D(0,1),o)){s=!1;break}if(s)return d&&(h[0]=n.swap(m[0],m[0]=h[0])),1}}if(l<=3*o)return 0;let _=n.snap(Math.max(o/l,.1),0,.5),f=.01*o,y=0,x=0,P=_,E=-1,v=0,C=1/32;for(let e=0;;e++){t.geometryReleaseAssert(e<4095);const s=p?_:1-_,i=c.getCoord2D(s),l=g.getClosestCoordinate(i,!1);if(l===r)return v;const u=g.getCoord2D(l),D=n.Point2D.distance(i,u);if(0===e&&(E=D),D<=f?(C=.5,x=D,y=_):(P=_,E=D),Math.abs(x-E)>.1*f&&P-y>1e-16)_=n.lerp(y,P,C);else{if(m[v]=s,h[v]=l,d&&(h[v]=n.swap(m[v],m[v]=h[v])),1===a||1===v)return 1===v&&m[0]>m[1]&&(m[1]=n.swap(m[0],m[0]=m[1]),h[1]=n.swap(h[0],h[0]=h[1])),v+1;v++,y=P,x=E,P=.8,E=-1,_=.8,C=1/32,f=10*o,e=0}}}function S(e,t,s,i,r,o,a,m,h){if(n.isOneOf(s,0,1)&&n.isOneOf(i,0,1)&&0===n.Point2D.distance(e.getCoord2D(s),t.getCoord2D(i))){const h=1e-12,l=new y,u=n.doubleEps();if(e.queryDerivative(new n.ECoordinate(s,u),l),l.isTrueZero()){const t=1===s?-1e-12:h;e.queryDerivative(new n.ECoordinate(s,u).add(t),l)}1===s&&l.negateThis();const c=new y;if(t.queryDerivative(new n.ECoordinate(i,u),c),c.isTrueZero()){const e=1===s?-1e-12:h;t.queryDerivative(new n.ECoordinate(i,u).add(e),c)}1===i&&c.negateThis(),l.isZero()||l.normalize(),c.isZero()||c.normalize();const g=l.dotProduct(c),d=l.crossProduct(c);d.scaleError(3);const p=()=>{{const s=e.calculateUpperLength2D(),n=t.calculateUpperLength2D();return Math.min(.01*r/Math.min(s,n),1e-10)}};if(g.ge(n.s_zero)&&(d.isZero()||Math.abs(d.value())<p()))return b(e,t,s,i,r,o,a,m)}return 0}function I(e,t){e.m_XStart=t.x,e.m_YStart=t.y}function w(e,t,s){e.m_XStart=t,e.m_YStart=s}function T(e,t){e.m_XEnd=t.x,e.m_YEnd=t.y}function A(e,t,s){e.m_XEnd=t,e.m_YEnd=s}function N(e,t){const n=new s.Point3D;return t?(n.x=e.m_XEnd,n.y=e.m_YEnd):(n.x=e.m_XStart,n.y=e.m_YStart),n.z=function(e,t){return e.m_description.hasZ()?e.m_attributes[t*(e.m_description.getTotalComponentCount()-2)]:E.getDefaultValue(1)}(e,t),n}function G(e,t,s){e.m_description.hasZ()||e.addAttribute(1),t?e.m_XEnd===s.x&&e.m_YEnd===s.y||(e.m_XEnd=s.x,e.m_YEnd=s.y,e.endPointModified()):e.m_XStart===s.x&&e.m_YStart===s.y||(e.m_XStart=s.x,e.m_YStart=s.y,e.endPointModified()),e.m_attributes[(e.m_description.getTotalComponentCount()-2)*t]=s.z}function M(e,t,s){s.assignVertexDescription(e.m_description);const n=0===t?e.m_XStart:e.m_XEnd,i=0===t?e.m_YStart:e.m_YEnd;s.setXYCoords(n,i);for(let n=1;n<e.m_description.getAttributeCount();n++){const i=e.m_description.getSemantics(n);for(let n=0,r=E.getComponentCount(i);n<r;n++){const r=k(e,t,i,n);s.setAttributeBasic(i,n,r)}}}function R(e,s,n){n.isEmpty()&&t.throwEmptyGeometryException(""),function(e,t,s){t?e.m_XEnd===s.x&&e.m_YEnd===s.y||(e.m_XEnd=s.x,e.m_YEnd=s.y,e.endPointModified()):e.m_XStart===s.x&&e.m_YStart===s.y||(e.m_XStart=s.x,e.m_YStart=s.y,e.endPointModified())}(e,s,n.getXY());const i=n.getDescription();i!==e.m_description&&e.mergeVertexDescription(i);for(let t=1,r=i.getAttributeCount();t<r;t++){const r=i.getSemantics(t),o=E.getComponentCount(r);for(let t=0;t<o;t++)F(e,s,r,t,n.getAttributeAsDbl(r,t))}}function k(e,s,n,i){if((s<0||s>1)&&t.throwOutOfRangeException(""),0===n)return(i<0||i>=2)&&t.throwOutOfRangeException(""),0===s?0===i?e.m_XStart:e.m_YStart:0===i?e.m_XEnd:e.m_YEnd;const r=E.getComponentCount(n);(i<0||i>=r)&&t.throwOutOfRangeException("");const o=e.m_description.getAttributeIndex(n);return o>=0?e.m_attributes[s*(e.m_description.getTotalComponentCount()-2)+e.m_description.getPointAttributeOffset(o)-2+i]:E.getDefaultValue(n)}function F(e,s,n,i,r){if((s<0||s>1)&&t.throwOutOfRangeException(""),0===n)return 0===s?0===i?e.m_XStart=r:1===i?e.m_YStart=r:t.throwOutOfRangeException(""):1===s?0===i?e.m_XEnd=r:1===i?e.m_YEnd=r:t.throwOutOfRangeException(""):t.throwOutOfRangeException(""),void e.endPointModified();const o=E.getComponentCount(n);(i<0||i>=o)&&t.throwOutOfRangeException("");let a=e.m_description.getAttributeIndex(n);a<0&&(e.addAttribute(n),a=e.m_description.getAttributeIndex(n)),e.m_attributes[s*(e.m_description.getTotalComponentCount()-2)+e.m_description.getPointAttributeOffset(a)-2+i]=r}function q(e,s){if(e===s)return;s.isEmpty()&&t.throwEmptyGeometryException("");const n=s.getDescription();n!==e.m_description&&e.mergeVertexDescription(n);for(let t=1,i=n.getAttributeCount();t<i;t++){const i=n.getSemantics(t),r=E.getComponentCount(i);for(let t=0;t<r;t++){let n=k(s,0,i,t);F(e,0,i,t,n),n=k(s,1,i,t),F(e,1,i,t,n)}}}function V(e){return e.absNorm()*n.geomEpsFactor()}function H(e,t){return Math.max(e.absNorm(),t.absNorm())*n.geomEpsFactor()}function O(e,t,s){const i=new d;e.queryEnvelopeW(n.Envelope1D.unit(),i);const r=new d;return t.queryEnvelopeW(n.Envelope1D.unit(),r),r.inflate(s),!i.isIntersectingW(r)}function Y(e,t,s){const i=n.cloneObjectArray(e,s),r=n.cloneObjectArray(t,s);i.sort((e,t)=>e.compare(t)),r.sort((e,t)=>e.compare(t));for(let e=0;e<3;e++){if(i[e].compare(r[e])<0)return-1;if(0!==i[e].compare(r[e]))return 1}return 0}var X=s.VertexDescription;class L{constructor(e){if(e.copy)this.m_XStart=e.copy.m_XStart,this.m_YStart=e.copy.m_YStart,this.m_XEnd=e.copy.m_XEnd,this.m_YEnd=e.copy.m_YEnd,this.m_description=e.copy.m_description,this.m_attributes=null,this.m_description&&this.m_description.getTotalComponentCount()-2&&(this.m_attributes=e.copy.m_attributes.slice());else{if(e.move)return this.m_description=e.move.m_description,e.move.m_description=null,this.m_attributes=e.move.m_attributes,e.move.m_attributes=null,this.m_XStart=e.move.m_XStart,this.m_YStart=e.move.m_YStart,this.m_XEnd=e.move.m_XEnd,void(this.m_YEnd=e.move.m_YEnd);if(void 0!==e.XStart)return this.m_XStart=e.XStart,this.m_YStart=e.YStart,this.m_XEnd=e.XEnd,this.m_YEnd=e.YEnd,this.m_attributes=null,this.m_description=e.vd?e.vd:s.getDefaultDescription2D(),void(e.vd&&this.setDefaultAttributeValues());if(void 0!==e.ZStart)return this.m_XStart=e.XStart,this.m_YStart=e.YStart,this.m_XEnd=e.XEnd,this.m_YEnd=e.YEnd,this.m_description=e.vd?e.vd:s.getDefaultDescription3D(),void(e.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=e.ZStart,this.m_attributes[this.m_description.getTotalComponentCount()-2]=e.ZEnd):this.m_attributes=[e.ZStart,e.ZEnd]);if(e.start)return this.m_XStart=e.start.x,this.m_YStart=e.start.y,this.m_XEnd=e.end.x,this.m_YEnd=e.end.y,this.m_attributes=null,void(this.m_description=s.getDefaultDescription2D());if(e.start3D)return this.m_XStart=e.start3D.x,this.m_YStart=e.start3D.y,this.m_XEnd=e.end3D.x,this.m_YEnd=e.end3D.y,this.m_description=e.vd?e.vd:s.getDefaultDescription3D(),void(e.vd?(this.setDefaultAttributeValues(),this.addAttribute(1),this.m_attributes[0]=e.start3D.z,this.m_attributes[this.m_description.getTotalComponentCount()-2]=e.end3D.z):this.m_attributes=[e.start3D.z,e.end3D.z]);t.throwInternalErrorException("bad constructor params"),this.m_XStart=this.m_YStart=this.m_XEnd=this.m_YEnd=Number.NaN}}setDefaultAttributeValues(){const e=this.m_description.getTotalComponentCount()-2;e>0&&(null===this.m_attributes&&(this.m_attributes=n.makePrimitiveArray(2*e,Number.NaN)),n.memcpy(this.m_attributes,this.m_description.getDefaultPointAttributes(),0,2,e),n.memcpy(this.m_attributes,this.m_description.getDefaultPointAttributes(),e,2,e))}absNormXYZ(e){return t.throwNotImplementedException("not implemented"),0}queryWeights(e){}snapControlPoints3D(){return t.throwNotImplementedException("not implemented"),!1}setCoordsForIntersector3D(e,s,n){t.throwNotImplementedException("not implemented")}transformAttribute(e,s,n,i,r){t.throwNotImplementedException("")}mergeVertexDescriptionImpl(e){const t=this.getDescription(),n=s.getMergedVertexDescription(t,e);this.assignVertexDescription(n)}changeEndPoints(e,t){const s=e.getXY(),n=t.getXY();this.changeEndPoints2D(s,n);let i=e.getDescription();i!==this.getDescription()&&this.mergeVertexDescription(i),i=t.getDescription(),i!==this.getDescription()&&this.mergeVertexDescription(i);for(let s=1,n=i.getAttributeCount();s<n;s++){const n=i.getSemantics(s),r=X.getComponentCount(n);for(let s=0;s<r;s++)F(this,0,n,s,e.getAttributeAsDbl(n,s)),F(this,1,n,s,t.getAttributeAsDbl(n,s))}}getStartXY(){return new n.Point2D(this.m_XStart,this.m_YStart)}setStartXY(e){this.m_XStart=e.x,this.m_YStart=e.y,this.endPointModified()}setStartXYCoords(e,t){this.m_XStart=e,this.m_YStart=t,this.endPointModified()}getStartXYZ(){return N(this,0)}setStartXYZ(e){G(this,0,e)}setStartXYZCoords(e,t,n){G(this,0,s.Point3D.construct(e,t,n))}queryStart(e){M(this,0,e)}setStart(e){R(this,0,e)}setStart2D(e){this.setStartXY(e)}getStartAttributeAsDbl(e,t){return k(this,0,e,t)}getStartAttributeAsInt(e,s){return t.geometryReleaseAssert(0),0}setStartAttribute(e,t,s){F(this,0,e,t,s)}setStartAttributesFromPoint(e,t){const s=e.getDescription();for(let n=t&&s.hasZ()?2:1,i=s.getAttributeCount();n<i;++n){const t=s.getSemantics(n),i=X.getComponentCount(t);for(let s=0;s<i;++s){const n=e.getAttributeAsDbl(t,s);this.setStartAttribute(t,s,n)}}}setEndAttributesFromPoint(e,t){const s=e.getDescription();for(let n=t&&s.hasZ()?2:1,i=s.getAttributeCount();n<i;++n){const t=s.getSemantics(n),i=X.getComponentCount(t);for(let s=0;s<i;++s){const n=e.getAttributeAsDbl(t,s);this.setEndAttribute(t,s,n)}}}getStartX(){return this.m_XStart}getStartY(){return this.m_YStart}getStartZ(){return t.geometryReleaseAssert(0),0}getEndX(){return this.m_XEnd}getEndY(){return this.m_YEnd}getEndZ(){return t.geometryReleaseAssert(0),0}getEndXY(){return new n.Point2D(this.m_XEnd,this.m_YEnd)}setEndXY(e){this.m_XEnd=e.x,this.m_YEnd=e.y,this.endPointModified()}setEndXYCoords(e,t){this.m_XEnd=e,this.m_YEnd=t,this.endPointModified()}getEndXYZ(){return N(this,1)}setEndXYZ(e){G(this,1,e)}setEndXYZCoords(e,t,n){G(this,1,s.Point3D.construct(e,t,n))}queryEnd(e){M(this,1,e)}setEnd(e){R(this,1,e)}setEnd2D(e){this.setEndXY(e)}getEndAttributeAsDbl(e,t){return k(this,1,e,t)}getEndAttributeAsInt(e,s){return t.geometryReleaseAssert(0),Math.trunc(0)}setEndAttribute(e,t,s){F(this,1,e,t,s)}getDimension(){return 1}copyTo(e){if(this===e)return;e.getGeometryType()!==this.getGeometryType()&&t.throwInvalidArgumentException("");const s=e;s.assignVertexDescription(this.m_description),s.m_attributes&&n.memcpy(s.m_attributes,this.m_attributes,0,0,2*(this.m_description.getTotalComponentCount()-2)),s.m_XStart=this.m_XStart,s.m_YStart=this.m_YStart,s.m_XEnd=this.m_XEnd,s.m_YEnd=this.m_YEnd,this.copyToImpl(s)}isEmpty(){return this.isEmptyImpl()}isClosed(){return this.m_XStart===this.m_XEnd&&this.m_YStart===this.m_YEnd}setEmpty(){}calculateArea2D(){return 0}queryInterval(e,t){const s=n.Envelope1D.constructEmpty();return s.vmin=k(this,0,e,t),s.vmax=s.vmin,s.mergeNeCoordinate(k(this,1,e,t)),s}calculateLength3D(e){return t.geometryReleaseAssert(0),0}getCoord3D(e){return t.geometryReleaseAssert(0),{}}getCoord2D(e){const t=n.Point2D.getNAN();return this.queryCoord2D(e,t),t}queryCoord3D(e,s){t.geometryReleaseAssert(0)}getCoordZ(e){return t.geometryReleaseAssert(0),0}queryCoord(e,t){t.assignVertexDescription(this.m_description),t.setXY(this.getCoord2D(e));for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){const n=this.m_description.getSemantics(s),i=X.getComponentCount(n);for(let s=0;s<i;s++){const i=this.getAttributeAsDbl(e,n,s);t.setAttributeBasic(n,s,i)}}}isCloserThanDistance(e,t,s){const r=i.Envelope2D.constructEmpty();if(this.queryLooseEnvelopeOnInterval(t,r),r.distance(e)>s)return!1;const o=this.getClosestCoordinateOnInterval(e,t,s);return!Number.isNaN(o)&&n.Point2D.distance(e,this.getCoord2D(o))<=s}isMonotoneQuickAndDirty(){return!1}isTrue3D(){return!1}getReversed(){const e=this.clone();return e.reverse(),e}reverse(){this.m_XEnd=n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=n.swap(this.m_YStart,this.m_YStart=this.m_YEnd),this.reverseImpl();for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e);for(let e=0,s=X.getComponentCount(t);e<s;e++){const s=k(this,0,t,e);F(this,0,t,e,k(this,1,t,e)),F(this,1,t,e,s)}}return this.afterCompletedModification(),this}isEmptyImpl(){return!1}isCircular(){return!1}distance(e,s,i,r){if(!s&&this.isIntersecting(e,0,!1)){if(null!==i||null!==r){const s=n.makePrimitiveArray(9,Number.NaN),o=n.makePrimitiveArray(9,Number.NaN),a=this.intersect(e,null,s,o,0);t.geometryReleaseAssert(a<=9),0===a&&t.throwInternalErrorException(""),null!==i&&(i[0]=s[0]),null!==r&&(r[0]=o[0])}return 0}let o,a=Number.MAX_VALUE,m=-1,h=a;return o=this.getStartXY(),m=e.getClosestCoordinate(o,!1),o.subThis(e.getCoord2D(m)),h=o.length(),h<a&&(a=h,null!==r&&(r[0]=m),null!==i&&(i[0]=0)),o=this.getEndXY(),m=e.getClosestCoordinate(o,!1),o.subThis(e.getCoord2D(m)),h=o.length(),h<a&&(a=h,null!==r&&(r[0]=m),null!==i&&(i[0]=1)),o=e.getStartXY(),m=this.getClosestCoordinate(o,!1),o.subThis(this.getCoord2D(m)),h=o.length(),h<a&&(a=h,null!==i&&(i[0]=m),null!==r&&(r[0]=0)),o=e.getEndXY(),m=this.getClosestCoordinate(o,!1),o.subThis(this.getCoord2D(m)),h=o.length(),h<a&&(a=h,null!==i&&(i[0]=m),null!==r&&(r[0]=1)),a}calculateSubLengthFromStart(e){return this.tToLength(e)}calculateSubLength(e,t){return t===e?0:this.tToLength(t)-this.tToLength(e)}static recalculateParentT(e,t,s){return n.lerp(e,t,s)}moveTo(e){const t=this.isClosed(),s=new r.Transformation2D;s.setShift(e.sub(this.getStartXY())),this.applyTransformation(s),t?this.changeEndPoints2D(e,e):this.changeEndPoints2D(e,this.getEndXY())}moveTo3D(e){t.geometryReleaseAssert(0)}getDescription(){return this.m_description}assignVertexDescription(e){!function(e,t){const i=s.createAttributeMap();s.mapAttributes(t,e.m_description,i);let r=null;const o=t.getTotalComponentCount()-2,a=e.m_description?e.m_description.getTotalComponentCount()-2:0;if(o>0&&(r=n.makePrimitiveArray(2*o,Number.NaN),n.memcpy(r,t.getDefaultPointAttributes(),0,2,o),n.memcpy(r,t.getDefaultPointAttributes(),o,2,o),null!==e.m_description))for(let s=1;s<t.getAttributeCount();s++){const n=i[s];if(-1!==n){const i=e.m_description.getPointAttributeOffset(n)-2,m=t.getPointAttributeOffset(s)-2,h=E.getComponentCount(t.getSemantics(s));for(let t=0;t<h;++t)r[m]=e.m_attributes[i],r[o+m]=e.m_attributes[a+i]}}e.m_attributes=r,e.m_description=t}(this,e)}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=s.getMergedVertexDescriptionSemantics(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=s.removeSemanticsFromVertexDescription(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=s.getDefaultDescription2D();e!==this.m_description&&this.assignVertexDescription(e)}swap(e){if(this===e)return;e.getGeometryType()!==this.getGeometryType()&&t.throwInvalidArgumentException("wrong geometry type");const s=e;s.m_description=n.swap(this.m_description,this.m_description=s.m_description),s.m_XStart=n.swap(this.m_XStart,this.m_XStart=s.m_XStart),s.m_YStart=n.swap(this.m_YStart,this.m_YStart=s.m_YStart),s.m_XEnd=n.swap(this.m_XEnd,this.m_XEnd=s.m_XEnd),s.m_YEnd=n.swap(this.m_YEnd,this.m_YEnd=s.m_YEnd),s.m_attributes=n.swap(this.m_attributes,this.m_attributes=s.m_attributes),this.swapImpl(s)}equals(e,t){if(this.getGeometryType()!==e.getGeometryType())return!1;const s=void 0===t;s&&(t=0);const i=e;if(this===i)return!0;if(this.m_description!==i.m_description)return!1;if(Math.abs(this.m_XStart-i.m_XStart)>t||Math.abs(this.m_XEnd-i.m_XEnd)>t||Math.abs(this.m_YStart-i.m_YStart)>t||Math.abs(this.m_YEnd-i.m_YEnd)>t)return!1;for(let e=0,s=2*(this.m_description.getTotalComponentCount()-2);e<s;e++)if(!n.isEqualNonIEEETol(this.m_attributes[e],i.m_attributes[e],t))return!1;return s?this.equalsImpl(i):this.equalsImplTol(i,t)}getImpl(){return this}setAttributeBasic(e,s,n){if(this.addAttribute(e),0===e&&this.isCurve()){(s<0||s>1)&&t.throwInvalidArgumentException("");const e=new r.Transformation2D,i=0===s?n:0,o=1===s?n:0;e.setShiftCoords(i,o),0===s?e.xx=0:e.yy=0,this.applyTransformation(e)}else this.setStartAttribute(e,s,n),this.setEndAttribute(e,s,n)}replaceNaNs(e,t){if(this.addAttribute(e),this.isEmpty())return;const s=X.getComponentCount(e);for(let n=0;n<s;n++){const s=this.getStartAttributeAsDbl(e,n);Number.isNaN(s)&&this.setStartAttribute(e,n,t);const i=this.getEndAttributeAsDbl(e,n);Number.isNaN(i)&&this.setEndAttribute(e,n,t)}}}L.s_maxMonotonicPartParams=8;class B extends o.GeometryCursor{constructor(e,t){super(),this.m_index=-1,this.gc=e,this.dim=t}next(){for(;;){if(this.m_index>=this.gc.getGeometryCount())return null;if(this.m_index++,this.m_index===this.gc.getGeometryCount())return null;const e=this.gc.getGeometry(this.m_index);if(-1===this.dim||1<<e.getDimension()&this.dim)return e}return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class z{constructor(e){this.m_geoms=[],this.m_description=s.getDefaultDescription2D(),e&&(e.vd?this.m_description=e.vd:e.copy?e.copy.copyTo(this):t.throwInvalidArgumentException("constructor argument not recognized"))}getGeometryCount(){return this.m_geoms.length}reserve(e){}addGeometry(e){if(e.getGeometryType()===t.GeometryType.enumGeometryCollection){const t=e;for(let e=0,s=t.getGeometryCount();e<s;e++)this.addGeometry(t.getGeometry(e))}else this.m_geoms.push(e.clone()),this.mergeVertexDescription(e.getDescription())}addCursor(e){for(let t=e.next();null!==t;t=e.next())this.addGeometry(t)}getGeometry(e){return(e<0||e>=this.m_geoms.length)&&t.throwInvalidArgumentException("Geometry_collection.get_geometry"),this.m_geoms[e]}modifiedElementIndex(e){this.mergeVertexDescription(this.getGeometry(e).getDescription())}modifiedElement(e){this.mergeVertexDescription(e.getDescription())}getGeometryType(){return t.GeometryType.enumGeometryCollection}getDimension(){let e=0;for(const t of this.m_geoms)e=Math.max(e,t.getDimension());return e}getDescription(){return this.m_description}assignVertexDescription(e){this.m_description!==e&&this.assignVertexDescriptionImpl(e)}assignVertexDescriptionImpl(e){for(const t of this.m_geoms)t.assignVertexDescription(e);this.m_description=e}mergeVertexDescription(e){this.m_description!==e&&(this.m_description.hasAttributesFrom(e)||this.mergeVertexDescriptionImpl(e))}hasAttribute(e){return this.m_description.hasAttribute(e)}addAttribute(e){if(this.m_description.hasAttribute(e))return;const t=s.getMergedVertexDescriptionSemantics(this.m_description,e);this.assignVertexDescription(t)}dropAttribute(e){if(!this.m_description.hasAttribute(e))return;const t=s.removeSemanticsFromVertexDescription(this.m_description,e);this.assignVertexDescription(t)}dropAllAttributes(){const e=s.getDefaultDescription2D();e!==this.m_description&&this.assignVertexDescription(e)}queryInterval(e,t){let s=new n.Envelope1D;const i=new n.Envelope1D;i.setEmpty();for(const n of this.m_geoms)s=n.queryInterval(e,t),i.merge(s);return i}queryEnvelope(e){if(4===e.m_EnvelopeType){const t=new s.Envelope;e.setEmpty(),e.assignVertexDescription(this.m_description);for(const s of this.m_geoms)s.queryEnvelope(t),e.merge(t)}else if(2===e.m_EnvelopeType){const t=new i.Envelope2D;e.setEmpty();for(const s of this.m_geoms)s.queryEnvelope(t),e.mergeEnvelope2D(t)}t.throwNotImplementedException("3d envelope case not implemented")}queryLooseEnvelope(e){if(2===e.m_EnvelopeType){const t=new i.Envelope2D;e.setEmpty();for(const s of this.m_geoms)s.queryLooseEnvelope(t),e.mergeEnvelope2D(t)}t.throwNotImplementedException("3d not impl")}isEmpty(){return 0===this.m_geoms.length}setEmpty(){this.m_geoms.length=0}applyTransformation(e){if(1===e.m_TransformationType)for(const t of this.m_geoms)t.applyTransformation(e);t.throwNotImplementedException("3d xform not impl")}transformAttribute(e,t,s,n,i){for(const r of this.m_geoms)r.transformAttribute(e,t,s,n,i)}createInstance(){return new z({vd:this.getDescription()})}copyTo(e){e.getGeometryType()!==t.GeometryType.enumGeometryCollection&&t.throwInvalidArgumentException("");const s=e;if(s!==this){s.m_geoms.length=0,s.assignVertexDescription(this.m_description);for(const e of this.m_geoms)s.m_geoms.push(e.clone())}}calculateArea2D(){const e=new n.KahanSummator(0);for(const t of this.m_geoms)e.pe(t.calculateArea2D());return e.getResult()}calculateLength2D(){const e=new n.KahanSummator(0);for(const t of this.m_geoms)e.pe(t.calculateLength2D());return e.getResult()}calculateLength3D(e){return t.geometryReleaseAssert(0),0}getBoundary(){const e=this.createInstance(),t=e;for(const e of this.m_geoms){const s=e.getBoundary();s&&t.m_geoms.push(s)}return e}clone(){return new z({copy:this})}equals(e,s){if(e===this)return!0;if(e.getGeometryType()!==t.GeometryType.enumGeometryCollection)return!1;const n=e;if(this.m_description!==n.m_description)return!1;if(this.m_geoms.length!==n.m_geoms.length)return!1;for(let e=0;e<this.m_geoms.length;++e)if(!this.m_geoms[e].equals(n.m_geoms[e],s))return!1;return!0}swap(e){e.getGeometryType()!==t.GeometryType.enumGeometryCollection&&t.throwInvalidArgumentException("");const s=e;s!==this&&(this.m_geoms=n.swap(s.m_geoms,s.m_geoms=this.m_geoms))}setAttributeBasic(e,t,s){for(const n of this.m_geoms)n.setAttributeBasic(e,t,s)}replaceNaNs(e,t){for(const s of this.m_geoms)s.replaceNaNs(e,t)}getImpl(){return this}mergeVertexDescriptionImpl(e){const t=this.getDescription(),n=s.getMergedVertexDescription(t,e);this.assignVertexDescription(n)}}z.type=t.GeometryType.enumGeometryCollection;class U extends L{constructor(e){super(e)}}class j extends U{isTrue3D(){return!0}constructor(e){super(e)}}function W(e,t,s){Z(t,e.getStartXY(),e.getEndXY(),s)}function Z(e,t,s,i){n.lerpPoint2D(t,s,e,i)}function Q(e,t){return n.lerp(e.m_XStart,e.m_XEnd,t)}function K(e,t){return n.lerp(e.m_YStart,e.m_YEnd,t)}function $(e,t,s){t.value()<=.5?n.lerpLoPointE(2,y.constructPoint2D(e.getStartXY()),y.constructPoint2D(e.getEndXY()),t,s):n.lerpHiPointE(2,y.constructPoint2D(e.getStartXY()),y.constructPoint2D(e.getEndXY()),t,s)}function J(e,t,s){e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=s.x,e.m_YEnd=s.y,e.afterCompletedModification()}function ee(e){if(e.m_YEnd<e.m_YStart||e.m_YEnd===e.m_YStart&&e.m_XEnd<e.m_XStart){e.m_XEnd=n.swap(e.m_XStart,e.m_XStart=e.m_XEnd),e.m_YEnd=n.swap(e.m_YStart,e.m_YStart=e.m_YEnd);for(let t=0,s=e.m_description.getTotalComponentCount()-2;t<s;t++)e.m_attributes[t+s]=n.swap(e.m_attributes[t],e.m_attributes[t]=e.m_attributes[t+s])}}function te(e,t,s,n){let i=0;if((e.m_XStart===t.m_XStart&&e.m_YStart===t.m_YStart||e.m_XStart===t.m_XEnd&&e.m_YStart===t.m_YEnd)&&(i++,!n))return 1;if(e.m_XEnd===t.m_XStart&&e.m_YEnd===t.m_YStart||e.m_XEnd===t.m_XEnd&&e.m_YEnd===t.m_YEnd){if(i++,2===i)return 2;if(!n)return 1}return t.isIntersectingPoint(e.getStartXY(),s,!0)||t.isIntersectingPoint(e.getEndXY(),s,!0)||e.isIntersectingPoint(t.getStartXY(),s,!0)||e.isIntersectingPoint(t.getEndXY(),s,!0)?4:n&&i?0:function(e,t){const s=ie(e,t.m_XStart,t.m_YStart),n=ie(e,t.m_XEnd,t.m_YEnd);if(s<0&&n<0||s>0&&n>0)return!1;const i=ie(t,e.m_XStart,e.m_YStart),r=ie(t,e.m_XEnd,e.m_YEnd);return!(i<0&&r<0||i>0&&r>0)&&(ae(e)>ae(t)?oe(e,t):oe(t,e))}(e,t)?4:0}function se(e,t,s,i,r,o,a,m){null!==i&&n.initializePrimitiveArray(i,2,Number.NaN),null!==r&&n.initializePrimitiveArray(r,2,Number.NaN),null!==s&&n.initializeObjectArray(s,n.Point2D,2);const h=function(e,t,s,i,r,o,a,m,h){const l=ne(e,t.getStartXY(),a,!1),u=ne(e,t.getEndXY(),a,!1),c=ne(t,e.getStartXY(),a,!1),g=ne(t,e.getEndXY(),a,!1);let d=0,p=0;if(!Number.isNaN(l)){let s=!1;m&&n.isOneOf(l,0,1)&&e.getCoord2D(l).isEqualPoint2D(t.getStartXY())&&(d++,s=!0),s||(r&&(r[p]=l),o&&(o[p]=0),i&&i[p].setCoords(t.m_XStart,t.m_YStart),p++)}if(!Number.isNaN(u)){let s=!1;m&&n.isOneOf(u,0,1)&&e.getCoord2D(u).isEqualPoint2D(t.getEndXY())&&(d++,s=!0),s||(2>p&&(r&&(r[p]=u),o&&(o[p]=1),i&&i[p].setCoords(t.m_XEnd,t.m_YEnd)),p++)}if(2!==p&&!Number.isNaN(c)&&!(0===l&&0===c||0===u&&1===c)){let s=!1;m&&n.isOneOf(c,0,1)&&t.getCoord2D(c).isEqualPoint2D(e.getStartXY())&&(d++,s=!0),s||(2>p&&(r&&(r[p]=0),o&&(o[p]=c),i&&i[p].setCoords(e.m_XStart,e.m_YStart)),p++)}if(2!==p&&!Number.isNaN(g)&&!(1===l&&0===g||1===u&&1===g)){let s=!1;m&&n.isOneOf(g,0,1)&&t.getCoord2D(g).isEqualPoint2D(e.getEndXY())&&(d++,s=!0),s||(2>p&&(r&&(r[p]=1),o&&(o[p]=g),i&&i[p].setCoords(t.m_XEnd,t.m_YEnd)),p++)}if(p>0)return h&&(o=n.swap(r,r=o)),2===p&&r&&r[0]>r[1]&&(r[1]=n.swap(r[0],r[0]=r[1]),o&&(o[1]=n.swap(o[0],o[0]=o[1])),i&&(i[1]=n.swap(i[0],i[0]=i[1]))),p;if(d>0)return 0;const _=function(e,t,s){const i=e.m_XEnd-e.m_XStart,r=e.m_YEnd-e.m_YStart,o=t.m_XEnd-t.m_XStart,a=t.m_YEnd-t.m_YStart,m=o*r-i*a;if(0===m)return n.Point2D.getNAN();const h=4*n.doubleEps()*(Math.abs(o*r)+Math.abs(i*a)),l=t.m_XStart-e.m_XStart,u=t.m_YStart-e.m_YStart,c=o*u-l*a,g=4*n.doubleEps()*(Math.abs(o*u)+Math.abs(l*a)),d=c/m,p=Math.abs(m),_=(g*p+h*Math.abs(c))/(m*m)+n.doubleEps()*Math.abs(d);if(d<-_||d>1+_)return n.Point2D.getNAN();const f=i*u-l*r,y=f/m,x=(4*n.doubleEps()*(Math.abs(i*u)+Math.abs(l*r))*p+h*Math.abs(f))/(m*m)+n.doubleEps()*Math.abs(y);if(y<-x||y>1+x)return n.Point2D.getNAN();let P=n.snap(d,0,1),E=n.snap(y,0,1);const v=n.Point2D.getNAN();W(e,P,v);const C=n.Point2D.getNAN();if(W(t,E,C),!s||n.Point2D.distance(v,C)>s){const i=n.Point2D.getNAN();n.lerpPoint2D(v,C,.5,i),P=e.getClosestCoordinate(i,!1),E=t.getClosestCoordinate(i,!1);const r=n.Point2D.getNAN();W(e,P,r);const o=n.Point2D.getNAN();W(t,E,o),r.subThis(o);const a=r.length(),m=(e.absNorm()+t.absNorm())*n.geomEpsFactor();if(a>Math.max(s,m))return n.Point2D.getNAN()}return new n.Point2D(P,E)}(e,t,a);return Number.isNaN(_.x)?0:(i&&(i[0]=e.getCoord2D(_.x)),r&&(r[0]=_.x),o&&(o[0]=_.y),1)}(e,t,0,s,i,r,o,a,m);return i&&(i.length=h),r&&(r.length=h),s&&(s.length=h),h}function ne(e,t,s,i){const r=n.Point2D.getNAN(),o=n.Point2D.getNAN();let a=!1;e.m_YEnd<e.m_YStart||e.m_YEnd===e.m_YStart&&e.m_XEnd<e.m_XStart?(r.setCoords(e.m_XEnd,e.m_YEnd),o.setCoords(e.m_XStart,e.m_YStart),a=!0):(r.setCoords(e.m_XStart,e.m_YStart),o.setCoords(e.m_XEnd,e.m_YEnd));const m=a?1:0,h=a?0:1,l=n.Point2D.getNAN();l.setSub(t,r);let u=l.length(),c=3*u*n.doubleEps();if(u<=Math.max(s,c))return i&&0===u?Number.NaN:m;if(l.setSub(t,o),u=l.length(),c=3*u*n.doubleEps(),u<=Math.max(s,c))return i&&0===u?Number.NaN:h;l.setCoords(o.x-r.x,o.y-r.y);const g=l.length();if(g>0){const e=1/g;l.scale(e);const i=n.Point2D.getNAN();i.setSub(t,r);const u=i.dotProduct(l),c=8*i.dotProductAbs(l)*n.doubleEps();l.leftPerpendicularThis();const d=i.dotProduct(l),p=8*i.dotProductAbs(l)*n.doubleEps(),_=Math.max(s,c);if(u<-_||u>g+_)return Number.NaN;const f=Math.max(s,p);if(Math.abs(d)<=f){let i=u*e;i=n.snap(i,0,1);const l=n.Point2D.getNAN();if(Z(i,r,o,l),n.Point2D.distance(l,t)<=s){if(i<.5){if(n.Point2D.distance(l,r)<=s&&n.Point2D.distance(t,r)<=s)return m}else if(n.Point2D.distance(l,o)<=s&&n.Point2D.distance(t,o)<=s)return h;return a?1-i:i}}}return Number.NaN}function ie(e,t,s){const i=n.Point2D.getNAN();i.setCoords(t,s),i.subThis(e.getStartXY());const r=n.Point2D.getNAN();r.setSub(e.getEndXY(),e.getStartXY());const o=r.crossProduct(i),a=4*n.doubleEps()*(Math.abs(r.x*i.y)+Math.abs(r.y*i.x));return o>a?-1:o<-a?1:0}function re(e,t,s,i){const r=i?e.m_XStart:e.m_XEnd,o=i?e.m_YStart:e.m_YEnd,a=n.Point2D.getNAN();return a.x=t.getEndX()-r,a.y=t.getEndY()-o,!(s.dotProduct(a)>3*n.doubleEps()*s.dotProductAbs(a))||(a.x=t.getStartX()-r,a.y=t.getStartY()-o,s.dotProduct(a)<=3*n.doubleEps()*s.dotProductAbs(a))}function oe(e,t){const s=n.Point2D.getNAN();return s.x=e.m_XEnd-e.m_XStart,s.y=e.m_YEnd-e.m_YStart,!!re(e,t,s,!1)&&(s.negateThis(),!!re(e,t,s,!0))}function ae(e){const t=e.m_XStart-e.m_XEnd,s=e.m_YStart-e.m_YEnd;return t*t+s*s}class me{constructor(e){if(this.m_segFlagStream=null,this.m_xyStream=null,this.m_bCirculator=!1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_parent=e.parent,this.m_buffer=new this.m_parent.m_segmentBufferCTor,this.m_description=e.parent.getDescription(),this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),void 0!==e.pointIndex){(e.pointIndex<0||e.pointIndex>=e.parent.getPointCount())&&t.throwOutOfRangeException("");const s=e.parent.getPathIndexFromPointIndex(e.pointIndex);this.m_currentPathIndex=s,this.m_nextPathIndex=s+1,this.m_nextSegmentIndex=e.pointIndex-e.parent.getPathStart(s),this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex)}else if(void 0!==e.pathIndex){(e.pathIndex<0||e.pathIndex>=e.parent.getPathCount()||e.segmentIndex<0)&&t.throwOutOfRangeException("");const s=e.parent.isClosedPath(e.pathIndex)?0:1;e.segmentIndex>=e.parent.getPathSize(e.pathIndex)-s&&t.throwOutOfRangeException(""),this.m_nextSegmentIndex=e.segmentIndex,this.m_currentPathIndex=e.pathIndex,this.m_nextPathIndex=this.m_nextSegmentIndex+1,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex)}this.prepare(),this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1,this.m_bStripAttributes=!1,this.m_prevPathIndex=-1,this.m_prevSegmentIndex=-1,this.m_bNeedsUpdate=!1,this.m_currentPathIndex>-1&&(this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex))}stripAttributes(){this.m_bStripAttributes=!0}prepare(){this.m_bCirculator=!1,this.m_parent.isEmptyImpl()?(this.m_segFlagStream=null,this.m_xyStream=null):(this.m_segFlagStream=this.m_parent.getSegmentFlagsStreamRef(),this.m_xyStream=this.m_parent.getAttributeStreamRef(0))}nextPath(){return this.m_currentPathIndex=this.m_nextPathIndex,!(this.m_currentPathIndex>=this.m_parent.getPathCount()||(this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_currentPathIndex),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.m_nextPathIndex++,0))}previousPath(){return 0!==this.m_nextPathIndex&&(this.m_nextPathIndex--,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0,this.m_segmentCount=this.getSegmentCount(this.m_nextPathIndex),this.m_currentPathIndex=this.m_nextPathIndex,this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex),this.resetToLastSegment(),!0)}getSegmentCount(e){return this.m_parent.isEmptyImpl()?0:this.m_parent.getSegmentCountPath(e)}resetToFirstPath(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_nextPathIndex=0,this.m_currentPathIndex=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}resetToLastPath(){this.m_nextPathIndex=this.m_parent.getPathCount(),this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1}resetToPath(e){(e<0||e>this.m_parent.getPathCount())&&t.throwOutOfRangeException(""),this.m_nextPathIndex=e,this.m_currentPathIndex=-1,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=-1,this.m_segmentCount=-1,this.m_pathBegin=-1,this.m_bCurrentPathClosed=!1}isLastPath(){return this.m_currentPathIndex===this.m_parent.getPathCount()-1}isFirstSegmentInPath(){return 0===this.m_currentSegmentIndex}isLastSegmentInPath(){return this.m_currentSegmentIndex===this.m_segmentCount-1}resetToFirstSegment(){this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=0}resetToLastSegment(){this.m_nextSegmentIndex=this.m_segmentCount,this.m_currentSegmentIndex=-1}resetTo(e){this.m_parent!==e.m_parent&&t.throwInvalidCallException(""),this.m_currentSegmentIndex=e.m_currentSegmentIndex,this.m_nextSegmentIndex=e.m_nextSegmentIndex,this.m_currentPathIndex=e.m_currentPathIndex,this.m_nextPathIndex=e.m_nextPathIndex,this.m_segmentCount=e.m_segmentCount,this.m_bCirculator=e.m_bCirculator,this.m_pathBegin=e.m_pathBegin,this.m_bCurrentPathClosed=e.m_bCurrentPathClosed,this.m_bStripAttributes=e.m_bStripAttributes,this.m_description=e.m_description}resetToVertex(e,t){if(this.m_currentPathIndex>=0&&this.m_currentPathIndex<this.m_parent.getPathCount()){const t=this.getPathBegin();if(e>=t&&e<this.m_parent.getPathEnd(this.m_currentPathIndex))return this.m_currentSegmentIndex=-1,void(this.m_nextSegmentIndex=e-t)}let s;s=t>=0&&t<this.m_parent.getPathCount()&&e>=this.m_parent.getPathStart(t)&&e<this.m_parent.getPathEnd(t)?t:this.m_parent.getPathIndexFromPointIndex(e),this.m_nextPathIndex=s+1,this.m_currentPathIndex=s,this.m_currentSegmentIndex=-1,this.m_nextSegmentIndex=e-this.m_parent.getPathStart(s),this.m_segmentCount=this.getSegmentCount(s),this.m_pathBegin=this.m_parent.getPathStart(this.m_currentPathIndex),this.m_bCurrentPathClosed=this.m_parent.isClosedPath(this.m_currentPathIndex)}hasNextSegment(){return this.m_nextSegmentIndex<this.m_segmentCount}hasPreviousSegment(){return this.m_nextSegmentIndex>0}nextSegment(){return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&t.throwOutOfRangeException("Segment_iterator_impl::next_segment"),this.m_nextSegmentIndex++),this.m_buffer.get()}previousSegment(){return this.m_bCirculator?this.m_nextSegmentIndex=(this.m_segmentCount+this.m_nextSegmentIndex-1)%this.m_segmentCount:(0===this.m_nextSegmentIndex&&t.throwOutOfRangeException(""),this.m_nextSegmentIndex--),this.m_nextSegmentIndex!==this.m_currentSegmentIndex&&this.updateSegment(),this.m_buffer.get()}nextCurve(){if(!this.m_parent.hasNonLinearSegments())return this.resetToLastSegment(),null;let e=0;for(;;){if(this.m_nextSegmentIndex===this.m_segmentCount||e===this.m_segmentCount)return null;const t=this.getPathBegin()+this.m_nextSegmentIndex;if(1!=(31&this.m_segFlagStream.read(t))){this.updateSegment();break}this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:this.m_nextSegmentIndex++,e++}return this.m_currentSegmentIndex!==this.m_nextSegmentIndex&&this.updateSegment(),this.m_bCirculator?this.m_nextSegmentIndex=(this.m_nextSegmentIndex+1)%this.m_segmentCount:(this.m_nextSegmentIndex===this.m_segmentCount&&t.throwOutOfRangeException(""),this.m_nextSegmentIndex++),this.m_buffer.get()}getPathBegin(){return this.m_pathBegin}getPathIndex(){return this.m_currentPathIndex}getStartPointIndex(){return this.getPathBegin()+this.m_currentSegmentIndex}getEndPointIndex(){return this.isClosingSegment()?this.getPathBegin():this.getStartPointIndex()+1}updateSegment(){(this.m_nextSegmentIndex<0||this.m_nextSegmentIndex>=this.m_segmentCount||this.m_currentPathIndex<0)&&t.throwOutOfRangeException(""),this.m_currentSegmentIndex=this.m_nextSegmentIndex,this.m_parent.getSegmentFromPath(this.m_currentPathIndex,this.m_currentSegmentIndex,this.m_buffer,this.m_bStripAttributes)}isClosingSegment(){return this.m_bCurrentPathClosed&&this.m_currentSegmentIndex===this.m_segmentCount-1}isCurve(){return null!==this.m_segFlagStream&&1!=(31&this.m_segFlagStream.read(this.m_currentSegmentIndex))}isPathClosed(){return this.m_bCurrentPathClosed}setCirculator(e){this.m_bCirculator=e}getImpl(){return this}}class he{constructor(e){this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null,this.m_refCount=1,e&&e.copyTo(this)}getRasterizedGeometry(){return this.m_rasterizedGeometry}copyTo(e){e!==this&&(t.geometryReleaseAssert(e.uniqueUse()),e.m_quadTree=this.m_quadTree,e.m_quadTreeForPaths=this.m_quadTreeForPaths,e.m_rasterizedGeometry=this.m_rasterizedGeometry)}clone(){const e=new he;return this.copyTo(e),e}uniqueUse(){return 1===this.m_refCount}addRef(){++this.m_refCount}release(){0===--this.m_refCount&&(this.m_rasterizedGeometry=null,this.m_quadTree=null,this.m_quadTreeForPaths=null)}setRasterizedGeometry(e){t.geometryReleaseAssert(this.uniqueUse())}setQuadTree(e){t.geometryReleaseAssert(this.uniqueUse()),this.m_quadTree=e}setQuadTreeForPaths(e){t.geometryReleaseAssert(this.uniqueUse()),this.m_quadTreeForPaths=e}getQuadTree(){return this.m_quadTree}getQuadTreeForPaths(){return this.m_quadTreeForPaths}}function le(e,t){return e.readPoint2D(t+4)}function ue(e){const s=e.getGeometryType();return s===t.GeometryType.enumEllipticArc?10:s===t.GeometryType.enumBezier?4:s===t.GeometryType.enumRationalBezier2?5:s===t.GeometryType.enumBezier2?2:void t.throwInternalErrorException("")}function ce(e){const t=31&e;return 4===t?10:2===t?4:8===t?5:16===t?2:0}function ge(e,t,s,i){const r=e.getPathStart(t),o=e.getPathEnd(t);if(o-r<3)return;const a=2*r,m=n.Point2D.getNAN();s.queryPoint2D(a,m);const h=m.x,l=m.y,u=n.Point2D.getNAN();s.queryPoint2D(a+2,u);const c=n.Point2D.getNAN();for(let e=a+4,t=2*o;e<t;e+=2)s.queryPoint2D(e,c),i.pe((c.x-m.x)*(u.y-l)),m.setCoordsPoint2D(u),u.setCoordsPoint2D(c);i.pe((h-m.x)*(u.y-l))}function de(e,t,s){for(;t.hasNextSegment();){const e=t.nextCurve();if(null===e)break;s.pe(2*e.calculateArea2DHelper())}}var pe=s.VertexDescription;class _e{static toSegType(e){let s=0;switch(e){case t.GeometryType.enumLine:s=1;break;case t.GeometryType.enumBezier:s=2;break;case t.GeometryType.enumEllipticArc:s=4;break;case t.GeometryType.enumRationalBezier2:s=8;break;case t.GeometryType.enumBezier2:s=16;break;default:t.throwInternalErrorException("")}return s}constructor(){this.m_segmentFlags=null,this.m_segmentParamIndex=null,this.m_segmentParams=null,this.m_curveCount=0,this.m_bezierCount=0,this.m_arcCount=0,this.m_rbezier2Count=0,this.m_bezier2Count=0,this.m_curveParamWritePoint=0}assignCopy(e){return this.m_segmentFlags=e.m_segmentFlags,this.m_segmentParamIndex=e.m_segmentParamIndex,this.m_segmentParams=e.m_segmentParams,this.m_curveCount=e.m_curveCount,this.m_bezierCount=e.m_bezierCount,this.m_arcCount=e.m_arcCount,this.m_rbezier2Count=e.m_rbezier2Count,this.m_bezier2Count=e.m_bezier2Count,this.m_curveParamWritePoint=e.m_curveParamWritePoint,this}}class fe extends c{constructor(e){super(e),this.m_cachedRingAreas2D=null,this.m_paths=null,this.m_pathFlags=null,this.m_curveData=null,e.move?(this.m_bPolygon=e.move.m_bPolygon,this.m_cachedLength2D=e.move.m_cachedLength2D,this.m_cachedArea2D=e.move.m_cachedArea2D,this.m_currentPathIndex=e.move.m_currentPathIndex,this.m_cachedRingAreas2D=e.move.m_cachedRingAreas2D,this.m_paths=e.move.m_paths,this.m_pathFlags=e.move.m_pathFlags,this.m_curveData=e.move.m_curveData,e.move.m_curveData=null,e.move.setEmpty()):(this.m_bPolygon=e.bPolygon,this.m_cachedLength2D=0,this.m_cachedArea2D=0,this.m_currentPathIndex=0)}getGeometryType(){return this.m_bPolygon?t.GeometryType.enumPolygon:t.GeometryType.enumPolyline}getDimension(){return this.m_bPolygon?2:1}changeRingStartPoint(e){t.geometryReleaseAssert(this.m_bPolygon);const s=this.getPathIndexFromPointIndex(e),n=this.getPathStart(s);if(n===e)return;const i=this.getPathEnd(s);(e>=i||e<n)&&t.throwInvalidArgumentException("change_ring_start_point");for(let t=0,s=this.m_description.getAttributeCount();t<s;t++){const s=this.m_description.getSemantics(t),r=pe.getComponentCount(s);this.m_vertexAttributes.get(t).rotate(n*r,e*r,i*r)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.rotate(n,e,i),this.m_curveData.m_segmentParamIndex.rotate(n,e,i))}setFillRule(e){this.m_bFillRule=1===e}getFillRule(){return this.m_bFillRule?1:0}isExteriorRingOGC(e){return!!this.m_bPolygon&&(this.updateOGCFlagsProtected(),!!(8&this.m_pathFlags.read(e)))}isExteriorRing(e){return this.calculateRingArea2D(e)>0}calculateRingArea2D(e){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedRingAreas2D.read(e)):0}updateRingAreas2DProtected(){if(!this.hasDirtyFlag(1024))return;const e=this.getPathCount();if(0===e)return this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=0),void this.setDirtyFlagProtected(1024,!1);const t=new s.AttributeStreamOfDbl(e),i=new n.KahanSummator(0),r=new n.KahanSummator(0);if(0!==this.m_pointCount){const s=this.getAttributeStreamRef(0);if(this.hasNonLinearSegments()){const e=new me({parent:this});for(e.stripAttributes();e.nextPath();){r.reset();const n=e.getPathIndex();ge(this,n,s,r),de(0,e,r);const o=.5*r.getResult();i.add(o),t.write(n,o)}}else for(let n=0;n<e;n++){r.reset(),ge(this,n,s,r);const e=.5*r.getResult();i.add(e),t.write(n,e)}}this.hasDirtyFlag(1024)&&(this.m_cachedArea2D=i.getResult(),this.m_cachedRingAreas2D=t,this.setDirtyFlagProtected(1024,!1))}getOGCPolygonCount(){if(!this.m_bPolygon)return 0;this.updateOGCFlagsProtected();let e=0;const t=this.getPathCount();for(let s=0;s<t;s++)8&this.m_pathFlags.read(s)&&e++;return e}getHashCodeImpl(){return t.geometryReleaseAssert(0),0}equalsImpl(e){const t=e,s=this.getPathCount();if(s!==t.getPathCount())return!1;const i=this.hasNonLinearSegments();if(i!==t.hasNonLinearSegments())return!1;if(i){if(this.m_curveData.m_curveCount!==t.m_curveData.m_curveCount)return!1;if(this.m_curveData.m_bezierCount!==t.m_curveData.m_bezierCount)return!1}if(this.m_paths&&!this.m_paths.equals(t.m_paths,0,s+1))return!1;if(this.m_bFillRule!==t.m_bFillRule)return!1;if(!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(t.m_pathFlags,0,s))return!1;if(this.hasNonLinearSegments()){if(!this.m_curveData.m_segmentFlags.equals(t.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;for(let e=0,s=this.getPointCount();e<s;e++){const s=this.m_curveData.m_segmentFlags.read(e);if(!fe.isNonLinearSegmentFlag(s))continue;const i=this.m_curveData.m_segmentParamIndex.read(e),r=t.m_curveData.m_segmentParamIndex.read(e),o=ce(s);for(let e=0;e<o;e++){const s=this.m_curveData.m_segmentParams.read(i+e),o=t.m_curveData.m_segmentParams.read(r+e);if(!n.isEqualNonIEEE(s,o))return!1}}}return!0}equalsImplTol(e,t){const s=e,n=this.getPathCount();if(n!==s.getPathCount())return!1;const i=this.hasNonLinearSegments();if(i!==s.hasNonLinearSegments())return!1;if(i){if(this.m_curveData.m_curveCount!==s.m_curveData.m_curveCount)return!1;if(this.m_curveData.m_bezierCount!==s.m_curveData.m_bezierCount)return!1}if(this.m_paths&&!this.m_paths.equals(s.m_paths,0,n+1))return!1;if(this.m_bFillRule!==s.m_bFillRule)return!1;if(!this.m_bPolygon&&this.m_pathFlags&&!this.m_pathFlags.equals(s.m_pathFlags,0,n))return!1;if(!i)return!0;if(!this.m_curveData.m_segmentFlags.equals(s.m_curveData.m_segmentFlags,0,this.getPointCount()))return!1;const r=this.querySegmentIterator(),o=s.querySegmentIterator();for(;r.nextPath();){if(!o.nextPath())return!1;for(;r.hasNextSegment();){const e=r.nextCurve(),s=o.nextCurve();if(!(e&&s&&e.equals(s,t))){if(!e&&!s)break;return!1}}}return!0}reserveImplImpl(e,t){this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(e,1),this.m_curveData.m_segmentParamIndex.resize(e,-1),this.checkCompactSegmentParams())}verifyStreamsAfterSizeChangeExtraImpl(){this.m_paths||(this.m_paths=s.createIndexStream(1,0),this.m_pathFlags=s.createByteStream(1,0)),this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.resize(this.m_reservedPointCount,1),this.m_curveData.m_segmentParamIndex.resize(this.m_reservedPointCount,-1),this.checkCompactSegmentParams())}copyToImpl(e,t){const s=e;s.m_bPathStarted=!1,s.m_bFillRule=this.m_bFillRule,this.m_paths?s.m_paths=t?this.m_paths:this.m_paths.clone():s.m_paths=null,this.m_pathFlags?s.m_pathFlags=t?this.m_pathFlags:this.m_pathFlags.clone():s.m_pathFlags=null,this.m_curveData&&(s.m_curveData||(s.m_curveData=new _e),s.m_curveData.assignCopy(this.m_curveData),s.m_curveData.m_curveCount=0,s.updateCurveCounter(this.m_curveData.m_curveCount),t||(this.m_curveData.m_segmentParamIndex?s.m_curveData.m_segmentParamIndex=this.m_curveData.m_segmentParamIndex.clone():s.m_curveData.m_segmentParamIndex=null,this.m_curveData.m_segmentFlags?s.m_curveData.m_segmentFlags=this.m_curveData.m_segmentFlags.clone():s.m_curveData.m_segmentFlags=null,this.m_curveData.m_segmentParams?s.m_curveData.m_segmentParams=this.m_curveData.m_segmentParams.clone():s.m_curveData.m_segmentParams=null)),s.hasDirtyFlag(512)||(s.m_cachedLength2D=this.m_cachedLength2D),s.m_cachedRingAreas2D=null,s.hasDirtyFlag(1024)||(s.m_cachedArea2D=this.m_cachedArea2D,null!==this.m_cachedRingAreas2D&&(s.m_cachedRingAreas2D=t?this.m_cachedRingAreas2D:this.m_cachedRingAreas2D.clone()))}calculateArea2D(){return this.m_bPolygon?(this.updateRingAreas2DProtected(),this.m_cachedArea2D):0}calculateLength2D(){if(!this.hasDirtyFlag(512))return this.m_cachedLength2D;const e=this.querySegmentIterator(),t=new n.KahanSummator(0);for(;e.nextPath();)for(;e.hasNextSegment();)t.add(e.nextSegment().calculateLength2D());return this.hasDirtyFlag(512)&&(this.m_cachedLength2D=t.getResult()),this.setDirtyFlagProtected(512,!1),t.getResult()}calculatePathLength2D(e){const t=this.querySegmentIteratorAtVertex(this.getPathStart(e)),s=new n.KahanSummator(0);for(;t.hasNextSegment();)s.add(t.nextSegment().calculateLength2D());return s.getResult()}calculateLength3D(e){return t.geometryReleaseAssert(0),0}calculatePathLength3D(e,s){return t.geometryReleaseAssert(0),0}copyTo(e){t.isMultiPath(e.getGeometryType())||t.throwInvalidArgumentException(""),this!==e&&super.copyTo(e)}swap(e){t.geometryReleaseAssert(0)}setPointByVal(e,t){this.setPointByValWithCurves(e,t)}setPointByValWithCurves(e,t){if(this.hasNonLinearSegments()){const s=t.getXY();if(this.setXYCoordsWithCurves(e,s.x,s.y),1===this.m_description.getAttributeCount())return}this.setPointByValNoCurves(e,t)}setXYCoordsWithCurves(e,t,s){if(this.hasNonLinearSegments()){const i=fe.getPathIndexFromPointIndexImpl(this.m_paths,this.getPathCount(),e,this.m_currentPathIndex);this.m_currentPathIndex=i;const r=this.getPrevSegmentTypeFromPath(i,e),o=this.getNextSegmentType(e);if(1!==r||1!==o){let a=e-1;const m=new Mr;1!==r&&(this.isClosedPath(i)&&e===this.getPathStart(i)&&(a=this.getPathEnd(i)-1),this.getSegmentBuffer(a,m,!0));const h=new Mr;1!==o&&this.getSegmentBuffer(e,h,!0);const l=e+1;this.setXYCoordsNoCurves(e,t,s);const u=new n.Point2D(t,s);return 1!==r&&(m.get().changeEndPoints2D(m.get().getStartXY(),u),this.replaceSegmentImpl(a,e,m.get(),!0)),void(1!==o&&(h.get().changeEndPoints2D(u,h.get().getEndXY()),this.replaceSegmentImpl(e,l,h.get(),!0)))}}this.setXYCoordsNoCurves(e,t,s)}setXYZWithCurves(e,t){this.hasNonLinearSegments()?(this.setXYCoordsWithCurves(e,t.x,t.y),this.setAttributeNoCurves(1,e,0,t.z)):this.setXYZNoCurves(e,t)}setAttributeWithCurves(e,t,s,n){if(0===e&&this.hasNonLinearSegments()){const e=this.getXY(t);0===s?e.x=n:e.y=n,this.setXYCoordsWithCurves(t,e.x,e.y)}else this.setAttributeNoCurves(e,t,s,n)}setXY(e,t){this.setXYCoordsWithCurves(e,t.x,t.y)}setXYCoords(e,t,s){this.setXYCoordsWithCurves(e,t,s)}setXYZ(e,t){this.setXYZWithCurves(e,t)}setAttribute(e,t,s,n){this.setAttributeWithCurves(e,t,s,n)}setAttributeWithCurvesFromArray(e,s,n,i){if(0===e&&this.hasNonLinearSegments()){i<2&&t.throwOutOfRangeException("");const e=this.getXY(s);e.x=n[0],e.y=n[1],this.setXYCoordsWithCurves(s,e.x,e.y)}else this.setAttributeFromArrayNoCurves(e,s,n,i)}setAttributeFromArray(e,t,s,n){this.setAttributeWithCurvesFromArray(e,t,s,n)}hasNonLinearSegments(){return 0!==this.getCurveCount()}getSegmentCount(){let e=this.getPointCount();if(!this.m_bPolygon){e-=this.getPathCount();for(let t=0,s=this.getPathCount();t<s;t++)this.isClosedPath(t)&&e++}return e}getSegmentCountPath(e){let t=this.getPathSize(e);return!this.isClosedPath(e)&&t>0&&t--,t}add(e,s){this===e&&t.throwInvalidArgumentException("Multi_path_impl::add");for(let t=0,n=e.getPathCount();t<n;t++)this.addPath(e,t,!s)}addPath(e,t,s){this.insertPath(-1,e,t,s)}addPathPoint2D(e,t,s){this.insertPath2D(-1,e,0,t,s)}addPathMultiPoint(e,t,s,n){s<0&&(s=e.getPointCount()-t),this.insertPointsFromMultipoint(-1,0,e,t,s,n)}addSegmentsFromPath(e,s,n,i,r){if(this===e&&t.throwInvalidArgumentException("Multi_path_impl.add_segments_from_path"),r||0!==this.getPathCount()||(r=!0),s<0&&(s=e.getPathCount()-1),(s>=e.getPathCount()||n<0||i<0||n+i>e.getSegmentCountPath(s))&&t.throwOutOfRangeException("add_segments_from_path"),0===i)return;const o=e.getPathStart(s),a=e.isClosedPath(s)&&n+i===e.getSegmentCountPath(s);this.m_bPathStarted=!1,this.mergeVertexDescription(e.getDescription());let m=i;const h=o+n;let l=h+1;r&&(m++,l--),!r&&e.hasNonLinearSegments()&&1!==e.m_curveData.m_segmentFlags.read(h)&&(e.getXY(h).equals(this.getXY(this.m_pointCount-1))||t.throwInvalidArgumentException("add_segments_from_path: start point mismatch"));const u=this.m_pointCount;if(this.resizeImpl(this.m_pointCount+m),this.verifyAllStreamsAfterSizeChange(),r){if(0===m)return;this.m_paths.add(this.m_pointCount);let t=e.m_pathFlags.read(s);this.m_bPolygon&&(t|=1),this.m_pathFlags.write(this.m_pathFlags.size()-1,t),this.m_pathFlags.add(0)}else this.m_paths.write(this.m_pathFlags.size()-1,this.m_pointCount);const c=a?m-1:m;for(let t=0,s=this.m_description.getAttributeCount();t<s;t++){const s=this.m_description.getSemantics(t),n=pe.getComponentCount(s),i=e.m_description.getAttributeIndex(s);if(c>0){if(i<0||!e.m_vertexAttributes.get(i)){const e=pe.getDefaultValue(s);this.m_vertexAttributes.get(t).insertRange(n*u,e,c*n,n*u),a&&this.m_vertexAttributes.get(t).insertRange(n*u+c*n,e,n,n*u);continue}this.m_vertexAttributes.get(t).insertRangeFromStream(n*u,e.m_vertexAttributes.get(i),n*l,c*n,!0,n,n*u)}a&&this.m_vertexAttributes.get(t).insertRangeFromStream(n*(u+c),e.m_vertexAttributes.get(i),n*o,n,!0,n,n*(u+c))}if(this.hasNonLinearSegments()&&this.initSegmentData(0),e.hasNonLinearSegments()){let t=0;for(let s=0,n=h;s<i;s++)t+=ce(e.m_curveData.m_segmentFlags.read(n)),n++;if(t>0){this.initSegmentData(t);let s=h,n=u-(r?0:1),o=0;for(let t=0;t<i;t++){const t=e.m_curveData.m_segmentFlags.read(s);if(this.m_curveData.m_segmentFlags.write(n,t),fe.isNonLinearSegmentFlag(t)){o++;let i=e.m_curveData.m_segmentParamIndex.read(s);const r=ce(t);this.m_curveData.m_segmentParamIndex.write(n,this.m_curveData.m_curveParamWritePoint);for(let t=0;t<r;t++){const t=e.m_curveData.m_segmentParams.read(i);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,t),this.m_curveData.m_curveParamWritePoint++,i++}this.incCurveType(t,1)}else this.m_curveData.m_segmentParamIndex.write(n,-1);n++,s++}this.modifyCurveCounter(o)}}if(a){const e=this.getPathCount()-1,t=this.getPathStart(e),s=this.getPathEnd(e)-1,n=this.getXY(t),i=this.getXY(s);n.isEqualPoint2D(i)&&(--this.m_pointCount,this.m_paths.write(e+1,this.m_pointCount))}this.notifyModifiedFlags(2001)}reverseAllPaths(){for(let e=0,t=this.getPathCount();e<t;e++)this.reversePath(e)}reversePath(e){e>=this.getPathCount()&&t.throwInvalidArgumentException("");const s=this.getPathSize(e);if(0===s)return;const n=this.getPathStart(e),i=this.isClosedPath(e);if(this.hasNonLinearSegments()){let e=n;const t=new this.m_segmentBufferCTor;let r=!1;for(let n=0;n<s;n++,e++){const s=this.m_curveData.m_segmentFlags.read(e);if(!fe.isNonLinearSegmentFlag(s))continue;r=!0,this.querySegment(e,t,!0),t.get().reverse();const n=this.m_curveData.m_segmentParamIndex.read(e);t.get().writeInBufferStream(this.m_curveData.m_segmentParams,n)}if(r){const e=i?0:1;this.m_curveData.m_segmentFlags.reverseRange(n,s-e,1),this.m_curveData.m_segmentParamIndex.reverseRange(n,s-e,1)}}const r=i?1:0;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){const t=this.m_description.getSemantics(e),i=pe.getComponentCount(t);this.m_vertexAttributes.get(e).reverseRange(i*(n+r),i*(s-r),i)}const o=6&this.m_pathFlags.read(e);if(o){let t=0;4&o&&(t|=2),2&o&&(t|=4),this.m_pathFlags.clearBits(e,6),this.m_pathFlags.setBits(e,t)}this.notifyModifiedFlags(1233)}removePath(e){const s=this.getPathCount();e<0&&(e=s-1),e>=s&&t.throwInvalidArgumentException("");const n=this.getPathStart(e),i=this.getPathSize(e);for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){const t=this.m_description.getSemantics(e),s=pe.getComponentCount(t);this.m_vertexAttributes.get(e).eraseRange(s*n,s*i,s*this.m_pointCount)}if(this.hasNonLinearSegments()){let e=0;for(let t=n,s=n+i;t<s;t++){const s=this.m_curveData.m_segmentFlags.read(t);fe.isNonLinearSegmentFlag(s)&&(this.incCurveType(s,-1),e++)}this.modifyCurveCounter(-e),this.m_curveData.m_segmentFlags.eraseRange(n,i,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(n,i,this.m_pointCount)}for(let t=e+1;t<=s;t++){const e=this.m_paths.read(t);this.m_paths.write(t-1,e-i)}if(this.m_pathFlags)for(let t=e+1;t<=s;t++){const e=this.m_pathFlags.read(t);this.m_pathFlags.write(t-1,e)}this.m_paths.resize(s),this.m_pathFlags.resize(s),this.m_pointCount-=i,this.m_reservedPointCount-=i,e===s-1&&(this.m_bPathStarted=!1),this.notifyModifiedFlags(2001),this.checkCompactSegmentParams(),this.dbgVerifyCurves()}dbgVerifyCurves(){}insertPath(e,n,i,r){this===n&&t.throwInvalidArgumentException("Multi_path_impl::insert_path");const o=this.getPathCount();if(!r&&n.hasNonLinearSegmentsPath(i))return e=this.insertPath(e,n,i,!0),this.reversePath(e),e;i>=n.getPathCount()&&t.throwInvalidArgumentException(""),e>o&&t.throwInvalidArgumentException(""),e<0&&(e=o),i<0&&(i=n.getPathCount()-1),this.m_bPathStarted=!1,this.mergeVertexDescription(n.getDescription());const a=n.getPathStart(i),m=n.getPathSize(i);if(0===m)return this.insertPath2D(e,null,0,0,!0);const h=this.m_pointCount,l=n.isClosedPath(i)&&!r?1:0;this.resizeImpl(this.m_pointCount+m),this.verifyAllStreamsAfterSizeChange();const u=e<o?this.getPathStart(e):h;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),s=n.getDescription().getAttributeIndex(t),i=pe.getComponentCount(t);if(s>=0&&n.m_vertexAttributes.get(s))0!==l&&this.m_vertexAttributes.get(e).insertRangeFromStream(u*i,n.m_vertexAttributes.get(s),i*a,i,!0,i,i*h),this.m_vertexAttributes.get(e).insertRangeFromStream((u+l)*i,n.m_vertexAttributes.get(s),i*(a+l),i*(m-l),r,i,i*(h+l));else{const s=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(u*i,s,i*m,i*h)}}const c=h+m;this.m_paths.add(c);for(let t=o;t>=e+1;t--){const e=this.m_paths.read(t-1);this.m_paths.write(t,e+m)}this.m_pathFlags.add(0);for(let t=o-1;t>=e+1;t--){let e=this.m_pathFlags.read(t);e&=-9,this.m_pathFlags.write(t+1,e)}let g=n.getPathFlagsStreamRef().read(i);if(g&=-9,this.m_bPolygon&&(g|=1),this.m_pathFlags.write(e,g),n.hasNonLinearSegments()){this.initSegmentData(0);let e=a,t=0;for(let s=0;s<m;s++)t+=ce(n.m_curveData.m_segmentFlags.read(e)),e++;if(t>0){null===this.m_curveData.m_segmentFlags?(this.m_curveData.m_segmentFlags=s.createByteStream(this.m_pointCount,1),this.m_curveData.m_segmentParamIndex=s.createIndexStream(this.m_pointCount,-1)):(this.m_curveData.m_segmentFlags.insertRange(u,1,m,h),this.m_curveData.m_segmentParamIndex.insertRange(u,-1,m,h)),this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams.resize(this.m_curveData.m_curveParamWritePoint+t):this.m_curveData.m_segmentParams=s.createDoubleStream(t),e=a;let i=u,r=0;for(let t=0;t<m;t++){const t=n.m_curveData.m_segmentFlags.read(e);if(fe.isNonLinearSegmentFlag(t)){this.m_curveData.m_segmentFlags.write(i,t),this.m_curveData.m_segmentParamIndex.write(i,this.m_curveData.m_curveParamWritePoint);const s=ce(t);let o=n.m_curveData.m_segmentParamIndex.read(e);for(let e=0;e<s;e++){const e=n.m_curveData.m_segmentParams.read(o);this.m_curveData.m_segmentParams.write(this.m_curveData.m_curveParamWritePoint,e),this.m_curveData.m_curveParamWritePoint++,o++}r++,this.incCurveType(t,1)}e++,i++}this.modifyCurveCounter(r)}}return this.notifyModifiedFlags(2001),e}insertPath2D(e,s,n,i,r){const o=this.getPathCount();(e>o||n<0)&&t.throwInvalidArgumentException(""),e<0&&(e=o),this.m_bPathStarted=!1;const a=this.m_pointCount;this.resizeImpl(this.m_pointCount+i),0===i&&this.notifyModifiedFlags(32),this.verifyAllStreamsAfterSizeChange();const m=e<o?this.getPathStart(e):a;if(s)this.m_vertexAttributes.get(0).insertRangeFromPoints(2*m,s,n,i,r,2*a);else{const e=pe.getDefaultValue(0);this.m_vertexAttributes.get(0).insertRange(2*m,e,2*i,2*a)}for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),s=pe.getComponentCount(t),n=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(m*s,n,s*i,s*a)}this.m_paths.add(this.m_pointCount);for(let t=o;t>=e+1;t--){const e=this.m_paths.read(t-1);this.m_paths.write(t,e+i)}this.m_pathFlags.add(0);for(let t=o-1;t>=e+1;t--){let e=this.m_pathFlags.read(t);e&=-9,this.m_pathFlags.write(t+1,e)}return this.m_bPolygon&&this.m_pathFlags.write(e,1),this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(m,1,i,a),this.m_curveData.m_segmentParamIndex.insertRange(m,-1,i,a)),this.notifyModifiedFlags(2001),e}insertPathFromMultipoint(e,s,n,i,r){const o=s.getImpl(),a=this.getPathCount();(e>a||n<0)&&t.throwInvalidArgumentException("");const m=i<0?o.getPointCount()-n:i;if(m>o.getPointCount()&&t.throwInvalidArgumentException(""),n>=o.getPointCount()&&t.throwInvalidArgumentException("pointsOffset"),e<0&&(e=a),this.m_bPathStarted=!1,this.mergeVertexDescription(o.getDescription()),0===m)return void this.insertPath2D(e,null,0,0,!0);const h=this.m_pointCount,l=n;this.resizeImpl(this.m_pointCount+m),this.verifyAllStreamsAfterSizeChange();const u=e<a?this.getPathStart(e):h;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),s=o.getDescription().getAttributeIndex(t),n=pe.getComponentCount(t);if(s>=0){const s=o.getAttributeStreamRef(t);this.m_vertexAttributes.get(e).insertRangeFromStream(u*n,s,n*l,n*m,r,n,n*h)}else{const s=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(u*n,s,n*m,n*h)}}const c=h+m;this.m_paths.add(c);for(let t=a;t>=e+1;t--){const e=this.m_paths.read(t-1);this.m_paths.write(t,e+m)}this.m_pathFlags.add(0);for(let t=a-1;t>=e+1;t--){let e=this.m_pathFlags.read(t);e&=-9,this.m_pathFlags.write(t+1,e)}let g=0;this.m_bPolygon&&(g|=1),this.m_pathFlags.write(e,g),this.notifyModifiedFlags(2001)}insertPoints(e,s,n,i,r,o,a){if(this===n&&t.throwInvalidArgumentException("Multi_path_impl.insert_points"),e<0&&(e=this.getPathCount()),i<0&&(i=n.getPathCount()-1),(e>this.getPathCount()||s>=0&&s>this.getPathSize(e)||i>=n.getPathCount()||o>n.getPathSize(i))&&t.throwOutOfRangeException(""),!o)return;if(this.mergeVertexDescription(n.m_description),e===this.getPathCount()){this.m_paths.add(this.m_pointCount);let e=n.m_pathFlags.read(i);e&=-9,this.m_bPolygon?this.m_pathFlags.add(1|e):this.m_pathFlags.add(e)}s<0&&(s=this.getPathSize(e));const m=this.m_pointCount;this.resizeImpl(this.m_pointCount+o),this.verifyAllStreamsAfterSizeChange();const h=this.getPathStart(e),l=h+s;o<0&&(o=n.getPathSize(i));const u=n.getPathStart(i),c=u+o;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),i=pe.getComponentCount(t),g=n.m_description.getAttributeIndex(t);if(g<0||!n.m_vertexAttributes.get(g)){const s=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(i*l,s,c*i,i*m);continue}this.m_vertexAttributes.get(e)?.insertRangeFromStream(i*(h+s),n.m_vertexAttributes.get(g),i*(u+r),o*i,a,i,i*m)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(h+s,1,o,m),this.m_curveData.m_segmentParamIndex.insertRange(h+s,-1,o,m),s>0&&this.isNonLinearSegment(h+s-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(h+s-1),-1),this.m_curveData.m_segmentFlags.write(h+s-1,1),this.m_curveData.m_segmentParamIndex.write(h+s-1,-1),this.modifyCurveCounter(-1)));for(let t=e+1,s=this.getPathCount();t<=s;t++){const e=this.m_paths.read(t);this.m_paths.write(t,e+o)}this.notifyModifiedFlags(2001)}insertPointsFromPoints(e,s,n,i,r,o){if(e<0&&(e=this.getPathCount()),(e>this.getPathCount()||s>this.getPathSize(e)||i<0)&&t.throwOutOfRangeException(""),!r)return;e===this.getPathCount()&&(this.m_paths.add(this.m_pointCount),this.m_bPolygon?this.m_pathFlags.add(1):this.m_pathFlags.add(0)),s<0&&(s=this.getPathSize(e));const a=this.m_pointCount;this.resizeImpl(this.m_pointCount+r),this.verifyAllStreamsAfterSizeChange();const m=this.getPathStart(e);this.m_vertexAttributes.get(0).insertRangeFromPoints(2*(m+s),n,i,r,o,2*a);for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),n=pe.getComponentCount(t),i=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange((m+s)*n,i,n*r,n*a)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(m+s,1,r,a),this.m_curveData.m_segmentParamIndex.insertRange(m+s,-1,r,a),s>0&&this.isNonLinearSegment(m+s-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(m+s-1),-1),this.m_curveData.m_segmentFlags.write(m+s-1,1),this.m_curveData.m_segmentParamIndex.write(m+s-1,-1),this.modifyCurveCounter(-1)));for(let t=e+1,s=this.getPathCount();t<=s;t++)this.m_paths.write(t,this.m_paths.read(t)+r);this.notifyModifiedFlags(2001)}insertPointsFromMultipoint(e,s,n,i,r,o){const a=n.getImpl(),m=this.getPathCount();e<0&&(e=this.getPathCount());const h=a.getPointCount();if((i<0||i>h)&&t.throwOutOfRangeException(""),(r<0||i+r>h)&&(r=h-i),s<0&&(s=e<m?this.getPathSize(e):0),(e>m||e<m&&s>this.getPathSize(e)||e===m&&s>0||r<0)&&t.throwOutOfRangeException(""),!r)return;if(this.mergeVertexDescription(a.getDescription()),e===m){this.m_paths.add(this.m_pointCount);const e=0;this.m_bPolygon?this.m_pathFlags.add(1|e):this.m_pathFlags.add(e)}s<0&&(s=this.getPathSize(e));const l=this.m_pointCount;this.resizeImpl(this.m_pointCount+r),this.verifyAllStreamsAfterSizeChange();const u=this.getPathStart(e),c=u+s,g=0+r;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),n=pe.getComponentCount(t);if(a.getDescription().getAttributeIndex(t)<0){const s=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(n*c,s,g*n,n*l);continue}const m=a.getAttributeStreamRef(t);this.m_vertexAttributes.get(e).insertRangeFromStream(n*(u+s),m,n*(0+i),r*n,o,n,n*l)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(u+s,1,r,l),this.m_curveData.m_segmentParamIndex.insertRange(u+s,-1,r,l),s>0&&this.isNonLinearSegment(u+s-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(u+s-1),-1),this.m_curveData.m_segmentFlags.write(u+s-1,1),this.m_curveData.m_segmentParamIndex.write(u+s-1,-1),this.modifyCurveCounter(-1)));for(let t=e+1,s=this.getPathCount();t<=s;t++){const e=this.m_paths.read(t);this.m_paths.write(t,e+r)}this.notifyModifiedFlags(2001)}insertPoint2D(e,s,n){const i=this.getPathCount();e<0&&(e=i),(e>i||e<i&&s>this.getPathSize(e))&&t.throwOutOfRangeException(""),e===i&&this.addPathPoint2D(null,0,!0);const r=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();const o=this.getPathStart(e),a=s<0?this.getPathSize(e)+o:s+o,m=this.m_vertexAttributes.get(0);if(a===r)this.m_paths.write(e+1,r+1),m.writePoint2D(2*a,n);else{m.insert(2*a,n,2*r);for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),s=pe.getComponentCount(t),n=pe.getDefaultValue(t);this.m_vertexAttributes.get(e).insertRange(s*a,n,s,s*r)}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(a,1,1,r),this.m_curveData.m_segmentParamIndex.insertRange(a,-1,1,r));for(let t=e+1,s=i;t<=s;t++)this.m_paths.write(t,this.m_paths.read(t)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&a>o&&this.isNonLinearSegment(a-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(a-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(a-1,1),this.m_curveData.m_segmentParamIndex.write(a-1,-1)),this.notifyModifiedFlags(2001)}insertPoint(e,s,n){const i=this.getPathCount();e<0&&(e=i),(e>i||e<i&&s>this.getPathSize(e))&&t.throwOutOfRangeException(""),e===i&&this.addPathPoint2D(null,0,!0);const r=this.m_pointCount;this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();const o=this.getPathStart(e),a=s<0?this.getPathSize(e)+o:s+o;if(a===r)this.m_paths.write(e+1,r+1),this.setPointByValNoCurves(a,n);else{const t=n.getDescription();this.m_description!==t&&this.mergeVertexDescription(t);for(let e=0,s=this.m_description.getAttributeCount();e<s;e++){const s=this.m_description.getSemantics(e),i=pe.getComponentCount(s);if(t.hasAttribute(s))this.m_vertexAttributes.get(e).insertAttributes(i*a,n,s,i*r);else{const t=pe.getDefaultValue(s);this.m_vertexAttributes.get(e).insertRange(i*a,t,i,i*r)}}this.m_curveData&&this.m_curveData.m_segmentFlags&&(this.m_curveData.m_segmentFlags.insertRange(a,1,1,r),this.m_curveData.m_segmentParamIndex.insertRange(a,-1,1,r));for(let t=e+1,s=i;t<=s;t++)this.m_paths.write(t,this.m_paths.read(t)+1)}this.m_curveData&&this.m_curveData.m_segmentFlags&&a>o&&this.isNonLinearSegment(a-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(a-1),-1),this.modifyCurveCounter(-1),this.m_curveData.m_segmentFlags.write(a-1,1),this.m_curveData.m_segmentParamIndex.write(a-1,-1)),this.notifyModifiedFlags(2001)}removePointFromPath(e,s){const n=this.getPathCount();e<0&&(e=n-1),(e>=n||s>=this.getPathSize(e))&&t.throwOutOfRangeException("Multi_path.remove_point");const i=this.getPathStart(e),r=this.isClosedPath(e);s<0&&(s=this.getPathSize(e)-1),s<0&&t.throwOutOfRangeException("Multi_path.remove_point");const o=i+s;for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){const t=this.m_description.getSemantics(e),s=pe.getComponentCount(t);this.m_vertexAttributes.get(e).eraseRange(s*o,s,s*this.m_pointCount)}if(this.m_curveData&&this.m_curveData.m_segmentFlags){this.checkCompactSegmentParams();let t=0;if(o>i&&this.isNonLinearSegment(o-1))t+=1,this.incCurveType(this.m_curveData.m_segmentFlags.read(o-1),-1),this.m_curveData.m_segmentFlags.write(o-1,1),this.m_curveData.m_segmentParamIndex.write(o-1,-1);else{const s=this.getPathEnd(e);r&&i+1<s&&this.isNonLinearSegment(s-1)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(s-1),-1),this.m_curveData.m_segmentFlags.write(s-1,1),this.m_curveData.m_segmentParamIndex.write(s-1,-1),t+=1)}this.isNonLinearSegment(o)&&(this.incCurveType(this.m_curveData.m_segmentFlags.read(o),-1),t+=1),t>0&&this.modifyCurveCounter(-t),this.m_curveData.m_segmentFlags.eraseRange(o,1,this.m_pointCount),this.m_curveData.m_segmentParamIndex.eraseRange(o,1,this.m_pointCount)}for(let t=n;t>=e+1;t--){const e=this.m_paths.read(t);this.m_paths.write(t,e-1)}this.m_pointCount--,this.m_reservedPointCount--,this.notifyModifiedFlags(2001)}removePoint(e){let t;t=e<0?this.getPathCount()-1:this.getPathIndexFromPointIndex(e),this.removePointFromPath(t,e-this.getPathStart(t))}getNextSegmentType(e){return this.hasNonLinearSegments()?this.m_curveData.m_segmentFlags.read(e):1}getPrevSegmentTypeFromPath(e,s){if(!this.hasNonLinearSegments())return 1;const n=this.getPathStart(e);if(s>n)return this.m_curveData.m_segmentFlags.read(s-1);if(s===n){if(this.isClosedPath(e)){const t=this.getPathEnd(e);return this.m_curveData.m_segmentFlags.read(t-1)}return 1}t.throwInternalErrorException("")}getNumberOfCurves(e){if(!this.hasNonLinearSegments())return 0;let t=0;for(let s=this.getPathStart(e),n=this.getPathEnd(e);s<n;s++)fe.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(s))&&++t;return t}getPathCount(){return this.m_paths?this.m_paths.size()-1:0}getPathSize(e){return this.m_paths.read(e+1)-this.m_paths.read(e)}getPathStart(e){return this.m_paths.read(e)}getPathEnd(e){return this.m_paths.read(e+1)}getPathIndexFromPointIndex(e,t=-1){-1===t&&(t=this.m_currentPathIndex);const s=this.getPathCount(),n=fe.getPathIndexFromPointIndexImpl(this.m_paths,s,e,t);return this.m_currentPathIndex=n,n}startPathCoords(e,t){this.startPathPoint(new s.Point({x:e,y:t}))}startPath(e){this.startPathPoint(new s.Point({pt:e}))}startPath3D(e){this.startPathPoint(new s.Point({x:e.x,y:e.y,z:e.z}))}startPath3DCoords(e,t,n){this.startPathPoint(new s.Point({x:e,y:t,z:n}))}startPathPoint(e){e.isEmpty()&&t.throwInvalidArgumentException("");const n=e.getDescription();let i;if(this.m_description!==n){this.mergeVertexDescription(n);const t=new s.Point({vd:this.m_description});e.copyCommonAttributesTo(t),i=t}else i=e;this.m_bPathStarted?this.setPointByValNoCurves(this.m_pointCount-1,i):(this.insertPoint(-1,-1,i),this.m_bPathStarted=!0)}beforeNewSegmentHelper2(){this.m_paths=s.createIndexStream(2),this.m_paths.write(0,0),this.m_pathFlags=s.createByteStream(2,0),this.m_bPolygon&&this.m_pathFlags.write(0,1)}beforeNewSegmentHelper1(){null!==this.m_paths?(this.m_paths.add(0),this.m_pathFlags.add(0),this.m_bPolygon&&this.m_pathFlags.write(this.m_pathFlags.size()-2,1)):this.beforeNewSegmentHelper2()}beforeNewSegment(e){0!==this.m_pointCount||this.m_bPathStarted||this.startPathCoords(0,0);const t=this.m_pointCount,s=this.m_paths.size()-1,n=t+e;this.m_paths.write(s,n),this.resizeImpl(n),this.m_bPathStarted&&(this.m_bPathStarted=!1)}finishLineTo(){if(this.hasNonLinearSegments()){const e=this.m_curveData.m_segmentFlags.read(this.m_pointCount-1);1!==e&&(this.m_curveData.m_segmentFlags.write(this.m_pointCount-1,1),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-1,-1),this.modifyCurveCounter(-1),this.incCurveType(e,-1))}}lineToCoords(e,t){if(this.beforeNewSegment(1),1===this.m_description.getAttributeCount())this.setXYCoordsNoCurves(this.m_pointCount-1,e,t);else{const n=s.newOrdinateBuffer(),i=new s.Point({vd:this.m_description,attribBuffer:n,initDefaultValues:!0});i.setXYCoords(e,t),this.setPointByValNoCurves(this.m_pointCount-1,i)}this.finishLineTo()}lineTo(e){this.lineToCoords(e.x,e.y)}lineTo3D(e){this.beforeNewSegment(1);const t=s.getMergedVertexDescription(this.m_description,s.getDefaultDescription3D()),n=s.newOrdinateBuffer(),i=new s.Point({vd:t,attribBuffer:n,initDefaultValues:!0});i.setXYZ(e),this.setPointByValNoCurves(this.m_pointCount-1,i),this.finishLineTo()}lineTo3DCoords(e,t,n){this.lineTo3D(new s.Point3D(e,t,n))}lineToPoint(e){if(this.beforeNewSegment(1),this.m_description===e.getDescription())this.setPointByValNoCurves(this.m_pointCount-1,e);else{this.mergeVertexDescription(e.getDescription());const t=s.newOrdinateBuffer(),n=new s.Point({vd:this.m_description,attribBuffer:t,initDefaultValues:!1});e.copyCommonAttributesTo(n),this.setPointByValNoCurves(this.m_pointCount-1,n)}this.finishLineTo()}openPathAndDuplicateStartVertex(e){this.m_bPolygon&&t.throwInternalErrorException("");const s=this.getPathCount();if(e>s&&t.throwInvalidArgumentException(""),!this.isClosedPath(e))return;this.m_pathFlags||t.throwInternalErrorException("");const n=this.m_pointCount,i=this.getPathStart(e),r=this.getPathEnd(e);if(r-i!==0){this.resizeImpl(this.m_pointCount+1),this.verifyAllStreamsAfterSizeChange();for(let e=0,t=this.m_description.getAttributeCount();e<t;e++)if(this.m_vertexAttributes.get(e)){const t=this.m_description.getSemantics(e),s=pe.getComponentCount(t);this.m_vertexAttributes.get(e).insertRangeFromStream(s*r,this.m_vertexAttributes.get(e),s*i,s,!0,1,s*n)}for(let t=s;t>e;t--){const e=this.m_paths.read(t);this.m_paths.write(t,e+1)}this.hasNonLinearSegments()&&(this.m_curveData.m_segmentFlags.insertRange(r,1,1,n),this.m_curveData.m_segmentParamIndex.insertRange(r,-1,1,n)),this.m_pathFlags.clearBits(e,1)}}openPath(e){this.m_bPolygon&&t.throwInternalErrorException(""),e>this.getPathCount()&&t.throwInvalidArgumentException(""),this.m_pathFlags||t.throwInternalErrorException(""),this.m_pathFlags.clearBits(e,1)}isStrongPathStart(e){return!!(2&this.m_pathFlags.read(e))}setStrongPathStart(e,t){t?this.m_pathFlags.setBits(e,2):this.m_pathFlags.clearBits(e,2)}isStrongPathEnd(e){return!!(4&this.m_pathFlags.read(e))}setStrongPathEnd(e,t){t?this.m_pathFlags.setBits(e,4):this.m_pathFlags.clearBits(e,4)}clearStrongPathEnds(){for(let e=0,t=this.getPathCount();e<t;++e)this.m_pathFlags.clearBits(e,6)}openAllPathsAndDuplicateStartVertex(){if(this.m_bPolygon&&t.throwInternalErrorException(""),this.isEmpty())return;this.m_pathFlags||t.throwInternalErrorException("");let e=0;const n=this.getPathCount();for(let t=0;t<n;t++)this.isClosedPath(t)&&(this.getPathSize(t)>0?e++:this.m_pathFlags.clearBits(t,1));if(0===e)return;const i=this.hasNonLinearSegments();let r=0;const o=this.getPathCount(),a=this.m_description.getAttributeCount(),m=new Array(a);let h=null,l=null;for(let t=0;t<o;++t){const n=this.getPathStart(t),o=this.getPathSize(t),u=this.isClosedPath(t);if(o>0){const t=n+r;for(let i=0;i<a;i++)if(this.m_vertexAttributes.get(i)){const r=this.m_description.getSemantics(i),a=pe.getComponentCount(r);if(!m[i]){const t=a*(this.m_pointCount+e),n=s.createAttributeStreamUninitialized(r,t);m[i]=n}m[i].writeRange(t*a,o*a,this.m_vertexAttributes.get(i),n*a,!0,1),u&&m[i].writeRange((t+o)*a,a,this.m_vertexAttributes.get(i),n*a,!0,1)}if(i){if(null===h){const t=this.m_pointCount+e;h=s.createByteStream(t),l=s.createIndexStream(t)}h.writeRange(t,o,this.m_curveData.m_segmentFlags,n,!0,1),l.writeRange(t,o,this.m_curveData.m_segmentParamIndex,n,!0,1),u&&(h.write(t+o,1),l.write(t+o,-1))}}this.m_paths.write(t,n+r),u&&(this.m_pathFlags.clearBits(t,1),++r)}this.m_paths.write(o,this.m_pointCount+e),this.m_pathFlags.clearBits(o,1);for(let e=0;e<a;e++)this.m_vertexAttributes.get(e)&&this.m_vertexAttributes.set(e,m[e]);i&&(this.m_curveData.m_segmentFlags=h,this.m_curveData.m_segmentParamIndex=l),this.m_pointCount+=e,this.m_reservedPointCount>0&&(this.m_reservedPointCount=this.m_pointCount)}closePathWithLine(e){void 0===e&&(e=this.getPathCount()-1),this.throwIfEmpty(),(e<0||e>=this.getPathCount())&&t.throwInvalidArgumentException("close_path_with_line"),e===this.getPathCount()-1&&(this.m_bPathStarted=!1);const s=this.m_pathFlags.read(e);if(1&s||this.m_pathFlags.write(e,1|s),this.m_curveData&&this.m_curveData.m_segmentFlags){const t=this.getPathEnd(e)-1,s=this.m_curveData.m_segmentFlags.read(t);1!==s&&(this.m_curveData.m_segmentFlags.write(t,1),this.m_curveData.m_segmentParamIndex.write(t,-1),this.incCurveType(s,-1),this.modifyCurveCounter(-1))}this.notifyModifiedFlags(2001)}closeLastPathWithSegment(e){this.closePathWithSegment(this.getPathCount()-1,e)}closePathWithSegment(e,s){if(this.throwIfEmpty(),(e<0||e>=this.getPathCount())&&t.throwInvalidArgumentException("close_path_with_line"),s.getEndXY().equals(this.getXY(this.getPathStart(e)))||t.throwInvalidArgumentException("close_path_with_segment: end point mismatch"),e===this.getPathCount()-1)this.m_bPathStarted=!1,this.addSegment(s,!1),--this.m_pointCount,this.m_paths.write(e+1,this.m_pointCount);else{this.mergeVertexDescription(s.getDescription());const n=s.getStartXY(),i=this.getPathEnd(e)-1;n.equals(this.getXY(i))||t.throwInvalidArgumentException("close_path_with_segment: start point mismatch");const r=s.getGeometryType();if(r===t.GeometryType.enumLine)return void this.closePathWithLine(e);{const e=ue(s);this.initSegmentData(e);const t=_e.toSegType(r),n=this.m_curveData.m_segmentFlags.read(i);if(n!==t)this.m_curveData.m_segmentParamIndex.write(i,this.m_curveData.m_curveParamWritePoint),s.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=e,this.incCurveType(t,1),1!==n?this.incCurveType(n,-1):this.modifyCurveCounter(1);else{const e=this.m_curveData.m_segmentParamIndex.read(i);s.writeInBufferStream(this.m_curveData.m_segmentParams,e)}this.m_curveData.m_segmentFlags.write(i,t)}}const n=this.m_pathFlags.read(e);1&n||this.m_pathFlags.write(e,1|n),this.notifyModifiedFlags(2001)}closeAllPaths(){if(this.m_bPolygon||this.isEmptyImpl())return;this.m_bPathStarted=!1;let e=!1;for(let t=0,s=this.m_paths.size()-1;t<s;t++){if(this.isClosedPath(t))continue;const s=this.m_pathFlags.read(t);this.m_pathFlags.write(t,1|s),e=!0}e&&this.notifyModifiedFlags(512)}isClosedPath(e){return!!(1&this.m_pathFlags.read(e))}isClosedPathInXYPlane(e){if(this.isClosedPath(e))return!0;const t=this.getPathStart(e),s=this.getPathEnd(e)-1;if(t>s)return!1;const n=this.getXY(t),i=this.getXY(s);return n.isEqualPoint2D(i)}isClosedPathIn3D(e){return t.geometryReleaseAssert(0),!1}hasNonLinearSegmentsPath(e){if(!this.hasNonLinearSegments())return!1;for(let t=this.getPathStart(e),s=this.getPathEnd(e);t<s;t++)if(fe.isNonLinearSegmentFlag(this.m_curveData.m_segmentFlags.read(t)))return!0;return!1}isNonLinearSegment(e){return!(1&this.getSegmentFlags(e))}addEnvelope(e,t){if(e.isEmpty())return;const n=0===this.m_pointCount;if(e instanceof i.Envelope2D)this.startPathCoords(e.xmin,e.ymin),t?(this.lineToCoords(e.xmax,e.ymin),this.lineToCoords(e.xmax,e.ymax),this.lineToCoords(e.xmin,e.ymax)):(this.lineToCoords(e.xmin,e.ymax),this.lineToCoords(e.xmax,e.ymax),this.lineToCoords(e.xmax,e.ymin));else{const n=e.getDescription(),i=s.newOrdinateBuffer(),r=new s.Point({vd:n,attribBuffer:i,initDefaultValues:!1});for(let s=0,n=4;s<n;s++){const i=t?n-s-1:s;e.queryCornerByVal(i,r),0===s?this.startPathPoint(r):this.lineToPoint(r)}}this.closePathWithLine(),this.m_bPathStarted=!1,n&&!t&&(this.setDirtyFlagProtected(256,!1),this.m_bPolygon&&Math.min(e.width(),e.height())>0&&this.setIsSimple(3,0))}addPathFromClosedSegment(e,n){if(e.isClosed()||t.throwInvalidArgumentException("add_path_from_closedSegment: segment must be closed"),n){const t=e.getReversed(),n=new s.Point;t.queryStart(n),this.startPathPoint(n),this.closeLastPathWithSegment(t)}else{const t=new s.Point;e.queryStart(t),this.startPathPoint(t),this.closeLastPathWithSegment(e)}}addSegment_(e,n){const i=e.getDescription();this.mergeVertexDescription(i);const r=s.newOrdinateBuffer(),o=new s.Point({vd:i,attribBuffer:r,initDefaultValues:!1}),a=e.getGeometryType();if(a===t.GeometryType.enumLine)(n||this.isEmptyImpl())&&(e.queryStart(o),this.startPathPoint(o)),e.queryEnd(o),this.lineToPoint(o);else{let i=!1;if((n||this.isEmptyImpl())&&(i=!0),i||e.getStartXY().equals(this.getXY(this.m_pointCount-1))||t.throwInvalidArgumentException("add_segment: start point mismatch"),i&&(e.queryStart(o),this.startPathPoint(o)),this.beforeNewSegment(1),e.queryEnd(o),o.getDescription()===this.m_description)this.setPointByVal(this.m_pointCount-1,o);else{const e=s.newOrdinateBuffer(),t=new s.Point({vd:this.m_description,attribBuffer:e,initDefaultValues:!1});o.copyCommonAttributesTo(t),this.setPointByVal(this.m_pointCount-1,t)}const r=ue(e);this.initSegmentData(r),this.m_curveData.m_segmentParamIndex.write(this.m_pointCount-2,this.m_curveData.m_curveParamWritePoint),e.writeInBufferStream(this.m_curveData.m_segmentParams,this.m_curveData.m_curveParamWritePoint),this.m_curveData.m_curveParamWritePoint+=r;const m=_e.toSegType(a);this.incCurveType(m,1),this.modifyCurveCounter(1),this.m_curveData.m_segmentFlags.write(this.m_pointCount-2,m)}}addSegment(e,t,s){s?t?this.addPathFromClosedSegment(e,!1):this.closeLastPathWithSegment(e):this.addSegment_(e,t)}interpolateAttributesRange(e,s,n,i){for(let s=e;s<n-1;s++)this.isClosedPath(s)&&t.throwInvalidArgumentException("cannot interpolate across closed paths");const r=this.m_description.getAttributeCount();if(1===r)return;const o=this.calculateSubLength2D(e,s,n,i);if(0!==o)for(let t=1;t<r;t++){const r=this.m_description.getSemantics(t);this.interpolateAttributesSemanticsImpl(r,e,s,n,i,o)}}interpolateAttributesSemantics(e,s,n,i,r){if(0===e)return;this.hasAttribute(e)||t.throwInvalidArgumentException("does not have the given attribute"),2===pe.getInterpolation(e)&&t.throwInvalidArgumentException("angular interpolation");for(let e=s;e<i-1;e++)this.isClosedPath(e)&&t.throwInvalidArgumentException("cannot interpolate across closed paths");const o=this.calculateSubLength2D(s,n,i,r);0!==o&&this.interpolateAttributesSemanticsImpl(e,s,n,i,r,o)}interpolateAttributesPath(e,t,s){const n=this.m_description.getAttributeCount();if(1===n)return;if(t===s)return;const i=this.calculatePathSubLength2D(e,t,s);for(let r=1;r<n;r++){const n=this.m_description.getSemantics(r);this.interpolateAttributesSemanticsPathImpl(n,e,t,s,i)}}interpolateAttributesSemanticsPath(e,s,n,i){if(0===e)return;this.hasAttribute(e)||t.throwInvalidArgumentException("does not have the given attribute"),2===pe.getInterpolation(e)&&t.throwInvalidArgumentException("angular interpolation");const r=this.calculatePathSubLength2D(s,n,i);0!==r&&this.interpolateAttributesSemanticsPathImpl(e,s,n,i,r)}interpolateAttributesSemanticsImpl(e,t,s,i,r,o){const a=this.querySegmentIterator(),m=this.getPathStart(t)+s,h=this.getPathStart(i)+r,l=pe.getComponentCount(e),u=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,m,u,l);const c=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,h,c,l);const g=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);n.memcpy(g,u,0,0,l);let d=0;const p=pe.getDefaultValue(e),_=pe.getInterpolation(e);a.resetToVertex(m,t);do{if(a.hasNextSegment()){if(a.nextSegment(),a.getStartPointIndex()===h)return;this.setAttributeFromArray(e,a.getStartPointIndex(),g,l),a.previousSegment();do{const t=a.nextSegment();if(a.getEndPointIndex()===h)return;d+=t.calculateLength2D();const s=d/o;n.interpolateArray(_,u,c,g,0,l,s,p),a.isClosingSegment()||this.setAttributeFromArray(e,a.getEndPointIndex(),g,l)}while(a.hasNextSegment())}}while(a.nextPath())}interpolateAttributesSemanticsPathImpl(e,s,i,r,o){t.geometryReleaseAssert(0!==e);const a=this.querySegmentIterator(),m=pe.getInterpolation(e),h=this.getPathStart(s)+i,l=this.getPathStart(s)+r;if(l===h)return;const u=pe.getComponentCount(e),c=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,h,c,u);const g=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);this.queryAttributeAsDbl(e,l,g,u);const d=new n.KahanSummator(0);a.resetToVertex(h,s),a.setCirculator(this.isClosedPath(s));const p=pe.getDefaultValue(e),_=n.makePrimitiveArray(pe.maxComponentCount(),Number.NaN);n.memcpy(_,c,0,0,u);const f=0===o;let y=.5;do{const t=a.nextSegment();if(this.setAttributeFromArrayNoCurves(e,a.getStartPointIndex(),_,u),!f){const e=t.calculateLength2D();d.pe(e),y=d.getResult()/o}n.interpolateArray(m,c,g,_,0,u,y,p)}while(a.getEndPointIndex()!==l)}querySegment(e,s,n){const i=this.getPathIndexFromPointIndex(e),r=e-this.getPathStart(i);r>=this.getSegmentCountPath(i)&&t.throwInvalidArgumentException("get_segment"),this.getSegmentFromPath(i,r,s,n)}getSegment(e,t){const s=new this.m_segmentBufferCTor;return this.getSegmentBuffer(e,s,t),s.releaseSegment()}getSegmentType(e){const s=this.getPathIndexFromPointIndex(e),n=e-this.getPathStart(s);return n>=this.getSegmentCountPath(s)&&t.throwInvalidArgumentException("get_segment"),this.getSegmentTypeFromPath(s,n)}getSegmentFromPath(e,n,i,r){const o=this.getPathStart(e)+n,a=this.getSegmentFlagsStreamRef();let m=1;switch(a&&(m=31&a.read(o)),m){case 1:i.createLine();break;case 2:i.createCubicBezier();break;case 4:i.createEllipticArc();break;case 8:i.createQuadraticRationalBezier();break;case 16:i.createQuadraticBezier();break;default:t.throwInternalErrorException("")}const h=i.get();let l,u=null;if(r?(u=s.getDefaultDescription2D(),h.assignVertexDescription(u)):h.assignVertexDescription(this.m_description),l=o===this.getPathEnd(e)-1&&this.isClosedPath(e)?this.getPathStart(e):o+1,I(h,this.getXY(o)),T(h,this.getXY(l)),!r)for(let e=1,t=this.m_description.getAttributeCount();e<t;e++){const t=this.m_description.getSemantics(e),s=pe.getComponentCount(t);for(let e=0;e<s;e++){const s=this.getAttributeAsDbl(t,o,e);h.setStartAttribute(t,e,s);const n=this.getAttributeAsDbl(t,l,e);h.setEndAttribute(t,e,n)}}if(fe.isNonLinearSegmentFlag(m)){const e=this.m_curveData.m_segmentParamIndex.read(o);h.readFromBufferStream(this.m_curveData.m_segmentParams,e)}}replaceLinearEllipticalArcsWithTrueLines(){if(!this.hasNonLinearSegments())return!1;if(0===this.m_curveData.m_arcCount)return!1;let e=!1;for(let t=0,s=this.getPointCount();t<s;t++)if(4===this.m_curveData.m_segmentFlags.read(t)){const s=this.m_curveData.m_segmentParamIndex.read(t);le(this.m_curveData.m_segmentParams,s).isNAN()&&(this.m_curveData.m_segmentFlags.write(t,1),this.m_curveData.m_segmentParamIndex.write(t,-1),this.incCurveType(4,-1),this.modifyCurveCounter(-1),e=!0)}return e&&this.checkCompactSegmentParams(),e}queryPointAlongPath(e,s,i,r=!1){const o={iSegment:-1},a=r?o:{tSegment:0};if(i.setEmpty(),this.isEmpty())return o;if((e<0||e>=this.getPathCount())&&t.throwInvalidArgumentException("query_point_along_path"),s<0)return o;const m=this.getPathSize(e);if(0===m)return o;if(1===m)return this.getPointByVal(this.getPathStart(e),i),a.tSegment=0,o.iSegment=this.getPathStart(e),o;const h=this.querySegmentIteratorAtVertex(this.getPathStart(e)),l=new n.KahanSummator(0);for(;h.hasNextSegment();){const e=h.nextSegment(),t=e.calculateLength2D(),n=l.getResult();if(l.add(t),l.getResult()>=s){let r=s-n;r>t&&(r=t);const m=e.lengthToT(r);return e.queryCoord(m,i),a.tSegment=m,o.iSegment=h.getStartPointIndex(),o}}if(this.isClosedPath(e)){const t=this.getPathStart(e);return this.getPointByVal(t,i),a.tSegment=1,o.iSegment=this.getPathEnd(e)-1,o}{const t=this.getPathEnd(e)-1;return this.getPointByVal(t,i),this.getPathSize(e)>1?(a.tSegment=1,o.iSegment=this.getPathEnd(e)-2,o):(a.tSegment=0,o.iSegment=this.getPathStart(e),o)}}queryPointsAlongPath(e,s,i,r,o,a){{let e=0;for(let n=0;n<s;++n)r&&r[n].setEmpty(),o&&(o[n]=-1),a&&(a[n]=0),e>i[n]&&t.throwInvalidArgumentException("query_points_along"),e=i[n]}const m=this.getPathSize(e);if(0===s||0===m)return 0;if(1===m){const t=this.getPathStart(e);return r&&this.getPointByVal(t,r[0]),a&&(a[0]=0),o&&(o[0]=t),1}const h=this.getPathStart(e),l=new n.KahanSummator(0),u=this.querySegmentIteratorAtVertex(h);let c=0,g=0,d=i[c];for(;u.hasNextSegment();){const e=u.nextSegment(),t=e.calculateLength2D(),n=l.getResult();for(l.add(t);l.getResult()>=d;){let m=d-n;m>t&&(m=t);const h=e.lengthToT(m);if(r&&e.queryCoord(h,r[g]),a&&(a[g]=h),o&&(o[g]=u.getStartPointIndex()),g++,c++,d=i[c],c===s)return g}}if(this.isClosedPath(e)){const t=this.getPathStart(e),s=0;r&&this.getPointByVal(t,r[g]),a&&(a[g]=s),o&&(o[g]=t),g++}else if(this.getPathSize(e)>1){const t=this.getPathEnd(e)-2,s=1;r&&this.getPointByVal(t+1,r[g]),a&&(a[g]=s),o&&(o[g]=t),g++}return g}queryPointsAlong(e,s,i,r,o){{let n=0;for(let a=0;a<e;++a)i&&i[a].setEmpty(),r&&(r[a]=-1),o&&(o[a]=0),n>s[a]&&t.throwInvalidArgumentException("query_points_along"),n=s[a]}if(0===e)return 0;const a=new n.KahanSummator(0),m=this.querySegmentIterator();let h=-1,l=0,u=0,c=s[l];for(;m.nextPath();)for(;m.hasNextSegment();){h=m.getPathIndex();const t=m.nextSegment(),n=t.calculateLength2D(),g=a.getResult();for(a.add(n);a.getResult()>=c;){let a=c-g;a>n&&(a=n);const h=t.lengthToT(a);if(i&&t.queryCoord(h,i[u]),o&&(o[u]=h),r&&(r[u]=m.getStartPointIndex()),u++,l++,c=s[l],l===e)return u}}if(h<0)return 0;if(this.isClosedPath(h)){const e=this.getPathStart(h),t=0;i&&this.getPointByVal(e,i[u]),o&&(o[u]=t),r&&(r[u]=e),u++}else if(this.getPathSize(h)>1){const e=this.getPathEnd(h)-2,t=1;i&&this.getPointByVal(e+1,i[u]),o&&(o[u]=t),r&&(r[u]=e),u++}return u}querySegmentIterator(){return new me({parent:this})}querySegmentIteratorAtVertex(e){return new me({parent:this,pointIndex:e})}queryPathEnvelope(e,t){this.queryPathEnvelopeImpl(e,t,!0)}queryLoosePathEnvelope(e,t){this.queryPathEnvelopeImpl(e,t,!1)}queryPathEnvelopeImpl(e,n,r){if(n instanceof s.Envelope&&t.geometryReleaseAssert(0,"not implemented for Envelope"),n instanceof s.Envelope3D&&t.geometryReleaseAssert(0,"not implemented for Envelope3D"),(e>=this.getPathCount()||e<0)&&t.throwInvalidArgumentException(""),this.isEmpty())return void n.setEmpty();const o=this.getAttributeStreamRef(0),a=i.Envelope2D.constructEmpty();a.setEmpty();for(let s=2*this.getPathStart(e),n=2*this.getPathEnd(e);s<n;){const e=n-s;t.geometryReleaseAssert(!(1&e)),a.mergePointsInterleaved(o,s/2,e/2),s+=e}if(n.setCoords({env2D:a}),this.hasNonLinearSegmentsPath(e)){const s=this.querySegmentIterator();if(s.resetToPath(e),s.nextPath())for(;s.hasNextSegment();){const e=s.nextCurve();if(!e)break;{const t=i.Envelope2D.constructEmpty();r?e.queryEnvelope(t):e.queryLooseEnvelope(t),n.mergeEnvelope2D(t)}}else t.geometryReleaseAssert(0)}}checkCompactSegmentParams(){if(!this.m_curveData||null===this.m_curveData.m_segmentParams)return!1;if(this.m_curveData.m_segmentParams.size()<=this.m_vertexAttributes.get(0).size())return!1;const e=ce(4)*this.m_curveData.m_arcCount+ce(2)*this.m_curveData.m_bezierCount+ce(8)*this.m_curveData.m_rbezier2Count+ce(16)*this.m_curveData.m_bezier2Count;return this.m_curveData.m_segmentParams.size()>Math.max(3*e>>1,10)?(this.forceCompactSegmentParams(),!0):(0===this.m_pointCount&&(this.m_curveData.m_curveParamWritePoint=0),!1)}forceCompactSegmentParams(){let e=0;for(let t=0,s=this.getPointCount();t<s;t++){const s=this.m_curveData.m_segmentFlags.read(t);fe.isNonLinearSegmentFlag(s)&&(e+=ce(s))}const t=s.createDoubleStream(e);let n=0;for(let e=0,s=this.getPointCount();e<s;e++){const s=this.m_curveData.m_segmentFlags.read(e);if(fe.isNonLinearSegmentFlag(s)){let i=this.m_curveData.m_segmentParamIndex.read(e);this.m_curveData.m_segmentParamIndex.write(e,n);const r=ce(s);for(let e=0;e<r;e++)t.write(n,this.m_curveData.m_segmentParams.read(i)),n++,i++}}this.m_curveData.m_segmentParams=t,this.m_curveData.m_curveParamWritePoint=n}setEmpty(){this.m_curveData&&(this.removeAllCurvesFromGlobalCounter(),this.m_curveData=null),this.m_bPathStarted=!1,this.m_paths=null,this.m_pathFlags=null,this.setEmptyImpl()}applyTransformation(e){this.applyTransformationToPath(e,-1)}applyTransformation3D(e){t.geometryReleaseAssert(0)}getImpl(){return this}reserve(e){this.reserveImpl(e),e>0&&!this.m_paths&&(this.m_paths=s.createIndexStream(0),this.m_pathFlags=s.createByteStream(0),this.m_paths.reserve(2),this.m_pathFlags.reserve(2),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0))}reserveParts(e,t){this.reserveImpl(e),t>0&&(this.m_paths?(this.m_paths.reserve(t+1),this.m_pathFlags.reserve(t+1)):(this.m_paths=s.createIndexStream(0),this.m_pathFlags=s.createByteStream(0),this.m_paths.reserve(t+1),this.m_pathFlags.reserve(t+1),this.m_paths.resize(1,0),this.m_pathFlags.resize(1,this.m_bPolygon?1:0)))}clone(){const e=this.createInstance();return this.copyTo(e),e}queryLimitedSegmentIterator(e){return new ye(this,e)}getPathStreamRef(){return this.throwIfEmpty(),this.m_paths}setPathStreamRef(e){this.m_paths=e}getSegmentFlagsStreamRef(){return this.throwIfEmpty(),null!=this.m_curveData?this.m_curveData.m_segmentFlags:null}getPathFlagsStreamRef(){return this.throwIfEmpty(),this.m_pathFlags}setPathFlagsStreamRef(e){this.m_pathFlags=e}getSegmentIndexStreamRef(){return this.throwIfEmpty(),null!==this.m_curveData?this.m_curveData.m_segmentParamIndex:null}getSegmentDataStreamRef(){return this.throwIfEmpty(),null!==this.m_curveData?this.m_curveData.m_segmentParams:null}setSegmentData(e,t,s,n){this.m_curveData||(this.m_curveData=new _e),this.m_curveData.m_segmentFlags=s,this.m_curveData.m_segmentParams=t,this.m_curveData.m_segmentParamIndex=e,this.m_curveData.m_curveParamWritePoint=n}static getPathIndexFromPointIndexImpl(e,s,n,i){if(i>=0&&i<s){if(n>=e.read(i)){if(n<e.read(i+1))return i;i++}else i--;if(i>=0&&i<s&&n>=e.read(i)&&n<e.read(i+1))return i}if(s<5){for(let t=0;t<s;t++)if(n<e.read(t+1))return t;t.throwCorruptedGeometryException("")}let r=0,o=s-1;for(;o>r;){const t=r+(o-r>>1);if(n<e.read(t))o=t-1;else{if(!(n>=e.read(t+1)))return t;r=t+1}}return r}getHighestPointIndex(e){t.geometryReleaseAssert(e>=0&&e<this.getPathCount());const s=this.getAttributeStreamRef(0),i=this.getPathEnd(e),r=this.getPathStart(e);let o=-1;const a=new n.Point2D;a.y=Number.NEGATIVE_INFINITY,a.x=Number.NEGATIVE_INFINITY;for(let e=r+0;e<i;e++){const t=s.readPoint2D(2*e);-1===a.compare(t)&&(o=e,a.setCoordsPoint2D(t))}return o}applyTransformationToPath(e,s){if(s>=this.getPathCount()&&t.throwInvalidArgumentException("apply_transformation"),this.isEmpty())return;if(e.isIdentity())return;const i=this.m_vertexAttributes.get(0);if(!(s<0?this.hasNonLinearSegments():this.hasNonLinearSegmentsPath(s))){let t,n;return s<0?(t=0,n=this.m_pointCount):(t=this.getPathStart(s),n=this.getPathEnd(s)),i.applyTransformation(e,2*t,n-t),void this.notifyModifiedFlags(2001)}const r=new this.m_segmentBufferCTor,o=this.getPathCount();let a=s<0?0:s;do{const t=this.getPathStart(a),o=this.getPathEnd(a),m=this.isClosedPath(a),h=i.readPoint2D(2*t);if(!this.hasNonLinearSegmentsPath(a)){i.applyTransformation(e,2*t,o-t);continue}const l=n.Point2D.getNAN();for(let s=t;s<o;++s){if(1!=(31&this.m_curveData.m_segmentFlags.read(s))){const n=m&&s+1===o;n&&i.writePoint2D(2*t,h),this.getSegmentBuffer(s,r,!0),r.get().applyTransformation(e);const a=this.m_curveData.m_segmentParamIndex.read(s);r.get().writeInBufferStream(this.m_curveData.m_segmentParams,a),i.writePoint2D(2*s,r.get().getStartXY()),n&&i.writePoint2D(2*t,r.get().getEndXY());continue}const n=2*s;i.queryPoint2D(n,l),e.transformInPlace(l),i.writePoint2D(n,l)}if(a===s)break}while(++a<o);this.notifyModifiedFlags(2001)}calculateSubLength2D(e,s,n,i){const r=this.getPathStart(e)+s,o=this.getPathStart(n)+i;(o<r||r<0||o>this.getPointCount()-1)&&t.throwInvalidCallException("");const a=this.querySegmentIterator();let m=0;a.resetToVertex(r,e);do{for(;a.hasNextSegment();){const e=a.nextSegment();if(a.getStartPointIndex()===o)break;m+=e.calculateLength2D()}if(a.getStartPointIndex()===o)break}while(a.nextPath());return m}calculatePathSubLength2D(e,s,n){const i=this.getPathStart(e)+s,r=this.getPathStart(e)+n;(i<0||r>this.getPointCount()-1)&&t.throwInvalidCallException("");const o=this.querySegmentIterator();if(i>r&&(this.isClosedPath(e)||t.throwInvalidArgumentException("cannot iterate across an open path"),o.setCirculator(!0)),i===r)return 0;let a=0,m=0;o.resetToVertex(i,e);do{m+=a,a=o.nextSegment().calculateLength2D()}while(o.getStartPointIndex()!==r);return m}calculateEnvelope2D(e){return this.updateXYImpl(e)}updateXYImpl(e){const t=super.updateXYImpl(e);if(this.hasNonLinearSegments()){const s=i.Envelope2D.constructEmpty(),n=this.querySegmentIterator();for(;n.nextPath();)for(;n.hasNextSegment();){const i=n.nextCurve();if(!i)break;e?i.queryEnvelope(s):i.queryLooseEnvelope(s),t.mergeEnvelope2D(s)}}return t}notifyModifiedAllImpl(){null!==this.m_paths&&this.m_paths.size()?this.m_pointCount=this.m_paths.read(this.m_paths.size()-1):this.m_pointCount=0}setDirtyOGCFlags(e){this.setDirtyFlagProtected(16,e)}hasDirtyOGCStartFlags(){return this.hasDirtyFlag(16)}setDirtyRingAreas2D(e){this.setDirtyFlagProtected(1024,e)}hasDirtyRingAreas2D(){return this.hasDirtyFlag(1024)}static isNonLinearSegmentFlag(e){return!(1&e)}addAndExplicitlyOpenAllPaths(e,s){this===e&&t.throwInvalidArgumentException("Multi_path_impl::add");let n=this.getPathCount();for(let t=0,i=e.getPathCount();t<i;t++)this.addPath(e,t,!s),this.openPathAndDuplicateStartVertex(n),n++}getSegmentFlags(e){return null!==this.m_curveData&&null!==this.m_curveData.m_segmentFlags?this.m_curveData.m_segmentFlags.read(e):1}getSegmentBuffer(e,s,n){const i=this.getPathIndexFromPointIndex(e),r=e-this.getPathStart(i);r>=this.getSegmentCountPath(i)&&t.throwInvalidArgumentException("getSegmentBuffer"),this.getSegmentFromPath(i,r,s,n)}getSegmentTypeFromPath(e,s){const n=this.getPathStart(e)+s,i=this.getSegmentFlagsStreamRef();let r=1;switch(i&&(r=31&i.read(n)),r){case 1:return t.GeometryType.enumLine;case 2:return t.GeometryType.enumBezier;case 4:return t.GeometryType.enumEllipticArc;case 8:return t.GeometryType.enumRationalBezier2;case 16:return t.GeometryType.enumBezier2;default:t.throwInternalErrorException("")}}ensureXYMonotoneSegments(){if(!this.m_curveData)return!1;let e=!1;for(let s=0,i=this.getPathCount();s<i;s++){const i=this.getPathStart(s),r=this.getPathEnd(s),o=r-i;for(let s=i;s<r;s++){const r=31&this.m_curveData.m_segmentFlags.read(s);if(1===r)continue;2!==r&&t.throwNotImplementedException("ensure_xy_monotone_segments");const a=(s-i+1)%o+i,m=this.m_curveData.m_segmentParamIndex.read(s),h=n.makeObjectArray(n.Point2D,4);h[0]=this.getXY(s),h[3]=this.getXY(a),h[1].x=this.m_curveData.m_segmentParams.read(m),h[1].y=this.m_curveData.m_segmentParams.read(m+1),h[2].x=this.m_curveData.m_segmentParams.read(m+2),h[2].y=this.m_curveData.m_segmentParams.read(m+3),v(h)&&(e=!0,this.m_curveData.m_segmentParams.write(m,h[1].x),this.m_curveData.m_segmentParams.write(m+1,h[1].y),this.m_curveData.m_segmentParams.write(m+2,h[2].x),this.m_curveData.m_segmentParams.write(m+3,h[2].y))}}return e&&this.notifyModifiedFlags(2001),e}buildRasterizedGeometryAccelerator(e,t){return!1}buildQuadTreeAccelerator(e){if(this.m_accelerators||(this.m_accelerators=new he),null!==this.m_accelerators.getQuadTree())return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTree(null);const t=s.buildQuadTree(this);return this.m_accelerators.setQuadTree(t),!0}buildQuadTreeForPathsAccelerator(e){if(this.m_accelerators||(this.m_accelerators=new he),null!==this.m_accelerators.getQuadTreeForPaths())return!0;this.ensureUniqueAccelerators(),this.m_accelerators.setQuadTreeForPaths(null);const t=s.buildQuadTreeForPaths(this);return this.m_accelerators.setQuadTreeForPaths(t),!0}updateCurveCounter(e){this.modifyCurveCounter(e-this.getCurveCount())}removeAllCurvesFromGlobalCounter(){this.m_curveData&&(fe.st_totalCurveCount-=this.m_curveData.m_curveCount,this.m_curveData.m_curveCount=0,this.m_curveData.m_bezierCount=0,this.m_curveData.m_arcCount=0,this.m_curveData.m_bezier2Count=0,this.m_curveData.m_rbezier2Count=0,this.m_curveData.m_curveParamWritePoint=0)}modifyCurveCounter(e){e&&(this.m_curveData||(this.m_curveData=new _e),fe.st_totalCurveCount+=e,this.m_curveData.m_curveCount+=e)}getCurveCount(){return this.m_curveData?this.m_curveData.m_curveCount:0}incCurveType(e,t){this.m_curveData||(this.m_curveData=new _e),2&e?this.m_curveData.m_bezierCount+=t:4&e?this.m_curveData.m_arcCount+=t:8&e?this.m_curveData.m_rbezier2Count+=t:16&e&&(this.m_curveData.m_bezier2Count+=t)}getCurveWritePoint(){return null!==this.m_curveData?this.m_curveData.m_curveParamWritePoint:0}initSegmentData(e){null===this.m_curveData&&(this.m_curveData=new _e);const t=this.m_reservedPointCount>0?this.m_reservedPointCount:this.m_pointCount;null===this.m_curveData.m_segmentParamIndex&&(this.m_curveData.m_segmentFlags=s.createByteStream(t,1),this.m_curveData.m_segmentParamIndex=s.createIndexStream(t,-1));const n=this.m_curveData.m_curveParamWritePoint+e;null===this.m_curveData.m_segmentParams?this.m_curveData.m_segmentParams=s.createDoubleStream(n):n!==this.m_curveData.m_segmentParams.size()&&this.m_curveData.m_segmentParams.resize(n,0),this.m_curveData.m_segmentFlags.size()<t&&(this.m_curveData.m_segmentFlags.resize(t,1),this.m_curveData.m_segmentParamIndex.resize(t,-1))}updateCurveWritePoint(e){null===this.m_curveData&&(this.m_curveData=new _e),this.m_curveData.m_curveParamWritePoint=e}updateOGCFlagsHelper(){const e=this.getPathCount();if(0===e)return;const t=this.m_pathFlags;let s=0;for(let i=0;i<e;i++){const e=this.m_cachedRingAreas2D.read(i);0===s&&(s=n.sign(e)),e*s>0||0===s?t.setBits(i,8):t.clearBits(i,8)}}updateOGCFlagsProtected(){this.hasDirtyFlag(16)&&(this.updateRingAreas2DProtected(),this.updateOGCFlagsHelper(),this.setDirtyFlagProtected(16,!1))}replaceSegment(e,s,n){(e<0||e>=this.getPointCount())&&t.throwInvalidArgumentException("Multi_path_impl.replace_segment"),t.geometryReleaseAssert(s.isCurve());const i=this.getPathIndexFromPointIndex(e),r=this.getPathStart(i),o=(e-r+1)%this.getPathSize(i)+r;{const n=this.getXY(e),i=this.getXY(o),r=!n.isEqualPoint2D(s.getStartXY())||!i.isEqualPoint2D(s.getEndXY());t.geometryReleaseAssert(!r)}this.replaceSegmentImpl(e,o,s,n)}replaceSegmentImpl(e,i,r,o){const a=r.getDescription();this.mergeVertexDescription(a);const m=n.makePrimitiveArray(32,Number.NaN),h=new s.Point({vd:a,attribBuffer:m,initDefaultValues:!1}),l=null===this.m_curveData?1:31&this.m_curveData.m_segmentFlags.read(e),u=ce(l),c=ue(r);let g,d=!1;u>=c?(t.geometryReleaseAssert(null!==this.m_curveData),d=!0,g=this.m_curveData.m_segmentParamIndex.read(e)):(this.initSegmentData(c),d=!1,g=this.m_curveData.m_curveParamWritePoint);const p=r.getGeometryType(),_=_e.toSegType(p);o||(r.queryStart(h),this.setPointByValNoCurves(e,h),r.queryEnd(h),this.setPointByValNoCurves(i,h)),this.m_curveData.m_segmentParamIndex.write(e,1!==_?g:-1),this.m_curveData.m_segmentFlags.write(e,_),1!==_&&r.writeInBufferStream(this.m_curveData.m_segmentParams,g),d||(this.m_curveData.m_curveParamWritePoint+=c),l!==_&&(this.incCurveType(l,-1),this.incCurveType(_,1),this.modifyCurveCounter(1===l?1:-1))}setAttributeImpl(e,s,n){if(this.addAttribute(e),!this.isEmpty())if(this.hasNonLinearSegments()&&0===e){(s<0||s>1)&&t.throwInvalidArgumentException("");const e=new r.Transformation2D,i=0===s?n:0,o=0===s?0:1;e.setShiftCoords(i,o),0===s?e.xx=0:e.yy=0,this.applyTransformation(e)}else super.setAttributeImpl(e,s,n)}}fe.st_totalCurveCount=0;class ye{constructor(e,t){this.m_segIter=null,this.m_quadTree=null,this.m_qtIter=null,this.m_extentOfInterest=new i.Envelope2D(t),this.m_bfirst=!0,this.m_prevIndex=-100,this.m_parent=e}nextSegment(){return this.m_bfirst&&this.prepare_(),this.m_quadTree?this.nextSegmentQt():this.nextSegmentNoQt()}getPathIndex(){return this.m_segIter.getPathIndex()}getStartPointIndex(){return this.m_segIter.getStartPointIndex()}getEndPointIndex(){return this.m_segIter.getEndPointIndex()}isClosingSegment(){return this.m_segIter.isClosingSegment()}isPathClosed(){return this.m_segIter.isPathClosed()}prepare_(){const e=this.m_parent.getAccelerators();e&&(this.m_quadTree=e.getQuadTree(),this.m_quadTree&&(this.m_qtIter=this.m_quadTree.getSortedIterator(this.m_extentOfInterest,0))),this.m_segIter=this.m_parent.querySegmentIterator()}nextSegmentQt(){this.m_bfirst=!1;const e=this.m_qtIter.next();if(-1===e)return null;const t=this.m_quadTree.getElement(e);return(t!==this.m_prevIndex+1||this.m_segIter.isLastSegmentInPath())&&(this.m_segIter.resetToVertex(t,this.m_segIter.getPathIndex()),this.m_prevIndex=t),this.m_segIter.nextSegment()}nextSegmentNoQt(){for(;;){if(!this.m_bfirst&&this.m_segIter.hasNextSegment()){const e=this.m_segIter.nextSegment(),t=i.Envelope2D.constructEmpty();if(e.queryLooseEnvelope(t),!t.isIntersecting(this.m_extentOfInterest))continue;return e}if(this.m_bfirst=!1,!this.m_segIter.nextPath())return null}}}class xe extends fe{constructor(e){e?e.vd?(super({vd:e.vd,bPolygon:!1}),this.m_segmentBufferCTor=Mr):e.copy?(super({vd:e.copy.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=Mr,e.copy.copyTo(this)):e.move?(super({move:e.move}),this.m_segmentBufferCTor=Mr):e.start?(super({vd:e.start.getDescription(),bPolygon:!1}),this.m_segmentBufferCTor=Mr,this.startPathPoint(e.start),this.lineToPoint(e.end)):e.path?(super({bPolygon:!1}),this.m_segmentBufferCTor=Mr,this.addPathPoint2D(e.path,e.pointCount,e.bForward)):t.throwInternalErrorException("bad constructor arg"):(super({bPolygon:!1}),this.m_segmentBufferCTor=Mr)}getBoundary(){return Ee(this)}assignCopy(e){return this!==e&&e.copyTo(this),this}assignMove(e){return e.copyTo(this),this}getGeometryType(){return xe.type}getDimension(){return 1}createInstance(){return new xe({vd:this.getDescription()})}equals(e,t){return this.equalsBase(e,t)}}xe.type=t.GeometryType.enumPolyline;var Pe=t.GeometryType;function Ee(e,n){const i=e.getGeometryType();if(i===Pe.enumPolygon){const t=new xe({vd:e.getDescription()});return e.isEmpty()||e.copyToUnchecked(t),t}if(i===Pe.enumPolyline)return ve(e.getImpl(),0,!1).boundary;if(i===Pe.enumEnvelope){const t=new xe({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t.isSegment(i)){const t=new g({vd:e.getDescription()});if(!e.isEmpty()&&!e.isClosed()){const n=new s.Point;t.reserve(2),e.queryStart(n),t.add(n),e.queryEnd(n),t.add(n)}return t}if(i===Pe.enumGeometryCollection){const t=e;let s=null;for(let i=0,r=t.getGeometryCount();i<r;i++){const r=Ee(t.getGeometry(i),n);if(null!==r){null===s&&(s=e.createInstance());const t=r;s.addGeometry(t)}}return s}if(t.isPoint(i))return new s.Point({vd:e.getDescription()});t.throwNotImplementedException("")}function ve(e,t,i){const r=!1,o=e;let a=null;if(i||(a=new g({vd:o.getDescription()})),!o.isEmpty()){const e=new s.AttributeStreamOfInt32(0);for(let t=0,s=o.getPathCount();t<s;t++)if(o.getPathSize(t)>0&&!o.isClosedPathInXYPlane(t)){const s=o.getPathStart(t);e.add(s);const n=o.getPathEnd(t)-1;e.add(n)}if(e.size()>0){const t=new s.BucketSort,r=o.getAttributeStreamRef(0),m={userSort(e,t,s){const i=n.Point2D.getNAN(),o=n.Point2D.getNAN();s.sort(e,t,(e,t)=>(r.queryPoint2D(2*e,i),r.queryPoint2D(2*t,o),i.compare(o)))},getValue:e=>r.read(2*e+1)};t.sort(e,0,e.size(),m);let h=r.readPoint2D(2*e.read(0)),l=0,u=1;const c=new s.Point;for(let t=1,s=e.size();t<s;t++){const s=r.readPoint2D(2*e.read(t));if(s.isEqualPoint2D(h))e.read(l)>e.read(t)?(e.write(l,n.indexTypeMax()),l=t):e.write(t,n.indexTypeMax()),u++;else{if(1&u){if(i)return{bNotEmpty:!0,boundary:new g({})}}else e.write(l,n.indexTypeMax());h=s,l=t,u=1}}if(1&u){if(i)return{bNotEmpty:!0,boundary:new g({})}}else e.write(l,n.indexTypeMax());if(!i){e.sort(0,e.size());for(let t=0,s=e.size();t<s&&e.read(t)!==n.indexTypeMax();t++)o.getPointByVal(e.read(t),c),a.add(c)}}}return i?{bNotEmpty:r,boundary:new g({})}:{bNotEmpty:r,boundary:a}}function Ce(e,s,i,r){const o=4*n.doubleEps()*(Math.abs(s.vmin)+Math.abs(s.vmax)),a=n.doubleEps();if(1===e.getMaxDerivative()){t.geometryReleaseAssert(i>0);const a=Ie(e,0,s,n.doubleEps(),o);return r[0]=a.root,a.cRoots}let m,h=[];const l=new n.Envelope1D(s.vmin-o,s.vmax+o);h.push(new n.Point2D(l.vmin,l.vmax));let u=0;for(let t=e.getMaxDerivative()-1;t>=0;t--){m=h,h=[];for(let l=0,c=m.length;l<c;l++){if(m[l][0]<m[l][1]){let c,g,d;if(t===e.getMaxDerivative()-1?({root:c,funcAtRoot:g,cRoots:d}=Ie(e,t,n.Envelope1D.construct(m[l][0],m[l][1]),a,.5*o)):({root:c,funcAtRoot:g,cRoots:d}=we(e,t,n.Envelope1D.construct(m[l][0],m[l][1]),0,.5*o)),1===d){if(0===t)u<i&&(m[l][0]<=s.vmin&&m[l][1]>=s.vmin&&c!==s.vmin&&0===e.getValue(0,s.vmin)&&(c=s.vmin),m[l][0]<=s.vmax&&m[l][1]>=s.vmax&&c!==s.vmax&&0===e.getValue(0,s.vmax)&&(c=s.vmax),r[u]=s.snapClip(c),u>0?r[u]-r[u-1]>o&&u++:u++);else{const e=n.Point2D.getNAN();e[0]=m[l][0],e[1]=c,h.push(e);const t=n.Point2D.getNAN();t[0]=c,t[1]=m[l][1],h.push(t)}continue}}h.push(m[l])}}return u}function De(e,t,s,i,r,o){const a=n.makeObjectArray(n.ECoordinate,2),m=Ne(new n.ECoordinate(e),new n.ECoordinate(t),new n.ECoordinate(s),i,r,a);return o[0]=a[0].value(),o[1]=a[1].value(),m}function be(e,t,s,i,r,o,a){const m=n.makeObjectArray(n.ECoordinate,3),h=Ge(new n.ECoordinate(e),new n.ECoordinate(t),new n.ECoordinate(s),new n.ECoordinate(i),r,o,m);return a[0]=m[0].value(),a[1]=m[1].value(),a[2]=m[2].value(),h}function Se(e,t,s,i,r,o,a,m){return function(e,t,s,i,r,o,a,m){const h=n.makePrimitiveArray(s*s,Number.NaN);h.fill(0),n.memcpy(m,i,0,0,s);const l=n.makePrimitiveArray(s,Number.NaN),u=n.makePrimitiveArray(s,Number.NaN),c=n.makePrimitiveArray(s,Number.NaN);let g=e(m,s,t),d=0;for(d=0;d<100;d++){const i=g;for(let e=0;e<s;++e)u[e]=m[e];if(d%s===0){h.fill(0);for(let e=0;e<s;e++)h[e*s+e]=1}let a=0,p=0;for(let n=0;n<s;++n){for(let e=0;e<s;++e)l[e]=h[n*s+e];const i=g;g=Te(e,t,m,l,r,o,s);const u=i-g;u>a&&(p=n,a=u)}for(let e=0;e<s;e++)l[e]=m[e]-u[e],c[e]=m[e]+(m[e]-u[e]);const _=e(c,s,t);if(_<i&&2*(i-2*g+_)*n.sqr(i-g-a)<n.sqr(i-_)*a){g=Te(e,t,m,l,r,o,s);for(let e=0;e<s;++e)h[p*s+e]=h[(s-1)*s+e],h[(s-1)*s+e]=l[e]}if(i<=g)return e(m,s,t)}return g}(e,t,s,i,r,o,0,m)}function Ie(e,s,i,r,o){const a={root:0,funcAtRoot:0,cRoots:0};let m=i.vmin,h=i.vmax,l=0,u=Number.MAX_VALUE,c=e.getValue(s,m),g=e.getValue(s,h),d=0,p=0,_=0;if(c>=0&&g>=0||c<=0&&g<=0)return Math.abs(c)<Math.abs(g)?(a.funcAtRoot=c,a.root=m,a.cRoots=0===c?1:0,a):(a.funcAtRoot=g,a.root=h,a.cRoots=0===g?1:0,a);Math.abs(c)<Math.abs(g)&&(h=n.swap(m,m=h),g=n.swap(c,c=g)),l=m,d=c;let f=!0,y=0;for(;0!==g&&Math.abs(m-h)>r*Math.abs(h)+o;y++){let i=y>64;if(!i){p=c!==d&&g!==d?m*g*d/((c-g)*(c-d))+h*c*d/((g-c)*(g-d))+l*c*g/((d-c)*(d-g)):h-g*(h-m)/(g-c);const e=(3*m+h)/4;if(i=!(p>e&&p<h||p>h&&p<e),!i){const e=r*Math.abs(h)+o;if(f){const t=Math.abs(h-l);i=Math.abs(p-h)>=.5*t||t<e}else{const t=Math.abs(l-u);i=Math.abs(p-h)>=.5*t||t<e}}}if(i?(p=(m+h)/2,f=!0):f=!1,_=e.getValue(s,p),0===_)return a.root=p,a.funcAtRoot=_,a.cRoots=1,a;if(!i){const t=m-p,i=p-h;if(Math.abs(t)>10*Math.abs(i)){let t=h+3*i;for(let i=0;i<2;i++){const i=e.getValue(s,t);n.sign(c)*n.sign(i)>0?(m=t,c=i):t=n.lerp(m,h,.75)}}else if(Math.abs(i)>10*Math.abs(t)){let i=m-3*t;for(let t=0;t<2;++t){const t=e.getValue(s,i);n.sign(g)*n.sign(t)>0?(h=i,g=t):i=n.lerp(m,h,.25)}}}u=l,l=h,d=g,n.sign(c)*n.sign(_)<0?(h=p,g=_):(m=p,c=_),Math.abs(c)<Math.abs(g)&&(h=n.swap(m,m=h),g=n.swap(c,c=g)),128===y&&t.throwInternalErrorException("Root_finder iterations exceeded")}return a.root=h,a.funcAtRoot=g,a.cRoots=1,a}function we(e,s,i,r,o){const a={root:0,funcAtRoot:0,cRoots:0};let m=i.vmin,h=e.getValue(s,m),l=i.vmax,u=e.getValue(s,l);if(h>=0&&u>=0||h<=0&&u<=0)return Math.abs(h)<Math.abs(u)?(a.funcAtRoot=h,a.root=m,a.cRoots=0===h?1:0,a):(a.funcAtRoot=u,a.root=l,a.cRoots=0===u?1:0,a);u<0&&(u=n.swap(h,h=u),l=n.swap(m,m=l));let c=.5*(m+l),g=Math.abs(l-m),d=g,p=e.getValue(s,c),_=e.getValue(s+1,c),f=4,y=1,x=0,P=0,E=1,v=0;for(;++v<100;){let t;v>32||0===_||2===E&&x>1||1===E&&f<4?(E=1,y>1&&y--):(E=2,P>1&&Math.abs(2*p)>Math.abs(g*_)&&y++),g=d;let n=!1;if(1===E)do{if(P>2){const e=16*Math.abs(g);if(.5*Math.abs(m-l)>e){const s=Math.min(m,l),n=Math.max(m,l);if(c===s){t=c,c=s+e,d=c-t;break}if(c===n){t=c,c=n-e,d=c-t;break}}}d=.5*(l-m),t=c,c=m+d,n=m===c||l===c}while(0);else for(;;){d=y*p/_,t=c,c-=d,n=c===t;const e=Math.min(m,l),s=Math.max(m,l);if(c<e){if(y>1){c=t,y--;continue}d=t-e,c=e}else if(c>s){if(y>1){c=t,y--;continue}d=t-s,c=s}break}if(n||Math.abs(d)<o){t!==c&&(p=e.getValue(s,c));break}p=e.getValue(s,c),_=e.getValue(s+1,c);const i=m,r=l;p<0?(h=p,m=c):(u=p,l=c),2===E&&(m===i&&l===r||P>1&&Math.abs(d)>=.5001*Math.abs(g))?x++:x=0,1===E?(f++,P=0):(f=0,P++)}return 100===v&&t.throwInternalErrorException("Root_finder iterations exceeded"),a.root=c,a.funcAtRoot=p,a.cRoots=1,a}function Te(e,t,s,i,r,o,a){const m=i.slice(0,a);let h=0;for(let e=0;e<a;e++)h+=i[e]*i[e];if(h=Math.sqrt(h),h>0)for(let e=0;e<a;e++)m[e]/=h;let l=Number.NEGATIVE_INFINITY,u=Number.POSITIVE_INFINITY;{const e=n.makePrimitiveArray(a,0);for(let t=0;t<a;t++)e[t]=t;e.sort((e,t)=>{const s=Math.abs(m[e]),n=Math.abs(m[t]);return s<n?-1:s>n?1:0});for(let t=0;t<a;t++){const i=e[t];if(0===m[i])continue;let a=(r[i]-s[i])/m[i],h=(o[i]-s[i])/m[i];h<a&&(h=n.swap(a,a=h)),a>l&&(l=a),h<u&&(u=h)}}let c=0;const g=(Math.abs(l)+Math.abs(u))*n.doubleEps()*100,d=n.makePrimitiveArray(a,Number.NaN),p=m.slice();function _(n,i){for(let e=0,t=a;e<t;e++)d[e]=s[e]+n*p[e];return e(d,a,t)}g>0&&(c=function(e,t,s,i,r,o){return function(e,t,s,i,r,o){const a=n.goldenRatio();let m=0,h=e(m,t),l=s,u=r,c=e(l,t),g=e(u,t);h>c&&(h=c,m=l),h>g&&(h=g,m=u);let d=l,p=u,_=c,f=g;_>f&&(_=n.swap(f,f=_),p=n.swap(d,d=p));let y=m-d,x=d-p;const P=.5*Math.min(o,u-l),E=2*P;let v,C=0;for(v=0;v<100&&!(u-l<=E);++v){const s=l+.5*(u-l);let n=C>0;if(!n&&Math.abs(x)<=P&&(n=!0,C=3),!n){const e=m-d,t=m-p,s=e*(h-f);let i=t*(h-_),r=t*i-e*s;i=2*(i-s),i>0&&(r=-r),i=Math.abs(i),0===i||Math.abs(r)>=Math.abs(i*x/2)||r<=i*(l-m)||r>=i*(u-m)?(n=!0,C=3):(x=y,y=r/i)}n&&(x=m>=s?l-m:u-m,y=a*x,C--);let i=m+y;i<l+P?i=l+P:i>u-P&&(i=u-P);const r=e(i,t);r<h?(i>=m?(l=m,c=h):(u=m,g=h),p=d,d=m,m=i,f=_,_=h,h=r):(i<m?(l=i,c=r):(u=i,g=r),r<=_||d===m?(p=d,d=i,f=_,_=r):(r<=f||p===m||p===d)&&(p=i,f=r))}return m}(e,null,s,0,r,o)}(_,0,l,0,u,g));const f=_(c);for(let e=0,t=a;e<t;e++)s[e]=n.snap(d[e],r[e],o[e]);return f}function Ae(e,t,s,n){return e.isZero()?t.isZero()?-1:0:(n.setE(t.clone().negateThis().divThisE(e)),s.containsCoordinate(n.value())?1:0)}function Ne(e,t,s,i,r,o){if(0===e.value())return r?(o[0].set(1),i.containsCoordinate(o[0].value())?1:0):Ae(t,s,i,o[0]);if(r){let t=2;return o[0].set(1),o[1].setE(s).divThisE(e),o[1].eq(o[0])&&(o[1].set(1),t=1),i.containsCoordinate(o[1].value())||(t=1),i.containsCoordinate(o[0].value())||(t--,o[0].setE(o[1])),2===t&&o[0].value()>o[1].value()&&(o[1]=n.swap(o[0],o[0]=o[1])),t}const a=t.clone().sqrThis().subThisE(e.clone().mulThisE(s).mulThisE(n.s_four));if(a.lt(n.s_zero))return 0;const m=new n.ECoordinate(t.value()>=0?1:-1),h=a.clone().sqrtThis(),l=new n.ECoordinate(-.5).mulThisE(t.clone().addThisE(m.clone().mulThisE(h)));let u=0;o[0].setE(l.divE(e));const c=new n.ECoordinate(o[0].value()),g=new n.ECoordinate(e.value()).mulE(c).addE(new n.ECoordinate(t.value()).mulE(c).addE(new n.ECoordinate(s.value())));return g.isZero()||He(o[0],e,t,s,o[0]),i.containsCoordinate(o[0].value())&&u++,0!==h.value()&&0!==l.value()?(o[u].assign(s.divE(l)),c.set(o[u].value()),g.assign(new n.ECoordinate(e.value()).mulE(c).addE(new n.ECoordinate(t.value()).mulE(c).addE(new n.ECoordinate(s.value())))),g.isZero()||He(o[u],e,t,s,o[u]),i.containsCoordinate(o[u].value())&&u++,2===u&&o[0].value()>o[1].value()&&(o[1]=n.swap(o[0],o[0]=o[1])),u):u}function Ge(e,s,i,r,o,a,m){if(0===e.value())return Ne(s,i,r,o,a,m);if(a){let t=1;m[0].set(1);const i=m.slice(t),a=Ne(e,s.addE(e),r.negate(),o,!1,i);if(a>0){t+=a;for(let e=1;e<t;e++)m[e].eq(n.s_one)&&(m[t-1]=n.swap(m[e],m[e]=m[t-1]),t--)}const h=m.slice(0,t);h.sort((e,t)=>e.value()<t.value()?-1:e.value()>t.value()?1:0);for(let e=0;e<t;++e)m[e]=h[e];return t}return function(e,s,i,r,o,a){const m=n.makeObjectArray(n.ECoordinate,3);let h=0;const l=s.negate().divThisE(e.clone().mulThis(3));o.containsCoordinate(l.value())&&(m[0].setE(l),h=1);const u=n.makeObjectArray(n.ECoordinate,2),c=Ne(e.mul(3),s.mul(2),i,o,!1,u);if(c<0)return r.isZero()?-1:0;for(let e=0;e<c;e++)o.containsCoordinate(u[e].value())&&m[h++].setE(u[e]);n.sortRange(m,0,h,(e,t)=>e.value()<t.value()?-1:e.value()>t.value()?1:0);const g=n.makeObjectArray(n.ECoordinate,5);g[0].set(o.vmin);for(let e=0;e<h;e++)g[1+e].setE(m[e]);g[1+h].set(o.vmax);const d=h+2;let p=1,_=0;{const t=g[0].clone();if(e.clone().mulThisE(t).addThisE(s).mulThisE(t).addThisE(i).mulThisE(t).addThisE(r).isZero()){const n=Re(e,s,i,r);t.setError(n.estimateError(t.value())),a[_]=t,_++,p++}}for(let n=p;n<d;n++){const m=g[n].clone(),h=e.clone().mulThisE(m).addThisE(s).mulThisE(m).addThisE(i).mulThisE(m).addThisE(r).isZero();if(h||!g[n].eq(g[n-1])){if(h||qe(g[n-1].value(),g[n].value(),g[n-1].clone().addThisE(g[n]).divThisByPower2(2),e,s,i,r,m)){if(_>0&&m.eq(a[_-1]))continue;if(_>=3&&t.throwInternalErrorException("cubic_polynomial_solver_too_many_roots"),h){const t=Re(e,s,i,r);m.setError(t.estimateError(m.value()))}a[_]=m,_++}if(g[n].value()===o.vmax)break;h&&n++}}return _}(e,s,i,r,o,m)}function Me(e,s,i,r,o,a){return(a<s||s<0)&&t.throwInvalidArgumentException("nth_degree_real_roots"),function(e,t,s,i,r){const o=new ke(e,t,s,n.doubleEps());let a=0;if(2===o.truePower)a=Ne(e[2],e[1],e[0],s,i,r);else if(1===o.truePower)a=Ae(e[1],e[0],s,r[0]);else{if(0===o.truePower)return e[0].value()?0:-1;{const e=[];e.length=t,a=Ce(o,s,t,e);for(let t=0;t<a;t++)r[t].set(e[t])}}for(let e=0;e<a;e++)r[e].setError(o.getError(r[e].value()));return a}(e,s,i,r,o)}function Re(e,t,s,n){return{coef0:e.clone(),coef1:t.clone(),coef2:s.clone(),coef3:n.clone(),calcF(e){return this.coef0.clone().mulThis(e).addThisE(this.coef1).mulThis(e).addThisE(this.coef2).mulThis(e).addThisE(this.coef3)},calcDF(e){return this.coef0.clone().mulThis(3).mulThis(e).addThisE(this.coef1.clone().mulThisByPower2(2)).mulThis(e).addThisE(this.coef2)},estimateError(e){const t=Math.abs(e),s=((this.coef0.eps()*t+this.coef1.eps())*t+this.coef2.eps())*t+this.coef3.eps()+this.calcF(e).eps(),n=this.coef0.clone().mulThis(e).mulThis(3).addThisE(this.coef1.clone().mulThis(2)).mulThis(e).addThisE(this.coef2);if(n.isZero()){const t=this.coef0.clone().mulThis(e).mulThis(6).addThisE(this.coef1.clone().mulThis(2));if(t.isZero()){const e=this.coef0.clone().mulThis(6);return Math.pow(6*s/Math.abs(e.value()),1/3)}return Math.sqrt(2*s/Math.abs(t.value()))}return s/Math.abs(n.value())}}}class ke{updateCoefs(e){if(this.lastDeriv1===e)return this.curCoefs=this.derivCoefs1,void(this.lastUsed=1);if(this.lastDeriv2===e)return this.curCoefs=this.derivCoefs2,void(this.lastUsed=2);let t;1===this.lastUsed?(t=this.derivCoefs2,this.lastDeriv2=e,this.lastUsed=2):(t=this.derivCoefs1,this.lastDeriv1=e,this.lastUsed=1),t.length=0;for(let s=0,n=this.truePower-e;s<=n;++s){t.push(this.coefs[s+e].clone());let n=s+e,i=n--;for(let t=1;t<e;t++)i*=n--;t[s].mulThis(i)}this.curCoefs=t}constructor(e,t,s,n){this.derivCoefs1=[],this.derivCoefs2=[],this.lastDeriv1=-1,this.lastDeriv2=-1,this.lastUsed=-1,this.curCoefs=null,this.coefs=e,this.power=t,this.truePower=0;for(let e=t;e>=1;e--)if(0!==this.coefs[e].value()){this.truePower=e;break}}getMaxDerivative(){return this.truePower+1}getValue(e,t){let s=this.coefs;0===e?s=this.coefs:(this.updateCoefs(e),s=this.curCoefs);const i=new n.KahanSummator(0);let r=1;for(let n=0,o=this.truePower-e;n<=o;++n)i.pe(r*s[n].value()),r*=t;return i.getResult()}getError(e){const t=Math.abs(e),s=new n.KahanSummator(0),i=new n.ECoordinate(1),r=new n.ECoordinate(0);for(let e=0,n=this.power;e<=n;++e)r.addThisE(this.coefs[e].mulE(i)),s.pe(i.value()*this.coefs[e].eps()),i.mulThis(t);s.pe(r.eps());let o=1;for(let t=1;t<=this.truePower;++t){o*=t,this.updateCoefs(t);const i=new n.ECoordinate(1),r=new n.ECoordinate(0);for(let s=0,n=this.truePower-t;s<=n;++s)r.addThisE(this.curCoefs[s].mulE(i)),i.mulThis(e);if(!r.isZero())return Math.pow(o*s.getResult()/Math.abs(r.value()),1/t)}return 0}}function Fe(e,t,s,i,r,o){let a=e,m=t,h=m-a;if(!o){let s=i.calcF(e).value(),r=i.calcF(t).value();if((s>0||s>r)&&(m=n.swap(a,a=m),r=n.swap(s,s=r)),s>=0||r<=0)return!1}let l,u=!1,c=s,g=0;for(;g<100;g++){const e=i.calcF(c);if(l=i.calcDF(c),l.isZero())return!1;if(!e.value()||g>3&&e.isZero()){u=!0;break}o||(e.value()<0?a=c:m=c);const t=e.value()/l.value(),s=c-t;o||(s>=a&&s<=m||s>=m&&s<=a)&&Math.abs(t)<=.5*h?(c=s,h=Math.abs(t)):(h=Math.abs(.5*(m-a)),c=.5*(a+m))}return!!u&&(r.set(c,i.estimateError(c)),!0)}function qe(e,t,s,n,i,r,o,a){return Fe(e,t,s.value(),Re(n,i,r,o),a,!1)}class Ve{constructor(e,t,s){this.coefs=n.makeObjectArray(n.ECoordinate,3),this.coefs[0].setE(e),this.coefs[1].setE(t),this.coefs[2].setE(s)}calcF(e){const t=new n.ECoordinate(e);return this.coefs[0].mulE(t).addE(this.coefs[1]).mulE(t).addE(this.coefs[2])}calcDF(e){const t=new n.ECoordinate(e);return n.ECoordinate.st_mulByPower2(this.coefs[0],2).mulE(t).addE(this.coefs[1])}estimateError(e){const t=Math.abs(e),s=(this.coefs[0].eps()*t+this.coefs[1].eps())*t+this.coefs[2].eps()+this.calcF(e).eps(),i=new n.ECoordinate(2).mulE(this.coefs[0]).mul(e).addE(this.coefs[1]);if(i.isZero()){const e=this.coefs[0].value();return Math.sqrt(s/Math.abs(e))}return s/Math.abs(i.value())}}function He(e,t,s,n,i){return Fe(0,0,e.value(),new Ve(t,s,n),i,!0)}var Oe=s.VertexDescription;class Ye extends U{constructor(e){return void 0===e||n.isOnlyProperty(e,"vd")?(super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new n.Point2D(0,0),void(this.m_weights=[1,0,1])):(e.fromPoint&&e.weight?e={fromPoint:e.fromPoint,controlPoint1:e.controlPoint1,toPoint:e.toPoint,weight0:1,weight1:e.weight,weight2:1}:e.points&&e.weight?e={fromPoint:e.points[0],controlPoint1:e.points[1],toPoint:e.points[2],weight0:1,weight1:e.weight,weight2:1}:e.points&&e.weights&&(e={fromPoint:e.points[0],controlPoint1:e.points[1],toPoint:e.points[2],weight0:e.weights[0],weight1:e.weights[1],weight2:e.weights[2]}),e.fromPoint&&e.weight0?(super({start:e.fromPoint,end:e.toPoint}),(e.weight0<=0||e.weight1<0||e.weight2<=0)&&t.throwInvalidArgumentException("weights"),this.m_cp=e.controlPoint1.clone(),void(this.m_weights=[e.weight0,e.weight1,e.weight2])):e.copy?(super(e),this.m_cp=e.copy.m_cp.clone(),void(this.m_weights=e.copy.m_weights.slice())):e.move?(super(e),this.m_cp=e.move.m_cp.clone(),void(this.m_weights=e.move.m_weights.slice())):void t.throwNotImplementedException("unexpected constructor param"))}getBoundary(){return Ee(this)}assignMove(e){return this}assignCopy(e){return e.copyTo(this),this}construct(e,t,s,n){this.dropAllAttributes(),this.setCpsAndWeights(e,t,s,1,n,1),vn(this)}constructWeights(e,t,s,n,i,r){this.dropAllAttributes(),this.setCpsAndWeights(e,t,s,n,i,r),vn(this)}constructArray(e,t){this.construct(e[0],e[1],e[2],t)}constructArrayWeights(e,t){this.dropAllAttributes(),this.setCpsAndWeightsArray(e,t),vn(this)}convertToStandardForm(){}getStandardFormWeight(){return this.m_weights[1]/Math.sqrt(this.m_weights[0]*this.m_weights[2])}getGeometryType(){return t.GeometryType.enumRationalBezier2}queryEnvelope(e){if(e instanceof i.Envelope2D){if(e.setCoords(this.getStartXY()),e.mergeNe(this.getEndXY()),e.contains(this.m_cp))return;const t=kn(this);if(null!==t){const s=new n.Point2D;for(const n of t.specialPoints)this.queryCoord2D(n,s),e.mergeNe(s)}else{const t=[],s=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(s),Dn(s,this.m_weights,t);const i=new n.Point2D;for(const s of t)this.queryCoord2D(s,i),e.mergeNe(i)}}}applyTransformation(e){if(e instanceof r.Transformation2D){const t=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(t),e.transformPoints2D(t,3,t),this.setStartXY(t[0]),this.m_cp.assign(t[1]),this.setEndXY(t[2]),void this.afterCompletedModification()}}createInstance(){return new Ye({vd:this.m_description})}calculateLength2D(){return bn(this,1,!1)}calculateLowerLength2D(){return n.Point2D.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return this.m_weights[1]>0?n.Point2D.distance(this.getStartXY(),this.m_cp)+n.Point2D.distance(this.getEndXY(),this.m_cp):n.Point2D.distance(this.getStartXY(),this.getEndXY())}queryCoord2D(e,t){return this.queryCoord2DExtension(e,t,!0)}queryCoord2DE(e,t){!function(e,t,s){const i=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(i);const r=[0,0,0];e.queryWeights(r),function(e,t,s,i){if(0===s.value())return void i.setE(e[0]);if(1===s.value())return void i.setE(e[2]);const r=[e[0].x.mulE(t[0]),e[1].x.mulE(t[1]),e[2].x.mulE(t[2])],o=[e[0].y.mulE(t[0]),e[1].y.mulE(t[1]),e[2].y.mulE(t[2])],a=[t[0].clone(),t[1].clone(),t[2].clone()],m=new n.ECoordinate,h=new n.ECoordinate,l=new n.ECoordinate;if(s.value()<=.5){const e=n.lerpLoE(r[0],r[1],s),t=n.lerpLoE(r[1],r[2],s);m.setE(n.lerpLoE(e,t,s));const i=n.lerpLoE(o[0],o[1],s),u=n.lerpLoE(o[1],o[2],s);h.setE(n.lerpLoE(i,u,s));const c=n.lerpLoE(a[0],a[1],s),g=n.lerpLoE(a[1],a[2],s);l.setE(n.lerpLoE(c,g,s))}else{const e=n.lerpHiE(r[0],r[1],s),t=n.lerpHiE(r[1],r[2],s);m.setE(n.lerpHiE(e,t,s));const i=n.lerpHiE(o[0],o[1],s),u=n.lerpHiE(o[1],o[2],s);h.setE(n.lerpHiE(i,u,s));const c=n.lerpHiE(a[0],a[1],s),g=n.lerpHiE(a[1],a[2],s);l.setE(n.lerpHiE(c,g,s))}m.divThisE(l),h.divThisE(l);const u=new n.Point2D(m.value(),h.value());ui([e[0].value(),e[1].value(),e[2].value()],u),i.x.set(u.x,m.eps()),i.y.set(u.y,h.eps())}([y.constructPoint2D(i[0]),y.constructPoint2D(i[1]),y.constructPoint2D(i[2])],[new n.ECoordinate(r[0]),new n.ECoordinate(r[1]),new n.ECoordinate(r[2])],t,s)}(this,e,t)}queryCoord2DExtension(e,t,s){if(s){if(e<0)return void W(new Gr({start:this.getStartXY(),end:this.getStartXY().add(this.getTangent(0).getUnitVector())}),e,t);if(e>1)return void W(new Gr({start:this.getEndXY(),end:this.getEndXY().add(this.getTangent(1).getUnitVector())}),e-1,t)}const i=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(i),ii(i,this.m_weights,e,t)}getCoordX(e){const t=new n.Point2D;return this.queryCoord2DExtension(e,t,!0),t.x}getCoordY(e){const t=new n.Point2D;return this.queryCoord2DExtension(e,t,!0),t.y}cut(e,t,s){const n=new Mr;return this.queryCut(e,t,n,s),n.releaseSegment()}queryCut(e,t,s,n){const i=s.createQuadraticRationalBezier();if(this.cutBezierIgnoreAttributes(e,t,i),n)return;i.assignVertexDescription(this.m_description);const r=this.m_description.getAttributeCount();if(r>1){for(let t=1;t<r;t++){const s=this.m_description.getSemantics(t),n=Oe.getComponentCount(s);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,s,t);i.setStartAttribute(s,t,n)}}for(let e=1;e<r;e++){const s=this.m_description.getSemantics(e),n=Oe.getComponentCount(s);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,s,e);i.setEndAttribute(s,e,n)}}}}queryDerivative(e,s){!function(e,s,i){const r=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(r);const o=n.makePrimitiveArray(3,Number.NaN);e.queryWeights(o),function(e,s,i,r){i.value()<0&&i.set(0,i.eps()),i.value()>1&&i.set(1,i.eps());const o=n.makeObjectArray(y,4);(function(e,s,i,r,o){const a=[y.constructPoint2D(e[0]),y.constructPoint2D(e[1]),y.constructPoint2D(e[2])];a[2].subThisE(a[0]),a[1].subThisE(a[0]),a[0].setCoords(0,0),function(e,s,i,r,o){t.geometryReleaseAssert(!0);const a=[e[0].clone(),e[1].clone(),e[2].clone()];if(!a[0].isZero()){for(let e=1;e<3;++e)a[e].subThisE(a[0]);a[0]=y.constructCoords(0,0)}const m=Tn(a,s,0,r),h=function(e,t,s){if(s.toDouble()<=.5){const t=n.lerpLoE(e[0],e[1],s),i=n.lerpLoE(e[1],e[2],s);return n.lerpLoE(t,i,s)}{const t=n.lerpHiE(e[0],e[1],s),i=n.lerpHiE(e[1],e[2],s);return n.lerpHiE(t,i,s)}}(s,0,r),l=m.divE(h);o[0].setE(l);const u=[s[1].mulE(s[0]),s[2].mulE(s[0]).mul(.5),s[1].mulE(s[2])],c=Tn([e[1].subE(e[0]),e[2].subE(e[0]),e[2].subE(e[1])],u,0,r).mul(2),g=h.sqr(),d=c.divE(g);o[1].setE(d)}(a,[new n.ECoordinate(s[0]),new n.ECoordinate(s[1]),new n.ECoordinate(s[2])],0,r,o)})(e,s,0,i,o),r.setE(o[1])}(r,o,s,i)}(this,e,s)}cutBezierIgnoreAttributes(e,s,i){(e<0||s>1||e>s)&&t.throwInvalidArgumentException("Quadratic_rational_bezier.cut_bezier_ignore_attributes");const r=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(r);const o=[0,0,0];zn(r,this.m_weights,e,s,r,o),i.setControlPointsAndWeights(r,o)}splitBezierIgnoreAttributes(e,t,s){}getAttributeAsDbl(e,t,s){if(0===t)return 0===s?this.getCoordX(e):this.getCoordY(e);const i=this.calculateLength2D(),r=i>0?this.tToLength(e)/i:0,o=Oe.getInterpolation(t),a=this.getStartAttributeAsDbl(t,s),m=this.getEndAttributeAsDbl(t,s);return n.interpolate(o,a,m,r,Oe.getDefaultValue(t))}getClosestCoordinate(e,t){return qn(this,e,n.Envelope1D.unit(),t,-1)}getClosestCoordinateOnInterval(e,t,s=-1){return qn(this,e,0,!1,s)}getYMonotonicParts(e,t){return this.getMonotonicParts(e,t)}getMonotonicParts(e,s){e.length<2&&t.throwInvalidArgumentException("");const n=Cn(this);let i=0;if(2===n.specialPointsCount())return 0;t.geometryReleaseAssert(e.length>=n.specialPointsCount()-1);for(let t=1,r=n.specialPointsCount();t<r;++t)this.queryCut(n.specialPoints[t-1],n.specialPoints[t],e[i],s),i++;for(let t=0;t<i;++t)Xn(e[t].get());return i}intersectionWithAxis2D(e,t,s,i){s&&(s.length=9),i&&(i.length=9);const r=new Array(3),o=n.makeObjectArray(n.ECoordinate,2),a=new n.Envelope1D(0,1);let m=0;const h=n.makeObjectArray(n.Point2D,3);if(this.queryControlPoints(h),e){if(r[0]=new n.ECoordinate(h[0].y).sub(t).mul(this.m_weights[0]),r[1]=new n.ECoordinate(h[1].y).sub(t).mul(this.m_weights[1]),r[2]=r[0].subE(r[1].mul(2)).addE(new n.ECoordinate(h[2].y).sub(t).mul(this.m_weights[2])),r[1]=r[1].subE(r[0]).mulThisByPower2(2),m=Ne(r[2],r[1],r[0],a,!1,o),s)for(let e=0;e<m;e++)s[e]=this.getCoordX(o[e].value())}else if(r[0]=new n.ECoordinate(h[0].x).sub(t).mul(this.m_weights[0]),r[1]=new n.ECoordinate(h[1].x).sub(t).mul(this.m_weights[1]),r[2]=r[0].subE(r[1].mul(2)).addE(new n.ECoordinate(h[2].x).sub(t).mul(this.m_weights[2])),r[1]=r[1].subE(r[0]).mulThisByPower2(2),m=Ne(r[2],r[1],r[0],a,!1,o),s)for(let e=0;e<m;e++)s[e]=this.getCoordY(o[e].value());if(i)for(let e=0;e<m;e++)i[e]=o[e].value();else s&&n.sortRange(s,0,m,n.standardNumericCompare);return m}intersectionOfYMonotonicWithAxisX(e,s){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?s:Number.NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;const n=[Number.NaN,Number.NaN],i=this.intersectionWithAxis2D(!0,e,n,null);return t.geometryReleaseAssert(2!==i),-1===i?s:n[0]}isCurve(){return!0}isDegenerate(e){return D(this,e)}isDegenerate3D(e,t){return!1}queryLooseEnvelope(e){if(e instanceof i.Envelope2D)return e.setCoords({pt:this.getStartXY()}),e.mergeNe(this.m_cp),void e.mergeNe(this.getEndXY())}clone(e){const t=this.createInstance();return this.copyTo(t),t}queryInterval(e,t){if(0===e){const e=i.Envelope2D.constructEmpty();this.queryEnvelope(e);const s=n.Envelope1D.constructEmpty();return 0===t?e.queryIntervalX(s):e.queryIntervalY(s),s}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){const s=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(s),zn(s,this.m_weights,e.vmin,e.vmax,s,[0,0,0]),t.setFromPoints(s,3)}changeEndPoints2D(e,t){if(e.isEqual(this.m_XStart,this.m_YStart)&&t.isEqual(this.m_XEnd,this.m_YEnd))return;const s=this.m_cp.isEqual(this.m_XStart,this.m_YStart),n=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(e),this.setEndXY(t),s?this.m_cp.setCoordsPoint2D(e):n&&this.m_cp.setCoordsPoint2D(t),this.normalizeAfterEndpointChange()}tToLength(e){return bn(this,e,!0)}lengthToT(e){const s=function(e,s){const i=bn(e,1,!1);if(s<=0)return s;if(s>=i)return s-i+1;const r=[0];return 1!==Ce(new Gn(e,s),n.Envelope1D.unit(),1,r)&&t.throwInternalErrorException(""),r[0]}(this,e);return s}calculateWeightedAreaCentroid2D(e){const s=function(e){const s=n.makeObjectArray(n.Point2D,3),i=[0,0,0];return e.queryControlPoints(s),e.queryWeights(i),function(e,s){const i=oi(s);if(1===i){const t=n.makeObjectArray(n.Point2D,3);Xt(e,t);const s=t[2].clone(),i=t[1].clone(),r=new n.Point2D,o=s.y*i.x-s.x*i.y;return r.x=-(4*s.x+5*i.x)*o/60,r.y=-(4*s.y+5*i.y)*o/60,r}if(0===i)return new n.Point2D(0,0);t.geometryReleaseAssert(i>0);const r=e[1].sub(e[0]),o=e[2].sub(e[0]);if(i<1){const e=Math.sqrt(1-i),t=Math.sqrt(1+i),s=(r.y*o.x-r.x*o.y)*i/Math.pow(e*t,5)/12,n=Math.atan2(e,t),a=i*e*t,m=i*i,h=r.mul(2*(2+m)),l=o.mul(2*m-5),u=h.add(l).mul(a),c=o.sub(r.mul(2*m)).mul(6*n);return u.add(c).mul(s)}{const e=Math.sqrt(i-1),t=Math.sqrt(i+1),s=(r.y*o.x-r.x*o.y)*i/Math.pow(e*t,5)/12,n=Math.atanh(e/t),a=i*e*t,m=i*i,h=r.mul(4).sub(o.mul(5)),l=r.add(o).mul(2*m),u=h.add(l).mul(a),c=o.sub(r.mul(2*m)).mul(6*n);return u.add(c).mul(s)}}(s,i)}(this),i=Mn(this);return s.x+=(this.getStartX()-e.x)*i,s.y+=(this.getStartY()-e.y)*i,s}calculateWeightedCentroid2D(){const e=new n.Point2D;return this.isDegenerate(0)?(e.setCoords(0,0),e):function(e){if(0===e.m_weights[1])return!0;const t=n.Point2D.distance(e.getStartXY(),e.getEndXY()),s=e.calculateUpperLength2D();return s-t<=8*Number.EPSILON*s}(this)?(e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e):(e.assign(function(e,s,i){void 0===i&&(i=s,s=0);const r=new n.Point2D;if(s<0||i>1)return r.setNAN(),r;if(s>i&&t.throwInvalidArgumentException("calculate_sub_weighted_centroid"),s===i||e.isDegenerate(0))return r.setCoords(0,0),r;const o=Cn(e),a=Rn(e),m=a/e.calculateUpperLength2D();let h=s,l=0;for(let e=1,t=o.specialPointsCount();e<t;e++)if(s<o.specialPoints[e]){l=e-1;break}r.setCoords(0,0);for(let t=l+1,s=o.specialPointsCount();t<s;t++){const s=Math.min(o.specialPoints[t],i),n=En(e,h,s,m,a);if(r.addThis(n),h=s,i<=o.specialPoints[t])break}return r.add(e.getStartXY().mul(e.calculateLength2D()))}(this,1)),e)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(e){this.m_cp.setCoordsPoint2D(e),this.afterCompletedModification()}queryWeights(e){for(let t=0;t<3;++t)e[t]=this.m_weights[t]}queryCoord2DMP(e,t){const s=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(s),function(e,t,s,i){const r=s.lte(n.s_half)?n.MPValue.lerpLo:n.MPValue.lerpHi,[o,a,m]=[t.map((t,s)=>e[s].x.mul(t)),t.map((t,s)=>e[s].y.mul(t)),t].map(([e,t,n])=>r(r(e,t,s),r(t,n,s),s)),h=new n.Point2D(o.divThis(m).value(),a.divThis(m).value());ui(e.map(e=>e.asPoint2D()),h),i.x=n.MPValue.constructDouble(h.x),i.y=n.MPValue.constructDouble(h.y)}(s.map(e=>P.constructPoint2D(e)),this.m_weights.map(e=>n.MPValue.constructDouble(e)),n.MPValue.constructDouble(e),t)}setWeights(e){}queryControlPoints(e){e[0].assign(this.getStartXY()),e[1].assign(this.m_cp),e[2].assign(this.getEndXY())}queryControlPointsHelper(e){return this.queryControlPoints(e),3}setControlPointsAndWeights(e,t){this.setCpsAndWeightsArray(e,t),this.afterCompletedModification()}getTangent(e){const t=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(t),Nn(t,this.m_weights,e)}getDerivative(e){const t=n.snap(e,0,1),s=n.makeObjectArray(n.Point2D,4);return Sn(this,1,t,s),s[1]}getCurvature(e){const t=n.makeObjectArray(n.Point2D,4);Sn(this,2,e,t);const s=t[1].sqrLength();return 0===s?Number.NaN:(t[1].divThis(Math.sqrt(s)),t[1].crossProduct(t[2])/s)}isIntersecting(e,t,s){return!1}isIntersectingPoint(e,t,s){return!1}isIntersectingPoint3D(e,t,s,n,i=1){return!1}isMonotoneQuickAndDirty(){const e=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(e),Yn(e)}getMonotonicPartParams(e,s){const n=Cn(this),i=n.specialPointsCount();if(!s)return n.specialPointsCount();e<i&&t.throwInvalidArgumentException("");for(let e=0;e<i;e++)s[e]=n.specialPoints[e];return i}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=n.swap(this.m_YStart,this.m_YStart=this.m_YEnd),this.m_weights[2]=n.swap(this.m_weights[0],this.m_weights[0]=this.m_weights[2]);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=n.swap(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_cachedValues=null}}isLine(){return!1}isDegenerateToLineHelper(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const s=t[2].sub(t[0]),i=s.length();if(n.Point2D.distance(t[0],t[1])+n.Point2D.distance(t[2],t[1])-i>e)return!1;const r=e,o=t[1].clone();return o.subThis(t[0]),!(Math.abs(o.crossProduct(s))/i>r)}copyIgnoreAttributes(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const s=[0,0,0];this.queryWeights(s),e.setControlPointsAndWeights(t,s)}calculateArea2DHelper(){return Mn(this)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)+this.m_cp.norm(1)}absNormXYZ(e){return t.geometryReleaseAssert(0),0}queryEnvelopeW(e,t){Hn(this,e,t)}setSegmentFromCoordsForStitcher(e,t){const s=[0,0,0];this.queryWeights(s),this.constructWeights(e[0],this.getControlPoint1(),e[t-1],s[0],s[1],s[2])}writeInBufferStream(e,t){const s=new Float64Array(5);return s[0]=this.m_cp.x,s[1]=this.m_cp.y,s[2]=this.m_weights[0],s[3]=this.m_weights[1],s[4]=this.m_weights[2],e.writeRangeFromArray(t,s.length,s,!0,1),t+s.length}readFromBufferStream(e,t){const s=new Float64Array(5);e.queryRange(t,s.length,s,!0,1),this.m_cp.x=s[0],this.m_cp.y=s[1],this.m_weights[0]=s[2],this.m_weights[1]=s[3],this.m_weights[2]=s[4],this.m_cachedValues=null}snapControlPoints(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const s=n.Point2D.sqrDistance(t[1],t[0]),i=n.Point2D.sqrDistance(t[1],t[2]);let r=t[0].clone(),o=s;s>i&&(r=t[2].clone(),o=i);let a=!1;return o<=e&&0!==o&&(a=!0,this.setControlPoint1(r)),a}needsSnapControlPoints(e){if(!e)return!1;const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const s=n.Point2D.sqrDistance(t[1],t[0]),i=n.Point2D.sqrDistance(t[1],t[2]);t[0].clone();let r=s;return s>i&&(t[2].clone(),r=i),r<=e&&0!==r}calculateSpecialPointsForCracking(e,t){return 0}ensureXYMonotone(){return Xn(this)}setCoordsForIntersector(e,t,s){!function(e,t,s,i){if(t.isEqual(e.m_XStart,e.m_YStart)&&s.isEqual(e.m_XEnd,e.m_YEnd))return;const o=!!i&&e.isMonotoneQuickAndDirty(),a=new r.Transformation2D,m=n.makeObjectArray(n.Point2D,3);m[0].setCoords(e.m_XStart,e.m_YStart),m[2].setCoords(e.m_XEnd,e.m_YEnd);const h=new n.Point2D;h.setSub(m[2],m[0]),h.leftPerpendicularThis(),m[1].setAdd(m[0],h);const l=n.makeObjectArray(n.Point2D,3);l[0].setCoordsPoint2D(t),l[2].setCoordsPoint2D(s),h.setSub(l[2],l[0]),h.leftPerpendicularThis(),l[1].setAdd(l[0],h),a.setFromTwoTriangles(m,l)?a.transformInPlace(e.m_cp):n.lerpPoint2D(t,s,.5,e.m_cp),e.changeEndPoints2D(t,s),o&&Xn(e)}(this,e,t,s)}copyToImpl(e){const t=e;t.m_cp.setCoordsPoint2D(this.m_cp),t.m_weights[0]=this.m_weights[0],t.m_weights[1]=this.m_weights[1],t.m_weights[2]=this.m_weights[2],Fn(t,kn(this))}reverseImpl(){this.m_weights[2]=n.swap(this.m_weights[0],this.m_weights[0]=this.m_weights[2])}equalsImpl(e){const t=e;if(!this.m_cp.equals(t.m_cp))return!1;for(let e=0;e<3;e++)if(this.m_weights[e]!==t.m_weights[e])return!1;return!0}equalsImplTol(e,t){const i=e;if(!this.m_cp.isEqualPoint2D(i.m_cp,t))return!1;const r=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(r);const o=n.makeObjectArray(n.Point2D,3);i.queryControlPoints(o);const a=[i.m_weights[0],i.m_weights[1],i.m_weights[2]];for(let e=0;e<3;e++){const n=new s.Point3D;n.setCoordsPoint2DZ(r[e].mul(this.m_weights[e]),this.m_weights[e]);const i=new s.Point3D;if(i.setCoordsPoint2DZ(o[e].mul(a[e]),a[e]),!n.isEqual(i,t))return!1}return!0}swapImpl(e){const t=e;var s;t.m_cp=n.swap(this.m_cp,this.m_cp=t.m_cp),t.m_weights=n.swap(this.m_weights,this.m_weights=t.m_weights),(s=t).m_cachedValues=n.swap(this.m_cachedValues,this.m_cachedValues=s.m_cachedValues)}afterCompletedModification(){vn(this)}intersect(e,t,s,n,i){return Ir(!1,this,e,t,s,n,i)}intersectPoint(e,s,i){return function(e,s,i,r){const o=new d;if(Hn(e,n.Envelope1D.unit(),o),o.inflate(r),!o.isIntersectingPoint2D(s))return 0;const a=Cn(e);let m=0;const h=[];let l=a.specialPoints[0];for(let n=1,i=a.specialPoints.length;n<i;++n){const i=a.specialPoints[n],r=Pn(e,s,l,i);if(0===h.length)h.push(r);else if(r.t===r.tmin)t.geometryReleaseAssert(h.at(-1).d<=r.d),h.at(-1).tmax=r.tmax;else if(h.at(-1).t===h.at(-1).tmax){t.geometryReleaseAssert(h.at(-1).d>=r.d);const e=h.at(-1).tmin;h[h.length-1]=r,h.at(-1).tmin=e}else h.push(r);l=i}for(const e of h)if(e.d<=r){const t=e.t;i?(i[m]=t,m++):m++}return m}(this,e,s,i)}endPointModified(){vn(this)}clearEndPointModified(){}setCpsAndWeights(e,s,n,i,r,o){(i<=0||o<=0||r<0)&&t.throwInvalidArgumentException("weights"),(e.isNAN()||s.isNAN()||n.isNAN())&&t.throwInvalidArgumentException("NAN control points in bezier are not supported"),this.setStartXY(e),this.m_cp.assign(s),this.m_weights[0]=i,this.m_weights[1]=r,this.m_weights[2]=o,this.setEndXY(n)}setCpsAndWeightsArray(e,t){this.setCpsAndWeights(e[0],e[1],e[2],t[0],t[1],t[2])}}Ye.type=t.GeometryType.enumRationalBezier2;var Xe=s.VertexDescription;class Le extends U{constructor(e){void 0===e||n.isOnlyProperty(e,"vd")?(super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=new n.Point2D(0,0)):e.from?(super({XStart:e.from.x,YStart:e.from.y,XEnd:e.to.x,YEnd:e.to.y,...e.vd}),this.m_cp=e.cp.clone()):e.points?(super({XStart:e.points[0].x,YStart:e.points[0].y,XEnd:e.points[2].x,YEnd:e.points[2].y,...e.vd}),this.m_cp=e.points[1].clone()):e.copy?(super(e),this.m_cp=e.copy.m_cp.clone()):t.throwInternalErrorException("unexpected constructor args")}getBoundary(){return Ee(this)}assignCopy(e){return this!==e&&e.copyTo(this),this}construct(e,t,s){this.setStartXY(e),this.m_cp.assign(t),this.setEndXY(s),_t(this)}constructPoints(e){this.setStartXY(e[0]),this.m_cp.assign(e[1]),this.setEndXY(e[2]),_t(this)}getGeometryType(){return t.GeometryType.enumBezier2}queryEnvelope(e){if(2===e.m_EnvelopeType){if(e.setCoords(this.getStartXY()),e.mergeNe(this.getEndXY()),e.contains(this.m_cp))return;const t=It(this);if(null!==t){const s=new n.Point2D;for(const n of t.specialPoints)this.queryCoord2D(n,s),e.mergeNe(s)}else{const t=[];yt(this,t);const s=new n.Point2D;for(const n of t)this.queryCoord2D(n,s),e.mergeNe(s)}return}t.throwNotImplementedException("env type not impl")}applyTransformation(e){if(1===e.m_TransformationType){const t=n.makeObjectArray(n.Point2D,3);return this.queryControlPoints(t),e.transformPoints2D(t,3,t),this.setStartXY(t[0]),this.m_cp.assign(t[1]),this.setEndXY(t[2]),void this.afterCompletedModification()}t.geometryReleaseAssert(0)}createInstance(){return new Le({vd:this.m_description})}calculateLength2D(){return xt(this,1,!1)}calculateLowerLength2D(){return n.Point2D.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return this.calculateUpperLength2D_()}calculateUpperLength2D_(){return n.Point2D.distance(this.getStartXY(),this.m_cp)+n.Point2D.distance(this.getEndXY(),this.m_cp)}queryCoord2D(e,t){this.queryCoord2DExtended(e,t,!1)}queryCoord2DExtended(e,t,s){const i=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(i),Bt(i,e,t,s)}queryCoord2DE(e,t){!function(e,t,s){const i=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(i),function(e,t,s){if(t.value()<=.5){const i=y.constructPoint2D(e[1]),r=new y;n.lerpLoPointE(2,y.constructPoint2D(e[0]),i,t,r);const o=new y;n.lerpLoPointE(2,i,y.constructPoint2D(e[2]),t,o);const a=new y;n.lerpLoPointE(2,r,o,t,a),s.setE(a)}else{const i=y.constructPoint2D(e[1]),r=new y;n.lerpHiPointE(2,y.constructPoint2D(e[0]),i,t,r);const o=new y;n.lerpHiPointE(2,i,y.constructPoint2D(e[2]),t,o);const a=new y;n.lerpHiPointE(2,r,o,t,a),s.setE(a)}}(i,t,s)}(this,e,t)}queryCoord2DMP(e,s){t.geometryReleaseAssert(!1,"bernstein polynomials not ported")}getCoordX(e){if(e<0||e>1){const t=new n.Point2D;return this.queryCoord2DExtended(e,t,!0),t.x}if(e<=.5){const t=n.lerpLo(this.getStartX(),this.m_cp.x,e),s=n.lerpLo(this.m_cp.x,this.getEndX(),e);return n.lerpLo(t,s,e)}{const t=n.lerpHi(this.getStartX(),this.m_cp.x,e),s=n.lerpHi(this.m_cp.x,this.getEndX(),e);return n.lerpHi(t,s,e)}}getCoordY(e){if(e<0||e>1){const t=new n.Point2D;return this.queryCoord2DExtended(e,t,!0),t.y}if(e<=.5){const t=n.lerpLo(this.getStartX(),this.m_cp.x,e),s=n.lerpLo(this.m_cp.x,this.getEndX(),e);return n.lerpLo(t,s,e)}{const t=n.lerpHi(this.getStartY(),this.m_cp.y,e),s=n.lerpHi(this.m_cp.y,this.getEndY(),e);return n.lerpHi(t,s,e)}}cut(e,t,s){const n=new Mr;return this.queryCut(e,t,n,s),n.releaseSegment()}queryCut(e,t,s,n){const i=s.createQuadraticBezier();if(this.cutBezierIgnoreAttributes(e,t,i),n)return;i.assignVertexDescription(this.m_description);const r=this.m_description.getAttributeCount();if(r>1){for(let t=1;t<r;t++){const s=this.m_description.getSemantics(t),n=Xe.getComponentCount(s);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,s,t);i.setStartAttribute(s,t,n)}}for(let e=1;e<r;e++){const s=this.m_description.getSemantics(e),n=Xe.getComponentCount(s);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,s,e);i.setEndAttribute(s,e,n)}}}}queryDerivative(e,t){!function(e,t,s){const i=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(i),function(e,t,s){t.value()<0&&t.set(0,t.eps()),t.value()>1&&t.set(1,t.eps()),s.setE(function(e,t,s){{const t=y.constructPoint2D(e[1]).subE(y.constructPoint2D(e[0])),i=new n.ECoordinate(1).subE(s),r=y.constructPoint2D(e[2]).subE(y.constructPoint2D(e[1])),o=t.mulE(i).addE(r.mulE(s));return o.mulThisE(new n.ECoordinate(2)),o}}(e,0,t))}(i,t,s)}(this,e,t)}cutBezierIgnoreAttributes(e,s,i){if((e<0||s>1||e>s)&&t.throwInvalidArgumentException("Quadratic_bezier.cut_bezier_ignore_attributes"),0===e&&1===s)return i.setStartXY(this.getStartXY()),i.m_cp.assign(this.m_cp),void i.setEndXY(this.getEndXY());const r=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(r),Ft(r,e,s,r),i.constructPoints(r)}splitBezierIgnoreAttributes(e,s,n){t.geometryReleaseAssert(0)}getAttributeAsDbl(e,t,s){if(0===t)return 0===s?this.getCoordX(e):this.getCoordY(e);const i=this.calculateLength2D(),r=i>0?this.tToLength(e)/i:0,o=Xe.getInterpolation(t),a=this.getStartAttributeAsDbl(t,s),m=this.getEndAttributeAsDbl(t,s);return n.interpolate(o,a,m,r,Xe.getDefaultValue(t))}getClosestCoordinate(e,t){return Tt(this,e,n.Envelope1D.unit(),t)}getClosestCoordinateOnInterval(e,t,s=-1){return Tt(this,e,t,!1)}getYMonotonicParts(e,t){return this.getMonotonicParts(e,t)}getMonotonicParts(e,s){e.length<2&&t.throwInvalidArgumentException("");const n=ft(this);let i=0;if(2===n.specialPointsCount())return 0;t.geometryReleaseAssert(e.length>=n.specialPointsCount()-1);for(let t=1,r=n.specialPointsCount();t<r;++t)this.queryCut(n.specialPoints[t-1],n.specialPoints[t],e[i],s),i++;for(let t=0;t<i;++t)Mt(e[t].get());return i}intersectionWithAxis2D(e,t,s,i){const r=n.makeObjectArray(n.ECoordinate,3),o=n.makeObjectArray(n.ECoordinate,2),a=new n.Envelope1D(0,1);let m=0;if(e){if(r[0]=new n.ECoordinate(this.getStartY()).sub(t),r[1]=new n.ECoordinate(this.m_cp.y).subE(new n.ECoordinate(this.getStartY())).mulThisByPower2(2),r[2]=new n.ECoordinate(this.getStartY()).add(this.getEndY()).subE(new n.ECoordinate(this.m_cp.y).mulThisByPower2(2)),m=Ne(r[2],r[1],r[0],a,!1,o),s)for(let e=0;e<m;e++)s[e]=this.getCoordX(o[e].value())}else if(r[0]=new n.ECoordinate(this.getStartX()).sub(t),r[1]=new n.ECoordinate(this.m_cp.x).subE(new n.ECoordinate(this.getStartX())).mulThisByPower2(2),r[2]=new n.ECoordinate(this.getStartX()).add(this.getEndX()).subE(new n.ECoordinate(this.m_cp.x).mulThisByPower2(2)),m=Ne(r[2],r[1],r[0],a,!1,o),s)for(let e=0;e<m;e++)s[e]=this.getCoordY(o[e].value());if(i)for(let e=0;e<m;e++)i[e]=o[e].value();else s&&n.numericSortRange(s,m);return m}intersectionOfYMonotonicWithAxisX(e,s){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?s:Number.NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;const n=[0,0],i=this.intersectionWithAxis2D(!0,e,n,null);return t.geometryReleaseAssert(2!==i),-1===i?s:n[0]}isCurve(){return!0}isLine(){return!1}isDegenerate(e){return D(this,e)}isDegenerate3D(e,s){return t.geometryReleaseAssert(0),!1}queryLooseEnvelope(e){if(2===e.m_EnvelopeType)return e.setCoords(this.getStartXY()),e.mergeNe(this.m_cp),void e.mergeNe(this.getEndXY());t.geometryReleaseAssert(0)}clone(e){const t=this.createInstance();return this.copyTo(t),t}queryInterval(e,t){if(0===e){const e=new i.Envelope2D;this.queryEnvelope(e);const s=new n.Envelope1D;return 0===t?e.queryIntervalX(s):e.queryIntervalY(s),s}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){const s=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(s),Ft(s,e.vmin,e.vmax,s),t.setFromPoints(s,4)}changeEndPoints2D(e,t){if(e.isEqual(this.m_XStart,this.m_YStart)&&t.isEqual(this.m_XEnd,this.m_YEnd))return;const s=this.m_cp.isEqual(this.m_XStart,this.m_YStart),n=this.m_cp.isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(e),this.setEndXY(t),s?this.m_cp.setCoordsPoint2D(e):n&&this.m_cp.setCoordsPoint2D(t),this.normalizeAfterEndpointChange()}tToLength(e){return xt(this,e,!0)}lengthToT(e){const s=function(e,s){const i=xt(e,1,!1);if(s<=0)return s;if(s>=i)return s-i+1;const r=[0];return 1!==Ce(new dt(e,s),n.Envelope1D.unit(),1,r)&&t.throwInternalErrorException(""),r[0]}(this,e);return s}calculateWeightedAreaCentroid2D(e){const t=n.makeObjectArray(n.Point2D,3);!function(e,t,s=!1){const i=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(i),Xt(i,t,s)}(this,t);const s=t[2],i=t[1],r=new n.Point2D,o=s.y*i.x-s.x*i.y;r.x=-(4*s.x+5*i.x)*o/60,r.y=-(4*s.y+5*i.y)*o/60;const a=bt(this);return r.x+=(t[0].x-e.x)*a,r.y+=(t[0].y-e.y)*a,r}calculateWeightedCentroid2D(){const e=new n.Point2D;return this.isDegenerate(0)?(e.setCoords(0,0),e):function(e){const t=n.Point2D.distance(e.getStartXY(),e.getEndXY()),s=e.calculateUpperLength2D();return s-t<=8*Number.EPSILON*s}(this)?(e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e):(e.assign(function(e,s,i){void 0===i&&(i=s,s=0);const r=new n.Point2D;if(s<0||i>1)return r.setNAN(),r;if(s>i&&t.throwInvalidArgumentException("calculate_sub_weighted_centroid"),s===i||e.isDegenerate(0))return r.setCoords(0,0),r;const o=ft(e),a=V(e),m=Math.min(a/e.calculateUpperLength2D(),1e-7);let h=s,l=0;for(let e=1,t=o.specialPointsCount();e<t;e++)if(s<o.specialPoints[e]){l=e-1;break}r.setCoords(0,0);for(let t=l+1,s=o.specialPointsCount();t<s;t++){const s=Math.min(o.specialPoints[t],i),n=pt(e,h,s,m,a);if(r.addThis(n),h=s,i<=o.specialPoints[t])break}return r.add(e.getStartXY().mul(e.calculateLength2D()))}(this,1)),e)}getControlPoint1(){return this.m_cp.clone()}setControlPoint1(e){this.m_cp.setCoordsPoint2D(e),this.afterCompletedModification()}queryControlPoints(e){e[0].assign(this.getStartXY()),e[1].assign(this.m_cp),e[2].assign(this.getEndXY())}queryControlPointsHelper(e){return this.queryControlPoints(e),3}setControlPoints(e){for(let s=0;s<3;s++)e[s].isNAN()&&t.throwInvalidArgumentException("NaN control points in bezier are not supported");this.m_XStart=e[0].x,this.m_YStart=e[0].y,this.m_cp.setCoordsPoint2D(e[1]),this.m_XEnd=e[2].x,this.m_YEnd=e[2].y,this.afterCompletedModification()}getTangent(e){const t=n.snap(e,0,1);let s=Ct(this,1,t);return s.isZero()&&(s=Ct(this,2,t),1===t&&s.negateThis()),s}getDerivative(e){return Ct(this,1,n.snap(e,0,1))}getCurvature(e){const t=Ct(this,1,e),s=Ct(this,2,e),n=t.sqrLength();return 0===n?Number.NaN:(t.divThis(Math.sqrt(n)),t.crossProduct(s)/n)}isIntersecting(e,t,s){return 0!==Cr(!1,this,e,t,s)}isIntersectingPoint(e,t,s){if(s&&(e.isEqualPoint2D(this.getStartXY())||e.isEqualPoint2D(this.getEndXY())))return!1;const r=new i.Envelope2D;if(this.queryLooseEnvelope(r),r.inflateCoords(t,t),!r.contains(e))return!1;const o=this.getClosestCoordinate(e,!1),a=new n.Point2D;return this.queryCoord2D(o,a),n.Point2D.distance(a,e)<=t}isIntersectingPoint3D(e,s,n,i,r=1){return t.geometryReleaseAssert(0),!1}isMonotoneQuickAndDirty(){return!1}getMonotonicPartParams(e,s){const n=ft(this),i=n.specialPointsCount();if(!s)return n.specialPointsCount();e<i&&t.throwInvalidArgumentException("");for(let e=0;e<i;e++)s[e]=n.specialPoints[e];return i}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),n.swap(this.m_YStart,this.m_YStart=this.m_YEnd);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=n.swap(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_cachedValues=null}}isDegenerateToLineHelper(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t);const s=t[2].sub(t[0]),i=s.length();if(n.Point2D.distance(t[0],t[1])+n.Point2D.distance(t[2],t[1])-i>e)return!1;const r=e,o=t[1].clone();return o.subThis(t[0]),!(Math.abs(o.crossProduct(s))/i>r)}copyIgnoreAttributes(e){const t=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(t),e.setControlPoints(t)}calculateArea2DHelper(){return bt(this)}absNorm(){return(e=this).getStartXY().norm(1)+e.getEndXY().norm(1)+e.m_cp.norm(1);var e}queryEnvelopeW(e,t){const s=n.makeObjectArray(n.Point2D,3);this.queryControlPoints(s),Nt(s,e,t)}setSegmentFromCoordsForStitcher(e,t){this.construct(e[0],this.getControlPoint1(),e[t-1])}snapControlPoints(e){return function(e,t){const s=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(s);const i=n.Point2D.sqrDistance(s[1],s[0]),r=n.Point2D.sqrDistance(s[1],s[2]);let o=s[0].clone(),a=i;i>r&&(o=s[2].clone(),a=r);let m=!1;return a<=t&&0!==a&&(m=!0,e.setControlPoint1(o)),m}(this,e)}writeInBufferStream(e,t){const s=new Float64Array(2);return s[0]=this.m_cp.x,s[1]=this.m_cp.y,e.writeRangeFromArray(t,s.length,s,!0,1),t+s.length}readFromBufferStream(e,t){const s=new Float64Array(2);e.queryRange(t,s.length,s,!0,1),this.m_cp.x=s[0],this.m_cp.y=s[1],this.m_cachedValues=null}needsSnapControlPoints(e){return function(e,t){if(!t)return!1;const s=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(s);const i=n.Point2D.sqrDistance(s[1],s[0]),r=n.Point2D.sqrDistance(s[1],s[2]);s[0].clone();let o=i;return i>r&&(s[2].clone(),o=r),o<=t&&0!==o}(this,e)}calculateSpecialPointsForCracking(e,t){return 0}ensureXYMonotone(){return Mt(this)}setCoordsForIntersector(e,t,s){!function(e,t,s,i){if(t.isEqual(e.m_XStart,e.m_YStart)&&s.isEqual(e.m_XEnd,e.m_YEnd))return;const o=!!i&&e.isMonotoneQuickAndDirty(),a=new r.Transformation2D,m=n.makeObjectArray(n.Point2D,3);m[0].setCoords(e.m_XStart,e.m_YStart),m[2].setCoords(e.m_XEnd,e.m_YEnd);const h=new n.Point2D;h.setSub(m[2],m[0]),h.leftPerpendicularThis(),m[1].setAdd(m[0],h);const l=n.makeObjectArray(n.Point2D,3);l[0].setCoordsPoint2D(t),l[2].setCoordsPoint2D(s),h.setSub(l[2],l[0]),h.leftPerpendicularThis(),l[1].setAdd(l[0],h),a.setFromTwoTriangles(m,l)?a.transformInPlace(e.m_cp):n.lerpPoint2D(t,s,.5,e.m_cp),e.changeEndPoints2D(t,s),o&&Mt(e)}(this,e,t,s)}copyToImpl(e){const t=e;t.m_cp.setCoordsPoint2D(this.m_cp),wt(t,It(this))}reverseImpl(){}equalsImplTol(e,t){const s=e;return!!this.m_cp.isEqualPoint2D(s.m_cp,t)}equalsImpl(e){const t=e;return!!this.m_cp.equals(t.m_cp)}swapImpl(e){const t=e;var s;t.m_cp=n.swap(this.m_cp,this.m_cp=t.m_cp),(s=t).m_cachedValues=n.swap(this.m_cachedValues,this.m_cachedValues=s.m_cachedValues)}afterCompletedModification(){_t(this)}intersect(e,t,s,n,i){return Ir(!1,this,e,t,s,n,i)}intersectPoint(e,t,s){return function(e,t,s,i,r){const o=new d;if(function(e,t,s){const i=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(i),Nt(i,t,s)}(e,n.Envelope1D.unit(),o),o.inflate(r),!o.isIntersectingPoint2D(t))return 0;const a=new n.Point2D,m=Tt(e,t,n.Envelope1D.unit(),!1);return e.queryCoord2D(m,a),n.Point2D.distance(a,t)<=r?(i&&(i[0]=m),1):0}(this,e,t.length,t,s)}endPointModified(){_t(this)}clearEndPointModified(){}}Le.type=t.GeometryType.enumBezier2;class Be{constructor(e){return e.coefsT?(this.m_zeroCtor=e.zeroCtor,this.m_elements=e.coefsT.map(e=>e.clone()),t.geometryReleaseAssert(this.m_elements.length===e.power+1),void this.updatePower()):e.coef0?(this.m_zeroCtor=e.zeroCtor,void(this.m_elements=[e.coef0.clone()])):e.copy?(this.m_zeroCtor=e.copy.m_zeroCtor,void(this.m_elements=e.copy.m_elements.map(e=>e.clone()))):(this.m_zeroCtor=e.zeroCtor,void(this.m_elements=[new this.m_zeroCtor]))}construct(e,t){return this.m_elements=e.map(e=>e.clone()),this.updatePower(),this}construct0(e){return this.m_elements.length=0,this.m_elements.push(e.clone()),this.updatePower(),this}assignCopy(e){return this.m_elements=e.m_elements.map(e=>e.clone()),this.updatePower(),this}assignMove(e){return this.m_elements=e.m_elements,e.m_elements=[],this.updatePower(),this}power(){return this.m_elements.length-1}addElement(e){this.m_elements.push(e.clone())}scaleRangeToUnitInterval(e,t){const s=t;s.subThis(e);const i=this.power();for(let t=0;t<=i;t++){const r=new this.m_zeroCtor;for(let s=t;s<=i;s++){const i=this.m_elements[s];i.mulDoubleThis(n.choose(s,t));const o=e.pow(s-t);i.mulThis(o),r.addThis(i)}const o=s.pow(t);r.mulThis(o),this.m_elements[t]=r}}fmSubThis(e,s){return t.geometryReleaseAssert(0),this}addThis(e){const t=Math.min(this.power(),e.power());for(let s=0;s<=t;++s)this.m_elements[s].addThis(e.m_elements[s]);const s=e.power();this.m_elements.length=Math.max(this.power(),e.power())+1;for(let n=t+1;n<=s;++n)this.m_elements[n]=e.m_elements[n];return this.updatePower(),this}add0(e){return this.m_elements[0].addThis(e),this.updatePower(),this}addNumber0(e){return t.geometryReleaseAssert(0),this}sub(e){const t=Math.min(this.power(),e.power());for(let s=0;s<=t;++s)this.m_elements[s].subThis(e.m_elements[s]);const s=e.power();this.m_elements.length=Math.max(this.power(),e.power())+1;for(let n=t+1;n<=s;++n)this.m_elements[n]=e.m_elements[n].clone(),this.m_elements[n].negateThis();return this.updatePower(),this}sub0(e){return t.geometryReleaseAssert(0),this}subNumber0(e){return t.geometryReleaseAssert(0),this}subShifted(e,t){const s=this.power(),n=e.power()+t,i=Math.min(this.power(),n);let r=0;for(let s=t;s<=i;++s)this.m_elements[s].subThis(e.m_elements[r]),r++;if(n<=s)return this.updatePower(),this;this.m_elements.length=n+1;for(let e=s+1;e<this.m_elements.length;++e)this.m_elements[e]=new this.m_zeroCtor;for(let t=i+1;t<=n;++t)this.m_elements[t].subThis(e.m_elements[r++]);return this.updatePower(),this}subShiftedWithCoef(e,t,s){const n=this.power(),i=e.power()+s,r=Math.min(this.power(),i);let o=0;for(let n=s;n<=r;++n)this.m_elements[n].fmSubThis(e.m_elements[o],t),o++;if(i<=n)return this.updatePower(),this;this.m_elements.length=i+1;for(let e=n+1;e<this.m_elements.length;++e)this.m_elements[e]=new this.m_zeroCtor;for(let s=r+1;s<=i;++s)this.m_elements[s].fmSubThis(e.m_elements[o++],t);return this.updatePower(),this}mulThis(e){if(this.constructor===e.constructor){const t=e,s=[];for(let e=0,n=this.power();e<=n;e++)for(let n=0,i=t.power();n<=i;n++){const i=this.m_elements[e].clone();i.mulThis(t.m_elements[n]),e+n<s.length?s[e+n].addThis(i):s.push(i)}this.m_elements=s}else for(let t=0,s=this.power();t<=s;t++)this.m_elements[t].mulThis(e);return this.updatePower(),this}mulElementThis(e){for(let t=0,s=this.power();t<=s;t++)this.m_elements[t].mulThis(e);return this.updatePower(),this}mulDoubleThis(e){for(let t=0,s=this.power();t<=s;t++)this.m_elements[t].mulDoubleThis(e);return this.updatePower(),this}mulNumber0(e){return t.geometryReleaseAssert(0),this}mulBigint0(e){return t.geometryReleaseAssert(0),this}mulBigIntThis(e){return t.geometryReleaseAssert(0),this}mulInt320(e){return t.geometryReleaseAssert(0),this}div0(e){return t.geometryReleaseAssert(0),this}absThis(){return t.geometryReleaseAssert(0),this}div(e,t,s){if(this.power()<e.power())return s.assignCopy(this),void t.setZero();s.setZero(),t.setZero();const i=e.getElement(e.power()),r=this.clone();let o=r.power();const a=r.power()-e.power();let m=a;for(t.m_elements=n.makeObjectArray(t.m_zeroCtor,a+1);;){if(o<e.power()){s.assignMove(r);break}if(o===r.power()){const s=r.getElement(r.power());s.divThis(i),r.subShiftedWithCoef(e,s,r.power()-e.power()),t.m_elements[m]=s.clone()}m--,o--}s.updatePower(),t.updatePower()}divThis(e){return t.geometryReleaseAssert(0),this}subThis(e){const t=Math.min(this.power(),e.power());for(let s=0;s<=t;++s)this.m_elements[s].subThis(e.m_elements[s]);const s=e.power();this.m_elements.length=Math.max(this.power(),e.power())+1;for(let n=t+1;n<=s;++n)this.m_elements[n]=e.m_elements[n].clone(),this.m_elements[n].negateThis();return this.updatePower(),this}sub0This(e){return this.m_elements[0].subThis(e),this.updatePower(),this}subFrom(e,s){t.geometryReleaseAssert(0)}isZero(){return 0===this.power()&&this.m_elements[0].isZero()}negateThis(){for(let e=this.m_elements.length-1;e>=0;e--)this.m_elements[e].negateThis();return this}getElement(e){return this.m_elements[e].clone()}setElement(e,t){return this.m_elements[e]=t.clone(),this}evaluate(e){const t=this.power(),s=this.m_elements[t].clone();for(let n=t-1;n>=0;--n)s.mulThis(e),s.addThis(this.m_elements[n]);return s}equals(e){if(this===e)return!0;if(this.power()!==e.power())return!1;for(let t=this.m_elements.length-1;t>=0;t--)if(!this.m_elements[t].equals(e.m_elements[t]))return!1;return!0}updatePower(){for(let e=this.m_elements.length-1;e>0&&this.m_elements[e].isZero();e--)this.m_elements.pop();return this}setZero(){return this.m_elements.length=1,this.m_elements[0]=new this.m_zeroCtor,this.updatePower(),this}derivative(e){if(this.power()<e)return this.clone().setZero();if(0===e)return this.clone();const t=new this.constructor({coefsT:this.m_elements.slice(e),power:this.power()-e});for(let s=e,n=this.power();s<=n;s++){let n=BigInt(s);for(let t=s-1,i=s-e;t>i;--t)n*=BigInt(t);t.m_elements[s-e].mulBigIntThis(n)}return t.updatePower(),t}derivative1This(){if(this.m_elements.length>1){this.m_elements=this.m_elements.slice(1);for(let e=1,t=this.power();e<=t;e++)this.m_elements[e].mulThis(n.MPValue.constructInt32(e+1))}else this.m_elements.length=0,this.m_elements.push(new this.m_zeroCtor);return this}limitPrecisionThis(e){for(let t=this.power();t>=0;--t)this.m_elements[t].limitPrecisionThis(e);return this.updatePower(),this}hiBitIndex(){return this.m_elements.reduce((e,t)=>{const s=t.hiBitIndex();return e<s?s:e},0)}shiftRight(e){return this.m_elements.splice(0,e),this.updatePower(),this}evaluateDerivative(e){const t=this.power(),s=this.m_elements[t];s.mulDoubleThis(t);for(let n=t-1;n>=1;--n){s.mulThis(e);const t=this.m_elements[n];t.mulDoubleThis(n),s.addThis(t)}return s}static evaluateCoefs(e,t,s){const n=e.power();s.construct0(e.getElement(0).evaluate(t));for(let i=1;i<=n;++i)s.addElement(e.getElement(i).evaluate(t));s.updatePower()}}class ze extends Be{constructor(e){super(void 0===e?{zeroCtor:n.MPValue}:{...e,zeroCtor:n.MPValue})}clone(){return new ze({copy:this})}absEvaluate(e){const t=this.power(),s=this.m_elements[t].clone();s.absThis();const n=e.clone();n.absThis();for(let e=t-1;e>=0;--e)s.mulThis(n),s.addThis(this.m_elements[e].abs());return s}}class Ue extends Be{constructor(e){super(void 0===e?{zeroCtor:ze}:{...e,zeroCtor:ze})}clone(){return new Ue({copy:this})}constructFromMPValues(e,t){this.m_elements.length=0;for(let s=0;s<=t;++s)this.m_elements.push(new ze({coef0:e[s]}));return this.updatePower(),this}}function je(e,s,i,r,o,a,m,h,l,u,c,g,d,p,_,f,y,x,P,E=!1){const v={polypoly1:new Ue,polypoly2:new Ue,polyX2:new ze,polyY2:new ze,polyX2Deriv:new ze,polyY2Deriv:new ze,polypolyX1:new Ue,polypolyY1:new Ue,polypolyX1Deriv:new Ue,polypolyY1Deriv:new Ue,lazyPolypolyD1:new Ue,lazyPolypolyD1Deriv:new Ue,lazyPolyD2:new ze,lazyPolyD2Deriv:null,polypoly11:new Ue,polypoly12:new Ue,tempPp:new Ue,tempPp1:new Ue,tempPp2:new Ue,tempP:new ze,tempP1:new ze,tempP2:new ze};v.polyX2.construct(m,h),v.polyY2.construct(l,u),v.polypolyX1.constructFromMPValues(e,s),v.polypolyY1.constructFromMPValues(i,r),v.polypoly11.assignCopy(v.polypolyX1),v.polypoly12.assignCopy(v.polypolyY1),c&&(v.lazyPolyD2.construct(c,g),v.polypoly11.mulElementThis(v.lazyPolyD2),v.polypoly12.mulElementThis(v.lazyPolyD2)),o?(v.lazyPolypolyD1.constructFromMPValues(o,a),v.lazyPolypolyD1Deriv=new Ue({copy:v.lazyPolypolyD1}),v.lazyPolypolyD1Deriv.derivative1This(),v.tempPp.assignCopy(v.lazyPolypolyD1),v.tempPp.mulElementThis(v.polyX2),v.polypoly11.subThis(v.tempPp),v.tempPp.assignCopy(v.lazyPolypolyD1),v.tempPp.mulElementThis(v.polyY2),v.polypoly12.subThis(v.tempPp)):(v.polypoly11.sub0This(v.polyX2),v.polypoly12.sub0This(v.polyY2)),v.polypolyX1Deriv.assignCopy(v.polypolyX1),v.polypolyX1Deriv.derivative1This(),v.polypolyY1Deriv.assignCopy(v.polypolyY1),v.polypolyY1Deriv.derivative1This(),o&&(v.polypolyX1Deriv.mulThis(v.lazyPolypolyD1),v.tempPp2.assignCopy(v.lazyPolypolyD1Deriv),v.tempPp2.mulThis(v.polypolyX1),v.polypolyX1Deriv.subThis(v.tempPp2),v.polypolyY1Deriv.mulThis(v.lazyPolypolyD1),v.tempPp2.assignCopy(v.lazyPolypolyD1Deriv),v.tempPp2.mulThis(v.polypolyY1),v.polypolyY1Deriv.subThis(v.tempPp2)),v.polyX2Deriv.assignCopy(v.polyX2),v.polyX2Deriv.derivative1This(),v.polyY2Deriv.assignCopy(v.polyY2),v.polyY2Deriv.derivative1This(),c&&(t.geometryReleaseAssert(null===v.lazyPolyD2Deriv),v.lazyPolyD2Deriv=new ze({copy:v.lazyPolyD2}),v.lazyPolyD2Deriv.derivative1This(),v.polyX2Deriv.mulThis(v.lazyPolyD2),v.tempP1.assignCopy(v.lazyPolyD2Deriv),v.tempP1.mulThis(v.polyX2),v.polyX2Deriv.subThis(v.tempP1),v.polyY2Deriv.mulThis(v.lazyPolyD2),v.tempP1.assignCopy(v.lazyPolyD2Deriv),v.tempP1.mulThis(v.polyY2),v.polyY2Deriv.subThis(v.tempP1)),v.polypoly1.assignCopy(v.polypoly11),v.polypoly1.mulElementThis(v.polyX2Deriv),v.tempPp.assignCopy(v.polypoly12),v.tempPp.mulElementThis(v.polyY2Deriv),v.polypoly1.addThis(v.tempPp),v.polypoly2.assignCopy(v.polypolyX1Deriv),v.polypoly2.mulElementThis(v.polyY2Deriv),v.tempPp.assignCopy(v.polypolyY1Deriv),v.tempPp.mulElementThis(v.polyX2Deriv),v.polypoly2.subThis(v.tempPp);let C=[];const D=[];y||(y=[]),f||(f=[]),tt(v.polypoly11,v.polypoly12,v.tempP);const b=n.s_one$1.ldexp(-59).toDouble(),S=[];let I=st(v.tempP,0,_,b,64,S,x,x);if(I<0)return-1;for(let e=0;e<I;e++){const s=v.tempP1,i=v.tempP2;ze.evaluateCoefs(v.polypoly11,S[e],s);const r=n.constructBernsteinCoefficientsFromStandardForm(s.m_elements,s.power()+1);r.sort((e,t)=>e.compare(t)),ze.evaluateCoefs(v.polypoly12,S[e],i);const o=n.constructBernsteinCoefficientsFromStandardForm(i.m_elements,i.power()+1);o.sort((e,t)=>e.compare(t));const a=r[0],m=r.at(-1),h=o[0],l=o.at(-1);m.subThis(a),l.subThis(h);const u=m.subThis(l).GEZ(),c=58,g=[];let d;if(d=st(u?s:i,0,p,n.s_one$1.ldexp(-59).toDouble(),c,g,x,x),d<0&&t.throwInternalErrorException("mp_curve_proximity"),d>0){const r=u?i:s;for(let s=0;s<d;s++){let i;if(u){const t=v.tempP;ze.evaluateCoefs(v.polypoly12,S[e].addDouble(Number.EPSILON),t),i=t.evaluate(g[s])}else{const t=v.tempP;ze.evaluateCoefs(v.polypoly11,S[e].addDouble(Number.EPSILON),t),i=t.evaluate(g[s])}const o=r.evaluateDerivative(g[s]).abs().mulDoubleThis(Number.EPSILON),a=r.evaluate(g[s]);o.addThis(i.sub(a).absThis()),o.ldexpThis(3),a.absThis(),a.lt(o)?D.push(n.makePair(g[s].toDouble(),S[e].toDouble())):t.geometryReleaseAssert(a.gte(o))}}}I=D.length,tt(v.polypoly1,v.polypoly2,v.tempP);const w=[];let T=st(v.tempP,0,_,b,64,w);T<0&&(T=0);for(let e=0;e<T;e++){ze.evaluateCoefs(v.polypoly1,w[e],v.tempP1);const t=[];let s=st(v.tempP1,0,p,b,64,t);if(0!==s)if(ze.evaluateCoefs(v.polypoly2,w[e],v.tempP2),s<0){if(s=st(v.tempP2,0,p,b,64,t),s<0)continue;for(let i=0;i<s;i++)C.push(n.makePair(t[i].toDouble(),w[e].toDouble()))}else{const i=v.tempP2.absEvaluate(n.s_one$1);i.mulThis(n.MPValue.constructDouble(1e-12));for(let r=0;r<s;r++){const s=v.tempP2.evaluate(t[r]);s.absThis(),s.lt(i)&&C.push(n.makePair(t[r].toDouble(),w[e].toDouble()))}}}if(T=C.length,0===I&&0===T)return 0;C=C.concat(D),C.sort((e,t)=>E?n.standardNumericCompare(e.second,t.second):n.standardNumericCompare(e.first,t.first));const A=n.unique(C,(e,t)=>e.first===t.first&&e.second===t.second);C=C.slice(0,A),f.length=0,y.length=0;for(const e of C)f.push(e.first),y.push(e.second);return t.geometryReleaseAssert(f.length===y.length),y.length}function We(e,t,s,i,r,o,a,m,h,l,u,c,g){const d={polyIntersect:new ze,polyX1:new ze,polyY1:new ze,polyX1Deriv:new ze,polyY1Deriv:new ze,lazyPolyD1:new ze,lazyPolyD1Deriv:new ze,tempP:new ze,tempP1:new ze,tempP2:new ze,polypoly1Proximity:new Ue,polypoly2Proximity:new Ue};d.polyX1.construct(e,t),d.polyY1.construct(s,i),d.polyX1Deriv.assignCopy(d.polyX1),d.polyX1Deriv.derivative1This(),d.polyY1Deriv.assignCopy(d.polyY1),d.polyY1Deriv.derivative1This(),d.polyIntersect.assignCopy(d.polyX1),d.polyIntersect.mulThis(d.polyX1),d.polyIntersect.mulElementThis(a[0]),d.tempP.assignCopy(d.polyY1),d.tempP.mulThis(d.polyY1),d.tempP.mulElementThis(a[1]),d.polyIntersect.addThis(d.tempP),r?(d.lazyPolyD1.construct(r,o),d.tempP.assignCopy(d.lazyPolyD1),d.tempP.mulThis(d.lazyPolyD1),d.tempP.mulElementThis(a[2]),d.polyIntersect.addThis(d.tempP)):d.polyIntersect.add0(a[2]);{const r=a[0].clone(),o=r.clone();o.sqrThis();const m=a[1].clone(),h=m.clone();h.sqrThis();const l=a[2].clone(),u=r.clone();u.subThis(m),d.polyX1.construct(e,t),d.polyX1Deriv.assignCopy(d.polyX1),d.polyX1Deriv.derivative1This(),d.polyY1.construct(s,i),d.polyY1Deriv.assignCopy(d.polyY1),d.polyY1Deriv.derivative1This(),d.tempP.assignCopy(d.polyX1),d.tempP.mulThis(d.polyX1),d.tempP.mulElementThis(h),d.tempP.mulElementThis(l),d.polypoly1Proximity.construct0(d.tempP),d.tempP.assignCopy(d.polyX1),d.tempP.mulThis(m.mul(u).mul(l).ldexpThis(1)),d.polypoly1Proximity.addElement(d.tempP),d.tempP.assignCopy(d.polyX1),d.tempP.mulThis(d.polyX1),d.tempP.mulElementThis(r.mul(h)),d.tempP1.assignCopy(d.polyY1),d.tempP1.mulThis(d.polyY1),d.tempP1.mulElementThis(o.mul(m)),d.tempP.addThis(d.tempP1),d.tempP.add0(u.mul(u).mul(l)),d.polypoly1Proximity.addElement(d.tempP),d.tempP.assignCopy(d.polyX1),d.tempP.mulElementThis(u.mul(r).mul(m).ldexpThis(1)),d.polypoly1Proximity.addElement(d.tempP),d.tempP.construct0(r.mul(u).mul(u)),d.polypoly1Proximity.addElement(d.tempP),d.polypoly1Proximity.updatePower(),d.tempP.construct0(n.s_zero$1),d.polypoly2Proximity.construct0(d.tempP),d.tempP.assignCopy(d.polyX1),d.tempP.mulThis(d.polyX1Deriv),d.tempP1.assignCopy(d.polyY1),d.tempP1.mulThis(d.polyY1Deriv),d.tempP.addThis(d.tempP1),d.tempP.mulElementThis(r.mul(m)),d.polypoly2Proximity.addElement(d.tempP),d.tempP.assignCopy(d.polyX1Deriv),d.tempP.mulElementThis(u.mul(r)),d.polypoly2Proximity.addElement(d.tempP),d.polypoly2Proximity.updatePower()}const p=[],_=[];null===u&&(u=[]);let f=2*d.polyIntersect.power()+58;const y=.5*Number.EPSILON,x=[],P=st(d.polyIntersect,0,h,y,f,x,c,c);if(P<0)return-1;for(const e of x)_.push(e.toDouble());tt(d.polypoly1Proximity,d.polypoly2Proximity,d.tempP),f=2*d.tempP.power()+58,x.length=0;let E=st(d.tempP,0,h,y,f,x);if(E<0&&(E=0),0===P&&0===E)return 0;for(const e of x)p.push(e.toDouble());const v=p.concat(_);u.length=v.length,n.memcpy(u,v,0,0,v.length),n.numericSort(u);const C=n.unique(u,(e,t)=>0===n.standardNumericCompare(e,t));return u.length=C,u.length}function Ze(e,t,s,n){return e.isZero()?t.isZero()?-1:0:(n.setThis(t),n.negateThis(),n.divThis(e),s.isEmpty()||s.containsCoordinate(n.value())?1:0)}function Qe(e,t,s,i,r,o,a){if(e.isZero())return o?(a[0].setInt32(1),r.containsCoordinate(1)?1:0):Ze(t,s,r,a[0]);if(o){let t=2;return a[0].setInt32(1),s.equals(e)?(a[1].setInt32(1),t=1):a[1].setThis(s.div(e)),r.containsCoordinate(a[1].value())||(t=1),r.containsCoordinate(a[0].value())||(t--,a[0].setThis(a[1])),2===t&&a[0].value()>a[1].value()&&(a[1]=n.swap(a[0],a[0]=a[1])),t}const m=t.clone();m.sqrThis();const h=e.clone();if(h.mulThis(s).ldexpThis(2).negateThis().addThis(m),h.LZ())return 0;const l=i+2,u=n.MPValue.sqrt(h,l),c=u.clone();t.LZ()&&c.negateThis(),c.addThis(t).limitPrecisionThis(l).ldexpThis(-1).negateThis();let g=0;return a[0].setThis(c).divThis(n.MPValue.constructAssign(e,l)).limitPrecisionThis(i),(r.isEmpty()||r.containsCoordinate(a[0].value()))&&g++,u.isZero()||c.isZero()||(a[g].setThis(s).divThis(c).limitPrecisionThis(i),(r.isEmpty()||r.containsCoordinate(a[g].value()))&&g++,2===g&&a[0].gt(a[1])&&(a[1]=n.swap(a[0],a[0]=a[1]))),g}function Ke(e,s,i,r,o,a,m,h){if(e.isZero())return Qe(s,i,r,o,a,m,h);const l=(e,t)=>{if(e>0){let s=t+e;for(let e=1;e<s;e++)h[e].equals(h[0])&&(h[s-1]=n.swap(h[e],h[e]=h[s-1]),s--);t=s}return n.sortRange(h,0,t,(e,t)=>e.compare(t)),t};if(r.isZero()){let t=0;return a.containsCoordinate(0)&&(h[0].setInt32(0),t=1),l(Qe(e,s,i,o,a,m,h.slice(1)),t)}if(m){let t=0;a.containsCoordinate(1)&&(h[0].setInt32(1),t=1);const n=s.add(e),i=r.negate(),m=e.add(n).add(i).isZero();return l(Qe(e,n,i,o,a,m,h.slice(t)),t)}const u=new n.MPValue,c=new n.MPValue,g=new n.MPValue,d=s.clone();if(d.isZero())c.setThis(i),c.divThis(e),g.setThis(r),g.divThis(e);else{d.divThis(e).divDoubleThis(3).negateThis();const t=s.clone();t.sqrThis();const n=e.clone();n.sqrThis(),c.setThis(e),c.mulThis(i).mulDoubleThis(3).subThis(t).divThis(n).divDoubleThis(3),g.setThis(t),g.mulThis(s),g.ldexpThis(1),u.setThis(e),u.mulThis(s).mulThis(i).mulDoubleThis(9),g.subThis(u),u.setThis(n),u.mulThis(r).mulDoubleThis(27),g.addThis(u),g.divThis(n).divThis(e).divDoubleThis(27)}if(c.isZero()){const e=g.clone();return e.negateThis(),e.isZero()?(h[0].setThis(d),ht(a,o,h,1)):(h[0].setThis(n.MPValue.cubicRoot(e,o).add(d)),ht(a,o,h,1))}const p=g.clone();if(p.sqrThis().ldexpThis(-2),u.setThis(c.clone()),u.sqrThis().mulThis(c).divDoubleThis(27),p.addThis(u),p.isZero())return h[0].setThis(g),h[0].mulDoubleThis(3).divThis(c),h[1].setThis(h[0]),h[1].negateThis(),h[1].ldexpThis(-1),h[0].addThis(d),h[1].addThis(d),ht(a,o,h,2);if(p.GZ())return p.setThis(n.MPValue.sqrt(p,o+8)),u.setThis(g),u.ldexpThis(-1).negateThis(),u.addThis(p),h[0].setThis(n.MPValue.cubicRoot(u,o+8)),u.setThis(g),u.ldexpThis(-1).negateThis(),u.subThis(p),h[0].addThis(n.MPValue.cubicRoot(u,o+8)),h[0].addThis(d),ht(a,o,h,1);u.setThis(c),u.divDoubleThis(3).negateThis(),t.geometryReleaseAssert(u.GEZ());const _=n.MPValue.sqrt(u,o+8),f=_.clone();f.negateThis(),f.addThis(d),_.addThis(d);const y=n.MPValue.constructDouble(a.isEmpty()?-Number.MAX_VALUE:a.vmin),x=n.MPValue.constructDouble(a.isEmpty()?Number.MAX_VALUE:a.vmax),P=new ze({zeroCtor:n.MPValue});P.construct0(r),P.addElement(i),P.addElement(s),P.addElement(e);const E=new ze({copy:P});E.derivative1This();let v=0;const C=n.makeObjectArray(n.MPValue,4);C[v++].setThis(y),f.gt(y)&&f.lt(x)&&C[v++].setThis(f),_.gt(y)&&_.lt(x)&&C[v++].setThis(_),C[v++].setThis(x);const D=3*o;let b=52,S=Number.EPSILON;for(;b<D;)2*b<=D?(S*=S,b*=2):(S*=Number.EPSILON,b+=52);b+=2;let I=0,w=!1;for(let e=1;e<v;e++)if(rt(P,E,C[e-1],C[e],S,b,h[0])){I=1,w=e+1<v;break}if(!I)return 0;if(w){const e=new ze({zeroCtor:n.MPValue,coef0:h[0]});e.negateThis(),e.addElement(n.s_one$1);const s=new ze({zeroCtor:n.MPValue}),i=new ze({zeroCtor:n.MPValue});P.div(e,s,i),t.geometryReleaseAssert(2===s.power()),t.geometryReleaseAssert(0===i.power());const r=Qe(s.getElement(2),s.getElement(1),s.getElement(0),o,a,!1,h.slice(1));t.geometryReleaseAssert(r>=0&&r<=2),I+=r}return ht(a,o,h,I)}function $e(e,t,s,i,r,o,a,m,h){if(e.isZero())return Ke(t,s,i,r,o,a,m,h);const l=(e,t)=>{if(e>0){let s=t+e;for(let e=1;e<s;e++)h[e].equals(h[0])&&(h[s-1]=n.swap(h[e],h[e]=h[s-1]),s--);t=s}return n.sortRange(h,0,t,(e,t)=>e.compare(t)),t};if(r.isZero()){let n=0;return a.containsCoordinate(0)&&(h[0].setInt32(0),n=1),l(Ke(e,t,s,i,o,a,m,h.slice(n)),n)}const u=new ze({zeroCtor:n.MPValue,coef0:r});if(u.addElement(i),u.addElement(s),u.addElement(t),u.addElement(e),m){let e=0;a.containsCoordinate(1)&&(h[0].setInt32(1),e=1);const t=new ze({zeroCtor:n.MPValue,coef0:n.MPValue.constructInt32(-1)});t.addElement(n.MPValue.constructInt32(1));const s=new ze({zeroCtor:n.MPValue}),i=new ze({zeroCtor:n.MPValue});return u.div(t,s,i),l(Ke(3===s.power()?s.getElement(3):n.s_zero$1.clone(),s.power()>=2?s.getElement(2):n.s_zero$1.clone(),s.power()>=1?s.getElement(1):n.s_zero$1.clone(),s.getElement(0),o,a,s.evaluate(n.s_one$1).isZero(),h.slice(e)),e)}if(u.getElement(0).isZero()){let e=0;for(a.containsCoordinate(0)&&(e=1,h[0].setDouble(0));u.getElement(0).isZero()&&u.power()>0;)u.shiftRight(1);const t=Ke(3===u.power()?u.getElement(3):n.s_zero$1.clone(),u.power()>=2?u.getElement(2):n.s_zero$1.clone(),u.power()>=1?u.getElement(1):n.s_zero$1.clone(),u.getElement(0),o,a,!1,h.slice(e));return t>0&&(e+=t),n.sortRange(h,0,e,(e,t)=>e.compare(t)),e}let c=52,g=Number.EPSILON;for(;c<o;)2*c<=o?(g*=g,c*=2):(g*=Number.EPSILON,c+=52);c+=2;const d=mt(u),p=n.MPValue.constructDouble(Math.max(Math.abs(a.vmax),Math.abs(a.vmin)));return g=(d.lt(p)?d:p).mul(n.MPValue.constructDouble(g)).toDouble(),at(u,a,g,c,m,0,h,4)}function Je(e,t){let s=e,i=t;i.power()>s.power()&&(i=n.swap(s,s=i));const r=s.power()-i.power(),o=new ze({copy:s.getElement(s.power())});s.mulThis(i.getElement(i.power()));for(let e=0,t=s.power();e<t;e++)if(e>=r){const t=new ze({copy:i.getElement(e-r)});t.mulThis(o);const n=s.getElement(e).sub(t);s.setElement(e,n)}s.setElement(s.power(),s.getElement(s.power()).setZero()),s.updatePower(),et(s)}function et(e){let t=0;for(;t<e.power()&&e.getElement(t).isZero();)t++;return t>0&&(e.shiftRight(t),!0)}function tt(e,t,s){const n=e.clone(),i=t.clone();for(et(n),et(i);0!==n.power()||0!==i.power();)Je(n,i);s.assignMove(n.getElement(0))}function st(e,t,s,i,r,o,a=!1,m=!1){o.length=0;const h=e.power(),l=n.makeObjectArray(n.MPValue,2*h+4),u=function(e,t,s,i,r,o,a){if(0===e.power())return e.isZero()?-1:0;const m=e.evaluate(n.MPValue.constructInt32(1)).isZero();if(1===e.power()){const s=Ze(e.getElement(1),e.getElement(0),t,o.at(0));return o[0].limitPrecisionThis(i),1!==s?0:(o[0].limitPrecisionThis(i),1)}return 2===e.power()?Qe(e.getElement(2),e.getElement(1),e.getElement(0),i,t,m,o):3===e.power()?Ke(e.getElement(3),e.getElement(2),e.getElement(1),e.getElement(0),i,t,m,o):4===e.power()?$e(e.getElement(4),e.getElement(3),e.getElement(2),e.getElement(1),e.getElement(0),i,t,m,o):at(e,t,s,i,m,0,o,a)}(e,s||n.Envelope1D.unit(),i,r,0,l,l.length);if(u>0){o.length=0;for(let e=0;e<u;e++){const t=l[e];e>0&&t.lte(o.at(-1))||o.push(t.clone())}return o.length}return u}function nt(e,s,n){if(t.geometryReleaseAssert(n>=1),0===e.power())return e.isZero()?-1:0;const i=e.getElement(0);return i.negateThis(),i.divThis(e.getElement(1)),s[0].setThis(i),1}function it(e,s,i,r){if(e.power()<2)return nt(e,i,r);t.geometryReleaseAssert(r>=1);let o=e.getElement(1);o.mulThis(e.getElement(1));const a=e.getElement(0);if(a.mulThis(e.getElement(2)),a.ldexpThis(2),o.subThis(a),o.LZ())return 0;if(o.isZero()){const t=e.getElement(1);return t.negateThis(),t.divThis(e.getElement(2)),t.ldexpThis(-1),t.limitPrecisionThis(s),i[0].setThis(t),1}t.geometryReleaseAssert(r>=2),o=n.MPValue.sqrt(o,s+8);const m=e.getElement(1);m.negateThis();const h=m.clone();h.subThis(o),h.divThis(e.getElement(2)),h.ldexpThis(-1),h.limitPrecisionThis(s);const l=m.clone();return l.addThis(o),l.divThis(e.getElement(2)),l.ldexpThis(-1),l.limitPrecisionThis(s),h.lt(l)?(i[0].setThis(h),i[1].setThis(l)):(i[1].setThis(h),i[0].setThis(l)),2}function rt(e,s,i,r,o,a,m){let h=i.clone(),l=r.clone();h.limitPrecisionThis(a),l.limitPrecisionThis(a);let u=e.evaluate(h);u.limitPrecisionThis(a+2);let c=e.evaluate(l);if(c.limitPrecisionThis(a+2),u.GEZ()&&c.GEZ()||u.LEZ()&&c.LEZ())return u.absLessAbs(c)?(m=h,u.isZero()):(m=l,c.isZero());const g=c.LZ();g&&(c=n.swap(u,u=c),l=n.swap(h,h=l));const d=g?l:h,p=g?h:l,_=h.add(l).ldexpThis(-1);_.limitPrecisionThis(a);const f=l.sub(h);f.limitPrecisionThis(a),f.absThis();const y=f.clone();let x=e.evaluate(_),P=s.evaluate(_);const E=new ze({copy:e}),v=new ze({copy:s});{const t=Math.max(e.hiBitIndex(),s.hiBitIndex()),i=n.s_one$1.clone();i.ldexpThis(-(a+2));for(let n=64;n<t;){E.limitPrecisionThis(n),v.limitPrecisionThis(n);const r=E.evaluate(_),o=v.evaluate(_),a=r.sub(x),m=o.sub(P);if(a.divThis(x).absThis().lt(i)&&(P.isZero()||m.divThis(P).absThis().lt(i)))break;E.assignCopy(e),v.assignCopy(s),n=Math.min(n+64,t)}x.limitPrecisionThis(a+2),P.limitPrecisionThis(a+2)}let C=4,D=1,b=0,S=0,I=1;const w=n.MPValue.constructDouble(.25*o),T=n.MPValue.constructDouble(.5001);let A=0;for(;++A<300;){if(A>32&&b>0||P.isZero()||2===I&&b>1||1===I&&C<4)I=1,D>1&&D--;else if(I=2,S>1){const e=f.mul(P);e.absThis(),e.ldexpThis(-3),e.absLessAbs(x)&&D++}f.setThis(y);const e=new n.MPValue;let t=!1;if(1===I)do{if(S>2){const t=f.clone();if(t.absThis(),t.ldexpThis(4),p.sub(d).ldexpThis(-1).gt(t)){if(_.equals(d)){e.setThis(_),_.setThis(d.add(t)),_.limitPrecisionThis(a),y.setThis(_.sub(e));break}if(_.equals(p)){e.setThis(_),_.setThis(p.sub(t)),_.limitPrecisionThis(a),y.setThis(_.sub(e));break}}}y.setThis(l.sub(h)),y.ldexpThis(-1),y.limitPrecisionThis(a),e.setThis(_),_.setThis(h.add(y)),_.limitPrecisionThis(a),_.lt(d)?_.setThis(d):_.gt(p)&&_.setThis(p),t=h.equals(_)||l.equals(_)}while(0);else for(;;){if(y.setThis(x.div(P)),y.limitPrecisionThis(a),1!==D&&y.mulDoubleThis(D),e.setThis(_),_.subThis(y),_.limitPrecisionThis(a),t=_.equals(e),_.lt(d)){if(D>1){_.setThis(e),D--;continue}y.setThis(e.sub(d)),_.setThis(d)}else if(_.gt(p)){if(D>1){_.setThis(e),D--;continue}y.setThis(e.sub(p)),_.setThis(p)}break}if(t||y.absLessAbs(w)){e.equals(_)||(x=E.evaluate(_),x.limitPrecisionThis(a+2));break}x=E.evaluate(_),x.limitPrecisionThis(a+2),P=v.evaluate(_),P.limitPrecisionThis(a+2);const s=h.clone(),i=l.clone();x.LZ()?(u.setThis(x),h.setThis(_)):(c.setThis(x),l.setThis(_)),2===I&&(h.equals(s)&&l.equals(i)||S>1&&!y.absLessAbs(T.mul(f)))?b++:b=0,1===I?(C++,S=0):(C=0,S++)}return A>=300&&t.throwInternalErrorException("Root_finder iterations exceeded"),m.setThis(_),!0}function ot(e,t,s,i,r){const o=e.evaluate(s);if(o.isZero())return!0;const a=n.MPValue.constructDouble(.5*i),m=s.clone();m.subThis(a);const h=e.evaluate(m),l=s.clone();l.addThis(a);const u=e.evaluate(l);if(h.LZ()&&u.GZ()||h.GZ()&&u.LZ())return!0;if(o.GZ()?h.LEZ()||u.LEZ():h.GEZ()||u.GEZ())return!0;const c=h.LEZ()&&u.LEZ(),g=h.GEZ()&&u.GEZ();let d=!1;return c?o.gt(h)&&o.gt(u)&&(d=!0):g&&o.lt(h)&&o.lt(u)&&(d=!0),!!d&&o.absThis().lt(n.MPValue.constructDouble(1e-17))}function at(e,s,i,r,o,a,m,h){t.geometryReleaseAssert(i>0),t.geometryReleaseAssert(h>=e.power());const l=m,u=[];let c=[];const g=new ze({zeroCtor:e.m_zeroCtor}),d=new ze({zeroCtor:e.m_zeroCtor}),p=new ze({zeroCtor:e.m_zeroCtor}),_=n.MPValue.constructDouble(i),f=n.MPValue.constructDouble(s.vmin),y=n.MPValue.constructDouble(s.vmax),x=f.sub(_),P=y.add(_),E=mt(e),v=E.clone();if(v.negateThis(),x.lt(v))x.setThis(v.sub(_));else if(x.gt(E))return 0;if(P.gt(E))P.setThis(E.add(_));else if(P.lt(v))return 0;let C=e,D=null;if(o){const t=new ze({coef0:n.MPValue.constructInt32(-1)});t.addElement(n.s_one$1),D=new ze,C=D;const s=new ze,i=new ze;for(e.div(t,s,i),D.assignCopy(s);C.evaluate(n.s_one$1).isZero();)C.div(t,s,i),D.assignCopy(s)}let b=!1;if(C.power()>0&&C.getElement(0).isZero())for(b=!0,D||(D=new ze({copy:C}),C=D);C.getElement(0).isZero();)D.shiftRight(1);let S=r+2*C.power()+2,I=i/Math.pow(2,C.power()+2),w=S;if(n.s_zero$1.gt(x)&&n.s_zero$1.lt(P))for(let e=0,t=C.power();e<t;e++)if(C.getElement(e).isZero()){u.push(n.s_zero$1.clone());break}for(let e=C.power()-1;e>0;e--)if(I*=2,S-=2,w-=2,C.power()-e!==1){if(C.power()-e===2){d.assignMove(C.derivative(e));const s=it(d,S,l,h);t.geometryReleaseAssert(s>=0&&s<=2);for(let e=0;e<s;e++)l[e].gt(x)&&l[e].lt(P)&&!l[e].isZero()&&u.push(l[e].clone());if(u.length>1&&u.sort((e,t)=>e.compare(t)),u.length>0){let e=u[0].sub(_);e.limitPrecisionThis(w),c.push(n.makePair(x.clone(),e));let t=1===u.length?P.clone():u[1].sub(_);e=u[0].add(_),e.limitPrecisionThis(w),t.limitPrecisionThis(w),c.push(n.makePair(e,t)),u.length>1&&(t=2===u.length?P.clone():u[2].sub(_),t.limitPrecisionThis(w),e=u[1].add(_),e.limitPrecisionThis(w),c.push(n.makePair(e,t)),u.length>2&&(e=u[2].add(_),e.limitPrecisionThis(w),c.push(n.makePair(e,P.clone()))))}else c.push(n.makePair(x.clone(),P.clone()));g.assignCopy(d),p.assignMove(C.derivative(e-1));continue}{d.assignMove(p),p.assignMove(C.derivative(e-1));let t=[];for(let e=0,s=c.length;e<s;++e)if(c[e].first.lte(c[e].second)){const s=new n.MPValue;if(rt(d,g,c[e].first,c[e].second,I,S,s)){u.push(s);let i=s.sub(_);i.limitPrecisionThis(w),t.push(n.makePair(c[e].first,i)),i=s.add(_),i.limitPrecisionThis(w),t.push(n.makePair(i,c[e].second))}else t.push(c[e])}c=t,t=[],g.assignMove(d)}}else d.assignMove(C.derivative(e)),1===nt(d,l,h)&&(l[0].gt(x)&&l[0].lt(P)&&!l[0].isZero()&&u.push(l[0].clone()),g.assignMove(d),p.assignMove(C.derivative(e-1)));u.sort((e,t)=>e.compare(t)),0===c.length&&(g.assignMove(C.derivative(C.power())),g.isZero()||c.push(n.makePair(x.clone(),P.clone())));let T=0,A=0,N=0;const G=new n.MPValue;for(;;){if(A<c.length){if(c[A].first.gt(c[A].second)){A++;continue}let e=!1;if(N<u.length&&u[N].lt(c[A].first)&&(e=!0),!e){rt(C,g,c[A].first,c[A].second,i,r,G)&&(G.lt(f)?l[T++].setThis(f):G.gt(y)?l[T++].setThis(y):l[T++].setThis(G)),A++;continue}}if(!(N<u.length))break;0!==N&&u[N-1].equals(u[N])||ot(C,0,u[N],i)&&(G.setThis(u[N]),G.lt(f)?G.setThis(f):G.gt(y)&&G.setThis(y),0!==T&&l[T].equals(G)||l[T++].setThis(G)),N++}return b&&n.s_zero$1.gt(x)&&n.s_zero$1.lt(P)&&(l[T++].setThis(n.s_zero$1),n.sortRange(l,0,T,(e,t)=>e.compare(t))),o&&n.s_one$1.gt(x)&&n.s_one$1.lt(P)&&(l[T++].setThis(n.s_one$1),n.sortRange(l,0,T,(e,t)=>e.compare(t))),T}function mt(e){const t=e.getElement(e.power());t.limitPrecisionThis(53),t.absThis();const s=n.s_zero$1.clone();for(let t=0,n=e.power();t<n;t++){const n=e.getElement(t);n.limitPrecisionThis(53),n.gt(s)&&s.setThis(n)}return s.divThis(t),s.addThis(n.s_one$1),s.mulThis(n.MPValue.constructDouble(1+100*Number.EPSILON)),s}function ht(e,t,s,i){let r=i;if(!e.isEmpty()){r=0;for(let t=0;t<i;++t)e.containsCoordinate(s[t].value())&&(r!==t&&s[r].setThis(s[t]),r++)}r>1&&(s[0].gt(s[1])&&(s[1]=n.swap(s[0],s[0]=s[1])),r>2&&(s[0].gt(s[2])&&(s[2]=n.swap(s[0],s[0]=s[2])),s[1].gt(s[2])&&(s[2]=n.swap(s[1],s[1]=s[2]))));for(let e=0;e<r;++e)s[e].limitPrecisionThis(t);return r}function lt(e,s,i,r,o,a){return function(e,s,i,r,o,a){if(i<s&&t.throwInvalidArgumentException("xTo < xFrom"),i===s)return 0;const m=[0];let h=Number.MAX_VALUE;const l=[Number.MAX_VALUE];let u=0;const c=n.makePrimitiveArray(33,Number.NaN),g=n.makePrimitiveArray(33,Number.NaN),d=[0];c[0]=1;let p=0,_=0;for(let n=0;n<32;n++){if(u=ut(s,i,r,0===n,u,d),g[n]=u,n+1>=e){ct(n+1-e,e,c,g,0,m,l)||t.throwInternalErrorException("polynomial_interpolation");const s=o*Math.abs(m[0])+a,i=Math.abs(h-m[0]);if(i<=s&&Math.abs(l[0])<=s){if(p++,p>1&&(i<=.1*_||0===_||p>2))return m[0]}else p=0;_=i,h=m[0]}g[n+1]=g[n],c[n+1]=.25*c[n]}return m[0]}(e,s,i,a,r,o)}function ut(e,t,s,i,r,o){let a=r;if(i)return o[0]=1,a=.5*(t-e)*(s(e)+s(t)),a;const m=o[0],h=(t-e)/m,l=e,u=new n.KahanSummator(0);for(let e=1;e<=o[0];++e){const t=(e-.5)*h;u.add(s(l+t))}return a=.5*(a+(t-e)*u.getResult()/m),o[0]*=2,a}function ct(e,t,s,i,r,o,a){let m=0,h=Math.abs(r-s[e]);const l=n.makePrimitiveArray(t,Number.NaN),u=n.makePrimitiveArray(t,Number.NaN);for(let n=0;n<t;++n){const t=Math.abs(r-s[e+n]);t<h&&(m=n,h=t),l[n]=i[e+n],u[n]=i[e+n]}let c=0,g=0,d=0;o[0]=i[e+m],m--;for(let n=1;n<t;n++){for(let i=0;i<t-n;i++){if(g=s[e+i]-r,d=s[e+i+n]-r,c=g-d,0===c)return!1;const t=(l[i+1]-u[i])/c;l[i]=g*t,u[i]=d*t}if(2*(m+1)<t-n){const e=m+1;a[0]=l[e]}else{const e=m;a[0]=u[e],m--}o[0]+=a[0]}return!0}class gt{constructor(){this.area=Number.NaN,this.centroid_x=Number.NaN,this.centroid_y=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}}let dt=class{constructor(e,t){this.b=e,this.len=t}getMaxDerivative(){return 1}getValue(e,t){return 0===e?this.len-xt(this.b,t,!1):0}getError(e){return t.geometryReleaseAssert(0),0}};function pt(e,t,s,i,r){let o=!0;const a=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(a);let m=o?0:1,h=a[1][m]-a[0][m],l=a[2][m]-a[0][m];const u=lt(5,t,s,i,r,e=>{let t;if(e<=.5){const s=n.lerpLo(0,h,e),i=n.lerpLo(h,l,e);t=n.lerpLo(s,i,e)}else{const s=n.lerpHi(0,h,e),i=n.lerpHi(h,l,e);t=n.lerpHi(s,i,e)}return t*Dt(a,1,e).length()});o=!1,m=o?0:1,h=a[1][m]-a[0][m],l=a[2][m]-a[0][m];const c=lt(5,t,s,i,r,e=>{let t;if(e<=.5){const s=n.lerpLo(0,h,e),i=n.lerpLo(h,l,e);t=n.lerpLo(s,i,e)}else{const s=n.lerpHi(0,h,e),i=n.lerpHi(h,l,e);t=n.lerpHi(s,i,e)}return t*Dt(a,1,e).length()});return new n.Point2D(u,c)}function _t(e){e.m_cachedValues=null}function ft(e){if(e.m_cachedValues)return e.m_cachedValues;const t=new gt;return yt(e,t.specialPoints),wt(e,t),t}function yt(e,t){const s=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(s);const i=n.makeObjectArray(n.ECoordinate,8);i[0].set(0);let r=1;{const e=n.makeObjectArray(n.ECoordinate,3);!function(e,t,s=!1){const i=new n.ECoordinate(e[1][0]).subE(new n.ECoordinate(e[0][0]));t[1]=i.mul(2),t[2]=new n.ECoordinate(e[2][0]).subE(new n.ECoordinate(e[1][0])).subE(i),s?t[0].set(0):t[0].set(e[0][0])}(s,e,!1);const t=n.makeObjectArray(n.ECoordinate,2),o=new n.Envelope1D(0,1);let a=Ae(e[2].mul(2),e[1],o,t[0]);a<0&&(a=0);for(let e=0;e<a;e++)n.isOneOf(t[e].value(),0,1)||(i[r]=t[e],r++)}{const e=n.makeObjectArray(n.ECoordinate,3);!function(e,t,s=!1){const i=new n.ECoordinate(e[1][1]).subE(new n.ECoordinate(e[0][1]));t[1]=i.mul(2),t[2]=new n.ECoordinate(e[2][1]).subE(new n.ECoordinate(e[1][1])).subE(i),s?t[0].set(0):t[0].set(e[0][1])}(s,e,!1);const t=n.makeObjectArray(n.ECoordinate,2),o=new n.Envelope1D(0,1);let a=Ae(e[2].mul(2),e[1],o,t[0]);a<0&&(a=0);for(let e=0;e<a;e++)n.isOneOf(t[e].value(),0,1)||(i[r]=t[e],r++)}if(i[r].set(1),r++,r>2){n.sortRange(i,0,r,(e,t)=>e.value()-t.value());let e=0,t=i[0].value(),s=1;for(let n=1;n<r;n++)i[n].eq(i[n-1])?(t+=i[n].value(),s++):(s>1&&(t/=s,i[e].set(t)),e++,i[e]=i[n],t=i[n].value(),s=1);e++,r=e}i[0].set(0),i[r-1].set(1),t.length=r;for(let e=0;e<r;e++)t[e]=i[e].value()}function xt(e,t,s){const i=n.makeObjectArray(n.Point2D,3);return e.queryControlPoints(i),Pt(i,t,s)}function Pt(e,t,s){if(s){if(t<0)return t;if(t>1)return t-1+Pt(e,1,!1)}if(1===t)return Et(e);const i=n.makeObjectArray(n.Point2D,3);return kt(e,t,i,null),Et(i)}function Et(e){if(e[0].equals(e[1]))return n.Point2D.distance(e[2],e[0]);if(e[1].equals(e[2]))return n.Point2D.distance(e[0],e[2]);const t=n.Point2D.distance(e[0],e[1])+n.Point2D.distance(e[2],e[1]),s=n.Point2D.distance(e[0],e[2]);if(t-s<=t*Number.EPSILON)return s;const i=n.makeObjectArray(n.Point2D,3);Xt(e,i,!0);const r=4*(n.sqr(i[2].x)+n.sqr(i[2].y)),o=2*(i[2].x*i[1].x+i[2].y*i[1].y),a=n.sqr(i[1].x)+n.sqr(i[1].y);if(1e-14*(Math.abs(o)+Math.abs(a))>=Math.abs(r))return 1e-14*Math.abs(a)>=Math.abs(o)?1*Math.sqrt(a):2/(3*o)*(Math.pow(1*o+a,1.5)-Math.pow(a,1.5));const m=o/r,h=a/r,l=h-m*m,u=1+m;if(0===l)return m>=0&&u>=0||m<=0&&u<=0?Math.abs(.5*Math.sqrt(r)*(u*u-m*m)):.5*Math.sqrt(r)*(u*u+m*m);const c=Math.sqrt(l+u*u),g=Math.sqrt(h);return.5*Math.sqrt(r)*(u*c-m*g+l*Math.log(Math.abs((u+c)/(m+g))))}function vt(e,t){const s=n.snap(t,0,1);let i=Dt(e,1,s);return i.isZero()&&(i=Dt(e,2,s)),i}function Ct(e,t,s){const i=n.makeObjectArray(n.Point2D,3);return e.queryControlPoints(i),Dt(i,t,s)}function Dt(e,t,s){if(1===t){const t=e[1].sub(e[0]).mul(1-s).add(e[2].sub(e[1]).mul(s));return t.mulThis(2),t}return 2===t?e[2].sub(e[1]).sub(e[1].sub(e[0]).mul(2)):n.Point2D.construct(0,0)}function bt(e){const t=n.makeObjectArray(n.Point2D,3);return e.queryControlPoints(t),St(t)}function St(e){return-e[1].sub(e[0]).crossProduct(e[2].sub(e[0]))/3}function It(e){return e.m_cachedValues}function wt(e,t){e.m_cachedValues=t}function Tt(e,s,i,r,o){t.checkAndThrow(n.Envelope1D.unit().contains(i),"QuadraticBezierHelper::getClosestCoordinateSegment");const a=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(a);let m=Number.MAX_VALUE;const h=[0],l=At(a,s,h);if(i.containsCoordinate(h[0]))m=n.Point2D.distance(s,l);else{h[0]=i.vmin,Bt(a,h[0],l),m=n.Point2D.distance(l,s);const e=new n.Point2D;Bt(a,i.vmax,e);const t=n.Point2D.distance(e,s);m>t&&(l.setCoordsPoint2D(e),h[0]=i.vmax,m=t)}if(!r)return h[0];if(i.vmin<=0){const t=new n.Point2D;e.queryCoord2DExtended(-1,t,!0);const r=new n.Point2D;e.queryCoord2D(i.vmin,r);const o=new Gr({start:t,end:r}),a=o.getClosestCoordinate(s,!0);if(a<1){const e=o.getCoord2D(a),t=n.Point2D.distance(e,s);t<m&&(m=t,h[0]=a-1,l.assign(e))}}if(i.vmin>=1){const t=new n.Point2D;e.queryCoord2DExtended(2,t,!0);const r=new n.Point2D;e.queryCoord2D(i.vmax,r);const o=new Gr({start:r,end:t}),a=o.getClosestCoordinate(s,!0);if(a>0){const e=o.getCoord2D(a),t=n.Point2D.distance(e,s);t<m&&(m=t,h[0]=1+a,l.assign(e))}}return h[0]}function At(e,t,s){const i=e[2].sub(e[1]).sub(e[1].sub(e[0])),r=e[1].sub(e[0]),o=e[0].sub(t),a=o.dotProduct(r),m=o.dotProduct(i)+2*r.dotProduct(r),h=3*r.dotProduct(i),l=i.dotProduct(i),u=n.makePrimitiveArray(3,Number.NaN),c=be(l,h,m,a,n.Envelope1D.unit(),!1,u),g=e[0].clone();let d=0,p=n.Point2D.sqrDistance(e[0],t),_=n.Point2D.sqrDistance(e[2],t);_<p&&(d=1,g.assign(e[2]),p=_);for(let s=0;s<c;s++){const i=new n.Point2D;Bt(e,u[s],i),_=n.Point2D.sqrDistance(i,t),_<p&&(p=_,g.assign(i),d=u[s])}return s&&(s[0]=d),g}function Nt(e,t,s){if(t.equalsRange(0,1))return void s.setFromPoints(e,3);const i=n.makeObjectArray(n.Point2D,3);Ft(e,t.vmin,t.vmax,i),s.setFromPoints(i,3)}function Gt(e,t,s){s.setEmpty();const i=[];i.push(new n.Envelope1D(0,1));const r=.5*Math.max(t.width(),t.height());for(;i.length;){const o=i.at(-1);i.pop();const a=new d;if(Nt(e,o,a),a.isIntersectingW(t)){const e=Math.max(a.width(),a.height());if(t.containsW(a)||e<=r||o.width()<1e-12)s.merge(o);else{const e=o.getCenter();i.push(n.Envelope1D.construct(o.vmin,e)),i.push(n.Envelope1D.construct(e,o.vmax))}}}}function Mt(e){const t=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(t);const s=Rt(t);return s&&(e.m_cp.setCoordsPoint2D(t[1]),e.afterCompletedModification()),s}function Rt(e){let t=!1;for(let s=0;s<2;s++){const i=n.compareNoNANs(e[0][s],e[2][s]);i>0?(n.compareNoNANs(e[0][s],e[1][s])<0&&(e[1][s]=e[0][s],t=!0),n.compareNoNANs(e[1][s],e[2][s])<0&&(e[1][s]=e[2][s],t=!0)):i<0?(n.compareNoNANs(e[0][s],e[1][s])>0&&(e[1][s]=e[0][s],t=!0),n.compareNoNANs(e[1][s],e[2][s])>0&&(e[1][s]=e[2][s],t=!0)):e[1][s]!==e[0][s]&&(e[1][s]=e[0][s],t=!0)}return t}function kt(e,t,s,i){(new n.Point2D).setCoordsPoint2D(e[0]),(new n.Point2D).setCoordsPoint2D(e[1]),(new n.Point2D).setCoordsPoint2D(e[2]);const r=new n.Point2D,o=new n.Point2D,a=new n.Point2D;if(n.lerpPoint2D(e[0],e[1],t,r),n.lerpPoint2D(e[1],e[2],t,o),n.lerpPoint2D(r,o,t,a),s&&(s[0].assign(e[0]),s[1].assign(r),s[2].assign(a)),i){const t=e[2];i[0].assign(a),i[1].assign(o),i[2].assign(t)}}function Ft(e,t,s,i){if(t===s){const s=new n.Point2D;return Bt(e,t,s),i[0]=s,i[1]=s,void(i[2]=s)}const r=n.makeObjectArray(n.Point2D,3);kt(e,s,r,null),kt(r,t/s,null,r),Bt(e,t,r[0]),Bt(e,s,r[2]),i[0].setCoordsPoint2D(r[0]),i[1].setCoordsPoint2D(r[1]),i[2].setCoordsPoint2D(r[2])}function qt(e,t,s,n,i){if(i){if(0!==br(t,s))return e?4:2}else if(C(t,s))return 1;return 0!==Ht(e,t,s,null,null,null,n,i??!1,0,!1)?4:0}function Vt(e,t,s,n,i){if(i){if(0!==br(t,s))return e?4:2}else if(C(t,s))return 1;return 0!==Ot(e,t,s,null,null,null,n,i??!1,0,!1)?4:0}function Ht(e,s,i,r,o,a,m,h,l,u){if(null!=o&&(o.length=0),null!==a&&(a.length=0),null!==r&&(r.length=0),i.isDegenerate(0)){const e=[0,0],t=s.intersectPoint(i.getStartXY(),e,m);if(t>0){if(null!==o)for(let s=0;s<t;s++)o.push(e[s]);if(null!==a)for(let e=0;e<t;e++)a.push(0);if(null!==r)for(let i=0;i<t;i++){const t=new n.Point2D;s.queryCoord2D(e[i],t),r.push(t)}}return t}const c=H(s,i);if(m=Math.max(m,c),s.isDegenerateToLineHelper(c)){const e=new Gr({start:s.getStartXY(),end:s.getEndXY()}),t=se(e,i,r,o,a,m,h,u);if(o)for(let n=0;n<t;++n){const t=e.getCoord2D(o[n]);o[n]=s.getClosestCoordinate(t,!1)}return t}if(O(s,i,m))return 0;const g=P.constructPoint2D(i.getStartXY()),d=P.constructPoint2D(i.getEndXY()).sub(g),p=d.clone();p.leftPerpendicularThis();const _=P.constructPoint2D(s.m_cp).sub(P.constructPoint2D(s.getStartXY())),f=P.constructPoint2D(s.getEndXY()).sub(P.constructPoint2D(s.m_cp));let y=_.dotProduct(p).toDouble(),x=f.sub(_).dotProduct(p).toDouble();const E=n.makePrimitiveArray(12,Number.NaN),v=n.makePrimitiveArray(12,Number.NaN);let C=function(e,t,s,i){const r=new n.ECoordinate,o=Ae(new n.ECoordinate(e),new n.ECoordinate(t),s,r);return i[0]=r.value(),o}(x,y,n.Envelope1D.unit(),E);C<0&&(E[0]=0,E[1]=1,C=2);let D,b=0;for(let e=0,t=b;e<C;++e){const r=s.getCoord2D(E[e+t]);v[b]=i.getClosestCoordinate(r,!1),n.Point2D.distance(r,i.getCoord2D(v[b]))<=m&&(E[b]=E[e+t],b++)}const S=n.makeObjectArray(n.Point2D,3);s.queryControlPoints(S);{const e=n.makeObjectArray(P,3);if(Lt(S,e,!1),e[0]=e[0].sub(g),d.x.abs().gte(d.y.abs())){const t=d.y.div(d.x);x=e[2].y.sub(e[2].x.mul(t)).toDouble(),y=e[1].y.sub(e[1].x.mul(t)).toDouble(),D=e[0].y.sub(e[0].x.mul(t)).toDouble()}else{const t=d.x.div(d.y);x=e[2].x.sub(e[2].y.mul(t)).toDouble(),y=e[1].x.sub(e[1].y.mul(t)).toDouble(),D=e[0].x.sub(e[0].y.mul(t)).toDouble()}}const I=s.getEndXY().equals(i.getStartXY())||s.getEndXY().equals(i.getEndXY()),w=[0,0];C=De(x,y,D,n.Envelope1D.unit(),I,w);for(let e=0,t=b;e<C;++e){E[e+t]=w[e];const r=s.getCoord2D(E[e+t]);v[b]=i.getClosestCoordinate(r,!1),n.Point2D.distance(r,i.getCoord2D(v[b]))<=m&&(E[b]=E[e+t],b++)}t.geometryReleaseAssert(b<E.length+4),C=s.intersectPoint(i.getStartXY(),w,m);for(let e=0;e<C;e++)E[b]=w[e],v[b++]=0;C=s.intersectPoint(i.getEndXY(),w,m);for(let e=0;e<C;e++)E[b]=w[e],v[b++]=1;C=i.intersectPoint(s.getStartXY(),w,m);for(let e=0;e<C;e++)v[b]=w[e],E[b++]=0;C=i.intersectPoint(s.getEndXY(),w,m);for(let e=0;e<C;e++)v[b]=w[e],E[b++]=0;return 0===b?0:Tr(e,s,i,E,v,b,r,o,a,m,h,0,u)}function Ot(e,t,s,i,o,a,m,h,l,u){if(Ki(s))return Ht(e,t,new Gr({start:s.getStartXY(),end:s.getEndXY()}),i,o,a,m,h,0,u);const c=H(t,s);if(O(t,s,m=Math.max(m,c)))return 0;const g=[],d=[],p=n.makeObjectArray(n.Point2D,3);{t.queryControlPoints(p);const e=n.makeObjectArray(n.Point2D,3),i=new r.Transformation2D;s.canonicToWorldTransformation(i);const o=new r.Transformation2D;o.setInvert(i),o.transformPoints2D(p,3,e);const a=n.makeObjectArray(P,3);Lt(e,a);const l=[a[0].x,a[1].x,a[2].x],u=[a[0].y,a[1].y,a[2].y],c=n.makeObjectArray(n.MPValue,3);c[0].setDouble(s.getSemiMinorAxis()),c[0].sqrThis(),c[1].setDouble(s.getSemiMajorAxis()),c[1].sqrThis(),c[2]=c[0],c[2].mul(c[1]),c[2].negate();const _=We(l,2,u,2,null,0,c,0,n.Envelope1D.unit(),n.Envelope1D.unit(),g,h);if(_>0){let e=0;for(let i=0;i<_;i++){const r=new n.Point2D;t.queryCoord2D(g[i],r);const o=s.getClosestCoordinate(r,!1),a=new n.Point2D;s.queryCoord2D(o,a),n.Point2D.distance(r,a)<=m&&(g[e]=g[i],d.push(o),e++)}g.length=e}}const _=[0,1];for(let e=0;e<2;e++){const t=0===e?s.getStartXY():s.getEndXY(),i=[0];At(p,t,i);const r=new n.Point2D;Bt(p,i[0],r),n.Point2D.distance(t,r)<=m&&(g.push(i[0]),d.push(_[e]))}for(let e=0;e<2;e++){const t=[0,2];{const i=s.getClosestCoordinate(p[t[e]],!1),r=new n.Point2D;s.queryCoord2D(i,r),n.Point2D.distance(p[t[e]],r)<=m&&(g.push(_[e]),d.push(i))}}return Tr(e,t,s,g,d,g.length,i,o,a,m,h,0,u)}function Yt(e,t,s,i,r,o,a,m,h,l){const u=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(u);const c=n.makeObjectArray(n.Point2D,3);if(s.queryControlPoints(c),Y(u,c,3)<0)return Yt(e,s,t,i,o,r,a,m,h,!l);const g=H(t,s);if(O(t,s,a=Math.max(a,g)))return 0;if(function(e,t,s,i,r,o,a,m,h){const l=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(l);const u=n.makeObjectArray(n.Point2D,3);if(t.queryControlPoints(u),l[0].equals(u[0])){if(l[1].equals(u[1])&&l[2].equals(u[2]))return s&&(s.length=0,s.push(l[0]),s.push(l[2])),i&&(i.length=0,i.push(0),i.push(1)),r&&(r.length=0,r.push(0),r.push(1)),!0;if(!l[0].equals(u[2]))return!1}return!!(l[0].equals(u[2])&&l[1].equals(u[1])&&l[2].equals(u[0]))&&(i&&(i.length=0,i.push(0),i.push(1),h&&(i[1]=n.swap(i[0],i[0]=i[1]))),r&&(r.length=0,r.push(1),r.push(0),h&&(r[1]=n.swap(r[0],r[0]=r[1]))),s&&(s.length=0,s.push(l[0]),s.push(l[2]),h&&(s[1]=n.swap(s[0],s[0]=s[1]))),!0)}(t,s,i,r,o,0,0,0,l))return 2;const p=new n.Envelope1D(0,1),_=new n.Envelope1D(0,1);{const e=new d;Nt(u,n.Envelope1D.unit(),e);const t=new d;Nt(c,n.Envelope1D.unit(),t);const s=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*a),t.inflate(3*a),!e.intersectW(t))return 0;if(e.maxDim()<.1*s){if(Gt(u,e,p),Gt(c,e,_),p.isEmpty()||_.isEmpty())return 0;Ft(u,p.vmin,p.vmax,u),Ft(c,_.vmin,_.vmax,c)}}const f=Ar(u,2,c,2,a);if(0===f)return 0;const y=[],x=[];if(-1===f){const e=n.makeObjectArray(P,3);Lt(u,e);const t=[e[0].x,e[1].x,e[2].x],s=[e[0].y,e[1].y,e[2].y],i=n.makeObjectArray(P,3);Lt(c,i);const r=je(t,2,s,2,null,0,[i[0].x,i[1].x,i[2].x],2,[i[0].y,i[1].y,i[2].y],2,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),y,x,l,0,l);if(r>0){let e=0;for(let t=0;t<r;t++){const s=new n.Point2D,i=new n.Point2D;Bt(c,x[t],i),Bt(u,y[t],s),n.Point2D.distance(s,i)<=a&&(y[e]=y[t],x[e]=x[t],e++)}y.length=e,x.length=e}}for(let e=0;e<2;e++){const t=0===e?u:c,s=0===e?c:u;for(let i=0;i<2;i++){const r=0===i?0:2,o=[0];At(s,t[r],o);const m=new n.Point2D;Bt(s,o[0],m),n.Point2D.distance(t[r],m)<=a&&(0===e?(y.push(0===r?0:1),x.push(o[0])):(x.push(0===r?0:1),y.push(o[0])))}}if(0===y.length)return 0;if(!p.equalsRange(0,1))for(let e=0;e<y.length;++e)y[e]=Le.recalculateParentT(p.vmin,p.vmax,y[e]);if(!_.equalsRange(0,1))for(let e=0;e<x.length;++e)x[e]=Le.recalculateParentT(_.vmin,_.vmax,x[e]);return Tr(e,t,s,y,x,y.length,i,r,o,a,m,0,l)}function Xt(e,t,s=!1){const n=e[1].sub(e[0]);t[1].assign(n.mul(2)),t[2].assign(e[2].sub(e[1]).sub(n)),s?t[0].setCoords(0,0):t[0].assign(e[0])}function Lt(e,t,s=!1){const i=P.constructPoint2D(e[1]),r=i.sub(P.constructPoint2D(e[0]));t[1]=r.mul(n.MPValue.constructInt32(2)),t[2]=P.constructPoint2D(e[2]).sub(i).sub(r),t[0]=s?new P(n.s_zero$1,n.s_zero$1):P.constructPoint2D(e[0])}function Bt(e,t,s,i){if(i){if(t<0)return void W(new Gr({start:e[0],end:e[0].add(vt(e,0).getUnitVector())}),t,s);if(t>1)return void W(new Gr({start:e[2],end:e[2].add(vt(e,1).getUnitVector())}),t-1,s)}if(t<=.5){const i=e[1].clone(),r=new n.Point2D;n.lerpPointLo(2,e[0],i,t,r);const o=new n.Point2D;n.lerpPointLo(2,i,e[2],t,o);const a=new n.Point2D;n.lerpPointLo(2,r,o,t,a),s.assign(a)}else{const i=e[1].clone(),r=new n.Point2D;n.lerpPointHi(2,e[0],i,t,r);const o=new n.Point2D;n.lerpPointHi(2,i,e[2],t,o);const a=new n.Point2D;n.lerpPointHi(2,r,o,t,a),s.assign(a)}}function zt(e,t){let s=1;e[1].isEqualPoint2D(e[0])&&(s=2,e[2].isEqualPoint2D(e[0])&&(s=3));let i=2;e[2].isEqualPoint2D(e[3])&&(i=1,e[1].isEqualPoint2D(e[3])&&(i=0)),t[0].assign(e[0]),t[2].assign(e[3]);const r=n.Point2D.intersectLinesAtOnePoint(e[0],e[s],e[i],e[3]),o=new n.Point2D;n.lerpPoint2D(e[0],e[3],.5,o);const a=new n.Point2D;Ys(e,.5,a);const m=new n.Point2D;t[1].assign(r),Bt(t,.5,m);const h=new n.Point2D;t[1].assign(o),Bt(t,.5,h);const l=n.Point2D.sqrDistance(a,m),u=n.Point2D.sqrDistance(a,h);return l<u?(t[1].setCoordsPoint2D(r),Math.sqrt(l)):(t[1].setCoordsPoint2D(o),Math.sqrt(u))}function Ut(e,t,s){s[0].assign(e[0]),s[1].assign(e[1]),s[2].assign(e[2]);const i=new n.Point2D;ii(e,t,.5,i);const r=new n.Point2D;Bt(s,.5,r);const o=n.Point2D.sqrDistance(i,r);return Math.sqrt(o)}const jt=[[.33998104358485626,.6521451548625461],[.8611363115940526,.34785484513745385]],Wt=[[.1834346424956498,.362683783378362],[.525532409916329,.31370664587788727],[.7966664774136267,.22238103445337448],[.9602898564975363,.10122853629037626]],Zt=[[.09501250983763744,.1894506104550685],[.2816035507792589,.18260341504492358],[.45801677765722737,.16915651939500254],[.6178762444026438,.14959598881657674],[.755404408355003,.12462897125553388],[.8656312023878318,.09515851168249279],[.9445750230732326,.062253523938647894],[.9894009349916499,.027152459411754096]],Qt=[[.04830766568773832,.0965400885147278],[.1444719615827965,.09563872007927486],[.23928736225213706,.09384439908080457],[.33186860228212767,.09117387869576389],[.42135127613063533,.08765209300440381],[.5068999089322294,.08331192422694675],[.5877157572407623,.07819389578707031],[.6630442669302152,.0723457941088485],[.7321821187402897,.06582222277636185],[.7944837959679424,.058684093478535544],[.84936761373257,.050998059262376175],[.8963211557660521,.04283589802222668],[.9349060759377397,.03427386291302143],[.9647622555875064,.02539206530926206],[.9856115115452684,.01627439473090567],[.9972638618494816,.007018610009470096]],Kt=[[.024350292663424433,.048690957009139724],[.07299312178779904,.04857546744150343],[.12146281929612056,.048344762234802954],[.16964442042399283,.04799938859645831],[.21742364374000708,.04754016571483031],[.2646871622087674,.04696818281621002],[.31132287199021097,.046284796581314416],[.3572201583376681,.04549162792741814],[.4022701579639916,.044590558163756566],[.4463660172534641,.04358372452932345],[.48940314570705296,.04247351512365359],[.5312794640198946,.04126256324262353],[.571895646202634,.03995374113272034],[.6111553551723933,.038550153178615626],[.6489654712546573,.03705512854024005],[.6852363130542333,.035472213256882386],[.7198818501716109,.033805161837141606],[.7528199072605319,.03205792835485155],[.7839723589433414,.030234657072402478],[.8132653151227975,.028339672614259483],[.8406292962525803,.02637746971505466],[.8659993981540928,.024352702568710874],[.8893154459951141,.022270173808383253],[.9105221370785028,.02013482315353021],[.9295691721319396,.017951715775697343],[.9464113748584028,.015726030476024718],[.9610087996520538,.013463047896718643],[.973326827789911,.011168139460131128],[.983336253884626,.008846759826363947],[.9910133714767443,.006504457968978363],[.9963401167719553,.004147033260562468],[.9993050417357722,.001783280721696433]],$t=[[.012223698960615764,.024446180196262518],[.03666379096873349,.024431569097850044],[.06108196960413957,.02440235563384958],[.08546364050451549,.024358557264690626],[.10979423112764375,.024300200167971867],[.13405919946118777,.02422731922281525],[.15824404271422493,.024139957989019287],[.18233430598533718,.024038168681024052],[.2063155909020792,.023922012136703457],[.23017356422666,.023791557781003402],[.2538939664226943,.023646883584447616],[.2774626201779044,.02348807601653591],[.3008654388776772,.02331522999406276],[.32408843502441337,.023128448824387027],[.3471177285976355,.022927844143686846],[.369939555349859,.02271353585023646],[.39254027503326744,.022485652032744968],[.414906379552275,.022244328893799764],[.43702450103710416,.02198971066846049],[.4588814198335522,.021721949538052076],[.48046407240417205,.02144120553920846],[.5017595591361445,.02114764646822135],[.5227551520511755,.02084144778075115],[.5434383024128103,.02052279248696007],[.5637966482266181,.020191871042130043],[.5838180216287631,.01984888123283086],[.6034904561585486,.019494028058706602],[.6228021939105849,.019127523609950944],[.6417416925623075,.01874958694054471],[.660297632272646,.01836044393733134],[.6784589224477192,.017960327185008687],[.6962147083695144,.017549475827117706],[.7135543776835874,.01712813542311138],[.7304675667419088,.016696557801589205],[.746944166797062,.016255000909785187],[.7629743300440948,.015803728659399347],[.7785484755064119,.015343010768865144],[.7936572947621933,.014873122602147314],[.8082917575079137,.014394345004166847],[.8224431169556439,.013906964132951985],[.8361029150609068,.013411271288616333],[.8492629875779689,.012907562739267348],[.8619154689395485,.012396139543950923],[.8740527969580318,.01187730737274028],[.8856677173453972,.011351376324080417],[.8967532880491582,.010818660739503076],[.9073028834017568,.010279479015832158],[.9173101980809605,.009734153415006806],[.9267692508789478,.009183009871660874],[.9356743882779164,.00862637779861675],[.9440202878302202,.008064589890486059],[.9518019613412644,.0074979819256347285],[.9590147578536999,.006926892566898814],[.9656543664319652,.006351663161707189],[.9717168187471366,.005772637542865698],[.9771984914639074,.00519016183267633],[.9820961084357185,.004604584256702955],[.9864067427245862,.004016254983738642],[.9901278184917344,.0034255260409102157],[.9932571129002129,.0028327514714579912],[.9957927585349812,.0022382884309626186],[.997733248625514,.0016425030186690294],[.9990774599773758,.0010458126793403489],[.9998248879471319,.00044938096029209035]];function Jt(e,t,s,i){const r=.5*(i-s),o=s+r,a=new n.KahanSummator(0);for(let s=0,i=Math.trunc(e/2);s<i;++s){let i,m;switch(e){case 4:i=jt[s][0],m=jt[s][1];break;case 8:i=Wt[s][0],m=Wt[s][1];break;case 16:i=Zt[s][0],m=Zt[s][1];break;case 32:i=Qt[s][0],m=Qt[s][1];break;case 64:i=Kt[s][0],m=Kt[s][1];break;case 128:i=$t[s][0],m=$t[s][1];break;default:throw new Error("Quadrature_integral: invalid n")}const h=n.fma(-.5,i,o),l=n.fma(r,i,o);a.pe(t(h)*m),a.pe(t(l)*m)}return a.getResult()*r}class es extends fe{constructor(e){e?e.vd?(super({vd:e.vd,bPolygon:!0}),this.m_segmentBufferCTor=Mr):e.copy?(super({vd:e.copy.getDescription(),bPolygon:!0}),this.m_segmentBufferCTor=Mr,e.copy.copyTo(this)):e.move?(super({move:e.move}),this.m_segmentBufferCTor=Mr):e.envelope?t.throwNotImplementedException("envelope constructor not impl"):t.throwInternalErrorException("bad arg to polygon constructor"):(super({bPolygon:!0}),this.m_segmentBufferCTor=Mr)}assignMove(e){return e.copyTo(this),this}assignCopy(e){return e.copyTo(this),this}getBoundary(){return Ee(this)}getExteriorRingCount(){return this.getOGCPolygonCount()}getGeometryType(){return es.type}getDimension(){return 2}createInstance(){return new es({vd:this.getDescription()})}equals(e,t){return this.equalsBase(e,t)}}es.type=t.GeometryType.enumPolygon;var ts=s.VertexDescription;const ss=-1;class ns{constructor(e){this.m_shape=e}userSort(e,t,s){this.m_shape.sortVerticesSimpleByYHelper(s,e,t)}getValue(e){return this.m_shape.getY(e)}}class is{constructor(e){!function(e){return void 0!==e.parent}(e)?(this.m_parent=e.copy.m_parent,this.m_geometry=e.copy.m_geometry,this.m_path=e.copy.m_path,this.m_vertex=e.copy.m_vertex,this.m_index=e.copy.m_index,this.m_bSkipMultiPoints=e.copy.m_bSkipMultiPoints,this.m_firstVertex=e.copy.m_firstVertex,this.m_bFirst=!0,this.m_selection=e.copy.m_selection,this.m_bOneGeom=e.copy.m_bOneGeom):(this.m_parent=e.parent,this.m_geometry=e.geometry,this.m_path=e.path,this.m_vertex=e.vertex,this.m_firstVertex=e.firstVertex,this.m_index=e.selection?0:e.index,this.m_bSkipMultiPoints=e.bSkipMultiPoints,this.m_selection=e.selection,this.m_bOneGeom=e.bOneGeom,this.m_bFirst=!0)}moveToNextHelper(){for(this.m_path=this.m_parent.getNextPath(this.m_path),this.m_index=0;this.m_geometry!==ss;){for(;this.m_path!==ss;this.m_path=this.m_parent.getNextPath(this.m_path))if(this.m_vertex=this.m_parent.getFirstVertex(this.m_path),this.m_firstVertex=this.m_vertex,this.m_vertex!==ss)return this.m_vertex;if(this.m_bOneGeom)return ss;if(this.m_geometry=this.m_parent.getNextGeometry(this.m_geometry),this.m_geometry===ss)break;this.m_bSkipMultiPoints&&!t.isMultiPath(this.m_parent.getGeometryType(this.m_geometry))||(this.m_path=this.m_parent.getFirstPath(this.m_geometry))}return ss}nextSelection(){for(;this.m_index<this.m_parent.m_selectedVertices.length;){const e=this.m_parent.m_selectedVertices[this.m_index++];if(e!==ss&&(this.m_path=this.m_parent.getPathFromVertex(e),!this.m_bOneGeom||this.m_geometry===this.m_parent.getGeometryFromPath(this.m_path)))return this.m_geometry=this.m_parent.getGeometryFromPath(this.m_path),e}return ss}next(){return this.m_selection?this.nextSelection():this.m_bFirst?(this.m_bFirst=!1,this.m_vertex):this.m_vertex!==ss?(this.m_vertex=this.m_parent.getNextVertex(this.m_vertex),this.m_index++,this.m_vertex!==ss&&this.m_vertex!==this.m_firstVertex?this.m_vertex:this.moveToNextHelper()):ss}currentGeometry(){return this.m_geometry}currentPath(){return this.m_path}static create_(e,t,s,n,i,r,o,a,m){return new is({parent:e,geometry:t,path:s,vertex:n,firstVertex:i,index:r,bSkipMultiPoints:o,selection:a,bOneGeom:m})}}class rs{constructor(e){this.parentage=e}equals(e){return this.parentage===e.parentage}}class os{setPrevPath(e,t){this.m_pathIndexList.setField(e,1,t)}setNextPath(e,t){this.m_pathIndexList.setField(e,2,t)}setPathFlags(e,t){this.m_pathIndexList.setField(e,6,t)}getPathFlags(e){return this.m_pathIndexList.getField(e,6)}setPathGeometry(e,t){this.m_pathIndexList.setField(e,7,t)}getPathIndex(e){return this.m_pathIndexList.getField(e,0)}setNextGeometry(e,t){this.m_geometryIndexList.setField(e,1,t)}setPrevGeometry(e,t){this.m_geometryIndexList.setField(e,0,t)}getGeometryIndex(e){return this.m_geometryIndexList.getField(e,7)}setFirstPath(e,t){this.m_geometryIndexList.setField(e,3,t)}setLastPath(e,t){this.m_geometryIndexList.setField(e,4,t)}newGeometry(e){const t=this.m_geometryIndexList.newElement();return this.m_geometryIndexList.setField(t,2,e),this.m_geometryIndexList.setField(t,5,0),this.m_geometryIndexList.setField(t,6,0),this.m_geometryIndexList.setField(t,7,this.m_geometryIndexList.elementToIndex(t)),t}freeGeometry(e){this.m_geometryIndexList.deleteElement(e)}newPath(e){const t=this.m_pathIndexList.newElement(),s=this.m_pathIndexList.elementToIndex(t);if(this.m_pathIndexList.setField(t,0,s),this.m_pathIndexList.setField(t,3,0),this.m_pathIndexList.setField(t,6,0),this.setPathGeometry(t,e),s>=this.m_pathAreas.length){const e=Math.trunc(s<16?16:3*s/2);this.m_pathAreas.length=e,this.m_pathLengths.length=e}return this.m_pathAreas[s]=0,this.m_pathLengths[s]=0,this.m_pathCount++,t}freePath(e){this.m_pathIndexList.deleteElement(e),this.m_pathCount--}newVertex(e){const t=this.m_vertexIndexList.newElement(),s=e>=0?e:this.m_vertexIndexList.elementToIndex(t);if(this.m_vertexIndexList.setField(t,0,s),e<0){if(s>=this.m_vertices.getPointCount()){const e=Math.trunc(s<16?16:3*s/2);this.m_vertices.reserveRounded(e),this.m_vertices.resizeNoInit(e),null!==this.m_segments&&(this.m_segments.length=e),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0)}this.m_segments&&(this.m_segments[s]=null)}return this.m_pointCount++,t}freeVertex(e){this.unselect(e);const t=this.getVertexIndex(e);this.m_vertexIndexList.deleteElement(e),this.m_pointCount--;for(let e=0,s=this.m_indices.length;e<s;e++){if(e===this.m_selectionIndex)continue;const s=this.m_indices[e];null!==s&&s.size()>t&&s.write(t,-1)}this.m_weights&&this.m_weights.size()>t&&this.m_weights.write(t,1),this.m_ranks&&this.m_ranks.size()>t&&this.m_ranks.write(t,1),this.m_segmentWeights&&this.m_segmentWeights.size()>t&&this.m_segmentWeights.write(t,1),this.m_segmentRanks&&this.m_segmentRanks.size()>t&&this.m_segmentRanks.write(t,1),this.m_segments&&this.setSegmentToIndex(t,null)}insertVertex_(e,t,s,n){this.m_hasForceSetEnvelope=0;const i=t!==ss?this.getPrevVertex(t):this.getLastVertex(e),r=i!==ss?this.getNextVertex(i):ss,o=this.newVertex(null===s?this.m_pointCount:-1),a=this.getVertexIndex(o);null!==s&&this.m_vertices.setPointByValNoCurves(a,s),this.setPathToVertex(o,e),this.setNextVertex(o,r),this.setPrevVertex(o,i),r!==ss&&this.setPrevVertex(r,o),i!==ss&&this.setNextVertex(i,o);const m=this.isClosedPath(e),h=this.getFirstVertex(e);t===ss&&this.setLastVertex(e,o),t===h&&(m&&n&&h!==ss||this.setFirstVertex(e,o)),m&&r===ss&&(this.setNextVertex(o,o),this.setPrevVertex(o,o)),this.setPathSize(e,this.getPathSize(e)+1);const l=this.getGeometryFromPath(e);return this.setGeometryVertexCount(l,this.getPointCount(l)+1),o}getHelperPoint(){return this.m_helperPoint||(this.m_helperPoint=new s.Point({vd:this.m_vertices.getDescription()}),this.m_helperPoint.setXYCoords(0,0)),this.m_helperPoint}addMultiPoint(e,t){const s=this.createGeometry(e.getGeometryType(),e.getDescription());return this.appendMultiPoint(s,e,t),s}addPoint_(e,s){const n=this.createGeometry(t.GeometryType.enumMultiPoint,e.getDescription());return this.appendPoint(n,e,s),n}appendMultiPath_(e,t){if(t.isEmpty())return;const s=t.getImpl();this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+s.getPointCount()),this.m_verticesMp.addPoints(t,0,s.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);const n=null!==this.m_segments||null!==s.getSegmentFlagsStreamRef();this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+s.getPointCount()),this.m_pathIndexList.setCapacity(this.m_pathIndexList.size()+s.getPathCount());for(let t=0,i=s.getPathCount();t<i;t++){if(0===s.getPathSize(t))continue;const i=this.insertPath(e,ss);this.setClosedPath(i,s.isClosedPath(t));for(let e=s.getPathStart(t),r=s.getPathEnd(t);e<r;e++){const t=this.insertVertex_(i,ss,null,!1);if(n){const n=this.getVertexIndex(t);if(1&s.getSegmentFlags(e))this.setSegmentToIndex(n,null);else{const t=new Mr;s.querySegment(e,t,!0),this.setSegmentToIndex(n,t.releaseSegment())}}}s.isStrongPathStart(t)&&this.setStrongPathStart(i,!0),s.isStrongPathEnd(t)&&this.setStrongPathEnd(i,!0)}}addMultiPath(e,s){const n=this.createGeometry(e.getGeometryType(),e.getDescription());return e.getGeometryType()===t.GeometryType.enumPolygon&&this.setFillRule(n,e.getFillRule()),this.appendMultiPath(n,e,s),n}appendMultiPathPolyline(e,t,s){const n=t.getImpl(),r=null!==this.m_segments||null!==n.getSegmentFlagsStreamRef(),o=new i.Envelope2D;t.queryEnvelope(o);{const i=s.clone();let o=n.getPointCount();const a=n.getAccelerators();if(a&&a.getQuadTree()&&(o=a.getQuadTree().getIntersectionCount(i,0,n.getPointCount()+1)),o<t.getPointCount()){if(0===o)return;const s=n.queryLimitedSegmentIterator(i);let a=-1,m=-100,h=-1,l=0,u=-1,c=ss,g=!1,d=s.nextSegment();if(null!==d)for(;;d=s.nextSegment()){let i=null===d;const o=null!==d?s.getPathIndex():a,p=null!==d?s.getStartPointIndex():m;if(i||(a===o&&m+1===p?l++:i=!0),i){if(-1!==u){let e=-1,s=-1;if(l===h){this.setClosedPath(c,g);const i=n.getPathEnd(a);this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+i-u),this.m_verticesMp.addPoints(t,u,i),s=n.getPathSize(a),e=i-1}else if(!g||m+1<n.getPathEnd(a))this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+m+2-u),this.m_verticesMp.addPoints(t,u,m+2),s=m-u+2,e=m;else{this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+m+2-u),this.m_verticesMp?.addPoints(t,u,m+1),e=m,s=m-u+1;const i=n.getPathStart(a);this.m_verticesMp.addPoints(t,i,i+1),s+=1}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);for(let t=0,i=u;t<s;t++,i++){const t=this.insertVertex_(c,ss,null,!1);if(r){const s=this.getVertexIndex(t);if(1&n.getSegmentFlags(i)||i>e)this.setSegmentToIndex(s,null);else{const e=new Mr;n.getSegmentBuffer(i,e,!0),this.setSegmentToIndex(s,e.releaseSegment())}}}}if(null===d)break;l=1,u=p,a!==o?(c=this.insertPath(e,ss),this.setClosedPath(c,!1),h=n.getSegmentCountPath(o),g=n.isClosedPath(o),a=o):c=this.insertPath(e,ss)}m=p}return}}this.appendMultiPath_(e,t)}appendMultiPathPolygon(e,s,r){const o=s.getImpl(),a=null!==this.m_segments||null!==o.getSegmentFlagsStreamRef(),m=i.Envelope2D.constructEmpty();s.queryEnvelope(m),t.geometryReleaseAssert(r.isIntersecting(m)&&!r.containsEnvelope(m));let h=i.Envelope2D.construct(Number.NEGATIVE_INFINITY,r.ymin,Number.POSITIVE_INFINITY,r.ymax),l=i.Envelope2D.construct(r.xmin,Number.NEGATIVE_INFINITY,r.xmax,Number.POSITIVE_INFINITY);const u=o.getAccelerators();if(u&&u.getQuadTree()){const e=u.getQuadTree(),t=e.getIntersectionCount(h,0,0);t>e.getIntersectionCount(l,0,t+1)&&(l=n.swap(h,h=l))}else h.height()>l.width()&&(l=n.swap(h,h=l));const c=[],g=o.queryLimitedSegmentIterator(h);let d=-1,p=-100,_=-1,f=0,y=-1,x=-1,P=ss,E=!0,v=g.nextSegment();if(null!==v)for(;;v=g.nextSegment()){let r=null===v;const m=null!==v?g.getPathIndex():d,h=null!==v?g.getStartPointIndex():p;if(r||(m===d?p+1===h?f++:r=!0:(r=d>=0,d<0&&(d=m,_=o.getSegmentCountPath(d),y=h,P=ss,f=1))),r){if(0!==c.length||_!==f){0!==c.length&&c[0].first===y||(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(s,y,y+1),-1===x&&(x=y),P===ss&&(P=this.insertPath(e,ss),this.setClosedPath(P,!0)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.insertVertex_(P,ss,null,!1));for(const{first:n,second:i}of c){-1===x&&(x=n);let r=-1,m=-1;const h=n+i-1;if(i===_){const e=h+1;m=e-n,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+m),this.m_verticesMp.addPoints(s,n,e),r=h,t.geometryReleaseAssert(1===c.length)}else if(h+1<o.getPathEnd(d)){const e=h+2;m=e-n,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+m),this.m_verticesMp.addPoints(s,n,e),r=h}else{const e=o.getPathStart(d),t=e!==x?1:0,i=h+1;m=i-n+t,this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+(i-n)+t),this.m_verticesMp.addPoints(s,n,i),r=h,t>0&&this.m_verticesMp?.addPoints(s,e,e+1)}this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),P===ss&&(P=this.insertPath(e,ss),this.setClosedPath(P,!0));for(let e=0,t=n;e<m;e++,t++){const e=this.insertVertex_(P,ss,null,!1);if(a){const s=this.getVertexIndex(e);if(1&o.getSegmentFlags(t)||t>r)this.setSegmentToIndex(s,null);else{const e=new Mr;o.getSegmentBuffer(t,e,!0),this.setSegmentToIndex(s,e.releaseSegment())}}}}if(0===c.length||c.at(-1).first+c.at(-1).second!==y+f){let e=y+f;e===s.getPathEnd(d)&&(e=s.getPathStart(d)),x!==e&&(this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.addPoints(s,e,e+1),this.insertVertex_(P,ss,null,!1))}}c.length=0,E=!0,m!==d&&(d=m,_=o.getSegmentCountPath(d),P=ss,x=-1),y=h,f=1}if(!v)break;{const e=i.Envelope2D.constructEmpty();v.queryLooseEnvelope(e),l.isIntersecting(e)?(E?c.push(n.makePair(h,1)):c.at(-1).second++,E=!1):E=!0}p=h}}appendMultiPath(e,s,n){if(void 0===n)return void this.appendMultiPath_(e,s);if(s.isEmpty())return;const r=s.getGeometryType()===t.GeometryType.enumPolygon,o=i.Envelope2D.constructEmpty();s.queryEnvelope(o),n.isIntersecting(o)&&(!n.containsEnvelope(o)&&s.getPointCount()>10?r?this.appendMultiPathPolygon(e,s,n):this.appendMultiPathPolyline(e,s,n):this.appendMultiPath_(e,s))}appendPoint(e,t,s){if(t.isEmpty())return;if(void 0!==s&&!s.contains(t.getXY()))return;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+1),this.m_verticesMp.add(t),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+1);const n=this.insertPath(e,ss);this.insertVertex_(n,ss,null,!1)}appendMultiPoint_(e,t){this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+t.getPointCount()),this.m_verticesMp.addPoints(t,0,t.getPointCount()),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+t.getPointCount());const s=this.insertPath(e,ss);for(let e=0,n=t.getPointCount();e<n;e++)this.insertVertex_(s,ss,null,!1)}appendMultiPoint(e,t,s){if(void 0===s)return void this.appendMultiPoint_(e,t);const n=t.getAttributeStreamRef(0);let i=0;for(let e=0,r=t.getPointCount();e<r;e++){const t=n.readPoint2D(2*e);s.contains(t)&&i++}this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+i);let r=-1,o=-1,a=0;for(let e=0,i=t.getPointCount();e<i;e++){const i=n.readPoint2D(2*e);s.contains(i)?(-1===r&&(r=e,o=e),o++):r>=0&&(this.m_verticesMp.addPoints(t,r,o-r),r=-1,a++)}if(r>0&&(this.m_verticesMp.addPoints(t,r,o-r),a++),!a)return;this.m_xyStream=this.m_vertices.getAttributeStreamRef(0),this.m_vertexIndexList.setCapacity(this.m_vertexIndexList.size()+i);const m=this.insertPath(e,ss);for(let e=0,i=t.getPointCount();e<i;e++){const t=n.readPoint2D(2*e);s.contains(t)&&this.insertVertex_(m,ss,null,!1)}}splitSegmentForward(e,s,n,i,r){const o=this.getNextVertex(e);o===ss&&t.throwInvalidArgumentException("Edit_shape.split_segment_forward_");const a=this.getHelperPoint(),m=this.getPathFromVertex(e);let h=e;const l=this.hasSegmentParentage();for(let e=0,i=s.getResultSegmentCount(n);e<i;e++){const u=this.getVertexIndex(h),c=this.getNextVertex(h),g=s.getResultSegment(n,e);let d=null;if(g.getGeometryType()!==t.GeometryType.enumLine&&(d=g.clone(),d.dropAllAttributes()),0===e&&(g.queryStart(a),this.setSegmentToIndex(u,null),this.setPointEx(h,a,s.getResultSegmentStartPointRank(n,e),s.getResultSegmentStartPointWeight(n,e),r)),this.setSegmentRank(h,s.getResultSegmentInteriorRank(n,e)),this.setSegmentWeight(h,s.getResultSegmentInteriorWeight(n,e)),l){const t=s.getResultSegmentSegmentParentage(n,e),i=s.getResultSegmentStartPointIsBreak(n,e);this.setSegmentParentageAndBreak(h,t,i)}if(g.queryEnd(a),e<i-1){this.setSegmentToIndex(u,d);const t=this.insertVertex(m,c,a);this.setWeight(t,s.getResultSegmentEndPointWeight(n,e)),this.setRank(t,s.getResultSegmentEndPointRank(n,e)),this.select(t),h=t}else{this.setPointEx(o,a,s.getResultSegmentEndPointRank(n,e),s.getResultSegmentEndPointWeight(n,e),r);const t=s.getResultSegmentEndPointIsBreak(n,e);this.setSegmentParentageBreakVertex(o,t),this.setSegmentToIndex(u,d)}}}splitSegmentBackward(e,s,n,i,r){const o=this.getNextVertex(e);o===ss&&t.throwInvalidArgumentException("Edit_shape.split_segment_backward_");const a=this.getHelperPoint(),m=this.getPathFromVertex(e);let h=e;const l=this.hasSegmentParentage();for(let e=0,i=s.getResultSegmentCount(n);e<i;e++){const u=i-e-1,c=this.getVertexIndex(h),g=this.getNextVertex(h),d=s.getResultSegment(n,u);let p=null;if(d.getGeometryType()!==t.GeometryType.enumLine&&(p=d.clone(),p.reverse(),p.dropAllAttributes()),0===e&&(d.queryEnd(a),this.setSegmentToIndex(c,null),this.setPointEx(h,a,s.getResultSegmentEndPointRank(n,u),s.getResultSegmentEndPointWeight(n,u),r),this.setSegmentParentageAndBreak(h,s.getResultSegmentSegmentParentage(n,u),s.getResultSegmentEndPointIsBreak(n,u))),d.getGeometryType()===t.GeometryType.enumLine?this.setSegmentToIndex(c,null):this.setSegmentToIndex(c,p),this.setSegmentRank(h,s.getResultSegmentInteriorRank(n,u)),this.setSegmentWeight(h,s.getResultSegmentInteriorWeight(n,u)),d.queryStart(a),e<i-1){const e=this.insertVertex(m,g,a);this.setWeight(e,s.getResultSegmentStartPointWeight(n,u)),this.setRank(e,s.getResultSegmentStartPointRank(n,u)),this.select(e),h=e,l&&this.setSegmentParentageAndBreak(e,s.getResultSegmentSegmentParentage(n,u),s.getResultSegmentEndPointIsBreak(n,u))}else this.setPointEx(o,a,s.getResultSegmentStartPointRank(n,u),s.getResultSegmentStartPointWeight(n,u),r)}}selected_(e){return this.getUserIndex(e,this.m_selectionIndex)>=0}allocateIndex(e=!0){if(this.m_deletedIndices.length){const t=this.m_deletedIndices.pop();return e&&t.setRange(-1,0,t.size()),t}return e?s.createIndexStream(0,-1):s.createIndexStream(0)}recycleUserIndex(e){this.m_deletedIndices.push(e)}allocatePathIndex(){if(this.m_deletedPathIndices.length){const e=this.m_deletedPathIndices.at(-1);return this.m_deletedPathIndices.pop(),e}return s.createIndexStream(0)}recyclePathUserIndex(e){this.m_deletedPathIndices.push(e)}peelALoop_(e,t,s){const i=this.getNextVertex(e),r=this.getNextVertex(t),o=this.getVertexIndex(e),a=this.getVertexIndex(t);if(this.setNextVertex(e,r),this.setPrevVertex(r,e),this.setNextVertex(t,i),this.setPrevVertex(i,t),this.m_segments){const e=this.getSegmentFromIndex(o),t=this.getSegmentFromIndex(a);this.setSegmentToIndex(a,null),this.setSegmentToIndex(o,t),this.setSegmentToIndex(a,e)}if(this.hasSegmentParentage()){let s=this.getSegmentParentage(t),i=this.getSegmentParentage(e);-1===s&&-1===i||(i=n.swap(s,s=i),this.setSegmentParentageAndBreak(e,i),this.setSegmentParentageAndBreak(t,s))}if(s){const t=this.getPathFromVertex(e),s=this.getGeometryFromPath(t),n=[!1],o=this.insertClosedPath(s,ss,i,this.getFirstVertex(t),n);n[0]&&this.setFirstVertex(t,r);let a=this.getPathSize(t);return a-=this.getPathSize(o),this.setPathSize(t,a),o}return ss}sortVerticesSimpleByYHelper(e,t,s){e.sort(t,s,(e,t)=>{let s=this.compareVerticesSimpleY(e,t);if(0===s){const n=this.getPathInternalIndexFromVertex(e),i=this.getPathInternalIndexFromVertex(t);s=n<i?-1:n>i?1:0}return s})}sortVerticesSimpleByYHelper3D(e,s,n){t.geometryReleaseAssert(0)}constructor(){this.m_verticesMp=null,this.m_vertices=null,this.m_xyStream=null,this.m_vertexDescription=null,this.m_segments=null,this.m_weights=null,this.m_ranks=null,this.m_segmentWeights=null,this.m_segmentRanks=null,this.m_indices=[],this.m_deletedIndices=[],this.m_pathAreas=[],this.m_pathLengths=[],this.m_pathindices=[],this.m_deletedPathIndices=[],this.m_geometryIndices=[],this.m_selectedVertices=[],this.m_helperPoint=null,this.m_forceSetEnvelope=s.Envelope3D.constructEmpty(),this.m_hasForceSetEnvelope=0,this.m_workPoint2D=n.Point2D.getNAN(),this.m_workPoint2_2D=n.Point2D.getNAN(),this.m_curveStitcher=null,this.m_pathCount=0,this.m_pointCount=0,this.m_firstGeometry=ss,this.m_lastGeometry=ss,this.m_vertexIndexList=new s.StridedIndexTypeCollection(5),this.m_pathIndexList=new s.StridedIndexTypeCollection(8),this.m_geometryIndexList=new s.StridedIndexTypeCollection(8),this.m_bHasAttributes=!1,this.m_selectedCount=0,this.m_selectionIndex=-1,this.m_selection=!1,this.m_bucketSort=new s.BucketSort,this.m_segmentParentageIndex=-1}getTotalPointCount(){return this.m_pointCount}getEnvelope2D(e){if(0!==this.m_hasForceSetEnvelope)return new i.Envelope2D(this.m_forceSetEnvelope.xmin,this.m_forceSetEnvelope.ymin,this.m_forceSetEnvelope.xmax,this.m_forceSetEnvelope.ymax);const t=this.hasCurves(),s=i.Envelope2D.constructEmpty(),n=this.queryVertexIterator();let r=!0;for(let e=n.next();e!==ss;e=n.next()){if(r?s.merge(this.getXY(e)):s.mergeNe(this.getXY(e)),t){const t=this.getSegment(e);if(null!==t){const e=i.Envelope2D.constructEmpty();t.queryLooseEnvelope(e),s.mergeEnvelope2D(e)}}r=!1}return s}getEnvelope3D(e){return t.geometryReleaseAssert(0),s.Envelope3D.constructEmpty()}forceSetEnvelope2D(e){this.m_hasForceSetEnvelope=1,this.m_forceSetEnvelope.setCoords(e.xmin,e.ymin,0,e.xmax,e.ymax,0)}forceSetEnvelope3D(e){t.geometryReleaseAssert(0)}forgetForceSetEnvelope(){this.m_hasForceSetEnvelope=0}getGeometryCount(){return this.m_geometryIndexList.size()}addGeometry(e,s){const n=e.getGeometryType();if(t.isMultiPath(n))return this.addMultiPath(e,s);if(n===t.GeometryType.enumMultiPoint)return this.addMultiPoint(e,s);if(n===t.GeometryType.enumPoint)return this.addPoint_(e,s);if(n===t.GeometryType.enumEnvelope){const t=new es;return t.addEnvelope(e,!1),this.addMultiPath(t,s)}t.throwInvalidArgumentException("")}appendGeometry(e,s){this.mergeVertexDescription(s.getDescription());const n=s.getGeometryType();t.isMultiPath(n)?this.appendMultiPath(e,s):n!==t.GeometryType.enumMultiPoint?t.throwInvalidArgumentException(""):this.appendMultiPoint(e,s)}assignRankToGeometryVertices(e,t){t<1&&(t=1);const s=this.queryVertexIterator();for(let e=s.next();e!==ss;e=s.next())this.setRank(e,t),this.setSegmentRank(e,t)}collapseAllGeometriesToFirst(){this.collapseGeometriesToFirst(t.GeometryType.enumUnknown)}collapseGeometriesToFirst(e){this.dbgVerifyVertexCounts();let s=ss,n=-1,i=-1;for(let r=this.getFirstGeometry();r!==ss;){if(e===t.GeometryType.enumUnknown||this.getGeometryType(r)===e){if(s===ss){s=r,n=this.getPathCount(s),i=this.getPointCount(s),r=this.getNextGeometry(r);continue}for(let e=this.getFirstPath(r);e!==ss;e=this.getNextPath(e))this.setPathGeometry(e,s);n+=this.getPathCount(r),i+=this.getPointCount(r);const e=this.getLastPath(s),t=this.getFirstPath(r);e!==ss?this.setNextPath(e,t):this.setFirstPath(s,t),t!==ss&&(this.setPrevPath(t,e),this.setLastPath(s,this.getLastPath(r))),this.setFirstPath(r,ss),this.setLastPath(r,ss);const o=r;r=this.getNextGeometry(r),this.setGeometryVertexCount(o,0),this.removeGeometry(o);continue}r=this.getNextGeometry(r)}return s!==ss&&(this.setGeometryVertexCount(s,i),this.setGeometryPathCount(s,n),this.dbgVerifyVertexCounts()),s}setFillRule(e,t){let s=this.m_geometryIndexList.getField(e,2);s&=-134217729,s|=1===t?134217728:0,this.m_geometryIndexList.setField(e,2,s)}getFillRule(e){return 134217728&this.m_geometryIndexList.getField(e,2)?1:0}setGeometryModified(e,t){let s=this.m_geometryIndexList.getField(e,2);!!(67108864&s)!==t&&(s&=-67108865,s|=t?67108864:0,this.m_geometryIndexList.setField(e,2,s))}getGeometryModified(e){return!!(67108864&this.m_geometryIndexList.getField(e,2))}setGeometryModifiedWithVertex(e,t){const s=this.getPathFromVertex(e),n=this.getGeometryFromPath(s);this.setGeometryModified(n,t)}getGeometryModifiedWithVertex(e){const t=this.getPathFromVertex(e),s=this.getGeometryFromPath(t);return this.getGeometryModified(s)}swapGeometry(e,t){const s=this.getFirstPath(e),n=this.getFirstPath(t),i=this.getLastPath(e),r=this.getLastPath(t);for(let s=this.getFirstPath(e);s!==ss;s=this.getNextPath(s))this.setPathGeometry(s,t);for(let s=this.getFirstPath(t);s!==ss;s=this.getNextPath(s))this.setPathGeometry(s,e);this.setFirstPath(e,n),this.setFirstPath(t,s),this.setLastPath(e,r),this.setLastPath(t,i);const o=this.getPointCount(e),a=this.getPathCount(e),m=this.getPointCount(t),h=this.getPathCount(t);this.setGeometryVertexCount(e,m),this.setGeometryVertexCount(t,o),this.setGeometryPathCount(e,h),this.setGeometryPathCount(t,a);const l=this.m_geometryIndexList.getField(e,2),u=this.m_geometryIndexList.getField(t,2);this.m_geometryIndexList.setField(e,2,u),this.m_geometryIndexList.setField(t,2,l)}addPathFromMultiPath(e,s,n){const i=this.createGeometry(n?t.GeometryType.enumPolygon:t.GeometryType.enumPolyline,e.getDescription()),r=e.getImpl();if(e.getPathSize(s)<2)return i;this.m_vertices.reserveRounded(this.m_vertices.getPointCount()+e.getPathSize(s)),this.m_verticesMp.addPoints(e,e.getPathStart(s),r.getPathEnd(s)),this.m_xyStream=this.m_vertices.getAttributeStreamRef(0);const o=this.insertPath(i,ss);this.setClosedPath(o,r.isClosedPath(s)||n);const a=null!==this.m_segments||null!==r.getSegmentFlagsStreamRef();for(let e=r.getPathStart(s),t=r.getPathEnd(s);e<t;e++){const t=this.insertVertex_(o,ss,null,!1);if(a){const s=this.getVertexIndex(t);if(1&r.getSegmentFlags(e))this.setSegmentToIndex(s,null);else{const t=new Mr;r.querySegment(e,t,!0),this.setSegmentToIndex(s,t.releaseSegment())}}}return r.isStrongPathStart(s)&&this.setStrongPathStart(o,!0),r.isStrongPathEnd(s)&&this.setStrongPathEnd(o,!0),i}getGeometry(e){const n=this.getGeometryType(e),i=function(e,n){let i,r=n,o=null;switch(r||(o=t.isMesh(e)?s.getDefaultDescription3D():s.getDefaultDescription2D(),r=o),e){case t.GeometryType.enumPoint:i=new s.Point({vd:r});break;case t.GeometryType.enumLine:i=new Gr({vd:r});break;case t.GeometryType.enumBezier:i=new pn({vd:r});break;case t.GeometryType.enumEllipticArc:i=new Ei({vd:r});break;case t.GeometryType.enumRationalBezier2:i=new Ye({vd:r});break;case t.GeometryType.enumBezier2:i=new Le({vd:r});break;case t.GeometryType.enumEnvelope:i=new s.Envelope({vd:r});break;case t.GeometryType.enumMultiPoint:i=new g({vd:r});break;case t.GeometryType.enumPolyline:i=new xe({vd:r});break;case t.GeometryType.enumPolygon:i=new es({vd:r});break;case t.GeometryType.enumMultipatch:t.throwNotImplementedException("multipatch not impl");break;case t.GeometryType.enumGeometryCollection:i=new z({vd:r});break;default:t.throwInvalidArgumentException("Geometry.create")}return i}(n,this.m_verticesMp.getDescription()),r=this.getPointCount(e);if(0===r)return i;if(t.isMultiPath(n)){const t=i.getImpl(),n=this.getPathCount(e),o=s.createIndexStream(n+1),a=s.createByteStream(n+1,0),m=i.getDescription(),h=this.hasCurves();for(let i=0,h=m.getAttributeCount();i<h;i++){const h=m.getSemantics(i),l=ts.getComponentCount(h),u=s.createAttributeStreamFromSemantics(h,r),c=this.m_vertices.getAttributeStreamRef(h);let g=0,d=0,p=0;for(let t=this.getFirstPath(e);t!==ss;t=this.getNextPath(t)){let e=0;this.isClosedPath(t)&&(e|=1),this.isExterior(t)&&(e|=8),this.isStrongPathStart(t)&&(e|=2),this.isStrongPathEnd(t)&&(e|=4),e&&a.setBits(d,e);const s=this.getPathSize(t);if(o.write(d++,p),p+=s,0===h){const e=c,s=u;let n;for(let i=this.getFirstVertex(t);g<p;i=this.getNextVertex(i),g++){const t=this.getVertexIndex(i);n=e.readPoint2D(2*t),s.writePoint2D(2*g,n)}}else for(let e=this.getFirstVertex(t);g<p;e=this.getNextVertex(e),g++){const t=this.getVertexIndex(e);for(let e=0;e<l;e++){const s=c.readAsDbl(t*l+e);u.writeAsDbl(g*l+e,s)}}}t.setAttributeStreamRef(h,u),o.write(n,r)}if(t.setPathFlagsStreamRef(a),t.setPathStreamRef(o),t.notifyModifiedFlags(65535),h){let s=0,n=0;for(let i=this.getFirstPath(e);i!==ss;i=this.getNextPath(i)){s+=this.getPathSize(i);for(let e=this.getFirstVertex(i);n<s;e=this.getNextVertex(e)){const s=this.getSegment(e);null!==s&&s.isCurve()&&t.replaceSegment(n,s,!0),n++}}}}else if(n===t.GeometryType.enumMultiPoint){const t=i.getImpl(),s=i.getDescription();t.reserve(r),t.resizeNoInit(r);for(let n=0,i=s.getAttributeCount();n<i;n++){const i=s.getSemantics(n),r=ts.getComponentCount(i),o=t.getAttributeStreamRef(i),a=this.m_vertices.getAttributeStreamRef(i);let m=0;const h=this.getFirstPath(e),l=this.getPathSize(h);for(let e=this.getFirstVertex(h);m<l;e=this.getNextVertex(e),m++){const t=this.getVertexIndex(e);for(let e=0;e<r;e++){const s=a.readAsDbl(t*r+e);o.writeAsDbl(m*r+e,s)}}t.setAttributeStreamRef(i,o)}t.notifyModifiedFlags(65535)}else t.throwInternalErrorException("getGeometry");return i}queryPointGeometryOnly(e,s){this.getGeometryType(e)!==t.GeometryType.enumMultiPoint&&t.throwInvalidArgumentException("get_point_geometry_only");const n=this.getPointCount(e);if(n>1&&t.throwInvalidArgumentException("get_point_geometry_only"),0===n)return s.assignVertexDescription(this.m_vertexDescription),void s.setEmpty();const i=this.getFirstPath(e),r=this.getFirstVertex(i);this.queryPoint(r,s)}removeGeometry(e){for(let t=this.getFirstPath(e);t!==ss;t=this.removePath(t));const t=this.getPrevGeometry(e),s=this.getNextGeometry(e);return t!==ss?this.setNextGeometry(t,s):this.m_firstGeometry=s,s!==ss?this.setPrevGeometry(s,t):this.m_lastGeometry=t,this.freeGeometry(e),s}createGeometry(e,t){void 0===t&&(t=s.getDefaultDescription2D());const n=this.newGeometry(e);return this.m_vertices||(this.m_verticesMp=new g({vd:t}),this.m_vertices=this.m_verticesMp.getImpl()),this.mergeVertexDescription(t),this.m_firstGeometry===ss?(this.m_firstGeometry=n,this.m_lastGeometry=n):(this.setPrevGeometry(n,this.m_lastGeometry),this.setNextGeometry(this.m_lastGeometry,n),this.m_lastGeometry=n),n}getFirstGeometry(){return this.m_firstGeometry}getLastGeometry(){return this.m_lastGeometry}getNextGeometry(e){return this.m_geometryIndexList.getField(e,1)}getPrevGeometry(e){return this.m_geometryIndexList.getField(e,0)}getGeometryType(e){return 16777215&this.m_geometryIndexList.getField(e,2)}setGeometryUserIndex(e,t,s){const n=this.m_geometryIndices[t],i=this.getGeometryIndex(e);i>=n.size()&&n.resize(Math.max(1.25*i,16),-1),n.write(i,s)}getGeometryUserIndex(e,t){const s=this.getGeometryIndex(e),n=this.m_geometryIndices[t];return s<n.size()?n.read(s):-1}createGeometryUserIndex(){for(let e=0;e<this.m_geometryIndices.length;e++)if(null===this.m_geometryIndices[e])return this.m_geometryIndices[e]=s.createIndexStream(0),e;this.m_geometryIndices.push(s.createIndexStream(0));const e=this.m_geometryIndices.length-1;return t.geometryReleaseAssert(e>=0&&e<=Number.MAX_SAFE_INTEGER),e}removeGeometryUserIndex(e){for(this.m_geometryIndices[e]=null;this.m_geometryIndices.length>0&&null===this.m_geometryIndices.at(-1);)this.m_geometryIndices.pop()}getFirstPath(e){return this.m_geometryIndexList.getField(e,3)}getLastPath(e){return this.m_geometryIndexList.getField(e,4)}hasPointFeatures(){for(let e=this.getFirstGeometry();e!==ss;e=this.getNextGeometry(e))if(!t.isMultiPath(this.getGeometryType(e)))return!0;return!1}getPointCount(e){return this.m_geometryIndexList.getField(e,5)}getPathCount(e){return this.m_geometryIndexList.getField(e,6)}filterClosePoints(e,s,i,r,o){const a=e*e;let m=0;const h=this.hasCurves(),l=this.hasSegmentParentage(),u=!0;for(let e=o===ss?this.getFirstGeometry():o;e!==ss;e=o===ss?this.getNextGeometry(e):ss){const o=this.getGeometryType(e);if(!t.isMultiPath(o))continue;if(i&&o!==t.GeometryType.enumPolygon)continue;const c=this.getGeometryType(e)===t.GeometryType.enumPolygon;let g=this.getGeometryModified(e);for(let i=this.getFirstPath(e);i!==ss;){let o=0;for(let s=this.getFirstVertex(i);o<Math.trunc(this.getPathSize(i)/2);){const c=this.getNextVertex(s);if(c===ss)break;const d=this.getXY(s),p=this.getXY(c);let _=n.Point2D.sqrDistance(d,p),f=!0;do{if(_<=a){if(h){const e=this.getSegment(s);if(null!==e){const t=e.calculateLength2D();if(_=t*t,_>a)break}}if(0===_?0===m&&(m=-1):m=1,c!==this.getLastVertex(i)){const n=l&&(this.getSegmentParentageBreakVertex(s)||this.getSegmentParentageBreakVertex(c));if(this.transferAllDataToTheVertex(c,s,u),this.removeVertex(c,!1),r&&!g&&(this.setGeometryModified(e,!0),g=!0),l&&s!==c){this.setSegmentParentageBreakVertex(s,n);const e=this.getNextVertex(s);t.geometryReleaseAssert(e!==ss),this.isDiscontinuousSegmentParentage(e)&&this.setSegmentParentageBreakVertex(e,!0)}}f=!1}}while(0);f&&(s=this.getNextVertex(s)),o++}let d=this.getFirstVertex(i);for(let s=this.isClosedPath(i)?d:this.getLastVertex(i);this.getPathSize(i)>0;){const o=this.getPrevVertex(s);if(o===ss)break;{const c=this.getXY(o),p=this.getXY(s);let _=n.Point2D.sqrDistance(c,p),f=!0;do{if(_<=a){if(h){const e=this.getSegment(o);if(null!==e){const t=e.calculateLength2D();if(_=t*t,_>a)break}}if(0===_?0===m&&(m=-1):m=1,l){t.geometryReleaseAssert(this.m_segmentParentageIndex>=0);const e=this.getUserIndex(s,this.m_segmentParentageIndex);this.transferAllDataToTheVertex(o,s,u),this.setUserIndex(s,this.m_segmentParentageIndex,e)}else this.transferAllDataToTheVertex(o,s,u);const n=l&&(this.getSegmentParentageBreakVertex(s)||this.getSegmentParentageBreakVertex(o));this.removeVertex(o,!0),r&&!g&&(this.setGeometryModified(e,!0),g=!0),l&&o!==s&&(n||this.isDiscontinuousSegmentParentage(s))&&this.setSegmentParentageBreakVertex(s,!0),d===o&&(d=this.getFirstVertex(i)),f=!1}}while(0);if(f&&(s=this.getPrevVertex(s),s===d))break}}const p=this.getPathSize(i);let _=s&&p<(c?3:2);_&&c&&2===p&&h&&(_=!this.pathHasCurves(i)),_?(i=this.removePath(i),0===m&&(m=-1),r&&!g&&(this.setGeometryModified(e,!0),g=!0)):i=this.getNextPath(i)}}return m}filterClosePoints3D(e,s,n,i,r,o){return t.geometryReleaseAssert(0),0}hasDegenerateSegments(e){for(let s=this.getFirstGeometry();s!==ss;s=this.getNextGeometry(s))if(t.isMultiPath(this.getGeometryType(s)))for(let t=this.getFirstPath(s);t!==ss;){const s=this.getPathSize(t);if(0===s)return!0;let n=this.getFirstVertex(t);for(let t=0;t<s;t++){const t=this.getNextVertex(n);if(t===ss)break;const s=this.getVertexIndex(n),i=this.getSegmentFromIndex(s);let r=0;if(null!==i){if(r=i.calculateLowerLength2D(),r<=e){if(r=i.calculateUpperLength2D(),r<=e)return!0;if(r=i.calculateLength2D(),r<=e)return!0}}else{const n=this.getVertexIndex(t);if(r=this.m_vertices.getShortestDistance(s,n),r<=e)return!0}n=t}t=this.getNextPath(t)}return!1}hasDegenerateSegments3D(e,s){return t.geometryReleaseAssert(0),!1}transferAllDataToTheVertex(e,t,s=!1){const n=this.getVertexIndex(e),i=this.getVertexIndex(t);if(s){let e=1,t=1;if(this.m_ranks&&(e=this.getRankWithIndex(n),t=this.getRankWithIndex(i)),e>t&&this.setRankWithIndex(i,e),e>=t&&this.m_weights){const s=this.getWeightWithIndex(n),r=this.getWeightWithIndex(i);(e>t||s>r)&&this.setWeightWithIndex(i,s)}}else{if(this.m_weights){const e=this.getWeightWithIndex(n);this.setWeightWithIndex(i,e)}if(this.m_ranks){const e=this.getRankWithIndex(n);this.setRankWithIndex(i,e)}}if(this.m_segmentWeights){const e=this.getSegmentWeightWithIndex(n);this.setSegmentWeightWithIndex(i,e)}if(this.m_segmentRanks){const e=this.getSegmentRankWithIndex(n);this.setSegmentRankWithIndex(i,e)}for(let s=0,n=this.m_indices.length;s<n;s++)if(s!==this.m_selectionIndex&&null!==this.m_indices[s]){const n=this.getUserIndex(e,s);this.setUserIndex(t,s,n)}const r=this.selected(e);r!==this.selected(t)&&(r?this.select(t):this.unselect(t))}splitSegmentAxisAware(e,s,n,i,r){let o=0;const a=this.getNextVertex(e);a===ss&&t.throwInvalidArgumentException("");const m=this.getVertexIndex(e),h=this.getVertexIndex(a),l=this.getSegmentFromIndex(m);let u=this.m_vertices.getShortestDistance(m,h);const c=this.getPathFromVertex(e),g=this.m_bHasAttributes;g&&l&&(u=l.calculateLength2D());const d=this.getSegmentParentage(e),p=this.getHelperPoint();if(l){let e=0,t=0,r=ss;for(let _=0;_<n;_++){const n=s[_];if(e<n&&n<1){const s=l.cut(e,n);if(null!==i&&(_>0&&s.setStartXY(i[_-1]),s.setEndXY(i[_]),s.normalizeAfterEndpointChange(),t=_),g){const e=u>0?l.calculateSubLengthFromStart(n)/u:0;this.m_vertices.interpolateTwoVertices(m,h,e,p)}p.setXY(s.getEndXY()),r=this.insertVertex(c,a,p),o++;const f=this.getPrevVertex(r),y=this.getVertexIndex(f);this.setSegmentToIndex(y,s),-1!==d&&this.setSegmentParentageAndBreak(r,d,!1),e=n}}if(r!==ss){const s=l.cut(e,1);null!==i&&(s.setStartXY(i[t]),s.normalizeAfterEndpointChange());const n=this.getVertexIndex(r);this.setSegmentToIndex(n,s)}}else{let e=0;for(let t=0;t<n;t++){const n=s[t];if(e<n&&n<1){this.m_vertices.interpolateTwoVertices(m,h,n,p);const e=this.insertVertex(c,a,p);o++,-1!==d&&this.setSegmentParentageAndBreak(e,d,!1)}e=n}}return o}splitSegment(e,t,s,n=null){return this.splitSegmentAxisAware(e,t,s,n,-1)}snapControlPoints(e,s,n){this.getNextVertex(e)===ss&&t.throwInvalidArgumentException("");let i=e,r=!1;for(let e=0;e<s;++e){const e=this.getVertexIndex(i),t=this.getSegmentFromIndex(e);if(t){const e=t.snapControlPoints(n);r||=e}i=this.getNextVertex(i)}return r}snapControlPointsOnSelection(e){if(!this.hasCurves())return!1;let t=0;const s=this.queryVertexIteratorOnSelection();for(let n=s.next();n!==ss;n=s.next()){const s=this.getVertexIndex(n),i=this.getSegmentFromIndex(s);i&&(t|=i.snapControlPoints(e)?1:0)}return 0!==t}calculateSubLength2D(e,s,n){return t.geometryReleaseAssert(0),0}setPoint(e,t,s){if(this.setPointOnly(e,t),null!==this.m_segments){const n=this.getVertexIndex(e),i=this.getSegmentFromIndex(n);null!==i&&(i.setStartXY(t.getXY()),i.normalizeAfterEndpointChange(),s&&i.ensureXYMonotone());const r=this.getPrevVertex(e);if(r!==ss){const e=this.getVertexIndex(r),n=this.getSegmentFromIndex(e);null!==n&&(n.setEndXY(t.getXY()),n.normalizeAfterEndpointChange(),s&&n.ensureXYMonotone())}}}setPointEx(e,t,s,n,i){this.setPoint(e,t,i);const r=this.getVertexIndex(e);this.setWeightWithIndex(r,n),this.setRankWithIndex(r,s)}setPointOnly(e,t){const s=this.getVertexIndex(e);this.m_vertices.setPointByValNoCurves(s,t)}setPointOnlyEx(e,s,n,i){t.geometryReleaseAssert(0)}queryPoint(e,t){const s=this.getVertexIndex(e);this.m_vertices.getPointByVal(s,t)}setXY(e,t){this.setXYCoords(e,t.x,t.y)}setXYCoords(e,t,s){const n=this.getVertexIndex(e);if(this.m_vertices?.setXYCoordsNoCurves(n,t,s),null!==this.m_segments){const i=this.getSegmentFromIndex(n);null!==i&&(i.setStartXYCoords(t,s),i.normalizeAfterEndpointChange());const r=this.getPrevVertex(e);if(r!==ss){const e=this.getVertexIndex(r),n=this.getSegmentFromIndex(e);null!=n&&(n.setEndXYCoords(t,s),n.normalizeAfterEndpointChange())}}}setXYMonotonic(e,t,s){const i=this.getVertexIndex(e);if(this.m_vertices.setXYCoordsNoCurves(i,t,s),null!==this.m_segments){const r=this.getSegmentFromIndex(i);if(null!==r){const e=r.getEndXY();r.setCoordsForIntersector(new n.Point2D(t,s),e,!1),r.ensureXYMonotone()}const o=this.getPrevVertex(e);if(o!==ss){const e=this.getVertexIndex(o),i=this.getSegmentFromIndex(e);if(null!==i){const e=i.getStartXY();i.setCoordsForIntersector(e,new n.Point2D(t,s),!1),i.ensureXYMonotone()}}}}setXYMonotonicPoint2D(e,t){this.setXYMonotonic(e,t.x,t.y)}queryXY(e,t){const s=this.getVertexIndex(e);return this.m_vertices.queryXY(s,t)}getXY(e){const t=this.getVertexIndex(e);return this.m_vertices.getXY(t)}getXYWithIndex(e){return this.m_xyStream.readPoint2D(2*e)}static setSegDefault(e,s,n){t.geometryReleaseAssert(0)}setXYZ(e,s,n){t.geometryReleaseAssert(0)}setXYZCoords(e,s,n,i){t.geometryReleaseAssert(0)}queryXYZ(e,s){t.geometryReleaseAssert(0)}getXYZ(e){return t.geometryReleaseAssert(0),s.Point3D.getNAN()}getXYZWithIndex(e){return t.geometryReleaseAssert(0),s.Point3D.getNAN()}mergeVertexDescription(e){this.m_verticesMp.mergeVertexDescription(e),this.m_vertexDescription=this.m_verticesMp.getDescription(),this.m_bHasAttributes=this.m_vertexDescription.getAttributeCount()>1}addAttribute(e){t.geometryReleaseAssert(0)}getAttributeAsDbl(e,t,s){return this.m_vertices.getAttributeAsDbl(e,this.getVertexIndex(t),s)}queryAttributeAsDbl(e,s,n,i){t.geometryReleaseAssert(0)}setAttribute(e,s,n,i){t.geometryReleaseAssert(0)}setAttributeInt(e,s,n,i){t.geometryReleaseAssert(0)}getVertexDescription(){return this.m_vertexDescription}getMinPathVertexY(e){return t.geometryReleaseAssert(0),0}getVertexIndex(e){return this.m_vertexIndexList.getField(e,0)}getY(e){const t=this.getVertexIndex(e);return this.m_vertices.queryXY(t,this.m_workPoint2D),this.m_workPoint2D.y}getX(e){return this.getXY(e).x}isEqualXY(e,t){return this.queryXY(e,this.m_workPoint2D),this.queryXY(t,this.m_workPoint2_2D),this.m_workPoint2D.isEqualPoint2D(this.m_workPoint2_2D)}isEqualXYPoint2D(e,t){return this.queryXY(e,this.m_workPoint2D),this.m_workPoint2D.isEqualPoint2D(t)}isEqualXYZPoint3D(e,s){return t.geometryReleaseAssert(0),!1}setWeight(e,t){t<1&&(t=1);const n=1===t;if(null==this.m_weights){if(n)return;this.m_weights=s.createDoubleStream(this.m_vertices.getPointCount(),1)}const i=this.getVertexIndex(e);if(i>=this.m_weights.size()){if(n)return;this.m_weights.resize(i+1,1)}this.m_weights.write(i,t)}setWeightWithIndex(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_weights){if(n)return;this.m_weights=s.createDoubleStream(this.m_vertices.getPointCount(),1)}if(e>=this.m_weights.size()){if(n)return;this.m_weights.resize(e+1,1)}this.m_weights.write(e,t)}getWeight(e){if(null===this.m_weights)return 1;const t=this.getVertexIndex(e);return t>=this.m_weights.size()?1:this.m_weights.read(t)}getWeightWithIndex(e){return null===this.m_weights||e>=this.m_weights.size()?1:this.m_weights.read(e)}getRank(e){if(null===this.m_ranks)return 1;const t=this.getVertexIndex(e);return t>=this.m_ranks.size()?1:this.m_ranks.read(t)}getRankWithIndex(e){return null===this.m_ranks||e>=this.m_ranks.size()?1:this.m_ranks.read(e)}setRank(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_ranks){if(n)return;this.m_ranks=s.createIndexStream(this.m_vertices.getPointCount(),1)}const i=this.getVertexIndex(e);if(i>=this.m_ranks.size()){if(n)return;this.m_ranks.resize(i+1,1)}this.m_ranks.write(i,t)}setRankWithIndex(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_ranks){if(n)return;this.m_ranks=s.createIndexStream(this.m_vertices.getPointCount(),1)}if(e>=this.m_ranks.size()){if(n)return;this.m_ranks.resize(e+1,1)}this.m_ranks.write(e,t)}setSegmentWeight(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_segmentWeights){if(n)return;this.m_segmentWeights=s.createDoubleStream(this.m_vertices.getPointCount(),1)}const i=this.getVertexIndex(e);if(i>=this.m_segmentWeights.size()){if(n)return;this.m_segmentWeights.resize(i+1,1)}this.m_segmentWeights.write(i,t)}setSegmentWeightWithIndex(e,t){t<1&&(t=1);const n=1===t;if(null==this.m_segmentWeights){if(n)return;this.m_segmentWeights=s.createDoubleStream(this.m_vertices.getPointCount(),1)}if(e>=this.m_segmentWeights.size()){if(n)return;this.m_segmentWeights.resize(e+1,1)}this.m_segmentWeights.write(e,t)}getSegmentWeight(e){if(null===this.m_segmentWeights)return 1;const t=this.getVertexIndex(e);return t>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(t)}getSegmentWeightWithIndex(e){return null==this.m_segmentWeights||e>=this.m_segmentWeights.size()?1:this.m_segmentWeights.read(e)}getSegmentRank(e){if(null===this.m_segmentRanks)return os.st_defaultRank;const t=this.getVertexIndex(e);return t>=this.m_segmentRanks.size()?os.st_defaultRank:this.m_segmentRanks.read(t)}getSegmentRankWithIndex(e){return null===this.m_segmentRanks||e>=this.m_segmentRanks.size()?1:this.m_segmentRanks.read(e)}setSegmentRank(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_segmentRanks){if(n)return;this.m_segmentRanks=s.createIndexStream(this.m_vertices.getPointCount(),1)}const i=this.getVertexIndex(e);if(i>=this.m_segmentRanks.size()){if(n)return;this.m_segmentRanks.resize(i+1,1)}this.m_segmentRanks.write(i,t)}setSegmentRankWithIndex(e,t){t<1&&(t=1);const n=1===t;if(null===this.m_segmentRanks){if(n)return;this.m_segmentRanks=s.createIndexStream(this.m_vertices.getPointCount(),1)}if(e>=this.m_segmentRanks.size()){if(n)return;this.m_segmentRanks.resize(e+1,1)}this.m_segmentRanks.write(e,t)}removeWeights(){this.m_weights=null,this.m_segmentWeights=null}removeRanks(){this.m_ranks=null,this.m_segmentRanks=null}setUserIndex(e,t,s){const n=this.m_indices[t],i=this.getVertexIndex(e);if(n.size()<=i){if(-1===s)return;n.resize(this.m_vertices.getPointCount(),-1)}n.write(i,s)}getUserIndex(e,t){const s=this.getVertexIndex(e),n=this.m_indices[t];return s<n.size()?n.read(s):-1}addToUserIndex(e,t,s){const n=this.m_indices[t],i=this.getVertexIndex(e);n.size()<=i&&n.resize(this.m_vertices.getPointCount(),-1);const r=n.read(i);n.write(i,r+s)}createUserIndex(){for(let e=0;e<this.m_indices.length;e++)if(null===this.m_indices[e])return this.m_indices[e]=this.allocateIndex(),e;this.m_indices.push(this.allocateIndex());const e=this.m_indices.length-1;return t.geometryReleaseAssert(e>=0&&e<=n.intMax()),e}createUserIndexUninitialized(){for(let e=0;e<this.m_indices.length;e++)if(null===this.m_indices[e])return this.m_indices[e]=this.allocateIndex(!1),e;this.m_indices.push(this.allocateIndex(!1));const e=this.m_indices.length-1;return t.geometryReleaseAssert(e>=0&&e<=Number.MAX_SAFE_INTEGER),e}fillUserIndexForGeometry(e,t,s){const n=this.m_indices[t],i=n.size();for(let t=this.getFirstPath(e);t!==ss;t=this.getNextPath(t)){let e=this.getFirstVertex(t);for(let r=0,o=this.getPathSize(t);r<o;r++,e=this.getNextVertex(e)){const t=this.getVertexIndex(e);t<i&&n.write(t,s)}}}fillUserIndexForSelection(e,s){t.geometryReleaseAssert(0)}removeUserIndex(e){for(this.recycleUserIndex(this.m_indices[e]),this.m_indices[e]=null;this.m_indices.length>0&&null===this.m_indices[this.m_indices.length-1];)this.m_indices.pop()}replaceCurveWithLine(e){if(null!==this.m_segments){const t=this.getVertexIndex(e);this.setSegmentToIndex(t,null)}}queryLineConnector(e,t,n=!1){const i=this.getNextVertex(e);if(i===ss)return!1;if(!this.m_bHasAttributes||n){const s=this.getXY(e);t.setStartXY(s);const n=this.getXY(i);t.setEndXY(n)}else{const n=new s.Point({vd:this.getVertexDescription()});this.queryPoint(e,n),t.setStart(n),this.queryPoint(i,n),t.setEnd(n)}return!0}queryLineConnector3D(e,s,n=!1){return t.geometryReleaseAssert(0),!1}hasCurves(){return null!==this.m_segments}geometryHasCurves(e){return t.geometryReleaseAssert(0),!1}pathHasCurves(e){if(!this.hasCurves())return!1;const s=this.getFirstVertex(e);if(s===ss)return!1;const n=this.getPathSize(e);let i=s;for(let e=0;e<n;e++,i=this.getNextVertex(i)){const e=this.getSegment(i);if(null!==e&&e.getGeometryType()!==t.GeometryType.enumLine)return!0}return!1}insertPath(e,s){let n=ss;s!==ss?(e!==this.getGeometryFromPath(s)&&t.throwInvalidArgumentException(""),n=this.getPrevPath(s)):n=this.getLastPath(e);const i=this.newPath(e);return s!==ss&&this.setPrevPath(s,i),this.setNextPath(i,s),this.setPrevPath(i,n),n!==ss?this.setNextPath(n,i):this.setFirstPath(e,i),s===ss&&this.setLastPath(e,i),this.setGeometryPathCount(e,this.getPathCount(e)+1),i}removePath(e){const t=this.getPrevPath(e),s=this.getNextPath(e),n=this.getGeometryFromPath(e);return t!==ss?this.setNextPath(t,s):this.setFirstPath(n,s),s!==ss?this.setPrevPath(s,t):this.setLastPath(n,t),this.clearPath(e),this.setGeometryPathCount(n,this.getPathCount(n)-1),this.freePath(e),s}clearPath(e){const t=this.getFirstVertex(e);if(t!==ss){let s=t;for(let t=0,n=this.getPathSize(e);t<n;t++){const e=s;s=this.getNextVertex(s),this.freeVertex(e)}const n=this.getGeometryFromPath(e);this.setGeometryVertexCount(n,this.getPointCount(n)-this.getPathSize(e))}this.setPathSize(e,0)}getNextPath(e){return this.m_pathIndexList.getField(e,2)}getPrevPath(e){return this.m_pathIndexList.getField(e,1)}getPathSize(e){return this.m_pathIndexList.getField(e,3)}isClosedPath(e){return!!(1&this.getPathFlags(e))}setClosedPath(e,t){if(this.isClosedPath(e)===t)return;if(this.getPathSize(e)>0){const s=this.getFirstVertex(e),n=this.getLastVertex(e);if(t){this.setNextVertex(n,s),this.setPrevVertex(s,n);const e=this.getVertexIndex(n);this.setSegmentToIndex(e,null)}else{this.setNextVertex(n,ss),this.setPrevVertex(s,ss);const e=this.getVertexIndex(n);this.setSegmentToIndex(e,null)}}const s=(1|this.getPathFlags(e))-1;this.setPathFlags(e,s|(t?1:0))}closeAllPaths(e){t.geometryReleaseAssert(0)}isStrongPathStart(e){return!!(8&this.getPathFlags(e))}isStrongPathEnd(e){return!!(16&this.getPathFlags(e))}setStrongPathStart(e,t){const s=(8|this.getPathFlags(e))-8;this.setPathFlags(e,s|(t?8:0))}setStrongPathEnd(e,t){const s=(16|this.getPathFlags(e))-16;this.setPathFlags(e,s|(t?16:0))}getGeometryFromPath(e){return this.m_pathIndexList.getField(e,7)}isExterior(e){return!!(2&this.getPathFlags(e))}setExterior(e,t){const s=(2|this.getPathFlags(e))-2;this.setPathFlags(e,s|(t?2:0))}getRingArea(e){if(this.isRingAreaValid(e))return this.m_pathAreas[this.getPathIndex(e)];const s=this.getFirstVertex(e);if(s===ss)return 0;const i=this.getXY(s),r=new n.KahanSummator(0),o=this.getPathSize(e);if(o>2){const e=i.clone(),t=e.x,a=e.y;let m=this.getNextVertex(s);const h=this.getXY(m);m=this.getNextVertex(m);const l=n.Point2D.getNAN();for(let t=2;t<o;t++,m=this.getNextVertex(m))this.queryXY(m,l),r.pe((l.x-e.x)*(h.y-a)),e.setCoordsPoint2D(h),h.setCoordsPoint2D(l);r.pe((t-e.x)*(h.y-a))}if(this.hasCurves()){let e=s;for(let s=0;s<o;s++,e=this.getNextVertex(e)){const s=this.getSegment(e);if(null===s||s.getGeometryType()===t.GeometryType.enumLine)continue;const n=2*s.calculateArea2DHelper();r.pe(n)}}this.setRingAreaValid(e,!0);const a=.5*r.getResult();return this.m_pathAreas[this.getPathIndex(e)]=a,a}getPathIndexInternal(e){return this.getPathIndex(e)}getPathInternalIndexFromVertex(e){return this.getPathIndex(this.getPathFromVertex(e))}setPathUserIndex(e,t,s){const n=this.m_pathindices[t],i=this.getPathIndex(e);n.size()<this.m_pathAreas.length&&n.resize(this.m_pathAreas.length,-1),n.write(i,s)}getPathUserIndex(e,t){const s=this.getPathIndex(e),n=this.m_pathindices[t];return s<n.size()?n.read(s):-1}createPathUserIndex(){for(let e=0;e<this.m_pathindices.length;e++)if(null===this.m_pathindices[e])return this.m_pathindices[e]=this.allocatePathIndex(),e;this.m_pathindices.push(this.allocatePathIndex());const e=this.m_pathindices.length-1;return t.geometryReleaseAssert(e>=0&&e<=Number.MAX_SAFE_INTEGER),e}fillPathUserIndexForGeometry(e,t,s){const n=this.m_pathindices[t],i=n.size();for(let t=this.getFirstPath(e);t!==ss;t=this.getNextPath(t)){const e=this.getPathIndex(t);e<i&&n.write(e,s)}}removePathUserIndex(e){for(this.recyclePathUserIndex(this.m_pathindices[e]),this.m_pathindices[e]=null;this.m_pathindices.length>0&&null===this.m_pathindices.at(-1);)this.m_pathindices.pop()}movePath(e,s,n){if(n===ss&&t.throwInvalidArgumentException(""),s===n)return;const i=this.getNextPath(n);let r=this.getPrevPath(n);const o=this.getGeometryFromPath(n);r===ss?this.setFirstPath(o,i):this.setNextPath(r,i),i===ss?this.setLastPath(o,r):this.setPrevPath(i,r),this.setGeometryVertexCount(o,this.getPointCount(o)-this.getPathSize(n)),this.setGeometryPathCount(o,this.getPathCount(o)-1),r=s===ss?this.getLastPath(e):this.getPrevPath(s),this.setPrevPath(n,r),this.setNextPath(n,s),s===ss?this.setLastPath(e,n):this.setPrevPath(s,n),r===ss?this.setFirstPath(e,n):this.setNextPath(r,n),this.setGeometryVertexCount(e,this.getPointCount(e)+this.getPathSize(n)),this.setGeometryPathCount(e,this.getPathCount(e)+1),this.setPathGeometry(n,e)}addVertex(e,t){return this.m_vertices.getPointByVal(this.getVertexIndex(t),this.getHelperPoint()),this.insertVertex_(e,ss,this.getHelperPoint(),!1)}insertVertex(e,t,s){return this.insertVertex_(e,t,s,!0)}removeVertex(e,t){const s=this.getPathFromVertex(e),n=this.getPrevVertex(e),i=this.getNextVertex(e);n!==ss&&this.setNextVertex(n,i);const r=this.getPathSize(s);if(e===this.getFirstVertex(s)&&this.setFirstVertex(s,r>1?i:ss),i!==ss&&this.setPrevVertex(i,n),e===this.getLastVertex(s)&&this.setLastVertex(s,r>1?n:ss),this.hasCurves()&&n!==ss&&i!==ss){const s=this.getVertexIndex(e),r=this.getVertexIndex(n),o=this.getVertexIndex(i);if(t){const e=this.getSegmentFromIndex(r);if(null!==e){const t=this.m_vertices.getXY(o);e.setEndXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(s,null)}else{const e=this.getSegmentFromIndex(s);if(this.setSegmentToIndex(s,null),null!==e){const t=this.m_vertices.getXY(r);e.setStartXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(r,e)}}this.setPathSize(s,r-1);const o=this.getGeometryFromPath(s);return this.setGeometryVertexCount(o,this.getPointCount(o)-1),this.freeVertex(e),i}removeVertices(e,s){t.geometryReleaseAssert(e!==s);const n=this.getPathFromVertex(e),i=this.getPrevVertex(e),r=this.getPrevVertex(s);i!==ss&&this.setNextVertex(i,s);let o=this.getPathSize(n);const a=this.getVertexIndex(e);this.setSegmentToIndex(a,null),this.setPrevVertex(s,i),this.setPrevVertex(e,ss),this.setNextVertex(r,ss);let m=0,h=e;const l=this.getFirstVertex(n);let u=!1;for(;;){const e=this.getNextVertex(h);if(u||=l===h,this.freeVertex(h),m++,h===r)break;h=e}o-=m,u&&this.setFirstVertex(n,o>0?s:ss),this.setPathSize(n,o);const c=this.getGeometryFromPath(n);this.setGeometryVertexCount(c,this.getPointCount(c)-m)}getFirstVertex(e){return this.m_pathIndexList.getField(e,4)}getLastVertex(e){return this.m_pathIndexList.getField(e,5)}getNextVertex(e){return this.m_vertexIndexList.getField(e,2)}getPrevVertex(e){return this.m_vertexIndexList.getField(e,1)}getNextVertexEx(e,t){return t>0?this.m_vertexIndexList.getField(e,2):this.m_vertexIndexList.getField(e,1)}getPrevVertexEx(e,t){return t>0?this.m_vertexIndexList.getField(e,1):this.m_vertexIndexList.getField(e,2)}getPathFromVertex(e){return this.m_vertexIndexList.getField(e,3)}addPoint(e,t){return this.insertVertex_(e,ss,t,!1)}getGeometryFromVertex(e){return this.getGeometryFromPath(this.getPathFromVertex(e))}replaceNaNs(e,s){this.m_vertexDescription.hasAttribute(e)||t.throwInternalErrorException(""),this.m_vertices.replaceNaNs(e,s)}removeNaNVertices(){for(let e=this.getFirstGeometry();e!==ss;e=this.getNextGeometry(e))for(let t=this.getFirstPath(e);t!==ss;t=this.getNextPath(t)){let e=this.getFirstVertex(t);for(let s=0,n=this.getPathSize(t);s<n;s++)e=this.getXY(e).isFinite()?this.getNextVertex(e):this.removeVertex(e,!0)}}queryVertexIterator(e=-1){return this.queryVertexIteratorEx(!1,e)}queryVertexIteratorEx(e,s=-1){let n=ss,i=ss,r=ss,o=ss,a=0,m=!1;for(n=s!==ss?s:this.getFirstGeometry();n!==ss;n=this.getNextGeometry(n))if(!e||t.isMultiPath(this.getGeometryType(n))){for(i=this.getFirstPath(n);i!==ss;i=this.getNextPath(i))if(r=this.getFirstVertex(i),o=r,a=0,r!==ss){m=!0;break}if(m||s!==ss)break}return m||(n=ss),is.create_(this,n,i,r,o,a,e,!1,s!==ss)}queryVertexIteratorOnSelection(e=-1){return this.m_selection?is.create_(this,e,ss,ss,ss,-1,!1,!0,e!==ss):this.queryVertexIteratorEx(!1,e)}hasSelection(){return this.m_selection}createEmptySelection(){t.geometryReleaseAssert(0)}removeSelection(){this.m_selection&&(this.m_selectedVertices.length=0,this.removeUserIndex(this.m_selectionIndex),this.m_selectionIndex=-1,this.m_selection=!1,this.m_selectedCount=0)}select(e){return!!this.selected(e)||(this.setUserIndex(e,this.m_selectionIndex,this.m_selectedVertices.length),this.m_selectedVertices.push(e),this.m_selectedCount++,!1)}unselect(e){if(!this.m_selection)return;const t=this.getUserIndex(e,this.m_selectionIndex);t>=0&&(this.m_selectedVertices[t]=ss,this.setUserIndex(e,this.m_selectionIndex,-1),this.m_selectedCount--)}selected(e){return!this.m_selection||this.selected_(e)}getSelectedCount(){return this.m_selection?this.m_selectedCount:this.getTotalPointCount()}createSelectionForCrackingAndClustering(e,s){return t.geometryReleaseAssert(0),!1}peelALoop(e,t){this.peelALoop_(e,t,!1)}peelALoopIntoAPath(e,t){return this.peelALoop_(e,t,!0)}applyTransformation(e){if(this.m_verticesMp.applyTransformation(e),null!==this.m_segments)for(let t=0,s=this.m_segments.length;t<s;t++)this.m_segments[t]&&this.m_segments[t].applyTransformation(e)}setGeometryType(e,t){this.m_geometryIndexList.setField(e,2,t)}splitSegmentWithIntersector(e,t,s,n,i){n?this.splitSegmentForward(e,t,s,!0,i):this.splitSegmentBackward(e,t,s,!0,i)}setPrevVertex(e,t){this.m_vertexIndexList.setField(e,1,t)}setNextVertex(e,t){this.m_vertexIndexList.setField(e,2,t)}setPathToVertex(e,t){this.m_vertexIndexList.setField(e,3,t)}setPathSize(e,t){this.m_pathIndexList.setField(e,3,t)}setFirstVertex(e,t){this.m_pathIndexList.setField(e,4,t)}setLastVertex(e,t){this.m_pathIndexList.setField(e,5,t)}getSegment(e){if(null!=this.m_segments){const t=this.getVertexIndex(e);return this.getSegmentFromIndex(t)}return null}isCurve(e){if(null===this.m_segments)return!1;const t=this.getVertexIndex(e);return this.m_segments.length>t&&null!==this.m_segments[t]}querySegment(e,t,s=!0,n=!1){const i=this.getNextVertex(e);if(i===ss)return!1;const r=this.getSegment(e);if(!r)return!s&&(this.queryLineConnector(e,t.createLine(),n),!0);if(t.copyFrom(r,!0),n)return!0;if(this.m_vertexDescription.getAttributeCount()>1){const s=this.getHelperPoint();this.queryPoint(e,s),t.get().setStart(s),this.queryPoint(i,s),t.get().setEnd(s)}return!0}getSegmentFromIndex(e){return(null!==this.m_segments&&this.m_segments.length>e?this.m_segments[e]:null)||null}getAndClearSegmentFromIndex(e){return(null!==this.m_segments&&this.m_segments.length>e?this.m_segments[e]:null)||null}setSegmentToIndex(e,t){if(this.m_hasForceSetEnvelope=0,null===this.m_segments){if(!t)return;this.m_segments=[],this.m_segments.length=this.m_vertices.getPointCount()}e>=this.m_segments.length&&(this.m_segments.length=e+1),this.m_segments[e]=t}setGeometryPathCount(e,t){this.m_geometryIndexList.setField(e,6,t)}setGeometryVertexCount(e,t){this.m_geometryIndexList.setField(e,5,t)}ringParentageCheckInternal(e,s){return t.geometryReleaseAssert(0),!1}reverseRingInternal(e){const t=this.hasCurves(),s=this.hasSegmentParentage();let n=null,i=-1,r=e;if(t){const e=this.getVertexIndex(r);n=this.getAndClearSegmentFromIndex(e)}s&&(i=this.getSegmentParentage(r));do{const e=this.getPrevVertex(r),o=this.getNextVertex(r);if(this.setNextVertex(r,e),this.setPrevVertex(r,o),t){const e=this.getVertexIndex(o),t=this.getSegmentFromIndex(e);n&&n.reverse(),this.setSegmentToIndex(e,n),n=t}if(s){const e=this.getSegmentParentage(o);this.setSegmentParentagePreserveBreak(o,i),i=e}r=o}while(r!==e);this.dbgVerifyIntegrity(e)}setTotalPointCount(e){this.m_pointCount=e}removePathOnly(e){const t=this.getPrevPath(e),s=this.getNextPath(e),n=this.getGeometryFromPath(e);t!==ss?this.setNextPath(t,s):this.setFirstPath(n,s),s!==ss?this.setPrevPath(s,t):this.setLastPath(n,t),this.setFirstVertex(e,ss),this.setLastVertex(e,ss),this.freePath(e)}insertClosedPath(e,t,s,n,i){const r=this.insertPath(e,ss);let o=0,a=s;for(i[0]=!1;;){a===n&&(i[0]=!0),this.setPathToVertex(a,r),o++;const e=this.getNextVertex(a);if(e===s)break;a=e}return this.setClosedPath(r,!0),this.setPathSize(r,o),i[0]&&(s=n),this.setFirstVertex(r,s),this.setLastVertex(r,this.getPrevVertex(s)),this.setRingAreaValid(r,!1),r}findVertex2D(e,s){return t.geometryReleaseAssert(0),0}findVertex3D(e,s,n){return t.geometryReleaseAssert(0),0}dbgVerifyMonotone(){}dbgCheckSelection(){}dbgVerifySegment(e){}dbgVerifyIntegrity(e,t=!0){}dbgVerifyVertexCounts(){}dbgVerifyCurves(){}dbgDumpGeometry(e,t){}getNextNthVertex(e,t){if(0===t)return e;let s=e;for(let e=0;e<t;++e)if(s=t>0?this.getNextVertex(s):this.getPrevVertex(s),s===ss)return ss;return s}removeVertexInternal(e,t){const s=this.getPrevVertex(e),n=this.getNextVertex(e);if(s!==ss&&this.setNextVertex(s,n),n!==ss&&this.setPrevVertex(n,s),this.hasCurves()&&s!==ss&&n!==ss){const i=this.getVertexIndex(e),r=this.getVertexIndex(s),o=this.getVertexIndex(n);if(t){const e=this.getSegmentFromIndex(r);if(null!==e){const t=this.m_vertices.getXY(o);e.setEndXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(i,null)}else{const e=this.getSegmentFromIndex(i);if(this.setSegmentToIndex(i,null),null!==e){const t=this.m_vertices.getXY(r);e.setStartXY(t),e.normalizeAfterEndpointChange()}this.setSegmentToIndex(r,e)}}return this.freeVertex(e),n}isRingAreaValid(e){return!!(4&this.getPathFlags(e))}setRingAreaValid(e,t){const s=(4|this.getPathFlags(e))-4;this.setPathFlags(e,s|(t?4:0))}compareVerticesSimpleY(e,t){return this.queryXY(e,this.m_workPoint2D),this.queryXY(t,this.m_workPoint2_2D),this.m_workPoint2D.compare(this.m_workPoint2_2D)}compareVerticesSimpleY3D(e,t){return this.getXYZ(e).compare(this.getXYZ(t))}compareVerticesSimpleX(e,t){return this.getXY(e).compareX(this.getXY(t))}sortVerticesSimpleByYHeapMerge(e,s){t.geometryReleaseAssert(0)}sortVerticesSimpleByY(e,t,s){this.m_bucketSort.sort(e,t,s,new ns(this))}sortVerticesSimpleByX(e,s,n){t.geometryReleaseAssert(0)}sortVerticesSimpleByY3D(e,s,n){t.geometryReleaseAssert(0)}snapVertexForPoleClipping(e,t){const s=this.getPrevVertex(e);s!==ss&&this.replaceCurveWithLine(s),this.getNextVertex(e)!==ss&&this.replaceCurveWithLine(e);const i=new n.Point2D;this.queryXY(e,i),i.y=t,this.setXY(e,i)}setSegmentParentageAndBreak(e,s,i=!0){if(-1===this.m_segmentParentageIndex){if(-1===s)return;this.m_segmentParentageIndex=this.createUserIndex()}s>=0&&(t.geometryReleaseAssert(s<=n.indexTypeMax()>>1),s<<=1,s|=i?1:0),this.setUserIndex(e,this.m_segmentParentageIndex,s)}setSegmentParentagePreserveBreak(e,s){if(t.geometryReleaseAssert(s>=-1),-1===this.m_segmentParentageIndex){if(-1===s)return;this.m_segmentParentageIndex=this.createUserIndex()}s>=0&&(t.geometryReleaseAssert(s<=n.indexTypeMax()>>1),s<<=1,s|=this.getSegmentParentageBreakVertex(e)?1:0),this.setUserIndex(e,this.m_segmentParentageIndex,s)}getSegmentParentage(e){if(-1===this.m_segmentParentageIndex)return-1;const t=this.getUserIndex(e,this.m_segmentParentageIndex);return t<0?t:t>>1}getOriginalSegmentInfo(e){if(-1!==this.m_segmentParentageIndex){const t=this.getSegmentParentage(e);return new rs(t)}return new rs(-1)}setSegmentParentageBreakVertex(e,t){if(-1===this.m_segmentParentageIndex)return;let s=this.getUserIndex(e,this.m_segmentParentageIndex);s<0||!!(1&s)!==t&&(t?s|=1:s&=n.indexTypeMax()>>1<<1,this.setUserIndex(e,this.m_segmentParentageIndex,s))}getSegmentParentageBreakVertex(e){if(-1===this.m_segmentParentageIndex)return!0;const t=this.getUserIndex(e,this.m_segmentParentageIndex);return t<0||!!(1&t)}isDiscontinuousSegmentParentage(e){const t=this.getPrevVertex(e);return t!==ss&&this.getSegmentParentage(t)!==this.getSegmentParentage(e)}setCurveStitcherPointer(e){this.m_curveStitcher=e}hasSegmentParentage(){return-1!==this.m_segmentParentageIndex}deleteSegmentParentage(){-1!==this.m_segmentParentageIndex&&(this.removeUserIndex(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),this.m_curveStitcher=null}clearSegments(){this.m_segments=null}}function as(e,t,n,i=!1){if(t<=262144)return function(e,t,n,i){const r=new s.AttributeStreamOfInt32(0);for(let e=0;e<t;e++)r.add(e);const o={userSort(t,s,n){n.sort(t,s,(t,s)=>e[t].compareX(e[s]))},getValue:t=>e[t].x};i||s.BucketSort.sortEx(r,0,t,o);let a=0;e:for(let s=0;s<t;++s){const t=r.read(s);for(;a>=2;){const i=n[a-2],o=n[a-1];if(e[o].equals(e[t])){r.write(s,-1);continue e}if(!(ls(e[i],e[o],e[t])>=0)){o===r.read(s-1)&&r.write(s-1,-1);break}a--}n[a++]=t,2===a&&e[t].equals(e[n[0]])&&(r.write(1,-1),a--)}const m=a+1;e:for(let s=t-2;s>=0;--s){const t=r.read(s);if(!(t<0)){for(;a>=m;){const s=n[a-2],i=n[a-1];if(e[i].equals(e[t]))continue e;if(!(us(e[s],e[i],e[t])>=0))break;a--}if(0!==s){const s=n[a-1];n[a++]=t,e[t].equals(e[s])&&a--}}}return a>1&&e[n[0]].equals(e[n[a-1]])&&a--,a}(e,t,n,i);const r=new hs({points:e,n:t});let o=1;const a=e[0];for(;o<t&&e[o].equals(a);)o++;if(r.m_treeHull.addElement(0),o<t){r.m_treeHull.addBiggestElement(o);for(let s=o+1;s<t;s++){const t=e[s],n=r.treeHull(t);-1!==n&&r.m_treeHull.setElement(n,s)}}let m=0;for(let e=r.m_treeHull.getFirst();-1!==e;e=r.m_treeHull.getNext(e))n[m++]=r.m_treeHull.getElement(e);return m}os.st_defaultRank=1;class ms{constructor(e){this.m_handleP=-1,this.m_handleQ=-1,this.m_currentSupport=-1,this.m_area=0,this.m_bDone=!0,t.geometryReleaseAssert(0),this.m_convexHull=e,this.m_function=this.done_}next(){return t.geometryReleaseAssert(0),!1}get_vertex_handle_p(){return t.geometryReleaseAssert(0),0}get_vertex_handle_q(){return t.geometryReleaseAssert(0),0}get_current_support(){return t.geometryReleaseAssert(0),0}getNext(e){return t.geometryReleaseAssert(0),0}getPrev(e){return t.geometryReleaseAssert(0),0}intialize_(){return t.geometryReleaseAssert(0),!1}increment_(){return t.geometryReleaseAssert(0),!1}increment_q_(){return t.geometryReleaseAssert(0),!1}increment_p_(){return t.geometryReleaseAssert(0),!1}parallel_edge_with_q_support_(){return t.geometryReleaseAssert(0),!1}parallel_edge_with_p_support_(){return t.geometryReleaseAssert(0),!1}done_(){return t.geometryReleaseAssert(0),!1}}class hs{nullGetXY(e){return t.throwInternalErrorException("m_getXY is null"),{}}nullDeleteNode(e){t.throwInternalErrorException("m_deleteNode is null")}constructor(e){return this.m_treeHull=new s.Treap,this.m_shape=null,this.m_stream=null,this.m_points=null,this.m_geometryHandle=-1,this.m_pathHandle=-1,this.m_getXY=this.nullGetXY,this.m_deleteNode=this.nullDeleteNode,e?e.stream?(this.m_treeHull.setCapacity(Math.min(20,e.n)),this.m_stream=e.stream,this.m_getXY=this.getXYStream,this.m_deleteNode=this.deleteNodeStream,this.m_points=null,this.m_geometryHandle=ss,void(this.m_pathHandle=ss)):e.points?(this.m_treeHull.setCapacity(Math.min(20,e.n)),this.m_points=e.points,this.m_getXY=this.getXYPoints,this.m_deleteNode=this.deleteNodePoints,this.m_stream=null,this.m_geometryHandle=ss,void(this.m_pathHandle=ss)):void t.throwInvalidCallException("unrecognized constructor parameter"):(this.m_treeHull.setCapacity(20),this.m_shape=new os,this.m_geometryHandle=this.m_shape.createGeometry(t.GeometryType.enumMultiPoint),this.m_pathHandle=this.m_shape.insertPath(this.m_geometryHandle,ss),this.m_getXY=this.getXYShape,this.m_deleteNode=this.deleteNodeShape,this.m_stream=null,void(this.m_points=null))}getXYShape(e){return this.m_shape.getXY(e)}getXYStream(e){return this.m_stream.readPoint2D(e<<1)}getXYPoints(e){return t.geometryReleaseAssert(0),new n.Point2D}deleteNodeShape(e){const t=this.m_treeHull.getElement(e);this.m_treeHull.deleteNode(e),this.m_shape.removeVertex(t,!1)}deleteNodeStream(e){this.m_treeHull.deleteNode(e)}deleteNodePoints(e){t.geometryReleaseAssert(0)}addGeometry(e){if(e.isEmpty())return;const s=e.getGeometryType();if(s===t.GeometryType.enumGeometryCollection){const t=e;for(let e=0,s=t.getGeometryCount();e<s;e++)this.addGeometry(t.getGeometry(e))}else t.isMultiVertex(s)?this.addMultiVertexGeometry(e):t.isSegment(s)?this.addSegment(e,!1):s===t.GeometryType.enumEnvelope?this.addEnvelope(e):s===t.GeometryType.enumPoint?this.addPoint(e):t.throwInvalidArgumentException("Convex_hull: geometry not supported")}getBoundingGeometry(){const e=new s.Point,t=this.m_treeHull.getFirst(),n=new es({vd:this.m_shape.getVertexDescription()});if(0===this.m_treeHull.size())return n;n.reserve(this.m_treeHull.size()),this.m_shape.queryPoint(this.m_treeHull.getElement(t),e),n.startPathPoint(e);for(let s=this.m_treeHull.getNext(t);-1!==s;s=this.m_treeHull.getNext(s))this.m_shape.queryPoint(this.m_treeHull.getElement(s),e),n.lineToPoint(e);return n}getAntipodalPairsIterator(){return t.geometryReleaseAssert(0),new ms(this)}getXY(e){return t.geometryReleaseAssert(0),new n.Point2D}getXYWithIndex(e){return t.geometryReleaseAssert(0),new n.Point2D}getFirst(){return t.geometryReleaseAssert(0),0}getLast(){return t.geometryReleaseAssert(0),0}getNext(e){return t.geometryReleaseAssert(0),0}getPrev(e){return t.geometryReleaseAssert(0),0}getVertexIndex(e){return t.geometryReleaseAssert(0),0}getPointCount(){return t.geometryReleaseAssert(0),0}addMultiVertexGeometry(e){const i=new s.Point,r=e.getImpl(),o=new n.Point2D;for(let t=0;t<e.getPointCount();t++){r.queryXY(t,o);const s=this.addPoint2D(o);if(-1!==s){e.getPointByVal(t,i);const n=this.m_shape.addPoint(this.m_pathHandle,i);this.m_treeHull.setElement(s,n)}}if(t.isMultiPath(e.getGeometryType())){const t=e;if(t.hasNonLinearSegments()){const e=t.querySegmentIterator();for(;e.nextPath();)for(;e.hasNextSegment();){const t=e.nextCurve();null!==t&&this.addSegment(t,!0)}}}}addEnvelope(e){const t=new s.Point;for(let s=0;s<4;s++){const i=new n.Point2D;e.queryCorner(s,i);const r=this.addPoint2D(i);if(-1!==r){e.queryCornerByVal(s,t);const n=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(r,n)}}}static querySegmentControlPoints(e,i,r){const o=e.getGeometryType();if(t.geometryReleaseAssert(o!==t.GeometryType.enumLine),o===t.GeometryType.enumEllipticArc){const t=e,r=60*Math.PI/180,o=Math.abs(t.getSweepAngle());if(o>r){const e=Math.min(6,Math.ceil(o/r)),a=1/e,m=new Mr;t.queryStart(i[0]);let h=1;for(let r=0;r<e;r++){t.queryCut(r*a,(r+1)*a,m);const o=n.makeObjectArray(n.Point2D,3);ur(m.get(),o);const l=n.Point2D.calculateLength(o,3),u=n.Point2D.calculateLength(o,2),c=l>0?u/l:.5;r<e-1?m.get().queryEnd(i[h+1]):t.queryEnd(i[h+1]),s.Point.lerp(i[h-1],i[h+1],c,i[h]),i[h].setXY(o[1]),h+=2}return h}{const t=n.makeObjectArray(n.Point2D,3);ur(e,t);const r=n.Point2D.calculateLength(t,3);e.queryStart(i[0]),e.queryEnd(i[2]);const o=n.Point2D.calculateLength(t,2),a=r>0?o/r:.5;return s.Point.lerp(i[0],i[2],a,i[1]),i[1].setXY(t[1]),3}}if(o===t.GeometryType.enumBezier){const t=e,r=n.makeObjectArray(n.Point2D,4);t.queryControlPoints(r);const o=n.Point2D.calculateLength(r,4),a=n.Point2D.calculateLength(r,2),m=n.Point2D.calculateLength(r,3);e.queryStart(i[0]),e.queryEnd(i[3]);const h=o>0?a/o:.5;s.Point.lerp(i[0],i[3],h,i[1]),i[1].setXY(r[1]);const l=o>0?m/o:.5;return s.Point.lerp(i[0],i[3],l,i[2]),i[2].setXY(r[2]),4}if(o===t.GeometryType.enumBezier2){const t=e,r=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(r);const o=n.Point2D.calculateLength(r,3);e.queryStart(i[0]),e.queryEnd(i[2]);const a=n.Point2D.calculateLength(r,2),m=o>0?a/o:.5;return s.Point.lerp(i[0],i[2],m,i[1]),i[1].setXY(r[1]),3}if(o===t.GeometryType.enumRationalBezier2){const t=e,r=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(r);const o=n.Point2D.calculateLength(r,3);e.queryStart(i[0]),e.queryEnd(i[2]);const a=n.Point2D.calculateLength(r,2),m=o>0?a/o:.5;return s.Point.lerp(i[0],i[2],m,i[1]),i[1].setXY(r[1]),3}t.throwInvalidArgumentException("Convex_hull: segment type not supported")}addSegment(e,t){if(!t){const t=new s.Point,n=e.getStartXY(),i=this.addPoint2D(n);if(-1!==i){e.queryStart(t);const s=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(i,s)}const r=e.getEndXY(),o=this.addPoint2D(r);if(-1!==o){e.queryEnd(t);const s=this.m_shape.addPoint(this.m_pathHandle,t);this.m_treeHull.setElement(o,s)}}if(e.isCurve()){const t=n.makeObjectArray(s.Point,13);for(let s=1,n=hs.querySegmentControlPoints(e,t,t.length)-1;s<n;++s){const e=t[s].getXY(),n=this.addPoint2D(e);if(-1!==n){const e=this.m_shape.addPoint(this.m_pathHandle,t[s]);this.m_treeHull.setElement(n,e)}}}}addPoint(e){const t=e.getXY(),s=this.addPoint2D(t);if(-1!==s){const t=this.m_shape.addPoint(this.m_pathHandle,e);this.m_treeHull.setElement(s,t)}}addPoint2D(e){let t=-1;if(0===this.m_treeHull.size())return t=this.m_treeHull.addElement(-4),t;if(1===this.m_treeHull.size()){const s=this.m_treeHull.getElement(this.m_treeHull.getFirst()),n=this.m_shape.getXY(s);return e.equals(n)||(t=this.m_treeHull.addBiggestElement(-5)),t}return t=this.treeHull(e),t}treeHull(e){let t=-1;do{const s=this.m_treeHull.getFirst(),i=this.m_treeHull.getLast(),r=this.m_treeHull.getElement(s),o=this.m_treeHull.getElement(i),a=this.m_getXY(r),m=this.m_getXY(o),h=n.Point2D.orientationRobust(m,e,a);if(cs(h)){t=this.m_treeHull.addBiggestElement(-1);const n=this.treeHullWalkBackward(e,i,s);n!==s&&this.treeHullWalkForward(e,s,this.m_treeHull.getPrev(n));break}if(gs(h)){let r=this.m_treeHull.getRoot(),o=this.m_treeHull.getFirst(),m=this.m_treeHull.getLast(),h=-1,l=-1,u=-1;for(;o!==this.m_treeHull.getPrev(m);){l=this.m_treeHull.getElement(r);const t=this.m_getXY(l);gs(n.Point2D.orientationRobust(t,e,a))?(m=r,r=this.m_treeHull.getLeft(r)):(o=r,r=this.m_treeHull.getRight(r))}r=m,h=o,l=this.m_treeHull.getElement(r),u=this.m_treeHull.getElement(h);const c=this.m_getXY(l),g=this.m_getXY(u);if(h!==s&&!cs(n.Point2D.orientationRobust(g,e,c)))break;t=this.m_treeHull.addElementAtPosition(h,r,-2,!0,!1),this.treeHullWalkForward(e,r,i),this.treeHullWalkBackward(e,h,s);break}{const n=ds(e,m,a);if(-1===n){const n=this.m_treeHull.getPrev(i);this.m_treeHull.deleteNode(i),t=this.m_treeHull.addBiggestElement(-3),this.treeHullWalkBackward(e,n,s)}else if(1===n){const n=this.m_treeHull.getNext(s);this.m_treeHull.deleteNode(s),t=this.m_treeHull.addElementAtPosition(-1,n,-3,!0,!1),this.treeHullWalkForward(e,n,i)}break}}while(0);return t}treeHullWalkForward(e,t,s){if(t===s)return s;let i=t,r=this.m_treeHull.getElement(i),o=this.m_treeHull.getNext(i);const a=this.m_getXY(r);for(;i!==s&&this.m_treeHull.size()>2;){const t=this.m_treeHull.getElement(o),s=this.m_getXY(t);if(cs(n.Point2D.orientationRobust(s,e,a)))break;const m=i;i=o,r=t,a.assign(s),o=this.m_treeHull.getNext(i),this.m_deleteNode(m)}return i}treeHullWalkBackward(e,t,s){if(t===s)return s;let i=t,r=this.m_treeHull.getElement(i),o=this.m_treeHull.getPrev(i);const a=this.m_getXY(r);for(;i!==s&&this.m_treeHull.size()>2;){const t=this.m_treeHull.getElement(o),s=this.m_getXY(t);if(cs(n.Point2D.orientationRobust(a,e,s)))break;const m=i;i=o,r=t,a.assign(s),o=this.m_treeHull.getPrev(i),this.m_deleteNode(m)}return i}}function ls(e,t,s){const i=t.sub(e),r=s.sub(t);if(0===i.x)return r.x>0?-1:0;if(0===i.y)return r.y>0?1:r.y<0?-1:0;const o=i.crossProduct(r),a=4*Number.EPSILON*(Math.abs(r.x*i.y)+Math.abs(r.y*i.x));return o>a?1:o<-a?-1:n.Point2D.orientationRobust(e,t,s)}function us(e,t,s){const i=t.sub(e),r=s.sub(t);if(0===i.x)return r.x<0?-1:0;if(0===i.y)return r.y>0?-1:r.y<0?1:0;const o=i.crossProduct(r),a=4*Number.EPSILON*(Math.abs(r.x*i.y)+Math.abs(r.y*i.x));return o>a?1:o<-a?-1:n.Point2D.orientationRobust(e,t,s)}function cs(e){return e<0}function gs(e){return e>0}function ds(e,t,s){let n=-1;n=t.y===s.y?0:t.x===s.x?1:Math.abs(t.x-s.x)>=Math.abs(t.y-s.y)?0:1;let i=-1;return i=t[n]<s[n]?e[n]<t[n]?-1:s[n]<e[n]?1:0:t[n]<e[n]?-1:e[n]<s[n]?1:0,i}function ps(e){return(e=e.clone()).divThis(Math.max(Math.abs(e.x),Math.abs(e.y))),e.normalize(),e}function _s(e,t,s){e.inc(t,0)===s&&e.set(t,0,0),e.inc(t,1)===s&&e.set(t,1,0)}function fs(e,s,i,r,o){switch(o){case 0:break;case 1:s.rightPerpendicularThis(),e.rightPerpendicularThis();break;case 2:s.negateThis(),e.negateThis();break;case 3:s.leftPerpendicularThis(),e.leftPerpendicularThis();break;default:t.throwInvalidArgumentException("")}return n.Point2D.orientationRobustEx(e,s,i,r)}class ys{constructor(){this.length=Number.NaN,this.specialPoints=[]}specialPointsCount(){return this.specialPoints.length}}function xs(e){var t;return t=e.calculateUpperLength2D(),256*n.doubleEps()*t}function Ps(e,t,s=!1){t[1].setCoords(e.m_cp[0].x-e.getStartX(),e.m_cp[0].y-e.getStartY()),t[1].mulThis(3),t[2].setCoords(e.m_cp[1].x-e.m_cp[0].x,e.m_cp[1].y-e.m_cp[0].y),t[2].mulThis(3),t[3]=e.getEndXY().sub(e.getStartXY()),t[3].subThis(t[2]),t[2].subThis(t[1]),s?t[0].setCoords(0,0):t[0]=e.getStartXY()}function Es(e,t,s){const i=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(i),Cs(i,t,s)}function vs(e,t,s){const i=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(i),Ds(i,t,s)}function Cs(e,t,s){let n=e[1].x;n-=e[0].x,n*=3;let i=e[2].x;i-=e[1].x,i*=3;let r=e[3].x;r-=e[0].x,r-=i,i-=n,t[3].setWithEps(r),t[2].setWithEps(i),t[1].setWithEps(n),s?t[0].set(0):t[0].set(e[0].x)}function Ds(e,t,s){let n=e[1].y;n-=e[0].y,n*=3;let i=e[2].y;i-=e[1].y,i*=3;let r=e[3].y;r-=e[0].y,r-=i,i-=n,t[3].setWithEps(r),t[2].setWithEps(i),t[1].setWithEps(n),s?t[0].set(0):t[0].set(e[0].y)}function bs(e,t,s=!1){const i=n.makeObjectArray(P,4);i[0].assignPoint2D(e[0]),i[1].assignPoint2D(e[1]),i[2].assignPoint2D(e[2]),i[3].assignPoint2D(e[3]),t[1].setCoords(i[1].x.sub(i[0].x),i[1].y.sub(i[0].y)),t[1].mulThis(n.MPValue.constructInt32(3)),t[2].setCoords(i[2].x.sub(i[1].x),i[2].y.sub(i[1].y)),t[2].mulThis(n.MPValue.constructInt32(3)),t[3]=i[3].sub(i[0]),t[3]=t[3].sub(t[2]),t[2]=t[2].sub(t[1]),s?t[0].setCoords(n.s_zero$1,n.s_zero$1):t[0]=i[0].clone()}function Ss(e,t,s){if(s){if(t<0)return t;if(t>1)return t-1+Ss(e,1,!1)}if(e.isDegenerate(0))return 0;const n=1===t,i=Is(e);if(n&&!Number.isNaN(i.length)&&!Number.isNaN(i.length))return i.length;const r=xs(e),o=r/e.calculateUpperLength2D();let a=0,m=0;for(let s=1,n=i.specialPointsCount();s<n;s++){const n=i.specialPoints[s];if(a+=un(e,m,Math.min(t,n),o,r),t<=n)break;m=n}return n&&(i.length=a),a}function Is(e){if(e.m_cachedValues)return e.m_cachedValues;const t=new ys,s=n.makeObjectArray(n.ECoordinate,8),i=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(i);const r=on(i,s);t.specialPoints=[];for(let e=0;e<r;e++)t.specialPoints.push(s[e].value());return Ts(e,t),t}function ws(e){let t=null;return t=e.m_cachedValues,t}function Ts(e,t){e.m_cachedValues=t}function As(e){e.m_cachedValues=null}function Ns(e,t,s,i){const r=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(r);const o=n.makePrimitiveArray(18,NaN),a=Ce(new tn(r,t,NaN),n.Envelope1D.construct(s,i),18,o),m=new n.Point2D;e.queryCoord2D(s,m);let h=s,l=n.Point2D.distance(m,t);const u=new n.Point2D;e.queryCoord2D(i,u);const c=n.Point2D.distance(u,t);c<l&&(l=c,h=i,m.assign(u));for(let s=0;s<a;s++){e.queryCoord2D(o[s],u);const i=n.Point2D.distance(u,t);i<l&&(l=i,h=o[s],m.assign(u))}return function(e,t,s,n,i){return{tmin:e,tmax:t,t:s,d:n,pt:i.clone()}}(s,i,h,l,m)}function Gs(e,s){const i=n.makeObjectArray(n.ECoordinate,4);Es(e,i,!0);const r=n.makeObjectArray(n.ECoordinate,4);vs(e,r,!0);const o=i[3].clone(),a=i[2].clone(),m=i[1].clone(),h=r[3].clone(),l=r[2].clone(),u=r[1].clone(),c=a.mulE(m).addE(l.mulE(u)).mul(4),g=a.mulE(a).mul(8).addE(o.mulE(m).mul(12)).addE(l.mulE(l).mul(8).addE(h.mulE(u).mul(12))),d=o.mulE(a).addE(h.mulE(l)).mul(36),p=o.mulE(o).addE(h.mulE(h)).mul(36),_=n.makeObjectArray(n.ECoordinate,3),f=Ge(p,d,g,c,new n.Envelope1D(0,1),!1,_);if(t.geometryReleaseAssert(f<=3),f>0){const t=Rs(e,1,0).sqrLength(),n=Rs(e,1,1).sqrLength();let i=t;s.set(0),i<n&&(i=n,s.set(1));for(let t=0;t<f;t++){const n=Rs(e,1,_[t].value()).sqrLength();n<i&&(i=n,s=_[t])}}}function Ms(e,t,s){const i=new n.Point2D;return function(e,t,s,n){if(1===t){const t=1-s,i=t*t,r=s*s,o=e[1].sub(e[0]),a=e[2].sub(e[1]),m=e[3].sub(e[2]),h=o.mul(i).add(a.mul(2*t*s)).add(m.mul(r));n.assign(h.mul(3))}else if(2===t){const t=1-s,i=e[2].sub(e[1]).sub(e[1].sub(e[0])),r=e[3].sub(e[2]).sub(e[2].sub(e[1])),o=i.mul(t).add(r.mul(s));n.assign(o.mul(6))}else if(3===t){const t=e[2].sub(e[1]),s=e[3].sub(t.mul(3)).sub(e[0]);n.assign(s.mul(6))}else n.setCoords(0,0)}(e,t,s,i),i}function Rs(e,t,s){const i=n.makeObjectArray(n.Point2D,4);return e.queryControlPoints(i),Ms(i,t,s)}function ks(e){const t=e.m_cp[0].sub(e.getStartXY()),s=e.m_cp[1].sub(e.m_cp[0]),n=e.getEndXY().sub(e.getStartXY());return t.mulThis(3),s.mulThis(3),n.subThis(s),s.subThis(t),(3*n.x*(2*s.y+5*t.y)-3*n.y*(2*s.x+5*t.x)+10*(s.x*t.y-s.y*t.x))/60}function Fs(e){const t=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(t);const s=qs(t);return s&&(e.m_cp[0].setCoordsPoint2D(t[1]),e.m_cp[1].setCoordsPoint2D(t[2]),e.afterCompletedModification()),s}function qs(e){return v(e)}function Vs(e,t,s){const i=new n.Point2D,r=new n.Point2D,o=new n.Point2D,a=new n.Point2D,m=new n.Point2D;t<=.5?(n.lerpPointLo(2,e[0],e[1],t,i),n.lerpPointLo(2,e[1],e[2],t,r),n.lerpPointLo(2,e[2],e[3],t,o),n.lerpPointLo(2,i,r,t,a),n.lerpPointLo(2,r,o,t,m),n.lerpPointLo(2,a,m,t,s)):(n.lerpPointHi(2,e[0],e[1],t,i),n.lerpPointHi(2,e[1],e[2],t,r),n.lerpPointHi(2,e[2],e[3],t,o),n.lerpPointHi(2,i,r,t,a),n.lerpPointHi(2,r,o,t,m),n.lerpPointHi(2,a,m,t,s))}function Hs(e,s,i,r){t.geometryReleaseAssert(s>=0&&s<=1);const o=new n.Point2D,a=new n.Point2D,m=new n.Point2D,h=new n.Point2D,l=new n.Point2D,u=new n.Point2D;s<=.5?(n.lerpPointLo(2,e[0],e[1],s,o),n.lerpPointLo(2,e[1],e[2],s,a),n.lerpPointLo(2,e[2],e[3],s,m),n.lerpPointLo(2,o,a,s,h),n.lerpPointLo(2,a,m,s,l),n.lerpPointLo(2,h,l,s,u)):(n.lerpPointHi(2,e[0],e[1],s,o),n.lerpPointHi(2,e[1],e[2],s,a),n.lerpPointHi(2,e[2],e[3],s,m),n.lerpPointHi(2,o,a,s,h),n.lerpPointHi(2,a,m,s,l),n.lerpPointHi(2,h,l,s,u));const c=e[3].clone();i&&(i[0].assign(e[0]),i[1].assign(o),i[2].assign(h),i[3].assign(u)),r&&(r[0].assign(u),r[1].assign(l),r[2].assign(m),r[3].assign(c))}function Os(e,s,i,r){if(t.geometryReleaseAssert(s>=0&&i<=1&&s<=i),s===i){const t=new n.Point2D;return Ys(e,s,t),r[0].assign(t),r[1].assign(t),r[2].assign(t),void r[3].assign(t)}if(0===s&&1===i){for(let t=0;t<4;++t)r[t].assign(e[t]);return}const o=n.makeObjectArray(n.Point2D,4);Hs(e,i,o,null),Hs(o,i>0?s/i:0,null,o),Ys(e,s,o[0]),Ys(e,i,o[3]),r[0].setCoordsPoint2D(o[0]),r[1].setCoordsPoint2D(o[1]),r[2].setCoordsPoint2D(o[2]),r[3].setCoordsPoint2D(o[3])}function Ys(e,t,s,i){if(i){if(t<0)return void W(new Gr({start:e[0],end:e[0].add(Xs(e,0).getUnitVector())}),t,s);if(t>1)return void W(new Gr({start:e[3],end:e[3].add(Xs(e,1).getUnitVector())}),t-1,s)}if(t<=.5){const i=new n.Point2D;n.lerpPointLo(2,e[0],e[1],t,i);const r=new n.Point2D;n.lerpPointLo(2,e[1],e[2],t,r);const o=new n.Point2D;n.lerpPointLo(2,e[2],e[3],t,o);const a=new n.Point2D;n.lerpPointLo(2,i,r,t,a);const m=new n.Point2D;n.lerpPointLo(2,r,o,t,m),n.lerpPointLo(2,a,m,t,s)}else{const i=new n.Point2D;n.lerpPointHi(2,e[0],e[1],t,i);const r=new n.Point2D;n.lerpPointHi(2,e[1],e[2],t,r);const o=new n.Point2D;n.lerpPointHi(2,e[2],e[3],t,o);const a=new n.Point2D;n.lerpPointHi(2,i,r,t,a);const m=new n.Point2D;n.lerpPointHi(2,r,o,t,m),n.lerpPointHi(2,a,m,t,s)}}function Xs(e,t){const s=n.snap(t,0,1);let i=Ms(e,1,s);return i.isZero()&&(i=Ms(e,2,s),i.isZero()?i=Ms(e,3,s):1===s&&i.negateThis()),i}function Ls(e,t,s){const i=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(i),function(e,t,s){t.value()<0&&t.set(0,t.eps()),t.value()>1&&t.set(1,t.eps()),s.setE(function(e,t,s){const i=[y.constructPoint2D(e[0]),y.constructPoint2D(e[1]),y.constructPoint2D(e[2]),y.constructPoint2D(e[3])],r=new y;return function(e,t,s,i){{const t=n.s_one.subE(s),r=t.sqr(),o=s.sqr(),a=e[1].subE(e[0]).mulE(r).addE(e[2].subE(e[1]).mulE(new n.ECoordinate(2).mulE(t).mulE(s))).addE(e[3].subE(e[2]).mulE(o));i.setE(a.mulE(new n.ECoordinate(3)))}}(i,0,s,r),r}(e,0,t))}(i,t,s)}function Bs(e,t,s,n,i){if(i){if(0!==br(t,s))return e?4:2}else if(C(t,s))return 1;return 0!==Ws(e,t,s,null,null,null,n,void 0!==i&&i,0,!1)?4:0}function zs(e,t,s,n,i){if(i){if(0!==br(t,s))return e?4:2}else if(C(t,s))return 1;return 0!==Zs(e,t,s,null,null,null,n,void 0!==i&&i,0,!1)?4:0}function Us(e,t,s,n,i){if(i){if(0!==br(t,s))return e?4:2}else if(C(t,s))return 1;return 0!==Ks(e,t,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}function js(e,t,s,n,i){if(i){if(0!==br(t,s))return e?4:2}else if(C(t,s))return 1;return 0!==$s(e,t,s,null,null,null,n,i??!1,0,!1)?4:0}function Ws(e,t,s,i,r,o,a,m,h,l){if(null!==r&&(r.length=0),null!=o&&(o.length=0),null!==i&&(i.length=0),s.isDegenerate(0)){const e=[0,0,0],m=t.intersectPoint(s.getStartXY(),e,a);if(m>0){if(null!==r)for(let t=0;t<m;t++)r.push(e[t]);if(null!==o)for(let e=0;e<m;e++)o.push(0);if(null!=i)for(let s=0;s<m;s++){const r=new n.Point2D;t.queryCoord2D(e[s],r),i.push(r)}}return m}const u=H(t,s);if(O(t,s,a=Math.max(a,u)))return 0;const c=n.makeObjectArray(n.Point2D,4);Ps(t,c);const g=s.getEndXY();g.subThis(s.getStartXY());const d=g.clone();d.leftPerpendicularThis();let p=3*c[3].dotProduct(d),_=2*c[2].dotProduct(d),f=c[1].dotProduct(d);const y=n.makePrimitiveArray(15,Number.NaN),x=n.makePrimitiveArray(15,Number.NaN);let P=De(p,_,f,n.Envelope1D.unit(),!1,y);P<0&&(y[0]=0,y[1]=1,P=2);let E,v=0;for(let e=0,i=v;e<P;++e){const r=t.getCoord2D(y[e+i]);x[v]=s.getClosestCoordinate(r,!1),n.Point2D.distance(r,s.getCoord2D(x[v]))<=a&&(y[v]=y[e+i],v++)}if(c[0].subThis(s.getStartXY()),Math.abs(g.x)>=Math.abs(g.y)){const e=g.y/g.x;p=c[3].y-c[3].x*e,_=c[2].y-c[2].x*e,f=c[1].y-c[1].x*e,E=c[0].y-c[0].x*e}else{const e=g.x/g.y;p=c[3].x-c[3].y*e,_=c[2].x-c[2].y*e,f=c[1].x-c[1].y*e,E=c[0].x-c[0].y*e}const C=t.getEndXY().equals(s.getStartXY())||t.getEndXY().equals(s.getEndXY()),D=[0,0,0];P=be(p,_,f,E,n.Envelope1D.unit(),C,D);for(let e=0,i=v;e<P;++e){y[e+i]=D[e];const r=t.getCoord2D(y[e+i]);x[v]=s.getClosestCoordinate(r,!1),n.Point2D.distance(r,s.getCoord2D(x[v]))<=a&&(y[v]=y[e+i],v++)}P=t.intersectPoint(s.getStartXY(),D,a);for(let e=0;e<P;e++)y[v]=D[e],x[v++]=0;P=t.intersectPoint(s.getEndXY(),D,a);for(let e=0;e<P;e++)y[v]=D[e],x[v++]=1;return 0!==s.intersectPoint(t.getStartXY(),D,a)&&(x[v]=D[0],y[v++]=0),0!==s.intersectPoint(t.getEndXY(),D,a)&&(x[v]=D[0],y[v++]=1),0===v?0:Tr(e,t,s,y,x,v,i,r,o,a,m,0,l)}function Zs(e,t,s,i,o,a,m,h,l,u){if(Ki(s))return Ws(e,t,new Gr({start:s.getStartXY(),end:s.getEndXY()}),i,o,a,m,h,0,u);const c=H(t,s);if(O(t,s,m=Math.max(m,c)))return 0;const g=[],d=[],p=[],_=n.makeObjectArray(n.Point2D,4);{t.queryControlPoints(_);const e=n.makeObjectArray(n.Point2D,4),i=new r.Transformation2D;s.canonicToWorldTransformation(i);const o=new r.Transformation2D;o.setInvert(i),o.transformPoints2D(_,4,e);const a=n.makeObjectArray(P,4);bs(e,a);const l=[a[0].x,a[1].x,a[2].x,a[3].x],u=[a[0].y,a[1].y,a[2].y,a[3].y],c=n.makeObjectArray(n.MPValue,3);c[0].setDouble(s.getSemiMinorAxis()),c[0].sqrThis(),c[1].setDouble(s.getSemiMajorAxis()),c[1].sqrThis(),c[2].setThis(c[0]),c[2].mulThis(c[1]),c[2].negateThis();const f=We(l,3,u,3,null,0,c,0,n.Envelope1D.unit(),n.Envelope1D.unit(),d,h);if(f>0){let e=0;for(let i=0;i<f;i++){const r=new n.Point2D;t.queryCoord2D(d[i],r);const o=s.getClosestCoordinate(r,!1),a=new n.Point2D;s.queryCoord2D(o,a),n.Point2D.distance(r,a)<=m&&(g.push(r.clone()),d[e]=d[i],p.push(o),e++)}d.length=e,g.length=e}}const f=[0,1];for(let e=0;e<2;e++){const t=0===e?s.getStartXY():s.getEndXY(),i=[0];sn(_,t,n.Envelope1D.unit(),!1,-1,1,i);const r=new n.Point2D;Ys(_,i[0],r),n.Point2D.distance(t,r)<=m&&(d.push(i[0]),p.push(f[e]),g.push(r.clone()))}for(let e=0;e<2;e++){const t=[0,3];{const i=s.getClosestCoordinate(_[t[e]],!1),r=new n.Point2D;s.queryCoord2D(i,r),n.Point2D.distance(_[t[e]],r)<=m&&(d.push(f[e]),p.push(i),g.push(r.clone()))}}return Tr(e,t,s,d,p,d.length,i,o,a,m,h,0,u)}function Qs(e,s,i,r,o,a,m,h,l,u){const c=n.makeObjectArray(n.Point2D,4);s.queryControlPoints(c);const g=n.makeObjectArray(n.Point2D,4);if(i.queryControlPoints(g),Y(c,g,4)<0)return Qs(e,i,s,r,a,o,m,h,l,!u);const p=H(s,i);if(O(s,i,m=Math.max(m,p)))return 0;if(function(e,t,s,i,r,o,a,m,h){const l=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(l);const u=n.makeObjectArray(n.Point2D,4);if(t.queryControlPoints(u),l[0].equals(u[0])){if(l[1].equals(u[1])&&l[2].equals(u[2])&&l[3].equals(u[3]))return s&&(s.length=0,s.push(l[0]),s.push(l[3])),i&&(i.length=0,i.push(0),i.push(1)),r&&(r.length=0,r.push(0),r.push(1)),!0;if(!l[0].equals(u[3]))return!1}return!!(l[0].equals(u[3])&&l[1].equals(u[2])&&l[2].equals(u[1])&&l[3].equals(u[0]))&&(i&&(i.length=0,i.push(0),i.push(1),h&&(i[1]=n.swap(i[0],i[0]=i[1]))),r&&(r.length=0,r.push(1),r.push(0),h&&(r[1]=n.swap(r[0],r[0]=r[1]))),s&&(s.length=0,s.push(l[0]),s.push(l[3]),h&&(s[1]=n.swap(s[0],s[0]=s[1]))),!0)}(s,i,r,o,a,0,0,0,u))return 2;const _=new n.Envelope1D(0,1),f=new n.Envelope1D(0,1);{const e=new d;en(c,new n.Envelope1D(0,1),e);const t=new d;en(g,new n.Envelope1D(0,1),t);const s=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*m),t.inflate(3*m),!e.intersectW(t))return 0;if(e.maxDim()<.1*s){if(mn(c,e,_),_.isEmpty())return 0;if(mn(g,e,f),f.isEmpty())return 0;Os(c,_.vmin,_.vmax,c),Os(g,f.vmin,f.vmax,g)}}const y=Ar(c,3,g,3,m);if(0===y)return 0;const x=[],E=[],v=[];let C=!1;if(-1===y){const e=n.makeObjectArray(P,4);bs(c,e);const t=[e[0].x,e[1].x,e[2].x,e[3].x],s=[e[0].y,e[1].y,e[2].y,e[3].y],i=n.makeObjectArray(P,4);bs(g,i);const r=[],o=[],a=je(t,3,s,3,null,0,[i[0].x,i[1].x,i[2].x,i[3].x],3,[i[0].y,i[1].y,i[2].y,i[3].y],3,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),r,o,l);if(a>0)for(let e=0;e<a;e++){const t=new n.Point2D;Ys(g,o[e],t);const s=new n.Point2D;Ys(c,r[e],s),n.Point2D.distance(s,t)<=m&&(x.push(s.clone()),v.push(o[e]),E.push(r[e]))}else-1===a&&(C=!0)}for(let e=0;e<2;e++){const t=0===e?c:g,s=0===e?g:c;for(let i=0;i<2;i++){const r=0===i?0:3,o=[0];sn(s,t[r],n.Envelope1D.unit(),!1,-1,1,o);const a=new n.Point2D;Ys(s,o[0],a),n.Point2D.distance(t[r],a)<=m&&(0===e?(E.push(0===r?0:1),v.push(o[0])):(v.push(0===r?0:1),E.push(o[0])),x.push(a.clone()))}}if(0===E.length&&C){const e=s.calculateUpperLength2D()>i.calculateUpperLength2D();{const r=[0,0];if(2===rn(e?s:i,r,!0)&&(t.geometryReleaseAssert(n.Envelope1D.unit().containsCoordinate(r[0])),!n.Envelope1D.unit().containsCoordinate(r[1]))){const t=new n.Point2D;Ys(e?c:g,r[0],t);const s=[0,0];1===sn(e?g:c,t,n.Envelope1D.unit(),!1,-1,2,s)&&(x.push(t.clone()),E.push(e?r[0]:s[0]),v.push(e?s[0]:r[0]))}}}if(0===E.length)return 0;if(!_.equalsRange(0,1))for(let e=0;e<E.length;++e)E[e]=pn.recalculateParentT(_.vmin,_.vmax,E[e]);if(!f.equalsRange(0,1))for(let e=0;e<v.length;++e)v[e]=pn.recalculateParentT(f.vmin,f.vmax,v[e]);return Tr(e,s,i,E,v,E.length,r,o,a,m,h,0,u)}function Ks(e,s,i,r,o,a,m,h,l,u){const c=H(s,i);if(i.isDegenerateToLineHelper(c)){const t=new Gr({start:i.getStartXY(),end:i.getEndXY()}),n=Ws(e,s,t,r,o,a,m,h,0,u);if(a)for(let e=0;e<n;++e){const s=t.getCoord2D(a[e]);a[e]=i.getClosestCoordinate(s,!1)}return n}if(O(s,i,m=Math.max(m,c)))return 0;const g=n.makeObjectArray(n.Point2D,4);s.queryControlPoints(g);const p=n.makeObjectArray(n.Point2D,3);i.queryControlPoints(p);const _=new n.Envelope1D(0,1),f=new n.Envelope1D(0,1),y=[0,0,0];i.queryWeights(y);const x=[1,oi(y),1];{const e=new d;en(g,new n.Envelope1D(0,1),e);const t=new d;On(p,x,new n.Envelope1D(0,1),t);const s=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*m),t.inflate(3*m),!e.intersectW(t))return 0;if(e.maxDim()<.1*s){if(mn(g,e,_),_.isEmpty())return 0;if(ri(p,x,e,f),f.isEmpty())return 0;Os(g,_.vmin,_.vmax,g),zn(p,x,f.vmin,f.vmax,p,x)}}const E=Ar(g,3,p,2,m);if(0===E)return 0;const v=[],C=[],D=[];if(-1===E){const e=n.makeObjectArray(P,4);bs(g,e);const t=[e[0].x,e[1].x,e[2].x,e[3].x],s=[e[0].y,e[1].y,e[2].y,e[3].y],i=n.makeObjectArray(n.MPValue,3),r=n.makeObjectArray(n.MPValue,3),o=n.makeObjectArray(n.MPValue,3);ei(p,x,i,r,o);const a=[],h=[],u=je(i,2,r,2,o,2,t,3,s,3,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),h,a,l);if(u>0)for(let e=0;e<u;e++){const t=new n.Point2D;Ys(g,a[e],t);const s=new n.Point2D;ii(p,x,h[e],s),n.Point2D.distance(t,s)<=m&&(v.push(t.clone()),C.push(a[e]),D.push(h[e]))}}for(let e=0;e<2;e++){let s,i;0===e?(s=g,i=p):(i=g,s=p);for(let r=0;r<2;r++){const o=0===r?0:s.length-1,a=[0],h=new n.Point2D;if(0===e){const e=Vn(i,x,s[o],n.Envelope1D.unit(),!1,-1,1,a);t.geometryReleaseAssert(1===e),ii(i,x,a[0],h)}else{const e=sn(i,s[o],n.Envelope1D.unit(),!1,-1,1,a);t.geometryReleaseAssert(1===e),Ys(i,a[0],h)}n.Point2D.distance(s[o],h)<=m&&(0===e?(C.push(0===o?0:1),D.push(a[0])):(D.push(0===o?0:1),C.push(a[0])),v.push(h.clone()))}}if(0===C.length)return 0;if(!_.equalsRange(0,1))for(let e=0;e<C.length;++e)C[e]=pn.recalculateParentT(_.vmin,_.vmax,C[e]);if(!f.equalsRange(0,1))for(let e=0;e<D.length;++e)D[e]=Ye.recalculateParentT(f.vmin,f.vmax,D[e]);for(let e=0;e<D.length;++e)D[e]=ai(y,D[e]);return Tr(e,s,i,C,D,C.length,r,o,a,m,h,0,u)}function $s(e,s,i,r,o,a,m,h,l,u){const c=H(s,i);if(O(s,i,m=Math.max(m,c)))return 0;const g=n.makeObjectArray(n.Point2D,4);s.queryControlPoints(g);const d=n.makeObjectArray(n.Point2D,3);i.queryControlPoints(d);const p=Ar(g,3,d,2,m);if(0===p)return 0;const _=[],f=[],y=[];if(-1===p){const e=n.makeObjectArray(P,4);bs(g,e);const t=[e[0].x,e[1].x,e[2].x,e[3].x],r=[e[0].y,e[1].y,e[2].y,e[3].y],o=n.makeObjectArray(P,3);Lt(d,o);const a=je([o[0].x,o[1].x,o[2].x],2,[o[0].y,o[1].y,o[2].y],2,null,0,t,3,r,3,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),y,f,h);if(a>0){let e=0;for(let t=0;t<a;t++){const r=new n.Point2D;s.queryCoord2D(f[t],r);const o=new n.Point2D;i.queryCoord2D(y[t],o),n.Point2D.distance(r,o)<=m&&(_.push(r.clone()),f[e]=f[t],y[e]=y[t],e++)}f.length=e,_.length=e}}for(let e=0;e<2;e++){let s,i;0===e?(s=g,i=d):(i=g,s=d);for(let r=0;r<2;r++){const o=0===r?0:s.length-1,a=[0],h=new n.Point2D;if(0===e)At(i,s[o],a),Bt(i,a[0],h);else{const e=sn(i,s[o],n.Envelope1D.unit(),!1,-1,1,a);t.geometryReleaseAssert(1===e),Ys(i,a[0],h)}n.Point2D.distance(s[o],h)<=m&&(0===e?(f.push(0===o?0:1),y.push(a[0])):(y.push(0===o?0:1),f.push(a[0])),_.push(h.clone()))}}return Tr(e,s,i,f,y,f.length,r,o,a,m,h,0,u)}function Js(e,t,s){const i=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(i),en(i,t,s)}function en(e,t,s){if(t.equalsRange(0,1))return void s.setFromPoints(e,4);const i=n.makeObjectArray(n.Point2D,4);Os(e,t.vmin,t.vmax,i),s.setFromPoints(i,4)}let tn=class{constructor(e,t,s){this.dbgCounter=0,this.controlPoints=e,this.point=t.clone(),this.maxDistance=s}getMaxDerivative(){return 6}getValue(e,t){switch(e){case 0:{const e=new n.Point2D;Ys(this.controlPoints,t,e);const s=Ms(this.controlPoints,1,t);return 2*e.sub(this.point).dotProduct(s)}case 1:{const e=new n.Point2D;Ys(this.controlPoints,t,e);const s=Ms(this.controlPoints,1,t),i=Ms(this.controlPoints,2,t);return 2*(e.sub(this.point).dotProduct(i)+s.dotProduct(s))}case 2:{const e=new n.Point2D;Ys(this.controlPoints,t,e);const s=Ms(this.controlPoints,1,t),i=Ms(this.controlPoints,2,t),r=Ms(this.controlPoints,3,t);return 2*(e.sub(this.point).dotProduct(r)+3*s.dotProduct(i))}case 3:{const e=Ms(this.controlPoints,1,t),s=Ms(this.controlPoints,2,t),n=Ms(this.controlPoints,3,t);return 2*(4*e.dotProduct(n)+3*s.sqrLength())}case 4:{const e=Ms(this.controlPoints,2,t),s=Ms(this.controlPoints,3,t);return 10*e.dotProduct(s)*2}case 5:{const e=Ms(this.controlPoints,3,t);return 10*e.dotProduct(e)*2}default:return 0}}getError(e){return 0}isInterestingInterval(e,t){if(e>=0&&t<=1){const s=n.makeObjectArray(n.Point2D,4);Os(this.controlPoints,e,t,s);const i=new d;if(i.setFromPoints(s,4),Math.sqrt(i.sqrMinDistance(this.point))>this.maxDistance)return!1}return!0}};function sn(e,i,r,o,a,m,h){t.checkAndThrow(n.Envelope1D.unit().contains(r)&&m>0,"getClosestCoordinate"),(a<0||Number.isNaN(a))&&(a=Number.MAX_VALUE);const l=[],u=new n.Point2D;Ys(e,r.vmin,u);let c=n.Point2D.distance(u,i);if(c<=a&&l.push(new n.Point2D(r.vmin,c)),r.vmin!==r.vmax&&(Ys(e,r.vmax,u),c=n.Point2D.distance(u,i),c<=a&&l.push(new n.Point2D(r.vmax,c))),r.width()>0){const t=n.makePrimitiveArray(18,Number.NaN),s=Ce(new tn(e,i,a),r,18,t);for(let r=0;r<s;r++)Ys(e,t[r],u),c=n.Point2D.distance(u,i),c>a||l.push(new n.Point2D(t[r],c))}if(o){t.geometryReleaseAssert(r.equals(n.Envelope1D.unit()));{Ys(e,-1,u,!0);const t=new n.Point2D;Ys(e,0,t);const s=new Gr({start:u,end:t}),r=s.getClosestCoordinate(i,!0);r<1&&(u.assign(s.getCoord2D(r)),c=n.Point2D.distance(u,i),c<=a&&l.push(new n.Point2D(r-1,c)))}{Ys(e,2,u,!0);const t=new n.Point2D;Ys(e,r.vmax,t);const s=new Gr({start:t,end:u}),o=s.getClosestCoordinate(i,!0);o>0&&(u.assign(s.getCoord2D(o)),c=n.Point2D.distance(u,i),c<=a&&l.push(new n.Point2D(1+o,c)))}}if(!l.length)return 0;l.sort((e,t)=>e.compare(t));let g=0;const d=l[0].x;if(h[g++]=d,g<m){const t=s.calculateToleranceFromPointsForOps(e,4,!1).total(),i=l[0].y;for(let e=1,s=l.length;e<s;e++)if(l[e].y>i+t){l.length=e;break}l.sort((e,t)=>n.standardNumericCompare(e.x,t.x)),g=0,h[g++]=l[0].x;for(let e=1,t=l.length;e<t;e++)l[e].x!==h[g-1]&&g<m&&(h[g++]=l[e].x)}return g}function nn(e,t,s,i,r,o,a){const m=n.makeObjectArray(n.Point2D,4);return e.queryControlPoints(m),sn(m,t,s,i,r,o,a)}function rn(e,t,s=!1){const i=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(i);const r=n.makeObjectArray(P,4);let o,a,m;bs(i,r,!0);const h=r[3].x.isZero(),l=r[3].y.isZero();if(h||l)if(h&&!l){if(r[2].x.isZero())return 0;o=r[1].x.div(r[2].x).negate(),a=r[2].y.div(r[3].y),m=r[1].y.div(r[3].y)}else{if(h||!l)return 0;if(r[2].y.isZero())return 0;o=r[1].y.div(r[2].y).negate(),a=r[2].x.div(r[3].x),m=r[1].x.div(r[3].x)}else{r[2].x.divThis(r[3].x),r[1].x.divThis(r[3].x),r[2].y.divThis(r[3].y),r[1].y.divThis(r[3].y);const e=r[2].x.sub(r[2].y);if(e.isZero())return 0;o=r[1].x.sub(r[1].y).div(e).negate(),a=r[2].x.clone(),m=r[1].x.clone()}if(!s&&o.abs().value()>2)return 0;const u=[0,0],c=e.getStartXY().equals(e.getEndXY()),g=De(1,-o.toDouble(),o.add(a).mul(o).add(m).toDouble(),n.Envelope1D.unit(),c,u);if(0===g)return 0;if(u[0]>=0&&u[0]<=1){const e=o.toDouble()-u[0];if(s||e>=0&&e<=1)return t[0]=u[0],t[1]=e,t[0]>t[1]&&(t[1]=n.swap(t[0],t[0]=t[1])),2}if(2===g&&u[1]>=0&&u[1]<=1){const e=o.toDouble()-u[1];if(s||e>=0&&e<=1)return t[0]=u[1],t[1]=e,t[0]>t[1]&&(t[1]=n.swap(t[0],t[0]=t[1])),2}return 0}function on(e,s){s[0].set(0);let i=1;const r=n.makeObjectArray(n.ECoordinate,4);Cs(e,r,!0);const o=n.makeObjectArray(n.ECoordinate,4);Ds(e,o,!0);{const e=r[3].mul(3),t=r[2].mul(2),o=r[1].clone(),a=n.makeObjectArray(n.ECoordinate,2);let m=Ne(e,t,o,new n.Envelope1D(0,1),!1,a);m<0&&(m=0);for(let e=0;e<m;e++)n.isOneOf(a[e].value(),0,1)||(s[i]=a[e],i++)}{const e=o[3].mul(3),t=o[2].mul(2),r=o[1].clone(),a=n.makeObjectArray(n.ECoordinate,2);let m=Ne(e,t,r,new n.Envelope1D(0,1),!1,a);m<0&&(m=0);for(let e=0;e<m;e++)n.isOneOf(a[e].value(),0,1)||(s[i]=a[e],i++)}const a=function(e,t,s){const i=e[1].mulE(t[2]).subThisE(e[2].mulE(t[1])),r=e[1].mulE(t[3]).subThisE(e[3].mulE(t[1])).mulThis(3),o=e[2].mulE(t[3]).subThisE(e[3].mulE(t[2])).mulThis(3),a=n.makeObjectArray(n.ECoordinate,2);let m=Ne(o,r,i,new n.Envelope1D(0,1),!1,a);m<0&&(m=0);let h=0;for(let e=0;e<m;e++)n.isOneOf(a[e].value(),0,1)||(s[h].setE(a[e]),h++);return h}(r,o,s.slice(i));if(i+=a,s[i].set(1),i++,i>2){n.sortRange(s,0,i,(e,t)=>{const s=e.value(),n=t.value();return s<n?-1:s>n?1:0});let t=0;const r=s[0].clone();let o=0;const a=((m=e)[0].norm(1)+m[1].norm(1)+m[2].norm(1)+m[3].norm(1))*n.doubleEps(),h=new n.Point2D;Vs(e,s[0].value(),h);for(let m=1;m<i;m++){const i=new n.Point2D;if(Vs(e,s[m].value(),i),s[m].eq(r)||i.isEqualPoint2D(h,a)){if(0!==t){if(0===s[m].eps())r.setE(s[m]),o=0;else if(0!==o){const e=n.sqr(1/s[m].eps()),t=1/o,i=e+t;r.set((s[m].value()*e+r.value()*t)/i),o=1/i,r.setError(Math.sqrt(o))}s[t].setE(r),Vs(e,r.value(),h)}}else t++,s[t].setE(s[m]),r.setE(s[m]),Vs(e,r.value(),h),o=n.sqr(s[m].eps())}t++,i=t}var m;return 1===i&&(i=2,s[1].set(1)),t.geometryReleaseAssert(0===s[0].value()),t.geometryReleaseAssert(1===s[i-1].value()),i}function an(e,t,s,i){const r=n.makeObjectArray(n.Point2D,s);for(let e=0;e<s;++e)r[e]=new n.Point2D(e/(s-1),0);const o=(e,t,s,i)=>{const r=new n.ECoordinate(t.x).subE(new n.ECoordinate(e.x)).divE(new n.ECoordinate(t.y).subE(new n.ECoordinate(e.y))).mulE(new n.ECoordinate(s).subE(new n.ECoordinate(e.y))).addE(new n.ECoordinate(e.x));if(r.eps()>.1){const i=(t.x-e.x)/(t.y-e.y)*(s-e.y)+e.x;r.set(i,n.doubleEps())}if(r.lt(new n.ECoordinate(0))||r.gt(new n.ECoordinate(1)))return!1;let o=r.value()-r.eps();o=n.snap(o,0,1);let a=r.value()+r.eps();return a=n.snap(a,0,1),i.mergeCoordinate(o),i.mergeCoordinate(a),!0},a=[];{const t=(e,t)=>{a.length=s;const i=as(r,s,a,!0),m=new n.Envelope1D;m.setEmpty();const h=s=>s.y<e?-1:s.y>t?1:0;let l=r[a[0]],u=h(l);0===u&&m.mergeCoordinate(l.x);for(let s=1;s<=i;++s){const n=r[a[s%i]],c=h(n);0===c&&m.mergeCoordinate(n.x);let g=0;c!==u&&(g=c*u===0?1===c||1===u?2:1:3,1&g&&o(l,n,e,m),2&g&&o(l,n,t,m)),l=n,u=c}return m};for(let t=0;t<s;++t)r[t].y=e[t].x;const m=t(i.xmin,i.xmax);if(m.isEmpty())return new n.Envelope1D(m);for(let t=0;t<s;++t)r[t].y=e[t].y;const h=t(i.ymin,i.ymax);return m.intersect(new n.Envelope1D(h)),new n.Envelope1D(m)}}function mn(e,t,s){s.setEmpty(),s.merge(function(e,t,s,i){const r=an(e,0,4,i.getEnvelope2D());if(r.isEmpty())return new n.Envelope1D(r);const o=n.makeObjectArray(n.Point2D,4);for(let t=0;t<4;++t)i.xyRot(e[t],o[t]);const a=an(o,0,4,i.getRotatedEnvelope2D());return r.intersect(new n.Envelope1D(a)),new n.Envelope1D(r)}(e,0,0,t))}class hn{constructor(e,t){this.b=e,this.len=t}getMaxDerivative(){return 1}getValue(e,t){return 0===e?this.len-Ss(this.b,t,!1):0}getError(e){return 0}}function ln(e,s,i,r,o,a,m){for(;;){const h=n.Point2D.distance(s[0],s[3]),l=n.Point2D.distance(s[0],s[1])+n.Point2D.distance(s[1],s[2])+n.Point2D.distance(s[2],s[3]);if(l-h<=r+i*l)return e+n.lerp(h,l,.5);const u=e=>Ms(s,1,e).length();{t.geometryReleaseAssert(m<12);let h=u(0),c=u(1);o[0]+=2,h>c&&(c=n.swap(h,h=c),s[3]=n.swap(s[0],s[0]=s[3]),s[2]=n.swap(s[1],s[1]=s[2]));let g=h/(h+c),d=1,p=l;for(;g<1/32&&p>=32*(r+i*p);){d/=4;const e=u(d);o[0]++,g=h/(e+h);const t=new n.Point2D;if(Ys(s,.5*d,t),p=n.Point2D.distance(t,s[0]),p<=r){const e=new n.Point2D;Ys(s,d,e),p+=n.Point2D.distance(e,t)}}if(1!==d){const t=n.makeObjectArray(n.Point2D,4);Hs(s,d,s,t),e=ln(e,t,i,r,o,0,m+1),a++,m++;continue}}const c=8;o[0]+=c;const g=Jt(c,u,0,1),d=16;o[0]+=d;const p=Jt(d,u,0,1);let _=Math.abs(g-p)>r+i*l;if(!_)return e+p;if(a<3){const t=n.makeObjectArray(n.Point2D,4);Hs(s,.5,s,t),e=ln(e,t,i,r,o,a+1,m+1),a++,m++;continue}const f=32;o[0]+=f;const y=Jt(f,u,0,1);if(_=Math.abs(p-y)>r+i*l,!_)return e+y;const x=64;o[0]+=x;const P=Jt(x,u,0,1);if(_=Math.abs(y-P)>r+i*l,!_)return e+P;const E=128;o[0]+=E;const v=Jt(E,u,0,1);return _=Math.abs(P-v)>r+i*l,e+v}}function un(e,t,s,i,r){if(s===t)return 0;const o=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(o);const a=n.makeObjectArray(n.Point2D,4);return Os(o,t,s,a),ln(0,a,i,r,[0],0,0)}function cn(e,t,s,i,r){let o=!0;const a=lt(5,t,s,i,r,t=>{const s=Rs(e,1,t);return(o?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*s.length()});o=!1;const m=lt(5,t,s,i,r,t=>{const s=Rs(e,1,t);return(o?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*s.length()});return new n.Point2D(a,m)}function gn(e,s,i,r,o,a,m,h,l,u,c,g){t.geometryReleaseAssert(u+2===g);let d=0,p=0,_=0,f=0,y=0,x=0,P=0;const E=(e,t)=>{const s=1-t,m=i.mul(n.cube(s)),h=r.mul(3*t*s*s),l=o.mul(3*t*t*s),u=a.mul(n.cube(t));return m.add(h).add(l).add(u).sub(c[e]).sqrLength()};for(let t=1,s=g-1;t<s;t++){let s=l[t-1];if(e){t>2?(s=n.snap(2*l[t-2]-l[t-3],0,1),l[t-1]=s):2===t&&(s=n.snap(2*l[t-2],0,1),l[t-1]=s);const e=(e,t,s)=>{let m=-1;for(let h=0;!(Math.abs(t-m)<1e-12)&&10!==h;h++){const h=t*t,l=1-t,u=l*l,g=u*l,d=i.x-2*r.x+o.x,p=i.x-3*r.x+3*o.x-a.x,_=i.y-2*r.y+o.y,f=i.y-3*r.y+3*o.y-a.y,y=i.x-r.x-2*d*t+p*h,x=-c[e].x+i.x*g+t*(3*r.x*u+t*(3*o.x*l+a.x*t)),P=i.y-r.y-2*_*t+f*h,E=-c[e].y+i.y*g+t*(3*r.y*u+t*(3*o.y*l+a.y*t)),v=-6*(y*x+P*E),C=6*(3*n.sqr(y)-(-2*d+2*p*t)*x)+6*(3*n.sqr(P)-(-2*_+2*f*t)*E);if(m=t,0===C)break;{const e=t-v/C;t=n.snap(e,s,1)}}return m};{const s=E(t,l[t-1]);let n=e(t,l[t-1],0),i=E(t,n);if(1.01*s<i){const s=t>1?l[t-2]:0,r=e(t,.3*(l[t-1]-s)+s,0),o=E(t,r);o<i&&(i=o,n=r)}s>i&&(l[t-1]=n)}}const m=l[t-1],h=m*m,u=h*m,g=1-m,v=g*g,C=v*g;d+=3*h*v*v,p+=3*u*C,_+=3*h*h*v;const D=-(C*i.x+u*a.x-c[t].x);f+=D*m*v,y+=D*h*g;const b=-(C*i.y+u*a.y-c[t].y);x+=b*m*v,P+=b*h*g}if(s){const e=d*_-p*p;Math.abs(e)>=1e-12*(Math.abs(d*_)+Math.abs(p*p))+1e-10?(m||(r.x=(f*_-y*p)/e,r.y=(x*_-P*p)/e),h||(o.x=(d*y-p*f)/e,o.y=(d*P-p*x)/e)):(n.lerpPoint2D(i,a,.3,r),n.lerpPoint2D(i,a,.6,o))}let v=0;for(let e=1,t=g-1;e<t;e++)v+=E(e,l[e-1]);return v}var dn=s.VertexDescription;class pn extends U{constructor(e){e&&e.cp?(super({start:e.cp[0],end:e.cp[3],vd:e.vd}),this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].assign(e.cp[1]),this.m_cp[1].assign(e.cp[2])):void 0===e||n.isOnlyProperty(e,"vd")?(super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)):e.from?(super({start:e.from,end:e.to,vd:e.vd}),this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].assign(e.cp1),this.m_cp[1].assign(e.cp2)):(super({XStart:0,YStart:0,XEnd:0,YEnd:0,vd:e.vd}),t.throwInternalErrorException("unrecognized constructor params"),this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].setCoords(0,0),this.m_cp[1].setCoords(0,0)),this.m_cachedValues=0}getBoundary(){return Ee(this)}construct(e,t,s,n){this.m_XStart=e.x,this.m_YStart=e.y,this.m_XEnd=n.x,this.m_YEnd=n.y,this.m_cp[0].assign(t),this.m_cp[1].assign(s),this.afterCompletedModification()}constructPoints(e){this.m_XStart=e[0].x,this.m_YStart=e[0].y,this.m_XEnd=e[3].x,this.m_YEnd=e[3].y,this.m_cp[0].assign(e[1]),this.m_cp[1].assign(e[2]),this.afterCompletedModification()}constructFromQuadratic(e){const t=n.makeObjectArray(n.Point2D,4);var s,i;s=e,(i=t)[0].assign(s[0]),i[3].assign(s[2]),n.lerpPoint2D(s[0],s[1],2/3,i[1]),n.lerpPoint2D(s[1],s[2],1/3,i[2]),this.constructPoints(t)}constructFromQuadraticSegment(e){this.dropAllAttributes(),this.assignVertexDescription(e.getDescription()),this.m_XStart=e.getStartX(),this.m_YStart=e.getStartY(),this.m_XEnd=e.getEndX(),this.m_YEnd=e.getEndY(),n.lerpPoint(2,e.getStartXY(),e.getControlPoint1(),2/3,this.m_cp[0]),n.lerpPoint(2,e.getControlPoint1(),e.getEndXY(),1/3,this.m_cp[1]),this.afterCompletedModification(),q(this,e)}getGeometryType(){return t.GeometryType.enumBezier}queryEnvelope(e){if(2!==e.m_EnvelopeType)return void t.geometryReleaseAssert(0);if(e.setCoords(this.getStartXY()),e.mergeNe(this.getEndXY()),e.contains(this.m_cp[0])&&e.contains(this.m_cp[1]))return;const s=ws(this);if(null!==s){const t=new n.Point2D;for(const n of s.specialPoints)this.queryCoord2D(n,t),e.mergeNe(t);return}const i=n.makeObjectArray(n.ECoordinate,8),r=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(r);const o=on(r,i),a=new n.Point2D;for(let t=1;t<o-1;t++)this.queryCoord2D(i[t].value(),a),e.mergeNe(a)}applyTransformation(e){if(1===e.m_TransformationType){const t=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(t),e.transformPoints2D(t,4,t),this.setStartXY(t[0]),this.m_cp[0].assign(t[1]),this.m_cp[1].assign(t[2]),this.setEndXY(t[3]),void As(this)}t.geometryReleaseAssert(0)}createInstance(){return new pn({vd:this.m_description})}calculateLength2D(){return Ss(this,1,!1)}calculateLowerLength2D(){return n.Point2D.distance(this.getStartXY(),this.getEndXY())}calculateUpperLength2D(){return n.Point2D.distance(this.getStartXY(),this.m_cp[0])+n.Point2D.distance(this.m_cp[0],this.m_cp[1])+n.Point2D.distance(this.getEndXY(),this.m_cp[1])}queryCoord2D(e,t){return this.queryCoord2DExtends(e,t,!0)}queryCoord2DMP(e,s){t.geometryReleaseAssert(0)}queryCoord2DExtends(e,t,s){const i=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(i),Ys(i,e,t,s)}queryCoord2DE(e,t){!function(e,t,s){const i=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(i),function(e,t,s){if(t.value()<=.5){const i=new y;n.lerpLoPointE(2,y.constructPoint2D(e[0]),y.constructPoint2D(e[1]),t,i);const r=new y;n.lerpLoPointE(2,y.constructPoint2D(e[1]),y.constructPoint2D(e[2]),t,r);const o=new y;n.lerpLoPointE(2,y.constructPoint2D(e[2]),y.constructPoint2D(e[3]),t,o);const a=new y;n.lerpLoPointE(2,i,r,t,a);const m=new y;n.lerpLoPointE(2,r,o,t,m),n.lerpLoPointE(2,a,m,t,s)}else{const i=new y;n.lerpHiPointE(2,y.constructPoint2D(e[0]),y.constructPoint2D(e[1]),t,i);const r=new y;n.lerpHiPointE(2,y.constructPoint2D(e[1]),y.constructPoint2D(e[2]),t,r);const o=new y;n.lerpHiPointE(2,y.constructPoint2D(e[2]),y.constructPoint2D(e[3]),t,o);const a=new y;n.lerpHiPointE(2,i,r,t,a);const m=new y;n.lerpHiPointE(2,r,o,t,m),n.lerpHiPointE(2,a,m,t,s)}}(i,t,s)}(this,e,t)}getCoordX(e){if(e<0||e>1){const t=new n.Point2D;return this.queryCoord2DExtends(e,t,!0),t.x}const t=n.lerp(this.getStartX(),this.m_cp[0].x,e),s=n.lerp(this.m_cp[0].x,this.m_cp[1].x,e),i=n.lerp(this.m_cp[1].x,this.getEndX(),e),r=n.lerp(t,s,e),o=n.lerp(s,i,e);return n.lerp(r,o,e)}getCoordY(e){if(e<0||e>1){const t=new n.Point2D;return this.queryCoord2DExtends(e,t,!0),t.y}const t=n.lerp(this.getStartY(),this.m_cp[0].y,e),s=n.lerp(this.m_cp[0].y,this.m_cp[1].y,e),i=n.lerp(this.m_cp[1].y,this.getEndY(),e),r=n.lerp(t,s,e),o=n.lerp(s,i,e);return n.lerp(r,o,e)}cut(e,t,s){const n=new Mr;return this.queryCut(e,t,n,s),n.releaseSegment()}queryCut(e,t,s,n){const i=s.createCubicBezier();if(this.cutBezierIgnoreAttributes(e,t,i),n)return;i.assignVertexDescription(this.m_description);const r=this.m_description.getAttributeCount();if(r>1){for(let t=1;t<r;t++){const s=this.m_description.getSemantics(t),n=dn.getComponentCount(s);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,s,t);i.setStartAttribute(s,t,n)}}for(let e=1;e<r;e++){const s=this.m_description.getSemantics(e),n=dn.getComponentCount(s);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,s,e);i.setEndAttribute(s,e,n)}}}}queryDerivative(e,t){Ls(this,e,t)}cutBezierIgnoreAttributes(e,s,i){(e<0||s>1||e>s)&&t.throwInvalidArgumentException("Cubic_bezier.cut_bezier_ignore_attributes");const r=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(r);const o=n.makeObjectArray(n.Point2D,4);Os(r,e,s,o),i.setControlPoints(o)}splitBezierIgnoreAttributes(e,s,i){this===s&&this===i&&t.throwInvalidArgumentException("Cubic_bezier.split_bezier_ignore_attributes");const r=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(r);const o=n.makeObjectArray(n.Point2D,4),a=n.makeObjectArray(n.Point2D,4);Hs(r,e,o,a),s&&s.setControlPoints(o),i&&i.setControlPoints(a)}getAttributeAsDbl(e,t,s){if(0===t)return 0===s?this.getCoordX(e):this.getCoordY(e);if(0===e)return this.getStartAttributeAsDbl(t,s);if(1===e)return this.getEndAttributeAsDbl(t,s);const i=this.getStartAttributeAsDbl(t,s),r=this.getEndAttributeAsDbl(t,s),o=this.calculateLength2D(),a=o>0?this.tToLength(e)/o:0,m=dn.getInterpolation(t);return n.interpolate(m,i,r,a,dn.getDefaultValue(t))}getClosestCoordinate(e,t){const s=[Number.NaN];return nn(this,e,n.Envelope1D.unit(),t,-1,1,s),s[0]}getClosestCoordinateOnInterval(e,t,s=-1){const n=[Number.NaN];return 0===nn(this,e,t,!1,s,1,n)?Number.NaN:n[0]}getYMonotonicParts(e,t=!1){return this.getMonotonicParts(e,t)}getMonotonicParts(e,s){e.length<2&&t.throwInvalidArgumentException("");const n=Is(this);if(2===n.specialPointsCount()&&this.isMonotoneQuickAndDirty())return 0;let i=0;t.geometryReleaseAssert(e.length>=n.specialPointsCount()-1);for(let t=1,r=n.specialPointsCount();t<r;++t)this.queryCut(n.specialPoints[t-1],n.specialPoints[t],e[i],s),i++;for(let t=0;t<i;++t)Fs(e[t].get());return i}intersectionWithAxis2D(e,t,s,i){const r=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(r),function(e,t,s,i,r){const o=n.makeObjectArray(n.ECoordinate,4),a=n.makeObjectArray(n.ECoordinate,3),m=new n.Envelope1D(0,1);let h=0;if(t){if(Ds(e,o,!1),h=Ge(o[3],o[2],o[1],o[0].sub(s),m,!1,a),i)for(let t=0;t<h;t++){const s=new n.Point2D;Ys(e,a[t].value(),s),i[t]=s.x}}else if(Cs(e,o,!1),h=Ge(o[3],o[2],o[1],o[0].sub(s),m,!1,a),i)for(let t=0;t<h;t++){const s=new n.Point2D;Ys(e,a[t].value(),s),i[t]=s.y}if(r)for(let e=0;e<h;e++)r[e]=a[e].value();else i&&n.sortRange(i,0,h,n.standardNumericCompare);return h}(r,e,t,s,i)}intersectionOfYMonotonicWithAxisX(e,s){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?s:Number.NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;const n=[0,0],i=this.intersectionWithAxis2D(!0,e,n,null);return t.geometryReleaseAssert(2!==i),-1===i?s:n[0]}isCurve(){return!0}isDegenerate(e){return D(this,e)}isDegenerate3D(e,s){return t.geometryReleaseAssert(0),!1}queryLooseEnvelope(e){if(2===e.m_EnvelopeType)return e.setCoords({pt:this.getStartXY()}),e.mergeNe(this.m_cp[0]),e.mergeNe(this.m_cp[1]),void e.mergeNe(this.getEndXY());t.geometryReleaseAssert(0)}clone(e){const t=this.createInstance();return this.copyTo(t),t}queryInterval(e,t){if(0===e){const e=i.Envelope2D.constructEmpty();this.queryEnvelope(e);const s=n.Envelope1D.constructEmpty();return 0===t?e.queryIntervalX(s):e.queryIntervalY(s),s}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){const s=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(s),Os(s,e.vmin,e.vmax,s),t.setFromPoints(s,4)}changeEndPoints2D(e,t){if(e.isEqual(this.m_XStart,this.m_YStart)&&t.isEqual(this.m_XEnd,this.m_YEnd))return;const s=this.m_cp[0].isEqual(this.m_XStart,this.m_YStart),n=this.m_cp[0].isEqual(this.m_XEnd,this.m_YEnd),i=this.m_cp[1].isEqual(this.m_XStart,this.m_YStart),r=this.m_cp[1].isEqual(this.m_XEnd,this.m_YEnd);this.setStartXY(e),this.setEndXY(t),s?this.m_cp[0].setCoordsPoint2D(e):n&&this.m_cp[0].setCoordsPoint2D(t),r?this.m_cp[1].setCoordsPoint2D(t):i&&this.m_cp[1].setCoordsPoint2D(e),this.normalizeAfterEndpointChange()}tToLength(e){return Ss(this,e,!0)}lengthToT(e){const s=function(e,s){const i=Ss(e,1,!1);if(s<=0)return s;if(s>=i)return s-i+1;const r=[0];return 1!==Ce(new hn(e,s),n.Envelope1D.unit(),1,r)&&t.throwInternalErrorException(""),r[0]}(this,e);return s}calculateWeightedAreaCentroid2D(e){const t=n.makeObjectArray(n.Point2D,4);Ps(this,t);const s=t[3],i=t[2],r=t[1],o=new n.Point2D;o.x=(5*s.x*s.x*(7*i.y+16*r.y)+s.x*(-35*s.y*i.x+40*i.x*i.y-80*s.y*r.x+140*i.x*r.y+112*r.x*r.y)-2*(s.y*(20*i.x*i.x+70*i.x*r.x+56*r.x*r.x)-7*(4*i.x+5*r.x)*(-i.y*r.x+i.x*r.y)))/840,o.y=(-5*s.y*s.y*(7*i.x+16*r.x)+s.y*(5*s.x*(7*i.y+16*r.y)-4*(10*i.x*i.y+35*i.y*r.x+28*r.x*r.y))+2*(-7*(4*i.y+5*r.y)*(i.y*r.x-i.x*r.y)+s.x*(20*i.y*i.y+70*i.y*r.y+56*r.y*r.y)))/840;const a=ks(this);return o.x+=(t[0].x-e.x)*a,o.y+=(t[0].y-e.y)*a,o}calculateWeightedCentroid2D(){const e=new n.Point2D;return this.isDegenerate(0)?(e.setCoords(0,0),e):function(e){const t=n.Point2D.distance(e.getStartXY(),e.getEndXY()),s=e.calculateUpperLength2D();return s-t<=8*Number.EPSILON*s}(this)?(e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e):(e.assign(function(e,s,i){void 0===i&&(i=s,s=0);const r=new n.Point2D;if(s<0||i>1)return r.setNAN(),r;if(s>i&&t.throwInvalidArgumentException("calculate_sub_weightedCentroid"),s===i||e.isDegenerate(0))return r.setCoords(0,0),r;const o=Is(e),a=xs(e),m=a/e.calculateUpperLength2D();let h=s,l=0;for(let e=1,t=o.specialPointsCount();e<t;e++)if(s<o.specialPoints[e]){l=e-1;break}r.setCoords(0,0);for(let t=l+1,s=o.specialPointsCount();t<s;t++){const s=Math.min(o.specialPoints[t],i),n=cn(e,h,s,m,a);if(r.addThis(n),h=s,i<=o.specialPoints[t])break}return r.add(e.getStartXY().mul(e.calculateLength2D()))}(this,1)),e)}getControlPoint1(){return this.m_cp[0].clone()}setControlPoint1(e){this.m_cp[0].setCoordsPoint2D(e),this.afterCompletedModification()}getControlPoint2(){return this.m_cp[1].clone()}setControlPoint2(e){this.m_cp[1].setCoordsPoint2D(e),this.afterCompletedModification()}queryControlPoints(e){e[0].assign(this.getStartXY()),e[1].assign(this.m_cp[0]),e[2].assign(this.m_cp[1]),e[3].assign(this.getEndXY())}queryControlPointsHelper(e){return this.queryControlPoints(e),4}setControlPoints(e){for(let s=0;s<4;s++)e[s].isNAN()&&t.throwInvalidArgumentException("NAN control points in bezier are not supported");this.m_XStart=e[0].x,this.m_YStart=e[0].y,this.m_cp[0].setCoordsPoint2D(e[1]),this.m_cp[1].setCoordsPoint2D(e[2]),this.m_XEnd=e[3].x,this.m_YEnd=e[3].y,this.afterCompletedModification()}getTangent(e){const t=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(t),Xs(t,e)}getDerivative(e){const t=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(t),Ms(t,1,e)}getCurvature(e){const t=Rs(this,1,e),s=Rs(this,2,e),n=t.sqrLength();return 0===n?Number.NaN:(t.divThis(Math.sqrt(n)),t.crossProduct(s)/n)}isIntersectingPoint(e,t,s){if(s&&(e.equals(this.getStartXY())||e.equals(this.getEndXY())))return!1;const r=new i.Envelope2D;if(this.queryLooseEnvelope(r),r.inflateCoords(t,t),!r.contains(e))return!1;const o=this.getClosestCoordinate(e,!1),a=new n.Point2D;return this.queryCoord2D(o,a),n.Point2D.distance(a,e)<=t}isIntersectingPoint3D(e,s,n,i,r=1){return t.geometryReleaseAssert(0),!1}isMonotoneQuickAndDirty(){const e=n.makeObjectArray(n.Point2D,4);return this.queryControlPoints(e),function(e){return function(e){const t=n.compareNoNANs(e[0].y,e[1].y),s=n.compareNoNANs(e[1].y,e[2].y),i=n.compareNoNANs(e[2].y,e[3].y);if(t>=0&&s>=0&&i>=0||t<=0&&s<=0&&i<=0){const t=n.compareNoNANs(e[0].x,e[1].x),s=n.compareNoNANs(e[1].x,e[2].x),i=n.compareNoNANs(e[2].x,e[3].x);if(t>=0&&s>=0&&i>=0||t<=0&&s<=0&&i<=0)return!0}return!1}(e)}(e)}getMonotonicPartParams(e,s){const n=Is(this),i=n.specialPointsCount();if(t.geometryReleaseAssert(L.s_maxMonotonicPartParams>=i),!s)return n.specialPointsCount();e<i&&t.throwInvalidArgumentException("");for(let e=0;e<i;e++)s[e]=n.specialPoints[e];return i}normalizeAfterEndpointChange(){return!1}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=n.swap(this.m_YStart,this.m_YStart=this.m_YEnd);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=n.swap(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_cp[1]=n.swap(this.m_cp[0],this.m_cp[0]=this.m_cp[1]),this.m_cachedValues=null}}findMinDeriv(){const e=new n.ECoordinate;return Gs(this,e),e.value()}isLine(){return!1}isDegenerateToLineHelper(e){const t=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(t);const s=t[3].sub(t[0]),i=s.length();if(n.Point2D.distance(t[0],t[1])+n.Point2D.distance(t[2],t[1])+n.Point2D.distance(t[2],t[3])-i>e)return!1;const r=e;let o=t[1].clone();o.subThis(t[0]);let a=Math.abs(o.crossProduct(s))/i;return!(a>r||(o=t[2].clone(),o.subThis(t[1]),a=Math.abs(o.crossProduct(s))/i,a>r))}copyIgnoreAttributes(e){const t=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(t),e.setControlPoints(t)}calculateArea2DHelper(){return ks(this)}absNorm(){return(e=this).getStartXY().norm(1)+e.getEndXY().norm(1)+e.m_cp[0].norm(1)+e.m_cp[1].norm(1);var e}queryEnvelopeW(e,t){Js(this,e,t)}setSegmentFromCoordsForStitcher(e,s){!function(e,s,i){if(t.geometryReleaseAssert(i>=2),2===i){const t=new n.Point2D;n.lerpPoint2D(s[0],s[i-1],1/3,t);const r=new n.Point2D;return n.lerpPoint2D(s[0],s[i-1],2/3,r),void e.construct(s[0],t,r,s[i-1])}const r=s[0],o=s[i-1],a=[0,0],m=nn(e,r,n.Envelope1D.unit(),!1,Number.NaN,2,a),h=[0,0],l=nn(e,o,n.Envelope1D.unit(),!1,Number.NaN,2,h),u=[];for(let t=0;t<m;t++)for(let m=0;m<l;m++){const l=a[t],c=h[m],g=l>c,d=(t,a)=>{const m=n.makePrimitiveArray(i-2,Number.NaN),h=()=>{let e=0;for(let t=1,r=i-1;t<r;t++){e+=n.Point2D.distance(s[t-1],s[t]);const i=e;m[t-1]=i}e+=n.Point2D.distance(s[i-2],s[i-1]),g&&m.reverse();for(let t=1,s=i-1;t<s;t++)m[t-1]/=e,g&&(m[t-1]=1-m[t-1])};let u=!1,d=!1;{const s=new Mr;g?(e.queryCut(c,l,s,!0),t.assign(s.get().getControlPoint2()),a.assign(s.get().getControlPoint1())):(e.queryCut(l,c,s,!0),t.assign(s.get().getControlPoint1()),a.assign(s.get().getControlPoint2())),r.equals(t)&&(u=!0),o.equals(a)&&(d=!0)}h();let p=Number.MAX_VALUE;const _=t.clone(),f=a.clone();for(let e=0;e<5;e++)p=gn(!0,!1,r,_,f,o,u,d,m,i-2,s,i);for(let e=0;e<30;e++){const e=_.clone();f.clone();const t=gn(!0,!0,r,_,f,o,u,d,m,i-2,s,i);if(p<=t&&e.equals(_)&&e.equals(f))break;p=t}h();let y=!1,x=Number.MAX_VALUE;const P=t.clone(),E=a.clone();for(let e=0;e<30;e++){const e=P.clone();E.clone();const t=gn(y,!0,r,P,E,o,u,d,m,i-2,s,i);if(x<=t&&e.equals(P)&&e.equals(E))break;y=!0,x=t}return x<p?(t.assign(P),a.assign(E)):(t.assign(_),a.assign(f),x=p),x},p=new n.Point2D,_=new n.Point2D,f=[d(p,_),n.Point2D.distance(r,p)+n.Point2D.distance(p,_)+n.Point2D.distance(_,o),p.x,p.y,_.x,_.y];u.splice(u.length,0,...f)}let c=u[0],g=u[1],d=0;for(let e=6;e<u.length;e+=6)u[e]<c&&(c=u[e],g=u[e+1],d=e);let p=d;for(let e=0;e<u.length;e+=6)e!==d&&u[e+1]<g&&Math.abs(c-u[e])<10*c&&(g=u[e+1],p=e);e.construct(r,new n.Point2D(u[p+2],u[p+3]),new n.Point2D(u[p+4],u[p+5]),o)}(this,e,s)}writeInBufferStream(e,t){const s=new Float64Array(4);return this.writeInBuffer_(s),e.writeRangeFromArray(t,s.length,s,!0,1),t+s.length}writeInBuffer_(e){return e[0]=this.m_cp[0].x,e[1]=this.m_cp[0].y,e[2]=this.m_cp[1].x,e[3]=this.m_cp[1].y,4}readFromBufferStream(e,t){const s=new Float64Array(4);e.queryRange(t,s.length,s,!0,1),this.readFromBuffer_(s)}readFromBuffer_(e){this.m_cp=n.makeObjectArray(n.Point2D,2),this.m_cp[0].x=e[0],this.m_cp[0].y=e[1],this.m_cp[1].x=e[2],this.m_cp[1].y=e[3],this.m_cachedValues=null}snapControlPoints(e){const t=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(t);const s=(t,s,i)=>{let r=!1;return n.Point2D.sqrDistance(t,i)<=e&&(r=!t.equals(i),t.setCoordsPoint2D(i),n.Point2D.sqrDistance(s,i)<=e&&(r||=!s.equals(i),s.setCoordsPoint2D(i))),r},i=s(t[1],t[2],t[0]),r=s(t[2],t[1],t[3]);return(i||r)&&this.setControlPoints(t),i||r}needsSnapControlPoints(e){if(!e)return!1;const t=n.makeObjectArray(n.Point2D,4);this.queryControlPoints(t);const s=(t,s,i)=>{let r=!1;return n.Point2D.sqrDistance(t,i)<=e&&(r=!t.equals(i),t.setCoordsPoint2D(i),n.Point2D.sqrDistance(s,i)<=e&&(r||=!s.equals(i),s.setCoordsPoint2D(i))),r},i=s(t[1],t[2],t[0]),r=s(t[2],t[1],t[3]);return i||r}calculateSpecialPointsForCracking(e,t){return function(e,t,s){s.length=0;{const t=new n.ECoordinate;Gs(e,t);const i=new y;if(Ls(e,t,i),i.isZero())return t.isZero()||t.eq(new n.ECoordinate(1))?0:(s.push(t.value()),1)}const i=n.makeObjectArray(n.ECoordinate,4);Es(e,i,!0);const r=n.makeObjectArray(n.ECoordinate,4);vs(e,r,!0);const o=n.makeObjectArray(n.ECoordinate,6),a=i[3].negate().mulE(r[1]).addE(i[2].mulE(r[2]).mul(2)).addE(i[1].mulE(r[3])),m=i[3].negate().mulE(r[1]).subE(i[2].mulE(r[2]).mul(2)).addE(i[1].mulE(r[3])),h=i[2].mulE(i[2]).subE(r[2].mulE(r[2]));o[0]=r[1].mulE(r[1]).mulE(a).addE(i[1].mulE(i[1]).mulE(m)).addE(i[1].mulE(r[1]).mulE(h).mul(2)).mul(6),o[1]=i[2].mulE(r[1]).subE(i[1].mulE(r[2])).mulE(i[2].mulE(i[2]).addE(i[1].mulE(i[3]).mul(2)).addE(r[2].mulE(r[2])).addE(r[1].mulE(r[3]).mul(2))).mul(24);const l=i[1].mulE(r[2]).mulE(r[2]).mulE(r[3]),u=i[2].mulE(i[2]).mulE(i[3]).mulE(r[1]).subE(l).mul(156),c=i[3].mulE(r[1]).subE(i[1].mulE(r[3])),g=i[3].mulE(r[1]).subE(i[1].mulE(r[3])),d=i[1].mulE(i[3]).mulE(g).addE(r[1].mulE(r[3]).mulE(c)).mul(72),p=r[1].mulE(r[3]).subE(i[1].mulE(i[3])),_=i[2].mulE(r[2]).mulE(p).mul(120),f=i[1].mulE(i[2]).mulE(i[2]).mulE(r[3]),x=i[3].mulE(r[1]).mulE(r[2]).mulE(r[2]).subE(f).mul(36);o[2]=u.addE(d).addE(_).addE(x);const P=i[2].mulE(i[3]).mulE(i[3]).mulE(r[1]).subE(i[1].mulE(r[2]).mulE(r[3]).mulE(r[3])).mul(360),E=i[2].mulE(r[2]).mulE(i[2].mulE(i[3]).subE(r[2].mulE(r[3]))).addE(i[3].mulE(r[2]).mulE(r[2]).mulE(r[2])).subE(i[2].mulE(i[2]).mulE(i[2]).mulE(r[3])).mul(24),v=i[2].mulE(r[1]).mulE(r[3]).mulE(r[3]).subE(i[1].mulE(i[3]).mulE(i[3]).mulE(r[2])).mul(72),C=i[3].mulE(r[3]).mulE(r[1].mulE(r[2]).subE(i[1].mulE(i[2]))).mul(288);o[3]=P.addE(E).addE(v).addE(C),o[4]=r[3].mulE(r[3]).addE(i[3].mulE(i[3])).mulE(i[3].mulE(r[1]).subE(i[1].mulE(r[3]))).mul(270).addE(i[3].mulE(r[2]).subE(i[2].mulE(r[3]))).mulE(i[2].mulE(i[3]).addE(r[2].mulE(r[3]))).mul(180),o[5]=i[3].mulE(r[2]).subE(i[2].mulE(r[3])).mulE(i[3].mulE(i[3]).addE(r[3].mulE(r[3]))).mul(216);const D=n.makeObjectArray(n.ECoordinate,5),b=Me(o,5,new n.Envelope1D(0,1),!1,D,5);if(b>0){let i=Math.abs(e.getCurvature(0)),r=0;const o=Math.abs(e.getCurvature(1));(o>i||!Number.isFinite(o))&&(r=1);for(let t=0;t<b;t++){const s=Math.abs(e.getCurvature(D[t].value()));e.getCoord2D(D[t].value()),(s>i||!Number.isFinite(s))&&(i=s,r=D[t].value())}if((!Number.isFinite(i)||1/i<t)&&!n.isOneOf(r,0,1)){const t=e.getCoord2D(r);if(!t.equals(e.getStartXY())&&!t.equals(e.getEndXY()))return s.push(r),1}}if(!e.isClosed()){const t=[0,0],n=rn(e,t,!1);for(let e=0;e<n;e++)t[e]>0&&t[e]<1&&s.push(t[e]);return s.length}return 0}(this,e,t)}ensureXYMonotone(){return Fs(this)}setCoordsForIntersector(e,t,s){!function(e,t,s,i){if(t.isEqual(e.m_XStart,e.m_YStart)&&s.isEqual(e.m_XEnd,e.m_YEnd))return;const o=!!i&&e.isMonotoneQuickAndDirty(),a=new r.Transformation2D,m=n.makeObjectArray(n.Point2D,3);m[0].setCoords(e.m_XStart,e.m_YStart),m[2].setCoords(e.m_XEnd,e.m_YEnd);const h=new n.Point2D;h.setSub(m[2],m[0]),h.leftPerpendicularThis(),m[1].setAdd(m[0],h);const l=n.makeObjectArray(n.Point2D,3);l[0].setCoordsPoint2D(t),l[2].setCoordsPoint2D(s),h.setSub(l[2],l[0]),h.leftPerpendicularThis(),l[1].setAdd(l[0],h),a.setFromTwoTriangles(m,l)?a.transformPoints2D(e.m_cp,2,e.m_cp):(n.lerpPoint2D(t,s,1/3,e.m_cp[0]),n.lerpPoint2D(t,s,2/3,e.m_cp[1])),e.changeEndPoints2D(t,s),o&&Fs(e)}(this,e,t,s)}copyToImpl(e){const t=e;t.m_cp[0].assign(this.m_cp[0]),t.m_cp[1].assign(this.m_cp[1]),Ts(t,ws(this))}reverseImpl(){this.m_cp[1]=n.swap(this.m_cp[0],this.m_cp[0]=this.m_cp[1])}equalsImpl(e){const t=e;return!!this.m_cp[0].equals(t.m_cp[0])&&!!this.m_cp[1].equals(t.m_cp[1])}equalsImplTol(e,t){const s=e;return!!this.m_cp[0].isEqualPoint2D(s.m_cp[0],t)&&!!this.m_cp[1].isEqualPoint2D(s.m_cp[1],t)}swapImpl(e){const t=e;var s;t.m_cp[0]=n.swap(this.m_cp[0],this.m_cp[0]=t.m_cp[0]),t.m_cp[1]=n.swap(this.m_cp[1],this.m_cp[1]=t.m_cp[1]),(s=t).m_cachedValues=n.swap(this.m_cachedValues,this.m_cachedValues=s.m_cachedValues)}afterCompletedModification(){As(this)}isIntersecting(e,t,s){return 0!==Cr(!1,this,e,t,s)}intersect(e,t,s,n,i){return Ir(!1,this,e,t,s,n,i)}intersectPoint(e,s,i){return function(e,s,i,r){const o=new d;if(Js(e,n.Envelope1D.unit(),o),o.inflate(r),!o.isIntersectingPoint2D(s))return 0;const a=Is(e);let m=0,h=a.specialPoints[0];const l=[];for(let n=1,i=a.specialPoints.length;n<i;++n){const i=a.specialPoints[n],r=Ns(e,s,h,i);if(0===l.length)l.push(r);else if(r.t===r.tmin)t.geometryReleaseAssert(l.at(-1).d<=r.d),l.at(-1).tmax=r.tmax;else if(l.at(-1).t===l.at(-1).tmax){t.geometryReleaseAssert(l.at(-1).d>=r.d);const e=l.at(-1).tmin;l[l.length-1]=r,l.at(-1).tmin=e}else l.push(r);h=i}for(const e of l)if(e.d<=r){const s=e.t;i?(m>=i.length&&t.throwOutOfRangeException(""),i[m]=s,m++):m++}return m}(this,e,s,i)}endPointModified(){As(this)}clearEndPointModified(){}}pn.type=t.GeometryType.enumBezier;class _n{constructor(){this.length=Number.NaN,this.area=Number.NaN,this.centroidX=Number.NaN,this.centroidY=0,this.specialPoints=[],this.specialPointsLength=[]}specialPointsCount(){return this.specialPoints.length}}function fn(e,s,i,r,o,a,m,h){for(;;){const l=n.Point2D.distance(s[0],s[2]),u=n.Point2D.distance(s[0],s[1])+n.Point2D.distance(s[1],s[2]);if(u-l<=o+r*u)return e+n.lerp(l,u,.5);const c=n.makeObjectArray(n.Point2D,4),g=e=>(In(s,i,1,e,c),c[1].length());if(0===m&&h<8){t.geometryReleaseAssert(h<8);let l=g(0),c=g(1);a[0]+=2,l>c&&(c=n.swap(l,l=c),s[2]=n.swap(s[0],s[0]=s[2]),i[2]=n.swap(i[0],i[0]=i[2]));let d=l/(l+c),p=1,_=u;for(;d<1/32&&_>=o+r*_;){p/=4;const e=g(p);a[0]++,d=l/(e+l);const t=new n.Point2D;if(ii(s,i,.5*p,t),_=n.Point2D.distance(t,s[0]),_<=o){const e=new n.Point2D;ii(s,i,p,e),_+=n.Point2D.distance(e,t)}}if(1!==p){const t=n.makeObjectArray(n.Point2D,3),l=[0,0,0];Bn(s,i,p,s,i,t,l),e=fn(e,t,l,r,o,a,0,h+1),m++,h++;continue}}let d=!1;const p=8;a[0]+=p;const _=Jt(p,g,0,1),f=16;a[0]+=f;const y=Jt(f,g,0,1);if(d=Math.abs(_-y)>o+r*u,!d)return e+y;if(m<8&&h<9){const t=n.makeObjectArray(n.Point2D,3),l=[0,0,0];Bn(s,i,.5,s,i,t,l),e=fn(e,t,l,r,o,a,m+1,h+1),m++,h++;continue}const x=32;a[0]+=x;const P=Jt(x,g,0,1);if(d=Math.abs(y-P)>o+r*u,!d)return e+P;const E=64;a[0]+=E;const v=Jt(E,g,0,1);if(d=Math.abs(P-v)>o+r*u,!d)return e+v;const C=128;a[0]+=C;const D=Jt(C,g,0,1);return d=Math.abs(v-D)>o+r*u,e+D}}function yn(e,t,s,i,r){if(s===t)return 0;const o=n.makeObjectArray(n.Point2D,3),a=[0,0,0];e.queryControlPoints(o),e.queryWeights(a);const m=[0,0,0],h=n.makeObjectArray(n.Point2D,3);return zn(o,a,t,s,h,m),fn(0,h,m,i,r,[0],0,0)}class xn{constructor(e,t,s){this.controlPoints=n.cloneObjectArray(e,3),this.weights=[0,0,0],n.memcpy(this.weights,t,0,0,3),this.point=s.clone()}getMaxDerivative(){return 3}getValue(e,t){if(0===e){const e=new n.Point2D;ii(this.controlPoints,this.weights,t,e);const s=n.makeObjectArray(n.Point2D,4);return In(this.controlPoints,this.weights,1,t,s),2*e.sub(this.point).dotProduct(s[1])}if(1===e){const e=new n.Point2D;ii(this.controlPoints,this.weights,t,e);const s=n.makeObjectArray(n.Point2D,4);return In(this.controlPoints,this.weights,2,t,s),2*(e.sub(this.point).dotProduct(s[2])+s[1].dotProduct(s[1]))}if(2===e){const e=new n.Point2D;ii(this.controlPoints,this.weights,t,e);const s=n.makeObjectArray(n.Point2D,4);return In(this.controlPoints,this.weights,3,t,s),2*(e.sub(this.point).dotProduct(s[3])+3*s[1].dotProduct(s[2]))}return 0}getError(e){return t.geometryReleaseAssert(0),0}}function Pn(e,t,s,i){const r={tmin:0,tmax:0,t:0,d:0,pt:n.Point2D.getNAN().clone()},o=n.makePrimitiveArray(18,Number.NaN),a=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(a),a[2].subThis(t),a[1].subThis(t),a[0].subThis(t);const m=[0,0,0];e.queryWeights(m);const h=[1,oi(m),1],l=mi(m,s),u=mi(m,i),c=Ce(new xn(a,h,new n.Point2D(0,0)),n.Envelope1D.construct(l,u),18,o);ii(a,h,l,r.pt),r.t=l,r.d=n.Point2D.distance(r.pt,new n.Point2D(0,0));const g=new n.Point2D;ii(a,h,u,g);const d=n.Point2D.distance(g,new n.Point2D(0,0));d<r.d&&(r.d=d,r.t=u,r.pt.assign(g));for(let e=0;e<c;e++){ii(a,h,o[e],g);const t=n.Point2D.distance(g,new n.Point2D(0,0));t<r.d&&(r.d=t,r.t=ai(m,o[e]),r.pt.assign(g))}return r}function En(e,t,s,i,r){let o=!0;const a=n.makeObjectArray(n.Point2D,4),m=lt(5,t,s,i,r,t=>(Sn(e,1,t,a),(o?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*a[1].length()));o=!1;const h=lt(5,t,s,i,r,t=>(Sn(e,1,t,a),(o?e.getCoordX(t)-e.getStartX():e.getCoordY(t)-e.getStartY())*a[1].length()));return new n.Point2D(m,h)}function vn(e){e.m_cachedValues=null}function Cn(e){if(e.m_cachedValues)return e.m_cachedValues;const t=new _n,s=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(s);const i=[0,0,0];return e.queryWeights(i),Dn(s,i,t.specialPoints),Fn(e,t),t}function Dn(e,t,s){if(0===t[1])return s.length=0,s.push(0),void s.push(1);const i=n.makeObjectArray(n.ECoordinate,8);i[0].set(0);let r=1;{const s=new n.ECoordinate(e[1].x).subThis(e[0].x).mulThis(t[1]).mulThis(t[0]),o=new n.ECoordinate(e[2].x).subThis(e[0].x).mulThis(t[2]).mulThis(t[0]),a=s.subE(o).addThisE(new n.ECoordinate(e[2].x).subThis(e[1].x).mulThis(t[2]).mulThis(t[1]));o.subThisE(s.mul(2));const m=n.makeObjectArray(n.ECoordinate,2);let h=Ne(a,o,s,new n.Envelope1D(0,1),!1,m);h<0&&(h=0);for(let e=0;e<h;e++)n.isOneOf(m[e].value(),0,1)||(i[r]=m[e],r++)}{const s=new n.ECoordinate(e[1].y).subThis(e[0].y).mulThis(t[1]).mulThis(t[0]),o=new n.ECoordinate(e[2].y).subThis(e[0].y).mulThis(t[2]).mulThis(t[0]),a=s.subE(o).addThisE(new n.ECoordinate(e[2].y).subThis(e[1].y).mulThis(t[2]).mulThis(t[1]));o.subThisE(s.mul(2));const m=n.makeObjectArray(n.ECoordinate,2);let h=Ne(a,o,s,new n.Envelope1D(0,1),!1,m);h<0&&(h=0);for(let e=0;e<h;e++)n.isOneOf(m[e].value(),0,1)||(i[r]=m[e],r++)}if(i[r].set(1),r++,r>2){n.sortRange(i,0,r,(e,t)=>n.standardNumericCompare(e.value(),t.value()));let e=0,t=i[0].value(),s=1;for(let n=1;n<r;n++)i[n].eq(i[n-1])?(t+=i[n].value(),s++):(s>1&&(t/=s,i[e].set(t)),e++,i[e]=i[n],t=i[n].value(),s=1);e++,r=e}i[0].set(0),i[r-1].set(1),s.length=r;for(let e=0;e<r;e++)s[e]=i[e].value()}function bn(e,t,s){if(s){if(t<0)return t;if(t>1)return t-1+bn(e,1,!1)}if(e.isDegenerate(0))return 0;const n=1===t,i=Cn(e);if(n&&!Number.isNaN(i.length))return i.length;const r=Rn(e),o=r/e.calculateUpperLength2D();let a=0,m=0;for(let s=1,n=i.specialPointsCount();s<n;s++){const n=i.specialPoints[s];if(a+=yn(e,m,Math.min(t,n),o,r),t<=n)break;m=n}return n&&(i.length=a),a}function Sn(e,t,s,i){const r=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(r);const o=[0,0,0];e.queryWeights(o),In(r,o,t,s,i)}function In(e,s,i,r,o){const a=[e[0],e[1],e[2]],m=[s[0],s[1],s[2]],h=n.makeObjectArray(n.Point2D,4);!function(e,s,n,i,r){t.geometryReleaseAssert(n>0);const o=[e[0].clone(),e[1].clone(),e[2].clone()];if(!o[0].isZero()){for(let e=1;e<3;++e)o[e].subThis(o[0]);o[0].setCoords(0,0)}const a=wn(o,s,0,i),m=An(s,0,i),h=a.divide(m);if(r[0].assign(h),0===n)return;const l=[s[1]*s[0],s[2]*s[0]*.5,s[1]*s[2]],u=[e[1].sub(e[0]),e[2].sub(e[0]),e[2].sub(e[1])],c=m*m,g=wn(u,l,0,i).mul(2).divide(c);if(r[1].assign(g),1===n)return;const d=An(s,1,i),p=2*m*d,_=wn(u,l,1,i).mul(2).sub(g.mul(p)).divide(c);if(r[2].assign(_),2===n)return;const f=wn(u,l,2,i).mul(2),y=2*(d*d+m*An(s,2,i)),x=f.sub(_.mul(p).mul(2)).sub(g.mul(y)).divide(c);r[3].assign(x),3!==n&&t.throwInternalErrorException("")}(a,m,i,r,h);for(let e=0;e<=i;e++)o[e].setCoords(h[e].x,h[e].y)}function wn(e,s,i,r){if(0===i){if(r<=.5){const t=new n.Point2D;n.lerpPointLo(2,e[0].mul(s[0]),e[1].mul(s[1]),r,t);const i=new n.Point2D;n.lerpPointLo(2,e[1].mul(s[1]),e[2].mul(s[2]),r,i);const o=new n.Point2D;return n.lerpPointLo(2,t,i,r,o),o}{const t=new n.Point2D;n.lerpPointHi(2,e[0].mul(s[0]),e[1].mul(s[1]),r,t);const i=new n.Point2D;n.lerpPointHi(2,e[1].mul(s[1]),e[2].mul(s[2]),r,i);const o=new n.Point2D;return n.lerpPointHi(2,t,i,r,o),o}}if(1===i){const t=e[1].mul(s[1]),n=t.sub(e[0].mul(s[0])).mul(1-r).add(e[2].mul(s[2]).sub(t).mul(r));return n.mulThis(2),n}if(2===i){const t=e[1].mul(s[1]),n=e[2].mul(s[2]).sub(t).sub(t.sub(e[0].mul(s[0])));return n.mulThis(2),n}t.throwInternalErrorException("")}function Tn(e,t,s,i){if(i.toDouble()<=.5){const s=new y;n.lerpLoPointE(2,e[0].mulE(t[0]),e[1].mulE(t[1]),i,s);const r=new y;n.lerpLoPointE(2,e[1].mulE(t[1]),e[2].mulE(t[2]),i,r);const o=new y;return n.lerpLoPointE(2,s,r,i,o),o}{const s=new y;n.lerpHiPointE(2,e[0].mulE(t[0]),e[1].mulE(t[1]),i,s);const r=new y;n.lerpHiPointE(2,e[1].mulE(t[1]),e[2].mulE(t[2]),i,r);const o=new y;return n.lerpHiPointE(2,s,r,i,o),o}}function An(e,s,i){if(0===s){const t=n.lerp(e[0],e[1],i),s=n.lerp(e[1],e[2],i);return n.lerp(t,s,i)}return 1===s?2*((1-i)*(e[1]-e[0])+(e[2]-e[1])*i):2===s?2*(e[2]-e[1]-(e[1]-e[0])):void t.throwInternalErrorException("")}function Nn(e,t,s){const i=n.snap(s,0,1),r=n.makeObjectArray(n.Point2D,4);if(In(e,t,3,i,r),r[1].isZero()){if(r[2].isZero())return r[3];{const e=r[2].clone();return 1===i&&e.negateThis(),e}}return r[1]}class Gn{constructor(e,t){this.len=0,this.b=e,this.len=t}getMaxDerivative(){return 1}getValue(e,t){return 0===e?this.len-bn(this.b,t,!1):0}getError(e){return t.geometryReleaseAssert(0),0}}function Mn(e){const s=n.makeObjectArray(n.Point2D,3),i=[0,0,0];return e.queryControlPoints(s),e.queryWeights(i),function(e,s){const i=oi(s);if(1===i)return St(e);if(0===i)return 0;const r=[new n.Point2D(0,0),e[1].sub(e[0]),e[2].sub(e[0])],o=r[1].crossProduct(r[2]);if(i<1){t.geometryReleaseAssert(i>0);const e=1-i;let s;if(e<.01)s=-1/3+e*(2/15+e*(3/35+e*(16/315+e*(20/693+e*(16/1001+e*(56/6435))))));else{const t=e*(1+i),r=Math.atan2(Math.sqrt(e),Math.sqrt(1+i));s=i*(.5*i-n.rsqrt(t)*r)/t}return o*s}{const e=(i-1)*(i+1);return.25*i/Math.pow(e,1.5)*(-2*i*Math.sqrt(e)*o-4*r[1].y*r[2].x*Math.atanh(Math.sqrt((i-1)/(i+1)))-r[1].x*r[2].y*Math.log(2*i*(i-Math.sqrt(e))-1))}}(s,i)}function Rn(e){var t;return t=e.calculateUpperLength2D(),256*n.doubleEps()*t}function kn(e){return e.m_cachedValues}function Fn(e,t){e.m_cachedValues=t}function qn(e,t,s,i,r){const o=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(o);const a=[0,0,0];e.queryWeights(a);const m=[0];return 1===Vn(o,a,t,n.Envelope1D.unit(),i,r,1,m)?m[0]:Number.NaN}function Vn(e,i,r,o,a,m,h,l){t.checkAndThrow(n.Envelope1D.unit().contains(o)&&h>0,""),(m<0||Number.isNaN(m))&&(m=Number.MAX_VALUE);const u=new Array(3);for(let t=0;t<3;++t)u[t]=e[t].sub(r);const c=oi(i),g=P.constructPoint2D(u[0]),d=P.constructPoint2D(u[1]),p=P.constructPoint2D(u[2]),_=n.MPValue.constructDouble(c),f=_.clone();f.ldexpThis(1);const y=g.dotProduct(d.sub(g)).mul(_),x=_.mul(_.addDouble(2)),E=p.sub(d.mul(x.ldexp(1))),v=d.sqrLength().mul(_.mul(_).ldexp(1)).add(g.sqrLength().mul(_.ldexp(2).subDouble(1))).add(g.dotProduct(E)),C=p.sub(d.mul(f)).add(g.mul(f.subDouble(1))),D=d.mul(_).sub(g).dotProduct(C).mulDouble(3),b=d.dotProduct(p).mul(_.subDouble(3).mul(_)).ldexp(1),S=d.sqrLength().mul(_.mul(_).ldexp(2)),I=g.sqrLength().mul(_.ldexp(2).subDouble(3)),w=g.dotProduct(p.sub(d.mul(_.mulDouble(3).subDouble(1)).mul(_))).ldexp(1),T=p.sqrLength().addThis(b).addThis(S).addThis(I).addThis(w),A=g.add(p).sub(d.mul(f)),N=_.subDouble(1),G=p.sub(g).dotProduct(A).mul(N),M=new n.Point2D(0,0),R=[];let k=new n.Point2D;ii(u,i,o.vmin,k);let F=n.Point2D.distance(k,M);if(F<=m&&R.push(new n.Point2D(o.vmin,F)),o.vmin!==o.vmax&&(ii(u,i,o.vmax,k),F=n.Point2D.distance(k,M),F<=m&&R.push(new n.Point2D(o.vmax,F))),o.width()>0){const e=u[2].isZero(),t=n.makeObjectArray(n.MPValue,4),s=$e(G,T,D,v,y,58,o,e,t);for(let e=0;e<s;e++){if(!o.containsExclusiveCoordinate(t[e].toDouble()))continue;let s=t[e].toDouble();s=ai(i,s);const r=new n.Point2D;ii(u,i,s,r),F=n.Point2D.distance(r,M),F<=m&&R.push(new n.Point2D(s,F))}}if(a){t.geometryReleaseAssert(o.equals(n.Envelope1D.unit()));{ii(u,i,-1,k,!0);const e=new n.Point2D;ii(u,i,0,e);const t=new Gr({start:k,end:e}),s=t.getClosestCoordinate(M,!0);s<1&&(k=t.getCoord2D(s),F=n.Point2D.distance(k,M),F<=m&&R.push(new n.Point2D(s-1,F)))}{ii(u,i,2,k,!0);const e=new n.Point2D;ii(u,i,o.vmax,e);const t=new Gr({start:e,end:k}),s=t.getClosestCoordinate(M,!0);s>0&&(k=t.getCoord2D(s),F=n.Point2D.distance(k,M),F<=m&&R.push(new n.Point2D(1+s,F)))}}if(!R.length)return 0;R.sort((e,t)=>e.compare(t));let q=0;const V=R[0].x;if(l[q++]=V,q<h){const e=s.calculateToleranceFromPointsForOps(u,4,!1).total(),t=R[0].y;for(let s=1,n=R.length;s<n;s++)if(R[s].y>t+e){R.length=s;break}R.sort((e,t)=>n.standardNumericCompare(e.x,t.x)),q=0,l[q++]=R[0].x;for(let e=1,t=R.length;e<t;e++)R[e].x!==l[q-1]&&q<h&&(l[q++]=R[e].x)}return q}function Hn(e,t,s){const i=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(i);const r=[0,0,0];e.queryWeights(r),On(i,r,t,s)}function On(e,t,s,i){if(s.equalsRange(0,1))return void i.setFromPoints(e,3);const r=n.makeObjectArray(n.Point2D,3);zn(e,t,s.vmin,s.vmax,r,[0,0,0]),i.setFromPoints(r,3)}function Yn(e){const t=n.compareNoNANs(e[0].y,e[1].y),s=n.compareNoNANs(e[1].y,e[2].y);if(t>=0&&s>=0||t<=0&&s<=0){const t=n.compareNoNANs(e[0].x,e[1].x),s=n.compareNoNANs(e[1].x,e[2].x);if(t>=0&&s>=0||t<=0&&s<=0)return!0}return!1}function Xn(e){const t=n.makeObjectArray(n.Point2D,3);e.queryControlPoints(t);const s=Ln(t);return s&&(e.m_cp.setCoordsPoint2D(t[1]),e.afterCompletedModification()),s}function Ln(e){let t=!1;for(let s=0;s<2;s++){const i=n.compareNoNANs(e[0][s],e[2][s]);i>0?(n.compareNoNANs(e[0][s],e[1][s])<0&&(e[1][s]=e[0][s],t=!0),n.compareNoNANs(e[1][s],e[2][s])<0&&(e[1][s]=e[2][s],t=!0)):i<0?(n.compareNoNANs(e[0][s],e[1][s])>0&&(e[1][s]=e[0][s],t=!0),n.compareNoNANs(e[1][s],e[2][s])>0&&(e[1][s]=e[2][s],t=!0)):e[1][s]!==e[0][s]&&(e[1][s]=e[0][s],t=!0)}return t}function Bn(e,i,r,o,a,m,h){t.geometryReleaseAssert(r>=0&&r<=1&&o!==m&&a!==h),t.geometryReleaseAssert(i[0]>0&&i[2]>0&&i[1]>=0);const l=[1,oi(i),1],u=mi(i,r),c=n.cloneObjectArray(e,3),g=n.makeObjectArray(s.Point3D,3);ti(c,l,g);const d=n.makeObjectArray(s.Point3D,3),p=n.makeObjectArray(s.Point3D,3);hi(g,u,o?d:null,m?p:null),li(i,r,a,h);const _=Yn(c);if(o){for(let e=0;e<3;++e)ni(d[e],o[e]);ci(c,o),_&&Ln(o)}if(m){for(let e=0;e<3;++e)ni(p[e],m[e]);ci(c,m),_&&Ln(m)}}function zn(e,i,r,o,a,m){if(t.geometryReleaseAssert(r>=0&&o<=1&&r<=o),r===o){const t=new n.Point2D,s=si(e,i,r,t);return ui(e,t),a[0].assign(t),a[1].assign(t),a[2].assign(t),m[0]=s,m[1]=s,void(m[2]=s)}if(0===r&&1===o)return a[0].assign(e[0]),a[1].assign(e[1]),a[2].assign(e[2]),m[0]=i[0],m[1]=i[1],void(m[2]=i[2]);const h=n.makeObjectArray(s.Point3D,3);{const t=[1,oi(i),1],s=mi(i,r),n=mi(i,o);ti(e,t,h),hi(h,n,h,null),hi(h,s>=n?1:s/n,null,h)}const l=[0,0,0];li(i,o,l,null),li(l,r/o,null,l);const u=Yn(e),c=n.makeObjectArray(n.Point2D,3);ni(h[1],c[1]),ii(e,i,r,c[0]),ii(e,i,o,c[2]),ci(e,c);for(let e=0;e<3;++e)a[e].assign(c[e]),m[e]=l[e];u&&Ln(a)}function Un(e,t,s){const i=oi(t),r=[1,i,1],o=4*i/(3*(1+i));s[0].assign(e[0]),s[3].assign(e[2]),n.lerpPoint2D(e[0],e[1],o,s[1]),n.lerpPoint2D(e[2],e[1],o,s[2]),new pn({cp:s}),new Ye({points:e,weight:i});let a=0,m=.1,h=0;for(let t=0;t<9;t++,m+=.1){const t=new n.Point2D;ii(e,r,m,t);const i=new n.Point2D;Ys(s,m,i);const o=n.Point2D.sqrDistance(t,i);o>a&&(a=o,h=m)}{const t=new n.Point2D;ii(e,r,h,t);const i=[0];sn(s,t,n.Envelope1D.unit(),!1,-1,1,i);const o=new n.Point2D;return Ys(s,i[0],o),a=n.Point2D.sqrDistance(t,o),Math.sqrt(a)}}function jn(e,t,s,n,i){if(i){if(0!==br(t,s))return e?4:2}else if(C(t,s))return 1;return 0!==Qn(e,t,s,null,null,null,n,void 0!==i&&i,0,!1)?4:0}function Wn(e,t,s,n,i){if(i){if(0!==br(t,s))return e?4:2}else if(C(t,s))return 1;return 0!==Kn(e,t,s,null,null,null,n,i??!1,0,!1)?4:0}function Zn(e,t,s,n,i){if(i){if(0!==br(t,s))return e?4:2}else if(C(t,s))return 1;return 0!==Jn(e,t,s,null,null,null,n,i??!1,0,!1)?4:0}function Qn(e,s,i,r,o,a,m,h,l,u){if(null!==o&&(o.length=0),null!==a&&(a.length=0),null!==r&&(r.length=0),i.isDegenerate(0)){const e=[0,0],t=s.intersectPoint(i.getStartXY(),e,m);if(t>0){if(null!==o)for(let s=0;s<t;s++)o.push(e[s]);if(null!=a)for(let e=0;e<t;e++)a.push(0);if(null!=r)for(let i=0;i<t;i++){const t=new n.Point2D;s.queryCoord2D(e[i],t),r.push(t)}}return t}const c=H(s,i);if(m=Math.max(m,c),s.isDegenerateToLineHelper(c)){const e=new Gr({start:s.getStartXY(),end:s.getEndXY()}),t=se(e,i,r,o,a,m,h,u);if(o)for(let n=0;n<t;++n){const t=e.getCoord2D(o[n]);o[n]=s.getClosestCoordinate(t,!1)}return t}if(O(s,i,m))return 0;const g=n.makeObjectArray(n.Point2D,3);s.queryControlPoints(g);const d=[0,0,0];s.queryWeights(d);const p=[1,oi(d),1],_=i.getEndXY().sub(i.getStartXY()),f=_.clone();f.leftPerpendicularThis();const y=g[0].clone(),x=g[1].clone(),P=g[2].clone(),E=x.sub(y),v=P.sub(y),C=P.sub(x),D=p[0],b=p[1],S=p[2],I=D*b,w=D*S,T=b*S,A=E.dotProduct(f)*I,N=v.dotProduct(f)*w;let G=A,M=N-2*A,R=C.dotProduct(f)*T+N-N;const k=n.makePrimitiveArray(13,Number.NaN),F=n.makePrimitiveArray(13,Number.NaN);let q=De(R,M,G,n.Envelope1D.unit(),!1,k);q<0&&(k[0]=0,k[1]=1,q=2);let V=0;for(let e=0,t=V;e<q;++e){const s=new n.Point2D;ii(g,p,k[e+t],s),F[V]=i.getClosestCoordinate(s,!1),n.Point2D.distance(s,i.getCoord2D(F[V]))<=m&&(k[V]=k[e+t],V++)}const Y=n.makeObjectArray(n.Point2D,3),X=n.makeObjectArray(n.Point2D,3);if(s.queryControlPoints(X),X[0].subThis(i.getStartXY()),X[1].subThis(i.getStartXY()),X[2].subThis(i.getStartXY()),function(e,t,s,i=!1){const r=n.makeObjectArray(n.Point2D,3);i?(r[0].setCoordsPoint2D(e[0]),r[1].setCoordsPoint2D(e[1]),r[1].subThis(r[0]),r[2].setCoordsPoint2D(e[2]),r[2].subThis(r[0]),r[0].setCoords(0,0)):(r[0].setCoordsPoint2D(e[0]),r[1].setCoordsPoint2D(e[1]),r[2].setCoordsPoint2D(e[2])),r[0].mulThis(t[0]),r[1].mulThis(t[1]),r[2].mulThis(t[2]),s[1].setCoords(r[1].x-r[0].x,r[1].y-r[0].y),s[2].setCoordsPoint2D(r[2].sub(r[1])),s[2].subThis(s[1]),s[1].x*=2,s[1].y*=2,s[0].setCoordsPoint2D(r[0])}(X,p,Y,!1),Math.abs(_.x)>=Math.abs(_.y)){const e=_.y/_.x;R=Y[2].y-Y[2].x*e,M=Y[1].y-Y[1].x*e,G=Y[0].y-Y[0].x*e}else{const e=_.x/_.y;R=Y[2].x-Y[2].y*e,M=Y[1].x-Y[1].y*e,G=Y[0].x-Y[0].y*e}const L=s.getEndXY().equals(i.getStartXY())||s.getEndXY().equals(i.getEndXY()),B=[0,0];q=De(R,M,G,n.Envelope1D.unit(),L,B);for(let e=0,t=V;e<q;++e){k[e+t]=B[e];const s=new n.Point2D;ii(g,p,k[e+t],s),F[V]=i.getClosestCoordinate(s,!1),n.Point2D.distance(s,i.getCoord2D(F[V]))<=m&&(k[V]=k[e+t],V++)}t.geometryReleaseAssert(V<k.length+4);for(let e=0;e<V;e++)k[e]=ai(d,k[e]);q=s.intersectPoint(i.getStartXY(),B,m);for(let e=0;e<q;e++)k[V]=B[e],F[V++]=0;q=s.intersectPoint(i.getEndXY(),B,m);for(let e=0;e<q;e++)k[V]=B[e],F[V++]=1;q=i.intersectPoint(s.getStartXY(),B,m);for(let e=0;e<q;e++)F[V]=B[e],k[V++]=0;q=i.intersectPoint(s.getEndXY(),B,m);for(let e=0;e<q;e++)F[V]=B[e],k[V++]=1;return 0===V?0:Tr(e,s,i,k,F,V,r,o,a,m,h,0,u)}function Kn(e,t,s,i,o,a,m,h,l,u){if(Ki(s))return Qn(e,t,new Gr({start:s.getStartXY(),end:s.getEndXY()}),i,o,a,m,h,0,u);const c=H(t,s);if(O(t,s,m=Math.max(m,c)))return 0;const g=[],d=[],p=n.makeObjectArray(n.Point2D,4);{t.queryControlPoints(p);const e=n.makeObjectArray(n.Point2D,4),i=new r.Transformation2D;s.canonicToWorldTransformation(i);const o=new r.Transformation2D;o.setInvert(i),o.transformPoints2D(p,4,e);const a=n.makeObjectArray(n.MPValue,3),l=n.makeObjectArray(n.MPValue,3),u=n.makeObjectArray(n.MPValue,3),c=[0,0,0];t.queryWeights(c),ei(e,c,a,l,u);const _=n.makeObjectArray(n.MPValue,3);_[0].setDouble(s.getSemiMinorAxis()),_[0].sqrThis(),_[1].setDouble(s.getSemiMajorAxis()),_[1].sqrThis(),_[2].setThis(_[0]),_[2].mulThis(_[1]),_[2].negateThis();const f=We(a,2,l,2,u,2,_,0,n.Envelope1D.unit(),n.Envelope1D.unit(),g,h);if(f>0){let e=0;for(let i=0;i<f;i++){const r=new n.Point2D;t.queryCoord2D(g[i],r);const o=s.getClosestCoordinate(r,!1),a=new n.Point2D;s.queryCoord2D(o,a),n.Point2D.distance(r,a)<=m&&(g[e]=g[i],d.push(o),e++)}g.length=e}}const _=[0,1];for(let e=0;e<2;e++){const i=0===e?s.getStartXY():s.getEndXY(),r=qn(t,i,n.Envelope1D.unit(),!1,-1),o=new n.Point2D;t.queryCoord2D(r,o),n.Point2D.distance(i,o)<=m&&(g.push(r),d.push(_[e]))}for(let e=0;e<2;e++){const t=[0,3];{const i=s.getClosestCoordinate(p[t[e]],!1),r=new n.Point2D;s.queryCoord2D(i,r),n.Point2D.distance(p[t[e]],r)<=m&&(g.push(_[e]),d.push(i))}}return Tr(e,t,s,g,d,g.length,i,o,a,m,h,0,u)}function $n(e,s,i,r,o,a,m,h,l,u){const c=n.makeObjectArray(n.Point2D,3);s.queryControlPoints(c);const g=n.makeObjectArray(n.Point2D,3);if(i.queryControlPoints(g),Y(c,g,3)<0)return $n(e,i,s,r,a,o,m,h,l,!u);const p=H(s,i);if(s.isDegenerateToLineHelper(p)){const t=new Gr({start:s.getStartXY(),end:s.getEndXY()}),n=Qn(e,i,t,r,a,o,m,h,0,!u);if(o)for(let e=0;e<n;++e){const n=t.getCoord2D(o[e]);o[e]=s.getClosestCoordinate(n,!1)}return n}if(i.isDegenerateToLineHelper(p)){const t=new Gr({start:i.getStartXY(),end:i.getEndXY()}),n=Qn(e,s,t,r,o,a,m,h,0,u);if(a)for(let e=0;e<n;++e){const s=t.getCoord2D(a[e]);a[e]=i.getClosestCoordinate(s,!1)}return n}if(O(s,i,m=Math.max(m,p)))return 0;const _=n.makePrimitiveArray(3,Number.NaN);s.queryWeights(_);const f=n.makePrimitiveArray(3,Number.NaN);i.queryWeights(f);const y=[1,oi(_),1],x=[1,oi(f),1],P=new n.Envelope1D(0,1),E=new n.Envelope1D(0,1);{const e=d.constructEmpty();On(c,y,new n.Envelope1D(0,1),e);const t=d.constructEmpty();On(g,x,new n.Envelope1D(0,1),t);const s=Math.max(e.maxDim(),t.maxDim());if(e.inflate(3*m),t.inflate(3*m),!e.intersectW(t))return 0;if(e.maxDim()<.1*s){if(ri(c,y,e,P),ri(g,x,e,E),P.isEmpty()||E.isEmpty())return 0;zn(c,y,P.vmin,P.vmax,c,y),zn(g,x,E.vmin,E.vmax,g,x)}}const v=Ar(c,2,g,2,m);if(0===v)return 0;const C=[],D=[];if(-1===v){const e=n.makeObjectArray(n.MPValue,3),t=n.makeObjectArray(n.MPValue,3),s=n.makeObjectArray(n.MPValue,3);ei(c,y,e,t,s);const i=n.makeObjectArray(n.MPValue,3),r=n.makeObjectArray(n.MPValue,3),o=n.makeObjectArray(n.MPValue,3);ei(g,x,i,r,o);const a=[],l=[],d=je(e,2,t,2,s,2,i,2,r,2,o,2,0,n.Envelope1D.unit(),n.Envelope1D.unit(),a,l,h,0,u);if(d>0)for(let e=0;e<d;e++){const t=new n.Point2D;ii(g,x,l[e],t);const s=new n.Point2D;ii(c,y,a[e],s),n.Point2D.distance(s,t)<=m&&(C.push(a[e]),D.push(l[e]))}}for(let e=0;e<2;e++){let s,i,r;0===e?(s=c,i=g,r=x):(s=g,i=c,r=y);for(let o=0;o<2;o++){const a=0===o?0:s.length-1,h=new n.Point2D,l=[0],u=Vn(i,r,s[a],n.Envelope1D.unit(),!1,-1,1,l);t.geometryReleaseAssert(1===u),ii(i,r,l[0],h),n.Point2D.distance(s[a],h)<=m&&(0===e?(C.push(0===a?0:1),D.push(l[0])):(D.push(0===a?0:1),C.push(l[0])))}}if(0===C.length)return 0;if(!P.equalsRange(0,1))for(let e=0;e<C.length;++e)C[e]=Ye.recalculateParentT(P.vmin,P.vmax,C[e]);if(!E.equalsRange(0,1))for(let e=0;e<D.length;++e)D[e]=Ye.recalculateParentT(E.vmin,E.vmax,D[e]);for(let e=0;e<C.length;++e)C[e]=ai(_,C[e]);for(let e=0;e<D.length;++e)D[e]=ai(f,D[e]);return Tr(e,s,i,C,D,C.length,r,o,a,m,h,0,u)}function Jn(e,t,s,i,r,o,a,m,h,l){if(t.isLine())return Ht(e,s,new Gr({start:t.getStartXY(),end:t.getEndXY()}),i,o,r,a,m,0,!l);if(s.isLine())return Qn(e,t,new Gr({start:s.getStartXY(),end:s.getEndXY()}),i,r,o,a,m,0,l);const u=H(t,s);if(O(t,s,a=Math.max(a,u)))return 0;const c=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(c);const g=n.makeObjectArray(n.Point2D,3);s.queryControlPoints(g);const d=Ar(c,2,g,2,a);if(0===d)return 0;const p=[],_=[];if(-1===d){const e=n.makeObjectArray(n.MPValue,3),i=n.makeObjectArray(n.MPValue,3),r=n.makeObjectArray(n.MPValue,3),o=[0,0,0];t.queryWeights(o),ei(c,o,e,i,r);const h=n.makeObjectArray(P,3);Lt(g,h);const u=je(e,2,i,2,r,2,[h[0].x,h[1].x,h[2].x],2,[h[0].y,h[1].y,h[2].y],2,null,0,0,n.Envelope1D.unit(),n.Envelope1D.unit(),p,_,m,0,l);if(u>0){let e=0;for(let i=0;i<u;i++){const r=new n.Point2D;s.queryCoord2D(_[i],r);const o=new n.Point2D;t.queryCoord2D(p[i],o),n.Point2D.distance(o,r)<=a&&(p[e]=p[i],_[e]=_[i],e++)}p.length=e,_.length=e}}for(let e=0;e<2;e++){let i;i=0===e?c:g;for(let r=0;r<2;r++){const o=0===r?0:i.length-1;let m;const h=new n.Point2D;0===e?(m=Tt(s,i[o],n.Envelope1D.unit(),!1),s.queryCoord2D(m,h)):(m=qn(t,i[o],n.Envelope1D.unit(),!1,-1),t.queryCoord2D(m,h)),n.Point2D.distance(i[o],h)<=a&&(0===e?(p.push(0===o?0:1),_.push(m)):(_.push(0===o?0:1),p.push(m)))}}return Tr(e,t,s,p,_,p.length,i,r,o,a,m,0,l)}function ei(e,t,s,i,r){const o=n.MPValue.constructDouble(t[0]),a=n.MPValue.constructDouble(t[1]),m=n.MPValue.constructDouble(t[2]);s[0].setDouble(e[0].x),s[0].mulThis(o),s[1].setDouble(e[1].x),s[1].mulThis(a),s[2].setDouble(e[2].x),s[2].mulThis(m),s[2].subThis(s[1]),s[1].subThis(s[0]),s[2].subThis(s[1]),s[1].ldexpThis(1),i[0].setDouble(e[0].y),i[0].mulThis(o),i[1].setDouble(e[1].y),i[1].mulThis(a),i[2].setDouble(e[2].y),i[2].mulThis(m),i[2].subThis(i[1]),i[1].subThis(i[0]),i[2].subThis(i[1]),i[1].ldexpThis(1),r[0].setDouble(t[0]),r[1].setDouble(t[1]),r[2].setThis(r[1]),r[2].ldexpThis(1),r[2].negateThis(),r[2].addThis(r[0]),r[2].addDoubleThis(t[2]),r[1].subThis(r[0]),r[1].ldexpThis(1)}function ti(e,t,s){for(let n=0;n<3;++n)s[n].setCoordsPoint2DZ(e[n].mul(t[n]),t[n])}function si(e,t,s,i){if(0===s)return i.assign(e[0]),t[0];if(1===s)return i.assign(e[2]),t[2];const r=[e[0].x*t[0],e[1].x*t[1],e[2].x*t[2]],o=[e[0].y*t[0],e[1].y*t[1],e[2].y*t[2]],a=[t[0],t[1],t[2]],m=s;let h,l,u;if(s<=.5){const e=n.lerpLo(r[0],r[1],m),t=n.lerpLo(r[1],r[2],m);h=n.lerp(e,t,m);const s=n.lerpLo(o[0],o[1],m),i=n.lerpLo(o[1],o[2],m);l=n.lerp(s,i,m);const c=n.lerpLo(a[0],a[1],m),g=n.lerpLo(a[1],a[2],m);u=n.lerpLo(c,g,m)}else{const e=n.lerpHi(r[0],r[1],m),t=n.lerpHi(r[1],r[2],m);h=n.lerpHi(e,t,m);const s=n.lerpHi(o[0],o[1],m),i=n.lerpHi(o[1],o[2],m);l=n.lerpHi(s,i,m);const c=n.lerpHi(a[0],a[1],m),g=n.lerpHi(a[1],a[2],m);u=n.lerpHi(c,g,m)}return h/=u,l/=u,i.setCoords(h,l),ui(e,i),u}function ni(e,t){return t.setCoords(e.x/e.z,e.y/e.z),e.z}function ii(e,t,s,n,i){if(i){if(s<0)return void W(new Gr({start:e[0],end:e[0].add(Nn(e,t,0).getUnitVector())}),s,n);if(s>1)return void W(new Gr({start:e[2],end:e[2].add(Nn(e,t,1).getUnitVector())}),s-1,n)}si(e,t,s,n)}function ri(e,t,s,i){i.setEmpty();const r=[];r.push(new n.Envelope1D(0,1));const o=.5*Math.max(s.width(),s.height());for(;r.length;){const a=r.at(-1);r.pop();const m=new d;if(On(e,t,a,m),m.isIntersectingW(s)){const e=Math.max(m.width(),m.height());if(s.containsW(m)||e<=o||a.width()<1e-12)i.merge(a);else{const e=a.getCenter();r.push(n.Envelope1D.construct(a.vmin,e)),r.push(n.Envelope1D.construct(e,a.vmax))}}}}function oi(e){return e[1]/Math.sqrt(e[0]*e[2])}function ai(e,t){const s=Math.sqrt(e[2]/e[0]);return t/n.lerp(s,1,t)}function mi(e,t){const s=Math.sqrt(e[0]/e[2]);return t/n.lerp(s,1,t)}function hi(e,i,r,o){t.geometryReleaseAssert(i>=0&&i<=1),(new s.Point3D).setCoordsPoint3D(e[0]),(new s.Point3D).setCoordsPoint3D(e[1]),(new s.Point3D).setCoordsPoint3D(e[2]);const a=new s.Point3D,m=new s.Point3D,h=new s.Point3D;n.lerpPoint(3,e[0],e[1],i,a),n.lerpPoint(3,e[1],e[2],i,m),n.lerpPoint(3,a,m,i,h);const l=e[2].clone();r&&(r[0].assign(e[0]),r[1].assign(a),r[2].assign(h)),o&&(o[0].assign(h),o[1].assign(m),o[2].assign(l))}function li(e,s,i,r){const o=[e[0],e[1],e[2]];t.geometryReleaseAssert(s>=0&&s<=1&&i!==r);const a=n.lerp(o[0],o[1],s),m=n.lerp(o[1],o[2],s),h=n.lerp(a,m,s);i&&(i[0]=o[0],i[1]=a,i[2]=h),r&&(r[0]=h,r[1]=m,r[2]=o[2])}function ui(e,t){const s=n.Envelope1D.constructEmpty();s.vmin=s.vmax=e[0].x,s.mergeNeCoordinate(e[1].x),s.mergeNeCoordinate(e[2].x),t.x=n.snap(t.x,s.vmin,s.vmax),s.vmin=s.vmax=e[0].y,s.mergeNeCoordinate(e[1].y),s.mergeNeCoordinate(e[2].y),t.y=n.snap(t.y,s.vmin,s.vmax)}function ci(e,t){const s=new n.Envelope1D;s.vmin=s.vmax=e[0].x,s.mergeNeCoordinate(e[1].x),s.mergeNeCoordinate(e[2].x),t[0].x=n.snap(t[0].x,s.vmin,s.vmax),t[1].x=n.snap(t[1].x,s.vmin,s.vmax),t[2].x=n.snap(t[2].x,s.vmin,s.vmax),s.vmin=s.vmax=e[0].y,s.mergeNeCoordinate(e[1].y),s.mergeNeCoordinate(e[2].y),t[0].y=n.snap(t[0].y,s.vmin,s.vmax),t[1].y=n.snap(t[1].y,s.vmin,s.vmax),t[2].y=n.snap(t[2].y,s.vmin,s.vmax)}const gi=n.geometryPi/180,di=180/n.geometryPi;function pi(e){let t=e;return t=function(e){let t=e;return t>=-360&&t<720?(t<0?t+=360:t>=360&&(t-=360),t):(t=n.fmod(t,360),t<0&&(t+=360),t)}(t),t>180&&(t-=360),t}function _i(e){return e*gi}function fi(e){return e*di}function yi(e){const t=n.twoPi();let s=e;return s>=-t&&s<2*t?(s<0&&(s+=t),s>=t&&(s-=t),s):(s=n.fmod(s,t),s<0&&(s+=t),s)}function xi(e){const t=n.pi();let s=e;return s>-t&&s<=t||(s=yi(s),s>t&&(s-=n.twoPi())),s}var Pi=s.VertexDescription;class Ei extends U{constructor(e){if(void 0===e||n.isOnlyProperty(e,"vd"))return super({vd:e?.vd,XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_semiMajorAxis=0,this.m_minorMajorRatio=1,this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,this.m_center=new n.Point2D(0,0),this.m_sweepAngle=0,this.m_startAngle=0,this.m_interior=new n.Point2D(0,0),void(this.m_bits=0);if(e.copy)return super(e),void(this!==e.copy&&(this.m_center=new n.Point2D(0,0),this.m_interior=new n.Point2D(0,0),e.copy.copyToImpl(this)));if(e.move)super(e),this.m_semiMajorAxis=e.move.m_semiMajorAxis,this.m_minorMajorRatio=e.move.m_minorMajorRatio,this.m_rotation=e.move.m_rotation,this.m_cosr=e.move.m_cosr,this.m_sinr=e.move.m_sinr,this.m_center=e.move.m_center.clone(),this.m_sweepAngle=e.move.m_sweepAngle,this.m_startAngle=e.move.m_startAngle,this.m_interior=e.move.m_interior.clone(),this.m_bits=e.move.m_bits,this.m_cachedValues=e.move.m_cachedValues,e.move.m_cachedValues=null;else{if(e.fromPoint)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new n.Point2D(0,0),this.m_interior=new n.Point2D(0,0),void this.constructCircularArcThreePoint(e.fromPoint,e.toPoint,e.interiorPoint);if(e.center)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),this.m_center=new n.Point2D(0,0),this.m_interior=new n.Point2D(0,0),void this.constructCircleRadius(e.radius,e.center,e.bIsCounterClockwise);if(e.semiMajorAxis)return super({XStart:0,YStart:0,XEnd:0,YEnd:0}),void this.constructEllipticArcEndPoints(e.fromPoint,e.toPoint,e.semiMajorAxis,e.minorMajorRatio,e.axisXRotationRad,e.bBigArc,e.bIsCounterClockwise)}}getBoundary(){return Ee(this)}assignCopy(e){return this!==e&&e.copyTo(this),this}constructCircleRadius(e,t,s=!1){return this.constructEllipse(e,1,t,0,s),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircleCenterAndPoint(e,t,s=!1){const i=n.Point2D.distance(e,t);return this.constructEllipticArcEndPointsCenter(t,t,i,1,0,!0,s,e),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructTwoPointCircle(e,t,s=!1){const i=n.Point2D.lerp(e,t,.5);return this.constructCircleCenterAndPoint(i,e,s),this}constructLineEllipticArc(e,t){return Qi(this,e,t,1),this}constructLineCircularArc(e,t){return Qi(this,e,t,0),this}constructEllipse(e,t,s,i,r=!1){this.m_semiMajorAxis=Math.abs(e),this.m_minorMajorRatio=Math.abs(t),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);const o=new n.Point2D(0,this.m_minorMajorRatio*this.m_semiMajorAxis),a=Math.cos(i),m=Math.sin(i);return o.rotateDirect(a,m),o.addThis(s),this.constructEllipticArcEndPointsCenter(o,o,this.m_semiMajorAxis,this.m_minorMajorRatio,i,!0,r,s),this}inflate(e){if(this.isDegenerateToLine())return;let t=this.getSemiMinorAxis()+e;if(t=t<=0?0:(this.getSemiMajorAxis()+e)/this.getSemiMajorAxis(),this.isCircular()){const e=new r.Transformation2D;e.setShiftCoords(-this.m_center.x,-this.m_center.y),e.scale(t,t),e.shiftCoords(this.m_center.x,this.m_center.y),this.applyTransformation(e)}else{const e=new r.Transformation2D;this.canonicToWorldTransformation(e);const s=e.clone();s.invertPreciseThis(),s.scale(t,t),s.multiply(e),this.applyTransformation(s)}}constructEnclosingCircle(e,s,i=!1){return function(e,s,i,r){0===i&&t.throwInvalidArgumentException("construct_enclosing_circle");const o=[0,0,0],a=vi(s,i,o);if(1===a)e.constructCircleRadius(0,s[o[0]],r);else if(2===a){const t=n.Point2D.lerp(s[o[0]],s[o[1]],.5),i=n.Point2D.distance(s[o[0]],t),a=n.Point2D.distance(s[o[1]],t);e.constructCircleRadius(Math.max(i,a),t,r)}else if(3===a){const t=n.Point2D.calculateCircleCenterFromThreePoints(s[o[0]],s[o[1]],s[o[2]]),i=n.Point2D.distance(s[o[0]],t),a=n.Point2D.distance(s[o[1]],t),m=n.Point2D.distance(s[o[2]],t);e.constructCircleRadius(Math.max(i,a,m),t,r)}else t.throwInternalErrorException("unexpected")}(this,e,s,i),this}constructThreePointCircle(e,t,s,i=!1){if(e.equals(t)||t.equals(s)||e.equals(s)){const n=e.clone(),r=t.clone(),o=s.clone();return n.equals(r)&&r.assign(o),this.constructTwoPointCircle(n,r,i)}{const r=n.Point2D.calculateCircleCenterFromThreePoints(e,t,s);if(!r.isFinite()||!Number.isFinite(n.Point2D.distance(e,r))){const i=n.Point2D.distance(e,t),r=n.Point2D.distance(e,s);this.constructLineCircularArc(e,i>=r?t:s)}return this.constructCircleCenterAndPoint(r,e,i)}}constructCircularArcThreePoint(e,t,s){const i=new n.ECoordinate(e.x),r=new n.ECoordinate(t.x),o=new n.ECoordinate(s.x),a=new n.ECoordinate(e.y),m=new n.ECoordinate(t.y),h=new n.ECoordinate(s.y),l=new n.ECoordinate(.5),u=r.subE(i),c=m.subE(a),g=o.subE(i),d=h.subE(a),p=u.mulE(d).subThisE(c.mulE(g));if(p.scaleError(10),p.isZero()){if(!u.isZero()||!c.isZero())return Qi(this,e,t,0),this;{const n=e.clone().addThis(t).mulThis(.5).addThis(s).mulThis(.5),i=s.sub(n).length();this.constructEllipticArcEndPointsCenter(e,t,i,1,0,!0,!1,n),this.m_interior.assign(s)}return this.setProjectionBehavior(0),this}const _=u.sqr().addThisE(c.sqr()).mulThisE(l),f=g.sqr().addThisE(d.sqr()).mulThisE(l),y=_.mulE(d).subThisE(f.mulE(c)),x=u.mulE(f).subThisE(g.mulE(_));y.divThisE(p),x.divThisE(p);const P=y.sqr().addThisE(x.sqr());P.sqrtThis();const E=y.addE(i),v=x.addE(a);let C=e.x-E.value(),D=e.y-v.value();const b=Math.atan2(D,C);C=t.x-E.value(),D=t.y-v.value();const S=Math.atan2(D,C);C=s.x-E.value(),D=s.y-v.value();const I=Math.atan2(D,C);let w=I-2*n.pi();for(;w<b;)w+=2*n.pi();let T=S-2*n.pi();for(;T<w;)T+=2*n.pi();let A=I+2*n.pi();for(;A>b;)A-=2*n.pi();let N,G=S+2*n.pi();for(;G>A;)G-=2*n.pi();N=T-b<b-G?T-b:G-b;const M=new n.Point2D(E.value(),v.value());return this.constructEllipticArcEndPointsCenter(e,t,P.value(),1,0,Math.abs(N)>n.pi(),N>0,M),this.m_interior.assign(s),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructCircularArc(e,t,s,n){return this.constructEllipticArcGeneral(e,1,t,s,n,0),this.setProjectionBehavior(0),this.afterCompletedModification(),this}constructEllipticArcEndPoints(e,t,s,n,i,r,o){return Zi(this,e,t,s,n,i,r,o)}constructEllipticArcEndPointsCenter(e,t,s,n,i,r,o,a){return Zi(this,e,t,s,n,i,r,o,a)}constructEllipticArcGeneral(e,t,s,i,r,o){this.m_semiMajorAxis=Math.abs(e),this.m_minorMajorRatio=Math.abs(t),this.m_minorMajorRatio>1&&(this.m_semiMajorAxis*=this.m_minorMajorRatio,this.m_minorMajorRatio=1/this.m_minorMajorRatio);const a=xi(o),m=Math.cos(a),h=Math.sin(a),l=new n.Point2D(this.m_semiMajorAxis,this.m_minorMajorRatio*this.m_semiMajorAxis),u=n.Point2D.getNAN(),c=xi(i);u.x=l.x*Math.cos(c),u.y=l.y*Math.sin(c),u.rotateDirect(m,h),u.addThis(s);const g=n.snapMagnitude(r,n.twoPi());let d=g;Math.abs(d)===n.twoPi()&&(d=0);const p=n.Point2D.getNAN();return p.x=l.x*Math.cos(c+d),p.y=l.y*Math.sin(c+d),p.rotateDirect(m,h),p.addThis(s),this.constructEllipticArcEndPointsCenter(u,p,this.m_semiMajorAxis,this.m_minorMajorRatio,a,Math.abs(g)>n.pi(),g>0,s)}constructEllipticArcAsNURB(e,s,n,i){return(i>=1||i<0)&&t.throwInvalidArgumentException("construct_elliptic_arc_as_NURB: weight"),s.isFinite()||t.throwInvalidArgumentException("construct_elliptic_arc_as_NURB: control_point"),cr([e,s,n],i*i,null,!1,this),this}constructCanonic(e){return this.assignCopy(e),e.isDegenerateToLine()||e.m_center.isEqual(0,0)&&0===this.m_rotation||(this.m_XStart=e.getSemiMajorAxis()*Math.cos(e.m_startAngle),this.m_YStart=e.getSemiMinorAxis()*Math.sin(e.m_startAngle),this.m_XEnd=e.getSemiMajorAxis()*Math.cos(e.getEndAngle()),this.m_YEnd=e.getSemiMinorAxis()*Math.sin(e.getEndAngle()),this.m_center.setCoords(0,0),this.m_rotation=0,this.m_cosr=1,this.m_sinr=0,pr(this),this.afterCompletedModification(),e!==this&&q(this,e)),this}isCircular(){return 1===this.m_minorMajorRatio&&0===this.m_rotation&&!this.isDegenerateToLine()}isDegenerateToLineHelper(e){if(this.isLine())return!0;if(this.isMajor())return!1;const t=this.getEndXY().sub(this.getStartXY()).length();return!(this.calculateLength2D()-t>e)}isDegenerateToLine(){return Ki(this)}getCenter(){return this.m_center.clone()}setCenter(e){if(!this.m_center.isNAN()){const t=e.sub(this.m_center);this.m_XStart+=t.x,this.m_YStart+=t.y,this.m_XEnd+=t.x,this.m_YEnd+=t.y,this.m_interior.addThis(t),this.m_center.assign(e),this.endPointModified(),this.normalizeAfterEndpointChange()}}getAxisXRotation(){return this.m_rotation}getSemiAxes(){return n.Point2D.construct(this.m_semiMajorAxis,this.m_semiMajorAxis*this.m_minorMajorRatio)}getSemiMajorAxis(){return this.m_semiMajorAxis}getSemiMinorAxis(){return this.m_semiMajorAxis*this.m_minorMajorRatio}getMinorMajorRatio(){return this.m_minorMajorRatio}isClockwise(){return!rr(this)}isMajor(){return ar(this)}getSweepAngle(){return this.m_sweepAngle}getStartAngle(){return this.m_startAngle}getEndAngle(){return this.m_startAngle+this.m_sweepAngle}getGeometryType(){return t.GeometryType.enumEllipticArc}queryEnvelope(e){if(4===e.m_EnvelopeType){e.setEmpty(),e.assignVertexDescription(this.m_description);const t=i.Envelope2D.constructEmpty();this.queryEnvelope(t),e.setEnvelope(t);for(let t=1,s=this.m_description.getAttributeCount();t<s;t++){const s=this.m_description.getSemantics(t);for(let n=0,i=Pi.getComponentCount(s);t<i;t++){const t=this.queryInterval(s,n);e.setIntervalEnvelope(s,n,t)}}}else 2===e.m_EnvelopeType?xr(this,n.Envelope1D.unit(),e):t.throwNotImplementedException("3d not impl")}applyTransformation(e){er(this,e,!1,null,null)}createInstance(){return new Ei}calculateLength2D(){return function(e){if(Ki(e))return 1*n.Point2D.distance(e.getStartXY(),e.getEndXY());if(1===e.m_minorMajorRatio)return Math.abs(-1*e.getSweepAngle())*e.m_semiMajorAxis;const t=$i(e,0);return $i(e,1)-t}(this)}queryControlPointsHelper(e){t.throwInternalErrorException("")}queryCoord2D(e,t){if(Ki(this))Z(e,this.getStartXY(),this.getEndXY(),t);else if(0===e)t.assign(n.Point2D.construct(this.m_XStart,this.m_YStart));else if(1===e)t.assign(n.Point2D.construct(this.m_XEnd,this.m_YEnd));else{const s=Bi(this,e),i=new n.Point2D(this.m_semiMajorAxis*Math.cos(s),this.getSemiMinorAxis()*Math.sin(s));i.rotateDirect(this.m_cosr,this.m_sinr),i.addThis(this.m_center),t.assign(i)}}queryCoord2DE(e,t){!function(e,t,s){if(Ki(e))$(new Gr({start:e.getStartXY(),end:e.getEndXY()}),t,s);else if(0===t.value())s.set(e.getStartXY());else if(1===t.value())s.set(e.getEndXY());else{const i=new n.ECoordinate;zi(e,t,i);const r=new n.ECoordinate,o=new n.ECoordinate;n.ECoordinate.st_cosAndSin(i,r,o);const a=y.constructCoordsE(new n.ECoordinate(e.m_semiMajorAxis).mulThisE(r),new n.ECoordinate(e.m_semiMajorAxis).mulThis(e.m_minorMajorRatio).mulThisE(o)),m=new n.ECoordinate(e.m_rotation);n.ECoordinate.st_cosAndSin(m,r,o),a.rotateDirect(r,o),a.addThisE(y.constructPoint2D(e.m_center)),s.setE(a)}}(this,e,t)}queryCoord2DMP(e,s){t.throwNotImplementedException("")}getCoordX(e){const t=new n.Point2D;return this.queryCoord2D(e,t),t.x}getCoordY(e){const t=new n.Point2D;return this.queryCoord2D(e,t),t.y}cut(e,t,s){const n=new Mr;return this.queryCut(e,t,n,s),n.releaseSegment()}queryCut(e,t,s,i){const r=s.createEllipticArc();i&&r.dropAllAttributes();let o=0===e&&1===t;if(o&&!i)return void this.copyTo(r);const a=n.Point2D.getNAN();this.queryCoord2D(e,a);const m=n.Point2D.getNAN();if(this.queryCoord2D(t,m),!o)if(a.equals(m))t-e>.5&&this.isMajor()&&this.isClosed()?(o=!0,e=0,t=1):1===t?e=t:t=e;else if(e>0&&a.isEqual(this.m_XStart,this.m_YStart)&&(e=0),t<1&&m.isEqual(this.m_XEnd,this.m_YEnd)&&(t=1),o=0===e&&1===t,o&&!i)return void this.copyTo(r);if(r.m_center.assign(this.m_center),r.m_semiMajorAxis=this.m_semiMajorAxis,r.m_minorMajorRatio=this.m_minorMajorRatio,r.m_interior.assign(this.m_interior),r.m_rotation=this.m_rotation,r.m_cosr=this.m_cosr,r.m_sinr=this.m_sinr,r.m_sweepAngle=this.m_sweepAngle,r.m_startAngle=this.m_startAngle,r.m_bits=this.m_bits,w(r,a.x,a.y),A(r,m.x,m.y),o)return void sr(r,Ui(this));r.m_startAngle=Bi(this,e),r.m_sweepAngle=Bi(this,t)-r.m_startAngle,r.m_startAngle=Hi(r.m_startAngle),or(r,Math.abs(r.m_sweepAngle)>n.pi()),i&&r.assignVertexDescription(this.m_description),pr(r),Xi(r);const h=this.m_description.getAttributeCount();if(h>1&&!i){for(let t=1;t<h;t++){const s=this.m_description.getSemantics(t),n=Pi.getComponentCount(s);for(let t=0;t<n;t++){const n=this.getAttributeAsDbl(e,s,t);r.setStartAttribute(s,t,n)}}for(let e=1;e<h;e++){const s=this.m_description.getSemantics(e),n=Pi.getComponentCount(s);for(let e=0;e<n;e++){const n=this.getAttributeAsDbl(t,s,e);r.setEndAttribute(s,e,n)}}}r.afterCompletedModification()}queryDerivative(e,t){!function(e,t,s){if(Ki(e))s.setE(y.constructPoint2D(e.getEndXY()).subE(y.constructPoint2D(e.getStartXY())));else{const i=new n.ECoordinate;zi(e,t,i);const r=new y;if(r.setCoordsE(new n.ECoordinate(e.m_semiMajorAxis).negate().mulE((new n.ECoordinate).setSin(i)),new n.ECoordinate(e.getSemiMinorAxis()).mulE((new n.ECoordinate).setCos(i))),e.m_rotation){const t=new n.ECoordinate(e.m_rotation);r.rotateDirect((new n.ECoordinate).setCos(t),(new n.ECoordinate).setSin(t))}r.scaleThis(new n.ECoordinate(e.getSweepAngle())),s.setE(r)}}(this,e,t)}cutArcIgnoreAttributes(e,t,s){let i=0===e&&1===t;const r=new n.Point2D;this.queryCoord2D(e,r);const o=new n.Point2D;this.queryCoord2D(t,o),i||(r.equals(o)?t-e>.5&&this.isMajor()&&this.isClosed()?(i=!0,e=0,t=1):1===t?e=t:t=e:(e>0&&r.isEqual(this.m_XStart,this.m_YStart)&&(e=0),t<1&&o.isEqual(this.m_XEnd,this.m_YEnd)&&(t=1),i=0===e&&1===t)),s.m_center.assign(this.m_center),s.m_semiMajorAxis=this.m_semiMajorAxis,s.m_minorMajorRatio=this.m_minorMajorRatio,s.m_interior.assign(this.m_interior),s.m_rotation=this.m_rotation,s.m_cosr=this.m_cosr,s.m_sinr=this.m_sinr,s.m_sweepAngle=this.m_sweepAngle,s.m_startAngle=this.m_startAngle,s.m_bits=this.m_bits,w(s,r.x,r.y),A(s,o.x,o.y),i?sr(s,Ui(this)):(s.m_startAngle=Bi(this,e),s.m_sweepAngle=Bi(this,t)-s.m_startAngle,s.m_startAngle=Hi(s.m_startAngle),or(s,Math.abs(s.m_sweepAngle)>Math.PI),pr(s),s.afterCompletedModification())}changeEndPoints2D(e,t){Wi(this,e,t,!1)}getAttributeAsDbl(e,t,s){if(0===t)return 0===s?this.getCoordX(e):this.getCoordY(e);if(0===e)return this.getStartAttributeAsDbl(t,s);if(1===e)return this.getEndAttributeAsDbl(t,s);const i=this.calculateLength2D(),r=i>0?this.tToLength(e)/i:0,o=Pi.getInterpolation(t),a=this.getStartAttributeAsDbl(t,s),m=this.getEndAttributeAsDbl(t,s);return n.interpolate(o,a,m,r,Pi.getDefaultValue(t))}getClosestCoordinate(e,t){return Pr(this,e,n.Envelope1D.unit(),t)}getClosestCoordinateOnInterval(e,t,s=-1){return Pr(this,e,t,!1)}getYMonotonicParts(e,s=!1){e.length<2&&t.throwInvalidArgumentException("");const i=this.getSemiAxes(),r=Math.atan2(i.y*this.m_cosr,i.x*this.m_sinr),o=r+n.pi(),a=n.makePrimitiveArray(3,Number.NaN);let m=0;if(a[0]=Li(this,r),a[0]>0&&a[0]<1&&m++,a[1]=Li(this,o),a[1]>0&&a[1]<1&&(a[m]=a[1],m++),0===m)return 0;a[m]=1,m++,t.geometryReleaseAssert(e.length>=m);let h=0;for(let t=0;t<m;t++){const n=a[t];this.queryCut(h,n,e[t],s),h=n}return m}getMonotonicParts(e,s){if(e.length<4&&t.throwInvalidArgumentException(""),this.isDegenerateToLine())return e[0].createEllipticArc().assignCopy(this),s&&e[0].get().dropAllAttributes(),1;const i=this.getSemiAxes(),r=n.makePrimitiveArray(4,Number.NaN);r[0]=Math.atan2(i.y*this.m_cosr,i.x*this.m_sinr),r[1]=r[0]+n.pi(),r[2]=Math.atan2(-i.y*this.m_sinr,i.x*this.m_cosr),r[3]=r[2]+n.pi();const o=n.makePrimitiveArray(5,Number.NaN);let a=0;for(let e=0;e<4;e++)o[a]=Li(this,r[e]),o[a]>0&&o[a]<1&&a++;if(0===a)return 0;n.numericSortRange(o,a),o[a-1]<1&&(o[a]=1,a++),t.geometryReleaseAssert(e.length>=a);let m=0;for(let t=0;t<a;t++){const n=o[t];this.queryCut(m,n,e[t],s),m=n}return a}intersectionWithAxis2D(e,t,s,i){if(Ki(this))return new Gr({start:this.getStartXY(),end:this.getEndXY()}).intersectionWithAxis2D(e,t,s,i);let r,o;const a=new n.ECoordinate(t),m=this.getSemiAxes();if(e){if(t>this.m_center.y+m.x||t<this.m_center.y-m.x)return 0;r=new n.ECoordinate(m.x).mulThis(this.m_sinr),o=new n.ECoordinate(m.y).mulThis(this.m_cosr),a.subThis(this.m_center.y)}else{if(t>this.m_center.x+m.x||t<this.m_center.x-m.x)return 0;r=new n.ECoordinate(m.x).mulThis(this.m_cosr),o=new n.ECoordinate(m.y).mulThis(-this.m_sinr),a.subThis(this.m_center.x)}const h=r.sqr(),l=o.sqr(),u=h.addE(l),c=o.mulE(a).mulThis(-2),g=a.sqr().subThisE(h),d=c.sqr().subThisE(u.mulE(g).mulThis(4)),p=r.mulE(a).mulThis(-2),_=a.sqr().subThisE(l),f=p.sqr().subThisE(u.mulE(_).mulThis(4));let y=d.eps()*Math.abs(f.value())<=f.eps()*Math.abs(d.value());y?r.isZero()&&(y=!1):o.isZero()&&(y=!0),y||(c.setE(p),g.setE(_));const x=n.makeObjectArray(n.ECoordinate,2);let P=Ne(u,c,g,n.Envelope1D.construct(-1,1),!1,x);if(0===P)return 0;const E=[0,0];let v=0;for(let e=0;e<P;e++){const t=new n.ECoordinate,s=new n.ECoordinate;y?(t.setE(x[e]),s.setE(a.subE(o.mulE(x[e])).divThisE(r))):(s.setE(x[e]),t.setE(a.subE(r.mulE(x[e])).divThisE(o)));const i=Li(this,Math.atan2(t.value(),s.value()));i>=0&&i<=1&&(E[v]=i,v++)}return P=v,0===P?0:(2===P&&E[0]>E[1]&&(E[1]=n.swap(E[0],E[0]=E[1])),i&&n.memcpy(i,E,0,0,P),s&&(s[0]=e?this.getCoordX(E[0]):this.getCoordY(E[0]),P>1&&(s[1]=e?this.getCoordX(E[1]):this.getCoordY(E[1]),!i&&s[0]>s[1]&&(s[1]=n.swap(s[0],s[0]=s[1])))),P)}intersectionOfYMonotonicWithAxisX(e,t){if(this.m_YStart===this.m_YEnd)return e===this.m_YStart?t:Number.NaN;if(e===this.m_YStart)return this.m_XStart;if(e===this.m_YEnd)return this.m_XEnd;const s=[0,0];return-1===this.intersectionWithAxis2D(!0,e,s,null)?t:s[0]}isCurve(){return!0}isDegenerate(e){return D(this,e)}isDegenerate3D(e,s){return t.geometryReleaseAssert(0),!1}queryLooseEnvelope(e){3!==e.m_EnvelopeType?this.queryLooseEnvelopeOnInterval(new n.Envelope1D(0,1),e):t.throwNotImplementedException("3d not impl")}clone(e){const t=new Ei;return this.copyTo(t),t}queryInterval(e,t){if(0===e){if(Ki(this))return 0===t?n.Envelope1D.construct(this.getStartX(),this.getEndX()):n.Envelope1D.construct(this.getStartY(),this.getEndY());let e;const s=this.getSemiAxes();e=0===t?Math.atan2(-s.y*this.m_sinr,s.x*this.m_cosr):Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr);const i=e+Math.PI,r=[0,0];r[0]=Li(this,e),r[1]=Li(this,i);const o=0===t?n.Envelope1D.construct(this.getStartX(),this.getEndX()):n.Envelope1D.construct(this.getStartY(),this.getEndY()),a=new n.Point2D;for(let e=0;e<2;e++){const s=r[e];s>0&&s<1&&(this.queryCoord2D(s,a),o.mergeNeCoordinate(0===t?a.x:a.y))}return o}return super.queryInterval(e,t)}queryLooseEnvelopeOnInterval(e,t){const s=new n.Envelope1D(0,1);if(s.intersect(e),s.isEmpty())return void t.setEmpty();if(Ki(this))return t.setCoords(this.getCoord2D(s.vmin)),void t.mergeNe(this.getCoord2D(s.vmax));const i=this.getCoord2D(s.vmin),r=this.getCoord2D(s.vmax);if(1===this.m_minorMajorRatio&&Math.abs(this.m_sweepAngle)*s.width()<=n.geometryHalfPi){let e=n.Point2D.lerp(i,r,.5);const s=e.sub(this.m_center);return s.normalize(),e=e.add(s.mul(.5*n.Point2D.distance(i,r))),t.setCoords(i),t.mergeNe(r),void t.mergeNe(e)}xr(this,s,t)}tToLength(e){return Ki(this)?e*n.Point2D.distance(this.getStartXY(),this.getEndXY()):1===this.m_minorMajorRatio?Math.abs(this.getSweepAngle()*e)*this.m_semiMajorAxis:$i(this,e)}parametricAngleToT(e){return Li(this,e)}tToParametricAngle(e){return Bi(this,e)}lengthToT(e){if(Ki(this)){const t=n.Point2D.distance(this.getStartXY(),this.getEndXY());return 0===t?0:e/t}if(1===this.m_minorMajorRatio){const t=Math.abs(this.getSweepAngle())*this.m_semiMajorAxis;return 0===t?0:e/t}{const t=function(e,t){if(Ki(e)){const s=n.Point2D.distance(e.getStartXY(),e.getEndXY());return 0===s?0:t/s}if(1===e.m_minorMajorRatio){const s=Math.abs(e.getSweepAngle()*e.m_semiMajorAxis);return 0===s?0:t/s}if(0===t)return 0;const s=e.getSweepAngle();if(0===s)return.5;const i=ji(e),r=n.halfPi(),o=Ji(e);s<0&&(t=-t);const a=t/e.m_semiMajorAxis+o;let m=n.inverseEllipticE(a,i.e2,i.completeE);return m-=r,m-=e.getStartAngle(),m/s}(this,e);return t}}calculateWeightedAreaCentroid2D(e){if(Ki(this)){const e=new n.Point2D;return e.setCoords(0,0),e}const t=dr(this),s=this.getStartXY().sub(this.m_center),i=this.getEndXY().sub(this.m_center),r=this.m_semiMajorAxis,o=this.getSemiMinorAxis(),a=this.m_startAngle+this.m_sweepAngle,m=new n.Point2D;m.x=r*o*(r*this.m_cosr*(-Math.sin(a)+Math.sin(this.m_startAngle))+o*(-Math.cos(a)+Math.cos(this.m_startAngle))*this.m_sinr)/3,m.y=r*o*(o*(Math.cos(a)-Math.cos(this.m_startAngle))*this.m_cosr+r*(-Math.sin(a)+Math.sin(this.m_startAngle))*this.m_sinr)/3;const h=i.add(s).mul(i.crossProduct(s)/6);return m.x-=h.x,m.y-=h.y,m.add(this.m_center.sub(e).mul(t))}calculateWeightedCentroid2D(){const e=new n.Point2D;if(this.isDegenerate(0))return e.setCoords(0,0),e;if(Ki(this))return e.assign(this.getCoord2D(.5).mul(this.calculateLength2D())),e;let t=this.m_startAngle,s=this.m_startAngle+this.m_sweepAngle;if(s<t){const e=t;t=s,s=e}const i=Math.sin(t),r=Math.sin(s),o=Math.cos(t),a=Math.cos(s);if(1===this.m_minorMajorRatio){const t=this.getSemiMajorAxis(),s=t*t,n=s*(r-i),m=s*(o-a);e.setCoords(n,m)}else{const t=this.getSemiMajorAxis(),s=this.getSemiMinorAxis(),n=t*t,m=s*s,h=t*s,l=n-m,u=l/m,c=l/n,g=Math.sqrt(u),d=Math.sqrt(c),p=.5*h*(Math.asinh(g*r)/g+r*Math.sqrt(1+u*r*r))-.5*h*(Math.asinh(g*i)/g+i*Math.sqrt(1+u*i*i)),_=-.5*h*(Math.asin(d*a)/d+a*Math.sqrt(1-c*a*a))- -.5*h*(Math.asin(d*o)/d+o*Math.sqrt(1-c*o*o));e.setCoords(p,_)}return e.rotateDirect(this.m_cosr,this.m_sinr),e.assign(e.add(this.m_center.mul(this.calculateLength2D()))),e}isIntersectingPoint(e,t,s){if(s&&(e.isEqualPoint2D(this.getStartXY())||e.isEqualPoint2D(this.getEndXY())))return!1;if(!Ki(this)){const s=n.Point2D.distance(e,this.m_center),i=this.getSemiAxes();if(s<i.x-t||s>i.y+t)return!1}const i=this.getClosestCoordinate(e,!1),r=new n.Point2D;return this.queryCoord2D(i,r),n.Point2D.distance(r,e)<=t}isIntersectingPoint3D(e,s,n,i,r=1){return t.geometryReleaseAssert(0),!1}getTangent(e){if(Ki(this))return this.getEndXY().sub(this.getStartXY());{const t=Bi(this,e),s=new n.Point2D;return s.setCoords(-this.m_semiMajorAxis*Math.sin(t),this.getSemiMinorAxis()*Math.cos(t)),this.m_rotation&&s.rotateDirect(this.m_cosr,this.m_sinr),s.scale(this.getSweepAngle()),s}}getDerivative(e){if(Ki(this))return this.getEndXY().sub(this.getStartXY());{const t=Bi(this,e),s=new n.Point2D;return s.setCoords(-this.m_semiMajorAxis*Math.sin(t),this.getSemiMinorAxis()*Math.cos(t)),this.m_rotation&&s.rotateDirect(this.m_cosr,this.m_sinr),s.scale(this.getSweepAngle()),s}}normalizeAfterEndpointChange(){return!!mr(this)&&(Ki(this)?(hr(this),!1):lr(this,!1))}projectionBehavior(){return(4&this.m_bits)>>2}setProjectionBehavior(e){this.m_bits=-5&this.m_bits|e<<2}convertToCanonic(e){const t=new n.Point2D(e.x,e.y);return t.subThis(this.m_center),t.rotateReverse(this.m_cosr,this.m_sinr),t}convertFromCanonic(e){const t=new n.Point2D(e.x,e.y);return t.rotateDirect(this.m_cosr,this.m_sinr),t.addThis(this.m_center),t}canonicToWorldTransformation(e){e.setRotate(this.m_cosr,this.m_sinr),e.shiftCoords(this.m_center.x,this.m_center.y)}getCurvature(e){const t=Bi(this,e),s=new n.Point2D,i=this.getSemiMinorAxis();s.setCoords(-this.m_semiMajorAxis*Math.sin(t),i*Math.cos(t));const r=new n.Point2D;r.setCoords(-this.m_semiMajorAxis*Math.cos(t),-i*Math.sin(t)),this.m_rotation&&(s.rotateDirect(this.m_cosr,this.m_sinr),r.rotateDirect(this.m_cosr,this.m_sinr));const o=s.sqrLength();if(0===o)return Number.NaN;const a=Math.sqrt(o);return s.divThis(a),s.crossProduct(r)/o}getMonotonicPartParams(e,s){const i=n.makePrimitiveArray(6,Number.NaN);i[0]=0;let r=1;if(this.isDegenerateToLine())i[1]=1,r=2;else{const e=this.getSemiAxes(),t=n.makePrimitiveArray(4,Number.NaN);this.m_rotation?(t[0]=Math.atan2(e.y*this.m_cosr,e.x*this.m_sinr),t[1]=t[0]+Math.PI,t[2]=Math.atan2(-e.y*this.m_sinr,e.x*this.m_cosr),t[3]=t[2]+Math.PI):(t[0]=0,t[1]=Math.PI,t[2]=.5*Math.PI,t[3]=n.threeHalfPi());for(let e=0;e<4;e++){const s=Li(this,t[e]);s>0&&s<1&&(i[r]=s,r++)}r>2&&n.numericSortRange(i,r),i[r]=1,r++}if(s){e<r&&t.throwInvalidArgumentException("");for(let e=0;e<r;e++)s[e]=i[e]}return r}calculateLowerLength2D(){const e=n.Point2D.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return e;const t=Math.abs(this.m_sweepAngle)*this.getSemiMinorAxis();return Math.max(t,e)}calculateUpperLength2D(){const e=n.Point2D.distance(this.getStartXY(),this.getEndXY());if(this.isDegenerateToLine())return e;const t=Math.abs(this.m_sweepAngle)*this.getSemiMajorAxis();return Math.max(t,e)}orientBottomUp(){if(this.m_YEnd<this.m_YStart||this.m_YEnd===this.m_YStart&&this.m_XEnd<this.m_XStart){this.m_XEnd=n.swap(this.m_XStart,this.m_XStart=this.m_XEnd),this.m_YEnd=n.swap(this.m_YStart,this.m_YStart=this.m_YEnd);for(let e=0,t=this.m_description.getTotalComponentCount()-2;e<t;e++)this.m_attributes[e+t]=n.swap(this.m_attributes[e],this.m_attributes[e]=this.m_attributes[e+t]);this.m_startAngle=this.m_startAngle+this.m_sweepAngle,this.m_sweepAngle=-this.m_sweepAngle}}isLine(){return Ki(this)}copyIgnoreAttributes(e){e.m_XStart=this.m_XStart,e.m_YStart=this.m_YStart,e.m_XEnd=this.m_XEnd,e.m_YEnd=this.m_YEnd,e.m_center.assign(this.m_center),e.m_semiMajorAxis=this.m_semiMajorAxis,e.m_minorMajorRatio=this.m_minorMajorRatio,e.m_interior.assign(this.m_interior),e.m_rotation=this.m_rotation,e.m_cosr=this.m_cosr,e.m_sinr=this.m_sinr,e.m_sweepAngle=this.m_sweepAngle,e.m_startAngle=this.m_startAngle,e.m_bits=this.m_bits,nr(e)}calculateArea2DHelper(){return dr(this)}absNorm(){let e=this.getStartXY().norm(1)+this.getEndXY().norm(1);return this.isDegenerateToLine()||(e+=this.m_center.norm(1),e+=this.m_semiMajorAxis),e}queryEnvelopeW(e,t){if(t.setCoords(this.getCoord2D(e.vmin)),t.mergeNe(this.getCoord2D(e.vmax)),Ki(this))return;const s=this.getSemiAxes(),i=n.makePrimitiveArray(8,Number.NaN);{const e=Math.atan2(-s.y*this.m_sinr,s.x*this.m_cosr),t=e+Math.PI,n=Math.atan2(s.y*this.m_cosr,s.x*this.m_sinr),r=n+Math.PI;i[0]=Li(this,e),i[1]=Li(this,t),i[2]=Li(this,n),i[3]=Li(this,r)}{const e=this.m_cosr+this.m_sinr,t=this.m_cosr-this.m_sinr,n=Math.atan2(-s.y*e,s.x*t),r=n+Math.PI,o=Math.atan2(s.y*t,s.x*e),a=o+Math.PI;i[4]=Li(this,n),i[5]=Li(this,r),i[6]=Li(this,o),i[7]=Li(this,a)}const r=n.Point2D.getNAN();for(let s=0;s<8;s++){const n=i[s];e.containsExclusiveCoordinate(n)&&(this.queryCoord2D(n,r),t.mergeNe(r))}}setSegmentFromCoordsForStitcher(e,t){!function(e,t,s){const i=0===e.projectionBehavior();if(s<=2)return void Qi(e,t[0],t[s-1],i?0:1);if(i){e.constructCircularArcThreePoint(t[0],t[s-1],t[Math.trunc(s/2)]);const i=new n.Point2D;return e.queryCoord2D(.5,i),void e.m_interior.setCoordsPoint2D(i)}const r=e.getSemiMajorAxis(),o=e.getMinorMajorRatio(),a=e.getAxisXRotation(),m=e.getCenter(),h=new Array(4);h[0]=e.isMajor(),h[1]=!h[0],h[2]=h[0],h[3]=!h[0];const l=new Array(4);l[0]=e.isClockwise(),l[1]=l[0],l[2]=!l[0],l[3]=!l[0];const u=Math.trunc(s<5?1:(s+4)/5),c=n.makeObjectArray(Ei,4),g=n.makePrimitiveArray(4,Number.NaN);let d=0;for(let e=0;e<4;e++){c[e].constructEllipticArcEndPointsCenter(t[0],t[s-1],r,o,a,h[e],l[e],m),g[e]=0;let i=0;for(let r=u;r<s-1;r+=u){const s=c[e].getClosestCoordinate(t[r],!1);g[e]+=n.Point2D.sqrDistance(c[e].getCoord2D(s),t[r]),i++}g[e]/=i,g[e]<g[d]&&(d=e)}e.assignCopy(c[d])}(this,e,t)}writeInBufferStream(e,t){const s=new Float64Array(10);return s[0]=this.m_bits,s[1]=this.m_semiMajorAxis,s[2]=this.m_minorMajorRatio,s[3]=this.m_rotation,s[4]=this.m_center.x,s[5]=this.m_center.y,s[6]=this.m_sweepAngle,s[7]=this.m_startAngle,s[8]=this.m_interior.x,s[9]=this.m_interior.y,e.writeRangeFromArray(t,s.length,s,!0,1),t+s.length}readFromBufferStream(e,t){const s=new Float64Array(10);e.queryRange(t,s.length,s,!0,1),this.m_bits=s[0],this.m_semiMajorAxis=s[1],this.m_minorMajorRatio=s[2],this.m_rotation=s[3],this.m_center.x=s[4],this.m_center.y=s[5],this.m_sweepAngle=s[6],this.m_startAngle=s[7],this.m_interior.x=s[8],this.m_interior.y=s[9],this.m_cosr=Math.cos(this.m_rotation),this.m_sinr=Math.sin(this.m_rotation),this.m_cachedValues=null}snapControlPoints(e){return!1}needsSnapControlPoints(e){return!1}calculateSpecialPointsForCracking(e,s){return t.throwInternalErrorException("should not1; be called"),0}ensureXYMonotone(){if(Ki(this))return!1;if(this.getStartXY().equals(this.getEndXY()))return Qi(this,this.getStartXY(),this.getEndXY(),this.projectionBehavior()),!0;const e=n.makeObjectArray(n.Point2D,3);let t=ur(this,e);if(Ln(e)){let s=!1;if(0===this.projectionBehavior()){const r=new i.Envelope2D;r.setCoords({pt:e[0]}),r.mergeNe(e[2]);const o=new n.Point2D;o.setSub(e[2],e[0]),o.leftPerpendicularThis(),o.normalize(),o.scale(n.Point2D.distance(e[2],e[0]));const a=n.Point2D.lerp(e[2],e[0],.5),m=a.sub(o),h=a.add(o);r.clipLine(m,h);const l=n.Point2D.getClosestCoordinate(m,h,e[1],!1);e[1]=n.Point2D.lerp(m,h,l);const u=e[2].sub(e[1]),c=e[0].sub(e[1]),g=u.crossProduct(c),d=u.dotProduct(c);t=n.halfPi()-Math.abs(.5*Math.atan2(g,d)),s=!0}return cr(e,t*t,null,s,this),!0}return!1}setCoordsForIntersector(e,t,s){Wi(this,e,t,s)}getInteriorPoint(){return this.m_interior.clone()}copyToImpl(e){const t=e;t.m_center.assign(this.m_center),t.m_semiMajorAxis=this.m_semiMajorAxis,t.m_minorMajorRatio=this.m_minorMajorRatio,t.m_interior.assign(this.m_interior),t.m_rotation=this.m_rotation,t.m_cosr=this.m_cosr,t.m_sinr=this.m_sinr,t.m_sweepAngle=this.m_sweepAngle,t.m_startAngle=this.m_startAngle,t.m_bits=this.m_bits,sr(t,Ui(this))}reverseImpl(){ir(this,!rr(this)),Xi(this),(0!==this.projectionBehavior()||this.getStartXY().equals(this.getEndXY()))&&pr(this)}equalsImpl(e){const t=e;if(this.m_bits!==t.m_bits)return!1;if(this.m_semiMajorAxis!==t.m_semiMajorAxis)return!1;if(this.m_minorMajorRatio!==t.m_minorMajorRatio)return!1;if(!(this.m_center.isEqualPoint2D(t.m_center)||this.m_center.isNAN()&&t.m_center.isNAN()))return!1;if(this.m_rotation!==t.m_rotation)return!1;if(!this.m_interior.equals(t.m_interior))return!1;const s=t.m_sweepAngle;if(this.m_sweepAngle!==s)return!1;const n=t.m_startAngle;return this.m_startAngle===n}equalsImplTol(e,t){const s=e;if(this.m_bits!==s.m_bits)return!1;if(this.m_center.isNAN()&&s.m_center.isNAN())return!0;if(this.m_center.isNAN()!==s.m_center.isNAN())return!1;if(!this.getSemiAxes().isEqualPoint2D(s.getSemiAxes(),t))return!1;if(!this.m_center.isEqualPoint2D(s.m_center,t))return!1;const i=Math.abs(_i(pi(fi(this.m_rotation-s.m_rotation)))),r=Math.abs(n.pi()-i),o=Math.min(i,r);if(this.m_semiMajorAxis*Math.abs(o)>t)return!1;const a=this.getCoord2D(.5),m=s.getCoord2D(.5);return!!a.isEqualPoint2D(m,t)}swapImpl(e){const t=e;var s;this.m_center=n.swap(t.m_center,t.m_center=this.m_center),this.m_semiMajorAxis=n.swap(t.m_semiMajorAxis,t.m_semiMajorAxis=this.m_semiMajorAxis),this.m_minorMajorRatio=n.swap(t.m_minorMajorRatio,t.m_minorMajorRatio=this.m_minorMajorRatio),this.m_interior=n.swap(t.m_interior,t.m_interior=this.m_interior),this.m_rotation=n.swap(t.m_rotation,t.m_rotation=this.m_rotation),this.m_cosr=n.swap(t.m_cosr,t.m_cosr=this.m_cosr),this.m_sinr=n.swap(t.m_sinr,t.m_sinr=this.m_sinr),this.m_sweepAngle=n.swap(t.m_sweepAngle,t.m_sweepAngle=this.m_sweepAngle),this.m_startAngle=n.swap(t.m_startAngle,t.m_startAngle=this.m_startAngle),this.m_bits=n.swap(t.m_bits,t.m_bits=this.m_bits),(s=t).m_cachedValues=n.swap(this.m_cachedValues,this.m_cachedValues=s.m_cachedValues)}afterCompletedModification(){hr(this),nr(this)}intersect(e,t,s,n,i){return Ir(!1,this,e,t,s,n,i)}intersectPoint(e,s,i){if(s.length<2&&t.throwOutOfRangeException(""),Ki(this))return new Gr({start:this.getStartXY(),end:this.getEndXY()}).intersectPoint(e,s,i);{const t=n.Point2D.distance(e,this.m_center);if(t>this.m_semiMajorAxis+i||t<this.getSemiMinorAxis()-i)return 0}const r=this.getClosestCoordinate(e,!1),o=n.Point2D.getNAN();return this.queryCoord2D(r,o),n.Point2D.distance(o,e)<=i?n.isOneOf(r,0,1)&&(this.queryCoord2D(0===r?1:0,o),n.Point2D.distance(o,e)<=i)?(s&&(s[0]=0,s[1]=1),2):(s&&(s[0]=r),1):0}isIntersecting(e,t,s){return 0!==Cr(!1,this,e,t,s)}endPointModified(){this.m_bits|=8,nr(this)}clearEndPointModified(){hr(this)}}function vi(e,t,s,n){const i=[];return Ci(t,i),Di(e,i,t,s)}function Ci(e,t){t.length=e;for(let e=0;e<t.length;++e)t[e]=e;e>3&&m(e,t)}function Di(e,t,s,i,r){let o=0;const a=[0,0,0];let m=0,h=0;for(let r=0;r<3;++r){let l=!1;for(;h<s;){const s=e.at(t[h]);let u=1;if(3===o?u=n.Point2D.inCircleRobust(e.at(i[0]),e.at(i[1]),e.at(i[2]),s):2===o?u=n.Point2D.inCircleRobust3Point(e.at(i[0]),e.at(i[1]),s):1===o&&s.equals(e.at(i[0]))&&(u=0),u<=0){if(u<0&&r+1<3){t[m]=n.swap(t[h],t[h]=t[m]);for(let e=0;e<o;e++)if(i[e]===t[h]){a[e]=h;break}m++}h++;continue}l=!0;let c=0;for(let e=0;e<o;e++)a[e]>h&&(i[c]=i[e],a[c]=a[e],c++);o=c,i[o]=t[h],a[o]=h,o++,o<3?h=m:(1===n.Point2D.orientationRobust(e.at(i[0]),e.at(i[1]),e.at(i[2]))&&(i[2]=n.swap(i[0],i[0]=i[2]),a[2]=n.swap(a[0],a[0]=a[2])),h++)}if(!l)break;if(r+1<3){m=0;let s=!1;for(let e=0;e<o;e++)for(let t=e+1;t<o;t++)a[e]>a[t]&&(a[t]=n.swap(a[e],a[e]=a[t]),i[t]=n.swap(i[e],i[e]=i[t]),s=!0);for(let e=0;e<o;e++)t[a[e]]=n.swap(t[e],t[e]=t[a[e]]),a[e]=e;s&&3===o&&1===n.Point2D.orientationRobust(e.at(i[0]),e.at(i[1]),e.at(i[2]))&&(i[2]=n.swap(i[0],i[0]=i[2]),a[2]=n.swap(a[0],a[0]=a[2]))}h=o}return o}function bi(e,s,i,r,o,a,m,h){a&&(a.length=0),m&&(m.length=0);const l=e.getGeometryType();if(l===t.GeometryType.enumLine)return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY())),m&&(m.push(0),m.push(1)),1;if(l===t.GeometryType.enumBezier){if(!r)return a&&(a.push(e.getStartXY()),a.push(e.getControlPoint1()),a.push(e.getControlPoint2()),a.push(e.getEndXY())),m&&(m.push(0),m.push(1)),1;const t=n.makePrimitiveArray(9,Number.NaN);let s=e.getMonotonicPartParams(t.length,t);if(t.length=s,s=wi(e,i,t),2===s&&o&&(t[1]=.5,t.push(1),s=3),m&&m.splice(0,0,...t.slice(0,s)),a){const n=new Mr;for(let i=1;i<s;i++){const s=t[i-1],r=t[i];e.queryCut(s,r,n,!0);const o=n.get();Fs(o),1===i&&a.push(o.getStartXY()),a.push(o.getControlPoint1()),a.push(o.getControlPoint2()),a.push(o.getEndXY())}}return s-1}if(l===t.GeometryType.enumEllipticArc){const h=e;if(h.isDegenerateToLine()||h.isDegenerate(0))return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY())),m&&(m.push(0),m.push(1)),1;if(r&&(o||!h.isMonotoneQuickAndDirty())){const l=n.makePrimitiveArray(6,Number.NaN);let u=h.getMonotonicPartParams(l.length,l);l.length=u,u=wi(e,i,l),2===u&&o&&(l[1]=.5,l.push(1),u=3);let c=0;if(u>2){const e=new Mr,n=m||[];let o=0;for(let g=1;g<u;g++){const d=l[o],p=l[g];if(h.queryCut(d,p,e,!0),e.get().isDegenerate(0))continue;const _=n.length,f=Ni(1===g,e.get(),s,i,r,a,m);t.geometryReleaseAssert(f>0),c+=f;const y=g===u-1,x=l[o],P=e.get().getSweepAngle()/h.getSweepAngle();for(let e=_,t=n.length;e<t;e++)if(n[e]=!y||e+1<t?x+n[e]*P:1,a){const t=3*e,s=h.getCoord2D(n[e]);a[t].setCoordsPoint2D(s),t>0&&qs(a.slice(t-3))}o=g}return c}}return Ni(!0,h,s,i,r,a,m)}if(l===t.GeometryType.enumRationalBezier2){const t=e;if(r&&(o||!t.isMonotoneQuickAndDirty())){const r=n.makePrimitiveArray(6,Number.NaN);let h=t.getMonotonicPartParams(r.length,r);r.length=h,h=wi(e,i,r),2===h&&o&&(r[1]=.5,r.push(1),h=3);let l=0;if(h>2){const e=new Mr,n=m||[];for(let o=1;o<h;o++){const u=r[o-1],c=r[o];t.queryCut(u,c,e,!0);const g=n.length;l+=Mi(1===o,e.get(),s,i,!1,a,m);const d=o===h-1,p=r[o-1];for(let e=g,s=n.length;e<s;e++)if(n[e]=!d||e+1<s?p+n[e]:1,a){const s=3*e,i=t.getCoord2D(n[e]);a[s].setCoordsPoint2D(i),s>0&&Rt(a.slice(s-3))}}return l}}return Mi(!0,t,s,i,r,a,m)}if(l===t.GeometryType.enumBezier2){const t=e,h=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(h);const l=new pn;l.constructFromQuadratic(h);const u=bi(l,s,i,r,o,a,m);if(null!=a&&null!=m){const e=3;for(let s=1,i=0;s<u;++s,i+=e){const o=new n.Point2D;t.queryCoord2D(m[s],o);const h=a[i+e];!o.equals(h)&&(a[i+e].setCoordsPoint2D(o),r)&&qs(a.slice(i,i+4))}}return u}t.throwNotImplementedException("")}function Si(e,s,i,r,o,a,m,h,l){const u=e.getGeometryType();if(a&&(a.length=0,m.length=0),h&&(h.length=0),u===t.GeometryType.enumEllipticArc){const t=e;if(t.isDegenerateToLine()||t.isDegenerate(0))return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY()),m.push(Number.NaN),m.push(Number.NaN),m.push(Number.NaN)),h&&(h.push(0),h.push(1)),1}const c=n.makePrimitiveArray(9,Number.NaN);let g;if(o)g=e.getMonotonicPartParams(c.length,c),c.length=g,g=wi(e,i,c);else{if(g=2,c[0]=0,c[1]=1,u===Ei.type){const t=e.getSweepAngle();if(t>.9*Math.PI){const e=2*Math.PI/3;Math.min(3,Math.trunc(t/e+.5))>2?(c[0]=0,c[1]=1/3,c[2]=2/3,c[3]=1,g=4):(c[0]=0,c[1]=.5,c[2]=1,g=3)}}else t.geometryReleaseAssert(u===Ye.type);c.length=g}if(2===g&&r&&(c[1]=.5,c.push(1),g=3),a){const s=new Mr;let i=1;for(;i<g;){const r=c[i-1],h=c[i];e.queryCut(r,h,s,!0);const l=n.makeObjectArray(n.Point2D,3),d=[1,1,1];if(u===t.GeometryType.enumEllipticArc){const e=s.get();if(Math.abs(e.getSweepAngle())>.9*Math.PI){const e=(h-r)/3;c.splice(i,0,r+e),c.splice(i+1,0,r+2*e),g+=2;continue}d[1]=ur(e,l)}else{const e=s.get();e.queryControlPoints(l),e.queryWeights(d)}o&&Ln(l),1===i&&(a.push(l[0].clone()),m.push(d[0])),a.push(l[1].clone()),a.push(l[2].clone()),m.push(d[1]),m.push(d[2]),i++}}return h&&(h.length=g,n.memcpy(h,c,0,0,g)),g-1}Ei.type=t.GeometryType.enumEllipticArc;class Ii{static constructDefault(e){return new Ii(0,0,0,e,!1,n.intMax())}constructor(e,i,r,o,a,m){this.m_segmentBuffer=null,this.m_dummyPoint=new s.Point,this.m_progressCounter=0,this.m_progressTracker=o,this.m_bSetDensifyFlag=a,this.m_maxLength=e,this.m_maxDeviation=i,this.m_maxAngle=r>n.halfPi()?n.halfPi():r,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_maxSegmentsPerCurve=m,t.checkAndThrow(this.m_maxSegmentsPerCurve>0,"this.m_maxSegmentsPerCurve > 0"),this.m_minStep=1/this.m_maxSegmentsPerCurve}densify(e){return this.densifyGeom(e)}densifySegment(e,t){this.densifySegmentEx(e,null,!0,!1,t)}densifyEx(e,s,i,r,o,a){return this.m_maxLength=s,this.m_maxDeviation=i,this.m_maxAngle=r>n.halfPi()?n.halfPi():r,this.m_cosMaxAngle=Math.cos(this.m_maxAngle),this.m_bOnlyCurveDensify=this.m_maxAngle>0||this.m_maxDeviation>0,this.m_bSetDensifyFlag=o,this.m_maxSegmentsPerCurve=a,t.checkAndThrow(this.m_maxSegmentsPerCurve>0,"this.m_maxSegmentsPerCurve > 0"),this.m_minStep=1/this.m_maxSegmentsPerCurve,this.densifyGeom(e)}densifyGeom(e){if(e.isEmpty()||e.getDimension()<1)return e;const s=e.getGeometryType();return t.isMesh(s)?e:t.isMultiPath(s)?this.densifyMultiPath(e):t.isSegment(s)?this.densifySegmentImpl(e):s===t.GeometryType.enumEnvelope?this.densifyEnvelope(e):void t.throwInternalErrorException("")}densifySegmentEx(e,s,n,i,r){const o=e.getGeometryType();if(!(this.m_maxLength>0||this.m_bOnlyCurveDensify&&o!==t.GeometryType.enumLine)&&(!i||n))return void(s?o===t.GeometryType.enumLine?s.addSegment(e,n):(n&&(e.queryStart(this.m_dummyPoint),s.startPathPoint(this.m_dummyPoint)),e.queryEnd(this.m_dummyPoint),s.lineToPoint(this.m_dummyPoint)):(n&&r.push(0),r.push(1)));if(o===t.GeometryType.enumBezier)return void this.densifyCubicBezier(e,s,n,i,r);if(o===t.GeometryType.enumRationalBezier2)return void this.densifyRationalBezier2(e,s,n,i,r);if(o===t.GeometryType.enumBezier2)return void this.densifyBezier2(e,s,n,i,r);if(o===t.GeometryType.enumEllipticArc&&!e.isLine()&&e.getMinorMajorRatio()<.25)return void this.densifyEllipticArc(e,s,n,i,r);let a=1;this.m_maxLength>0&&(a=this.calculateLengthSubdivisionStep(e,this.m_maxLength)),this.m_maxDeviation>0&&(a=Math.min(a,this.calculateDeviationSubdivisionStep(e,this.m_maxDeviation))),this.m_maxAngle>0&&(a=Math.min(a,this.calculateAngularSubdivisionStep(e,this.m_maxAngle))),this.densifySegmentByLength(e,a,s,n,i,r)}densifyMultiPath(e){if(!e.hasNonLinearSegments()){if(1===e.getDescription().getAttributeCount())return this.densifyMultiPathLinear(e);if(!(this.m_maxLength>0))return e}const s=e.createInstance();s.getGeometryType()===t.GeometryType.enumPolygon&&s.setFillRule(e.getFillRule()),s.reserve(e.getPointCount());const n=e.getImpl().querySegmentIterator();for(;n.nextPath();){let e=!0;for(;n.hasNextSegment();){const t=n.nextSegment(),i=n.isClosingSegment();this.densifySegmentEx(t,s,e,i,null),i&&s.closePathWithLine(),e=!1}}return s}densifySegmentImpl(e){const t=new xe({vd:e.getDescription()});return this.densifySegmentEx(e,t,!0,!1,[0]),t}densifyEnvelope(e){const t=new es({vd:e.getDescription()});t.addEnvelope(e,!1);const s=i.Envelope2D.constructEmpty();e.queryEnvelope(s);const n=s.width(),r=s.height();return!(this.m_maxLength>0)||n<=this.m_maxLength&&r<=this.m_maxLength?t:this.densifyMultiPath(t)}densifyMultiPathLinear(e){if(!(this.m_maxLength>0))return e;const s=e.createInstance();s.getGeometryType()===t.GeometryType.enumPolygon&&s.setFillRule(e.getFillRule()),s.reserve(e.getPointCount());const i=s.getImpl(),r=e.getImpl(),o=r.getAttributeStreamRef(0),a=new Gr;for(let e=0,t=r.getPathCount();e<t;e++){const t=r.isClosedPath(e);if(0===r.getPathSize(e))continue;const m=r.getPathStart(e),h=o.readPoint2D(2*m),l=h.clone();i.startPath(h);for(let t=m+1,h=r.getPathEnd(e);t<h;t++){const e=o.readPoint2D(2*t),r=n.Point2D.distance(l,e);if(r>this.m_maxLength){let t=Math.ceil(r/this.m_maxLength);t>n.intMax()&&(t=n.intMax());const s=1/t;let o,m,h;l.compare(e)<0?(a.setStartXY(l),a.setEndXY(e),o=0,m=1):(a.setStartXY(e),a.setEndXY(l),o=t-2,m=-1);for(let e=0,r=t-1;e<r;e++,o+=m){this.progress_(),h=s*(o+1);const e=new n.Point2D;a.queryCoord2D(h,e),i.lineTo(e),this.m_bSetDensifyFlag&&i.setAttributeNoCurves(10,i.getPointCount()-1,0,1)}}else this.progress_();s.lineTo(e),l.assign(e)}if(t){const e=n.Point2D.distance(l,h);if(e>this.m_maxLength){const t=h;let s=Math.ceil(e/this.m_maxLength);s>n.intMax()&&(s=n.intMax());const r=1/s;let o,m;l.compare(t)<0?(a.setStartXY(l),a.setEndXY(t),o=0,m=1):(a.setStartXY(t),a.setEndXY(l),o=s-2,m=-1);const u=new n.Point2D(0,0);let c;for(let e=0,t=s-1;e<t;e++,o+=m)this.progress_(),c=r*(o+1),a.queryCoord2D(c,u),i.lineTo(u),this.m_bSetDensifyFlag&&i.setAttributeNoCurves(10,i.getPointCount()-1,0,1)}i.closePathWithLine()}}return s}densifySegmentByLength(e,s,i,r,o,a){t.geometryReleaseAssert(e.getGeometryType()!==t.GeometryType.enumBezier);let m=e.getStartXY().compare(e.getEndXY());0===m&&s<1&&(e.getGeometryType()===t.GeometryType.enumEllipticArc?m=e.getSweepAngle()<0?1:-1:t.throwNotImplementedException("densify segment by length"));let h=0;if(r&&(i?(e.queryStart(this.m_dummyPoint),i.startPathPoint(this.m_dummyPoint)):a.push(0),++h),s*this.m_maxSegmentsPerCurve<1&&(s=1/this.m_maxSegmentsPerCurve),s<1){this.m_segmentBuffer||(this.m_segmentBuffer=new Mr);let t=Math.ceil(1/s);t>n.intMax()&&(t=n.intMax()),s=1/t,this.m_segmentBuffer.create(e.getGeometryType());let r,o,l,u=e;m<0?(r=0,o=1):(e.copyTo(this.m_segmentBuffer.get()),this.m_segmentBuffer.get().reverse(),r=t-2,o=-1,u=this.m_segmentBuffer.get());const c=t-1;for(let e=0;e<c;e++,r+=o)l=s*(r+1),i?(u.queryCoord(l,this.m_dummyPoint),i.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==l&&0!==l&&i.setAttribute(10,i.getPointCount()-1,0,1)):a.push(m>0?1-l:l),this.progress_();l=1,h+=c}(!o||o&&r&&h<2)&&(i?(e.queryEnd(this.m_dummyPoint),i.lineToPoint(this.m_dummyPoint)):a.push(1))}densifyCubicBezier(e,t,s,i,r){const o=new pn;let a=e;const m=e.calculateUpperLength2D();let h=e.getStartXY().compare(e.getEndXY());if(0===h&&m>0){const t=n.makeObjectArray(n.Point2D,4);e.queryControlPoints(t),h=t[1].compare(t[2]),0===h&&(h=t[1].compare(t[0]))}h>0&&(e.copyTo(o),o.reverse(),a=o);let l=0;s&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):r.push(0),++l);const u=[],c=[],g=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve));let d=!0,p=0;if(h>0)for(u.push([a.getStartXY(),a.getControlPoint1(),a.getControlPoint2(),a.getEndXY(),new n.Point2D(0,1)]),c.push(0);u.length;){this.progress_();const e=u.at(-1),o=c.at(-1),m=e[4].x,h=e[4].y;if(o<g&&this.bezierNeedsSplit(e)){d&&(p=a.findMinDeriv(),d=!1);let t=.5*(m+h);Math.abs(p-t)<.4*(h-m)&&(t=p);const s=(t-m)/(h-m),i=e[0].mul(1-s).add(e[1].mul(s)),r=e[1].mul(1-s).add(e[2].mul(s)),l=e[2].mul(1-s).add(e[3].mul(s)),g=i.mul(1-s).add(r.mul(s)),_=r.mul(1-s).add(l.mul(s)),f=g.mul(1-s).add(_.mul(s)),y=e[3];e[1]=i,e[2]=g,e[3]=f,e[4].setCoords(m,t);const x=[f,_,l,y,new n.Point2D(t,h)];u.push(x),c[c.length-1]=o+1,c.push(o+1);continue}u.pop(),c.pop(),(u.length>0||!i||i&&s&&l<2)&&(t?(a.queryCoord(m,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==m&&0!==m&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(1-m),++l)}else for(u.push([a.getStartXY(),a.getControlPoint1(),a.getControlPoint2(),a.getEndXY(),new n.Point2D(0,1)]),c.push(0);u.length;){this.progress_();const e=u.at(-1),o=c.at(-1),m=e[4].x,h=e[4].y;if(o<g&&this.bezierNeedsSplit(e)){d&&(p=a.findMinDeriv(),d=!1);let t=.5*(m+h);Math.abs(p-t)<.4*(h-m)&&(t=p);const s=(t-m)/(h-m),i=e[0].mul(1-s).add(e[1].mul(s)),r=e[1].mul(1-s).add(e[2].mul(s)),l=e[2].mul(1-s).add(e[3].mul(s)),g=i.mul(1-s).add(r.mul(s)),_=r.mul(1-s).add(l.mul(s)),f=g.mul(1-s).add(_.mul(s)),y=e[0];e[0]=f,e[1]=_,e[2]=l,e[4].setCoords(t,h);const x=[y,i,g,f,new n.Point2D(m,t)];u.push(x),c[c.length-1]=o+1,c.push(o+1);continue}u.pop(),c.pop(),(u.length>0||!i||i&&s&&l<2)&&(t?(a.queryCoord(h,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==h&&0!==h&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(h),++l)}}densifyRationalBezier2(e,t,s,i,r){const o=new Ye;let a=e;const m=e.calculateUpperLength2D();let h=e.getStartXY().compare(e.getEndXY());0===h&&m>0&&(h=0),h>0&&(e.copyTo(o),o.reverse(),a=o);let l=0;s&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):r.push(0),++l);const u=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),c=new Ye,g=[],d=[];for(g.push(new n.Envelope1D(0,1)),d.push(0);g.length;){this.progress_();const e=g.at(-1).clone(),o=d.at(-1);if(o<u&&this.rationalBezier2NeedsSplit(a,c,e.vmin,e.vmax)){const t=e.getCenter();h>0?(g.at(-1).vmax=t,g.push(new n.Envelope1D(t,e.vmax))):(g.at(-1).vmin=t,g.push(new n.Envelope1D(e.vmin,t))),d[d.length-1]=o+1,d.push(o+1);continue}if(g.pop(),d.pop(),g.length>0||!i||i&&s&&l<2){const s=h>0?e.vmin:e.vmax;t?(a.queryCoord(s,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==s&&0!==s&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(h>0?1-s:s),++l}}}densifyBezier2(e,t,s,i,r){const o=new Le;let a=e;const m=e.calculateUpperLength2D();let h=e.getStartXY().compare(e.getEndXY());0===h&&m>0&&(h=0),h>0&&(e.copyTo(o),o.reverse(),a=o);let l=0;s&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):r.push(0),++l);const u=Math.ceil(Math.log2(this.m_maxSegmentsPerCurve)),c=new Le,g=[],d=[];for(g.push(new n.Envelope1D(0,1)),d.push(0);g.length;){this.progress_();const e=g.at(-1).clone(),o=d.at(-1);if(o<u&&this.bezier2NeedsSplit(a,c,e.vmin,e.vmax)){const t=e.getCenter();h>0?(g.at(-1).vmax=t,g.push(new n.Envelope1D(t,e.vmax))):(g.at(-1).vmin=t,g.push(new n.Envelope1D(e.vmin,t))),d[d.length-1]=o+1,d.push(o+1);continue}if(g.pop(),d.pop(),g.length>0||!i||i&&s&&l<2){const s=h>0?e.vmin:e.vmax;t?(a.queryCoord(s,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==s&&0!==s&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(h>0?1-s:s),++l}}}densifyEllipticArc(e,t,s,i,r){const o=new Ei;let a=e;const m=e.calculateUpperLength2D();let h=e.getStartXY().compare(e.getEndXY());0===h&&m>0&&(h=e.isClockwise()?0:1),h>0&&(e.copyTo(o),o.reverse(),a=o);let l=0;s&&(t?(e.queryStart(this.m_dummyPoint),t.startPathPoint(this.m_dummyPoint)):r.push(0),++l);const u=Math.trunc(Math.log2(this.m_maxSegmentsPerCurve)),c=new Ei,g=[],d=[];for(g.push(new n.Envelope1D(0,1)),d.push(0);g.length;){this.progress_();const e=g.at(-1).clone(),o=d.at(-1);if(o<u&&this.ellipticArcNeedsSplit(a,c,e.vmin,e.vmax)){const t=e.getCenter();h>0?(g.at(-1).vmax=t,g.push(new n.Envelope1D(t,e.vmax))):(g.at(-1).vmin=t,g.push(new n.Envelope1D(e.vmin,t))),d[d.length-1]=o+1,d.push(o+1);continue}if(g.pop(),d.pop(),g.length>0||!i||i&&s&&l<2){const s=h>0?e.vmin:e.vmax;t?(a.queryCoord(s,this.m_dummyPoint),t.lineToPoint(this.m_dummyPoint),this.m_bSetDensifyFlag&&1!==s&&0!==s&&t.setAttribute(10,t.getPointCount()-1,0,1)):r.push(h>0?1-s:s),++l}}}calculateLengthSubdivisionStep(e,s){const n=e.calculateUpperLength2D();if(!e.isCurve())return n?s/n:1;if(e.getGeometryType()===t.GeometryType.enumEllipticArc){const t=e;if(t.isCircular()||t.isDegenerate(0)||t.isDegenerateToLine()){let e=s/n;return e<this.m_minStep&&(e=this.m_minStep),e}return s/n*t.getSemiAxes().y/t.getSemiAxes().x}e.getGeometryType()===t.GeometryType.enumBezier&&t.throwNotImplementedException(""),t.throwNotImplementedException("")}calculateDeviationSubdivisionStep(e,s){if(!e.isCurve())return 1;if(e.getGeometryType()===t.GeometryType.enumEllipticArc){const t=e;if(t.isDegenerate(0)||t.isDegenerateToLine())return 1;{const n=t.getSemiMajorAxis(),i=1-s/n;let r=Math.PI/2;if(i>0){const e=4*Math.sqrt(s/n*.5);r=Math.min(Math.PI/2,Math.abs(e))}r=Math.max(r,2*Math.PI/this.m_maxSegmentsPerCurve);const o=r*n;return this.calculateLengthSubdivisionStep(e,o)}}t.throwNotImplementedException("")}calculateAngularSubdivisionStep(e,s){if(!e.isCurve())return 1;if(e.getGeometryType()===t.GeometryType.enumEllipticArc){const t=e;return t.isDegenerate(0)||t.isDegenerateToLine()?1:this.calculateLengthSubdivisionStep(e,s*t.getSemiMinorAxis())}t.throwNotImplementedException("")}rationalBezier2NeedsSplit(e,t,s,i){e.cutBezierIgnoreAttributes(s,i,t);let r=!1;if(this.m_maxLength>0&&t.calculateUpperLength2D()>this.m_maxLength)return r=!0,!0;const o=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(o);const a=[0,0,0];return t.queryWeights(a),!r&&this.m_maxDeviation>0&&(r=!Ii.checkRationalBezier2MaxDeviation(o,a,this.m_maxDeviation)),!r&&this.m_maxAngle>0&&(r=!Ii.checkRationalBezier2MaxAngle(o,a,this.m_cosMaxAngle)),r}bezier2NeedsSplit(e,t,s,i){e.cutBezierIgnoreAttributes(s,i,t);let r=!1;if(this.m_maxLength>0&&t.calculateUpperLength2D()>this.m_maxLength)return r=!0,!0;const o=n.makeObjectArray(n.Point2D,3);return t.queryControlPoints(o),!r&&this.m_maxDeviation>0&&(r=!Ii.checkBezier2MaxDeviation(o,this.m_maxDeviation)),!r&&this.m_maxAngle>0&&(r=!Ii.checkBezier2MaxAngle(o,this.m_cosMaxAngle)),r}ellipticArcNeedsSplit(e,t,s,n){e.cutArcIgnoreAttributes(s,n,t);let i=!1;return this.m_maxLength>0&&t.calculateUpperLength2D()>this.m_maxLength?(i=!0,!0):(!i&&this.m_maxDeviation>0&&(i=!Ii.checkEllipticArcMaxDeviation(t,this.m_maxDeviation)),!i&&this.m_maxAngle>0&&(i=!Ii.checkEllipticArcMaxAngle(t,this.m_cosMaxAngle)),i)}bezierNeedsSplit(e){let t=!1;return this.m_maxLength>0&&n.Point2D.distance(e[0],e[1])+n.Point2D.distance(e[1],e[2])+n.Point2D.distance(e[2],e[3])>this.m_maxLength?(t=!0,!0):(!t&&this.m_maxDeviation>0&&(t=!Ii.checkBezierMaxDeviation(e,this.m_maxDeviation)),!t&&this.m_maxAngle>0&&(t=!Ii.checkBezierMaxAngle(e,this.m_cosMaxAngle)),t)}progress_(){}static checkBezierMaxDeviation(e,t){const s=e[3].sub(e[0]);if(s.sqrLength()>0){const i=s.clone();i.leftPerpendicularThis(),i.normalize();const r=i.dotProduct(e[0].sub(e[1])),o=i.dotProduct(e[0].sub(e[2]));if(Math.max(Math.abs(r),Math.abs(o))<=t){const t=new n.Point2D;Ys(e,.5,t,!1);const i=t.sub(e[0]).dotProduct(s);return i>=0&&i<=s.sqrLength()}return!1}return Math.max(e[0].sub(e[1]).sqrLength(),e[0].sub(e[2]).sqrLength())<=t*t}static checkBezierMaxAngle(e,t){if(e[0].equals(e[3]))return!(!e[0].equals(e[1])||!e[1].equals(e[2]));const s=e[3].sub(e[0]);s.normalize();{const n=e[1].sub(e[0]),i=n.dotProduct(s);if(i<0)return!1;if(n.length()*t>i)return!1}{const n=e[2].sub(e[0]),i=n.dotProduct(s);if(i<0)return!1;if(n.length()*t>i)return!1}{const n=e[2].sub(e[1]),i=n.dotProduct(s);if(i<0)return!1;if(n.length()*t>i)return!1}return!0}static checkRationalBezier2MaxDeviation(e,t,s){if(0===t[1])return!1;const n=e[2].sub(e[0]);if(n.sqrLength()>0){const t=n.clone();t.leftPerpendicularThis(),t.normalize();const i=t.dotProduct(e[0].sub(e[1]));if(Math.abs(i)<=s){const t=e[1].sub(e[0]).dotProduct(n);return t>=0&&t<=n.sqrLength()}return!1}return e[0].sub(e[1]).sqrLength()<=s*s}static checkRationalBezier2MaxAngle(e,t,s){if(0===t[1])return!1;if(e[0].equals(e[2]))return!!e[0].equals(e[1]);const n=e[2].sub(e[0]);n.normalize();{const t=e[1].sub(e[0]),i=t.dotProduct(n);if(i<0)return!1;if(t.length()*s>i)return!1}return!0}static checkBezier2MaxDeviation(e,t){const s=e[2].sub(e[0]);if(s.sqrLength()>0){const n=s.clone();n.leftPerpendicularThis(),n.normalize();const i=n.dotProduct(e[0].sub(e[1]));if(Math.abs(i)<=t){const t=e[1].sub(e[0]).dotProduct(s);return t>=0&&t<=s.sqrLength()}return!1}return e[0].sub(e[1]).sqrLength()<=t*t}static checkBezier2MaxAngle(e,t){if(e[0].equals(e[2]))return!!e[0].equals(e[1]);const s=e[2].sub(e[0]);s.normalize();{const n=e[1].sub(e[0]),i=n.dotProduct(s);if(i<0)return!1;if(n.length()*t>i)return!1}return!0}static checkEllipticArcMaxDeviation(e,s){if(Math.abs(e.getSweepAngle())<Math.PI){const i=e.getEndXY().sub(e.getStartXY()),o=[0,0],a=function(e,s,i){t.geometryReleaseAssert(!Ki(e));const o=new r.Transformation2D;o.setRotateAngle(-e.getAxisXRotation());const a=new n.Point2D;o.queryTransform(s,a);const m=Math.atan2(-a.x*e.getMinorMajorRatio(),a.y),h=m+n.pi();let l=Li(e,m),u=Li(e,h);u<l&&(u=n.swap(l,l=u));let c=0;return l>=0&&l<=1&&(i[c++]=l),u>=0&&u<=1&&(i[c++]=u),c}(e,i,o);if(1===a){const t=e.getCoord2D(o[0]),i=n.Point2D.getClosestCoordinate(e.getStartXY(),e.getEndXY(),t),r=new n.Point2D;return n.lerpPoint2D(e.getStartXY(),e.getEndXY(),i,r),n.Point2D.distance(t,r)<=s}}const i=e.getCoord2D(.5),o=new n.Point2D;return n.lerpPoint2D(e.getEndXY(),e.getStartXY(),.5,o),n.Point2D.distance(i,o)<=s}static checkEllipticArcMaxAngle(e,t){const s=e.getTangent(0),n=e.getTangent(1),i=s.dotProduct(n);return!(i<0||s.length()*n.length()*t>i)}static checkTypeForReplace(e,s){return e.getGeometryType()===s&&(s!==t.GeometryType.enumEllipticArc||e.isCircular())}}function wi(e,t,s){const i=s.length;if(t<=0||i<=2)return i;let r=0;const o=n.makePrimitiveArray(i-1,Number.NaN);for(let t=1,n=i;t<n;t++){const n=e.tToLength(s[t]);o[t-1]=n-r,r=n}for(;o.length>1;){const e=o.findIndex(e=>e<=2*t);if(-1===e)break;let n=e+1,i=e+1;if(e>0){const t=e-1;(i===o.length||o[t]>o[i])&&(i=t,n--)}o[i]+=o[e],o.splice(e,1),s.splice(n,1)}return s.length}function Ti(e,t,n,i,r){const o=[],a=[],m=bi(t,n,0,i,!1,o,a),h=new pn;let l=r;const u=t.getDescription();h.assignVertexDescription(u);const c=u.getAttributeCount()>1,g=new s.Point,d=new Gr;for(let s=0,n=0;s<m;s++){if(o[n+1].isNAN()){if(c){let e=a[s];t.queryCoord(e,g),d.setStart(g),e=a[s+1],t.queryCoord(e,g),d.setEnd(g)}d.setStartXY(o[n]),d.setEndXY(o[n+3]),e.addSegment(d,l)}else{if(c){let e=a[s];t.queryCoord(e,g),h.setStart(g),e=a[s+1],t.queryCoord(e,g),h.setEnd(g)}h.setStartXY(o[n]),h.setControlPoint1(o[n+1]),h.setControlPoint2(o[n+2]),h.setEndXY(o[n+3]),e.addSegment(h,l)}n+=3,l=!1}}function Ai(e,i,r,o,a){const m=[],h=[],l=function(e,s,i,r,o,a,m){a&&(a.length=0),m&&(m.length=0);const h=e.getGeometryType();if(h===t.GeometryType.enumLine)return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY())),m&&(m.push(0),m.push(1)),1;if(h===t.GeometryType.enumBezier2){const t=n.makePrimitiveArray(9,Number.NaN);let s=e.getMonotonicPartParams(t.length,t);if(t.length=s,s=wi(e,0,t),m&&m.splice(0,0,...t.slice(0,s)),a){const n=new Mr;for(let i=1;i<s;i++){const s=t[i-1],r=t[i];e.queryCut(s,r,n,!0);const o=n.get();Mt(o),1===i&&a.push(o.getStartXY()),a.push(o.getControlPoint1()),a.push(o.getEndXY())}}return s-1}if(h===t.GeometryType.enumEllipticArc){const t=e;if(t.isDegenerateToLine()||t.isDegenerate(0))return a&&(a.push(e.getStartXY()),a.push(n.Point2D.getNAN()),a.push(e.getEndXY())),m&&(m.push(0),m.push(1)),1;if(!t.isMonotoneQuickAndDirty()){const i=n.makePrimitiveArray(6,Number.NaN);let r=t.getMonotonicPartParams(i.length,i);i.length=r,r=wi(e,0,i);let o=0;if(r>2){const e=new Mr,n=m||[];for(let h=1;h<r;h++){const l=i[h-1],u=i[h];t.queryCut(l,u,e,!0);const c=n.length;o+=Ri(1===h,e.get(),s,0,0,a,m);const g=h===r-1,d=i[h-1],p=e.get().getSweepAngle()/t.getSweepAngle();for(let e=c,s=n.length;e<s;e++)if(n[e]=!g||e+1<s?d+n[e]*p:1,a){const s=2*e,i=t.getCoord2D(n[e]);a[s].setCoordsPoint2D(i),s>0&&Rt(a.slice(s-2))}}return o}}return Ni(!0,t,s,0,r,a,m)}if(h===t.GeometryType.enumBezier){const t=e;if(!t.isMonotoneQuickAndDirty()){const i=n.makePrimitiveArray(6,Number.NaN);let r=t.getMonotonicPartParams(i.length,i);i.length=r,r=wi(e,0,i);let o=0;if(r>2){const e=new Mr,n=m||[];for(let h=1;h<r;h++){const l=i[h-1],u=i[h];t.queryCut(l,u,e,!0);const c=n.length;o+=ki(1===h,e.get(),s,0,0,a,m);const g=h===r-1,d=i[h-1];for(let e=c,s=n.length;e<s;e++)if(n[e]=!g||e+1<s?d+n[e]:1,a){const s=2*e,i=t.getCoord2D(n[e]);a[s].setCoordsPoint2D(i),s>0&&Rt(a.slice(s-2))}}return o}}return ki(!0,t,s,0,0,a,m)}if(h===t.GeometryType.enumRationalBezier2){const t=e;if(!t.isMonotoneQuickAndDirty()){const i=n.makePrimitiveArray(6,Number.NaN);let r=t.getMonotonicPartParams(i.length,i);i.length=r,r=wi(e,0,i);let o=0;if(r>2){const e=new Mr,n=m||[];for(let h=1;h<r;h++){const l=i[h-1],u=i[h];t.queryCut(l,u,e,!0);const c=n.length;o+=Gi(1===h,e.get(),s,0,0,a,m);const g=h===r-1,d=i[h-1];for(let e=c,s=n.length;e<s;e++)if(n[e]=!g||e+1<s?d+n[e]:1,a){const s=2*e,i=t.getCoord2D(n[e]);a[s].setCoordsPoint2D(i),s>0&&Rt(a.slice(s-2))}}return o}}return Gi(!0,t,s,0,0,a,m)}t.throwNotImplementedException("")}(i,r,0,o,0,m,h),u=new Le;let c=a;const g=i.getDescription();u.assignVertexDescription(g);const d=g.getAttributeCount()>1,p=new s.Point,_=new Gr;for(let t=0,s=0;t<l;t++){if(m[s+1].isNAN()){if(d){let e=h[t];i.queryCoord(e,p),_.setStart(p),e=h[t+1],i.queryCoord(e,p),_.setEnd(p)}_.setStartXY(m[s]),_.setEndXY(m[s+2]),e.addSegment(_,c)}else{if(d){let e=h[t];i.queryCoord(e,p),u.setStart(p),e=h[t+1],i.queryCoord(e,p),u.setEnd(p)}u.setStartXY(m[s]),u.setControlPoint1(m[s+1]),u.setEndXY(m[s+2]),e.addSegment(u,c)}s+=2,c=!1}}function Ni(e,t,s,o,a,m,h,l){const u=t.clone();u.dropAllAttributes();const c=(e,t,s,i)=>(t&&(e&&t.push(i.getStartXY()),t.push(n.Point2D.getNAN()),t.push(n.Point2D.getNAN()),t.push(i.getEndXY())),s&&(e&&s.push(0),s.push(1)),1);if(u.isDegenerateToLine()||u.isDegenerate(0))return c(e,m,h,t);const g=u.getStartXY(),d=u.getEndXY(),p=u.getSemiAxes(),_=new r.Transformation2D;if(u.isCircular())_.setIdentity();else{const e=u.getAxisXRotation();_.setScaleCoords(1,u.getMinorMajorRatio()),_.rotateAngle(e)}const f=u.getCenter();_.shift(f);const y=_.clone();y.invertThis(),u.applyTransformation(y);const x=u.getSweepAngle();if(0===x)return c(e,m,h,t);const P=i.Envelope2D.constructEmpty();P.setCoords({center:f,width:2*p.x,height:2*p.x});const E=.05*P.calculateToleranceFromEnvelope(),v=Math.max(s/p.x,E/p.x);let C=4*Math.pow(v/.0741,1/6);C=Math.min(C,Math.PI/2);const D=yi(u.getStartAngle());let b=x>0?Math.floor(D/C):Math.ceil(D/C);b*=C;const S=x>0?C:-C;b+S===D&&(b+=S);let I=4/3*Math.tan(Math.abs(C)/4);x>0&&(I=-I),h&&e&&h.push(0);const w=C/Math.abs(x);let T=(b-D)/x;const A=g.clone(),N=new n.Point2D;u.queryCoord2D(0,N);const G=N.clone(),M=1-.01*w;let R=0,k=0;for(;T<1;){let s;if(T+=w,k>0&&T<M)s=I;else{T>=M&&(T=1);const e=(T-k)*x;s=4/3*Math.tan(Math.abs(e)/4),x>0&&(s=-s)}u.queryCoord2D(T,N);const i=new n.Point2D;_.queryTransform(N,i);const r=t.getClosestCoordinate(i,!1);if(t.queryCoord2D(r,i),1!==T&&(n.Point2D.distance(A,i)<=2*o||n.Point2D.distance(i,d)<=2*o))continue;A.setCoordsPoint2D(i);const l=n.makeObjectArray(n.Point2D,4);l[0].assign(G),l[3].assign(N),l[1].rightPerpendicularOther(G),l[1].scaleAddThis(s,G),l[2].leftPerpendicularOther(N),l[2].scaleAddThis(s,N),_.transformPoints2D(l,3,l),l[3].assign(i),0===k&&l[0].setCoordsPoint2D(g),1===T&&l[3].setCoordsPoint2D(d),a&&qs(l);let c=!0;for(let e=1;e<4;e++)if(!l[e].isEqualPoint2D(l[0])){c=!1;break}c||(h&&h.push(r),m&&(0===k&&e&&m.push(l[0].clone()),m.push(l[1].clone()),m.push(l[2].clone()),m.push(l[3].clone())),R++),k=T,G.setCoordsPoint2D(N)}return R}function Gi(e,t,s,r,o,a,m,h){t.clone().dropAllAttributes();const l=new i.Envelope2D;t.queryLooseEnvelope(l);const u=.05*l.calculateToleranceFromEnvelope(),c=Math.max(s,u);m&&e&&m.push(0);let g=0;const d=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(d);const p=[0,0,0];t.queryWeights(p);const _=[],f=n.makePrimitiveArray(9,Number.NaN);let y=t.getMonotonicPartParams(f.length,f);f.length=y,y=wi(t,r,f);let x=0,P=e;for(let e=1;e<y;e++){const t=f[e];for(_.push(x),_.push(t);_.length>1;){const e=_.at(-1);_.pop();const t=_.at(-1),s=n.makeObjectArray(n.Point2D,3);zn(d,p,e,t,s,[0,0,0]);const i=n.makeObjectArray(n.Point2D,3),r=Ut(s,p,i),o=16,h=_.length>o;c>=r||h?(m.push(t),a&&(P&&(a.push(i[0]),P=!1),a.push(i[1]),a.push(i[2])),g++):(_.push(.5*(e+t)),_.push(e))}x=t}return g}function Mi(e,t,s,r,o,a,m,h){t.clone().dropAllAttributes();const l=new i.Envelope2D;t.queryLooseEnvelope(l);const u=.05*l.calculateToleranceFromEnvelope(),c=Math.max(s,u);m&&e&&m.push(0);let g=0;const d=n.makeObjectArray(n.Point2D,3);t.queryControlPoints(d);const p=[0,0,0];t.queryWeights(p);const _=[],f=n.makePrimitiveArray(9,Number.NaN);let y=0;o?(y=t.getMonotonicPartParams(f.length,f),f.length=y,y=wi(t,r,f)):(f.length=2,y=2,f[0]=0,f[1]=1);let x=0,P=e;for(let e=1;e<y;e++){const t=f[e];for(_.length=0,_.push(t),_.push(x);_.length>1;){const e=_.at(-1);_.pop();const t=_.at(-1),s=n.makeObjectArray(n.Point2D,3),i=[0,0,0];zn(d,p,e,t,s,i);const r=n.makeObjectArray(n.Point2D,4),o=Un(s,i,r),h=16,l=_.length>h;c>=o||l?(m.push(t),a&&(P&&(a.push(r[0]),P=!1),a.push(r[1]),a.push(r[2]),a.push(r[3])),g++):(_.push(.5*(e+t)),_.push(e))}x=t}return g}function Ri(e,t,s,o,a,m,h,l){const u=t.clone();if(u.dropAllAttributes(),u.isDegenerateToLine()||0===u.getSweepAngle())return m&&(e&&m.push(t.getStartXY()),m.push(n.Point2D.getNAN()),m.push(t.getEndXY())),h&&(e&&h.push(0),h.push(1)),1;const c=u.getStartXY(),g=u.getEndXY(),d=u.getSemiAxes(),p=new r.Transformation2D;if(u.isCircular())p.setIdentity();else{const e=u.getAxisXRotation();p.setScaleCoords(1,u.getMinorMajorRatio()),p.rotateAngle(e)}const _=u.getCenter();p.shift(_);const f=p.clone();f.invertThis(),u.applyTransformation(f);const y=i.Envelope2D.constructEmpty();y.setCoords({center:_,width:2*d.x,height:2*d.x});const x=.05*y.calculateToleranceFromEnvelope(),P=Math.max(s/d.x,x/d.x),E=Math.sqrt(2*P+P*P);let v=2*Math.sqrt(2*E*(1+P-E));v=Math.min(v,Math.PI/2);const C=u.getSweepAngle(),D=Math.ceil(Math.abs(C)/v),b=Math.max(D,1);v=C/b;const S=1/b;let I=Math.tan(Math.abs(v)/2);C>0&&(I=-I),h&&e&&h.push(0);const w=new n.Point2D;u.queryCoord2D(0,w);for(let t=0;t<b;t++){const s=w.clone(),i=(t+1)*S;if(h&&h.push(i),!m)continue;u.queryCoord2D(i,w);const r=n.makeObjectArray(n.Point2D,3);r[0].assign(s),r[2].assign(w),r[1].rightPerpendicularOther(r[0]),r[1].mulThis(I),r[1].addThis(r[0]),p.transformPoints2D(r,3,r),0===t&&r[0].setCoordsPoint2D(c),t===b-1&&r[2].setCoordsPoint2D(g),0===t&&e&&m.push(r[0]),m.push(r[1]),m.push(r[2])}return b}function ki(e,t,s,r,o,a,m,h){t.clone().dropAllAttributes();const l=new i.Envelope2D;t.queryLooseEnvelope(l);const u=.05*l.calculateToleranceFromEnvelope(),c=Math.max(s,u);m&&e&&m.push(0);let g=0;const d=n.makeObjectArray(n.Point2D,4);t.queryControlPoints(d);const p=[],_=n.makePrimitiveArray(9,Number.NaN);let f=t.getMonotonicPartParams(_.length,_);_.length=f,f=wi(t,r,_);let y=0,x=e;for(let e=1;e<f;e++){const t=_[e];for(p.push(y),p.push(t);p.length>1;){const e=p.at(-1);p.pop();const t=p.at(-1),s=n.makeObjectArray(n.Point2D,4);Os(d,e,t,s);const i=n.makeObjectArray(n.Point2D,3),r=zt(s,i),o=16,h=p.length>o;c>=r||h?(m.push(t),a&&(x&&(a.push(i[0]),x=!1),a.push(i[1]),a.push(i[2])),g++):(p.push(.5*(e+t)),p.push(e))}y=t}return g}class Fi{constructor(e,t){this.m_arc=e,this.m_sqrChordLength=t}getMaxDerivative(){return 1}getValue(e,t){return 0===e?n.Point2D.sqrDistance(this.m_arc.getCoord2D(t),this.m_arc.getCoord2D(1-t))-this.m_sqrChordLength:0}getError(e){return 0}}function qi(e,t){return e.convertToCanonic(t)}function Vi(e,t,s,i){let r=e.m_startAngle,o=e.m_sweepAngle;const a=1e-12;for(;r>n.pi();)r-=2*n.pi();for(;r<=-n.pi();)r+=2*n.pi();if(!Number.isNaN(t)){for(;t>n.pi();)t-=2*n.pi();for(;t<=-n.pi();)t+=2*n.pi();!s&&t>r&&(t-=2*n.pi()),s&&t<r&&(t+=2*n.pi()),o=t-r,Math.abs(o)<a&&!i&&(o=s?2*n.pi():-2*n.pi()),Math.abs(o)>2*n.pi()-a&&i&&(o=0)}Math.abs(o)>2*n.pi()-a&&(o=o>=0?2*n.pi():-2*n.pi(),e.setEndXY(e.getStartXY())),Math.abs(o)<a&&(o=0,e.setEndXY(e.getStartXY())),i=Math.abs(o)<=n.pi(),o&&(s=o>0),e.m_startAngle=Hi(r),e.m_sweepAngle=o,or(e,!i),ir(e,s)}function Hi(e){let t=e,s=!1;return t<=-n.pi()?(t+=n.twoPi(),s=!0):t>n.pi()&&(t-=n.twoPi(),s=!0),t<=-n.pi()?(t=n.fmod(t,n.twoPi()),t<=-n.pi()&&(t+=n.twoPi()),s=!0):t>n.pi()&&(t=n.fmod(t,n.twoPi()),t>n.pi()&&(t-=n.twoPi()),s=!0),s&&(t>n.pi()||t<=-n.pi())&&(t=n.pi()),t}function Oi(e,t,s){const i=s,r=i.getSemiAxes();let o=new n.Point2D(r.x*Math.cos(e[0]),r.y*Math.sin(e[0]));return o=i.convertFromCanonic(o),n.Point2D.sqrDistance(o,i.getStartXY())}function Yi(e,t,s){const i=s,r=i.getSemiAxes(),o=e[0]+i.getStartAngle();let a=new n.Point2D(r.x*Math.cos(o),r.y*Math.sin(o));return a=i.convertFromCanonic(a),n.Point2D.sqrDistance(a,i.getEndXY())}function Xi(e){if(e.m_center.isNAN())return e.m_startAngle=0,void(e.m_sweepAngle=0);const t=e.getStartXY(),s=e.getEndXY(),i=t.equals(s),r=ar(e),o=rr(e),a=e.projectionBehavior();if(i){const s=e.convertToCanonic(t),i=new n.Point2D(e.m_semiMajorAxis,e.m_semiMajorAxis*e.m_minorMajorRatio);s.x/=i.x,s.y/=i.y,e.m_startAngle=Hi(Math.atan2(s.y,s.x)),e.m_sweepAngle=r?o?n.twoPi():-n.twoPi():0}else{const i=e.convertToCanonic(t),m=new n.Point2D(e.m_semiMajorAxis,e.m_semiMajorAxis*e.m_minorMajorRatio);i.x/=m.x,i.y/=m.y;const h=e.convertToCanonic(s);h.x/=m.x,h.y/=m.y,e.m_startAngle=Math.atan2(i.y,i.x),e.m_sweepAngle=n.Point2D.calculateAngle(i,h),o?e.m_sweepAngle<0&&(e.m_sweepAngle+=n.twoPi()):e.m_sweepAngle>0&&(e.m_sweepAngle-=n.twoPi()),e.m_startAngle=Hi(e.m_startAngle);let l=Oi([e.m_startAngle],0,e);if(l=Math.sqrt(l),l>.25*V(e)){const t=e.m_startAngle-1e-4,s=e.m_startAngle+1e-4,n=[0];Se(Oi,e,1,[e.m_startAngle],[t],[s],0,n),e.m_startAngle=Hi(n[0])}if(l=Yi([e.m_sweepAngle],0,e),l=Math.sqrt(l),l>.25*V(e)){const t=e.m_sweepAngle-1e-4,s=e.m_sweepAngle+1e-4,n=[0];Se(Yi,e,1,[e.m_sweepAngle],[t],[s],0,n),e.m_sweepAngle=n[0]}const u=Math.abs(e.m_sweepAngle)>n.pi();if(or(e,u),r!==u&&!r&&Math.abs(e.m_sweepAngle)>1.5*n.pi())return void Qi(e,t,s,a);if(0===e.m_sweepAngle||o!==e.m_sweepAngle>0)return void Qi(e,t,s,a)}}function Li(e,t){const s=function(e,t){const s=new n.Envelope1D(e.getStartAngle(),e.getEndAngle());s.normalize();const i=n.twoPi(),r=n.fmod(t,i);if(r<s.vmin){let e=r+i;for(;e<s.vmin;)e+=i;return s.containsCoordinate(e)?e:s.vmin-r<e-s.vmax?r:e}if(r>s.vmax){let e=r-i;for(;e>s.vmax;)e-=i;return s.containsCoordinate(e)||s.vmin-e<r-s.vmax?e:r}return r}(e,t);return(s-e.getStartAngle())/e.getSweepAngle()}function Bi(e,t){return e.m_startAngle+t*e.m_sweepAngle}function zi(e,t,s){s.assign(new n.ECoordinate(e.m_startAngle).addE(t.mulE(new n.ECoordinate(e.m_sweepAngle))))}function Ui(e){return e.m_cachedValues}function ji(e){if(e.m_cachedValues)return e.m_cachedValues;const t={e2:0,completeE:0};return t.e2=function(e){return 1-n.sqr(e.m_minorMajorRatio)}(e),t.completeE=n.completeEllipticE(t.e2),e.m_cachedValues=t,t}function Wi(e,t,s,i){if(!t.isEqual(e.m_XStart,e.m_YStart)||!s.isEqual(e.m_XEnd,e.m_YEnd)){if(Ki(e))return e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=s.x,e.m_YEnd=s.y,pr(e),void e.afterCompletedModification();if(i&&Math.abs(e.getSweepAngle())<=1.01*n.halfPi()){const i=n.makeObjectArray(n.Point2D,3),r=ur(e,i);if(Yn(i)){if(i[0].assign(t),i[2].assign(s),Ln(i),0===e.projectionBehavior()){let t=0,s=2;n.Point2D.sqrDistance(i[1],i[0])<n.Point2D.sqrDistance(i[1],i[2])&&(s=n.swap(t,t=s));const r=i[s].sub(i[t]),o=r.length();r.divThis(o);const a=i[1].sub(i[t]),m=a.length(),h=a.dotProduct(r)/m,l=a.crossProduct(r)/m,u=new n.Point2D;n.lerpPoint2D(i[t],i[s],.5,u);const c=.5*o/l*n.snap(1-h,0,1),g=i[1].side(i[t],i[s]),d=r.clone();g?d.leftPerpendicularThis():d.rightPerpendicularThis();const p=u.sub(d.mul(c));e.constructCircularArcThreePoint(i[0],i[2],p)}else cr(i,r*r,null,!1,e);return}}0===e.projectionBehavior()?function(e,t,s){const i=e.getStartXY(),o=e.getEndXY(),a=i.equals(o),m=t.equals(s);if(!a&&!m){const a=new r.Transformation2D;a.setShiftCoords(-e.m_XStart,-e.m_YStart);const m=n.Point2D.distance(t,s),h=n.Point2D.distance(i,o),l=m/h;a.scale(l,l);const u=o.sub(i);u.divThis(h);const c=s.sub(t);c.divThis(m);const g=u.crossProduct(c),d=c.dotProduct(u);return a.rotate(d,g),a.shiftCoords(t.x,t.y),void er(e,a,!0,t,s)}const h=new n.Point2D;if(e.queryCoord2D(.5,h),m){if(a){const n=e.m_center.add(t.sub(i));e.constructEllipticArcEndPointsCenter(t,s,e.getSemiMajorAxis(),1,0,!0,!e.isClockwise(),n),e.setProjectionBehavior(0)}else if(e.isMajor()){const n=h.sub(t).getUnitVector().mul(2*e.getSemiMajorAxis()).add(t);e.constructCircularArcThreePoint(t,s,n)}else e.constructCircularArcThreePoint(t,s,t);return}const l=t.add(s).mul(.5),u=s.sub(t);u.rightPerpendicularThis();const c=l.add(u),g=n.Point2D.getClosestCoordinate(l,c,e.getCenter(),!0),d=new n.Point2D;n.lerpPoint2D(l,c,g,d);const p=n.Point2D.distance(t,d);e.constructEllipticArcEndPointsCenter(t,s,p,1,0,!0,!e.isClockwise(),d),e.setProjectionBehavior(0)}(e,t,s):vr(e,t,s)}}function Zi(e,t,s,n,i,r,o,a,m){return e.m_bits=0,e.m_rotation=r,I(e,t),T(e,s),e.m_cosr=Math.cos(r),e.m_sinr=Math.sin(r),or(e,o),ir(e,a),void 0!==m?e.m_center.assign(m):e.m_center.setNAN(),e.setProjectionBehavior(1),e.m_semiMajorAxis=n,e.m_minorMajorRatio=i,lr(e,void 0===m)}function Qi(e,t,s,n){e.m_bits=0,e.m_rotation=0,I(e,t),T(e,s),e.m_interior.assign(t.add(s).mul(.5)),e.m_startAngle=0,e.m_sweepAngle=0,e.m_cosr=1,e.m_sinr=0,or(e,!1),ir(e,!1),e.m_center.setNAN(),e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.setProjectionBehavior(n),e.afterCompletedModification()}function Ki(e){return e.m_center.isNAN()}function $i(e,t){if(0===t)return 0;const s=ji(e),i=Bi(e,t),r=n.halfPi(),o=Ji(e),a=n.ellipticE(i+r,s.e2,s.completeE),m=e.m_semiMajorAxis*(a-o);return Math.abs(m)}function Ji(e){const t=ji(e);return n.ellipticE(e.getStartAngle()+n.halfPi(),t.e2,t.completeE)}function er(e,s,i,r,o){if(2===s.m_TransformationType)return void t.geometryReleaseAssert(0);if(t.geometryReleaseAssert(!mr(e)),s.isIdentity()&&(!r||r.equals(e.getStartXY())&&o.equals(e.getEndXY())))return;nr(e);let a=n.Point2D.getNAN(),m=n.Point2D.getNAN();if(null===r?(a.x=e.m_XStart,a.y=e.m_YStart,s.transformInPlace(a),m.x=e.m_XEnd,m.y=e.m_YEnd,s.transformInPlace(m)):(a=r,m=o),Ki(e))return e.m_XStart=a.x,e.m_YStart=a.y,e.m_XEnd=m.x,void(e.m_YEnd=m.y);const h=e.m_center.clone();if(s.transformInPlace(h),i||s.isUniformNoRotation()){let t=rr(e);if(s.isReflective()&&(t=!t),0===e.projectionBehavior()){if(!a.equals(m)){const t=e.m_interior.clone();return s.transformInPlace(t),void e.constructCircularArcThreePoint(a,m,t)}return void tr(e,a,m,h,t,!1)}const i=new n.Point2D(e.m_cosr,e.m_sinr);s.transformWithoutTranslateInPlace(i);const r=Math.atan2(i.y,i.x),o=e.getSemiAxes();s.transformWithoutTranslateInPlace(o);const l=e.m_center.clone();return s.transformInPlace(l),void e.constructEllipticArcEndPointsCenter(a,m,o.x,o.y/o.x,r,e.isMajor(),t,l)}{{const t=new Array(4);!function(e,t){const s=new n.ECoordinate(e.m_cosr).sqrThis(),i=new n.ECoordinate(e.m_sinr).sqrThis(),r=new n.ECoordinate(e.m_minorMajorRatio),o=new n.ECoordinate(1/e.m_minorMajorRatio),a=r.mulE(s).addThisE(o.mulE(i)),m=r.subE(o).mulThis(2*e.m_cosr*e.m_sinr),h=r.mulE(i).addThisE(o.mulE(s));t[0]=a,t[1]=m,t[2]=h,t[3]=new n.ECoordinate(-e.m_semiMajorAxis).mulThis(e.m_semiMajorAxis).mulThis(e.m_minorMajorRatio)}(e,t);const i=new x;if(i.a11.setE(t[0]),i.a12.setE(t[1]),i.a12.mulThisByPower2(.5),i.a21.setE(i.a12),i.a22.setE(t[2]),!i.det().isZero()){const r=new x;if(r.a11.set(s.xx),r.a12.set(s.xy),r.a21.set(s.yx),r.a22.set(s.yy),r.invertThis()){const o=r.clone();o.transposeThis();const l=i.clone();if(l.mulThis(r),l.mulLeftThis(o),!l.det().isZero()){const i=n.makeObjectArray(n.ECoordinate,4);i[0].setE(l.a11),i[1].setE(l.a12),i[1].mulThisByPower2(2),i[2].setE(l.a22),i[3].setE(t[3]);const r=n.Point2D.getNAN(),o=function(e,t){const s=new x;s.a11.setE(e[0]),s.a12=n.ECoordinate.st_mulByPower2(e[1],.5),s.a21.setE(s.a12),s.a22.setE(e[2]);const i=[n.Point2D.getNAN(),n.Point2D.getNAN()],r=[new n.ECoordinate,new n.ECoordinate];s.eigenSymmetric(r,i);const o=e[3].clone();return o.negateThis(),o.invThis(),r[0].mulThisE(o),r[1].mulThisE(o),r[0].sqrtThis().invThis(),r[1].sqrtThis().invThis(),t.x=r[0].toDouble(),t.y=r[1].toDouble(),Math.atan2(i[0].y,i[0].x)}(i,r);let u=rr(e);return s.isReflective()&&(u=!u),void e.constructEllipticArcEndPointsCenter(a,m,r.x,r.y/r.x,o,e.isMajor(),u,h)}}}}const t=[n.Point2D.getNAN(),n.Point2D.getNAN(),n.Point2D.getNAN()];t[0].setCoords(e.getSemiMajorAxis(),0),t[0].rotateDirect(e.m_cosr,e.m_sinr),t[1].setCoords(e.getSemiMajorAxis(),e.getSemiMinorAxis()),t[1].rotateDirect(e.m_cosr,e.m_sinr),t[2].setCoords(0,e.getSemiMinorAxis()),t[2].rotateDirect(e.m_cosr,e.m_sinr);let i=e.isClockwise();i&&(t[2]=n.swap(t[0],t[0]=t[2]));const r=.5;s.transformWithoutTranslateArray(t,3,t),s.isReflective()&&(i=!i);const o=new n.Point2D(0,0),l=e.createInstance();cr(t,r,o,!1,l),e.constructEllipticArcEndPointsCenter(a,m,l.getSemiMajorAxis(),l.getMinorMajorRatio(),l.getAxisXRotation(),e.isMajor(),!i,h)}}function tr(e,t,s,n,i,r){const o=.5*(n.sub(t).length()+n.sub(s).length());e.m_center.assign(n),e.m_startAngle=Math.atan2(t.y-e.m_center.y,t.x-e.m_center.x),Vi(e,Math.atan2(s.y-e.m_center.y,s.x-e.m_center.x),i,r);const a=e.constructEllipticArcEndPointsCenter(t,s,o,1,0,Math.abs(e.m_sweepAngle)>Math.PI,e.m_sweepAngle>0,n);return e.setProjectionBehavior(0),a}function sr(e,t){e.m_cachedValues=t}function nr(e){e.m_cachedValues=null}function ir(e,t){const s=t?1:0;e.m_bits=-2&e.m_bits|s}function rr(e){return!!(1&e.m_bits)}function or(e,t){const s=t?1:0;e.m_bits=-3&e.m_bits|s<<1}function ar(e){return!!(2&e.m_bits)}function mr(e){return!!(8&e.m_bits)}function hr(e){e.m_bits&=-9}function lr(e,s){hr(e);const i=e.getStartXY(),r=e.getEndXY();let o=!1;const a=ar(e),m=rr(e),h=e.projectionBehavior(),l=i.equals(r);let u=0===e.m_minorMajorRatio||0===e.m_semiMajorAxis;if(Number.isNaN(e.m_minorMajorRatio)&&(0===e.m_semiMajorAxis?e.m_minorMajorRatio=1:t.throwCorruptedGeometryException("NAN minor major ratio and non-zero major axis")),u||=s?l:e.m_center.isNAN(),u)return Qi(e,i,r,h),!0;e.m_semiMajorAxis=Math.abs(e.m_semiMajorAxis),e.m_minorMajorRatio=Math.abs(e.m_minorMajorRatio),e.m_minorMajorRatio>1&&(e.m_semiMajorAxis*=e.m_minorMajorRatio,e.m_minorMajorRatio=1/e.m_minorMajorRatio);const c=new n.Point2D(e.m_semiMajorAxis,e.m_semiMajorAxis*e.m_minorMajorRatio);if(t.geometryReleaseAssert(c.y>0&&c.x>=c.y),l){const s=e.convertToCanonic(i);t.geometryReleaseAssert(!c.isZero()),s.x/=c.x,s.y/=c.y;const r=Math.sqrt(n.sqr(s.x)+n.sqr(s.y));if(o=1!==r,e.m_semiMajorAxis*=r,c.mulThis(r),e.m_startAngle=Hi(Math.atan2(s.y,s.x)),!a)return e.m_interior.assign(i),e.m_sweepAngle=0,e.afterCompletedModification(),o;e.m_sweepAngle=m?n.twoPi():-n.twoPi()}else{let t=e.m_center.isNAN()||function(e){if(e.m_center.isNAN())return!1;const t=new y;t.setWithEps(e.getStartXY(),8),t.subThisE((new y).setWithEps(e.m_center,8));const s=new n.ECoordinate;s.setWithEps(e.m_rotation,8);const i=new n.ECoordinate,r=new n.ECoordinate;n.ECoordinate.st_cosAndSin(s,i,r),t.rotateReverse(i,r);const o=new y;o.setWithEps(e.getEndXY()),o.subThisE(y.constructPoint2D(e.m_center)),o.rotateReverse(i,r);const a=new n.ECoordinate;a.setWithEps(e.m_semiMajorAxis,8);const m=a.clone(),h=new n.ECoordinate;h.setWithEps(e.m_minorMajorRatio),m.mulThisE(h),t.x.divThisE(a),t.y.divThisE(m),o.x.divThisE(a),o.y.divThisE(m);const l=t.x.sqr().addThisE(t.y.sqr()).subThisE(n.s_one),u=o.x.sqr().addThisE(o.y.sqr()).subThisE(n.s_one);return!l.isZero()||!u.isZero()}(e);if(!t){const s=e.convertToCanonic(i);s.x/=c.x,s.y/=c.y;const o=new n.Point2D(1,0);e.m_startAngle=n.Point2D.calculateAngle(o,s);const a=e.convertToCanonic(r);a.x/=c.x,a.y/=c.y,e.m_sweepAngle=n.Point2D.calculateAngle(s,a),t=!gr(e)}if(t){o=!0;const t=i.sub(r).mulThis(.5);t.rotateReverse(e.m_cosr,e.m_sinr);let s=n.sqr(t.x/c.x)+n.sqr(t.y/c.y);s>1&&(s=Math.sqrt(s),e.m_semiMajorAxis*=s,c.mulThis(s));const h=new n.Point2D(0,0);{const e=c.x*c.x,s=c.y*c.y,n=e*t.y*t.y+s*t.x*t.x,i=e*s-n;if(i>0){const e=Math.sqrt(i/n);h.setCoords(c.x*t.y/c.y,-c.y*t.x/c.x),h.mulThis(e),a===m&&h.negateThis()}}{const t=new n.Point2D(h.x,h.y);t.rotateDirect(e.m_cosr,e.m_sinr),t.addThis(i.add(r).mulThis(.5)),e.m_center.assign(t)}}if(Xi(e),!gr(e))return Qi(e,i,r,h),!0}return pr(e),e.afterCompletedModification(),o}function ur(e,s){t.geometryReleaseAssert(Math.abs(e.getSweepAngle())<15*Math.PI/16);const i=e.getSemiMajorAxis(),r=e.getSemiMinorAxis();let o;if(0===i)return s[0].setCoordsPoint2D(e.getStartXY()),s[1].setCoordsPoint2D(e.getStartXY()),s[2].setCoordsPoint2D(e.getStartXY()),o=1,o;if(0===r)return s[0].setCoordsPoint2D(e.getStartXY()),s[2].setCoordsPoint2D(e.getEndXY()),s[1]=n.Point2D.lerp(s[0],s[2],.5),o=1,o;const a=e.getSweepAngle(),m=e.getStartAngle(),h=m+a,l=new n.Point2D(-i*Math.sin(m),r*Math.cos(m)),u=new n.Point2D(-i*Math.sin(h),r*Math.cos(h));l.normalize(),u.normalize(),l.rotateDirect(e.m_cosr,e.m_sinr),u.rotateDirect(e.m_cosr,e.m_sinr),s[0].setCoordsPoint2D(e.getStartXY()),s[2].setCoordsPoint2D(e.getEndXY()),s[1].setSub(s[2],s[0]);const c=l.crossProduct(u);return s[1].assign(l.mul(s[1].crossProduct(u)/c)),s[1].addThis(s[0]),o=Math.cos(.5*a),o}function cr(e,s,i,r,o){if(r){const t=.5,i=Math.sqrt(s),r=n.sqr(1-t)+2*i*t*(1-t)+n.sqr(t),a=e[0].mul(n.sqr(1-t)).add(e[1].mul(2*i*t*(1-t))).add(e[2].mul(n.sqr(t))).divThis(r);return o.constructCircularArcThreePoint(e[0],e[2],a),!0}const a=e[0].sub(e[1]),m=e[2].sub(e[1]),h=a.crossProduct(m),l=a.dotProduct(m),u=s;t.geometryReleaseAssert(u<=1),t.geometryReleaseAssert(u>0);const c=.5/(1-u),g=a.sqrLength(),d=l,p=m.sqrLength(),_=n.sqr(h),f=a.sub(m).sqrLength();if(0===_)return Qi(o,e[0],e[2],1),!1;if(l<=-Math.sqrt(g)*Math.sqrt(p))return Qi(o,e[0],e[2],1),!1;const y=[0,0],x=new n.Envelope1D;x.setInfinite();const P=De(2*_,-(f/u+4*d),2*(1-u)/u,x,!1,y);if(0===P)return Qi(o,e[0],e[2],1),!1;1===P&&(y[1]=y[0]);const E=Math.sqrt(c/y[0]),v=Math.sqrt(c/y[1]),C=.5/u;let D=C-p*y[0],b=C-g*y[0];Math.abs(D)>Math.abs(b)?b=d*y[0]-C+1:D=d*y[0]-C+1;const S=a.mul(D).add(m.mul(b)),I=S.norm(1)<1e-15*E?0:Math.atan2(S.y,S.x)+Math.PI,w=a.add(m),T=i?i.clone():e[1].add(w.mul(c)),A=e[0].sub(T),N=e[2].sub(T),G=A.crossProduct(N)<0;return new Ei,o.constructEllipticArcEndPointsCenter(e[0],e[2],E,v/E,I,!1,!G,T)}function gr(e){const t=V(e);let s=!1;{const i=new n.Point2D(e.m_semiMajorAxis*Math.cos(e.m_startAngle),e.getSemiMinorAxis()*Math.sin(e.m_startAngle));i.rotateDirect(e.m_cosr,e.m_sinr),i.addThis(e.m_center),s=n.Point2D.distance(e.getStartXY(),i)>t}let i=!1;if(!s){const s=new n.Point2D(e.m_semiMajorAxis*Math.cos(e.m_startAngle+e.m_sweepAngle),e.getSemiMinorAxis()*Math.sin(e.m_startAngle+e.m_sweepAngle));s.rotateDirect(e.m_cosr,e.m_sinr),s.addThis(e.m_center),i=n.Point2D.distance(e.getEndXY(),s)>t}return!s&&!i}function dr(e){if(Ki(e))return 0;if(e.isDegenerate(0))return 0;const t=e.m_semiMajorAxis,s=e.getSemiMinorAxis(),n=t*t+s*s,i=e.getStartAngle(),r=e.getEndAngle(),o=e.m_center.y-e.m_YStart,a=e.m_cosr,m=e.m_sinr;let h=1,l=0;e.m_rotation&&(h=(a-m)*(a+m),l=2*a*m);const u=((-.5*(r-i)+.25*h*(2*Math.cos(r+i)*Math.sin(r-i)))*s+-2*Math.sin(.5*(r+i))*Math.sin(.5*(r-i))*a*o)*t/n;let c=0;return e.m_rotation&&(c=-2*Math.sin(r+i)*Math.sin(r-i)*.125*l-s*o/n*(2*Math.cos(.5*(r+i))*Math.sin(.5*(r-i)))*m),n*(u+c)+-.5*(e.m_XEnd-e.m_XStart)*(e.m_YEnd-e.m_YStart)}function pr(e){e.queryCoord2D(.5,e.m_interior)}function _r(e,t,s,n,i){if(i){if(0!==br(t,s))return 2}else if(C(t,s))return 1;return 0!==fr(e,t,s,null,null,null,n,void 0!==i&&i,0,!1)?4:0}function fr(e,s,i,r,o,a,m,h,l,u){if(Ki(s))return se(new Gr({start:s.getStartXY(),end:s.getEndXY()}),i,r,o,a,m,h,u);null!==o&&(o.length=0),null!==a&&(a.length=0),null!==r&&(r.length=0);const c=H(s,i);if(O(s,i,m=Math.max(c,m)))return 0;const g=i.getStartXY();g.subThis(s.m_center);const d=i.getEndXY();d.subThis(s.m_center),g.rotateReverse(s.m_cosr,s.m_sinr),d.rotateReverse(s.m_cosr,s.m_sinr);const p=d.clone();p.subThis(g);const _=s.m_semiMajorAxis,f=1/_,y=s.getSemiMinorAxis(),x=1/y,P=p.clone();P.leftPerpendicularThis();const E=Math.atan2(y*P.y,_*P.x),v=n.makePrimitiveArray(16,Number.NaN),C=n.makePrimitiveArray(16,Number.NaN);let D=0;const b=[E,E+Math.PI];for(let e=0;e<2;++e){const t=Li(s,b[e]);if(t>=0&&t<=1){v[D]=t;const e=s.getCoord2D(v[D]);C[D]=i.getClosestCoordinate(e,!1),n.Point2D.distance(e,i.getCoord2D(C[D]))<=m&&D++}}const S=g.x*f,I=g.y*x,w=p.x*f,T=p.y*x;let A=De(w*w+T*T,2*(S*w+I*T),S*S+I*I-1,n.Envelope1D.unit(),!1,C);t.geometryReleaseAssert(A>=0);for(let e=0;e<A;e++){const t=p.mul(C[e]).add(g);t.x*=f,t.y*=x;const r=Li(s,Math.atan2(t.y,t.x));if(r>=0&&r<=1){v[D]=r;const e=s.getCoord2D(r);C[D]=i.getClosestCoordinate(e,!1),n.Point2D.distance(e,i.getCoord2D(C[D]))<=m&&D++}}t.geometryReleaseAssert(D<v.length+4);const N=n.makePrimitiveArray(16,Number.NaN);A=s.intersectPoint(i.getStartXY(),N,m);for(let e=0;e<A;e++,D++)v[D]=N[e],C[D]=0;A=s.intersectPoint(i.getEndXY(),N,m);for(let e=0;e<A;e++,D++)v[D]=N[e],C[D]=1;A=i.intersectPoint(s.getStartXY(),N,m);for(let e=0;e<A;e++,D++)v[D]=0,C[D]=N[e];A=i.intersectPoint(s.getEndXY(),N,m);for(let e=0;e<A;e++,D++)v[D]=1,C[D]=N[e];return 0===D?0:Tr(e,s,i,v,C,D,r,o,a,m,h,0,u)}function yr(e,s,i,r,o,a,m,h,l,u){if(Ki(s)){const t=new Gr({start:s.getStartXY(),end:s.getEndXY()});return fr(e,i,t,r,a,o,m,h,0,!0)}if(Ki(i)){const t=new Gr({start:i.getStartXY(),end:i.getEndXY()});return fr(e,s,t,r,o,a,m,h,0,u)}const c=H(s,i);m=Math.max(m,c);let g=!1;{const e=s.getSemiAxes(),r=s.getCenter(),u=i.getSemiAxes(),c=i.getCenter(),d=n.Point2D.distance(c,r),p=e.x+u.x;if(d>p+m)return 0;if(e.y>u.x){if(d+u.x+m<e.y)return 0}else if(u.y>e.x&&d+e.x+m<u.y)return 0;if(l&&!h){const n=1===s.m_minorMajorRatio&&s.isClosed()&&s.isMajor(),r=1===i.m_minorMajorRatio&&i.isClosed()&&i.isMajor();if(n&&r&&(g=!0,d<=p)&&Math.max(e.x,u.x)<=Math.min(e.x,u.x)+d)return t.geometryReleaseAssert(!o&&!a),1}}if(!g&&O(s,i,m))return 0;const d=[],p=[],_=!1,f=!1,y=Si(s,0,0,_,f,d,p,null),x=[],P=[],E=Si(i,0,0,_,f,x,P,null);if(1===y&&1===E){const e=new Ye({points:d,weights:p}),t=new Ye({points:x,weights:P}),c=[],g=[],_=$n(!1,e,t,r,null===o?null:c,null===a?null:g,m,h,l,u);if(_>0&&null!==o||null!==a){o&&(o.length=0),a&&(a.length=0);for(let r=0;r<_;++r){if(o)if(n.isOneOf(c[r],0,1))o.push(c[r]);else{const t=e.tToLength(c[r]),n=s.lengthToT(t);o.push(n)}if(a)if(n.isOneOf(g[r],0,1))a.push(g[r]);else{const e=t.tToLength(g[r]),s=i.lengthToT(e);a.push(s)}}}return _}let v=[];const C=[];let D=0;const b=l&&!h;for(let e=0;e<y;e++){const t=new Ye({points:d.slice(2*e,2*e+3),weights:p.slice(2*e,2*e+3)});let r=0;for(let o=0;o<E;o++){C.length<=o&&C.push(new Ye({points:x.slice(2*o,2*o+3),weights:P.slice(2*o,2*o+3)}));const a=[],h=[],l=b?null:a,u=b?null:h,c=$n(!1,t,C[o],null,l,u,m,!1,b,!1);if(c>0&&b)return 1;for(let m=0;m<c;++m){if(0===a[m]&&0===e)a[m]=0;else if(1===a[m]&&e===y-1)a[m]=1;else{const e=t.tToLength(a[m])+D,n=s.lengthToT(e);a[m]=n}if(0===h[m]&&0===o)h[m]=0;else if(1===h[m]&&o===E-1)h[m]=1;else{const e=C[o].tToLength(h[m])+r,t=i.lengthToT(e);h[m]=t}v.push(n.makePair(a[m],h[m]))}r+=C[o].calculateLength2D()}D+=t.calculateLength2D()}if(0===v.length)return 0;if(h&&(v=v.filter(e=>!n.isOneOf(e.first,0,1)||!n.isOneOf(e.second,0,1)||!s.getCoord2D(e.first).equals(i.getCoord2D(e.second)))),l)return v.length;const S=[],I=[];for(const e of v)S.push(e.first),I.push(e.second);return Tr(e,s,i,S,I,S.length,r,o,a,m,h,0,u)}function xr(e,t,s){if(s.setCoords(e.getCoord2D(t.vmin)),s.mergeNe(e.getCoord2D(t.vmax)),Ki(e))return;const i=e.getSemiAxes(),r=[0,0,0,0];{const t=Math.atan2(-i.y*e.m_sinr,i.x*e.m_cosr),s=t+Math.PI,n=Math.atan2(i.y*e.m_cosr,i.x*e.m_sinr),o=n+Math.PI;r[0]=Li(e,t),r[1]=Li(e,s),r[2]=Li(e,n),r[3]=Li(e,o)}const o=new n.Point2D;for(let n=0;n<4;n++){const i=r[n];t.containsExclusiveCoordinate(i)&&(e.queryCoord2D(i,o),s.mergeNe(o))}}function Pr(e,s,i,r,o){if(0===e.m_semiMajorAxis)return i.vmin;let a=n.Point2D.getNAN();e.queryCoord2D(i.vmin,a);let m=n.Point2D.getNAN();if(e.queryCoord2D(i.vmax,m),Ki(e))return new Gr({start:a,end:m}).getClosestCoordinate(s,r);const h=qi(e,s);if(a=qi(e,a),m=qi(e,m),1===e.m_minorMajorRatio){if(h.isEqual(0,0))return i.vmin;const t=Li(e,Math.atan2(h.y,h.x));return r||i.containsCoordinate(t)?t:n.Point2D.distance(h,a)<=n.Point2D.distance(h,m)?i.vmin:i.vmax}const l=e.getSemiMajorAxis(),u=e.getSemiMinorAxis(),c=(l-u)*(l+u),g=n.sqr(c),d=h.x,p=h.y,_=n.sqr(u*p),f=u*c*p*2,y=[new n.ECoordinate(_),new n.ECoordinate(f),new n.ECoordinate(g-n.sqr(l*d)-_),new n.ECoordinate(-f),new n.ECoordinate(-g)],x=n.makeObjectArray(n.ECoordinate,4),P=Me(y,4,new n.Envelope1D(-1,1),!1,x,4);let E=i.vmin,v=n.Point2D.sqrDistance(h,a);{const e=n.Point2D.sqrDistance(h,m);e<v&&(E=i.vmax,v=e)}t.geometryReleaseAssert(!r);let C=n.makePrimitiveArray(8,Number.NaN);for(let t=0;t<P;++t){const s=x[t].value(),n=Math.sqrt(1-s*s),i=Math.atan2(s,n),r=Math.atan2(s,-n);C[2*t]=Li(e,i),C[2*t+1]=Li(e,r)}C=C.slice(0,2*P),n.numericSort(C);for(let t=0,r=2*P;t<r;++t)if(C[t]>i.vmin&&C[t]<i.vmax){const i=n.Point2D.sqrDistance(s,e.getCoord2D(C[t]));v>i&&(v=i,E=C[t])}return E}function Er(e,t,s){return e.m_semiMajorAxis===t.m_semiMajorAxis&&e.isMajor()!==t.isMajor()&&!!e.m_center.equals(t.m_center)&&e.m_sinr===t.m_sinr&&e.m_cosr===t.m_cosr&&e.m_minorMajorRatio===t.m_minorMajorRatio&&(s?e.isClockwise()!==t.isClockwise():e.isClockwise()===t.isClockwise())}function vr(e,s,i,o){const a=e.getStartXY(),m=e.getEndXY(),h=a.equals(m),l=s.equals(i);if(!h&&!l){const t=new r.Transformation2D;return t.initializeFromTwoPoints(a,m,s,i),er(e,t,!0,s,i),e.endPointModified(),void e.normalizeAfterEndpointChange()}if(!e.isMajor())return void Qi(e,s,i,1);if(h&&l){const t=e.m_center.add(s.sub(a));return void e.constructEllipticArcEndPointsCenter(s,i,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),t)}if(!h){const t=.5*(n.twoPi()-Math.abs(e.getSweepAngle())),r=(e.getSweepAngle()+t*n.sign(e.getSweepAngle()))/e.getSweepAngle(),o=new n.Point2D;e.queryCoord2D(r,o),e.constructEllipticArcEndPointsCenter(o,o,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),e.getCenter());const a=e.getCenter().add(s.sub(o));return void e.constructEllipticArcEndPointsCenter(s,i,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),a)}const u=n.Point2D.sqrDistance(s,i);let c=.25,g=.75;if(u<n.Point2D.sqrDistance(e.getCoord2D(.25),e.getCoord2D(.75))){const s=[0],i=Ce(new Fi(e,u),n.Envelope1D.construct(0,.25),1,s);i>0&&(t.geometryReleaseAssert(1===i),c=s[0],g=1-s[0])}const d=e.getCoord2D(c),p=e.getCoord2D(g);t.geometryReleaseAssert(!d.equals(p)),e.constructEllipticArcEndPointsCenter(d,p,e.getSemiMajorAxis(),e.getMinorMajorRatio(),e.getAxisXRotation(),!0,!e.isClockwise(),e.m_center),vr(e,s,i)}function Cr(e,t,s,n,i){return Dr(e,!1,t,s,n,i)}function Dr(e,s,n,i,r,o){const a=n.getGeometryType(),m=i.getGeometryType(),h=Math.max(r,H(n,i));if(a===t.GeometryType.enumLine&&m===t.GeometryType.enumLine)return te(n,i,h,o);let l=n,u=i,c=n.getStartXY(),g=n.getEndXY();if(c.compare(g)>0&&(l=n.clone().reverse()),c=i.getStartXY(),g=i.getEndXY(),c.compare(g)>0&&(u=i.clone().reverse()),s){if(n.equals(i))return 2;if(function(e,s,n){return t.geometryReleaseAssert(e.isCurve()||s.isCurve()),!!(e.getStartXY().equals(s.getStartXY())&&S(e,s,0,0,n,2,[0,0],[0,0])||e.getEndXY().equals(s.getEndXY())&&S(e,s,1,1,n,2,[0,0],[0,0])||e.getStartXY().equals(s.getEndXY())&&S(e,s,0,1,n,2,[0,0],[0,0])||e.getEndXY().equals(s.getStartXY())&&S(e,s,1,0,n,2,[0,0],[0,0]))}(n,i,h))return 4}switch(a){case t.GeometryType.enumLine:switch(m){case t.GeometryType.enumEllipticArc:return _r(e,u,l,h,o);case t.GeometryType.enumBezier:return Bs(e,u,l,h,o);case t.GeometryType.enumRationalBezier2:return jn(e,u,l,h,o);case t.GeometryType.enumBezier2:return qt(e,u,l,h,o);default:t.throwInternalErrorException("")}break;case t.GeometryType.enumEllipticArc:switch(m){case t.GeometryType.enumLine:return _r(e,l,u,h,o);case t.GeometryType.enumEllipticArc:return function(e,t,s,n,i){if(i){if(0!==br(t,s))return 2}else if(C(t,s))return 1;return 0!==yr(e,t,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}(e,l,u,h,o);case t.GeometryType.enumBezier:return zs(e,u,l,h,o);case t.GeometryType.enumRationalBezier2:return Wn(e,u,l,h,o);case t.GeometryType.enumBezier2:return Vt(e,u,l,h,o);default:t.throwInternalErrorException("")}break;case t.GeometryType.enumBezier:switch(m){case t.GeometryType.enumLine:return Bs(e,l,u,h,o);case t.GeometryType.enumEllipticArc:return zs(e,l,u,h,o);case t.GeometryType.enumBezier:return function(e,t,s,n,i){if(i){if(0!==br(t,s))return 2}else if(C(t,s))return 1;return 0!==Qs(e,t,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}(e,l,u,h,o);case t.GeometryType.enumRationalBezier2:return Us(e,l,u,h,o);case t.GeometryType.enumBezier2:return js(e,l,u,h,o);default:t.throwInternalErrorException("")}break;case t.GeometryType.enumRationalBezier2:switch(m){case t.GeometryType.enumLine:return jn(e,l,u,h,o);case t.GeometryType.enumEllipticArc:return Wn(e,l,u,h,o);case t.GeometryType.enumBezier:return Us(e,u,l,h,o);case t.GeometryType.enumRationalBezier2:return function(e,t,s,n,i){if(i){const n=br(t,s);if(0!==n){if(e){if(1===n){if(t.m_weights[0]===s.m_weights[0]&&t.m_weights[1]===s.m_weights[1]&&t.m_weights[2]===s.m_weights[2])return 2}else if(t.m_weights[0]===s.m_weights[2]&&t.m_weights[1]===s.m_weights[1]&&t.m_weights[2]===s.m_weights[0])return 2;return 4}return 2}}else if(C(t,s))return 1;return 0!==$n(e,t,s,null,null,null,n,void 0!==i&&i,!0,!1)?4:0}(e,l,u,h,o);case t.GeometryType.enumBezier2:return Zn(e,l,u,h,o);default:t.throwInternalErrorException("")}break;case t.GeometryType.enumBezier2:switch(m){case t.GeometryType.enumLine:return qt(e,l,u,h,o);case t.GeometryType.enumEllipticArc:return Vt(e,l,u,h,o);case t.GeometryType.enumBezier:return js(e,u,l,h,o);case t.GeometryType.enumRationalBezier2:return Zn(e,u,l,h,o);case t.GeometryType.enumBezier2:return function(e,t,s,n,i){if(i){if(0!==br(t,s))return 2}else if(C(t,s))return 1;return 0!==Yt(e,t,s,null,null,null,n,i??!1,!0,!1)?4:0}(e,l,u,h,o);default:t.throwInternalErrorException("")}break;default:t.throwInternalErrorException("")}}function br(e,s,n=!0){if(!n&&!Sr(e,s))return 0;const i=e.isLine()&&s.isLine();if(e.getStartXY().equals(s.getStartXY())&&e.getEndXY().equals(s.getEndXY())){const n=1;if(i)return n;const r=e.getGeometryType();if(r!==s.getGeometryType())return 0;if(r===t.GeometryType.enumBezier){const t=e,i=s;return t.getControlPoint1().equals(i.getControlPoint1())&&t.getControlPoint2().equals(i.getControlPoint2())?n:0}if(r===t.GeometryType.enumEllipticArc)return Er(e,s,!1)?n:0;if(r===t.GeometryType.enumRationalBezier2){const t=e,i=s;if(t.getControlPoint1().equals(i.getControlPoint1())&&t.getStandardFormWeight()===i.getStandardFormWeight())return n}else if(r===t.GeometryType.enumBezier2){const t=s;if(e.getControlPoint1().equals(t.getControlPoint1()))return n}return 0}if(e.getStartXY().equals(s.getEndXY())&&e.getEndXY().equals(s.getStartXY())){const n=-1;if(i)return n;const r=e.getGeometryType();if(r!==s.getGeometryType())return 0;if(r===t.GeometryType.enumBezier){const t=e,i=s;return t.getControlPoint1().equals(i.getControlPoint2())&&t.getControlPoint2().equals(i.getControlPoint1())?n:0}if(r===t.GeometryType.enumEllipticArc)return Er(e,s,!0)?n:-1;if(r===t.GeometryType.enumRationalBezier2){const t=e,i=s;if(t.getControlPoint1().equals(i.getControlPoint1())&&t.getStandardFormWeight()===i.getStandardFormWeight())return n}else if(r===t.GeometryType.enumBezier2){const t=s;if(e.getControlPoint1().equals(t.getControlPoint1()))return n}return 0}return 0}function Sr(e,s){const n=e.getGeometryType();return n===s.getGeometryType()&&(n!==t.GeometryType.enumEllipticArc||e.projectionBehavior()===s.projectionBehavior())}function Ir(e,s,n,i,r,o,a){!r&&o&&t.throwInvalidArgumentException("");const m=s.getGeometryType(),h=n.getGeometryType(),l=Math.max(a,H(s,n));if(i&&(i.length=0),r&&(r.length=0),o&&(o.length=0),m===t.GeometryType.enumLine&&h===t.GeometryType.enumLine)return se(s,n,i,r,o,l,!1,!1);let u=s,c=n,g=s.getStartXY(),d=s.getEndXY(),p=!1,_=!1;g.compare(d)>0&&(u=s.clone(!0).reverse(),p=!0),g=n.getStartXY(),d=n.getEndXY(),g.compare(d)>0&&(c=n.clone(!0).reverse(),_=!0);let f=0;switch(m){case t.GeometryType.enumLine:switch(h){case t.GeometryType.enumEllipticArc:f=fr(e,c,u,i,o,r,l,!1,0,!0);break;case t.GeometryType.enumBezier:f=Ws(e,c,u,i,o,r,l,!1,0,!0);break;case t.GeometryType.enumRationalBezier2:f=Qn(e,c,u,i,o,r,l,!1,0,!0);break;case t.GeometryType.enumBezier2:f=Ht(e,c,u,i,o,r,l,!1,0,!0);break;default:t.throwInternalErrorException("")}break;case t.GeometryType.enumEllipticArc:switch(h){case t.GeometryType.enumLine:f=fr(e,u,c,i,r,o,l,!1,0,!1);break;case t.GeometryType.enumEllipticArc:f=yr(e,u,c,i,r,o,l,!1,!1,!1);break;case t.GeometryType.enumBezier:f=Zs(e,c,u,i,o,r,l,!1,0,!0);break;case t.GeometryType.enumRationalBezier2:f=Kn(e,c,u,i,o,r,l,!1,0,!0);break;case t.GeometryType.enumBezier2:f=Ot(e,c,u,i,o,r,l,!1,0,!0);break;default:t.throwInternalErrorException("")}break;case t.GeometryType.enumRationalBezier2:switch(h){case t.GeometryType.enumLine:f=Qn(e,u,c,i,r,o,l,!1,0,!1);break;case t.GeometryType.enumEllipticArc:f=Kn(e,u,c,i,r,o,l,!1,0,!1);break;case t.GeometryType.enumBezier:f=Ks(e,c,u,i,o,r,l,!1,!1,!0);break;case t.GeometryType.enumRationalBezier2:f=$n(e,u,c,i,r,o,l,!1,!1,!1);break;case t.GeometryType.enumBezier2:f=Jn(e,u,c,i,r,o,l,!1,0,!1);break;default:t.throwInternalErrorException("")}break;case t.GeometryType.enumBezier2:switch(h){case t.GeometryType.enumLine:f=Ht(e,u,c,i,r,o,l,!1,0,!1);break;case t.GeometryType.enumEllipticArc:f=Ot(e,u,c,i,r,o,l,!1,0,!1);break;case t.GeometryType.enumBezier:f=$s(e,c,u,i,o,r,l,!1,0,!0);break;case t.GeometryType.enumRationalBezier2:f=Jn(e,c,u,i,o,r,l,!1,0,!0);break;case t.GeometryType.enumBezier2:f=Yt(e,u,c,i,r,o,l,!1,!1,!1);break;default:t.throwInternalErrorException("")}break;case t.GeometryType.enumBezier:switch(h){case t.GeometryType.enumLine:f=Ws(e,u,c,i,r,o,l,!1,0,!1);break;case t.GeometryType.enumEllipticArc:f=Zs(e,u,c,i,r,o,l,!1,0,!1);break;case t.GeometryType.enumBezier:f=Qs(e,u,c,i,r,o,l,!1,!1,!1);break;case t.GeometryType.enumRationalBezier2:f=Ks(e,u,c,i,r,o,l,!1,!1,!1);break;case t.GeometryType.enumBezier2:f=$s(e,u,c,i,r,o,l,!1,0,!1);break;default:t.throwInternalErrorException("")}break;default:t.throwInternalErrorException("")}if(p){if(r){for(let e=0;e<f;e++)r[e]=1-r[e];r.reverse()}i&&i.reverse(),o&&o.reverse()}if(_&&o)for(let e=0;e<f;e++)o[e]=1-o[e];return f}function wr(e,t,s){return t===s?0:(t>s&&(s=n.swap(t,t=s)),e.cut(t,s,!0).calculateUpperLength2D())}function Tr(e,t,s,i,r,o,a,m,h,l,u,c,g){if(!o)return 0;const d=(e,t)=>{for(let s=0;s<o;++s){let i=t[s];if(n.isOneOf(i,0,1)){i=n.normalizeSignedZero(i);continue}const r=e.getCoord2D(i);i<.5?r.equals(e.getStartXY())&&wr(e,0,i)<=V(e)&&(t[s]=0):r.equals(e.getEndXY())&&wr(e,i,1)<=V(e)&&(t[s]=1)}};d(t,i),d(s,r),function(e,t,s,i,r){const o=[],a=[],m=[];for(let h=0,l=r;h<l;h++)o.push(e.calculateSubLengthFromStart(s[h])),a.push(t.calculateSubLengthFromStart(i[h])),n.isOneOf(s[h],0,1)&&n.isOneOf(i[h],0,1)&&e.getCoord2D(s[h]).equals(t.getCoord2D(i[h]))&&m.push(h);if(0===m.length||m.length===r)return;m.sort((e,t)=>s[e]<s[t]?-1:s[e]>s[t]?1:i[e]<i[t]?-1:i[e]>i[t]?1:0);let h=-1;for(const l of m){if(h>=0&&s[l]===s[h]&&s[l]===s[h]){h=l;continue}h=l;const m=[];m.length=r;for(let e=0;e<m.length;++e)m[e]=e;m.sort((e,t)=>{const s=o[l],n=a[l],i=o[e]-s,r=a[e]-n,m=i*i+r*r,h=o[t]-s,u=a[t]-n,c=h*h+u*u;return m<c?-1:m>c?1:0});for(let o=0;o<r;o++){const r=m[o];if(r===l||s[r]===s[l]&&i[r]===i[l]||n.isOneOf(s[r],0,1)&&n.isOneOf(i[r],0,1))continue;const a=(s,i,r,o)=>{const a=new y,m=new n.ECoordinate;m.setWithEps(1);const h=new n.ECoordinate;h.set(i,m.eps()),e.queryCoord2DE(h,a);const l=new y;e.queryCoord2DE(new n.ECoordinate(s),l);let u=!1;return a.eq(l)&&(h.set(o,m.eps()),t.queryCoord2DE(h,a),t.queryCoord2DE(new n.ECoordinate(r),l),u=a.eq(l)),!u},h=n.Point2D.getNAN();e.queryCoord2D(s[r],h);const u=n.Point2D.getNAN();if(t.queryCoord2D(i[r],u),0===n.Point2D.distance(h,u)&&a(s[l],s[r],i[l],i[r]))break;const c=new n.Envelope1D(i[r],i[l]);c.normalizeNoNAN();const g=new n.Envelope1D(s[r],s[l]);g.normalizeNoNAN();let d=-1,p=Number.POSITIVE_INFINITY,_=Number.POSITIVE_INFINITY,f=s[r];h.assign(e.getCoord2D(f));for(let o=0;o<5;o++){const o=t.getClosestCoordinateOnInterval(h,c,-1);u.assign(t.getCoord2D(o));const m=n.Point2D.distance(h,u);if(f=e.getClosestCoordinateOnInterval(u,g,-1),f===s[l]&&o===i[l]){d=1;break}h.assign(e.getCoord2D(f));const y=n.Point2D.distance(u,h);if(!(y<_&&m<p)){d=0;break}if(0===y&&0===m){a(s[l],s[r],i[l],i[r])?(s[r]=f,i[r]=o,d=0):d=1;break}_=y,p=m}if(-1===d&&(d=n.isOneOf(s[r],0,1)||n.isOneOf(i[r],0,1)?0:1),1!==d)break;s[r]=s[l],i[r]=i[l]}}}(t,s,i,r,o);const p=[];for(let e=0,t=o;e<t;e++)p.push(e);const _=(e,t)=>g?n.standardNumericCompare2(r[e],i[e],r[t],i[t]):n.standardNumericCompare2(i[e],r[e],i[t],r[t]);if(p.length>1){p.sort(_);const e=Math.max(V(t),V(s));let o=0;for(let a=1,m=p.length;a<m;a++){const m=i[p[o]],h=i[p[a]],l=r[p[o]],u=r[p[a]];if(m!==h||l!==u){if(wr(t,m,h)<=e&&wr(s,l,u)<=e&&!(n.isOneOf(m,0,1)&&n.isOneOf(l,0,1)||n.isOneOf(h,0,1)&&n.isOneOf(u,0,1))){const e=n.Point2D.distance(t.getCoord2D(m),s.getCoord2D(l)),i=n.Point2D.distance(t.getCoord2D(h),s.getCoord2D(u));if(e<=i)continue;if(i<e){p[o]=p[a];continue}continue}o++,p[o]=p[a]}}if(p.length=o+1,1===p.length&&0!==p[0]&&(i[0]=i[p[0]],r[0]=r[p[0]],p[0]=0),p.length>2){const e=n.Envelope1D.constructEmpty(),o=n.Envelope1D.constructEmpty();e.setCoords(i[p[0]],i[p.at(-1)]),o.setCoords(r[p[0]],r[p.at(-1)]);let a=!0;for(let t=1,s=p.length-1;t<s;t++)if(!e.containsCoordinate(i[p[t]])||!o.containsCoordinate(r[p[t]])){a=!1;break}if(a){const i=[.5,.2,.7,.1,.3,.4,.6,.8,.9];for(let r=0;r<i.length;r++){let m=n.lerp(e.vmin,e.vmax,i[r]);const h=t.getCoord2D(m);if(!s.isCloserThanDistance(h,o,l)){a=!1;break}m=n.lerp(o.vmin,o.vmax,i[r]);const u=s.getCoord2D(m);if(!t.isCloserThanDistance(u,e,l)){a=!1;break}}}a&&(p[1]=p.at(-1),p.length=2)}}if(1===p.length&&e){const e=0,n=0;S(t,s,i[0],r[0],l,1,[e],[n])&&(p.push(1),i[1]=e,r[1]=n,p.sort(_))}if(u&&1===p.length){let e=!0;for(let o=0,a=p.length;o<a;o++)if(!n.isOneOf(i[p[o]],0,1)||!n.isOneOf(r[p[o]],0,1)||0!==n.Point2D.distance(t.getCoord2D(i[p[o]]),s.getCoord2D(r[p[o]]))){e=!1;break}if(e)return 0}let f=0;for(let e=0,s=p.length;e<s;e++){if(m&&m.push(i[p[e]]),h&&h.push(r[p[e]]),a){const s=n.Point2D.getNAN();t.queryCoord2D(i[p[e]],s),a.push(s)}f++}return f}function Ar(e,s,i,r,o){let a=-1,m=-1,h=-1,l=-1;{const t=[0,s],n=[s,0],o=[0,r],u=[r,0];for(let s=0;s<2&&-1===a;++s)for(let r=0;r<2;++r)if(e[t[s]].equals(i[o[r]])){a=t[s],m=n[s],h=o[r],l=u[r];break}}if(-1===a){const t=new d;t.setFromPoints(e,s+1);const n=new d;return n.setFromPoints(i,r+1),n.inflate(o),t.isIntersectingW(n)?-1:0}{const u=n.makePrimitiveArray(s+1,Number.NaN),c=as(e,s+1,u);t.geometryReleaseAssert(c>1);let g=0,d=0;for(let e=0;e<c;++e)a===u[e]&&(d=e,g++),m===u[e]&&g++;if(2!==g)return-1;const p=n.makePrimitiveArray(r+1,Number.NaN),_=as(i,r+1,p);t.geometryReleaseAssert(_>1),g=0;let f=0;for(let e=0;e<_;++e)h===p[e]&&(f=e,g++),l===p[e]&&g++;if(2!==g)return-1;const y=e[u[(d+c-1)%c]],x=e[u[(d+1)%c]],P=i[p[(f+_-1)%_]],E=i[p[(f+1)%_]],v=e[a],C=[y,x,P,E],D=[0,1,2,3];D.sort((e,t)=>n.Point2D.compareVectorsOrigin(v,C[e],C[t]));let b=D[0];for(let e=1;e<4;e++){if(D[e]!==(b+1)%4)return-1;b=D[e]}{const e=y.sub(v),t=E.sub(v),s=t.dotProduct(e);if(s>0){const n=t.crossProduct(e),i=Math.abs(Math.atan2(n,s)),r=i*e.length(),a=i*t.length();if(r<=o||a<=o)return-1}}{const e=x.sub(v),t=P.sub(v),s=t.dotProduct(e);if(s>0){const n=t.crossProduct(e),i=Math.abs(Math.atan2(n,s)),r=i*e.length(),a=i*t.length();if(r<=o||a<=o)return-1}}return 1}}var Nr=s.VertexDescription;class Gr extends j{constructor(e){super(e||{XStart:0,YStart:0,XEnd:0,YEnd:0})}assignMove(e){return this!==e&&(this.m_description=e.m_description,e.m_description=null,this.m_attributes=e.m_attributes,e.m_attributes=null,this.m_XStart=e.m_XStart,e.m_XStart=Number.NaN,this.m_YStart=e.m_YStart,this.m_XEnd=e.m_XEnd,e.m_XEnd=Number.NaN,this.m_YEnd=e.m_YEnd),this}assignCopy(e){return this!==e&&e.copyTo(this),this}calculateLowerLength3D(){return t.geometryReleaseAssert(0),0}calculateUpperLength3D(){return t.geometryReleaseAssert(0),0}changeEndPoints3D(e,s){t.geometryReleaseAssert(0)}getClosestCoordinate3D(e,s,n){return t.geometryReleaseAssert(0),0}getBoundary(){return Ee(this)}getAttributeAsDbl(e,t,s){if(0===t)return 0===s?Q(this,e):K(this,e);const i=Nr.getInterpolation(t),r=this.getStartAttributeAsDbl(t,s),o=this.getEndAttributeAsDbl(t,s);return n.interpolate(i,r,o,e,Nr.getDefaultValue(t))}constructFromCoords(e,t,s,n){this.dropAllAttributes(),this.setStartXYCoords(e,t),this.setEndXYCoords(s,n)}construct(e,t){this.dropAllAttributes(),this.setStartXY(e),this.setEndXY(t)}construct3D(e,s){t.geometryReleaseAssert(0)}constructPoint(e,t){this.assignVertexDescription(e.getDescription()),this.mergeVertexDescription(t.getDescription()),this.setStart(e),this.setEnd(t)}getGeometryType(){return Gr.type}queryEnvelope(e){if(4===e.m_EnvelopeType){e.setEmpty(),e.assignVertexDescription(this.m_description);const t=i.Envelope2D.constructEmpty();this.queryEnvelope(t),e.setEnvelope(t);for(let t=1,s=this.m_description.getAttributeCount();t<s;t++){const s=this.m_description.getSemantics(t);for(let n=0,i=Nr.getComponentCount(s);t<i;t++){const t=this.queryInterval(s,n);e.setIntervalEnvelope(s,n,t)}}}else 2===e.m_EnvelopeType?e.setCoords({xmin:this.m_XStart,ymin:this.m_YStart,xmax:this.m_XEnd,ymax:this.m_YEnd}):3===e.m_EnvelopeType?(e.setEmpty(),e.mergeCoords(this.m_XStart,this.m_YStart,k(this,0,1,0)),e.mergeCoords(this.m_XEnd,this.m_YEnd,k(this,1,1,0))):t.throwNotImplementedException("env type not impl")}applyTransformation(e){t.geometryReleaseAssert(e instanceof r.Transformation2D);const s=new n.Point2D;s.x=this.m_XStart,s.y=this.m_YStart,e.transformInPlace(s),this.m_XStart=s.x,this.m_YStart=s.y,s.x=this.m_XEnd,s.y=this.m_YEnd,e.transformInPlace(s),this.m_XEnd=s.x,this.m_YEnd=s.y}createInstance(){return new Gr({vd:this.m_description})}calculateLength2D(){return Math.sqrt(ae(this))}calculateLength3D(e){return t.geometryReleaseAssert(0),0}changeEndPoints2D(e,t){this.setStartXY(e),this.setEndXY(t),this.normalizeAfterEndpointChange()}queryControlPointsHelper(e){return t.geometryReleaseAssert(e.length>=2),e[0]=this.getStartXY(),e[1]=this.getEndXY(),2}queryCoord2D(e,t){return W(this,e,t)}queryCoord3D(e,s){t.geometryReleaseAssert(0)}getCoordZ(e){return function(e,t){const s=e.getStartZ(),i=e.getEndZ();return n.lerp(s,i,t)}(this,e)}queryCoord2DE(e,t){$(this,e,t)}queryCoord2DMP(e,t){t.assignPoint2D(this.getStartXY());const s=P.constructPoint2D(this.getEndXY());s.subThis(t),s.mulThis(n.MPValue.constructDouble(e)),t.addThis(s)}getCoordX(e){return Q(this,e)}getCoordY(e){return K(this,e)}cut(e,t,s){const n=new Mr;return this.queryCut(e,t,n,s),n.releaseSegment()}queryCut(e,t,s,i){const r=s.createLine();i&&r.assignVertexDescription(this.m_description);const o=n.Point2D.getNAN();if(W(this,e,o),r.setStartXYCoords(o.x,o.y),W(this,t,o),r.setEndXYCoords(o.x,o.y),!i)for(let s=1,n=this.m_description.getAttributeCount();s<n;s++){const n=this.m_description.getSemantics(s),i=Nr.getComponentCount(n);for(let s=0;s<i;s++){const i=this.getAttributeAsDbl(e,n,s);r.setStartAttribute(n,s,i);const o=this.getAttributeAsDbl(t,n,s);r.setEndAttribute(n,s,o)}}}queryDerivative(e,t){!function(e,t,s){const n=y.constructPoint2D(e.getStartXY()),i=y.constructPoint2D(e.getEndXY());s.setCoordsE(i.x.subE(n.x),i.y.subE(n.y))}(this,0,t)}getClosestCoordinate(e,t){return n.Point2D.getClosestCoordinate(this.getStartXY(),this.getEndXY(),e,t)}getClosestCoordinateOnInterval(e,t,s=-1){const i=new n.Point2D;this.queryCoord2D(t.vmin,i);const r=new n.Point2D;this.queryCoord2D(t.vmax,r);const o=n.Point2D.getClosestCoordinate(i,r,e,!1);return L.recalculateParentT(t.vmin,t.vmax,o)}intersectionOfYMonotonicWithAxisX(e,t){const s=this.m_YEnd-this.m_YStart;if(!s)return e===this.m_YEnd?t:Number.NaN;const n=(e-this.m_YStart)/s;let i=Q(this,n);return 1===n&&(i=this.m_XEnd),i}isCurve(){return!1}isMonotoneQuickAndDirty(){return!0}isDegenerate(e){const t=this.m_XStart-this.m_XEnd,s=this.m_YStart-this.m_YEnd;return Math.sqrt(t*t+s*s)<=e}isDegenerate3D(e,s){return t.geometryReleaseAssert(0),!1}queryLooseEnvelope(e){this.queryEnvelope(e)}clone(e){const t=new Gr;return this.copyTo(t),t}tToLength(e){return e*this.calculateLength2D()}lengthToT(e){const t=this.calculateLength2D();return 0!==t?e/t:0}calculateWeightedAreaCentroid2D(e){const t=new n.Point2D;return t.setCoords(0,0),t}calculateWeightedCentroid2D(){return this.getCoord2D(.5).mul(this.calculateLength2D())}getTangent(e){const t=n.Point2D.getNAN();return t.setSub(this.getEndXY(),this.getStartXY()),t}getDerivative(e){const t=new n.Point2D;return t.setSub(this.getEndXY(),this.getStartXY()),t}getCurvature(e){return 0}isIntersectingPoint(e,t,s){return ne(this,e,t,s)>=0}isIntersectingPoint3D(e,s,n,i,r=1){return t.geometryReleaseAssert(0),!1}getYMonotonicParts(e,t){return 0}getMonotonicParts(e,t){return 0}getMonotonicPartParams(e,s){return s&&(e<2&&t.throwInvalidArgumentException(""),s[0]=0,s[1]=1),2}intersectionWithAxis2D(e,t,s,n){if(e){const e=this.m_YEnd-this.m_YStart;if(!e)return t===this.m_YEnd?-1:0;const i=(t-this.m_YStart)/e;return i<0||i>1?0:(s&&(s[0]=Q(this,i)),n&&(n[0]=i),1)}{const e=this.m_XEnd-this.m_XStart;if(!e)return t===this.m_XEnd?-1:0;const i=(t-this.m_XStart)/e;return i<0||i>1?0:(s&&(s[0]=K(this,i)),n&&(n[0]=i),1)}}calculateUpperLength2D(){return this.calculateLength2D()}calculateLowerLength2D(){return this.calculateLength2D()}normalizeAfterEndpointChange(){return!1}queryLooseEnvelopeOnInterval(e,s){if(2===s.m_EnvelopeType){let t=n.snap(e.vmin,0,1);const i=new n.Point2D;return this.queryCoord2D(t,i),s.setCoords({pt:i}),t=n.snap(e.vmax,0,1),this.queryCoord2D(t,i),void s.mergeNe(i)}t.throwNotImplementedException("3d dst not impl")}orientBottomUp(){ee(this)}isLine(){return!0}isDegenerateToLineHelper(e){return!0}copyIgnoreAttributes(e){e.setStartXY(this.getStartXY()),e.setEndXY(this.getEndXY()),e.normalizeAfterEndpointChange()}calculateArea2DHelper(){return 0}absNormXYZ(e){return function(e,t){const s=e.getStartXYZ();s.z*=t;const n=e.getEndXYZ();return n.z*=t,s.norm(1)+n.norm(1)}(this,e)}absNorm(){return this.getStartXY().norm(1)+this.getEndXY().norm(1)}queryEnvelopeW(e,t){t.setCoords(this.getCoord2D(e.vmin)),t.mergeNe(this.getCoord2D(e.vmax))}setSegmentFromCoordsForStitcher(e,t){J(this,e[0],e[t-1])}writeInBufferStream(e,s){return t.geometryReleaseAssert(0),0}readFromBufferStream(e,s){t.geometryReleaseAssert(0)}snapControlPoints(e){return!1}needsSnapControlPoints(e){return!1}calculateSpecialPointsForCracking(e,t){return 0}ensureXYMonotone(){return!1}setCoordsForIntersector(e,t,s){J(this,e,t)}static isIntersectingLineLine(e,t,s,n){return te(e,t,s,n)}static isIntersectingLineLine_(e,t,s,n){return te(e,t,s,n)}copyToImpl(e){}reverseImpl(){}equalsImpl(e){return!0}equalsImplTol(e,t){return!0}swapImpl(e){}afterCompletedModification(){}endPointModified(){}clearEndPointModified(){}intersect(e,t,s,n,i){return Ir(!1,this,e,t,s,n,i)}intersectPoint(e,s,n){s.length<1&&t.throwOutOfRangeException("");const i=ne(this,e,n,!1);return i>=0?(s&&(s[0]=i),1):0}isIntersecting(e,t,s){return 0!==Cr(!1,this,e,t,s)}}Gr.type=t.GeometryType.enumLine;class Mr{constructor(e){this.m_seg=null,this.m_curves=null,this.m_lineBuffer=new Gr,this.m_mask=0,this.m_active=0,void 0!==e&&(e.copy?e.copy.copyTo(this,!1):e.move?this.assignMove(e.move):e.segment?this.copyFrom(e.segment,!!e.bIgnoreAttributes):t.throwInternalErrorException("bad constructor params"))}assignCopy(e){return e instanceof Mr?this!==e&&e.copyTo(this,!1):this.copyFrom(e,!1),this}assignMove(e){if(e instanceof Mr){if(this===e)return this;this.reset(),1&e.m_mask&&(this.m_lineBuffer=e.m_lineBuffer,e.m_lineBuffer=null,this.m_mask=1),this.m_curves=e.m_curves,this.m_mask=e.m_mask,this.m_active=e.m_active,e.reset(),this.m_seg=this.activeSegment(),e.m_seg=null}else{if(this.m_seg===e)return this;this.create(e.getGeometryType()),this.m_seg.swap(e)}return this}activeSegment(){switch(this.m_active){case 0:return null;case 1:return this.line();case 2:return this.arc();case 4:return this.bezier3();case 8:return this.bezier2();case 16:return this.rbezier2();default:t.throwInternalErrorException("")}}get(){return this.m_seg}reset(){1&this.m_mask&&(this.m_lineBuffer=null),this.m_mask>1&&(this.m_curves=null),this.m_mask=0,this.m_active=0}empty(){return null===this.m_seg}copyTo(e,t){this!==e&&(this.empty()?e.m_seg=null:e.copyFrom(this.m_seg,t))}copyToWithZ(e,s){t.geometryReleaseAssert(0)}createImpl(e){switch(e){case t.GeometryType.enumLine:1&this.m_mask||(this.m_lineBuffer=new Gr,this.m_mask|=1,this.m_active=1);break;case t.GeometryType.enumEllipticArc:2&this.m_mask||(this.m_curves=new Ei,this.m_mask=1&this.m_mask|2,this.m_active=2);break;case t.GeometryType.enumBezier:4&this.m_mask||(this.m_curves=new pn,this.m_mask=1&this.m_mask|4,this.m_active=4);break;case t.GeometryType.enumBezier2:8&this.m_mask||(this.m_curves=new Le,this.m_mask=1&this.m_mask|8,this.m_active=8);break;case t.GeometryType.enumRationalBezier2:16&this.m_mask||(this.m_curves=new Ye,this.m_mask=1&this.m_mask|16,this.m_active=16);break;default:t.throwInvalidArgumentException("")}}create(e){e===t.GeometryType.enumLine?this.createLine():e===t.GeometryType.enumEllipticArc?this.createEllipticArc():e===t.GeometryType.enumBezier?this.createCubicBezier():e===t.GeometryType.enumRationalBezier2?this.createQuadraticRationalBezier():e===t.GeometryType.enumBezier2?this.createQuadraticBezier():t.throwInvalidArgumentException("Segment_buffer.create")}copyFrom(e,t){this.m_seg!==e&&(this.create(e.getGeometryType()),t?e.copyIgnoreAttributes(this.m_seg):e.copyTo(this.m_seg))}copyFromWithZ(e,s){t.geometryReleaseAssert(0)}line(){return this.m_lineBuffer}arc(){return this.m_curves}bezier3(){return this.m_curves}bezier2(){return this.m_curves}rbezier2(){return this.m_curves}createLine(){return this.createImpl(t.GeometryType.enumLine),this.m_seg=this.line(),this.line()}createEllipticArc(){return this.createImpl(t.GeometryType.enumEllipticArc),this.m_seg=this.arc(),this.arc()}createCubicBezier(){return this.createImpl(t.GeometryType.enumBezier),this.m_seg=this.bezier3(),this.bezier3()}createQuadraticRationalBezier(){return this.createImpl(t.GeometryType.enumRationalBezier2),this.m_seg=this.rbezier2(),this.rbezier2()}createQuadraticBezier(){return this.createImpl(t.GeometryType.enumBezier2),this.m_seg=this.bezier2(),this.bezier2()}releaseSegment(){if(this.m_seg=null,0===this.m_active&&t.throwInternalErrorException("releaseSegment"),1&this.m_active){const e=this.line();return this.m_mask-=1,this.m_active=0,this.m_lineBuffer=null,e}let e;return 2&this.m_active?e=this.arc():4&this.m_active?e=this.bezier3():8&this.m_active?e=this.bezier2():16&this.m_active?e=this.rbezier2():t.throwInternalErrorException("releaseSegment"),this.m_mask-=this.m_active,this.m_active=0,this.m_curves=null,e}equals(e){return e instanceof Mr?this===e||(this.empty()?e.empty():!e.empty()&&this.get().equals(e.get())):(t.throwNotImplementedException("seg comparison not yet impl"),!1)}}e.ConvexHull=hs,e.CubicBezier=pn,e.Densificator=Ii,e.EPoint2D=y,e.EditShape=os,e.EllipticArc=Ei,e.GeometryCollection=z,e.Line=Gr,e.MPPoint2D=P,e.MultiPoint=g,e.Polygon=es,e.Polyline=xe,e.QuadraticRationalBezier=Ye,e.Segment=L,e.SegmentBuffer=Mr,e.SegmentTypeInfo=rs,e.VertexIterator=is,e.approximationWithBeziers=bi,e.approximationWithQuadraticRationalBeziers=Si,e.arcimpl_NormalizeAngles=Vi,e.calculate=Ee,e.calculateStandardWeight=oi,e.canUseQuadTree=function(e){return!(e.isEmpty()||e.getGeometryType()!==t.GeometryType.enumPolyline&&e.getGeometryType()!==t.GeometryType.enumPolygon||e.getPointCount()<20)},e.canUseQuadTreeForPaths=function(e){return!(e.isEmpty()||e.getGeometryType()!==t.GeometryType.enumPolyline&&e.getGeometryType()!==t.GeometryType.enumPolygon||e.getPointCount()<20)},e.checkSharpCorner=function(e,t,s,i,r,o,a,m,h){if(n.isOneOf(s,0,1)&&n.isOneOf(i,0,1)&&0===n.Point2D.distance(e.getCoord2D(s),t.getCoord2D(i))){const l=1e-12,u=new y,c=Number.EPSILON;if(e.queryDerivative(new n.ECoordinate(s,c),u),u.isTrueZero()){const t=1===s?-1e-12:l;e.queryDerivative(new n.ECoordinate(s,c).add(t),u)}1===s&&u.negateThis();const g=new y;if(t.queryDerivative(new n.ECoordinate(i,c),g),g.isTrueZero()){const e=1===s?-1e-12:l;t.queryDerivative(new n.ECoordinate(i,c).add(e),g)}1===i&&g.negateThis(),u.isZero()||u.normalize(),g.isZero()||g.normalize();const d=u.dotProduct(g),p=u.crossProduct(g);p.scaleError(3);const _=()=>{if(h)return.001;{const s=e.calculateUpperLength2D(),n=t.calculateUpperLength2D();return Math.min(.01*r/Math.min(s,n),1e-10)}};if(d.ge(n.s_zero)&&(p.isZero()||Math.abs(p.value())<_()))return b(e,t,s,i,r,o,a,m)}return 0},e.clearEndPointModified=hr,e.compareConnectedSegments=function(e,s,i){const r=n.makeObjectArray(n.Point2D,4);let o=e.queryControlPointsHelper(r);const a=n.makeObjectArray(n.Point2D,4);let m=s.queryControlPointsHelper(a);r[0].equals(a[0])||t.throwNonSimpleGeometryException("");const h=e.getGeometryType();if(h===s.getGeometryType()&&r.map((e,t)=>a[t].equals(e)).reduce((e,t)=>e&&t)){if(h!==t.GeometryType.enumRationalBezier2)return 0;{const t=s,n=[0,0,0],i=[0,0,0];if(e.queryWeights(n),t.queryWeights(i),n.map((e,t)=>i[t]===e).reduce((e,t)=>e&&t))return 0}}for(;o>2&&r[1].equals(r[0]);)r.splice(1,1),o--;for(;m>2&&a[1].equals(a[0]);)a.splice(1,1),m--;(r[1].equals(r[0])||a[1].equals(r[0]))&&t.throwNonSimpleGeometryException("");const l=n.Point2D.compareVectorsOrigin(r[0],r[1],a[1]);if(0===l){const t=P.constructPoint2D(r[0]),n=new P;e.queryCoord2DMP(1e-16,n),n.sub(t);const i=new P;return s.queryCoord2DMP(1e-16,i),i.sub(t),i.crossProduct(n).sign()}return l},e.construct=function(e){if(e.isEmpty())return new es({vd:e.getDescription()});if(t.isMultiPath(e.getGeometryType())&&e.hasNonLinearSegments())return function(e){t.geometryReleaseAssert(e.hasNonLinearSegments()&&!e.isEmpty());const s=new hs;return s.addGeometry(e),s.getBoundingGeometry()}(e);const i=e.getImpl(),r=i.getPointCount();if(r<=2){if(1===r||i.getXY(0).equals(i.getXY(1))){const e=new s.Point({vd:i.getDescription()});return i.getPointByVal(0,e),e}{const e=new s.Point,t=new xe({vd:i.getDescription()});return i.getPointByVal(0,e),t.startPathPoint(e),i.getPointByVal(1,e),t.lineToPoint(e),t}}const o=i.getAttributeStreamRef(0),a=new hs({stream:o,n:r});let m=1;const h=o.readPoint2D(0),l=new n.Point2D;for(;m<r&&o.queryPoint2D(m<<1,l).equals(h);)m++;if(a.m_treeHull.addElement(0),m<r){a.m_treeHull.addBiggestElement(m);const e=new n.Point2D;for(let t=m+1;t<i.getPointCount();t++){o.queryPoint2D(t<<1,e);const s=a.treeHull(e);-1!==s&&a.m_treeHull.setElement(s,t)}}const u=i.getDescription(),c=u.getAttributeCount()>1,g=a.m_treeHull.size();let d=null;if(g>=2){d=g>=3?new es({vd:u}):new xe({vd:u});const e=d.getImpl();e.reserve(a.m_treeHull.size()),e.addPathPoint2D(null,0,!0);const t=new n.Point2D;for(let n=a.m_treeHull.getFirst();-1!==n;n=a.m_treeHull.getNext(n))if(c){const t=new s.Point;i.getPointByVal(a.m_treeHull.getElement(n),t),e.insertPoint(0,-1,t)}else o.queryPoint2D(a.m_treeHull.getElement(n)<<1,t),e.insertPoint2D(0,-1,t)}else if(c){const e=new s.Point({vd:u});i.getPointByVal(a.m_treeHull.getElement(a.m_treeHull.getFirst()),e),d=e}else{const e=o.readPoint2D(a.m_treeHull.getElement(a.m_treeHull.getFirst())<<1);d=new s.Point(e)}return d},e.constructCircularArcHelperForOldFormat=tr,e.constructOrientedMinimumBoundingBox=function(e,s,i,r,o){if(function(e,t,s){e.setNAN(),t.setCoords(1,0),s.setCoords(0,0)}(i,r,o),e.isEmpty())return;if(e.getGeometryType()===t.GeometryType.enumPoint)return void i.assign(e.getXY());const a=e,m=a.getPointCount();0!==m&&(1!==m?function(e,t,s,i,r,o){if(2===t){const t=e.getXY(0),s=e.getXY(1);i.assign(t.add(s).mul(.5));const n=s.sub(t);r=ps(n),o.setCoords(.5*n.length(),0)}else{let a=Number.MAX_VALUE;const m=[0,1,0,0],h=new n.SmallMatrix(4,2);for(h.set(0,0,0),h.set(0,1,1),h.set(1,0,1),h.set(1,1,2);m[0]<t;++m[0],_s(h,0,t)){m[1]===m[0]&&(++m[1],_s(h,1,t));for(let s=1;;++s){for(;;){const n=fs(e.getXY(h.get(0,0)),e.getXY(h.get(0,1)),e.getXY(h.get(s,0)),e.getXY(h.get(s,1)),2^s);if(n>0)break;if(++m[s],_s(h,s,t),0===n)break}if(3===s)break;m[s+1]<m[s]&&(m[s+1]=m[s],h.set(s+1,0,h.get(s,0)),h.set(s+1,1,h.get(s,1)))}const l=e.getXY(h.get(0,0)).add(e.getXY(h.get(2,0))).mul(.5),u=ps(e.getXY(h.get(0,1)).sub(e.getXY(h.get(0,0)))),c=new n.Point2D;let g,d;if(c.x=Math.max(0,u.dotProduct(e.getXY(h.get(1,0)).sub(e.getXY(h.get(3,0))))),c.y=Math.max(0,u.crossProduct(e.getXY(h.get(0,0)).sub(e.getXY(h.get(2,0))))),s?(g=c.x*c.y,d=g<a):(g=c.y,d=g<a),d){a=g;const t=e.getXY(h.get(1,0)),s=e.getXY(h.get(3,0)),n=t.add(s).mul(.5).sub(l);i.assign(l.add(u.mul(u.dotProduct(n)))),r.assign(u),o.assign(c)}}o.mulThis(.5),o.x<o.y&&(o.y=n.swap(o.x,o.x=o.y),r.leftPerpendicularThis())}r.y<0?r.negateThis():0===r.y&&(r.x=1)}(a,m,s,i,r,o):i.assign(a.getXY(0)))},e.convertToDegrees=fi,e.convertToRadians=_i,e.defaultRank=1,e.densify=function(e,t,s,i,r,o){return new Ii(0,0,0,null,!1,n.intMax()).densifyEx(e,t,s,i,!1,o)},e.ensureXYMonotoneSegment$1=Fs,e.forEachDir=function(e,t,s){if(e)for(let e=t.length-1;e>=0;--e)s(t[e]);else t.forEach(s)},e.generateGeometryCursor=function(e,t=-1){return new B(e,t)},e.getPolynomialCoefs$1=Ps,e.groupTransform=function(e,t,s){if(0===e.length)return;let n=0,i=0;for(++i;i!==e.length;++i)t(e[n],e[i])||(s(n,i),n=i);s(n,i)},e.hasNonEmptyBoundary=function e(s,n){if(s.isEmpty())return!1;const i=s.getGeometryType();if(i===Pe.enumPolygon)return 0!==s.calculateArea2D();if(i===Pe.enumPolyline)return ve(s.getImpl(),0,!0).bNotEmpty;if(i===Pe.enumEnvelope)return!0;if(t.isSegment(i))return!!s.isClosed();if(t.isPoint(i))return!1;if(i===Pe.enumGeometryCollection){const t=s;for(let s=0,i=t.getGeometryCount();s<i;s++)if(e(t.getGeometry(s),n))return!0;return!1}t.throwNotImplementedException("")},e.integrateByRomberg=lt,e.intersect=Ir,e.intersectInfiniteLines=function(e,t){const s={bIntersect:!1,t1:Number.NaN,t2:Number.NaN},n=e.m_XEnd-e.m_XStart,i=e.m_YEnd-e.m_YStart,r=t.m_XEnd-t.m_XStart,o=t.m_YEnd-t.m_YStart,a=r*i-n*o;if(0===a)return s;const m=t.m_XStart-e.m_XStart,h=t.m_YStart-e.m_YStart,l=r*h-m*o,u=n*h-m*i,c=1/a;return s.t1=l*c,s.t2=u*c,s.bIntersect=!0,s},e.isEndPointModified=mr,e.isExactOverlap2d=br,e.isIdenticalType=Sr,e.isIntersecting=Cr,e.isIntersectingEx=Dr,e.isPathConvex=function(e,s,i){if((s<0||s>=e.getPathCount())&&t.throwInvalidArgumentException("path index"),e.hasNonLinearSegmentsPath(s))return!1;const r=e.getImpl(),o=r.getPathStart(s),a=r.getPathEnd(s),m=!r.isClosedPath(s)&&r.isClosedPathInXYPlane(s),h=r.getAttributeStreamRef(0),l=2*o;let u=2*a;if(m&&(u-=2),u-l<6)return!0;const c=h.readPoint2D(l),g=h.readPoint2D(l+2),d=h.readPoint2D(l+4);if(!cs(n.Point2D.orientationRobust(g,d,c)))return!1;const p=g.clone(),_=new n.Point2D;for(let e=l+6;e<u;e+=2){if(_.assign(g),g.assign(d),h.queryPoint2D(e,d),!cs(n.Point2D.orientationRobust(g,d,c)))return!1;if(!cs(n.Point2D.orientationRobust(p,d,c)))return!1;if(!cs(n.Point2D.orientationRobust(g,d,_)))return!1}return!0},e.minTolerance=V,e.minimumBoundingCircle=function(e,s,n){e.isEmpty()&&t.throwEmptyGeometryException(""),t.throwIfCurves(e);const i=e.getImpl(),r=[];return Ci(i.getPointCount(),r),Di((o=i,{at:e=>o.getXY(e)}),r,i.getPointCount(),s);var o},e.minimumBoundingCirclePoint2D=vi,e.nthElement=function(e,t,s,i,r){n.sortRange(e,t,i-t,(e,t)=>r(e,t)?-1:1)},e.nullHandle=ss,e.nurbs2ToArc128=function(e,t,s,n,i){return cr(e,t,s,n,i)},e.orientBottomUp=ee,e.quadraticRealRoots$2=De,e.replaceAllCurvesWithBeziers=function(e,s,n,i){return Number.isFinite(s)||t.throwInvalidArgumentException("replace_all_curves_with_beziers: maxDeviation"),function(e,s,n,i){t.geometryReleaseAssert(e===t.GeometryType.enumBezier||e===t.GeometryType.enumEllipticArc||e===t.GeometryType.enumBezier2);const r=s.createInstance();r.getGeometryType()===t.GeometryType.enumPolygon&&r.setFillRule(s.getFillRule());const o=s.querySegmentIterator();for(let a=0,m=s.getPathCount();a<m;++a){if(!s.hasNonLinearSegmentsPath(a)){r.addPath(s,a,!0);continue}const m=s.getPathStart(a);let h=!0,l=0;for(o.resetToPath(a),t.geometryReleaseAssert(o.nextPath());o.hasNextSegment();){const u=o.nextCurve();if(!u)break;{const c=o.getStartPointIndex()-m,g=c-l;g>0&&(r.addSegmentsFromPath(s,a,l,g,h),h=!1),l=c+1,e===t.GeometryType.enumBezier?Ti(r,u,n,i,h):e===t.GeometryType.enumBezier2?Ai(r,u,n,i,h):t.throwInternalErrorException(""),h=!1}}const u=s.getSegmentCountPath(a);u-l!==0&&r.addSegmentsFromPath(s,a,l,u-l,h)}return r}(t.GeometryType.enumBezier,e,s,n)},e.rotate=function(e,t,s,n){h(e,t,s-1),h(e,s,n-1),e.reverse()},e.shorterArcDistance=function(e,t){return pi(t-e)},e.shuffle=m,e.sizeInBuffer=ce,e.solve$1=Ce,e.tToParametricAngle=Bi})},"esri/chunks/Transformation2D":function(){define(["exports","./Geometry","./Point2D"],function(e,t,s){"use strict";class n{constructor(e,t,s){if(e instanceof n)return this.data=e.data,this.N=e.N,this.M=e.M,e.data=null,e.N=0,void(e.M=0);this.data=e,this.N=t,this.M=s}assignCopy(e){return this===e||(t.geometryReleaseAssert(this.N*this.M===e.N*e.M),this.data.set(e.data),this.N=e.N,this.M=e.M),this}setZero(){return this.data?.fill(0),this}setIdentity(){for(let e=0;e<this.N;e++)for(let t=0;t<this.M;t++)this.setRowCol(e,t,e===t?1:0);return this}rows(){return this.N}cols(){return this.M}row(e){return t.geometryReleaseAssert(0),{}}set(e,t){return this.data[e]=t,this}setRowCol(e,t,s){return this.data[e*this.M+t]=s,this}at(e){return this.data[e]}atRowCol(e,t){return this.data[e*this.M+t]}mulScalar(e,s){t.geometryReleaseAssert(0)}mul(e,s){if(t.geometryReleaseAssert(this.M===e.rows()),t.geometryReleaseAssert(this.N===s.rows()),t.geometryReleaseAssert(e.cols()===s.cols()),s===this){const t=new Float64Array(this.N*this.M),i=new n(t,this.N,this.M);return this.mul(e,i),void s.assignCopy(i)}if(s===e){const t=new Float64Array(e.N*e.M),i=new n(t,e.N,e.M);return this.mul(e,i),void s.assignCopy(i)}const i=e.cols();for(let t=0;t<this.N;t++)for(let n=0;n<i;n++){let i=0;for(let s=0;s<this.M;s++)i+=this.atRowCol(t,s)*e.atRowCol(s,n);s.setRowCol(t,n,i)}}mulTranspose(e,s){if(t.geometryReleaseAssert(this.M===e.cols()),t.geometryReleaseAssert(this.N===s.rows()),t.geometryReleaseAssert(e.rows()===s.cols()),s===this){const t=new Float64Array(this.N*this.M),i=new n(t,this.N,this.M);return this.mulTranspose(e,i),void s.assignCopy(i)}if(s===e){const t=new Float64Array(e.N*e.M),i=new n(t,e.N,e.M);return this.mulTranspose(e,i),void s.assignCopy(i)}const i=e.rows();for(let t=0;t<this.N;t++)for(let n=0;n<i;n++){let i=0;for(let s=0;s<this.M;s++)i+=this.atRowCol(t,s)*e.atRowCol(n,s);s.setRowCol(t,n,i)}}mulLeft(e,s){t.geometryReleaseAssert(0)}mulLeftTranspose(e,s){t.geometryReleaseAssert(0)}mulDiag(e,s){if(t.geometryReleaseAssert(this.M===e.N*e.M),t.geometryReleaseAssert(this.N===s.rows()),t.geometryReleaseAssert(this.M===s.cols()),s===this){const t=new Float64Array(this.N*this.M),i=new n(t,this.N,this.M);return this.mulDiag(e,i),void s.assignCopy(i)}const i=this.M;for(let t=0;t<this.N;t++)for(let n=0;n<i;n++)s.setRowCol(t,n,this.atRowCol(t,n)*e.at(n))}transposeInPlace(){if(this.N===this.M){for(let e=0;e<this.N;e++)for(let t=e+1;t<this.M;t++){const s=this.atRowCol(e,t);this.setRowCol(e,t,this.atRowCol(t,e)),this.setRowCol(t,e,s)}return this}const e=new Float64Array(this.N*this.M),t=new n(e,this.N,this.M);return t.assignCopy(this),this.M=s.swap(this.N,this.N=this.M),t.transpose(this),this}transpose(e){if(this!==e){n.checkDims(e,this.M,this.N);for(let t=0;t<this.N;t++)for(let s=0;s<this.M;s++)e.setRowCol(s,t,this.atRowCol(t,s))}else e.transposeInPlace()}add(e,t){}svd(e,s,i,r=!1){if(n.checkDims(e,this.N,this.M),n.checkDims(s,this.M,1),n.checkDims(i,this.M,this.M),r){if(t.geometryReleaseAssert(this.N===this.M),!this.symmetricEigen(s,i))return!1;for(let e=0;e<this.M;++e)s.at(e)<0&&s.set(e,0);return e.assignCopy(i),!0}let o,a,m,h,l,u,c,g=0,d=0,p=0,_=0,f=0;const y=this.M,x=this.N;e.assignCopy(this);const P=new Float64Array(y),E=new n(P,y,1),v=(e,t)=>t>=0?Math.abs(e):-Math.abs(e),C=(e,t)=>{if((e=Math.abs(e))>(t=Math.abs(t))){const s=t/e;return e*Math.sqrt(s*s+1)}if(t>0){const s=e/t;return t*Math.sqrt(s*s+1)}return 0};for(let t=0;t<y;t++){if(g=t+1,E.set(t,_*p),p=h=_=0,t<x){for(let s=t;s<x;s++)_+=Math.abs(e.atRowCol(s,t));if(_){for(let s=t;s<x;s++)e.setRowCol(s,t,e.atRowCol(s,t)/_),h+=e.atRowCol(s,t)*e.atRowCol(s,t);a=e.atRowCol(t,t),p=-v(Math.sqrt(h),a),m=a*p-h,e.setRowCol(t,t,a-p);for(let s=g;s<y;s++){h=0;for(let n=t;n<x;n++)h+=e.atRowCol(n,t)*e.atRowCol(n,s);a=h/m;for(let n=t;n<x;n++)e.setRowCol(n,s,e.atRowCol(n,s)+a*e.atRowCol(n,t))}for(let s=t;s<x;s++)e.setRowCol(s,t,e.atRowCol(s,t)*_)}}if(s.set(t,_*p),p=h=_=0,t<x&&t!==y-1){for(let s=g;s<y;s++)_+=Math.abs(e.atRowCol(t,s));if(_){for(let s=g;s<y;s++)e.setRowCol(t,s,e.atRowCol(t,s)/_),h+=e.atRowCol(t,s)*e.atRowCol(t,s);a=e.atRowCol(t,g),p=-v(Math.sqrt(h),a),m=a*p-h,e.setRowCol(t,g,a-p);for(let s=g;s<y;s++)E.set(s,e.atRowCol(t,s)/m);for(let s=g;s<x;s++){h=0;for(let n=g;n<y;n++)h+=e.atRowCol(s,n)*e.atRowCol(t,n);for(let t=g;t<y;t++)e.setRowCol(s,t,e.atRowCol(s,t)+h*E.at(t))}for(let s=g;s<y;s++)e.setRowCol(t,s,e.atRowCol(t,s)*_)}}const n=Math.abs(s.at(t))+Math.abs(E.at(t));f=n>f?n:f}for(let t=y-1;t>=0;t--){if(t<y-1){if(p){for(let s=g;s<y;s++)i.setRowCol(s,t,e.atRowCol(t,s)/e.atRowCol(t,g)/p);for(let s=g;s<y;s++){h=0;for(let n=g;n<y;n++)h+=e.atRowCol(t,n)*i.atRowCol(n,s);for(let e=g;e<y;e++)i.setRowCol(e,s,i.atRowCol(e,s)+h*i.atRowCol(e,t))}}for(let e=g;e<y;e++)i.setRowCol(t,e,0),i.setRowCol(e,t,0)}i.setRowCol(t,t,1),p=E.at(t),g=t}for(let t=(x<y?x:y)-1;t>=0;t--){g=t+1,p=s.at(t);for(let s=g;s<y;s++)e.setRowCol(t,s,0);if(p){p=1/p;for(let s=g;s<y;s++){h=0;for(let n=g;n<x;n++)h+=e.atRowCol(n,t)*e.atRowCol(n,s);a=h/e.atRowCol(t,t)*p;for(let n=t;n<x;n++)e.setRowCol(n,s,e.atRowCol(n,s)+a*e.atRowCol(n,t))}for(let s=t;s<x;s++)e.setRowCol(s,t,e.atRowCol(s,t)*p)}else for(let s=t;s<x;s++)e.setRowCol(s,t,0);e.setRowCol(t,t,e.atRowCol(t,t)+1)}for(let t=y-1;t>=0;t--)for(let n=1;;n++){let r=1;for(g=t;g>=0;g--){if(d=g-1,Math.abs(E.at(g))+f===f){r=0;break}if(Math.abs(s.at(d))+f===f)break}if(r){o=0,h=1;for(let n=g;n<=t&&(a=h*E.at(n),E.set(n,E.at(n)*o),Math.abs(a)+f!==f);n++){p=s.at(n),m=C(a,p),s.set(n,m),m=1/m,o=p*m,h=-a*m;for(let t=0;t<x;t++)u=e.atRowCol(t,d),c=e.atRowCol(t,n),e.setRowCol(t,d,u*o+c*h),e.setRowCol(t,n,c*o-u*h)}}if(c=s.at(t),g===t){if(c<0){s.set(t,-c);for(let e=0;e<y;e++)i.setRowCol(e,t,-i.atRowCol(e,t))}break}if(100===n)return!1;l=s.at(g),d=t-1,u=s.at(d),p=E.at(d),m=E.at(t),a=((u-c)*(u+c)+(p-m)*(p+m))/(2*m*u),p=C(a,1),a=((l-c)*(l+c)+m*(u/(a+v(p,a))-m))/l,o=h=1;for(let t=g;t<=d;t++){const n=t+1;p=E.at(n),u=s.at(n),m=h*p,p*=o,c=C(a,m),E.set(t,c),o=a/c,h=m/c,a=l*o+p*h,p=p*o-l*h,m=u*h,u*=o;for(let e=0;e<y;e++)l=i.atRowCol(e,t),c=i.atRowCol(e,n),i.setRowCol(e,t,l*o+c*h),i.setRowCol(e,n,c*o-l*h);c=C(a,m),s.set(t,c),c&&(c=1/c,o=a*c,h=m*c),a=o*p+h*u,l=o*u-h*p;for(let s=0;s<x;s++)u=e.atRowCol(s,t),c=e.atRowCol(s,n),e.setRowCol(s,t,u*o+c*h),e.setRowCol(s,n,c*o-u*h)}E.set(g,0),E.set(t,a),s.set(t,l)}const D=new Float64Array(this.N),b=new Float64Array(this.M),S=new n(D,this.N,1),I=new n(b,this.M,1);let w=1;do{w*=3,w++}while(w<=this.M);do{w/=3,w=Math.trunc(w);for(let t=w;t<this.M;t++){const n=s.at(t);for(let s=0;s<this.N;s++)S.set(s,e.atRowCol(s,t));for(let e=0;e<this.M;e++)I.set(e,i.atRowCol(e,t));let r=t;for(;s.at(r-w)<n;){s.set(r,s.at(r-w));for(let t=0;t<this.N;t++)e.setRowCol(t,r,e.atRowCol(t,r-w));for(let e=0;e<this.M;e++)i.setRowCol(e,r,i.atRowCol(e,r-w));if(r-=w,r<w)break}s.set(r,n);for(let t=0;t<this.N;t++)e.setRowCol(t,r,S.at(t));for(let e=0;e<this.M;e++)i.setRowCol(e,r,I.at(e))}}while(w>1);for(let t=0;t<this.M;t++){let s=0;for(let n=0;n<this.N;n++)e.atRowCol(n,t)<0&&s++;for(let e=0;e<this.M;e++)i.atRowCol(e,t)<0&&s++;if(s>Math.trunc((this.N+this.M)/2)){for(let s=0;s<this.N;s++)e.setRowCol(s,t,-e.atRowCol(s,t));for(let e=0;e<this.M;e++)i.setRowCol(e,t,-i.atRowCol(e,t))}}return!0}isSymmetric(){if(this.N!==this.M)return!1;for(let e=0;e<this.N;e++)for(let t=e+1;t<this.M;t++)if(this.atRowCol(e,t)!==this.atRowCol(t,e))return!1;return!0}isZero(){return t.geometryReleaseAssert(0),!1}isIdentity(){return t.geometryReleaseAssert(0),!1}equals(e,s){if(void 0!==s&&t.geometryReleaseAssert(0),this.N!==e.N||this.M!==e.M)return!1;for(let t=0;t<this.N*this.M;t++)if(this.data[t]!==e.data[t])return!1;return!0}maxElement(){return t.geometryReleaseAssert(0),0}minElement(){return t.geometryReleaseAssert(0),0}determinant(){if(t.geometryReleaseAssert(this.N===this.M),1===this.N)return this.data[0];if(2===this.N)return this.data[0]*this.data[3]-this.data[1]*this.data[2];if(3===this.N){const e=this;return e.atRowCol(0,0)*(e.atRowCol(1,1)*e.atRowCol(2,2)-e.atRowCol(1,2)*e.atRowCol(2,1))-e.atRowCol(0,1)*(e.atRowCol(1,0)*e.atRowCol(2,2)-e.atRowCol(2,0)*e.atRowCol(1,2))+e.atRowCol(0,2)*(e.atRowCol(1,0)*e.atRowCol(2,1)-e.atRowCol(1,1)*e.atRowCol(2,0))}const e=new Float64Array(this.N*this.N),s=new n(e,this.N,this.N),i=new Float64Array(this.N);if(!this.luDecomposition(s,i))return 0;let r=1;for(let e=0;e<this.N;e++)r*=s.atRowCol(e,e),i[e]!==e&&(r=-r);return r}submatrix(e,s,n){t.geometryReleaseAssert(0)}inverse(e){t.geometryReleaseAssert(0)}pseudoInverse(e,t=!1,s=2220446049250313e-31){if(e.setZero(),1===this.N&&1===this.M)return 0!==this.atRowCol(0,0)?e.setRowCol(0,0,1/this.atRowCol(0,0)):e.setRowCol(0,0,0),!0;if(2===this.N&&2===this.M){const t=this.atRowCol(0,0)*this.atRowCol(1,1)-this.atRowCol(0,1)*this.atRowCol(1,0),s=1e-5*(Math.abs(this.atRowCol(0,0)*this.atRowCol(1,1))+Math.abs(this.atRowCol(0,1)*this.atRowCol(1,0)));if(Math.abs(t)>s)return e.setRowCol(0,0,this.atRowCol(1,1)/t),e.setRowCol(0,1,-this.atRowCol(0,1)/t),e.setRowCol(1,0,-this.atRowCol(1,0)/t),e.setRowCol(1,1,this.atRowCol(0,0)/t),!0}const i=new Float64Array(this.N*this.M),r=new n(i,this.N,this.M),o=new Float64Array(this.M),a=new n(o,this.M,1),m=new Float64Array(this.M*this.M),h=new n(m,this.M,this.M);if(!this.svd(r,a,h,t))return!1;const l=Math.max(this.N,this.M),u=s*Math.abs(a.at(0))*l;for(let e=0;e<this.M;e++)a.at(e)>u?a.set(e,1/a.at(e)):a.set(e,0);return h.mulDiag(a,e),e.mulTranspose(r,e),!0}luDecomposition(e,s){return t.geometryReleaseAssert(0),!1}symmetricEigen(e,s){t.geometryReleaseAssert(this.rows()===this.cols()),t.geometryReleaseAssert(this.rows()===e.rows()),t.geometryReleaseAssert(s.rows()===s.cols()&&s.rows()===this.rows()),t.geometryReleaseAssert(this.isSymmetric());const i=new Float64Array(this.N*this.M),r=new n(i,this.N,this.M);r.assignCopy(this);const o=100/Number.EPSILON,a=this.rows(),m=new Float64Array(a),h=new Float64Array(a),l=new n(m,a,1),u=new n(h,a,1);for(let t=0;t<a;t++)l.set(t,r.atRowCol(t,t)),e.set(t,r.atRowCol(t,t)),u.set(t,0);s.setIdentity();const c=()=>{const t=l;s.transposeInPlace();let n=1;do{n*=3,n++}while(n<=a);do{n/=3,n=Math.trunc(n);for(let i=n;i<a;i++){const r=e.at(i),o=Math.abs(r);for(let e=0;e<this.M;e++)t.set(e,s.atRowCol(e,i));let a=i;for(;Math.abs(e.at(a-n))<o;){e.set(a,e.at(a-n));for(let e=0;e<this.M;e++)s.setRowCol(e,a,s.atRowCol(e,a-n));if(a-=n,a<n)break}if(a!==i){e.set(a,r);for(let e=0;e<this.M;e++)s.setRowCol(e,a,t.at(e))}}}while(n>1)};for(let t=1;;t++){let n=0;for(let e=1;e<a;e++)for(let t=0;t<e;t++)n+=Math.abs(r.atRowCol(e,t));if(0===n)return c(),!0;const i=t<4?.2*n/(a*a):0;for(let n=0;n<a;n++)for(let m=n+1;m<a;m++){let h=o*Math.abs(r.atRowCol(m,n));if(t>4&&h<=Math.abs(e.at(n))&&h<=Math.abs(e.at(m)))r.setRowCol(m,n,0);else if(Math.abs(r.atRowCol(m,n))>i){let t,i=e.at(m)-e.at(n);if(h<Math.abs(i))t=r.atRowCol(m,n)/i;else{const e=.5*i/r.atRowCol(m,n);t=1/(Math.abs(e)+Math.sqrt(1+e*e)),e<0&&(t=-t)}const o=1/Math.sqrt(1+t*t),l=t*o,c=l/(1+o);i=t*r.atRowCol(m,n),u.set(n,u.at(n)-i),u.set(m,u.at(m)+i),e.set(n,e.at(n)-i),e.set(m,e.at(m)+i),r.setRowCol(m,n,0);let g=0;for(;g<n;g++)h=r.atRowCol(n,g),i=r.atRowCol(m,g),r.setRowCol(n,g,h-l*(i+h*c)),r.setRowCol(m,g,i+l*(h-i*c));for(g++;g<m;g++)h=r.atRowCol(g,n),i=r.atRowCol(m,g),r.setRowCol(g,n,h-l*(i+h*c)),r.setRowCol(m,g,i+l*(h-i*c));for(g++;g<a;g++)h=r.atRowCol(g,n),i=r.atRowCol(g,m),r.setRowCol(g,n,h-l*(i+h*c)),r.setRowCol(g,m,i+l*(h-i*c));for(g=0;g<a;g++)h=s.atRowCol(n,g),i=s.atRowCol(m,g),s.setRowCol(n,g,h-l*(i+h*c)),s.setRowCol(m,g,i+l*(h-i*c))}}for(let t=0;t<a;t++)l.set(t,l.at(t)+u.at(t)),e.set(t,l.at(t)),u.set(t,0)}}static checkDims(e,s,n){t.geometryReleaseAssert(e.rows()===s&&e.cols()===n)}}class i extends n{constructor(e){if(e.copy){const t=new Float64Array(e.copy.N*e.copy.M);return super(t,e.copy.N,e.copy.M),this.buffer=t,void this.assignCopy(e.copy)}const t=new Float64Array(e.NN*e.MM);super(t,e.NN,e.MM),this.buffer=t,e.initializerList&&s.memcpy(this.buffer,e.initializerList,0,0,e.initializerList.length)}assignCopy(e){return this===e||super.assignCopy(e),this}}class r{constructor(e){this.m_TransformationType=1,void 0===e?this.setIdentity():e instanceof r?this.set(e):this.setScale(e)}set(e){return this.xx=e.xx,this.xy=e.xy,this.xd=e.xd,this.yx=e.yx,this.yy=e.yy,this.yd=e.yd,this}clone(){return(new r).set(this)}setZero(){this.xx=0,this.yy=0,this.xy=0,this.yx=0,this.xd=0,this.yd=0}isEqual(e){return this===e||this.xx===e.xx&&this.xy===e.xy&&this.xd===e.xd&&this.yx===e.yx&&this.yy===e.yy&&this.yd===e.yd}transformInPlace(e){const t=this.xx*e.x+this.xy*e.y+this.xd,s=this.yx*e.x+this.yy*e.y+this.yd;e.x=t,e.y=s}transform(e){const t=e.clone();return this.transformInPlace(t),t}queryTransform(e,t){const s=this.xx*e.x+this.xy*e.y+this.xd,n=this.yx*e.x+this.yy*e.y+this.yd;t.setCoords(s,n)}transformEnvInPlace(e){if(e.isEmpty())return;const t=s.makeObjectArray(s.Point2D,4);e.queryCorners(t),this.transformPoints2D(t,4,t),e.setFromPoints(t,4)}queryTransformEnv(e,s){t.geometryReleaseAssert(0)}transformPoints2D(e,t,s){for(let n=0;n<t;++n)this.queryTransform(e[n],s[n])}transformInterleavedPoints(e,t,n){t*=2;const i=s.Point2D.getNAN();for(let s=0;s<t;s+=2)i.x=e[s],i.y=e[s+1],this.transformInPlace(i),n[s]=i.x,n[s+1]=i.y}multiply(e){return r.st_multiply(this,e,this),this}mulLeft(e){return t.geometryReleaseAssert(0),this}static st_multiply(e,t,s){const n=e.xx*t.xx+e.yx*t.xy,i=e.xy*t.xx+e.yy*t.xy,r=e.xd*t.xx+e.yd*t.xy+t.xd,o=e.xx*t.yx+e.yx*t.yy,a=e.xy*t.yx+e.yy*t.yy,m=e.xd*t.yx+e.yd*t.yy+t.yd;s.xx=n,s.xy=i,s.xd=r,s.yx=o,s.yy=a,s.yd=m}getCoefficients(e){t.geometryReleaseAssert(e.length>=6),e[0]=this.xx,e[1]=this.xy,e[2]=this.xd,e[3]=this.yx,e[4]=this.yy,e[5]=this.yd}setCoefficients(e){t.geometryReleaseAssert(e.length>=6),this.xx=e[0],this.xy=e[1],this.xd=e[2],this.yx=e[3],this.yy=e[4],this.yd=e[5]}copyTo(e){t.geometryReleaseAssert(0)}initializeFromRect(e,t){e.isEmpty()||t.isEmpty()||!e.width()||!e.height()?this.setZero():(this.xy=this.yx=0,this.xx=t.width()/e.width(),this.yy=t.height()/e.height(),this.xd=t.xmin-e.xmin*this.xx,this.yd=t.ymin-e.ymin*this.yy)}initializeFromRectIsotropic(e,t){if(e.isEmpty()||!e.width()||!e.height()||t.isEmpty())this.setZero();else{this.yx=0,this.xy=0,this.xx=t.width()/e.width(),this.yy=t.height()/e.height(),this.xx>this.yy?this.xx=this.yy:this.yy=this.xx;const s=t.getCenter(),n=e.getCenter();this.xd=s.x-n.x*this.xx,this.yd=s.y-n.y*this.yy}}initializeFromTwoPointsArray(e,n){if(e[0].equals(n[0])&&e[1].equals(n[1]))return void this.setIdentity();if(e[0].equals(e[1])){if(n[0].equals(n[1]))return void this.setShift(n[0].sub(e[0]));t.throwInvalidArgumentException("")}if(!e[0].equals(e[1])&&n[0].equals(n[1]))return this.setZero(),void this.shift(n[0]);this.setShiftCoords(-e[0].x,-e[0].y);const i=s.Point2D.distance(e[0],e[1]),r=s.Point2D.distance(n[0],n[1]),o=r/i;this.scale(o,o);const a=e[1].sub(e[0]);a.divThis(i);const m=n[1].sub(n[0]);m.divThis(r);const h=a.crossProduct(m),l=a.dotProduct(m);this.rotate(l,h),this.shiftCoords(n[0].x,n[0].y)}initializeFromTwoPoints(e,t,s,n){const i=[e,t],r=[s,n];this.initializeFromTwoPointsArray(i,r)}transformSizeInPlace(e){t.geometryReleaseAssert(0)}transformSize(e,s){t.geometryReleaseAssert(0)}transformTol(e){return t.geometryReleaseAssert(0),0}transformWithoutTranslateArray(e,t,s){for(let n=0;n<t;++n)this.transformWithoutTranslate(e[n],s[n])}transformWithoutTranslateInPlace(e){const t=this.xx*e.x+this.xy*e.y,s=this.yx*e.x+this.yy*e.y;e.setCoords(t,s)}transformWithoutTranslate(e,t){const s=this.xx*e.x+this.xy*e.y,n=this.yx*e.x+this.yy*e.y;t.setCoords(s,n)}setIdentity(){this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=1,this.yd=0}isIdentity(){return!(1!==this.xx||1!==this.yy||this.xy||this.xd||this.yx||this.yd)}isIdentityTol(e){const t=e*e;return!(s.sqr(this.xd)+s.sqr(this.yd)>t||s.sqr(this.xy+this.xd)+s.sqr(this.yy+this.yd-1)>t||s.sqr(this.xx+this.xd-1)+s.sqr(this.yx+this.yd)>t)}isReflective(){return this.xx*this.yy-this.yx*this.xy<0}isUniform(e){const t=this.xx*this.xx+this.yx*this.yx,s=this.xy*this.xy+this.yy*this.yy,n=(t+s)*e;return Math.abs(t-s)<=n&&Math.abs(this.xx*this.xy+this.yx*this.yy)<=n}isUniformNoRotation(){return 0!==this.xx&&Math.abs(this.xx)===Math.abs(this.yy)&&0===this.xy&&0===this.yx}isTranslate(){return 1===this.xx&&1===this.yy&&!this.xy&&!this.yx}isTranslateTol(e){const t=new s.Point2D;return t.setCoords(0,1),this.transformWithoutTranslateInPlace(t),t.y-=1,!(t.sqrLength()>e*e)&&(t.setCoords(1,0),this.transformWithoutTranslateInPlace(t),t.x-=1,t.sqrLength()<=e*e)}isOrthonormal(e){const t=new r;return t.xx=this.xx*this.xx+this.xy*this.xy,t.xy=this.xx*this.yx+this.xy*this.yy,t.yx=this.yx*this.xx+this.yy*this.xy,t.yy=this.yx*this.yx+this.yy*this.yy,t.xd=0,t.yd=0,t.isIdentityTol(e)}isDegenerate(e){return Math.abs(this.xx*this.yy-this.yx*this.xy)<=2*e*(Math.abs(this.xx*this.yy)+Math.abs(this.yx*this.xy))}isZero(){return 0===this.xx&&0===this.yy&&0===this.xy&&0===this.yx&&0===this.xd&&0===this.yd}isScaleAndTranslateTol(e){return this.xy*this.xy+this.yx*this.yx<=(this.xx*this.xx+this.yy*this.yy)*e}setTranslate(e,t){return this.xx=1,this.xy=0,this.xd=e,this.yx=0,this.yy=1,this.yd=t,this}setShiftCoords(e,t){return this.xx=1,this.xy=0,this.xd=e,this.yx=0,this.yy=1,this.yd=t,this}setShift(e){return this.xx=1,this.xy=0,this.xd=e.x,this.yx=0,this.yy=1,this.yd=e.y,this}setScaleCoords(e,t){return this.xx=e,this.xy=0,this.xd=0,this.yx=0,this.yy=t,this.yd=0,this}setScale(e){return this.setScaleCoords(e,e),this}setFlipX(e,t){return this.xx=-1,this.xy=0,this.xd=e+t,this.yx=0,this.yy=1,this.yd=0,this}setFlipY(e,t){return this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=-1,this.yd=e+t,this}setShear(e,t){return this.xx=1,this.xy=e,this.xd=0,this.yx=t,this.yy=1,this.yd=0,this}scale(e,t){return this.xx*=e,this.xy*=e,this.xd*=e,this.yx*=t,this.yy*=t,this.yd*=t,this}setRotateAngle(e){return this.setRotate(Math.cos(e),Math.sin(e))}setRotate(e,t){return this.xx=e,this.xy=-t,this.xd=0,this.yx=t,this.yy=e,this.yd=0,this}setRotateAngleAbout(e,t){return this.setRotateAbout(Math.cos(e),Math.sin(e),t)}setRotateAbout(e,t,s){return this.setTranslate(-s.x,-s.y),this.rotate(e,t),this.translate(s.x,s.y)}setSwapCoordinates(){return this.xx=0,this.xy=1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}setRotateCw90(){return this.xx=0,this.xy=1,this.xd=0,this.yx=-1,this.yy=0,this.yd=0,this}setRotateCcw90(){return this.xx=0,this.xy=-1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}shiftCoords(e,t){return this.xd+=e,this.yd+=t,this}shift(e){return this.xd+=e.x,this.yd+=e.y,this}translate(e,t){return this.xd+=e,this.yd+=t,this}flipX(e,t){return this.xx=-this.xx,this.xy=-this.xy,this.xd=e+t-this.xd,this}flipY(e,t){return this.yx=-this.yx,this.yy=-this.yy,this.yd=e+t-this.yd,this}shear(e,t){const s=new r;return s.setShear(e,t),this.multiply(s)}rotateAngle(e){const t=new r;return t.setRotateAngle(e),this.multiply(t)}rotate(e,t){const s=new r;return s.setRotate(e,t),this.multiply(s)}rotateAbout(e,t,s){return this.translate(-s.x,-s.y),this.rotate(e,t),this.translate(s.x,s.y)}rotateAngleAbout(e,t){return this.rotateAbout(Math.cos(e),Math.sin(e),t)}setInvert(e){return this.set(e),this.invertThis()}invertThis(){let e=this.xx*this.yy-this.xy*this.yx;if(0===e)return this.setZero(),this;e=1/e;const t=(this.xy*this.yd-this.xd*this.yy)*e,s=(this.xd*this.yx-this.xx*this.yd)*e,n=this.yy*e,i=-this.xy*e,r=-this.yx*e,o=this.xx*e;return this.xd=t,this.yd=s,this.xx=n,this.yy=o,this.xy=i,this.yx=r,this}invertPrecise(e){return this.set(e),this.invertPreciseThis()}invertPreciseThis(){const e=s.MPValue.constructDouble(this.xy),t=s.MPValue.constructDouble(this.xx),n=t.mulDouble(this.yy).sub(e.mulDouble(this.yx));if(n.isZero())return this.setZero(),this;const i=n.clone();i.invertThis();const r=s.MPValue.constructDouble(this.xd),o=e.mulDouble(this.yd).sub(r.mulDouble(this.yy)).mul(i).toDouble(),a=r.mulDouble(this.yx).sub(t.mulDouble(this.yd)).mul(i).toDouble(),m=i.mulDouble(this.yy).toDouble(),h=i.mulDouble(-this.xy).toDouble(),l=i.mulDouble(-this.yx).toDouble(),u=i.mulDouble(this.xx).toDouble();return this.xd=o,this.yd=a,this.xx=m,this.yy=u,this.xy=h,this.yx=l,this}extractScaleTransform(e,t){const s=Math.sqrt(this.xx*this.xx+this.xy*this.xy),n=Math.sqrt(this.yx*this.yx+this.yy*this.yy);t.setScaleCoords(1/s,1/n),t.multiply(this),e.setScaleCoords(s,n)}setFromTwoTriangles(e,t){let n=!0;for(let s=0;s<3;++s)n=n&&e[s].equals(t[s]);if(n)return this.setIdentity(),!0;const i=new s.Point2D;i.setSub(e[0],e[1]);const r=new s.Point2D;r.setSub(e[0],e[2]);const o=new s.Point2D;o.setSub(t[0],t[1]);const a=new s.Point2D;a.setSub(t[0],t[2]);const m=4*Number.EPSILON*(Math.abs(i.x*r.y)+Math.abs(r.x*i.y));let h=i.x*r.y-i.y*r.x;return Math.abs(h)>m?(h=1/h,this.xx=(o.x*r.y-i.y*a.x)*h,this.xy=(i.x*a.x-o.x*r.x)*h,this.yx=(o.y*r.y-i.y*a.y)*h,this.yy=(i.x*a.y-o.y*r.x)*h,this.xd=t[0].x-(this.xx*e[0].x+this.xy*e[0].y),this.yd=t[0].y-(this.yx*e[0].x+this.yy*e[0].y),!0):(this.setZero(),!1)}initializeFromControlPoints(e,n,m,h,l=null){return 0===n?(this.setIdentity(),void(l&&l.setIdentity())):1===n?(this.setShift(h[0].sub(m[0])),void(l&&l.setShift(m[0].sub(h[0])))):(n<3&&(e=1),void(4===e&&n>2?function(e,n,r,o,m){const h=s.Point2D.average(r,n),l=s.Point2D.average(o,n),u=new i({NN:2,MM:2});u.setZero();const c=new i({NN:2,MM:2});c.setZero();for(let e=0;e<n;++e)u.setRowCol(0,0,u.atRowCol(0,0)+(r[e].x-h.x)*(r[e].x-h.x)),u.setRowCol(0,1,u.atRowCol(0,1)+(r[e].x-h.x)*(r[e].y-h.y)),u.setRowCol(1,1,u.atRowCol(1,1)+(r[e].y-h.y)*(r[e].y-h.y)),c.setRowCol(0,0,c.atRowCol(0,0)+(o[e].x-l.x)*(r[e].x-h.x)),c.setRowCol(0,1,c.atRowCol(0,1)+(o[e].x-l.x)*(r[e].y-h.y)),c.setRowCol(1,0,c.atRowCol(1,0)+(o[e].y-l.y)*(r[e].x-h.x)),c.setRowCol(1,1,c.atRowCol(1,1)+(o[e].y-l.y)*(r[e].y-h.y));u.setRowCol(1,0,u.atRowCol(0,1));const g=new i({NN:2,MM:2});u.pseudoInverse(g,!0)||t.throwMathSingularityException("Failed to compute pseudo inverse"),c.mul(g,c),a(e,c);const d=h.clone();e.transformInPlace(d),e.xd=l.x-d.x,e.yd=l.y-d.y,m&&(c.pseudoInverse(g,!1)||t.throwMathSingularityException("Failed to compute pseudo inverse"),a(m,g),m.transformInPlace(l),m.xd=h.x-l.x,m.yd=h.y-l.y)}(this,n,m,h,l):function(e,n,m,h,l,u){t.geometryReleaseAssert(1===e||0===e||2===e||3===e),n.setIdentity();const c=s.Point2D.average(h,m),g=s.Point2D.average(l,m);if(t.geometryReleaseAssert(e<o.length&&e>0),8&o[e]){const s=new i({NN:2,MM:2});s.setZero();for(let e=0;e<m;++e)s.setRowCol(0,0,s.atRowCol(0,0)+(l[e].x-g.x)*(h[e].x-c.x)),s.setRowCol(1,0,s.atRowCol(1,0)+(l[e].x-g.x)*(h[e].y-c.y)),s.setRowCol(0,1,s.atRowCol(0,1)+(l[e].y-g.y)*(h[e].x-c.x)),s.setRowCol(1,1,s.atRowCol(1,1)+(l[e].y-g.y)*(h[e].y-c.y));const u=new i({NN:2,MM:2}),d=new i({NN:2,MM:1}),p=new i({NN:2,MM:2});s.svd(u,d,p)||t.throwMathSingularityException("Failed to compute svd");const _=new i({NN:2,MM:2});u.transpose(_);const f=new i({NN:2,MM:2});p.mul(_,f),32&o[e]||f.determinant()<0&&(_.setRowCol(1,0,-_.atRowCol(1,0)),_.setRowCol(1,1,-_.atRowCol(1,1)),p.mul(_,f));const y=new r;a(y,f),n.set(y)}if(2&o[e]){let e=0,t=0;for(let s=0;s<m;++s){const i=h[s].sub(c);e+=i.sqrLength(),n.transformInPlace(i),t+=i.dotProduct(l[s].sub(g))}if(0===e)0===t?n.setIdentity():n.setZero();else{const s=t/e;n.scale(s,s)}}else t.geometryReleaseAssert(!(4&o[e]));const d=c.clone();n.transformInPlace(d),n.xd=g.x-d.x,n.yd=g.y-d.y,u&&(u.set(n),u.invertThis(),u.isZero()&&(u.xd=c.x,u.yd=c.y))}(e,this,n,m,h,l)))}calculateErrors(e,n,i,r){t.geometryReleaseAssert(e>0&&null!==n&&null!==i);let o=0;for(let t=0;t<e;++t){const e=this.transform(n[t]),a=s.Point2D.sqrDistance(i[t],e);o+=a,r&&(r[t]=Math.sqrt(a))}return Math.sqrt(o/e)}}const o=[43,11,41,9,61];function a(e,s){t.geometryReleaseAssert(!(2!==s.rows()&&3!==s.rows()||2!==s.cols()&&3!==s.rows())),e.xx=s.atRowCol(0,0),e.xy=s.atRowCol(0,1),e.yx=s.atRowCol(1,0),e.yy=s.atRowCol(1,1),3===s.cols()?(e.xd=s.atRowCol(0,2),e.yd=s.atRowCol(1,2)):(e.xd=0,e.yd=0)}e.Transformation2D=r})},"esri/chunks/ProjectionTransformation":function(){define(["exports","./Envelope2D","./Geometry","./MultiPathImpl","./Envelope","./Point2D","./tslib.es6","./Transformation2D","./OperatorClip","./OperatorDensify","./SimpleGeometryCursor","./OperatorDefinitions"],function(e,t,s,n,i,r,o,a,m,h,l,u){"use strict";class c{constructor(e){if(this.m_geom=this.m_sr=null,e){if(e.move)return this.m_geom=e.move.m_geom,e.move.m_geom=null,this.m_sr=e.move.m_sr,void(e.move.m_sr=null);if(e.copy)return this.m_geom=e.copy.m_geom?e.copy.m_geom.clone():null,void(this.m_sr=e.copy.m_sr);e.geom&&(this.m_geom=e.geom),e.sr&&(this.m_sr=e.sr)}}getGeometry(){return this.m_geom}getSpatialReference(){return this.m_sr}setGeometry(e){this.m_geom=e}setSpatialReference(e){this.m_sr=e}equals(e,t){const s=e;return!(!this.m_sr&&s.m_sr||this.m_sr&&!s.m_sr||!this.m_geom&&s.m_geom||this.m_geom&&!s.m_geom||this.m_sr&&s.m_sr&&!this.m_sr.equals(s.m_sr)||this.m_geom&&s.m_geom&&!this.m_geom.equals(s.m_geom,t))}clone(){let e=null;return this.m_geom&&(e=this.m_geom.clone()),new c({geom:e,sr:this.m_sr})}hasGeom(){return!!this.m_geom}}class g{constructor(e){this.m_factor=1,this.m_wkid=0,this.m_peUnit=null,e&&(this.m_peUnit=e,this.m_factor=e.getUnitFactor(),this.m_wkid=e.getCode(),this.m_wkid<0&&(this.m_wkid=0))}getName(){return this.m_peUnit?this.m_peUnit.getName():""}getID(){return this.m_wkid}getConversionFactor(e){return this.getUnitType()!==e.getUnitType()&&s.throwInvalidArgumentException("unit type mismatch"),this.getUnitToBaseFactor()/e.getUnitToBaseFactor()}getUnitToBaseFactor(){return this.m_factor}getHashCode(){return r.hashCombine(r.hashInt32(this.getUnitType()),r.hashInt32(this.getUnitToBaseFactor()))}equals(e){return!!e&&this.getUnitType()===e.getUnitType()&&this.getUnitToBaseFactor()===e.getUnitToBaseFactor()&&this.getID()===e.getID()&&this.getName()===e.getName()}static isValidWkid(e){return!1}}const d={330:104878,500:104879,1300:104899,1450:104986,2230:104988,3800:104978,5e3:104919,6200:104906,8200:104909,9500:104927,9600:104977,1e4:[104911,104936],11e3:104941,11080:104872,11100:104907,12e3:104920,12400:104995,13e3:104948,14e3:[104923,104989],15e3:[104913,104954],15100:104976,16e3:[104926,104931],18e3:[104922,104982],21e3:104947,21500:104877,27e3:[104950,104957],29e3:104964,3e4:104921,31e3:104949,33e3:104946,4e4:[104914,104967],40600:104897,41900:104937,42e3:104951,43100:104993,49300:104924,50100:104939,54e3:104955,58200:104981,59500:104930,74e3:104961,77e3:104956,79e3:104962,83500:104910,85e3:104917,88800:104934,89200:104985,96e3:104997,104e3:104963,106500:104898,11e4:104938,133e3:104932,135e3:104983,17e4:104965,198200:104987,198630:104935,208e3:104966,235800:104952,249400:104929,252100:104980,255e3:104973,47e4:104972,529800:104942,531e3:104996,56e4:104928,561400:104979,578900:104945,584700:104959,593e3:104970,606e3:104999,718e3:104933,745700:104984,761400:104953,763500:104994,764e3:104940,788900:104958,1188300:104998,1195e3:104969,1352600:104968,1560800:104874,1562090:104915,1737400:104903,1821460:104918,1821490:104876,2409300:104912,2410300:104873,2439400:104974,2439700:104900,2575e3:104943,2631200:104875,2632345:104916,3393400:104904,3396190:[104905,104971],6051e3:104901,6051800:104902,637e4:104128,6370997:[4052,37008],6371e3:4035,6371007:4047,6371228:[4053,10346],6376045:[8042,8043],6376523:[4027,4901,4902],6376896:37007,6378135:[4122,4322,4324,4720,4985,4987],6378136:[4740,4923,7678,7680,9474,9475,104017,104018],6378137:[3823,3824,3888,3889,4017,4019,4023,4031,4040,4046,4055,4074,4075,4080,4081,4121,4126,4130,4133,4140,4141,4148,4151,4152,4163,4166,4167,4170,4171,4172,4173,4176,4180,4189,4190,4258,4269,4283,4318,4319,4326,4463,4466,4469,4470,4480,4482,4483,4490,4557,4558,4612,4617,4619,4624,4627,4659,4661,4667,4669,4670,4674,4686,4687,4693,4694,4702,4737,4742,4747,4749,4750,4755,4756,4757,4758,4759,4761,4762,4763,4764,4765,4883,4885,4887,4889,4893,4895,4898,4907,4909,4921,4925,4927,4929,4931,4933,4935,4937,4939,4941,4943,4945,4947,4949,4951,4953,4955,4957,4959,4961,4963,4965,4967,4971,4975,4977,4979,4981,4983,4989,4997,4999,5012,5013,5245,5246,5251,5252,5263,5264,5323,5324,5340,5342,5353,5354,5359,5360,5364,5365,5370,5371,5372,5373,5380,5381,5392,5393,5488,5489,5545,5546,5592,5593,5885,5886,6134,6135,6310,6311,6318,6319,6321,6322,6324,6325,6364,6365,6667,6668,6705,6706,6782,6783,6980,6982,6983,6987,6989,6990,7034,7035,7036,7037,7038,7039,7040,7041,7042,7072,7073,7084,7085,7086,7087,7133,7135,7136,7138,7139,7372,7373,7657,7659,7661,7663,7665,7685,7686,7797,7798,7816,7843,7844,7880,7881,7885,7886,7900,7901,7902,7903,7904,7905,7906,7907,7908,7909,7910,7911,7912,7915,7917,7919,7921,7923,7925,7927,7929,7931,8085,8086,8231,8232,8235,8237,8239,8240,8244,8246,8248,8249,8251,8252,8254,8255,8399,8403,8426,8427,8449,8542,8544,8545,8684,8685,8698,8699,8817,8818,8860,8888,8899,8900,8901,8902,8906,8907,8916,8918,8920,8922,8924,8926,8928,8930,8932,8934,8936,8938,8940,8942,8944,8946,8948,8949,8972,8973,8974,8975,8976,8977,8978,8979,8980,8981,8982,8983,8984,8985,8986,8987,8988,8989,8990,8991,8992,8993,8994,8995,8996,8997,8998,8999,9e3,9002,9003,9005,9006,9008,9009,9011,9012,9013,9014,9016,9017,9018,9019,9053,9054,9055,9056,9057,9059,9060,9061,9062,9063,9064,9065,9066,9067,9068,9069,9071,9072,9074,9075,9139,9140,9147,9148,9152,9153,9183,9184,9293,9294,9299,9308,9309,9332,9333,9364,9372,9379,9380,9384,9453,9469,9470,9546,9547,9695,9696,9701,9702,9739,9754,9755,9758,9763,9776,9777,9778,9779,9781,9782,9783,9784,9866,9871,9939,9964,9969,9974,9989,9990,10175,10177,10178,10185,10191,10196,10204,10209,10214,10219,10224,10229,10237,10272,10277,10283,10284,10298,10299,10300,10304,10305,10307,10309,10310,10311,10312,10327,10328,10413,10414,10468,10474,10475,10570,10571,10605,10606,10623,10628,10638,10639,10670,10671,10672,10673,10689,10690,10724,10725,10738,10739,10761,10762,10780,10781,10784,10785,10799,10800,20033,20040,20041,20045,20046,104009,104010,104011,104012,104013,104014,104015,104016,104019,104020,104021,104022,104024,104027,104028,104050,104100,104107,104108,104110,104111,104114,104115,104116,104117,104118,104119,104120,104121,104122,104123,104124,104129,104133,104134,104137,104141,104142,104143,104144,104145,104179,104180,104181,104182,104183,104184,104185,104186,104199,104223,104257,104258,104259,104260,104286,104287,104602,104613,104644,104645,104646,104647,104653,104804,104896,104991],6378140:4610,6378145:[4025,4276,4760,4891,37001],6378150:37003,6378155:[37004,37207],6378160:[3821,4003,4021,4036,4202,4203,4237,4238,4291,4618,4708,5527,37231,104023,104136],6378166:37002,6378200:[4020,4229,4286,4303,4706],6378245:[4024,4147,4164,4178,4179,4191,4200,4205,4214,4284,4317,4555,4676,4677,4678,4991,4993,5560,5561,37257,104135],6378270:[4732,37005,37229],6378273:[4054,10345],6378300:[4029,4168,4174],6378388:[4022,4123,4153,4154,4158,4159,4160,4161,4165,4181,4182,4183,4184,4185,4192,4194,4195,4196,4199,4204,4207,4208,4215,4218,4221,4224,4225,4230,4231,4233,4235,4236,4247,4248,4249,4254,4255,4259,4264,4265,4271,4272,4274,4285,4287,4288,4292,4297,4309,4311,4313,4316,4472,4475,4611,4614,4615,4616,4621,4622,4623,4625,4626,4628,4629,4630,4631,4632,4633,4636,4637,4639,4641,4642,4643,4644,4645,4646,4658,4660,4662,4663,4664,4665,4668,4672,4673,4684,4688,4689,4690,4691,4692,4698,4704,4705,4707,4709,4710,4711,4712,4714,4715,4716,4718,4719,4721,4722,4724,4725,4727,4728,4729,4730,4733,4734,4735,4739,4741,4753,4754,4802,4803,4806,4809,4810,4823,4824,4900,5524,6883,8428,8430,8431,9248,9251,9253,9403,9893,10158,10249,10252,10635,10636,10735,10736,10758,37201,37204,37205,37212,37213,37214,37215,37216,37217,37218,37219,37221,37222,37224,37226,37227,37230,37232,37233,37234,37235,37237,37238,37241,37242,37245,37246,37247,37249,37250,37251,37253,37259,104104,104106,104125,104126,104127,104130,104138,104248],6378523:104786,24764e3:104960,25559e3:104944,60268e3:104925,71492e3:104908,6957e5:104975,6377397.155:[3819,3906,4004,4120,4124,4125,4149,4150,4156,4162,4211,4219,4257,4262,4280,4289,4294,4295,4301,4306,4308,4312,4314,4613,4666,4745,4746,4801,4804,4805,4808,4813,4814,4815,4818,4820,4904,5132,5228,5229,5681,5830,8351,9267,10268,37255,104101,104102,104105,104131,104648,104696,104697,104990,104992],6377563.396:[4001,4188,4277,4278,4279],6377340.189:[4002,4299,4300],6377492.018:[4005,4273,4817],6377483.865280418:[4006,4293],6378293.645208759:[4007,4157,4302,4738,5464],6378206.4:[4008,4127,4128,4129,4135,4136,4137,4138,4139,4169,4216,4242,4253,4267,4608,4609,4638,4675,4683,4695,4717,4723,4726,4995,5451,5467,37220,37239,37243,37252,37260,104e3,104109,104112,104113,104132],6378450.047:[4009,4268],6378300.789:[4010,4281],6378249.2:[4011,4014,4155,4193,4206,4213,4223,4226,4227,4228,4252,4261,4266,4275,4282,4296,4304,4310,4315,4671,4807,4811,4816,4821,37223,37225,104139,104140,104261,104304],6378249.145:[4012,4013,4132,4134,4142,4143,4175,4197,4198,4201,4209,4210,4212,4220,4222,4232,4234,4246,4250,4251,4256,4260,4263,4270,4305,4307,4600,4601,4602,4603,4604,4605,4606,4607,4620,4679,4680,4696,4697,4699,4700,4701,4703,4713,4731,4736,4743,4744,4812,4819,6881,6882,6892,6894,8694,37206,37208,37211,37228,37240,37254,104025,104026,104103,104305],6377276.345:[4015,4131,4144,4239,4240,4244,4682,5233,6207,37202,104256,104664,104693],6377298.556:[4016,4298],6377304.063:[4018,4245],6378298.3:[4028,4903],6378136.2:4032,6378136.3:4033,6378249.144808011:[4034,4241],20922931.8:[4042,4243],6377301.243:[4044,4145,37203],6377299.151:[4045,4146],6377019.27:[4657,10256,10260,10265],6378306.3696:[4748,4752],6377295.664:[4751,37006],6378136.5:[7682,7683],6371008.7714:104047,6378418.941:[104700,104726,104760],6378586.581:[104701,104743],6378505.809:104702,6378544.823:104703,6378490.569:104704,6378470.757:[104705,104776],6378403.701:[104706,104750],6378434.181:[104707,104724,104739,104764],6378454.907:104708,6378400.653:104709,6378567.378:104710,6378546.957:[104711,104717,104780],6378476.853:[104712,104736],6378411.321:[104713,104728],6378647.541:[104714,104715],6378514.953:[104716,104782],6378421.989:[104718,104770],6378481.425:[104719,104753,104774,104781],6378518.001:[104720,104725],6378521.049:[104721,104723,104731,104745,104748],6378464.661:104722,6378436.619:104727,6378574.389:[104729,104730],6378472.281:[104732,104756],6378498.189:[104733,104746],6378449.421:[104734,104766],6378525.621:[104735,104754],6378466.185:104737,6378496.665:104738,6378643.579:104740,6378559.758:104741,6378414.369:[104742,104763,104772],6378441.801:104744,6378502.761:[104747,104759,104773,104775],6378617.061:104749,6378624.681:[104751,104765],6378468.623:104752,6378445.763:[104755,104758,104761],6378670.401:104757,6378438.753:104762,6378543.909:104767,6378605.783:104768,6378540.861:104769,6378443.325:[104771,104784],6378548.481:104777,6378463.746:104778,6378426.561:104779,6378453.688:104783,6378530.193:104785,6378376.271:[104800,104828],6378471.92:104801,6378472.931:104802,6378411.351:104803,6378380.991:104805,6378414.96:104806,6378345.09:[104807,104819,104844,104870],6378412.542:104808,6378470.401:104809,6378376.331:104810,6378379.031:104811,6378407.621:104812,6378376.811:[104813,104827],6378313.92:104814,6378414.93:104815,6378413.021:104816,6378380.381:104817,6378530.851:104818,6378591.521:104820,6378378.881:104821,6378408.481:[104822,104832],6378375.601:[104823,104838],6378408.041:104824,6378655.071:104825,6378409.151:104826,6378315.7:[104829,104840,104845,104851],6378285.86:[104830,104835,104859],6378379.301:104831,6378560.121:104833,6378531.821:104834,6378500.6:104836,6378376.041:104837,6378406.601:104839,6378438.991:104841,6378345.42:104842,6378593.86:104843,6378381.271:[104846,104847],6378413.671:104848,6378344.377:104849,6378563.891:104850,6378408.091:104852,6378377.671:104853,6378472.751:104854,6378412.511:104855,6378407.281:104856,6378534.451:104857,6378406.051:104858,6378532.921:104860,6378380.091:104861,6378408.941:104862,6378624.171:104863,6378377.411:104864,6378474.591:104865,6378407.141:104866,6378376.871:104867,6378375.251:104868,6378405.971:104869,6378437.651:104871};class p extends g{constructor(e){if("number"==typeof e)return super(),this.m_factor=e,void(this.m_wkid=0);super(e)}getUnitType(){return 1}convertFromRadians(e){return e/this.getUnitToBaseFactor()}convertToRadians(e){return e*this.getUnitToBaseFactor()}}class _{constructor(e,t,n){void 0===e?(this.x=new r.ECoordinate,this.y=new r.ECoordinate,this.z=new r.ECoordinate):e instanceof i.Point3D?(this.x=new r.ECoordinate(e.x),this.y=new r.ECoordinate(e.y),this.z=new r.ECoordinate(e.z)):e instanceof r.ECoordinate?(this.x=e.clone(),this.y=t.clone(),this.z=n.clone()):s.throwInvalidArgumentException("EPoint3D constructor")}dotProduct(e){return this.x.mulE(e.x).addE(this.y.mulE(e.y)).addE(this.z.mulE(e.z))}crossProduct(e){return new _(this.y.mulE(e.z).subE(this.z.mulE(e.y)),this.z.mulE(e.x).subE(this.x.mulE(e.z)),this.x.mulE(e.y).subE(this.y.mulE(e.x)))}crossProductVector(e){const t=this.y.mulE(e.z).subE(e.y.mulE(this.z)),s=e.x.mulE(this.z).subE(this.x.mulE(e.z)),n=this.x.mulE(e.y).subE(e.x.mulE(this.y));return new _(t,s,n)}sqrLength(){return this.x.mulE(this.x).addE(this.y.mulE(this.y)).addE(this.z.mulE(this.z))}length(){return this.sqrLength().sqrt()}static distance(e,t){return e.sub(t).length()}negate(){return new _(this.x.negate(),this.y.negate(),this.z.negate())}add(e){return new _(this.x.addE(e.x),this.y.addE(e.y),this.z.addE(e.z))}sub(e){return new _(this.x.subE(e.x),this.y.subE(e.y),this.z.subE(e.z))}subThis(e){return this.x.subThisE(e.x),this.y.subThisE(e.y),this.z.subThisE(e.z),this}addThis(e){return this.x.addThisE(e.x),this.y.addThisE(e.y),this.z.addThisE(e.z),this}mul(e){return new _(this.x.mulE(e),this.y.mulE(e),this.z.mulE(e))}div(e){return new _(this.x.divE(e),this.y.divE(e),this.z.divE(e))}eq(e){return this.x.eq(e.x)&&this.y.eq(e.y)&&this.z.eq(e.z)}isZero(){return this.x.isZero()&&this.y.isZero()&&this.z.isZero()}value(){return i.Point3D.construct(this.x.value(),this.y.value(),this.z.value())}}class f{constructor(e){if(this.m_origin=new i.Point3D,this.m_normal=new i.Point3D,this.m_axisX=new i.Point3D,this.m_axisY=new i.Point3D,!e)return this.m_origin=new i.Point3D,this.m_normal=new i.Point3D(0,0,1),this.m_axisX=new i.Point3D(1,0,0),void(this.m_axisY=new i.Point3D(0,1,0));e.pt0&&e.pt1&&e.pt2?this.setFromPoints(e.pt0,e.pt1,e.pt2):s.geometryReleaseAssert(0,`unimplemented constructor options ${JSON.stringify(e)}`)}assign(e){return s.geometryReleaseAssert(0),this}set(e,t,n,i){s.geometryReleaseAssert(0)}setFromPoints(e,t,s){let n=t.sub(e);const i=s.sub(e);this.m_normal=n.crossProductVector(i);let r=!0;if(this.m_normal.isZero()){if(r=!1,n.isZero()&&(n=i),n.isZero()){const t=0,s=1;return this.m_normal.setCoords(t,t,s),this.m_axisX.setCoords(s,t,t),this.m_axisY.setCoords(t,s,t),this.m_origin=e,!1}this.m_axisX=n.getUnitVector(),this.m_normal=this.m_axisX.createAPerpendicular()}else this.m_normal.normalizeThis(),this.m_axisX=n.getUnitVector();return this.m_axisY=this.m_normal.crossProductVector(this.m_axisX),this.m_origin=e,r}getCoord(e,t){return s.geometryReleaseAssert(0),{}}getCoord2D(e){return s.geometryReleaseAssert(0),{}}getCoordX(e,t){return s.geometryReleaseAssert(0),0}getCoordY(e,t){return s.geometryReleaseAssert(0),0}getCoordZ(e,t){return s.geometryReleaseAssert(0),0}setPreferredAxisX(e){s.geometryReleaseAssert(0)}getOrigin(){return s.geometryReleaseAssert(0),{}}getNormal(){return s.geometryReleaseAssert(0),{}}getAxisX(){return this.m_axisX.clone()}getAxisY(){return this.m_axisY.clone()}setAxisX(e,t=!1){s.geometryReleaseAssert(0)}setAxisY(e,t=!1){s.geometryReleaseAssert(0)}recalculateAxisY(){s.geometryReleaseAssert(0)}setOrigin(e){s.geometryReleaseAssert(0)}setNormal(e,t){s.geometryReleaseAssert(0)}intersect(e,t){return s.geometryReleaseAssert(0),!1}intersectLine(e){return s.geometryReleaseAssert(0),0}intersectLineEx(e,t){return s.geometryReleaseAssert(0),0}closestCoordinate(e){const t=e.sub(this.m_origin),s=new r.Point2D;return s.x=t.dotProduct(this.m_axisX),s.y=t.dotProduct(this.m_axisY),s}projectVector(e){return s.geometryReleaseAssert(0),{}}signedDistance(e){return s.geometryReleaseAssert(0),0}distance(e){return s.geometryReleaseAssert(0),0}}function y(e,t){return!1}function x(e,t,n,i,o=100,a=y){let m,h,l,u,c,g,d,p,_;s.geometryReleaseAssert(i>0);let f,x,P,E=0,v=0;const C=r.goldenRatio();t>n&&(n=r.swap(t,t=n));const D=e(t),b=e(n);D<b?(m=h=l=t,u=c=g=D):(m=h=l=n,u=c=g=b);let S=0;for(;S<o&&(P=.5*(n-t),_=t+P,f=i*(Math.abs(m)+.25),x=2*f,!(a(m,u)||Math.abs(m-_)<=x-P));++S){if(Math.abs(v)>f){const e=(m-h)*(u-g);let s=(m-l)*(u-c),i=(m-l)*s-(m-h)*e;s=2*(s-e),s>0&&(i=-i),s=Math.abs(s);const o=v;v=E,Math.abs(i)>=Math.abs(s*o*.5)||i<=s*(t-m)||i>=s*(n-m)?(v=m>=_?t-m:n-m,E=r.goldenRatio()*v):(E=i/s,p=m+E,(p-t<x||n-p<x)&&(E=_-m<0?-Math.abs(f):Math.abs(f)))}else v=m>=_?t-m:n-m,E=v*C;p=m+E,d=e(p),d<u?(p>=m?t=m:n=m,l=h,h=m,m=p,g=c,c=u,u=d):(p<m?t=p:n=p,d<=c||h===m?(l=h,h=p,g=c,c=d):(d<=g||l===m||l===h)&&(l=p,g=d))}return r.makePair(m,u)}function P(e,t,s){return e>s?e-=Math.ceil((e-s)/r.geometry2Pi)*r.geometry2Pi:e<t&&(e+=Math.ceil((t-e)/r.geometry2Pi)*r.geometry2Pi),e}function E(e,t,s){return function(e,t,s){const n=s.x,i=s.y;return v(e,t,Math.cos(n),Math.sin(n),Math.cos(i),Math.sin(i),0)}(e,t,s)}function v(e,t,s,n,r,o,a){const m=e/Math.sqrt(1-t*o*o),h=m+a,l=h*r*s,u=h*r*n,c=(m*(1-t)+a)*o;return i.Point3D.construct(l,u,c)}function C(e,t,s){const n=new r.ECoordinate,i=new r.ECoordinate,o=new r.ECoordinate,a=new r.ECoordinate;n.setCos(s.x),i.setSin(s.x),o.setCos(s.y),a.setSin(s.y);const m=a.negate().mulE(a.mul(t)).add(1).sqrt(),h=new r.ECoordinate(e).divE(m),l=h.mulE(o).mulE(n),u=h.mulE(o).mulE(i),c=h.mul(1-t).mulE(a);return new _(l,u,c)}function D(e,t,s){const n=s.x,i=s.y,o=s.z,a=Math.atan2(i,n),m=Math.sqrt(n*n+i*i),h=Math.atan2(o,(1-t)*m);return r.Point2D.construct(a,h)}function b(e,t,s){const n=1-t,i=e/Math.sqrt(r.sqr(s.x)+r.sqr(s.y)+r.sqr(s.z)/n);return s.mul(i)}function S(e,t,s,n,r){const o=E(e,t,s),a=E(e,t,n);return D(0,t,i.Point3D.lerp(o,a,r))}function I(e,t,s){const n=new i.Point3D;return n.setCrossProductVector(t,s),Math.abs(Math.atan2(n.length(),t.dotProduct(s)))*e}function w(t,n,a,m,h,l=0,u){if(2===l||3===l)return function(e,t,s,n,o,a=!1,m){const h=b(e,t,s);if(a){const a=new f({pt0:new i.Point3D(0,0,0),pt1:n,pt2:o}),l=a.closestCoordinate(s),u=a.closestCoordinate(n),c=a.closestCoordinate(o),g=r.Point2D.getClosestCoordinate(u,c,l),d=b(e,t,i.Point3D.lerp(n,o,g)),p=i.Point3D.distance(d,h);return m&&m.assign(d),r.makePair(g,p)}const l=s=>{const r=b(e,t,i.Point3D.lerp(n,o,s));return i.Point3D.distance(r,h)},u=i.Point3D.distance(n,o);if(u>0){const s=M(e,u),{first:a,second:h}=x(l,0,1,s);return m&&m.assign(b(e,t,i.Point3D.lerp(n,o,a))),r.makePair(a,h)}{const e=i.Point3D.distance(s,n);return m&&m.assign(s),r.makePair(.5,e)}}(t,n,a,m,h,3===l,u);const c=D(0,n,a),g=r=>{const a=D(0,n,i.Point3D.lerp(m,h,r));return function(t,n,r,a,m){switch(s.geometryReleaseAssert(r.isFinite()&&a.isFinite()),m){case 0:return function(t,s,n,i){const r={stack:[],error:void 0,hasError:!1};try{const a=o.__addDisposableResource(r,new e.PeDoubleClass,!1);return e.peLineType.geodeticDistance(t,s,n.x,n.y,i.x,i.y,a,null,null,e.peDefs.PE_LINETYPE_GEODESIC),a.val}catch(e){r.error=e,r.hasError=!0}finally{o.__disposeResources(r)}}(t,n,r,a);case 1:return function(t,s,n){const i={stack:[],error:void 0,hasError:!1};try{const r=o.__addDisposableResource(i,new e.PeDoubleClass,!1);return e.peLineType.greatEllipticDistance(t,s,n.x,n.y,n.x,n.y,r,null,null),r.val}catch(e){i.error=e,i.hasError=!0}finally{o.__disposeResources(i)}}(t,n,r);case 2:case 3:{const e=E(t,n,r),s=E(t,n,a);return i.Point3D.distance(e,s)}default:s.throwNotImplementedException("")}}(t,n,c,a,l)},d=i.Point3D.distance(m,h);if(d>0){const e=M(t,d),{first:s,second:o}=x(g,0,1,e);return u&&u.assign(b(t,n,i.Point3D.lerp(m,h,s))),r.makePair(s,o)}{const e=g(0);return u&&u.assign(m),r.makePair(.5,e)}}function T(e,t,s,i,o,a){if(a[0]=Number.NaN,a[1]=Number.NaN,Math.abs(s.x-i.x)>Math.PI)return 0;if(Math.abs(s.y)>r.geometryHalfPi||Math.abs(i.y)>r.geometryHalfPi)return 0;if((Math.abs(s.y)===r.geometryHalfPi||Math.abs(i.y)===r.geometryHalfPi)&&s.x!==i.x)return 0;if(Math.abs(o)>=r.geometryHalfPi)return 0;if(s.y>0&&i.y>0&&s.y>o&&i.y>o||s.y<0&&i.y<0&&s.y<o&&i.y<o)return 0;const m=n.EPoint2D.constructPoint2D(s),h=n.EPoint2D.constructPoint2D(i),l=C(1,t,m),u=C(1,t,h),c=l.crossProductVector(u);if(c.z.isZero())return r.Envelope1D.construct(s.y,i.y).containsCoordinate(o)?(a[0]=s.x,1):0;const g=c.x.divE(c.z.negate()),d=c.y.divE(c.z.negate()),p=g.mulE(g).addE(d.mulE(d)).sqrt();if(p.isZero()||g.isZero()&&d.isZero())return 0===o?(a[0]=s.x,a[1]=i.x,2):0;const _=(1-t)*Math.tan(o)/p.value();if(Math.abs(_)>1)return 0;const f=Math.acos(_),y=Math.atan2(d.value(),g.value()),x=y-f;let E=y+f;const v=Math.min(s.x,i.x),D=Math.max(s.x,i.x);P(x,v,D),0!==o?P(E,v,D):E=x;let b=0;return v<=x&&x<=D&&(a[b]=x,b++),E!==x&&v<=E&&E<=D&&(a[b]=E,b++),b}function A(e,t){t[0]>.5*Math.PI?(e[0]+=Math.PI,t[0]=Math.PI-t[0]):t[0]<.5*-Math.PI&&(e[0]-=Math.PI,t[0]=-Math.PI-t[0]),s.geometryReleaseAssert(t[0]>=.5*-Math.PI&&t[0]<=.5*Math.PI)}function N(e,t){if(0===t)return 0;const s=Math.sin(t);let n=s,i=s;if(0!==e){n/=1-e*s*s;const t=Math.sqrt(e);i=s*r.atanhUOverU(t*s)}return n+i}function G(e,t){return(1-t)*e}function M(e,t){if(0!==t){const s=e*r.geographyEpsFactor()/t;return Math.min(s,1e-10)}return 0}class R{constructor(e){this.m_currentShift=63n,this.m_currentElt=0n,this.m_iCurrentElt=-1,this.m_parent=e,this.m_aiSetElts=e.m_bits.flatMap((e,t)=>t)}next(){if(this.m_currentShift++,64n===this.m_currentShift){if(this.m_iCurrentElt++,this.m_iCurrentElt===this.m_aiSetElts.length)return R.npos();this.m_currentShift=0n,this.m_currentElt=this.m_parent.m_bits[this.m_aiSetElts[this.m_iCurrentElt]]}for(;this.m_currentShift<63n&&!(this.m_currentElt&1n<<this.m_currentShift);)this.m_currentShift++;return this.m_currentElt&1n<<this.m_currentShift?64*this.m_aiSetElts[this.m_iCurrentElt]+Number(this.m_currentShift):this.next()}static npos(){return Number.MAX_SAFE_INTEGER}}function k(e){return 1n<<(0x3fn&BigInt(e))}function F(e){return e>>6}class q{constructor(e){this.m_bits=[],void 0!==e&&e.copy&&(this.m_bits=e.copy.m_bits.slice())}assignMove(){return this}assignCopy(){return this}hasBit(e){const t=k(e),s=F(e);return void 0!==this.m_bits[s]&&!!(this.m_bits[s]&t)}setBit(e){const t=k(e),s=F(e);void 0===this.m_bits[s]&&(this.m_bits[s]=0n),this.m_bits[s]|=t}clearBit(e){}flipBit(e){const t=k(e),s=F(e);return void 0===this.m_bits[s]&&(this.m_bits[s]=0n),this.m_bits[s]^=t,0n!==(this.m_bits[s]&t)}clear(){this.m_bits.length=0}isZero(){let e=0;return this.m_bits.forEach(t=>{e|=t?2:1}),!(2&e)}equals(e){if(this===e)return!0;if(this.m_bits.length!==e.m_bits.length)return!1;let t=0;return this.m_bits.forEach((s,n)=>{t|=s===e.m_bits[n]?2:1}),!(1&t||(e.m_bits.forEach((e,s)=>{t|=e===this.m_bits[s]?2:1}),1&t))}notEquals(e){return!this.equals(e)}assignOr(e){return e.m_bits.forEach((e,t)=>{void 0===this.m_bits[t]?this.m_bits[t]=e:this.m_bits[t]|=e}),this}assignSubtract(e){return e.m_bits.forEach((e,t)=>{void 0!==this.m_bits[t]&&(this.m_bits[t]&=~e)}),this}assignAnd(e){return e.m_bits.forEach((e,t)=>{void 0!==this.m_bits[t]&&(this.m_bits[t]&=e)}),this}assignXor(e){return e.m_bits.forEach((e,t)=>{void 0===this.m_bits[t]?this.m_bits[t]=e:this.m_bits[t]^=e}),this}getHashCode(){return this.m_bits.reduce((e,t)=>r.hashCombineInt64(e,t),r.hashInt32(0))}getUnorderedBitIterator(){return new R(this)}}class V{constructor(e,t){this.m_map=new Map,this.m_hf=e,this.m_ef=t}add(e){const t=this.m_hf(e);if(!this.m_map.has(t))return this.m_map.set(t,e),this;const s=this.m_map.get(t);return s instanceof Array?s.find(t=>this.m_ef(t,e))||s.push(e):this.m_ef(s,e)||this.m_map.set(t,[s,e]),this}clear(){this.m_map.clear()}delete(e){return!1}has(e){const t=this.m_hf(e);if(!this.m_map.has(t))return!1;const s=this.m_map.get(t);return s instanceof Array?void 0!==s.find(t=>this.m_ef(t,e)):this.m_ef(s,e)}get(e){const t=this.m_hf(e),s=this.m_map.get(t);if(void 0!==s)return s instanceof Array?s.find(t=>this.m_ef(t,e)):s}get size(){let e=0;for(const t of this.m_map.values())e+=t instanceof Array?t.length:1;return e}forEach(e,t){}[Symbol.iterator](){return(new Set)[Symbol.iterator]()}entries(){return(new Set).entries()}keys(){return(new Set).keys()}values(){return(new Set).values()}get[Symbol.toStringTag](){return"ValueSet"}}class H extends i.Comparator{constructor(e){super(),this.m_bufferLeft=new n.SegmentBuffer,this.m_bufferRight=new n.SegmentBuffer,this.m_intervalLeft=r.Envelope1D.constructEmpty(),this.m_intervalRight=r.Envelope1D.constructEmpty(),this.m_yScanline=Number.NaN,this.m_helper=e}compare(e,t,s){const n=t,i=e.getElement(s);this.m_helper.querySegmentXY(n,this.m_bufferLeft),this.m_helper.querySegmentXY(i,this.m_bufferRight);const r=this.m_bufferLeft.get(),o=this.m_bufferRight.get();if(this.m_intervalLeft.setCoords(r.getStartX(),r.getEndX()),this.m_intervalRight.setCoords(o.getStartX(),o.getEndX()),this.m_intervalLeft.vmax<this.m_intervalRight.vmin)return-1;if(this.m_intervalLeft.vmin>this.m_intervalRight.vmax)return 1;const a=r.getStartY()===r.getEndY(),m=o.getStartY()===o.getEndY();if(a||m){if(a&&m)return 0;if(r.getStartY()===o.getStartY()&&r.getStartX()===o.getStartX())return a?1:-1;if(r.getEndY()===o.getEndY()&&r.getEndX()===o.getEndX())return a?-1:1}let h=r.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalLeft.vmin),l=o.intersectionOfYMonotonicWithAxisX(this.m_yScanline,this.m_intervalRight.vmin);if(h===l){const e=r.getEndY(),t=o.getEndY(),s=Math.min(e,t);let n=.5*(s+this.m_yScanline);n===this.m_yScanline&&(n=s),h=r.intersectionOfYMonotonicWithAxisX(n,this.m_intervalLeft.vmin),l=o.intersectionOfYMonotonicWithAxisX(n,this.m_intervalRight.vmin)}return h<l?-1:h>l?1:0}setY(e){this.m_yScanline=e}}class O{constructor(e){this.m_segmentBuffer=new n.SegmentBuffer,this.m_point=r.Point2D.getNAN(),this.m_parent=e}setPointXY(e){this.m_point.assign(e)}compare(e,t){const s=e.getElement(t);this.m_parent.querySegmentXY(s,this.m_segmentBuffer);const n=this.m_segmentBuffer.get(),i=new r.Envelope1D;if(i.setCoords(n.getStartX(),n.getEndX()),this.m_point.x<i.vmin)return-1;if(this.m_point.x>i.vmax)return 1;const o=n.intersectionOfYMonotonicWithAxisX(this.m_point.y,this.m_point.x);return this.m_point.x<o?-1:this.m_point.x>o?1:0}}var Y,X;function L(e,t){return{parentage:e,rank:t}}function B(e,t){const s=e.length;if(s!==t.length)return!1;const n=e[0].parentage;if(n!==t[0].parentage)return!1;if(-1===n)return!0;for(let n=1;n<s;++n)if(e[n].parentage!==t[n].parentage)return!1;return!0}function z(e,t,s){s.length=0;let i=!1;{let r=e.getHalfEdgeVertexIterator(t);for(;r!==n.nullHandle;){const t=e.getVertexFromVertexIterator(r),n=e.getShape().getSegmentRank(t),o=e.getShape().getSegmentParentage(t);i||=o>=0,s.push(L(o,n)),r=e.incrementVertexIterator(r)}}{let r=e.getHalfEdgeVertexIterator(e.getHalfEdgeTwin(t));for(;r!==n.nullHandle;){const t=e.getVertexFromVertexIterator(r),n=e.getShape().getSegmentRank(t),o=e.getShape().getSegmentParentage(t);i||=o>=0,s.push(L(o,n)),r=e.incrementVertexIterator(r)}}i&&s.sort((e,t)=>e.rank>t.rank?-1:e.rank<t.rank?1:e.parentage<t.parentage?-1:e.parentage>t.parentage?1:0),-1===s[0].parentage&&(s.length=1)}!function(e){e[e.enumInputModeBuildGraph=0]="enumInputModeBuildGraph",e[e.enumInputModeSimplifyAlternate=1]="enumInputModeSimplifyAlternate",e[e.enumInputModeSimplifyWinding=2]="enumInputModeSimplifyWinding"}(Y||(Y={})),function(e){e[e.enumSegmentParentageBreakNode=1]="enumSegmentParentageBreakNode",e[e.enumPathBreakNode=2]="enumPathBreakNode"}(X||(X={}));class U{constructor(){this.m_shape=null,this.m_clusterData=new i.StridedIndexTypeCollection(8),this.m_clusterVertices=new i.StridedIndexTypeCollection(2),this.m_firstCluster=n.nullHandle,this.m_lastCluster=n.nullHandle,this.m_halfEdgeData=new i.StridedIndexTypeCollection(8),this.m_chainData=new i.StridedIndexTypeCollection(8),this.m_chainAreas=null,this.m_chainPerimeters=null,this.m_universeChain=-1,this.m_simplifiedGeometry=-1,this.m_edgeIndices=[],this.m_clusterIndices=[],this.m_chainIndices=[],this.m_bBuildGeometryParentageSets=!1,this.m_chainBitSetIndex=-1,this.m_edgeBitSetIndex=-1,this.m_edgeBitSetIndexLeft=-1,this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_uniqueBitSets=null,this.m_chainBitSets=[],this.m_edgeBitSets=[],this.m_checkDirtyPlanesweepTolerance=Number.NaN,this.m_geometryIDIndex=-1,this.m_clusterIndex=-1,this.m_halfEdgeIndex=-1,this.m_tmpHalfEdgeParentageIndex=-1,this.m_tmpHalfEdgeParentageIndexLeft=-1,this.m_tmpHalfEdgeWindingNumberIndex=-1,this.m_tmpHalfEdgeOddEvenNumberIndex=-1,this.m_segmentParentageIndex=-1,this.m_segmentIndexHe=-1,this.m_clusterBreakNodeIndex=-1,this.m_universeGeomID=-1,this.m_pointCount=0,this.m_progressCounter=0,this.m_bBuildChains=!0,this.m_bDirtyCheckFailed=!1}setCheckDirtyPlanesweepTolerance(e){this.m_checkDirtyPlanesweepTolerance=e}dirtyCheckFailed(){return this.m_bDirtyCheckFailed}getShape(){return this.m_shape}setEditShape(e,t,s=!0,n=!1){n?this.setEditShapeImpl3D_(e,Y.enumInputModeBuildGraph,null,t,!1):this.setEditShapeImpl_(e,Y.enumInputModeBuildGraph,null,t,s)}setAndSimplifyEditShapeAlternate(e,t,n=null,i=!1){const r=[];r.push(t),this.m_simplifiedGeometry=t,i?this.setEditShapeImpl3D_(e,Y.enumInputModeSimplifyAlternate,r,n,!1):this.setEditShapeImpl_(e,Y.enumInputModeSimplifyAlternate,r,n,e.getGeometryType(t)===s.GeometryType.enumPolygon)}setAndSimplifyEditShapeWinding(e,t,s=null){const n=[];n.push(t),this.m_simplifiedGeometry=t,this.setEditShapeImpl_(e,Y.enumInputModeSimplifyWinding,n,s,!0)}removeShape(){null!==this.m_shape&&(-1!==this.m_geometryIDIndex&&(this.m_shape.removeGeometryUserIndex(this.m_geometryIDIndex),this.m_geometryIDIndex=-1),-1!==this.m_clusterIndex&&(this.m_shape.removeUserIndex(this.m_clusterIndex),this.m_clusterIndex=-1),-1!==this.m_halfEdgeIndex&&(this.m_shape.removeUserIndex(this.m_halfEdgeIndex),this.m_halfEdgeIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1),-1!==this.m_segmentParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_segmentParentageIndex),this.m_segmentParentageIndex=-1),-1!==this.m_segmentIndexHe&&(this.deleteUserIndexForHalfEdges(this.m_segmentIndexHe),this.m_segmentIndexHe=-1),-1!==this.m_clusterBreakNodeIndex&&(this.deleteUserIndexForClusters(this.m_clusterBreakNodeIndex),this.m_clusterBreakNodeIndex=-1),this.deleteEdgeBitSets_(),this.deleteChainBitSets_(),this.m_emptyBitSet=null,this.m_geometryMapID=null,this.m_shape=null,this.m_clusterData.deleteAll(!0),this.m_clusterVertices.deleteAll(!0),this.m_firstCluster=n.nullHandle,this.m_lastCluster=n.nullHandle,this.m_halfEdgeData.deleteAll(!0),this.m_edgeIndices.length=0,this.m_clusterIndices.length=0,this.m_chainIndices.length=0,this.m_chainData.deleteAll(!0),this.m_universeChain=n.nullHandle,this.m_chainAreas=null)}getClusterHalfEdge(e){return this.m_clusterData.getField(e,2)}queryXY(e,t){const s=this.getClusterVertexIndex_(e);t.assign(this.m_shape.getXYWithIndex(s))}queryXYZ(e,t){s.geometryReleaseAssert(0)}getClusterParentage(e){return this.m_clusterData.getField(e,1)}getFirstCluster(){return this.m_firstCluster}getPrevCluster(e){return this.m_clusterData.getField(e,3)}getNextCluster(e){return this.m_clusterData.getField(e,4)}getClusterChain(e){return this.m_clusterData.getField(e,6)}getClusterVertexIterator(e){return this.m_clusterData.getField(e,7)}incrementVertexIterator(e){return this.m_clusterVertices.getField(e,1)}getVertexFromVertexIterator(e){return this.m_clusterVertices.getField(e,0)}getClusterUserIndex(e,t){const s=this.getClusterIndex_(e),n=this.m_clusterIndices[t];return n.size()<=s?-1:n.read(s)}setClusterUserIndex(e,t,s){const n=this.getClusterIndex_(e),i=this.m_clusterIndices[t];i.size()<=n&&i.resize(this.m_clusterData.size(),-1),i.write(n,s)}hasClusterUserIndexFlags(e,t,s){if(-1===t)return!1;const n=this.getClusterUserIndex(e,t);return-1!==n&&0!==(s&n)}setClusterUserIndexFlags(e,t,s){const n=this.getClusterIndex_(e),i=this.m_clusterIndices[t];i.size()<=n&&i.resize(this.m_clusterData.size(),-1);let r=i.read(n);-1===r&&(r=0),i.write(n,s|r)}clearClusterUserIndexFlags(e,t,s){const n=this.getClusterIndex_(e),i=this.m_clusterIndices[t];i.size()<=n&&i.resize(this.m_clusterData.size(),-1);let r=i.read(n);-1===r&&(r=0),i.write(n,~s&r)}createUserIndexForClusters(e=-1){const t=new i.AttributeStreamOfInt32(this.m_clusterData.capacity(),e);for(let e=0,s=this.m_clusterIndices.length;e<s;e++)if(null===this.m_clusterIndices[e])return this.m_clusterIndices[e]=t,e;return this.m_clusterIndices.push(t),this.m_clusterIndices.length-1}deleteUserIndexForClusters(e){this.m_clusterIndices[e]=null}getHalfEdgeOrigin(e){return this.m_halfEdgeData.getField(e,1)}getHalfEdgeTo(e){return this.getHalfEdgeOrigin(this.getHalfEdgeTwin(e))}getHalfEdgeTwin(e){return this.m_halfEdgeData.getField(e,4)}getHalfEdgePrev(e){return this.m_halfEdgeData.getField(e,5)}getHalfEdgeNext(e){return this.m_halfEdgeData.getField(e,6)}getHalfEdgeChain(e){return this.m_halfEdgeData.getField(e,2)}getHalfEdgeFaceParentage(e){return this.getChainParentage(this.getHalfEdgeChain(e))}getHalfEdgeVertexIterator(e){return this.m_halfEdgeData.getField(e,7)}getHalfEdgeFromXY(e,t){this.queryXY(this.getHalfEdgeOrigin(e),t)}getHalfEdgeToXY(e,t){this.queryXY(this.getHalfEdgeTo(e),t)}isHalfEdgeCurve(e){return-1!==this.m_segmentIndexHe&&-1!==this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe)}getHalfEdgeFromXYZ(e,t){s.geometryReleaseAssert(0)}getHalfEdgeToXYZ(e,t){s.geometryReleaseAssert(0)}getHalfEdgeParentage(e){return this.m_halfEdgeData.getField(e,3)&U.c_EdgeParentageMask}getHalfEdgeUserIndex(e,t){const s=this.getHalfEdgeIndex_(e),n=this.m_edgeIndices[t];return n.size()<=s?-1:n.read(s)}setHalfEdgeUserIndex(e,t,s){const n=this.getHalfEdgeIndex_(e),i=this.m_edgeIndices[t];i.size()<=n&&i.resize(this.m_halfEdgeData.size(),-1),i.write(n,s)}createUserIndexForHalfEdges(e){void 0===e&&(e=-1);const t=new i.AttributeStreamOfInt32(this.m_halfEdgeData.capacity(),e);for(let e=0,s=this.m_edgeIndices.length;e<s;e++)if(null===this.m_edgeIndices[e])return this.m_edgeIndices[e]=t,e;this.m_edgeIndices.push(t);const n=this.m_edgeIndices.length-1;return s.geometryReleaseAssert(n>=0&&n<=Number.MAX_SAFE_INTEGER),n}deleteUserIndexForHalfEdges(e){this.m_edgeIndices[e]=null}deleteEdgesBreakFaces_(e){for(let t=0,s=e.length;t<s;t++){const s=e[t],i=this.getHalfEdgeChain(s),r=this.getHalfEdgeTwin(s),o=this.getHalfEdgeChain(r);this.setChainHalfEdge_(i,n.nullHandle),this.setChainHalfEdge_(o,n.nullHandle),this.updateVertexToHalfEdgeConnection_(s,!0),this.deleteEdgeImpl_(s)}}doesHalfEdgeBelongToAPolygonInterior(e,t){return s.geometryReleaseAssert(0),!1}doesHalfEdgeBelongToAPolygonExterior(e,t){return s.geometryReleaseAssert(0),!1}doesHalfEdgeBelongToAPolygonBoundary(e,t){return s.geometryReleaseAssert(0),!1}doesHalfEdgeBelongToAPolylineInterior(e,t){return s.geometryReleaseAssert(0),!1}doesHalfEdgeBelongToAPolylineExterior(e,t){return s.geometryReleaseAssert(0),!1}doesClusterBelongToAPolygonInterior(e,t){return s.geometryReleaseAssert(0),!1}doesClusterBelongToAPolygonExterior(e,t){return s.geometryReleaseAssert(0),!1}doesClusterBelongToAPolygonBoundary(e,t){return s.geometryReleaseAssert(0),!1}getFirstChain(){return this.m_universeChain}getChainHalfEdge(e){return this.m_chainData.getField(e,1)}getChainParentage(e){return this.m_chainData.getField(e,2)}getChainParent(e){return this.m_chainData.getField(e,3)}getChainFirstIsland(e){return this.m_chainData.getField(e,4)}getChainNextInParent(e){return this.m_chainData.getField(e,5)}getChainNext(e){return this.m_chainData.getField(e,7)}getChainArea(e){const t=this.getChainIndex_(e);let s=this.m_chainAreas.read(t);return Number.isNaN(s)&&(this.updateChainAreaAndPerimeter_(e),s=this.m_chainAreas.read(t)),s}getChainPerimeter(e){return s.geometryReleaseAssert(0),0}getChainUserIndex(e,t){const s=this.getChainIndex_(e),n=this.m_chainIndices[t];return n.size()<=s?-1:n.read(s)}setChainUserIndex(e,t,s){const n=this.getChainIndex_(e),i=this.m_chainIndices[t];i.size()<=n&&i.resize(this.m_chainData.size(),-1),i.write(n,s)}createUserIndexForChains(){const e=new i.AttributeStreamOfInt32(this.m_chainData.capacity(),-1);for(let t=0,s=this.m_chainIndices.length;t<s;t++)if(null===this.m_chainIndices[t])return this.m_chainIndices[t]=e,t;return this.m_chainIndices.push(e),this.m_chainIndices.length-1}deleteUserIndexForChains(e){this.m_chainIndices[e]=null}extractPolygonFromChainAndIslands(e,t,i,r){const o=t===n.nullHandle?e.createGeometry(s.GeometryType.enumPolygon):t,a=new n.SegmentBuffer;this.extractPolygonPathFromChain_(e,o,i,r,a);for(let t=this.getChainFirstIsland(i);t!==n.nullHandle;t=this.getChainNextInParent(t))this.extractPolygonPathFromChain_(e,o,t,r,a);return o}getGeometryID(e){const t=this.m_shape.getGeometryUserIndex(e,this.m_geometryIDIndex);return s.geometryReleaseAssert(t>=0),1<<Math.min(t,31)}getClusterFromVertex(e){return this.m_shape.getUserIndex(e,this.m_clusterIndex)}getHalfEdgeFromVertex(e){return this.m_shape.getUserIndex(e,this.m_halfEdgeIndex)}buildGeometryParentageSets(){this.m_bBuildGeometryParentageSets=!0}getChainBitSet(e){if(s.geometryReleaseAssert(this.m_bBuildGeometryParentageSets),-1===this.m_chainBitSetIndex)return this.getEmptySet();const t=this.getChainUserIndex(e,this.m_chainBitSetIndex);s.geometryReleaseAssert(t>=0);let n=this.m_chainBitSets.at(t);return n||(n=this.getEmptySet()),n}getChainBoundaryBitSet(e){s.geometryReleaseAssert(this.m_bBuildGeometryParentageSets);const t=new q,i=e=>{const s=this.getChainHalfEdge(e);let n=s;do{const e=this.getEdgeBitSet_(n);null!==e&&t.assignOr(e);const s=this.getEdgeBitSet_(this.getHalfEdgeTwin(n));null!==s&&t.assignOr(s),n=this.getHalfEdgeNext(n)}while(n!==s)};i(e);for(let t=this.getChainFirstIsland(e);t!==n.nullHandle;t=this.getChainNextInParent(t))i(e);return t}getChainPolygons(e){return s.geometryReleaseAssert(0),[]}getGeometriesFromBits(e){if(!this.m_bBuildGeometryParentageSets||null===e)return[];if(null===this.m_geometryMapID){this.m_geometryMapID=new Map;for(let e=this.m_shape.getFirstGeometry();e!==n.nullHandle;e=this.m_shape.getNextGeometry(e))this.m_geometryMapID.set(this.m_shape.getGeometryUserIndex(e,this.m_geometryIDIndex),e)}const t=[],i=e.getUnorderedBitIterator();for(let e=i.next();e!==R.npos();e=i.next())s.geometryReleaseAssert(this.m_geometryMapID.has(e)),t.push(this.m_geometryMapID.get(e));return t}getVertexDominant(e,t){if(t===n.nullHandle)return e;const s=this.getClusterFromVertex(e);return this.getVertexDominantFromCluster(s,t)}getVertexDominantFromCluster(e,t){if(t!==n.nullHandle){let s=n.nullHandle;for(let i=this.getClusterVertexIterator(e);i!==n.nullHandle;i=this.incrementVertexIterator(i)){const e=this.getVertexFromVertexIterator(i);s===n.nullHandle&&(s=e);const r=this.m_shape.getPathFromVertex(e);if(this.m_shape.getGeometryFromPath(r)===t){s=e;break}}return s}{const t=this.getClusterVertexIterator(e);return t!==n.nullHandle?this.getVertexFromVertexIterator(t):n.nullHandle}}isBreakNode(e){return this.hasClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,X.enumSegmentParentageBreakNode)}setBreakNode(e,t){s.geometryReleaseAssert(-1!==this.m_clusterBreakNodeIndex),t?this.setClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,X.enumSegmentParentageBreakNode):this.clearClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,X.enumSegmentParentageBreakNode)}isStrongPathNode(e){return this.hasClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,X.enumPathBreakNode)}setStrongPathNode(e,t){if(-1===this.m_clusterBreakNodeIndex){if(!t)return;this.m_clusterBreakNodeIndex=this.createUserIndexForClusters()}t?this.setClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,X.enumPathBreakNode):this.clearClusterUserIndexFlags(e,this.m_clusterBreakNodeIndex,X.enumPathBreakNode)}getSegmentParentage(e){if(-1===this.m_segmentParentageIndex)return-1;const t=this.getHalfEdgeUserIndex(e,this.m_segmentParentageIndex);return t>=0?t:-1}isCrossroadAhead(e){const t=this.getHalfEdgeNext(e);if(this.isStrongPathNode(this.getHalfEdgeOrigin(t)))return!0;const s=this.getHalfEdgeTwin(t),n=this.getHalfEdgeNext(s);return e!==this.getHalfEdgeTwin(n)}isCrossroadBehind(e){return s.geometryReleaseAssert(0),!1}getHalfEdgeConnector(e,t){const s=this.getClusterHalfEdge(e);if(s===n.nullHandle)return n.nullHandle;let i=s,r=n.nullHandle,o=n.nullHandle;do{if(this.getHalfEdgeTo(i)===t)return i;if(r===n.nullHandle){if(r=this.getClusterHalfEdge(t),r===n.nullHandle)return n.nullHandle;o=r}if(this.getHalfEdgeTo(o)===e)return i=this.getHalfEdgeTwin(o),i;i=this.getHalfEdgeNext(this.getHalfEdgeTwin(i)),o=this.getHalfEdgeNext(this.getHalfEdgeTwin(o))}while(i!==s&&o!==r);return n.nullHandle}querySegmentXY(e,t){if(-1!==this.m_segmentIndexHe){let s=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);if(-1!==s){if(-2!==s){const e=this.m_shape.getSegmentFromIndex(s);t.copyFrom(e,!0)}else{s=this.getHalfEdgeUserIndex(this.getHalfEdgeTwin(e),this.m_segmentIndexHe);const n=this.m_shape.getSegmentFromIndex(s);t.copyFrom(n,!0),t.get().reverse()}return}}t.createLine();const s=t.get(),n=r.Point2D.getNAN();this.getHalfEdgeFromXY(e,n),s.setStartXY(n),this.getHalfEdgeToXY(e,n),s.setEndXY(n)}isCurveEdge(e){return-1!==this.m_segmentIndexHe&&-1!==this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe)}compareEdgeAnglesCurveHelper_(e,t,i){const o=new n.SegmentBuffer,a=new n.SegmentBuffer;this.querySegmentXY(e,o),this.querySegmentXY(t,a);const m=o.get(),h=a.get();if(m.equals(h))return 0;const l=new r.Point2D;this.getHalfEdgeFromXY(e,l);const u=new r.Point2D;this.getHalfEdgeToXY(e,u);const c=new r.Point2D;return this.getHalfEdgeToXY(t,c),s.geometryReleaseAssert(!u.isEqualPoint2D(c)),n.compareConnectedSegments(m,h)}compareEdgeAnglesHelper_(e,t,s){if(e===t)return 0;if(this.isHalfEdgeCurve(e)||this.isHalfEdgeCurve(t))return this.compareEdgeAnglesCurveHelper_(e,t,s);const n=r.Point2D.getNAN();this.getHalfEdgeToXY(e,n);const i=r.Point2D.getNAN();if(this.getHalfEdgeToXY(t,i),n.isEqualPoint2D(i))return 0;const o=r.Point2D.getNAN();this.getHalfEdgeFromXY(e,o);const a=r.Point2D.getNAN();a.setSub(n,o);const m=r.Point2D.getNAN();return m.setSub(i,o),!s||m.y>=0&&a.y>0?r.Point2D.compareVectors(a,m):0}compareEdgeAngles_(e,t){return this.compareEdgeAnglesHelper_(e,t,!1)}compareEdgeAnglesForPair_(e,t){return this.compareEdgeAnglesHelper_(e,t,!0)}compareEdgeAngles3D_(e,t){return s.geometryReleaseAssert(0),0}compareEdgeAnglesForPair3D_(e,t){return s.geometryReleaseAssert(0),0}dbgDumpChains_(){}dbgDumpChainToPolygon_(e,t){}deleteEdgeInternal_(e){const t=this.getHalfEdgeChain(e),i=this.getHalfEdgeTwin(e),r=this.getHalfEdgeChain(i);s.geometryReleaseAssert(r===t),s.geometryReleaseAssert(e===this.getHalfEdgeNext(i)||i===this.getHalfEdgeNext(e));let o=this.getHalfEdgeNext(e);o===i&&(o=this.getHalfEdgeNext(o),o===e&&(o=n.nullHandle));const a=this.getChainIndex_(t),m=this.m_chainAreas.read(a);Number.isNaN(m)||(this.setChainArea_(t,Number.NaN),this.setChainPerimeter_(t,Number.NaN));const h=this.getChainHalfEdge(t);h!==e&&h!==i||this.setChainHalfEdge_(t,o),this.updateVertexToHalfEdgeConnection_(e,!0),this.deleteEdgeImpl_(e)}getFirstUnvisitedHalfEdgeOnCluster_(e,t,s){let i=t!==n.nullHandle?t:this.getClusterHalfEdge(e);if(i===n.nullHandle)return n.nullHandle;const r=i;for(;;){if(1!==this.getHalfEdgeUserIndex(i,s))return i;const e=this.getHalfEdgeNext(this.getHalfEdgeTwin(i));if(e===r)return n.nullHandle;i=e}}removeSpikes_(){let e=!1;const t=this.createUserIndexForHalfEdges();for(let s=this.getFirstCluster();s!==n.nullHandle;s=this.getNextCluster(s)){let i=n.nullHandle;for(;;){let r=this.getFirstUnvisitedHalfEdgeOnCluster_(s,i,t);if(r===n.nullHandle)break;i=this.getHalfEdgeNext(this.getHalfEdgeTwin(r));let o=r;for(;;){const s=this.getHalfEdgeNext(o),a=this.getHalfEdgePrev(o),m=this.getHalfEdgeTwin(o);if(a===m){if(this.deleteEdgeInternal_(o),e=!0,i!==o&&i!==m||(i=n.nullHandle),o===r||a===r){if(r=s,o===r||a===r)break;o=s;continue}}else this.setHalfEdgeUserIndex(o,t,1);if(o=s,o===r)break}}}return this.deleteUserIndexForHalfEdges(t),e}progress_(e,t=!1){}newCluster_(){const e=this.m_clusterData.newElement();return this.m_clusterData.setField(e,1,0),e}newHalfEdgePair_(){const e=this.m_halfEdgeData.newElement();this.m_halfEdgeData.setField(e,2,0),this.m_halfEdgeData.setField(e,3,0);const t=this.m_halfEdgeData.newElement();return this.m_halfEdgeData.setField(t,2,0),this.m_halfEdgeData.setField(t,3,0),this.setHalfEdgeTwin_(e,t),this.setHalfEdgeTwin_(t,e),e}newChain_(){const e=this.m_chainData.newElement();return this.m_chainData.setField(e,2,0),e}deleteChain_(e){return s.geometryReleaseAssert(0),0}getClusterIndex_(e){return this.m_clusterData.elementToIndex(e)}setClusterVertexIterator_(e,t){this.m_clusterData.setField(e,7,t)}setClusterHalfEdge_(e,t){this.m_clusterData.setField(e,2,t)}setClusterParentage_(e,t){this.m_clusterData.setField(e,1,t)}setPrevCluster_(e,t){this.m_clusterData.setField(e,3,t)}setNextCluster_(e,t){this.m_clusterData.setField(e,4,t)}setClusterVertexIndex_(e,t){this.m_clusterData.setField(e,5,t)}getClusterVertexIndex_(e){return this.m_clusterData.getField(e,5)}setClusterChain_(e,t){this.m_clusterData.setField(e,6,t)}addClusterToExteriorChain_(e,t){this.setClusterChain_(t,e)}getHalfEdgeIndex_(e){return this.m_halfEdgeData.elementToIndex(e)}setHalfEdgeOrigin_(e,t){this.m_halfEdgeData.setField(e,1,t)}setHalfEdgeTwin_(e,t){this.m_halfEdgeData.setField(e,4,t)}setHalfEdgePrev_(e,t){this.m_halfEdgeData.setField(e,5,t)}setHalfEdgeNext_(e,t){this.m_halfEdgeData.setField(e,6,t)}setHalfEdgeChain_(e,t){this.m_halfEdgeData.setField(e,2,t)}setHalfEdgeParentage_(e,t){this.m_halfEdgeData.setField(e,3,t)}getHalfEdgeParentageMask_(e){return this.m_halfEdgeData.getField(e,3)}setHalfEdgeVertexIterator_(e,t){this.m_halfEdgeData.setField(e,7,t)}updateVertexToHalfEdgeConnectionHelper_(e,t){const s=t?n.nullHandle:e;for(let t=this.getHalfEdgeVertexIterator(e);t!==n.nullHandle;t=this.incrementVertexIterator(t)){const e=this.getVertexFromVertexIterator(t);this.m_shape.setUserIndex(e,this.m_halfEdgeIndex,s)}}updateVertexToHalfEdgeConnection_(e,t){e!==n.nullHandle&&(this.updateVertexToHalfEdgeConnectionHelper_(e,t),this.updateVertexToHalfEdgeConnectionHelper_(this.getHalfEdgeTwin(e),t))}getChainIndex_(e){return this.m_chainData.elementToIndex(e)}setChainHalfEdge_(e,t){this.m_chainData.setField(e,1,t)}setChainParentage_(e,t){this.m_chainData.setField(e,2,t)}setChainParent_(e,t){this.m_chainData.setField(e,3,t);const s=this.getChainFirstIsland(t);this.setChainNextInParent_(e,s),this.setChainFirstIsland_(t,e)}setChainFirstIsland_(e,t){this.m_chainData.setField(e,4,t)}setChainNextInParent_(e,t){this.m_chainData.setField(e,5,t)}setChainPrev_(e,t){this.m_chainData.setField(e,6,t)}setChainNext_(e,t){this.m_chainData.setField(e,7,t)}setChainArea_(e,t){const s=this.getChainIndex_(e);this.m_chainAreas.write(s,t)}setChainPerimeter_(e,t){const s=this.getChainIndex_(e);this.m_chainPerimeters.write(s,t)}updateChainAreaAndPerimeter_(e){const t=this.m_shape.hasCurves(),s=new r.KahanSummator(0),i=new r.KahanSummator(0),o=this.getChainHalfEdge(e),a=r.Point2D.getNAN(),m=r.Point2D.getNAN(),h=r.Point2D.getNAN();this.getHalfEdgeFromXY(o,a),m.setCoordsPoint2D(a);let l=o;do{this.getHalfEdgeToXY(l,h),t&&this.isCurveEdge(l)||i.pe(r.Point2D.distance(m,h)),this.getHalfEdgeChain(this.getHalfEdgeTwin(l))!==e&&s.pe((h.x-a.x-(m.x-a.x))*(h.y-a.y+(m.y-a.y))*.5),m.setCoordsPoint2D(h),l=this.getHalfEdgeNext(l)}while(l!==o);if(t){const t=new n.SegmentBuffer;l=o;do{this.getHalfEdgeToXY(l,h);const n=this.isCurveEdge(l);if(n&&(this.querySegmentXY(l,t),i.pe(t.get().calculateLength2D())),this.getHalfEdgeChain(this.getHalfEdgeTwin(l))!==e&&n){const e=t.get().calculateArea2DHelper();s.pe(e)}l=this.getHalfEdgeNext(l)}while(l!==o)}const u=this.getChainIndex_(e);this.m_chainAreas.write(u,s.getResult()),this.m_chainPerimeters.write(u,i.getResult())}getChainTopmostEdge_(e){return s.geometryReleaseAssert(0),0}planeSweepParentage_(e,t){const s=new H(this),o=new i.Treap;o.setCapacity(Math.trunc(this.m_pointCount/2)),o.setComparator(s);const a=[],m=this.createUserIndexForHalfEdges();let h=null;const l=r.Point2D.getNAN();for(let r=this.getFirstCluster();r!==n.nullHandle;r=this.getNextCluster(r)){this.progress_(t);const u=this.getClusterHalfEdge(r);if(u!==n.nullHandle){if(a.length=0,!this.tryOptimizedInsertion_(o,m,a,r,u)){this.queryXY(r,l),s.setY(l.y);let e=u;do{const t=this.getHalfEdgeUserIndex(e,m);-1!==t&&(o.deleteNode(t),this.setHalfEdgeUserIndex(e,m,i.StridedIndexTypeCollection.impossibleIndex2())),e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(u!==e);e=u;do{if(-1===this.getHalfEdgeUserIndex(e,m)){const t=o.addElement(e);a.push(t)}e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(u!==e)}for(let t=a.length-1;t>=0;t--){const s=a[t],n=o.getElement(s),i=this.getHalfEdgeTwin(n);this.setHalfEdgeUserIndex(i,m,s),this.planeSweepParentagePropagateParentage_(o,s,e)}}else if(this.getClusterChain(r)===n.nullHandle){null===h&&(h=new O(this)),this.queryXY(r,l),h.setPointXY(l);const e=o.searchLowerBound(h);let t=this.m_universeChain;if(-1!==e){let s=o.getElement(e);this.getHalfEdgeChain(s)===this.getHalfEdgeChain(this.getHalfEdgeTwin(s))&&(s=this.getLeftSkipPolylines_(o,e)),s!==n.nullHandle&&(t=this.getHalfEdgeChain(s))}this.addClusterToExteriorChain_(t,r)}}this.deleteUserIndexForHalfEdges(m)}planeSweepParentagePropagateParentage_(e,t,i){const r=e.getElement(t),o=this.getHalfEdgeChain(r);if(this.getChainParent(o)!==n.nullHandle)return;const a=this.getLeftSkipPolylines_(e,t),m=this.getHalfEdgeTwin(r),h=this.getHalfEdgeChain(m);let l=this.getChainParent(o),u=this.getChainParent(h);if(a===n.nullHandle)l===n.nullHandle&&(h===o?(this.setChainParent_(h,this.m_universeChain),u=this.m_universeChain,l=u):(u===n.nullHandle&&(this.setChainParent_(h,this.m_universeChain),u=this.m_universeChain),this.setChainParent_(o,h),l=h));else{const e=this.getHalfEdgeChain(a);if(u===n.nullHandle){if(this.getChainArea(e)<=0){const t=this.getChainParent(e);this.setChainParent_(h,t),u=t}else this.setChainParent_(h,e),u=e;h===o&&(l=u)}}l===n.nullHandle&&(this.trySetChainParentFromTwin_(o,h),l=this.getChainParent(o)),s.geometryReleaseAssert(l!==n.nullHandle),i===Y.enumInputModeBuildGraph?this.propagateParentageBuildGraph_(e,t,r,a):i===Y.enumInputModeSimplifyWinding?this.propagateParentageWinding_(e,t,r,a,m,o,h):i===Y.enumInputModeSimplifyAlternate&&this.propagateParentageAlternate_(e,t,r,a,m,o,h)}propagateParentageBuildGraph_(e,t,s,i){let r,o=t;i===n.nullHandle?(o=e.getNext(o),r=this.getHalfEdgeChain(s)):r=this.getHalfEdgeChain(i);let a=null,m=this.getChainParentage(r);for(this.m_bBuildGeometryParentageSets&&(a=this.getChainBitSet(r));-1!==o;o=e.getNext(o)){const t=e.getElement(o),s=this.getHalfEdgeTwin(t);r=this.getHalfEdgeChain(t);const n=this.getHalfEdgeChain(s);if(this.m_bBuildGeometryParentageSets){let e=this.getChainBitSet(n);e=new q({copy:e}),e.assignOr(a),this.setChainBitSet_(n,e);let s=this.getChainBitSet(r);const i=this.getLeftEdgeBitSet_(t),o=new q({copy:a});if(o.assignSubtract(i),o.isZero())break;s=new q({copy:s}),s.assignOr(o),this.setChainBitSet_(r,s),a=s}const i=this.getChainParentage(n),h=i|m;h!==i&&this.setChainParentage_(n,h);let l=this.getChainParentage(r);const u=m&~this.getHalfEdgeUserIndex(t,this.m_tmpHalfEdgeParentageIndexLeft);if(u&&(l|=u,this.setChainParentage_(r,l)),0===u)break;m=l}}propagateParentageWinding_(e,t,i,r,o,a,m){if(a===m)return;let h=this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeWindingNumberIndex);h+=this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeWindingNumberIndex);let l=0;const u=[],c=[];c.push(0);for(let i=e.getFirst();i!==t;i=e.getNext(i)){const t=e.getElement(i),r=this.getHalfEdgeTwin(t),o=this.getHalfEdgeChain(t),a=this.getHalfEdgeChain(r);if(o!==a){let e=this.getHalfEdgeUserIndex(t,this.m_tmpHalfEdgeWindingNumberIndex);e+=this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeWindingNumberIndex),l+=e;let i=!1;0!==u.length&&u.at(-1)===a&&(c.pop(),u.pop(),i=!0),s.geometryReleaseAssert(this.getChainParent(a)!==n.nullHandle),i&&this.getChainParent(a)===o||(c.push(l),u.push(o))}}if(l+=h,0!==u.length&&u.at(-1)===m&&(c.pop(),u.pop()),0!==l){if(0===c.at(-1)){const e=this.m_simplifiedGeometry,t=this.getGeometryID(e);this.setChainParentage_(a,t)}}else if(0!==c.at(-1)){const e=this.m_simplifiedGeometry,t=this.getGeometryID(e);this.setChainParentage_(a,t)}}propagateParentageAlternate_(e,t,s,i,r,o,a){const m=this.m_simplifiedGeometry,h=this.getGeometryID(m);if(i===n.nullHandle)this.setChainParentage_(a,this.m_universeGeomID),1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,h):this.setChainParentage_(o,this.m_universeGeomID);else{const e=this.getChainParentage(a);if(0===e){const e=this.getHalfEdgeChain(i),t=this.getChainParentage(e);this.setChainParentage_(a,t),1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,t===h?this.m_universeGeomID:h):this.setChainParentage_(o,t)}else 1&this.getHalfEdgeUserIndex(s,this.m_tmpHalfEdgeOddEvenNumberIndex)?this.setChainParentage_(o,e===h?this.m_universeGeomID:h):this.setChainParentage_(o,e)}}tryOptimizedInsertion_(e,t,s,r,o){let a=o,m=-1,h=n.nullHandle,l=0;do{if(2===l)return!1;const e=this.getHalfEdgeUserIndex(a,t);if(-1!==e){if(-1!==m)return!1;m=e}else{if(h!==n.nullHandle)return!1;h=a}l++,a=this.getHalfEdgeNext(this.getHalfEdgeTwin(a))}while(o!==a);return h!==n.nullHandle&&-1!==m&&(this.setHalfEdgeUserIndex(e.getElement(m),t,i.StridedIndexTypeCollection.impossibleIndex2()),e.setElement(m,h),s.push(m),!0)}trySetChainParentFromTwin_(e,t){const s=this.getChainArea(e);if(0===s)return!1;const i=this.getChainArea(t);if(s>0&&i<0||s<0&&i>0)return this.setChainParent_(e,t),!0;{const s=this.getChainParent(t);if(s!==n.nullHandle)return this.setChainParent_(e,s),!0}return!1}createHalfEdges_(e,t){this.m_halfEdgeIndex=this.m_shape.createUserIndex();for(let i=0,r=t.size();i<r;i++){const r=t.read(i),o=this.m_shape.getUserIndex(r,this.m_clusterIndex),a=this.m_shape.getPathFromVertex(r),m=this.m_shape.getGeometryFromPath(a),h=this.m_shape.getGeometryType(m);if(s.isMultiPath(h)){const t=this.m_shape.getNextVertex(r);if(t===n.nullHandle)continue;const i=this.m_shape.getUserIndex(t,this.m_clusterIndex);if(o===i)continue;const a=this.newHalfEdgePair_(),l=this.getHalfEdgeTwin(a),u=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(u,0,r),this.m_clusterVertices.setField(u,1,-1),this.setHalfEdgeVertexIterator_(a,u),this.m_shape.setUserIndex(r,this.m_halfEdgeIndex,a),this.setHalfEdgeOrigin_(a,o);const c=this.getClusterHalfEdge(o);if(c===n.nullHandle)this.setClusterHalfEdge_(o,a),this.setHalfEdgePrev_(a,l),this.setHalfEdgeNext_(l,a);else{const e=this.getHalfEdgePrev(c);this.setHalfEdgePrev_(c,l),this.setHalfEdgeNext_(l,c),this.setHalfEdgeNext_(e,a),this.setHalfEdgePrev_(a,e)}this.setHalfEdgeOrigin_(l,i);const g=this.getClusterHalfEdge(i);if(g===n.nullHandle)this.setClusterHalfEdge_(i,l),this.setHalfEdgeNext_(a,l),this.setHalfEdgePrev_(l,a);else{const e=this.getHalfEdgePrev(g);this.setHalfEdgePrev_(g,a),this.setHalfEdgeNext_(a,g),this.setHalfEdgeNext_(e,l),this.setHalfEdgePrev_(l,e)}const d=this.getGeometryID(m);if(e===Y.enumInputModeBuildGraph){const e=h===s.GeometryType.enumPolygon?d:0;if(this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex,0),this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndex,e),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft,e),this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeParentageIndexLeft,0),this.m_bBuildGeometryParentageSets){const e=new q,t=this.m_shape.getGeometryUserIndex(m,this.m_geometryIDIndex);e.setBit(t),this.setEdgeBitSet_(a,e),this.setEdgeBitSet_(l,null),this.setLeftEdgeBitSet_(l,e),this.setLeftEdgeBitSet_(a,null)}}else if(e===Y.enumInputModeSimplifyWinding){const e=this.m_shape.getXY(r),s=this.m_shape.getXY(t);let n=0,i=0;e.compare(s)<0?n=1:i=-1,this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeWindingNumberIndex,n),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex,i)}else e===Y.enumInputModeSimplifyAlternate&&(this.setHalfEdgeUserIndex(a,this.m_tmpHalfEdgeOddEvenNumberIndex,1),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex,1));const p=h===s.GeometryType.enumPolygon?U.c_EdgeBitMask:0;this.setHalfEdgeParentage_(a,d|p),this.setHalfEdgeParentage_(l,d|p)}}if(this.m_shape.hasCurves()){this.m_segmentIndexHe=this.createUserIndexForHalfEdges();for(let e=0,s=t.size();e<s;e++){const s=t.read(e);if(this.m_shape.getSegment(s)){const e=this.m_shape.getUserIndex(s,this.m_halfEdgeIndex);e!==n.nullHandle&&(this.setHalfEdgeUserIndex(e,this.m_segmentIndexHe,this.m_shape.getVertexIndex(s)),this.setHalfEdgeUserIndex(this.getHalfEdgeTwin(e),this.m_segmentIndexHe,-2))}}}}mergeVertexListsOfEdges_(e,t){{const s=this.getHalfEdgeVertexIterator(t);if(s!==n.nullHandle){const i=this.getHalfEdgeVertexIterator(e);this.m_clusterVertices.setField(s,1,i),this.setHalfEdgeVertexIterator_(e,s),this.setHalfEdgeVertexIterator_(t,n.nullHandle)}}const s=this.getHalfEdgeTwin(e),i=this.getHalfEdgeTwin(t);{const e=this.getHalfEdgeVertexIterator(i);if(e!==n.nullHandle){const t=this.getHalfEdgeVertexIterator(s);this.m_clusterVertices.setField(e,1,t),this.setHalfEdgeVertexIterator_(s,e),this.setHalfEdgeVertexIterator_(i,n.nullHandle)}}if(-1!==this.m_segmentIndexHe){let n=this.getHalfEdgeUserIndex(e,this.m_segmentIndexHe);if(-1!==n){if(-2===n){const s=this.getHalfEdgeUserIndex(t,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(e,this.m_segmentIndexHe,s)}if(n=this.getHalfEdgeUserIndex(s,this.m_segmentIndexHe),-2===n){const e=this.getHalfEdgeUserIndex(i,this.m_segmentIndexHe);this.setHalfEdgeUserIndex(s,this.m_segmentIndexHe,e)}}}}sortHalfEdgesByAngle_(e){const t=[];for(let s=this.getFirstCluster();s!==n.nullHandle;s=this.getNextCluster(s)){t.length=0;const i=this.getClusterHalfEdge(s);if(i!==n.nullHandle){let o=i;do{t.push(o),o=this.getHalfEdgeNext(this.getHalfEdgeTwin(o))}while(o!==i);if(t.length>1){let o=!0;t.length>2?(t.sort((e,t)=>this.compareEdgeAngles_(e,t)),t.push(t[0])):this.compareEdgeAnglesForPair_(t[0],t[1])>0?t[1]=r.swap(t[0],t[0]=t[1]):o=!1;let a=t[0],m=a,h=this.getHalfEdgeTo(m),l=this.getHalfEdgeTwin(m),u=n.nullHandle;for(let s=1,i=t.length;s<i;s++){const i=t[s],r=this.getHalfEdgeTwin(i),o=this.getHalfEdgeOrigin(r);if(o!==h||i===m)this.updateVertexToHalfEdgeConnection_(u,!1),u=n.nullHandle,m=i,h=o,l=r;else{if(e===Y.enumInputModeBuildGraph){const e=this.getHalfEdgeParentageMask_(m)|this.getHalfEdgeParentageMask_(i);if(this.setHalfEdgeParentage_(m,e),this.setHalfEdgeParentage_(l,e),this.setHalfEdgeUserIndex(m,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(m,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex,this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndex)|this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndex)),this.setHalfEdgeUserIndex(m,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(m,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeParentageIndexLeft)),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft,this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeParentageIndexLeft)|this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeParentageIndexLeft)),this.m_bBuildGeometryParentageSets){let e,t,s;e=this.getEdgeBitSet_(m),t=this.getEdgeBitSet_(i),s=new q({copy:e}),s.assignOr(t),this.setEdgeBitSet_(m,s),e=this.getEdgeBitSet_(l),t=this.getEdgeBitSet_(r),s=new q({copy:e}),s.assignOr(t),this.setEdgeBitSet_(l,s),e=this.getLeftEdgeBitSet_(m),t=this.getLeftEdgeBitSet_(i),s=new q({copy:e}),s.assignOr(t),this.setLeftEdgeBitSet_(m,s),e=this.getLeftEdgeBitSet_(l),t=this.getLeftEdgeBitSet_(r),s=new q({copy:e}),s.assignOr(t),this.setLeftEdgeBitSet_(l,s)}}else if(-1!==this.m_tmpHalfEdgeWindingNumberIndex){const e=this.getHalfEdgeUserIndex(m,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeWindingNumberIndex),t=this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex)+this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeWindingNumberIndex);this.setHalfEdgeUserIndex(m,this.m_tmpHalfEdgeWindingNumberIndex,e),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeWindingNumberIndex,t)}else if(-1!==this.m_tmpHalfEdgeOddEvenNumberIndex){const e=this.getHalfEdgeUserIndex(m,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(i,this.m_tmpHalfEdgeOddEvenNumberIndex),t=this.getHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex)+this.getHalfEdgeUserIndex(r,this.m_tmpHalfEdgeOddEvenNumberIndex);this.setHalfEdgeUserIndex(m,this.m_tmpHalfEdgeOddEvenNumberIndex,e),this.setHalfEdgeUserIndex(l,this.m_tmpHalfEdgeOddEvenNumberIndex,t)}this.mergeVertexListsOfEdges_(m,i),this.deleteEdgeImpl_(i),u=m,t[s]=n.nullHandle,i===a&&(t[0]=n.nullHandle,a=n.nullHandle)}}if(this.updateVertexToHalfEdgeConnection_(u,!1),u=n.nullHandle,!o){a=n.nullHandle;for(let e=0,s=t.length;e<s;e++){const s=t[e];if(s!==n.nullHandle){a=s;break}}i!==a&&this.setClusterHalfEdge_(s,a);continue}a=n.nullHandle;for(let e=0,s=t.length;e<s;e++){const s=t[e];if(s===n.nullHandle)continue;if(a===n.nullHandle){a=s,m=a,h=this.getHalfEdgeTo(m),l=this.getHalfEdgeTwin(m);continue}if(s===m)continue;const i=this.getHalfEdgeTwin(s),r=this.getHalfEdgeOrigin(i);this.setHalfEdgeNext_(l,s),this.setHalfEdgePrev_(s,l),m=s,h=r,l=i}this.setClusterHalfEdge_(s,a)}}}}sortHalfEdgesByAngle3D_(e){s.geometryReleaseAssert(0)}buildChains_(e){this.m_universeChain=this.newChain_(),this.setChainHalfEdge_(this.m_universeChain,n.nullHandle);let t=this.m_universeChain;const s=this.createUserIndexForHalfEdges();for(let e=this.getFirstCluster();e!==n.nullHandle;e=this.getNextCluster(e)){const i=this.getClusterHalfEdge(e);if(i!==n.nullHandle){let e=i;do{if(1!==this.getHalfEdgeUserIndex(e,s)){const n=this.newChain_();this.setChainHalfEdge_(n,e),this.setChainPrev_(n,t),this.setChainNext_(t,n);let i=null;this.m_bBuildGeometryParentageSets&&(i=new q),t=n;let r=0,o=e;do{-1!==this.m_tmpHalfEdgeParentageIndex&&(r|=this.getHalfEdgeUserIndex(o,this.m_tmpHalfEdgeParentageIndex)),this.m_bBuildGeometryParentageSets&&i.assignOr(this.getEdgeBitSet_(o)),this.setHalfEdgeChain_(o,n),this.setHalfEdgeUserIndex(o,s,1),o=this.getHalfEdgeNext(o)}while(o!==e);this.m_bBuildGeometryParentageSets&&this.setChainBitSet_(n,i),this.setChainParentage_(n,r)}e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(e!==i)}}this.m_chainAreas=new i.AttributeStreamOfDbl(this.m_chainData.size(),Number.NaN),this.m_chainPerimeters=new i.AttributeStreamOfDbl(this.m_chainData.size(),Number.NaN),this.setChainArea_(this.m_universeChain,Number.POSITIVE_INFINITY),this.setChainPerimeter_(this.m_universeChain,Number.POSITIVE_INFINITY),this.deleteUserIndexForHalfEdges(s)}simplify_(e){s.geometryReleaseAssert(0)}simplifyAlternate_(){s.geometryReleaseAssert(0)}simplifyWinding_(){s.geometryReleaseAssert(0)}setEditShapeImpl_(e,t,o,a,m){this.removeShape(),this.m_bBuildChains=m,this.m_shape=e,this.m_geometryIDIndex=this.m_shape.createGeometryUserIndex();let h=this.m_shape.getTotalPointCount();if(o){h=0;for(let e=0,t=o.length;e<t;e++)h+=this.m_shape.getPointCount(o[e])}const l=new i.AttributeStreamOfInt32(0);let u=0,c=0;{let e=null!=o?o[0]:this.m_shape.getFirstGeometry(),t=1;for(;e!==n.nullHandle;){this.m_shape.setGeometryUserIndex(e,this.m_geometryIDIndex,c++);for(let t=this.m_shape.getFirstPath(e);t!==n.nullHandle;t=this.m_shape.getNextPath(t)){let e=this.m_shape.getFirstVertex(t);for(let s=0,n=this.m_shape.getPathSize(t);s<n;s++)l.add(e),e=this.m_shape.getNextVertex(e)}s.isPoint(this.m_shape.getGeometryType(e))||(u+=this.m_shape.getPathCount(e)),null!=o?(e=t<o.length?o[t]:n.nullHandle,t++):e=this.m_shape.getNextGeometry(e)}}this.m_universeGeomID=1<<Math.min(c,31),this.m_pointCount=l.size(),this.m_shape.sortVerticesSimpleByY(l,0,this.m_pointCount),this.m_clusterVertices.setCapacity(this.m_pointCount),this.progress_(a,!0),this.m_clusterData.setCapacity(this.m_pointCount+10),this.m_halfEdgeData.setCapacity(2*this.m_pointCount+32),this.m_chainData.setCapacity(Math.max(32,u)),this.m_clusterIndex=this.m_shape.createUserIndex();const g=r.Point2D.getNAN();let d=0;const p=r.Point2D.getNAN();for(let e=0;e<=this.m_pointCount;e++){if(e<this.m_pointCount){const t=l.read(e);this.m_shape.queryXY(t,p)}else p.setNAN();if(!g.isEqualPoint2D(p)){if(d<e){const t=this.newCluster_();let s=n.nullHandle,i=-1;for(let n=d;n<e;n++){i=l.read(n),this.m_shape.setUserIndex(i,this.m_clusterIndex,t);const e=this.m_clusterVertices.newElement();this.m_clusterVertices.setField(e,0,i),this.m_clusterVertices.setField(e,1,s),s=e;const r=this.m_shape.getPathFromVertex(i),o=this.m_shape.getGeometryFromPath(r),a=this.getGeometryID(o);this.setClusterParentage_(t,this.getClusterParentage(t)|a)}this.setClusterVertexIterator_(t,s),this.setClusterVertexIndex_(t,this.m_shape.getVertexIndex(i)),this.m_lastCluster!==n.nullHandle&&this.setNextCluster_(this.m_lastCluster,t),this.setPrevCluster_(t,this.m_lastCluster),this.m_lastCluster=t,this.m_firstCluster===n.nullHandle&&(this.m_firstCluster=t)}d=e,g.setCoordsPoint2D(p)}}if(this.m_shape.hasSegmentParentage()){-1===this.m_clusterBreakNodeIndex&&(this.m_clusterBreakNodeIndex=this.createUserIndexForClusters());for(let e=0;e<this.m_pointCount;e++){const t=l.read(e);if(this.m_shape.getSegmentParentageBreakVertex(t)){const e=this.getClusterFromVertex(t);this.setBreakNode(e,!0)}}}this.progress_(a,!0);{let e=null!=o?o[0]:this.m_shape.getFirstGeometry(),t=1;for(;e!==n.nullHandle;){for(let t=this.m_shape.getFirstPath(e);t!==n.nullHandle;t=this.m_shape.getNextPath(t)){if(this.m_shape.isStrongPathStart(t)){const e=this.m_shape.getFirstVertex(t),s=this.getClusterFromVertex(e);this.setStrongPathNode(s,!0)}if(this.m_shape.isStrongPathEnd(t)){const e=this.m_shape.isClosedPath(t)?this.m_shape.getFirstVertex(t):this.m_shape.getLastVertex(t),s=this.getClusterFromVertex(e);this.setStrongPathNode(s,!0)}}null!=o?(e=t<o.length?o[t]:n.nullHandle,t++):e=this.m_shape.getNextGeometry(e)}}if(t===Y.enumInputModeBuildGraph&&(this.m_tmpHalfEdgeParentageIndex=this.createUserIndexForHalfEdges(),this.m_tmpHalfEdgeParentageIndexLeft=this.createUserIndexForHalfEdges()),t===Y.enumInputModeSimplifyWinding&&(this.m_tmpHalfEdgeWindingNumberIndex=this.createUserIndexForHalfEdges()),t===Y.enumInputModeSimplifyAlternate&&(this.m_tmpHalfEdgeOddEvenNumberIndex=this.createUserIndexForHalfEdges()),this.createHalfEdges_(t,l),this.dbgNavigate_(),this.sortHalfEdgesByAngle_(t),!Number.isNaN(this.m_checkDirtyPlanesweepTolerance)&&!this.checkStructureAfterDirtySweep_())return this.m_bDirtyCheckFailed=!0,void this.cleanSetEditShapeImpl_();this.buildChains_(t),-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),this.m_bBuildChains&&this.planeSweepParentage_(t,a),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),this.dbgChkChainParents_(),this.dbgDumpChains_(),this.mergeSegmentParentage_(),this.dbgNavigate_(),this.dbgDumpChains_(),this.cleanSetEditShapeImpl_()}setEditShapeImpl3D_(e,t,n,i,r){s.geometryReleaseAssert(0)}cleanSetEditShapeImpl_(){-1!==this.m_tmpHalfEdgeParentageIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndex),this.m_tmpHalfEdgeParentageIndex=-1),-1!==this.m_tmpHalfEdgeParentageIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeParentageIndexLeft),this.m_tmpHalfEdgeParentageIndexLeft=-1),-1!==this.m_tmpHalfEdgeWindingNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeWindingNumberIndex),this.m_tmpHalfEdgeWindingNumberIndex=-1),-1!==this.m_tmpHalfEdgeOddEvenNumberIndex&&(this.deleteUserIndexForHalfEdges(this.m_tmpHalfEdgeOddEvenNumberIndex),this.m_tmpHalfEdgeOddEvenNumberIndex=-1)}cleanSetEditShapeImpl3D_(){s.geometryReleaseAssert(0)}dbgNavigate_(){}dbgChkChainParents_(){}deleteEdgeImpl_(e){const t=this.getHalfEdgeNext(e),s=this.getHalfEdgePrev(e),i=this.getHalfEdgeTwin(e),r=this.getHalfEdgeNext(i),o=this.getHalfEdgePrev(i);t!==i&&(this.setHalfEdgeNext_(o,t),this.setHalfEdgePrev_(t,o)),s!==i&&(this.setHalfEdgeNext_(s,r),this.setHalfEdgePrev_(r,s));const a=this.getHalfEdgeOrigin(e);this.getClusterHalfEdge(a)===e&&(r!==e?this.setClusterHalfEdge_(a,r):this.setClusterHalfEdge_(a,n.nullHandle));const m=this.getHalfEdgeOrigin(i);this.getClusterHalfEdge(m)===i&&(t!==i?this.setClusterHalfEdge_(m,t):this.setClusterHalfEdge_(m,n.nullHandle)),this.m_halfEdgeData.deleteElement(e),this.m_halfEdgeData.deleteElement(i)}getLeftSkipPolylines_(e,t){let s=t;for(;;){if(s=e.getPrev(s),-1===s)return n.nullHandle;{const t=e.getElement(s);if(this.getHalfEdgeChain(t)!==this.getHalfEdgeChain(this.getHalfEdgeTwin(t)))return t}}}checkStructureAfterDirtySweep_(){const e=r.sqr(this.m_checkDirtyPlanesweepTolerance),t=new r.Point2D,s=new r.Point2D,i=new r.Point2D,o=new r.Point2D,a=new r.Point2D;for(let r=this.getFirstCluster();r!==n.nullHandle;r=this.getNextCluster(r)){const m=this.getClusterHalfEdge(r);if(m!==n.nullHandle){let n=m;this.getHalfEdgeFromXY(n,t),this.getHalfEdgeToXY(n,s),i.setSub(s,t);let r=i.sqrLength();do{const m=n;if(n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n)),n!==m){this.getHalfEdgeToXY(n,o),a.setSub(o,t);const m=a.sqrLength(),h=a.crossProduct(i),l=h*h/(m*r);if(Math.min(m,r)*l<=e&&a.dotProduct(i)>=0)return!1;i.assign(a),r=m,s.assign(o)}}while(n!==m)}}return!0}extractPolygonPathFromChain_(e,t,s,r,o){const a=this.m_shape.hasSegmentParentage(),m=this.getChainHalfEdge(s);let h=m,l=n.nullHandle;const u=new i.Point;do{const i=this.getHalfEdgeTwin(h);if(this.getHalfEdgeChain(i)!==s){let s=n.nullHandle;const i=this.getHalfEdgeOrigin(h);if(r===n.nullHandle){const e=this.getClusterVertexIterator(i);s=this.getVertexFromVertexIterator(e)}else for(let e=this.getClusterVertexIterator(i);e!==n.nullHandle;e=this.incrementVertexIterator(e)){const t=this.getVertexFromVertexIterator(e);s===n.nullHandle&&(s=t);const i=this.m_shape.getPathFromVertex(t);if(this.m_shape.getGeometryFromPath(i)===r){s=t;break}}let m;if(l===n.nullHandle&&(l=e.insertPath(t,n.nullHandle),e.setClosedPath(l,!0)),this.m_shape===e?m=e.addVertex(l,s):(this.m_shape.queryPoint(s,u),m=e.addPoint(l,u)),this.isHalfEdgeCurve(h)&&(this.querySegmentXY(h,o),e.setSegmentToIndex(e.getVertexIndex(m),o.get().clone())),a){const t=this.getSegmentParentage(h);e.setSegmentParentageAndBreak(m,t,this.isBreakNode(i))}}h=this.getHalfEdgeNext(h)}while(h!==m)}mergeSegmentParentage_(){if(!this.m_shape.hasSegmentParentage())return;s.geometryReleaseAssert(-1!==this.m_clusterBreakNodeIndex),s.geometryReleaseAssert(-1===this.m_segmentParentageIndex);for(let e=this.getFirstCluster();e!==n.nullHandle;e=this.getNextCluster(e)){let t=0;const s=this.getClusterHalfEdge(e);if(s!==n.nullHandle){let e=s;do{t++,e=this.getHalfEdgeNext(this.getHalfEdgeTwin(e))}while(e!==s&&t<3)}2!==t&&this.setBreakNode(e,!0)}let e=[],t=[];this.m_segmentParentageIndex=this.createUserIndexForHalfEdges();const i=this.createUserIndexForHalfEdges();for(let s=this.getFirstCluster();s!==n.nullHandle;s=this.getNextCluster(s)){const o=this.getClusterHalfEdge(s);if(o!==n.nullHandle){let s=!1,n=o;do{let o=n;for(;-1===this.getHalfEdgeUserIndex(o,i);){const n=this.getHalfEdgeNext(o),a=this.getHalfEdgeTwin(o);z(this,o,t);const m=t.at(-1).parentage;if(!s){const t=this.getHalfEdgeOrigin(o);if(!this.isBreakNode(t)){const t=this.getHalfEdgePrev(o);o!==t&&(z(this,t,e),s=!0)}}if(s&&!B(t,e)){const e=this.getHalfEdgeOrigin(o);this.setBreakNode(e,!0)}e=r.swap(t,t=e),s=!0;const h=this.getHalfEdgeOrigin(n);this.isBreakNode(h)&&(s=!1),this.setHalfEdgeUserIndex(o,this.m_segmentParentageIndex,m),this.setHalfEdgeUserIndex(a,this.m_segmentParentageIndex,m),this.setHalfEdgeUserIndex(o,i,1),this.setHalfEdgeUserIndex(a,i,1),o=n}n=this.getHalfEdgeNext(this.getHalfEdgeTwin(n))}while(n!==o)}}this.deleteUserIndexForHalfEdges(i)}registerNewBitSet(e){return null===this.m_uniqueBitSets&&(this.m_uniqueBitSets=new V(e=>e.getHashCode(),(e,t)=>e.equals(t)),this.m_uniqueBitSets.add(this.getEmptySet())),null===e?this.getEmptySet():this.m_uniqueBitSets.has(e)?this.m_uniqueBitSets.get(e):(this.m_uniqueBitSets.add(e),e)}getLeftEdgeBitSet_(e){const t=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft);return s.geometryReleaseAssert(t>=0),s.geometryReleaseAssert(this.m_edgeBitSets.at(t)),this.m_edgeBitSets.at(t)}getEdgeBitSet_(e){const t=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndex);return s.geometryReleaseAssert(t>=0),this.m_edgeBitSets.at(t)}setEdgeBitSet_(e,t){s.geometryReleaseAssert(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),-1===this.m_edgeBitSetIndex&&(this.m_edgeBitSetIndex=this.createUserIndexForHalfEdges());const n=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndex);-1!==n?this.m_edgeBitSets[n]=t:(this.setHalfEdgeUserIndex(e,this.m_edgeBitSetIndex,this.m_edgeBitSets.length),this.m_edgeBitSets.push(t))}setLeftEdgeBitSet_(e,t){s.geometryReleaseAssert(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),-1===this.m_edgeBitSetIndexLeft&&(this.m_edgeBitSetIndexLeft=this.createUserIndexForHalfEdges());const n=this.getHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft);-1!==n?this.m_edgeBitSets[n]=t:(this.setHalfEdgeUserIndex(e,this.m_edgeBitSetIndexLeft,this.m_edgeBitSets.length),this.m_edgeBitSets.push(t))}setChainBitSet_(e,t){s.geometryReleaseAssert(this.m_bBuildGeometryParentageSets),t=this.registerNewBitSet(t),-1===this.m_chainBitSetIndex&&(this.m_chainBitSetIndex=this.createUserIndexForChains());const n=this.getChainUserIndex(e,this.m_chainBitSetIndex);-1!==n?this.m_chainBitSets[n]=t:(this.setChainUserIndex(e,this.m_chainBitSetIndex,this.m_chainBitSets.length),this.m_chainBitSets.push(t))}getEmptySet(){return this.m_emptyBitSet||(this.m_emptyBitSet=new q),this.m_emptyBitSet}deleteEdgeBitSets_(){-1!==this.m_edgeBitSetIndex&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndex),this.m_edgeBitSetIndex=-1),-1!==this.m_edgeBitSetIndexLeft&&(this.deleteUserIndexForHalfEdges(this.m_edgeBitSetIndexLeft),this.m_edgeBitSetIndexLeft=-1),this.m_edgeBitSets.length=0,this.m_uniqueBitSets=null}deleteChainBitSets_(){-1!==this.m_chainBitSetIndex&&(this.deleteUserIndexForChains(this.m_chainBitSetIndex),this.m_chainBitSetIndex=-1,this.m_chainBitSets.length=0)}dbgPrintEdge_(e){}dbgVerifyEdgeSegment(e){}}U.c_EdgeParentageMask=~(1<<31),U.c_EdgeBitMask=1<<31;class j{freeNode_(e){this.m_listNodes.deleteElement(e)}newNode_(){return this.m_listNodes.newElement()}freeList_(e){this.m_lists.deleteElement(e)}newList_(){return this.m_lists.newElement()}Init_(e){s.geometryReleaseAssert(0)}constructor(e){this.m_listNodes=new i.StridedIndexTypeCollection(2),this.m_listOfLists=j.st_nullNode(),this.m_bAllowNavigationBetweenLists=!0,void 0===e&&(e=!0),this.m_bAllowNavigationBetweenLists=e,this.m_lists=new i.StridedIndexTypeCollection(this.m_bAllowNavigationBetweenLists?4:2)}createList(){const e=this.newList_();return this.m_bAllowNavigationBetweenLists&&(this.m_lists.setField(e,3,this.m_listOfLists),this.m_listOfLists!==j.st_nullNode()&&this.m_lists.setField(this.m_listOfLists,2,e),this.m_listOfLists=e),e}deleteList(e){let t=this.getFirst(e);for(;t!==j.st_nullNode();){const e=t;t=this.getNext(t),this.freeNode_(e)}if(this.m_bAllowNavigationBetweenLists){const t=this.m_lists.getField(e,2),s=this.m_lists.getField(e,3);t!==j.st_nullNode()?this.m_lists.setField(t,3,s):this.m_listOfLists=s,s!==j.st_nullNode()&&this.m_lists.setField(s,2,t)}this.freeList_(e)}reserveLists(e){this.m_lists.setCapacity(e)}addElement(e,t){this.m_lists.getField(e,0);const s=this.m_lists.getField(e,1),n=this.newNode_();return s!==j.st_nullNode()?(this.m_listNodes.setField(s,1,n),this.m_lists.setField(e,1,n)):(this.m_lists.setField(e,0,n),this.m_lists.setField(e,1,n)),this.m_listNodes.setField(n,0,t),n}reserveNodes(e){this.m_listNodes.setCapacity(e)}deleteElementDirect(e,t,s){t!==j.st_nullNode()?(this.m_listNodes.setField(t,1,this.m_listNodes.getField(s,1)),this.m_lists.getField(e,1)===s&&this.m_lists.setField(e,1,t)):(this.m_lists.setField(e,0,this.m_listNodes.getField(s,1)),this.m_lists.getField(e,1)===s&&this.m_lists.setField(e,1,j.st_nullNode())),this.freeNode_(s)}deleteElementSearch(e,t){let s=-1,n=this.getFirst(e);for(;n!==t;)s=n,n=this.getNext(n);this.deleteElementDirect(e,s,t)}concatenateLists(e,t){const s=this.m_lists.getField(e,1),n=this.m_lists.getField(t,0);if(n!==j.st_nullNode()&&(s!==j.st_nullNode()?(this.m_listNodes.setField(s,1,n),this.m_lists.setField(e,1,this.m_lists.getField(t,1))):(this.m_lists.setField(e,0,n),this.m_lists.setField(e,1,this.m_lists.getField(t,1)))),this.m_bAllowNavigationBetweenLists){const e=this.m_lists.getField(t,2),s=this.m_lists.getField(t,3);e!==j.st_nullNode()?this.m_lists.setField(e,3,s):this.m_listOfLists=s,s!==j.st_nullNode()&&this.m_lists.setField(s,2,e)}return this.freeList_(t),e}getElement(e){return this.m_listNodes.getField(e,0)}getData(e){return this.getElement(e)}setElement(e,t){s.geometryReleaseAssert(0)}getNext(e){return this.m_listNodes.getField(e,1)}getFirst(e){return this.m_lists.getField(e,0)}getFirstElement(e){const t=this.getFirst(e);return this.getElement(t)}static st_nullNode(){return-1}clear(){this.m_listNodes.deleteAll(!0),this.m_lists.deleteAll(!0),this.m_listOfLists=j.st_nullNode()}isEmpty(e){return s.geometryReleaseAssert(0),!1}getNodeCount(){return this.m_listNodes.size()}getListCount(){return this.m_lists.size()}getFirstList(){return this.m_listOfLists}getNextList(e){return this.m_lists.getField(e,3)}}function W(e=-1){return{m_value:e,m_line:new n.Line,m_segment:null,m_segmentInfo:new n.SegmentTypeInfo(-1),m_env:new r.Envelope1D(0,0),m_dxdy:55555555,m_bHorizontal:!1,m_bCurve:!1}}class Z extends i.Comparator{constructor(e,t,s){super(!0),this.m_bIntersectionDetected=!1,this.m_nonSimpleResult=new u.NonSimpleResult,this.m_tempSimpleEdge1=W(),this.m_tempSimpleEdge2=W(),this.m_prev1=n.nullHandle,this.m_prev2=n.nullHandle,this.m_vertex1=n.nullHandle,this.m_vertex2=n.nullHandle,this.m_currentNode=-1,this.m_prevX1=Number.NaN,this.m_prevX2=Number.NaN,this.m_prevY=Number.NaN,this.m_prevX=0,this.m_sweepY=Number.NaN,this.m_sweepX=0,this.m_ptSweep=new r.Point2D,this.m_simpleEdgesCache=[],this.m_simpleEdgesRecycle=[],this.m_cOutstandingConstructedEdges=0,this.m_shape=e,this.m_bShapeHasSegments=this.m_shape.hasCurves(),this.m_tolerance=t,this.m_tolerance10=10*t,this.m_bIsSimple=s;const i=Math.trunc(Math.min(3*e.getTotalPointCount()/2,67)),o=Math.min(7,i);this.m_simpleEdgesCache.length=o}tryGetCachedEdge_(e){const t=this.m_simpleEdgesCache[(e&r.indexTypeMax())%this.m_simpleEdgesCache.length];return t&&t.m_value===e?t:null}tryDeleteCachedEdge_(e){const t=(e&r.indexTypeMax())%this.m_simpleEdgesCache.length,s=this.m_simpleEdgesCache[t];s&&s.m_value===e&&(this.m_simpleEdgesRecycle.push(s),this.m_simpleEdgesCache[t]=null)}tryCreateCachedEdge_(e){const t=(e&r.indexTypeMax())%this.m_simpleEdgesCache.length;let s=this.m_simpleEdgesCache[t];return s?null:(0===this.m_simpleEdgesRecycle.length?(s=W(),this.m_cOutstandingConstructedEdges++):s=this.m_simpleEdgesRecycle.pop(),s.m_value=e,this.m_simpleEdgesCache[t]=s,s)}initSimpleEdge_(e,t){this.m_bShapeHasSegments&&this.initSimpleEdgeHelper_(e,t)||e.m_bCurve||(this.m_shape.queryLineConnector(t,e.m_line,!0),e.m_segment=e.m_line,e.m_env.setCoordsNoNAN(e.m_line.getStartX(),e.m_line.getEndX()),e.m_env.vmax+=this.m_tolerance,e.m_line.orientBottomUp(),e.m_bHorizontal=e.m_line.getEndY()===e.m_line.getStartY(),e.m_bHorizontal||(e.m_dxdy=(e.m_line.getEndX()-e.m_line.getStartX())/(e.m_line.getEndY()-e.m_line.getStartY())))}initSimpleEdgeHelper_(e,t){if(e.m_segment=this.m_shape.getSegment(t),e.m_segmentInfo=this.m_shape.getOriginalSegmentInfo(t),e.m_bCurve=null!==e.m_segment,e.m_bCurve){const t=e.m_segment.clone();return t.orientBottomUp(),e.m_segment=t,e.m_env=e.m_segment.queryInterval(0,0),e.m_env.vmax+=this.m_tolerance,!0}return!1}compareTwoSegments_(e,t){const s=e.getStartXY(),n=e.getEndXY(),i=t.getStartXY(),o=t.getEndXY();if(this.m_ptSweep.setCoords(this.m_sweepX,this.m_sweepY),s.isEqualPoint2D(i)&&this.m_sweepY===s.y){this.m_ptSweep.assign(n.compare(o)<0?n:o);const s=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),i=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x);if(Math.abs(s-i)>this.m_tolerance)return s<i?-1:1}const a=s.compare(i)<0?i:s,m=n.compare(o)<0?n:o;let h=0,l=0;for(let s=1;s<5;s++){r.lerpPoint2D(a,m,s/5,this.m_ptSweep);const n=e.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),i=t.intersectionOfYMonotonicWithAxisX(this.m_ptSweep.y,this.m_ptSweep.x),o=Math.abs(n-i);o>h&&(h=o,l=n<i?-1:1)}return 0===l?this.errorCracking():l}compareNonHorizontal_(e,t){if(e.m_line.getStartY()===t.m_line.getStartY()&&e.m_line.getStartX()===t.m_line.getStartX())return e.m_line.getEndY()===t.m_line.getEndY()&&e.m_line.getEndX()===t.m_line.getEndX()?this.m_bIsSimple?this.errorCoincident():0:this.compareNonHorizontalUpperEnd_(e,t);if(e.m_line.getEndY()===t.m_line.getEndY()&&e.m_line.getEndX()===t.m_line.getEndX())return this.compareNonHorizontalLowerEnd_(e,t);const s=this.compareNonHorizontalLowerEnd_(e,t),n=this.compareNonHorizontalUpperEnd_(e,t);return s<0&&n<0?-1:s>0&&n>0?1:this.errorCracking()}compareHorizontal1Case1_(e,t){if(e.getEndX()>t.getEndX()){if(t.getEndX()>t.getStartX()&&t.getEndY()-t.getStartY()<2*this.m_tolerance&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((t.getEndY()-t.getStartY())/(t.getEndX()-t.getStartX())*(e.getEndX()-e.getStartX())<this.m_tolerance10&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return 1}compareHorizontal1Case2_(e,t){if(e.getStartX()<t.getStartX()){if(t.getEndX()>t.getStartX()&&t.getEndY()-t.getStartY()<2*this.m_tolerance&&e.isIntersectingPoint(t.getEndXY(),this.m_tolerance,!0))return this.errorCracking()}else if((t.getEndY()-t.getStartY())/(t.getEndX()-t.getStartX())*(e.getStartX()-e.getEndX())<this.m_tolerance10&&t.isIntersectingPoint(e.getStartXY(),this.m_tolerance,!0))return this.errorCracking();return-1}compareHorizontal1Case3_(e,t){const s=r.Point2D.getNAN();s.setSub(t.getEndXY(),t.getStartXY()),s.rightPerpendicularThis(),s.normalize();const n=r.Point2D.getNAN();n.setSub(e.getStartXY(),t.getStartXY());const i=r.Point2D.getNAN();i.setSub(e.getEndXY(),t.getStartXY());const o=n.dotProduct(s),a=i.dotProduct(s),m=Math.abs(o),h=Math.abs(a);if(m<h){if(m<this.m_tolerance10&&t.isIntersectingPoint(e.getStartXY(),this.m_tolerance,!0))return this.errorCracking()}else if(h<this.m_tolerance10&&t.isIntersectingPoint(e.getEndXY(),this.m_tolerance,!0))return this.errorCracking();return o<0&&a<0?-1:o>0&&a>0?1:this.errorCracking()}compareHorizontal1_(e,t){return e.getStartY()===t.getStartY()&&e.getStartX()===t.getStartX()?this.compareHorizontal1Case1_(e,t):e.getEndY()===t.getEndY()&&e.getEndX()===t.getEndX()?this.compareHorizontal1Case2_(e,t):this.compareHorizontal1Case3_(e,t)}compareHorizontal2_(e,t){return e.getEndY()===t.getEndY()&&e.getEndX()===t.getEndX()&&e.getStartY()===t.getStartY()&&e.getStartX()===t.getStartX()?this.m_bIsSimple?this.errorCoincident():0:this.errorCracking()}compareNonHorizontalLowerEnd_(e,t){let s=1;if(e.m_line.getStartY()<t.m_line.getStartY()){s=-1;const n=e;e=t,t=n}const n=e.m_line,i=t.m_line,r=n.getStartX()-i.getStartX(),o=t.m_dxdy*(n.getStartY()-i.getStartY()),a=this.m_tolerance10;return r<o-a?-s:r>o+a?s:i.isIntersectingPoint(n.getStartXY(),this.m_tolerance,!0)?this.errorCracking():r<o?-s:s}compareNonHorizontalUpperEnd_(e,t){let s=1;if(t.m_line.getEndY()<e.m_line.getEndY()){s=-1;const n=e;e=t,t=n}const n=e.m_line,i=t.m_line,r=n.getEndX()-i.getStartX(),o=t.m_dxdy*(n.getEndY()-i.getStartY()),a=this.m_tolerance10;return r<o-a?-s:r>o+a?s:i.isIntersectingPoint(n.getEndXY(),this.m_tolerance,!0)?this.errorCracking():r<o?-s:s}errorCoincident(){return this.m_bIntersectionDetected=!0,this.m_nonSimpleResult=new u.NonSimpleResult(7,this.m_vertex1,this.m_vertex2),-1}errorCracking(){if(this.m_bIntersectionDetected=!0,this.m_bIsSimple){const e=6;this.m_nonSimpleResult=new u.NonSimpleResult(e,this.m_vertex1,this.m_vertex2)}else this.m_prev1=n.nullHandle,this.m_prev2=n.nullHandle,this.m_vertex1=n.nullHandle,this.m_vertex2=n.nullHandle;return-1}compareSegments_(e,t,s,i){if(s.m_env.vmax<i.m_env.vmin)return-1;if(i.m_env.vmax<s.m_env.vmin)return 1;if(!s.m_bCurve&&!i.m_bCurve){let e=s.m_bHorizontal?1:0;return e|=i.m_bHorizontal?2:0,0===e?this.compareNonHorizontal_(s,i):1===e?this.compareHorizontal1_(s.m_line,i.m_line):2===e?-1*this.compareHorizontal1_(i.m_line,s.m_line):this.compareHorizontal2_(s.m_line,i.m_line)}if(this.m_bIntersectionDetected)return-1;const r=this.m_prevY===this.m_sweepY&&this.m_prevX===this.m_sweepX;let o,a;if(r&&e===this.m_prev1?o=this.m_prevX1:(o=Number.NaN,this.m_prev1=n.nullHandle),r&&t===this.m_prev2?a=this.m_prevX2:(a=Number.NaN,this.m_prev2=n.nullHandle),this.m_prevY=this.m_sweepY,this.m_prevX=this.m_sweepX,Number.isNaN(o)){this.m_prev1=e;const t=s.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);o=t,this.m_prevX1=t}if(Number.isNaN(a)){this.m_prev2=t;const e=i.m_segment.intersectionOfYMonotonicWithAxisX(this.m_sweepY,this.m_sweepX);a=e,this.m_prevX2=e}const m=n.isIntersectingEx(!0,!0,s.m_segment,i.m_segment,this.m_tolerance,!0);return 0!==m?2===m?this.m_bIsSimple?this.errorCoincident():s.m_segmentInfo.equals(i.m_segmentInfo)?0:this.errorCracking():this.errorCracking():Math.abs(o-a)<=this.m_tolerance?this.compareTwoSegments_(s.m_segment,i.m_segment):o<a?-1:o>a?1:0}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1}intersectionDetected(){return this.m_bIntersectionDetected}getLastComparedNode(){return this.m_currentNode}getResult(){return this.m_nonSimpleResult}setSweepY(e,t){this.m_sweepY=e,this.m_sweepX=t,this.m_prev1=n.nullHandle,this.m_prev2=n.nullHandle,this.m_vertex1=n.nullHandle,this.m_vertex2=n.nullHandle}compare(e,t,s){if(this.m_bIntersectionDetected)return-1;const n=e.getElement(s),i=t;return this.m_currentNode=s,this.compareSegments(i,i,n,n)}compareSegments(e,t,s,n){let i=this.tryGetCachedEdge_(e);null===i?this.m_vertex1===t?i=this.m_tempSimpleEdge1:(this.m_vertex1=t,i=this.tryCreateCachedEdge_(e),null===i&&(i=this.m_tempSimpleEdge1,this.m_tempSimpleEdge1.m_value=e),this.initSimpleEdge_(i,t)):this.m_vertex1=t;let r=this.tryGetCachedEdge_(s);return null===r?this.m_vertex2===n?r=this.m_tempSimpleEdge2:(this.m_vertex2=n,r=this.tryCreateCachedEdge_(s),null===r&&(r=this.m_tempSimpleEdge2,this.m_tempSimpleEdge2.m_value=s),this.initSimpleEdge_(r,n)):this.m_vertex2=n,this.compareSegments_(t,n,i,r)}onDelete(e){this.tryDeleteCachedEdge_(e)}onSet(e){this.tryDeleteCachedEdge_(e)}onEndSearch(e){this.tryDeleteCachedEdge_(e)}onAddUniqueElementFailed(e){this.tryDeleteCachedEdge_(e)}}class Q{constructor(e,t){this.m_bIntersectionDetected=!1,this.m_pointOfInterest=r.Point2D.getNAN(),this.m_line1=new n.Line,this.m_seg1=null,this.m_env=r.Envelope1D.constructEmpty(),this.m_vertex1=-1,this.m_currentNode=-1,this.m_minDist=Number.MAX_VALUE,this.m_shape=e,this.m_tolerance=t}getCurrentNode(){return this.m_currentNode}clearIntersectionDetectedFlag(){this.m_bIntersectionDetected=!1,this.m_minDist=Number.MAX_VALUE}intersectionDetected(){return this.m_bIntersectionDetected}setPoint(e){this.m_pointOfInterest.assign(e)}compare(e,t){const s=e.getElement(t);return this.compareVertex(e,t,s)}compareVertex(e,s,i){let o,a=this.m_shape.getSegment(i),m=!0;if(null==a)this.m_shape.queryLineConnector(i,this.m_line1,!0),this.m_env.setCoordsNoNAN(this.m_line1.getStartX(),this.m_line1.getEndX()),a=this.m_line1,o=this.m_line1.getStartY()===this.m_line1.getEndY();else{const e=t.Envelope2D.constructEmpty();a.queryLooseEnvelope(e),e.queryIntervalX(this.m_env),o=0===e.height(),m=!1}if(this.m_pointOfInterest.x+this.m_tolerance<this.m_env.vmin)return-1;if(this.m_pointOfInterest.x-this.m_tolerance>this.m_env.vmax)return 1;if(o)return this.m_currentNode=s,this.m_bIntersectionDetected=!0,0;let h=0;if(m){n.orientBottomUp(this.m_line1);const e=this.m_line1.getStartXY(),t=new r.Point2D;t.setSub(this.m_line1.getEndXY(),e),t.rightPerpendicularThis();const s=new r.Point2D;s.setSub(this.m_pointOfInterest,e),h=t.dotProduct(s),h/=t.length()}else h=a.intersectionOfYMonotonicWithAxisX(this.m_pointOfInterest.y,this.m_pointOfInterest.x)-this.m_pointOfInterest.x;return h<10*-this.m_tolerance?-1:h>10*this.m_tolerance?1:(a.isIntersectingPoint(this.m_pointOfInterest,this.m_tolerance)&&(Math.abs(h)<this.m_minDist&&(this.m_currentNode=s,this.m_minDist=h),this.m_bIntersectionDetected=!0),h<0?-1:h>0?1:0)}}class K{constructor(e,t){this.m_lists=new j(!1),this.m_hash=t,this.m_hashBuckets=new Int32Array(e),this.m_hashBuckets.fill(K.st_nullNode()),this.m_bitFilter=new Int32Array(10*e+31>>5)}reserveElements(e){this.m_lists.reserveLists(Math.min(this.m_hashBuckets.length,e)),this.m_lists.reserveNodes(e)}addElement(e,t){void 0===t&&(t=this.m_hash.getHash(e));const s=t%(this.m_bitFilter.length<<5);this.m_bitFilter[s>>5]|=1<<(31&s);const n=t%this.m_hashBuckets.length;let i=this.m_hashBuckets[n];return i===j.st_nullNode()&&(i=this.m_lists.createList(),this.m_hashBuckets[n]=i),this.m_lists.addElement(i,e)}deleteElement(e,t){void 0===t&&(t=this.m_hash.getHash(e));const n=t%this.m_hashBuckets.length,i=this.m_hashBuckets[n];i===j.st_nullNode()&&s.throwInvalidArgumentException("");let r=this.m_lists.getFirst(i),o=j.st_nullNode();for(;r!==j.st_nullNode();){const t=this.m_lists.getData(r),s=this.m_lists.getNext(r);t===e?(this.m_lists.deleteElementDirect(i,o,r),this.m_lists.getFirst(i)===j.st_nullNode()&&(this.m_lists.deleteList(i),this.m_hashBuckets[n]=j.st_nullNode())):o=r,r=s}}getFirstInBucket(e){const t=e%(this.m_bitFilter.length<<5);if(!(this.m_bitFilter[t>>5]&1<<(31&t)))return j.st_nullNode();const s=e%this.m_hashBuckets.length,n=this.m_hashBuckets[s];return n===j.st_nullNode()?j.st_nullNode():this.m_lists.getFirst(n)}getNextInBucket(e){return this.m_lists.getNext(e)}findNode(e){const t=this.m_hash.getHash(e);let s=this.getFirstInBucket(t);for(;s!==j.st_nullNode();){const t=this.m_lists.getData(s);if(this.m_hash.equal(t,e))return s;s=this.m_lists.getNext(s)}return j.st_nullNode()}deleteNode(e){const t=this.getElement(e),n=this.m_hash.getHash(t)%this.m_hashBuckets.length,i=this.m_hashBuckets[n];i===j.st_nullNode()&&s.throwInvalidArgumentException(""),this.m_lists.deleteElementSearch(i,e),this.m_lists.getFirst(i)===j.st_nullNode()&&(this.m_lists.deleteList(i),this.m_hashBuckets[n]=j.st_nullNode())}getElement(e){return this.m_lists.getData(e)}static st_nullNode(){return j.st_nullNode()}clear(){s.geometryReleaseAssert(0)}size(){return this.m_lists.getNodeCount()}dbgPrintBucketHistogram(){}}function $(e,t,s,n,i){const r=new ne(i);return r.m_shape=e,r.m_sqrTolerance=t*t,r.m_cellSize=2*t,r.m_invCellSize=1/r.m_cellSize,r.m_geometry=s,r.m_bTrackChanges=n,r.m_bHasSegmentParentage=e.hasSegmentParentage(),r.clusterNonReciprocal()}function J(e,t,s,n,i){const r=e-s,o=t-n;return r*r+o*o<=i}function ee(e,t,s,n,i,o){const a={pt:new r.Point2D,weight:0,rank:0,bMerged:!1},m=s+i;let h=!1,l=e.x;e.x!==t.x&&(n===o&&(l=(e.x*s+t.x*i)/m),h=!0);let u=e.y;return e.y!==t.y&&(n===o&&(u=(e.y*s+t.y*i)/m),h=!0),n!==o?n>o?(a.rank=n,a.weight=s,a.pt=e):(a.rank=o,a.weight=i,a.pt=t):(a.pt.setCoords(l,u),a.weight=m,a.rank=n),a.bMerged=h,a}function te(e,t){const s=r.hashForClustering(e);return r.hashForClustering2(s,t)}class se{constructor(e,t,s,n,i){this.m_workPt=new r.Point2D,this.m_shape=e,this.m_sqrTolerance=s,this.m_invCellSize=n,this.m_origin=t.clone(),this.m_hashValues=i}getHash(e){return this.m_shape.getUserIndex(e,this.m_hashValues)}calculateHashFromVertex(e){this.m_shape.queryXY(e,this.m_workPt);const t=this.m_workPt.x-this.m_origin.x,s=Math.trunc(t*this.m_invCellSize+.5),n=this.m_workPt.y-this.m_origin.y;return te(s,Math.trunc(n*this.m_invCellSize+.5))}equal(e,t){return s.geometryReleaseAssert(0),!1}}class ne{constructor(e){this.m_origin=r.Point2D.getNAN(),this.m_sqrTolerance=0,this.m_cellSize=0,this.m_invCellSize=0,this.m_geometry=n.nullHandle,this.m_bucketArray=r.makePrimitiveArray(4,Number.NaN),this.m_bucketHash=r.makePrimitiveArray(4,Number.NaN),this.m_dbgCandidateCheckCount=0,this.m_nsr=new u.NonSimpleResult,this.m_hashValues=-1,this.m_newClusters=-1,this.m_bTrackChanges=!1,this.m_bHasSegmentParentage=!1,this.m_shape=null,this.m_clusters=new j,this.m_hashFunction=null,this.m_hashTable=null,this.m_progressCounter=0,this.m_progressTracker=e}progress_(){}collectClusterCandidates(e,t){const s=r.Point2D.getNAN();this.m_shape.queryXY(e,s);const n=(s.x-this.m_origin.x)*this.m_invCellSize,i=(s.y-this.m_origin.y)*this.m_invCellSize,o=Math.trunc(n),a=Math.trunc(i);let m=0;for(let e=0;e<=1;e+=1)for(let t=0;t<=1;t+=1){const s=te(o+e,a+t),n=this.m_hashTable.getFirstInBucket(s);n!==K.st_nullNode()&&(this.m_bucketArray[m]=n,this.m_bucketHash[m]=s,m++)}for(let e=m-1;e>=1;e--){const t=this.m_bucketArray[e];for(let s=e-1;s>=0;s--)if(t===this.m_bucketArray[s]){this.m_bucketHash[s]=-1,m--,e!==m&&(this.m_bucketHash[e]=this.m_bucketHash[m],this.m_bucketArray[e]=this.m_bucketArray[m]);break}}for(let n=0;n<m;n++)this.collectNearestNeighbourCandidates(e,this.m_bucketHash[n],s,this.m_bucketArray[n],t)}collectNearestNeighbourCandidates(e,t,s,n,i){const o=r.Point2D.getNAN();for(let r=n;r!==K.st_nullNode();r=this.m_hashTable.getNextInBucket(r)){const n=this.m_hashTable.getElement(r);e===n||-1!==t&&this.m_shape.getUserIndex(n,this.m_hashValues)!==t||(this.m_shape.queryXY(n,o),J(s.x,s.y,o.x,o.y,this.m_sqrTolerance)&&i.push(r))}}mergeClusters(e,t,s){let n=this.m_shape.getUserIndex(e,this.m_newClusters);const r=this.m_shape.getUserIndex(t,this.m_newClusters);-1===n&&(n=this.m_clusters.createList(),this.m_clusters.addElement(n,e),this.m_shape.setUserIndex(e,this.m_newClusters,n)),-1===r?this.m_clusters.addElement(n,t):this.m_clusters.concatenateLists(n,r),this.m_shape.setUserIndex(t,this.m_newClusters,i.StridedIndexTypeCollection.impossibleIndex2());const o=this.mergeVertices(e,t);if(s){const t=this.m_hashFunction.calculateHashFromVertex(e);this.m_shape.setUserIndex(e,this.m_hashValues,t)}return o}mergeVertices(e,t){const s=r.Point2D.getNAN();this.m_shape.queryXY(e,s);const n=r.Point2D.getNAN();this.m_shape.queryXY(t,n);const i=this.m_shape.getRank(e),o=this.m_shape.getRank(t),a=this.m_shape.getWeight(e),m=this.m_shape.getWeight(t);let h,l,u,c,g=!1;if(i===o?(h=i,l=a+m,u=s.x,s.x!==n.x&&(u=(s.x*a+n.x*m)/l,g=!0),c=s.y,s.y!==n.y&&(c=(s.y*a+n.y*m)/l,g=!0)):(i>o?(u=s.x,c=s.y,l=a,h=i):(u=n.x,c=n.y,l=m,h=o),g=!s.equals(n)),g&&(this.m_shape.setXYMonotonic(e,u,c),this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(e,!0),this.m_bHasSegmentParentage)){const s=this.m_shape.getSegmentParentageBreakVertex(e)||this.m_shape.getSegmentParentageBreakVertex(t);this.m_shape.setSegmentParentageBreakVertex(e,s),this.m_shape.setSegmentParentageBreakVertex(t,s)}return this.m_shape.setWeight(e,l),this.m_shape.setRank(e,h),g}needsClustering(){const e={stack:[],error:void 0,hasError:!1};try{o.__addDisposableResource(e,r.makeScopedCall(()=>{this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters)}),!1);const t=this.m_shape.getSelectedCount(),s=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin.assign(s.getLowerLeft());const a=Math.max(s.height(),s.width())/(r.intMax()-1);this.m_cellSize<a&&(this.m_cellSize=a,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(this.m_shape.getSelectedCount()/3+1),this.m_clusters.reserveNodes(this.m_shape.getSelectedCount()/3+1),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new se(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new K(4*t/3,this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let m=!1;for(let e=0;e<2;e++){const t=[],s=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let r=s.next();r!==n.nullHandle;r=s.next()){if(this.progress_(),e>0&&this.m_shape.getUserIndex(r,this.m_newClusters)===i.StridedIndexTypeCollection.impossibleIndex2())continue;let s;if(0===e?(s=this.m_hashFunction.calculateHashFromVertex(r),this.m_shape.setUserIndex(r,this.m_hashValues,s)):s=this.m_shape.getUserIndex(r,this.m_hashValues),this.collectClusterCandidates(r,t),0!==t.length){for(let e=0,s=t.length;e<s;e++){this.progress_();const s=t[e],n=this.m_hashTable.getElement(s);if(this.m_hashTable.deleteNode(s),!this.m_shape.isEqualXY(r,n))return this.m_nsr=new u.NonSimpleResult(5,this.m_shape.getVertexIndex(r),this.m_shape.getVertexIndex(n)),m=!0,m;this.mergeClusters(r,n,!1)}t.length=0}0===e&&this.m_hashTable.addElement(r,s)}}return m}catch(t){e.error=t,e.hasError=!0}finally{o.__disposeResources(e)}}clusterNonReciprocal(){const e=this.m_shape.getSelectedCount(),t=this.m_shape.getEnvelope2D(this.m_progressTracker);this.m_origin=t.getLowerLeft();const s=Math.max(t.height(),t.width())/(r.intMax()-1);this.m_cellSize<s&&(this.m_cellSize=s,this.m_invCellSize=1/this.m_cellSize),this.m_clusters.clear(),this.m_clusters.reserveLists(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_clusters.reserveNodes(Math.trunc(this.m_shape.getSelectedCount()/3+1)),this.m_hashValues=this.m_shape.createUserIndex(),this.m_newClusters=this.m_shape.createUserIndex(),this.m_hashFunction=new se(this.m_shape,this.m_origin,this.m_sqrTolerance,this.m_invCellSize,this.m_hashValues),this.m_hashTable=new K(Math.trunc(4*e/3),this.m_hashFunction),this.m_hashTable.reserveElements(this.m_shape.getSelectedCount());let o=!1;{const e=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let t=e.next();t!==n.nullHandle;t=e.next()){this.progress_();const e=this.m_hashFunction.calculateHashFromVertex(t);this.m_shape.setUserIndex(t,this.m_hashValues,e),this.m_hashTable.addElement(t,e)}}{const e=[],t=this.m_shape.queryVertexIteratorOnSelection(this.m_geometry);for(let s=t.next();s!==n.nullHandle;s=t.next()){if(this.m_shape.getUserIndex(s,this.m_newClusters)===i.StridedIndexTypeCollection.impossibleIndex2())continue;let t=this.m_shape.getUserIndex(s,this.m_hashValues);this.m_hashTable.deleteElement(s,t);let n=!1;for(;this.collectClusterCandidates(s,e),0!==e.length;){let t=0;for(let n=0,i=e.length;n<i;n++){this.progress_();const r=e[n],o=this.m_hashTable.getElement(r);this.m_hashTable.deleteNode(r);const a=n+1===i;t|=this.mergeClusters(s,o,a)?1:0}if(n||=0!==t,o||=0!==t,e.length=0,!t)break}n&&(t=this.m_shape.getUserIndex(s,this.m_hashValues)),this.m_hashTable.addElement(s,t)}e.length=0}return o&&this.applyClusterPositions_(),this.m_hashTable=null,this.m_hashFunction=null,this.m_shape.removeUserIndex(this.m_hashValues),this.m_shape.removeUserIndex(this.m_newClusters),o}applyClusterPositions_(){const e=r.Point2D.getNAN();for(let t=this.m_clusters.getFirstList();t!==j.st_nullNode();t=this.m_clusters.getNextList(t)){let s=this.m_clusters.getFirst(t);const n=this.m_clusters.getElement(s);this.m_shape.queryXY(n,e);const i=this.m_shape.getRank(n),r=this.m_shape.getWeight(n);for(s=this.m_clusters.getNext(s);s!==j.st_nullNode();s=this.m_clusters.getNext(s)){const t=this.m_clusters.getElement(s);if(this.m_bTrackChanges?this.m_shape.isEqualXYPoint2D(t,e)||(this.m_shape.setXYMonotonicPoint2D(t,e),this.m_shape.setGeometryModifiedWithVertex(t,!0)):this.m_shape.setXYMonotonicPoint2D(t,e),this.m_bHasSegmentParentage){const e=this.m_shape.getSegmentParentageBreakVertex(n)||this.m_shape.getSegmentParentageBreakVertex(t);this.m_shape.setSegmentParentageBreakVertex(n,e),this.m_shape.setSegmentParentageBreakVertex(t,e)}this.m_shape.setWeight(t,r),this.m_shape.setRank(t,i)}}}}class ie{constructor(){this.m_inputParts=[],this.m_resultParts1=[],this.m_resultParts2=[],this.m_resultSegments=[],this.m_freeSegments=[],this.m_inputSegments=[],this.m_param1=[],this.m_param2=[],this.m_tolerance=0,this.m_toleranceZ=0,this.m_point=new i.Point,this.m_pointWeight=1,this.m_maxDensifyLimit=0,this.m_pointRank=0,this.m_changed1=!1,this.m_changed2=!1,this.m_adaptiveDensify=!1}clear(){this.freeAllResultSegments(),this.m_inputSegments.length=0,this.m_inputParts.length=0,this.m_resultParts1.length=0,this.m_resultParts2.length=0,this.m_param1.length=0,this.m_param2.length=0,this.m_adaptiveDensify=!1,this.m_changed1=!1,this.m_changed2=!1}newIntersectionPart_(e,t,s,n,i,r,o,a,m,h){return function(e,t,s,n,i,r,o,a,m,h){return{segmentIndex:e,weightStart:t,rankStart:s,weightEnd:n,rankEnd:i,weightInterior:r,rankInterior:o,segmentParentage:h,u:re(a,m)}}(e,t,s,n,i,r,o,a,m,h)}pushSegment(e,t,s,n,i,r,o,a,m,h){return this.m_inputParts.push(this.newIntersectionPart_(this.m_inputSegments.length,t,s,n,i,r,o,a,m,h)),this.m_inputSegments.push(e),this.m_inputParts.length-1}getResultSegmentCount(e){return this.m_adaptiveDensify?0===e?this.m_param1.length-1:this.m_param2.length-1:0===e?this.m_resultParts1.length:this.m_resultParts2.length}getResultPart_(e,t){return 0===e?this.m_resultParts1[t]:this.m_resultParts2[t]}getResultSegment(e,t){return this.m_resultSegments[this.getResultPart_(e,t).segmentIndex].get()}getSegmentChanged(e){return 0===e?this.m_changed1:this.m_changed2}getResultSegmentStartPointWeight(e,t){return this.getResultPart_(e,t).weightStart}getResultSegmentStartPointRank(e,t){return this.getResultPart_(e,t).rankStart}getResultSegmentSegmentParentage(e,t){return this.getResultPart_(e,t).segmentParentage}getResultSegmentStartPointIsBreak(e,t){return this.getResultPart_(e,t).u.bBreakStart}getResultSegmentEndPointWeight(e,t){return this.getResultPart_(e,t).weightEnd}getResultSegmentEndPointRank(e,t){return this.getResultPart_(e,t).rankEnd}getResultSegmentEndPointIsBreak(e,t){return this.getResultPart_(e,t).u.bBreakEnd}getResultSegmentInteriorRank(e,t){return this.getResultPart_(e,t).rankInterior}getResultSegmentInteriorWeight(e,t){return this.getResultPart_(e,t).weightInterior}getResultPoint(){return this.m_point}getResultPointWeight(){return this.m_pointWeight}getResultPointRank(){return this.m_pointRank}getResultPointChanged(){return this.m_changed2}intersectLines(e,t){2!==this.m_inputSegments.length&&s.throwInternalErrorException(""),this.m_changed1=!1,this.m_changed2=!1,this.m_tolerance=e;const i=r.sqr(e*ie.c_smallToleranceFactor);let o=!1;const a=this.m_inputParts[0],m=this.m_inputParts[1],h=this.m_inputSegments[a.segmentIndex],l=this.m_inputSegments[m.segmentIndex];if(t||5&n.isIntersecting(!0,h,l,e,!0)){const t=n.intersect(!0,h,l,null,this.m_param1,this.m_param2,e);0===t&&s.throwInternalErrorException("");const u=new Array(t);for(let e=0;e<t;++e)u[e]=r.Point2D.getNAN();const c=new Float64Array(t),g=new Int32Array(t),d=new Array(t),p=new Array(t);for(let e=0;e<t;++e)d[e]=oe(),p[e]=oe();for(let e=0;e<t;e++){const t=this.m_param1[e],s=this.m_param2[e];let n,_=a.rankInterior,f=a.weightInterior;0===t?(_=a.rankStart,f=a.weightStart,n=a.u.bBreakStart):1===t?(_=a.rankEnd,f=a.weightEnd,n=a.u.bBreakEnd):(this.m_changed1=!0,n=!1);let y,x=m.rankInterior,P=m.weightInterior;0===s?(x=m.rankStart,P=m.weightStart,y=m.u.bBreakStart):1===s?(x=m.rankEnd,P=m.weightEnd,y=m.u.bBreakEnd):(this.m_changed2=!0,y=!1);const E=_,v=x;let C=1,D=0,b=r.Point2D.getNAN();if(E===v){const n=h.getCoord2D(t),o=l.getCoord2D(s);C=f+P;const a=P/C;D=_,r.lerpPoint2D(n,o,a,b);const m=r.Point2D.sqrDistance(b,n),u=r.Point2D.sqrDistance(b,o);d[e].bBigMove=m>i,p[e].bBigMove=u>i,this.m_changed1||n.equals(b)||(this.m_changed1=!0),this.m_changed2||o.equals(b)||(this.m_changed2=!0)}else if(E>v){b=h.getCoord2D(t);const n=l.getCoord2D(s);C=f,D=_;const o=r.Point2D.sqrDistance(b,n);d[e].bBigMove=!1,p[e].bBigMove=o>i,this.m_changed2||n.equals(b)||(this.m_changed2=!0)}else{b=l.getCoord2D(s),C=P,D=x;const n=h.getCoord2D(t),o=r.Point2D.sqrDistance(b,n);d[e].bBigMove=o>i,p[e].bBigMove=!1,this.m_changed1||n.equals(b)||(this.m_changed1=!0)}u[e].assign(b),c[e]=C,g[e]=D,d[e].bIsBreak=n||y,p[e].bIsBreak=n||y,o||=d[e].bBigMove||p[e].bBigMove}const _=a.rankInterior,f=a.weightInterior;let y=0,x=-1;for(let s=0;s<=t;s++){const n=s<t?this.m_param1[s]:1;if(n!==y){const i=this.allocResultSegment(),o=this.m_resultSegments[i];let m,l,p,P;h.queryCut(y,n,o,!1),o.get().snapControlPoints(e*e);let E=!1,v=!1,C=!1,D=!1,b=!1,S=r.Point2D.getNAN(),I=r.Point2D.getNAN();-1!==x?(l=g[x],m=c[x],E=d[x].bBigMove,S.assign(u[x]),C=d[x].bIsBreak,b=!0):(m=a.weightStart,l=a.rankStart,S=o.get().getStartXY(),C=a.u.bBreakStart),s<t?(P=g[s],p=c[s],v=d[s].bBigMove,I.assign(u[s]),D=d[s].bIsBreak,b=!0):(p=a.weightEnd,P=a.rankEnd,I=o.get().getEndXY(),D=a.u.bBreakEnd),b&&o.get().setCoordsForIntersector(S,I,!0),this.m_resultParts1.push(this.newIntersectionPart_(i,m,l,p,P,f,_,C,D,a.segmentParentage));const w=this.m_resultParts1.at(-1);w.u.bBigMoveStart=E,w.u.bBigMoveEnd=v,y=n,x=s}else-1===x&&(x=s)}const P=r.makePrimitiveArray(t,0);for(let e=0;e<t;e++)P[e]=e;t>2?(P.sort((e,t)=>this.m_param2[e]<this.m_param2[t]?-1:this.m_param2[e]>this.m_param2[t]?1:0),r.numericSort(this.m_param2)):2===t&&this.m_param2[0]>this.m_param2[1]&&(this.m_param2[1]=r.swap(this.m_param2[0],this.m_param2[0]=this.m_param2[1]),P[1]=r.swap(P[0],P[0]=P[1]));const E=m.rankInterior,v=m.weightInterior;y=0,x=-1;for(let s=0;s<=t;s++){const n=s<t?this.m_param2[s]:1;if(n!==y){const i=this.allocResultSegment(),o=this.m_resultSegments[i];let a,h,d,_;l.queryCut(y,n,o,!1),o.get().snapControlPoints(e*e);let f=r.Point2D.getNAN(),C=r.Point2D.getNAN(),D=!1,b=!1,S=!1,I=!1,w=!1;if(-1!==x){const e=P[x];a=c[e],h=g[e],f.assign(u[e]),S=p[e].bBigMove,D=p[e].bIsBreak,w=!0}else a=m.weightStart,h=m.rankStart,f=o.get().getStartXY(),D=m.u.bBreakStart;if(s!==t){const e=P[s];d=c[e],_=g[e],C.assign(u[e]),I=p[e].bBigMove,b=p[e].bIsBreak,w=!0}else d=m.weightEnd,_=m.rankEnd,C=o.get().getEndXY(),b=m.u.bBreakEnd;w&&o.get().setCoordsForIntersector(f,C,!0),this.m_resultParts2.push(this.newIntersectionPart_(i,a,h,d,_,v,E,D,b,m.segmentParentage));const T=this.m_resultParts2.at(-1);T.u.bBigMoveStart=S,T.u.bBigMoveEnd=I,y=n,x=s}else-1===x&&(x=s)}return o?3:2}return 0}intersectLines3D(e,t,n,i){return s.geometryReleaseAssert(0),1}intersect2D(e,t){const n=this.m_inputParts[0],i=this.m_inputParts[1],r=this.m_inputSegments[n.segmentIndex].getGeometryType(),o=this.m_inputSegments[i.segmentIndex].getGeometryType();return r!==s.GeometryType.enumLine||o!==s.GeometryType.enumLine?new le(this).intersectCurves(e,t):this.intersectLines(e,t)}intersect2DEx(e,t,n,i,o){this.m_point.assignCopy(t),1!==this.m_inputSegments.length&&s.throwInternalErrorException(""),this.m_tolerance=e,this.m_changed1=!1,this.m_changed2=!1;const a=r.sqr(e*ie.c_smallToleranceFactor);let m=!1;const h=this.m_inputParts[0],l=this.m_inputSegments[h.segmentIndex];if(o||l.isIntersectingPoint(t.getXY(),e,!0)){this.m_param1=r.makePrimitiveArray(16,Number.NaN);const s=l.getClosestCoordinate(t.getXY(),!1);this.m_param1[0]=s;let o=h.rankInterior,u=h.weightInterior;0===s?(o=h.rankStart,u=h.weightStart):1===s?(o=h.rankEnd,u=h.weightEnd):this.m_changed1=!0;let c=o;const g=n,d=i;c===g&&l.isCurve()&&(c=g+1);let p=1,_=0;const f=new r.Point2D;if(c===g){const e=l.getCoord2D(s),n=t.getXY();p=u+d,_=o;const i=d/p;r.lerpPoint2D(e,n,i,f),this.m_changed1||e.equals(f)||(this.m_changed1=!0),this.m_changed2||n.equals(f)||(this.m_changed2=!0),m=r.Point2D.sqrDistance(f,e)>a}else c>g?(f.assign(l.getCoord2D(s)),p=u,_=o,this.m_changed2||f.equals(t.getXY())||(this.m_changed2=!0)):(f.assign(l.getCoord2D(s)),p=d,_=g,this.m_changed1||f.equals(t.getXY())||(this.m_changed1=!0),m=r.Point2D.sqrDistance(f,t.getXY())>a);let y=0,x=-1;const P=1;for(let t=0;t<=P;t++){const s=t<P?this.m_param1[0]:1;if(s!==y){const n=this.allocResultSegment(),i=this.m_resultSegments[n];l.queryCut(y,s,i),i.get().snapControlPoints(e*e);let r=h.weightStart,o=h.weightEnd,a=h.rankStart,m=h.rankEnd;const u=h.rankInterior,c=h.weightInterior;let g=h.u.bBreakStart,d=h.u.bBreakEnd;-1!==x&&(r=p,a=_,g=!0,i.get().setCoordsForIntersector(f,i.get().getEndXY(),!0)),t!==P&&(o=p,m=_,d=!0,i.get().setCoordsForIntersector(i.get().getStartXY(),f,!0)),y=s,this.m_resultParts1.push(this.newIntersectionPart_(n,r,a,o,m,c,u,g,d,h.segmentParentage))}x=t}return this.m_point.setXY(f),this.m_pointWeight=p,this.m_pointRank=_,m?3:2}return 0}intersect3D(e,t,n,i){return s.geometryReleaseAssert(0),1}intersect3DEx(e,t,n,i,r,o,a){return s.geometryReleaseAssert(0),1}getTolerance(){return this.m_tolerance}freeAllResultSegments(){this.m_resultSegments.length=0,this.m_freeSegments.length=0}freeResultSegment(e){this.m_freeSegments.push(e)}allocResultSegment(){if(this.m_freeSegments.length)return this.m_freeSegments.pop();const e=new n.SegmentBuffer,t=this.m_resultSegments.length;return this.m_resultSegments.push(e),t}allocResultSegmentFromBuffer(e){if(this.m_freeSegments.length)return this.m_freeSegments.pop();const t=new n.SegmentBuffer({copy:e}),s=this.m_resultSegments.length;return this.m_resultSegments.push(t),s}allocResultSegmentFromSegment(e){if(this.m_freeSegments.length)return this.m_freeSegments.pop();const t=new n.SegmentBuffer({segment:e}),s=this.m_resultSegments.length;return this.m_resultSegments.push(t),s}}function re(e,t){return{bBigMoveStart:!1,bBigMoveEnd:!1,bBreakStart:e,bBreakEnd:t}}function oe(){return{bBigMove:!1,bIsBreak:!1}}ie.maxWeight=.1*Number.MAX_VALUE,ie.c_smallToleranceFactor=.01,ie.c_maxGeometryTypeToRankDelta=8;let ae=class{constructor(){this.start=null,this.end=null,this.equalEdge=null,this.segmentIndex=-1,this.segmentParentage=-1,this.weight=0,this.rank=0}hasSegment(){return this.segmentIndex>=0}transferAttributes(e,t,s){if(1===t.getDescription().getAttributeCount())return;const n=e.parent.m_resultSegments[this.segmentIndex].get().getStartXY(),r=e.parent.m_resultSegments[this.segmentIndex].get().getEndXY(),o=new i.Point;t.queryStart(o),s?(o.setXY(n),e.parent.m_resultSegments[this.segmentIndex].get().setStart(o)):(o.setXY(r),e.parent.m_resultSegments[this.segmentIndex].get().setEnd(o)),t.queryEnd(o),s?(o.setXY(r),e.parent.m_resultSegments[this.segmentIndex].get().setEnd(o)):(o.setXY(n),e.parent.m_resultSegments[this.segmentIndex].get().setStart(o))}copyFromWhenOverlap(e,t,s){this.equalEdge=t,t.equalEdge=this,this.segmentIndex=e.parent.allocResultSegmentFromBuffer(e.parent.m_resultSegments[t.segmentIndex]),this.segmentParentage=t.segmentParentage,this.weight=t.weight,this.rank=t.rank,s?(this.start.copyFrom(t.start),this.end.copyFrom(t.end)):(this.start.copyFrom(t.end),this.end.copyFrom(t.start),e.parent.m_resultSegments[this.segmentIndex].get().reverse())}getEnd(){return this.end}getNextInChain(){return this.end.nextInChain}getPrevInChain(){return this.start.prevInChain}};class me{constructor(){this.hash=0,this.pt=new r.Point2D,this.prevInChain=null,this.nextInChain=null,this.prevInHash=null,this.nextInHash=null,this.prevEqual=null,this.nextEqual=null,this.weight=0,this.rank=0,this.bBigMove=!1,this.bIsBreak=!1}copyFrom(e){this.pt.assign(e.pt),this.weight=e.weight,this.rank=e.rank,this.bBigMove=e.bBigMove,this.bIsBreak=e.bIsBreak}nextNode(){return this.nextInChain?this.nextInChain.end:null}prevNode(){return this.prevInChain?this.prevInChain.start:null}equalListHead(){let e=this;for(;null!==e.prevEqual;e=e.prevEqual);return e}}function he(e,t,s,n){return{edge1:e,edge2:t,recursion:s,bIsIntersecting:n}}class le{constructor(e){this.m_pairs=[],this.m_chainOrigin1=null,this.m_chainOrigin2=null,this.m_newNodes=[],this.m_hashTableOfEquals=[],this.m_hashTableOfEqualsSize=0,this.m_origin=new r.Point2D,this.m_cell=new r.Point2D,this.parent=e}addSegment(e,t,n,i,r,o,a,m,h,l,u){const c=this.newNode(this.parent.m_resultSegments[e].get().getStartXY(),n,i,h),g=this.newNode(this.parent.m_resultSegments[e].get().getEndXY(),r,o,l);this.newEdge(c,g,e,a,m,u),null===this.m_chainOrigin1?this.m_chainOrigin1=c:null===this.m_chainOrigin2?this.m_chainOrigin2=c:s.geometryReleaseAssert(0)}intersectCurvesHelper(e,t,i,o,a){const m=this.getSegment(e).get(),h=this.getSegment(t).get();if(m.isDegenerate(0)||h.isDegenerate(0))return 0;const l=this.tryOverlapIntersectCurves(e,t,i,o);if(0!==l)return l;const u=r.sqr(.01*i);let c=!1,g=this.processSharpCorners(m,h,i,a>4);const d=g>0;if(!d){const e=!0;if(!(o||5&n.isIntersectingEx(!0,!1,m,h,i,e)))return 0;g=n.intersect(!0,m,h,null,this.parent.m_param1,this.parent.m_param2,i)}0===g&&s.throwInternalErrorException("");const p=m.getGeometryType(),_=h.getGeometryType(),f=r.makeObjectArray(r.Point2D,g),y=r.makeObjectArray(r.Point2D,g),x=r.makePrimitiveArray(g,Number.NaN),P=r.makePrimitiveArray(g,Number.NaN),E=r.makePrimitiveArray(g,Number.NaN),v=r.makePrimitiveArray(g,Number.NaN),C=r.makeStructArray(oe,g),D=r.makeStructArray(oe,g);let b=!1,S=!1;for(let s=0;s<g;s++){const n=this.parent.m_param1[s],o=this.parent.m_param2[s];let a=e.rank,l=e.weight,g=!0,I=!1;0===n?(a=e.start.rank,l=e.start.weight,I=e.start.bIsBreak):1===n?(a=e.end.rank,l=e.end.weight,I=e.end.bIsBreak):(b=!0,g=!1);let w=t.rank,T=t.weight,A=!1,N=!0;0===o?(w=t.start.rank,T=t.start.weight,A=t.start.bIsBreak):1===o?(w=t.end.rank,T=t.end.weight,A=t.end.bIsBreak):(S=!0,N=!1);let G=a,M=w;if(G===M&&(G*=ie.c_maxGeometryTypeToRankDelta,M*=ie.c_maxGeometryTypeToRankDelta,G+=ue(p,m,!1),M+=ue(_,h,!1)),g&&N&&M===G){const e=m.getCoord2D(n),t=h.getCoord2D(o);e.equals(t)&&(M=G-1)}let R=1,k=0,F=1,q=0;const V=new r.Point2D,H=new r.Point2D,O=m.getCoord2D(n),Y=h.getCoord2D(o);if(d&&r.Point2D.distance(O,Y)>i)V.setCoordsPoint2D(O),H.setCoordsPoint2D(Y),R=l,F=T,k=a,q=w,C[s].bBigMove=!1,D[s].bBigMove=!1,I=!0,A=!0;else if(G===M){F=R=l+T,q=k=a;const e=T/R;r.lerpPoint2D(O,Y,e,V),H.setCoordsPoint2D(V);const t=r.Point2D.sqrDistance(V,O),n=r.Point2D.sqrDistance(V,Y);C[s].bBigMove=t>u,D[s].bBigMove=n>u,b||O.equals(V)||(b=!0),S||Y.equals(H)||(S=!0)}else if(G>M){V.setCoordsPoint2D(O),H.setCoordsPoint2D(V),F=R=l,q=k=a;const e=r.Point2D.sqrDistance(V,Y);C[s].bBigMove=!1,D[s].bBigMove=e>u,S||Y.equals(H)||(S=!0)}else{H.setCoordsPoint2D(Y),V.setCoordsPoint2D(H),F=R=T,q=k=w;const e=r.Point2D.sqrDistance(V,O);C[s].bBigMove=e>u,D[s].bBigMove=!1,b||O.equals(V)||(b=!0)}f[s].assign(V),y[s].assign(H),x[s]=R,P[s]=F,E[s]=k,v[s]=q,C[s].bIsBreak=I||A,D[s].bIsBreak=I||A,c||=C[s].bBigMove||D[s].bBigMove,s>0&&(n!==this.parent.m_param1[s-1]&&o!==this.parent.m_param2[s-1]||(E[s]<=E[s-1]?(f[s].assign(y[s-1]),x[s]=P[s-1],E[s]=v[s-1],y[s].assign(y[s-1]),P[s]=P[s-1],v[s]=v[s-1],C[s].bBigMove||=C[s-1].bBigMove,D[s].bBigMove||=D[s-1].bBigMove,C[s].bIsBreak||=C[s-1].bIsBreak,D[s].bIsBreak||=D[s-1].bIsBreak):(f[s-1].assign(f[s]),x[s-1]=x[s],E[s-1]=E[s],y[s-1].assign(y[s]),P[s-1]=P[s],v[s-1]=v[s],C[s-1].bBigMove||=C[s].bBigMove,D[s-1].bBigMove||=D[s].bBigMove,C[s-1].bIsBreak||=C[s].bIsBreak,D[s-1].bIsBreak||=D[s].bIsBreak)))}if(!(b||S||2!==g||p===s.GeometryType.enumLine&&_===s.GeometryType.enumLine)){if(this.processDoublyConnectedEdges(e,t,a+1,i))return this.parent.m_changed1=!0,this.parent.m_changed2=!0,2;s.geometryReleaseAssert(0)}this.parent.m_changed1||=b,this.parent.m_changed2||=S;let I=e,w=e.end.weight,T=e.end.rank,A=e.end.bBigMove,N=e.end.bIsBreak,G=0,M=-1;for(let t=0;t<=g;t++){const s=t<g?this.parent.m_param1[t]:1;if(s!==G){const n=this.parent.allocResultSegment(),o=this.parent.m_resultSegments[n];let a,h,l,u;m.queryCut(G,s,o,!1),o.get().snapControlPoints(i*i);let c=!1,d=!1,p=!1,_=!1;const y=new r.Point2D,P=new r.Point2D;-1!==M?(h=E[M],a=x[M],p=C[M].bBigMove,c=C[M].bIsBreak,y.assign(f[M])):(a=e.start.weight,h=e.start.rank,p=e.start.bBigMove,c=e.start.bIsBreak,y.assign(o.get().getStartXY())),t<g?(u=E[t],l=x[t],_=C[t].bBigMove,d=C[t].bIsBreak,P.assign(f[t])):(l=w,u=T,_=A,d=N,P.assign(o.get().getEndXY()));let v=I;s<1&&(this.splitEdgeInPlace(I),v=I.getNextInChain()),this.updateSegmentOnly(I,n),0===I.start.hash||I.start.pt.equals(y)||(this.m_newNodes.push(I.start),this.removeNodeFromHash(I.start),I.start.hash=0),0===I.end.hash||I.end.pt.equals(P)||(this.m_newNodes.push(I.end),this.removeNodeFromHash(I.end),I.end.hash=0),I.start.pt.assign(y),I.end.pt.assign(P),I.start.bBigMove||=p,I.end.bBigMove||=_,I.start.bIsBreak||=c,I.end.bIsBreak||=d,I.start.weight=a,I.start.rank=h,I.end.weight=l,I.end.rank=u,I=v,G=s,M=t}else-1===M&&(M=t)}const R=I.getNextInChain(),k=[];k.length=g;for(let e=0;e<g;e++)k[e]=e;g>2?(k.sort((e,t)=>r.standardNumericCompare(this.parent.m_param2[e],this.parent.m_param2[t])),this.parent.m_param2.sort(r.standardNumericCompare)):2===g&&this.parent.m_param2[0]>this.parent.m_param2[1]&&(this.parent.m_param2[1]=r.swap(this.parent.m_param2[0],this.parent.m_param2[0]=this.parent.m_param2[1]),k[1]=r.swap(k[0],k[0]=k[1])),I=t,w=t.end.weight,T=t.end.rank,A=t.end.bBigMove,N=t.end.bIsBreak,G=0,M=-1;for(let e=0;e<=g;e++){const s=e<g?this.parent.m_param2[e]:1;if(s!==G){const n=this.parent.allocResultSegment(),o=this.parent.m_resultSegments[n];let a,m,l,u;h.queryCut(G,s,o,!1),o.get().snapControlPoints(i*i);const c=new r.Point2D,d=new r.Point2D;let p=!1,_=!1,f=!1,x=!1;if(-1!==M){const e=k[M];a=P[e],m=v[e],c.assign(y[e]),f=D[e].bBigMove,p=D[e].bIsBreak}else a=t.start.weight,m=t.start.rank,f=t.start.bBigMove,p=t.start.bIsBreak,c.assign(o.get().getStartXY());if(e!==g){const t=k[e];l=P[t],u=v[t],d.assign(y[t]),x=D[t].bBigMove,_=D[t].bIsBreak}else l=w,u=T,x=A,_=N,d.assign(o.get().getEndXY());let E=I;s<1&&(this.splitEdgeInPlace(I),E=I.getNextInChain()),this.updateSegmentOnly(I,n),0===I.start.hash||I.start.pt.equals(c)||(this.m_newNodes.push(I.start),this.removeNodeFromHash(I.start),I.start.hash=0),0===I.end.hash||I.end.pt.equals(d)||(this.m_newNodes.push(I.end),this.removeNodeFromHash(I.end),I.end.hash=0),I.start.pt.assign(c),I.end.pt.assign(d),I.start.bBigMove||=f,I.end.bBigMove||=x,I.start.bIsBreak||=p,I.end.bIsBreak||=_,I.start.weight=a,I.start.rank=m,I.end.weight=l,I.end.rank=u,I=E,G=s,M=e}else-1===M&&(M=e)}const F=I.getNextInChain();return this.postProcessResultPartsForCurves(e,R,t,F,a+1),c?3:2}intersectCurves(e,n){2!==this.parent.m_inputSegments.length&&s.throwInternalErrorException(""),this.parent.m_changed1=!1,this.parent.m_changed2=!1,this.parent.m_tolerance=e,this.m_hashTableOfEqualsSize=0,this.m_hashTableOfEquals=r.makeNullArray(16);const i=t.Envelope2D.constructEmpty();for(let e=0;e<2;e++){const s=this.parent.allocResultSegmentFromSegment(this.parent.m_inputSegments[this.parent.m_inputParts[e].segmentIndex]),n=t.Envelope2D.constructEmpty();this.parent.m_inputSegments[this.parent.m_inputParts[e].segmentIndex].queryLooseEnvelope(n),i.mergeEnvelope2D(n);const r=this.parent.m_inputParts[e];this.addSegment(s,0,r.weightStart,r.rankStart,r.weightEnd,r.rankEnd,r.weightInterior,r.rankInterior,r.u.bBreakStart,r.u.bBreakEnd,r.segmentParentage)}i.inflateCoords(100*e,100*e),this.m_origin.assign(i.getLowerLeft()),this.m_cell.setCoords(2*e,2*e),this.m_pairs.push(he(this.m_chainOrigin1.nextInChain,this.m_chainOrigin2.nextInChain,0,n));let o=0,a=!0;for(;this.m_pairs.length;){const t=this.m_pairs.at(-1);this.m_pairs.pop(),s.geometryReleaseAssert(t.recursion>=0),s.geometryReleaseAssert(t.recursion<=256),this.clusterNodes(e);const n=this.intersectCurvesHelper(t.edge1,t.edge2,e,t.bIsIntersecting,t.recursion);a&&(a=!1,o=n)}for(let e=0;e<2;e++){const t=0===e?this.parent.m_resultParts1:this.parent.m_resultParts2;for(let s=(0===e?this.m_chainOrigin1:this.m_chainOrigin2).nextInChain;null!=s;s=s.getNextInChain())t.push(this.parent.newIntersectionPart_(s.segmentIndex,s.start.weight,s.start.rank,s.end.weight,s.end.rank,s.weight,s.rank,s.start.bIsBreak,s.end.bIsBreak,s.segmentParentage)),t.at(-1).u.bBigMoveStart=s.start.bBigMove,t.at(-1).u.bBigMoveEnd=s.end.bBigMove}return o}tryOverlapIntersectCurves(e,t,i,o){const a=this.parent.m_resultSegments[e.segmentIndex].get(),m=this.parent.m_resultSegments[t.segmentIndex].get(),h=a.getStartXY().equals(m.getStartXY())&&a.getEndXY().equals(m.getEndXY()),l=a.getStartXY().equals(m.getEndXY())&&a.getEndXY().equals(m.getStartXY());if(!h&&!l)return 0;const u=n.isExactOverlap2d(a,m,!0);if(0!==u&&n.isIdenticalType(a,m)&&e.segmentParentage===t.segmentParentage){let e=!1;if(u>0)e=a.equals(m);else{s.geometryReleaseAssert(-1===u);const t=new n.SegmentBuffer({segment:m});t.get().reverse(),e=a.equals(t.get())}if(e)return 1}const c=i*ie.c_smallToleranceFactor;let g=!1;if(0===u){const e=[.5,.25,.75,.125,.375,.625,.875,.5625,.3125];for(let t=0,s=e.length;t<s;++t){const s=e[t],n=new r.Point2D;a.queryCoord2D(s,n);const o=m.getClosestCoordinate(n,!1),h=new r.Point2D;m.queryCoord2D(o,h);const l=r.Point2D.distance(n,h);if(l>i)return 0;g||=l>c}for(let t=0,s=e.length;t<s;++t){const s=e[t],n=new r.Point2D;m.queryCoord2D(s,n);const o=a.getClosestCoordinate(n,!1),h=new r.Point2D;a.queryCoord2D(o,h);const l=r.Point2D.distance(n,h);if(l>i)return 0;g||=l>c}}let d=e.rank,p=t.rank;return d===p&&(d*=ie.c_maxGeometryTypeToRankDelta,p*=ie.c_maxGeometryTypeToRankDelta,d+=ue(a.getGeometryType(),a,!0),p+=ue(m.getGeometryType(),m,!0)),d>p?(t.copyFromWhenOverlap(this,e,h),t.transferAttributes(this,a,h)):p>d?(e.copyFromWhenOverlap(this,t,h),e.transferAttributes(this,m,h)):e.segmentParentage<=t.segmentParentage?(e.weight=e.weight+t.weight,t.copyFromWhenOverlap(this,e,h),t.transferAttributes(this,a,h)):(t.weight=e.weight+t.weight,e.copyFromWhenOverlap(this,t,h),e.transferAttributes(this,m,h)),g?3:2}postProcessResultPartsForCurves(e,t,n,i,o){o===r.shortMax()&&s.throwInternalErrorException("curve_helper");for(let s=e;s!==t;s=s.getNextInChain())this.updateSegmentToNodes(s);for(let e=n;e!==i;e=e.getNextInChain())this.updateSegmentToNodes(e);for(let a=e;a!==t;a=a.getNextInChain()){const e=a.end.pt.sub(a.start.pt);for(let t=n;t!==i;t=t.getNextInChain()){let n=0;if(a.start.pt.equals(t.start.pt)&&a.end.pt.equals(t.end.pt)?n=1:a.start.pt.equals(t.end.pt)&&a.end.pt.equals(t.start.pt)&&(n=-1),!n){let n=a.start.pt.equals(t.start.pt)?1:0;if(n||(n=a.end.pt.equals(t.end.pt)?2:0,n||(n=a.end.pt.equals(t.start.pt)?3:0,n||(n=a.start.pt.equals(t.end.pt)?4:0))),n){const i=t.end.pt.sub(t.start.pt),r=e.dotProduct(i);let m;switch(n){case 1:case 2:m=r>0;break;case 3:case 4:m=r<0;break;default:s.throwInternalErrorException("post_process_result_parts_for_curves_")}m&&this.m_pairs.push(he(a,t,o,!1))}continue}const i=this.parent.m_resultSegments[a.segmentIndex],m=this.parent.m_resultSegments[t.segmentIndex],h=[.5,.25,.75];for(let e=0,t=h.length;e<t;++e){const t=h[e],s=new r.Point2D;i.get().queryCoord2D(t,s);const o=m.get().getClosestCoordinate(s,!1),a=new r.Point2D;if(m.get().queryCoord2D(o,a),r.Point2D.distance(s,a)>this.parent.m_tolerance){n=0;break}}if(!n){this.m_pairs.push(he(a,t,o,!1));continue}for(let e=0,t=h.length;e<t;++e){const t=h[e],s=new r.Point2D;m.get().queryCoord2D(t,s);const o=i.get().getClosestCoordinate(s,!1),a=new r.Point2D;if(i.get().queryCoord2D(o,a),r.Point2D.distance(s,a)>this.parent.m_tolerance){n=0;break}}if(!n){this.m_pairs.push(he(a,t,o,!1));continue}a.equalEdge=t,t.equalEdge=a;let l=a.rank,u=t.rank;l===u&&(l*=ie.c_maxGeometryTypeToRankDelta,u*=ie.c_maxGeometryTypeToRankDelta,l+=ue(i.get().getGeometryType(),i.get(),!0),u+=ue(m.get().getGeometryType(),m.get(),!0)),l>u||l===u&&a.segmentParentage<=t.segmentParentage?(i.copyTo(m,!1),t.segmentParentage=a.segmentParentage,-1===n&&m.get().reverse()):(m.copyTo(i,!1),a.segmentParentage=t.segmentParentage,-1===n&&i.get().reverse());break}}this.updateAttachedEdgesAfterNodeChange(e.start),t&&this.updateAttachedEdgesAfterNodeChange(t.start),this.updateAttachedEdgesAfterNodeChange(n.start),i&&this.updateAttachedEdgesAfterNodeChange(i.start)}processDoublyConnectedEdges(e,t,i,o){i===r.shortMax()&&s.throwInternalErrorException("curve_helper");const a=this.getSegment(e).get(),m=this.getSegment(t).get(),h=a.getStartXY().equals(m.getStartXY())&&a.getEndXY().equals(m.getEndXY())?1:a.getEndXY().equals(m.getStartXY())&&a.getStartXY().equals(m.getEndXY())?-1:0;if(0!==h){const s=new n.SegmentBuffer;a.queryCut(0,.5,s),s.get().snapControlPoints(o*o);const r=new n.SegmentBuffer;a.queryCut(.5,1,r),r.get().snapControlPoints(o*o),this.splitEdgeInPlace(e),e.end.pt=s.get().getEndXY(),e.segmentIndex=this.parent.allocResultSegmentFromBuffer(s),e.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(r);let l=m.getClosestCoordinate(e.end.pt,!1);return Math.abs(l-.5)>.2&&(l=.5),m.queryCut(0,l,s),s.get().snapControlPoints(o*o),m.queryCut(l,1,r),r.get().snapControlPoints(o*o),this.splitEdgeInPlace(t),t.end.pt=s.get().getEndXY(),t.segmentIndex=this.parent.allocResultSegmentFromBuffer(s),t.getNextInChain().segmentIndex=this.parent.allocResultSegmentFromBuffer(r),h>0?(this.m_pairs.push(he(e,t,i,!1)),this.m_pairs.push(he(e.getNextInChain(),t.getNextInChain(),i,!1))):(this.m_pairs.push(he(e,t.getNextInChain(),i,!1)),this.m_pairs.push(he(e.getNextInChain(),t,i,!1))),!0}return!1}newNode(e,t,s,n){const i=new me;return this.m_newNodes.push(i),i.pt=e,i.rank=s,i.weight=t,i.bIsBreak=n,i}newEdge(e,t,s,n,i,r){const o=new ae;return o.start=e,o.end=t,e.nextInChain=o,t.prevInChain=o,o.segmentIndex=s,o.segmentParentage=r,o.rank=i,o.weight=n,o}splitEdgeInPlace(e){e.segmentIndex=-1;const t=new ae,s=new me;this.m_newNodes.push(s),s.pt.setNAN(),s.nextInChain=t,s.prevInChain=e,s.prevInHash=null,s.nextInHash=null,s.prevEqual=null,s.nextEqual=null,s.weight=e.weight,s.rank=e.rank,s.bIsBreak=!1,s.bBigMove=!1,t.start=s,t.segmentIndex=-1,t.end=e.end,t.end.prevInChain=t,t.rank=e.rank,t.weight=e.weight,t.segmentParentage=e.segmentParentage,e.end=s,e.equalEdge&&(e.equalEdge.equalEdge=null),e.equalEdge=null}updateSegmentOnly(e,t){e.segmentIndex=t}updateAttachedEdgesAfterNodeChange(e){for(let t=e.equalListHead();null!==t;t=t.nextEqual)this.updateAttachedEdgesAfterNodeChangeImpl(t)}updateAttachedEdgesAfterNodeChangeImpl(e){const t=e.prevInChain;if(t&&t.hasSegment()){const s=this.getSegment(t).get();e.pt.equals(s.getEndXY())||(s.setCoordsForIntersector(t.start.pt,t.end.pt,!1),s.ensureXYMonotone())}const s=e.nextInChain;if(s&&s.hasSegment()){const t=this.getSegment(s).get();e.pt.equals(t.getStartXY())||(t.setCoordsForIntersector(s.start.pt,s.end.pt,!1),t.ensureXYMonotone())}}updateSegmentToNodes(e){const t=this.getSegment(e).get();e.start.pt.equals(t.getStartXY())&&e.end.pt.equals(t.getEndXY())||(t.setCoordsForIntersector(e.start.pt,e.end.pt,!1),t.ensureXYMonotone()),this.updateAttachedEdgesAfterNodeChange(e.start),this.updateAttachedEdgesAfterNodeChange(e.end)}getSegment(e){return this.parent.m_resultSegments[e.segmentIndex]}clusterNodes(e){let t=!1;const s=[],n=[],i=[];for(let e=0,t=this.m_newNodes.length;e<t;e++){const s=this.m_newNodes[e];if(null===s)continue;let n=s;for(let i=e+1;i<t;i++){const e=this.m_newNodes[i];null!==e&&s.pt.equals(e.pt)&&(n.nextInHash=e,e.prevInHash=n,n=e,this.m_newNodes[i]=null)}}for(let o=0,a=this.m_newNodes.length;o<a;o++){const a=this.m_newNodes[o];if(null==a)continue;for(a.hash=this.calculateHash(a.pt);;){const o=r.makeNullArray(4),m=this.hashTableBinsToCheck(a,o);for(let t=0;t<m;t++)if(null!==o[t])for(let m=o[t];null!==m;){const t=m.nextInHash;r.Point2D.distance(a.pt,m.pt)<=e&&(s.push(m),this.removeNodeFromHash(m),m.hash=0,i.push(m),n.push(m)),m=t}let h=!1;for(const e of s)if(!a.pt.equals(e.pt)){const s=ee(a.pt,e.pt,a.weight,a.rank,e.weight,e.rank);a.pt.assign(s.pt),a.weight=s.weight,a.rank=s.rank,h=!0,t=!0}if(s.length=0,!h)break;a.hash=this.calculateHash(a.pt)}i.push(a),n.push(a);for(let e=a.nextInHash;null!==e;){e.prevInHash=null;const t=e.nextInHash;e.nextInHash=null,i.push(e),n.push(e),e=t}const m=a.hash;let h=null,l=null;for(const e of n)a!==e&&(e.hash=m,e.pt.assign(a.pt),e.rank=a.rank,e.weight=a.weight),e.prevInHash=h,h&&(h.nextInHash=e),e.prevEqual=l,e.nextEqual=null,l&&(l.nextEqual=e),l=e,h=e;const u=m%this.m_hashTableOfEquals.length;h.nextInHash=this.m_hashTableOfEquals[u],null!==this.m_hashTableOfEquals[u]&&(this.m_hashTableOfEquals[u].prevInHash=h),this.m_hashTableOfEquals[u]=n[0],this.m_hashTableOfEqualsSize+=n.length,n.length=0,this.rehashIfNeeded()}if(this.m_newNodes.length=0,t)for(const e of i)this.updateAttachedEdgesAfterNodeChange(e)}rehashIfNeeded(){if(2*this.m_hashTableOfEqualsSize>this.m_hashTableOfEquals.length){const e=this.m_hashTableOfEquals;this.m_hashTableOfEquals=r.makeNullArray(2*e.length),this.m_hashTableOfEqualsSize=0;for(const t of e){let e=t;for(;e;){const t=e.nextInHash;e.nextInHash=null,e.prevInHash=null,this.addNodeToHashImpl(e),e=t}}}}addNodeToHashImpl(e){const t=e.hash%this.m_hashTableOfEquals.length,s=this.m_hashTableOfEquals[t];e.nextInHash=s,null!==s&&(s.prevInHash=e),this.m_hashTableOfEquals[t]=e,this.m_hashTableOfEqualsSize++}removeNodeFromHash(e){const t=e.hash%this.m_hashTableOfEquals.length,s=e.prevInHash,n=e.nextInHash;s?s.nextInHash=n:this.m_hashTableOfEquals[t]=n,n&&(n.prevInHash=s),this.m_hashTableOfEqualsSize--,e.prevInHash=null,e.nextInHash=null}hashTableBinsToCheck(e,t){const s=(e.pt.x-this.m_origin.x)/this.m_cell.x,n=(e.pt.y-this.m_origin.y)/this.m_cell.y,i=r.intMax()-1,o=Math.round(r.snap(s,-2147483646,i)),a=Math.round(r.snap(n,-2147483646,i));let m=o|a<<32;m=r.hashInt32(m),t[0]=this.m_hashTableOfEquals[m%this.m_hashTableOfEquals.length];let h=o+1|a<<32;h=r.hashInt32(h);let l=1;t[1]=this.m_hashTableOfEquals[h%this.m_hashTableOfEquals.length],t[1]!==t[0]&&(l=2);let u=o+1|a+1<<32;u=r.hashInt32(u),t[l]=this.m_hashTableOfEquals[u%this.m_hashTableOfEquals.length];for(let e=0;e<l;e++)if(t[l]===t[e]){l--;break}l++;let c=o|a+1<<32;c=r.hashInt32(c),t[l]=this.m_hashTableOfEquals[c%this.m_hashTableOfEquals.length];for(let e=0;e<l;e++)if(t[l]===t[e]){l--;break}return l++,l}calculateHash(e){const t=(e.x-this.m_origin.x)/this.m_cell.x,s=(e.y-this.m_origin.y)/this.m_cell.y,n=r.intMax()-1;let i=Math.round(r.snap(t,-2147483646,n))|Math.round(r.snap(s,-2147483646,n))<<32;return i=r.hashInt32(i),0===i&&(i=1),i}processSharpCorners(e,t,s,i){if(this.parent.m_param1.length=0,this.parent.m_param2.length=0,e.getStartXY().equals(t.getStartXY())){const r=[0,0],o=[0,0],a=n.checkSharpCorner(e,t,0,0,s,2,r,o,i);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(0);for(let e=0;e<a;e++)this.parent.m_param1.push(r[e]),this.parent.m_param2.push(o[e]);return a+1}}if(e.getEndXY().equals(t.getEndXY())){const r=[0,0],o=[0,0],a=n.checkSharpCorner(e,t,1,1,s,2,r,o,i);if(a){for(let e=0;e<a;e++)this.parent.m_param1.push(r[e]),this.parent.m_param2.push(o[e]);return this.parent.m_param1.push(1),this.parent.m_param2.push(1),a+1}}if(e.getStartXY().equals(t.getEndXY())){const r=[0,0],o=[0,0],a=n.checkSharpCorner(e,t,0,1,s,2,r,o,i);if(a){this.parent.m_param1.push(0),this.parent.m_param2.push(1);for(let e=0;e<a;e++)this.parent.m_param1.push(r[e]),this.parent.m_param2.push(o[e]);return a+1}}if(e.getEndXY().equals(t.getStartXY())){const r=[0,0],o=[0,0],a=n.checkSharpCorner(e,t,1,0,s,2,r,o,i);if(a){for(let e=0;e<a;e++)this.parent.m_param1.push(r[e]),this.parent.m_param2.push(o[e]);return this.parent.m_param1.push(1),this.parent.m_param2.push(0),a+1}}return 0}}function ue(e,t,n){let i=0;switch(e){case s.GeometryType.enumLine:i=0;break;case s.GeometryType.enumBezier:i=2;break;case s.GeometryType.enumRationalBezier2:i=3;break;case s.GeometryType.enumBezier2:i=1;break;case s.GeometryType.enumEllipticArc:i=0===t.projectionBehavior()?5:4;break;default:s.throwInternalErrorException("")}return n?5-i:i}class ce extends Z{constructor(e){super(e.m_shape,e.m_tolerance,!1),this.m_parent=e}compare(e,t,s){if(this.m_bIntersectionDetected)return-1;const n=e.getElement(s),i=this.m_parent.getEdgeOriginVertices(t),r=this.m_parent.m_edgeVertices.getFirstElement(i),o=this.m_parent.getEdgeOriginVertices(n),a=this.m_parent.m_edgeVertices.getFirstElement(o);return this.m_currentNode=s,this.compareSegments(t,r,n,a)}}class ge extends Q{constructor(e){super(e.m_shape,e.m_tolerance),this.m_parent=e}compare(e,t){if(this.m_bIntersectionDetected)return-1;const s=e.getElement(t),n=this.m_parent.getEdgeOriginVertices(s),i=this.m_parent.m_edgeVertices.getFirstElement(n);return this.m_currentNode=t,this.compareVertex(e,t,i)}}class de extends i.Comparator{constructor(e){super(),this.pt1=r.Point2D.getNAN(),this.pt2=r.Point2D.getNAN(),this.m_shape=e}compare(e,t,s){this.m_shape.queryXY(t,this.pt1);const n=e.getElement(s);return this.m_shape.queryXY(n,this.pt2),this.pt1.compare(this.pt2)}}class pe{constructor(e){this.m_point=r.Point2D.getNAN(),this.m_pt=r.Point2D.getNAN(),this.m_shape=e}setPoint(e){this.m_point.setCoordsPoint2D(e)}compare(e,t){const s=e.getElement(t);return this.m_shape.queryXY(s,this.m_pt),this.m_point.compare(this.m_pt)}}class _e{constructor(e,t){this.m_shape=null,this.m_progressTracker=null,this.m_edges=new i.StridedIndexTypeCollection(8),this.m_clusters=new i.StridedIndexTypeCollection(5),this.m_clusterVertices=new j(!1),this.m_edgeVertices=new j(!1),this.m_helperPoint=new i.Point,this.m_eventQ=new i.Treap,this.m_sweepStructure=new i.Treap,this.m_bComplications=!1,this.m_sweepComparator=null,this.m_tempEdgeBuffer=[],this.m_modifiedClusters=[],this.m_edgesToInsertInSweepStructure=[],this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1,this.m_progressCounter=0,this.m_segmentIntersector=new ie,this.m_segBuf1=new n.SegmentBuffer,this.m_segBuf2=new n.SegmentBuffer,this.m_sweepPoint=new r.Point2D(0,0),this.m_tolerance=0,this.m_toleranceSqr=0,this.m_sweepPointCluster=-1,this.m_vertexClusterIndex=-1,this.m_bCracked=!1,this.m_bSweepPointClusterWasModified=!1,this.m_progressTracker=e,this.m_bTrackChanges=t}hadComplications(){return this.m_bComplications}sweep(e,t){const s=new a.Transformation2D;s.setSwapCoordinates(),e.applyTransformation(s),this.setEditShape_(e),this.m_bCracked=!1,this.m_tolerance=t,this.m_toleranceSqr=t*t;let n=this.sweepImpl_();return e.applyTransformation(s),n||(this.fillEventQueuePass2(),n=this.sweepImpl_()||n),this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_shape=null,this.m_bCracked}sweepVertical(e,t){this.setEditShape_(e),this.m_bCracked=!1,this.m_tolerance=t,this.m_toleranceSqr=t*t,this.m_bComplications=!1;let s=this.sweepImpl_();if(!this.m_bComplications){const i=e.filterClosePoints(t,!0,!1,this.m_bTrackChanges,n.nullHandle);this.m_bComplications=1===i,s||=1===i}return-1!==this.m_vertexClusterIndex&&(this.m_shape.removeUserIndex(this.m_vertexClusterIndex),this.m_vertexClusterIndex=-1),this.m_shape=null,s}getEdgeCluster(e,t){return this.m_edges.getField(e,0+t)}setEdgeCluster_(e,t,s){this.m_edges.setField(e,0+t,s)}getEdgeOriginVertices(e){return this.m_edges.getField(e,2)}setEdgeOriginVertices_(e,t){this.m_edges.setField(e,2,t)}getNextEdgeEx(e,t){return this.m_edges.getField(e,3+t)}setNextEdgeEx_(e,t,s){this.m_edges.setField(e,3+t,s)}getEdgeSweepNode(e){return this.m_edges.getField(e,7)}setEdgeSweepNode_(e,t){this.m_edges.setField(e,7,t)}getNextEdge(e,t){const s=this.getEdgeEnd(e,t);return this.m_edges.getField(e,3+s)}setNextEdge_(e,t,s){const n=this.getEdgeEnd(e,t);this.m_edges.setField(e,3+n,s)}getPrevEdge(e,t){const s=this.getEdgeEnd(e,t);return this.m_edges.getField(e,5+s)}setPrevEdge_(e,t,s){const n=this.getEdgeEnd(e,t);this.m_edges.setField(e,5+n,s)}getClusterVertices(e){return this.m_clusters.getField(e,0)}setClusterVertices_(e,t){this.m_clusters.setField(e,0,t)}getClusterSweepEdgeList(e){return this.m_clusters.getField(e,2)}setClusterSweepEdgeList_(e,t){this.m_clusters.setField(e,2,t)}getClusterFirstEdge(e){return this.m_clusters.getField(e,1)}setClusterFirstEdge_(e,t){this.m_clusters.setField(e,1,t)}getClusterEventQNode(e){return this.m_clusters.getField(e,3)}setClusterEventQNode_(e,t){this.m_clusters.setField(e,3,t)}newCluster_(e){const t=this.m_clusters.newElement(),s=this.m_clusterVertices.createList();return this.setClusterVertices_(t,s),e!==n.nullHandle&&(this.m_clusterVertices.addElement(s,e),this.m_shape.setUserIndex(e,this.m_vertexClusterIndex,t)),t}deleteCluster_(e){this.m_clusters.deleteElement(e)}addVertexToCluster_(e,t){const s=this.getClusterVertices(e);this.m_clusterVertices.addElement(s,t),this.m_shape.setUserIndex(t,this.m_vertexClusterIndex,e)}newEdge_(e){const t=this.m_edges.newElement(),s=this.m_edgeVertices.createList();return this.setEdgeOriginVertices_(t,s),-1!==e&&this.m_edgeVertices.addElement(s,e),t}addVertexToEdge_(e,t){const s=this.getEdgeOriginVertices(e);this.m_edgeVertices.addElement(s,t)}deleteEdge_(e){this.m_edges.deleteElement(e);const t=this.m_edgesToInsertInSweepStructure.findIndex(t=>t===e);t>=0&&r.unorderedPop(this.m_edgesToInsertInSweepStructure,t)}addEdgeToCluster(e,t){-1===this.getEdgeCluster(e,0)?this.setEdgeCluster_(e,0,t):-1===this.getEdgeCluster(e,1)?this.setEdgeCluster_(e,1,t):s.throwInternalErrorException(""),this.addEdgeToClusterImpl_(e,t)}addEdgeToClusterImpl_(e,t){const s=this.getClusterFirstEdge(t);if(-1!==s){const n=this.getNextEdge(s,t);this.setPrevEdge_(n,t,e),this.setNextEdge_(e,t,n),this.setNextEdge_(s,t,e),this.setPrevEdge_(e,t,s)}else this.setPrevEdge_(e,t,e),this.setNextEdge_(e,t,e),this.setClusterFirstEdge_(t,e)}getEdgeEnd(e,t){return this.getEdgeCluster(e,0)===t?0:1}mergeClusters_(e,t){this.dbgCheckCluster_(e),this.dbgCheckCluster_(t);const s=this.getClusterEventQNode(t);-1!==s&&(this.m_eventQ.deleteNode(s),this.setClusterEventQNode_(t,-1));let n=this.getClusterFirstEdge(e),i=this.getClusterFirstEdge(t);if(-1!==i){let s=i,r=i,o=!1;do{this.dbgCheckEdge_(s),o=!1;const n=this.getEdgeEnd(s,t),a=this.getNextEdgeEx(s,n);if(this.getEdgeCluster(s,n+1&1)===e){this.disconnectEdge_(s);const e=this.getEdgeOriginVertices(s);if(this.m_edgeVertices.deleteList(e),this.deleteEdge_(s),s===a){i=-1;break}i===s&&(i=this.getClusterFirstEdge(t),r=a,o=!0)}s=a}while(s!==r||o);if(-1!==i){do{const n=this.getEdgeEnd(s,t),i=this.getNextEdgeEx(s,n);this.setEdgeCluster_(s,n,e),s=i}while(s!==r);if(n=this.getClusterFirstEdge(e),-1!==n){const t=this.getNextEdge(n,e),s=this.getNextEdge(i,e);t===n?(this.setClusterFirstEdge_(e,i),this.addEdgeToClusterImpl_(n,e),this.setClusterFirstEdge_(e,n)):s===i&&this.addEdgeToClusterImpl_(i,e),this.setNextEdge_(i,e,t),this.setPrevEdge_(t,e,i),this.setNextEdge_(n,e,s),this.setPrevEdge_(s,e,n)}else this.setClusterFirstEdge_(e,i)}}const r=this.getClusterVertices(e),o=this.getClusterVertices(t);for(let t=this.m_clusterVertices.getFirst(o);-1!==t;t=this.m_clusterVertices.getNext(t)){const s=this.m_clusterVertices.getElement(t);this.m_shape.setUserIndex(s,this.m_vertexClusterIndex,e)}this.m_clusterVertices.concatenateLists(r,o),this.deleteCluster_(t),this.dbgCheckCluster_(e)}mergeEdges_(e,t){this.dbgCheckEdge_(e),this.dbgCheckEdge_(t);const s=this.getEdgeCluster(e,0),n=this.getEdgeCluster(e,1),i=this.getEdgeCluster(t,0),r=this.getEdgeCluster(t,1),o=this.getEdgeOriginVertices(e),a=this.getEdgeOriginVertices(t);if(this.m_edgeVertices.concatenateLists(o,a),t===this.getClusterFirstEdge(s)&&this.setClusterFirstEdge_(s,e),t===this.getClusterFirstEdge(n)&&this.setClusterFirstEdge_(n,e),this.disconnectEdge_(t),this.deleteEdge_(t),!(s===i&&n===r||n===i&&s===r)){const e=this.getClusterXY(s),t=this.getClusterXY(i);e.isEqualPoint2D(t)?(s!==i&&this.mergeClusters_(s,i),n!==r&&this.mergeClusters_(n,r)):(n!==i&&this.mergeClusters_(n,i),s!==r&&this.mergeClusters_(s,r))}this.dbgCheckEdge_(e)}disconnectEdge_(e){const t=this.getEdgeCluster(e,0),s=this.getEdgeCluster(e,1);this.disconnectEdgeFromCluster_(e,t),this.disconnectEdgeFromCluster_(e,s)}disconnectEdgeFromCluster_(e,t){const s=this.getNextEdge(e,t),n=this.getPrevEdge(e,t),i=this.getClusterFirstEdge(t);s!==e?(this.setNextEdge_(n,t,s),this.setPrevEdge_(s,t,n),i===e&&this.setClusterFirstEdge_(t,s)):this.setClusterFirstEdge_(t,-1)}applyIntersectorToEditShape_(e,t,s){let n=this.m_edgeVertices.getFirst(e);const i=this.m_edgeVertices.getElement(n),r=this.getClusterFromVertex(i),o=this.m_shape.getNextVertex(i),a=this.getClusterFromVertex(o),m=this.m_shape.getXY(i),h=this.m_shape.getXY(o);let l=!1,u=!1;const c=t.getResultSegment(s,0).getStartXY(),g=t.getResultSegment(s,t.getResultSegmentCount(s)-1).getEndXY();m.equals(c)||(l=!0),h.equals(g)||(u=!0),this.m_shape.splitSegmentWithIntersector(i,t,s,!0,!0);const d=this.m_bTrackChanges&&t.getSegmentChanged(s);for(d&&this.m_shape.setGeometryModifiedWithVertex(i,!0),n=this.m_edgeVertices.getNext(n);-1!==n;n=this.m_edgeVertices.getNext(n)){const e=this.m_edgeVertices.getElement(n),i=this.getClusterFromVertex(e)===r;this.m_shape.splitSegmentWithIntersector(e,t,s,i,!0),d&&this.m_shape.setGeometryModifiedWithVertex(e,!0)}if(l&&this.updateClusterXY(!0,r,c,t.getResultSegmentStartPointWeight(s,0),t.getResultSegmentStartPointRank(s,0)),u){const e=t.getResultSegmentCount(s)-1;this.updateClusterXY(!0,a,g,t.getResultSegmentEndPointWeight(s,e),t.getResultSegmentEndPointRank(s,e))}}createEdgesAndClustersFromSplitEdge_(e,t,s){this.dbgCheckNewEdgesArray_();const n=this.getEdgeOriginVertices(e),r=this.getEdgeCluster(e,0),o=this.getEdgeCluster(e,1);let a=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(a);const m=i.StridedIndexTypeCollection.impossibleIndex3();this.setEdgeSweepNode_(a,m),this.m_tempEdgeBuffer.push(a),this.addEdgeToCluster(a,r);const h=t.getResultSegmentCount(s);for(let e=1;e<h;e++){const e=this.newCluster_(-1);this.m_modifiedClusters.push(e),this.m_tempEdgeBuffer.push(e),this.addEdgeToCluster(a,e);const t=this.newEdge_(-1);this.m_edgesToInsertInSweepStructure.push(t),this.setEdgeSweepNode_(t,m),this.m_tempEdgeBuffer.push(t),this.addEdgeToCluster(t,e),a=t}this.addEdgeToCluster(a,o);for(let e=this.m_edgeVertices.getFirst(n);-1!==e;e=this.m_edgeVertices.getNext(e)){let t=this.m_edgeVertices.getElement(e);if(this.getClusterFromVertex(t)===r){let e=0;const s=this.m_tempEdgeBuffer.length;do{if(e>0){const s=this.m_tempEdgeBuffer[e-1];this.addVertexToCluster_(s,t)}const s=this.m_tempEdgeBuffer[e];e+=2,this.addVertexToEdge_(s,t),t=this.m_shape.getNextVertex(t)}while(e<s)}else{let e=this.m_tempEdgeBuffer.length-1;do{if(e<this.m_tempEdgeBuffer.length-2){const s=this.m_tempEdgeBuffer[e+1];this.addVertexToCluster_(s,t)}const s=this.m_tempEdgeBuffer[e];e-=2,this.addVertexToEdge_(s,t),t=this.m_shape.getNextVertex(t)}while(e>=0)}}this.m_tempEdgeBuffer.length=0,this.dbgCheckNewEdgesArray_()}getVertexFromClusterIndex(e){const t=this.getClusterVertices(e);return this.m_clusterVertices.getFirstElement(t)}getClusterFromVertex(e){return this.m_shape.getUserIndex(e,this.m_vertexClusterIndex)}processSplitHelper1_(e,t,s){const n=this.getEdgeCluster(t,0),r=this.getClusterXY(n),o=this.getEdgeCluster(t,1),a=this.getClusterXY(o),m=s.getResultSegmentCount(e);let h=s.getResultSegment(e,0);const l=h.getStartXY();if(r.isEqualPoint2D(l)||(this.m_bComplications||r.compare(this.m_sweepPoint)*l.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(n,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(n)),!this.m_bComplications&&m>1){const e=r.compare(a),t=h.getEndXY();(r.compare(t)!==e||t.compare(a)!==e||t.compare(this.m_sweepPoint)<0)&&(this.m_bComplications=!0)}h=s.getResultSegment(e,m-1);const u=h.getEndXY();a.isEqualPoint2D(u)||(this.m_bComplications||a.compare(this.m_sweepPoint)*u.compare(this.m_sweepPoint)<0&&(this.m_bComplications=!0),this.getAffectedEdges(o,this.m_tempEdgeBuffer),this.m_modifiedClusters.push(o)),this.m_tempEdgeBuffer.push(t);for(let e=0,s=this.m_tempEdgeBuffer.length;e<s;e++){const s=this.m_tempEdgeBuffer[e],n=this.getEdgeSweepNode(s);i.StridedIndexTypeCollection.isValidElement(n)&&(this.m_sweepStructure.deleteNode(n),this.setEdgeSweepNode_(s,-1));const r=i.StridedIndexTypeCollection.impossibleIndex3();s!==t&&this.getEdgeSweepNode(s)!==r&&(this.m_edgesToInsertInSweepStructure.push(s),this.setEdgeSweepNode_(s,r))}this.m_tempEdgeBuffer.length=0}checkAndFixIntersection_(e,t){const s=this.m_sweepStructure.getElement(e);return this.m_sweepComparator.compare(this.m_sweepStructure,s,t),!!this.m_sweepComparator.intersectionDetected()&&(this.m_sweepComparator.clearIntersectionDetectedFlag(),this.fixIntersection_(e,t),!0)}fixIntersection_(e,t){this.m_bCracked=!0;const s=this.m_sweepStructure.getElement(e),n=this.m_sweepStructure.getElement(t);let i=null,r=null;const o=this.getEdgeOriginVertices(s),a=this.m_edgeVertices.getFirstElement(o),m=this.getEdgeOriginVertices(n),h=this.m_edgeVertices.getFirstElement(m);this.m_shape.querySegment(a,this.m_segBuf1,!1,!1),i=this.m_segBuf1.get();const l=this.m_shape.getNextVertex(a),u=this.m_shape.getWeight(a),c=this.m_shape.getSegmentParentageBreakVertex(a),g=this.m_shape.getWeight(l),d=this.m_shape.getSegmentParentageBreakVertex(l),p=this.m_shape.getSegmentWeight(a),_=this.m_shape.getRank(a),f=this.m_shape.getRank(l),y=this.m_shape.getSegmentRank(a),x=this.m_shape.getSegmentParentage(a);this.m_shape.querySegment(h,this.m_segBuf2,!1,!1),r=this.m_segBuf2.get();const P=this.m_shape.getNextVertex(h),E=this.m_shape.getWeight(h),v=this.m_shape.getSegmentParentageBreakVertex(h),C=this.m_shape.getWeight(P),D=this.m_shape.getSegmentParentageBreakVertex(P),b=this.m_shape.getSegmentWeight(h),S=this.m_shape.getRank(h),I=this.m_shape.getRank(P),w=this.m_shape.getSegmentRank(h),T=this.m_shape.getSegmentParentage(h);this.m_segmentIntersector.pushSegment(i,u,_,g,f,p,y,c,d,x),this.m_segmentIntersector.pushSegment(r,E,S,C,I,b,w,v,D,T),3===this.m_segmentIntersector.intersect2D(this.m_tolerance,!0)&&(this.m_bComplications=!0),this.splitEdge_(s,n,-1,this.m_segmentIntersector),this.m_segmentIntersector.clear()}fixIntersectionPointSegment_(e,t){this.m_bCracked=!0;const s=this.m_sweepStructure.getElement(t);let n=null;const i=this.getEdgeOriginVertices(s),r=this.m_edgeVertices.getFirstElement(i);this.m_shape.querySegment(r,this.m_segBuf1,!1,!1),n=this.m_segBuf1.get();const o=this.m_shape.getNextVertex(r),a=this.m_shape.getWeight(r),m=this.m_shape.getSegmentParentageBreakVertex(r),h=this.m_shape.getWeight(o),l=this.m_shape.getSegmentParentageBreakVertex(o),u=this.m_shape.getSegmentWeight(r),c=this.m_shape.getRank(r),g=this.m_shape.getRank(o),d=this.m_shape.getSegmentRank(r),p=this.m_shape.getSegmentParentage(r),_=this.getClusterFirstVertex(e);this.m_segmentIntersector.pushSegment(n,a,c,h,g,u,d,m,l,p),this.m_shape.queryPoint(_,this.m_helperPoint);const f=this.m_shape.getWeight(_),y=this.m_shape.getRank(_);this.m_segmentIntersector.intersect2DEx(this.m_tolerance,this.m_helperPoint,y,f,!0),this.splitEdge_(s,-1,e,this.m_segmentIntersector),this.m_segmentIntersector.clear()}insertNewEdges_(){if(0===this.m_edgesToInsertInSweepStructure.length)return!0;this.dbgCheckNewEdgesArray_();let e=!0,t=0;const s=this.m_edgesToInsertInSweepStructure.length,n=Math.max(2*s+200,this.m_sweepStructure.size()+200);for(;this.m_edgesToInsertInSweepStructure.length;){if(this.m_edgesToInsertInSweepStructure.length>Math.max(100,this.m_shape.getTotalPointCount())||t>n){this.m_edgesToInsertInSweepStructure.length=0,this.m_bComplications=!0,e=!1;break}const s=this.m_edgesToInsertInSweepStructure.at(-1);this.m_edgesToInsertInSweepStructure.pop(),this.setEdgeSweepNode_(s,-1);const r=this.isEdgeOnSweepLine_(s);i.StridedIndexTypeCollection.isValidElement(r)?(this.insertNewEdgeToSweepStructure_(s,r),t++):r!==i.StridedIndexTypeCollection.impossibleIndex2()&&(e=!1),this.m_bContinuingSegmentChainOptimization=!1}return e}insertNewEdgeToSweepStructure_(e,t){let s;if(this.m_bContinuingSegmentChainOptimization?(s=this.m_sweepStructure.addElementAtPosition(this.m_prevNeighbour,this.m_nextNeighbour,e,!0,!0),this.m_bContinuingSegmentChainOptimization=!1):s=this.m_sweepStructure.addUniqueElement(e),-1===s){const t=this.m_sweepStructure.getDuplicateElement(),s=this.m_sweepStructure.getElement(t);return this.mergeEdges_(s,e),!1}if(this.setEdgeSweepNode_(e,s),this.m_sweepComparator.intersectionDetected()){this.m_sweepComparator.clearIntersectionDetectedFlag();const e=this.m_sweepComparator.getLastComparedNode();return this.m_prevNeighbour===e&&(this.m_prevNeighbour=-1),this.m_nextNeighbour===e&&(this.m_nextNeighbour=-1),this.fixIntersection_(e,s),!0}return!1}isEdgeOnSweepLine_(e){const t=this.getEdgeCluster(e,0),s=this.getEdgeCluster(e,1),n=this.getClusterXY(t),o=this.getClusterXY(s);if(r.Point2D.sqrDistance(n,o)<=this.m_toleranceSqr)return this.m_bComplications=!0,-1;const a=n.compare(this.m_sweepPoint),m=o.compare(this.m_sweepPoint);return a<=0&&m>0?s:m<=0&&a>0?t:a>0&&m>0?i.StridedIndexTypeCollection.impossibleIndex2():-1}fillEventQueue(){const e=new i.AttributeStreamOfInt32(0),t=this.m_shape.queryVertexIteratorOnSelection();for(let s=t.next();s!==n.nullHandle;s=t.next())-1!==this.m_shape.getUserIndex(s,this.m_vertexClusterIndex)&&e.add(s);this.m_shape.sortVerticesSimpleByY(e,0,e.size()),this.progress_(!0),this.m_eventQ.clear(),this.m_eventQ.setCapacity(e.size()),this.m_eventQ.setComparator(new de(this.m_shape));const s=r.Point2D.getNAN();s.setNAN();let o=-1;for(let t=0,n=e.size();t<n;t++){const n=e.read(t);if(this.m_shape.getXY(n).isEqualPoint2D(s)){const e=this.m_shape.getUserIndex(n,this.m_vertexClusterIndex);this.mergeClusters_(o,e);continue}o=this.getClusterFromVertex(n),this.m_shape.queryXY(n,s);const i=this.m_eventQ.addBiggestElement(n);this.setClusterEventQNode_(o,i)}}fillEventQueuePass2(){const e=new i.AttributeStreamOfInt32(0);for(let t=this.m_eventQ.getFirst();-1!==t;t=this.m_eventQ.getNext(t)){const s=this.m_eventQ.getElement(t);e.add(s)}this.m_eventQ.clear(),this.m_shape.sortVerticesSimpleByY(e,0,e.size()),this.progress_(!0);for(let t=0,s=e.size();t<s;t++){const s=e.read(t),n=this.getClusterFromVertex(s),i=this.m_eventQ.addBiggestElement(s);this.setClusterEventQNode_(n,i)}}getAffectedEdges(e,t){const s=this.getClusterFirstEdge(e);if(-1===s)return;let n=s;do{const s=this.getEdgeSweepNode(n);i.StridedIndexTypeCollection.isValidElement(s)&&t.push(n),n=this.getNextEdge(n,e)}while(n!==s)}updateClusterXY(e,t,s,n,i){const r=this.getClusterVertices(t);for(let t=this.m_clusterVertices.getFirst(r);-1!==t;t=this.m_clusterVertices.getNext(t)){const r=this.m_clusterVertices.getElement(t);this.m_shape.setXYMonotonicPoint2D(r,s),this.m_shape.setWeight(r,n),this.m_shape.setRank(r,i),e&&this.m_bTrackChanges&&this.m_shape.setGeometryModifiedWithVertex(r,!0),this.m_shape.setSegmentParentageBreakVertex(r,!0)}}splitEdge_(e,t,s,n){this.dbgCheckEdge_(e),-1!==t&&this.dbgCheckEdge_(t),this.disconnectEdge_(e),-1!==t&&this.disconnectEdge_(t),this.processSplitHelper1_(0,e,n),-1!==t&&this.processSplitHelper1_(1,t,n),-1!==s&&n.getResultPointChanged()&&this.m_modifiedClusters.push(s);for(let e=0,t=this.m_modifiedClusters.length;e<t;e++){const t=this.m_modifiedClusters[e],s=this.getClusterEventQNode(t);-1!==s&&(this.m_eventQ.deleteNode(s),this.setClusterEventQNode_(t,-1))}const i=this.getEdgeOriginVertices(e),r=-1!==t?this.getEdgeOriginVertices(t):-1;if(this.applyIntersectorToEditShape_(i,n,0),-1!==r)this.applyIntersectorToEditShape_(r,n,1);else{const e=n.getResultPoint().getXY();this.updateClusterXY(n.getResultPointChanged(),s,e,n.getResultPointWeight(),n.getResultPointRank())}this.createEdgesAndClustersFromSplitEdge_(e,n,0),-1!==t&&this.createEdgesAndClustersFromSplitEdge_(t,n,1),this.m_edgeVertices.deleteList(i),this.deleteEdge_(e),-1!==t&&(this.m_edgeVertices.deleteList(r),this.deleteEdge_(t));for(let e=0,t=this.m_modifiedClusters.length;e<t;e++){const t=this.m_modifiedClusters[e];t===this.m_sweepPointCluster&&(this.m_bSweepPointClusterWasModified=!0);let s=this.getClusterEventQNode(t);if(-1===s){const e=this.getClusterFirstVertex(t);if(s=this.m_eventQ.addUniqueElement(e),-1===s){const e=this.m_eventQ.getDuplicateElement(),s=this.m_eventQ.getElement(e),n=this.getClusterFromVertex(s);this.mergeClusters_(n,t)}else this.setClusterEventQNode_(t,s)}}this.m_modifiedClusters.length=0}getClusterXY(e){const t=this.getClusterFirstVertex(e);return this.m_shape.getXY(t)}getClusterFirstVertex(e){const t=this.getClusterVertices(e);return this.m_clusterVertices.getFirstElement(t)}dbgCheckEdge_(e){}dbgCheckCluster_(e){}dbgCheckNewEdgesArray_(){}dbgSaveSweepStructure_(e){}sweepImpl_(){this.progress_(!0),this.m_bSweepPointClusterWasModified=!1,this.m_sweepPointCluster=-1,null===this.m_sweepComparator&&(this.m_sweepStructure.disableBalancing(),this.m_sweepComparator=new ce(this),this.m_sweepStructure.setComparator(this.m_sweepComparator));const e=[];let t=null,s=null;this.m_prevNeighbour=-1,this.m_nextNeighbour=-1,this.m_bContinuingSegmentChainOptimization=!1;const n=i.StridedIndexTypeCollection.impossibleIndex2(),r=i.StridedIndexTypeCollection.impossibleIndex3();for(let i=this.m_eventQ.getFirst();-1!==i;){this.progress_(),this.dbgCheckSweepStructure_(),this.m_bContinuingSegmentChainOptimization=!1,this.m_prevNeighbour=-1,this.m_nextNeighbour=-1;const o=this.m_eventQ.getElement(i);this.m_sweepPointCluster=this.getClusterFromVertex(o),this.m_shape.queryXY(o,this.m_sweepPoint),this.m_sweepComparator.setSweepY(this.m_sweepPoint.y,this.m_sweepPoint.x);let a=!1;{const t=this.getClusterFirstEdge(this.m_sweepPointCluster);if(a=-1===t,!a){let s=t;do{const t=this.getEdgeSweepNode(s);-1===t?(this.m_edgesToInsertInSweepStructure.push(s),this.setEdgeSweepNode_(s,r)):t!==r&&e.push(t),s=this.getNextEdge(s,this.m_sweepPointCluster)}while(s!==t)}}if(!this.m_sweepStructure.isAutoBalancing()&&(this.m_sweepStructure.getMaxDepthEver()>4||this.m_edgesToInsertInSweepStructure.length>10)&&this.m_sweepStructure.enableBalancing(),e.length>0){this.m_bContinuingSegmentChainOptimization=1===e.length&&1===this.m_edgesToInsertInSweepStructure.length;for(let t=0,s=e.length;t<s;t++){const s=this.m_sweepStructure.getElement(e[t]);this.setEdgeSweepNode_(s,n)}let t=n,s=n;for(let i=0,r=e.length;i<r;i++){const r=e[i];if(t===n){const e=this.m_sweepStructure.getPrev(r);if(-1!==e){const s=this.m_sweepStructure.getElement(e);this.getEdgeSweepNode(s)!==n&&(t=e)}else t=-1}if(s===n){const e=this.m_sweepStructure.getNext(r);if(-1!==e){const t=this.m_sweepStructure.getElement(e);this.getEdgeSweepNode(t)!==n&&(s=e)}else s=-1}if(t!==n&&s!==n)break}for(let t=0,s=e.length;t<s;t++){const s=e[t],n=this.m_sweepStructure.getElement(s);this.m_sweepStructure.deleteNode(s),this.setEdgeSweepNode_(n,-1)}e.length=0,this.m_prevNeighbour=t,this.m_nextNeighbour=s,-1!==t&&-1!==s?this.m_bContinuingSegmentChainOptimization||this.checkAndFixIntersection_(t,s):-1===t&&-1===s&&(this.m_bContinuingSegmentChainOptimization=!1)}else a&&(null===t&&(t=new ge(this)),t.setPoint(this.m_sweepPoint),this.m_sweepStructure.searchUpperBound(t),t.intersectionDetected()&&(t.clearIntersectionDetectedFlag(),this.fixIntersectionPointSegment_(this.m_sweepPointCluster,t.getCurrentNode())));const m=this.m_bContinuingSegmentChainOptimization;!this.insertNewEdges_()&&m&&-1!==this.m_prevNeighbour&&-1!==this.m_nextNeighbour&&this.checkAndFixIntersection_(this.m_prevNeighbour,this.m_nextNeighbour),this.m_bSweepPointClusterWasModified?(this.m_bSweepPointClusterWasModified=!1,null===s&&(s=new pe(this.m_shape)),s.setPoint(this.m_sweepPoint),i=this.m_eventQ.searchUpperBound(s)):i=this.m_eventQ.getNext(i)}return this.m_bCracked}setEditShape_(e){this.m_shape=e,this.m_vertexClusterIndex=this.m_shape.createUserIndex(),this.m_edges.setCapacity(e.getSelectedCount()+32),this.m_clusters.setCapacity(e.getSelectedCount()),this.m_clusterVertices.reserveLists(e.getSelectedCount()),this.m_clusterVertices.reserveNodes(e.getSelectedCount()),this.m_edgeVertices.reserveLists(e.getSelectedCount()+32),this.m_edgeVertices.reserveNodes(e.getSelectedCount()+32);for(let t=this.m_shape.getFirstGeometry();t!==n.nullHandle;t=this.m_shape.getNextGeometry(t))if(s.isMultiPath(this.m_shape.getGeometryType(t)))for(let s=this.m_shape.getFirstPath(t);s!==n.nullHandle;s=this.m_shape.getNextPath(s)){const t=this.m_shape.getPathSize(s),i=this.m_shape.getFirstVertex(s);if(i===n.nullHandle)continue;let r=this.m_shape.getNextVertex(i);if(r===n.nullHandle||r===i)continue;let o=-1;e.selected(i)&&(o=this.newCluster_(i));let a=-1;-1!==o&&e.selected(r)&&(a=this.newEdge_(i),this.addEdgeToCluster(a,o));let m=a;for(let e=0,s=t-2;e<s;e++){const e=this.m_shape.getNextVertex(r);let t=-1;if(this.m_shape.selected(r)){const s=this.newCluster_(r);-1!==m&&this.addEdgeToCluster(m,s),this.m_shape.selected(e)&&(t=this.newEdge_(r),this.addEdgeToCluster(t,s))}m=t,r=e}if(this.m_shape.isClosedPath(s)){const e=this.m_shape.getNextVertex(r);if(this.m_shape.selected(r)){const t=this.newCluster_(r);if(-1!==m&&this.addEdgeToCluster(m,t),this.m_shape.selected(e)){const e=this.newEdge_(r);this.addEdgeToCluster(e,t),this.addEdgeToCluster(e,o)}}}else{let e=-1;this.m_shape.selected(r)&&(e=this.newCluster_(r),-1!==m&&this.addEdgeToCluster(m,e))}}else for(let e=this.m_shape.getFirstPath(t);e!==n.nullHandle;e=this.m_shape.getNextPath(e)){let t=this.m_shape.getFirstVertex(e);for(let s=0,n=this.m_shape.getPathSize(e);s<n;s++)this.m_shape.selected(t)&&this.newCluster_(t),t=this.m_shape.getNextVertex(t)}this.fillEventQueue()}progress_(e=!1){}dbgCheckSweepStructure_(){}}function fe(e,t,s){return{vertex0:e,vertex1:t,dir:s}}class ye{constructor(e){this.m_shape=null,this.m_spikes=[],this.m_points=new i.AttributeStreamOfInt32(0),this.m_pointsIndex=-1,this.m_dissolvedEdges=0,this.m_progressTracker=e}executeImpl_(e,t){if(this.m_shape=e,e.getPathCount(t)<2&&e.getPointCount(t)<6)return;this.m_points.resize(0);for(let s=e.getFirstPath(t);s!==n.nullHandle;s=e.getNextPath(s)){let t=e.getFirstVertex(s);for(let n=0,i=e.getPathSize(s);n<i;n++,t=e.getNextVertex(t))this.m_points.add(t)}this.m_pointsIndex=e.createUserIndex();for(let t=0,s=this.m_points.size();t<s;++t)e.setUserIndex(this.m_points.read(t),this.m_pointsIndex,t);e.sortVerticesSimpleByY(this.m_points,0,this.m_points.size());let i=this.m_points.read(0);const r=e.getXY(i);let o=1,a=0;const m=[];for(let t=1;t<this.m_points.size();t++){const s=this.m_points.read(t);if(s===n.nullHandle)continue;if(-1===e.getUserIndex(s,this.m_pointsIndex))continue;const h=e.getXY(s);if(h.isEqualPoint2D(r))o++;else{if(o>1){for(let s=a;s<t;s++){const t=this.m_points.read(s);if(-1===e.getUserIndex(t,this.m_pointsIndex))continue;const n=e.getNextVertex(t),i=e.getPrevVertex(t);if(t!==n&&!e.isEqualXYPoint2D(n,r)){const e=fe(t,n,1);m.push(e)}if(t!==i&&i!==n&&!e.isEqualXYPoint2D(i,r)){const e=fe(t,i,-1);m.push(e)}}m.length>0&&this.processBunch_(m,r)}i=s,r.assign(h),o=1,a=t}}if(0===this.m_dissolvedEdges)return e.removeUserIndex(this.m_pointsIndex),void(this.m_pointsIndex=-1);let h=e.getPointCount(t);for(let t=0;t<this.m_points.size();t++){const s=this.m_points.read(t);if(s===n.nullHandle)continue;if(-1!==e.getUserIndex(s,this.m_pointsIndex)){e.setUserIndex(s,this.m_pointsIndex,-1);continue}const i=e.getPathFromVertex(s);e.getFirstVertex(i)===s&&e.setFirstVertex(i,n.nullHandle),e.freeVertex(s),this.m_points.write(t,n.nullHandle),h--}const l=e.createPathUserIndex();let u=e.getPathCount(t);for(let i=0,r=this.m_points.size();i<r;++i){if(this.m_points.read(i)===n.nullHandle)continue;let r=this.m_points.read(i);if(-1!==e.getUserIndex(r,this.m_pointsIndex))continue;let o=e.getPathFromVertex(r),a=-1;if(2===e.getPathUserIndex(o,l)){o=n.nullHandle;for(let t=e.getNextVertex(r);t!==r;t=e.getNextVertex(t)){const s=e.getPathFromVertex(t);if(2!==e.getPathUserIndex(s,l)){o=s,r=t;break}}o===n.nullHandle&&(o=e.insertPath(t,n.nullHandle),e.setClosedPath(o,!0),u++),s.geometryReleaseAssert(o!==n.nullHandle)}e.setPathUserIndex(o,l,2),a=e.getFirstVertex(o);let m=0,h=!1,c=r;do{a===c&&(h=!0),e.setUserIndex(c,this.m_pointsIndex,1);const t=e.getPathFromVertex(c);t!==o&&(2!==e.getPathUserIndex(t,l)&&(e.setPathUserIndex(t,l,1),e.setFirstVertex(t,n.nullHandle)),e.setPathToVertex(c,o)),m++,c=e.getNextVertex(c)}while(c!==r);h||e.setFirstVertex(o,r),e.setPathSize(o,m)}for(let s=e.getFirstPath(t);s!==n.nullHandle;){const t=e.getNextPath(s);1!==e.getPathUserIndex(s,l)&&e.getFirstVertex(s)!==n.nullHandle||(e.removePathOnly(s),u--),s=t}e.setGeometryVertexCount(t,h),e.setGeometryPathCount(t,u),e.removePathUserIndex(l),e.removeUserIndex(this.m_pointsIndex),this.m_pointsIndex=-1,e.dbgVerifyVertexCounts(),e.filterClosePoints(0,!0,!1,!1,t)}processBunch_(e,t){e.sort((e,s)=>{const n=this.m_shape.getXY(e.vertex1).sub(t),i=this.m_shape.getXY(s.vertex1).sub(t),o=r.Point2D.compareVectors(n,i);return 0===o?e.dir<s.dir?-1:1:o});let s=0;const n=this.m_shape.getXY(e[0].vertex1);let i=1;const o=this.m_shape.hasCurves();for(let t=1,r=e.length;t<r;t++){const a=this.m_shape.getXY(e[t].vertex1);if(!(a.isEqualPoint2D(n)&&(i++,t+1<r))){if(2===i){const t=e[s],n=e[s+1],i=t.dir;if(i!==n.dir){let e=!0;if(o&&(e=!this.m_shape.isCurve(1===t.dir?t.vertex0:t.vertex1)&&!this.m_shape.isCurve(1===n.dir?n.vertex0:n.vertex1)),e){if(1===i){const e=t.vertex0,s=n.vertex0;this.m_shape.setNextVertex(e,s),this.m_shape.setPrevVertex(s,e),this.m_shape.getPrevVertex(e)===s&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(s,this.m_pointsIndex,-1));const i=t.vertex1,r=n.vertex1;this.m_shape.setPrevVertex(i,r),this.m_shape.setNextVertex(r,i),this.m_shape.getNextVertex(i)===r&&(this.m_shape.setUserIndex(i,this.m_pointsIndex,-1),this.m_shape.setUserIndex(r,this.m_pointsIndex,-1))}else{const e=t.vertex0,s=n.vertex0;this.m_shape.setPrevVertex(e,s),this.m_shape.setNextVertex(s,e),this.m_shape.getNextVertex(e)===s&&(this.m_shape.setUserIndex(e,this.m_pointsIndex,-1),this.m_shape.setUserIndex(s,this.m_pointsIndex,-1));const i=t.vertex1,r=n.vertex1;this.m_shape.setNextVertex(i,r),this.m_shape.setPrevVertex(r,i),this.m_shape.getPrevVertex(i)===r&&(this.m_shape.setUserIndex(i,this.m_pointsIndex,-1),this.m_shape.setUserIndex(r,this.m_pointsIndex,-1))}this.m_dissolvedEdges+=2}}}n.assign(a),s=t,i=1}}e.length=0}}function xe(e){for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))if(s.isMultiPath(e.getGeometryType(t)))return!0;return!1}function Pe(e,t,s,n,i){if(!xe(t))return!1;let r=new ve(i);if(r.m_shape=t,r.m_tolerance=s,r.m_bAllowCoincident=e,r.m_bNeedsNonSimpleResult=null!==n,r.needsCrackingImpl_())return n&&n.assign(r.m_nonSimpleResult),!0;const o=new a.Transformation2D;o.setSwapCoordinates(),t.applyTransformation(o),r=new ve(i),r.m_shape=t,r.m_tolerance=s,r.m_bAllowCoincident=e,r.m_bNeedsNonSimpleResult=null!==n;const m=r.needsCrackingImpl_();return t.applyTransformation(o),!!m&&(n&&n.assign(r.m_nonSimpleResult),!0)}function Ee(e,t){return{t:e,index:t}}class ve{crackBruteForce_(){let e=this.crackBruteForceImpl_();if(!e&&this.m_shape.hasCurves()){const t=new a.Transformation2D;t.setSwapCoordinates(),this.m_shape.applyTransformation(t),e=this.crackBruteForceImpl_(),this.m_shape.applyTransformation(t)}return e}crackBruteForceImpl_(){let e=!1;const r=new n.SegmentBuffer,o=new n.SegmentBuffer,a=t.Envelope2D.constructEmpty(),m=t.Envelope2D.constructEmpty(),h=!1,l=new i.Point,u=new ie,c=this.m_shape.getTotalPointCount(),g=c*c*2,d=this.m_shape.queryVertexIteratorOnSelection();for(let t=d.next();t!==n.nullHandle;t=d.next()){const i=this.m_shape.getGeometryType(d.currentGeometry());let c=1,p=1,_=1,f=0,y=0,x=0;const P=this.m_shape.getSegmentParentage(t);let E=!1,v=!1,C=null,D=!1;if(s.isPoint(i))c=this.m_shape.getWeight(t),f=this.m_shape.getRank(t);else{if(C=this.getSegment_(t,r),null===C)continue;const e=this.m_shape.getVertexIndex(t);c=this.m_shape.getWeightWithIndex(e),f=this.m_shape.getRankWithIndex(e),_=this.m_shape.getSegmentWeightWithIndex(e),x=this.m_shape.getSegmentRankWithIndex(e),E=this.m_shape.getSegmentParentageBreakVertex(t);{const e=this.m_shape.getNextVertex(t);p=this.m_shape.getWeight(e),y=this.m_shape.getRank(e),v=this.m_shape.getSegmentParentageBreakVertex(e)}if(C.queryLooseEnvelope(a),a.inflateCoords(this.m_tolerance,this.m_tolerance),C.isDegenerate(this.m_tolerance)){if(!C.isDegenerate(0))continue;D=!0,C=null}}const b=new n.VertexIterator({copy:d});let S=b.next();S!==n.nullHandle&&(S=b.next());let I=0;for(;S!==n.nullHandle;S=b.next()){if(0!==I){I--;continue}if(this.m_shape.getTotalPointCount()>g)return e;this.progress_();const i=this.m_shape.getGeometryType(b.currentGeometry());let w=null,T=!1,A=0,N=0,G=0,M=0,R=0,k=0,F=!1,q=!1;const V=this.m_shape.getSegmentParentage(S);if(s.isPoint(i))A=this.m_shape.getWeight(S),M=this.m_shape.getRank(S);else{if(w=this.getSegment_(S,o),null===w)continue;const e=this.m_shape.getVertexIndex(S);A=this.m_shape.getWeightWithIndex(e),M=this.m_shape.getRankWithIndex(e),G=this.m_shape.getSegmentWeightWithIndex(e),k=this.m_shape.getSegmentRankWithIndex(e),F=this.m_shape.getSegmentParentageBreakVertex(S);{const e=this.m_shape.getNextVertex(S);N=this.m_shape.getWeight(e),R=this.m_shape.getRank(e),q=this.m_shape.getSegmentParentageBreakVertex(e)}if(w.queryLooseEnvelope(m),w.isDegenerate(this.m_tolerance)){if(!w.isDegenerate(0))continue;T=!0,w=null}}let H=0,O=0;if(null!==C&&null!==w)a.isIntersectingNe(m)&&0!==n.isIntersectingEx(!0,!0,C,w,this.m_tolerance,!0)&&(u.pushSegment(C,c,f,p,y,_,x,E,v,P),u.pushSegment(w,A,M,N,R,G,k,F,q,V),u.intersect2D(this.m_tolerance,!0),e||=u.getSegmentChanged(0)||u.getSegmentChanged(1),H=u.getResultSegmentCount(0),O=u.getResultSegmentCount(1),H+O>0&&(this.m_shape.splitSegmentWithIntersector(t,u,0,!0,!0),this.m_shape.splitSegmentWithIntersector(S,u,1,!0,!0),this.m_bTrackChanges&&(u.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(t,!0),u.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(S,!0))),O>1&&(I+=O-1),u.clear());else if(null!==C){const s=this.m_shape.getXY(S);if(a.contains(s)){if(u.pushSegment(C,c,f,p,y,_,x,E,v,P),this.m_shape.queryPoint(S,l),u.intersect2DEx(this.m_tolerance,l,M,A,h),e||=u.getSegmentChanged(0)||u.getResultPointChanged(),H=u.getResultSegmentCount(0),H>0)if(this.m_bTrackChanges&&(u.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(t,!0),u.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(S,!0)),this.m_shape.splitSegmentWithIntersector(t,u,0,!0,!0),T){let e=n.nullHandle;for(let t=this.m_shape.getNextVertex(S);t!==n.nullHandle&&t!==S&&(w=this.getSegment_(t,o),e=t,null!=w&&w.isDegenerate(0));t=this.m_shape.getNextVertex(t));for(let t=S;t!==n.nullHandle&&(this.m_shape.setPoint(t,u.getResultPoint(),!0),t!==e);t=this.m_shape.getNextVertex(t));}else this.m_shape.setPoint(S,u.getResultPoint(),!0);u.clear()}}else{if(null===w)continue;{const s=this.m_shape.getXY(t);if(m.inflateCoords(this.m_tolerance,this.m_tolerance),m.contains(s)){if(u.pushSegment(w,A,M,N,R,G,k,F,q,V),this.m_shape.queryPoint(t,l),u.intersect2DEx(this.m_tolerance,l,f,c,h),e||=u.getSegmentChanged(0)||u.getResultPointChanged(),O=u.getResultSegmentCount(0),O>0)if(this.m_bTrackChanges&&(u.getSegmentChanged(0)&&this.m_shape.setGeometryModifiedWithVertex(S,!0),u.getSegmentChanged(1)&&this.m_shape.setGeometryModifiedWithVertex(t,!0)),this.m_shape.splitSegmentWithIntersector(S,u,0,!0,!0),I+=O-1,D){let e=n.nullHandle;for(let s=this.m_shape.getNextVertex(t);s!==n.nullHandle&&s!==t&&(w=this.getSegment_(s,o),e=s,null!=w&&w.isDegenerate(0));s=this.m_shape.getNextVertex(s));for(let s=t;s!==n.nullHandle&&(this.m_shape.setPoint(s,u.getResultPoint(),!0),s!==e);s=this.m_shape.getNextVertex(s));}else this.m_shape.setPoint(t,u.getResultPoint(),!0);u.clear()}}}if(H+O!==0&&0!==H){let e=!1;for(;C=this.getSegment_(t,r),null!=C&&(C.queryEnvelope(a),C.isDegenerate(this.m_tolerance));){if(!(H>1)){e=!0;break}t=d.next(),H--,s.geometryReleaseAssert(t!==n.nullHandle)}if(e)break}}}return e}crackerPlaneSweep_(){return this.planesweep_()}planesweep_(){return new _e(this.m_progressTracker,this.m_bTrackChanges).sweep(this.m_shape,this.m_tolerance)}needsCrackingImpl_(){let e=!1;const t=new i.AttributeStreamOfInt32(0);t.resize(this.m_shape.getSelectedCount());const o=this.m_shape.queryVertexIteratorOnSelection();for(let e=0,s=o.next();s!==n.nullHandle;++e,s=o.next())t.write(e,s);this.m_shape.sortVerticesSimpleByY(t,0,t.size()),t.add(n.nullHandle);const a=this.m_shape.createUserIndex(),m=this.m_shape.createUserIndex();this.m_sweepComparator=new Z(this.m_shape,this.m_tolerance,!this.m_bAllowCoincident),this.m_sweepStructure.setComparator(this.m_sweepComparator);let h=null;const l=[],c=[];let g=0;const d=new r.Point2D;for(let i=t.read(g++);i!==n.nullHandle;){this.m_shape.queryXY(i,d);let o=!1;do{let e=this.m_shape.getNextVertex(i),s=this.m_shape.getPrevVertex(i);o||=e!==n.nullHandle||s!==n.nullHandle,e===n.nullHandle||this.m_shape.selected(e)||(e=n.nullHandle),s===n.nullHandle||this.m_shape.selected(s)||(s=n.nullHandle),e!==n.nullHandle&&this.m_shape.compareVerticesSimpleY(i,e)<0&&(c.push(i),c.push(e)),s!==n.nullHandle&&this.m_shape.compareVerticesSimpleY(i,s)<0&&(c.push(s),c.push(s));const r=this.m_shape.getUserIndex(i,a);-1!==r&&(l.push(r),this.m_shape.setUserIndex(i,a,-1));const h=this.m_shape.getUserIndex(i,m);-1!==h&&(l.push(h),this.m_shape.setUserIndex(i,m,-1)),i=t.read(g++)}while(i!==n.nullHandle&&this.m_shape.isEqualXYPoint2D(i,d));if(!o&&(null===h&&(h=new Q(this.m_shape,this.m_tolerance)),h.setPoint(d),this.m_sweepStructure.searchUpperBound(h),h.intersectionDetected())){e=!0,this.m_bNeedsNonSimpleResult&&(s.throwInternalErrorException("needsCrackingIMpl_"),this.m_nonSimpleResult=new u.NonSimpleResult(6,-1,-1));break}let p=1===l.length&&2===c.length;const _=32;l.length>_&&r.numericSort(l);let f=-1,y=-1;if(!p)for(let t=0,s=l.length;t<s;t++){const s=l[t],n=this.m_sweepStructure.getPrev(s);if(-1!==n&&-1===l.indexOf(n))if(-1===f)f=n;else{if(e=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new u.NonSimpleResult(6,-1,-1)}const i=this.m_sweepStructure.getNext(s);if(-1!==i&&-1===l.indexOf(i))if(-1===y)y=i;else{if(e=!0,!this.m_bNeedsNonSimpleResult)break;this.m_nonSimpleResult=new u.NonSimpleResult(6,-1,-1)}if(-1!==f&&-1!==y)break}if(e&&!this.m_bNeedsNonSimpleResult)break;if(this.m_sweepComparator.setSweepY(d.y,d.x),!p){for(let e=0,t=l.length;e<t;e++){const t=l[e];this.m_sweepStructure.deleteNode(t)}l.length=0}if(!p&&-1!==f&&-1!==y&&this.checkForIntersections_(f,y)){e=!0,this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult());break}for(let t=0,s=c.length;t<s;t+=2){const s=c[t],n=c[t+1];let i;if(p?(i=this.m_sweepStructure.replaceElementAtPosition(l[0],s,!0,!0),l.length=0,p=!1):i=this.m_sweepStructure.addElement(s),this.m_sweepComparator.intersectionDetected()){this.m_bNeedsNonSimpleResult&&(this.m_nonSimpleResult=this.m_sweepComparator.getResult()),e=!0;break}-1===this.m_shape.getUserIndex(n,a)?this.m_shape.setUserIndex(n,a,i):this.m_shape.setUserIndex(n,m,i)}if(e)break;c.length=0}return this.m_shape.removeUserIndex(a),this.m_shape.removeUserIndex(m),e}checkForIntersections_(e,t){const s=this.m_sweepStructure.getElement(e);this.m_sweepComparator.compare(this.m_sweepStructure,s,t);const n=this.m_sweepComparator.intersectionDetected();return this.m_sweepComparator.clearIntersectionDetectedFlag(),n}getSegment_(e,t){return ve.st_getSegment(this.m_shape,e,t)}static st_getSegment(e,t,s){return e.querySegment(t,s,!1,!1)?s.get():null}dbgPrintSweepEdge(e){}dbgPrintSweepStructure(){}dbgSaveSweepStructure(e=null){}dbgCheckSweepStructure(){}progress_(e=!1){this.m_progressCounter++}crackAWithBMultiPath_(e,o,a){const m=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(m);const h=t.Envelope2D.constructEmpty();if(o.queryLooseEnvelope(h),h.inflateCoords(a,a),!h.isIntersecting(m))return e;const l=e.getImpl(),u=l.getAccelerators();let c=null,g=null;u&&(g=u.getQuadTree()),function(e,t){const s=e.getPointCount();return!(s<16)&&2*s+Math.log(s)/Math.log(2)*1*t<1*s*t}(e,s.vertexCount(o))&&(c=i.buildQuadTree(l,h),g=c);const d=g?g.getIteratorForQT():null,p=o.querySegmentIterator(),_=e.querySegmentIterator(),f=r.makePrimitiveArray(15,Number.NaN),y=[];for(;p.nextPath();)for(;p.hasNextSegment();){const e=p.nextSegment();if(g){d.resetIterator(e,a);for(let t=d.next();-1!==t;t=d.next()){this.progress_();const s=g.getElement(t);if(_.resetToVertex(s,-1),_.hasNextSegment()){const t=_.nextSegment().intersect(e,null,f,null,a);for(let e=0;e<t;e++){const t=f[e];if(0===t||1===t)continue;const s=Ee(t,_.getStartPointIndex());y.push(s)}}}}else{const s=t.Envelope2D.constructEmpty();if(e.queryLooseEnvelope(s),s.inflateCoords(a,a),!m.isIntersecting(s))continue;for(_.resetToFirstPath();_.nextPath();)for(;_.hasNextSegment();){const n=_.nextSegment(),i=t.Envelope2D.constructEmpty();if(n.queryLooseEnvelope(i),!i.isIntersecting(s))continue;const r=n.intersect(e,null,f,null,a);for(let e=0;e<r;e++){const t=f[e];if(0===t||1===t)continue;const s=Ee(t,_.getStartPointIndex());y.push(s)}}}}if(0===y.length)return e;y.sort((e,t)=>e.index<t.index?-1:e.index>t.index?1:e.t<t.t?-1:e.t>t.t?1:0);const x=e.createInstance();for(x.getGeometryType()===s.GeometryType.enumPolygon&&x.setFillRule(e.getFillRule()),_.resetToFirstPath();_.nextPath()&&!_.hasNextSegment(););s.geometryReleaseAssert(_.hasNextSegment());let P=_.nextSegment();const E=new n.SegmentBuffer;let v=-1;for(let e=0,t=y.length;e<t;){const n=y[e].index;let i=e+1;for(;i<t&&y[i].index===n;)++i;for(;_.getStartPointIndex()<n;){this.progress_();const e=_.hasNextSegment(),t=_.getPathIndex();if((e||!_.isClosingSegment()||_.isCurve())&&(s.geometryReleaseAssert(null!==P),x.addSegment(P,v!==t)),v=t,!e){for(_.isPathClosed();_.nextPath()&&!_.hasNextSegment(););s.geometryReleaseAssert(_.hasNextSegment())}P=_.nextSegment()}let r=0;for(let t=e;t<i;t++){const e=y[t].t;if(e===r)continue;s.geometryReleaseAssert(null!==P),P.queryCut(r,e,E),r=e;const n=_.getPathIndex();x.addSegment(E.get(),v!==n),v=n}const o=_.hasNextSegment();if((o||!_.isClosingSegment()||_.isCurve())&&(s.geometryReleaseAssert(null!=P),P.queryCut(r,1,E),x.addSegment(E.get(),!1)),o)P=_.nextSegment();else{for(;_.nextPath()&&!_.hasNextSegment(););P=_.hasNextSegment()?_.nextSegment():null}e=i}if(null!==P){const e=_.getPathIndex();(_.hasNextSegment()||!_.isClosingSegment()||_.isCurve())&&x.addSegment(P,v!==e),v=e}let C=_.hasNextSegment();for(;;){if(!C){for(;_.nextPath()&&(C=_.hasNextSegment(),!C););if(!C)break}P=_.nextSegment();const e=_.getPathIndex();C=_.hasNextSegment(),(C||!_.isClosingSegment()||_.isCurve())&&x.addSegment(P,v!==e),v=e}return x}constructor(e){this.m_shape=null,this.m_progressTracker=null,this.m_nonSimpleResult=new u.NonSimpleResult,this.m_tolerance=0,this.m_sweepComparator=null,this.m_progressCounter=0,this.m_bTrackChanges=!1,this.m_bNeedsNonSimpleResult=!1,this.m_bAllowCoincident=!0,this.m_sweepStructure=new i.Treap,this.m_progressTracker=e}}ve.s_bForceBruteForce=!0;class Ce{constructor(e,t){this.m_monotoneParts=r.makeObjectArray(n.SegmentBuffer,16),this.m_xOrds=r.makePrimitiveArray(16,Number.NaN),this.m_inputPoint=r.Point2D.getNAN(),this.m_miny=0,this.m_maxy=0,this.m_windnum=0,this.m_bAlternate=e,this.m_tolerance=t,this.m_toleranceSqr=t*t,this.m_bTestBorder=!!t,this.m_bBreak=!1}_DoOne(e){if(!this.m_bTestBorder&&(this.m_bAlternate&&this.m_inputPoint.equals(e.getStartXY())||this.m_inputPoint.equals(e.getEndXY())))return void(this.m_bBreak=!0);if(e.getStartY()===this.m_inputPoint.y&&e.getStartY()===e.getEndY()){if(this.m_bAlternate&&!this.m_bTestBorder){const t=Math.min(e.getStartX(),e.getEndX()),s=Math.max(e.getStartX(),e.getEndX());this.m_inputPoint.x>t&&this.m_inputPoint.x<s&&(this.m_bBreak=!0)}return}let t=!1;const s=Math.max(e.getStartX(),e.getEndX());if(this.m_inputPoint.x>s)t=!0;else if(this.m_inputPoint.x>=Math.min(e.getStartX(),e.getEndX())){const n=e.intersectionOfYMonotonicWithAxisX(this.m_inputPoint.y,s);t=!Number.isNaN(n)&&n<=this.m_inputPoint.x}if(t){if(this.m_inputPoint.y===e.getStartY()){if(this.m_inputPoint.y<e.getEndY())return}else if(this.m_inputPoint.y===e.getEndY()&&this.m_inputPoint.y<e.getStartY())return;this.m_bAlternate?this.m_windnum^=1:this.m_windnum+=e.getStartY()>e.getEndY()?1:-1}}_Result(){return!!this.m_windnum}testBorder(e){const t=e.getClosestCoordinate(this.m_inputPoint,!1),s=e.getCoord2D(t);return r.Point2D.sqrDistance(s,this.m_inputPoint)<=this.m_toleranceSqr}setInputPoint(e){this.m_inputPoint.setCoordsPoint2D(e),this.m_miny=e.y-this.m_tolerance,this.m_maxy=e.y+this.m_tolerance}processSegment(e){const t=e.queryInterval(0,1);if(t.vmin>this.m_maxy||t.vmax<this.m_miny)return!1;if(this.m_bTestBorder&&this.testBorder(e))return!0;if(t.vmin>this.m_inputPoint.y||t.vmax<this.m_inputPoint.y)return!1;let n=0;if(e.isCurve()&&(0===this.m_monotoneParts.length&&(this.m_monotoneParts.length=128),n=e.getMonotonicParts(this.m_monotoneParts,!0),s.geometryReleaseAssert(this.m_monotoneParts.length>=n)),n>0)for(let e=0;e<n;e++){const t=this.m_monotoneParts[e].get(),s=r.Envelope1D.construct(t.getStartY(),t.getEndY());if(!(s.vmin>this.m_inputPoint.y||s.vmax<this.m_inputPoint.y)&&(this._DoOne(t),this.m_bBreak))return!0}else if(this._DoOne(e),this.m_bBreak)return!0;return!1}result(){return s.geometryReleaseAssert(0),2}}function De(e,n,i){if(e.isEmpty())return 0;const r=t.Envelope2D.constructEmpty();if(e.queryLooseEnvelope(r),r.inflateCoords(i,i),!r.contains(n))return 0;const o=e.getImpl().getAccelerators();if(o){o.getRasterizedGeometry()&&s.geometryReleaseAssert(0);const r=o.getQuadTree();if(r)return function(e,s,n,i){const r=new t.Envelope2D;e.queryLooseEnvelope(r),r.inflateCoords(i,i);const o=0===e.getFillRule(),a=new Ce(o,i);a.setInputPoint(n);const m=r.clone();m.xmax=n.x+i,m.ymin=n.y-i,m.ymax=n.y+i;const h=e.getImpl().querySegmentIterator(),l=s.getIterator(m,i);for(let e=l.next();-1!==e;e=l.next())if(h.resetToVertex(s.getElement(e),-1),h.hasNextSegment()){const e=h.nextSegment();if(a.processSegment(e))return-1}return a._Result()?1:0}(e,r,n,i)}return function(e,t,s){const n=0===e.getFillRule(),i=new Ce(n,s);i.setInputPoint(t);const r=e.getImpl().querySegmentIterator();for(;r.nextPath();)for(;r.hasNextSegment();){const e=r.nextSegment();if(i.processSegment(e))return-1}return i._Result()?1:0}(e,n,i)}function be(e,t){const s=e.getPointCount();return!(s<16)&&2*s+Math.log(s)/Math.log(2)*1*t<1*s*t}class Se{getDirection_(e){return this.m_shape.getNextVertex(this.getEnd1(e))===this.getEnd2(e)}getEnd_(e){const t=this.getEnd1(e),s=this.getEnd2(e);return this.m_shape.getNextVertex(t)===s?s:t}constructor(e){this.m_end1Nodes=[],this.m_end2Nodes=[],this.m_directions=[],this.m_shape=e,this.m_firstFree=-1}getSegment(e){return this.m_shape.getSegment(this.getStart(e))}isBottomUp(e){let t=this.getEnd1(e),n=this.getEnd2(e);this.m_shape.getPrevVertex(t)===n&&(n=r.swap(t,t=n));const i=r.Point2D.getNAN(),o=r.Point2D.getNAN();return this.m_shape.queryXY(t,i),this.m_shape.queryXY(n,o),s.geometryReleaseAssert(!i.equals(o)),i.y<o.y}getStart(e){const t=this.getEnd1(e),s=this.getEnd2(e);return this.m_shape.getNextVertex(t)===s?t:s}getEnd1(e){return this.m_end1Nodes[e]}getEnd2(e){return this.m_end2Nodes[e]}freeEdge(e){this.m_end1Nodes[e]=this.m_firstFree,this.m_firstFree=e}newEdge(e){if(-1!==this.m_firstFree){const t=this.m_firstFree;return this.m_firstFree=this.m_end1Nodes[t],this.m_end1Nodes[t]=e,this.m_end2Nodes[t]=this.m_shape.getNextVertex(e),t}const t=this.m_end1Nodes.length;return this.m_end1Nodes.push(e),this.m_end2Nodes.push(this.m_shape.getNextVertex(e)),t}getShape(){return this.m_shape}getPath(e){return this.m_shape.getPathFromVertex(this.getEnd1(e))}}let Ie=class extends i.Comparator{constructor(e){super(),this.m_line1=new n.Line,this.m_line2=new n.Line,this.m_leftElm=-1,this.m_leftx=0,this.m_seg1=null,this.m_helper=e}compare(e,t,n){const i=e.getElement(n),r=this.m_helper.m_edges;let o;this.m_leftElm===t?o=this.m_leftx:(this.m_seg1=r.getSegment(t),this.m_seg1?o=this.m_seg1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(r.getShape().queryLineConnector(r.getStart(t),this.m_line1,!0),this.m_seg1=this.m_line1,o=this.m_line1.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),this.m_leftx=o,this.m_leftElm=t);let a,m=r.getSegment(i);if(m?a=m.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0):(r.getShape().queryLineConnector(r.getStart(i),this.m_line2,!0),m=this.m_line2,a=this.m_line2.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0)),o===a){const e=r.isBottomUp(t),n=r.isBottomUp(i),h=e?this.m_seg1.getEndY():this.m_seg1.getStartY(),l=n?m.getEndY():m.getStartY(),u=Math.min(h,l);let c=.5*(u+this.m_helper.m_yScanline);c===this.m_helper.m_yScanline&&(c=u),o=this.m_seg1.intersectionOfYMonotonicWithAxisX(c,0),a=m.intersectionOfYMonotonicWithAxisX(c,0),o===a&&s.throwNonSimpleGeometryException("")}return o<a?-1:o>a?1:0}reset(){this.m_leftElm=-1}};class we{constructor(e){this.m_node=-1,this.m_index=0,this.m_sortedVertices=e.m_sortedVertices,this.m_sortedVerticesArray=e.m_sortedVerticesArray,this.m_sortedVertices&&(this.m_node=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList()))}next(){if(this.m_sortedVertices){const e=this.m_node;if(-1===e)return n.nullHandle;const t=this.m_sortedVertices.getData(e);return this.m_node=this.m_sortedVertices.getNext(e),t}if(this.m_index<this.m_sortedVerticesArray.size()){const e=this.m_sortedVerticesArray.read(this.m_index);return this.m_index++,e}return n.nullHandle}}class Te{constructor(e){this.m_edges=null,this.m_shape=null,this.m_AET=new i.Treap,this.m_yScanline=0,this.m_geometry=n.nullHandle,this.m_unknownRingOrientationCount=-1,this.m_sortedVertices=null,this.m_sortedVerticesArray=null,this.m_unknownNodes=[],this.m_node1UserIndex=-1,this.m_node2UserIndex=-1,this.m_pathOrientationIndex=-1,this.m_pathParentageIndex=-1,this.m_pathParentsIndex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_progressTracker=e,this.m_AET.disableBalancing(),this.m_sweepComparator=new Ie(this),this.m_AET.setComparator(this.m_sweepComparator)}fixRingOrientation_(){const e=this.fixRingOrientationImplMain_();return-1===this.m_pathOrientationIndex||this.fixRingOrientationImplSimplify_(),e}fixRingOrientationForMp2sp_(){return this.fixRingOrientationImplMain_(),-1===this.m_pathOrientationIndex?-1:this.fixRingOrientationImplMp2sp_()}processBunchForRingOrientationTest_(e){return this.processBunchForRingOrientationTestOddEven_(e)}processBunchForRingOrientationTestOddEven_(e){let t=!1;if(this.m_edges||(this.m_edges=new Se(this.m_shape)),this.m_unknownNodes.length=0,this.processBunchForRingOrientationRemoveEdges_(e),!this.m_AET.isAutoBalancing()){let t=0;for(let s=0,n=e.length;s<n;s++)-1!==e[s]&&t++;(t>10||this.m_AET.getMaxDepthEver()>4)&&this.m_AET.enableBalancing()}for(let t=0,s=e.length;t<s;t++){const s=e[t];s!==n.nullHandle&&this.insertEdge_(s,-1)}for(let e=0;e<this.m_unknownNodes.length&&this.m_unknownRingOrientationCount>0;e++){const r=this.m_unknownNodes[e],o=this.m_AET.getElement(r),a=this.m_edges.getPath(o),m=this.m_shape.getPathUserIndex(a,this.m_pathOrientationIndex);let h=n.nullHandle;if(0===m){let e=this.m_AET.getPrev(r),n=r,o=!1;for(;e!==i.Treap.st_nullNode();){const t=this.m_AET.getElement(e),s=this.m_edges.getPath(t);if(0!==this.m_shape.getPathUserIndex(s,this.m_pathOrientationIndex)){h=s;break}n=e,e=this.m_AET.getPrev(e)}if(e===i.Treap.st_nullNode())o=!0,e=n;else{const t=this.m_AET.getElement(e);o=this.m_edges.isBottomUp(t),e=this.m_AET.getNext(e),o=!o}do{const i=this.m_AET.getElement(e),r=this.m_edges.getPath(i);if(0===this.m_shape.getPathUserIndex(r,this.m_pathOrientationIndex)){if(o!==this.m_edges.isBottomUp(i)){const e=this.m_shape.getFirstVertex(r);this.m_shape.reverseRingInternal(e),this.m_shape.setLastVertex(r,this.m_shape.getPrevVertex(e)),t=!0}if(this.m_shape.setPathUserIndex(r,this.m_pathOrientationIndex,o?3:2),!o){let e=this.m_shape.getPathUserIndex(h,this.m_pathOrientationIndex);2===e?(h=this.m_shape.getPathUserIndex(h,this.m_pathParentsIndex),e=this.m_shape.getPathUserIndex(h,this.m_pathOrientationIndex),s.geometryReleaseAssert(3===e)):s.geometryReleaseAssert(3===e);const t=this.m_shape.getPathUserIndex(h,this.m_pathParentageIndex);this.m_shape.setPathUserIndex(h,this.m_pathParentageIndex,r),this.m_shape.setPathUserIndex(r,this.m_pathParentageIndex,t),this.m_shape.setPathUserIndex(r,this.m_pathParentsIndex,h)}if(this.m_unknownRingOrientationCount--,!this.m_unknownRingOrientationCount)return t}h=r,n=e,e=this.m_AET.getNext(e),o=!o}while(n!==r)}}return t}processBunchForRingOrientationRemoveEdges_(e){for(let t=0,s=e.length;t<s;t++){const s=e[t],i=this.m_shape.getUserIndex(s,this.m_node1UserIndex),r=this.m_shape.getUserIndex(s,this.m_node2UserIndex);if(-1!==i){const e=this.m_AET.getElement(i);this.m_edges.freeEdge(e),this.m_shape.setUserIndex(s,this.m_node1UserIndex,-1)}if(-1!==r){const e=this.m_AET.getElement(r);this.m_edges.freeEdge(e),this.m_shape.setUserIndex(s,this.m_node2UserIndex,-1)}let o=-1;-1!==i&&-1!==r?(this.m_AET.deleteNode(i),this.m_AET.deleteNode(r),e[t]=n.nullHandle):o=-1!==i?i:r,-1!==o&&(this.insertEdge_(s,o)||this.m_AET.deleteNode(o),e[t]=n.nullHandle)}}dbgVerifyRingOrientation_(){}insertEdge_(e,t){const s=r.Point2D.getNAN(),n=r.Point2D.getNAN();this.m_shape.queryXY(e,s);const i=this.m_shape.getNextVertex(e);this.m_shape.queryXY(i,n);let o=!1;if(s.y<n.y){o=!0;const s=this.m_edges.newEdge(e);let n;-1===t?n=this.m_AET.addElement(s):(n=t,this.m_AET.setElement(n,s)),-1===this.m_shape.getUserIndex(i,this.m_node1UserIndex)?this.m_shape.setUserIndex(i,this.m_node1UserIndex,n):this.m_shape.setUserIndex(i,this.m_node2UserIndex,n);const r=this.m_shape.getPathFromVertex(e);0===this.m_shape.getPathUserIndex(r,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(n)}const a=this.m_shape.getPrevVertex(e);if(this.m_shape.queryXY(a,n),s.y<n.y){o=!0;const s=this.m_edges.newEdge(a);let n;-1===t?n=this.m_AET.addElement(s):(n=t,this.m_AET.setElement(n,s)),-1===this.m_shape.getUserIndex(a,this.m_node1UserIndex)?this.m_shape.setUserIndex(a,this.m_node1UserIndex,n):this.m_shape.setUserIndex(a,this.m_node2UserIndex,n);const i=this.m_shape.getPathFromVertex(e);0===this.m_shape.getPathUserIndex(i,this.m_pathOrientationIndex)&&this.m_unknownNodes.push(n)}return o}fixRingSelfTangency_(){const e=[],t=[];let i=-1,o=-1;const a=new r.Point2D;let m=n.nullHandle,h=n.nullHandle,l=-1;const u=new we(this);for(let s=u.next();s!==n.nullHandle;s=u.next()){const n=new r.Point2D;this.m_shape.queryXY(s,n);const u=this.m_shape.getPathFromVertex(s);a.equals(n)&&h===u?(-1===o&&(i=this.m_shape.createPathUserIndex(),this.m_shape.fillPathUserIndexForGeometry(this.m_geometry,i,-1),o=this.m_shape.createUserIndex(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,o,-1)),-1===l&&(l=t.length,this.m_shape.setUserIndex(m,o,l),t.push(1),-1===this.m_shape.getPathUserIndex(u,i)&&(this.m_shape.setPathUserIndex(u,i,m),e.push(u))),this.m_shape.setUserIndex(s,o,l),t[t.length-1]++):(l=-1,a.assign(n)),m=s,h=u}if(0===e.length)return!1;s.geometryReleaseAssert(-1!==i);for(let s=0,n=e.length;s<n;s++){const n=e[s];let r=this.m_shape.getPathUserIndex(n,i);const a=this.m_shape.getUserIndex(r,o),m=[],h=[];m.push(r),h.push(a);for(let e=this.m_shape.getNextVertex(r);e!==r;e=this.m_shape.getNextVertex(e)){const s=e,n=this.m_shape.getUserIndex(s,o);if(-1!==n){if(0===h.length){h.push(n),m.push(s);continue}if(h.at(-1)===n){const i=m.at(-1);this.m_shape.peelALoopIntoAPath(i,s),this.m_shape.setUserIndex(e,o,-1),t[n]--,1===t[n]&&(t[n]=0,h.pop(),m.pop()),r=i,e=i}else m.push(e),h.push(n)}}}return this.m_shape.removePathUserIndex(i),this.m_shape.removeUserIndex(o),this.m_shape.dbgVerifyVertexCounts(),!0}progress_(e=!1){}fixRingOrientationImplMain_(){const e={stack:[],error:void 0,hasError:!1};try{let t,s=!1;const a=o.__addDisposableResource(e,r.makeScopedCall(()=>{this.m_sortedVerticesArray=null}),!1);if(null===this.m_sortedVertices){const e=this.m_shape.getPointCount(this.m_geometry);t=new i.AttributeStreamOfInt32(0);for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==n.nullHandle;e=this.m_shape.getNextPath(e)){let s=this.m_shape.getFirstVertex(e);for(let n=0,i=this.m_shape.getPathSize(e);n<i;n++)t.add(s),s=this.m_shape.getNextVertex(s)}this.m_shape.sortVerticesSimpleByY(t,0,e),this.progress_(!0),this.m_sortedVerticesArray=t}else a.bForget=!0;if(this.m_bFixSelfTangency&&(s=this.fixRingSelfTangency_()),1===this.m_shape.getPathCount(this.m_geometry)){const e=this.m_shape.getFirstPath(this.m_geometry),t=this.m_shape.getRingArea(e);if(this.m_shape.setExterior(e,!0),t<0){const t=this.m_shape.getFirstVertex(e);return this.m_shape.reverseRingInternal(t),this.m_shape.setLastVertex(e,this.m_shape.getPrevVertex(t)),!0}return!1}this.m_shape.dbgVerifyCurves(),this.m_pathOrientationIndex=this.m_shape.createPathUserIndex(),this.m_pathParentageIndex=this.m_shape.createPathUserIndex(),this.m_pathParentsIndex=this.m_shape.createPathUserIndex();for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==n.nullHandle;e=this.m_shape.getNextPath(e))this.m_shape.setPathUserIndex(e,this.m_pathOrientationIndex,0),this.m_shape.setPathUserIndex(e,this.m_pathParentageIndex,-1),this.m_shape.setPathUserIndex(e,this.m_pathParentsIndex,-1);const m=[];this.m_yScanline=Number.NaN;const h=r.Point2D.getNAN();this.m_unknownRingOrientationCount=this.m_shape.getPathCount(this.m_geometry),this.m_node1UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node1UserIndex,-1),this.m_node2UserIndex=this.m_shape.createUserIndexUninitialized(),this.m_shape.fillUserIndexForGeometry(this.m_geometry,this.m_node2UserIndex,-1);const l=new we(this);for(let e=l.next();e!==n.nullHandle&&(this.progress_(),this.m_shape.queryXY(e,h),h.y!==this.m_yScanline&&m.length&&(s=this.processBunchForRingOrientationTest_(m)||s,this.m_sweepComparator.reset(),m.length=0),m.push(e),this.m_yScanline=h.y,0!==this.m_unknownRingOrientationCount);e=l.next());return this.m_unknownRingOrientationCount>0&&(s=this.processBunchForRingOrientationTest_(m)||s,m.length=0),this.m_shape.removeUserIndex(this.m_node1UserIndex),this.m_shape.removeUserIndex(this.m_node2UserIndex),this.dbgVerifyRingOrientation_(),s}catch(t){e.error=t,e.hasError=!0}finally{o.__disposeResources(e)}}fixRingOrientationImplSimplify_(){const e=[];for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==n.nullHandle;)if(this.progress_(),3===this.m_shape.getPathUserIndex(t,this.m_pathOrientationIndex)){this.m_shape.setExterior(t,!0);for(let s=this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex);s!==n.nullHandle;){const n=this.m_shape.getPathUserIndex(s,this.m_pathParentageIndex);e.push(s),this.m_shape.setExterior(s,!1),this.m_shape.setPathUserIndex(s,this.m_pathParentageIndex,t),s=n}let s=t,r=e.length;for(let e=this.m_shape.getNextPath(t);r>0&&e!==n.nullHandle;e=this.m_shape.getNextPath(e),--r){if(this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex)!==t){s=n.nullHandle;break}s=e}if(0!==r){s=t;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.m_shape.setPathUserIndex(n,this.m_pathParentageIndex,i.c_deadBeef),this.m_shape.movePath(this.m_geometry,this.m_shape.getNextPath(s),n),s=n}}e.length=0,t=this.m_shape.getNextPath(s)}else t=this.m_shape.getNextPath(t);this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex)}fixRingOrientationImplMp2sp_(){const e=this.m_shape.createPathUserIndex();let t=0;const s=[];for(let r=this.m_shape.getFirstPath(this.m_geometry);r!==n.nullHandle;)if(this.progress_(),3===this.m_shape.getPathUserIndex(r,this.m_pathOrientationIndex)){this.m_shape.setExterior(r,!0),this.m_shape.setPathUserIndex(r,e,t),t++;for(let e=this.m_shape.getPathUserIndex(r,this.m_pathParentageIndex);e!==n.nullHandle;){const t=this.m_shape.getPathUserIndex(e,this.m_pathParentageIndex);s.push(e),this.m_shape.setExterior(e,!1),this.m_shape.setPathUserIndex(e,this.m_pathParentageIndex,r),e=t}let o=r,a=s.length,m=t;for(let t=this.m_shape.getNextPath(r);a>0&&t!==n.nullHandle;t=this.m_shape.getNextPath(t),--a){if(this.m_shape.getPathUserIndex(t,this.m_pathParentageIndex)!==r){o=n.nullHandle;break}o=t,this.m_shape.setPathUserIndex(t,e,-m),m++}if(0!==a){o=r,m=t;for(let t=0,n=s.length;t<n;t++){const n=s[t];this.m_shape.setPathUserIndex(n,e,-m),m++,this.m_shape.setPathUserIndex(n,this.m_pathParentageIndex,i.c_deadBeef)}o=r}t=m,s.length=0,r=this.m_shape.getNextPath(o)}else r=this.m_shape.getNextPath(r);return this.m_shape.removePathUserIndex(this.m_pathOrientationIndex),this.m_shape.removePathUserIndex(this.m_pathParentageIndex),this.m_shape.removePathUserIndex(this.m_pathParentsIndex),e}}function Ae(e,t,s,n,i,r){const o=new Ne(r);return o.m_shape=e,o.m_geometry=t,o.m_knownSimpleResult=s,o.m_bFixSelfTangency=n,o.m_polylineDegeneracies=i,o.m_bHasSegmentParentage=e.hasSegmentParentage(),o.m_bHasSegments=e.hasCurves(),o.simplify_()}class Ne{constructor(e){this.m_shape=null,this.m_geometry=n.nullHandle,this.m_sortedVertices=new i.IndexMultiDCList,this.m_bunchEdgeEndPoints=[],this.m_bunchEdgeCenterPoints=[],this.m_bunchEdgeIndices=[],this.m_sorterSegmentBuffer1=null,this.m_sorterSegmentBuffer2=null,this.m_knownSimpleResult=-1,this.m_sortedVerticesListIndex=-1,this.m_polylineDegeneracies=n.nullHandle,this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=-1,this.m_progressCounter=0,this.m_bFixSelfTangency=!1,this.m_bHasSegmentParentage=!1,this.m_bHasSegments=!1,this.m_progressTracker=e}compareAngles_(e,t){return this.m_bHasSegments?this.compareAnglesCurves_(e,t):this.compareAnglesLines_(e,t)}compareAnglesLines_(e,t){const n=this.m_bunchEdgeEndPoints[e],i=new r.Point2D;this.m_shape.queryXY(n,i);const o=new r.Point2D,a=this.m_bunchEdgeEndPoints[t];if(this.m_shape.queryXY(a,o),i.equals(o))return 0;const m=this.m_bunchEdgeCenterPoints[e],h=new r.Point2D;this.m_shape.queryXY(m,h);const l=this.m_bunchEdgeCenterPoints[t],u=new r.Point2D;this.m_shape.queryXY(l,u);const c=new r.Point2D;c.setSub(i,h);const g=new r.Point2D;return g.setSub(o,u),(c.isZero()||g.isZero())&&s.throwNonSimpleGeometryException(""),r.Point2D.compareVectors(c,g)}compareAnglesCurves_(e,t){const s=this.m_bunchEdgeEndPoints[e],i=this.m_bunchEdgeEndPoints[t],r=this.m_bunchEdgeCenterPoints[e],o=this.m_bunchEdgeCenterPoints[t],a=this.m_shape.getNextVertex(r)===s,m=this.m_shape.getNextVertex(o)===i,h=a?this.m_shape.isCurve(r):this.m_shape.isCurve(s),l=m?this.m_shape.isCurve(o):this.m_shape.isCurve(i);return h||l?(this.m_sorterSegmentBuffer1||(this.m_sorterSegmentBuffer1=new n.SegmentBuffer),this.m_sorterSegmentBuffer2||(this.m_sorterSegmentBuffer2=new n.SegmentBuffer),a?this.m_shape.querySegment(r,this.m_sorterSegmentBuffer1,!1,!0):(this.m_shape.querySegment(s,this.m_sorterSegmentBuffer1,!1,!0),this.m_sorterSegmentBuffer1.get().reverse()),m?this.m_shape.querySegment(o,this.m_sorterSegmentBuffer2,!1,!0):(this.m_shape.querySegment(i,this.m_sorterSegmentBuffer2,!1,!0),this.m_sorterSegmentBuffer2.get().reverse()),n.compareConnectedSegments(this.m_sorterSegmentBuffer1.get(),this.m_sorterSegmentBuffer2.get())):this.compareAnglesLines_(e,t)}beforeRemoveVertex_(e,t){const s=this.m_shape.getUserIndex(e,this.m_userIndexSortedIndexToVertex);if(this.m_nextVertexToProcess===s&&(this.m_nextVertexToProcess=this.m_sortedVertices.getNext(this.m_nextVertexToProcess)),this.m_firstCoincidentVertex===s&&(this.m_firstCoincidentVertex=this.m_sortedVertices.getNext(this.m_firstCoincidentVertex)),this.m_sortedVertices.deleteElement(this.m_sortedVerticesListIndex,s),this.removeAngleSortInfo_(e),t){const t=this.m_shape.getPathFromVertex(e);if(t!==n.nullHandle&&this.m_shape.getFirstVertex(t)===e){const s=this.m_shape.getNextVertex(e);if(s!==e){if(this.m_shape.getPathFromVertex(s)===t)return void this.m_shape.setFirstVertex(t,s);{const s=this.m_shape.getPrevVertex(e);if(s!==e&&this.m_shape.getPathFromVertex(s)===t)return void this.m_shape.setFirstVertex(t,s)}}this.m_shape.setFirstVertex(t,n.nullHandle),this.m_shape.setLastVertex(t,n.nullHandle)}}}processBunch_(){let e=!1;const t=new r.Point2D(0,0);for(;;){this.m_bunchEdgeEndPoints.length=0,this.m_bunchEdgeCenterPoints.length=0,this.m_bunchEdgeIndices.length=0;let s=this.m_firstCoincidentVertex,n=0,r=!0;for(;s!==this.m_nextVertexToProcess;){const e=this.m_sortedVertices.getData(s);r&&(this.m_shape.queryXY(e,t),r=!1);const o=this.m_shape.getPrevVertex(e),a=this.m_shape.getNextVertex(e);this.m_shape.getUserIndex(o,this.m_userIndexSortedAngleIndexToVertex)!==i.c_deadBeef&&(this.m_bunchEdgeEndPoints.push(o),this.m_shape.setUserIndex(o,this.m_userIndexSortedAngleIndexToVertex,i.c_deadBeef),this.m_bunchEdgeCenterPoints.push(e),this.m_bunchEdgeIndices.push(n++)),this.m_shape.getUserIndex(a,this.m_userIndexSortedAngleIndexToVertex)!==i.c_deadBeef&&(this.m_bunchEdgeEndPoints.push(a),this.m_shape.setUserIndex(a,this.m_userIndexSortedAngleIndexToVertex,i.c_deadBeef),this.m_bunchEdgeCenterPoints.push(e),this.m_bunchEdgeIndices.push(n++)),s=this.m_sortedVertices.getNext(s)}if(this.m_bunchEdgeEndPoints.length<2){1===this.m_bunchEdgeEndPoints.length&&this.m_shape.setUserIndex(this.m_bunchEdgeEndPoints[0],this.m_userIndexSortedAngleIndexToVertex,-1);break}this.m_bunchEdgeIndices.sort((e,t)=>this.compareAngles_(e,t));for(let e=0,t=this.m_bunchEdgeIndices.length;e<t;e++){const t=this.m_bunchEdgeIndices[e],s=this.m_bunchEdgeEndPoints[t];this.m_shape.setUserIndex(s,this.m_userIndexSortedAngleIndexToVertex,e)}const o=this.processCrossOvers_(t);for(let e=0,t=this.m_bunchEdgeIndices.length;e<t;e++){const t=this.m_bunchEdgeIndices[e];if(-1===t)continue;const s=this.m_bunchEdgeEndPoints[t];this.m_shape.setUserIndex(s,this.m_userIndexSortedAngleIndexToVertex,-1)}if(!o)break;e=!0}return e}processCrossOvers_(e){let t=!1,s=!0;for(;s;){s=!1;let n=0;-1===this.m_bunchEdgeIndices[n]&&(n=this.getNextEdgeIndex_(n));let i=this.getNextEdgeIndex_(n);for(let r=0,o=this.m_bunchEdgeIndices.length;r<o&&-1!==n&&-1!==i&&n!==i;r++){const r=this.m_bunchEdgeIndices[n],o=this.m_bunchEdgeIndices[i],a=this.m_bunchEdgeEndPoints[r],m=this.m_bunchEdgeEndPoints[o];let h=this.m_shape.getNextVertex(a),l=!1;this.m_shape.isEqualXYPoint2D(h,e)||(h=this.m_shape.getPrevVertex(a),l=!0);let u=this.m_shape.getNextVertex(m),c=!1;this.m_shape.isEqualXYPoint2D(u,e)||(u=this.m_shape.getPrevVertex(m),c=!0);const g=l?this.m_shape.getPrevVertex(h):this.m_shape.getNextVertex(h),d=c?this.m_shape.getPrevVertex(u):this.m_shape.getNextVertex(u);let p=!1;(this.removeSpike_(h)||this.removeSpike_(u)||this.removeSpike_(a)||this.removeSpike_(m)||this.removeSpike_(g)||this.removeSpike_(d))&&(p=!0),h!==u&&(!p&&this.m_shape.isEqualXY(a,m)&&(p=this.resolveOverlap_(l,c,h,a,u,m)),!p&&this.m_shape.isEqualXY(g,d)&&(p=this.resolveOverlap_(!l,!c,h,g,u,d)),!p&&this.m_shape.isEqualXY(a,d)&&(p=this.resolveOverlap_(l,!c,h,a,u,d)),!p&&this.m_shape.isEqualXY(g,m)&&(p=this.resolveOverlap_(!l,c,h,g,u,m))),p&&(t=!0),s||=p,n=p?this.getNextEdgeIndex_(n):i,i=this.getNextEdgeIndex_(n)}}if(!t){let s=0;-1===this.m_bunchEdgeIndices[s]&&(s=this.getNextEdgeIndex_(s));let n=this.getNextEdgeIndex_(s);for(let i=0,r=this.m_bunchEdgeIndices.length;i<r&&-1!==s&&-1!==n&&s!==n;i++){const i=this.m_bunchEdgeIndices[s],r=this.m_bunchEdgeIndices[n],o=this.m_bunchEdgeEndPoints[i],a=this.m_bunchEdgeEndPoints[r];let m=this.m_shape.getNextVertex(o);this.m_shape.isEqualXYPoint2D(m,e)||(m=this.m_shape.getPrevVertex(o));let h=this.m_shape.getNextVertex(a);this.m_shape.isEqualXYPoint2D(h,e)||(h=this.m_shape.getPrevVertex(a));const l=this.getDirection_(m,o),u=this.getDirection_(h,a),c=l?this.m_shape.getPrevVertex(m):this.m_shape.getNextVertex(m),g=u?this.m_shape.getPrevVertex(h):this.m_shape.getNextVertex(h),d=this.detectAndResolveCrossOver_(l,u,o,m,c,a,h,g);1!==d?0===d?(s=this.getNextEdgeIndex_(s),n=this.getNextEdgeIndex_(s)):(s=this.getPrevEdgeIndex_(s),n=this.getNextEdgeIndex_(s)):t=!0}}return t}simplify_(){this.m_shape.getGeometryType(this.m_geometry)===s.GeometryType.enumPolygon&&1===this.m_shape.getFillRule(this.m_geometry)&&new Is(this.m_progressTracker).planarSimplifyNoCrackingAndCluster(this.m_bFixSelfTangency,this.m_shape,this.m_geometry,0);let e=!1;this.m_userIndexSortedIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=-1,this.m_userIndexSortedAngleIndexToVertex=this.m_shape.createUserIndexUninitialized();const t=this.m_shape.getPointCount(this.m_geometry),o=new i.AttributeStreamOfInt32(0);this.m_shape.dbgVerifyMonotone();for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==n.nullHandle;e=this.m_shape.getNextPath(e)){let t=this.m_shape.getFirstVertex(e);for(let s=0,n=this.m_shape.getPathSize(e);s<n;s++)this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,-1),o.add(t),t=this.m_shape.getNextVertex(t)}this.m_shape.sortVerticesSimpleByY(o,0,t),this.progress_(!0),this.m_userIndexSortedIndexToVertex=this.m_shape.createUserIndexUninitialized(),this.m_sortedVertices.reserveNodes(t),this.m_sortedVerticesListIndex=this.m_sortedVertices.createList(0);for(let e=0;e<t;e++){const t=o.read(e),s=this.m_sortedVertices.addElement(this.m_sortedVerticesListIndex,t);this.m_shape.setUserIndex(t,this.m_userIndexSortedIndexToVertex,s)}this.m_nextVertexToProcess=-1,this.cleanupSpikes_()&&(e=!0);let a=0,m=!1;do{m=!1,this.m_nextVertexToProcess=-1,this.m_firstCoincidentVertex=this.m_sortedVertices.getFirst(this.m_sortedVerticesListIndex);const t=new r.Point2D(0,0);this.m_firstCoincidentVertex!==i.IndexMultiDCList.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(this.m_firstCoincidentVertex),t);let n=0,o=this.m_firstCoincidentVertex;for(;o!==i.IndexMultiDCList.st_nullNode()&&(o=this.m_sortedVertices.getNext(o),o!==i.IndexMultiDCList.st_nullNode());){this.progress_();const e=this.m_sortedVertices.getData(o),s=r.Point2D.getNAN();if(this.m_shape.queryXY(e,s),t.equals(s))n++;else{if(n>0){this.m_nextVertexToProcess=o;const e=this.processBunch_();o=this.m_nextVertexToProcess,o!==i.IndexMultiDCList.st_nullNode()&&this.m_shape.queryXY(this.m_sortedVertices.getData(o),s),e&&(m=!0)}t.setCoordsPoint2D(s),this.m_firstCoincidentVertex=o,n=0}}this.m_nextVertexToProcess=-1,n>0&&this.processBunch_()&&(m=!0),a++>10&&s.throwInternalErrorException(""),m&&this.fixOrphanVertices_(),this.cleanupSpikes_()&&(m=!0),e||=m}while(m);return this.m_shape.dbgVerifyMonotone(),this.m_shape.dbgVerifyCurves(),this.m_shape.removeUserIndex(this.m_userIndexSortedIndexToVertex),this.m_shape.removeUserIndex(this.m_userIndexSortedAngleIndexToVertex),e=function(e,t,s,n,i){const r=new Te(i);return r.m_shape=e,r.m_geometry=t,r.m_sortedVertices=s,r.m_bFixSelfTangency=n,r.fixRingOrientation_()}(this.m_shape,this.m_geometry,this.m_sortedVertices,this.m_bFixSelfTangency,this.m_progressTracker)||e,this.m_shape.dbgVerifyCurves(),e}getDirection_(e,t){return this.m_shape.getNextVertex(t)!==e}detectAndResolveCrossOver_(e,t,s,n,i,o,a,m){if(n===a)return this.removeAngleSortInfo_(s),this.removeAngleSortInfo_(o),-1;const h=this.m_shape.getUserIndex(s,this.m_userIndexSortedAngleIndexToVertex),l=this.m_shape.getUserIndex(i,this.m_userIndexSortedAngleIndexToVertex),u=this.m_shape.getUserIndex(o,this.m_userIndexSortedAngleIndexToVertex),c=this.m_shape.getUserIndex(m,this.m_userIndexSortedAngleIndexToVertex),g=r.makePrimitiveArray(8,Number.NaN),d=r.makePrimitiveArray(4,Number.NaN);g[0]=0,d[0]=h,g[1]=0,d[1]=l,g[2]=1,d[2]=u,g[3]=1,d[3]=c;for(let e=1;e<4;e++){const t=d[e],s=g[e];let n=e-1;for(;n>=0&&d[n]>t;)d[n+1]=d[n],g[n+1]=g[n],n--;d[n+1]=t,g[n+1]=s}let p=0;if(g[0]&&(p|=1),g[1]&&(p|=2),g[2]&&(p|=4),g[3]&&(p|=8),5!==p&&10!==p)return 0;if(e!==t&&(m=r.swap(o,o=m)),e)this.m_shape.setNextVertex(m,n),this.m_shape.setPrevVertex(n,m),this.m_shape.setNextVertex(i,a),this.m_shape.setPrevVertex(a,i),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(a,!0));else{if(this.m_shape.setPrevVertex(m,n),this.m_shape.setNextVertex(n,m),this.m_shape.setPrevVertex(i,a),this.m_shape.setNextVertex(a,i),this.m_bHasSegmentParentage){const e=this.m_shape.getSegmentParentage(n),t=this.m_shape.getSegmentParentage(a);this.m_shape.setSegmentParentageAndBreak(n,t,!0),this.m_shape.setSegmentParentageAndBreak(a,e,!0)}if(this.m_bHasSegments){const e=this.m_shape.getVertexIndex(n),t=this.m_shape.getVertexIndex(a),s=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null);const i=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null),this.m_shape.setSegmentToIndex(e,i),this.m_shape.setSegmentToIndex(t,s)}}return 1}resolveOverlap_(e,t,s,n,i,r){return this.resolveOverlapOddEven_(e,t,s,n,i,r)}resolveOverlapOddEven_(e,t,s,n,i,o){if(e!==t){e||(i=r.swap(s,s=i),o=r.swap(n,n=o));const t=this.m_shape.getNextVertex(i),a=this.m_shape.getNextVertex(s);if(this.m_shape.setNextVertex(s,t),this.m_shape.setPrevVertex(t,s),this.m_shape.setNextVertex(i,a),this.m_shape.setPrevVertex(a,i),this.m_bHasSegments){const e=this.m_shape.getVertexIndex(s),t=this.m_shape.getVertexIndex(i),n=this.m_shape.getSegmentFromIndex(e);this.m_shape.setSegmentToIndex(e,null);const r=this.m_shape.getSegmentFromIndex(t);this.m_shape.setSegmentToIndex(t,null),this.m_shape.setSegmentToIndex(e,r),this.m_shape.setSegmentToIndex(t,n)}if(this.m_bHasSegmentParentage){const e=this.m_shape.getSegmentParentage(s),t=this.m_shape.getSegmentParentage(i);this.m_shape.setSegmentParentageAndBreak(s,t,!0),this.m_shape.setSegmentParentageAndBreak(i,e,!0),this.m_shape.setSegmentParentageBreakVertex(n,!0),this.m_shape.setSegmentParentageBreakVertex(o,!0)}this.removeSpike_(i)}else{const r=e?s:n,a=t?i:o,m=e?n:s,h=t?o:i;let l=null;if(this.m_bHasSegments){const e=this.m_shape.getVertexIndex(h);l=this.m_shape.getSegmentFromIndex(e),this.m_shape.setSegmentToIndex(e,null);const t=this.m_shape.getVertexIndex(a);this.m_shape.setSegmentToIndex(t,null);const s=this.m_shape.getVertexIndex(r);this.m_shape.setSegmentToIndex(s,null)}let u=-1;this.m_bHasSegmentParentage&&(u=this.m_shape.getSegmentParentage(h));let c=!1;this.m_shape.setNextVertex(r,a),this.m_shape.setNextVertex(a,r),this.m_shape.setPrevVertex(m,h),this.m_shape.setPrevVertex(h,m);let g=h;for(;g!==a;){const e=this.m_shape.getPrevVertex(g),t=this.m_shape.getNextVertex(g);if(this.m_shape.setPrevVertex(g,t),this.m_shape.setNextVertex(g,e),c||=g===r,this.m_bHasSegments&&g!==r){const e=this.m_shape.getVertexIndex(t),s=l;l=this.m_shape.getSegmentFromIndex(e),null!==s&&s.reverse(),this.m_shape.setSegmentToIndex(e,s)}if(this.m_bHasSegmentParentage){const e=this.m_shape.getSegmentParentage(t);this.m_shape.setSegmentParentagePreserveBreak(t,u),u=e}g=t}let d=null;if(!c){const e=this.m_shape.getPrevVertex(a),t=this.m_shape.getNextVertex(a);if(this.m_shape.setPrevVertex(a,t),this.m_shape.setNextVertex(a,e),this.m_bHasSegments){const e=this.m_shape.getVertexIndex(a);d=this.m_shape.getSegmentFromIndex(e),this.m_shape.setSegmentToIndex(e,null)}}let p=-1,_=-1;if(this.m_bHasSegmentParentage&&(p=c?this.m_shape.getSegmentParentage(r):this.m_shape.getSegmentParentage(a),_=this.m_shape.getSegmentParentage(m)),this.transferVertexData_(a,r),this.beforeRemoveVertex_(a,!0),this.m_shape.removeVertexInternal(a,!0),this.removeAngleSortInfo_(r),this.transferVertexData_(h,m),this.beforeRemoveVertex_(h,!0),this.m_shape.removeVertexInternal(h,!0),this.removeAngleSortInfo_(m),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageAndBreak(r,p,!0),this.m_shape.setSegmentParentageAndBreak(m,_,!0)),d){const e=this.m_shape.getVertexIndex(r);this.m_shape.setSegmentToIndex(e,d)}}return!0}cleanupSpikes_(){let e=!1;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==n.nullHandle;){const s=this.m_shape.getNextPath(t);let i=this.m_shape.getFirstVertex(t);for(let s=0,r=this.m_shape.getPathSize(t);s<r&&r>1;){this.progress_();const{v:o,bModified:a}=this.checkAndCleanupSpike_(t,i);if(o===n.nullHandle)break;a?(e=!0,i=o,s=0,r=this.m_shape.getPathSize(t)):(i=o,s++)}t=s}return e}checkAndCleanupSpike_(e,t){const s={v:n.nullHandle,bModified:!1};let i=this.m_shape.getPrevVertex(t),r=this.m_shape.getNextVertex(t),o=n.nullHandle,a=n.nullHandle;for(;this.m_shape.isEqualXY(i,r)&&(o=i,a=r,r!==t);)i=this.m_shape.getPrevVertex(i),r=this.m_shape.getNextVertex(r);if(o===n.nullHandle)return s.v=r,s;s.bModified=!0;for(let e=this.m_shape.getNextVertex(o);this.beforeRemoveVertex_(e,!1),e!==a;e=this.m_shape.getNextVertex(e));if(o===t)return this.m_polylineDegeneracies!==n.nullHandle?this.m_shape.movePath(this.m_polylineDegeneracies,n.nullHandle,e):this.m_shape.removePath(e),s.v=n.nullHandle,s;{const e=this.m_shape.peelALoopIntoAPath(o,a);this.m_polylineDegeneracies!==n.nullHandle?this.m_shape.movePath(this.m_polylineDegeneracies,n.nullHandle,e):this.m_shape.removePath(e)}return s.v=o,s}removeSpike_(e){let t=this.m_shape.getPrevVertex(e),s=this.m_shape.getNextVertex(e),i=n.nullHandle,r=n.nullHandle;for(;this.m_shape.isEqualXY(t,s)&&(i=t,r=s,s!==e);)t=this.m_shape.getPrevVertex(t),s=this.m_shape.getNextVertex(s);if(i===n.nullHandle)return!1;if(this.m_shape.peelALoop(i,r),this.m_bHasSegmentParentage&&(this.m_shape.setSegmentParentageBreakVertex(i,!0),this.m_shape.setSegmentParentageBreakVertex(r,!0)),this.removeAngleSortInfo_(i),this.m_polylineDegeneracies===n.nullHandle)for(let e=this.m_shape.getNextVertex(r);;){const t=this.m_shape.getNextVertex(e);if(this.removeAngleSortInfo_(e),this.beforeRemoveVertex_(e,!0),this.m_shape.setSegmentToIndex(this.m_shape.getVertexIndex(e),null),this.m_shape.removeVertexInternal(e,!1),e===r)break;e=t}else{for(let e=r;;){const t=this.m_shape.getNextVertex(e);if(this.removeAngleSortInfo_(e),this.beforeRemoveVertex_(e,!1),e=t,e===r)break}const e=[!1];this.m_shape.insertClosedPath(this.m_polylineDegeneracies,n.nullHandle,r,r,e)}return!0}fixOrphanVertices_(){let e=0;for(let e=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==e;e=this.m_sortedVertices.getNext(e)){const t=this.m_sortedVertices.getData(e);this.m_shape.setPathToVertex(t,n.nullHandle)}let t=0;for(let s=this.m_shape.getFirstPath(this.m_geometry);s!==n.nullHandle;){const i=this.m_shape.getFirstVertex(s);if(i===n.nullHandle||this.m_shape.getPathFromVertex(i)!==n.nullHandle){const e=s;s=this.m_shape.getNextPath(s),this.m_shape.removePathOnly(e);continue}this.m_shape.setPathToVertex(i,s);let r=1;for(let e=this.m_shape.getNextVertex(i);e!==i;e=this.m_shape.getNextVertex(e))this.m_shape.setPathToVertex(e,s),r++;this.m_shape.setRingAreaValid(s,!1),this.m_shape.setPathSize(s,r),this.m_shape.setLastVertex(s,this.m_shape.getPrevVertex(i)),t+=r,e++,s=this.m_shape.getNextPath(s)}for(let s=this.m_sortedVertices.getFirst(this.m_sortedVertices.getFirstList());-1!==s;s=this.m_sortedVertices.getNext(s)){const i=this.m_sortedVertices.getData(s);if(this.m_shape.getPathFromVertex(i)!==n.nullHandle)continue;const r=[!1],o=this.m_shape.insertClosedPath(this.m_geometry,n.nullHandle,i,i,r);t+=this.m_shape.getPathSize(o),e++}this.m_shape.setGeometryPathCount(this.m_geometry,e),this.m_shape.setGeometryVertexCount(this.m_geometry,t);let s=0;for(let e=this.m_shape.getFirstGeometry();e!==n.nullHandle;e=this.m_shape.getNextGeometry(e))s+=this.m_shape.getPointCount(e);this.m_shape.setTotalPointCount(s)}getNextEdgeIndex_(e){if(-1===e)return-1;for(let t=0,s=this.m_bunchEdgeIndices.length-1;t<s;t++)if(e=(e+1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[e])return e;return-1}getPrevEdgeIndex_(e){if(-1===e)return-1;for(let t=0,s=this.m_bunchEdgeIndices.length-1;t<s;t++)if(e=(this.m_bunchEdgeIndices.length+e-1)%this.m_bunchEdgeIndices.length,-1!==this.m_bunchEdgeIndices[e])return e;return-1}transferVertexData_(e,t){const s=this.m_shape.getUserIndex(t,this.m_userIndexSortedIndexToVertex),n=this.m_shape.getUserIndex(t,this.m_userIndexSortedAngleIndexToVertex);this.m_shape.transferAllDataToTheVertex(e,t),this.m_shape.setUserIndex(t,this.m_userIndexSortedIndexToVertex,s),this.m_shape.setUserIndex(t,this.m_userIndexSortedAngleIndexToVertex,n)}removeAngleSortInfo_(e){const t=this.m_shape.getUserIndex(e,this.m_userIndexSortedAngleIndexToVertex);-1!==t&&(this.m_bunchEdgeIndices[t]=-1,this.m_shape.setUserIndex(e,this.m_userIndexSortedAngleIndexToVertex,-1))}progress_(e=!1){}}function Ge(e,o,a,m,h,l=!0){switch(Me(m)){case 0:break;case 1:s.throwInvalidArgumentException("relation string length has to be 9 characters");break;default:s.throwInvalidArgumentException("relation string")}if(l){const t=function(e,t,s){return function(e){return"T*F**FFF*"===e}(e)?3:function(e){return"FF*FF****"===e}(e)?4:function(e,t,s){return!(0===t&&0===s||(2===t&&2===s?"F***T****"!==e:2!==t&&1!==t||0!==s||"F**T*****"!==e))}(e,t,s)?8:function(e,t,s){return t>s?"T*****T**"===e:1===t&&1===s&&"0********"===e}(e,t,s)?16:function(e){return"T**FF*FF*"===e}(e)?64:function(e){return"T*****FF*"===e}(e)?1:function(e,t,s){return t===s&&(1!==t?"T*T***T**"===e:"1*T***T**"===e)}(e,t,s)?32:0}(m,e.getDimension(),o.getDimension());if(0!==t)return Ze(e,o,a,t,h)}let u=0;if("number"==typeof a)u=a;else{const s=t.Envelope2D.constructEmpty();e.queryEnvelope(s);const n=t.Envelope2D.constructEmpty();o.queryEnvelope(n);const r=t.Envelope2D.constructEmpty();r.setCoords({env2D:s}),r.mergeEnvelope2D(n),u=i.calculateToleranceFromGeometryForRel(a,r,!1)}const c=Be(e,u),g=Be(o,u);if(c.isEmpty()||g.isEmpty())return function(e,i,o){const a=r.makePrimitiveArray(9,-1);if(e.isEmpty()&&i.isEmpty())return Oe(a,o);let m,h=!1;e.isEmpty()?(m=i,h=!0):m=e,a[0]=-1,a[1]=-1,a[3]=-1,a[4]=-1,a[6]=-1,a[7]=-1,a[8]=2;const l=m.getGeometryType();if(s.isMultiPath(l))if(l===s.GeometryType.enumPolygon)if(0!==m.calculateArea2D())a[2]=2,a[5]=1;else{a[5]=-1;const e=t.Envelope2D.constructEmpty();m.queryEnvelope(e),a[2]=e.height()||e.width()?1:0}else{const e=0!==m.calculateLength2D();a[2]=e?1:0,a[5]=n.hasNonEmptyBoundary(m)?0:-1}else a[2]=0,a[5]=-1;return h&&Le(a),Oe(a,o)}(c,g,m);const d=c.getGeometryType(),p=g.getGeometryType();let _=!1;switch(d){case s.GeometryType.enumPolygon:switch(p){case s.GeometryType.enumPolygon:_=function(e,s,r,o,a){const m=new Xe;m.resetMatrix_(),m.setPredicates_(o),m.setAreaAreaPredicates_();const h=t.Envelope2D.constructEmpty(),l=t.Envelope2D.constructEmpty();e.queryEnvelope(h),s.queryEnvelope(l);let u=!1;if(Ke(h,l,r)&&(m.areaAreaDisjointPredicates_(e,s),u=!0),u||$e(e,s),!u){const t=new n.EditShape,o=t.addGeometry(e),h=t.addGeometry(s);m.setEditShapeCrackAndCluster_(t,new i.CombinedTolerance(r,0),a),m.computeMatrixTopoGraphHalfEdges_(o,h),m.m_topoGraph.removeShape()}return Oe(m.m_matrix,m.m_scl)}(c,g,u,m,h);break;case s.GeometryType.enumPolyline:_=Re(c,g,u,m,h);break;case s.GeometryType.enumPoint:_=qe(c,g,u,m);break;case s.GeometryType.enumMultiPoint:_=ke(c,g,u,m,h)}break;case s.GeometryType.enumPolyline:switch(p){case s.GeometryType.enumPolygon:_=Re(g,c,u,ze(m),h);break;case s.GeometryType.enumPolyline:_=function(e,s,r,o,a){const m=new Xe;m.resetMatrix_(),m.setPredicates_(o),m.setLineLinePredicates_();const h=t.Envelope2D.constructEmpty(),l=t.Envelope2D.constructEmpty();e.queryEnvelope(h),s.queryEnvelope(l);let u=!1;if(Ke(h,l,r)&&(m.lineLineDisjointPredicates_(e,s),u=!0),u||$e(e,s),!u){const t=new n.EditShape,o=t.addGeometry(e),h=t.addGeometry(s);m.setEditShapeCrackAndCluster_(t,new i.CombinedTolerance(r,0),a),m.m_clusterIndexA=m.m_topoGraph.createUserIndexForClusters(),m.m_clusterIndexB=m.m_topoGraph.createUserIndexForClusters(),Ye(o,m.m_topoGraph,m.m_clusterIndexA),Ye(h,m.m_topoGraph,m.m_clusterIndexB),m.computeMatrixTopoGraphHalfEdges_(o,h),m.m_topoGraph.deleteUserIndexForClusters(m.m_clusterIndexA),m.m_topoGraph.deleteUserIndexForClusters(m.m_clusterIndexB),m.m_topoGraph.removeShape()}return Oe(m.m_matrix,m.m_scl)}(c,g,u,m,h);break;case s.GeometryType.enumPoint:_=Ve(c,g,u,m,h);break;case s.GeometryType.enumMultiPoint:_=Fe(c,g,u,m,h)}break;case s.GeometryType.enumPoint:switch(p){case s.GeometryType.enumPolygon:_=qe(g,c,u,ze(m));break;case s.GeometryType.enumPolyline:_=Ve(g,c,u,ze(m),h);break;case s.GeometryType.enumPoint:_=function(e,t,s,n){const i=e.getXY(),o=t.getXY(),a=r.makePrimitiveArray(9,-1);return r.Point2D.sqrDistance(i,o)<=s*s?a[0]=0:(a[2]=0,a[6]=0),a[8]=2,Oe(a,n)}(c,g,u,m);break;case s.GeometryType.enumMultiPoint:_=He(g,c,u,ze(m))}break;case s.GeometryType.enumMultiPoint:switch(p){case s.GeometryType.enumPolygon:_=ke(g,c,u,ze(m),h);break;case s.GeometryType.enumPolyline:_=Fe(g,c,u,ze(m),h);break;case s.GeometryType.enumMultiPoint:_=function(e,s,r,o,a){const m=new Xe;m.resetMatrix_(),m.setPredicates_(o),m.setPointPointPredicates_();const h=new t.Envelope2D,l=new t.Envelope2D;e.queryEnvelope(h),s.queryEnvelope(l);let u=!1;if(Ke(h,l,r)&&(m.pointPointDisjointPredicates_(),u=!0),!u){const t=new n.EditShape,o=t.addGeometry(e),h=t.addGeometry(s);m.setEditShapeCrackAndCluster_(t,new i.CombinedTolerance(r,0),a),m.computeMatrixTopoGraphClusters_(o,h),m.m_topoGraph.removeShape()}return Oe(m.m_matrix,m.m_scl)}(c,g,u,m,h);break;case s.GeometryType.enumPoint:_=He(c,g,u,m)}break;default:_=!1}return _}function Me(e){if(9!==e.length)return 1;for(let t=0;t<9;t++){const s=e[t];if("*"!==s&&"T"!==s&&"F"!==s&&"0"!==s&&"1"!==s&&"2"!==s)return 2}return 0}function Re(e,s,r,o,a){const m=new Xe;m.resetMatrix_(),m.setPredicates_(o),m.setAreaLinePredicates_();const h=t.Envelope2D.constructEmpty(),l=t.Envelope2D.constructEmpty();e.queryEnvelope(h),s.queryEnvelope(l);let u=!1;if(Ke(h,l,r)&&(m.areaLineDisjointPredicates_(e,s),u=!0),u||$e(e,s),!u){const t=new n.EditShape,o=t.addGeometry(e),h=t.addGeometry(s);m.setEditShapeCrackAndCluster_(t,new i.CombinedTolerance(r,0),a),m.m_clusterIndexB=m.m_topoGraph.createUserIndexForClusters(),Ye(h,m.m_topoGraph,m.m_clusterIndexB),m.computeMatrixTopoGraphHalfEdges_(o,h),m.m_topoGraph.deleteUserIndexForClusters(m.m_clusterIndexB),m.m_topoGraph.removeShape()}return Oe(m.m_matrix,m.m_scl)}function ke(e,s,r,o,a){const m=new Xe;m.resetMatrix_(),m.setPredicates_(o),m.setAreaPointPredicates_();const h=t.Envelope2D.constructEmpty(),l=t.Envelope2D.constructEmpty();e.queryEnvelope(h),s.queryEnvelope(l);let u=!1;if(Ke(h,l,r)&&(m.areaPointDisjointPredicates_(e),u=!0),u||$e(e,s),!u){const t=new n.EditShape,o=t.addGeometry(e),h=t.addGeometry(s);m.setEditShapeCrackAndCluster_(t,new i.CombinedTolerance(r,0),a),m.computeMatrixTopoGraphClusters_(o,h),m.m_topoGraph.removeShape()}return Oe(m.m_matrix,m.m_scl)}function Fe(e,s,r,o,a){const m=new Xe;m.resetMatrix_(),m.setPredicates_(o),m.setLinePointPredicates_();const h=t.Envelope2D.constructEmpty(),l=t.Envelope2D.constructEmpty();e.queryEnvelope(h),s.queryEnvelope(l);let u=!1;if(Ke(h,l,r)&&(m.linePointDisjointPredicates_(e),u=!0),u||$e(e,s),!u){const t=new n.EditShape,o=t.addGeometry(e),h=t.addGeometry(s);m.setEditShapeCrackAndCluster_(t,new i.CombinedTolerance(r,0),a),m.m_clusterIndexA=m.m_topoGraph.createUserIndexForClusters(),Ye(o,m.m_topoGraph,m.m_clusterIndexA),m.computeMatrixTopoGraphClusters_(o,h),m.m_topoGraph.deleteUserIndexForClusters(m.m_clusterIndexA),m.m_topoGraph.removeShape()}return Oe(m.m_matrix,m.m_scl)}function qe(e,s,n,i,r){const o=new Xe;o.resetMatrix_(),o.setPredicates_(i),o.setAreaPointPredicates_();const a=t.Envelope2D.constructEmpty();e.queryEnvelope(a);const m=s.getXY();let h=!1;if(Je(m,a,n)&&(o.areaPointDisjointPredicates_(e),h=!0),!h){const s=Qt(e,m,n);if(1===s)o.m_matrix[0]=0,o.m_matrix[2]=2,o.m_matrix[3]=-1,o.m_matrix[5]=1,o.m_matrix[6]=-1;else if(2===s)if(o.m_matrix[6]=-1,0!==e.calculateArea2D())o.m_matrix[0]=-1,o.m_matrix[3]=0,o.m_matrix[2]=2,o.m_matrix[5]=1;else{o.m_matrix[0]=0,o.m_matrix[3]=-1,o.m_matrix[5]=-1;const s=t.Envelope2D.constructEmpty();e.queryEnvelope(s),o.m_matrix[2]=s.height()||s.width()?1:-1}else o.areaPointDisjointPredicates_(e)}return Oe(o.m_matrix,i)}function Ve(e,s,i,r,o){const a=new Xe;a.resetMatrix_(),a.setPredicates_(r),a.setLinePointPredicates_();const m=t.Envelope2D.constructEmpty();e.queryEnvelope(m);let h=!1;if(Je(s.getXY(),m,i)&&(a.linePointDisjointPredicates_(e),h=!0),!h){let t=null,r=!1,m=!1;if((a.m_performPredicates[0]||a.m_performPredicates[6])&&(Ze(e,s,i,4,o)?(a.m_matrix[0]=-1,a.m_matrix[6]=0):(a.m_performPredicates[0]&&(t=n.calculate(e),m=!Ze(t,s,i,4,o),r=!0,a.m_matrix[0]=m?-1:0),a.m_matrix[6]=-1)),a.m_performPredicates[3]&&(null!==t&&t.isEmpty()?a.m_matrix[3]=-1:(r||(null==t&&(t=n.calculate(e)),m=!Ze(t,s,i,4,o),r=!0),a.m_matrix[3]=m?0:-1)),a.m_performPredicates[5])if(null!==t&&t.isEmpty())a.m_matrix[5]=-1;else if(r&&!m)a.m_matrix[5]=0;else{null===t&&(t=n.calculate(e));const r=Ze(t,s,i,3,o);a.m_matrix[5]=r?-1:0}if(a.m_performPredicates[2])if(0!==e.calculateLength2D())a.m_matrix[2]=1;else{const t=new n.MultiPoint({vd:e.getDescription()});t.addPoints(e,0,e.getPointCount());const r=Ze(t,s,i,3,o);a.m_matrix[2]=r?-1:0}}return Oe(a.m_matrix,a.m_scl)}function He(e,s,n,i,o){const a=new Xe;a.resetMatrix_(),a.setPredicates_(i),a.setPointPointPredicates_();const m=t.Envelope2D.constructEmpty();e.queryEnvelope(m);const h=s.getXY(),l=new r.Point2D;let u=!1;if(Je(h,m,n)&&(a.pointPointDisjointPredicates_(),u=!0),!u){let t=!1,s=!0;const i=n*n;for(let n=0;n<e.getPointCount()&&(e.queryXY(n,l),r.Point2D.sqrDistance(l,h)<=i?t=!0:s=!1,!t||s);n++);t?(a.m_matrix[0]=0,a.m_matrix[2]=s?-1:0,a.m_matrix[6]=-1):(a.m_matrix[0]=-1,a.m_matrix[2]=0,a.m_matrix[6]=0)}return Oe(a.m_matrix,i)}function Oe(e,t){for(let s=0;s<9;s++)switch(t[s]){case"T":if(-1===e[s])return!1;break;case"F":if(-1!==e[s])return!1;break;case"0":if(0!==e[s])return!1;break;case"1":if(1!==e[s])return!1;break;case"2":if(2!==e[s])return!1}return!0}function Ye(e,t,s){const i=t.getGeometryID(e);for(let e=t.getFirstCluster();e!==n.nullHandle;e=t.getNextCluster(e)){if(0===(t.getClusterParentage(e)&i))continue;const r=t.getClusterHalfEdge(e);if(r===n.nullHandle){t.setClusterUserIndex(e,s,0);continue}let o=r,a=0;do{const e=o;0!==(t.getHalfEdgeParentage(e)&i)&&a++,o=t.getHalfEdgeNext(t.getHalfEdgeTwin(e))}while(o!==r);t.setClusterUserIndex(e,s,a)}}class Xe{nullFunc(){return s.throwInternalErrorException("should not be called"),!1}constructor(){this.m_clusterIndexA=-1,this.m_clusterIndexB=-1,this.m_visitedIndex=-1,this.m_topoGraph=new U,this.m_matrix=r.makePrimitiveArray(9,0),this.m_maxDim=r.makePrimitiveArray(9,0),this.m_performPredicates=r.makePrimitiveArray(9,!1),this.m_scl="",this.m_predicateCount=0,this.m_predicatesHalfEdge=this.nullFunc,this.m_predicatesCluster=this.nullFunc}resetMatrix_(){this.m_matrix.fill(-2),this.m_maxDim.fill(-2)}setPredicates_(e){this.m_scl=e;for(let e=0;e<9;e++)"*"!==this.m_scl[e]?(this.m_performPredicates[e]=!0,this.m_predicateCount++):this.m_performPredicates[e]=!1}setRemainingPredicatesToFalse_(){for(let e=0;e<9;e++)this.m_performPredicates[e]&&-2===this.m_matrix[e]&&(this.m_matrix[e]=-1,this.m_performPredicates[e]=!1)}isPredicateKnown_(e){return!(-2===this.m_matrix[e]||(-1===this.m_matrix[e]?(this.m_performPredicates[e]=!1,this.m_predicateCount--,0):"T"!==this.m_scl[e]&&"F"!==this.m_scl[e]&&this.m_matrix[e]<this.m_maxDim[e]||(this.m_performPredicates[e]=!1,this.m_predicateCount--,0)))}setAreaAreaPredicates_(){this.m_predicatesHalfEdge=this.areaAreaPredicates_,this.m_maxDim[0]=2,this.m_maxDim[1]=1,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=1,this.m_maxDim[5]=1,this.m_maxDim[6]=2,this.m_maxDim[7]=1,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaLinePredicates_(){this.m_predicatesHalfEdge=this.areaLinePredicates_,this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=2,this.m_maxDim[3]=1,this.m_maxDim[4]=0,this.m_maxDim[5]=1,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLineLinePredicates_(){this.m_predicatesHalfEdge=this.lineLinePredicates_,this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=1,this.m_maxDim[1]=0,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=0,this.m_maxDim[5]=0,this.m_maxDim[6]=1,this.m_maxDim[7]=0,this.m_maxDim[8]=2,this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setAreaPointPredicates_(){this.m_predicatesCluster=this.areaPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=2,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setLinePointPredicates_(){this.m_predicatesCluster=this.linePointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=1,this.m_maxDim[3]=0,this.m_maxDim[4]=-1,this.m_maxDim[5]=0,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}setPointPointPredicates_(){this.m_predicatesCluster=this.pointPointPredicates_,this.m_maxDim[0]=0,this.m_maxDim[1]=-1,this.m_maxDim[2]=0,this.m_maxDim[3]=-1,this.m_maxDim[4]=-1,this.m_maxDim[5]=-1,this.m_maxDim[6]=0,this.m_maxDim[7]=-1,this.m_maxDim[8]=2,this.m_performPredicates[1]&&(this.m_matrix[1]=-1,this.m_performPredicates[1]=!1,this.m_predicateCount--),this.m_performPredicates[3]&&(this.m_matrix[3]=-1,this.m_performPredicates[3]=!1,this.m_predicateCount--),this.m_performPredicates[4]&&(this.m_matrix[4]=-1,this.m_performPredicates[4]=!1,this.m_predicateCount--),this.m_performPredicates[5]&&(this.m_matrix[5]=-1,this.m_performPredicates[5]=!1,this.m_predicateCount--),this.m_performPredicates[7]&&(this.m_matrix[7]=-1,this.m_performPredicates[7]=!1,this.m_predicateCount--),this.m_performPredicates[8]&&(this.m_matrix[8]=2,this.m_performPredicates[8]=!1,this.m_predicateCount--)}areaAreaDisjointPredicates_(e,t){this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5]),this.areaGeomContainsOrDisjointPredicates_(t,this.m_performPredicates[6]?6:-1,this.m_scl[6],this.m_performPredicates[7]?7:-1,this.m_scl[7])}areaGeomContainsOrDisjointPredicates_(e,s,n,i,r){const o=-1!==s,a=-1!==i;if(o||a)if(("T"!==n&&"F"!==n&&o||"T"!==r&&"F"!==r&&a)&&0===e.calculateArea2D()){if(a&&(this.m_matrix[i]=-1),o){const n=t.Envelope2D.constructEmpty();e.queryEnvelope(n),this.m_matrix[s]=n.height()||n.width()?1:0}}else o&&(this.m_matrix[s]=2),a&&(this.m_matrix[i]=1)}areaAreaContainsPredicates_(e){this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[0]?0:-1,this.m_scl[0],this.m_performPredicates[1]?1:-1,this.m_scl[1])}areaAreaWithinPredicates_(e){this.areaAreaContainsPredicates_(e),Le(this.m_matrix)}areaLineDisjointPredicates_(e,t){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[6]){const e=this.m_scl[6],s="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[6]=s?1:0}if(this.m_performPredicates[7]){const e=n.hasNonEmptyBoundary(t);this.m_matrix[7]=e?0:-1}this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaLineContainsPredicates_(e,t){if(this.m_performPredicates[0]){const e=this.m_scl[0],s="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[0]=s?1:0}if(this.m_performPredicates[1]){const e=n.hasNonEmptyBoundary(t);this.m_matrix[1]=e?0:-1}this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1,this.m_matrix[7]=-1}areaPointDisjointPredicates_(e){this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_matrix[6]=0,this.areaGeomContainsOrDisjointPredicates_(e,this.m_performPredicates[2]?2:-1,this.m_scl[2],this.m_performPredicates[5]?5:-1,this.m_scl[5])}areaPointContainsPredicates_(e){this.m_matrix[0]=0,this.m_matrix[2]=2,this.m_matrix[3]=-1,this.m_matrix[5]=1,this.m_matrix[6]=-1}lineLineDisjointPredicates_(e,t){if(this.m_matrix[0]=-1,this.m_matrix[1]=-1,this.m_matrix[3]=-1,this.m_matrix[4]=-1,this.m_performPredicates[2]){const t=this.m_scl[2],s="T"===t||"F"===t||0!==e.calculateLength2D();this.m_matrix[2]=s?1:0}if(this.m_performPredicates[5]){const t=n.hasNonEmptyBoundary(e);this.m_matrix[5]=t?0:-1}if(this.m_performPredicates[6]){const e=this.m_scl[6],s="T"===e||"F"===e||0!==t.calculateLength2D();this.m_matrix[6]=s?1:0}if(this.m_performPredicates[7]){const e=n.hasNonEmptyBoundary(t);this.m_matrix[7]=e?0:-1}}linePointDisjointPredicates_(e){if(this.m_matrix[0]=-1,this.m_matrix[3]=-1,this.m_performPredicates[2]){const t=this.m_scl[2],s="T"===t||"F"===t||0!==e.calculateLength2D();this.m_matrix[2]=s?1:0}if(this.m_performPredicates[5]){const t=n.hasNonEmptyBoundary(e);this.m_matrix[5]=t?0:-1}this.m_matrix[6]=0}pointPointDisjointPredicates_(){this.m_matrix[0]=-1,this.m_matrix[2]=0,this.m_matrix[6]=0}areaAreaPredicates_(e,t,s){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorArea_(e,t,s);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryArea_(e,t,1);const s=this.isPredicateKnown_(1);n&&=s}if(this.m_performPredicates[2]){this.interiorAreaExteriorArea_(e,t,s,2);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.interiorAreaBoundaryArea_(e,s,3);const t=this.isPredicateKnown_(3);n&&=t}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryArea_(e,t,s);const i=this.isPredicateKnown_(4);n&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorArea_(e,t,s,5);const i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.interiorAreaExteriorArea_(e,s,t,6);const i=this.isPredicateKnown_(6);n&&=i}if(this.m_performPredicates[7]){this.boundaryAreaExteriorArea_(e,s,t,7);const i=this.isPredicateKnown_(7);n&&=i}return n}areaLinePredicates_(e,t,s){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorLine_(e,t,s);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[1]){this.interiorAreaBoundaryLine_(e,t,s,this.m_clusterIndexB);const i=this.isPredicateKnown_(1);n&&=i}if(this.m_performPredicates[2]){this.interiorAreaExteriorLine_(e,t,s);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.boundaryAreaInteriorLine_(e,t,s,this.m_clusterIndexB);const i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[4]){this.boundaryAreaBoundaryLine_(e,t,s,this.m_clusterIndexB);const i=this.isPredicateKnown_(4);n&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorLine_(e,t,s);const i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.exteriorAreaInteriorLine_(e,t);const s=this.isPredicateKnown_(6);n&&=s}if(this.m_performPredicates[7]){this.exteriorAreaBoundaryLine_(e,t,s,this.m_clusterIndexB);const i=this.isPredicateKnown_(7);n&&=i}return n}lineLinePredicates_(e,t,s){let n=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorLine_(e,t,s,this.m_clusterIndexA,this.m_clusterIndexB);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[1]){this.interiorLineBoundaryLine_(e,t,s,this.m_clusterIndexA,this.m_clusterIndexB,1);const i=this.isPredicateKnown_(1);n&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorLine_(e,t,s,2);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.interiorLineBoundaryLine_(e,s,t,this.m_clusterIndexB,this.m_clusterIndexA,3);const i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[4]){this.boundaryLineBoundaryLine_(e,t,s,this.m_clusterIndexA,this.m_clusterIndexB);const i=this.isPredicateKnown_(4);n&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorLine_(e,t,s,this.m_clusterIndexA,5);const i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.interiorLineExteriorLine_(e,s,t,6);const i=this.isPredicateKnown_(6);n&&=i}if(this.m_performPredicates[7]){this.boundaryLineExteriorLine_(e,s,t,this.m_clusterIndexB,7);const i=this.isPredicateKnown_(7);n&&=i}return n}areaPointPredicates_(e,t,s){let n=!0;if(this.m_performPredicates[0]){this.interiorAreaInteriorPoint_(e,t);const s=this.isPredicateKnown_(0);n&&=s}if(this.m_performPredicates[2]){this.interiorAreaExteriorPoint_(e,t);const s=this.isPredicateKnown_(2);n&&=s}if(this.m_performPredicates[3]){this.boundaryAreaInteriorPoint_(e,t,s);const i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[5]){this.boundaryAreaExteriorPoint_(e,t);const s=this.isPredicateKnown_(5);n&&=s}if(this.m_performPredicates[6]){this.exteriorAreaInteriorPoint_(e,t);const s=this.isPredicateKnown_(6);n&&=s}return n}linePointPredicates_(e,t,s){let n=!0;if(this.m_performPredicates[0]){this.interiorLineInteriorPoint_(e,t,s,this.m_clusterIndexA);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[2]){this.interiorLineExteriorPoint_(e,t,s,this.m_clusterIndexA);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[3]){this.boundaryLineInteriorPoint_(e,t,s,this.m_clusterIndexA);const i=this.isPredicateKnown_(3);n&&=i}if(this.m_performPredicates[5]){this.boundaryLineExteriorPoint_(e,t,s,this.m_clusterIndexA);const i=this.isPredicateKnown_(5);n&&=i}if(this.m_performPredicates[6]){this.exteriorLineInteriorPoint_(e,t,s);const i=this.isPredicateKnown_(6);n&&=i}return n}pointPointPredicates_(e,t,s){let n=!0;if(this.m_performPredicates[0]){this.interiorPointInteriorPoint_(e,t,s);const i=this.isPredicateKnown_(0);n&&=i}if(this.m_performPredicates[2]){this.interiorPointExteriorPoint_(e,t,s,2);const i=this.isPredicateKnown_(2);n&&=i}if(this.m_performPredicates[6]){this.interiorPointExteriorPoint_(e,s,t,6);const i=this.isPredicateKnown_(6);n&&=i}return n}interiorAreaInteriorArea_(e,t,s){if(2===this.m_matrix[0])return;const n=this.m_topoGraph.getHalfEdgeFaceParentage(e);0!==(n&t)&&0!==(n&s)&&(this.m_matrix[0]=2)}interiorAreaBoundaryArea_(e,t,s){if(1===this.m_matrix[s])return;const n=this.m_topoGraph.getHalfEdgeFaceParentage(e),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));0!==(n&t)&&0!==(i&t)&&(this.m_matrix[s]=1)}interiorAreaExteriorArea_(e,t,s,n){if(2===this.m_matrix[n])return;const i=this.m_topoGraph.getHalfEdgeFaceParentage(e);0!==(i&t)&&0===(i&s)&&(this.m_matrix[n]=2)}boundaryAreaBoundaryArea_(e,t,s){if(1===this.m_matrix[4])return;const n=this.m_topoGraph.getHalfEdgeParentage(e);if(0===(n&t)||0===(n&s)){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const n=this.m_topoGraph.getHalfEdgeTo(e),i=this.m_topoGraph.getClusterParentage(n);if(0!==(i&t)&&0!==(i&s))return void(this.m_matrix[4]=0)}}else this.m_matrix[4]=1}boundaryAreaExteriorArea_(e,t,s,n){if(1===this.m_matrix[n])return;const i=this.m_topoGraph.getHalfEdgeFaceParentage(e),r=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));0===(i&s)&&0===(r&s)&&(this.m_matrix[n]=1)}interiorAreaInteriorLine_(e,t,s){if(1===this.m_matrix[0])return;const n=this.m_topoGraph.getHalfEdgeFaceParentage(e),i=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));0!==(n&t)&&0!==(i&t)&&(this.m_matrix[0]=1)}interiorAreaBoundaryLine_(e,t,s,n){if(0!==this.m_matrix[1]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const i=this.m_topoGraph.getHalfEdgeTo(e),r=this.m_topoGraph.getClusterParentage(i);if(0===(r&t)&&0!==(this.m_topoGraph.getHalfEdgeFaceParentage(e)&t)){const e=this.m_topoGraph.getClusterUserIndex(i,n);if(0!==(r&s)&&e%2!=0)return void(this.m_matrix[1]=0)}}}interiorAreaExteriorLine_(e,t,s){2!==this.m_matrix[2]&&0!==(this.m_topoGraph.getHalfEdgeParentage(e)&t)&&(this.m_matrix[2]=2)}boundaryAreaInteriorLine_(e,t,s,n){if(1===this.m_matrix[3])return;const i=this.m_topoGraph.getHalfEdgeParentage(e);if(0===(i&t)||0===(i&s)){if(0!==this.m_matrix[3]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const i=this.m_topoGraph.getHalfEdgeTo(e),r=this.m_topoGraph.getClusterParentage(i);if(0!==(r&t)){const e=this.m_topoGraph.getClusterUserIndex(i,n);if(0!==(r&s)&&e%2==0)return void(this.m_matrix[3]=0)}}}else this.m_matrix[3]=1}boundaryAreaBoundaryLine_(e,t,s,n){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const i=this.m_topoGraph.getHalfEdgeTo(e),r=this.m_topoGraph.getClusterParentage(i);if(0!==(r&t)){const e=this.m_topoGraph.getClusterUserIndex(i,n);if(0!==(r&s)&&e%2!=0)return void(this.m_matrix[4]=0)}}}boundaryAreaExteriorLine_(e,t,s){if(1===this.m_matrix[5])return;const n=this.m_topoGraph.getHalfEdgeParentage(e);0!==(n&t)&&0===(n&s)&&(this.m_matrix[5]=1)}exteriorAreaInteriorLine_(e,t){if(1===this.m_matrix[6])return;const s=this.m_topoGraph.getHalfEdgeFaceParentage(e),n=this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e));0===(s&t)&&0===(n&t)&&(this.m_matrix[6]=1)}exteriorAreaBoundaryLine_(e,t,s,n){if(0!==this.m_matrix[7]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const i=this.m_topoGraph.getHalfEdgeTo(e),r=this.m_topoGraph.getClusterParentage(i);if(0===(r&t)&&0===(this.m_topoGraph.getHalfEdgeFaceParentage(e)&t)){const e=this.m_topoGraph.getClusterUserIndex(i,n);if(0!==(r&s)&&e%2!=0)return void(this.m_matrix[7]=0)}}}interiorLineInteriorLine_(e,t,s,n,i){if(1===this.m_matrix[0])return;const r=this.m_topoGraph.getHalfEdgeParentage(e);if(0===(r&t)||0===(r&s)){if(0!==this.m_matrix[0]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const r=this.m_topoGraph.getHalfEdgeTo(e),o=this.m_topoGraph.getClusterParentage(r);if(0!==(o&t)&&0!==(o&s)){const e=this.m_topoGraph.getClusterUserIndex(r,n),t=this.m_topoGraph.getClusterUserIndex(r,i);if(e%2==0&&t%2==0)return void(this.m_matrix[0]=0)}}}else this.m_matrix[0]=1}interiorLineBoundaryLine_(e,t,s,n,i,r){if(0!==this.m_matrix[r]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const o=this.m_topoGraph.getHalfEdgeTo(e),a=this.m_topoGraph.getClusterParentage(o);if(0!==(a&t)&&0!==(a&s)){const e=this.m_topoGraph.getClusterUserIndex(o,n),t=this.m_topoGraph.getClusterUserIndex(o,i);if(e%2==0&&t%2!=0)return void(this.m_matrix[r]=0)}}}interiorLineExteriorLine_(e,t,s,n){if(1===this.m_matrix[n])return;const i=this.m_topoGraph.getHalfEdgeParentage(e);0!==(i&t)&&0===(i&s)&&(this.m_matrix[n]=1)}boundaryLineBoundaryLine_(e,t,s,n,i){if(0!==this.m_matrix[4]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const r=this.m_topoGraph.getHalfEdgeTo(e),o=this.m_topoGraph.getClusterParentage(r);if(0!==(o&t)&&0!==(o&s)){const e=this.m_topoGraph.getClusterUserIndex(r,n),t=this.m_topoGraph.getClusterUserIndex(r,i);if(e%2!=0&&t%2!=0)return void(this.m_matrix[4]=0)}}}boundaryLineExteriorLine_(e,t,s,n,i){if(0!==this.m_matrix[i]&&1!==this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgePrev(this.m_topoGraph.getHalfEdgeTwin(e)),this.m_visitedIndex)){const t=this.m_topoGraph.getHalfEdgeTo(e);if(0===(this.m_topoGraph.getClusterParentage(t)&s)&&this.m_topoGraph.getClusterUserIndex(t,n)%2!=0)return void(this.m_matrix[i]=0)}}interiorAreaInteriorPoint_(e,t){if(0!==this.m_matrix[0]&&0===(this.m_topoGraph.getClusterParentage(e)&t)){const s=this.m_topoGraph.getClusterChain(e);if(0!==(this.m_topoGraph.getChainParentage(s)&t))return void(this.m_matrix[0]=0)}}interiorAreaExteriorPoint_(e,t){2!==this.m_matrix[2]&&0!==(this.m_topoGraph.getClusterParentage(e)&t)&&(this.m_matrix[2]=2)}boundaryAreaInteriorPoint_(e,t,s){if(0===this.m_matrix[3])return;const n=this.m_topoGraph.getClusterParentage(e);0===(n&t)||0===(n&s)||(this.m_matrix[3]=0)}boundaryAreaExteriorPoint_(e,t){1!==this.m_matrix[5]&&0!==(this.m_topoGraph.getClusterParentage(e)&t)&&(this.m_matrix[5]=1)}exteriorAreaInteriorPoint_(e,t){if(0!==this.m_matrix[6]&&0===(this.m_topoGraph.getClusterParentage(e)&t)){const s=this.m_topoGraph.getClusterChain(e);if(0===(this.m_topoGraph.getChainParentage(s)&t))return void(this.m_matrix[6]=0)}}interiorLineInteriorPoint_(e,t,s,n){if(0===this.m_matrix[0])return;const i=this.m_topoGraph.getClusterParentage(e);0===(i&t)||0===(i&s)||this.m_topoGraph.getClusterUserIndex(e,n)%2!=0||(this.m_matrix[0]=0)}interiorLineExteriorPoint_(e,t,s,n){if(1!==this.m_matrix[2])if(-1===this.m_topoGraph.getClusterHalfEdge(e)){if(0!==this.m_matrix[2]&&0===(this.m_topoGraph.getClusterParentage(e)&s))return void(this.m_matrix[2]=0)}else this.m_matrix[2]=1}boundaryLineInteriorPoint_(e,t,s,n){if(0===this.m_matrix[3])return;const i=this.m_topoGraph.getClusterParentage(e);0===(i&t)||0===(i&s)||this.m_topoGraph.getClusterUserIndex(e,n)%2==0||(this.m_matrix[3]=0)}boundaryLineExteriorPoint_(e,t,s,n){if(0===this.m_matrix[5])return;const i=this.m_topoGraph.getClusterParentage(e);0===(i&t)||0!==(i&s)||this.m_topoGraph.getClusterUserIndex(e,n)%2==0||(this.m_matrix[5]=0)}exteriorLineInteriorPoint_(e,t,s){if(0===this.m_matrix[6])return;const n=this.m_topoGraph.getClusterParentage(e);0!==(n&t)||0===(n&s)||(this.m_matrix[6]=0)}interiorPointInteriorPoint_(e,t,s){if(0===this.m_matrix[0])return;const n=this.m_topoGraph.getClusterParentage(e);0===(n&t)||0===(n&s)||(this.m_matrix[0]=0)}interiorPointExteriorPoint_(e,t,s,n){if(0===this.m_matrix[n])return;const i=this.m_topoGraph.getClusterParentage(e);0===(i&t)||0!==(i&s)||(this.m_matrix[n]=0)}computeMatrixTopoGraphHalfEdges_(e,t){let s=!1;const i=this.m_topoGraph.getGeometryID(e),r=this.m_topoGraph.getGeometryID(t);this.m_visitedIndex=this.m_topoGraph.createUserIndexForHalfEdges();for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle;e=this.m_topoGraph.getNextCluster(e)){const t=this.m_topoGraph.getClusterHalfEdge(e);if(t===n.nullHandle){if(null!==this.m_predicatesCluster&&(s=this.m_predicatesCluster(e,i,r),s))break;continue}let o=t;do{let e=o;if(1!==this.m_topoGraph.getHalfEdgeUserIndex(e,this.m_visitedIndex))do{if(s=this.m_predicatesHalfEdge(e,i,r),s)break;this.m_topoGraph.setHalfEdgeUserIndex(e,this.m_visitedIndex,1),e=this.m_topoGraph.getHalfEdgeNext(e)}while(e!==o&&!s);if(s)break;o=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(e))}while(o!==t);if(s)break}s||this.setRemainingPredicatesToFalse_(),this.m_topoGraph.deleteUserIndexForHalfEdges(this.m_visitedIndex)}computeMatrixTopoGraphClusters_(e,t){let s=!1;const i=this.m_topoGraph.getGeometryID(e),r=this.m_topoGraph.getGeometryID(t);for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle&&(s=this.m_predicatesCluster(e,i,r),!s);e=this.m_topoGraph.getNextCluster(e));s||this.setRemainingPredicatesToFalse_()}setEditShape_(e,t){this.m_topoGraph.setEditShape(e,t)}setEditShapeCrackAndCluster_(e,t,i){let r=0;if(e.hasCurves()){const s=new ms,n=e.getEnvelope2D(i),o=rs(t.total(),n);r=as(o,0),ss(e,o,t.total(),0,s,null,i),s.clearStitcher(e)}ls(e,t.add(r),i,!1,!1),e.filterClosePoints(0,!0,!0,!1,n.nullHandle);for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))e.getGeometryType(t)===s.GeometryType.enumPolygon&&Ae(e,t,-1,!1,n.nullHandle,i);this.setEditShape_(e,i)}}function Le(e){const t=e[1],s=e[2],n=e[5];e[1]=e[3],e[2]=e[6],e[5]=e[7],e[3]=t,e[6]=s,e[7]=n}function Be(e,r,o){const a=e.getGeometryType();if(s.isSegment(a)){const t=new n.Polyline({vd:e.getDescription()});return t.addSegment(e,!0),t}if(a===s.GeometryType.enumEnvelope){const s=e,o=t.Envelope2D.constructEmpty();if(e.queryEnvelope(o),o.height()<=r&&o.width()<=r){const t=new i.Point({vd:e.getDescription()});return s.getCenter(t),t}if(o.height()<=r||o.width()<=r){const t=new n.Polyline({vd:e.getDescription()}),r=new i.Point;return s.queryCornerByVal(0,r),t.startPathPoint(r),s.queryCornerByVal(2,r),t.lineToPoint(r),t}const a=new n.Polygon({vd:e.getDescription()});return a.addEnvelope(s,!1),a}return e}function ze(e){return`${e[0]}${e[3]}${e[6]}${e[1]}${e[4]}${e[7]}${e[2]}${e[5]}${e[8]}`}class Ue{nullFunc(){return s.throwInternalErrorException("should not be called"),!1}constructor(e,n,r,o=!1){this.m_bDone=!1,this.m_tolerance=0,this.m_elementHandle=-1,this.m_query=t.Envelope2D.constructEmpty(),this.m_envInter=t.Envelope2D.constructEmpty(),this.m_quadTree=null,this.m_intersector=null,this.m_function=this.nullFunc;const a=e.getAccelerators();let m=null;null!=a&&(m=o?a.getQuadTreeForPaths():a.getQuadTree());const h=n.getAccelerators();let l=null;if(null!=h&&(l=o?h.getQuadTreeForPaths():h.getQuadTree()),null===m&&null===l&&!o){const o=e.getPointCount(),a=n.getPointCount();if(o>10&&a>10){const h=t.Envelope2D.constructEmpty(),u=t.Envelope2D.constructEmpty(),c=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(h),n.queryLooseEnvelope(u),h.inflateCoords(r,r),u.inflateCoords(r,r),c.setCoords({env2D:h}),c.intersect(u),o>=a?m=s.isMultiPath(e.getGeometryType())?i.buildQuadTree(e,c):i.buildQuadTreeMpt(e,c):l=s.isMultiPath(n.getGeometryType())?i.buildQuadTree(n,c):i.buildQuadTreeMpt(n,c)}}this.construct_(e,m,n,l,r,o)}next(){if(this.m_bQuadTree){if(this.m_bDone)return!1;for(;this.m_function(););return!this.m_bDone}return!!this.m_intersector&&this.m_intersector.next()}getRedElement(){return this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElement(this.m_elementHandle):s.isMultiPath(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_bSwapElements?this.m_intersector.getBlueElement(this.m_intersector.getHandleB()):this.m_intersector.getRedElement(this.m_intersector.getHandleA())}getBlueElement(){return this.m_bQuadTree?this.m_bSwapElements?s.isMultiPath(this.m_queryType)?this.m_bPaths?this.m_pathIndex:this.m_segIter.getStartPointIndex():this.m_pointIndex:this.m_quadTree.getElement(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedElement(this.m_intersector.getHandleA()):this.m_intersector.getBlueElement(this.m_intersector.getHandleB())}getRedEnvelope(){return this.m_bPaths||s.throwInvalidCallException(""),this.m_bQuadTree?this.m_bSwapElements?this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_query:this.m_bSwapElements?this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB()):this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA())}getBlueEnvelope(){return this.m_bPaths||s.throwInvalidCallException(""),this.m_bQuadTree?this.m_bSwapElements?this.m_query:this.m_quadTree.getElementExtent(this.m_elementHandle):this.m_bSwapElements?this.m_intersector.getRedEnvelope(this.m_intersector.getHandleA()):this.m_intersector.getBlueEnvelope(this.m_intersector.getHandleB())}construct_(e,n,r,o,a,m){const h=t.Envelope2D.constructEmpty(),l=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(h),r.queryLooseEnvelope(l),h.inflateCoords(a,a),l.inflateCoords(a,a),this.m_envInter.setCoords({env2D:h}),this.m_envInter.intersect(l),this.m_multiVertexImplA=e,this.m_multiVertexImplB=r;const u=e.getGeometryType(),c=r.getGeometryType();this.m_bPaths=m,this.m_pathIndex=-1,this.m_pointIndex=-1,this.m_bSwapElements=!1,this.m_queryType=s.GeometryType.enumUnknown,this.m_bQuadTree=!1,null!==n&&(this.m_bDone=!1,this.m_tolerance=a,this.m_quadTree=n,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!0,s.isMultiPath(c)?(this.m_queryType=c,this.m_function=this.nextPath_,m?this.m_pathIndex=r.getPathCount():this.m_segIter=r.querySegmentIterator()):(this.m_queryType=c,this.m_function=this.nextPoint_,this.m_pointIndex=r.getPointCount())),this.m_bQuadTree||null!==o&&(this.m_bDone=!1,this.m_tolerance=a,this.m_quadTree=o,this.m_qtIter=this.m_quadTree.getIteratorForQT(),this.m_bQuadTree=!0,this.m_bSwapElements=!1,s.isMultiPath(u)?(this.m_queryType=u,this.m_function=this.nextPath_,m?this.m_pathIndex=e.getPathCount():this.m_segIter=e.querySegmentIterator()):(this.m_queryType=u,this.m_function=this.nextPoint_,this.m_pointIndex=e.getPointCount())),this.m_bQuadTree||(m&&s.isMultiPath(u)&&s.isMultiPath(c)?this.m_intersector=i.getEnvelope2DIntersectorForParts(e,r,a):s.isMultiPath(u)&&s.isMultiPath(c)?(this.m_intersector=i.getEnvelope2DIntersector(e,r,a),this.m_bSwapElements=!1):s.isMultiPath(u)&&!s.isMultiPath(c)?(this.m_intersector=i.getEnvelope2DIntersectorMpthMpt(e,r,a),this.m_bSwapElements=!1):!s.isMultiPath(u)&&s.isMultiPath(c)?(this.m_intersector=i.getEnvelope2DIntersectorMpthMpt(r,e,a),this.m_bSwapElements=!0):(this.m_intersector=i.getEnvelope2DIntersectorMptMpt(e,r,a),this.m_bSwapElements=!1))}nextPath_(){return this.m_bPaths?-1===--this.m_pathIndex?(this.m_bDone=!0,!1):(this.m_bSwapElements?this.m_multiVertexImplB.queryPathEnvelope(this.m_pathIndex,this.m_query):this.m_multiVertexImplA.queryPathEnvelope(this.m_pathIndex,this.m_query),this.m_qtIter.resetIterator(this.m_query,this.m_tolerance),this.m_function=this.iterate_,!0):this.m_segIter.nextPath()?(this.m_function=this.nextSegment_,!0):(this.m_bDone=!0,!1)}nextSegment_(){if(!this.m_segIter.hasNextSegment())return this.m_function=this.nextPath_,!0;const e=this.m_segIter.nextSegment(),s=new t.Envelope2D;return e.queryLooseEnvelope(s),!s.isIntersecting(this.m_envInter)||(this.m_qtIter.resetIterator(e,this.m_tolerance),this.m_function=this.iterate_,!0)}nextPoint_(){if(-1===--this.m_pointIndex)return this.m_bDone=!0,!1;const e=new r.Point2D;if(this.m_bSwapElements){const t=this.m_multiVertexImplB.getXY(this.m_pointIndex);e.setCoordsPoint2D(t)}else{const t=this.m_multiVertexImplA.getXY(this.m_pointIndex);e.setCoordsPoint2D(t)}return!this.m_envInter.contains(e)||(this.m_qtIter.resetIterator(t.Envelope2D.construct(e.x,e.y,e.x,e.y),this.m_tolerance),this.m_function=this.iterate_,!0)}iterate_(){return this.m_elementHandle=this.m_qtIter.next(),-1===this.m_elementHandle&&(s.isMultiPath(this.m_queryType)?(this.m_function=this.m_bPaths?this.nextPath_:this.nextSegment_,!0):(this.m_function=this.nextPoint_,!0))}}function je(e){return 2===e?1:1===e?2:128===e?64:64===e?128:e}function We(e,s,n){let r;if(e instanceof Wr||null===e){const o=t.Envelope2D.constructEmpty();o.setCoords({env2D:s}),o.mergeEnvelope2D(n),r=i.calculateToleranceFromGeometryForRel(e,o,!1)}else r=e;return r}function Ze(e,o,a,h,l){if(e.isEmpty()||o.isEmpty())return 4===h;s.throwIfMesh(e),s.throwIfMesh(o);let u=e.getGeometryType(),c=o.getGeometryType();if(u===s.GeometryType.enumEnvelope){if(c===s.GeometryType.enumEnvelope)return function(e,s,n,i){if(e.isEmpty()||s.isEmpty())return 4===i;const r=t.Envelope2D.constructEmpty();e.queryEnvelope(r);const o=t.Envelope2D.constructEmpty();s.queryEnvelope(o);const a=We(n,r,o);switch(i){case 4:return Ke(r,o,a);case 2:return St(o,r,a,!1);case 128:return St(o,r,a,!0);case 1:return St(r,o,a,!1);case 64:return St(r,o,a,!0);case 3:return bt(r,o,a);case 8:return function(e,s,n){if(e.height()<=n||e.width()<=n||s.height()<=n||s.width()<=n)return!1;const i=new t.Envelope2D;return i.setCoords({env2D:e}),i.inflateCoords(-n,-n),i.intersect(s),!(!i.isEmpty()&&i.height()>n&&i.width()>n||(i.setCoords({env2D:e}),i.inflateCoords(n,n),i.intersect(s),i.isEmpty()))}(r,o,a);case 32:return function(e,s,n){if(e.height()<=n||e.width()<=n||s.height()<=n||s.width()<=n)return!1;if(Tt(e,s,n))return!1;if(Tt(s,e,n))return!1;const i=new t.Envelope2D;return i.setCoords({env2D:e}),i.inflateCoords(-n,-n),i.intersect(s),!i.isEmpty()&&(i.height()>n||i.width()>n)}(r,o,a);case 16:return!1}return!1}(e,o,a,h);if(c===s.GeometryType.enumPoint)return Qe(o,e,a,je(h))}else if(u===s.GeometryType.enumPoint){if(c===s.GeometryType.enumEnvelope)return Qe(e,o,a,h);if(c===s.GeometryType.enumPoint)return function(e,s,n,o){if(e.isEmpty()||s.isEmpty())return 4===o;const a=e.getXY(),m=s.getXY();let h;if(n instanceof Wr||null===n){const e=t.Envelope2D.constructEmpty();e.setCoords({pt:a}),e.merge(m),h=i.calculateToleranceFromGeometryForRel(n,e,!1)}else h=n;switch(o){case 4:return function(e,t,s){return r.Point2D.sqrDistance(e,t)>s*s}(a,m,h);case 2:case 128:return Dt(m,a,h);case 1:case 64:return Dt(a,m,h);case 3:return Ct(a,m,h)}return!1}(e,o,a,h)}const g=t.Envelope2D.constructEmpty();e.queryEnvelope(g);const d=t.Envelope2D.constructEmpty();o.queryEnvelope(d);const p=We(a,g,d);if(Ke(g,d,p))return 4===h;let _=!1,f=null,y=null,x=null,P=null;switch(s.isSegment(u)?(f=new n.Polyline({vd:e.getDescription()}),f.addSegment(e,!0),x=f,u=s.GeometryType.enumPolyline):x=e,s.isSegment(c)?(y=new n.Polyline({vd:o.getDescription()}),y.addSegment(o,!0),P=y,c=s.GeometryType.enumPolyline):P=o,u!==s.GeometryType.enumEnvelope&&c!==s.GeometryType.enumEnvelope?(x.getDimension()<P.getDimension()||u===s.GeometryType.enumPoint&&c===s.GeometryType.enumMultiPoint)&&(h=je(h)):u!==s.GeometryType.enumPolygon&&c!==s.GeometryType.enumEnvelope&&(h=je(h)),u){case s.GeometryType.enumPolygon:switch(c){case s.GeometryType.enumPolygon:_=function(e,t,s,n,i){switch(n){case 4:return function(e,t,s){return $e(e,t,0,!0),1===It(e,t,s,!0)}(e,t,s);case 2:return lt(t,e,s,i);case 128:return ut(t,e,s);case 1:return lt(e,t,s,i);case 64:return ut(e,t,s);case 3:return ht(e,t,s,i);case 8:return function(e,t,s){return $e(e,t),Yt(e,t,s,null)}(e,t,s);case 32:return function(e,t,s,n){return $e(e,t),Xt(e,t,s,n)}(e,t,s,i)}return!1}(x,P,p,h,l);break;case s.GeometryType.enumPolyline:_=et(x,P,p,h,l);break;case s.GeometryType.enumPoint:_=tt(x,P,p,h);break;case s.GeometryType.enumMultiPoint:_=st(x,P,p,h);break;case s.GeometryType.enumEnvelope:_=nt(x,P,p,h,l)}break;case s.GeometryType.enumPolyline:switch(c){case s.GeometryType.enumPolygon:_=et(P,x,p,h,l);break;case s.GeometryType.enumPolyline:_=function(e,s,i,r,o){switch(r){case 4:return function(e,t,s){$e(e,t);const n=e.getImpl(),i=t.getImpl();return!new Ue(n,i,s,!0).next()||!Ft(e,t,s)}(e,s,i);case 2:return _t(s,e,i,o);case 128:return ft(s,e,i,o);case 1:return _t(e,s,i,o);case 64:return ft(e,s,i,o);case 3:return function(e,s,n,i){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),s.queryEnvelope(o),!!bt(r,o,n)&&($e(e,s),!!Gt(e,s,n)||(e.hasNonLinearSegments()||s.hasNonLinearSegments()?Ge(e,s,n,"**F**FFF*",i,!1):Rt(e,s,n,!1)))}(e,s,i,o);case 8:return function(e,s,i,r){$e(e,s);const o=[],a=qt(e,s,i,o);if(-2===a){const n=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty(),a=t.Envelope2D.constructEmpty();let h,l;if(e.queryEnvelope(n),s.queryEnvelope(o),n.inflateCoords(1e3*i,1e3*i),o.inflateCoords(1e3*i,1e3*i),a.setCoords({env2D:n}),a.intersect(o),e.getPointCount()>10){if(h=m.clip$1(e,a,i,0,r),h.isEmpty())return!1}else h=e;if(s.getPointCount()>10){if(l=m.clip$1(s,a,i,0,r),l.isEmpty())return!1}else l=s;return Ge(h,l,i,"F********",r,!1)}if(0!==a)return!1;const h=new n.MultiPoint;for(let e=0;e<o.length;e+=2){const t=o[e],s=o[e+1];h.addXY(t,s)}const l=e.getBoundary(),u=s.getBoundary();return l.addPoints(u,0,u.getPointCount()),!l.isEmpty()&&xt(l,h,i)}(e,s,i,o);case 32:return function(e,s,n,i){$e(e,s);const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();e.queryEnvelope(r),s.queryEnvelope(o);const a=Nt(r,o,n),h=Nt(o,r,n),l=e.hasNonLinearSegments(),u=s.hasNonLinearSegments(),c=qt(e,s,n,null);if(-1===c)return!1;if(1===c){if(a&&h)return!0;if(!l&&!u)return a&&!h?!kt(s,e,n,!1):h&&!a?!kt(e,s,n,!1):!kt(e,s,n,!1)&&!kt(s,e,n,!1)}const g=t.Envelope2D.constructEmpty(),d=t.Envelope2D.constructEmpty(),p=t.Envelope2D.constructEmpty();let _,f;g.setCoords({env2D:r}),g.inflateCoords(1e3*n,1e3*n),d.setCoords({env2D:o}),d.inflateCoords(1e3*n,1e3*n),p.setCoords({env2D:g}),p.intersect(d);let y="";if(y+="1*",a){if(s.getPointCount()>10){if(f=m.clip$1(s,p,n,0,i),f.isEmpty())return!1}else f=s;y+="****"}else f=s,y+="T***";if(h){if(e.getPointCount()>10){if(_=m.clip$1(e,p,n,0,i),_.isEmpty())return!1}else _=e;y+="***"}else _=e,y+="T**";return Ge(_,f,n,y,i,!1)}(e,s,i,o);case 16:return function(e,s,i,r){$e(e,s);const o=[],a=qt(e,s,i,o);if(-2===a){const n=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty(),a=t.Envelope2D.constructEmpty();let h,l;if(e.queryEnvelope(n),s.queryEnvelope(o),n.inflateCoords(1e3*i,1e3*i),o.inflateCoords(1e3*i,1e3*i),a.setCoords({env2D:n}),a.intersect(o),e.getPointCount()>10){if(h=m.clip$1(e,a,i,0,r),h.isEmpty())return!1}else h=e;if(s.getPointCount()>10){if(l=m.clip$1(s,a,i,0,r),l.isEmpty())return!1}else l=s;return Ge(h,l,i,"0********",r,!1)}if(0!==a)return!1;const h=new n.MultiPoint;for(let e=0;e<o.length;e+=2){const t=o[e],s=o[e+1];h.addXY(t,s)}const l=e.getBoundary(),u=s.getBoundary();return l.addPoints(u,0,u.getPointCount()),!!l.isEmpty()||!xt(l,h,i)}(e,s,i,o)}return!1}(x,P,p,h,l);break;case s.GeometryType.enumPoint:_=it(x,P,p,h);break;case s.GeometryType.enumMultiPoint:_=rt(x,P,p,h);break;case s.GeometryType.enumEnvelope:_=ot(x,P,p,h,l)}break;case s.GeometryType.enumPoint:switch(c){case s.GeometryType.enumPolygon:_=tt(P,x,p,h);break;case s.GeometryType.enumPolyline:_=it(P,x,p,h);break;case s.GeometryType.enumMultiPoint:_=at(P,x,p,h)}break;case s.GeometryType.enumMultiPoint:switch(c){case s.GeometryType.enumPolygon:_=st(P,x,p,h);break;case s.GeometryType.enumPolyline:_=rt(P,x,p,h);break;case s.GeometryType.enumMultiPoint:_=function(e,s,n,i){switch(i){case 4:return function(e,t,s){const n=e,i=t,o=new Ue(n,i,s,!1),a=s*s,m=new r.Point2D,h=new r.Point2D;for(;o.next();){const e=o.getRedElement(),t=o.getBlueElement();if(n.queryXY(e,m),i.queryXY(t,h),r.Point2D.sqrDistance(m,h)<=a)return!1}return!0}(e,s,n);case 2:case 128:return xt(s,e,n);case 1:case 64:return xt(e,s,n);case 3:return function(e,s,n){const i=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(i),s.queryEnvelope(o),!!bt(i,o,n)&&(!!function(e,t,s){if(e.getPointCount()!==t.getPointCount())return!1;const n=new r.Point2D,i=new r.Point2D;let o=!0;const a=s*s;for(let s=0;s<e.getPointCount();s++)if(e.queryXY(s,n),t.queryXY(s,i),r.Point2D.sqrDistance(n,i)>a){o=!1;break}return!!o}(e,s,n)||Mt(e,s,n,!1,!0,!1))}(e,s,n);case 32:return function(e,t,s){return Mt(e,t,s,!1,!1,!0)}(e,s,n)}return!1}(x,P,p,h);break;case s.GeometryType.enumPoint:_=at(x,P,p,h);break;case s.GeometryType.enumEnvelope:_=mt(x,P,p,h)}break;case s.GeometryType.enumEnvelope:switch(c){case s.GeometryType.enumPolygon:_=nt(P,x,p,h,l);break;case s.GeometryType.enumPolyline:_=ot(P,x,p,h,l);break;case s.GeometryType.enumMultiPoint:_=mt(P,x,p,h)}}return _}function Qe(e,s,n,r,o){if(e.isEmpty()||s.isEmpty())return 4===r;const a=e.getXY(),m=t.Envelope2D.constructEmpty();s.queryEnvelope(m);const h=function(e,s,n){let r;if(e instanceof Wr||null===e){const o=t.Envelope2D.constructEmpty();o.setCoords({pt:s}),o.mergeEnvelope2D(n),r=i.calculateToleranceFromGeometryForRel(e,o,!1)}else r=e;return r}(n,a,m);switch(r){case 4:return Je(a,m,h);case 2:case 128:return function(e,s,n){if(s.height()<=n||s.width()<=n)return!1;const i=t.Envelope2D.constructEmpty();return i.setCoords({env2D:s}),i.inflateCoords(-n,-n),i.containsExclusive(e)}(a,m,h);case 1:case 64:return!1;case 3:return function(e,s,n){const i=new t.Envelope2D;return i.setCoords({pt:e}),bt(i,s,n)}(a,m,h);case 8:return function(e,s,n){if(s.height()<=n||s.width()<=n)return!1;const i=new t.Envelope2D,r=new t.Envelope2D;return i.setCoords({env2D:s}),i.inflateCoords(n,n),!!i.contains(e)&&(r.setCoords({env2D:s}),r.inflateCoords(-n,-n),!r.containsExclusive(e))}(a,m,h)}return!1}function Ke(e,s,n){const i=t.Envelope2D.constructEmpty();return i.setCoords({env2D:s}),i.inflateCoords(n,n),!e.isIntersecting(i)}function $e(e,t,n,i=!1){const r=e.getGeometryType(),o=t.getGeometryType();if(s.isMultiVertex(r)){const t=e.getImpl().getAccelerators();if(null!==t){const e=t.getRasterizedGeometry();s.geometryReleaseAssert(null===e)}}if(s.isMultiVertex(o)){const e=t.getImpl().getAccelerators();if(null!==e){const t=e.getRasterizedGeometry();s.geometryReleaseAssert(null===t)}}return 0}function Je(e,s,n,i){const r=t.Envelope2D.constructEmpty();return r.setCoords({env2D:s}),r.inflateCoords(n,n),!r.contains(e)}function et(e,s,o,a,h){switch(a){case 4:return function(e,t,s){return $e(e,t,0,!0),1===It(e,t,s,!0)}(e,s,o);case 1:return function(e,s,r,o){const a=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();return e.queryEnvelope(a),s.queryEnvelope(h),!!Tt(a,h,r)&&($e(e,s),function(e,s,r,o){const a=[!1],h=wt(e,s,r,a);if(a[0])return h;const l=t.Envelope2D.constructEmpty();let u;if(s.queryEnvelope(l),l.inflateCoords(1e3*r,1e3*r),e.getPointCount()>10){if(u=m.clip$1(e,l,r,0,o),u.isEmpty())return!1}else u=e;return function(e,s,r,o){const a=new Xe;a.resetMatrix_(),a.setPredicates_("T*****F**"),a.setAreaLinePredicates_();const m=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();e.queryEnvelope(m),s.queryEnvelope(h);let l=!1;if(Ke(m,h,r)&&(a.areaLineDisjointPredicates_(e,s),l=!0),l||$e(e,s),l)return Oe(a.m_matrix,a.m_scl);const u=new n.EditShape,c=u.addGeometry(e),g=u.addGeometry(s);return a.setEditShapeCrackAndCluster_(u,new i.CombinedTolerance(r,0),o),0!==u.getPointCount(c)&&(a.computeMatrixTopoGraphHalfEdges_(c,g),a.m_topoGraph.removeShape(),Oe(a.m_matrix,a.m_scl))}(u,s,r,o)}(e,s,r,o))}(e,s,o,h);case 64:return function(e,s,n){const i=t.Envelope2D.constructEmpty(),r=t.Envelope2D.constructEmpty();return e.queryEnvelope(i),s.queryEnvelope(r),!!Tt(i,r,n)&&($e(e,s),2===It(e,s,n,!1))}(e,s,o);case 8:return ct(e,s,o,h);case 16:return function(e,s,n){return $e(e,s),function(e,s,n,i){const o=e.getImpl(),a=s.getImpl(),h=o.querySegmentIterator(),l=a.querySegmentIterator(),u=r.makePrimitiveArray(2,Number.NaN),c=r.makePrimitiveArray(2,Number.NaN),g=new Ue(o,a,n);let d=!1;for(;g.next();){const e=g.getRedElement(),t=g.getBlueElement();h.resetToVertex(e,-1),l.resetToVertex(t,-1);const s=h.nextSegment(),i=l.nextSegment();let r=0;if(Ut(s,i)?!d&&i.isIntersecting(s,n)&&(d=!0):r=i.intersect(s,null,c,u,n),2===r)d=!0;else if(r){const e=u[0],t=c[0];if(e>0&&e<1&&t>0&&t<1)return!0;d=!0}}if(!d)return!1;const p=t.Envelope2D.constructEmpty(),_=t.Envelope2D.constructEmpty(),f=t.Envelope2D.constructEmpty(),y=t.Envelope2D.constructEmpty(),x=t.Envelope2D.constructEmpty();if(e.queryEnvelope(p),s.queryEnvelope(_),Nt(_,p,n)){let t,r;if(f.setCoords({env2D:p}),f.inflateCoords(1e3*n,1e3*n),y.setCoords({env2D:_}),y.inflateCoords(1e3*n,1e3*n),x.setCoords({env2D:f}),x.intersect(y),e.getPointCount()>10){if(t=m.clip$1(e,x,n,0,i),t.isEmpty())return!1}else t=e;if(s.getPointCount()>10){if(r=m.clip$1(s,x,n,0,i),r.isEmpty())return!1}else r=s;return Ge(t,r,n,"T********",i,!1)}return Ge(e,s,n,"T*****T**",i,!1)}(e,s,n,null)}(e,s,o)}return!1}function tt(e,t,s,n,i){switch(n){case 4:return function(e,t,s){return 0===Zt(e,t,s)}(e,t,s);case 1:case 64:return function(e,t,s){return function(e,t,s){return 1===Qt(e,t,s)}(e,t.getXY(),s)}(e,t,s);case 8:return function(e,t,s){return function(e,t,s){return 2===Qt(e,t,s)}(e,t.getXY(),s)}(e,t,s)}return!1}function st(e,s,i,o,a){switch(o){case 4:return function(e,s,i){$e(e,s);const o=function(e,s,i){const o=t.Envelope2D.constructEmpty();e.queryEnvelope(o),o.inflateCoords(i,i);const a=new r.Point2D,m=e.getImpl(),h=new n.Polygon;let l=e,u=!1,c=!1,g=!1;for(let t=0;t<s.getPointCount();t++){if(s.queryXY(t,a),o.contains(a)){const e=Qt(l,a,i);if(1===e)return c=!0,4;if(2===e)return 4;g=!0}else g=!0;u||(!be(e,s.getPointCount()-1)||null!==m.getAccelerators()&&null!=m.getAccelerators().getQuadTree()?l=e:(e.copyTo(h),h.getImpl().buildQuadTreeAccelerator(1),l=h),u=!0)}return c?g?4:2:1}(e,s,i);return 1===o}(e,s,i);case 1:return gt(e,s,i,!1);case 64:return gt(e,s,i,!0);case 8:return function(e,s,i){$e(e,s);const o=t.Envelope2D.constructEmpty();e.queryEnvelope(o),o.inflateCoords(i,i);const a=new r.Point2D;let m=!1;const h=e.getImpl(),l=new n.Polygon;let u=e,c=!1;for(let t=0;t<s.getPointCount();t++){if(s.queryXY(t,a),o.contains(a)){const e=Qt(u,a,i);if(2===e)m=!0;else if(1===e)return!1}c||(!be(e,s.getPointCount()-1)||null!==h.getAccelerators()&&null!==h.getAccelerators().getQuadTree()?u=e:(e.copyTo(l),l.getImpl().buildQuadTreeAccelerator(1),u=l),c=!0)}return!!m}(e,s,i);case 16:return function(e,s,i){$e(e,s);const o=new t.Envelope2D,a=new t.Envelope2D,m=new t.Envelope2D;e.queryEnvelope(o),s.queryEnvelope(m),a.setCoords({env2D:o}),a.inflateCoords(i,i);let h=!1,l=!1;const u=new r.Point2D,c=e.getImpl(),g=new n.Polygon;let d=e,p=!1;for(let t=0;t<s.getPointCount();t++){if(s.queryXY(t,u),a.contains(u)){const e=Qt(d,u,i);0===e?l=!0:1===e&&(h=!0)}else l=!0;if(h&&l)return!0;p||(!be(e,s.getPointCount()-1)||null!==c.getAccelerators()&&null!==c.getAccelerators().getQuadTree()?d=e:(e.copyTo(g),g.getImpl().buildQuadTreeAccelerator(1),d=g),p=!0)}return!1}(e,s,i)}return!1}function nt(e,s,i,r,o){if(function(e,s,n){$e(e,s);const i=t.Envelope2D.constructEmpty(),r=t.Envelope2D.constructEmpty();return e.queryEnvelope(i),s.queryEnvelope(r),!Tt(r,i,n)&&(0===Qt(e,r.getLowerLeft(),0)&&!r.contains(e.getXY(0))&&!Ot(e,r,n))}(e,s,i))return 4===r;if(4===r)return!1;switch(r){case 2:return dt(e,s,i,!1);case 128:return dt(e,s,i,!0);case 1:return pt(e,s,i,!1,o);case 64:return pt(e,s,i,!0,o);case 3:return function(e,s,i,r){const o=new t.Envelope2D,a=new t.Envelope2D;if(e.queryEnvelope(o),s.queryEnvelope(a),!bt(o,a,i))return!1;const m=new n.Polygon;return m.addEnvelope(s,!1),ht(e,m,i,r)}(e,s,i,o);case 8:return function(e,s,i,r){$e(e,s);const o=new t.Envelope2D,a=new t.Envelope2D;if(e.queryEnvelope(o),s.queryEnvelope(a),Tt(a,o,i))return!1;if(a.height()<=i||a.width()<=i)return!1;const m=new n.Polygon;return m.addEnvelope(s,!1),Yt(e,m,i,r)}(e,s,i,o);case 32:return function(e,s,i,r){$e(e,s);const o=new t.Envelope2D,a=new t.Envelope2D;if(e.queryEnvelope(o),s.queryEnvelope(a),Tt(a,o,i))return!1;if(a.height()<=i||a.width()<=i)return!1;const m=new n.Polygon;return m.addEnvelope(s,!1),Xt(e,m,i,r)}(e,s,i,o);case 16:return!1}return!1}function it(e,t,s,n,i){switch(n){case 4:return function(e,t,s){return $e(e,t),!Ht(e,t.getXY(),s)}(e,t,s);case 1:case 64:return function(e,t,s){return $e(e,t),function(e,t,s){return Ht(e,t,s)&&!zt(e,t,s)}(e,t.getXY(),s)}(e,t,s);case 8:return function(e,t,s){return $e(e,t),zt(e,t.getXY(),s)}(e,t,s)}return!1}function rt(e,s,i,o,a){switch(o){case 4:return function(e,t,s){return $e(e,t),!Vt(e,t,s,!1)}(e,s,i);case 1:case 64:return function(e,s,n){const i=t.Envelope2D.constructEmpty(),r=t.Envelope2D.constructEmpty();if(e.queryEnvelope(i),s.queryEnvelope(r),!Tt(i,r,n))return!1;$e(e,s);const o=Vt(e,s,n,!0);if(!o)return o;const a=e.getBoundary();return a.isEmpty()?o:!xt(a,s,n)}(e,s,i);case 8:return function(e,t,s){$e(e,t);const i=e.getImpl(),r=t.getImpl(),o=new n.MultiPoint,a=new Ue(i,r,s,!1),m=i.querySegmentIterator();let h=!1;for(;a.next();){const e=a.getRedElement(),t=a.getBlueElement();m.resetToVertex(e,-1);const n=m.nextSegment(),i=r.getXY(t);n.isIntersectingPoint(i,s)&&(h=!0,o.addPoint2D(i))}if(!h)return!1;const l=e.getBoundary();return!l.isEmpty()&&xt(l,o,s)}(e,s,i);case 16:return function(e,t,s){$e(e,t);const i=e.getImpl(),o=t.getImpl(),a=o.getPointCount(),m=r.makePrimitiveArray(a,!1),h=new Ue(i,o,s,!1),l=i.querySegmentIterator();let u=!1;for(;h.next();){const e=h.getRedElement(),t=h.getBlueElement();l.resetToVertex(e,-1);const n=l.nextSegment(),i=o.getXY(t);n.isIntersectingPoint(i,s)&&(u=!0,m[t]=!0)}if(!u)return!1;let c=!1;for(let e=0;e<a;e++)if(!m[e]){c=!0;break}if(!c)return!1;const g=e.getBoundary();if(g.isEmpty())return!0;const d=new n.MultiPoint;for(let e=0;e<a;e++)m[e]&&d.addPoint2D(o.getXY(e));return!xt(g,d,s)}(e,s,i)}return!1}function ot(e,i,o,a,m){if(function(e,s,n){const i=t.Envelope2D.constructEmpty(),r=t.Envelope2D.constructEmpty();e.queryEnvelope(i),s.queryEnvelope(r);const o=function(e,s,n){const i=t.Envelope2D.constructEmpty();return i.setCoords({env2D:e}),i.inflateCoords(n,n),i.containsEnvelope(s)?1073741824:i.isIntersecting(s)?e.isIntersecting(s)?e.xmin<s.xmin&&s.xmax<e.xmax?s.ymin<e.ymin&&s.ymax>e.ymax?0:1073741824:e.ymin<s.ymin&&s.ymax<e.ymax?s.xmin<e.xmin&&s.xmax>e.xmax?0:1073741824:0:0:4}(r,i,n);return 0===o?!Ot(e,r,n):4===o}(e,i,o))return 4===a;if(4===a)return!1;switch(a){case 2:return yt(e,i,o,!1);case 128:return yt(e,i,o,!0);case 1:case 64:case 32:return!1;case 3:return function(e,s,n){const i=new t.Envelope2D,r=new t.Envelope2D;return e.queryEnvelope(i),s.queryEnvelope(r),!(r.height()>n&&r.width()>n)&&bt(i,r,n)}(e,i,o);case 8:return function(e,i,o,a){const m=new t.Envelope2D,h=new t.Envelope2D;if(e.queryEnvelope(m),i.queryEnvelope(h),h.height()<=o||h.width()<=o)return!1;const l=new t.Envelope2D,u=new t.Envelope2D;if(l.setCoords({env2D:h}),u.setCoords({env2D:h}),l.inflateCoords(o,o),u.inflateCoords(-o,-o),u.containsEnvelope(m)||!m.isIntersecting(l))return!1;const c=e.getImpl().querySegmentIterator();c.stripAttributes();const g=e.getImpl().getAccelerators();let d=null,p=null;null!==g&&(d=g.getQuadTree(),null!==d&&(p=d.getIterator(h,o))),p||c.nextPath()||s.throwInternalErrorException("relational_operations");let _=!1,f=null;const y=new r.Point2D,x=new r.Point2D,P=e.hasNonLinearSegments();let E=!1;for(;;){if(null!==p){const e=p.next();if(-1===e)break;c.resetToVertex(d.getElement(e),-1),f=c.nextSegment()}else{for(;!c.hasNextSegment()&&c.nextPath(););if(!c.hasNextSegment())break;f=c.nextSegment()}if(P&&f.getGeometryType()!==s.GeometryType.enumLine){const e=new t.Envelope2D;if(f.queryEnvelope(e),u.containsEnvelope(e))return!1;if(l.isIntersecting(e)){E=!0;break}}else{y.assign(f.getStartXY()),x.assign(f.getEndXY());let e=u.clipLine(y,x);if(0!==e)return!1;_||(e=l.clipLine(y,x),0!==e&&(_=!0))}}if(!E)return _;const v=new n.Polygon;return v.addEnvelope(h,!1),ct(v,e,o,a)}(e,i,o,m);case 16:return function(e,i,o){const a=new t.Envelope2D,m=new t.Envelope2D;if(e.queryEnvelope(a),i.queryEnvelope(m),m.height()<=o||m.width()<=o)return!1;const h=new t.Envelope2D;if(h.setCoords({env2D:m}),h.inflateCoords(o,o),h.containsEnvelope(a))return!1;const l=new t.Envelope2D;if(l.setCoords({env2D:m}),l.inflateCoords(-o,-o),!l.isIntersecting(a))return!1;const u=e.getImpl().querySegmentIterator();u.stripAttributes();const c=e.getImpl().getAccelerators();let g=null,d=null;if(null!==c&&(g=c.getQuadTree(),null!==g&&(d=g.getIterator(m,o))),!d){const e=u.nextPath();s.geometryReleaseAssert(e)}let p=!1,_=null;const f=new r.Point2D,y=new r.Point2D;let x=null,P=null,E=null,v=null;for(e.hasNonLinearSegments()&&(x=new n.Line,P=new n.Line,E=new n.Line,v=new n.Line,l.querySide(0,x),l.querySide(1,P),l.querySide(2,E),l.querySide(3,v));;){if(null!==d){const e=d.next();if(-1===e)break;u.resetToVertex(g.getElement(e),-1),_=u.nextSegment()}else{for(;!u.hasNextSegment()&&u.nextPath(););if(!u.hasNextSegment())break;_=u.nextSegment()}if(_.getGeometryType()===s.GeometryType.enumLine){if(f.assign(_.getStartXY()),y.assign(_.getEndXY()),0!==l.clipLine(f,y)){p=!0;break}}else{if(x.isIntersecting(_,o)){p=!0;break}if(P.isIntersecting(_,o)){p=!0;break}if(E.isIntersecting(_,o)){p=!0;break}if(v.isIntersecting(_,o)){p=!0;break}}}return p&&!0}(e,i,o)}return!1}function at(e,t,s,n,i){switch(n){case 4:return Et(e,t,s);case 2:case 128:return function(e,t,s){return Pt(e,t,s)}(e,t,s);case 1:case 64:return function(e,t,s){return!Et(e,t,s)}(e,t,s);case 3:return Pt(e,t,s)}return!1}function mt(e,s,n,i,o){switch(i){case 4:return function(e,s,n){const i=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();if(e.queryEnvelope(i),s.queryEnvelope(o),Tt(o,i,n))return!1;const a=t.Envelope2D.constructEmpty();a.setCoords({env2D:o}),a.inflateCoords(n,n);const m=new r.Point2D;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,m),a.contains(m))return!1;return!0}(e,s,n);case 2:return vt(e,s,n,!1);case 128:return vt(e,s,n,!0);case 1:case 64:return!1;case 3:return function(e,s,n){const i=new t.Envelope2D,r=new t.Envelope2D;return e.queryEnvelope(i),s.queryEnvelope(r),!(r.height()>n||r.width()>n)&&bt(i,r,n)}(e,s,n);case 8:return function(e,s,n){const i=new t.Envelope2D,o=new t.Envelope2D,a=new t.Envelope2D;if(s.queryEnvelope(i),i.height()<=n||i.width()<=n)return!1;o.setCoords({env2D:i}),a.setCoords({env2D:i}),o.inflateCoords(n,n),a.inflateCoords(-n,-n);const m=new r.Point2D;let h=!1;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,m),o.contains(m)){if(a.containsExclusive(m))return!1;h=!0}return h}(e,s,n);case 16:return function(e,s,n){const i=new t.Envelope2D,o=new t.Envelope2D;if(e.queryEnvelope(i),s.queryEnvelope(o),Tt(o,i,n))return!1;if(o.height()<=n||o.width()<=n)return!1;const a=new t.Envelope2D,m=new t.Envelope2D;a.setCoords({env2D:o}),a.inflateCoords(-n,-n),m.setCoords({env2D:o}),m.inflateCoords(n,n);const h=new r.Point2D;let l=!1,u=!1;for(let t=0;t<e.getPointCount();t++)if(e.queryXY(t,h),!l&&a.containsExclusive(h)&&(l=!0),u||m.contains(h)||(u=!0),l&&u)return!0;return!1}(e,s,n)}return!1}function ht(e,s,n,i){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();if(e.queryEnvelope(r),s.queryEnvelope(o),!bt(r,o,n))return!1;if($e(e,s),Gt(e,s,n))return!0;const a=e.calculateLength2D(),m=s.calculateLength2D(),h=Math.max(e.getPointCount(),s.getPointCount());return!(Math.abs(a-m)>4*h*n)&&(e.hasNonLinearSegments()||s.hasNonLinearSegments()?Ge(e,s,n,"**F**FFF*",i,!1):Rt(e,s,n,!0))}function lt(e,s,n,i){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),s.queryEnvelope(o),!!Tt(r,o,n)&&($e(e,s),Lt(e,s,n,i))}function ut(e,s,n,i){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),s.queryEnvelope(o),!!Tt(r,o,n)&&($e(e,s),2===It(e,s,n,!1))}function ct(e,s,n,i){return $e(e,s),function(e,s,n,i){const o=e.getImpl(),a=s.getImpl(),h=o.querySegmentIterator(),l=a.querySegmentIterator(),u=r.makePrimitiveArray(2,Number.NaN),c=r.makePrimitiveArray(2,Number.NaN),g=new Ue(o,a,n);let d=!1;for(;g.next();){const e=g.getRedElement(),t=g.getBlueElement();h.resetToVertex(e,-1),l.resetToVertex(t,-1);const s=h.nextSegment(),i=l.nextSegment();let r=0;if(Ut(s,i)?!d&&i.isIntersecting(s,n)&&(d=!0):r=i.intersect(s,null,c,u,n),2===r)d=!0;else if(r){const e=u[0],t=c[0];if(e>0&&e<1&&t>0&&t<1)return!1;d=!0}}if(!d)return!1;const p=t.Envelope2D.constructEmpty(),_=t.Envelope2D.constructEmpty(),f=t.Envelope2D.constructEmpty();let y,x;if(e.queryEnvelope(p),s.queryEnvelope(_),p.inflateCoords(1e3*n,1e3*n),_.inflateCoords(1e3*n,1e3*n),f.setCoords({env2D:p}),f.intersect(_),e.getPointCount()>10){if(y=m.clip$1(e,f,n,0,i),y.isEmpty())return!1}else y=e;if(s.getPointCount()>10){if(x=m.clip$1(s,f,n,0,i),x.isEmpty())return!1}else x=s;return Ge(y,x,n,"F********",i,!1)}(e,s,n,i)}function gt(e,s,i,o,a){const m=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();if(e.queryEnvelope(m),s.queryEnvelope(h),!Tt(m,h,i))return!1;$e(e,s);let l=!1;const u=new r.Point2D,c=e.getImpl(),g=new n.Polygon;let d=e,p=!1;for(let t=0;t<s.getPointCount();t++){if(s.queryXY(t,u),!m.contains(u))return!1;const n=Qt(d,u,i);if(1===n)l=!0;else if(0===n)return!1;if(o&&2===n)return!1;p||(!be(e,s.getPointCount()-1)||null!==c.getAccelerators()&&null!==c.getAccelerators().getQuadTree()?d=e:(e.copyTo(g),g.getImpl().buildQuadTreeAccelerator(1),d=g),p=!0)}return l}function dt(e,s,n,i,r){const o=t.Envelope2D.constructEmpty(),a=t.Envelope2D.constructEmpty();return e.queryEnvelope(o),s.queryEnvelope(a),i?At(a,o,n):Tt(a,o,n)}function pt(e,s,i,r,o){const a=t.Envelope2D.constructEmpty(),m=t.Envelope2D.constructEmpty();if(e.queryEnvelope(a),s.queryEnvelope(m),!Tt(a,m,i))return!1;$e(e,s);const h=new n.Polygon;return h.addEnvelope(s,!1),r?2===It(e,h,i,!1):Lt(e,h,i,o)}function _t(e,s,n,i){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),s.queryEnvelope(o),!!Tt(r,o,n)&&($e(e,s),e.hasNonLinearSegments()||s.hasNonLinearSegments()?Ge(e,s,n,"******FF*",i,!1):kt(s,e,n,!1))}function ft(e,s,n,i){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),s.queryEnvelope(o),!!Tt(r,o,n)&&($e(e,s),Ge(e,s,n,"T**FF*FF*",i,!1))}function yt(e,i,r,o,a){const m=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();if(e.queryEnvelope(m),i.queryEnvelope(h),h.height()<=r||h.width()<=r)return!1;if(o)return At(h,m,r);if(!Tt(h,m,r))return!1;const l=t.Envelope2D.constructEmpty();l.setCoords({env2D:h}),l.inflateCoords(-r,-r);const u=t.Envelope2D.constructEmpty();if(u.setCoords({env2D:h}),u.inflateCoords(r,r),l.containsEnvelope(m))return!0;const c=e.getImpl().querySegmentIterator();c.stripAttributes(),c.nextPath()||s.throwInternalErrorException("relational_operations");let g,d,p,_,f,y,x=!1;const P=e.hasNonLinearSegments();for(P&&(p=new n.Line,_=new n.Line,f=new n.Line,y=new n.Line,l.querySide(0,p),l.querySide(1,_),l.querySide(2,f),l.querySide(3,y));;){for(;!c.hasNextSegment()&&c.nextPath(););if(!c.hasNextSegment())break;const e=c.nextSegment();if(P&&e.getGeometryType()!==s.GeometryType.enumLine){if(e.isIntersecting(p,r)){x=!0;break}if(e.isIntersecting(_,r)){x=!0;break}if(e.isIntersecting(f,r)){x=!0;break}if(e.isIntersecting(y,r)){x=!0;break}}else if(g=e.getStartXY(),d=e.getEndXY(),0!==l.clipLine(g,d)){x=!0;break}}return x}function xt(e,s,n,i){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),s.queryEnvelope(o),!!Tt(r,o,n)&&Mt(s,e,n,!0,!1,!1)}function Pt(e,s,n,i){const r=t.Envelope2D.constructEmpty(),o=t.Envelope2D.constructEmpty();return e.queryEnvelope(r),s.queryEnvelope(o),bt(r,o,n)}function Et(e,t,s,n){return Bt(e,t.getXY(),s)}function vt(e,s,n,i,o){const a=t.Envelope2D.constructEmpty(),m=t.Envelope2D.constructEmpty();if(e.queryEnvelope(a),s.queryEnvelope(m),m.height()<=n||m.width()<=n)return!1;if(i)return At(m,a,n);if(!Tt(m,a,n))return!1;let h=!1;const l=t.Envelope2D.constructEmpty(),u=t.Envelope2D.constructEmpty();l.setCoords({env2D:m}),u.setCoords({env2D:m}),l.inflateCoords(-n,-n),u.inflateCoords(n,n);const c=new r.Point2D;for(let t=0;t<e.getPointCount();t++){if(e.queryXY(t,c),!u.contains(c))return!1;l.containsExclusive(c)&&(h=!0)}return h}function Ct(e,t,s,n){return r.Point2D.sqrDistance(e,t)<=s*s}function Dt(e,t,s,n){return Ct(e,t,s)}function bt(e,t,s,n){return Tt(e,t,s)&&Tt(t,e,s)}function St(e,s,n,i,r){if(e.height()<=n||e.width()<=n)return!1;if(i)return At(e,s,n);if(!Tt(e,s,n))return!1;const o=t.Envelope2D.constructEmpty();return o.setCoords({env2D:e}),o.inflateCoords(-n,-n),o.intersect(s),!o.isEmpty()}function It(e,i,o,a,m){const h=new r.Point2D,l=new r.Point2D,u=t.Envelope2D.constructEmpty(),c=t.Envelope2D.constructEmpty(),g=e.getImpl(),d=i.getImpl(),p=d.getGeometryType(),_=new Ue(g,d,o,!0);if(!_.next())return 1;if(Ft(e,i,o))return a?4:0;const f=new n.Polygon;let y=e;const x=new n.Polygon;let P=null;p===s.GeometryType.enumPolygon&&(P=i);const E=p===s.GeometryType.enumPolygon?r.makePrimitiveArray(g.getPathCount(),!1):[],v=r.makePrimitiveArray(d.getPathCount(),!1);let C=!1,D=!1,b=!1,S=!1,I=!1,w=!1;do{if(b&&I||S&&w)break;if(b&&S)break;const t=_.getRedElement(),n=_.getBlueElement();if(!v[n]&&(l.assign(i.getXY(i.getPathStart(n))),u.setCoords({env2D:_.getRedEnvelope()}),u.inflateCoords(o,o),u.contains(l))){if(0!==Qt(y,l,0)){if(S=!0,a)return 4}else w=!0;v[n]=!0}if(p===s.GeometryType.enumPolygon&&!E[t]&&(h.assign(e.getXY(e.getPathStart(t))),c.setCoords({env2D:_.getBlueEnvelope()}),c.inflateCoords(o,o),c.contains(h))){if(0!==Qt(P,h,0)){if(b=!0,a)return 4}else I=!0;E[t]=!0}if(C||(!be(e,i.getPathCount()-1)||null!==g.getAccelerators()&&null!==g.getAccelerators().getQuadTree()?y=e:(e.copyTo(f),f.getImpl().buildQuadTreeAccelerator(1),y=f),C=!0),p===s.GeometryType.enumPolygon&&!D){const t=i;!be(t,e.getPathCount()-1)||null!==d.getAccelerators()&&null!==d.getAccelerators().getQuadTree()?P=i:(t.copyTo(x),x.getImpl().buildQuadTreeAccelerator(1),P=x),D=!0}}while(_.next());if(!b&&!S)return 1;if(!I||!w){if(p===s.GeometryType.enumPolygon)for(let e=0,t=g.getPathCount();e<t;e++)if(!E[e]){I=!0;break}for(let e=0,t=d.getPathCount();e<t;e++)if(!v[e]){w=!0;break}}return b&&I||S&&w||b&&S?4:S?2:3}function wt(e,i,r,o,a){o[0]=!1;const m=e.getImpl(),h=i.getImpl(),l=m.querySegmentIterator(),u=h.querySegmentIterator(),c=[0,0],g=[0,0],d=new Ue(m,h,r);let p=!1;for(;d.next();){const e=d.getRedElement(),t=d.getBlueElement();l.resetToVertex(e,-1),u.resetToVertex(t,-1);const s=l.nextSegment(),n=u.nextSegment();let i=0;if(Ut(s,n)?!p&&n.isIntersecting(s,r)&&(p=!0):i=n.intersect(s,null,g,c,r),0!==i&&(p=!0,1===i)){const e=c[0],t=g[0];if(e>0&&e<1&&t>0&&t<1)return o[0]=!0,!1}}if(!p){o[0]=!0;const a=t.Envelope2D.constructEmpty();e.queryEnvelope(a),a.inflateCoords(r,r);const l=new n.Polygon;let u=e,c=!1;for(let n=0,r=i.getPathCount();n<r;n++)if(i.getPathSize(n)>0){const r=t.Envelope2D.constructEmpty();if(i.queryPathEnvelope(n,r),!a.isIntersecting(r))return!1;{const e=De(u,i.getXY(i.getPathStart(n)),0);if(s.geometryReleaseAssert(-1!==e),0===e)return!1}c||(!be(e,i.getPathCount()-1)||null!==m.getAccelerators()&&null!==m.getAccelerators().getQuadTree()?u=e:(e.copyTo(l),l.getImpl().buildQuadTreeAccelerator(1),u=l),c=!0)}if(1===e.getPathCount()||i.getGeometryType()===s.GeometryType.enumPolyline)return!0;const g=i,d=t.Envelope2D.constructEmpty();g.queryEnvelope(d),d.inflateCoords(r,r);const p=new n.Polygon;let _=g,f=!1;for(let n=0,i=e.getPathCount();n<i;n++)if(e.getPathSize(n)>0){const i=t.Envelope2D.constructEmpty();if(e.queryPathEnvelope(n,i),d.isIntersecting(i)){const t=De(_,e.getXY(e.getPathStart(n)),0);if(s.geometryReleaseAssert(-1!==t),1===t)return!1}f||(!be(g,e.getPathCount()-1)||null!==h.getAccelerators()&&null!==h.getAccelerators().getQuadTree()?_=g:(g.copyTo(p),p.getImpl().buildQuadTreeAccelerator(1),_=p),f=!0)}return!0}return!1}function Tt(e,s,n){const i=t.Envelope2D.constructEmpty();return i.setCoords({env2D:e}),i.inflateCoords(n,n),i.containsEnvelope(s)}function At(e,s,n){const i=t.Envelope2D.constructEmpty();return i.setCoords({env2D:s}),i.inflateCoords(n,n),e.containsExclusiveEnvelope(i)}function Nt(e,s,n){const i=t.Envelope2D.constructEmpty();return i.setCoords({env2D:s}),i.inflateCoords(n,n),!(i.contains(e.getLowerLeft())&&i.contains(e.getLowerRight())&&i.contains(e.getUpperLeft())&&i.contains(e.getUpperRight()))}function Gt(e,t,s,n){if(e.getPathCount()!==t.getPathCount()||e.getPointCount()!==t.getPointCount())return!1;if(e.hasNonLinearSegments()||t.hasNonLinearSegments())return e.equals(t);const i=new r.Point2D,o=new r.Point2D;let a=!0;const m=s*s;for(let s=0;s<e.getPathCount();s++){if(e.getPathEnd(s)!==t.getPathEnd(s)){a=!1;break}for(let n=e.getPathStart(s);n<t.getPathEnd(s);n++)if(e.queryXY(n,i),t.queryXY(n,o),r.Point2D.sqrDistance(i,o)>m){a=!1;break}if(!a)break}return!!a}function Mt(e,t,s,n,i,o,a){const m=e.getImpl(),h=t.getImpl(),l=m.getPointCount(),u=h.getPointCount(),c=r.makePrimitiveArray(l,!1),g=i||o?r.makePrimitiveArray(u,!1):[],d=s*s,p=new Ue(m,h,s);for(;p.next();){const e=p.getRedElement(),t=p.getBlueElement(),s=m.getXY(e),n=h.getXY(t);r.Point2D.sqrDistance(s,n)<=d&&(c[e]=!0,(i||o)&&(g[t]=!0))}let _=!1,f=!1;for(let e=0;e<l;e++){const t=c[e];if(_||=!t,f||=t,(i||n)&&_)return!1}if(n)return!0;let y=!1,x=!1;for(let e=0;e<u;e++){const t=g[e];if(y||=!t,x||=t,i&&y)return!1}return!!i||_&&f&&y&&x}function Rt(e,t,s,n){return kt(e,t,s,n)&&kt(t,e,s,n)}function kt(e,n,o,a){if(s.throwIfCurves(e),s.throwIfCurves(n),n.isEmpty())return!1;let m=!0;const h=r.makePrimitiveArray(2,Number.NaN),l=r.makePrimitiveArray(2,Number.NaN),u=[],c=new Wt;let g;const d=t.Envelope2D.constructEmpty(),p=t.Envelope2D.constructEmpty(),_=t.Envelope2D.constructEmpty();e.queryEnvelope(d),n.queryEnvelope(p),d.inflateCoords(o,o),p.inflateCoords(o,o),_.setCoords({env2D:d}),_.intersect(p);const f=e.getImpl().querySegmentIterator(),y=n.getImpl().querySegmentIterator(),x=n.getImpl().getAccelerators();let P=null,E=null,v=null,C=null;if(null!==x&&(P=x.getQuadTree(),E=x.getQuadTreeForPaths(),null!==E&&(C=E.getIteratorForQT())),null===P){const t=e.getPointCount(),s=n.getPointCount();t>10&&s>10&&(P=i.buildQuadTree(n.getImpl(),_))}for(null!==P&&(v=P.getIteratorForQT());f.nextPath();)for(;f.hasNextSegment();){let e=f.nextSegment();if(e.queryEnvelope(d),!d.isIntersecting(_))return m=!1,!1;if(null!==C&&(C.resetIterator(d,o),-1===C.next()))continue;let t=0,n=null;if(null!=v)v.resetIterator(e,o);else if(y.resetToFirstPath(),!y.nextPath())return m=!1,!1;do{if(t=0,null!==v){const s=v.next();if(-1===s)return m=!1,!1;y.resetToVertex(P.getElement(s),-1),n=y.nextSegment(),t=e.intersect(n,null,h,l,o)}else{for(;!y.hasNextSegment();)if(!y.nextPath())return m=!1,!1;n=y.nextSegment(),n.queryEnvelope(p),p.inflateCoords(o,o),d.isIntersecting(p)&&(t=e.intersect(n,null,h,l,o))}}while(2!==t||0!==h[0]||a&&!(l[0]<=l[1]));let r=Number.NaN,x=!1;do{let s=!1;if(1===h[1]){if(!f.hasNextSegment()){x=!0;break}e=f.nextSegment(),s=!0}if(1===l[1]&&l[0]<=l[1]){if(-1===r)break;if(r=1,!y.hasNextSegment())break;n=y.nextSegment(),s=!0}if(0===l[1]&&l[0]>l[1]){if(1===r)break;if(Number.isNaN(r)){if(!y.hasPreviousSegment())break;y.previousSegment(),r=-1}if(!y.hasPreviousSegment())break;n=y.previousSegment(),s=!0}if(!s)break;t=e.intersect(n,null,h,l,o)}while(2===t&&(!a||l[0]<=l[1]));if(x)continue;const E=e.calculateLength2D();e.queryEnvelope(d),u.length=0,c.m_overlapEvents.length=0;let D=!1,b=!1,S=0;const I=i.calculateToleranceFromGeometryForRel(null,d,!0);for(null!==v?v.resetIterator(e,o):(y.resetToFirstPath(),y.nextPath()||s.throwInternalErrorException("relational_operations"));;){if(t=0,null!==v){const s=v.next();if(-1===s)break;y.resetToVertex(P.getElement(s),-1),n=y.nextSegment(),t=e.intersect(n,null,h,l,o)}else{for(;!y.hasNextSegment()&&y.nextPath(););if(!y.hasNextSegment())break;n=y.nextSegment(),n.queryEnvelope(p),p.inflateCoords(o,o),d.isIntersecting(p)&&(t=e.intersect(n,null,h,l,o))}if(2===t&&(!a||l[0]<=l[1])){const e=f.getStartPointIndex(),t=f.getPathIndex(),s=y.getStartPointIndex(),n=y.getPathIndex();if(g=jt(e,t,h[0],h[1],s,n,l[0],l[1]),c.m_overlapEvents.push(g),u.push(u.length),!(D||g.m_scalarA0<S&&g.m_scalarA1<S))if(0===S&&E*(g.m_scalarA0-S)>o)D=!0;else if(0!==S&&E*(g.m_scalarA0-S)>I)D=!0;else if(S=g.m_scalarA1,E*(1-S)<=o||1===S){b=!0;break}}}if(!b){if(!D)return m=!1,!1;u.length>1&&u.sort((e,t)=>c.compareOverlapEvents(e,t)),S=0;for(let e=0;e<c.m_overlapEvents.length;e++)if(g=c.m_overlapEvents[u[e]],!(g.m_scalarA0<S&&g.m_scalarA1<S)){if(0===S&&E*(g.m_scalarA0-S)>o)return m=!1,!1;if(0!==S&&E*(g.m_scalarA0-S)>I)return m=!1,!1;if(S=g.m_scalarA1,E*(1-S)<=o||1===S)break}if(E*(1-S)>o)return m=!1,!1;u.length=0,c.m_overlapEvents.length=0}}return m}function Ft(e,t,s){const n=e.getImpl(),i=t.getImpl(),r=n.querySegmentIterator(),o=i.querySegmentIterator(),a=new Ue(n,i,s);for(;a.next();){const e=a.getRedElement(),t=a.getBlueElement();r.resetToVertex(e,-1),o.resetToVertex(t,-1);const n=r.nextSegment();if(o.nextSegment().isIntersecting(n,s))return!0}return!1}function qt(e,t,s,n){const i=e.getImpl(),o=t.getImpl(),a=i.querySegmentIterator(),m=o.querySegmentIterator(),h=r.makePrimitiveArray(2,Number.NaN),l=new Ue(i,o,s);let u=!1,c=-1;for(;l.next();){const e=l.getRedElement(),t=l.getBlueElement();a.resetToVertex(e,-1),m.resetToVertex(t,-1);const i=a.nextSegment(),o=m.nextSegment();let g=0;if(Ut(i,o)){if(o.isIntersecting(i,s))return-2}else g=i.intersect(o,null,h,null,s);if(g)if(2===g){const e=i.calculateLength2D(),t=h[0];if(e*(h[1]-t)>s)return c=1,c;u=!0}else if(c=0,n){const e=h[0],t=new r.Point2D;i.queryCoord2D(e,t),n.push(t.x),n.push(t.y)}}return u?-2:c}function Vt(e,t,s,n){const i=e.getImpl(),o=t,a=o.getPointCount(),m=n?r.makePrimitiveArray(a,!1):[],h=new Ue(i,o,s,!1),l=i.querySegmentIterator();for(;h.next();){const e=h.getRedElement(),t=h.getBlueElement();l.resetToVertex(e,-1);const i=l.nextSegment(),r=o.getXY(t);if(i.isIntersectingPoint(r,s)){if(!n)return!0;m[t]=!0}}if(!n)return!1;for(let e=0;e<a;e++)if(!m[e])return!1;return!0}function Ht(e,s,n){const i=new r.Point2D,o=n*n,a=e.querySegmentIterator(),m=e.getImpl().getAccelerators();if(null!==m){const e=m.getQuadTree();if(null!==e){const m=t.Envelope2D.constructEmpty();m.setCoords({pt:s});const h=e.getIterator(m,n);for(let t=h.next();-1!==t;t=h.next())if(a.resetToVertex(e.getElement(t),-1),a.hasNextSegment()){const e=a.nextSegment(),t=e.getClosestCoordinate(s,!1);if(e.queryCoord2D(t,i),r.Point2D.sqrDistance(s,i)<=o)return!0}return!1}}const h=t.Envelope2D.constructEmpty();for(;a.nextPath();)for(;a.hasNextSegment();){const e=a.nextSegment();if(e.queryEnvelope(h),h.inflateCoords(n,n),!h.contains(s))continue;const t=e.getClosestCoordinate(s,!1);if(e.queryCoord2D(t,i),r.Point2D.sqrDistance(s,i)<=o)return!0}return!1}function Ot(e,i,o,a){const m=e.querySegmentIterator(),h=e.getImpl().getAccelerators(),l=e.hasNonLinearSegments();let u=null,c=null,g=null,d=null;if(null!==h){const e=h.getQuadTree();if(null!==e){const r=e.getIterator(i,o);l&&(u=new n.Line,c=new n.Line,g=new n.Line,d=new n.Line,i.querySide(0,u),i.querySide(1,c),i.querySide(2,g),i.querySide(3,d));const a=t.Envelope2D.constructEmpty();a.setCoords({env2D:i}),a.inflateCoords(o,o);for(let t=r.next();-1!==t;t=r.next())if(m.resetToVertex(e.getElement(t),-1),m.hasNextSegment()){const e=m.nextSegment();if(e.getGeometryType()===s.GeometryType.enumLine){const t=e.getStartXY(),s=e.getEndXY();if(a.clipLine(t,s))return!0;continue}if(i.contains(e.getStartXY())||i.contains(e.getEndXY()))return!0;if(e.isIntersecting(u,o))return!0;if(e.isIntersecting(c,o))return!0;if(e.isIntersecting(g,o))return!0;if(e.isIntersecting(d,o))return!0}return!1}}if(l){u=new n.Line,c=new n.Line,g=new n.Line,d=new n.Line,i.querySide(0,u),i.querySide(1,c),i.querySide(2,g),i.querySide(3,d);const t=e.querySegmentIterator();for(;t.nextPath();)for(;t.hasNextSegment();){const e=t.nextSegment();if(i.contains(e.getStartXY())||i.contains(e.getEndXY()))return!0;if(e.isIntersecting(u,o))return!0;if(e.isIntersecting(c,o))return!0;if(e.isIntersecting(g,o))return!0;if(e.isIntersecting(d,o))return!0}}else{const s=t.Envelope2D.constructEmpty();s.setCoords({env2D:i}),s.inflateCoords(o,o);const n=e.getImpl(),a=n.getAttributeStreamRef(0),m=new r.Point2D;for(let e=0,t=n.getPathCount();e<t;e++){let t=!0;const i=new r.Point2D,o=new r.Point2D,h=new r.Point2D,l=n.getPathStart(e),u=new r.Point2D;for(let r=l,c=n.getPathEnd(e);r<c;r++)if(t)a.queryPoint2D(2*r,i),u.assign(i),t=!1;else{if(a.queryPoint2D(2*r,m),o.setCoordsPoint2D(i),h.setCoordsPoint2D(m),s.clipLine(o,h))return!0;i.assign(m)}if(n.isClosedPath(e)&&!t&&(o.setCoordsPoint2D(i),h.setCoordsPoint2D(u),s.clipLine(o,h)))return!0}}return!1}function Yt(e,s,n,o){const a=e.getImpl(),h=s.getImpl(),l=[0],u=i.isAtLeastWeakSimple(a.getIsSimple(0,l))&&i.isAtLeastWeakSimple(h.getIsSimple(0,l)),c=a.querySegmentIterator(),g=h.querySegmentIterator(),d=r.makePrimitiveArray(2,0),p=r.makePrimitiveArray(2,0),_=new Ue(a,h,n);let f=!1;for(;_.next();){const e=_.getRedElement(),t=_.getBlueElement();c.resetToVertex(e,-1),g.resetToVertex(t,-1);const s=c.nextSegment(),i=g.nextSegment();let r=0;if(Ut(s,i)){if(i.isIntersecting(s,n)){f=!0;break}}else r=i.intersect(s,null,p,d,n);if(2===r){const e=d[0],t=d[1],i=s.calculateLength2D();if(u&&(t-e)*i>n)return!1;f=!0}else if(r){const e=d[0],t=p[0];if(e>0&&e<1&&t>0&&t<1)return!1;f=!0}}if(!f)return!1;const y=t.Envelope2D.constructEmpty(),x=t.Envelope2D.constructEmpty(),P=t.Envelope2D.constructEmpty();let E,v;if(e.queryEnvelope(y),s.queryEnvelope(x),y.inflateCoords(1e3*n,1e3*n),x.inflateCoords(1e3*n,1e3*n),P.setCoords({env2D:y}),P.intersect(x),e.getPointCount()>10){if(E=m.clip$1(e,P,n,0,o),E.isEmpty())return!1}else E=e;if(s.getPointCount()>10){if(v=m.clip$1(s,P,n,0,o),v.isEmpty())return!1}else v=s;return Ge(E,v,n,"F********",o,!1)}function Xt(e,s,n,o){const a=e.getImpl(),h=s.getImpl(),l=[0],u=i.isAtLeastWeakSimple(a.getIsSimple(0,l))&&i.isAtLeastWeakSimple(h.getIsSimple(0,l)),c=t.Envelope2D.constructEmpty(),g=t.Envelope2D.constructEmpty(),d=t.Envelope2D.constructEmpty();e.queryEnvelope(c),s.queryEnvelope(g);let p=!1;const _=Nt(c,g,n),f=Nt(g,c,n),y=a.querySegmentIterator(),x=h.querySegmentIterator(),P=r.makePrimitiveArray(2,Number.NaN),E=r.makePrimitiveArray(2,Number.NaN),v=new Ue(a,h,n);for(;v.next();){const e=v.getRedElement(),t=v.getBlueElement();y.resetToVertex(e,-1),x.resetToVertex(t,-1);const s=y.nextSegment(),i=x.nextSegment();let r=0;if(Ut(s,i)){if(i.isIntersecting(s,n))break}else r=i.intersect(s,null,E,P,n);if(2===r){const e=P[0],t=P[1],i=s.calculateLength2D();if(u&&(t-e)*i>n&&(p=!0,_&&f))return!0}else if(r){const e=P[0],t=E[0];if(e>0&&e<1&&t>0&&t<1)return!0}}const C=t.Envelope2D.constructEmpty(),D=t.Envelope2D.constructEmpty();let b,S;C.setCoords({env2D:c}),C.inflateCoords(1e3*n,1e3*n),D.setCoords({env2D:g}),D.inflateCoords(1e3*n,1e3*n),d.setCoords({env2D:C}),d.intersect(D);let I="";if(I+=p?"**":"T*",_){if(s.getPointCount()>10){if(S=m.clip$1(s,d,n,0,o),S.isEmpty())return!1}else S=s;I+="****"}else S=s,I+="T***";if(f){if(e.getPointCount()>10){if(b=m.clip$1(e,d,n,0,o),b.isEmpty())return!1}else b=e;I+="***"}else b=e,I+="T**";return Ge(b,S,n,I,o,!1)}function Lt(e,s,r,o){const a=[!1],h=wt(e,s,r,a);if(a[0])return h;const l=t.Envelope2D.constructEmpty();let u;if(s.queryEnvelope(l),l.inflateCoords(1e3*r,1e3*r),e.getPointCount()>10){if(u=m.clip$1(e,l,r,0,o),u.isEmpty())return!1}else u=e;const c=function(e,s,r,o){const a=new Xe;a.resetMatrix_(),a.setPredicates_("T*****F**"),a.setAreaAreaPredicates_();const m=t.Envelope2D.constructEmpty(),h=t.Envelope2D.constructEmpty();e.queryEnvelope(m),s.queryEnvelope(h);let l=!1;if(Ke(m,h,r)&&(a.areaAreaDisjointPredicates_(e,s),l=!0),l||$e(e,s),l)return Oe(a.m_matrix,a.m_scl);let u=new n.EditShape,c=u.addGeometry(e),g=u.addGeometry(s),d=null,p=0;if(e.hasNonLinearSegments()||s.hasNonLinearSegments()){d=new ms;const e=rs(r,u.getEnvelope2D(o));p=as(e,0),ss(u,e,r,0,d,null,o)}ls(u,new i.CombinedTolerance(r,0).add(p),o,!1,!1);const _=u.getGeometry(g).getBoundary();if(u.filterClosePoints(0,!0,!0,!1,n.nullHandle),Ae(u,c,-1,!1,n.nullHandle,o),0===u.getPointCount(c))return!1;Ae(u,g,-1,!1,n.nullHandle,o),a.setEditShape_(u,o);const f=0===u.getPointCount(g);if(!f){a.computeMatrixTopoGraphHalfEdges_(c,g),a.m_topoGraph.removeShape();const e=Oe(a.m_matrix,a.m_scl);if(!e)return e}const y=u.getGeometry(c);return u=new n.EditShape,c=u.addGeometry(y),g=u.addGeometry(_),a.setEditShape_(u,o),a.m_predicateCount=0,a.resetMatrix_(),a.setPredicates_(f?"T*****F**":"******F**"),a.setAreaLinePredicates_(),a.computeMatrixTopoGraphHalfEdges_(c,g),a.m_topoGraph.removeShape(),Oe(a.m_matrix,a.m_scl)}(u,s,r,o);return c}function Bt(e,t,s,n){const i=new r.Point2D,o=s*s;for(let s=0;s<e.getPointCount();s++)if(e.queryXY(s,i),r.Point2D.sqrDistance(i,t)<=o)return!1;return!0}function zt(e,t,s){const n=e.getBoundary();return!n.isEmpty()&&!Bt(n,t,s)}function Ut(e,t){return e.getGeometryType()!==s.GeometryType.enumLine||t.getGeometryType()!==s.GeometryType.enumLine}function jt(e,t,s,n,i,r,o,a){return{m_ivertexA:e,m_ipathA:t,m_scalarA0:s,m_scalarA1:n,m_ivertexB:i,m_ipathB:r,m_scalarB0:o,m_scalarB1:a}}class Wt{constructor(){this.m_overlapEvents=[]}compareOverlapEvents(e,t){const s=this.m_overlapEvents[e],n=this.m_overlapEvents[t];if(s.m_ipathA<n.m_ipathA)return-1;if(s.m_ipathA===n.m_ipathA){if(s.m_ivertexA<n.m_ivertexA)return-1;if(s.m_ivertexA===n.m_ivertexA){if(s.m_scalarA0<n.m_scalarA0)return-1;if(s.m_scalarA0===n.m_scalarA0){if(s.m_scalarA1<n.m_scalarA1)return-1;if(s.m_scalarA1===n.m_scalarA1&&s.m_ivertexB<n.m_ivertexB)return-1}}}return 1}}function Zt(e,t,s){const n=function(e,t,s){return t.isEmpty()?0:De(e,t.getXY(),s)}(e,t,s);return n?1===n?1:2:0}function Qt(e,t,s){const n=De(e,t,s);return n?1===n?1:2:0}function Kt(e,n,i,r,o){if(e.getGeometryType()===s.GeometryType.enumPolygon)!function(e,t,s,n,i){for(let r=0;r<s;r++)i[r]=Qt(e,t[r],n)}(e,n,i,r,o);else if(e.getGeometryType()===s.GeometryType.enumEnvelope){const s=t.Envelope2D.constructEmpty();e.queryEnvelope(s),function(e,t,s,n,i){if(e.isEmpty()){for(let e=0;e<s;e++)i[e]=0;return}const r=e.clone();r.inflateCoords(.5*-n,.5*-n);const o=e.clone();o.inflateCoords(.5*n,.5*n);for(let e=0;e<s;e++)r.contains(t[e])?i[e]=1:o.contains(t[e])?i[e]=2:i[e]=0}(s,n,i,r,o)}else s.throwInvalidCallException("")}function $t(e,n,r,o,a){const m=e.getGeometryType();m===s.GeometryType.enumPolyline?function(e,n,r,o,a){const m=e.getImpl(),h=m.getAccelerators();let l=null;h&&(l=h.getRasterizedGeometry());let u=r;for(let e=0;e<r;e++)a[e]=1,l&&s.geometryReleaseAssert(0);if(u){if(h){let e=null;null!==h&&null!==h.getQuadTree()&&(e=h.getQuadTree());const s=m.getPointCount();if(null===e&&s>20&&s*r>4*s+Math.log(s)*r&&(e=i.buildQuadTree(m)),e){let s=null;const i=m.querySegmentIterator(),h=new t.Envelope2D;for(let t=0;t<r&&u;t++)if(1===a[t]){h.setCoords(n[t]),null===s?s=e.getIterator(h,o):s.resetIterator(h,o);let r=-1;for(let m=s.next();-1!==m;m=s.next()){if(i.resetToVertex(e.getElement(m),r),r=i.getPathIndex(),i.nextSegment().isIntersectingPoint(n[t],o)){a[t]=2,u--;break}a[t]=0}}return}}const e=m.querySegmentIterator();for(;e.nextPath()&&u;)for(;e.hasNextSegment()&&u;){const t=e.nextSegment();for(let e=0;e<r&&u;e++)1===a[e]&&t.isIntersectingPoint(n[e],o)&&(a[e]=2,u--)}}for(let e=0;e<r;e++)1===a[e]&&(a[e]=0)}(e,n,r,o,a):s.isSegment(m)?s.geometryReleaseAssert(0):s.throwInvalidCallException("")}function Jt(){return Number.isNaN(this.radius.value())}function es(e,t,s,n){return{pt:e.clone(),t,err:s,checkCount:n}}class ts{constructor(e,t,s,i,o){this.m_left=e,this.m_tracker=o,this.m_eps=s,this.m_trackerCounter=0,this.m_tolerance=i,this.m_circleCheckCounter=0,this.m_bReversedLeft=!1,this.m_leftArc={ptStart:new r.Point2D,ptEnd:new r.Point2D,center:new n.EPoint2D,radius:new r.ECoordinate,fcenter:new n.MPPoint2D,fradius2:new r.MPValue,maxError:Number.NaN,isLine:Jt}}closeToCircularArc(e,t,s,i,o,a){if(this.m_circleCheckCounter++,a.maxError=0,!ts.checkSweepAngle(e,t))return!1;if(a.ptStart.setCoordsPoint2D(s),a.ptEnd.setCoordsPoint2D(o),e.isCircular()){const t=e;return a.fradius2=r.MPValue.constructDouble(t.getSemiMajorAxis()).mulDouble(t.getSemiMajorAxis()),a.radius.set(t.getSemiMajorAxis()),a.fcenter.assignPoint2D(t.getCenter()),a.center.set(t.getCenter()),!0}const m=a.ptEnd.sub(a.ptStart).clone();if(m.leftPerpendicularThis(),m.normalize(),Math.abs(m.dotProduct(i.sub(a.ptStart)))<=this.m_eps)return!!this.confirmIsLine(a,m)&&(a.radius.set(Number.NaN),a.center.setCoords(0,0),!0);{const s=a.ptEnd.sub(a.ptStart),n=i.sub(a.ptStart),r=s.crossProduct(n);if(0===r)return!1;const o=.5*s.sqrLength(),m=.5*n.sqrLength();let h=o*n.y-m*s.y;h/=r;let l=s.x*m-n.x*o;l/=r;const u=Math.sqrt(h*h+l*l);if(4*Number.EPSILON*u>this.m_eps)return!1;const c=h+a.ptStart.x,g=l+a.ptStart.y;a.radius.set(u),a.center.setCoords(c,g);const d=this.maxCircleApproximationError(e,t,a);if(d>this.m_eps)return a.maxError=d,!1}const h=(new n.MPPoint2D).assignPoint2D(a.ptStart),l=(new n.MPPoint2D).assignPoint2D(a.ptEnd).sub(h),u=(new n.MPPoint2D).assignPoint2D(i).sub(h),c=l.crossProduct(u);if(c.isZero())return!1;const g=l.sqrLength().mulDouble(.5),d=u.sqrLength().mulDouble(.5),p=g.mul(u.y).sub(d.mul(l.y)),_=l.x.mul(d).sub(u.x.mul(g)),f=p.mul(p).add(_.mul(_)),y=c.clone();y.invertThis(),a.fradius2=f.mul(y).mul(y),a.fcenter.setCoords(p.mul(y).add(h.x),_.mul(y).add(h.y)),a.center.setWithEps(a.fcenter.asPoint2D()),a.radius.setWithEps(Math.sqrt(a.fradius2.toDouble()));const x=n.EPoint2D.constructPoint2D(a.ptStart).subE(a.center),P=n.EPoint2D.constructPoint2D(a.ptEnd).subE(a.center);if(!x.dotProduct(P).gt(r.s_zero))return!1;const E=this.maxCircleApproximationError(e,t,a);return a.maxError=E,E<=this.m_eps}static checkSweepAngle(e,t){if(e.getGeometryType()===s.GeometryType.enumEllipticArc){const s=e,i=n.tToParametricAngle(s,t.vmin),o=n.tToParametricAngle(s,t.vmax);return!(Math.abs(o-i)>.5*r.geometryHalfPi)}return!0}confirmIsLine(e,t){const s=e.ptEnd.sub(e.ptStart);return!(Math.abs(t.dotProduct(s.mul(.25)))>this.m_eps||Math.abs(t.dotProduct(s.mul(.75)))>this.m_eps)}maxCircleApproximationError(e,t,n){const i=[.25,.75],o=[.1,.25,.75,.9];let a,m;e.getGeometryType()===s.GeometryType.enumEllipticArc?(a=i,m=i.length):(a=o,m=o.length);let h=0;for(let s=0;s<m;++s){const i=new r.Point2D;e.queryCoord2D(r.lerp(t.vmin,t.vmax,a[s]),i);const o=i.sub(n.center.value()).length(),m=Math.abs(o-n.radius.value());m>h&&(h=m)}return h}approximateWithCirclesImpl(e,t){let s=1;t&&t.push(0);const n=r.makePrimitiveArray(9,Number.NaN);let i;e?i=this.m_left.getMonotonicPartParams(n.length,n):(n[0]=0,n[1]=1,i=2);const o=[],a=[],m=new r.Point2D(0,0);for(let e=1;e<i;e++){const i=new r.Envelope1D(n[e-1],n[e]);for(this.m_bReversedLeft=!ts.goodOrientation(this.m_left,i),this.m_bReversedLeft?(o.push(es(m,i.vmin,0,0)),o.push(es(m,i.vmax,0,0))):(o.push(es(m,i.vmax,0,0)),o.push(es(m,i.vmin,0,0))),o[0].pt=this.m_left.getCoord2D(o[0].t),o[1].pt=this.m_left.getCoord2D(o[1].t);o.length>1;){this.progress_();const e=o.at(-1);let n=e.checkCount,i=e.err;const m=e.pt.clone(),h=e.t,l=o[o.length-2].t,u=.5*(h+l),c=this.m_left.getCoord2D(u);if(i<=this.m_eps||n>=5){const e=new r.Envelope1D;if(e.setCoords(h,l),this.closeToCircularArc(this.m_left,e,m,c,o[o.length-2].pt,this.m_leftArc)){t&&(this.m_bReversedLeft?a.push(h):t.push(l)),s++,o.pop();continue}n=0,i=this.m_leftArc.maxError}e.t=u,e.pt.setCoordsPoint2D(c),i*=.125,n++,e.err=i,e.checkCount=n,o.push(es(m,h,i,n))}this.m_bReversedLeft&&t&&(t.length=t.length+a.length,r.memcpy(t,a.reverse(),t.length-a.length,0,a.length),a.length=0),o.length=0}return s}approximateWithCirclesImplPolyline(e){const t=new n.Polyline,s=[];if(!this.approximateWithCirclesImpl(!0,s))return t;let i=0;const o=this.m_left.getStartXY();t.startPath(o);for(let a=1;a<s.length;++a)if(e)t.lineTo(this.m_left.getCoord2D(s[a]));else{const e=new r.Point2D;this.m_left.queryCoord2D(s[a],e);const m=new r.Point2D;this.m_left.queryCoord2D(.5*(s[a]+i),m);const h=new n.EllipticArc;h.constructCircularArcThreePoint(o,e,m),t.addSegment(h,!1),o.assign(e),i=s[a]}return t}static goodOrientation(e,t){const s=e.getCoord2D(t.vmin),n=e.getCoord2D(t.vmax);return s.compare(n)<0}progress_(e=!1){}}function ss(e,t,s,n,i,r,o){!function(e,t,s,n,i,r){e.hasCurves()?(e.setCurveStitcherPointer(n),n.m_impl=new hs(r,!1,null),n.m_impl.buildMonotonicCurveParentage(e,t,s,i)):n.m_impl=null}(e,t,s,i,r,o),cs(e,s,o)}function ns(e,t,s,n,i,r,o,a){e.hasCurves()?(e.setCurveStitcherPointer(r),r.m_impl=new hs(a,!0,i),r.m_impl.buildMonotonicCurveParentage(e,t,s,o),cs(e,s,a)):r.m_impl=null}function is(e){if(!e.hasSegmentParentage())return;const t=e.queryVertexIteratorOnSelection();for(let s=t.next();s!==n.nullHandle;s=t.next())if(!e.getSegmentParentageBreakVertex(s)){e.getPathFromVertex(s);const t=e.getPrevVertex(s),i=t!==n.nullHandle?e.getSegmentParentage(t):-1,r=e.getSegmentParentage(s);-1!==r&&-1!==i&&r!==i&&e.setSegmentParentageBreakVertex(s,!0)}}function rs(e,s){return s||(s=t.Envelope2D.constructEmpty()),function(e,t){let s=t.isEmpty()?e:i.calculateToleranceFromGeometryForOp(null,t,!0).total();return s>e&&(s=e),.125*s}(e,s)}function os(e,t){return.125*e}function as(e,t){return 3*e+3*t}class ms{constructor(){this.m_impl=null}stitchCurves(e,t,s,n){this.m_impl&&(this.m_impl.stitchCurves(e,t,s),n&&this.clearStitcher(e))}clearStitcher(e){this.m_impl&&(this.m_impl.clearStitcher(e),this.m_impl=null)}getOriginalVertexIndex(e,t){return this.m_impl.getOriginalVertexIndex(e,t)}getOriginalSegmentTypeInfo(e){return this.m_impl.getOriginalSegmentTypeInfo(e)}}class hs{constructor(e,t,s){this.m_originalPlanarSegments=[],this.m_progressTracker=null,this.m_nsr=null,this.m_progressTracker=e,this.m_nsr=s,this.m_tolerance=0,this.m_originalVertexIndex=-1,this.m_type=1,this.m_progressCounter=0,this.m_bIsSimple=t,this.m_densificationDeviation=NaN,this.m_maxSegmentsPerCurve=-1}buildMonotonicCurveParentage(e,t,r,o){const a=!1;if(!e.hasCurves())return;s.geometryReleaseAssert(!e.hasSegmentParentage()),this.m_originalPlanarSegments.length=0,this.m_bIsSimple&&(this.m_originalVertexIndex=e.createUserIndex()),this.m_tolerance=r;const m=new i.Point,h=new n.SegmentBuffer,l=[],c=[],g=[];for(let i=e.getFirstGeometry();i!==n.nullHandle;i=e.getNextGeometry(i))for(let o=e.getFirstPath(i);o!==n.nullHandle;o=e.getNextPath(o)){let i=e.getPathSize(o),d=e.getFirstVertex(o),p=0,_=-1;for(let f=0;f<i;f++){let y=e.getNextVertex(d);if(!e.querySegment(d,h,!0,!1)){d=y;continue}if(0===p){_=e.getVertexIndex(d);const t=hs.regularizeCurve(e,h.get(),d,r);if(t>=0){this.m_nsr&&0===this.m_nsr.m_reason&&this.m_nsr.assign(new u.NonSimpleResult(13,_,-1)),p=t,i=e.getPathSize(o),y=e.getNextVertex(d);const n=e.querySegment(d,h,!0,!1);s.geometryReleaseAssert(n)}}else p--;const x=e.getVertexIndex(d);let P;-1!==this.m_originalVertexIndex&&e.setUserIndex(d,this.m_originalVertexIndex,_),e.setSegmentToIndex(x,null);let E=!1;switch(h.get().getGeometryType()){case s.GeometryType.enumEllipticArc:case s.GeometryType.enumRationalBezier2:P=n.approximationWithQuadraticRationalBeziers(h.get(),t,r,a,!0,c,g,l),E=!0;break;default:{const e=!this.m_bIsSimple||!h.get().isMonotoneQuickAndDirty();P=n.approximationWithBeziers(h.get(),t,r,e,a,c,l)}}const v=this.m_originalPlanarSegments.length;if(e.setSegmentParentageAndBreak(d,v,!0),!c[1].isNAN()){let t=null;t=E?new n.QuadraticRationalBezier({points:c,weights:g}):new n.CubicBezier({cp:c}),t.snapControlPoints(r*r),e.setSegmentToIndex(x,t)}const C=E?2:3;for(let t=1,s=P,i=C;t<s;++t,i+=C){h.get().queryCoord(l[t],m);const s=e.insertVertex(o,y,m);if(-1!==this.m_originalVertexIndex&&e.setUserIndex(s,this.m_originalVertexIndex,_),!c[i+1].isNAN())if(E){const t=new n.QuadraticRationalBezier({points:c.slice(i),weights:g.slice(i)});t.snapControlPoints(r*r),e.setSegmentToIndex(e.getVertexIndex(s),t)}else{const t=new n.CubicBezier({cp:c.slice(i)});t.snapControlPoints(r*r),e.setSegmentToIndex(e.getVertexIndex(s),t)}e.setSegmentParentageAndBreak(s,v,!1)}P>1&&(f+=P-1,i=e.getPathSize(o)),this.m_originalPlanarSegments.push(h.releaseSegment()),d=y}}}buildLinearSegmentParentage(e,t,r,o,a){if(this.m_type=0,this.m_densificationDeviation=t,this.m_maxSegmentsPerCurve=o,!e.hasCurves())return;s.geometryReleaseAssert(!e.hasSegmentParentage()),this.m_tolerance=r,this.m_originalPlanarSegments=[],this.m_bIsSimple&&(this.m_originalVertexIndex=e.createUserIndex());const m=new i.Point,h=new n.SegmentBuffer,l=new n.Densificator(0,t,0,this.m_progressTracker,!1,o),u=[];for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))for(let i=e.getFirstPath(t);i!==n.nullHandle;i=e.getNextPath(i)){let t=e.getPathSize(i),n=e.getFirstVertex(i);for(let o=0;o<t;o++){let o=e.getNextVertex(n);if(!e.querySegment(n,h,!0,!1)){n=o;continue}if(hs.regularizeCurve(e,h.get(),n,r)>=0){t=e.getPathSize(i),o=e.getNextVertex(n);const r=e.querySegment(n,h,!0,!1);s.geometryReleaseAssert(r)}const a=e.getVertexIndex(n);-1!==this.m_originalVertexIndex&&e.setUserIndex(n,this.m_originalVertexIndex,a),e.setSegmentToIndex(a,null),u.length=0,l.densifySegment(h.get(),u),this.progress_();const c=this.m_originalPlanarSegments.length;e.setSegmentParentageAndBreak(n,c,!0);for(let t=1,s=u.length-1;t<s;++t){h.get().queryCoord(u[t],m);const s=e.insertVertex(i,o,m);e.setSegmentParentageAndBreak(s,c,!1),-1!==this.m_originalVertexIndex&&e.setUserIndex(s,this.m_originalVertexIndex,a)}this.m_originalPlanarSegments.push(h.releaseSegment()),n=o}}e.clearSegments()}stitchCurves(e,t,s){hs.st_stitchCurvesImpl(this,e,t,s,!1)}clearStitcher(e){this.m_originalPlanarSegments.length=0,-1!==this.m_originalVertexIndex&&(e.removeUserIndex(this.m_originalVertexIndex),this.m_originalVertexIndex=-1),e.deleteSegmentParentage()}static st_verifyParentage(e){hs.st_stitchCurvesImpl(null,e,n.nullHandle,0,!0)}getOriginalVertexIndex(e,t){return-1!==this.m_originalVertexIndex&&t!==n.nullHandle?e.getUserIndex(t,this.m_originalVertexIndex):-1}getOriginalSegmentTypeInfo(e){if(-1!==e){const t=this.m_originalPlanarSegments[e];switch(t.getGeometryType()){case s.GeometryType.enumEllipticArc:return 0===t.projectionBehavior()?0:1;case s.GeometryType.enumBezier:return 2;case s.GeometryType.enumBezier2:return 3;case s.GeometryType.enumLine:return-1;case s.GeometryType.enumRationalBezier2:return 4;default:s.throwNotImplementedException("")}}return-1}progress_(e=!1){this.m_progressCounter++}processSpanSmartTe_(e,t,i,o,a,m,h){if(t===i&&0===o)return s.geometryReleaseAssert(e.getNextVertex(t)===n.nullHandle),e.setSegmentToIndex(e.getVertexIndex(t),null),void e.setSegmentParentageAndBreak(t,-1);const l=e.getNextVertex(t),u=e.getXY(t),c=e.getXY(i);let g,d=0;{let t=2,n=u;for(let s=l;s!==i;s=e.getNextVertex(s)){const i=e.getXY(s);d+=r.Point2D.distance(i,n),n=i,t++}d+=r.Point2D.distance(c,n),s.geometryReleaseAssert(t===o)}if(null===a)return e.setSegmentToIndex(e.getVertexIndex(t),null),void e.removeVertices(l,i);const p=h;let _=a.getClosestCoordinate(u,!1),f=a.getClosestCoordinate(c,!1);const y=a.calculateLength2D();let x=a.tToLength(_),P=a.tToLength(f);const E=Math.abs(x)>10*p&&Math.abs(x-y)>10*p,v=Math.abs(P)>10*p&&Math.abs(P-y)>10*p,C=e=>{const t=e.calculateLength2D();return Math.abs(t-d)>Math.max(.2*d,4*p)?null:e};let D=a.isClosed();if(!D){const e=r.Point2D.distance(a.getStartXY(),a.getEndXY());e<=p&&y>5*e&&(D=!0)}if(D){let n,m,h=new r.Point2D;if(2===o)h=r.Point2D.lerp(u,c,.5),n=a.getClosestCoordinate(h,!1),m=a.tToLength(n);else{let s=e.getNextNthVertex(t,(o-1)/2);h=e.getXY(s),n=a.getClosestCoordinate(h,!1),m=a.tToLength(n);let i=Math.abs(m)>10*p&&Math.abs(m-y)>10*p;if(!i&&(o-1>=4&&(s=e.getNextNthVertex(t,(o-1)/4),n=a.getClosestCoordinate(h,!1),m=a.tToLength(n),i=Math.abs(m)>10*p&&Math.abs(m-y)>10*p),!i))return}let l=!1;const d=x===P;if(d){const s=0;let n=2,i=4;o-1<=4&&(n=s+1,i=s+2);const m=u,h=e.getXY(e.getNextNthVertex(t,n)),c=e.getXY(e.getNextNthVertex(t,i));l=-r.Point2D.orientationNonRobust(m,h,c)*r.sign(a.calculateArea2DHelper())>0}else v?E?l=m>x:m<P?(x=0,_=0):(x=y,_=1):m>x?(P=y,f=1):(P=0,f=0);if(d)g=a.clone(),g.dropAllAttributes(),l||g.reverse(),s.geometryReleaseAssert(u.equals(c));else{let e=!1;_>f&&(e=!0,[_,f]=[f,_]),g=a.cut(_,f,!0),g.getDescription().getAttributeCount(),e&&g.reverse()}g.setCoordsForIntersector(u,c,!1),g=C(g),g&&(this.removeSpanBetween(e,t,i),e.setSegmentToIndex(e.getVertexIndex(t),g))}else if(E||v){if((!E||!v)&&r.Point2D.distance(a.getStartXY(),a.getEndXY())<10*p){const s=[r.makePair(_,f),r.makePair(_,f),r.makePair(_,f)];E?(s[1].second=0,s[2].second=1):(s[1].first=1,s[2].first=0);const n=[null,null,null],o=[0,0,0];let m=Number.MAX_VALUE,h=0;for(let e=0;e<3;e++){let t=!1;if(s[e].first>s[e].second){t=!0;const n=s[e].first;s[e].first=s[e].second,s[e].second=n}n[e]=a.cut(s[e].first,s[e].second,!0),n[e].dropAllAttributes(),t&&n[e].reverse(),n[e].setCoordsForIntersector(u,c,!1),o[e]=n[e].calculateLength2D();const i=Math.abs(d-o[e]);i<m&&(m=i,h=e)}return g=n[h],g=C(g),void(g&&(this.removeSpanBetween(e,t,i),e.setSegmentToIndex(e.getVertexIndex(t),g)))}let s=!1;_>f&&(s=!0,[_,f]=[f,_]),g=a.cut(_,f,!0),g.dropAllAttributes(),s&&g.reverse(),g.setCoordsForIntersector(u,c,!1),g=C(g),g&&(this.removeSpanBetween(e,t,i),e.setSegmentToIndex(e.getVertexIndex(t),g))}else{if(g=a.clone(),g.dropAllAttributes(),x>P&&g.reverse(),d<Math.max(.75*y,y-this.m_densificationDeviation*(o-1))){const e=_>f?f:_,t=g.tToLength(e)+d;let s=g.lengthToT(t);s=r.snap(s,e,1),g=g.cut(e,s,!0)}g.setCoordsForIntersector(u,c,!1),g=C(g),g&&(this.removeSpanBetween(e,t,i),e.setSegmentToIndex(e.getVertexIndex(t),g))}}processSpanCurves_(e,t,i,r,o,a,m){if(t===i&&0===r)return s.geometryReleaseAssert(e.getNextVertex(t)===n.nullHandle),e.setSegmentToIndex(e.getVertexIndex(t),null),void e.setSegmentParentageAndBreak(t,-1);const h=e.getNextVertex(t);{let t=2;for(let s=h;s!==i;s=e.getNextVertex(s))t++;s.geometryReleaseAssert(t===r)}if(null===o)return e.setSegmentToIndex(e.getVertexIndex(t),null),void e.removeVertices(h,i);const l=e.getXY(t),u=e.getXY(i);if(o.isClosed()){if(l.isEqualPoint2D(u)&&l.isEqualPoint2D(o.getStartXY())){let s;if(s=this.verifySegmentFitnessCurves(e,t,i,r,o,a,m)){const n=o.clone();return n.dropAllAttributes(),s<0&&n.reverse(),this.removeSpanBetween(e,t,i),void e.setSegmentToIndex(e.getVertexIndex(t),n)}}}else if(l.isEqualPoint2D(o.getStartXY())){if(u.isEqualPoint2D(o.getEndXY())){const n=o.clone();n.dropAllAttributes();const h=this.verifySegmentFitnessCurves(e,t,i,r,n,a,m);if(h)return s.geometryReleaseAssert(h>0),this.removeSpanBetween(e,t,i),void e.setSegmentToIndex(e.getVertexIndex(t),n)}}else if(u.isEqualPoint2D(o.getStartXY())&&l.isEqualPoint2D(o.getEndXY())){const n=o.getReversed();n.dropAllAttributes();const h=this.verifySegmentFitnessCurves(e,t,i,r,n,a,m);if(h)return s.geometryReleaseAssert(h>0),this.removeSpanBetween(e,t,i),void e.setSegmentToIndex(e.getVertexIndex(t),n)}this.processSpanSplitSegmentCurves(e,t,i,r,o,a,m)}processSpan_(e,t,s,n,i,r,o){return 0===this.m_type?void this.processSpanSmartTe_(e,t,s,n,i,r,o):void this.processSpanCurves_(e,t,s,n,i,r,o)}processSpanSplitSegmentCurves(e,t,s,n,i,o,a){if(i.isLine())return;if(this.fitSegmentToSpanCurves(e,t,s,n,i,o,a))return;const m=a*a;let h=n,l=t;const u=e.getXY(t);let c=i.getClosestCoordinate(u,!1);const g=i.getCoord2D(c);let d=!1;const p=r.Point2D.sqrDistance(u,g);if(p>m){const n=e.getNextVertex(t);if(this.approximateSpanSectionCurves(e,t,i,o,a),n===s)return;l=n,d=!0,h-=1}let _=s;const f=e.getXY(s);c=i.getClosestCoordinate(f,!1);const y=i.getCoord2D(c);let x=!1;const P=r.Point2D.sqrDistance(f,y);if(P>m){const t=e.getPrevVertex(s);if(this.approximateSpanSectionCurves(e,t,i,o,a),t===l)return;_=t,x=!0,h-=1}if((d||x)&&this.fitSegmentToSpanCurves(e,l,_,h,i,o,a))return;let E=!1;if(!d&&p>0){const s=e.getNextVertex(t);if(this.approximateSpanSectionCurves(e,t,i,o,a),s===_)return;l=s,d=!0,E=!0,h-=1}if(!x&&P>0){const t=e.getPrevVertex(s);if(this.approximateSpanSectionCurves(e,t,i,o,a),t===l)return;_=t,x=!0,E=!0,h-=1}if(E&&this.fitSegmentToSpanCurves(e,l,_,h,i,o,a))return;let v=l;for(;;){const t=e.getNextVertex(v);if(this.approximateSpanSectionCurves(e,v,i,o,a),v=t,v===_)return}}fitSegmentToSpanCurves(e,t,s,i,o,a,m){const h=[];h.push(e.getXY(t));let l=t;const u=new n.SegmentBuffer;for(;;){e.querySegment(l,u,!1,!0);const t=[.1,.25,.4,.5,.6,.75,.9,1];let n=0;for(const e of t)(2===i||1&n)&&h.push(u.get().getCoord2D(e)),n++;if(l=e.getNextVertex(l),l===s)break}const c=(()=>{let e=h[0].compare(h.at(-1));if(0===e){const t=new r.KahanSummator(0);!function(e,t,s){if(s.reset(),t<3)return;const n=e[0].clone(),i=n.x,o=n.y,a=e[1].clone(),m=new r.Point2D;for(let i=2;i<t;i++)m.assign(e[i]),s.pe((m.x-n.x)*(a.y-o)),n.assign(a),a.assign(m);s.pe((i-n.x)*(a.y-o))}(h,h.length,t),e=t.getResult()>=0?-1:1}return e>0})();c&&h.reverse();const g=o.clone();if(g.dropAllAttributes(),c&&g.reverse(),g.setSegmentFromCoordsForStitcher(h,h.length),c&&g.reverse(),g.snapControlPoints(this.m_tolerance*this.m_tolerance),this.verifySegmentFitnessCurves(e,t,s,i,g,a,m)){this.removeSpanBetween(e,t,s);const n=e.getVertexIndex(t);return e.setSegmentToIndex(n,g),!0}return!1}approximateSpanSectionCurves(e,t,o,a,m){const h=new n.SegmentBuffer;if(!e.querySegment(t,h,!0,!1))return;const l=o.getGeometryType();if(l!==h.get().getGeometryType()){if(l===s.GeometryType.enumEllipticArc){if(h.get().getGeometryType()!==s.GeometryType.enumRationalBezier2)return;if(0===o.projectionBehavior()){const s=[];!function(e,t,s,i,r){const o=n.minTolerance(t),a=Math.max(4*o,s);new ts(t,null,a,Number.NaN,r).approximateWithCirclesImpl(!1,i)}(0,h.get(),m,s,this.m_progressTracker);const o=e.getNextVertex(t),a=e.getPathFromVertex(t),l=new i.Point;let u=t;for(let t=1,i=s.length;t<i;t++){const i=s[t],m=h.get().getCoord2D(s[t-1]),c=h.get().getCoord2D(r.lerp(s[t-1],i,.5));h.get().queryCoord(i,l);const g=l.getXY(),d=new n.EllipticArc;d.constructCircularArcThreePoint(m,g,c);let p=n.nullHandle;i<1&&(p=e.insertVertex(a,o,l)),e.setSegmentToIndex(e.getVertexIndex(u),d),u=p}return}{const s=r.makeObjectArray(r.Point2D,3);h.get().queryControlPoints(s);const i=[0,0,0];h.get().queryWeights(i);const o=n.calculateStandardWeight(i),a=new n.EllipticArc;return n.nurbs2ToArc128(s,o*o,null,!1,a),void e.setSegmentToIndex(e.getVertexIndex(t),a)}}s.throwInternalErrorException("approximate_span_section_")}}verifySegmentFitnessCurves(e,t,s,i,o,a,m){const h=e.getXY(t),l=e.getXY(s);if(!h.isEqualPoint2D(o.getStartXY())||!l.isEqualPoint2D(o.getEndXY()))return 0;let u=0;if(o.isClosed()){const e=o.getCoord2D(.1).sub(h);u=o.getCoord2D(.7).sub(h).crossProduct(e)>=0?1:-1}const c=r.makePrimitiveArray(n.Segment.s_maxMonotonicPartParams,Number.NaN);let g=o.getMonotonicPartParams(c.length,c);g--;const d=new n.Line,p=[1,.5,.75,.25];let _=0,f=t;const y=h.clone();for(;;){const t=e.getNextVertex(f);let n=e.getSegment(f);null===n&&(e.queryLineConnector(f,d,!0),n=d);for(let e=t===s?1:0;e<p.length;e++){const t=n.getCoord2D(p[e]);if(!o.isCloserThanDistance(t,r.Envelope1D.unit(),m))return 0}if(g>1)for(let e=1;e<g;){const t=o.getCoord2D(c[e]);n.isCloserThanDistance(t,r.Envelope1D.unit(),m)?(c[g-1]=r.swap(c[e],c[e]=c[g-1]),g--):e++}if(u){const e=n.getCoord2D(.25);_+=e.sub(h).crossProduct(y.sub(h)),y.assign(e),e.assign(n.getCoord2D(.75)),_+=e.sub(h).crossProduct(y.sub(h)),y.assign(e)}if(f=t,f===s)return g>1?0:u?_<0?-u:u:1}}removeSpanBetween(e,t,s){e.setSegmentToIndex(e.getVertexIndex(t),null);const n=e.getNextVertex(t);n!==s&&e.removeVertices(n,s)}static st_stitchCurvesImpl(e,t,i,r,o){if(!t.hasSegmentParentage())return;is(t);let a=i===n.nullHandle?t.getFirstGeometry():i;for(;a!==n.nullHandle;)if(s.isLinear(t.getGeometryType(a))){for(let i=t.getFirstPath(a);i!==n.nullHandle;i=t.getNextPath(i)){let a=t.getPathSize(i);const m=t.isClosedPath(i);m&&(a+=1);let h=t.getFirstVertex(i);const l=t.getSegmentParentage(h);if(m){if(-1!==l&&!t.getSegmentParentageBreakVertex(h)){let e=t.getPrevVertex(h);const n=h;for(let i=0;;i++){const r=t.getSegmentParentage(e);if(l!==r){s.geometryReleaseAssert(-1===r);break}if(h=e,t.getSegmentParentageBreakVertex(e))break;if(e===n){h=n,t.setSegmentParentageBreakVertex(h,!0);break}e=t.getPrevVertex(e),s.geometryReleaseAssert(i<a)}}}else s.geometryReleaseAssert(-1===l||t.getSegmentParentageBreakVertex(h));let u=h;for(let i=0;i<a&&u!==n.nullHandle;){const m=t.getSegmentParentage(u);if(-1===m){if(i++,u=t.getNextVertex(u),u===h)break;continue}let l=0,c=n.nullHandle;const g=u;l=1;let d=t.getNextVertex(g);for(;i<a&&d!==n.nullHandle;){i++,c=d,l++;const e=t.getSegmentParentage(d);if(-1===e||t.getSegmentParentageBreakVertex(d))break;s.geometryReleaseAssert(e===m),d=t.getNextVertex(d)}if(c===n.nullHandle){s.geometryReleaseAssert(0);break}if(!o){const s=e.m_originalPlanarSegments[m];e.processSpan_(t,g,c,l,s,m,r)}if(u=c,u===h)break}}if(i!==n.nullHandle)break;a=t.getNextGeometry(a)}else a=i===n.nullHandle?t.getNextGeometry(a):n.nullHandle}static st_stitchCurvesFromLinesImpl(e,t,i,r,o){let a=i===n.nullHandle?t.getFirstGeometry():i;for(;a!==n.nullHandle;){for(let i=t.getFirstPath(a);i!==n.nullHandle;i=t.getNextPath(i)){let a=t.getPathSize(i);t.isClosedPath(i)&&(a+=1);let m=!0,h=!1;const l=t.getFirstVertex(i);let u=l;for(let i=0;i<a&&u!==n.nullHandle;){let c=t.getSegmentParentage(u);if(-1===c||m){m=!1,i++,u=t.getNextVertex(u),h=!0;continue}let g,d,p=0;if(h?(g=t.getPrevVertex(u),d=u,s.geometryReleaseAssert(g!==n.nullHandle),s.geometryReleaseAssert(d!==g),s.geometryReleaseAssert(-1===t.getSegmentParentage(g)||l===g)):(g=u,d=t.getNextVertex(g),i++,s.geometryReleaseAssert(d!==n.nullHandle),s.geometryReleaseAssert(d!==g),c=t.getSegmentParentage(d)),p=2,h=!1,-1===c||t.getSegmentParentageBreakVertex(d)){u=d;continue}let _=t.getNextVertex(d);for(i++;i<a&&_!==n.nullHandle;){d=_,p++;const e=t.getSegmentParentage(_);if(-1===e||t.getSegmentParentageBreakVertex(_))break;s.geometryReleaseAssert(e===c),i++,_=t.getNextVertex(_)}if(!o){const s=e.m_originalPlanarSegments[c];e.processSpan_(t,g,d,p,s,c,r)}u=d}}if(i!==n.nullHandle)break;a=t.getNextGeometry(a)}}static st_stitchCurvesFromCurvesImpl(e,t,i,r,o){let a=i===n.nullHandle?t.getFirstGeometry():i;for(;a!==n.nullHandle;)if(s.isLinear(t.getGeometryType(a))){for(let i=t.getFirstPath(a);i!==n.nullHandle;i=t.getNextPath(i)){let a=t.getPathSize(i);const m=t.isClosedPath(i);m&&(a+=1);let h=t.getFirstVertex(i);if(m){if(-1!==t.getSegmentParentage(h)){let e=h;for(let s=0;!t.getSegmentParentageBreakVertex(e);s++){if(s===a){h=t.getFirstVertex(i),t.setSegmentParentageBreakVertex(e,!0);break}e=t.getPrevVertex(e)}}}else s.geometryReleaseAssert(-1===t.getSegmentParentage(h)||t.getSegmentParentageBreakVertex(h));let l=h;for(let i=0;i<a&&l!==n.nullHandle;){const m=t.getSegmentParentage(l);if(-1===m){i++,l=t.getNextVertex(l);continue}let h=0,u=n.nullHandle;const c=l;h=1;let g=t.getNextVertex(c);for(;i<a&&g!==n.nullHandle;){i++,u=g,h++;const e=t.getSegmentParentage(g);if(-1===e||t.getSegmentParentageBreakVertex(g))break;s.geometryReleaseAssert(e===m),g=t.getNextVertex(g)}if(u===n.nullHandle)break;if(!o){const s=e.m_originalPlanarSegments[m];e.processSpan_(t,c,u,h,s,m,r)}l=u}}if(i!==n.nullHandle)break;a=t.getNextGeometry(a)}else a=i===n.nullHandle?t.getNextGeometry(a):n.nullHandle}static regularizeCurve(e,t,s,i){let o=t.snapControlPoints(i*i);if(o){const n=e.getVertexIndex(s),i=t.clone();e.setSegmentToIndex(n,i)}if(t.getGeometryType()===n.CubicBezier.type){const n=[],a=t.calculateSpecialPointsForCracking(i,n);if(a>0){const m=[];if(a>1)for(let e=0;e<a;e++)if(m.push(t.getCoord2D(n[e])),e>0){const t=(Math.abs(m[e].x)+Math.abs(m[e].y))*r.geomEpsFactor(),s=r.Point2D.distance(m[e-1],m[e]);if(s<t&&s>0){const t=new r.Point2D;r.lerpPoint2D(m[e-1],m[e],.5,t),m[e-1]=t,m[e]=t}}e.splitSegment(s,n,a),o=e.snapControlPoints(s,a+1,i*i)||o;for(let t=0;t<a;t++)s=e.getNextVertex(s),e.setSegmentParentageBreakVertex(s,!0);return a}}return o?0:-1}}function ls(e,t,s,n,i){return new ds(e,s,t,n,i).do_()}function us(e,t,s=1,n=1,r=1,o=1){if(n>o)return e;if(o>n)return t;const a=new i.Point;return function(e,t,s,n,i,r,o,a,m){const h=e.equals(t);if(n>r)return o.assignCopy(e),m[0]=n,a[0]=s,h;if(r>n)return o=t,m[0]=r,a[0]=i,h;o.assignCopy(e);const l=ee(e.getXY(),t.getXY(),s,n,i,r);o.setXY(l.pt),a[0]=l.weight,m[0]=l.rank}(e,t,s,n,r,o,a,[0],[0]),a}function cs(e,t,s){return ds.fixCurveTwoPointLoops(e,t,s)}function gs(e){return i.adjustToleranceForTEClustering(e)}class ds{constructor(e,t,s,n,i){this.m_shape=e,this.m_progressTracker=t,this.m_tolerance=s,this.m_bFilterDegenerateSegments=n,this.m_bTrackChanges=i,this.m_progressCounter=0}do_(){const e=new i.CombinedTolerance(this.m_tolerance.tolerance,this.m_tolerance.resolution),t=gs(e);let o=i.adjustToleranceForTECracking(e);const a=1.00001*o;o*=1.000001;let m=!1;const h=this.m_shape.getTotalPointCount()+10>30?1e3:(this.m_shape.getTotalPointCount()+10)*(this.m_shape.getTotalPointCount()+10),l=this.m_shape.hasPointFeatures();for(let e=0;;e++){this.m_shape.dbgCheckSelection(),e>h&&s.throwInternalErrorException("crack_and_cluster_iteration_exceeded"),this.m_shape.dbgVerifyMonotone();let i=-1;0===e&&(i=this.firstCrack_(),m||=i>0);const r=this.cluster_(t);if(this.m_shape.dbgVerifyMonotone(),m||=r,this.m_bFilterDegenerateSegments){const e=0!==this.m_shape.filterClosePoints(t,!0,!1,this.m_bTrackChanges,n.nullHandle);m||=e,this.m_shape.dbgVerifyMonotone()}const u=this.m_shape.snapControlPointsOnSelection(a*a);m||=u,this.m_shape.dbgCheckSelection();let c=!1;if((0===e&&-1===i||l||Pe(!0,this.m_shape,o,null,this.m_progressTracker))&&(c=this.crack_(a),m||=c,this.m_shape.dbgVerifyMonotone()),!c&&!ds.fixCurveTwoPointLoops(this.m_shape,t,this.m_progressTracker)){this.m_shape.dbgVerifyMonotone();break}}return m&&function(e){if(!e.hasSegmentParentage())return;is(e);const t=new i.AttributeStreamOfInt32(0),s=e.queryVertexIteratorOnSelection();for(let e=s.next();e!==n.nullHandle;e=s.next())t.add(e);if(0===t.size())return;e.sortVerticesSimpleByY(t,0,t.size()),t.add(n.nullHandle);const o=r.Point2D.getNAN();e.queryXY(t.read(0),o);let a=0;const m=r.Point2D.getNAN();for(let s=1,i=t.size();s<i;s++){{const i=t.read(s);i!==n.nullHandle?e.queryXY(i,m):m.setNAN()}if(!m.isEqualPoint2D(o)){if(s-a>1){let i=!1;for(let n=a;n<s;++n){const s=t.read(n);if(e.getSegmentParentageBreakVertex(s)){i=!0;break}}if(!i){const o=(t,s,i)=>{const r=e.getPrevVertex(t),o=e.getNextVertex(t);r!==n.nullHandle?s.assign(e.getXY(r)):s.setNAN(),o!==n.nullHandle?i.assign(e.getXY(o)):i.setNAN()},m=new r.Point2D,h=new r.Point2D;o(t.read(a),m,h);for(let e=a+1;e<s;++e){const s=t.read(e);if(s===n.nullHandle)continue;const a=new r.Point2D,l=new r.Point2D;o(s,a,l);const u=(e,t)=>!!(e.equals(t)||e.isNAN()&&t.isNAN());if(!(u(a,m)&&u(l,h)||u(l,m)&&u(a,h))){i=!0;break}}}if(i)for(let n=a;n<s;++n)e.setSegmentParentageBreakVertex(t.read(n),!0)}o.setCoordsPoint2D(m),a=s}}}(this.m_shape),m}cluster_(e){return $(this.m_shape,e,n.nullHandle,this.m_bTrackChanges,this.m_progressTracker)}crack_(e){return function(e,t,s,n){if(!xe(e))return!1;const i=new ve(n);i.m_shape=e,i.m_tolerance=t,i.m_bTrackChanges=s;let r=!1;const o=e.hasCurves()?5:15;return r=e.getTotalPointCount()<o?i.crackBruteForce_():i.crackerPlaneSweep_(),r}(this.m_shape,e,this.m_bTrackChanges,this.m_progressTracker)}static fixCurveTwoPointLoops(e,t,o){if(!e.hasCurves())return!1;e.dbgVerifyCurves();const a=e.createUserIndexUninitialized(),m=new i.AttributeStreamOfInt32(0),h=e.queryVertexIteratorOnSelection();for(let t=h.next();t!==n.nullHandle;t=h.next())m.add(t),e.setUserIndex(t,a,-1);if(0===m.size())return!1;m.add(n.nullHandle),e.sortVerticesSimpleByY(m,0,m.size()-1);let l=0;const u=e.getXY(m.read(l)),c=new r.Point2D(Number.NaN,Number.NaN),g=[];for(let t=1,s=m.size();t<s;++t){const s=m.read(t),i=s!==n.nullHandle?e.getXY(s):c;if(i.equals(u))continue;const o=[];for(let s=l;s<t;s++){const t=m.read(s),i=e.getPrevVertex(t);if(i!==n.nullHandle&&-1===e.getUserIndex(i,a)){const t=ps(e.getXY(i),e.getSegment(i));0!==r.Point2D.sqrDistance(u,t.otherPt)&&(t.vert=i,t.dir=-1,o.push(t)),e.setUserIndex(i,a,1)}const h=e.getNextVertex(t);if(h!==n.nullHandle&&-1===e.getUserIndex(t,a)){const s=ps(e.getXY(h),e.getSegment(t));0!==r.Point2D.sqrDistance(u,s.otherPt)&&(s.vert=t,s.dir=1,o.push(s)),e.setUserIndex(t,a,1)}}if(o.length>1){o.sort((e,t)=>fs(e,t));const e=ps(c.clone(),null);o.push(e);let t=0;for(let e=1,s=o.length;e<s;e++)if(!o[e].otherPt.equals(o[e-1].otherPt)){if(e-t>1&&null!==o[t].seg){let s=!1;const n=t;for(let i=t+1;i<e;i++)if(!_s(o[n],o[i])){s=!0;break}if(s)for(let s=t;s<e&&null!==o[s].seg;s++)g.push(o[s].vert)}t=e}}l=t,u.setCoordsPoint2D(i)}for(const n of g){const i=e.getSegment(n);s.geometryReleaseAssert(null!==i);const o=e.getXY(n),a=e.getXY(e.getNextVertex(n));if(r.Point2D.distance(o,a)<3*t)e.setSegmentToIndex(e.getVertexIndex(n),null);else{const t=i.lengthToT(.5*i.calculateLength2D());e.splitSegment(n,[t],1)}}return e.removeUserIndex(a),g.length>0}firstCrack_(){const e=this.m_shape.getEnvelope2D(this.m_progressTracker),t=i.calculateToleranceFromGeometryForOp(null,e,!0).total();if(4*t<this.m_tolerance.total()){let e=!1;const s=1.1*t,i=t,r=this.cluster_(s);e||=r;let o=0;this.m_bFilterDegenerateSegments&&(o=this.m_shape.filterClosePoints(0,!0,!1,this.m_bTrackChanges,n.nullHandle));const a=this.crack_(i);return e||=a,e?1:o?2:0}return-1}progress_(e=!1){this.m_progressCounter++,!e&&4095&this.m_progressCounter||(this.m_progressCounter=0)}}function ps(e,t){return{otherPt:e,seg:t,vert:-1,dir:0}}function _s(e,t){if(s.geometryReleaseAssert(e.otherPt.equals(t.otherPt)),null===e.seg)return null===t.seg;if(null===t.seg)return!1;const n=e.seg.getGeometryType();if(n!==t.seg.getGeometryType())return!1;if(n===s.GeometryType.enumBezier){const s=e.seg,n=t.seg;let i=s.getControlPoint1(),o=s.getControlPoint2();-1===e.dir&&(o=r.swap(i,i=o));let a=n.getControlPoint1(),m=n.getControlPoint2();return-1===t.dir&&(m=r.swap(a,a=m)),i.equals(a)&&o.equals(m)}if(n===s.GeometryType.enumRationalBezier2){const s=e.seg,n=t.seg,i=s.getControlPoint1(),o=n.getControlPoint1();if(!i.equals(o))return!1;const a=[0,0,0];s.queryWeights(a),-1===e.dir&&(a[2]=r.swap(a[0],a[0]=a[2]));const m=[0,0,0];return n.queryWeights(m),-1===t.dir&&(m[2]=r.swap(m[0],m[0]=m[2])),a[0]===m[0]&&a[1]===m[1]&&a[2]===m[2]}s.throwInternalErrorException("")}function fs(e,t){const s=e.otherPt.compare(t.otherPt);return 0!==s?s:function(e,t){if(null===e.seg||null===t.seg)return null!==e.seg?-1:null!==t.seg?1:0;const s=e.seg.getGeometryType(),n=t.seg.getGeometryType();return s<n?-1:s>n?1:0}(e,t)}var ys=s.isMultiPath,xs=s.isSegment,Ps=s.getDimensionFromType;function Es(e,t,n,r,o,a,m){const h=new Is(o);h.m_bOGCOutput=!0;const l=e.getGeometryType()===s.GeometryType.enumPolygon&&1===e.getFillRule()&&!i.isAtLeastWeakSimple(r);return h.planarSimplifyImpl_(e,t,l,n,r,o,a,m)}function vs(e,t,s,n,i,r,o,a){return new Is(r).planarSimplifyImpl_(e,t,s,n,i,r,o,a)}function Cs(e,t,n){return function(e,t,n){const i=e.createInstance(),o=r.makeObjectArray(r.Point2D,100),a=new Array(100),m=e.getPointCount();let h=!0;const l=2===t.getDimension();1!==t.getDimension()&&2!==t.getDimension()&&s.throwInternalErrorException("");for(let s=0;s<m;){const r=e.queryCoordinates(o,o.length,s,-1)-s;l?Kt(t,o,r,n.total(),a):$t(t,o,r,n.total(),a);let m=0;for(let t=0;t<r;t++)0===a[t]&&(h&&(h=!1,i.addPoints(e,0,s)),m!==t&&i.addPoints(e,s+m,s+t),m=t+1);h||m===r||i.addPoints(e,s+m,s+r),s+=r}return h?e:i}(e,t,n)}function Ds(e,t,n){return function(e,t,n){if(e.isEmpty())return e.createInstance();if(t.isEmpty())return e.createInstance();const i=[new r.Point2D],o=[0],a=2===t.getDimension();return 1!==t.getDimension()&&2!==t.getDimension()&&s.throwInternalErrorException(""),i[0]=e.getXY(),a?Kt(t,i,1,n.total(),o):$t(t,i,1,n.total(),o),0!==o[0]?e:e.createInstance()}(e,t,n)}function bs(e,t,r,o,a,m=!1){0===t&&s.throwInvalidArgumentException("not enough geometries to dissolve");let h=0;for(let s=0,n=t;s<n;s++)h=Math.max(e[s].getDimension(),h);if(2===h||1===h)return new Is(o).dissolveMultiPaths_(h,!1,e,t,r,a,m);let l=0,u=-1;for(let s=0,n=t;s<n;s++)e[s].getDimension()===h&&(-1===u&&(u=s),e[s].isEmpty()||(u=s,l++));if(l<2)return Ts(e[u]);const c=i.Envelope3D.constructEmpty(),g=new n.EditShape;let d=n.nullHandle;for(let s=0,r=t;s<r;s++)if(e[s].getDimension()===h&&!e[s].isEmpty()){d===n.nullHandle?d=g.addGeometry(Ts(e[s])):g.appendGeometry(d,Ts(e[s]));const t=i.Envelope3D.constructEmpty();e[s].queryLooseEnvelope(t),c.mergeEnv3D(t)}const p=i.calculateToleranceFromGeometryForOp(r,c.getEnvelope2D(),!0),_=new Is(o);if(m){const e=i.calculateZToleranceFromGeometryForOpEnv1D(r,c.getEnvelopeZs(),!0);return _.planarSimplify3DImpl_(g,p,e,0,!0)}return _.m_bOGCOutput=!0,_.planarSimplifyMultiPoints(g,p,!1,-1)}function Ss(e,t,r,o,a,m=!1){t<2&&s.throwInvalidArgumentException("not enough geometries to dissolve");let h=0;for(let s=0,n=t;s<n;s++)h=Math.max(e[s].getDimension(),h);if(2===h||1===h)return new Is(o).dissolveMultiPaths_(h,!0,e,t,r,a,m);const l=i.Envelope3D.constructEmpty(),u=new n.EditShape;let c=n.nullHandle,g=0,d=-1;for(let s=0,r=t;s<r;s++)if(e[s].getDimension()===h&&(-1===d&&(d=s),!e[s].isEmpty())){d=s,c===n.nullHandle?c=u.addGeometry(Ts(e[s])):u.appendGeometry(c,Ts(e[s]));const t=i.Envelope3D.constructEmpty();e[s].queryLooseEnvelope(t),l.mergeEnv3D(t),g++}if(g<2)return Ts(e[d]);const p=0===h?r:null,_=i.calculateToleranceFromGeometryForOp(p,l.getEnvelope2D(),!0),f=new Is(o);if(m){const e=i.calculateZToleranceFromGeometryForOpEnv1D(p,l.getEnvelopeZs(),!0);return f.m_bOGCOutput=!0,f.planarSimplify3DImpl_(u,_,e,0,!0)}return f.planarSimplifyMultiPoints(u,_,!0,-1)}class Is{constructor(e){this.m_topoGraph=null,this.m_maskLookup=[],this.m_dummyPt1=r.Point2D.getNAN(),this.m_dummyPt2=r.Point2D.getNAN(),this.m_fromEdgeForPolylines=n.nullHandle,this.m_progressCounter=0,this.m_bOGCOutput=!1,this.m_progressTracker=e}linesToPolygonsImpl(e,t){let s=0,i=0,r=null;if(e.hasCurves()){r=new ms;const n=e.getEnvelope2D(this.m_progressTracker);i=os(t.total());const o=rs(t.total(),n);s=as(o,i),ss(e,o,t.total(),0,r,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(e,t.add(s));const o=this.m_topoGraph.createUserIndexForChains(),a=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(a,o,1);for(let e=this.m_topoGraph.getChainFirstIsland(a);e!==n.nullHandle;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,o,1);const m=[];for(let t=this.m_topoGraph.getFirstChain();t!==n.nullHandle;t=this.m_topoGraph.getChainNext(t)){if(1===this.m_topoGraph.getChainUserIndex(t,o))continue;this.m_topoGraph.setChainUserIndex(t,o,1);for(let e=this.m_topoGraph.getChainFirstIsland(t);e!==n.nullHandle;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,o,1);if(0===this.m_topoGraph.getChainArea(t))continue;const s=this.m_topoGraph.extractPolygonFromChainAndIslands(e,n.nullHandle,t,n.nullHandle);null!=r&&r.stitchCurves(e,s,i,!1);const a=e.getGeometry(s);m.push(a)}return new l.SimpleGeometryCursor(m)}autoCompleteImpl(e,t,s){let i=0,r=0,o=null;if(e.hasCurves()){o=new ms;const t=e.getEnvelope2D(this.m_progressTracker);r=os(s.total());const n=rs(s.total(),t);i=as(n,r),ss(e,n,s.total(),0,o,null,this.m_progressTracker)}this.setEditShapeCrackAndCluster(e,s.add(i));const a=this.m_topoGraph.getGeometryID(t),m=this.m_topoGraph.createUserIndexForChains(),h=this.m_topoGraph.getFirstChain();this.m_topoGraph.setChainUserIndex(h,m,1);for(let e=this.m_topoGraph.getChainFirstIsland(h);e!==n.nullHandle;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,m,1);const u=[];for(let t=this.m_topoGraph.getFirstChain();t!==n.nullHandle;t=this.m_topoGraph.getChainNext(t)){if(1===this.m_topoGraph.getChainUserIndex(t,m))continue;this.m_topoGraph.setChainUserIndex(t,m,1);for(let e=this.m_topoGraph.getChainFirstIsland(t);e!==n.nullHandle;e=this.m_topoGraph.getChainNextInParent(e))this.m_topoGraph.setChainUserIndex(e,m,1);if(0!==this.m_topoGraph.getChainParentage(t))continue;const s=this.m_topoGraph.getChainHalfEdge(t);let i=s,h=!1;do{const e=this.m_topoGraph.getHalfEdgeTwin(i);if(this.m_topoGraph.getHalfEdgeChain(e)!==t&&0!==(this.m_topoGraph.getHalfEdgeParentage(i)&a)){h=!0;break}i=this.m_topoGraph.getHalfEdgeNext(i)}while(i!==s);if(!h)continue;if(0===this.m_topoGraph.getChainArea(t))continue;const l=this.m_topoGraph.extractPolygonFromChainAndIslands(e,n.nullHandle,t,n.nullHandle);null!==o&&o.stitchCurves(e,l,r,!1);const c=e.getGeometry(l);u.push(c)}return new l.SimpleGeometryCursor(u)}setEditShape(e,t=!1){null===this.m_topoGraph&&(this.m_topoGraph=new U),this.m_topoGraph.setEditShape(e,this.m_progressTracker,!0,t)}setEditShapeCrackAndCluster(e,t){ls(e,t,this.m_progressTracker,!0,!1);for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))e.getGeometryType(t)===s.GeometryType.enumPolygon&&Ae(e,t,-1,this.m_bOGCOutput,n.nullHandle,this.m_progressTracker);this.setEditShape(e)}setHalfEdgeOrientations_(e,t){const s=this.m_topoGraph.getShape();for(let i=s.getFirstGeometry();i!==n.nullHandle;i=s.getNextGeometry(i))if(i===t)for(let t=s.getFirstPath(i);t!==n.nullHandle;t=s.getNextPath(t)){let i=s.getFirstVertex(t);if(i===n.nullHandle)continue;let r=s.getNextVertex(i);for(;r!==n.nullHandle;){const t=this.m_topoGraph.getClusterFromVertex(i),o=this.m_topoGraph.getClusterFromVertex(r),a=this.m_topoGraph.getHalfEdgeConnector(t,o);if(a!==n.nullHandle){const t=this.m_topoGraph.getHalfEdgeTwin(a);this.m_topoGraph.setHalfEdgeUserIndex(a,e,1),this.m_topoGraph.setHalfEdgeUserIndex(t,e,2)}i=r,r=s.getNextVertex(i)}}}flushVertices_(e,t){const s=this.m_topoGraph.getShape(),i=s.hasSegmentParentage(),r=new n.SegmentBuffer,o=s.insertPath(e,n.nullHandle);t.push(t[0]);const a=t.length;let m=n.nullHandle;for(let e=0;e<a;e++){const n=t[e];if(m=s.addVertex(o,n),!i)continue;const h=this.m_topoGraph.getClusterFromVertex(n);if(e>0&&this.m_topoGraph.isBreakNode(h)&&s.setSegmentParentageBreakVertex(m,!0),e<a-1){const n=this.m_topoGraph.getHalfEdgeConnector(h,this.m_topoGraph.getClusterFromVertex(t[e+1])),i=this.m_topoGraph.getSegmentParentage(n);s.setSegmentParentageAndBreak(m,i,e>0||this.m_topoGraph.isBreakNode(h)),this.m_topoGraph.isHalfEdgeCurve(n)&&(this.m_topoGraph.querySegmentXY(n,r),s.setSegmentToIndex(s.getVertexIndex(m),r.get().clone()))}}if(i){const e=this.m_topoGraph.getClusterFromVertex(t[a-1]);this.m_topoGraph.isBreakNode(e)&&s.setSegmentParentageBreakVertex(m,!0)}s.setClosedPath(o,!0)}processPolygonCuts_(e,t,i,r){const o=this.m_topoGraph.getGeometryID(i),a=this.m_topoGraph.getGeometryID(r),m=[],h=this.m_topoGraph.getShape(),l=this.m_topoGraph.createUserIndexForHalfEdges();for(let i=this.m_topoGraph.getFirstCluster();i!==n.nullHandle;i=this.m_topoGraph.getNextCluster(i)){const r=this.m_topoGraph.getClusterHalfEdge(i);if(r===n.nullHandle)continue;let u=r;do{if(1!==this.m_topoGraph.getHalfEdgeUserIndex(u,l)){let n=u,i=u,r=!1,c=0;do{if(this.m_topoGraph.setHalfEdgeUserIndex(n,l,1),r||0!==(this.m_topoGraph.getHalfEdgeParentage(n)&a)&&0!==(this.m_topoGraph.getHalfEdgeFaceParentage(n)&o)&&(i=n,r=!0),r){const t=this.m_topoGraph.getHalfEdgeOrigin(n),s=this.m_topoGraph.getClusterVertexIterator(t),i=this.m_topoGraph.getVertexFromVertexIterator(s);m.push(i),-1!==e&&0!==(this.m_topoGraph.getHalfEdgeParentage(n)&a)&&(c|=this.m_topoGraph.getHalfEdgeUserIndex(n,e))}n=this.m_topoGraph.getHalfEdgeNext(n)}while(n!==i);if(r&&this.m_topoGraph.getChainArea(this.m_topoGraph.getHalfEdgeChain(i))>0){const e=h.createGeometry(s.GeometryType.enumPolygon);this.flushVertices_(e,m),-1!==t&&h.setGeometryUserIndex(e,t,c)}m.length=0}u=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(u))}while(u!==r)}this.m_topoGraph.deleteUserIndexForHalfEdges(l)}cutPolygonPolyline_(e,t,s,i){this.m_topoGraph.removeSpikes_();let r=-1;-1!==e&&(r=this.m_topoGraph.createUserIndexForHalfEdges(),this.setHalfEdgeOrientations_(r,s)),this.processPolygonCuts_(r,e,t,s),-1!==r&&(this.m_topoGraph.deleteUserIndexForHalfEdges(r),r=-1);const o=this.m_topoGraph.getShape();for(let e=o.getFirstGeometry();e!==n.nullHandle;e=o.getNextGeometry(e))e!==t&&e!==s&&i.push(e);i.sort((e,t)=>{const s=o.getFirstPath(e),n=o.getRingArea(s),i=o.getFirstPath(t),r=o.getRingArea(i);return n<r?-1:n>r?1:0})}cut(e,t,n,i,r){const o=this.m_topoGraph.getShape().getGeometryType(n),a=this.m_topoGraph.getShape().getGeometryType(i),m=s.getDimensionFromType(o),h=s.getDimensionFromType(a);if(2!==m||1!==h){if(1===m&&1===h)return void new Ns(this,e,t,n,i,r).Do();s.throwInternalErrorException("")}else this.cutPolygonPolyline_(t,n,i,r)}progress_(e=!1){}isGoodParentage(e){return e>=0&&e<this.m_maskLookup.length&&this.m_maskLookup[e]}normalizeInputGeometry(e){const t=e.getGeometryType();if(t===s.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t===s.GeometryType.enumPoint){const t=new n.MultiPoint({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(s.isSegment(t)){const t=new n.Polyline({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}return t!==s.GeometryType.enumMultiPoint&&t!==s.GeometryType.enumPolyline&&t!==s.GeometryType.enumPolygon&&s.throwInvalidArgumentException("Unexpected geometry type"),e}dissolveNonSimplePolygons(e,t,i,r){s.geometryReleaseAssert(t>0);const o=new n.EditShape;let a=0,m=-1;for(let s=0,n=t;s<n;s++)2===e[s].getDimension()&&(-1===m&&(m=s),e[s].isEmpty()||(a++,o.addGeometry(e[s])));return 0===a?(s.geometryReleaseAssert(m>=0),this.normalizeInputGeometry(e[m])):this.planarSimplifyPolygons(o,i,!0,!1,-1,!0)}dissolveMultiPaths_(e,o,a,m,h,l,u){s.geometryReleaseAssert(e>=1&&e<=2),s.geometryReleaseAssert(m>0);const c=8&l?1:2,g=i.Envelope3D.constructEmpty();let d=0,p=-1,_=!0;for(let t=0,n=m;t<n;t++)if(a[t].getDimension()===e&&(-1===p&&(p=t),!a[t].isEmpty())){p=t,d++;const n=i.Envelope3D.constructEmpty();if(a[t].queryLooseEnvelope(n),g.mergeEnv3D(n),2===e&&_&&a[t].getGeometryType()===s.GeometryType.enumPolygon)if(16&l){const e=[0],s=a[t].getImpl().getIsSimple(0,e),n=this.m_bOGCOutput?5===s:i.isAtLeastPlanarSimple(s);_&&=n}else{const e=i.isAtLeastWeakSimpleGeom(a[t],0);_&&=e}}if(d<2&&(s.geometryReleaseAssert(p>=0),0===d||!(16&l)))return this.normalizeInputGeometry(a[p]);if(!_){const e=i.calculateToleranceFromGeometryForOp(o?null:h,g.getEnvelope2D(),!0);return this.dissolveNonSimplePolygons(a,m,e,l)}const f=a.slice(0,m),y=i.calculateToleranceFromGeometryForOp(h,g.getEnvelope2D(),!0),x=10*i.adjustToleranceForTEClustering(y);let P=new i.CombinedTolerance(0,0);if(u&&(P=i.calculateZToleranceFromGeometryForOpEnv1D(h,g.getEnvelopeZs(),!0)),1===d&&1===e&&2===c&&!o)return u?(s.geometryReleaseAssert(0),{}):this.m_bOGCOutput?Es(f[p],y,!1,-1,this.m_progressTracker,c,!1):vs(f[p],y,!1,!1,-1,this.m_progressTracker,c,!1);const E=new i.Envelope2DIntersector;E.startConstruction();let v=2===e?3:4,C=0;for(let n=0,r=m;n<r;n++){if(f[n].getDimension()!==e||f[n].isEmpty())continue;let r=f[n].getGeometryType();if(r!==s.GeometryType.enumEnvelope){if(s.isSegment(r)?(f[n]=this.normalizeInputGeometry(f[n]),r=s.GeometryType.enumPolyline):s.geometryReleaseAssert(s.isMultiPath(r)),1===e){s.geometryReleaseAssert(r===s.GeometryType.enumPolyline);let e=-1;if(u)s.geometryReleaseAssert(0,"3d not implemented yet");else{const t=[0];e=f[n].getImpl().getIsSimple(y.total(),t)}if(this.m_bOGCOutput?5!==e:!i.isAtLeastPlanarSimple(e))if(o)v=-1;else{u?s.geometryReleaseAssert(0,"3d not implemented yet"):this.m_bOGCOutput?f[n]=Es(f[n],y,!1,-1,this.m_progressTracker,c,!1):f[n]=vs(f[n],y,!1,!1,-1,this.m_progressTracker,c,!1);const e=[0];s.geometryReleaseAssert(i.isAtLeastPlanarSimple(f[n].getImpl().getIsSimple(y.total(),e)))}}else{s.geometryReleaseAssert(r===s.GeometryType.enumPolygon);const e=[0],t=f[n].getImpl().getIsSimple(0,e);s.geometryReleaseAssert(i.isAtLeastWeakSimple(t))}const a=f[n].getImpl();for(let e=0,s=a.getPathCount();e<s;e++){const s=t.Envelope2D.constructEmpty();a.queryLoosePathEnvelope(e,s),s.inflateCoords(x,x),E.addEnvelope(C,s),C++}}else{s.geometryReleaseAssert(r===s.GeometryType.enumEnvelope);const e=t.Envelope2D.constructEmpty();f[n].queryLooseEnvelope(e),e.inflateCoords(x,x),E.addEnvelope(C,e),C++,v=-1}}E.endConstruction();const D=C,b=r.makePrimitiveArray(D,-2147483647),S=r.makePrimitiveArray(D,-1);let I=0;p=-1,C=0;for(let t=0,n=m;t<n;t++){if(f[t].getDimension()!==e)continue;if(-1===p&&(p=t),f[t].isEmpty())continue;p=t,I++;const n=f[t].getGeometryType();if(s.isMultiPath(n))for(let e=0,s=f[t].getPathCount();e<s;e++)S[C]=t,b[C]=-e-1,C++;else s.geometryReleaseAssert(n===s.GeometryType.enumEnvelope),S[C]=t,b[C]=-1,C++}if(I<2&&2===e)return s.geometryReleaseAssert(p>=0),this.normalizeInputGeometry(f[p]);let w=D;for(;E.next()&&w>0;){this.progress_();const e=E.getHandleA(),t=E.getHandleB(),s=E.getElement(e),n=E.getElement(t);S[s]!==S[n]&&(b[s]<0&&(w--,b[s]=-(b[s]+1)),b[n]<0&&(w--,b[n]=-(b[n]+1)))}const T=new n.EditShape;let A,N=!1,G=0;for(let t=0,i=m;t<i;t++){if(f[t].getDimension()!==e||f[t].isEmpty())continue;const i=f[t].getGeometryType(),r=G;let o=0,a=0;const m=s.isMultiPath(i)?f[t]:null;for(let e=r,n=b.length;e<n&&S[e]===t;e++)b[e]>=0&&(o++,a+=m?m.getPathSize(b[e]):s.vertexCount(f[t])),G++;if(a>.95*s.vertexCount(f[t])){T.addGeometry(this.normalizeInputGeometry(f[t]));for(let e=r;e<G;e++)b[e]<0&&(b[e]=-(b[e]+1))}else{if(0===o){N=!0;continue}{N=!0,s.geometryReleaseAssert(s.isMultiPath(i)),s.geometryReleaseAssert(null!=m);const e=new n.Polygon({vd:f[t].getDescription()}),o=new n.Polyline({vd:f[t].getDescription()}),a=i===s.GeometryType.enumPolygon?e:o;for(let e=r;e<G;e++)b[e]>=0&&a.addPath(m,b[e],!0);T.addGeometry(a)}}}if(T.getFirstGeometry()!==n.nullHandle){const t=2===e,s=o?i.calculateToleranceFromGeometryForOp(null,g.getEnvelope2D(),!0):y;let r=new i.CombinedTolerance(0,0);if(u&&(r=o?i.calculateZToleranceFromGeometryForOpEnv1D(null,g.getEnvelopeZs(),!0):P),2===e&&!(2&l)){T.collapseAllGeometriesToFirst();let e=0,t=null;if(T.hasCurves()&&!T.hasSegmentParentage()){t=new ms;const n=T.getEnvelope2D(this.m_progressTracker);e=os(s.total()),ss(T,rs(s.total(),n),s.total(),0,t,null,this.m_progressTracker)}!function(e,t,s,n){s>0&&$(e,s,t,!1,n),new ye(n).executeImpl_(e,t)}(T,T.getFirstGeometry(),s.total(),this.m_progressTracker),null!==t&&t.stitchCurves(T,n.nullHandle,e,!0)}if(u)A=this.planarSimplify3DImpl_(T,s,r,c,!0);else if(2===e)A=this.planarSimplifyPolygons(T,s,t,o,-1,!1);else{const e={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};e.ogcRule=this.m_bOGCOutput,e.allCrossRoadsImpassable=!0,e.unsplitBehavior=c,A=this.planarSimplifyPolylines(T,s,o,e,-1)}if(!N){const e=[0];v=A.getImpl().getIsSimple(s.total(),e)}}else s.geometryReleaseAssert(N),s.geometryReleaseAssert(p>=0),A=2===e?new n.Polygon({vd:f[p].getDescription()}):new n.Polyline({vd:f[p].getDescription()});if(N){let e=0;for(let t=0,n=b.length;t<n;t++){const n=S[t];if(!(n<0)&&b[t]<0){const i=f[n].getGeometryType(),r=s.isMultiPath(i)?f[n]:null;if(r){const s=-(b[t]+1);e+=r.getPathSize(s)}else e+=4}}A.reserve(A.getPointCount()+e);for(let e=0,t=b.length;e<t;e++){const t=S[e];if(!(t<0)&&b[e]<0){const n=f[t].getGeometryType(),i=s.isMultiPath(n)?f[t]:null;if(i){const t=-(b[e]+1);A.addPath(i,t,!0)}else n===s.GeometryType.enumEnvelope?A.addEnvelope(f[t],!1):(s.geometryReleaseAssert(s.isSegment(n)),A.addSegment(f[t],!0))}}}let M=0;if(2===e?-1!==v&&(v=3,M=o?0:y.total()):(s.geometryReleaseAssert(1===e),o||-1===v||(M=y.total())),u||A.getImpl().setIsSimple(v,M),!o&&N)if(2===e){if(!u)return(new Bs).execute(A,h,!1,this.m_progressTracker);s.geometryReleaseAssert(0,"3d not yet implemented")}else 1===e&&1!==c&&(u?(s.geometryReleaseAssert(0),A={}):A=function(e,t,i,r){const o=new Is(r),a=new n.EditShape,m=a.addGeometry(t),h=o.planarSimplifyNoCrackingAndCluster(e,a,m,i);return s.geometryReleaseAssert(h,"planar_simplify_no_cracking_and_cluster"),a.getGeometry(m)}(this.m_bOGCOutput,A,c,this.m_progressTracker),A.getImpl().setIsSimple(v,M));return A}dissolveTopoGraphCommonEdges_(){const e=this.m_topoGraph.createUserIndexForHalfEdges(),t=[];for(let s=this.m_topoGraph.getFirstCluster();s!==n.nullHandle;s=this.m_topoGraph.getNextCluster(s)){const i=this.m_topoGraph.getClusterHalfEdge(s);let r=i;if(i!==n.nullHandle)do{if(this.progress_(),1!==this.m_topoGraph.getHalfEdgeUserIndex(r,e)){const s=this.m_topoGraph.getHalfEdgeTwin(r);this.m_topoGraph.setHalfEdgeUserIndex(s,e,1),this.m_topoGraph.setHalfEdgeUserIndex(r,e,1);const n=this.m_topoGraph.getHalfEdgeFaceParentage(r);if(this.isGoodParentage(n)){const e=this.m_topoGraph.getHalfEdgeFaceParentage(s);this.isGoodParentage(e)&&t.push(r)}}r=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(r))}while(r!==i)}this.m_topoGraph.deleteUserIndexForHalfEdges(e),this.m_topoGraph.deleteEdgesBreakFaces_(t)}chooseVertexByOrder(e,t,i,o){let a=r.indexTypeMax(),m=n.nullHandle;for(let s=this.m_topoGraph.getClusterVertexIterator(e);s!==n.nullHandle;s=this.m_topoGraph.incrementVertexIterator(s)){const e=this.m_topoGraph.getVertexFromVertexIterator(s),n=t.getUserIndex(e,i);n>=0&&n<a&&(a=n,m=e)}s.geometryReleaseAssert(m!==n.nullHandle);let h=t.getUserIndex(m,o);return h>0&&(t.setUserIndex(m,o,--h),0===h&&t.setUserIndex(m,i,-1)),m}chooseVertexFromCluster_(e,t){return this.m_topoGraph.getVertexDominantFromCluster(e,t)}chooseVertexFromVertexCluster_(e,t){return this.m_topoGraph.getVertexDominant(e,t)}collectPolygonPathsPreservingFrom_(e,t,i,r,o){const a=this.m_topoGraph.getShape();if(a.getGeometryType(e)!==s.GeometryType.enumPolygon)return;const m=a.hasSegmentParentage(),h=new n.SegmentBuffer;for(let s=a.getFirstPath(e);s!==n.nullHandle;s=a.getNextPath(s)){const e=a.getFirstVertex(s);this.m_topoGraph.getClusterFromVertex(e);const l=this.m_topoGraph.getHalfEdgeFromVertex(e);if(l===n.nullHandle)continue;const u=this.m_topoGraph.getHalfEdgeUserIndex(l,i);if(1===u||2===u)continue;const c=this.m_topoGraph.getHalfEdgeFaceParentage(l);if(!this.isGoodParentage(c)){this.m_topoGraph.setHalfEdgeUserIndex(l,i,2);continue}this.m_topoGraph.setHalfEdgeUserIndex(l,i,1);const g=a.insertPath(t,n.nullHandle);a.setClosedPath(g,!0);let d=l,p=e,_=this.m_topoGraph.getClusterFromVertex(p),f=1;do{this.progress_();const e=this.chooseVertexFromVertexCluster_(p,o),t=a.addVertex(g,e);if(this.m_topoGraph.isHalfEdgeCurve(d)&&(this.m_topoGraph.querySegmentXY(d,h),a.setSegmentToIndex(a.getVertexIndex(t),h.get().clone())),m){const e=this.m_topoGraph.getSegmentParentage(d);a.setSegmentParentageAndBreak(t,e,this.m_topoGraph.isBreakNode(_))}let s,l;-1!==r&&this.m_topoGraph.setClusterUserIndex(_,r,1),this.m_topoGraph.setHalfEdgeUserIndex(d,i,1),d=this.m_topoGraph.getHalfEdgeNext(d);do{s=1===f?a.getNextVertex(p):a.getPrevVertex(p),l=s!==n.nullHandle?this.m_topoGraph.getClusterFromVertex(s):n.nullHandle}while(l===_);const u=this.m_topoGraph.getHalfEdgeOrigin(d);if(u!==l){do{s=1===f?a.getPrevVertex(p):a.getNextVertex(p),l=s!==n.nullHandle?this.m_topoGraph.getClusterFromVertex(s):n.nullHandle}while(l===_);if(u!==l){l=u;const e=this.m_topoGraph.getClusterVertexIterator(l);s=this.m_topoGraph.getVertexFromVertexIterator(e)}else f=-f}_=l,p=s}while(d!==l)}}topoOperationPolygonPolygonHelper_(e,t,s,i,r,o){this.progress_(!0),e!==n.nullHandle&&this.collectPolygonPathsPreservingFrom_(e,s,r,o,i),t!==n.nullHandle&&this.collectPolygonPathsPreservingFrom_(t,s,r,o,i);const a=new n.SegmentBuffer,m=this.m_topoGraph.getShape();m.dbgVerifyCurves();const h=m.hasSegmentParentage();for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle;e=this.m_topoGraph.getNextCluster(e)){const t=this.m_topoGraph.getClusterHalfEdge(e);if(t===n.nullHandle)continue;let l=t;do{this.progress_();const e=this.m_topoGraph.getHalfEdgeUserIndex(l,r);if(1!==e&&2!==e){const e=this.m_topoGraph.getHalfEdgeFaceParentage(l);if(this.isGoodParentage(e)){const e=m.insertPath(s,n.nullHandle);m.setClosedPath(e,!0);let t=l;do{const s=this.m_topoGraph.getHalfEdgeVertexIterator(t);let l=n.nullHandle;if(s!==n.nullHandle)l=this.m_topoGraph.getVertexFromVertexIterator(s);else{const e=this.m_topoGraph.getHalfEdgeVertexIterator(this.m_topoGraph.getHalfEdgeTwin(t));l=this.m_topoGraph.getVertexFromVertexIterator(e),l=m.getNextVertex(l)}const u=this.chooseVertexFromVertexCluster_(l,i),c=m.addVertex(e,u);if(h){const e=this.m_topoGraph.getSegmentParentage(t),s=this.m_topoGraph.getHalfEdgeOrigin(t);m.setSegmentParentageAndBreak(c,e,this.m_topoGraph.isBreakNode(s))}if(this.m_topoGraph.isHalfEdgeCurve(t)&&(this.m_topoGraph.querySegmentXY(t,a),m.setSegmentToIndex(m.getVertexIndex(c),a.get().clone())),this.m_topoGraph.setHalfEdgeUserIndex(t,r,1),-1!==o){const e=this.m_topoGraph.getClusterFromVertex(u);this.m_topoGraph.setClusterUserIndex(e,o,1)}t=this.m_topoGraph.getHalfEdgeNext(t)}while(t!==l)}else this.m_topoGraph.setHalfEdgeUserIndex(l,r,2)}l=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(l))}while(l!==t)}}topoOperationPolygonPolygon_(e,t,i,r=!1){this.dissolveTopoGraphCommonEdges_();const o=this.m_topoGraph.getShape(),a=o.createGeometry(s.GeometryType.enumPolygon),m=this.m_topoGraph.createUserIndexForHalfEdges();return this.topoOperationPolygonPolygonHelper_(e,t,a,i,m,-1),this.m_topoGraph.deleteUserIndexForHalfEdges(m),r||Ae(o,a,3,this.m_bOGCOutput,n.nullHandle,this.m_progressTracker),a}topoOperationPolyline_(e,t){const s={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return s.ogcRule=t,s.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(n.nullHandle,e,!1,s).first}topoOperationMultiPoint_(){const e=this.m_topoGraph.getShape(),t=e.createGeometry(s.GeometryType.enumMultiPoint),i=e.insertPath(t,n.nullHandle);for(let t=this.m_topoGraph.getFirstCluster();t!==n.nullHandle;t=this.m_topoGraph.getNextCluster(t)){const s=this.m_topoGraph.getClusterParentage(t);if(this.isGoodParentage(s)){let s=n.nullHandle;for(let i=this.m_topoGraph.getClusterVertexIterator(t);i!==n.nullHandle;i=this.m_topoGraph.incrementVertexIterator(i)){const t=this.m_topoGraph.getVertexFromVertexIterator(i);s===n.nullHandle&&(s=t);const r=e.getGeometryFromPath(e.getPathFromVertex(t)),o=this.m_topoGraph.getGeometryID(r);if(this.isGoodParentage(o)){s=t;break}}e.addVertex(i,s)}}return t}intersection(e,t){const i=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),o=s.getDimensionFromType(i),a=s.getDimensionFromType(r),m=this.m_topoGraph.getGeometryID(e),h=this.m_topoGraph.getGeometryID(t);s.geometryReleaseAssert(m>=0),s.geometryReleaseAssert(h>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(m|h),this.m_maskLookup[m|h]=!0;let l=n.nullHandle;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(l=e),2===o&&2===a?this.topoOperationPolygonPolygon_(e,t,l):1===o&&a>0||1===a&&o>0?this.topoOperationPolyline_(l,this.m_bOGCOutput):0===o||0===a?this.topoOperationMultiPoint_():void s.throwInternalErrorException("")}topoOperationPolygonPolygonEx(e,t,i){const r=this.m_topoGraph.getShape(),o=r.createGeometry(s.GeometryType.enumPolygon),a=r.createGeometry(s.GeometryType.enumPolyline),m=r.createGeometry(s.GeometryType.enumMultiPoint);this.dissolveTopoGraphCommonEdges_();let h=n.nullHandle;const l=this.m_topoGraph.createUserIndexForHalfEdges(),u=this.m_topoGraph.createUserIndexForClusters();r.dbgVerifyCurves(),this.topoOperationPolygonPolygonHelper_(e,t,o,i,l,u),r.dbgVerifyCurves();const c=r.hasSegmentParentage(),g=new n.SegmentBuffer;for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle;e=this.m_topoGraph.getNextCluster(e)){const t=this.m_topoGraph.getClusterHalfEdge(e);if(t===n.nullHandle)continue;let s=t;do{let t=this.m_topoGraph.getHalfEdgeUserIndex(s,l),o=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(s),l),m=t|o;if(2===m){let h=this.m_topoGraph.getHalfEdgeParentage(s);if(this.isGoodParentage(h)){const d=r.insertPath(a,n.nullHandle);let p=s;const _=this.chooseVertexFromCluster_(e,i);let f=r.addVertex(d,_);if(c){const e=this.m_topoGraph.getSegmentParentage(s),t=this.m_topoGraph.getHalfEdgeOrigin(s);r.setSegmentParentageAndBreak(f,e,this.m_topoGraph.isBreakNode(t))}this.m_topoGraph.isHalfEdgeCurve(s)&&(this.m_topoGraph.querySegmentXY(s,g),r.setSegmentToIndex(r.getVertexIndex(f),g.get().clone())),this.m_topoGraph.setClusterUserIndex(e,u,1);do{this.progress_();const e=this.m_topoGraph.getHalfEdgeTo(p),n=this.chooseVertexFromCluster_(e,i);if(f=r.addVertex(d,n),c){const e=this.m_topoGraph.getSegmentParentage(s),t=this.m_topoGraph.getHalfEdgeOrigin(s);r.setSegmentParentageAndBreak(f,e,this.m_topoGraph.isBreakNode(t))}if(this.m_topoGraph.setHalfEdgeUserIndex(p,l,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(p),l,1),this.m_topoGraph.setClusterUserIndex(e,u,1),p=this.m_topoGraph.getHalfEdgeNext(p),t=this.m_topoGraph.getHalfEdgeUserIndex(p,l),o=this.m_topoGraph.getHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(p),l),m=t|o,2!==m)break;if(h=this.m_topoGraph.getHalfEdgeParentage(p),!this.isGoodParentage(h)){this.m_topoGraph.setHalfEdgeUserIndex(p,l,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(p),l,1);break}this.m_topoGraph.isHalfEdgeCurve(s)&&p!==s&&(this.m_topoGraph.querySegmentXY(s,g),r.setSegmentToIndex(r.getVertexIndex(f),g.get().clone()))}while(p!==s)}else this.m_topoGraph.setHalfEdgeUserIndex(s,l,1),this.m_topoGraph.setHalfEdgeUserIndex(this.m_topoGraph.getHalfEdgeTwin(s),l,1)}s=this.m_topoGraph.getHalfEdgeNext(this.m_topoGraph.getHalfEdgeTwin(s))}while(s!==t)}for(let e=this.m_topoGraph.getFirstCluster();e!==n.nullHandle;e=this.m_topoGraph.getNextCluster(e)){if(this.progress_(),1===this.m_topoGraph.getClusterUserIndex(e,u))continue;const t=this.m_topoGraph.getClusterParentage(e);if(this.isGoodParentage(t)){h===n.nullHandle&&(h=r.insertPath(m,n.nullHandle));const t=this.m_topoGraph.getClusterVertexIterator(e);let s=n.nullHandle;if(t!==n.nullHandle){s=this.m_topoGraph.getVertexFromVertexIterator(t);const e=this.chooseVertexFromVertexCluster_(s,i);r.addVertex(h,e)}}}this.m_topoGraph.deleteUserIndexForClusters(u),this.m_topoGraph.deleteUserIndexForHalfEdges(l),r.dbgVerifyCurves(),Ae(r,o,3,this.m_bOGCOutput,n.nullHandle,this.m_progressTracker);const d=[n.nullHandle,n.nullHandle,n.nullHandle];return d[0]=m,d[1]=a,d[2]=o,d}topoOperationPolylinePolylineOrPolygonEx(e,t){const s={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return s.ogcRule=t,s.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(n.nullHandle,e,!0,s)}topoOperationMultiPoint(){const e=this.m_topoGraph.getShape(),t=e.createGeometry(s.GeometryType.enumMultiPoint),i=e.insertPath(t,n.nullHandle);for(let t=this.m_topoGraph.getFirstCluster();t!==n.nullHandle;t=this.m_topoGraph.getNextCluster(t)){const s=this.m_topoGraph.getClusterParentage(t);if(this.isGoodParentage(s)){let s=n.nullHandle;for(let i=this.m_topoGraph.getClusterVertexIterator(t);i!==n.nullHandle;i=this.m_topoGraph.incrementVertexIterator(i)){const t=this.m_topoGraph.getVertexFromVertexIterator(i);s===n.nullHandle&&(s=t);const r=e.getGeometryFromPath(e.getPathFromVertex(t)),o=this.m_topoGraph.getGeometryID(r);if(this.isGoodParentage(o)){s=t;break}}e.addVertex(i,s)}}return t}intersectionEx(e,t){const i=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),o=Ps(i),a=Ps(r),m=this.m_topoGraph.getGeometryID(e),h=this.m_topoGraph.getGeometryID(t);s.geometryReleaseAssert(m>=0),s.geometryReleaseAssert(h>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(m|h),this.m_maskLookup[m|h]=!0;let l=n.nullHandle;if(this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(l=e),2===o&&2===a)return this.topoOperationPolygonPolygonEx(e,t,l);if(1===o&&a>0||1===a&&o>0){const{first:e,second:t}=this.topoOperationPolylinePolylineOrPolygonEx(l,this.m_bOGCOutput);return[t,e]}if(0===o||0===a){const e=[];return e.push(this.topoOperationMultiPoint()),e}s.throwInternalErrorException("")}getCombinedHalfEdgeParentage(e){return this.m_topoGraph.getHalfEdgeParentage(e)|this.m_topoGraph.getHalfEdgeFaceParentage(e)|this.m_topoGraph.getHalfEdgeFaceParentage(this.m_topoGraph.getHalfEdgeTwin(e))}prevailingDirection(e,t){const s=this.getCombinedHalfEdgeParentage(t),i=this.m_topoGraph.getHalfEdgeOrigin(t),o=this.m_topoGraph.getHalfEdgeTo(t);let a=0,m=0;for(let r=this.m_topoGraph.getClusterVertexIterator(i);r!==n.nullHandle;r=this.m_topoGraph.incrementVertexIterator(r)){const i=this.m_topoGraph.getVertexFromVertexIterator(r),h=e.getPathFromVertex(i),l=e.getGeometryFromPath(h),u=this.m_topoGraph.getGeometryID(l),c=e.getFirstVertex(h),g=0!==(u&s);g&&c===i&&(this.m_fromEdgeForPolylines=t);const d=e.getNextVertex(i);if(d!==n.nullHandle&&this.m_topoGraph.getClusterFromVertex(d)===o){if(a++,g){if(this.m_fromEdgeForPolylines===n.nullHandle&&c===d){const e=this.m_topoGraph.getHalfEdgeNext(t);this.isGoodParentage(this.getCombinedHalfEdgeParentage(e))&&(this.m_fromEdgeForPolylines=e)}m++}}else{const s=e.getPrevVertex(i);if(s!==n.nullHandle&&this.m_topoGraph.getClusterFromVertex(s)===o&&(a--,g)){if(this.m_fromEdgeForPolylines===n.nullHandle&&c===s){const e=this.m_topoGraph.getHalfEdgeNext(t);this.isGoodParentage(this.getCombinedHalfEdgeParentage(e))&&(this.m_fromEdgeForPolylines=e)}m--}}}return this.m_topoGraph.queryXY(i,this.m_dummyPt1),this.m_topoGraph.queryXY(o,this.m_dummyPt2),(0!==m?m:a)*r.Point2D.distance(this.m_dummyPt1,this.m_dummyPt2)}tryMoveThroughCrossroadBackwards(e,t){const s=this.m_topoGraph.getHalfEdgePrev(e),i=this.m_topoGraph.getHalfEdgeTwin(s);if(!t){if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(e)))return n.nullHandle;const t=this.m_topoGraph.getHalfEdgeTwin(e);if(i===this.m_topoGraph.getHalfEdgeNext(t))return s}let r=i,o=n.nullHandle;for(;r!==e;){const e=this.getCombinedHalfEdgeParentage(r);if(this.isGoodParentage(e)){if(o!==n.nullHandle)return n.nullHandle;o=this.m_topoGraph.getHalfEdgeTwin(r)}r=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgePrev(r))}return o}tryMoveThroughCrossroadForward(e,t){const s=this.m_topoGraph.getHalfEdgeNext(e),i=this.m_topoGraph.getHalfEdgeTwin(s);if(!t){const t=this.m_topoGraph.getHalfEdgeTwin(e);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(t)))return n.nullHandle;if(i===this.m_topoGraph.getHalfEdgePrev(t))return s}let r=i,o=n.nullHandle;for(;r!==e;){const e=this.getCombinedHalfEdgeParentage(r);if(this.isGoodParentage(e)){if(o!==n.nullHandle)return n.nullHandle;o=this.m_topoGraph.getHalfEdgeTwin(r)}r=this.m_topoGraph.getHalfEdgeTwin(this.m_topoGraph.getHalfEdgeNext(r))}return o}isOnALoop(e,t){let n=e;const i=2*this.m_topoGraph.getShape().getTotalPointCount()+10;for(let s=0;s<i;s++){if(1===this.m_topoGraph.getHalfEdgeUserIndex(n,t))return!1;const s=this.m_topoGraph.getHalfEdgeNext(n);if(s===this.m_topoGraph.getHalfEdgeTwin(n))return!1;if(n=s,n===e)return!0}s.throwInternalErrorException("is_on_a_loop_")}restorePolylineParts(e,t,i,o,a,m,h,l,u,c){s.geometryReleaseAssert(a===n.nullHandle&&m>=0&&h>=0||-1===m&&-1===h),s.geometryReleaseAssert(-1===l&&1!==c.unsplitBehavior||-1!==l&&1===c.unsplitBehavior);const g=c.ogcRule,d=c.allCrossRoadsImpassable,p=1===c.unsplitBehavior,_=0===c.unsplitBehavior,f=this.m_topoGraph.getShape(),y=f.hasSegmentParentage();let x=e,P=this.m_topoGraph.getHalfEdgeTwin(x);const E=new n.SegmentBuffer;this.m_fromEdgeForPolylines=n.nullHandle;let v=this.prevailingDirection(f,x),C=x,D=n.nullHandle,b=!1,S=!1,I=!1;if(!p)for(;;){const t=this.m_topoGraph.getHalfEdgePrev(x);if(t===P){I=!0;break}const s=this.m_topoGraph.getHalfEdgeNext(P);if(this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(s))){b=!0;break}if(this.m_topoGraph.getHalfEdgeTwin(t)!==s){if(d){b=!0;break}if(x=this.tryMoveThroughCrossroadBackwards(x,!0),x===n.nullHandle){b=!0;break}P=this.m_topoGraph.getHalfEdgeTwin(x)}else x=t,P=s;if(1===this.m_topoGraph.getHalfEdgeUserIndex(x,i)){I=!0;break}if(x===e){D=e,S=!0;break}const r=this.getCombinedHalfEdgeParentage(x);if(!this.isGoodParentage(r))break;C=x,v+=this.prevailingDirection(f,x)}if(D===n.nullHandle){for(x=e,P=this.m_topoGraph.getHalfEdgeTwin(x),D=x;;){const e=this.m_topoGraph.getHalfEdgeNext(x),t=this.m_topoGraph.isStrongPathNode(this.m_topoGraph.getHalfEdgeOrigin(e));if(t){b=!0;break}if(e===P){I=!0;break}if(-1!==l){const e=this.m_topoGraph.getHalfEdgeOrigin(P);if(1===this.m_topoGraph.getClusterUserIndex(e,l)){b=!0;break}}const s=this.m_topoGraph.getHalfEdgePrev(P);if(this.m_topoGraph.getHalfEdgeTwin(e)!==s){if(t||d){b=!0;break}if(x=this.tryMoveThroughCrossroadForward(x,!0),x===n.nullHandle){b=!0;break}P=this.m_topoGraph.getHalfEdgeTwin(x)}else x=e,P=s;if(1===this.m_topoGraph.getHalfEdgeUserIndex(x,i)){I=!0;break}const r=this.getCombinedHalfEdgeParentage(x);if(!this.isGoodParentage(r))break;D=x,v+=this.prevailingDirection(f,x)}const t=this.m_topoGraph.getHalfEdgeOrigin(C);S=this.m_topoGraph.getHalfEdgeTo(D)===t}else if(this.m_fromEdgeForPolylines!==n.nullHandle){C=e,D=this.tryMoveThroughCrossroadBackwards(C,!1),s.geometryReleaseAssert(D!==n.nullHandle);const t=this.m_topoGraph.getHalfEdgeTwin(C);this.m_topoGraph.getHalfEdgeNext(t)}let w=S;S||I||u&&(w=this.isOnALoop(e,i),w||(w=this.isOnALoop(P,i)));const T=v>=0;let A=!1;w&&b&&(S?(A=g,T&&(A||p||_)&&C!==e&&(s.geometryReleaseAssert(!p),C=e,A=!1)):(p||T&&_)&&(C=e));let N=0;for(x=C;P=this.m_topoGraph.getHalfEdgeTwin(x),this.m_topoGraph.setHalfEdgeUserIndex(x,i,1),this.m_topoGraph.setHalfEdgeUserIndex(P,i,1),N++,x!==D;)x=d?this.m_topoGraph.getHalfEdgeNext(x):this.tryMoveThroughCrossroadForward(x,!1);T||(D=r.swap(C,C=D),D=this.m_topoGraph.getHalfEdgeTwin(D),C=this.m_topoGraph.getHalfEdgeTwin(C));let G=f.insertPath(t,n.nullHandle);x=C;const M=this.m_topoGraph.getHalfEdgeOrigin(C);let R;R=-1!==m?this.chooseVertexByOrder(M,f,m,h):this.chooseVertexFromCluster_(M,a),this.m_topoGraph.isStrongPathNode(M)&&f.setStrongPathStart(G,!0);let k=f.addVertex(G,R),F=k;-1!==o&&this.m_topoGraph.setClusterUserIndex(M,o,1);let q=0;const V=A?Math.trunc((N+1)/2):-1;let H=n.nullHandle,O=!0,Y=n.nullHandle;for(;;){if(y){const e=this.m_topoGraph.getSegmentParentage(x),t=this.m_topoGraph.getHalfEdgeOrigin(x);f.setSegmentParentageAndBreak(F,e,O||this.m_topoGraph.isBreakNode(t))}O=!1,this.m_topoGraph.isHalfEdgeCurve(x)&&(this.m_topoGraph.querySegmentXY(x,E),f.setSegmentToIndex(f.getVertexIndex(F),E.get().clone())),H!==n.nullHandle&&-1!==h&&f.addToUserIndex(H,h,-1);const e=d?this.m_topoGraph.getHalfEdgeNext(x):this.tryMoveThroughCrossroadForward(x,!1),s=this.m_topoGraph.getHalfEdgeTo(x);let i;if(i=-1!==m?this.chooseVertexByOrder(s,f,m,h):this.chooseVertexFromCluster_(s,a),k=f.addVertex(G,i),Y=s,-1!==o&&this.m_topoGraph.setClusterUserIndex(s,o,1),y&&this.m_topoGraph.isBreakNode(s)&&f.setSegmentParentageBreakVertex(k,!0),H=i,q++,A&&q===V&&(G=f.insertPath(t,n.nullHandle),k=f.addVertex(G,i),O=!0,-1!==h&&f.addToUserIndex(i,h,-1),H=n.nullHandle),x===D)break;x=e,F=k}Y!==n.nullHandle&&this.m_topoGraph.isStrongPathNode(Y)&&f.setStrongPathEnd(G,!0)}topoOperationPolylineSimplify_(e,t){return this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,n.nullHandle,!1,t).first}topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,t,i,o){s.geometryReleaseAssert(t===n.nullHandle||e===n.nullHandle);const a=this.m_topoGraph.getShape(),m=t=>e===n.nullHandle?t===n.nullHandle?a.getFirstGeometry():a.getNextGeometry(t):t===n.nullHandle?e:n.nullHandle,h=a.createGeometry(s.GeometryType.enumPolyline);let l=-1;i&&(l=this.m_topoGraph.createUserIndexForClusters());const u=this.m_topoGraph.createUserIndexForHalfEdges(),c=t===n.nullHandle?a.createUserIndex():-1,g=t===n.nullHandle?a.createUserIndex():-1;let d=-1;if(1===o.unsplitBehavior){d=this.m_topoGraph.createUserIndexForClusters();for(let e=m(n.nullHandle);e!==n.nullHandle;e=m(e))for(let t=a.getFirstPath(e);t!==n.nullHandle;t=a.getNextPath(t)){{const e=a.getFirstVertex(t),s=this.m_topoGraph.getClusterFromVertex(e);this.m_topoGraph.setClusterUserIndex(s,d,1)}if(!a.isClosedPath(t)){const e=a.getLastVertex(t),s=this.m_topoGraph.getClusterFromVertex(e);this.m_topoGraph.setClusterUserIndex(s,d,1)}}}if(t===n.nullHandle){let e=0;for(let t=m(n.nullHandle);t!==n.nullHandle;t=m(t))for(let s=a.getFirstPath(t);s!==n.nullHandle;s=a.getNextPath(s))if(a.isClosedPath(s)){let t=a.getFirstVertex(s);for(let n=0,i=a.getPathSize(s);n<i;n++,t=a.getNextVertex(t))a.setUserIndex(t,c,e++),a.setUserIndex(t,g,2)}else{const t=a.getFirstVertex(s);a.setUserIndex(t,c,e++),a.setUserIndex(t,g,1);let n=a.getNextVertex(t);for(let t=1,i=a.getPathSize(s)-1;t<i;++t)a.setUserIndex(n,c,e++),a.setUserIndex(n,g,2),n=a.getNextVertex(n);a.setUserIndex(n,c,e++),a.setUserIndex(n,g,1)}}for(let e=m(n.nullHandle);e!==n.nullHandle;e=m(e))for(let s=a.getFirstPath(e);s!==n.nullHandle;s=a.getNextPath(s)){let e=a.getFirstVertex(s);for(let i=0,r=a.getPathSize(s);i<r;i++,e=a.getNextVertex(e)){const s=this.m_topoGraph.getHalfEdgeFromVertex(e);if(s===n.nullHandle)continue;if(1===this.m_topoGraph.getHalfEdgeUserIndex(s,u))continue;const r=this.getCombinedHalfEdgeParentage(s);if(this.isGoodParentage(r)){const e=0===i;this.restorePolylineParts(s,h,u,l,t,c,g,d,e,o)}}}let p=n.nullHandle;if(i){p=a.createGeometry(s.GeometryType.enumMultiPoint);let e=n.nullHandle;for(let s=this.m_topoGraph.getFirstCluster();s!==n.nullHandle;s=this.m_topoGraph.getNextCluster(s))if(this.progress_(),1!==this.m_topoGraph.getClusterUserIndex(s,l)){const i=this.m_topoGraph.getClusterParentage(s);if(this.isGoodParentage(i)){e===n.nullHandle&&(e=a.insertPath(p,n.nullHandle));const i=this.m_topoGraph.getClusterVertexIterator(s);if(i!==n.nullHandle){let n;this.m_topoGraph.getVertexFromVertexIterator(i),n=-1!==c?this.chooseVertexByOrder(s,a,c,g):this.chooseVertexFromCluster_(s,t),a.addVertex(e,n)}}}}return-1!==g&&a.removeUserIndex(g),-1!==c&&a.removeUserIndex(c),-1!==l&&a.removeUserIndex(l),this.m_topoGraph.deleteUserIndexForHalfEdges(u),r.makePair(h,p)}difference(e,t){const i=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),o=s.getDimensionFromType(i),a=s.getDimensionFromType(r);if(o>a)return e;const m=this.m_topoGraph.getGeometryID(e),h=this.m_topoGraph.getGeometryID(t);if(this.m_maskLookup.length=0,this.m_maskLookup.length=1+(m|h),this.m_maskLookup[m]=!0,2===o&&2===a){let s=n.nullHandle;return this.m_topoGraph.getShape().getVertexDescription().getAttributeCount()>1&&(s=e),this.topoOperationPolygonPolygon_(e,t,s)}if(1===o&&2===a){const t={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};return t.ogcRule=this.m_bOGCOutput,t.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,n.nullHandle,!1,t).first}if(1===o&&1===a){const t={unsplitBehavior:0,allCrossRoadsImpassable:!0,ogcRule:!1};return t.ogcRule=this.m_bOGCOutput,t.unsplitBehavior=0,this.topoOperationPolylineSimplifyOrPolylineTopoHelper_(e,n.nullHandle,!1,t).first}if(0===o)return this.topoOperationMultiPoint_();s.throwInternalErrorException("")}symmetricDifference(e,t){const i=this.m_topoGraph.getShape().getGeometryType(e),r=this.m_topoGraph.getShape().getGeometryType(t),o=Ps(i),a=Ps(r),m=this.m_topoGraph.getGeometryID(e),h=this.m_topoGraph.getGeometryID(t);return s.geometryReleaseAssert(m>=0),s.geometryReleaseAssert(h>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=1+(m|h),this.m_maskLookup[m]=!0,this.m_maskLookup[m]=!0,this.m_maskLookup[h]=!0,2===o&&2===a?this.topoOperationPolygonPolygon_(e,t,n.nullHandle):1===o&&1===a?this.topoOperationPolyline_(n.nullHandle,this.m_bOGCOutput):0===o&&0===a?this.topoOperationMultiPoint():void s.throwInternalErrorException("")}planarSimplifyNoCrackingAndCluster(e,t,i,r){this.m_bOGCOutput=e,this.m_topoGraph=new U;const o=t.getFillRule(i),a=t.getGeometryType(i);if(1!==o||a===s.GeometryType.enumMultiPoint?this.m_topoGraph.setAndSimplifyEditShapeAlternate(t,i,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeWinding(t,i,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return!1;this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const m=this.m_topoGraph.getGeometryID(i);if(s.geometryReleaseAssert(m>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=m+1,this.m_maskLookup[m]=!0,t.getGeometryType(i)===s.GeometryType.enumPolygon||1===o&&t.getGeometryType(i)!==s.GeometryType.enumMultiPoint){t.setFillRule(i,0);const s=this.topoOperationPolygonPolygon_(i,n.nullHandle,n.nullHandle);if(t.swapGeometry(s,i),t.removeGeometry(s),1===o&&this.m_bOGCOutput)return this.planarSimplifyNoCrackingAndCluster(e,t,i,r)}else if(t.getGeometryType(i)===s.GeometryType.enumPolyline){const e={unsplitBehavior:0,allCrossRoadsImpassable:!1,ogcRule:!1};e.ogcRule=this.m_bOGCOutput,e.allCrossRoadsImpassable=!0,e.unsplitBehavior=r;const s=this.topoOperationPolylineSimplify_(t.getFirstGeometry(),e);t.swapGeometry(s,i),t.removeGeometry(s)}else if(t.getGeometryType(i)===s.GeometryType.enumMultiPoint){const e=this.topoOperationMultiPoint_();t.swapGeometry(e,i),t.removeGeometry(e)}else s.throwInternalErrorException("");return!0}unsplitPolylineExact(e){return s.geometryReleaseAssert(0),new n.Polyline}planarSimplifyPolylines(e,t,i,r,o){for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t)){const n=e.getGeometryType(t);s.geometryReleaseAssert(n===s.GeometryType.enumPolyline)}let a=0,m=0,h=null;if(e.hasCurves()&&!e.hasSegmentParentage()){h=new ms;const s=e.getEnvelope2D(this.m_progressTracker);m=os(t.total());const n=rs(t.total(),s);a=as(n,m),ss(e,n,t.total(),0,h,null,this.m_progressTracker)}{const s=gs(t.add(a));e.filterClosePoints(s,!1,!1,!1,n.nullHandle)}if(this.m_topoGraph=new U,4!==o&&5!==o)if(null===h&&i){const s=new _e(this.m_progressTracker,!1);s.sweepVertical(e,t.total()),s.hadComplications()?(ls(e,t,this.m_progressTracker,!0,!1),i=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(t.total())}else ls(e,t.add(a),this.m_progressTracker,!0,!1),i=!1;else i=!1;e.removeSelection(),e.collapseAllGeometriesToFirst();const l=e.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,l,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return s.geometryReleaseAssert(i&&null===h),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolylines(e,t,!1,r,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const u=this.m_topoGraph.getGeometryID(l);s.geometryReleaseAssert(u>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=u+1,this.m_maskLookup[u]=!0;const c=this.topoOperationPolylineSimplify_(e.getFirstGeometry(),r);null!==h&&h.stitchCurves(e,c,m,!0);const g=e.getGeometry(c);return i||g.getImpl().setIsSimple(4,t.total()),g}planarSimplifyMultiPoints(e,t,i,r){for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t)){const n=e.getGeometryType(t);s.geometryReleaseAssert(n===s.GeometryType.enumMultiPoint)}this.m_topoGraph=new U,4!==r&&5!==r?(ls(e,t,this.m_progressTracker,!0,!1),i=!1):i=!1,e.removeSelection(),e.collapseAllGeometriesToFirst();const o=e.getFirstGeometry();if(this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,o,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return s.geometryReleaseAssert(i),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyMultiPoints(e,t,!1,-1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const a=this.m_topoGraph.getGeometryID(o);s.geometryReleaseAssert(a>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=a+1,this.m_maskLookup[a]=!0;const m=this.topoOperationMultiPoint(),h=e.getGeometry(m);return i||h.getImpl().setIsSimple(4,t.total()),h}planarSimplifyPolygons(e,t,i,r,o,a){for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t)){const n=e.getGeometryType(t);s.geometryReleaseAssert(n===s.GeometryType.enumPolygon||n===s.GeometryType.enumPolyline&&i)}let m=0,h=0,l=null;if(e.hasCurves()&&!e.hasSegmentParentage()){l=new ms;const s=e.getEnvelope2D(this.m_progressTracker);h=os(t.total());const n=rs(t.total(),s);m=as(n,h),ss(e,n,t.total(),0,l,null,this.m_progressTracker)}if(a){ls(e,t.add(m),this.m_progressTracker,!0,!1);for(let t=e.getFirstGeometry();t!==n.nullHandle;t=e.getNextGeometry(t))e.getGeometryType(t)===s.GeometryType.enumPolygon&&Ae(e,t,-1,!1,n.nullHandle,this.m_progressTracker)}if(this.m_topoGraph=new U,a||4===o||5===o)r=!1;else if(null===l&&r){const s=new _e(this.m_progressTracker,!1);s.sweepVertical(e,t.total()),s.hadComplications()?(ls(e,t,this.m_progressTracker,!0,!1),r=!1):this.m_topoGraph.setCheckDirtyPlanesweepTolerance(t.total())}else ls(e,t.add(m),this.m_progressTracker,!0,!1),r=!1;e.removeSelection(),e.collapseAllGeometriesToFirst();const u=e.getFirstGeometry();if(i?this.m_topoGraph.setAndSimplifyEditShapeWinding(e,u,this.m_progressTracker):this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,u,this.m_progressTracker),this.m_topoGraph.dirtyCheckFailed())return s.geometryReleaseAssert(r&&null===l),this.m_topoGraph.removeShape(),this.m_topoGraph=null,this.planarSimplifyPolygons(e,t,i,!1,-1,!1);this.m_topoGraph.setCheckDirtyPlanesweepTolerance(Number.NaN);const c=this.m_topoGraph.getGeometryID(u);s.geometryReleaseAssert(c>=0),this.m_maskLookup.length=0,this.m_maskLookup.length=c+1,this.m_maskLookup[c]=!0,e.setFillRule(u,0);const g=this.m_bOGCOutput&&i,d=g;let p=this.topoOperationPolygonPolygon_(u,n.nullHandle,n.nullHandle,d);g&&(this.m_topoGraph.removeShape(),this.m_topoGraph=null,e.removeGeometry(u),this.m_topoGraph=new U,this.m_topoGraph.setAndSimplifyEditShapeAlternate(e,p,this.m_progressTracker),p=this.topoOperationPolygonPolygon_(p,n.nullHandle,n.nullHandle,!1)),null!==l&&l.stitchCurves(e,p,h,!0);const _=e.getGeometry(p);return _.setFillRule(0),r?_.getImpl().setIsSimple(3,0):(_.getImpl().setIsSimple(4,t.total()),_.getImpl().updateOGCFlagsProtected()),_}planarSimplify3DImpl_(e,t,n,i,r){return s.geometryReleaseAssert(0),{}}planarSimplifyImpl_(e,t,r,o,a,m,h,l){if(e.isEmpty())return e.clone();const u=e.getGeometryType(),c=new n.EditShape,g=c.addGeometry(e);if(i.isAtLeastWeakSimple(a)&&u===s.GeometryType.enumPolygon&&(r=!1,c.setFillRule(g,0)),l&&(e.hasAttribute(1)&&c.replaceNaNs(1,0),c.removeNaNVertices()),u===s.GeometryType.enumPolygon||u===s.GeometryType.enumPolyline&&r)return this.planarSimplifyPolygons(c,t,r,o,a,!1);if(u===n.Polyline.type){const e={unsplitBehavior:0,allCrossRoadsImpassable:!0,ogcRule:!1};return e.ogcRule=this.m_bOGCOutput,e.unsplitBehavior=h,this.planarSimplifyPolylines(c,t,o,e,a)}if(u===s.GeometryType.enumMultiPoint)return this.planarSimplifyMultiPoints(c,t,o,a);s.throwInternalErrorException("what else?")}}function ws(e,t,r,o){const a=e.getGeometryType();if(a===s.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(a===s.GeometryType.enumPoint&&("|"===o||"^"===o)){const t=new n.MultiPoint({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(a===s.GeometryType.enumLine){const t=new n.Polyline({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}if(a===s.GeometryType.enumMultiPoint&&"-"===o&&t.getGeometryType()===s.GeometryType.enumPoint){const t=new i.Point({vd:e.getDescription()});return e.isEmpty()||e.getPointByVal(0,t),t}if(a===s.GeometryType.enumMultiPoint&&"&"===o&&t.getGeometryType()===s.GeometryType.enumPoint){const t=new i.Point({vd:e.getDescription()});return e.isEmpty()||e.getPointByVal(0,t),t}return e}function Ts(e){const t=e.getGeometryType();if(t===s.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});return e.isEmpty()||t.addEnvelope(e,!1),t}if(t===s.GeometryType.enumPoint){const t=new n.MultiPoint({vd:e.getDescription()});return e.isEmpty()||t.add(e),t}if(xs(t)){const t=new n.Polyline({vd:e.getDescription()});return e.isEmpty()||t.addSegment(e,!0),t}return t!==s.GeometryType.enumMultiPoint&&t!==s.GeometryType.enumPolyline&&t!==s.GeometryType.enumPolygon&&s.throwInvalidArgumentException("Unexpected geometry type"),e}function As(e,t,i,r){const o=i===n.nullHandle?e.getClusterHalfEdge(t):i;let a=o;s.geometryReleaseAssert(e.getHalfEdgeOrigin(o)===t);do{r(a),a=e.getHalfEdgeNext(e.getHalfEdgeTwin(a))}while(a!==o)}class Ns{constructor(e,t,s,i,r,o){this.m_rParent=e,this.m_rTopoGraph=e.m_topoGraph,this.m_rShape=this.m_rTopoGraph.getShape(),this.m_IDCuttee=this.m_rTopoGraph.getGeometryID(i),this.m_IDCutter=this.m_rTopoGraph.getGeometryID(r),this.m_IDBoth=this.m_IDCuttee|this.m_IDCutter,this.m_bConsiderTouch=t,this.m_sideIndex=s,this.m_cuttee=i,this.m_cutter=r,this.m_rCutHandles=o,this.m_cutteeBreadcrumbsIndex=this.m_rShape.createUserIndexUninitialized(),this.m_clusterParentageIndex=this.m_rShape.createUserIndexUninitialized();for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==n.nullHandle;e=this.m_rShape.getNextPath(e)){let t=0;const s=this.m_rShape.getPathSize(e);for(let n=this.m_rShape.getFirstVertex(e);t<s;t++,n=this.m_rShape.getNextVertex(n))this.m_rShape.setUserIndex(n,this.m_clusterParentageIndex,this.m_rTopoGraph.getClusterParentage(this.m_rTopoGraph.getClusterFromVertex(n)))}}Do(){this.cutPolylinePolyline_(),this.m_rShape.removeUserIndex(this.m_cutteeBreadcrumbsIndex),this.m_rShape.removeUserIndex(this.m_clusterParentageIndex)}setTbd(e){return 8|e}classifyStandardCut(e,t,s,i){const r=this.m_rShape.getPrevVertex(e),o=this.m_rShape.getNextVertex(e),a=r===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(r)),m=o===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(o)),h=this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(s)),l=this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(i));let u=1,c=32,g=32;if(As(this.m_rTopoGraph,t,l,e=>{e===h&&(u=2),e===a&&(c=u),e===m&&(g=u)}),this.m_bConsiderTouch)32!==c&&this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex)|c),32!==g&&this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|g);else{if(32===c||32===g)return 1;if(c===g&&a!==h&&a!==l&&m!==h&&m!==l)return 1;this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex)|c),this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|g)}return 0}classifyTouchCut(e,t,s,i){const r=this.m_rShape.getPrevVertex(e),o=this.m_rShape.getNextVertex(e),a=r===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(r)),m=o===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(o)),h=s===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(s)),l=i===n.nullHandle?n.nullHandle:this.m_rTopoGraph.getHalfEdgeConnector(t,this.m_rTopoGraph.getClusterFromVertex(i));if(!this.m_bConsiderTouch){let t;return(t=h===a||l===a)?this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))):(t=h===m||l===m)&&this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),t?0:1}if(a===n.nullHandle)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(m===n.nullHandle)return this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),0;if(a===m)return this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(l!==n.nullHandle){if(a===l)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(m===l)return this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),0;let s=1;As(this.m_rTopoGraph,t,l,t=>{if(t===a){const e=this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,e),s=2}else if(t===m){const t=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,t),s=2}})}else{if(a===h)return this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex))),0;if(m===h)return this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,this.setTbd(this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex))),0;let s=2;As(this.m_rTopoGraph,t,h,t=>{if(t===a){const e=this.m_rShape.getUserIndex(r,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(r,this.m_cutteeBreadcrumbsIndex,e),s=1}else if(t===m){const t=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex)|s;this.m_rShape.setUserIndex(e,this.m_cutteeBreadcrumbsIndex,t),s=1}})}return 0}classifyCutVertex(e,t){let s=0,i=0;for(let r=this.m_rTopoGraph.getClusterVertexIterator(t);r!==n.nullHandle;r=this.m_rTopoGraph.incrementVertexIterator(r)){const o=this.m_rTopoGraph.getVertexFromVertexIterator(r);if(this.m_rShape.getGeometryFromVertex(o)===this.m_cutter){i++;const r=this.m_rShape.getPrevVertex(o),a=this.m_rShape.getNextVertex(o);r===n.nullHandle||a===n.nullHandle?s+=this.classifyTouchCut(e,t,r,a):s+=this.classifyStandardCut(e,t,r,a)}}i&&s===i&&!this.m_bConsiderTouch&&this.m_rShape.setUserIndex(e,this.m_clusterParentageIndex,this.m_IDCuttee)}cutPolylinePolyline_(){this.m_rShape.getGeometryType(this.m_cuttee),this.m_rShape.getGeometryType(this.m_cutter),this.m_rParent.m_maskLookup.length=0,this.m_rParent.m_maskLookup.length=this.m_IDBoth+1,this.m_rParent.m_maskLookup[this.m_IDBoth]=!0;for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==n.nullHandle;e=this.m_rShape.getNextPath(e)){const t=this.m_rShape.getPathSize(e);let s=this.m_rShape.getFirstVertex(e);for(let e=0;e<t;++e,s=this.m_rShape.getNextVertex(s))this.m_rShape.setUserIndex(s,this.m_cutteeBreadcrumbsIndex,0);s=this.m_rShape.getFirstVertex(e);for(let e=0;e<t;++e,s=this.m_rShape.getNextVertex(s)){const e=this.m_rTopoGraph.getClusterFromVertex(s);this.m_rTopoGraph.getClusterParentage(e)===this.m_IDBoth&&this.classifyCutVertex(s,e)}}const e=(e,t)=>{let s=this.m_rShape.getUserIndex(e,this.m_cutteeBreadcrumbsIndex);const n=this.m_rTopoGraph.getHalfEdgeConnector(this.m_rTopoGraph.getClusterFromVertex(e),this.m_rTopoGraph.getClusterFromVertex(t));return(this.m_rTopoGraph.getHalfEdgeParentage(n)&this.m_IDBoth)===this.m_IDBoth&&(s|=4),s};for(let t=this.m_rShape.getFirstPath(this.m_cuttee);t!==n.nullHandle;t=this.m_rShape.getNextPath(t)){let s=this.m_rShape.getFirstVertex(t);const n=this.m_rShape.isClosedPath(t),i=this.m_rShape.getPathSize(t)+(n?1:0);let r=1,o=32;for(let t=this.m_rShape.getNextVertex(s);r<i;++r,s=t,t=this.m_rShape.getNextVertex(t)){const n=e(s,t);this.m_rShape.getUserIndex(s,this.m_clusterParentageIndex)===this.m_IDBoth&&(o=n),32!==o&&this.m_rShape.setUserIndex(s,this.m_cutteeBreadcrumbsIndex,o|n)}s=this.m_rShape.getLastVertex(t);let a=32;r=1;for(let t=this.m_rShape.getPrevVertex(s);r<i;++r,s=t,t=this.m_rShape.getPrevVertex(t)){const n=e(t,s);this.m_rShape.getUserIndex(s,this.m_clusterParentageIndex)===this.m_IDBoth&&(a=n),32!==a&&this.m_rShape.setUserIndex(t,this.m_cutteeBreadcrumbsIndex,a|n)}}let t=n.nullHandle,i=n.nullHandle,r=32;const o=this.m_rShape.hasSegmentParentage(),a=new n.SegmentBuffer;for(let e=this.m_rShape.getFirstPath(this.m_cuttee);e!==n.nullHandle;e=this.m_rShape.getNextPath(e)){const m=this.m_rShape.isClosedPath(e),h=this.m_rShape.getPathSize(e)+(m?1:0);let l=1,u=this.m_rShape.getFirstVertex(e),c=n.nullHandle,g=!0;for(let e=this.m_rShape.getNextVertex(u);l<h;++l,e=this.m_rShape.getNextVertex(e)){let m=this.m_rShape.getUserIndex(u,this.m_cutteeBreadcrumbsIndex);8===m?m=3:(m&=-9,4&m?m=4:3&~m||(m=3)),m!==r?(t!==n.nullHandle&&(c=this.m_rShape.addVertex(i,u),o&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(u))&&this.m_rShape.setSegmentParentageBreakVertex(c,!0),this.m_rCutHandles.push(t),this.m_rShape.setGeometryUserIndex(t,this.m_sideIndex,r)),t=this.m_rShape.createGeometry(s.GeometryType.enumPolyline),i=this.m_rShape.insertPath(t,n.nullHandle),r=m,g=!0):this.m_rShape.getUserIndex(u,this.m_clusterParentageIndex)===this.m_IDBoth&&4!==m&&(c=this.m_rShape.addVertex(i,u),o&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(u))&&this.m_rShape.setSegmentParentageBreakVertex(c,!0),i=this.m_rShape.insertPath(t,n.nullHandle),g=!0),c=this.m_rShape.addVertex(i,u);const h=this.m_rTopoGraph.getClusterFromVertex(u);!g&&o&&this.m_rTopoGraph.isBreakNode(h)&&this.m_rShape.setSegmentParentageBreakVertex(c,!0);const l=this.m_rTopoGraph.getHalfEdgeFromVertex(u);if(o){const e=this.m_rTopoGraph.getSegmentParentage(l);this.m_rShape.setSegmentParentageAndBreak(c,e,g||this.m_rTopoGraph.isBreakNode(h))}this.m_rTopoGraph.isHalfEdgeCurve(l)&&(this.m_rTopoGraph.querySegmentXY(l,a),this.m_rShape.setSegmentToIndex(this.m_rShape.getVertexIndex(c),a.get().clone())),u=e,g=!1}c=this.m_rShape.addVertex(i,u),o&&this.m_rTopoGraph.isBreakNode(this.m_rTopoGraph.getClusterFromVertex(u))&&this.m_rShape.setSegmentParentageBreakVertex(c,!0),this.m_rCutHandles.push(t),this.m_rShape.setGeometryUserIndex(t,this.m_sideIndex,r),t=n.nullHandle,i=n.nullHandle,r=32}}}function Gs(e,r,o,a,m){if(a&&(a.m_reason=0,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),e.isEmpty())return 5;const h=e.getGeometryType();if(h===s.GeometryType.enumPoint)return Rs(e,a);const l=i.calculateToleranceFromGeometryForOpFromGeom(r,e,!1).total();if(h===s.GeometryType.enumEnvelope){const s=e,n=t.Envelope2D.constructEmpty();return s.queryEnvelope(n),n.isDegenerate(l)?(a&&(a.m_reason=4,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),0):5}if(s.isSegment(h)){const t=e,s=new n.Polyline({vd:t.getDescription()});return s.addSegment(t,!0),Gs(s,r,o,a,m)}const u=e.getImpl().getIsSimple(l,[0]);let c=o?-1:u;if(-1!==c)return c;const g=new Ls(e,r,c,m,!1);return h===s.GeometryType.enumMultiPoint?c=g.multipointIsSimpleAsFeature():h===s.GeometryType.enumPolyline?c=g.polylineIsSimpleAsFeature():h===s.GeometryType.enumPolygon?c=g.polygonIsSimpleAsFeature():s.throwInternalErrorException(""),e.getImpl().setIsSimple(c,l),a&&a.assign(g.m_nonSimpleResult),c}function Ms(e,r,o,a){if(e.isEmpty())return e;const m=e.getGeometryType();if(m===s.GeometryType.enumPoint){const t=new u.NonSimpleResult;if(Rs(e,t),3===t.m_reason){const t=e.clone();return t.replaceNaNs(1,0),t}return 2===t.m_reason?e.createInstance():e}if(m===s.GeometryType.enumEnvelope){const s=i.calculateToleranceFromGeometryForOpFromGeom(r,e,!0).total(),n=e,o=t.Envelope2D.constructEmpty();return n.queryEnvelope(o),o.isDegenerate(s)?n.createInstance():e}if(s.isSegment(m)){const t=e,s=new n.Polyline({vd:t.getDescription()});return s.addSegment(t,!0),Ms(s,r,o,a)}s.throwIfGeometryCollectionType(m);const h=i.calculateToleranceFromGeometryForOpFromGeom(r,e,!1).total(),l=e.getImpl().getIsSimple(h,[0]),c=o?-1:l;if(i.isAtLeastPlanarSimple(c)){if(m===s.GeometryType.enumPolygon&&0!==e.getFillRule()){const t=e.clone();return t.setFillRule(0),t}return e}if((m===s.GeometryType.enumMultiPoint||m===s.GeometryType.enumPolyline)&&c>=1)return e;const g=new Ls(e,r,c,a,!1);let d;return m===s.GeometryType.enumMultiPoint?d=g.multipointSimplifyAsFeature():m===s.GeometryType.enumPolyline?d=g.polylineSimplifyAsFeature():m===s.GeometryType.enumPolygon?d=g.polygonSimplifyAsFeature():s.throwInternalErrorException(""),d}function Rs(e,t){const s=e.getX(),n=e.getY();if(!Number.isFinite(s)||!Number.isFinite(n))return t&&(t.m_reason=2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0;if(e.hasAttribute(1)){const s=e.getZ();if(!Number.isFinite(s))return t&&(t.m_reason=Number.isNaN(s)?3:2,t.m_vertexIndex1=-1,t.m_vertexIndex2=-1),0}return 5}class ks{constructor(){this.m_segment=null,this.m_vertexIndex=-1,this.m_pathIndex=-1,this.m_flags=0}setReversed(e){this.m_flags&=-2,this.m_flags=this.m_flags|(e?1:0)}getReversed(){return!!(1&this.m_flags)}getRightSide(){return this.getReversed()?0:1}}function Fs(e,t,s,n,i){return{x:e,y:t,ipath:s,ivertex:n,ipolygon:i}}function qs(e,t){return e.x===t.x&&e.y===t.y&&e.ipath===t.ipath&&e.ivertex===t.ivertex&&e.ipolygon===t.ipolygon}function Vs(e,t){e.x=t.x,e.y=t.y,e.ipath=t.ipath,e.ivertex=t.ivertex,e.ipolygon=t.ipolygon}function Hs(e,t,s,n,i,r){return{x:e,y:t,ipath:s,ivertex:n,bBoundary:i,bEndPoint:r}}function Os(e,t){e.x=t.x,e.y=t.y,e.ipath=t.ipath,e.ivertex=t.ivertex,e.bBoundary=t.bBoundary,e.bEndPoint=t.bEndPoint}class Ys extends i.Comparator{constructor(e){super(),this.m_helper=e}compare(e,t,s){const n=e.getElement(s),i=this.m_helper.m_xy.read(2*t)-this.m_helper.m_xy.read(2*n);return i<0?-1:i>0?1:0}}class Xs extends i.Comparator{constructor(e){super(),this.m_helper=e}compare(e,t,s){const n=e.getElement(s),i=this.m_helper.m_edges[t],r=this.m_helper.m_edges[n],o=i.getReversed(),a=r.getReversed();let m=i.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0),h=r.m_segment.intersectionOfYMonotonicWithAxisX(this.m_helper.m_yScanline,0);if(m===h){const e=o?i.m_segment.getStartY():i.m_segment.getEndY(),t=a?r.m_segment.getStartY():r.m_segment.getEndY(),s=Math.min(e,t);let n=.5*(s-this.m_helper.m_yScanline)+this.m_helper.m_yScanline;n===this.m_helper.m_yScanline&&(n=s),m=i.m_segment.intersectionOfYMonotonicWithAxisX(n,0),h=r.m_segment.intersectionOfYMonotonicWithAxisX(n,0)}return m<h?-1:m>h?1:0}}class Ls{constructor(e,t,s,n,r){this.m_multiVertexGeom=null,this.m_edges=[],this.m_freeEdges=[],this.m_lineEdgesRecycle=[],this.m_newEdges=[],this.m_recycledSegIter=null,this.m_crossOverHelperList=new i.IndexMultiDCList,this.m_progressTracker=null,this.m_progressCounter=0,this.m_AET=new i.Treap,this.m_xyToNode1=null,this.m_xyToNode2=null,this.m_pathOrientations=null,this.m_pathParentage=null,this.m_xy=null,this.m_pairs=[],this.m_pairIndices=null,this.m_pathsForOGCTests=[],this.m_curveStitcher=null,this.m_editShape=null,this.m_multiPathStitcher=null,this.m_nonSimpleResult=new u.NonSimpleResult,this.m_progressCounter=0,this.m_progressTracker=n,this.m_geometry=e,this.m_knownSimpleResult=s,this.m_sr=t;const o=i.calculateToleranceFromGeometryForOpFromGeom(t,e,!1);this.m_toleranceIsSimple=o,this.m_toleranceIsSimpleClustering=i.adjustToleranceForTEClustering(o),this.m_toleranceIsSimpleCracking=i.adjustToleranceForTECracking(o),this.m_toleranceSimplify=i.calculateToleranceFromGeometryForOpFromGeom(t,e,!0),this.m_description=this.m_geometry.getDescription(),this.m_attributeCount=this.m_description.getAttributeCount(),this.m_bOGCRestrictions=r,this.m_bPlanarSimplify=this.m_bOGCRestrictions,this.m_unknownOrientationPathCount=-1,this.m_yScanline=0,this.m_progressCounter=0}isSimplePlanarImpl(){if(this.m_bPlanarSimplify=!0,!this.checkStructure())return 0;const e=this.m_geometry.getGeometryType();return s.isMultiPath(e)&&!this.checkDegenerateSegments(!1)?0:this._CheckClustering()?s.isMultiPath(e)?this._CheckCracking()?this.m_geometry.getGeometryType()===s.GeometryType.enumPolyline?this.checkSelfIntersectionsPolylinePlanar()?4:0:this._CheckSelfIntersections()?this._CheckValidRingOrientation():0:0:5:0}isSimplePlanarImpl3D(){return s.geometryReleaseAssert(0),7}generateSortedPairs(e){let t=null;s.isMultiPath(e.getGeometryType())&&(t=e);const n=(this.m_bPlanarSimplify||this.m_bOGCRestrictions)&&null!==t,o=e.getPointCount();this.m_xy=e.getAttributeStreamRef(0),this.m_pairs.length=0,this.m_pairIndices=new i.AttributeStreamOfInt32(0),n&&(this.m_pathsForOGCTests.length=0);let a=0;for(let e=0;e<o;e++)if(this.m_pairs.push(2*e),this.m_pairs.push(2*e+1),this.m_pairIndices.add(2*e),this.m_pairIndices.add(2*e+1),n){for(;e>=t.getPathEnd(a);)a++;this.m_pathsForOGCTests.push(a)}const m=new i.BucketSort,h={parent:this,workPt:new r.Point2D,userSort(e,t,s){s.sort(e,t,(e,t)=>this.parent.compareVerticesForPlanarClustering(e,t,n))},getValue(e){const t=this.parent.m_pairs[e],s=t>>1;return this.parent.m_xy.queryPoint2D(2*s,this.workPt),this.workPt.y+(1&t?this.parent.m_toleranceIsSimpleClustering:-this.parent.m_toleranceIsSimpleClustering)}};m.sort(this.m_pairIndices,0,2*o,h)}_TestToleranceDistancePlanar(e,t){const s=this.m_xy.read(2*e),n=this.m_xy.read(2*e+1),i=this.m_xy.read(2*t),r=this.m_xy.read(2*t+1);return!J(s,n,i,r,this.m_toleranceIsSimpleClustering*this.m_toleranceIsSimpleClustering)||0!==this.m_geometry.getDimension()&&s===i&&n===r}checkStructure(){const e=this.m_geometry.getGeometryType();if(s.isMultiPath(e)){const e=this.m_geometry.getImpl(),t=this.m_geometry.getGeometryType()===s.GeometryType.enumPolygon?3:2;for(let s=0,n=e.getPathCount();s<n;s++)if(e.getPathSize(s)<t){if(e.hasNonLinearSegments()&&e.hasNonLinearSegmentsPath(s)&&e.getPathSize(s)>0)continue;return this.m_nonSimpleResult=new u.NonSimpleResult(1,s,0),!1}}if(s.isMultiVertex(e)){const e=this.m_geometry.getImpl(),t=e.getAttributeStreamRef(0);for(let s=0,n=e.getPointCount();s<n;s++)if(!t.readPoint2D(2*s).isFinite())return this.m_nonSimpleResult=new u.NonSimpleResult(2,s,0),!1;if(this.m_geometry.hasAttribute(1)){const t=e.getAttributeStreamRef(1);for(let s=0,n=e.getPointCount();s<n;s++){const e=t.read(s);if(!Number.isFinite(e))return Number.isNaN(e)?this.m_nonSimpleResult=new u.NonSimpleResult(3,s,0):this.m_nonSimpleResult=new u.NonSimpleResult(2,s,0),!1}}}return!0}checkDegenerateSegments(e){const t=this.m_geometry.getImpl(),s=t.querySegmentIterator(),n=t.hasAttribute(1),r=n?i.calculateZToleranceFromGeometryForOpFromGeom(this.m_sr,t,!1).total():0,o=t.hasNonLinearSegments(),a=this.m_toleranceIsSimple.total();for(;s.nextPath();)for(;s.hasNextSegment();){const t=s.nextSegment();let i=t.calculateLowerLength2D();if(!(i>a||o&&t.isCurve()&&(i=t.calculateLength2D(),i>a))){if(e&&n){const e=t.getStartAttributeAsDbl(1,0),s=t.getEndAttributeAsDbl(1,0);if(Math.abs(s-e)>r)continue}return this.m_nonSimpleResult=new u.NonSimpleResult(4,s.getStartPointIndex(),-1),!1}}return!0}checkDegenerateSegments3D(){return s.geometryReleaseAssert(0),!1}_CheckClustering(){const e=this.m_geometry.getImpl();this.generateSortedPairs(e);const t=e.getPointCount();this.m_AET.clear(),this.m_AET.setComparator(new Ys(this)),this.m_AET.setCapacity(t);for(let e=0,s=2*t;e<s;e++){this.progress_();const t=this.m_pairIndices.read(e),s=this.m_pairs[t],n=s>>1;if(1&s){const e=this.m_AET.search(n),t=this.m_AET.getPrev(e),s=this.m_AET.getNext(e);if(this.m_AET.deleteNode(e),t!==i.Treap.st_nullNode()&&s!==i.Treap.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(t),this.m_AET.getElement(s)))return this.m_nonSimpleResult=new u.NonSimpleResult(5,this.m_AET.getElement(t),this.m_AET.getElement(s)),!1}else{const e=this.m_AET.addElement(n),t=this.m_AET.getPrev(e);if(t!==i.Treap.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(t),n))return this.m_nonSimpleResult=new u.NonSimpleResult(5,n,this.m_AET.getElement(t)),!1;const s=this.m_AET.getNext(e);if(s!==i.Treap.st_nullNode()&&!this._TestToleranceDistancePlanar(this.m_AET.getElement(s),n))return this.m_nonSimpleResult=new u.NonSimpleResult(5,n,this.m_AET.getElement(s)),!1}}return!0}_CheckCracking(){const e=this.m_geometry.getImpl(),t=e.getPointCount();return!e.hasNonLinearSegments()&&t<10?this._CheckCrackingBrute():this._CheckCrackingPlanesweep()}_CheckCrackingPlanesweep(){if(this.m_editShape=new n.EditShape,this.m_editShape.addGeometry(this.m_geometry),this.m_editShape.hasCurves()){this.m_curveStitcher=new ms;const e=t.Envelope2D.constructEmpty();this.m_geometry.queryEnvelope(e);const s=rs(this.m_toleranceSimplify.total(),e),n=new u.NonSimpleResult;if(ns(this.m_editShape,s,this.m_toleranceSimplify.total(),0,n,this.m_curveStitcher,null,this.m_progressTracker),0!==n.m_reason)return this.m_editShape=null,this.m_nonSimpleResult.assign(n),!1}const e=new u.NonSimpleResult;return Pe(!1,this.m_editShape,this.m_toleranceIsSimpleCracking,e,this.m_progressTracker)?(null!=this.m_curveStitcher?(e.m_vertexIndex1=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,e.m_vertexIndex1),e.m_vertexIndex2=this.m_curveStitcher.getOriginalVertexIndex(this.m_editShape,e.m_vertexIndex2),this.m_curveStitcher=null):(e.m_vertexIndex1=this.m_editShape.getVertexIndex(e.m_vertexIndex1),e.m_vertexIndex2=this.m_editShape.getVertexIndex(e.m_vertexIndex2)),this.m_editShape=null,this.m_nonSimpleResult.assign(e),!1):(null==this.m_curveStitcher&&(this.m_editShape=null),!0)}_CheckCrackingBrute(){const e=this.m_geometry.getImpl(),t=e.querySegmentIterator(),s=e.querySegmentIterator();for(;t.nextPath();)for(;t.hasNextSegment();){const e=t.nextSegment();if(!t.isLastSegmentInPath()||!t.isLastPath()){s.resetTo(t);do{for(;s.hasNextSegment();){const i=s.nextSegment(),r=n.isIntersecting(!0,e,i,this.m_toleranceIsSimpleCracking,!0);if(r){const e=2===r?7:6;return this.m_nonSimpleResult=new u.NonSimpleResult(e,t.getStartPointIndex(),s.getStartPointIndex()),!1}}}while(s.nextPath())}}return!0}_CheckSelfIntersections(){let e=this.m_geometry.getImpl();null!==this.m_curveStitcher&&(this.m_multiPathStitcher=this.m_editShape.getGeometry(this.m_editShape.getFirstGeometry()),e=this.m_multiPathStitcher.getImpl(),this.generateSortedPairs(e)),this.m_edges.length=0,this.m_lineEdgesRecycle.length=0,this.m_recycledSegIter=e.querySegmentIterator(),this.m_recycledSegIter.setCirculator(!0);const t=[],s=e.getPointCount();let n=Number.NaN,i=0;for(let e=0,r=2*s;e<r;e++){this.progress_();const s=this.m_pairIndices.read(e),r=this.m_pairs[s];if(1&r)continue;const o=r>>1,a=this.m_xy.read(2*o),m=this.m_xy.read(2*o+1);if(t.length&&(a!==n||m!==i)){if(!this.processBunchForSelfIntersectionTest(t))return!1;t.length=0}t.push(o),n=a,i=m}return!!this.processBunchForSelfIntersectionTest(t)}checkSelfIntersectionsPolylinePlanar(){const e=this.m_geometry.getImpl(),t=[];for(let s=0,n=e.getPathCount();s<n;s++)t.push(e.isClosedPathInXYPlane(s));const s={x:-1,y:-1,ipath:-1,ivertex:-1,bBoundary:!1,bEndPoint:!1};let n,i,r;{const o=this.m_pairIndices.read(0),a=this.m_pairs[o]>>1,m=this.m_xy.readPoint2D(2*a),h=this.m_pathsForOGCTests[a];n=t[h],i=e.getPathStart(h),r=e.getPathEnd(h)-1,s.bEndPoint=a===i||a===r,this.m_bOGCRestrictions?s.bBoundary=!n&&s.bEndPoint:s.bBoundary=s.bEndPoint,s.ipath=h,s.x=m.x,s.y=m.y,s.ivertex=a}for(let o=1,a=this.m_pairIndices.size();o<a;o++){const a=this.m_pairIndices.read(o),m=this.m_pairs[a];if(1&m)continue;const h=m>>1,l=this.m_xy.readPoint2D(2*h),c=this.m_pathsForOGCTests[h];let g;c!==s.ipath&&(n=t[c],i=e.getPathStart(c),r=e.getPathEnd(c)-1);const d=h===i||h===r;g=this.m_bOGCRestrictions?!n&&d:d;const p=Hs(l.x,l.y,c,h,g,d);if(p.x===s.x&&p.y===s.y)if(this.m_bOGCRestrictions){if(!(p.bBoundary&&s.bBoundary||p.ipath===s.ipath&&p.bEndPoint&&s.bEndPoint))return this.m_nonSimpleResult=new u.NonSimpleResult(10,p.ivertex,s.ivertex),!1}else if(!p.bEndPoint||!s.bEndPoint)return this.m_nonSimpleResult=new u.NonSimpleResult(7,p.ivertex,s.ivertex),!1;Os(s,p)}return!0}checkSelfIntersectionsPolylinePlanar3D(e){return s.geometryReleaseAssert(0),!1}checkSelfIntersectionsPolygonsOGC(){const e=this.m_geometry.getImpl(),t=[];let s=-1,n=!1;for(let i=0,r=e.getPathCount();i<r;i++)e.isExteriorRingOGC(i)&&(n=!1,s++,i<r-1&&(e.isExteriorRingOGC(i+1)||(n=!0))),t.push(n?s:-1);const o={x:-1,y:-1,ipath:-1,ivertex:-1,ipolygon:-1};{const e=this.m_pairIndices.read(0),s=this.m_pairs[e]>>1,n=this.m_xy.readPoint2D(2*s),i=this.m_pathsForOGCTests[s];o.ipath=i,o.x=n.x,o.y=n.y,o.ivertex=s,o.ipolygon=t[i]}const a=[];for(let e=1,s=this.m_pairIndices.size();e<s;e++){const s=this.m_pairIndices.read(e),n=this.m_pairs[s];if(1&n)continue;const i=n>>1,r=this.m_xy.readPoint2D(2*i),m=this.m_pathsForOGCTests[i],h=Fs(r.x,r.y,m,i,t[m]);if(h.x===o.x&&h.y===o.y){if(h.ipath===o.ipath)return this.m_nonSimpleResult=new u.NonSimpleResult(11,h.ivertex,o.ivertex),!1;t[h.ipath]>=0&&t[h.ipath]===t[o.ipath]&&(0!==a.length&&qs(a.at(-1),o)||a.push({...o}),a.push(h))}Vs(o,h)}if(0===a.length)return!0;const m=new i.IndexMultiDCList(!0);t.fill(-1);let h=-1;const l=new r.Point2D;for(let e=0,s=a.length;e<s;e++){const s=a[e];s.x===l.x&&s.y===l.y||(h=m.createList(0),l.x=s.x,l.y=s.y);let n=t[s.ipath];-1===n&&(n=m.createList(2),t[s.ipath]=n),m.addElement(n,h),m.addElement(h,n)}const c=[];for(let e=m.getFirstList();-1!==e;e=m.getNextList(e)){const s=m.getListData(e);if(1&s||!(2&s))continue;let n=-1;for(c.push(e),c.push(-1);c.length;){const e=c.at(-1);c.pop();const t=c.at(-1);c.pop();const s=m.getListData(t);if(1&s){n=2&s?t:e;break}m.setListData(t,1|s);for(let s=m.getFirst(t);-1!==s;s=m.getNext(s)){const n=m.getData(s);n!==e&&(c.push(n),c.push(t))}}if(-1!==n){const e=t.indexOf(n);return this.m_nonSimpleResult=new u.NonSimpleResult(12,e,-1),!1}}return!0}_CheckValidRingOrientation(){const e=null!==this.m_multiPathStitcher?this.m_multiPathStitcher.getImpl():this.m_geometry.getImpl();if(e.calculateArea2D()<=0)return this.m_nonSimpleResult=new u.NonSimpleResult(8,1===e.getPathCount()?1:-1,-1),0;if(1===e.getPathCount())return this.m_bOGCRestrictions&&!this.checkSelfIntersectionsPolygonsOGC()?0:4;this.m_pathOrientations=new i.AttributeStreamOfInt8(e.getPathCount(),0),this.m_pathParentage=new i.AttributeStreamOfInt32(e.getPathCount(),-1);let t=-1,s=0;for(let n=0,i=e.getPathCount();n<i;n++){const i=e.calculateRingArea2D(n);if(this.m_pathOrientations.write(n,i<0?0:8),i>0)t=n,s=i;else{if(0===i)return this.m_nonSimpleResult=new u.NonSimpleResult(8,n,-1),0;if((t<0||s<Math.abs(i))&&(this.m_nonSimpleResult=new u.NonSimpleResult(9,n,-1),this.m_bOGCRestrictions))return 0;this.m_pathParentage.write(n,t)}}this.m_unknownOrientationPathCount=e.getPathCount(),this.m_newEdges.length=0;const n=e.getPointCount();this.m_yScanline=Number.NaN;const r=[];this.m_xyToNode1=new i.AttributeStreamOfInt32(n,i.Treap.st_nullNode()),this.m_xyToNode2=new i.AttributeStreamOfInt32(n,i.Treap.st_nullNode()),this.m_freeEdges.length=0,this.m_AET.clear(),this.m_AET.setComparator(new Xs(this));for(let e=0,t=2*n;this.m_unknownOrientationPathCount>0&&e<t;e++){const t=this.m_pairIndices.read(e),s=this.m_pairs[t];if(1&s)continue;const n=s>>1,i=this.m_xy.read(2*n+1);if(i!==this.m_yScanline&&r.length){if(!this.processBunchForRingOrientationTest(r))return 0;r.length=0}r.push(n),this.m_yScanline=i}return this.m_unknownOrientationPathCount>0&&!this.processBunchForRingOrientationTest(r)?0:this.m_bOGCRestrictions?0!==this.m_nonSimpleResult.m_reason?0:this.checkSelfIntersectionsPolygonsOGC()?5:0:0===this.m_nonSimpleResult.m_reason?4:3}processBunchForSelfIntersectionTest(e){if(1===e.length)return!0;for(let t=0,s=e.length;t<s;t++){const s=e[t];this.m_recycledSegIter.resetToVertex(s,-1);const n=this.m_recycledSegIter.previousSegment();this.m_edges.push(this.createEdge(n,s,this.m_recycledSegIter.getPathIndex(),!0)),this.m_recycledSegIter.nextSegment();const i=this.m_recycledSegIter.nextSegment();this.m_edges.push(this.createEdge(i,s,this.m_recycledSegIter.getPathIndex(),!1))}this.m_edges.sort((e,t)=>this.edgeAngleCompare(e,t));let t=this.m_crossOverHelperList.getFirstList();-1===t&&(t=this.m_crossOverHelperList.createList(0)),this.m_crossOverHelperList.reserveNodes(this.m_edges.length);for(let e=0,s=this.m_edges.length;e<s;e++)this.m_crossOverHelperList.addElement(t,e);let s=!0,n=-1,i=-1;for(;s;){s=!1;let e=this.m_crossOverHelperList.getFirst(t);if(-1===e)break;let r=this.m_crossOverHelperList.getNext(e);for(;-1!==r;){const o=this.m_crossOverHelperList.getData(e),a=this.m_crossOverHelperList.getData(r);if(n=this.m_edges[o].m_vertexIndex,i=this.m_edges[a].m_vertexIndex,n!==i)e=r,r=this.m_crossOverHelperList.getNext(e);else if(s=!0,this.m_crossOverHelperList.deleteElement(t,e),e=this.m_crossOverHelperList.getPrev(r),r=this.m_crossOverHelperList.deleteElement(t,r),-1===r||-1===e)break}}const r=this.m_crossOverHelperList.getListSize(t);if(this.m_crossOverHelperList.clear(t),r>0)return this.m_nonSimpleResult=new u.NonSimpleResult(7,n,i),!1;for(let t=0,s=e.length;t<s;t++)this.recycleEdge(this.m_edges[t]);return this.m_edges.length=0,!0}processBunchForRingOrientationTest(e){for(let t=0,s=e.length;t<s;t++){const s=e[t];let n=this.m_xyToNode1.read(s);if(n!==i.Treap.st_nullNode()){const e=this.m_AET.getElement(n);this.m_freeEdges.push(e),this.m_AET.deleteNode(n),this.recycleEdge(this.m_edges[e]),this.m_edges[e]=null,this.m_xyToNode1.write(s,i.Treap.st_nullNode())}if(n=this.m_xyToNode2.read(s),n!==i.Treap.st_nullNode()){const e=this.m_AET.getElement(n);this.m_freeEdges.push(e),this.m_AET.deleteNode(n),this.recycleEdge(this.m_edges[e]),this.m_edges[e]=null,this.m_xyToNode2.write(s,i.Treap.st_nullNode())}}for(let t=0,s=e.length;t<s;t++){const s=e[t];this.m_recycledSegIter.resetToVertex(s,-1);const n=this.m_recycledSegIter.previousSegment();if(n.getStartY()>n.getEndY()){const e=this.m_recycledSegIter.getStartPointIndex(),t=this.createEdge(n,s,this.m_recycledSegIter.getPathIndex(),!0);let r;this.m_freeEdges.length>0?(r=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[r]=t):(r=this.m_edges.length,this.m_edges.push(t));const o=this.m_AET.addElement(r);this.m_xyToNode1.read(e)===i.Treap.st_nullNode()?this.m_xyToNode1.write(e,o):this.m_xyToNode2.write(e,o),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(o)}this.m_recycledSegIter.nextSegment();const r=this.m_recycledSegIter.nextSegment();if(r.getStartY()<r.getEndY()){const e=this.m_recycledSegIter.getEndPointIndex(),t=this.createEdge(r,s,this.m_recycledSegIter.getPathIndex(),!1);let n;this.m_freeEdges.length>0?(n=this.m_freeEdges.at(-1),this.m_freeEdges.pop(),this.m_edges[n]=t):(n=this.m_edges.length,this.m_edges.push(t));const o=this.m_AET.addElement(n);this.m_xyToNode1.read(e)===i.Treap.st_nullNode()?this.m_xyToNode1.write(e,o):this.m_xyToNode2.write(e,o),3&this.m_pathOrientations.read(this.m_recycledSegIter.getPathIndex())||this.m_newEdges.push(o)}}for(let e=0,t=this.m_newEdges.length;e<t&&this.m_unknownOrientationPathCount>0;e++){const t=this.m_newEdges[e],s=this.m_AET.getElement(t),n=this.m_edges[s].m_pathIndex;if(!(3&this.m_pathOrientations.read(n))){let e=-1,s=this.m_AET.getPrev(t),n=t,r=0;{let t=-1,o=null,a=-1,m=0;for(;s!==i.Treap.st_nullNode()&&(t=this.m_AET.getElement(s),o=this.m_edges[t],a=o.m_pathIndex,m=this.m_pathOrientations.read(a),!(3&m));)n=s,s=this.m_AET.getPrev(s);s===i.Treap.st_nullNode()?(r=1,s=n):(e=1==(3&m)?a:this.m_pathParentage.read(a),r=o.getRightSide()?0:1,s=this.m_AET.getNext(s))}do{const t=this.m_AET.getElement(s),i=this.m_edges[t],o=i.m_pathIndex;let a=this.m_pathOrientations.read(o);if(!(3&a)){if(r!==i.getRightSide())return this.m_nonSimpleResult=new u.NonSimpleResult(8,o,-1),!1;const t=r&&!i.getReversed()?1:2;if(a=-4&a|t,this.m_pathOrientations.write(o,a),2===t&&0===this.m_nonSimpleResult.m_reason){const t=this.m_pathParentage.read(o);if(t!==e&&(this.m_nonSimpleResult=new u.NonSimpleResult(9,o,t),this.m_bOGCRestrictions))return!1}if(this.m_unknownOrientationPathCount--,!this.m_unknownOrientationPathCount)return!0}e=1==(3&a)?o:this.m_pathParentage.read(o),n=s,s=this.m_AET.getNext(s),r=r?0:1}while(n!==t)}}return this.m_newEdges.length=0,!0}createEdge(e,t,n,i){let r;return e.getGeometryType()===s.GeometryType.enumLine?r=this.createEdgeLine(e):(r=new ks,r.m_segment=e.clone()),r.m_vertexIndex=t,r.m_pathIndex=n,r.m_flags=0,r.setReversed(i),r}createEdgeLine(e){let t;return this.m_lineEdgesRecycle.length>0?(t=this.m_lineEdgesRecycle.at(-1),this.m_lineEdgesRecycle.pop(),e.copyTo(t.m_segment)):(t=new ks,t.m_segment=e.clone()),t}recycleEdge(e){e.m_segment.getGeometryType()===s.GeometryType.enumLine&&this.m_lineEdgesRecycle.push(e)}static isShortSegment(e,t,s,n){let i=e.calculateLowerLength2D();if(i<=s){let r=!0;if(e.isCurve()&&(i=e.calculateLength2D(),r=i<=s),r){if(t){let t=e.getEndAttributeAsDbl(1,0);Number.isNaN(t)&&(t=0);let s=e.getStartAttributeAsDbl(1,0);return Number.isNaN(s)&&(s=0),Math.abs(s-t)<=n}return!0}return!1}return!1}static isShortSegmentPoints(e,t,s,n,o){if(s){const s=e.getXYZ(),r=t.getXYZ();return i.isCoincidentForClustering(s,r,n,o)}{const s=e.getXY(),i=t.getXY();return r.Point2D.sqrDistance(s,i)<=n*n}}removeDegenerateSegmentsFromCurvedPath(e,t,n,o){const a=e.hasAttribute(1),m=e.querySegmentIterator();m.resetToPath(t),s.geometryReleaseAssert(m.nextPath());const h=this.m_toleranceSimplify.total();let l=!1,u=!0;const c=new i.Point,g=new i.Point,d=new r.Point2D;for(;m.hasNextSegment();){this.progress_();const e=m.nextSegment();if(Ls.isShortSegment(e,a,h,n))if(l){if(e.queryEnd(g),Ls.isShortSegmentPoints(c,g,a,h,n))continue;u&&(o.startPathPoint(c),u=!1),e.queryEnd(c),o.lineToPoint(c),l=!1}else d.assign(e.getStartXY()),e.queryStart(c),l=!0;else if(l)if(e.isCurve()){const t=e.clone();if(t.setCoordsForIntersector(d,e.getEndXY(),!1),t.setStart(c),Ls.isShortSegment(t,a,h,n))continue;o.addSegment(t,u),u=!1,l=!1}else{if(e.queryEnd(g),Ls.isShortSegmentPoints(c,g,a,h,n))continue;u&&(o.startPathPoint(c),u=!1),o.lineToPoint(g),l=!1}else o.addSegment(e,u),u=!1}if(u)return;if(!l)return;e.isClosedPath(t)?e.getPointByVal(e.getPathStart(t),c):e.getPointByVal(e.getPathEnd(t)-1,c);const p=o.querySegmentIterator();p.resetToLastPath(),p.resetToLastSegment();const _=o.getDescription().getAttributeCount()>1;for(s.geometryReleaseAssert(p.previousPath());p.hasPreviousSegment();){const e=p.previousSegment();if(e.isCurve()){const t=e.clone();if(t.setCoordsForIntersector(e.getStartXY(),c.getXY(),!1),!Ls.isShortSegment(t,a,h,n)){_&&t.setEnd(c);const e=p.getEndPointIndex();for(let t=o.getPointCount()-1;t>=e;t--)o.removePoint(t);return void o.addSegment(t,!1)}}else if(e.queryStart(g),!Ls.isShortSegmentPoints(g,c,a,h,n)){const e=p.getEndPointIndex();for(let t=o.getPointCount()-1;t>=e;t--)o.removePoint(t);return void o.lineToPoint(c)}}o.removePath(o.getPathCount()-1)}multipointIsSimpleAsFeature(){if(!this.checkStructure())return 0;const e=this.m_geometry.getImpl();this.m_multiVertexGeom=e;const t=e.getPointCount(),s=r.makePrimitiveArray(t,0);for(let e=0;e<t;e++)s[e]=e;s.sort((e,t)=>this.compareVerticesMultiPoint(e,t));for(let e=1;e<t;e++)if(0===this.compareVerticesMultiPoint(s[e-1],s[e]))return this.m_nonSimpleResult=new u.NonSimpleResult(5,s[e-1],s[e]),0;return 1}polylineIsSimpleAsFeature(){return this.checkStructure()&&this.checkDegenerateSegments(!0)?1:0}polygonIsSimpleAsFeature(){return this.isSimplePlanarImpl()}multipointSimplifyAsFeature(){let e=this.m_geometry.getImpl();const t=Ls.hasNanZs(e);let s,n=this.m_geometry;t&&(s=this.m_geometry.clone(),e=s.getImpl(),s.replaceNaNs(1,i.VertexDescription.getDefaultValue(1)),n=s),this.m_multiVertexGeom=e;const o=e.getPointCount(),a=r.makePrimitiveArray(o,0);for(let e=0;e<o;e++)a[e]=e;a.sort((e,t)=>this.compareVerticesMultiPoint(e,t));const m=new Array(o);m.fill(!1);let h=-1;for(let t=0;t<o;t++){const s=a[t];e.getXY(s).isFinite()&&((h<0||0!==this.compareVerticesMultiPoint(h,s))&&(m[s]=!0),h=s)}const l=this.m_geometry.createInstance();let u=0,c=0;for(let e=0;e<o;e++)m[e]?c=e+1:(u<c&&l.addPoints(n,u,c),u=e+1);return u<c&&l.addPoints(n,u,c),l.getImpl().setIsSimple(1,this.m_toleranceSimplify.total()),l}polylineSimplifyAsFeature(){const e=this.m_geometry.getImpl(),t=e.querySegmentIterator(),s=e.querySegmentIterator(),n=this.m_geometry.createInstance(),o=this.m_geometry,a=e.hasAttribute(1),m=a?i.calculateZToleranceFromGeometryForOpFromGeom(this.m_sr,e,!0).total():0,h=[],l=[];let u=null;a&&(u=e.getAttributeStreamRef(1));const c=new i.Point,g=e.hasNonLinearSegments(),d=this.m_toleranceSimplify.total();for(;t.nextPath();){if(s.nextPath(),e.getPathSize(t.getPathIndex())<2)continue;if(g&&e.hasNonLinearSegmentsPath(t.getPathIndex())){this.removeDegenerateSegmentsFromCurvedPath(e,t.getPathIndex(),m,n);continue}s.resetToLastSegment();let i=0,p=0,_=!0,f=!0;for(;t.hasNextSegment();){this.progress_();const n=t.nextSegment(),o=s.previousSegment();if(t.getStartPointIndex()>s.getStartPointIndex())break;if(_){const s=t.getStartPointIndex();e.getXY(s).isNAN()||(_=!1,h.push(s))}if(f){const t=s.getEndPointIndex();e.getXY(t).isNAN()||(l.push(t),f=!1)}if(!_){const s=h.at(-1),o=t.getEndPointIndex();if(o-s>1){const t=new r.Point2D;t.setSub(e.getXY(s),e.getXY(o)),i=t.length()}else i=n.calculateLength2D();if(i>d)h.push(o),i=0;else if(a){let e=u.read(s);Number.isNaN(e)&&(e=0);let t=u.read(o);Number.isNaN(t)&&(t=0),Math.abs(t-e)>m&&(h.push(o),i=0)}}if(!f){const t=l.at(-1),n=s.getStartPointIndex();if(n-t>1){const s=new r.Point2D;s.setSub(e.getXY(t),e.getXY(n)),p=s.length()}else p=o.calculateLength2D();if(p>d)l.push(n),p=0;else if(a){let e=u.read(t);Number.isNaN(e)&&(e=0);let s=u.read(n);Number.isNaN(s)&&(s=0),Math.abs(s-e)>m&&(l.push(n),p=0)}}}if(h.length>0&&l.length>0&&(h.at(-1)<l.at(-1)?h.length>l.length?h.pop():l.pop():(h.at(-1)===l.at(-1)||l.pop(),l.pop())),l.length+h.length>=2){let e=!1;for(let t=0,s=h.length;t<s;t++)o.getPointByVal(h[t],c),e?n.lineToPoint(c):(n.startPathPoint(c),e=!0);for(let t=l.length-1;t>0;t--)o.getPointByVal(l[t],c),e?n.lineToPoint(c):(n.startPathPoint(c),e=!0);o.isClosedPath(t.getPathIndex())?n.closePathWithLine():l.length>0&&(o.getPointByVal(l[0],c),n.lineToPoint(c))}h.length=0,l.length=0}return a&&n.replaceNaNs(1,0),n.getImpl().setIsSimple(1,d),n}polygonSimplifyAsFeature(){return this.simplifyPlanar()}simplifyPlanar(){if(1===this.m_geometry.getFillRule()&&!i.isAtLeastWeakSimple(this.m_knownSimpleResult))return vs(this.m_geometry,this.m_toleranceSimplify,!0,!1,this.m_knownSimpleResult,this.m_progressTracker,0,!0);const e=new n.EditShape;if(e.addGeometry(this.m_geometry),this.m_geometry.hasAttribute(1)&&e.replaceNaNs(1,0),e.removeNaNVertices(),0!==e.getTotalPointCount()){let n=null,r=0,o=0;if(e.hasCurves()){n=new ms;const s=t.Envelope2D.constructEmpty();this.m_geometry.queryEnvelope(s);const i=rs(this.m_toleranceSimplify.total(),s);r=os(this.m_toleranceSimplify.total()),o=as(i,r),ss(e,i,this.m_toleranceSimplify.total(),0,n,null,this.m_progressTracker)}i.isAtLeastWeakSimple(this.m_knownSimpleResult)||ls(e,this.m_toleranceSimplify.add(o),this.m_progressTracker,!0,!1),this.m_geometry.getGeometryType()===s.GeometryType.enumPolygon&&Ae(e,e.getFirstGeometry(),this.m_knownSimpleResult,!1,-1,this.m_progressTracker),null!==n&&n.stitchCurves(e,e.getFirstGeometry(),r,!0)}const r=e.getGeometry(e.getFirstGeometry());return r.getGeometryType()===s.GeometryType.enumPolygon&&(r.getImpl().updateOGCFlagsProtected(),r.setFillRule(0)),r.getImpl().setIsSimple(4,this.m_toleranceSimplify.total()),r}progress_(){}static hasNanZs(e){if(e.hasAttribute(1)){const t=e.getAttributeStreamRef(1);for(let s=0,n=e.getPointCount();s<n;s++){const e=t.read(s);if(Number.isNaN(e))return!0}}return!1}compareVerticesForPlanarClustering(e,t,s){if(e===t)return 0;const n=this.m_pairs[e],i=this.m_pairs[t],o=n>>1,a=i>>1,m=this.m_xy.readPoint2D(2*o);m.y+=1&n?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;const h=this.m_xy.readPoint2D(2*a);h.y+=1&i?this.m_toleranceIsSimpleClustering:-this.m_toleranceIsSimpleClustering;const l=m.compare(h);if(0===l&&s){const e=this.m_pathsForOGCTests[o]-this.m_pathsForOGCTests[a];return r.sign(e)}return l}compareVerticesMultiPoint(e,t){if(e===t)return 0;const s=this.m_multiVertexGeom.getXY(e),n=this.m_multiVertexGeom.getXY(t),o=!s.isFinite(),a=!n.isFinite();if(o||a)return o<a?-1:o>a?1:0;if(s.y<n.y)return-1;if(s.y>n.y)return 1;if(s.x<n.x)return-1;if(s.x>n.x)return 1;for(let s=1;s<this.m_attributeCount;s++){const n=this.m_description.getSemantics(s),o=i.VertexDescription.getComponentCount(n);for(let s=0;s<o;s++){const i=this.m_multiVertexGeom.getAttributeAsDbl(n,e,s),o=this.m_multiVertexGeom.getAttributeAsDbl(n,t,s),a=r.compareWithNANs(i,o);if(0!==a)return a}}return 0}edgeAngleCompare(e,t){if(e===t)return 0;const s=e.m_segment.getTangent(e.getReversed()?1:0);e.getReversed()&&s.negateThis();const n=t.m_segment.getTangent(t.getReversed()?1:0);t.getReversed()&&n.negateThis();const i=s.getQuarter(),r=n.getQuarter();if(r===i){const e=s.crossProduct(n);return e<0?1:e>0?-1:0}return i<r?-1:1}}class Bs{getOperatorType(){return 10103}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}isSimpleAsFeature(e,t,s,n,r){const o=Gs(e,t,s,n,r);return i.isAtLeastSimpleAsFeature(e.getGeometryType(),o)}isSimplePlanarDONOTUSE(e,r,o,a,m){const h=function(e,r,o,a,m){if(a&&(a.m_reason=0,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),e.isEmpty())return 5;const h=e.getGeometryType();if(h===s.GeometryType.enumPoint)return Rs(e,a);const l=i.calculateToleranceFromGeometryForOpFromGeom(r,e,!1).total();if(h===s.GeometryType.enumEnvelope){const s=e,n=new t.Envelope2D;return s.queryEnvelope(n),n.isDegenerate(l)?(a&&(a.m_reason=4,a.m_vertexIndex1=-1,a.m_vertexIndex2=-1),0):5}if(s.isSegment(h)){const t=e,s=new n.Polyline({vd:t.getDescription()});return s.addSegment(t,!0),Gs(s,r,o,a,m)}const u=e.getImpl().getIsSimple(l,[0]);let c=o?-1:u;if(i.isAtLeastPlanarSimple(c)||0===c)return c;const g=new Ls(e,r,c,m,!1);return h===s.GeometryType.enumMultiPoint||h===s.GeometryType.enumPolyline||h===s.GeometryType.enumPolygon?c=g.isSimplePlanarImpl():s.throwInternalErrorException(""),e.getImpl().setIsSimple(c,l),a&&a.assign(g.m_nonSimpleResult),c}(e,r,o,a,m);return i.isAtLeastPlanarSimple(h)}executeMany(e,t,s,n){return new zs(e,t,s,n)}execute(e,t,n,i){const r=new l.SimpleGeometryCursor([e]),o=this.executeMany(r,t,n,i).next();return o||s.throwInternalErrorException("null geometry"),o}}class zs extends l.GeometryCursor{constructor(e,t,s,n){super(),this.m_progressTracker=n,this.m_bForceSimplify=s,this.m_index=-1,this.m_inputGeometryCursor=e,this.m_spatialReference=t}next(){const e=this.m_inputGeometryCursor.next();return e?(this.m_index=this.m_inputGeometryCursor.getGeometryID(),this.simplify(e)):null}getGeometryID(){return this.m_index}tock(){return!1}getRank(){return 1}simplify(e){if(e||s.throwInvalidArgumentException(""),e.getGeometryType()===s.GeometryType.enumGeometryCollection){const t=n.generateGeometryCursor(e,-1),s=(new Bs).executeMany(t,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker),i=e.createInstance();for(let e=s.next();null!=e;e=s.next())i.addGeometry(e);return i}return Ms(e,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker)}}class Us{constructor(e,t,n,i){this.m_intersectorGeom=null,this.m_sr=null,this.m_dimensionMask=-1,this.m_progressTracker=null,this.m_intersectorGeomType=s.GeometryType.enumUnknown,this.m_geomIntersectorEmptyGeom=null,this.m_intersectorGeom=e,this.m_sr=t,this.m_dimensionMask=n,this.m_progressTracker=i,this.m_intersectorGeomType=e.getGeometryType()}intersect(e){const o=this.tryFastImplementation(e);if(null!==o)return o;const a=i.getMergedExtent(this.m_intersectorGeom,e),h=i.calculateToleranceFromGeometryForOp(this.m_sr,a,!0).total(),l=t.Envelope2D.constructEmpty();this.m_intersectorGeom.queryEnvelope(l);const u=t.Envelope2D.constructEmpty();e.queryEnvelope(u),l.inflateCoords(2*h,2*h),l.intersect(u),l.inflateCoords(100*h,100*h);let c=m.clip$1(this.m_intersectorGeom,l,0,0,this.m_progressTracker),g=m.clip$1(e,l,0,0,this.m_progressTracker);return e.getDimension()>this.m_intersectorGeom.getDimension()&&(c=r.swap(g,g=c)),function(e,r,o,a){const m=t.Envelope2D.constructEmpty();e.queryEnvelope(m);const h=t.Envelope2D.constructEmpty();r.queryEnvelope(h);const l=t.Envelope2D.constructEmpty();l.setCoords({env2D:m}),l.mergeEnvelope2D(h);const u=i.calculateToleranceFromGeometryForOp(o,l,!0),c=new t.Envelope2D(h),g=i.adjustToleranceForTEClustering(u);if(c.inflateCoords(g,g),!m.isIntersecting(c)){if(e.getDimension()<=r.getDimension())return ws(Ts(e.createInstance()),e,0,"&");if(e.getDimension()>r.getDimension())return ws(Ts(r.createInstance()),e,0,"&")}const d=new Is(a),p=new n.EditShape,_=p.addGeometry(Ts(e)),f=p.addGeometry(Ts(r));let y=0,x=0,P=null;if(p.hasCurves()){P=new ms;const e=p.getEnvelope2D(a);x=os(u.total());const t=rs(u.total(),e);y=as(t,x),ss(p,t,u.total(),0,P,null,a)}d.setEditShapeCrackAndCluster(p,u.add(y));const E=d.intersection(_,f);null!==P&&P.stitchCurves(p,E,x,!0);const v=ws(p.getGeometry(E),e,0,"&");return ys(v.getGeometryType())&&(v.getImpl().setIsSimple(4,u.total()),v.getGeometryType()===s.GeometryType.enumPolygon&&v.getImpl().updateOGCFlagsProtected()),v}(g,c,this.m_sr,this.m_progressTracker)}intersectEx(e){const o=this.tryFastImplementation(e);if(null!==o){const t=[];return t.length=3,t[o.getDimension()]=o,this.prepareVector(e.getDescription(),this.m_dimensionMask,t)}const a=i.getMergedExtent(this.m_intersectorGeom,e),h=i.calculateToleranceFromGeometryForOp(this.m_sr,a,!0).total(),l=t.Envelope2D.constructEmpty();this.m_intersectorGeom.queryEnvelope(l);const u=t.Envelope2D.constructEmpty();e.queryEnvelope(u),l.inflateCoords(2*h,2*h),l.intersect(u),l.inflateCoords(100*h,100*h);let c=m.clip$1(this.m_intersectorGeom,l,0,0,this.m_progressTracker),g=m.clip$1(e,l,0,0,this.m_progressTracker);e.getDimension()>this.m_intersectorGeom.getDimension()&&(c=r.swap(g,g=c));const d=function(e,r,o,a){const m=new Array(3),h=t.Envelope2D.constructEmpty();e.queryEnvelope(h);const l=t.Envelope2D.constructEmpty();r.queryEnvelope(l);const u=t.Envelope2D.constructEmpty();u.setCoords({env2D:h}),u.mergeEnvelope2D(l);const c=i.calculateToleranceFromGeometryForOp(o,u,!0),g=new t.Envelope2D(l),d=i.adjustToleranceForTEClustering(c);if(g.inflateCoords(d,d),!h.isIntersecting(g)){if(e.getDimension()<=r.getDimension()){const t=ws(Ts(e.createInstance()),e,0,"&");return m[t.getDimension()]=t,m}if(e.getDimension()>r.getDimension()){const t=ws(Ts(r.createInstance()),e,0,"&");return m[t.getDimension()]=t,m}}const p=new Is(a),_=new n.EditShape,f=_.addGeometry(Ts(e)),y=_.addGeometry(Ts(r));let x=0,P=0,E=null;if(_.hasCurves()){E=new ms;const e=_.getEnvelope2D(a);P=os(c.total());const t=rs(c.total(),e);x=as(t,P),ss(_,t,c.total(),0,E,null,a)}p.setEditShapeCrackAndCluster(_,c.add(x)),_.dbgVerifyCurves();const v=p.intersectionEx(f,y);for(const t of v){null!==E&&E.stitchCurves(_,t,P,!1);const n=ws(_.getGeometry(t),e,0,"&");ys(n.getGeometryType())&&(n.getImpl().setIsSimple(4,c.total()),n.getGeometryType()===s.GeometryType.enumPolygon&&n.getImpl().updateOGCFlagsProtected()),m[n.getDimension()]=n}return null!==E&&E.clearStitcher(_),m}(g,c,this.m_sr,this.m_progressTracker);return this.prepareVector(e.getDescription(),this.m_dimensionMask,d)}init(e,t,n,i=null){s.geometryReleaseAssert(0)}static intersectPoints(e,t,s){const n=i.getMergedExtent(e,t);return o=e,a=t,m=i.calculateToleranceFromGeometryForOp(s,n,!0),o.isEmpty()||a.isEmpty()?o.createInstance():function(e,t,s){const n=i.adjustToleranceForTEClustering(e);return J(t.getX(),t.getY(),s.getX(),s.getY(),r.sqr(n))}(m,o,a)?new i.Point({copy:us(o,a)}):o.createInstance();var o,a,m}tryFastImplementation(e){const r=e.getGeometryType();if(this.m_intersectorGeomType===s.GeometryType.enumPoint&&r===s.GeometryType.enumPoint){const t=Us.intersectPoints(e,this.m_intersectorGeom,this.m_sr);if(-1!==this.m_dimensionMask){const e=new n.MultiPoint({vd:t.getDescription()});return t.isEmpty()||e.add(t),e}return t}if(r===s.GeometryType.enumEnvelope&&this.m_intersectorGeomType===s.GeometryType.enumEnvelope&&(-1===this.m_dimensionMask||4===this.m_dimensionMask)){const t=e,s=this.m_intersectorGeom,n=new i.Envelope({copy:t});return n.intersect(s),n}const o=i.getMergedExtent(e,this.m_intersectorGeom),a=i.calculateToleranceFromGeometryForOp(this.m_sr,o,!0),h=e.isEmpty(),l=this.m_intersectorGeom.isEmpty();let u=h||l;if(!u){const n=function(e,n,i){const r=new t.Envelope2D;e.queryEnvelope(r);const o=new t.Envelope2D;n.queryEnvelope(o);const a=new t.Envelope2D(o);if(a.inflate(2*i),!a.isIntersecting(r))return 4;const m=e.getGeometryType(),h=n.getGeometryType();if(m===s.GeometryType.enumEnvelope&&r.containsEnvelope(a))return 1;if(h===s.GeometryType.enumEnvelope){const e=new t.Envelope2D(r);if(e.inflate(2*i),o.containsEnvelope(e))return 2}return 0}(this.m_intersectorGeom,e,a.total());if(4===n)u=!0;else{if(2&n)return this.m_intersectorGeom;if(1&n)return e}}if(u){const t=s.getDimensionFromType(r),n=s.getDimensionFromType(this.m_intersectorGeomType);return t<n?Us.ReturnEmpty(e,h):t>n||0===t&&r===s.GeometryType.enumMultiPoint&&this.m_intersectorGeomType===s.GeometryType.enumPoint?this.ReturnEmptyIntersector():Us.ReturnEmpty(e,h)}if(r===s.GeometryType.enumEnvelope&&0===s.getDimensionFromType(this.m_intersectorGeomType)||this.m_intersectorGeomType===s.GeometryType.enumEnvelope&&0===s.getDimensionFromType(r)){const n=r===s.GeometryType.enumEnvelope?e:this.m_intersectorGeom,i=r===s.GeometryType.enumEnvelope?this.m_intersectorGeom:e,o=t.Envelope2D.constructEmpty();return n.queryEnvelope(o),m.clip$1(i,o,a.total(),0,this.m_progressTracker)}if(0===s.getDimensionFromType(r)&&s.getDimensionFromType(this.m_intersectorGeomType)>0||s.getDimensionFromType(r)>0&&0===s.getDimensionFromType(this.m_intersectorGeomType)){if(r===s.GeometryType.enumMultiPoint)return Cs(e,this.m_intersectorGeom,a);if(r===s.GeometryType.enumPoint)return Ds(e,this.m_intersectorGeom,a);if(this.m_intersectorGeomType===s.GeometryType.enumMultiPoint)return Cs(this.m_intersectorGeom,e,a);if(this.m_intersectorGeomType===s.GeometryType.enumPoint)return Ds(this.m_intersectorGeom,e,a);s.throwInternalErrorException("")}return null}ReturnEmptyIntersector(){return null===this.m_geomIntersectorEmptyGeom&&(this.m_geomIntersectorEmptyGeom=this.m_intersectorGeom.createInstance()),this.m_geomIntersectorEmptyGeom}static ReturnEmpty(e,t){return t?e:e.createInstance()}prepareVector(e,t,s){let i=0;return 1&t?(s[0]||(s[0]=new n.MultiPoint({vd:e})),i++):s.shift(),2&t?(s[i]||(s[i]=new n.Polyline({vd:e})),i++):s.splice(i,1),4&t?s[i]||(s[i]=new n.Polygon({vd:e})):s.splice(i,1),new l.SimpleGeometryCursor(s)}}class js extends l.GeometryCursor{constructor(e,t,n,i,r){super(),this.m_smallCursor=null,this.m_progressTracker=i,this.m_geomIntersector=t.next(),this.m_intersector=new Us(this.m_geomIntersector,n,r,i),this.m_index=-1,this.m_inputGeoms=e,this.m_dimensionMask=r,-1!==this.m_dimensionMask&&(this.m_dimensionMask<=0||this.m_dimensionMask>7)&&s.throwInvalidArgumentException("bad dimension mask")}next(){if(!this.m_geomIntersector)return null;let e;if(null!==this.m_smallCursor){if(e=this.m_smallCursor.next(),e)return e;this.m_smallCursor=null}for(;e=this.m_inputGeoms.next();)return s.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID(),-1===this.m_dimensionMask?this.m_intersector.intersect(e):(this.m_smallCursor=this.m_intersector.intersectEx(e),this.m_smallCursor.next());return null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class Ws{getOperatorType(){return 1e4}accelerateGeometry(e,t,r){if(!this.canAccelerateGeometry(e))return!1;i.calculateToleranceFromGeometryForOpFromGeom(t,e,!0);let o=0;return e.getGeometryType()!==s.GeometryType.enumPolygon&&e.getGeometryType()!==s.GeometryType.enumPolyline||!n.canUseQuadTree(e)||0===r||(o|=e.getImpl().buildQuadTreeAccelerator(r)?1:0),!!o}canAccelerateGeometry(e){return n.canUseQuadTree(e)}supportsCurves(){return!0}executeMany(e,t,s,n,i=-1){return new js(e,t,s,n,i)}execute(e,t,n,i){if(e.getGeometryType()===s.GeometryType.enumPoint&&t.getGeometryType()===s.GeometryType.enumPoint)return Us.intersectPoints(e,t,n);const r=new l.SimpleGeometryCursor([e]),o=new l.SimpleGeometryCursor([t]),a=this.executeMany(r,o,n,i,-1).next();return a||s.throwInternalErrorException("null output"),a}}function Zs(e,t,s){return t.m_projector.project(e,s)}function Qs(e,t,s,n,i){return e.m_projector.transformInPlaceZ(t,null,s,n,null,i)}function Ks(e,r,o,a){if(e&&r&&r.isPannable()||s.throwInvalidArgumentException("fold_into_360_range_geodetic"),e.isEmpty())return e;if(4===o)return $s(e,r,a);let m=e;const h=m.getGeometryType();if(s.isMultiPath(h)){m=_i(e,r);const s=new t.Envelope2D;m.queryEnvelope(s);const n=i.calculateToleranceFromGeometryForOp(r,s,!1).total(),a=r.getPannableExtent();let h=Math.floor((s.xmin-a.xmin)/a.width())*a.width()+a.xmin,l=m;for(;h<s.xmax;)h>s.xmin+n&&h<s.xmax-n&&(l=di(l,r,o,!0,h)),h+=a.width();m=l}else{if(h===s.GeometryType.enumEnvelope){const e=new n.Polygon({vd:m.getDescription()});return e.addEnvelope(m,!1),Ks(e,r,o,a)}if(s.isSegment(h)){const e=new n.Polyline({vd:m.getDescription()});return e.addSegment(m,!0),Ks(e,r,o,a)}}return $s(m,r,a)}function $s(e,t,i){if(e&&t&&t.isPannable()||s.throwInvalidArgumentException(""),e.isEmpty())return e;let r;const o=e.getGeometryType();if(o===s.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});t.addEnvelope(e,!1),r=t}else if(s.isSegment(o)){const t=new n.Polyline({vd:e.getDescription()});t.addSegment(e,!0),r=t}else r=e;const a=_i(r,t);return a.isEmpty()?a:hi(a,t,0,a!==e,0,i)}function Js(e,t,s,n){const o=t.getXYGridRange(),a=e.hasAttribute(1),h=e.hasAttribute(2);let l=new r.Envelope1D,u=new r.Envelope1D;a&&(l=t.getZGridRange()),h&&(u=t.getMGridRange());let c=(new m.OperatorClip).execute(e,o,s,n);if(a){const t=c.queryInterval(1,0);l.contains(t)||(e===c&&(c=c.clone()),i.snapCoordinate(c,l,1,0))}if(h){const t=c.queryInterval(2,0);u.contains(t)||(e===c&&(c=c.clone()),i.snapCoordinate(c,u,2,0))}return c}class en{constructor(e){this.m_inputPCSHorizonClipOption=0,this.m_outputPCSHorizonClipOption=0,this.m_bDontGeonormalizePolygon=!1,this.m_bClipOutCurvedPoles=!1,this.m_bNormalizeOutputGeometry=!1,this.m_bDontHackPolesInGeogToGeog=!1,this.m_centralMeridianOfOutputGCS=0,this.m_densificationStepInput=0,e||s.throwInvalidArgumentException(""),this.m_projTransform=e,this.m_bClipOutCurvedPoles=!1;const t=this.m_projTransform.getExtendedParamsImpl();this.m_bNormalizeOutputGeometry=t.normalizeResultGeometry,this.m_bNormalizeOutputGeometry&&(t.legacyHorizonClipping?this.m_bNormalizeOutputGeometry=!1:this.m_projTransform.getOutputSR().isPannable()||(this.m_bNormalizeOutputGeometry=!1)),t.clipWithInputHorizon?(this.m_inputPCSHorizonClipOption=0,!t.legacyHorizonClipping&&this.m_projTransform.getInputSR().isPannable()&&(this.m_inputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_inputPCSHorizonClipOption=1,t.clipWithOutputHorizon?(this.m_outputPCSHorizonClipOption=0,!t.legacyHorizonClipping&&this.m_projTransform.getOutputSR().isPannable()&&(this.m_outputPCSHorizonClipOption=this.m_bNormalizeOutputGeometry?4:2)):this.m_outputPCSHorizonClipOption=1,this.m_centralMeridianOfOutputGCS=t.centralMeridianOfOutputGCS,this.m_densificationStepInput=t.densificationStep;const n=this.m_projTransform.getExtendedParamsInternal();this.m_bDontGeonormalizePolygon=n.hasFlag(2147483648),this.m_bDontHackPolesInGeogToGeog=n.hasFlag(1073741824),this.m_bClipOutCurvedPoles=n.hasFlag(536870912)}project(e,t){if(this.m_projTransform.isIdentity()||e.isEmpty())return e;const n=e.getGeometryType();if(n===s.GeometryType.enumPoint)return this.projectPoint(e,t);const i=this.m_projTransform.getInputSR().getCoordinateSystemType(),r=this.m_projTransform.getOutputSR().getCoordinateSystemType(),o=this.m_projTransform.getInputSR(),a=this.m_projTransform.getOutputSR();if(0===i&&i===r){const t=sn(o,a),s=e.clone();return s.applyTransformation(t),s}switch(n){case s.GeometryType.enumPolyline:case s.GeometryType.enumPolygon:return this.projectMultiPath(e,t);case s.GeometryType.enumMultiPoint:return this.projectMultiPoint(e,t);case s.GeometryType.enumEnvelope:return this.projectEnvelope(e,t);case s.GeometryType.enumGeometryCollection:return this.projectGeometryCollection(e,t);default:s.throwInternalErrorException("")}}projectPoint(e,t){const s=[e.getXY()];let n,i=null;(n=e.hasAttribute(1))&&(i=[e.getZ()]),this.transformInPlaceZ(s,i,1,s,i,null);const r=e.clone();return r.setXY(s[0]),n&&r.setZ(i[0]),r}projectMultiPoint(e,t){let i=new n.MultiPoint({copy:e});const r=this.m_projTransform.getInputSR(),o=this.m_projTransform.getOutputSR(),a=r.getCoordinateSystemType(),m=o.getCoordinateSystemType();if(3===a&&s.geometryReleaseAssert(0),i=vi(i,r,this.m_inputPCSHorizonClipOption,t),i.isEmpty())return i;2===a&&Ii(r,0,i),Mi(this.m_projTransform,i,!1);let h=0;3===m&&s.geometryReleaseAssert(0);const l=2===m;return l?h=o.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(h=this.m_centralMeridianOfOutputGCS),l&&0!==this.m_outputPCSHorizonClipOption||(i=hi(i,qr(o),h,!1,0,t)),l&&(i=ri(i,o,this.m_outputPCSHorizonClipOption,t),Di(o,i,this.m_bNormalizeOutputGeometry),i.isEmpty()),i}projectMultiPath(e,t){const n=e.getGeometryType();return n===s.GeometryType.enumPolygon?this.projectPolygon(e,t):n===s.GeometryType.enumPolyline?this.projectPolyline(e,t):void s.throwInternalErrorException("project_multi_path_")}projectEnvelope(e,t){this.m_projTransform.getInputSR(),this.m_projTransform.getOutputSR();const s=this.m_projTransform.isVertical()&&e.hasAttribute(1);let n=r.Envelope1D.constructEmpty();if(s&&(n=e.queryInterval(1,0)),n.width()>0){const s=e.clone();s.setInterval(1,0,n.vmin,n.vmin);const i=this.projectEnvelopeHelper(s,t);s.setInterval(1,0,n.vmax,n.vmax);const r=this.projectEnvelopeHelper(s,t);return i.merge(r),i}return this.projectEnvelopeHelper(e,t)}projectPolygon(e,i){s.geometryReleaseAssert(e.getGeometryType()===s.GeometryType.enumPolygon),s.geometryReleaseAssert(!this.m_projTransform.isIdentity()),s.geometryReleaseAssert(!e.isEmpty());const r=this.m_projTransform.getInputSR(),o=this.m_projTransform.getOutputSR(),a=r.getCoordinateSystemType(),l=o.getCoordinateSystemType(),u=new n.Polygon({copy:e});3===a&&s.geometryReleaseAssert(0),3===l&&s.geometryReleaseAssert(0);const c=2===a,g=2===l,d=c?r.getGCS():r,p=g?o.getGCS():o,_=!g&&!this.m_bDontHackPolesInGeogToGeog;let f=!1,y=vi(u,r,this.m_inputPCSHorizonClipOption,i);if(y.isEmpty())return y;let x=this.m_densificationStepInput;const P=!Number.isNaN(x);let E;P&&(y=(new h.OperatorDensify).execute(y,x,0,0,i));let v=g?o.getPCSInfo():null,C=Number.NaN;c&&(C=r.getCentralMeridian());const D=null!==o.getGCSSplitLines();if(this.m_bDontGeonormalizePolygon){const e=y;if(c&&(Ai(r,C,e),P)){const e=r.getUnitsPerMillimeter();x*=r.getGCS().getUnitsPerMillimeter()/e}if(ki(this.m_projTransform,e,_),P){const e=r.getGCS().getUnitsPerMillimeter();x*=o.getGCS().getUnitsPerMillimeter()/e}E=e}else{let e=new n.Polyline({vd:y.getDescription()});if(e.addAndExplicitlyOpenAllPaths(y,!1),c){if(Ai(r,C,e),P){const e=r.getUnitsPerMillimeter();x*=r.getGCS().getUnitsPerMillimeter()/e}if(this.m_bClipOutCurvedPoles){const s=r.getPCSInfo(),n=s.getSouthPoleGeometry()===lo.PE_POLE_LINE_CURVED,o=s.getNorthPoleGeometry()===lo.PE_POLE_LINE_CURVED;if(n||o){const s=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(s),s.inflateCoords(1,1);const r=89.9999*d.getOneDegreeGCSUnit();n&&(s.ymin=-r),o&&(s.ymax=r),e=m.clipPolesOut(e,s,d,0,0,i)}}}if(ki(this.m_projTransform,e,_),P){const e=qr(r).getUnitsPerMillimeter();x*=qr(o).getUnitsPerMillimeter()/e}let s=Number.NaN;g?(v=o.getPCSInfo(),s=o.getCentralMeridian()):Number.isNaN(this.m_centralMeridianOfOutputGCS)||(s=this.m_centralMeridianOfOutputGCS);let a=tn(r)|tn(o),h=10*p.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(a=3,h=10*p.getTolerance(0)),E=function(e,t,s,n,i,r,o,a,m){return new Fn(e,null,s,t,n,i,o,a,r).geoNormalizePolygonGeometry(m)}(y,r,e,p,s,i,a,h,this.m_bNormalizeOutputGeometry),a=0}if(D&&(s.geometryReleaseAssert(!o.isPannable()),E=si(E,o,i)),g){if(!f){const e=p.getPannableExtent().width();if(E.queryInterval(0,0).width()>=e-10*p.getTolerance(0)){const e=v.getNorthPoleLocation(),t=v.getSouthPoleLocation(),s=v.getNorthPoleGeometry(),n=v.getSouthPoleGeometry();let i=0;s===lo.PE_POLE_POINT&&e!==lo.PE_POLE_OUTSIDE_BOUNDARY&&(i=1),n===lo.PE_POLE_POINT&&t!==lo.PE_POLE_OUTSIDE_BOUNDARY&&(i|=2),f||=0!==i}}E=ri(E,o,this.m_outputPCSHorizonClipOption,i),P&&(E=(new h.OperatorDensify).execute(E,x,0,0,i)),Si(o,E,this.m_bNormalizeOutputGeometry)}return E.isEmpty()||f&&(E=(new Bs).execute(E,o,!1,i)),E}projectPolyline(e,t){s.geometryReleaseAssert(e.getGeometryType()===s.GeometryType.enumPolyline),s.geometryReleaseAssert(!this.m_projTransform.isIdentity()),s.geometryReleaseAssert(!e.isEmpty());const i=this.m_projTransform.getInputSR(),r=this.m_projTransform.getOutputSR(),o=i.getCoordinateSystemType(),a=r.getCoordinateSystemType(),m=new n.Polyline({copy:e});3===o&&s.geometryReleaseAssert(0),3===a&&s.geometryReleaseAssert(0);const l=2===o,u=2===a;l&&i.getGCS();const c=u?r.getGCS():r,g=!u&&!this.m_bDontHackPolesInGeogToGeog;let d=vi(m,i,this.m_inputPCSHorizonClipOption,t);if(d.isEmpty())return d;let p=Number.NaN;l&&(p=i.getCentralMeridian());const _=null!==r.getGCSSplitLines();let f=this.m_densificationStepInput;const y=!Number.isNaN(f);let x;if(y&&(d=(new h.OperatorDensify).execute(d,f,0,0,t)),this.m_bDontGeonormalizePolygon){if(l&&(Ai(i,p,d),y)){const e=i.getUnitsPerMillimeter();f*=i.getGCS().getUnitsPerMillimeter()/e}if(ki(this.m_projTransform,d,g),y){const e=i.getGCS().getUnitsPerMillimeter();f*=r.getGCS().getUnitsPerMillimeter()/e}x=d}else{const e=new n.Polyline({vd:d.getDescription()});if(e.addAndExplicitlyOpenAllPaths(d,!1),l&&(Ai(i,p,e),y)){const e=i.getUnitsPerMillimeter();f*=i.getGCS().getUnitsPerMillimeter()/e}if(ki(this.m_projTransform,e,g),y){const e=i.getGCS().getUnitsPerMillimeter();f*=r.getGCS().getUnitsPerMillimeter()/e}let s=Number.NaN;u?s=r.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(s=this.m_centralMeridianOfOutputGCS);let o=tn(i)|tn(r),a=10*c.getTolerance(0);this.m_bDontHackPolesInGeogToGeog&&(o=3,a=0),x=function(e,t,s,n,i,r,o,a,m){return new Fn(e,null,s,t,n,i,o,a,r).geoNormalizePolylineGeometry(m)}(d,i,e,c,s,t,o,a,this.m_bNormalizeOutputGeometry),o=0}return _&&(s.geometryReleaseAssert(!r.isPannable()),x=si(x,r,t)),u&&(x=ri(x,r,this.m_outputPCSHorizonClipOption,t),y&&(x=(new h.OperatorDensify).execute(x,f,0,0,t)),Si(r,x,this.m_bNormalizeOutputGeometry)),x.isEmpty(),x}projectGeometryCollection(e,t){return s.geometryReleaseAssert(0),{}}projectEnvelopeHelper(e,s){const r=(e.height()+e.width())/400;if(0!==r){const o=(new h.OperatorDensify).execute(e,r,0,0,s),a=this.projectMultiPath(o,s),m=new i.Envelope({vd:e.getDescription()});if(a.isEmpty()){const r=Math.min(e.height(),e.width()),a=i.calculateToleranceFromGeometryForOpFromGeom(this.m_projTransform.getInputSR(),e,!0).total();if(r>100*a){const e=t.Envelope2D.constructEmpty(),s=i.calculateToleranceFromGeometryForOp(this.m_projTransform.getOutputSR(),e,!0).total(),n=this.m_projTransform.getInputSR().getOneMeter()/this.m_projTransform.getOutputSR().getOneMeter();if(r>100*Math.max(a,s*n))return m}const h=new n.Polyline;h.addAndExplicitlyOpenAllPaths(o,!1),this.projectMultiPath(h,s).queryEnvelope(m);const l=new n.MultiPoint({vd:e.getDescription()});l.reserve(4);const u=new i.Point;for(let t=0;t<4;t++)e.queryCornerByVal(t,u),l.add(u);const c=this.projectMultiPoint(l,s),g=new i.Envelope;return c.queryEnvelope(g),m.merge(g),m}return a.queryEnvelope(m),m}{const t=e.getCenterXY(),n=new i.Point(t),r=this.projectPoint(n,s),o=new i.Envelope({vd:e.getDescription()});if(r.isEmpty())o.setEmpty();else{e.copyTo(o);const t=r.getXY();o.setCoords(t.x,t.y,t.x,t.y)}return o}}transformInPlace(e,t,n,i){return s.geometryReleaseAssert(0),0}transformInPlaceZ(e,t,n,i,o,a){if(this.m_projTransform.isIdentity())return e!==i&&r.assignObjectArray(i,e,n),t!==o&&r.memcpy(o,t,0,0,n),n;const m=this.m_projTransform,h=m.getInputSR(),l=m.getOutputSR(),u=h.getCoordinateSystemType(),c=l.getCoordinateSystemType();if(0===u&&u===c)return sn(h,l).transformPoints2D(e,n,i),m.isVertical()&&s.geometryReleaseAssert(0),n;3===u&&s.throwNotImplementedException("image: transform_in_place_"),3===c&&s.throwNotImplementedException("image: transform_in_place_"),function(e,t,n,i,o){const a=i.getCoordinateSystemType();if(2===a){if(0===o)n!==e&&r.assignObjectArray(n,e,t),function(e,t,n){const i=e.getPCSHorizon();if(i.getGeometryType()===s.GeometryType.enumPolygon){const s=e.getDefaultPrecisionSR().getTolerance(0),r=i;for(let e=0;e<n;e++)1!==Qt(r,t[e],s)&&t[e].setNAN();return}if(i.getGeometryType()===s.GeometryType.enumEnvelope){const e=i;for(let s=0;s<n;s++)e.contains(t[s])||t[s].setNAN();return}s.throwInvalidArgumentException("")}(i,n,t);else if(n!==e&&r.assignObjectArray(n,e,t),i.isPannable()){const e=i.getTolerance(0);!function(e,t,s,n){for(let i=0;i<t;i++){if(e[i].y<s.ymin||e[i].y>s.ymax){e[i].setNAN();continue}const t=e[i].x;e[i].x=ci(t,s,n)}}(n,t,i.getPannableExtent(),e),li(n,t,i,0)}}else{s.geometryReleaseAssert(1===a);const r=i.getTolerance(0),o=i.getPannableExtent();for(let s=0;s<t;s++)n[s].assign(Ei(e[s],o,r))}}(e,n,i,h,this.m_inputPCSHorizonClipOption),o!==t&&r.memcpy(o,t,0,0,n),2===u&&Ni(h,0,i,n),Hi(this.m_projTransform,i,o,n,!1);let g=0;const d=2===c;if(d?g=l.getCentralMeridian():Number.isNaN(this.m_centralMeridianOfOutputGCS)||(g=this.m_centralMeridianOfOutputGCS),d&&0!==this.m_outputPCSHorizonClipOption||li(i,n,l.getGCS(),g),d){if(!mi(i,n,l,this.m_outputPCSHorizonClipOption))for(let e=0;e<n;++e)i[e].setNAN();Ci(l,i,n,!1)}let p=n;for(let e=0;e<n;++e)i[e].isNAN()&&(o&&(o[e]=Number.NaN),p--);return p}}function tn(e){if(2!==e.getCoordinateSystemType())return 0;let t=0;const s=e.getPCSInfo(),n=s.getNorthPoleLocation(),i=s.getSouthPoleLocation(),r=s.getNorthPoleGeometry(),o=s.getSouthPoleGeometry();return r===lo.PE_POLE_POINT&&n!==lo.PE_POLE_OUTSIDE_BOUNDARY&&(t=1),o===lo.PE_POLE_POINT&&i!==lo.PE_POLE_OUTSIDE_BOUNDARY&&(t|=2),t}function sn(e,t){const s=e.getHorzUnitFactor(),n=t.getHorzUnitFactor();let i=1,r=1;const o=20015077/180;1===e.getUnit().getUnitType()&&(i=o),1===t.getUnit().getUnitType()&&(r=o);const m=s/n*(i!==r?i/r:1),h=new a.Transformation2D;return h.setScaleCoords(m,m),h}let nn=class{getOperatorType(){return 10300}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s){return!t||t.isIdentity()?e:new rn(e,t,s)}execute(e,t,s){return t.isIdentity()?e:Zs(e,t,s)}transform(e,t,s,n,i=!0){return i?function(e,t,s,n){e.m_projector.transformInPlaceZ(t,null,s,n,null,null);const i=n.slice(0,s).filter(e=>!e.isNAN());for(let e=0,t=i.length;e<t;++e)n[e].assign(i[e]);return i.length}(e,t,s,n):Qs(e,t,s,n,null)}transform3D(e,t,n,i,r=!0){return s.geometryReleaseAssert(0),0}foldInto360Range(e,t){return $s(e,t,null)}foldInto360RangeGeodetic(e,t,s){return Ks(e,t,s,null)}normalizeGeometryEx(e,t,o,m,h=0){return function(e,t,o,m,h){if(!t.isPannable()||e.isEmpty())return e;const l=e.getGeometryType();l===s.GeometryType.enumGeometryCollection&&s.throwNotImplementedException("not yet impl for geometry collection");const u=t.getPannableExtent();Number.isNaN(o)&&(o=u.getCenterX());const c=u.width(),g=.5*c,d=h>0,p=e.queryInterval(0,0);if(!d&&p.width()<g||!s.isMultiVertex(e.getGeometryType())){const t=p.getCenter();if(Math.abs(t-o)<=g)return e;{const s=new a.Transformation2D,n=o-t,i=r.round(n/c)*c;s.setShiftCoords(i,0);const m=e.clone();return m.applyTransformation(s),m}}if(l===s.GeometryType.enumPolygon){let s=new n.Polyline({vd:e.getDescription()});s.addAndExplicitlyOpenAllPaths(e,!1),d&&(s=on(s,t,2,h,Number.NaN,null,!0));const a=[];if(!m){{let o=e;d&&(o=new n.Polygon,o.add(s,!1));const m=function(e,t,s){const n=Sr();t.querySpheroidData(n);const o=t.getGCS()!==t?t.getSRToGCSTransform():null,a=r.makeObjectArray(r.Point2D,100),m=new i.Point3D(0,0,0),h=e.getPointCount(),l=t.getGCS().getUnit().getUnitToBaseFactor();for(let t=0,s=h;t<s;){const i=Math.min(100,s-t);e.queryCoordinates(a,i,t,t+i),o&&(new nn).transform(o,a,i,a,!1);for(let e=0;e<i;e++){if(a[e].isNAN())continue;a[e].scale(l);const t=E(n.majorSemiAxis,n.e2,a[e]);m.addThis(t)}t+=i}const u=D(n.majorSemiAxis,n.e2,m);u.scale(1/l);const c=e;if(!new An(t.getGCS(),u).project(c))return 0;s.length=e.getPathCount();const g=c.calculateArea2D()<0;for(let t=0,n=e.getPathCount();t<n;t++){const e=c.calculateRingArea2D(t),n=g?e<0:e>0;s[t]=n}return g?-1:1}(e,t,a);if(m)m<0&&s.reverseAllPaths();else{const e=o.getPathCount();for(let t=0;t<e;t++)a.push(o.calculateRingArea2D(t)>0)}}m=a}return new Fn(null,m,s,null,t,o,3,0,null).geoNormalizePolygonGeometry(!0)}if(l===s.GeometryType.enumPolyline){let s=new n.Polyline({vd:e.getDescription()});return s.addAndExplicitlyOpenAllPaths(e,!1),d&&(s=on(s,t,2,h,Number.NaN,null,!0)),new Fn(null,null,s,null,t,o,3,0,null).geoNormalizePolylineGeometry(!0)}if(l===s.GeometryType.enumMultiPoint){const t=e,s=t.getAttributeStreamRef(0);let n,i=null,a=o,m=0;const h=.1*c;for(let o=0,l=t.getPointCount();o<l;o++){const t=s.read(2*o);let l=t-a;if(Math.abs(l)>g&&(l=r.round(l/c)*c,m-=l,Math.abs(m)<h&&(m=0)),0!==m){i||(n=e.clone(),i=n.getAttributeStreamRef(0));const s=t+m;i.write(2*o,s)}a=t}return i?(n.notifyModified(),n):e}s.throwInternalErrorException("")}(e,t,o,m,h)}normalizeGeometry(e,t,n){return function(e,t,n){if(!t.isPannable()||e.isEmpty())return e;const i=t.getPannableExtent().width(),o=.5*i,m=e.queryInterval(0,0);if(m.width()<o||!s.isMultiVertex(e.getGeometryType())){if(Number.isNaN(n))return e;const t=m.getCenter();if(Math.abs(t-n)<=o)return e;{const s=new a.Transformation2D,o=n-t,m=r.round(o/i)*i;s.setShiftCoords(m,0);const h=e.clone();return h.applyTransformation(s),h}}const h=e.getGeometryType(),l=e,u=l.getAttributeStreamRef(0),c=e.clone(),g=c.getAttributeStreamRef(0);let d=0,p=0,_=0,f=s.isMultiPath(h)?0:-1;const y=r.Envelope1D.constructEmpty();let x=!1;for(let e=0,t=l.getPointCount();e<t;e++){const t=u.read(2*e);e===p&&(s.isMultiPath(h)?(0===f&&Number.isNaN(n)&&(x=!0),f>0&&Number.isNaN(n)&&(n=y.getCenter(),x=!1),p=l.getPathEnd(f),f++):p=l.getPointCount(),Number.isNaN(n)?_=t:(_=n,d=0));let a=t-_;Math.abs(a)>o&&(a=r.round(a/i)*i,d-=a,Math.abs(d)<.1*i&&(d=0));const m=t+d;g.write(2*e,m),x&&y.mergeCoordinate(m),_=t}return c.notifyModified(),c}(e,t,n)}clipToSpatialReference(e,n,i,r=0){return function(e,n,i,r){const o=n.getCoordinateSystemType();if(0===o){const t=new Zr;return n.queryPrecisionDescriptor(t),Js(e,t,n,i)}let a=e;2!==r&&3!==r||!n.isPannable()||(a=$s(a,n,i));const h=new Zr;if(n.queryPrecisionDescriptor(h),a=Js(a,h,n,i),0===r||a.isEmpty())return a;if(1===o){if(1===r){const e=new t.Envelope2D;a.queryLooseEnvelope(e);const s=n.getPannableExtent(),r=.01*s.width();return s.xmin=e.xmin-r,s.xmax=e.xmax+r,(new m.OperatorClip).execute(a,s,n,i)}return a}if(2===o){const e=n.getPCSHorizon();if(1===r||2===r){const t=(new Ws).execute(a,e,n,i);return t===e?t.clone():t}return a}if(3===o)return a;s.throwInternalErrorException("missing implementation")}(e,n,i,r)}};class rn extends l.GeometryCursor{constructor(e,t,n){super(),this.m_projTrans=t,this.m_progressTracker=n,this.m_index=-1,e||s.throwInvalidArgumentException(""),this.m_inputGeoms=e}next(){const e=this.m_inputGeoms.next();return null!=e?(s.throwIfCurves(e),s.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID(),Zs(e,this.m_projTrans,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}function on(e,t,i,r,o,a,m=!1){e||s.throwInvalidArgumentException("Geometry.Geodetic_densify.densify");let h=e.getGeometryType();if(s.throwIfMesh(e),e.isEmpty()||s.isPoint(h))return e;const l=new un;l.m_sr=t,l.m_gcs=t.getGCS(),l.m_transform=l.m_gcs!==t?t.getSRToGCSTransform():null,l.m_progressTracker=a;const u=Sr();let c,g,d;if(l.m_gcs.querySpheroidData(u),l.m_a=u.majorSemiAxis,l.m_eSquared=u.e2,l.m_rpu=l.m_gcs.getUnit().getUnitToBaseFactor(),l.m_gcsTolerance=l.m_gcs.getTolerance(0),l.m_radTolerance=l.m_gcsTolerance*l.m_rpu,l.m_maxLength=r,l.m_maxDeviation=o,l.m_curveType=i,h===s.GeometryType.enumEnvelope){const t=new n.Polygon({vd:e.getDescription()});t.addEnvelope(e,!1),c=t,h=s.GeometryType.enumPolygon}else if(s.isSegment(h)){const t=new n.Polyline({vd:e.getDescription()});t.addSegment(e,!0),c=t,h=s.GeometryType.enumPolyline}else c=e;if(4!==l.m_curveType){if(s.geometryReleaseAssert(s.isMultiPath(h)),g=l.replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(c),g.isEmpty())return g;g=an(l.m_rpu,g);let e=l.geodeticDensify(g);m||(e=(new nn).foldInto360RangeGeodetic(e,l.m_gcs,l.m_curveType)),d=l.m_transform&&!l.m_transform.isIdentity()?(new nn).execute(e,l.m_transform.getInverse(),a):e}else{let e;if(s.geometryReleaseAssert(s.isMultiPath(h)),t.isPannable())e=_i(c,t);else{const s=t.getPCSHorizon();e=(new Ws).execute(c,s,t,a),e===s&&(e=s.clone())}if(g=e,g.isEmpty())return g;d=l.shapePreservingDensify(g)}return d}function an(e,s){const n=new t.Envelope2D;if(s.queryLooseEnvelope(n),n.width()*e<Math.PI)return s;let o=!1;const a=s.querySegmentIterator(),m=new r.Point2D,h=new r.Point2D;for(;a.nextPath();)for(;a.hasNextSegment();){const t=a.nextSegment();if(m.setCoordsPoint2D(t.getStartXY()),h.setCoordsPoint2D(t.getEndXY()),m.scale(e),h.scale(e),Math.abs(m.x-h.x)>Math.PI){if(!mn(m,h)){o=!0;break}if(Math.abs(m.x-h.x)>2*Math.PI){o=!0;break}}}if(!o)return s;const l=s.createInstance();l.reserve(s.getPointCount());const u=s.getDescription().getAttributeCount()>1,c=new r.Point2D,g=new r.Point2D,d=new r.Point2D(0,0),p=new r.Point2D(0,0),_=new i.Point;for(a.resetToFirstPath();a.nextPath();){let t=Number.NaN,s=0;for(;a.hasNextSegment();){const n=a.nextSegment();if(m.setCoordsPoint2D(n.getStartXY()),h.setCoordsPoint2D(n.getEndXY()),m.scale(e),h.scale(e),Number.isNaN(t)?(s=Cn(m.x,Number.NaN,s),d.setCoordsPoint2D(m)):d.setCoordsPoint2D(p),t=d.x,mn(m,h)){if(h.x-m.x>2*Math.PI)for(;h.x-m.x>2*Math.PI;)h.x-=2*Math.PI;else if(h.x-m.x<2*-Math.PI)for(;h.x-m.x<2*-Math.PI;)h.x+=2*Math.PI;s=Cn(h.x,Number.NaN,s),p.setCoordsPoint2D(h)}else c.setCoordsPoint2D(h),wn(c),s=Cn(c.x,t,s),p.setCoords(s+c.x,c.y);if(Math.abs(p.x-h.x)<.5&&p.setCoordsPoint2D(h),u)n.queryCoord(0,_),g.setCoordsPoint2D(d),g.scale(1/e),_.setXY(g),a.isFirstSegmentInPath()?l.startPathPoint(_):l.lineToPoint(_),a.isLastSegmentInPath()&&!a.isPathClosed()&&(n.queryCoord(1,_),g.setCoordsPoint2D(p),g.scale(1/e),_.setXY(g),l.lineToPoint(_));else{a.isFirstSegmentInPath()&&l.insertPath2D(-1,null,0,0,!0);const t=l.getPathCount()-1;g.setCoordsPoint2D(d),g.scale(1/e),l.insertPoint2D(t,-1,g),a.isLastSegmentInPath()&&!a.isPathClosed()&&(g.setCoordsPoint2D(p),g.scale(1/e),l.insertPoint2D(t,-1,g))}}}return l}function mn(e,t){return!(!ao(e.y,r.geometryHalfPi)||!ao(t.y,r.geometryHalfPi))||!(!ao(e.y,-r.geometryHalfPi)||!ao(t.y,-r.geometryHalfPi))}function hn(e,t){return!(!ao(e.y,r.geometryHalfPi)||ao(t.y,r.geometryHalfPi))||!(!ao(e.y,-r.geometryHalfPi)||ao(t.y,-r.geometryHalfPi))}function ln(e,t){return!(!ao(t.y,r.geometryHalfPi)||ao(e.y,r.geometryHalfPi))||!(!ao(t.y,-r.geometryHalfPi)||ao(e.y,-r.geometryHalfPi))}class un{constructor(){this.m_sr=null,this.m_gcs=null,this.m_transform=null,this.m_progressTracker=null,this.m_a=0,this.m_eSquared=0,this.m_rpu=0,this.m_gcsTolerance=0,this.m_radTolerance=0,this.m_maxLength=0,this.m_maxDeviation=0,this.m_curveType=0}geodeticDensify(e){const t=e.createInstance(),s=e.querySegmentIterator(),i=[],o=[],a=new n.SegmentBuffer,m=e.getDescription().getAttributeCount()>1;for(;s.nextPath();){const e=[0];for(;s.hasNextSegment();){const n=s.nextSegment(),h=n.getStartXY(),l=n.getEndXY();h.scale(this.m_rpu),l.scale(this.m_rpu);const u=new r.Point2D,c=new r.Point2D,g=h.compare(l)>0;En(g,h,l,u,c),i.length=0,o.length=0,this.m_maxLength>0?dn(this.m_a,this.m_eSquared,this.m_curveType,u,c,this.m_maxLength,this.m_maxDeviation,this.m_radTolerance,null,null,m?o:null,i,e):pn(),g&&Pn(null,null,m?o:null,i),i[0].setCoordsPoint2D(n.getStartXY()),i.at(-1).setCoordsPoint2D(n.getEndXY());const d=1/this.m_rpu;for(let e=1,t=i.length-1;e<t;e++)i[e].scale(d);if(m){const e=vn(g,n,a);gn(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),n,e,o,i,t)}else cn(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),i,t)}}return t}shapePreservingDensify(e){const t=e.createInstance(),s=e.querySegmentIterator(),i=[],r=[],o=new n.SegmentBuffer,a=e.getDescription().getAttributeCount()>1;for(;s.nextPath();)for(;s.hasNextSegment();){const e=s.nextSegment(),n=e.getStartXY(),m=e.getEndXY(),h=n.compare(m)>0,l=vn(h,e,o);i.length=0,r.length=0,xn(this.m_a,this.m_eSquared,this.m_rpu,l,this.m_sr,this.m_maxLength,this.m_maxDeviation,a?r:null,i),h&&Pn(null,null,a?r:null,i),a?gn(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),e,l,r,i,t):cn(s.isFirstSegmentInPath(),s.isLastSegmentInPath()&&!s.isPathClosed(),i,t)}return t}replaceCurvesWithLinesAndProjectToGCSAsMultiPoint_(e){const t=e.hasNonLinearSegments();if((!this.m_transform||this.m_transform.isIdentity())&&(e=_i(e,this.m_gcs),!t))return e;const s=e.createInstance();s.reserveParts(e.getPointCount(),e.getPathCount());for(let t=0,r=e.getPathCount();t<r;++t){let r=new n.MultiPoint;const o=e.getPathStart(t),a=e.getPathEnd(t);r.addPoints(e,o,a);const m=e.isClosedPath(t);let h=!1;if(m&&a-o===1&&e.hasNonLinearSegmentsPath(t)){const t=new i.Point;e.getPointByVal(o,t),r.add(t),h=!0}if(this.m_transform&&!this.m_transform.isIdentity()){if(m&&!h){const t=new i.Point;e.getPointByVal(o,t),r.add(t)}if(r=(new nn).execute(r,this.m_transform,this.m_progressTracker),m&&r.getPointCount()>1){const e=r.getXY(0),t=r.getXY(r.getPointCount()-1);e.equals(t)&&r.removePoint(r.getPointCount()-1)}}r.getPointCount()>1&&(s.addPathMultiPoint(r,0,-1,!0),m&&s.closePathWithLine())}return s}}function cn(e,t,s,n){e&&n.insertPath2D(-1,null,0,0,!0);const i=n.getPathCount()-1;n.insertPointsFromPoints(i,-1,s,0,s.length-1,!0),t&&n.insertPoint2D(i,-1,s.at(-1))}function gn(e,t,s,n,r,o,a){a.reserve(a.getPointCount()+o.length-1);const m=new i.Point;if(s.queryStart(m),e?a.startPathPoint(m):a.lineToPoint(m),o.length>2){const e=n.calculateLength2D();for(let t=1;t<o.length-1;t++){const s=n.lengthToT(r[t]*e);n.queryCoord(s,m),m.setXY(o[t]),a.lineToPoint(m)}}t&&(s.queryEnd(m),a.lineToPoint(m))}function dn(t,s,n,i,a,m,h,l,u,c,g,d,p){const _={stack:[],error:void 0,hasError:!1};try{const f=o.__addDisposableResource(_,new e.PeDoubleClass,!1),y=o.__addDisposableResource(_,new e.PeDoubleClass,!1),x=o.__addDisposableResource(_,new e.PeDoubleClass,!1);e.peLineType.geodeticDistance(t,s,i.x,i.y,a.x,a.y,x,f,y,n);const P=x.val,E=f.val,v=y.val;let C=E,D=v;C<0&&(C+=2*Math.PI),D<0&&(D+=2*Math.PI),u&&(u[0]=C),c&&(c[0]=D);let b=Number.NaN,S=Number.NaN;if(null!==g){const n=e.peMath.q90(t,s),r=e.peMath.q(t,s,i.y);b=(n-r)/P,S=(n+r)/P}const I=hn(i,a),w=ln(i,a),T=I||w,A=function(e,t,s){return!(!In(e,t,s)||ao(e.y,r.geometryHalfPi)||ao(e.y,-r.geometryHalfPi)||ao(t.y,r.geometryHalfPi)||ao(t.y,-r.geometryHalfPi))}(i,a,l),N=o.__addDisposableResource(_,new r.SimpleDisposableArray(new e.PeDoubleClass,new e.PeDoubleClass),!1),G=new r.Point2D,M=new r.Point2D,R=new r.Point2D;p[0]=Cn(i.x,Number.NaN,p[0]);let k=p[0];if(P<=m)return d.push(i.clone()),p[0]=Cn(a.x,Number.NaN,p[0]),null!=g&&g.push(0),T?(I&&Dn(i,a,g,d),w&&bn(i,a,g,d)):A?Sn(i,a,E,b,S,g,d):h>0&&(M.setCoords(i.x-k,i.y),G.setCoords(a.x-p[0],a.y),k=_n()),d.push(a.clone()),P;const F=1+Math.ceil(P/m),q=P/(F-1),V=new r.Point2D;d.push(i.clone()),V.setCoordsPoint2D(i),M.setCoords(i.x-p[0],i.y),null!==g&&g.push(0);for(let r=1;r<F;r++){let o;if(r<F-1){const a=r*q;e.peLineType.geodeticCoordinate(t,s,i.x,i.y,a,E,N.at(0),N.at(1),n),G.setCoords(N.at(0).val,N.at(1).val),p[0]=Cn(G.x,V.x,p[0]),R.setCoords(p[0]+G.x,G.y),o=r/(F-1)}else p[0]=Cn(a.x,Number.NaN,p[0]),G.setCoords(a.x-p[0],a.y),R.setCoordsPoint2D(a),o=1;T?(1===r&&I&&Dn(i,R,g,d),r===F-1&&w&&bn(V,a,g,d)):A?In(V,R,l)&&(i.x<a.x?V.x>R.x&&(p[0]+=2*Math.PI,R.setCoords(p[0]+G.x,G.y)):V.x<R.x&&(p[0]-=2*Math.PI,R.setCoords(p[0]+G.x,G.y)),Sn(V,R,E,b,S,g,d)):h>0&&_n(),d.push(R.clone()),null!=g&&g.push(o),V.setCoordsPoint2D(R),M.setCoordsPoint2D(G),k=p[0]}return P}catch(e){_.error=e,_.hasError=!0}finally{o.__disposeResources(_)}}function pn(e,t,n,i,r,o,a,m,h,l){s.geometryReleaseAssert(0)}function _n(e,t,n,i,r,o,a,m,h,l,u,c,g,d,p){return s.geometryReleaseAssert(0),0}function fn(e,t,s,n){const r=E(e,t,s),o=E(e,t,n);return i.Point3D.distance(r,o)}function yn(t,n,o,a,m,h,l,u){const c=new Array,g=r.makeObjectArray(Array,8);let d=2,p=m.getCoord2D(h);g[0][0]=p.x,g[0][1]=p.y,p=m.getCoord2D(l),g[1][0]=p.x,g[1][1]=p.y;const _=t=>{if(null!==o){const n=e.peCSTransformations.projToGeog(o,t,g);s.geometryReleaseAssert(n===t)}for(const e of g)e[0]*=a,e[1]*=a};_(2),c.push(E(t,n,new r.Point2D(g[0][0],g[0][1]))),c.push(E(t,n,new r.Point2D(g[1][0],g[1][1])));let f=i.Point3D.distance(c[0],c[1]);if(f>u)return f;let y=0;for(d=3;d<=17;){const e=1/(d-1);let o=0;for(let t=1;t<d;++t)if(1&t){const s=r.lerp(h,l,t*e);m.queryCoord2D(s,p),g[o][0]=p.x,g[o][1]=p.y,o++}_(o);let a=1;for(let e=0;e<o;++e)c.splice(a,0,E(t,n,new r.Point2D(g[e][0],g[e][1]))),a++;a=0;let x=c[a];a++;let P=0;for(;a!==c.length;++a){const e=c[a];P+=i.Point3D.distance(x,e),x=e}if(P>u)return P;if(y=P-f,s.geometryReleaseAssert(y>=0||Math.abs(y)<1e-14*P),y<0&&(y=0),f=P,P+y<=u)return P+y;d=2*d-1}return f+y}function xn(t,n,i,o,a,m,h,l,u){const c=o.isCurve(),g=function(e,t){return e*Math.sqrt(1-t)}(t,n)*Math.PI*179/180;let d=m;m>0&&!(m>g)||(d=g);const p=h,_=p>0;let f=Number.NaN;_&&(f=function(e,t,s){const n=s/(2*G(e,t)),i=n*n;return s*(1-i*(.16666666666666666-.008333333333333333*i))}(t,n,p));const y=1===a.getCoordinateSystemType();let x=null;y||(x=a.getPECoordSys());const P=a.getTolerance(0),v=o.getStartXY(),C=o.getEndXY(),D=new r.Point2D,b=new r.Point2D;if(y)D.setCoordsPoint2D(v),D.scale(i),b.setCoordsPoint2D(C),b.scale(i);else{const t=[v.x,v.y,C.x,C.y];e.peCSTransformations.projToGeog(x,2,t),D.setCoords(t[0],t[1]),D.scale(i),b.setCoords(t[2],t[3]),b.scale(i)}let I=0,T=0;const A=[],N=[],M=[];A.push(C.clone()),N.push(b.clone()),M.push(1),u.push(v.clone()),null!==l&&l.push(T);const R=a.isPannable(),k=v.clone(),F=[.5,.33333333333333337,.6666666666666666,.16666666666666669,.8333333333333333];let q=5;c||(_?(F[0]=.5,F[1]=.25,F[2]=.75,q=3):q=1),s.geometryReleaseAssert(d>0);const V=t=>{if(t=t.clone(),null!==x){const s=[t.x,t.y];e.peCSTransformations.projToGeog(x,1,s),t.setCoords(s[0],s[1])}return t.scale(i),t};for(;N.length>0;){const e=A.at(-1).clone();b.assign(N.at(-1));const m=M.at(-1);let h=!1,g=Number.NaN;const p=yn(t,n,x,i,o,T,m,d);let v=d>=p&&Math.abs(D.y-b.y)<.9*Math.PI;y&&v&&(v=Math.abs(D.x-b.x)<.9*Math.PI);const C=new r.Point2D,G=new r.Point2D;let H=!1;if(!_&&v&&v&&(H=!0),o.calculateSubLength(T,m)<=P&&(H=!0),!H)for(let l=0;l<q;l++){const u=r.lerp(T,m,F[l]),d=new r.Point2D;o.queryCoord2D(u,d);const p=V(d);if(0===l&&(g=u,C.setCoordsPoint2D(d),G.setCoordsPoint2D(p),!v)){h=!0;break}if(s.geometryReleaseAssert(_),y&&Math.abs(D.x-p.x)>=Math.PI){h=!0;break}let x=new r.Point2D,P=new r.Point2D;c?(x=r.Point2D.lerp(k,e,F[l]),P=V(x)):(x=d.clone(),P=p.clone());const I=S(t,n,D,b,F[l]),A=I.clone();if(y?(A.x/=i,A.y/=i):(A.x/=i,A.y/=i,Qs(a.getGCSToSRTransform(),[A],1,[A],null)),A.isNAN()){const e=E(t,n,p),s=E(t,n,D),i=E(t,n,b),{second:r}=w(t,n,e,s,i,2,null);if(r>f){h=!0;break}}else{if(R){const e=a.getPannableExtent().width(),t=r.lerp(o.getStartX(),o.getEndX(),.5);for(;A.x<t-.5*e;)A.x+=e;for(;A.x>=t+.5*e;)A.x-=e}const e=o.getClosestCoordinateOnInterval(A,new r.Envelope1D(T,m),-1);let s=o.getCoord2D(e);s=V(s);let i=fn(t,n,s,I);if(i>f){if(i<4*f){const e=E(t,n,s),r=E(t,n,D),o=E(t,n,b),{second:a}=w(t,n,e,r,o,2,null);i=a}if(i>f){h=!0;break}}else if(c){let e=E(t,n,p);const s=E(t,n,D),i=E(t,n,b);let{second:r}=w(t,n,e,s,i,3,null);if(r<=f){e=E(t,n,P);const{second:o}=w(t,n,e,s,i,3,null);r=o}if(r>f){h=!0;break}}}}h?(A.push(C.clone()),N.push(G.clone()),M.push(g)):(A.pop(),N.pop(),M.pop(),u.push(e.clone()),I+=p,null!==l&&l.push(I),k.setCoordsPoint2D(e),D.setCoordsPoint2D(b),T=m)}if(null!==l){const e=1/I;for(let t=0;t<l.length;t++)l[t]*=e}}function Pn(e,t,s,n){if(n.reverse(),null!==s&&s.reverse(),e){const s=e[0],n=t[0];e[0]=n,t[0]=s}}function En(e,t,s,n,i){e?(n.setCoordsPoint2D(s),i.setCoordsPoint2D(t)):(n.setCoordsPoint2D(t),i.setCoordsPoint2D(s))}function vn(e,t,s){return e?(s.create(t.getGeometryType()),t.copyTo(s.get()),s.get().reverse(),s.get()):t}function Cn(e,t,s){if(Number.isNaN(t)){for(;s-e>Math.PI;)s-=2*Math.PI;for(;e-s>Math.PI;)s+=2*Math.PI;return s}return s+e-t>Math.PI?s-=2*Math.PI:t-(s+e)>Math.PI&&(s+=2*Math.PI),s}function Dn(e,t,s,n){if(e.y>0){const i=new r.Point2D;i.setCoords(t.x,r.geometryHalfPi),ao(e.x,i.x)||ao(t.y,i.y)||(n.push(i),null!==s&&s.push(0))}else{const i=new r.Point2D;i.setCoords(t.x,-r.geometryHalfPi),ao(e.x,i.x)||ao(t.y,i.y)||(n.push(i),null!==s&&s.push(0))}}function bn(e,t,s,n){if(t.y>0){const i=new r.Point2D;i.setCoords(e.x,r.geometryHalfPi),ao(t.x,i.x)||ao(e.y,i.y)||(n.push(i),null!==s&&s.push(1))}else{const i=new r.Point2D;i.setCoords(e.x,-r.geometryHalfPi),ao(t.x,i.x)||ao(e.y,i.y)||(n.push(i),null!==s&&s.push(1))}}function Sn(e,t,s,n,i,o,a){if(h=oo,0===(m=s)||Math.abs(m)<=h){if(r.geometryHalfPi-e.y>0){const t=new r.Point2D;t.setCoords(e.x,r.geometryHalfPi),a.push(t),null!==o&&o.push(n)}if(r.geometryHalfPi-t.y>0){const e=new r.Point2D;e.setCoords(t.x,r.geometryHalfPi),a.push(e),null!==o&&o.push(n)}}else{if(r.geometryHalfPi+e.y>0){const t=new r.Point2D;t.setCoords(e.x,-r.geometryHalfPi),a.push(t),null!==o&&o.push(i)}if(r.geometryHalfPi+t.y>0){const e=new r.Point2D;e.setCoords(t.x,-r.geometryHalfPi),a.push(e),null!==o&&o.push(i)}}var m,h}function In(e,t,s){return Math.abs(Math.abs(e.x-t.x)-Math.PI)<=s}function wn(e){if(e.x<-Math.PI)for(;e.x<-Math.PI;)e.x+=2*Math.PI;else if(e.x>Math.PI)for(;e.x>Math.PI;)e.x-=2*Math.PI}function Tn(e,s,n,r,o){const h=new t.Envelope2D;n.queryEnvelope(h);const l=i.calculateToleranceFromGeometryForOpFromGeom(null,n,!0).total();if(s.xmin-h.xmin<=l&&h.xmax-s.xmax<=l)return n;const u=s.width();let c=0;for(;s.xmin+c*u<h.xmin;)c++;for(;s.xmin+c*u>h.xmin;)c--;const g=c*u,d=new a.Transformation2D;d.setShiftCoords(-g,0);const p=n;p.applyTransformation(d);const _=new t.Envelope2D;p.queryEnvelope(_);let f=null;if(_.xmax>s.xmax){let n=0;const r=new t.Envelope2D;r.setCoords({env2D:s}),r.ymin-=1,r.ymax+=1;let a=p;for(;r.xmin<_.xmax;){_.xmax>r.xmax&&(a=di(a,e,2,!0,r.xmax));const t=i.getMergedExtentEnv2D(a,r),h=i.calculateToleranceFromGeometryForOp(null,t,!0).total(),l=m.clip$1(a,r,h,Number.NaN,o);null===f?f=l===a?l.clone():l:(d.setShiftCoords(-n*u,0),l.applyTransformation(d),f.add(l,!1)),n++,r.xmin=r.xmax,r.xmax=s.xmax+n*u}}else f=p;return f}class An{constructor(e,t){this.m_basisX=new i.Point3D,this.m_basisY=new i.Point3D,this.m_normal=new i.Point3D,s.geometryReleaseAssert(1===e.getCoordinateSystemType()),this.m_gcs=e;const n=Sr();e.querySpheroidData(n),this.m_a=n.majorSemiAxis,this.m_e2=n.e2,this.m_rpu=e.getUnit().getUnitToBaseFactor(),this.m_curvCenterRad=t.mul(this.m_rpu);const o=this.m_curvCenterRad.x,a=this.m_curvCenterRad.y,m=Math.cos(o),h=Math.sin(o),l=Math.cos(a),u=Math.sin(a);this.m_cartCenter3D=function(e,t,s,n,i,r){return v(e,t,s,n,i,r,0)}(this.m_a,this.m_e2,m,h,l,u),this.m_normal.setCoordsPoint3D(this.m_cartCenter3D),this.m_d=this.m_cartCenter3D.length(),this.m_normal.divThis(this.m_d),i.Point3D.selectRightHandedBasisFromNormal(this.m_normal,this.m_basisX,this.m_basisY),this.m_northPolePcs=this.projectPoint(r.Point2D.construct(0,.5*Math.PI/this.m_rpu)),this.m_southPolePcs=this.projectPoint(r.Point2D.construct(0,.5*-Math.PI/this.m_rpu))}project(e){const t=e.getGeometryType();if(s.isMultiVertex(t)){s.throwIfCurves(e);const t=e;return this.projectMultiVertex(t)}s.throwInvalidArgumentException("Gnomonic.project")}unproject(e,o,a){const m=e.getGeometryType();if(s.isMultiVertex(m)){s.throwIfCurves(e);let h=e;const l=[];if(m===s.GeometryType.enumPolygon){const e=h.getPathCount();for(let t=0;t<e;t++){const e=h.calculateRingArea2D(t);l.push(e)}}return this.unprojectMultiVertex(o,h),s.isMultiPath(m)?(function(e,t,s){const n=e.getPannableExtent(),i=r.Point2D.construct(0,0);n.centerAt(i);const o=n.width(),a=.5*o,m=new r.Point2D;m.setNAN();let h=Number.NaN;for(let e=0;e<s.getPathCount();e++)for(let t=s.getPathStart(e);t<s.getPathEnd(e);t++){const i=s.getXY(t),r=ao(i.y,n.ymax)||ao(n.ymin,i.y);t===s.getPathStart(e)?(m.setNAN(),h=0):m.isNAN()||r||(h=Mn(i.x,m.x,a,o,h)),i.x+=h,s.setXYNoCurves(t,i),r||m.setCoordsPoint2D(i)}s.getImpl().notifyModifiedFlags(2001)}(this.m_gcs,0,h),function(e,o,a,m,h){const l=m.getGeometryType(),u=o.getPannableExtent();let c=m,g=!1,d=!1;if(l===s.GeometryType.enumPolygon){const s=new t.Envelope2D,a=r.Point2D.construct(0,0);s.setCoords({env2D:u}),s.centerAt(a),g=function(e,s,i,o,a){const m=function(e,s){const i=new t.Envelope2D;s.queryEnvelope(i);const o=ao(e.ymax,i.ymax),a=ao(e.ymin,i.ymin),m=o||a;return!!m&&(function(e,s){const i=new n.Polygon,o=new t.Envelope2D;for(let t=0;t<s.getPathCount();t++){s.queryPathEnvelope(t,o);let n=ao(e.ymax,o.ymax),a=ao(e.ymin,o.ymin);if(!n&&!a){i.addPath(s,t,!0);continue}i.insertPath2D(-1,null,0,0,!0);const m=s.getPathStart(t),h=s.getPathEnd(t),l=h-m;let u=-1;for(u=m;u<h;u++){const t=s.getXY(u);if(n=ao(e.ymax,t.y),a=ao(e.ymin,t.y),!n&&!a)break}let c=u,g=!1,d=Number.NaN;do{const o=s.getXY(c);n=ao(e.ymax,o.y),a=ao(e.ymin,o.y);const h=m+(c+1-m)%l;if(n||a){let n=r.Point2D.construct(d,o.y);i.insertPoint2D(t,-1,n);const a=s.getXY(h),m=ao(e.ymax,a.y),l=ao(e.ymin,a.y);m||l||(n=r.Point2D.construct(a.x,o.y),g?i.setXYNoCurves(i.getPointCount()-1,n):i.insertPoint2D(t,-1,n)),g=!0}else i.insertPoint2D(t,-1,o),d=o.x,g=!1;c=h}while(c!==u)}s.setEmpty(),s.add(i,!1)}(e,s),m)}(i,o),h=function(e,t,s,i,r){const o=[],a=[],m=.5*s.width();for(let n=0;n<i.getPathCount();n++){const h=i.getXY(i.getPathStart(n)),l=i.getXY(i.getPathEnd(n)-1),u=e[n]<0;if(Math.abs(h.x-l.x)>m){const e=Nn(u,t,s,n,i,r);o.push(e),a.push(n)}else if(!u&&i.calculateRingArea2D(n)<0){const e=Gn(t,s,n,i,r);o.push(e),a.push(n)}}if(0===o.length)return!1;const h=new n.Polygon({vd:i.getDescription()});let l=0,u=a[l];for(let e=0;e<i.getPathCount();e++)e===u?(h.add(o[l],!1),l++,l<a.length&&(u=a[l])):h.addPath(i,e,!0);return i.setEmpty(),i.add(h,!1),!0}(e,s,i,o,a);return m||h}(e,o,s,c,h);const m=function(e,s,n,r){const o=new t.Envelope2D;n.queryEnvelope(o);const a=i.calculateToleranceFromGeometryForOpFromGeom(null,n,!0).total();if(s.xmin-o.xmin<=a&&o.xmax-s.xmax<=a)return n;const m=n.createInstance();let h=n.createInstance();const l=new t.Envelope2D,u=n.getPathCount();for(let t=0;t<u;t++)n.queryPathEnvelope(t,l),s.xmin-l.xmin<=a&&l.xmax-s.xmax<=a?m.addPath(n,t,!0):(h.setEmpty(),h.addPath(n,t,!0),h=Tn(e,s,h,0,r),m.add(h,!0));return m}(o,s,c,h);m!==c&&(d=!0),c=m}else c=(new nn).foldInto360RangeGeodetic(c,o,2);l===s.GeometryType.enumPolygon&&(g||d)&&(c=(new Bs).execute(c,o,!1,h)),c!==m&&(m.setEmpty(),m.add(c,!1))}(l,this.m_gcs,0,h,a)):h=hi(h,this.m_gcs,0,!0,0,a),h}s.throwInvalidArgumentException("Gnomonic.unproject")}projectPoint(e){const t=e.mul(this.m_rpu),s=E(this.m_a,this.m_e2,t),n=this.m_normal.dotProduct(s);if(n<=0)return r.Point2D.construct(Number.NaN,Number.NaN);const i=this.m_d/n,o=s.mul(i).sub(this.m_cartCenter3D),a=new r.Point2D;return a.x=this.m_basisX.dotProduct(o),a.y=this.m_basisY.dotProduct(o),a}unprojectPoint(e){const t=this.m_cartCenter3D.add(this.m_basisX.mul(e.x).add(this.m_basisY.mul(e.y)));return D(this.m_a,this.m_e2,t).divide(this.m_rpu)}projectMultiVertex(e){const t=e.getImpl();let s=!0;const n=new r.Point2D,i=new r.Point2D;for(let e=0,r=t.getPointCount();e<r;e++)t.queryXY(e,n),n.y*this.m_rpu>.5*Math.PI?i.assign(this.m_northPolePcs):n.y*this.m_rpu<.5*-Math.PI?i.assign(this.m_southPolePcs):i.assign(this.projectPoint(n)),t.setXYNoCurves(e,i),i.isNAN()&&(s=!1);return t.notifyModifiedFlags(2001),s}unprojectMultiVertex(e,t){const s=t.getImpl(),n=e*e,i=!this.m_northPolePcs.isNAN(),o=!this.m_southPolePcs.isNAN();for(let e=0,t=s.getPointCount();e<t;e++){const t=s.getXY(e);let a=new r.Point2D;i&&r.Point2D.sqrDistance(t,this.m_northPolePcs)<=n?(a.setCoords(this.m_curvCenterRad.x,.5*Math.PI),a.scale(1/this.m_rpu)):o&&r.Point2D.sqrDistance(t,this.m_southPolePcs)<=n?(a.setCoords(this.m_curvCenterRad.x,.5*-Math.PI),a.scale(1/this.m_rpu)):a=this.unprojectPoint(t),s.setXYNoCurves(e,a)}s.notifyModifiedFlags(2001)}}function Nn(e,s,o,h,l,u){const c=new n.Polygon,g=new n.Polygon,d=new a.Transformation2D,p=l.getXY(l.getPathStart(h)),_=l.getXY(l.getPathEnd(h)-1),f=o.width(),y=.5*f,x=new t.Envelope2D;l.queryEnvelope(x);const P=Math.ceil(x.width()/f)+1;let E,v;p.x>_.x?(E=-f,v=e?o.ymin:o.ymax):(E=f,v=e?o.ymax:o.ymin),d.setShiftCoords(E,0),c.addPath(l,h,!0),g.add(c,!1);const C=new i.Point;for(let e=0;e<P;e++)g.applyTransformation(d),g.getPointByVal(0,C),c.lineToPoint(C),c.addSegmentsFromPath(g,0,0,g.getSegmentCount()-1,!1);const D=c.getXY(0),b=c.getXY(c.getPointCount()-1);D.y=v,b.y=v,c.lineTo(b);const S=new r.Point2D;for(S.setCoordsPoint2D(b),S.x-=.5*E;Math.abs(S.x-D.x)>y;)c.lineTo(S),S.x-=.5*E;c.lineTo(D);const I=o.getCenter().x,w=new t.Envelope2D;c.queryEnvelope(w);let T=0;const A=w.getCenter().x;A-I>y?T=-Math.ceil((A-I-y)/f):I-A>y&&(T=Math.ceil((I-A-y)/f)),0!==T&&(d.setShiftCoords(T*f,0),c.applyTransformation(d));const N=new n.EditShape,G=N.addGeometry(c);pi(N,G,s,0,2,!0,o.xmin),pi(N,G,s,0,2,!0,o.xmax);const M=N.getGeometry(G),R=i.getMergedExtentEnv2D(M,o);R.inflateCoords(0,1);const k=i.calculateToleranceFromGeometryForOp(null,R,!0);return m.clip$1(M,o,k.total(),Number.NaN,u)}function Gn(e,s,o,h,l){const u=s.width(),c=.5*u,g=s.getCenter().x,d=new t.Envelope2D;h.queryPathEnvelope(o,d);let p,_=0,f=d.getCenter().x;if(f-g>c?_=-Math.ceil((f-g-c)/u):g-f>c&&(_=Math.ceil((g-f-c)/u)),0!==_){const e=new a.Transformation2D;e.setShiftCoords(_*u,0),h.getImpl().applyTransformationToPath(e,o),h.queryPathEnvelope(o,d),f=d.getCenter().x}const y=new t.Envelope2D;s.containsExclusiveEnvelope(d)?(p=!1,y.setCoords({env2D:s})):(p=!0,y.setCoords({env2D:s}),y.xmin-=u,y.xmax+=u);let x=h.createInstance();x.addPathPoint2D(null,0,!0);const P=new r.Point2D;if(P.setCoords(y.xmin,y.ymin),x.insertPoint2D(0,-1,P),P.setCoords(y.xmin,y.ymax),x.insertPoint2D(0,-1,P),P.setCoords(.5*(y.xmin+y.xmax),y.ymax),x.insertPoint2D(0,-1,P),P.setCoords(y.xmax,y.ymax),x.insertPoint2D(0,-1,P),P.setCoords(y.xmax,y.ymin),x.insertPoint2D(0,-1,P),P.setCoords(.5*(y.xmin+y.xmax),y.ymin),x.insertPoint2D(0,-1,P),p){x.addPath(h,o,!0);const t=new a.Transformation2D;f<g?t.setShiftCoords(u,0):t.setShiftCoords(-u,0),h.getImpl().applyTransformationToPath(t,o),x.addPath(h,o,!0);const r=new n.EditShape,c=r.addGeometry(x);pi(r,c,e,0,2,!0,s.xmin),pi(r,c,e,0,2,!0,s.xmax),x=r.getGeometry(c);const d=i.getMergedExtentEnv2D(x,s);d.inflateCoords(0,1);const p=i.calculateToleranceFromGeometryForOp(null,d,!0).total();x=m.clip$1(x,s,p,Number.NaN,l)}else x.addPath(h,o,!0);return x}function Mn(e,t,s,n,i){return i+e-t>s?i-=n:t-(i+e)>s&&(i+=n),i}function Rn(e,t,s,o,a,m){const h=t.getAttributeStreamRef(0),l=t.getPointCount();let u=!1;const c=new r.Point2D;for(let e=0;e<l;++e){if(h.queryPoint2D(2*e,c),1&m&&c.y>=s){u=!0;break}if(2&m&&c.y<=-s){u=!0;break}}if(!u)return!1;let g=!1;e&&(g=t.getImpl().isClosedPathInXYPlane(0));const d=new n.EditShape,p=d.addGeometry(t),_=d.getFirstPath(p);let f=-1,y=!0;const x=new r.Point2D,P=new i.Point;let E=n.nullHandle;const v=kn*a/360;for(let e=d.getFirstVertex(_);e!==n.nullHandle;e=d.getNextVertex(e)){d.queryXY(e,c);let t=1&m&&c.y>=s?1:0;if(t|=2&m&&c.y<=-s?2:0,f>0&&f!==t){if(x.x!==c.x){const t=d.getPrevVertex(e);d.queryPoint(t,P);const s=d.insertVertex(_,e,P);x.x=c.x,d.setXY(s,x)}if(g){let t=E!==n.nullHandle?d.getNextVertex(E):d.getFirstVertex(_);const s=d.getPrevVertex(e);for(;t!==s;)t=d.removeVertex(t,!1);if(E!==n.nullHandle){const e=d.getXY(E),t=d.getXY(s);if(Math.abs(e.x-t.x)>v){d.queryPoint(E,P);const n=d.insertVertex(_,s,P);e.x=r.lerp(e.x,t.x,.5),d.setXY(n,e)}}}E=n.nullHandle}if(t&&(c.y=r.copySign(o,c.y),d.setXY(e,c),!y&&f!==t))if(c.x!==x.x){d.queryPoint(e,P);const t=d.insertVertex(_,e,P);d.setXYCoords(t,x.x,c.y),E=t}else E=e;f=t,x.assign(c),y=!1}if(g){if(E!==n.nullHandle){let e=d.getNextVertex(E);for(;e!==n.nullHandle;)e=d.removeVertex(e,!1)}const e=d.getFirstVertex(_);let t=d.getLastVertex(_);const s=d.getXY(e),i=d.getXY(t);if(!s.equals(i)&&(d.queryPoint(e,P),t=d.insertVertex(_,n.nullHandle,P),Math.abs(s.x-i.x)>v)){const e=d.insertVertex(_,t,P);s.x=r.lerp(s.x,i.x,.5),d.setXY(e,s)}}return t.assignCopy(d.getGeometry(p)),!0}const kn=210;class Fn{constructor(e,t,n,i,r,o,a,m,h){this.m_bAdjustedAtPoles=0,this.m_inputPoly=n,this.m_progressTracker=h,this.m_originalGeometry=e,this.m_originalSR=i,this.m_polygonRingFlags=t,this.m_pannableSR=r,this.m_poleSnappingTolerance=m,this.m_poleFlags=a,this.m_bAdjustedAtPoles=0,this.m_pannableExtent=function(e,t){const s=e.getPannableExtent();return Number.isNaN(t)||s.centerAtCoords(t,0),s}(this.m_pannableSR,o),this.m_centralLongitude=Number.isNaN(o)?this.m_pannableExtent.getCenterX():o,this.m_width360=this.m_pannableExtent.width(),this.m_degree=this.m_width360/360,this.m_GCSLargeDelta=kn*this.m_degree,s.geometryReleaseAssert(null===this.m_originalGeometry&&null===this.m_originalSR||null!==this.m_originalGeometry&&null!==this.m_originalSR)}geonormalizeRing(e,t,o,a,m,h,l){let u=o;const c=new n.Polyline({vd:this.m_inputPoly.getDescription()});c.addPath(this.m_inputPoly,e,!0),0!==this.m_poleFlags&&(this.m_bAdjustedAtPoles|=Rn(!0,c,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,this.m_pannableExtent.width(),this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(u=!1));let g=-1;u&&(g=this.m_originalGeometry.getPathStart(e));const d=c.getAttributeStreamRef(0),p=c.getPointCount();let _=0,f=d.read(0),y=0;const x=3*this.m_pannableSR.getTolerance(0);let P=!1;const E=new r.Point2D,v=new r.Point2D;let C=!1;const D=c.hasNonLinearSegments(),b=new r.Point2D;for(let e=1;e<p;++e){d.queryPoint2D(2*e,b);const t=b.x;let n=t+_;const o=n-f;if(b.x=n,Math.abs(o)>this.m_GCSLargeDelta){if(u){const t=g+e-1,s=g+(e+1<p?e:0),n=h.read(2*t),i=(h.read(2*s)-n)*a;Math.abs(o-i)>1*this.m_degree&&(u=!1)}u||(_-=r.copySign(this.m_width360,n-f),n=t+_,++y,C=0!==_,b.x=n)}else P||i.isAngleTooSharp(E,v,b,x)&&(P=!0);C&&(D&&s.throwInternalErrorException("error in geonormalize_ring_ for curves"),d.write(2*e,n)),f=n,E.setCoordsPoint2D(v),v.setCoordsPoint2D(b)}y&&c.notifyModified();const S=c.getXY(0),I=c.getXY(p-1);if(r.Point2D.distance(S,I)<x){const e=this.finalizeGeoNormalizeClosedRing(c,P,m);l.add(e,!1)}else{t<0&&(null!==this.m_originalGeometry?(s.geometryReleaseAssert(null!==this.m_originalGeometry),t=this.m_originalGeometry.calculateRingArea2D(e)>0?1:0):t=1);const n=this.finalizeGeoNormalizeOpenedRing(t>0,c);l.add(n,!1)}}geoNormalizePolygonGeometry(e){s.geometryReleaseAssert(this.m_originalSR&&this.m_originalGeometry||!this.m_originalGeometry&&!this.m_originalSR),s.geometryReleaseAssert(this.m_pannableSR.isPannable());let i=null,r=Number.NaN;const o=!!this.m_originalSR&&this.m_originalSR.isPannable();o&&(i=this.m_originalGeometry.getAttributeStreamRef(0),r=this.m_width360/this.m_originalSR.getPannableExtent().width()),this.m_bAdjustedAtPoles=0;const a=new n.Polygon({vd:this.m_inputPoly.getDescription()});for(let t=0,s=this.m_inputPoly.getPathCount();t<s;++t){const s=this.m_polygonRingFlags?this.m_polygonRingFlags[t]?1:0:-1;this.geonormalizeRing(t,s,o,r,e,i,a)}const l=this.m_pannableSR.getTolerance(0),u=this.m_pannableExtent.width()/180;Pi(a,this.m_pannableExtent,.1*l,!1);const c=t.Envelope2D.constructEmpty();if(c.setCoords({env2D:this.m_pannableExtent}),e){let e=!0;for(let s=0;s<2;s++){e=!0;const s=t.Envelope2D.constructEmpty();for(let t=0,n=a.getPathCount();t<n;t++)if(a.queryPathEnvelope(t,s),!(c.xmin<=s.xmin&&c.xmax>=s.xmax||s.xmin>=c.xmax||s.xmax<=c.xmin)){e=!1;break}if(e)break;c.move(.5*this.m_width360,0)}e||c.setCoords({env2D:this.m_pannableExtent})}let g=m.clip$1(a,c,l,u,this.m_progressTracker),d=a!==g;const p=this.m_originalGeometry?this.m_originalGeometry.calculateArea2D():1,_=g.calculateArea2D();let f=0;if(_>0&&p<0)f=1;else if(_<=0&&p>0)if(0===_){if(this.m_originalSR){let e=Number.NaN;2===this.m_originalSR.getCoordinateSystemType()?e=this.m_originalSR.getPCSHorizon().calculateArea2D():1===this.m_originalSR.getCoordinateSystemType()&&(e=this.m_originalSR.getPannableExtent().getArea()),p>.99*e&&(f=-1)}}else f=-1;if(0!==f){const e=function(e,t){let s=new n.Polygon({vd:e});s.addEnvelope(t,!1);const i=t.width()/180;return s=(new h.OperatorDensify).execute(s,i,0,0,null),s}(g.getDescription(),c);e.add(g,!1),d=!0,g=e}return d&&(g=(new Bs).execute(g,this.m_pannableSR,!1,this.m_progressTracker)),g}geoNormalizePolylineGeometry(e){s.geometryReleaseAssert(this.m_pannableSR.isPannable());let i=null;const o=this.m_originalSR&&this.m_originalSR.isPannable();let h=1;o&&(s.geometryReleaseAssert(this.m_originalGeometry),h=this.m_width360/this.m_originalSR.getPannableExtent().width(),i=this.m_originalGeometry.getAttributeStreamRef(0));const l=this.m_pannableExtent.width(),u=l*r.doubleEps()*4;let c=e,g=Number.NaN;const d=r.Envelope1D.constructEmpty();this.m_bAdjustedAtPoles=0;let p=new n.Polyline({vd:this.m_inputPoly.getDescription()});for(let e=0,m=this.m_inputPoly.getPathCount();e<m;++e){let m=o;const _=new n.Polyline({vd:this.m_inputPoly.getDescription()});_.addPath(this.m_inputPoly,e,!0);const f=this.m_inputPoly.isClosedPath(e);0!==this.m_poleFlags&&(this.m_bAdjustedAtPoles|=Rn(f,_,this.m_pannableExtent.ymax-this.m_poleSnappingTolerance,this.m_pannableExtent.ymax,l,this.m_poleFlags)?1:0,this.m_bAdjustedAtPoles&&(m=!1));let y=-1;const x=_.getPointCount();let P=!1;m&&(y=this.m_originalGeometry.getPathStart(e),P=this.m_originalGeometry.isClosedPath(e));const E=_.getAttributeStreamRef(0);let v=0,C=E.read(0),D=0;const b=new r.Point2D,S=new r.Point2D;let I=!1;const w=_.hasNonLinearSegments(),T=new r.Point2D;for(let e=1;e<x;++e){E.queryPoint2D(2*e,T);const t=T.x;let n=t+v;const o=n-C;if(T.x=n,Math.abs(o)>this.m_GCSLargeDelta){if(m){const t=y+e-1;let s=y;(!P||e+1<x)&&(s+=e);const n=i.read(2*t),r=(i.read(2*s)-n)*h;Math.abs(o-r)>1*this.m_degree&&(m=!1)}m||(v-=r.copySign(this.m_width360,n-C),n=t+v,++D,I=0!==v,T.x=n)}I&&(w&&s.throwInternalErrorException("error in geonormalize_ring_ for curves"),E.write(2*e,n)),C=n,b.setCoordsPoint2D(S),S.setCoordsPoint2D(T)}if(D&&_.notifyModified(),c){let e=!1;if(!_.isEmpty()){const n=t.Envelope2D.constructEmpty();if(_.queryEnvelope(n),n.width()>=l||n.ymin<=this.m_pannableExtent.ymin||n.ymax>=this.m_pannableExtent.ymax)e=!0;else{if(Number.isNaN(g)){const e=this.m_centralLongitude-.5*l;g=n.xmin,g+=Math.round((e-n.xmin)/l)*l,g>e&&(g-=l),s.geometryReleaseAssert(g<=e),g<e&&(g+=l),s.geometryReleaseAssert(g>=e)}let t=Math.round((g-n.xmin)/l)*l;if(n.xmin+t>g+u&&(t-=l),n.xmin+t<g-u&&(t+=l),d.mergeCoordinate(n.xmin+t),d.mergeCoordinate(n.xmax+t),e=d.width()>=l,!e){const e=new a.Transformation2D;e.setShiftCoords(t,0),_.applyTransformation(e)}}}p.add(_,!1),e&&(p=(()=>{const e=new n.Polyline({vd:p.getDescription()});for(let t=0,s=p.getPathCount();t<s;++t){const s=new n.Polyline({vd:p.getDescription()});s.addPath(p,t,!0);const i=hi(s,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);e.add(i,!1)}return e})(),c=!1)}else{const e=hi(_,this.m_pannableSR,this.m_centralLongitude,!0,0,this.m_progressTracker);p.add(e,!1)}}if(c)return p;const _=this.m_pannableSR.getTolerance(0),f=this.m_pannableExtent.width()/180;return Pi(p,this.m_pannableExtent,.1*_,!1),m.clip$1(p,this.m_pannableExtent,_,f,this.m_progressTracker)}finalizeGeoNormalizeOpenedRing(e,i){const o=i.getPointCount(),m=i.getXY(0),h=i.getXY(o-1);{const e=Math.abs(h.x-m.x),t=Math.round(e/this.m_width360)*this.m_width360;s.geometryReleaseAssert(Math.abs(e-t)<this.m_pannableSR.getTolerance(0))}const l=r.sign(h.x-m.x),u=t.Envelope2D.constructEmpty();i.queryLooseEnvelope(u);const c=this.m_pannableExtent.getCenterX();let g=0,d=c-this.m_width360,p=c+this.m_width360;if(l>=0){let e=Math.ceil((d-u.xmin)/this.m_width360);for(e*=this.m_width360;d>u.xmin+e;)e+=this.m_width360;for(;d<u.xmax+e;)e-=this.m_width360;for(g=e,u.width()>720&&(p=d+360*Math.ceil(u.width()/360));p<u.xmax;)p+=this.m_width360}else{let e=Math.ceil((p-u.xmax)/this.m_width360);for(e*=this.m_width360;p<u.xmax+e;)e-=this.m_width360;for(;p>u.xmin+e;)e+=this.m_width360;for(g=e,u.width()>720&&(d=p-360*Math.ceil(u.width()/360));d>u.xmin;)d-=this.m_width360}const _=Math.round(Math.abs(h.x-m.x)/this.m_width360)*this.m_width360,f=l*_,y=u.clone();y.move(g,0);const x=new r.Point2D(0,0),P=new a.Transformation2D;P.setShiftCoords(g,0),i.applyTransformation(P);const E=new n.Polyline({vd:i.getDescription()});E.add(i,!1),x.assign(i.getXY(o-1));let v=0,C=E.getXY(0).x;for(;l>0?y.xmax<p:y.xmin>d;)y.move(f,0),P.xd=f,i.applyTransformation(P),C+=f,this.m_pannableExtent.xmin<=C&&this.m_pannableExtent.xmax>=C&&(v=E.getPointCount()-1),i.setXY(0,x),x.assign(i.getXY(o-1)),E.addSegmentsFromPath(i,0,0,o-1,!1);const D=new n.Polygon({vd:E.getDescription()});D.add(E,!1);const b=E.getXY(0),S=E.getXY(E.getPointCount()-1),I=l<0?e:!e,w=D.getPointCount()-1;if(I){const e=new r.Point2D(S.x,this.m_pannableExtent.ymax);D.lineTo(e);const t=new r.Point2D(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymax);D.lineTo(t);const s=new r.Point2D(b.x,this.m_pannableExtent.ymax);D.lineTo(s)}else{const e=new r.Point2D(S.x,this.m_pannableExtent.ymin);D.lineTo(e);const t=new r.Point2D(this.m_pannableExtent.getCenterX(),this.m_pannableExtent.ymin);D.lineTo(t);const s=new r.Point2D(b.x,this.m_pannableExtent.ymin);D.lineTo(s)}if(D.interpolateAttributesPath(0,w,0),D.getImpl().changeRingStartPoint(v),_>this.m_width360){const e=new n.Polygon({copy:D});P.setShiftCoords(this.m_width360,0),e.applyTransformation(P),D.add(e,!1)}return D}finalizeGeoNormalizeClosedRing(e,i,o){const m=new n.Polygon({vd:e.getDescription()});if(m.add(e,!1),m.hasNonLinearSegments()&&(()=>{const e=m.getPointCount()-2;return m.getSegmentType(e)!==s.GeometryType.enumLine})()){const e=new n.SegmentBuffer,t=m.getPointCount()-2;m.getSegmentBuffer(t,e,!1),m.removePointFromPath(0,t+1),m.closeLastPathWithSegment(e.get())}else m.removePointFromPath(0,m.getPointCount()-1);const h=t.Envelope2D.constructEmpty();m.queryLooseEnvelope(h);let l=Math.ceil((this.m_pannableExtent.xmin-h.xmin)/this.m_width360);for(l*=this.m_width360;this.m_pannableExtent.xmin>h.xmin+l;)l+=this.m_width360;for(;this.m_pannableExtent.xmin<h.xmax+l;)l-=this.m_width360;if(l+=this.m_width360,0!==l){h.move(l,0);const e=new a.Transformation2D;e.setShiftCoords(l,0),m.applyTransformation(e)}if(this.m_pannableExtent.xmin<=h.xmin&&this.m_pannableExtent.xmax>=h.xmax){if(i){const e=m.calculateArea2D(),t=(new Bs).execute(m,this.m_pannableSR,!0,this.m_progressTracker);if(t!==m){const s=t.calculateArea2D();r.sign(e)!==r.sign(s)&&t.reverseAllPaths(),m.assignMove(t)}}let e;if(e=o?new n.Polygon({copy:m}):new n.Polygon({move:m}),o)for(;h.xmin<this.m_pannableExtent.xmax;){h.move(this.m_width360,0);const t=new a.Transformation2D;t.setShiftCoords(this.m_width360,0),m.applyTransformation(t),e.add(m,!1)}return e}let u=new n.Polygon({vd:e.getDescription()});u.add(m,!1);const c=i||h.width()>this.m_width360-10*this.m_pannableSR.getTolerance(0);for(;h.xmin<this.m_pannableExtent.xmax;){h.move(this.m_width360,0);const e=new a.Transformation2D;e.setShiftCoords(this.m_width360,0),m.applyTransformation(e),u.add(m,!1)}if(c){const e=u.calculateArea2D();u.setFillRule(1),u=(new Bs).execute(u,this.m_pannableSR,!0,this.m_progressTracker);const t=u.calculateArea2D();r.sign(e)!==r.sign(t)&&u.reverseAllPaths()}return u}geonormalize_ring_(e,t,n,i,r,o,a){s.geometryReleaseAssert(0)}}function qn(e){s.geometryReleaseAssert(0);const t=function(e){const t=new Wi({},!0);return t.m_WKID=e,t}(e),n=new Vn;return n.setVertProj_(t),n}class Vn{constructor(){this.m_hashCode=0,this.m_peVertSysVal=null,this.m_verticalUnit=new yr,this.m_verticalShift=0,this.m_userVerticalWKID=0,this.m_bIsDepth=!1}getType(){return s.geometryReleaseAssert(0),0}getID(){return s.geometryReleaseAssert(0),0}getLatestID(){return this.m_peVertSysVal?this.m_peVertSysVal.getLatestID():0}getOldID(){return this.m_peVertSysVal?this.m_peVertSysVal.getOldID():0}getText(){return s.geometryReleaseAssert(0),""}getTextExtended(e){return s.geometryReleaseAssert(0),""}getText2(e){return s.geometryReleaseAssert(0),""}getUnit(){return s.geometryReleaseAssert(0),{}}equals(e){return s.geometryReleaseAssert(0),!1}equalForProjection(e){return s.geometryReleaseAssert(0),!1}getPeVertcsCopy(){return s.geometryReleaseAssert(0),{}}getOneMeter(){return 1/this.m_verticalUnit.getUnitToBaseFactor()}getUnitToBaseFactor(){return s.geometryReleaseAssert(0),0}isDepth(){return s.geometryReleaseAssert(0),!1}getVerticalShift(){return s.geometryReleaseAssert(0),0}isCustomWkid(){return!!this.m_peVertSysVal&&this.m_peVertSysVal.isCustomWkid()}getHashCode(){return this.m_hashCode}setVertProj_(e){this.m_peVertSysVal=e}getPEVerticalCoordSys(){return this.m_peVertSysVal?this.m_peVertSysVal.m_peVertcs:null}}function Hn(e,t,s,i,r){if(e.equals(t))return!1;if(i){let s=1,n=0,o=1,a=1,m=0,h=1;Number.isNaN(e.m_heightMetersPerUnit)||(s=e.m_heightMetersPerUnit,n=e.m_heightZ0,o=e.m_heightSign,a=t.m_heightMetersPerUnit,m=t.m_heightZ0,h=t.m_heightSign);const l=o*h*s/a;for(let e=0;e<r;e++)i[e]=(i[e]-n)*l+m}let o=1,a=0;if(Number.isNaN(e.m_XYToRadians)||(o=e.m_XYToRadians/t.m_XYToRadians,a=e.m_PrimeMeridianDegrees-t.m_PrimeMeridianDegrees,0!==a&&(a=n.convertToRadians(a),a/=t.m_XYToRadians)),Array.isArray(s)){const e=s;for(let t=0;t<r;t++)e[t][0]=e[t][0]*o+a,e[t][1]=e[t][1]*o}else{const e=s;for(let t=0;t<r;t++){const s=t<<1;e[s]=e[s]*o+a,e[s+1]=e[s+1]*o}}return!0}function On(){return{m_heightMetersPerUnit:0,m_heightSign:0,m_heightZ0:0,m_XYToRadians:0,m_PrimeMeridianDegrees:0,assign(e){this.m_heightMetersPerUnit=e.m_heightMetersPerUnit,this.m_heightSign=e.m_heightSign,this.m_heightZ0=e.m_heightZ0,this.m_XYToRadians=e.m_XYToRadians,this.m_PrimeMeridianDegrees=e.m_PrimeMeridianDegrees},equals(e){return r.isEqualNonIEEE(this.m_heightSign,e.m_heightSign)&&r.isEqualNonIEEE(this.m_heightMetersPerUnit,e.m_heightMetersPerUnit)&&r.isEqualNonIEEE(this.m_heightZ0,e.m_heightZ0)&&r.isEqualNonIEEE(this.m_XYToRadians,e.m_XYToRadians)&&r.isEqualNonIEEE(this.m_PrimeMeridianDegrees,e.m_PrimeMeridianDegrees)},initFromGcsAndVcsPe(e,t){this.m_heightSign=1,this.m_heightMetersPerUnit=Number.NaN,this.m_heightZ0=0,this.m_XYToRadians=Number.NaN,this.m_PrimeMeridianDegrees=Number.NaN,t&&s.geometryReleaseAssert(0),e&&(this.m_XYToRadians=e.getUnit().getUnitFactor(),this.m_PrimeMeridianDegrees=e.getPrimem().getLongitude())},initFromGcsAndVcs(e,t){const s=e?e.getPECoordSys():null,n=t?t.getPEVerticalCoordSys():null;this.initFromGcsAndVcsPe(s,n)},processUnitParams(e){Number.isNaN(this.m_heightMetersPerUnit)&&(this.m_heightMetersPerUnit=e.m_heightMetersPerUnit,this.m_heightSign=e.m_heightSign,this.m_heightZ0=e.m_heightZ0),Number.isNaN(this.m_XYToRadians)&&(this.m_XYToRadians=e.m_XYToRadians,this.m_PrimeMeridianDegrees=e.m_PrimeMeridianDegrees)}}}class Yn{constructor(t){this.m_constantsLoaded=-1,this.m_isUsable=-1,this.m_inputSR=null,this.m_outputSR=null,this.m_inputSRHorz=null,this.m_outputSRHorz=null,this.m_inputVCS=null,this.m_outputVCS=null,this.m_hashCode=0,this.m_areaOfUse=new i.Envelope,this.m_inputUnitParams=On(),this.m_outputUnitParams=On(),s.geometryReleaseAssert(t),this.m_geogTran=t,this.m_vertTran=null,this.m_latestID=e.peFactory.getCode(this.m_geogTran),this.m_latestID<0&&(this.m_latestID=0);const n=this.m_geogTran.getGeogcs1();e.peFactory.getCode(n);const r=this.m_geogTran.getGeogcs2();e.peFactory.getCode(r),this.initUnitParams()}getLatestId(){return this.m_latestID}getText(){return this.m_geogTran?this.m_geogTran.toString():(s.geometryReleaseAssert(0),"")}getGeogtran(){return this.m_geogTran}getVerttran(){return null}loadConstants(t){let n=this.m_constantsLoaded;if(-1===n){if(!t){this.m_geogTran||s.throwInternalErrorException("vcs not impl");const n=this.m_geogTran.getParameters();null!==n[e.peDefs.PE_PARM_ND]&&(t=0===n[e.peDefs.PE_PARM_ND].getValue())}n=this.m_geogTran.loadConstants()?1:0,this.m_constantsLoaded=n}return 0!==n}isUsable(){let e=this.m_isUsable;return-1===e&&(this.m_geogTran?this.m_isUsable=e=this.m_geogTran?1:0:this.m_isUsable=e=this.m_vertTran?1:0),1===e}getInputSr(e){return this.updateSrs(),e?this.m_inputSR:this.m_inputSRHorz}getOutputSr(e){return this.updateSrs(),e?this.m_outputSR:this.m_outputSRHorz}getHashCode(){let e=this.m_hashCode;return 0===e&&(e=this.m_latestID>0?r.hashInt32(this.m_latestID):r.hashString(this.getText()),0===e&&(e=345),this.m_hashCode=e),e}isGeogtran(){return null!==this.m_geogTran}prepareOrThrow(){}getName(){return this.isGeogtran()?this.getGeogtran().getName():(s.throwNotImplementedException("vcs not impl"),"")}updateSrs(){if(this.m_inputSR||this.m_inputVCS)return;let e,t,n,i,r,o;if(this.m_geogTran){const s=this.m_geogTran.getGeogcs1(),a=mr(s),m=this.m_geogTran.getGeogcs2(),h=mr(m);let l=-1,u=-1;l=a.getVcsCode(),u=h.getVcsCode(),n=Mr(s,null,0,1),i=Mr(m,null,0,1),l>0&&u>0?(r=qn(l),o=qn(u),e={},t={}):(e=n,t=i)}else s.geometryReleaseAssert(0);this.m_inputSR||this.m_inputVCS||(this.m_inputSR=e,this.m_outputSR=t,this.m_inputSRHorz=n,this.m_outputSRHorz=i,this.m_inputVCS=r,this.m_outputVCS=o)}initUnitParams(){if(this.m_inputUnitParams.m_heightSign=1,this.m_inputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_inputUnitParams.m_heightZ0=0,this.m_outputUnitParams.m_heightSign=1,this.m_outputUnitParams.m_heightMetersPerUnit=Number.NaN,this.m_outputUnitParams.m_heightZ0=0,this.m_inputUnitParams.m_XYToRadians=Number.NaN,this.m_inputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_outputUnitParams.m_XYToRadians=Number.NaN,this.m_outputUnitParams.m_PrimeMeridianDegrees=Number.NaN,this.m_vertTran)s.geometryReleaseAssert(0);else if(this.m_geogTran){const e=this.m_geogTran;let t=e.getGeogcs1();this.m_inputUnitParams.m_XYToRadians=t.getUnit().getUnitFactor(),this.m_inputUnitParams.m_PrimeMeridianDegrees=t.getPrimem().getLongitude(),t=e.getGeogcs2(),this.m_outputUnitParams.m_XYToRadians=t.getUnit().getUnitFactor(),this.m_outputUnitParams.m_PrimeMeridianDegrees=t.getPrimem().getLongitude()}}}function Xn(e,t,s,n,i,r,o){let a=null;t&&(a=t.getPEVerticalCoordSys());let m=null;e&&(m=e.getPECoordSys());let h=null;n&&(h=n.getPEVerticalCoordSys());let l=null;if(s&&(l=s.getPECoordSys()),!(m||a||l||h))return!1;const u=On();u.initFromGcsAndVcsPe(m,a);const c=On();return c.initFromGcsAndVcsPe(l,h),Hn(u,c,i,r,o)}function Ln(e,t,s,n,i,r,o,a){const m=t,h=e,l=On();l.initFromGcsAndVcsPe(h,m),a.assign(n?s.m_outputUnitParams:s.m_inputUnitParams),a.processUnitParams(l),l.processUnitParams(a),o>0&&Hn(l,a,i,r,o)}function Bn(e,t,s,n,i,r,o,a,m){const h=On(),l=On();h.assign(s?t.m_inputUnitParams:t.m_outputUnitParams),l.assign(i?n.m_outputUnitParams:n.m_inputUnitParams),h.processUnitParams(e),l.processUnitParams(h),h.processUnitParams(l),a>0&&Hn(h,l,r,o,a),m.assign(l)}function zn(t,s,n,i,r,o,a){const m=s.getVerttran(),h=s.getGeogtran();if(a.assign(n?s.m_inputUnitParams:s.m_outputUnitParams),a.processUnitParams(t),o>0){s.prepareOrThrow();const t=n?e.peDefs.PE_TRANSFORM_2_TO_1:e.peDefs.PE_TRANSFORM_1_TO_2;m?qi():Vi(h,o,i,r,t)}}class Un{supportsCurves(){return!0}accelerateGeometry(e,t,s){return jn(e,t,s)}canAccelerateGeometry(e){return Wn(e)}}function jn(e,t,r){if(!Wn(e))return!1;i.calculateToleranceFromGeometryForRelGeom(t,e,!1);let o=0;const a=e.getGeometryType();return s.isMultiPath(a)&&n.canUseQuadTree(e)&&0!==r&&(o|=e.getImpl().buildQuadTreeAccelerator(r)?1:0),s.isMultiPath(a)&&n.canUseQuadTreeForPaths(e)&&0!==r&&(o|=e.getImpl().buildQuadTreeForPathsAccelerator(r)?1:0),o>0}function Wn(e){return n.canUseQuadTree(e)||n.canUseQuadTreeForPaths(e)}class Zn extends Un{getOperatorType(){return 8}execute(e,t,s,n){return Ze(e,t,s,1,n)}}class Qn{getOperatorType(){return 10002}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s,n){return new Kn(e,t,s,n)}execute(e,t,s,n){return this.executeMany(new l.SimpleGeometryCursor([e]),new l.SimpleGeometryCursor([t]),s,n).next()}}class Kn extends l.GeometryCursor{constructor(e,t,s,i){super(),this.m_progressTracker=i,this.m_index=-1,this.m_inputGeoms=e,this.m_spatialReference=s;const r=t.next();this.m_geomSubtractor=r||new n.Polygon}next(){const e=this.m_inputGeoms.next();return e?(s.throwIfMesh(e),s.throwIfGeometryCollection(e),this.m_index=this.m_inputGeoms.getGeometryID(),function(e,o,a,h){if(e.isEmpty()||o.isEmpty())return e;const l=e.getDimension(),u=o.getDimension();if(l>u)return e;const c=e.getGeometryType(),g=o.getGeometryType(),d=new t.Envelope2D,p=new t.Envelope2D,_=new t.Envelope2D;e.queryEnvelope(d),o.queryEnvelope(p),_.setCoords({env2D:d}),_.mergeEnvelope2D(p);const f=i.calculateToleranceFromGeometryForOp(a,_,!0),y=i.adjustToleranceForTEClustering(f),x=new t.Envelope2D;if(x.setCoords({env2D:d}),x.inflateCoords(y,y),!x.isIntersecting(p))return e;if(1===l&&2===u){const r=function(e,r,o,a,m){const h=new i.Envelope;e.queryEnvelope(h);const l=new t.Envelope2D;r.queryEnvelope(l),h.merge(l);const u=.1*h.width(),c=.1*h.height();h.inflateCoords(u,c);const g=new n.Polygon;g.addEnvelope(h,!1);const d=g.getImpl();if(o===s.GeometryType.enumPolygon){const e=r.getImpl();d.add(e,!0)}else d.addEnvelope(r,!0);return new Us(g,a,-1,m).tryFastImplementation(e)}(e,o,g,a,h);if(r)return r}if(c===s.GeometryType.enumPoint){let a;switch(s.isSegment(g)?(a=new n.Polyline({vd:o.getDescription()}),a.addSegment(o,!0)):a=o,g){case s.GeometryType.enumPolygon:return function(e,t,s){return 0===Zt(t,e,s.total())?e:e.createInstance()}(e,a,f);case s.GeometryType.enumPolyline:return function(e,s,n){const o=e.getXY(),a=s.querySegmentIterator(),m=i.adjustToleranceForTEClustering(n),h=m*m;for(;a.nextPath();)for(;a.hasNextSegment();){const s=a.nextSegment(),i=new t.Envelope2D;if(s.queryEnvelope(i),i.inflateCoords(m,m),!i.contains(o))continue;if(s.isIntersectingPoint(o,n.total()))return e.createInstance();let l=s.getStartXY();if(r.Point2D.sqrDistance(o,l)<=h)return e.createInstance();if(l=s.getEndXY(),r.Point2D.sqrDistance(o,l)<=h)return e.createInstance()}return e}(e,a,f);case s.GeometryType.enumMultiPoint:return function(e,t,s){const n=t.getImpl().getAttributeStreamRef(0),o=t.getPointCount(),a=e.getXY(),m=i.adjustToleranceForTEClustering(s),h=m*m,l=new r.Point2D;for(let t=0;t<o;t++)if(n.queryPoint2D(2*t,l),r.Point2D.sqrDistance(l,a)<=h)return e.createInstance();return e}(e,a,f);case s.GeometryType.enumEnvelope:return function(e,s,n){const i=new t.Envelope2D;s.queryEnvelope(i),i.inflate(n.total());const r=e.getXY();return i.contains(r)?e.createInstance():e}(e,a,f);case s.GeometryType.enumPoint:return function(e,t,s){const n=i.adjustToleranceForTEClustering(s),o=n*n,a=e.getXY(),m=t.getXY();return r.Point2D.sqrDistance(a,m)<=o?e.createInstance():e}(e,a,f);default:s.throwInvalidArgumentException("invalid shape type")}}else if(c===s.GeometryType.enumMultiPoint)switch(g){case s.GeometryType.enumPolygon:return function(e,s,n){const i=new t.Envelope2D;s.queryEnvelope(i),i.inflate(n.total());const o=e.getPointCount();let a=!1;const m=r.makePrimitiveArray(o,!1),h=new r.Point2D;for(let t=0;t<o;t++)e.queryXY(t,h),i.contains(h)&&0!==Qt(s,h,n.total())&&(a=!0,m[t]=!0);if(!a)return e;const l=e.createInstance();for(let t=0;t<o;t++)m[t]||l.addPoints(e,t,t+1);return l}(e,o,f);case s.GeometryType.enumEnvelope:return function(e,s,n){const i=new t.Envelope2D;s.queryEnvelope(i),i.inflate(n.total());const o=e.getPointCount();let a=!1;const m=r.makePrimitiveArray(o,!1),h=new r.Point2D;for(let t=0;t<o;t++)e.queryXY(t,h),i.contains(h)&&(a=!0,m[t]=!0);if(!a)return e;const l=e.createInstance();for(let t=0;t<o;t++)m[t]||l.addPoints(e,t,t+1);return l}(e,o,f);case s.GeometryType.enumPoint:return function(e,t,s){const n=e.getImpl().getAttributeStreamRef(0),o=e.getPointCount(),a=t.getXY();let m=!1;const h=r.makePrimitiveArray(o,!1),l=i.adjustToleranceForTEClustering(s),u=l*l,c=new r.Point2D;for(let e=0;e<o;e++)n.queryPoint2D(2*e,c),r.Point2D.sqrDistance(c,a)<=u&&(m=!0,h[e]=!0);if(!m)return e;const g=e.createInstance();for(let t=0;t<o;t++)h[t]||g.addPoints(e,t,t+1);return g}(e,o,f)}const P=new t.Envelope2D(d);return P.inflate(100*f.total()),function(e,r,o,a){if(e.isEmpty()||r.isEmpty()||e.getDimension()>r.getDimension())return ws(Ts(e),e,0,"-");const m=new t.Envelope2D;e.queryEnvelope(m);const h=new t.Envelope2D;r.queryEnvelope(h);const l=new t.Envelope2D;l.setCoords({env2D:m}),l.mergeEnvelope2D(h);const u=i.calculateToleranceFromGeometryForOp(o,l,!0),c=h.clone(),g=i.adjustToleranceForTEClustering(u);if(c.inflateCoords(g,g),!m.isIntersecting(c))return ws(Ts(e),e,0,"-");const d=new Is(a),p=new n.EditShape,_=p.addGeometry(Ts(e)),f=p.addGeometry(Ts(r));let y=0,x=0,P=null;if(p.hasCurves()){P=new ms;const e=p.getEnvelope2D(a);x=os(u.total());const t=rs(u.total(),e);y=as(t,x),ss(p,t,u.total(),0,P,null,a)}d.setEditShapeCrackAndCluster(p,u.add(y));const E=d.difference(_,f);null!==P&&P.stitchCurves(p,E,x,!0);const v=ws(p.getGeometry(E),e,0,"-");return ys(v.getGeometryType())&&(v.getImpl().setIsSimple(4,u.total()),v.getGeometryType()===s.GeometryType.enumPolygon&&v.getImpl().updateOGCFlagsProtected()),v}(e,m.clip$1(o,P,0,0,h),a,h)}(e,this.m_geomSubtractor,this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}class $n{getOperatorType(){return 10001}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s,n=0){return new ei(e,t,s,n)}execute(e,t,n,i){const r=new l.SimpleGeometryCursor([e,t]),o=new ei(r,n,i,0).next();return o||s.throwInternalErrorException("null output"),o}}class Jn{constructor(){this.binVertexCount=0,this.geometries=[]}addPair(e){this.binVertexCount+=e.vertexCount,this.geometries.push(e)}sort(){this.geometries.sort((e,t)=>function(e,t){return r.Point2D.compareZorder(e.location,t.location)?-1:e.location.equals(t.location)?0:1}(e,t))}geomCount(){return this.geometries.length}geomPairs(){return this.geometries}clear(){this.binVertexCount=0,this.geometries.length=0}getBinVertexCount(){return this.binVertexCount}}class ei extends l.GeometryCursor{constructor(e,t,s,n,i=!1){super(),this.m_index=-1,this.m_currentDim=-1,this.m_bDone=!1,this.m_unionBins=[],this.m_readyGeoms=r.makeNullArray(4),this.m_dimGeomCounts=r.makePrimitiveArray(4,0),this.m_addedGeoms=0,this.m_maxDimension=-1,this.m_bHadGeometry=r.makePrimitiveArray(4,!1),this.m_complexUnionGeoms=r.makeNullArray(4),this.m_totalNonEmptyGeomCounters=r.makePrimitiveArray(4,0),this.m_progressTracker=s,this.m_bUnionAllDimensions=!!(4&n),this.m_bPreserveAllPathEnds=!!(8&n),this.m_inputGeoms=e,this.m_spatialReference=t,this.m_options=n,this.m_bIs3D=i}next(){if(this.m_bDone&&this.m_currentDim===this.m_maxDimension)return null;for(;!this.step_(););if(-1===this.m_maxDimension)return null;if(this.m_bUnionAllDimensions){if(-1===this.m_currentDim)for(let e=0;e<=this.m_maxDimension;e++)if(this.m_bHadGeometry[e]){this.m_complexUnionGeoms[e]=this.getResultGeometry(e);for(let t=e+1;t<=this.m_maxDimension;t++)this.m_complexUnionGeoms[t]=this.getResultGeometry(t),this.m_bHadGeometry[t]&&!this.m_complexUnionGeoms[t].isEmpty()&&(this.m_bIs3D?s.geometryReleaseAssert(0):this.m_complexUnionGeoms[e]=(new Qn).execute(this.m_complexUnionGeoms[e],this.m_complexUnionGeoms[t],this.m_spatialReference,this.m_progressTracker))}for(;this.m_currentDim++,(this.m_currentDim>this.m_maxDimension||this.m_currentDim<0)&&s.throwInternalErrorException(""),!this.m_bHadGeometry[this.m_currentDim];);if(this.m_index++,0===this.m_currentDim&&this.m_complexUnionGeoms[this.m_currentDim].getGeometryType()===s.GeometryType.enumPoint){const e=new n.MultiPoint({vd:this.m_complexUnionGeoms[this.m_currentDim].getDescription()});return this.m_complexUnionGeoms[this.m_currentDim].isEmpty()||e.add(this.m_complexUnionGeoms[this.m_currentDim]),e}return this.m_complexUnionGeoms[this.m_currentDim]}return this.m_index=0,this.m_currentDim=this.m_maxDimension,this.getResultGeometry(this.m_maxDimension)}getGeometryID(){return this.m_index}getRank(){return 1}tock(){return this.step_()}getResultGeometry(e){return this.m_readyGeoms[e]}finishDim(e,t,r){let o=t;if(!r)return 16&this.m_options?(o=bs([o],1,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D),o):o;if(1&this.m_options)return o;if(1===e)if(8&this.m_options||!(16&this.m_options||this.m_totalNonEmptyGeomCounters[e]>1))1===this.m_totalNonEmptyGeomCounters[e]&&(this.m_bIs3D?s.geometryReleaseAssert(0):o=(new Bs).execute(o,this.m_spatialReference,!1,this.m_progressTracker));else{o=bs([o],1,this.m_spatialReference,this.m_progressTracker,16|this.m_options,this.m_bIs3D);const e=[0],t=o.getImpl().getIsSimple(0,e);s.geometryReleaseAssert(this.m_bIs3D||i.isAtLeastPlanarSimple(t))}else this.m_bIs3D?s.geometryReleaseAssert(0):o=(new Bs).execute(o,this.m_spatialReference,!1,this.m_progressTracker);if(0===e&&o.getGeometryType()===s.GeometryType.enumPoint){const e=new n.MultiPoint({vd:o.getDescription()});o.isEmpty()||e.add(o),o=e}return o}static getLevel(e){const t=s.vertexCount(e);let n=t>0?(Math.log(t)-Math.log(32))/Math.log(4):0;return n<0&&(n=0),Math.floor(n)}step_(){if(this.m_bDone)return!0;let e;if(this.m_inputGeoms?(e=this.m_inputGeoms.next(),null===e?(this.m_bDone=!0,this.m_inputGeoms=null):(this.checkAndThrow(e),e.isEmpty()||this.m_totalNonEmptyGeomCounters[e.getDimension()]++)):e=null,null!==e){const t=e.getDimension();this.m_bHadGeometry[t]=!0,(t>=this.m_maxDimension||this.m_bUnionAllDimensions)&&(this.addGeom(t,!1,e),t>this.m_maxDimension&&!this.m_bUnionAllDimensions&&this.removeAllBinsWithLowerDimension(t))}if(this.m_addedGeoms>0)for(let e=0;e<=this.m_maxDimension;e++){for(;this.m_dimGeomCounts[e]>1;){const t=this.collectGeometriesToUnion(e);if(null===t)break;{let s;s=1&this.m_options?bs(t,t.length,this.m_spatialReference,this.m_progressTracker,this.m_options,this.m_bIs3D):Ss(t,t.length,this.m_spatialReference,this.m_progressTracker,8|this.m_options,this.m_bIs3D),this.addGeom(e,!0,s)}}if(this.m_bDone&&(s.geometryReleaseAssert(this.m_dimGeomCounts[e]<=1),0!==this.m_dimGeomCounts[e])){const t=this.m_unionBins[e].entries().next().value,s=t[1].geomPairs()[0].geom,n=t[1].geomPairs()[0].bUnioned;this.m_unionBins[e].clear(),this.m_readyGeoms[e]=this.finishDim(e,s,n)}}return this.m_bDone}addGeom(e,n,i){const o={geom:null,vertexCount:-1,bUnioned:!1,location:new r.Point2D};o.geom=i;const a=s.vertexCount(i);o.vertexCount=a;const m=t.Envelope2D.constructEmpty();i.queryEnvelope(m),o.location=a>0?m.getCenter():new r.Point2D(0,0);const h=ei.getLevel(i);if(e+1>this.m_unionBins.length)for(;this.m_unionBins.length<Math.max(2,e+1);)this.m_unionBins.push(new Map);let l=null;const u=this.m_unionBins[e].get(h);u&&(l=u),null===l&&(l=new Jn,this.m_unionBins[e].set(h,l)),o.bUnioned=n,l.addPair(o),this.m_dimGeomCounts[e]++,this.m_addedGeoms++,this.m_maxDimension=Math.max(this.m_maxDimension,e)}removeAllBinsWithLowerDimension(e){for(let t=0;t<e;t++)this.m_unionBins[t].clear(),this.m_addedGeoms-=this.m_dimGeomCounts[t],this.m_dimGeomCounts[t]=0}collectGeometriesToUnion(e){if(1&this.m_options&&!this.m_bDone)return null;let t=null;const s=[];for(const t of this.m_unionBins[e].keys())s.push(t);r.numericSort(s);for(let n=0;n<s.length;n++){if(-1===s[n])continue;const i=this.m_unionBins[e].get(s[n]);{const r=5e3,o=4,a=i.getBinVertexCount()>r&&i.geomCount()>=o;if(this.m_bDone||a){for(let i=0;i<n;i++){if(-1===s[i])continue;const n=this.m_unionBins[e].get(s[i]);n.sort(),this.m_dimGeomCounts[e]-=n.geomCount(),this.m_addedGeoms-=n.geomCount();for(const e of n.geomPairs())t||(t=new Array),t.push(e.geom);n.clear(),this.m_unionBins[e].delete(s[i]),s[i]=-1}i.sort(),this.m_dimGeomCounts[e]-=i.geomCount(),this.m_addedGeoms-=i.geomCount();for(const e of i.geomPairs())t||(t=new Array),t.push(e.geom);if(i.clear(),this.m_unionBins[e].delete(s[n]),s[n]=-1,!this.m_bDone)break}}}return t}checkAndThrow(e){this.m_bIs3D&&(e.getDimension()>1&&s.throwInvalidGeometryTypeFor3DOps(),e.hasAttribute(1)||s.throwInvalidArgumentException("Geometry must have Zs")),s.throwIfMesh(e)}}class ti extends Un{getOperatorType(){return 3}execute(e,t,s,n=null){return Ze(e,t,s,4,n)}}function si(e,o,m){const h=o.getGCSSplitLines();if(null===h)return e;const l=o.getGCS(),u=l.getPannableExtent().width(),c=t.Envelope2D.constructEmpty();e.queryLooseEnvelope(c);const g=r.Envelope1D.constructEmpty();c.queryIntervalX(g);const d=h.querySegmentIterator();let p=null;const _=new a.Transformation2D;for(;d.nextPath();)for(;d.hasNextSegment();){const e=d.nextSegment(),t=e.queryInterval(0,0),s=r.Envelope1D.constructEmpty();s.setCoordsFromEnvelope(t);let i=0;for(;s.vmax>g.vmin;)s.move(-u),i--;for(;s.vmin<=g.vmax;){if(s.isIntersecting(g)){null===p&&(p=new n.Polyline);const t=new n.Line({start:e.getStartXY(),end:e.getEndXY()});0!==i&&(_.setShiftCoords(i*u,0),t.applyTransformation(_)),p.addSegment(t,!0)}s.move(u),++i}}if(null!==p){const t=i.calculateToleranceFromGeometryForOpFromGeom(l,p,!0);return function(e,t,n,i){const r=t.getGeometryType();if(s.isMultiPath(r))return new ve(i).crackAWithBMultiPath_(e,t,n);s.throwNotImplementedException("crack_A_with_B")}(e,p,i.adjustToleranceForTEClustering(t),m)}return e}function ni(t,s,n){let i=t.getName();return Br(i)||(n||s>0?(i=t.toString(e.peDefs.PE_STR_NAME_CANON|e.peDefs.PE_STR_AUTH_NONE),i=i.toLocaleUpperCase("en-US")):i=t.toString(e.peDefs.PE_STR_AUTH_TOP)),i}function ii(t,n=-1){if((n>1||n<-1)&&s.throwInvalidArgumentException("verbosity"),-1===n)return t.toString();{const s=0===n?e.peDefs.PE_STR_AUTH_TOP:e.peDefs.PE_STR_AUTH_ALL;return t.toString(s)}}function ri(e,n,r,o){if(e.isEmpty()||1===r)return e;const h=e.getGeometryType();if(h===s.GeometryType.enumPoint){const t=e,s=t.getXY();return 0===mi([s],1,n,r)||s.isNAN()?t.setEmpty():t.setXY(s),e}if(h===s.GeometryType.enumMultiPoint){const t=e,s=e.createInstance(),o=t.getPointCount();s.reserve(o);const a=t.getAttributeStreamRef(0),m=t.getDescription().getAttributeCount()>1,h=new i.Point,l=Float64Array.from(a.getArray());if(mi(l,o,n,r)>0)for(let e=0,n=2*o;e<n;e+=2)Number.isNaN(l[e])||(m?(t.getPointByVal(e>>1,h),h.setXYCoords(l[e],l[e+1]),s.add(h)):s.addXY(l[e],l[e+1]));return s}let l=e;const u=n.getOneDegreeGCSUnit(),c=90*u,g=180*u,d=360*u,p=n.getCentralMeridian(),_=.5*u,f=t.Envelope2D.constructEmpty();l.queryEnvelope(f);const y=n.getGCSHorizon(),x=n.getGCSHorisonIsInclusive(),P=y.getGeometryType()===s.GeometryType.enumEnvelope,E=t.Envelope2D.constructEmpty();y.queryEnvelope(E);const v=n.getGCS();if(2!==r&&4!==r||(E.xmin=p-g,E.xmax=E.xmin+d),4===r){if(!(f.width()>d-u)){const e=t.Envelope2D.constructEmpty();e.setCoords({xmin:f.xmin-u,ymin:E.ymin,xmax:f.xmax+u,ymax:E.ymax}),l=(new m.OperatorClip).execute(l,e,v,o);let s=Math.floor((p-f.getCenterX())/d);for(f.move(s*d,0);f.xmin>E.xmax;)s-=1,f.move(-d,0);for(;f.xmin<E.xmin;)s+=1,f.move(d,0);if(0!==s){const e=new a.Transformation2D;e.setShiftCoords(s*d,0),l.applyTransformation(e)}return l}r=2}if(2===r&&(E.xmin=p-g,E.xmax=E.xmin+d),f.ymin<-c||f.ymax>c){const e=t.Envelope2D.constructEmpty();if(e.setCoords({xmin:f.xmin-u,ymin:-c,xmax:f.xmax+u,ymax:c}),l=(new m.OperatorClip).execute(l,e,v,o),l.isEmpty())return l;l.queryEnvelope(f)}if(x&&(E.ymax<f.ymin||E.ymin>f.ymax))return l.createInstance();f.width()>d&&(l=yi(l,p-g,d,v,!0,0,!0,o),l.queryEnvelope(f));let C=(D=f.xmin,b=f.xmax,S=E.xmin,I=E.xmax,D>=S&&b<=I?0:fi(.5*(b+D),S,I,d));var D,b,S,I;if(0!==C&&f.move(C,0),f.xmax>E.xmax||f.xmin<E.xmin){if(f.xmax>E.xmax)for(;f.xmin>=E.xmax;)f.move(-d,0),C-=d;for(;f.xmin<E.xmax-d;)f.move(d,0),C+=d}const w=i.calculateToleranceFromGeometryForRelGeom(v,y,!1);if(0!==C){const e=new a.Transformation2D;e.setShiftCoords(C,0),l.applyTransformation(e),C=0}if(x){if(P&&E.containsEnvelope(f))return l;const e=new Array(2);for(let t=0;t<2;t++){let n;if(P?n=s.isMultiPath(h)?m.clip$1(l,E,w,_,o):m.clip$1(l,E,w,0,o):(n=(new Ws).execute(l,y,v,o),n===y&&(n=n.clone())),E.xmin<=f.xmin&&E.xmax>=f.xmax)return n;if(E.xmin>=f.xmin&&E.xmax<=f.xmax)return n;if(e[t]=n,0===t){f.move(-d,0);const e=new a.Transformation2D;e.setShiftCoords(-d,0),l.applyTransformation(e)}}return s.isMultiPath(h)?e[0].add(e[1],!1):s.throwInternalErrorException("intersect_with_GCS_horizon: unexpected geometry type"),e[0]}{if(E.ymax<f.ymin||E.ymin>f.ymax)return l;let e=0;for(;!l.isEmpty()&&f.xmax>E.xmin;){if(0!==e){const t=new a.Transformation2D;t.setShiftCoords(e,0),l.applyTransformation(t)}if((new ti).execute(l,y,v,o)||(l=(new Qn).execute(l,y,v,o),y===l&&(l=l.clone())),0!==e){const t=new a.Transformation2D;t.setShiftCoords(-e,0),l.applyTransformation(t)}e-=d,f.move(-d,0)}return l}}function oi(t,s,a,m,h,l){const u={stack:[],error:void 0,hasError:!1};try{if(2===l)return function(e,t,s,o,a){if(Math.abs(s.x-o.x)>Math.PI)return Number.NaN;if(Math.abs(s.y)>r.geometryHalfPi||Math.abs(o.y)>r.geometryHalfPi)return Number.NaN;if((Math.abs(s.y)===r.geometryHalfPi||Math.abs(o.y)===r.geometryHalfPi)&&s.x!==o.x)return Number.NaN;const{first:m,second:h}=r.minMax(s.x,o.x);let l=a;if(l=P(l,m,h),!r.Envelope1D.construct(s.x,o.x).containsCoordinate(l))return Number.NaN;const u=n.EPoint2D.constructPoint2D(s),c=n.EPoint2D.constructPoint2D(o),g=C(1,t,u),d=C(1,t,c),p=g.crossProductVector(d);if(p.z.isZero())return s.y;const _=p.x.divE(p.z.negate()),f=p.y.divE(p.z.negate()),y=_.mulE(_).addE(f.mulE(f)).sqrt();if(y.isZero()||_.isZero()&&f.isZero())return s.y;const x=Math.atan2(f.value(),_.value());let v=Math.atan2(y.value()*Math.cos(x-l),1-t);const D=E(1,t,r.Point2D.construct(l,v)),b=i.Point3D.construct(D.x,D.y,-D.z),S=p.value().dotProduct(D),I=p.value().dotProduct(b);return Math.abs(I)<Math.abs(S)&&(v=-v),v}(0,s,a,m,h);if(Math.abs(a.x-m.x)>=Math.PI||!Li(a.x,m.x,h))return Number.NaN;a.x>m.x&&(m=r.swap(a,a=m));const c=o.__addDisposableResource(u,new e.PeDoubleClass,!1),g=o.__addDisposableResource(u,new e.PeDoubleClass,!1),d=o.__addDisposableResource(u,new e.PeDoubleClass,!1),p=a.clone();e.peLineType.geodeticDistance(t,s,a.x,a.y,m.x,m.y,g,c,null,l);const _=g.val;let f=0,y=1;for(;_*(y-f)>1e-12*t;){const n=.5*(f+y);if(e.peLineType.geodeticCoordinate(t,s,a.x,a.y,_*n,c.val,g,d,l),p.x=g.val,p.y=d.val,p.x===h)return p.y;if(Li(a.x,p.x,h))y=n;else{if(!Li(m.x,p.x,h))return Number.NaN;f=n}}return p.y}catch(e){u.error=e,u.hasError=!0}finally{o.__disposeResources(u)}}function ai(e,t,s,n){for(let i=0,r=0;i<n;i++,r+=2)t[s+i].x=e[r],t[s+i].y=e[r+1]}function mi(e,n,o,a){if(0===n||1===a)return n;const m=function(e,t){let s;if(Array.isArray(e)){const n=e;s=new Float64Array(2*t);for(let e=0,i=0;e<t;e++,i+=2)s[i]=n[e].x,s[i+1]=n[e].y}else s=e;return s}(e,n);if(2===a){const t=o.getPannableExtentInGCS();let s=n;for(let e=0,i=2*n;e<i;e+=2)(m[e+1]>t.ymax||m[e+1]<t.ymin)&&(m[e]=Number.NaN,s--);return s?(xi(m,n,t.xmin,t.width(),!0),e!==m&&ai(m,e,0,n),s):0}const h=o.getOneDegreeGCSUnit(),l=90*h,u=180*h,c=360*h;let g=n;for(let e=0,t=2*n;e<t;e+=2)(m[e+1]>l||m[e+1]<-l)&&(m[e]=Number.NaN,g--);if(!g)return 0;const d=t.Envelope2D.constructEmpty();d.setFromPoints(m,n);const p=o.getGCSHorizon(),_=o.getGCSHorisonIsInclusive(),f=p.getGeometryType()===s.GeometryType.enumEnvelope,y=t.Envelope2D.constructEmpty();if(p.queryEnvelope(y),_&&(y.ymax<d.ymin||y.ymin>d.ymax))return 0;if(_)if(xi(m,n,y.getCenterX()-u,c,!0),g=n,f)for(let e=0,t=2*n;e<t;e+=2)y.containsCoords(m[e],m[e+1])||(m[e]=Number.NaN,g--);else{const e=i.calculateToleranceFromGeometryForRelGeom(o.getGCS(),p,!1),t=new r.Point2D;for(let s=0,i=2*n;s<i;s+=2)t.setCoords(m[s],m[s+1]),0!==Qt(p,t,e)||(m[s]=Number.NaN,g--)}else{xi(m,n,-u,c,!0),g=n;const e=i.calculateToleranceFromGeometryForRelGeom(o.getGCS(),p,!1),t=new r.Point2D;for(let s=0,i=2*n;s<i;s+=2){t.setCoords(m[s],m[s+1]),t.isNAN()&&g--;const n=fi(t.x,y.xmin,y.xmax,c);t.x+=n,0!==Qt(p,t,e)&&(m[s]=Number.NaN,g--)}}return g>0&&Array.isArray(e)&&ai(m,e,0,n),g}function hi(e,t,n,i,r,o){if(t.isPannable()||s.throwInvalidArgumentException("fold_into_360_degree_range"),e.isEmpty())return e;let a,m;if(2===t.getCoordinateSystemType()){const e=t.getPannableExtent();m=e.xmin,a=e.width()}else{const e=t.getOneDegreeGCSUnit();a=360*e,m=n-180*e}return yi(e,m,a,t,i,r,!0,o)}function li(e,t,s,n){let i,r;if(2===s.getCoordinateSystemType()){const e=s.getPannableExtent();i=e.xmin,r=e.width()}else{const e=s.getOneDegreeGCSUnit();r=360*e,i=n-180*e}xi(e,t,i,r)}function ui(e,t){const s=t.width();let n=r.fmod(e-t.vmin,s);return n<0&&(n+=s),t.snapClip(n+t.vmin)}function ci(e,t,s){return e>t.xmax&&e-t.xmax<s?t.xmax:e<t.xmin&&t.xmin-e<s?t.xmin:e}function gi(e,t,s){if(e[0]<t.vmin||e[0]>t.vmax||s&&e[0]===t.vmax){const s=t.width();return e[0]+=Math.ceil((t.vmin-e[0])/s)*s,e[0]=t.snapClip(e[0]),!0}return!1}function di(e,t,s,r,o){const a=new n.EditShape,m=a.addGeometry(e);return pi(a,m,t,i.calculateToleranceFromGeometryForRelGeom(t,e,!1),s,r,o),a.getGeometry(m)}function pi(t,i,a,m,h,l,u){const c={stack:[],error:void 0,hasError:!1};try{s.geometryReleaseAssert(wr()),a.isPannable()||s.throwInvalidCallException("insert_geodetic_points");const g=a.getPannableExtent(),d=a.getGCS(),p=Sr();d.querySpheroidData(p);const _=d.getUnit().getUnitToBaseFactor(),f=p.majorSemiAxis,y=p.e2;let x=0;const P=new r.Envelope1D;g.queryIntervalX(P);let E=null;const v=r.makePrimitiveArray(4,Number.NaN);2===a.getCoordinateSystemType()?(E=a.getPECoordSys(),l?(v[0]=ui(u,P),v[1]=g.getCenterY(),e.peCSTransformations.projToGeog(E,1,v),x=v[0]*_):(v[0]=g.getCenterX(),v[1]=u,e.peCSTransformations.projToGeog(E,1,v),x=v[1]*_)):x=u*_,l||0===x||2===h||s.throwInvalidCallException("insert_geodetic_points: 1");const C=o.__addDisposableResource(c,new e.PeDoubleClass,!1),D=new r.Point2D,b=new r.Point2D,S=new r.Point2D,I=new r.Point2D,w=new r.Point2D,A=new r.Point2D;for(let s=t.getFirstPath(i);s!==n.nullHandle;s=t.getNextPath(s)){const i=t.getFirstVertex(s);t.queryXY(i,S);let o=!1;const c=t.getNextVertex(i);for(let s=c;s!==n.nullHandle;s=t.getNextVertex(s)){if(s===c){if(o)break;o=!0}if(t.queryXY(s,I),l&&(m<u-S.x&&I.x-u>m||m<u-I.x&&S.x-u>m)||!l&&(0!==u||m<-S.y&&I.y>m||m<-I.y&&S.y>m))do{if(Math.abs(S.x-I.x)>=.5*P.width())break;2===a.getCoordinateSystemType()?(v[0]=ui(S.x,P),v[1]=S.y,v[2]=ui(I.x,P),v[3]=I.y,Ti(E,2,v,0),w.x=v[0]*_,w.y=v[1]*_,A.y=v[3]*_):(w.x=S.x*_,w.y=S.y*_,A.y=I.y*_),A.x=(I.x-S.x)*Math.PI*2/P.width()+w.x;let n=0;const i=r.makeObjectArray(r.Point2D,2);if(l){if(b.x=x,b.y=oi(f,y,w,A,x,h),Number.isNaN(b.y))break;i[0]=b,n=1}else if(2===h){const e=[0,0];if(n=T(0,y,w,A,x,e),!n)break;i[0].x=e[0],i[0].y=x,2===n&&(i[1].x=e[1],i[1].y=x)}else{if(b.x=Bi(f,y,w,A,h),Number.isNaN(b.x))break;b.y=0,i[0]=b,n=1}let o=-1;for(let m=0;m<n;m++){e.peLineType.geodeticDistance(f,y,w.x,w.y,A.x,A.y,C,null,null,h);const n=C.val;e.peLineType.geodeticDistance(f,y,w.x,w.y,i[m].x,i[m].y,C,null,null,h);const c=C.val;2===a.getCoordinateSystemType()?(v[0]=i[m].x/_,v[1]=i[m].y/_,e.peCSTransformations.geogToProj(E,1,v),l?(D.y=v[1],D.x=u):(D.x=zi(v[0],S.x,I.x,P),D.y=u)):l?(D.x=u,D.y=i[m].y/_):(D.x=zi(i[m].x/_,S.x,I.x,P),D.y=u);const g=n>0?r.snap(c/n,0,1):.5;if(0===g||1===g)continue;if(o>g)continue;const d=t.getPrevVertex(s);t.splitSegment(d,[g],1);const p=t.getNextVertex(d);t.setXYCoords(p,D.x,D.y),o=g}}while(0);S.setCoordsPoint2D(I)}}}catch(e){c.error=e,c.hasError=!0}finally{o.__disposeResources(c)}}function _i(e,n){s.geometryReleaseAssert(n.isPannable());const r=n.getPannableExtent();if(e.getGeometryType()===s.GeometryType.enumPoint){const t=e.getY();return r.ymin<=t&&t<=r.ymax?e:e.createInstance()}const o=t.Envelope2D.constructEmpty();e.queryEnvelope(o);const a=t.Envelope2D.constructEmpty();a.setCoords({env2D:r}),a.xmin=o.xmin,a.xmax=o.xmax,a.inflateCoords(.01*a.height(),0);const h=i.calculateToleranceFromGeometryForRel(n,o,!1);let l;return l=a.containsEnvelope(o)?e:m.clip$1(e,a,h,0,null),l}function fi(e,t,s,n){const i=.5*(s+t);return r.round((i-e)/n)*n}function yi(e,i,o,h,l,u,c,g){const d=e.getGeometryType(),p=r.Envelope1D.constructEmpty();p.setCoords(i,i+o);const _=[0];if(d===s.GeometryType.enumPoint){const t=e;if(_[0]=t.getX(),gi(_,p,c)){const t=l?e:e.clone();return t.setX(_[0]),t}return e}const f=t.Envelope2D.constructEmpty();if(e.queryEnvelope(f),f.isEmpty())return e;if(d===s.GeometryType.enumMultiPoint){const t=l?e:e.clone(),s=t.getImpl(),n=s.getAttributeStreamRef(0),i=2*s.getPointCount();let r=!1;for(let e=0;e<i;e+=2)_[0]=n.read(e),gi(_,p,c)&&(n.write(e,_[0]),r=!0);return r&&s.notifyModifiedFlags(2001),t}const y=r.Envelope1D.constructEmpty();if(f.queryIntervalX(y),p.contains(y))return p.vmax,y.vmax,e;const x=t.Envelope2D.constructEmpty();if(x.setCoords({env2D:f}),0===y.width()){let t=y.vmin;t+=Math.ceil((p.vmin-t)/o)*o,t=p.snapClip(t);const s=l?e:e.clone();return s.setAttributeBasic(0,0,t),s}if(d===s.GeometryType.enumEnvelope){const t=l?e:e.clone();return f.intersect(x),t.setEnvelope(f),t}const P=.1*Math.max(f.height(),f.width())*1;x.inflateCoords(0,P);let E=e;const v=h.getTolerance(0),C=new a.Transformation2D;for(;;){const e=Math.floor((y.vmin-i)/o),t=Math.ceil((y.vmax-i)/o);if(!(t-e>3))break;{const n=Math.floor(.5*(t+e));x.xmin=f.xmin-P,x.xmax=i+o*n;const r=m.clip$1(E,x,v,u,g);x.xmin=x.xmax,x.xmax=f.xmax+P;const a=m.clip$1(E,x,v,u,g);C.setShiftCoords((n-t)*o,0),a.applyTransformation(C),d===s.GeometryType.enumPolygon?E=(new $n).execute(r,a,h,g):(E=r,E.add(a,!1)),E.queryEnvelope(f),f.queryIntervalX(y)}}x.xmin=i,x.xmax=i+o;const D=t.Envelope2D.constructEmpty();D.setCoords({env2D:x}),D.inflateCoords(v,0);const b=Math.floor((f.xmin-x.xmin)/o)*o;let S;b?(x.move(b,0),C.setShiftCoords(-b,0)):C.setIdentity(),S=d===s.GeometryType.enumPolyline?new n.Polyline({vd:E.getDescription()}):new n.Polygon({vd:E.getDescription()});const I=t.Envelope2D.constructEmpty(),w=t.Envelope2D.constructEmpty();for(;f.xmax>x.xmin;){const e=m.clip$1(E,x,v,0,g);e.queryEnvelope(w);let t=!1;t=d===s.GeometryType.enumPolyline?!e.isEmpty()&&(w.width()>v||w.height()>v):!e.isEmpty()&&(d!==s.GeometryType.enumPolygon||w.width()>v),t&&(e.applyTransformation(C),e.queryEnvelope(w),S.queryEnvelope(I),I.inflateCoords(v,v),I.isIntersecting(w)&&d===s.GeometryType.enumPolygon?S=(new $n).execute(S,e,h,g):S.add(e,!1)),x.move(o,0),C.shiftCoords(-o,0)}return S}function xi(e,t,s,n,i=!0){const o=new r.Envelope1D;o.setCoords(s,s+n);const a=[0];if(Array.isArray(e)){const s=e;for(let e=0;e<t;e++)o.containsRightExclusive(s[e].x)||(a[0]=s[e].x,gi(a,o,i),s[e].x=a[0])}else{const s=e;for(let e=0;e<t;e++){const t=e<<1;o.containsRightExclusive(s[t])||(a[0]=s[t],gi(a,o,i),s[t]=a[0])}}}function Pi(e,n,i,r=!0){if(e.isEmpty())return;const o=e.getGeometryType();if(!r||o!==s.GeometryType.enumPolygon)if(s.isMultiVertex(o)){let t=!1;if(s.isMultiPath(o)&&e.hasNonLinearSegments()){const r=e.getImpl(),o=r.getAttributeStreamRef(0),a=r.getSegmentFlagsStreamRef();s.geometryReleaseAssert(null!==a);for(let e=0,s=r.getPathCount();e<s;e++){let s=!0;const m=r.isClosedPath(e),h=r.getPathEnd(e);m&&r.getPathSize(e)>0&&(s=1==(31&a.read(h-1)));for(let m=r.getPathStart(e);m<h;m++)if(1==(31&a.read(m))){if(s){const e=o.read(2*m),s=ci(e,n,i);s!==e&&(t=!0,o.write(2*m,s))}s=!0}else s=!1}}else{const s=e.getImpl(),r=s.getAttributeStreamRef(0);for(let e=0,o=s.getPointCount();e<o;e++){const s=r.read(2*e),o=ci(s,n,i);o!==s&&(t=!0,r.write(2*e,o))}}t&&e.getImpl().notifyModifiedFlags(2001)}else if(o===s.GeometryType.enumEnvelope){const s=e,r=t.Envelope2D.constructEmpty();s.queryEnvelope(r),r.xmin=ci(r.xmin,n,i),r.xmax=ci(r.xmax,n,i),s.setEnvelope(r)}else if(o===s.GeometryType.enumPoint){const t=e;t.setX(ci(t.getX(),n,i))}else s.throwInternalErrorException("")}function Ei(e,t,s){const n=new r.Point2D;return n.x=ci(e.x,t,s),n.y=e.y,n}function vi(n,o,a,h){const l=n.getGeometryType();s.geometryReleaseAssert(l===s.GeometryType.enumPolygon||l===s.GeometryType.enumPolyline||l===s.GeometryType.enumMultiPoint);const u=o.getCoordinateSystemType();if(2===u){let u=n;if(0===a){const a=function(s,n){if(n.isEmpty())return 0;const i=s.getPECoordSys();if(i.getProjection().getCode()===e.peDefs.PE_PRJ_AZIMUTHAL_EQUIDISTANT){const o=Sr();s.querySpheroidData(o);const a=i.getParameters();if(null===a[e.peDefs.PE_PARM_LAM0])return 0;if(null===a[e.peDefs.PE_PARM_PHI0])return 0;const m=[a[e.peDefs.PE_PARM_LAM0].getValue(),a[e.peDefs.PE_PARM_PHI0].getValue()];e.peCSTransformations.geogToProj(i,1,m);const h=new r.Point2D(m[0],m[1]),l=t.Envelope2D.constructEmpty();n.queryEnvelope(l);const u=r.makeObjectArray(r.Point2D,4);l.queryCorners(u);let c=0;const g=s.getOneMeter();let d=Math.max(o.majorSemiAxis,o.minorSemiAxis)*Math.PI,p=Math.min(o.majorSemiAxis,o.minorSemiAxis)*Math.PI;p-=d/180,d*=g,p*=g;for(let e=0;e<4;e++){const t=r.Point2D.distance(u[e],h);if(t>d)c++;else if(t>p)return-1}if(0===c)return 1;if(4===c){const e=t.Envelope2D.constructEmpty();return e.setCoords({center:h,width:d,height:d}),l.isIntersectingNe(e)?-1:0}return-1}return-1}(o,n);if(0===a)return n.createInstance();if(1===a)return n;const l=o.getPCSHorizon(),c=l.getGeometryType(),g=o.getDefaultPrecisionSR();if(c===s.GeometryType.enumEnvelope){const e=t.Envelope2D.constructEmpty();l.queryEnvelope(e);const s=i.calculateToleranceFromGeometryForRel(g,e,!1);u=m.clip$1(n,e,s,5e4*o.getOneMeterPCSUnit(),h)}else(new Zn).execute(l,n,g,h)||(u=(new Ws).execute(u,l,g,h),u===l&&(u=u.clone()))}else if(o.isPannable()){const e=t.Envelope2D.constructEmpty();u.queryEnvelope(e);const n=o.getPannableExtent();n.containsEnvelope(e)||(Pi(u,n,o.getTolerance(0)),2!==a&&4!==a||(u=_i(u,o)),4!==a?u=hi(u,o,0,!0,1e5*o.getOneMeterPCSUnit(),h):l===s.GeometryType.enumPolygon&&e.width()>2*n.width()&&(u=yi(u,-2*n.width(),2*n.width(),o,!0,0,!0,h)))}return u}if(s.geometryReleaseAssert(1===u),l===s.GeometryType.enumMultiPoint)return Pi(n,o.getPannableExtent(),o.getTolerance(0)),n;{const e=t.Envelope2D.constructEmpty();n.queryEnvelope(e);let i=n;const r=o.getPannableExtent();if(e.ymin<r.ymin||e.ymax>r.ymax){const s=Math.max(1,e.calculateToleranceFromEnvelope()),n=new t.Envelope2D(e.xmin-s,r.ymin,e.xmax+s,r.ymax);if(i=(new m.OperatorClip).execute(i,n,o,h),i.isEmpty())return i}return l===s.GeometryType.enumPolygon&&e.width()>2*r.width()&&(i=yi(i,-2*r.width(),2*r.width(),o,!0,0,!0,h)),i}}function Ci(t,s,n,i){if(!n)return;const o=t.getPECoordSys();if(1===n){const n=[s[0].x,s[0].y];if(e.peCSTransformations.geogToProj(o,1,n),i){const{first:e,second:i}=t.m_peCoordSysVal.getGeogToProjFactors();n[0]=e*(s[0].x-t.getCentralMeridian())+i}return void s[0].setCoords(n[0],n[1])}const a=t.isPannable(),m=a?t.getPannableExtent().width():0,h=179*m/360;let l=0;a&&(l=t.getCentralMeridian());const u=new Float64Array(512);for(let c=0;c<n;){for(let e=c;e<n&&s[e].isNAN();++e)c++;let g=Math.min(256,n-c);if(g>0){for(let e=1,t=c+1;e<g;++e,++t)if(s[t].isNAN()){g=e;break}for(let e=0;e<g;++e){const t=e<<1;u[t]=s[c+e].x,u[t+1]=s[c+e].y}if(e.peCSTransformations.geogToProj(o,g,u),i){const{first:e,second:n}=t.m_peCoordSysVal.getGeogToProjFactors();for(let t=0;t<g;++t)u[t<<1]=e*(s[c+t].x-l)+n}if(a)for(let e=0,t=c;e<g;e++,t++){const n=e<<1,i=u[n],o=r.sign(i),a=s[t].x-l;o*r.sign(a)<0&&Math.abs(i)>h&&(u[n]-=o*m)}ai(u,s,c,g),c+=g}}}function Di(t,n,i){s.geometryReleaseAssert(!i||t.isPannable());const o=n.getPointCount();if(!o)return;const a=n.getImpl(),m=a.getAttributeStreamRef(0),h=t.getPECoordSys();let l=0;const u=m.readRange(0,2*o);let c=()=>{e.peCSTransformations.geogToProj(h,o,u)};const g=t.isPannable()&&!i,d=g?t.getPannableExtent().width():0,p=179*d/360;if(t.isPannable()&&(l=t.getCentralMeridian(),i)){const s=t.m_peCoordSysVal.getGeogToProjFactors(),n=s.first,i=s.second;c=()=>{e.peCSTransformations.geogToProj(h,o,u);for(let e=0;e<o;e++){const t=e<<1,s=m.read(t),r=n*(s-l)+i;u[t]=r}}}if(c(),g)for(let e=0;e<o;e++){const t=e<<1,s=u[t],n=r.sign(s),i=m.read(t)-l;n*r.sign(i)<0&&Math.abs(s)>p&&(u[t]+=-n*d)}m.writeRangeFromArray(0,2*o,u,!0,1),a.notifyModifiedFlags(2001)}function bi(e,t,n){switch(t.getGeometryType()){case s.GeometryType.enumLine:return void function(e,t,s){const n=[t.getStartXY(),t.getEndXY()];Ci(e,n,2,s),t.setStartXY(n[0]),t.setEndXY(n[1]),t.normalizeAfterEndpointChange()}(e,t,n);case s.GeometryType.enumBezier:return void function(e,t,s){const n=r.makeObjectArray(r.Point2D,4);t.queryControlPoints(n),Oi(e,n,4,s),t.setControlPoints(n)}(e,t,n);case s.GeometryType.enumEllipticArc:return void function(e,t,s){if(0===t.projectionBehavior())!function(e,t,s){Xi(!0,e,0,t,s)}(e,t,s);else{const n=t.isClosed()&&t.isMajor(),i=[t.getStartXY(),n?t.getCenter():t.getEndXY()],r=[i[0].clone(),i[1].clone()];Oi(e,r,2,s);const o=new a.Transformation2D;o.initializeFromTwoPointsArray(i,r),t.applyTransformation(o);const m=n?0:1;t.setCoordsForIntersector(r[0],r[m],!1)}}(e,t,n);case s.GeometryType.enumBezier2:case s.GeometryType.enumRationalBezier2:return void s.geometryReleaseAssert(0);default:s.throwInternalErrorException("")}}function Si(t,o,a){if(!o.hasNonLinearSegments())return void Di(t,o,a);if(s.geometryReleaseAssert(!a||t.isPannable()),o.isEmpty())return;const m=t.getPECoordSys(),h=t.isPannable(),l=h?t.getPannableExtent().width():0,u=179*l/360;let c=0;h&&(c=t.getCentralMeridian());const g=o.createInstance();g.reserveParts(o.getPointCount(),o.getPathCount());const d=o.getImpl(),p=new n.SegmentBuffer;for(let s=0,n=o.getPathCount();s<n;++s)if(d.hasNonLinearSegmentsPath(s)){let e=!0,n=-1;const o=d.getPathStart(s),m=o+d.getSegmentCountPath(s);d.isClosedPath(s)&&(n=m-1);const h=new r.Point2D;for(let s=o;s<m;++s){if(d.getSegmentBuffer(s,p,!1),bi(t,p.get(),a),e||p.get().getStartXY().equals(h)||p.get().moveTo(h),s!==n)g.addSegment(p.get(),e);else{if(e){const e=new i.Point;p.get().queryStart(e),g.startPathPoint(e)}g.closeLastPathWithSegment(p.get())}h.assign(p.get().getEndXY()),e=!1}}else{const t=1024;let n,i=d.getPathSize(s),a=Math.min(i,t);g.insertPath(-1,o,s,!0);const p=d.getAttributeStreamRef(0),_=g.getAttributeStreamRef(0);for(let o=d.getPathStart(s),g=d.getPathEnd(s);o<g;){if(n=p.readRange(o,a),e.peCSTransformations.geogToProj(m,a,n),h)for(let e=0;e<a;e++){const t=e<<1,s=n[t],i=r.sign(s),o=p.read(2*(0+e))-c;i*r.sign(o)<0&&Math.abs(s)>u&&(n[t]+=-i*l)}_.writeRangeFromArray(o,a,n,!0,1),o+=a,i-=a,a=Math.min(i,t)}}o.assignMove(g)}function Ii(e,t,s){let n=s.getPointCount();if(!n)return;const i=s.getImpl(),o=i.getAttributeStreamRef(0);let a=Math.min(n,1e3),m=0;const h=e.getPECoordSys();Number.isNaN(t)&&(t=0);const l=e.isPannable(),u=e.getOneDegreeGCSUnit(),c=360*u,g=179*u;let d;for(;n;){if(d=o.readRange(2*m,2*a),Ti(h,a,d,t),l)for(let e=0;e<a;e++){const s=e<<1,n=d[s]-t,i=r.sign(n),a=o.read(2*(m+e));i*r.sign(a)<0&&Math.abs(n)>g&&(d[s]+=-i*c)}o.writeRangeFromArray(2*m,2*a,d,!0,1),m+=a,n-=a,a=Math.min(n,1e3)}i.notifyModifiedFlags(2001)}function wi(e,t,n){switch(n.getGeometryType()){case s.GeometryType.enumLine:return void function(e,t,s){const n=[s.getStartXY(),s.getEndXY()];Ni(e,t,n,2),s.setStartXY(n[0]),s.setEndXY(n[1]),s.normalizeAfterEndpointChange()}(e,t,n);case s.GeometryType.enumBezier:return void function(e,t,s){const n=r.makeObjectArray(r.Point2D,4);s.queryControlPoints(n),Yi(e,t,n,4),s.setControlPoints(n)}(e,t,n);case s.GeometryType.enumEllipticArc:return void function(e,t,s){if(0===s.projectionBehavior())!function(e,t,s){Xi(!1,e,t,s,!1)}(e,t,s);else{const n=s.isClosed()&&s.isMajor(),i=[s.getStartXY(),n?s.getCenter():s.getEndXY()],r=[i[0].clone(),i[1].clone()];Yi(e,t,r,2);const o=new a.Transformation2D;o.initializeFromTwoPointsArray(i,r),s.applyTransformation(o);const m=n?0:1;s.setCoordsForIntersector(r[0],r[m],!1)}}(e,t,n);case s.GeometryType.enumBezier2:case s.GeometryType.enumRationalBezier2:return void s.geometryReleaseAssert(0);default:s.throwInternalErrorException("")}}function Ti(t,n,i,r){const o=e.peCSTransformations.projToGeogCenter(t,n,i,r);for(let e=0;e<n;++e){const t=e<<1;s.geometryReleaseAssert(Number.isFinite(i[t]+i[t+1]))}return o}function Ai(e,t,s){if(!s.hasNonLinearSegments())return void Ii(e,t,s);if(s.isEmpty())return;const o=e.getPECoordSys();Number.isNaN(t)&&(t=0);const a=e.isPannable(),m=e.getOneDegreeGCSUnit(),h=360*m,l=179*m,u=s.createInstance();u.reserveParts(s.getPointCount(),s.getPathCount());const c=s.getImpl(),g=new n.SegmentBuffer;for(let n=0,m=s.getPathCount();n<m;++n)if(c.hasNonLinearSegmentsPath(n)){let s=!0,o=-1;const a=c.getPathStart(n),m=a+c.getSegmentCountPath(n);c.isClosedPath(n)&&(o=m-1);const h=new r.Point2D;for(let n=a;n<m;++n){if(c.getSegmentBuffer(n,g,!1),wi(e,t,g.get()),s||g.get().getStartXY().equals(h)||g.get().moveTo(h),n!==o)u.addSegment(g.get(),s);else{if(s){const e=new i.Point;g.get().queryStart(e),u.startPathPoint(e)}u.closeLastPathWithSegment(g.get())}h.assign(g.get().getEndXY()),s=!1}}else{const e=1e3;let i,m=c.getPathSize(n),g=Math.min(m,e);u.insertPath(-1,s,n,!0);const d=c.getAttributeStreamRef(0),p=u.getAttributeStreamRef(0);for(let s=c.getPathStart(n),u=c.getPathEnd(n);s<u;){if(i=d.readRange(2*s,2*g),Ti(o,g,i,t),a)for(let e=0;e<g;e++){const n=e<<1,o=i[n]-t,a=r.sign(o),m=d.read(2*s);a*r.sign(m)<0&&Math.abs(o)>l&&(i[n]+=-a*h)}p.writeRangeFromArray(2*s,2*g,i,!0,1),s+=g,m-=g,g=Math.min(m,e)}}s.assignMove(u)}function Ni(e,t,s,n){const i=e.getPECoordSys();Number.isNaN(t)&&(t=0);const o=e.isPannable(),a=e.getOneDegreeGCSUnit(),m=360*a,h=179*a,l=new Float64Array(512);for(let e=0;e<n;){for(let t=e;t<n&&s[t].isNAN();++t)e++;let a=Math.min(256,n-e);if(a>0){for(let t=1,n=e+1;t<a;++t,++n)if(s[n].isNAN()){a=t;break}for(let t=0;t<a;t++){const n=t<<1;l[n]=s[e+t].x,l[n+1]=s[e+t].y}if(Ti(i,a,l,t),o)for(let n=0,i=e;n<a;++n,++i){const e=n<<1,o=s[i].x,a=l[e]-t,u=r.sign(a);u*r.sign(o)<0&&Math.abs(a)>h&&(l[e]-=u*m)}for(let t=0;t<a;t++){const n=t<<1;s[e+t].x=l[n],s[e+t].y=l[n+1]}e+=a}}}function Gi(e,t,n,i){s.geometryReleaseAssert(0)}function Mi(e,t,s){let n=t.getPointCount();if(!n)return!1;const i=t.getImpl(),o=i.getAttributeStreamRef(0);let a=null;const m=e.getInputSR(),h=e.getOutputSR();m.getVCS(),h.getVCS();const l=m.getOneDegreeGCSUnit(),u=h.getOneDegreeGCSUnit(),c=e.isVertical();c&&t.hasAttribute(1)&&(a=i.getAttributeStreamRef(1));const g=e.getDatumTransformation(),d=!!g&&1===g.getType();if(d||null===a||(Gi(a.getArray()),a=null),!g||0===g.count()){const e=m.getGcsUnitFactor()/h.getGcsUnitFactor(),t=(m.getPrimeMeridian()-h.getPrimeMeridian())*u,s=-90*l,a=90*l;let c=0;const g=o.getArray(),d=[0];for(let e=1,t=2*n;e<t;)d[0]=g[e],c|=r.querySnap(d,s,a)?1:0,g[e]=d[0],e+=2;if(0!==t||1!==e){c=1;const s=o.getArray();for(let i=0,r=2*n;i<r;){let n=s[i];n*=e,n+=t,s[i]=n,s[i+1]*=e,i+=2}}return 0!==c&&i.notifyModifiedFlags(2001),!!c}let p=Math.min(n,1e3);const _=r.makePrimitiveArray(p,Number.NaN),f=r.makePrimitiveArray(p,Number.NaN);let y=null;null!==a&&(y=new Float64Array(p));let x=0,P=Number.NaN,E=Number.NaN;const v=360*u,C=u/l;s&&(E=90*u,P=89.9*l,f.fill(0));let D=!0,b=0;for(;n;){let e=!1;const t=o.readRange(2*x,2*p);for(let e=0;e<p;e++)_[e]=t[e<<1];if(s)for(let s=0;s<p;s++){const n=1+(s<<1),i=Math.abs(t[n])-P;if(i>0){const o=t[n];t[n]=r.copySign(P,o),f[s]=r.copySign(i,o),e=!0}}const i=t[0];if(d){const e=g;y&&a.queryRange(x,p,y,!0,1),e.transform(!1,t,y,p),y&&a.writeRangeFromArray(x,p,y,!0,1)}else g.transform(!1,t,p);D&&(b=t[0]-C*i,D=!1);for(let e=0;e<p;e++){const s=e<<1,n=t[s]-_[e]*C-b;Math.abs(n)>200&&(t[s]+=n>0?-v:v)}if(e){for(let e=0;e<p;e++)if(f[e]){const s=1+(e<<1);t[s]+=C*f[e],t[s]>E?t[s]=E:t[s]<-E&&(t[s]=-E)}f.fill(0)}o.writeRangeFromArray(2*x,2*p,t,!0,1),c&&a&&a.writeRangeFromArray(x,p,y,!0,1),x+=p,n-=p,p=Math.min(n,1e3)}return i.notifyModifiedFlags(2001),!0}function Ri(e,t,n){switch(t.getGeometryType()){case s.GeometryType.enumLine:return function(e,t,s){const n=[t.getStartXY(),t.getEndXY()];let i=null;t.hasAttribute(1)&&(i=[0,0],i[0]=t.getAttributeAsDbl(0,1,0),i[1]=t.getAttributeAsDbl(1,1,0));const r=Hi(e,n,i,2,s);return t.setStartXY(n[0]),t.setEndXY(n[1]),i&&(t.setStartAttribute(1,0,i[0]),t.setEndAttribute(1,0,i[1])),t.normalizeAfterEndpointChange(),r}(e,t,n);case s.GeometryType.enumBezier:return function(e,t,s){const n=r.makeObjectArray(r.Point2D,4);t.queryControlPoints(n);let i=null;t.hasAttribute(1)&&(i=[0,0,0,0],i[0]=t.getAttributeAsDbl(0,1,0),i[3]=t.getAttributeAsDbl(1,1,0),i[1]=r.lerp(i[0],i[3],.5),i[2]=i[1]);const o=Hi(e,n,i||null,n.length,s);return t.setControlPoints(n),i&&(t.setStartAttribute(1,0,i[0]),t.setEndAttribute(1,0,i[3])),t.normalizeAfterEndpointChange(),o}(e,t,n);case s.GeometryType.enumEllipticArc:return function(e,t,s){if(0===t.projectionBehavior())return function(e,t,s){const n=[t.getStartXY(),t.getEndXY(),t.getInteriorPoint(),t.getCenter()];let i=4;t.isDegenerateToLine()&&(i=2);const o=[0,0,0,0];let a=null;if(t.hasAttribute(1)){a=o,a[0]=t.getAttributeAsDbl(0,1,0),a[1]=t.getAttributeAsDbl(1,1,0);const e=r.lerp(a[0],a[1],.5);a[2]=e,a[3]=e}const m=t.getStartXY().equals(t.getEndXY())&&!t.isDegenerateToLine(),h=Hi(e,n,a,i,s);return m?t.constructCircleCenterAndPoint(n[3],n[0],!t.isClockwise()):t.isDegenerateToLine()?t.constructLineCircularArc(n[0],n[1]):t.constructCircularArcThreePoint(n[0],n[1],n[2]),a&&(t.setStartAttribute(1,0,a[0]),t.setEndAttribute(1,0,a[1])),h}(e,t,s);const n=t.getStartXY().equals(t.getEndXY()),i=r.makeObjectArray(r.Point2D,3),o=r.makeObjectArray(r.Point2D,3);let m=null;i[0].assign(t.getStartXY()),i[1].assign(n?t.getCenter():t.getEndXY());let h=!1;t.hasAttribute(1)&&(m=[0,0,0],m[0]=t.getAttributeAsDbl(0,1,0),m[1]=t.getAttributeAsDbl(1,1,0),m[2]=r.lerp(m[0],m[1],.5),n&&(m[1]=m[2])),o[0].setCoordsPoint2D(i[0]),o[1].setCoordsPoint2D(i[1]);const l=new a.Transformation2D;if(n||t.isDegenerateToLine())h=Hi(e,o,m,2,s),l.initializeFromTwoPoints(i[0],i[1],o[0],o[1]);else{const n=new r.Point2D;t.queryCoord2D(.5,n),i[2].setCoordsPoint2D(n),o[2].setCoordsPoint2D(n),h=Hi(e,o,m,3,s),l.setFromTwoTriangles(i,o)}return l.isIdentity()||(t.applyTransformation(l),t.setStartXY(o[0]),t.setEndXY(n?o[0]:o[1]),t.normalizeAfterEndpointChange()),m&&(t.setStartAttribute(1,0,m[0]),t.setEndAttribute(1,0,n?m[0]:m[1])),h}(e,t,n);case s.GeometryType.enumBezier2:case s.GeometryType.enumRationalBezier2:return s.geometryReleaseAssert(0),!1;default:s.throwInternalErrorException("")}}function ki(e,t,s){if(!t.hasNonLinearSegments())return Mi(e,t,s);if(t.isEmpty())return!1;const o=t.createInstance();o.reserveParts(t.getPointCount(),t.getPathCount());const a=t.getImpl(),m=new n.SegmentBuffer;for(let n=0,h=t.getPathCount();n<h;++n){let t=!0,h=-1;const l=a.getPathStart(n),u=l+a.getSegmentCountPath(n);a.isClosedPath(n)&&(h=u-1);const c=new r.Point2D;for(let n=l;n<u;++n){if(a.getSegmentBuffer(n,m,!1),Ri(e,m.get(),s),t||m.get().getStartXY().equals(c)||m.get().moveTo(c),n!==h)o.addSegment(m.get(),t);else{if(t){const e=new i.Point;m.get().queryStart(e),o.startPathPoint(e)}o.closeLastPathWithSegment(m.get())}c.assign(m.get().getEndXY()),t=!1}}return t.assignMove(o),!0}function Fi(e,t,s,n,i,o){if(e.isIdentityGeogToGeog()){const s=90*e.getInputSR().getOneDegreeGCSUnit();let i=0;const o=[0];for(let e=0;e<n;e++)o[0]=t[e].y,i|=r.querySnap(o,-s,s)?1:0,t[e].y=o[0];return i}const a=e.getInputSR(),m=e.getOutputSR(),h=a.getVCS(),l=m.getVCS(),u=a.getOneDegreeGCSUnit(),c=90*u,g=m.getOneDegreeGCSUnit(),d=e.isVertical(),p=e.getDatumTransformation(),_=!!p&&1===p.getType();if(d||(s=null),!p||0===p.count()){let e=0;const i=[0];for(let s=0;s<n;s++)i[0]=t[s].y,e|=r.querySnap(i,-c,c)?1:0,t[s].y=i[0];return e|=Xn(a.getGCS(),h,m.getGCS(),l,t,s,n)?1:0,e}_||null===s||Gi();let f=Math.min(n,1024);const y=r.makePrimitiveArray(f,Number.NaN),x=r.makePrimitiveArray(f,Number.NaN);let P=0,E=Number.NaN,v=Number.NaN;const C=360*g,D=g/u;i&&(v=90*g,E=89.9*u);let b=!0,S=0,I=n;for(;I;){let e=!1;for(let e=0;e<f;e++)y[e]=t[e+P].x;if(i)for(let s=0;s<f;s++){const n=Math.abs(t[s+P].y)-E;if(n>0){const i=t[s+P].y;t[s+P].y=r.copySign(E,i),x[s]=r.copySign(n,i),e=!0}}const n=t[0].x;_?p.transform(!1,t,s,f):p.transform(!1,t,f),b&&(S=t[0].x-D*n,b=!1);for(let e=0;e<f;e++){const s=t[P+e].x-y[e]*D-S;Math.abs(s)>200&&(s>0?t[P+e].x-=C:t[P+e].x+=C)}if(e){for(let e=0;e<f;e++)x[e]&&(t[P+e].y+=D*x[e],t[P+e].y>v?t[P+e].y=v:t[P+e].y<-v&&(t[P+e].y=-v));x.fill(0,0,f)}P+=f,I-=f,f=Math.min(I,1024)}return 1}function qi(e,t,n,i,r){return s.geometryReleaseAssert(0),0}function Vi(e,t,n,i,o){s.geometryReleaseAssert(null===i),s.geometryReleaseAssert(t<2147483647);const a=Array.isArray(n);let m;m=a?r.point2DArrayToFloat64Array(n):n;const h=ho.geogToGeog(e,t,m,null,o);return a&&r.float64ArrayToPoint2DArray2(m,n),h}function Hi(e,t,s,n,i,r){let o=0,a=!0,m=0;for(let r=0;r<n;++r)t[r].isNAN()?a||(o|=Fi(e,t.slice(m,r-m),s?s.slice(m,r-m):null,r-m,i),m=r,a=!0):a&&(m=r,a=!1);return a||(o|=Fi(e,0===m?t:t.slice(m),s?0===m?s:s.slice(m):null,n-m,i)),0!==o}function Oi(e,t,s,n){Ci(e,t,s,n)}function Yi(e,s,n,i){Ni(e,s,n,i);const r=new t.Envelope2D;r.setFromPoints(n,i);const o=e.getOneDegreeGCSUnit(),a=360*o,m=180*o;if(r.width()>m){for(let e=0;e<i;e++)for(;n[e].x<s;)n[e].x+=a;if(r.setFromPoints(n,i),r.xmax>m+s)for(let e=0;e<i;e++)n[e].x-=a}}function Xi(e,t,s,n,i){const o=r.makeObjectArray(r.Point2D,3);let a=0,m=!1,h=!1;const l=n.isDegenerateToLine();l?(o[0].assign(n.getStartXY()),o[1].assign(n.getEndXY()),o[2].setCoords(0,0),a=2):n.isClosed()&&n.isMajor()?(m=!0,h=!n.isClockwise(),o[0].assign(n.getStartXY()),o[1].assign(n.getCenter()),o[2].setCoords(0,0),a=2):(o[0].assign(n.getStartXY()),o[1].assign(n.getEndXY()),o[2].assign(n.getInteriorPoint()),a=3),e?Oi(t,o,a,i):Yi(t,s,o,a),l?n.constructLineCircularArc(o[0],o[1]):m?n.constructCircleCenterAndPoint(o[1],o[0],h):n.constructCircularArcThreePoint(o[0],o[1],o[2])}function Li(e,t,s){const i=n.convertToDegrees(e),r=n.convertToDegrees(t),o=n.shorterArcDistance(i,r),a=n.shorterArcDistance(i,n.convertToDegrees(s));return 0===a||o>0&&a>0&&a<=o||o<0&&a<0&&a>=o}function Bi(t,n,i,a,m){const h={stack:[],error:void 0,hasError:!1};try{const l=i.clone(),u=a.clone();if(2===m){const e=[0,0];return T(0,n,l,u,0,e),e[0]}if(l.y>u.y){const e=new r.Point2D;e.assign(l),l.assign(u),u.assign(e)}const c=o.__addDisposableResource(h,new e.PeDoubleClass,!1),g=o.__addDisposableResource(h,new e.PeDoubleClass,!1),d=o.__addDisposableResource(h,new e.PeDoubleClass,!1),p=new r.Envelope1D;if(p.setCoords(l.y,u.y),!p.containsCoordinate(0)||Math.abs(l.x-u.x)>=Math.PI)return Number.NaN;if(l.x===u.x)return l.x;e.peLineType.geodeticDistance(t,n,l.x,l.y,u.x,u.y,g,c,null,m);const _=g.val;let f=0,y=1;const x=l.clone();for(;_*(y-f)>1e-12*t;){const i=.5*(f+y);if(e.peLineType.geodeticCoordinate(t,n,l.x,l.y,_*i,c.val,g,d,m),x.x=g.val,x.y=d.val,p.setCoords(l.y,x.y),0===x.y)return x.x;if(p.containsCoordinate(0))y=i;else{if(p.setCoords(u.y,x.y),!p.containsCoordinate(0))return s.geometryReleaseAssert(!1),Number.NaN;f=i}}return x.x}catch(e){h.error=e,h.hasError=!0}finally{o.__disposeResources(h)}}function zi(e,t,s,n){const i=new r.Envelope1D;i.setCoords(t,s);const o=n.width();let a=Math.floor((e-t)/o)*o+e;const m=i.getCenter();for(;Math.abs(a-m)>Math.abs(a+o-m);)a+=o;return a}class Ui extends l.GeometryCursor{constructor(){super(),this.m_geometryDeque=[],this.m_index=-1}next(){if(this.m_geometryDeque.length>0){this.m_index++;const e=this.m_geometryDeque[0];return this.m_geometryDeque.shift(),e}return null}getGeometryID(){return this.m_index}tick(e){this.m_geometryDeque.push(e)}tock(){return!0}getRank(){return 1}}class ji{constructor(n,i=!0){this.m_PCSHorizon=null,this.m_GCSHorizon=null,this.m_GCSSplitLines=null,this.m_bGCSHorisonIsInclusive=!1,this.m_oneMeterPCS=0,this.m_oneDegreeGCS=0,this.m_gcsUnitFactor=0,this.m_northPole=r.Point2D.getNAN(),this.m_southPole=r.Point2D.getNAN(),this.m_polesUpdated=0,this.m_domain=t.Envelope2D.constructEmpty(),this.m_primeMeridian=Number.NaN,this.m_geogToProjFactor=1,this.m_geogToProjOffset=0,this.m_geogToProjFactorsUpdated=0,this.m_oneMillimeter=0,this.m_centralMeridian=0,this.m_pPCSInfoNoDomain=null,this.m_oldWKID=-1973,this.m_vcsWKID=-1,this.m_bIsPannable=!1,this.m_bCached=!1,this.m_pannableExtent=t.Envelope2D.constructEmpty(),this.m_pannableExtentGCS=t.Envelope2D.constructEmpty(),this.m_areaOfUse=null,this.m_canonicalWkt="",this.m_peCoordSys=n,this.m_WKID=e.peFactory.getCode(n),this.m_WKID<=0?(this.m_WKID=0,this.m_canonicalWkt=ni(n,0,!0),this.m_hashCode=r.hashString(this.m_canonicalWkt)):this.m_hashCode=r.nextRand(this.m_WKID);const o=this.m_peCoordSys.getType();this.m_csType=o===e.peDefs.PE_TYPE_PROJCS?2:1,s.geometryReleaseAssert(o===e.peDefs.PE_TYPE_PROJCS||o===e.peDefs.PE_TYPE_GEOGCS),o===e.peDefs.PE_TYPE_PROJCS&&(n.loadConstants()||s.throwInvalidArgumentException("PeProjcs.loadConstants failed"));const a=o===e.peDefs.PE_TYPE_GEOGCS?this.m_peCoordSys:this.m_peCoordSys.getGeogcs();o!==e.peDefs.PE_TYPE_GEOGCS&&e.peFactory.getCode(a),this.m_unit=function(t){const n=mo(null);return t.getType()===e.peDefs.PE_TYPE_PROJCS||t.getType()===e.peDefs.PE_TYPE_GEOGCS?n.reset(t.getUnit()):s.throwInvalidArgumentException("PE_coord_sys"),n.get()||s.throwInternalErrorException("cannot create units from coord sys"),function(t){return t.getType()===e.peDefs.PE_TYPE_LINUNIT?new yr(t):t.getType()===e.peDefs.PE_TYPE_ANGUNIT?new p(t):void s.throwInvalidArgumentException("peUnit")}(n.get())}(n),this.m_primeMeridian=a.getPrimem().getLongitude();{const e=a.getUnit().getUnitFactor();this.m_gcsUnitFactor=e;let t=Math.PI/(180*e);Math.abs(t-1)<1e-10&&(t=1),this.m_oneDegreeGCS=t}if(o===e.peDefs.PE_TYPE_PROJCS){const e=this.m_peCoordSys,t=e.getUnit().getUnitFactor();this.m_oneMeterPCS=1/t,this.m_oneMillimeter=.001/t,this.m_pPCSInfoNoDomain=lo.generate(e,lo.PE_PCSINFO_OPTION_NONE),this.m_pPCSInfoNoDomain||s.throwInternalErrorException("cannot create pcs info"),this.m_bIsPannable=this.m_pPCSInfoNoDomain.isPannableRectangle(),this.m_centralMeridian=this.m_pPCSInfoNoDomain.getCentralMeridian()}else{this.m_bIsPannable=!0,this.m_polesUpdated=1,this.m_oneMeterPCS=0;const e=1/a.getUnit().getUnitFactor(),t=a.getDatum().getSpheroid().getAxis();this.m_oneMillimeter=.001/t*e,this.m_centralMeridian=0}this.m_bIsPannable&&(this.updateGCSHorizon(),this.updatePCSHorizon(),this.updatePoles(),this.updateDomain(),this.updatePannableExtent(),this.updatePannableExtentGCS())}[Symbol.dispose](){}getHashCode(){return this.m_hashCode}getPCSHorizonPannable(){return this.m_PCSHorizon}getGCSHorizonPannable(){return this.m_GCSHorizon}getPCSInfo(){return s.geometryReleaseAssert(this.m_pPCSInfoNoDomain),this.m_pPCSInfoNoDomain}getCentralMeridian(){return this.m_centralMeridian}updateGCSHorizon(){if(this.m_peCoordSys.getType()!==e.peDefs.PE_TYPE_PROJCS)return;let o=!0;const h=this.m_peCoordSys,l=h.getGeogcs(),u=h.horizonGcsGenerate();if(!u)return;s.geometryReleaseAssert(u.length>0);const c=u[0].getNump(),g=u[0].getKind();let d,p;o=u[0].getInclusive()>0;const _=this.getOneDegreeGCSUnit(),f=90*_,y=360*_,x=370*_,P=180*_*e.peDefs.PE_HORIZON_DELTA/Math.PI,E=t.Envelope2D.constructEmpty();let v=null;if(c>1)for(let t=1;t<c;t++)if(u[t].getKind()===e.peDefs.PE_HORIZON_LINE){v||(v=new n.Polyline);const e=u[t].getCoord();v.startPathCoords(e[0][0],e[0][1]),v.lineToCoords(e[1][0],e[1][1])}if(g===e.peDefs.PE_HORIZON_RECT){const e=u[0].getCoord();if(E.setFromPoints([new r.Point2D(e[0][0],e[0][1]),new r.Point2D(e[1][0],e[1][1])],2),Math.abs(E.ymax-f)<1e-7*P&&(E.ymax=f),Math.abs(E.ymin+f)<1e-7*P&&(E.ymin=-f),E.width()>x){const e=-400*_,t=e+5*y;E.setCoords({xmin:e,ymin:E.ymin,xmax:t,ymax:E.ymax})}const t=new i.Envelope({env2D:E});this.m_GCSHorizon||(this.m_GCSHorizon=t,this.m_bGCSHorisonIsInclusive=o)}else{let i=this.getPCSInfo().isGcsHorizonMultiOverlap();const h=Mr(l,null,0,1),g=[],x=new r.Envelope1D;for(let s=0;s<c;s++){if(u[s].getKind()!==e.peDefs.PE_HORIZON_POLY)continue;d=u[s].getSize();const n=u[s].getCoord(),i=t.Envelope2D.constructEmpty();i.setFromPoints(r.coordinateArrayToPoint2DArray(n),d),g.push(new r.Envelope1D(i.xmin,i.xmax)),i.width(),x.merge(g.at(-1))}let P=!1;const E=new r.Envelope1D;x.width()>y&&g.length>1?(E.vmin=this.getCentralMeridian()-y,E.vmax=E.vmin+2*y,P=!0,i=!0):(E.vmin=x.vmin,E.vmax=E.vmin+y);const C=e=>{let t=0;for(;g[e].vmin+t<E.vmin;)t+=y;for(;g[e].vmax+t-y>E.vmin;)t-=y;return t};let D=new n.Polygon;if(i){const t=new Ui,s=(new $n).executeMany(t,h,null);for(let i=0;i<c;i++){if(u[i].getKind()!==e.peDefs.PE_HORIZON_POLY)continue;d=u[i].getSize();const o=u[i].getCoord();p=u[i].getInclusive()>0;const m=new n.Polygon;if(m.addPathPoint2D(r.coordinateArrayToPoint2DArray(o),d-1,!0),P){const e=C(i),s=g[i].clone();s.move(e);let n=e;const r=new a.Transformation2D;do{r.setShiftCoords(n,0);const e=m.clone();e.applyTransformation(r),t.tick(e),t.tock(),n+=y,s.move(y)}while(s.vmin<E.vmax)}else t.tick(m),s.tock()}D=s.next()}else{D=new n.Polygon;for(let t=0;t<c;t++){if(u[t].getKind()!==e.peDefs.PE_HORIZON_POLY)continue;d=u[t].getSize();const i=u[t].getCoord();if(p=u[t].getInclusive()>0,s.geometryReleaseAssert(p===o),P){const e=new n.Polygon;e.addPathPoint2D(r.coordinateArrayToPoint2DArray(i),d-1,!0);const s=C(t),o=g[t].clone();o.move(s);let m=s;const h=new a.Transformation2D;do{if(0!==m){h.setShiftCoords(m,0);const t=new n.Polygon({copy:e});t.applyTransformation(h),D.addPath(t,0,!0)}else D.addPath(e,0,!0);m+=y,o.move(y)}while(o.vmin<E.vmax)}else D.addPathPoint2D(r.coordinateArrayToPoint2DArray(i),d-1,!0)}}P&&(D=(new m.OperatorClip).execute(D,new t.Envelope2D(E.vmin,-f-_,E.vmax,f+_),h,null)),o?(new Ws).accelerateGeometry(D,h,1):(new Qn).accelerateGeometry(D,h,1),(new ti).accelerateGeometry(D,h,1),null===this.m_GCSHorizon&&(this.m_GCSHorizon=D,this.m_bGCSHorisonIsInclusive=o,this.m_GCSSplitLines=v)}}updateAreaOfUse(){return null}updatePCSHorizon(){if(this.m_peCoordSys.getType()!==e.peDefs.PE_TYPE_PROJCS)return;const o=this.m_peCoordSys.horizonPcsGenerate();if(!o)return;let a;this.getPCSInfo();const m=o[0].getKind();o[0].getInclusive();const l=t.Envelope2D.constructEmpty(),u=o[0].getNump();let c=!1;if(m===e.peDefs.PE_HORIZON_RECT){const e=o[0].getCoord();l.setFromPoints(r.coordinateArrayToPoint2DArray(e),2),a=new i.Envelope({env2D:l})}else{let t=-1;for(let s=0;s<u;s++)o[s].getKind()===e.peDefs.PE_HORIZON_POLY&&(t=s);s.geometryReleaseAssert(t>=0);const i=o[t].getSize()-1,m=o[t].getCoord(),h=new n.Polygon;a=h,h.addPathPoint2D(r.coordinateArrayToPoint2DArray(m),i,!0),c=!0}if(this.getPCSInfo().isDensificationNeeded()){s.geometryReleaseAssert(m!==e.peDefs.PE_HORIZON_RECT);const t=1e5*this.getOneMeterPCSUnit();a=(new h.OperatorDensify).execute(a,t,0,0,null)}if(c){{const e=new i.Envelope;a.queryEnvelope(e),a.calculateArea2D(),a.calculateLength2D(),a.getExteriorRingCount()}(new Ws).accelerateGeometry(a,null,1)}null===this.m_PCSHorizon&&(this.m_PCSHorizon=a)}updatePannableExtent(){const n=this.m_peCoordSys.getType();if(n===e.peDefs.PE_TYPE_PROJCS){const n=this.m_peCoordSys,i=this.getPCSInfo().getCentralMeridian(),r=n.getGeogcs();r||s.throwInternalErrorException("");const o=[i+1/r.getUnit().getUnitFactor()*Math.PI,0];e.peCSTransformations.geogToProj(n,1,o);const a=o[0],m=n.getParameters()[e.peDefs.PE_PARM_X0].getValue(),h=this.getPCSHorizon(),l=t.Envelope2D.constructEmpty();h.queryEnvelope(l);const u=Math.abs(a-m),c=u+m,g=-1*u+m,d=l.ymax,p=l.ymin;this.m_pannableExtent.setCoords({xmin:g,ymin:p,xmax:c,ymax:d})}else if(n===e.peDefs.PE_TYPE_GEOGCS){const e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtent.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else s.throwInternalErrorException("")}updatePannableExtentGCS(){const n=this.m_peCoordSys.getType();if(n===e.peDefs.PE_TYPE_PROJCS){const e=this.m_peCoordSys,n=this.m_centralMeridian,i=e.getGeogcs();i||s.throwInternalErrorException("");const r=1/i.getUnit().getUnitFactor()*Math.PI,o=this.getGCSHorizon(),a=t.Envelope2D.constructEmpty();o.queryEnvelope(a),this.m_pannableExtentGCS.setCoords({xmin:n-r,ymin:a.ymin,xmax:n+r,ymax:a.ymax})}else if(n===e.peDefs.PE_TYPE_GEOGCS){const e=1/this.m_peCoordSys.getUnit().getUnitFactor()*Math.PI;this.m_pannableExtentGCS.setCoords({xmin:-e,ymin:-e/2,xmax:e,ymax:e/2})}else s.throwInternalErrorException("")}updateDomain(){if(1===this.m_csType){const e=400*this.getOneDegreeGCSUnit();this.m_domain=t.Envelope2D.construct(-e,-e,e,e)}else{s.geometryReleaseAssert(2===this.m_csType);const e=lo.generate(this.m_peCoordSys,lo.PE_PCSINFO_OPTION_DOMAIN);e||s.throwInternalErrorException("generate pcs info failed");const n=new t.Envelope2D(e.getDomainMinx(),e.getDomainMiny(),e.getDomainMaxx(),e.getDomainMaxy());this.m_domain.isEmpty()&&this.m_domain.setCoords({env2D:n})}}updatePoles(){if(this.m_peCoordSys.getType()===e.peDefs.PE_TYPE_PROJCS){const t=90*this.getOneDegreeGCSUnit(),s=[[0,t],[0,-t]];e.peCSTransformations.geogToProj(this.m_peCoordSys,2,s);const n=this.getPCSInfo().getNorthPoleLocation()!==lo.PE_POLE_OUTSIDE_BOUNDARY,i=this.getPCSInfo().getSouthPoleLocation()!==lo.PE_POLE_OUTSIDE_BOUNDARY;this.m_polesUpdated||(n&&this.m_northPole.setCoords(s[0][0],s[0][1]),i&&this.m_southPole.setCoords(s[1][0],s[1][1]),this.m_polesUpdated=1)}else this.m_polesUpdated=1}updateGeogToProjFactors(){if(this.m_peCoordSys.getType()===e.peDefs.PE_TYPE_PROJCS){const t=this.getOneDegreeGCSUnit(),n=this.m_pPCSInfoNoDomain.getCentralMeridian(),i=[0,0,0,0];i[0]=n,i[1]=0,i[2]=n+t,i[3]=0;const r=e.peCSTransformations.geogToProj(this.m_peCoordSys,2,i);s.geometryReleaseAssert(2===r);const o=(i[2]-i[0])/t,a=i[0];0===this.m_geogToProjFactorsUpdated&&(this.m_geogToProjFactor=o,this.m_geogToProjOffset=a,this.m_geogToProjFactorsUpdated=1)}else this.m_geogToProjFactorsUpdated=1}getOneMeterPCSUnit(){return this.m_oneMeterPCS}getOneDegreeGCSUnit(){return this.m_oneDegreeGCS}getGcsUnitFactor(){return this.m_gcsUnitFactor}getUnitsPerMillimeter(){return this.m_oneMillimeter}getGCSSplitLines(){return this.m_bIsPannable?null:(this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSSplitLines)}getGCSHorizon(){return this.m_bIsPannable?this.getGCSHorizonPannable():(null!==this.m_GCSHorizon||this.updateGCSHorizon(),this.m_GCSHorizon)}getGCSHorisonIsInclusive(){return this.m_bIsPannable||this.getGCSHorizon(),this.m_bGCSHorisonIsInclusive}getPCSHorizon(){return this.m_bIsPannable?this.getPCSHorizonPannable():(null!==this.m_PCSHorizon||this.updatePCSHorizon(),this.m_PCSHorizon)}getPole(e){return this.m_bIsPannable||0!==this.m_polesUpdated||this.updatePoles(),e?this.m_southPole:this.m_northPole}getGeogToProjFactors(){return 0===this.m_geogToProjFactorsUpdated&&this.updateGeogToProjFactors(),r.makePair(this.m_geogToProjFactor,this.m_geogToProjOffset)}getDomainXY(){if(this.m_bIsPannable)return this.m_domain.clone();let e=!1;return e=this.m_domain.isEmpty(),e&&this.updateDomain(),this.m_domain.clone()}getPrimeMeridian(){return this.m_primeMeridian}getLatestID(){return this.m_WKID}getOldID(){let e=this.m_oldWKID;if(e<0){if(e=0,this.m_WKID>0){const t=[0],n=[0];(function(e,t,s,n){return t<=0?(s[0]=0,n[0]=0,!1):(s[0]=t,n[0]=t,!0)})(this.m_peCoordSys.getType(),this.m_WKID,t,n)||s.throwInternalErrorException("query_code_change"),e=t[0]}this.m_oldWKID=e}return e}isCustomWkid(){return!1}isPannable(){return this.m_bIsPannable}getPannableExtent(){return this.m_pannableExtent.clone()}getPannableExtentGCS(){return this.m_pannableExtentGCS.clone()}getAreaOfUse(){return null!==this.m_areaOfUse?this.m_areaOfUse:this.updateAreaOfUse()}getVcsCode(){return 0}saveMemory(){}getCSType(){return this.m_csType}getUnit(){return this.m_unit}setCached(){this.m_bCached=!0}getCached(){return this.m_bCached}static equal(e,t){return!1}static equal_for_projection(e,t){return!1}}class Wi{constructor(e,t=!0){this.m_oneMeter=0,this.m_WKID=-1,this.m_oldWKID=-1,this.m_canonicalWkt="not yet implemented",this.m_model=0,this.m_unit=new yr,this.m_cached=!1}setCached(e=!0){this.m_cached=e}getCached(){return this.m_cached}getOneMeterUnit(){return 0}getLatestID(){return this.m_WKID}getOldID(){let e=this.m_oldWKID;return e<0&&(e=0,this.m_WKID>0&&(e=this.m_WKID),this.m_oldWKID=e),e}getModel(){return 0}isCustomWkid(){return!1}getVerticalUnit(){return this.m_unit}static equal(e,t){return!1}static equal_for_projection(e,t){return!1}}function Zi(e,n,i,r){return function(e,n,i,r,o){return wr()||s.throwProjectionEngineNotLoadedException("cannot create projection transformation"),n.hasVCS()&&i.hasVCS()?(s.geometryReleaseAssert(0),{}):function(e,n,i,r){e&&n||s.throwInvalidArgumentException("!inputSR || !outputSR");const o=e.getLatestID(),a=n.getLatestID();if(3857===o&&4326===a){if(e.m_bDefaultDescriptor&&n.m_bDefaultDescriptor)return dr()}else if(4326===o&&3857===a&&e.m_bDefaultDescriptor&&n.m_bDefaultDescriptor)return cr||(cr=dr().getInverse()),cr;const m=t.Envelope2D.constructEmpty();m.setCoords({env2D:i});const h=e.getCoordinateSystemType(),l=n.getCoordinateSystemType();if(0===h||0===l)return er(e,n);if(r){const t=r.find(0,e.getGCS(),n.getGCS());if(t)return er(e,n,t)}const u=e.getGCS().getLatestID(),c=n.getGCS().getLatestID();if(u>0&&u===c)return er(e,n);const g=new hr(e,n,i);{const e=function(e){if(lr.has(e.getHashCode()))return lr.get(e.getHashCode())}(g);if(e)return e}const d=$i(0,e,n,m,1,!0);return function(e,t){return lr.set(e.getHashCode(),t),t}(g,er(e,n,d.length?d[0]:void 0))}(n,i,r,o)}(0,e,n,i,r)}function Qi(e,t,s,n){return Ki(!0,e,t,s,n)}function Ki(e,t,n,i,r,o){return wr()||s.throwProjectionEngineNotLoadedException("cannot create projection transformation"),new ir(e?2:1,t,n,i,r,o)}function $i(e,t,n,i,r,o=!1){if(t&&n||s.throwInvalidArgumentException(""),wr()||s.throwProjectionEngineNotLoadedException("cannot obtain geotransformation list"),1===e&&t.hasVCS()&&n.hasVCS())return s.throwNotImplementedException("hv xform not impl"),[];{const e=Co(t,n,i,r,o),s=[];for(const t of e)s.push(t);return s}}function Ji(){return{centralMeridianOfOutputGCS:Number.NaN,densificationStep:Number.NaN,clipWithInputHorizon:!0,clipWithOutputHorizon:!0,legacyHorizonClipping:!1,normalizeResultGeometry:!1,equals(e){return r.isEqualNonIEEE(this.centralMeridianOfOutputGCS,e.centralMeridianOfOutputGCS)&&r.isEqualNonIEEE(this.densificationStep,e.densificationStep)&&this.clipWithInputHorizon===e.clipWithInputHorizon&&this.clipWithOutputHorizon===e.clipWithOutputHorizon&&this.legacyHorizonClipping===e.legacyHorizonClipping&&this.normalizeResultGeometry===e.normalizeResultGeometry}}}function er(e,t,s,n,i){return new ir(1,e,t,s,n,i)}function tr(){return{flagsMask:0,setFlag(e,t){t?this.flagsMask|=e:this.flagsMask&=~e},hasFlag(e){return 0!==(this.flagsMask&e)}}}function sr(){return{m_extendedParams:Ji(),m_extendedParamsInternal:tr()}}function nr(){return sr()}let ir=class e{constructor(e,t,n,i,r,o){let a,m;this.m_datumTran=null,this.m_bIdentity=!0,this.m_bIdentityGeogToGeog=!0,this.m_bVertical=!1,this.m_bNormalize=!1,t&&n||s.throwInvalidArgumentException("!inputSR || !outputSR"),i&&0===i.getType()&&(i.m_bReadOnly=!0),this.m_bNormalize=!1,1!==e&&(a=t.getVCS(),m=n.getVCS(),this.m_bVertical=null!=a&&null!=m),this.m_inputSR=t,this.m_outputSR=n,this.m_bIdentity=!1,this.m_bIdentityGeogToGeog=!1,s.geometryReleaseAssert(!this.m_params),r&&(this.m_params=sr(),this.m_params.m_extendedParams=r),o&&(this.m_params||(this.m_params=sr()),this.m_params.m_extendedParamsInternal=o);let h=!1;const l=null!=i,u=t.getCoordinateSystemType(),c=n.getCoordinateSystemType();if(n.isPannable()&&0!==u&&r){const e=r.centralMeridianOfOutputGCS;if(!Number.isNaN(e)&&n.isPannable()){const t=n.getPannableExtent(),s=t.getCenterX();if(s!==e){const n=Math.ceil(t.width());e+n!==s+n&&(h=!0)}}}const g=r&&r.normalizeResultGeometry;if(t.equals(n))return this.m_bIdentity=!h,this.m_bIdentityGeogToGeog=!0,void this.updateProjector();const d=!l&&t.equalForProjection(n,this.m_bVertical);this.m_bIdentity=d&&!h,this.m_bIdentity?this.m_bIdentityGeogToGeog=!0:0!==u&&0!==c&&(g&&this.m_outputSR.isPannable()&&(this.m_bNormalize=g),this.m_datumTran=i||null,this.m_bIdentityGeogToGeog=(!this.m_datumTran||0===this.m_datumTran.count())&&this.m_inputSR.getGCS().equalForProjection(this.m_outputSR.getGCS(),this.m_bVertical)),this.updateProjector()}getInputSR(){return this.m_inputSR}getOutputSR(){return this.m_outputSR}getDatumTransformation(){return this.m_datumTran}getInverse(){const t=new e(1,this.m_outputSR,this.m_inputSR,this.m_datumTran?.createInverse());return t.m_bIdentity=this.m_bIdentity,t.m_bVertical=this.m_bVertical,t.m_bIdentityGeogToGeog=this.m_bIdentityGeogToGeog,t.updateProjector(),t}isIdentity(){return this.m_bIdentity}getExtendedParams(){return this.m_params?this.m_params.m_extendedParams:nr().m_extendedParams}equals(e){return s.geometryReleaseAssert(0),!1}isVertical(){return this.m_bVertical}isMatchingTransformation(e,t){return s.geometryReleaseAssert(0),!1}getGeographicTransformations(){return this.m_datumTran}getExtendedParamsImpl(){return this.m_params?this.m_params.m_extendedParams:nr().m_extendedParams}getExtendedParamsInternal(){return this.m_params?this.m_params.m_extendedParamsInternal:nr().m_extendedParamsInternal}isIdentityGeogToGeog(){return this.m_bIdentityGeogToGeog}normalizeOutput(){return this.m_bNormalize}updateProjector(){this.m_projector=new en(this)}};const rr=new Map,or=new Map,ar=new Map;function mr(t){let s=t.getCode();if(s>0)return fr(s)||_r(e.peFactory.coordsys(s));const n=t.getName();if(or.has(n)){const e=or.get(n);if(e&&e.deref()){const s=e.deref();if(s.m_peCoordSys.isEqual(t))return s}}return s=e.peFactory.getCode(t),_r(s>0?e.peFactory.coordsys(s):t)}class hr{constructor(e,t,s){this.m_hashCode=-1,e&&(this.m_inputSR=e,this.m_outputSR=t,this.m_env=s.clone(),this.m_hashCode=this.m_inputSR.getHashCode(),this.m_hashCode=r.hashCombine(this.m_hashCode,this.m_outputSR.getHashCode()),this.m_env.isEmpty()||(this.m_hashCode=r.hashCombine(this.m_hashCode,r.hashDouble(this.m_env.xmin)),this.m_hashCode=r.hashCombine(this.m_hashCode,r.hashDouble(this.m_env.xmax)),this.m_hashCode=r.hashCombine(this.m_hashCode,r.hashDouble(this.m_env.ymin)),this.m_hashCode=r.hashCombine(this.m_hashCode,r.hashDouble(this.m_env.ymax))))}getHashCode(){return this.m_hashCode}equals(e){return!(this.m_inputSR&&!e.m_inputSR||!this.m_inputSR&&e.m_inputSR)&&this.m_env.equals(e.m_env)&&this.m_inputSR.equals(e.m_inputSR)&&this.m_outputSR.equals(e.m_outputSR)}clear(){this.m_inputSR=void 0,this.m_outputSR=void 0,this.m_hashCode=-1,this.m_env=void 0}}const lr=new Map;let ur,cr,gr;function dr(){return ur||(ur=Qi(Qr(),$r())),ur}const pr=new Map;function _r(e){const t=mo(e),s=e.getCode();if(s>0){const e=fr(s);if(e)return e}const n=e.getName();let i=or.get(n);if(i){const t=i.deref();if(t&&t.m_peCoordSys.isEqual(e))return t}const r=new ji(t.release());if(s>0)return r.setCached(),rr.set(s,new WeakRef(r)),or.set(n,new WeakRef(r)),r;const o=ni(e,0,!1);if(i=ar.get(o),i){const e=i.deref();if(e)return e}return r.setCached(),ar.set(o,new WeakRef(r)),r}function fr(e){const t=rr.get(e);if(t)return t.deref()}class yr extends g{constructor(t){return void 0===t?(super(),this.m_wkid=9001,void(this.m_peUnit=null)):"number"==typeof t?(super(),this.m_factor=t,void(this.m_wkid=0)):(super(t),void(t||(this.m_factor=1,this.m_wkid=9001,this.m_peUnit=(gr||(gr=e.peFactory.unit(9001)),gr))))}getUnitType(){return 0}convertFromMeters(e){return e/this.getUnitToBaseFactor()}convertToMeters(e){return e*this.getUnitToBaseFactor()}}const xr=["0","1","2","3","4","5","6","7","8","9","b","c","d","e","f","g","h","j","k","m","n","p","q","r","s","t","u","v","w","x","y","z"];function Pr(e,t,n,i,r){s.geometryReleaseAssert(i>>5<r.length);let o=t,a=n;for(let t=i;t>=0;t-=2){const s=31&t,n=.5*(a+o);e>=n?(r[t>>5]|=1<<s,o=n):a=n}}let Er=new Set;const vr=2147483645n,Cr=9007199254740990n,Dr="operation is not supported for unknown coordinate systems";var br;function Sr(){return{majorSemiAxis:0,e2:0,minorSemiAxis:0,flattening:0,isSphere(){return 0===this.e2}}}function Ir(e){po=e,s.geometryReleaseAssert(po)}function wr(){return!!e.peFactory}function Tr(){return!!po}function Ar(){return!!e.peFactory||!!po}function Nr(e,t,n){return s.geometryReleaseAssert(Ar()),no(e,void 0===t?0:t,0,!1)}function Gr(t,n){s.geometryReleaseAssert(Ar());const i=new Wr;let r;return wr()?(r=function(t){const n=mo(e.peFactory.fromString(e.peDefs.PE_TYPE_COORDSYS,t));return n.get()||s.throwInvalidWktException(t),mr(n.release())}(t),i.setHorzProj_(r),i.m_vertcs=null,i.m_userWKID=r.getLatestID()):(r=_o(t),i.m_unit=r.isPCS?new yr(r.metersOrRadiansPerUnit):new p(r.metersOrRadiansPerUnit)),eo(i.m_precisionDescriptor,r,null,1),i.m_bDefaultDescriptor=!0,i.m_userWKT=t,i.calculateHashCode(),i.initDbgName(),i}function Mr(e,t,n,i,r=!0){let o=null;return t&&(s.geometryReleaseAssert(0),o={}),function(e,t,n,i,r){e||s.throwInvalidArgumentException("!PE_coord_sys");const o=new Wr;let a;return a=r?mr(e):new ji(e,!1),eo(o.m_precisionDescriptor,a,t,i),o.m_bDefaultDescriptor=!0,o.setHorzProj_(a),o.m_vertcs=t,o.m_userWKID=a.getLatestID(),o.calculateHashCode(),o.initDbgName(),o}(e,o,0,i,r)}function Rr(e,t,n=!1){3===e.getCoordinateSystemType()&&s.throwInvalidArgumentException("image spatial reference cannot be altered");const i=new Wr,r=e;return i.m_peCoordSysVal=r.m_peCoordSysVal,i.m_vertcs=r.m_vertcs,i.m_unit=r.m_unit,i.m_precisionDescriptor.assign(t),i.m_localZToXYFactor=r.m_localZToXYFactor,(Number.isNaN(i.m_precisionDescriptor.m_falseX)||Number.isNaN(i.m_precisionDescriptor.m_falseY))&&(i.m_precisionDescriptor.m_falseX=r.m_precisionDescriptor.m_falseX,i.m_precisionDescriptor.m_falseY=r.m_precisionDescriptor.m_falseY),i.m_precisionDescriptor.snapPrecision(),i.m_precisionDescriptor.fixTolerance(),i.m_userWKID=r.m_userWKID,i.m_precisionDescriptor.equals(r.m_precisionDescriptor)?i.m_bDefaultDescriptor=r.m_bDefaultDescriptor:i.m_bDefaultDescriptor=!1,n&&(i.m_bDefaultDescriptor=!0),i.calculateHashCode(),i.initDbgName(),i}function kr(e,t,n){void 0===t&&(t=1),(t<=0||!Number.isFinite(t))&&s.throwInvalidArgumentException(""),e||1===t||s.throwInvalidArgumentException("null Unit has to have z_to_xy_factor equal to 1");const i=new Wr;i.m_unit=e;const r=e||new yr(9001);return so(i.m_precisionDescriptor,r,null,1),i.m_bDefaultDescriptor=!0,Number.isNaN(i.m_precisionDescriptor.m_falseX)&&s.throwInvalidArgumentException("NAN false X/Y are not allowed here"),i.m_localZToXYFactor=t,i.calculateHashCode(),i.initDbgName(),i}function Fr(e,t){return e.snapGeometry(t)}function qr(e){const t=e.getCoordinateSystemType();return 1===t?e:(3===t&&s.geometryReleaseAssert(0),e.getGCS())}function Vr(t){return s.geometryReleaseAssert(Ar()),Tr()?function(t){return s.geometryReleaseAssert(Tr()),!!po(t).isPCS||(n=t,e.peFactory&&s.throwInvalidCallException("pe has been loaded. no-pe methods should not be used at this point."),ro||yo(),ro.has(n));var n}(t):function(t){if(pr.has(t))return pr.get(t);{const s=function(t){return null!==mo(e.peFactory.coordsys(t)).get()}(t);return pr.set(t,s),s}}(t)}function Hr(t){if(wr())return null!==mo(e.peFactory.fromString(e.peDefs.PE_TYPE_COORDSYS,t)).get();try{return _o(t),!0}catch(e){}return!1}let Or;function Yr(){return Or||(Or=(()=>{const e=Math.trunc(Math.random()*r.intMax()),t=Date.now();return`|abba_000|${e.toString(16)}|${t.toString(16)}|`})()),Or}!function(e){e[e.utmDefault=0]="utmDefault",e[e.utmNorthSouth=1]="utmNorthSouth"}(br||(br={}));let Xr=0;function Lr(e=""){let t=`${Yr()}${Xr++}`;return""!==e&&(t+=`|${e}`),t}function Br(e){return e.startsWith(Yr())}let zr,Ur,jr,Wr=class t{destroy(){var e;e=this.m_peCoordSysVal,or.delete(e.m_peCoordSys.getName()),ar.delete(ni(e.m_peCoordSys,0,!1)),1===this.getCoordinateSystemType()||2===this.getCoordinateSystemType()?this.getPECoordSys().destroy():s.throwInternalErrorException("SpatialReference.destroy")}constructor(){this.m_vertcs=null,this.m_peCoordSysVal=null,this.m_userWKID=0,this.m_userWKT=null,this.m_geogSpatialReference=null,this.m_srToGcs=null,this.m_gcsToSr=null,this.m_defaultPrecisionSR=null,this.m_localZToXYFactor=-1,this.m_precisionDescriptor=new Zr,this.m_hashCode=0,this.m_bDefaultDescriptor=!1,Jr(this.m_precisionDescriptor),Er&&Er.add(new WeakRef(this))}attachToPe(){(this.m_userWKID>0?Nr(this.m_userWKID):Gr(this.m_userWKT)).copyTo(this,!1)}copyTo(e,t=!0){(t||e.m_bDefaultDescriptor)&&(e.m_bDefaultDescriptor=this.m_bDefaultDescriptor,e.m_precisionDescriptor.assign(this.m_precisionDescriptor)),e.m_defaultPrecisionSR=null,e.m_gcsToSr=this.m_gcsToSr,e.m_geogSpatialReference=this.m_geogSpatialReference,e.m_hashCode=this.m_hashCode,e.m_localZToXYFactor=this.m_localZToXYFactor,e.m_peCoordSysVal=this.m_peCoordSysVal,e.m_srToGcs=this.m_srToGcs,e.m_userWKID=this.m_userWKID,e.m_userWKT=this.m_userWKT,e.m_vertcs=this.m_vertcs,e.m_unit=this.m_unit}getHashCode(){return this.m_hashCode}getHashCodeHorizontal(){let e=0;return e=this.m_peCoordSysVal?this.m_peCoordSysVal.getHashCode():this.m_unit?this.m_unit.getHashCode():305419891,e}updateTransform(e){if(1===this.getCoordinateSystemType())return Qi(this,this,null);let t=e?this.m_srToGcs:this.m_gcsToSr;if(t)return t;const s=this.getGCS();t=e?Qi(this,s,null):Qi(s,this,null);const n=t;return(e?this.m_srToGcs:this.m_gcsToSr)||(e?this.m_srToGcs=n:this.m_gcsToSr=n,t)}getHashCodeVertical(){return this.m_vertcs?this.m_vertcs.getHashCode():0}calculateHashCode(){let e=this.getHashCodeHorizontal();const t=this.getHashCodeVertical(),s=this.m_precisionDescriptor.getHashCode();e=r.hashCombine(e,t),this.m_hashCode=r.hashCombine(e,s)}initDbgName(){}setHorzProj_(e){this.m_peCoordSysVal=e,this.m_unit=this.m_peCoordSysVal.getUnit()}getTolerance(e=0){return this.m_precisionDescriptor.getTolerance(e)}getResolution(e=0){return this.m_precisionDescriptor.getResolution(e)}getPECoordSys(){return this.m_peCoordSysVal?this.m_peCoordSysVal.m_peCoordSys:null}getPCSInfo(){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSInfo()}getCentralMeridian(){return this.throwIfNotGCSOrPCS(),1===this.getCoordinateSystemType()?0:this.getPCSInfo().getCentralMeridian()}getCoordinateSystemType(){const t=this.getPECoordSys();if(t)switch(t.getType()){case e.peDefs.PE_TYPE_GEOGCS:return 1;case e.peDefs.PE_TYPE_PROJCS:return 2;default:return 0}else{if((this.m_userWKID>0||this.m_userWKT)&&this.m_unit instanceof yr)return 2;if(this.m_unit instanceof p)return 1}return 0}getID(){return this.m_userWKID}getLatestID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getLatestID():this.m_userWKID}getOldID(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getOldID():this.m_userWKID}getVerticalID(){return s.throwNotImplementedException("vcs not implemented"),0}getLatestVerticalID(){return this.m_vertcs?this.m_vertcs.getLatestID():0}getOldVerticalID(){return s.throwNotImplementedException("vcs not implemented"),0}getPEVerticalCoordSys(){return null}getPole(e){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPole(e)}getText(){const e=this.getPECoordSys();return e?ii(e):this.m_userWKT??""}getTextExtended(e){const t=this.getPECoordSys();return t?this.getPEVerticalCoordSys()?(this.getPEVerticalCoordSys(),s.geometryReleaseAssert(0),""):ii(t,e):this.m_userWKT??""}getText2(t=-1){const n=this.getPECoordSys();return n?function(t,n){(n>1||n<-1)&&s.throwInvalidArgumentException("verbosity");let i=e.peDefs.PE_STR_FMT_WKT2;return-1!==n&&(i|=0===n?e.peDefs.PE_STR_AUTH_TOP:e.peDefs.PE_STR_AUTH_ALL),t.toString(i)}(n,t):this.m_userWKT??""}getUnit(){return this.m_unit}getUnitsPerMillimeter(){return this.m_peCoordSysVal?this.m_peCoordSysVal.getUnitsPerMillimeter():this.m_unit instanceof yr?.001/this.m_unit.getUnitToBaseFactor():this.m_unit instanceof p?.001/(_o(this.m_userWKT??this.m_userWKID).semiMajor*this.m_unit.getUnitToBaseFactor()):(s.throwInvalidCallException("sr object not in valid state"),0)}getAuthorityName(){return this.getPECoordSys()?(s.geometryReleaseAssert(0),""):""}getVerticalUnit(){return s.throwNotImplementedException("vcs not implemented"),{}}getVCS(){return this.m_vertcs}hasVCS(){return!1}getGCSHorisonIsInclusive(){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorisonIsInclusive()}getGCSHorizon(){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSHorizon()}getGCS(){const e=this.getCoordinateSystemType();if(0===e)s.throwInvalidCallException(Dr);else{if(1===e)return this;3===e&&s.throwInvalidCallException("image cs not supported")}if(this.m_geogSpatialReference)return this.m_geogSpatialReference;let t;if(this===Qr()||this===Kr())t=$r();else{s.geometryReleaseAssert(this.m_peCoordSysVal);const e=this.m_peCoordSysVal.m_peCoordSys.getGeogcs();e||s.throwInternalErrorException(""),t=Mr(e,this.m_vertcs,0,this.m_precisionDescriptor.getPrecision(),this.m_peCoordSysVal.getCached())}return this.m_geogSpatialReference?t=this.m_geogSpatialReference:this.m_geogSpatialReference=t,t}getGCSSplitLines(){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getGCSSplitLines()}toGCS(e,t){if(0===e.length)return 0;e.length>t.length&&s.throwInvalidArgumentException("coordsSrc.size() > coordsDst.size()");const n=this.getCoordinateSystemType();if(0===n&&s.throwInvalidCallException(Dr),1===n)return r.assignObjectArray(t,e,e.length),e.length;s.geometryReleaseAssert(this.m_peCoordSysVal);const i=this.getSRToGCSTransform();return(new nn).transform(i,e,e.length,t)}toGeohash(e,t=8){const s=e.clone();s.scale(9102===this.getGCS().getUnit().getID()?1:this.getGCS().getUnit().getUnitToBaseFactor()/Math.PI*180),s.x<-180?(s.x=r.fmod(s.x,360),s.x<-180&&(s.x+=360)):s.x>180&&(s.x=r.fmod(s.x,360),s.x>180&&(s.x-=360)),s.y>90&&(s.y=90),s.y<-90&&(s.y=-90);const n=5*t,i=new Uint32Array(4);return Pr(s.x,-180,180,n-1,i),Pr(s.y,-90,90,n-2,i),function(e,t,s){const n=r.makePrimitiveArray(t,"R");let i=0,o=0;for(let s=0;s<t;s++){let r=e[i]>>o&31;if(o+=5,o>31){const t=37-o;r&=(1<<t)-1,o-=32,i++,r|=(e[i]&(1<<o)-1)<<t}const a=xr[r];n[t-1-s]=a}return s>t?n.push(..."0".repeat(s-t)):s<t&&(n.length=s),n.join("")}(i,t,t)}isPannable(){const e=this.getCoordinateSystemType();return 0!==e&&3!==e&&(s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.isPannable())}getPannableExtent(){return this.isPannable()||s.throwInvalidArgumentException("!is_pannable"),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtent()}getPannableExtentInGCS(){return this.isPannable()||s.throwInvalidArgumentException("!is_pannable"),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPannableExtentGCS()}throwIfNotGCSOrPCS(){const e=this.getCoordinateSystemType();1!==e&&2!==e&&s.throwInvalidArgumentException("Not a GCS or PCS")}getDomainXY(){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getDomainXY()}getFullWorldExtent(){return this.throwIfNotGCSOrPCS(),this.isPannable()?this.getPannableExtent():this.getDomainXY()}queryPrecisionDescriptor(e){if(e.assign(this.m_precisionDescriptor),Number.isNaN(e.m_falseX))if(wr()||s.throwProjectionEngineNotLoadedException("cannot query precision descriptor"),s.geometryReleaseAssert(null!==this.m_peCoordSysVal),2!==this.m_precisionDescriptor.m_precision){const t=this.m_peCoordSysVal.getDomainXY();e.m_falseX=t.xmin,e.m_falseY=t.ymin}else e.m_falseX=-Number.MAX_VALUE,e.m_falseY=-Number.MAX_VALUE}queryPrecisionDescriptorWithoutFalseXY(e){e.assign(this.m_precisionDescriptor),e.m_falseX=Number.NaN,e.m_falseY=Number.NaN}queryDefaultPrecisionDescriptorWithoutFalseXY(e){if(this.m_bDefaultDescriptor)e.assign(this.m_precisionDescriptor);else{const t=this.getCoordinateSystemType();0===t?so(e,this.m_unit,this.m_vertcs,this.m_precisionDescriptor.getPrecision()):3===t?s.throwNotImplementedException("image cs"):eo(e,this.m_peCoordSysVal,this.m_vertcs,this.m_precisionDescriptor.getPrecision())}e.m_falseX=Number.NaN,e.m_falseY=Number.NaN}horizontalEqual(e){return(t=this.m_peCoordSysVal)===(s=e.m_peCoordSysVal)||null!==t&&null!==s&&t.m_csType===s.m_csType&&(0===t.m_WKID&&0===s.m_WKID?t.m_hashCode===s.m_hashCode&&t.m_canonicalWkt===s.m_canonicalWkt:t.m_WKID===s.m_WKID);var t,s}verticalEqual(e){return null!==this.m_vertcs==(null!==e.m_vertcs)&&(!this.m_vertcs||this.m_vertcs.equals(e.m_vertcs))}equals(e){const t=e;if(this===t)return!0;if(!this.horizontalEqual(t)||!this.verticalEqual(t))return!1;if(!t.m_peCoordSysVal){if(s.geometryReleaseAssert(!this.m_peCoordSysVal),null!==this.m_unit!=(null!==t.m_unit))return!1;if(this.m_unit&&!this.m_unit.equals(t.m_unit))return!1;if(this.m_localZToXYFactor!==t.m_localZToXYFactor)return!1}if(!this.m_bDefaultDescriptor||!t.m_bDefaultDescriptor){if(this.m_peCoordSysVal){if(!this.m_precisionDescriptor.equalsWithoutFalseXY(t.m_precisionDescriptor))return!1;s.geometryReleaseAssert(t.m_peCoordSysVal);let e=this.m_precisionDescriptor.m_falseX,n=this.m_precisionDescriptor.m_falseY;if(Number.isNaN(e)){const t=this.m_peCoordSysVal.getDomainXY();e=t.xmin,n=t.ymin}let i=t.m_precisionDescriptor.m_falseX,r=t.m_precisionDescriptor.m_falseY;if(Number.isNaN(i)){const e=t.m_peCoordSysVal.getDomainXY();i=e.xmin,r=e.ymin}return e===i&&n===r}return this.m_precisionDescriptor.equals(t.m_precisionDescriptor)}return!0}equalForProjection(e,t){if(this===e)return!0;const s=this.getCoordinateSystemType(),n=e.getCoordinateSystemType();if(0===s||0===n)return 0===s&&0===n?(!t||this.getZToXYFactor()===e.getZToXYFactor())&&(!this.getUnit()||!e.getUnit()||this.getUnit().equals(e.getUnit())):3!==s&&3!==n&&(null===this.getUnit()||null===e.getUnit()||(!t||this.getZToXYFactor()===e.getZToXYFactor())&&this.getUnit().equals(e.getUnit()));if(s!==n)return!1;if(3===s)return this.equals(e);if((i=this.m_peCoordSysVal)===(r=e.m_peCoordSysVal)||null!==i&&null!==r&&i.m_csType===r.m_csType&&(0===i.m_WKID&&0===r.m_WKID?1===i.m_csType?i.m_peCoordSys.isEqual(r.m_peCoordSys):i.m_peCoordSys===r.m_peCoordSys:i.m_WKID===r.m_WKID)){if(!t)return!0;if(null!==this.m_vertcs==(null!==e.m_vertcs))return!this.m_vertcs||this.m_vertcs.equalForProjection(e.m_vertcs)}var i,r;return!1}equalHorizontal(e){return this.horizontalEqual(e)}equalVertical(e){return s.geometryReleaseAssert(0),!1}equalVerticalVCS(e){return s.geometryReleaseAssert(0),!1}convergenceAngle(e){return s.geometryReleaseAssert(0),0}getPeCoordsysCopy(){if(this.m_peCoordSysVal){const e=this.m_peCoordSysVal.m_peCoordSys;return e||s.throwInternalErrorException("cannot clone coord sys"),e}return null}getPeVertcsCopy(){return s.geometryReleaseAssert(0),0}throwIfLocal(){0===this.getCoordinateSystemType()&&s.throwInvalidArgumentException(Dr)}getPrimeMeridian(){return this.throwIfLocal(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPrimeMeridian()}getSRToGCSTransform(){return this.updateTransform(!0)}getGCSToSRTransform(){return this.updateTransform(!1)}getOneMeter(){return 1e3*this.getUnitsPerMillimeter()}getOneMeterPCSUnit(){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneMeterPCSUnit()}getDefaultPrecisionSR(){if(this.m_bDefaultDescriptor)return this;if(null===this.m_defaultPrecisionSR){const e=new Zr;this.queryDefaultPrecisionDescriptorWithoutFalseXY(e),this.m_defaultPrecisionSR=Rr(this,e,!0)}return this.m_defaultPrecisionSR}getPCSHorizon(){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getPCSHorizon()}getHorzUnitFactor(){return this.m_unit?this.m_unit.getUnitToBaseFactor():1}querySpheroidData(e){this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal);const t=this.getGCS().getPECoordSys().getDatum().getSpheroid(),n=t.getFlattening();var i,r,o;r=t.getAxis(),o=n,(i=e).majorSemiAxis=r,i.minorSemiAxis=r*(1-o),i.e2=o*(2-o),i.flattening=o}getAreaOfUse(){0===this.getCoordinateSystemType()&&s.throwInvalidCallException(""),s.geometryReleaseAssert(this.m_peCoordSysVal);const e=this.m_peCoordSysVal.getAreaOfUse();return null===e?new c:new c({geom:e.clone(),sr:Nr(4326)})}getZToXYFactor(){return 1}isCustomWkid(){return!1}getOneDegreeGCSUnit(){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getOneDegreeGCSUnit()}getGcsUnitFactor(){return this.throwIfNotGCSOrPCS(),s.geometryReleaseAssert(this.m_peCoordSysVal),this.m_peCoordSysVal.getGcsUnitFactor()}snapGeometry(e){if(e.isEmpty())return!1;if(2===this.m_precisionDescriptor.getPrecision())return!1;const t=e.getGeometryType();if(s.isMultiVertex(t))return this.snapMultiVertex_(e);if(t===s.GeometryType.enumPoint)return this.snapPoint_(e);if(t===s.GeometryType.enumEnvelope)return this.snapEnvelope_(e);if(s.isSegment(t))return this.snapSegment_(e);if(t===s.GeometryType.enumGeometryCollection){const t=e;let s=!1;for(let e=0,n=t.getGeometryCount();e<n;++e)s=this.snapGeometry(t.getGeometry(e))||s;return s}s.throwInternalErrorException("what else?")}snapMultiVertex_(e){if(s.geometryReleaseAssert(!e.isEmpty()),s.geometryReleaseAssert(2!==this.m_precisionDescriptor.getPrecision()),s.isMultiPath(e.getGeometryType())){const t=e;if(t.hasNonLinearSegments())return this.snapGeometryWithCurves_(t)}const t=e.getImpl(),n=t.getDescription();let i=!1;for(let e=0,s=n.getAttributeCount();e<s;e++){const s=n.getSemantics(e),r=t.getAttributeStreamRef(s);i=this.snapAttributes(s,r,0,t.getPointCount())||i}return i&&t.notifyModifiedFlags(2001),i}snapPoint_(e){return!1}snapEnvelope_(e){return!1}snapSegment_(e){s.geometryReleaseAssert(!e.isEmpty()),s.geometryReleaseAssert(2!==this.m_precisionDescriptor.getPrecision());const t=new Zr;this.queryPrecisionDescriptor(t);const n=e.getStartXY(),i=new r.Point2D;i.x=io(n.x,t.getFalseX(),t.getGridUnitsXY()),i.y=io(n.y,t.getFalseY(),t.getGridUnitsXY());let o=!i.equals(n);const a=e.getEndXY(),m=new r.Point2D;m.x=io(a.x,t.getFalseX(),t.getGridUnitsXY()),m.y=io(a.y,t.getFalseY(),t.getGridUnitsXY()),o||=!m.equals(a),o&&e.changeEndPoints2D(i,m);const h=(t,s,n)=>{let i=!1;{const o=e.getStartAttributeAsDbl(t,0),a=io(o,s,n),m=!r.isEqualNonIEEE(a,o);i||=m,m&&e.setStartAttribute(t,0,a)}{const o=e.getEndAttributeAsDbl(t,0),a=io(o,s,n),m=!r.isEqualNonIEEE(a,o);i||=m,m&&e.setEndAttribute(t,0,a)}return i};let l=o?1:0;return e.hasAttribute(1)&&(l|=h(1,t.getFalseZ(),t.getGridUnitsZ())?1:0),e.hasAttribute(2)&&(l|=h(2,t.getFalseM(),t.getGridUnitsM())?1:0),!!l}snapGeometryWithCurves_(e){s.geometryReleaseAssert(!e.isEmpty()),s.geometryReleaseAssert(2!==this.m_precisionDescriptor.getPrecision());const t=e.createInstance(),r=new n.SegmentBuffer;let o=0;for(let s=0,n=e.getPathCount();s<n;++s){const n=e.getSegmentCountPath(s);if(0===n){if(t.addPath(e,s,!0),1===t.getPathSize(s)){const e=new i.Point;t.getPointByVal(t.getPointCount()-1,e),o|=this.snapGeometry(e)?1:0,t.setPointByVal(t.getPointCount()-1,e)}continue}const a=e.isClosedPath(s);for(let i=0,m=a?n-1:n;i<m;++i)e.getSegmentFromPath(s,i,r,!1),o|=this.snapGeometry(r.get())?1:0,t.addSegment(r.get(),0===i);a&&(e.getSegmentFromPath(s,n-1,r,!1),o|=this.snapGeometry(r.get())?1:0,1===n?t.addPathFromClosedSegment(r.get(),!1):t.closeLastPathWithSegment(r.get()))}return o&&t.copyTo(e),!!o}snapAttributes(e,s,n,i){let o=!1;const a=new Zr;if(this.queryPrecisionDescriptor(a),0===e){const e=s;for(let s=n;s<i;s++){const n=e.read(2*s),i=t.s_SnapValue(n,a.getFalseX(),a.getGridUnitsXY()),r=e.read(2*s+1),m=t.s_SnapValue(r,a.getFalseY(),a.getGridUnitsXY());o=o||i!==n||m!==r,o&&(e.write(2*s,i),e.write(2*s+1,m))}}else if(1===e){const e=s;for(let s=n;s<i;s++){const n=e.read(s),i=t.s_SnapValue(n,a.getFalseZ(),a.getGridUnitsZ());o=o||!r.isEqualNonIEEE(i,n),o&&e.write(s,i)}}else if(2===e){const e=s;for(let s=n;s<i;s++){const n=e.read(s),i=t.s_SnapValue(n,a.getFalseM(),a.getGridUnitsM());o=o||!r.isEqualNonIEEE(i,n),o&&e.write(s,i)}}return o}static s_SnapValue(e,t,s){return r.round((e-t)*s)/s+t}};class Zr{constructor(){const e=Cr,t=.001,s=1e-4*Number(e)*.5;this.m_precision=1,this.m_falseX=-s,this.m_falseY=-s,this.m_unitsXY=Number(e)/(2*s),this.m_falseM=-1e5,this.m_unitsM=1e4,this.m_falseZ=-1e5,this.m_unitsZ=1e4,this.m_toleranceXY=t,this.m_toleranceM=t,this.m_toleranceZ=t}getHashCode(){let e=7777,t=7777;return t=r.hashCombine(t,this.m_falseM),t=r.hashCombine(t,this.m_unitsM),e=r.hashCombine(e,this.m_unitsXY),t=r.hashCombine(t,this.m_toleranceXY),e=r.hashCombine(e,this.m_falseZ),t=r.hashCombine(t,this.m_toleranceZ),e=r.hashCombine(e,this.m_unitsZ),t=r.hashCombine(t,this.m_toleranceM),e=r.hashCombine(e,this.m_precision),r.hashCombine(e,t)}clone(){const e=new Zr;return e.m_falseX=this.m_falseX,e.m_falseY=this.m_falseY,e.m_unitsXY=this.m_unitsXY,e.m_falseZ=this.m_falseZ,e.m_unitsZ=this.m_unitsZ,e.m_falseM=this.m_falseM,e.m_unitsM=this.m_unitsM,e.m_toleranceXY=this.m_toleranceXY,e.m_toleranceZ=this.m_toleranceZ,e.m_toleranceM=this.m_toleranceM,e.m_precision=this.m_precision,e}assign(e){return this.m_falseX=e.m_falseX,this.m_falseY=e.m_falseY,this.m_unitsXY=e.m_unitsXY,this.m_falseZ=e.m_falseZ,this.m_unitsZ=e.m_unitsZ,this.m_falseM=e.m_falseM,this.m_unitsM=e.m_unitsM,this.m_toleranceXY=e.m_toleranceXY,this.m_toleranceZ=e.m_toleranceZ,this.m_toleranceM=e.m_toleranceM,this.m_precision=e.m_precision,this}initialize2D(e,t){}getTolerance(e){switch(e){case 0:return this.m_toleranceXY;case 1:return this.m_toleranceZ;case 2:return this.m_toleranceM;default:return 0}}getResolution(e){if(2===this.m_precision)return 0;switch(e){case 0:return 1/this.m_unitsXY;case 1:return 1/this.m_unitsZ;case 2:return 1/this.m_unitsM;default:return 0}}getFalseX(){return this.m_falseX}getFalseY(){return this.m_falseY}getFalseZ(){return this.m_falseZ}getFalseM(){return this.m_falseM}getGridUnitsXY(){return this.m_unitsXY}getGridUnitsZ(){return this.m_unitsZ}getGridUnitsM(){return this.m_unitsM}getPrecision(){return this.m_precision}static getLimit32(){return 2147483645}static getLimit64(){return 9007199254740990n}static getLimitFloat(){return 0}getXYGridRange(){const e=new t.Envelope2D;switch(this.m_precision){case 0:{const t=Zr.getLimit32()/this.getGridUnitsXY();e.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+t,ymax:this.getFalseY()+t})}break;case 1:{const t=Number(Zr.getLimit64())/this.getGridUnitsXY();e.setCoords({xmin:this.getFalseX(),ymin:this.getFalseY(),xmax:this.getFalseX()+t,ymax:this.getFalseY()+t})}break;case 2:e.setCoords({xmin:-Number.MAX_VALUE,ymin:-Number.MAX_VALUE,xmax:Number.MAX_VALUE,ymax:Number.MAX_VALUE});break;default:e.setEmpty(),s.throwInternalErrorException("")}return e}getZGridRange(){const e=new r.Envelope1D;switch(this.m_precision){case 0:{const t=Zr.getLimit32()/this.getGridUnitsZ();e.setCoords(this.getFalseZ(),this.getFalseZ()+t)}break;case 1:{const t=Number(Zr.getLimit64())/this.getGridUnitsZ();e.setCoords(this.getFalseZ(),this.getFalseZ()+t)}break;case 2:e.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:e.setEmpty(),s.throwInternalErrorException("")}return e}getMGridRange(){const e=new r.Envelope1D;switch(this.m_precision){case 0:{const t=Zr.getLimit32()/this.getGridUnitsM();e.setCoords(this.getFalseM(),this.getFalseM()+t)}break;case 1:{const t=Number(Zr.getLimit64())/this.getGridUnitsM();e.setCoords(this.getFalseM(),this.getFalseM()+t)}break;case 2:e.setCoords(-Number.MAX_VALUE,Number.MAX_VALUE);break;default:e.setEmpty(),s.throwInternalErrorException("")}return e}setTolerance(e,t){switch(t<0&&s.throwInvalidArgumentException("tol < 0"),Number.isFinite(t)||s.throwInvalidArgumentException("tol is not finite"),e){case 0:this.m_toleranceXY=t;break;case 1:this.m_toleranceZ=t;break;case 2:this.m_toleranceM=t;break;default:s.throwInvalidArgumentException("cannot set tolerance for this attribute")}}setGridParams(e,t,n){Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(n)||s.throwInvalidArgumentException("grid params are not finite"),n<1&&s.throwInvalidArgumentException("grid units cannot be smaller than 1.0"),this.m_falseX=e,this.m_falseY=t,this.m_unitsXY=n}setZParams(e,t){Number.isFinite(e)&&Number.isFinite(t)||s.throwInvalidArgumentException("grid params are not finite"),t<1&&s.throwInvalidArgumentException("grid units cannot be smaller than 1.0"),this.m_falseZ=e,this.m_unitsZ=t}setMParams(e,t){Number.isFinite(e)&&Number.isFinite(t)||s.throwInvalidArgumentException("grid params are not finite"),t<1&&s.throwInvalidArgumentException("grid units cannot be smaller than 1.0"),this.m_falseM=e,this.m_unitsM=t}setPrecision(e){}equals(e){return this===e||r.isEqualNonIEEE(this.m_falseX,e.m_falseX)&&r.isEqualNonIEEE(this.m_falseY,e.m_falseY)&&this.equalsWithoutFalseXY(e)}snapPrecision(){if(2===this.m_precision)return;const e=(e,t,s,n)=>{if(!Number.isFinite(t)||!Number.isFinite(s))return s;if(s<1)return 1;if(!n)return s;const i=Number(e)/s;return Math.trunc((t+i-t)*s)>e&&(s=e/(t+i-t)),Math.max(1,s)},t=Number(0===this.m_precision?vr:Cr);this.m_unitsXY=e(t,this.m_falseX,this.m_unitsXY,!0),this.m_unitsXY=e(t,this.m_falseY,this.m_unitsXY,!0),this.m_unitsZ=e(t,this.m_falseZ,this.m_unitsZ,!1),this.m_unitsM=e(t,this.m_falseM,this.m_unitsM,!1)}verifyPrecision(){if(2===this.m_precision)return!0;const e=(e,t,s,n)=>{if(s<1)return!1;if(!Number.isFinite(t)||!Number.isFinite(s))return!1;if(!n)return!0;const i=Number(e)/s;return!(BigInt((t+i-t)*s)>e)},t=0===this.m_precision?vr:Cr;return!!(e(t,this.m_falseX,this.m_unitsXY,!0)&&e(t,this.m_falseY,this.m_unitsXY,!0)&&e(t,this.m_falseZ,this.m_unitsZ,!1)&&e(t,this.m_falseM,this.m_unitsM,!1))}fixTolerance(){2!==this.m_precision&&(this.m_toleranceXY=Math.max(2/this.m_unitsXY,this.m_toleranceXY),this.m_toleranceZ=Math.max(2/this.m_unitsZ,this.m_toleranceZ),this.m_toleranceM=Math.max(2/this.m_unitsM,this.m_toleranceM),(Number.isNaN(this.m_falseX)||Number.isNaN(this.m_falseY))&&(this.m_falseX=this.m_falseY=Number.NaN))}equalsWithoutFalseXY(e){return this===e||this.m_unitsXY===e.m_unitsXY&&this.m_falseZ===e.m_falseZ&&this.m_unitsZ===e.m_unitsZ&&this.m_falseM===e.m_falseM&&this.m_unitsM===e.m_unitsM&&this.m_toleranceXY===e.m_toleranceXY&&this.m_toleranceZ===e.m_toleranceZ&&this.m_toleranceM===e.m_toleranceM&&this.m_precision===e.m_precision}setBestXyDomainFromEnvelope(e,t){}setBestZDomainFromZRange(e,t,s){}setBestMDomainFromMRange(e,t,s){}}function Qr(){return(!zr||wr()&&null===zr.getPECoordSys())&&(zr=no(3857,0,0,!0)),zr}function Kr(){return(!Ur||wr()&&null===Ur.getPECoordSys())&&(Ur=no(102100,0,0,!0)),Ur}function $r(){return(!jr||wr()&&null===jr.getPECoordSys())&&(jr=no(4326,0,0,!0)),jr}function Jr(e){e.m_falseX=0,e.m_falseY=0,e.m_unitsXY=1,e.m_falseZ=0,e.m_unitsZ=1,e.m_falseM=0,e.m_unitsM=1,e.m_toleranceXY=100*r.doubleEps(),e.m_toleranceZ=100*r.doubleEps(),e.m_toleranceM=100*r.doubleEps(),e.m_precision=2}function eo(e,t,n,i){const r=t instanceof ji;Jr(e),e.m_precision=i,e.m_falseX=Number.NaN,e.m_falseY=Number.NaN;const o=1e-4,a=.001,m=r?t.m_csType:t.isPCS?2:1;if(1===m){const s=(0===i?1/18e5:1e-9)*(r?t.getOneDegreeGCSUnit():Math.PI/t.metersOrRadiansPerUnit/180);e.m_unitsXY=1/s}else if(2===m){const s=(0===i?a:o)*(r?t.getOneMeterPCSUnit():1/t.metersOrRadiansPerUnit);e.m_unitsXY=1/s}else s.throwInvalidArgumentException("unrecognized cs type");e.m_falseM=-1e5,e.m_unitsM=1/(0===i?a:o),e.m_unitsM=Math.max(1,e.m_unitsM),e.m_unitsXY=Math.max(1,e.m_unitsXY);let h=0,l=0;0!==i&&1!==i||(h=2/e.m_unitsXY,l=2/e.m_unitsM),e.m_toleranceXY=Math.max(h,r?t.getUnitsPerMillimeter():2===m?.001/t.metersOrRadiansPerUnit:.001/(t.semiMajor*t.metersOrRadiansPerUnit)),e.m_toleranceM=Math.max(a,l),to(e,n)}function to(e,t){const s=1e-4,n=.001;if(e.m_falseZ=-1e5,t){const i=(0===e.m_precision?n:s)*t.getOneMeter();e.m_unitsZ=1/i}else e.m_unitsZ=1/(0===e.m_precision?n:s);e.m_unitsZ=Math.max(1,e.m_unitsZ);let i=0;0!==e.m_precision&&1!==e.m_precision||(i=2/e.m_unitsZ),e.m_toleranceZ=Math.max(t?t.getOneMeter()*n:n,i)}function so(e,t,s,n){Jr(e),e.m_precision=n;const i=0===n?vr:Cr,r=1e-4,o=.001;let a=1,m=1,h=.001;t&&(m=t.getUnitToBaseFactor()),t&&1===t.getUnitType()?(a=400*Math.PI/180,h=8.983152841195215e-9*Math.PI/180/m):(a=(0===n?o:r)*Number(i)*.5,h=o/m),a/=m,e.m_falseX=-a,e.m_falseY=-a,e.m_unitsXY=Number(i)/(2*a),e.m_falseM=-1e5,e.m_unitsM=1/(0===n?o:r),e.m_unitsM=Math.max(1,e.m_unitsM),e.snapPrecision();let l=0,u=0;0!==e.m_precision&&1!==e.m_precision||(u=2/e.m_unitsM,l=2/e.m_unitsXY),e.m_toleranceXY=Math.max(l,h),e.m_toleranceM=Math.max(o,u),to(e,s)}function no(t,n,i,r){if(!r&&n<=0){if(3857===t)return Qr();if(102100===t)return Kr();if(4326===t)return $r()}const o=new Wr;let a,m=null;return wr()?(a=function(t){t<=0&&s.throwInvalidWkidException(t);{const e=fr(t);if(e)return e}const n=mo(e.peFactory.coordsys(t));n.get()||s.throwInvalidWkidException(t);const i=_r(n.release());return i.getLatestID()!==t&&rr.set(t,new WeakRef(i)),i}(t),n>0?m=null:n=0,o.setHorzProj_(a),o.m_vertcs=m):(a=_o(t),o.m_unit=a.isPCS?new yr(a.metersOrRadiansPerUnit):new p(a.metersOrRadiansPerUnit)),eo(o.m_precisionDescriptor,a,m,1),o.m_bDefaultDescriptor=!0,o.m_userWKID=t,o.calculateHashCode(),o.initDbgName(),o}function io(e,t,s){return r.round((e-t)*s)/s+t}let ro=null;const oo=3552713678800501e-30;function ao(e,t){return function(e,t,s){return e===t||Math.abs(e-t)<=s*(1+(Math.abs(e)+Math.abs(t))/2)}(e,t,oo)}function mo(e){return{_this:e,get(){return this._this},reset(e){this._this=e},release(){const e=this._this;return this._this=null,e}}}let ho,lo,uo,co,go;e.PeDoubleClass=void 0,e.peFactory=void 0,e.peDefs=void 0,e.peCSTransformations=void 0,e.peLineType=void 0,e.peMath=void 0;let po=null;function _o(t){s.geometryReleaseAssert(po);const n=po(t);return n.semiMajor=n.isPCS?Number.NaN:function(t){if(e.peFactory&&s.throwInvalidCallException("pe has been loaded. no-pe methods should not be used at this point."),"string"==typeof t){const e=t.match(fo);e&&2===e.length||s.throwInvalidArgumentException("bad gcs wkt");const n=Number.parseFloat(e[1]);return Number.isFinite(n)||s.throwInvalidArgumentException("bad gcs wkt"),n}return ro||yo(),ro.has(t)||s.throwInvalidCallException("gcs wkid not found"),ro.get(t)}(t),n}const fo=/(?:ELLIPSOID|SPHEROID)\["(?:\w|[-()])+",(\d+\.\d+)/;function yo(){ro=new Map;for(const e in d){const t=Number.parseFloat(e),s=d[e];if(Array.isArray(s))for(const e of s)ro.set(e,t);else ro.set(s,t)}!function(){for(const e in d)delete d[e]}()}function xo(e,t){return new vo(e,t)}const Po=r.hashInt32(0),Eo=r.hashInt32(1);let vo=class t{constructor(e,s){if(e instanceof t)return this.m_geogTranWrapper=e.m_geogTranWrapper,this.m_bInverted=s?!e.m_bInverted:e.m_bInverted,void(this.m_hashCode=r.hashCombine(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?Eo:Po));this.m_geogTranWrapper=new Yn(e),this.m_bInverted=s,this.m_hashCode=r.hashCombine(this.m_geogTranWrapper.getHashCode(),this.m_bInverted?Eo:Po)}getID(){return this.m_geogTranWrapper.getLatestId()}getLatestID(){return this.m_geogTranWrapper.getLatestId()}getText(){return this.m_geogTranWrapper.getText()}getTextExtended(t){if(!this.m_geogTranWrapper.getGeogtran())return"";if(-1===t)return this.m_geogTranWrapper.getGeogtran().toString();{const s=0===t?e.peDefs.PE_STR_AUTH_TOP:e.peDefs.PE_STR_AUTH_ALL;return this.m_geogTranWrapper.getGeogtran().toString(s)}}getText2(t=-1){let s=e.peDefs.PE_STR_FMT_WKT2;return-1!==t&&(s|=0===t?e.peDefs.PE_STR_AUTH_TOP:e.peDefs.PE_STR_AUTH_ALL),this.m_geogTranWrapper.getGeogtran().toString(s)}getName(){return this.m_geogTranWrapper&&this.m_geogTranWrapper.getGeogtran()?this.m_geogTranWrapper.getGeogtran().getName():""}getInputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getOutputSr(!1):this.m_geogTranWrapper.getInputSr(!1)}getOutputSpatialReference(){return this.m_bInverted?this.m_geogTranWrapper.getInputSr(!1):this.m_geogTranWrapper.getOutputSr(!1)}getInverse(){return new t(this,!0)}isInverted(){return this.m_bInverted}getHashCode(){return this.m_hashCode}GetPeGeogtran(){return this.m_geogTranWrapper.getGeogtran()}equals(e){const t=e;return t===this||this.m_bInverted===t.m_bInverted&&(this.GetPeGeogtran()===t.GetPeGeogtran()||this.getID()===t.getID()&&!(0===this.getID()&&!this.GetPeGeogtran().isEqual(t.GetPeGeogtran())))}referencesMissingData(){return!!this.m_geogTranWrapper&&!this.m_geogTranWrapper.isUsable()}getWrapper(){return this.m_geogTranWrapper}};function Co(e,t,n,o,a){const m=e.getGCS(),h=t.getGCS(),l=m.getPECoordSys(),u=h.getPECoordSys();let c=null;if(!n.isEmpty()){const t=n.clone();if(!t.isEmpty()&&2===e.getCoordinateSystemType()){let s=new i.Envelope({env2D:t});const n=Qi(e,m,null);s=(new nn).execute(s,n,null),s.queryEnvelope(t)}if(!t.isEmpty()){const e=l.getPrimem().getLongitude(),s=l.getUnit().getUnitFactor();c=new go(t.xmin,t.ymin,t.xmax,t.ymax,e,s)}}let g=o;g>=r.intMax()&&(g=0);const d=[];let p=uo.PE_GTLIST_OPTS_COMMON;a||(p&=~uo.PE_GTLIST_OPTS_USABLE);for(let e=0;e<2;e++){d.length=0;const e=g,t=uo.getGTlist(l,u,2,p,c,e);let n=!1;if(t&&t.length>0)for(let e=0,i=t.length;e<i;e++){const i=Do([t[e]]);if(s.geometryReleaseAssert(i),a&&i.referencesMissingData())n=!0;else if(d.push(i),o>0&&d.length===o)break}if(!n)break;0===g||(g=0)}return c&&c.destroy(),d}function Do(e){s.geometryReleaseAssert(null!==e);const t=new So,n=e[0].getSteps();if(n){const s=e[0].getEntries();for(let e=0;e<n;e++){const n=0!==s[e].getDirection(),i=xo(s[e].getGeogtran(),n);t.add(i)}return t.create()}return null}let bo=class{constructor(e,t,s,n){this.m_bReadOnly=!0,this.m_name="",this.m_fastTrack=-1,this.m_bNameIsSet=!1,this.m_transforms=e,t&&(this.m_name=t,this.m_bNameIsSet=!0),this.m_inputSr=s,this.m_outputSr=n}getType(){return 0}getName(){if(this.m_bNameIsSet)return this.m_name;if(0===this.m_transforms.length)return"";let e="";for(const t of this.m_transforms)e.length>0&&(e+=" + "),t.isInverted()&&(e+="~"),e+=t.getName();return e}count(){return this.m_transforms.length}createInverse(){return this.getInverse()}getHashCode(){let e=1973;for(let t=0;t<this.m_transforms.length;t++)e=r.hashCombine(e,this.m_transforms[t].getHashCode());return e}equals(e){return s.geometryReleaseAssert(0),!1}referencesMissingData(){if(0===this.m_transforms.length)return!1;for(const e of this.m_transforms)if(e.referencesMissingData())return!0;return!1}isMatchingTransformation(e,t){return s.geometryReleaseAssert(0),!1}validateTransformation(e,t){return s.geometryReleaseAssert(0),!1}nameIsSet(){return s.geometryReleaseAssert(0),!1}getInputSpatialReference(){return this.m_inputSr}getOutputSpatialReference(){return this.m_outputSr}getStep(e){return(e<0||e>this.count())&&s.throwOutOfRangeException(""),this.m_transforms[e]}getInverse(){const e=new So;return e.addSteps(this,!0),e.setInputSpatialReference(this.m_outputSr),e.setOutputSpatialReference(this.m_inputSr),e.create()}transform(t,s,i){if(0===this.count())return;let o=this.m_inputSr,a=this.m_outputSr;if(t&&(a=r.swap(o,o=a)),0===this.m_transforms.length)return void Xn(o,null,a,null,s,null,i);let m=this.m_fastTrack;if(1===m)return void n.forEachDir(t,this.m_transforms,n=>{!function(t,s,n,i,r){const o=t.getVerttran(),a=t.getGeogtran();if(r>0){t.prepareOrThrow();const i=s?e.peDefs.PE_TRANSFORM_2_TO_1:e.peDefs.PE_TRANSFORM_1_TO_2;o?qi():Vi(a,r,n,null,i)}}(n.getWrapper(),t!==n.isInverted(),s,0,i)});const h=On();-1===m&&h.initFromGcsAndVcs(o,null);const l=On();let u=t?this.m_transforms.length-1:0;const c=t?-1:1;for(let e=0,n=this.m_transforms.length;e<n;e++,u+=c){if(0===e){const e=this.m_transforms[u];Ln(o.getPECoordSys(),null,e.getWrapper(),t!==e.isInverted(),s,null,i,l),-1===m&&(h.equals(l)||(m=0)),h.assign(l)}else{const e=this.m_transforms[u-c],n=this.m_transforms[u];Bn(h,e.getWrapper(),t!==e.isInverted(),n.getWrapper(),t!==n.isInverted(),s,null,i,l),-1===m&&(h.equals(l)||(m=0)),h.assign(l)}const n=this.m_transforms[u];zn(h,n.getWrapper(),t!==n.isInverted(),s,null,i,l),h.assign(l)}const g=this.m_transforms[u-c];!function(e,t,s,n,i,r,o,a){const m=On();m.assign(s?t.m_inputUnitParams:t.m_outputUnitParams),m.processUnitParams(e);let h=null;n&&(h=n.getPECoordSys());const l=On();l.initFromGcsAndVcsPe(h,null),l.processUnitParams(m),m.processUnitParams(l),a>0&&Hn(m,l,r,null,a)}(h,g.getWrapper(),t!==g.isInverted(),a,0,s,0,i),-1===m&&(l.initFromGcsAndVcs(a,null),h.equals(l)||(m=0)),this.m_fastTrack=0===m?0:1}};class So{constructor(){this.m_transforms=[],this.m_inputGCS=null,this.m_outputGCS=null,this.m_name="",this.m_bNameIsSet=!1}getInputSpatialReference(){return null!==this.m_inputGCS?this.m_inputGCS:this.count()>0?this.m_transforms[0].getInputSpatialReference():null}setInputSpatialReference(e){this.m_inputGCS=e?e.getGCS():null}getOutputSpatialReference(){return null!==this.m_outputGCS?this.m_outputGCS:this.count()>0?this.m_transforms.at(-1).getOutputSpatialReference():null}setOutputSpatialReference(e){this.m_outputGCS=e?e.getGCS():null}getName(){if(this.m_bNameIsSet)return this.m_name;if(0===this.m_transforms.length)return"";let e="";for(const t of this.m_transforms)e.length>0&&(e+=" + "),t.isInverted()&&(e+="~"),e+=t.getName();return e}count(){return this.m_transforms.length}getStep(e){return(e<0||e>this.count())&&s.throwOutOfRangeException(""),this.m_transforms[e]}setStep(e,t){s.geometryReleaseAssert(0)}add(e){this.m_transforms.push(e)}addSteps(e,t){if(t)for(let t=e.count()-1;t>=0;--t)this.add(e.getStep(t).getInverse());else for(let t=0;t<e.count();++t)this.add(e.getStep(t))}clear(){this.m_transforms=[],this.m_name="",this.m_bNameIsSet=!1,this.m_inputGCS=null,this.m_outputGCS=null}remove(e){s.geometryReleaseAssert(0)}create(){const e=this.getInputSpatialReference(),t=this.getOutputSpatialReference(),s=new bo(this.m_transforms,this.m_bNameIsSet?this.m_name:null,e,t);return s.m_bReadOnly=!0,this.clear(),s}}const Io=Object.freeze(Object.defineProperty({__proto__:null,SpatialReference:Wr,SpatialReferencePrecisionDescriptor:Zr,create:Nr,createFromWKT:Gr,createImplFromPe:Mr,createLocal:kr,createWithNewPrecision:Rr,createWithNewVCS:function(e,t,s){return{}},getGCS:qr,getTempName:Lr,hasNoPe:Tr,hasPe:wr,injectNoPe:Ir,injectPe:function(t){if(e.peFactory)return;!function(t){const n=t;e.peFactory=n.PeFactory,s.geometryReleaseAssert(e.peFactory),go=n.PeGCSExtent,s.geometryReleaseAssert(go),e.peLineType=n.PeLineType,s.geometryReleaseAssert(e.peLineType),e.peMath=n.PeMath,s.geometryReleaseAssert(e.peMath),e.PeDoubleClass=n.PeDouble,s.geometryReleaseAssert(e.PeDoubleClass),e.peDefs=n.PeDefs,s.geometryReleaseAssert(e.peDefs),e.peCSTransformations=n.PeCSTransformations,s.geometryReleaseAssert(e.peCSTransformations),ho=n.PeGTTransformations,s.geometryReleaseAssert(ho),lo=n.PePCSInfo,s.geometryReleaseAssert(lo),uo=n.PeGTlistExtended,s.geometryReleaseAssert(uo),e.peFactory.initialize(),co=n.PeGTlistExtendedEntry,s.geometryReleaseAssert(co),e.peDefs.PE_TYPE_ANGUNIT=512,e.peDefs.PE_STR_AUTH_ALL=2,lo.PE_POLE_LINE_STRAIGHT=2,lo.PE_POLE_LINE_CURVED=3,e.peDefs.PE_PARM_LAM0=2,e.peDefs.PE_PARM_PHI0=6,e.peDefs.PE_PRJ_AZIMUTHAL_EQUIDISTANT=43032,e.peDefs.PE_PRJ_LAMBERT_AZIMUTHAL_EQAREA=43033,e.peDefs.PE_PRJ_ALBERS=43007,e.peDefs.PE_PRJ_CYLINDRICAL_EQAREA=43034,e.peDefs.PE_TYPE_VERTCS=8,e.peDefs.PE_LINETYPE_GEODESIC=0,e.peDefs.PE_LINETYPE_LOXODROME=1,e.peDefs.PE_LINETYPE_GREAT_ELLIPTIC=2,e.peDefs.PE_LINETYPE_NORMAL_SECTION=3,uo.PE_GTLIST_OPTS_USABLE=1,po=null}(t);const n=Er;Er=null,n.forEach(e=>{const t=e.deref();t&&t.attachToPe()})},isInitialized:Ar,isTempName:Br,isValidWkid:Vr,isValidWkt:Hr,makeSpheroidData:Sr,snapGeometry:Fr,webMercator:Qr,webMercator102100:Kr,wgs84:$r},Symbol.toStringTag,{value:"Module"})),wo=Object.freeze(Object.defineProperty({__proto__:null,OperatorProject:nn},Symbol.toStringTag,{value:"Module"})),To=Object.freeze(Object.defineProperty({__proto__:null,CompositeGeographicTransformation:bo,CompositeGeographicTransformationEditor:So,createImpl:Do,queryGtListImpl:Co},Symbol.toStringTag,{value:"Module"})),Ao=Object.freeze(Object.defineProperty({__proto__:null,GeographicTransformation:vo,create:function(t,n){const i=e.peFactory.geogtran(t);return i||s.throwInvalidWkidException(t),new vo(i,n)},createFromPe:xo,createFromWKT:function(t,n){const i=e.peFactory.fromString(e.peDefs.PE_TYPE_GEOGTRAN,t);return i||s.throwInvalidWktException(t),new vo(i,n)}},Symbol.toStringTag,{value:"Module"})),No=Object.freeze(Object.defineProperty({__proto__:null,ProjectionTransformation:ir,create:function(e,s,n){return Zi(e,s,t.Envelope2D.constructEmpty(),n)},createEx:Qi,createFromAoi:Zi,createImplEx:Ki,makeExtendedParams:Ji,makeExtendedParamsInternal:tr,queryTransformationList:$i},Symbol.toStringTag,{value:"Module"}));e.CompositeGeographicTransformation=To,e.CurveStitcher=ms,e.GeographicTransformation=Ao,e.Gnomonic=An,e.IndexMultiList=j,e.ListeningGeometryCursor=Ui,e.MapGeometry=c,e.OperatorContains=Zn,e.OperatorDifference=Qn,e.OperatorDisjoint=ti,e.OperatorIntersection=Ws,e.OperatorProject=nn,e.OperatorProject$1=wo,e.OperatorSimpleRelation=Un,e.OperatorSimplify=Bs,e.OperatorUnion=$n,e.PEGeogToGeogStable=Hi,e.PEGeogToProj=Ci,e.PEGeogToProjSimple=function(t,s){const n=s.getPointCount();if(!n)return;const i=s.getImpl(),r=i.getAttributeStreamRef(0),o=t;e.peCSTransformations.geogToProj(o,n,r.getArray()),i.notifyModifiedFlags(2001)},e.PEProjToGeogCenterPoint2D=Ni,e.PE_EQ=ao,e.ProjectionTransformation=No,e.SpatialReference=Io,e.SpatialReferencePrecisionDescriptor=Zr,e.TopoGraph=U,e.TopologicalOperations=Is,e.UnorderedBitIterator=R,e.accelerateGeometry=jn,e.applySplitLines=si,e.areaBetweenParallelsAndMeridiansOfUnitSpheroid=function(e,t,s,n,i){n=r.snap(n,-r.geometryHalfPi,r.geometryHalfPi),i=r.snap(i,-r.geometryHalfPi,r.geometryHalfPi);const o=r.geometryHalfPi-.03;let a;a=n>o&&i>o||n<-o&&i<-o?function(e,t,s){let n=1;if(t<0&&(n=-1,t=-t,s=-s),0!==e){const i=e*e,o=i*e,a=[1,(1+11*e)/12,(1+118*e+241*i)/360,(1+1089*e+10419*i+8651*o)/20160,(1+9836*e+318246*i+1027436*o+o*e*458881)/1814400],m=t=>{let s=0;const n=r.sqr(t)/(e-1);for(let e=a.length-1;e>=0;--e)s=a[e]+s*n;return s*=-r.sqr(t/(1-e)),s},h=m(r.geometryHalfPi-t);return(m(r.geometryHalfPi-s)-h)*n}{const e=r.geometryHalfPi-t,i=r.geometryHalfPi-s,o=-4*r.sqr(Math.sin(e/2));return(-4*r.sqr(Math.sin(i/2))-o)*n}}(e,n,i):N(e,i)-N(e,n);const m=function(e){return 1-e}(e);return.5*(s-t)*a*m},e.autoComplete=function(e,t,s,n){return new Is(n).autoCompleteImpl(e,t,s)},e.brentMinimization=x,e.buildSegmentParentage=ss,e.buildSegmentParentageForIsSimple=ns,e.calculateLargeRadius=function(e,t){return e/Math.sqrt(1-t)},e.calculateSmallRadius=G,e.calculateTightRadiusInMeters=function(t,s,n,i){const r={stack:[],error:void 0,hasError:!1};try{const a=[n.x],m=[n.y-i],h=[n.x],l=[n.y+i];A(a,m),A(h,l);const u=o.__addDisposableResource(r,new e.PeDoubleClass,!1),c=o.__addDisposableResource(r,new e.PeDoubleClass,!1);return e.peLineType.greatEllipticDistance(t,s,n.x,n.y,a[0],m[0],u,null,null),e.peLineType.greatEllipticDistance(t,s,n.x,n.y,h[0],l[0],c,null,null),Math.min(u.val,c.val)}catch(e){r.error=e,r.hasError=!0}finally{o.__disposeResources(r)}},e.canAccelerateGeometry=Wn,e.cartToCurv=D,e.checkEndForPoleTouch=ln,e.checkForWithinPole=mn,e.checkStartForPoleTouch=hn,e.clipGeometryFromTopAndBottom=_i,e.closestCoordinate=w,e.create$2=Nr,e.create$5=function(e){return new yr},e.createEx=Qi,e.createFromWKT$2=Gr,e.createImplEx=Ki,e.createLocal=kr,e.createWithNewPrecision=Rr,e.curvToCart=E,e.densificationDeviationFromTolerance=rs,e.densify=on,e.execute=ls,e.execute$1=Ae,e.executeMp2sp=function(e,t,s){const n=new Te(s);return n.m_shape=e,n.m_geometry=t,n.m_sortedVertices=null,n.m_bFixSelfTangency=!1,n.fixRingOrientationForMp2sp_()},e.extraToleranceForCrackingAndClustering=as,e.foldGeometry=yi,e.foldInto360NoUnion=Tn,e.geodeticDensifySegment=function(e,t,s,n,i,o,a,m,h,l,u,c){const g=new r.Point2D,d=new r.Point2D,p=n.compare(i)>0;En(p,n,i,g,d);const _=dn(e,t,s,g,d,o,a,m,h,l,null,u,c);return p&&Pn(h,l,null,u),_},e.getTempName=Lr,e.hasPe=wr,e.injectNoPe$1=Ir,e.insertGeodeticPointsEditShape=pi,e.isPoint2DInPolygon2D=Qt,e.isSimpleOGC=function e(r,o,a,m,h){if(m&&(m.m_reason=0,m.m_vertexIndex1=-1,m.m_vertexIndex2=-1),r.isEmpty())return 5;const l=r.getGeometryType();if(l===s.GeometryType.enumPoint)return Rs(r,m);const u=i.calculateToleranceFromGeometryForOpFromGeom(o,r,!1).total();if(l===s.GeometryType.enumEnvelope){const e=r,s=new t.Envelope2D;return e.queryEnvelope(s),s.isDegenerate(u)?(m&&(m.m_reason=4,m.m_vertexIndex1=-1,m.m_vertexIndex2=-1),0):5}if(s.isSegment(l)){const t=r,s=new n.Polyline({vd:t.getDescription()});return s.addSegment(t,!0),e(s,o,a,m,h)}s.throwIfGeometryCollectionType(l),s.isMultiVertex(l)||s.throwNotImplementedException("OGC simplify is not implemented for this geometry type");const c=r.getImpl().getIsSimple(u,[0]);let g=a?-1:c;if(5===g||0===g)return g;const d=new Ls(r,o,g,h,!0);return l===s.GeometryType.enumMultiPoint||l===s.GeometryType.enumPolyline||l===s.GeometryType.enumPolygon?(g=d.isSimplePlanarImpl(),i.isAtLeastPlanarSimple(g)&&(g=5)):s.throwInternalErrorException(""),r.getImpl().setIsSimple(g,u),m&&m.assign(d.m_nonSimpleResult),g},e.isValidWkid$1=Vr,e.isValidWkid$2=function(e){return!1},e.isValidWkt$1=Hr,e.linesToPolygons=function(e,t,s){return new Is(s).linesToPolygonsImpl(e,t)},e.makeExtendedParams=Ji,e.makeExtendedParamsInternal=tr,e.makeSpheroidData=Sr,e.needsCrackingAndClustering=function(e,t,s){const r=i.adjustToleranceForTEClustering(t),o=i.adjustToleranceForTECracking(t);return!!function(e,t,s,n,i){const r=new ne(i);return r.m_shape=e,r.m_sqrTolerance=t*t,r.m_cellSize=2*t,r.m_invCellSize=1/r.m_cellSize,r.m_geometry=s,r.m_bTrackChanges=!1,r.needsClustering()}(e,r,n.nullHandle,0,s)||Pe(!0,e,o,null,s)},e.normalizeMultiPathGcs=an,e.normalizeX=ui,e.planarSimplify=vs,e.processCurves=function(e,t,r,o){if(!s.isMultiPath(e.getGeometryType()))return e;const a=e.getImpl();if(!a.hasNonLinearSegments())return e;const m=e.createInstance();m.getGeometryType()===s.GeometryType.enumPolygon&&m.setFillRule(e.getFillRule()),new n.EditShape;const h=new i.Point,l=new n.SegmentBuffer,u=[],c=[],g=[],d=e.getDescription().getAttributeCount()>1,p=a.querySegmentIterator();for(;p.nextPath();){let e=!0;for(;p.hasNextSegment();){const i=p.isClosingSegment(),o=p.nextSegment();if(!o.isCurve()){m.addSegment(o,e,i),e=!1;continue}let a,_=!1;const f=!0,y=!0;switch(o.getGeometryType()){case s.GeometryType.enumEllipticArc:case s.GeometryType.enumRationalBezier2:a=n.approximationWithQuadraticRationalBeziers(o,t,r,f,y,c,g,u),_=!0;break;default:a=n.approximationWithBeziers(o,t,r,!0,f,c,u)}const x=_?2:3;c[1].isNAN()?(l.createLine(),l.get().construct(c[0],c[x])):_?(l.createQuadraticRationalBezier(),l.get().constructArrayWeights(c,g)):(l.createCubicBezier(),l.get().constructPoints(c)),d&&e&&(o.queryCoord(u[0],h),l.get().setStart(h)),d&&(o.queryCoord(u[1],h),l.get().setEnd(h)),m.addSegment(l.get(),e,i&&1===a),e=!1;for(let e=1,t=a,s=x;e<t;++e,s+=x)c[s+1].isNAN()?(l.createLine(),l.get().construct(c[s],c[s+x])):_?(l.createQuadraticRationalBezier(),l.get().constructArrayWeights(c.slice(s),g.slice(s))):(l.createCubicBezier(),l.get().constructPoints(c.slice(s))),d&&(o.queryCoord(u[e+1],h),l.get().setEnd(h)),m.addSegment(l.get(),!1,i&&e+1===t)}}return m},e.processWithPCSHorizon=vi,e.projectMultiPathVerticesPCSToGCS=function(e,s,i,r){const o=new n.MultiPoint({vd:s.getDescription()});let a;o.addPoints(s,0,-1),a=(new nn).execute(o,e,r);const m=s.getPointCount();if(i.setEmpty(),e.getInputSR().isPannable()){if(m!==a.getPointCount())return!1;const n=new t.Envelope2D;s.queryEnvelope(n);const r=new t.Envelope2D;a.queryEnvelope(r);const o=n.width(),h=r.width();if(0!==o&&0!==h){const t=h/o,s=e.getOutputSR().getPannableExtent().width()/e.getInputSR().getPannableExtent().width();if(Math.abs(t/s-1)>1e-10)return!1}else if(0!==o||0!==h)return!1;i.add(s,!1);for(let e=0;e<m;e++){const t=a.getXY(e);i.setXY(e,t)}return!0}return!1},e.projectPointsToGCS=function(e,t,s,n){const i=e.getSRToGCSTransform();return(new nn).transform(i,t,s,n,!1)},e.querySinglePartCount=function(e){if(e.isEmpty())return 0;switch(e.getGeometryType()){case s.GeometryType.enumMultiPoint:return e.getImpl().getPointCount();case s.GeometryType.enumPolyline:return e.getImpl().getPathCount();case s.GeometryType.enumPolygon:return e.getImpl().getOGCPolygonCount();case s.GeometryType.enumGeometryCollection:return e.getGeometryCount()}return 1},e.relate=Ze,e.relate$1=Ge,e.s_IntToPublicCutSide=function(e){switch(e){case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 0:return 0;default:s.geometryReleaseAssert(0,"unrecognized cut side")}return 3},e.simplifyOGC=function e(r,o,a,m){if(r.isEmpty())return r;const h=r.getGeometryType();if(h===s.GeometryType.enumPoint){const e=new u.NonSimpleResult;if(Rs(r,e),3===e.m_reason){const e=r.clone();return e.replaceNaNs(1,0),e}return 2===e.m_reason?r.createInstance():r}if(h===s.GeometryType.enumEnvelope){const e=r,s=new t.Envelope2D;e.queryEnvelope(s);const n=i.calculateToleranceFromGeometryForOpFromGeom(o,r,!0).total();return s.isDegenerate(n)?e.createInstance():r}if(s.isSegment(h)){const t=r,s=new n.Polyline({vd:t.getDescription()});return s.addSegment(t,!0),e(s,o,a,m)}s.throwIfGeometryCollectionType(h),s.isMultiVertex(h)||s.throwNotImplementedException("OGC simplify is not implemented for this geometry type");const l=i.calculateToleranceFromGeometryForOpFromGeom(o,r,!1).total(),c=r.getImpl().getIsSimple(l,[0]),g=a?-1:c;if(5===g){if(h===s.GeometryType.enumPolygon&&0!==r.getFillRule()){const e=r.clone();return e.setFillRule(0),e}return r}return Es(r,i.calculateToleranceFromGeometryForOpFromGeom(o,r,!0),!1,g,m,0,!0)},e.snapGeometry=Fr,e.sphericalDistance=I,e.sphericalDistancePointToSegment=function(e,t,s,n,r){const o=s.getUnitVector(),a=n.getUnitVector(),m=t.getUnitVector(),h=new i.Point3D;if(h.setCrossProductVector(o,a),!h.isZero()){h.normalizeThis();const t=m.sub(h.mul(h.dotProduct(m)));if(!t.isZero()){t.normalizeThis();const s=o.add(a).mul(.5);if(s.dotProduct(t)>s.dotProduct(o)){const s=Math.abs(h.dotProduct(m)),n=Math.asin(s);return r.assign(t.getUnitVector().mul(e)),n*e}}}const l=I(1,o,m),u=I(1,a,m);return l<=u?(r.assign(s),l*e):(r.assign(n),u*e)},e.stitchingDensificationDeviationFromTolerance=os,e.symmetricDifference=function(e,r,o,a){if(e.getDimension()>r.getDimension())return ws(Ts(e),e,0,"^");if(e.getDimension()<r.getDimension())return ws(Ts(r),e,0,"^");if(e.isEmpty())return ws(Ts(r),e,0,"^");if(r.isEmpty())return ws(Ts(e),e,0,"^");const m=new t.Envelope2D;e.queryEnvelope(m);const h=new t.Envelope2D;r.queryEnvelope(h);const l=new t.Envelope2D;l.setCoords({env2D:m}),l.mergeEnvelope2D(h);const u=i.calculateToleranceFromGeometryForOp(o,l,!0),c=new Is(a),g=new n.EditShape,d=g.addGeometry(Ts(e)),p=g.addGeometry(Ts(r));let _=0,f=null;if(g.hasCurves()){f=new ms;const e=g.getEnvelope2D(a);_=os(u.total()),ss(g,rs(u.total(),e),u.total(),0,f,null,a)}c.setEditShapeCrackAndCluster(g,u);const y=c.symmetricDifference(d,p);null!==f&&f.stitchCurves(g,y,_,!0);const x=ws(g.getGeometry(y),e,0,"^");return ys(x.getGeometryType())&&(x.getImpl().setIsSimple(4,u.total()),x.getGeometryType()===s.GeometryType.enumPolygon&&x.getImpl().updateOGCFlagsProtected()),x},e.testPointsInArea2D=Kt,e.transformInPlace=Qs,e.validateSclString=Me})},"esri/chunks/OperatorClip":function(){define(["exports","./SimpleGeometryCursor","./Geometry","./Envelope","./Envelope2D","./MultiPathImpl","./Point2D"],function(e,t,s,n,i,r,o){"use strict";function a(e,t,s,n,i){return m(e,t,null,s,n,i)}function m(e,t,r,o,m,l){const u=e.getGeometryType();if(u===s.GeometryType.enumPoint){const s=e.getXY();return t.contains(s)?e:e.createInstance()}if(u===s.GeometryType.enumEnvelope){const s=i.Envelope2D.constructEmpty();if(e.queryEnvelope(s),s.intersect(t)){const t=e.clone();return t.setEnvelope(s),t}return e.createInstance()}if(e.isEmpty())return e;if(t.isEmpty())return e.createInstance();const c=t.clone();{const t=new i.Envelope2D;if(e.queryLooseEnvelope(t),c.containsEnvelope(t))return e;if(!c.isIntersecting(t))return e.createInstance();0===m&&(t.intersect(c),t.inflate(Math.max(.1*t.maxDimension(),1)),t.intersect(c),c.assign(t))}let g=o;if((null!==r||Number.isNaN(g))&&(g=n.calculateToleranceFromGeometryForOp(r,c,!1).total()),u===s.GeometryType.enumGeometryCollection){const t=e,s=e.createInstance();for(let e=0,n=t.getGeometryCount();e<n;e++){const n=t.getGeometry(e);if(n.isEmpty())continue;const i=a(n,c,g,m,l);i.isEmpty()||(i===n?s.addGeometry(i.clone()):s.addGeometry(i))}return s}s.isMultiVertex(u)||s.throwInvalidArgumentException("Clip: geometry not supported");const d=e.getImpl().getAccelerators();if(null!==d){const e=d.getRasterizedGeometry();s.geometryReleaseAssert(null===e)}switch(u){case s.GeometryType.enumMultiPoint:{const t=e;let n;const i=t.getPointCount(),r=t.getImpl().getAttributeStreamRef(0);let o=0;for(let e=0;e<i;e++){const s=r.readPoint2D(2*e);c.contains(s)||(0===o&&(n=t.createInstance()),o<e&&n.addPoints(t,o,e),o=e+1)}return o>0&&n.addPoints(t,o,i),0===o?t:(s.geometryReleaseAssert(null!==n),n)}case s.GeometryType.enumPolygon:case s.GeometryType.enumPolyline:return function(e,t,s,n,i){return new h(t,i).clipMultiPath2(e,s,n)}(e,c,g,m,l);default:s.throwInternalErrorException("")}}class h{constructor(e,t){this.m_shape=new r.EditShape,this.m_geometry=r.nullHandle,this.m_verticesOnExtentIndex=-1,this.m_verticesOnExtent=[],this.m_progressCounter=0,this.m_extent=new i.Envelope2D(e),this.m_progressTracker=t}progress_(){}clipMultiPath2(e,t,n){return e.getGeometryType()===s.GeometryType.enumPolygon?this.clipPolygonOrProjectedPolyline2(e,n):this.clipPolyline(e,t)}clipPolygonOrProjectedPolyline2(e,t){const n=e.getGeometryType()===s.GeometryType.enumPolyline;if(0===this.m_extent.width()||0===this.m_extent.height())return e.createInstance();const a=i.Envelope2D.constructEmpty();e.queryLooseEnvelope(a),this.m_geometry=n?this.m_shape.addGeometry(e):this.m_shape.addGeometry(e,this.m_extent);const m=i.Envelope2D.constructEmpty(),l=i.Envelope2D.constructEmpty(),u=new o.Point2D,c=new o.Point2D,g=o.makePrimitiveArray(9,Number.NaN),d=o.makePrimitiveArray(9,Number.NaN),p=o.makeObjectArray(o.Point2D,9);let _=null;const f=new r.Line,y=[];let x=!1;for(let e=0;!x&&e<4;e++){let t=!1;const i=!!(1&e);let o=0;switch(e){case 0:o=this.m_extent.xmin,t=a.xmin<=o&&a.xmax>=o;break;case 1:o=this.m_extent.ymin,t=a.ymin<=o&&a.ymax>=o;break;case 2:o=this.m_extent.xmax,t=a.xmin<=o&&a.xmax>=o;break;case 3:o=this.m_extent.ymax,t=a.ymin<=o&&a.ymax>=o}if(t){x=!0;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==r.nullHandle;){let a=!0,P=-1,E=-1;const v=this.m_shape.getFirstVertex(t);let C=v;do{this.progress_(),_=this.m_shape.getSegment(C);let t=_;if(null===t){const e=this.m_shape.getNextVertex(C);if(e===r.nullHandle){s.geometryReleaseAssert(n),0===P&&y.push(C);break}this.m_shape.queryXY(C,u),f.setStartXY(u),this.m_shape.queryXY(e,c),f.setEndXY(c),t=f}t.queryLooseEnvelope(m);let v=h.checkSegmentIntersection(m,e,o);t.isCurve()&&0===v&&t.isCurve()&&(f.setStartXY(t.getStartXY()),f.setEndXY(t.getEndXY()),this.m_shape.replaceCurveWithLine(C),t=f,f.queryEnvelope(m),v=h.checkSegmentIntersection(m,e,o));let D=0,b=r.nullHandle;if(-1===v){const n=t.intersectionWithAxis2D(i,o,g,d);if(n>0){let e=null;if(t.isCurve()){e=p,s.geometryReleaseAssert(n<=9);for(let e=0;e<n;e++)i?p[e].setCoords(g[e],o):p[e].setCoords(o,g[e]);D=this.m_shape.splitSegmentAxisAware(C,d,n,e,i?1:0)}else D=this.m_shape.splitSegmentAxisAware(C,d,n,null,-1)}else D=0;D+=1;let r=C,m=this.m_shape.getNextVertex(r);t=null;for(let t=0;t<D;t++){this.m_shape.queryXY(r,u),this.m_shape.queryXY(m,c),_=this.m_shape.getSegment(r);let t=_;null===t&&(f.setStartXY(u),f.setEndXY(c),t=f),t.queryEnvelope(l);let s=h.checkSegmentIntersection(l,e,o);t.isCurve()&&0===s&&(this.m_shape.replaceCurveWithLine(r),f.setStartXY(u),f.setEndXY(c),t=f,t.queryEnvelope(l),s=h.checkSegmentIntersection(l,e,o)),-1===s&&(i?Math.abs(u.y-o)<Math.abs(c.y-o)?(u.y=o,this.m_shape.setXY(r,u)):(c.y=o,this.m_shape.setXY(m,c)):Math.abs(u.x-o)<Math.abs(c.x-o)?(u.x=o,this.m_shape.setXY(r,u)):(c.x=o,this.m_shape.setXY(m,c)),_=this.m_shape.getSegment(r),t=_,null===t&&(f.setStartXY(u),f.setEndXY(c),t=f),t.queryEnvelope(l),s=h.checkSegmentIntersection(l,e,o),-1===s&&(s=h.checkSegmentIntersectionLoose(l,e,o)));const n=P;P=s,-1===E&&(E=P),0===n&&1===P||1===n&&0===P||0===n&&0===P&&y.push(r),1===P&&(x=!1,a=!1),r=m,b=r,m=this.m_shape.getNextVertex(m)}}if(0===D){const e=P;P=v,-1===E&&(E=P),0===e&&P>=1||e>=1&&0===P||0===e&&0===P&&y.push(C),1===P&&(x=!1,a=!1),b=this.m_shape.getNextVertex(C)}if(C=b,y.length>=256){for(let e=1,t=y.length-1;e<t;e++){const t=y[e];n?this.m_shape.snapVertexForPoleClipping(t,o):this.m_shape.removeVertex(t,!1)}y[1]=y.at(-1),y.length=2}}while(C!==v);if(!a){0!==E||!n&&0!==P&&2!==P||y.push(v);for(let e=0,t=y.length;e<t;e++){const t=y[e];n?this.m_shape.snapVertexForPoleClipping(t,o):this.m_shape.removeVertex(t,!1)}}y.length=0,t=a||0===this.m_shape.getPathSize(t)?this.m_shape.removePath(t):this.m_shape.getNextPath(t)}}}if(x)return e.createInstance();_=null,n?this.removeSpikesAlongPoles():this.resolveBoundaryOverlaps(),t>0&&this.densifyAlongClipExtent(t);const P=this.m_shape.getGeometry(this.m_geometry);return P.getGeometryType()===s.GeometryType.enumPolygon&&P.setFillRule(e.getFillRule()),P}clipPolyline(e,t){const s=i.Envelope2D.constructEmpty(),n=i.Envelope2D.constructEmpty(),a=o.makePrimitiveArray(9,Number.NaN),m=o.makePrimitiveArray(9,Number.NaN),l=new r.SegmentBuffer;let u=e;const c=i.Envelope2D.constructEmpty();e.queryLooseEnvelope(c);for(let t=0;t<4;t++){let i=!1;const r=!!(1&t);let g=0;switch(t){case 0:g=this.m_extent.xmin,i=c.xmin<=g&&c.xmax>=g;break;case 1:g=this.m_extent.ymin,i=c.ymin<=g&&c.ymax>=g;break;case 2:g=this.m_extent.xmax,i=c.xmin<=g&&c.xmax>=g;break;case 3:g=this.m_extent.ymax,i=c.ymin<=g&&c.ymax>=g}if(!i)continue;const d=u;u=e.createInstance();const p=d.getImpl().querySegmentIterator();p.resetToFirstPath();const _=new o.Point2D,f=new o.Point2D;for(;p.nextPath();){let e=-1,i=!0;for(;p.hasNextSegment();){this.progress_();const o=p.nextSegment(),c=o.isDegenerate(0);o.queryLooseEnvelope(s);const d=h.checkSegmentIntersection(s,t,g);if(-1===d){const s=o.intersectionWithAxis2D(r,g,a,m);let d=0;_.assign(o.getStartXY());for(let p=0;p<=s;p++){const y=p<s?m[p]:1;if(d===y)continue;o.queryCut(d,y,l,!1);const x=l.get();let P=!1;if(x.getStartXY().equals(_)||(x.setStartXY(_),P=!0),p<s&&(r?(f.x=a[p],f.y=g):(f.x=g,f.y=a[p]),x.getEndXY().equals(f)||(x.setEndXY(f),P=!0)),P&&x.normalizeAfterEndpointChange(),!c&&x.isDegenerate(0))continue;x.queryEnvelope(n);let E=h.checkSegmentIntersection(n,t,g);if(-1===E){const e=x.getStartXY(),s=x.getEndXY();P=!1,r?Math.abs(e.y-g)<Math.abs(s.y-g)?(e.y=g,x.setStartXY(e),e.equals(x.getStartXY())||(x.setStartXY(e),P=!0)):(s.y=g,s.equals(x.getEndXY())||(x.setEndXY(s),P=!0)):Math.abs(e.x-g)<Math.abs(s.x-g)?(e.x=g,e.equals(x.getStartXY())||(x.setStartXY(e),P=!0)):(s.x=g,s.equals(x.getEndXY())||(x.setEndXY(s),P=!0)),P&&x.normalizeAfterEndpointChange(),x.queryEnvelope(n),E=h.checkSegmentIntersection(n,t,g),-1===E&&(E=h.checkSegmentIntersectionLoose(n,t,g))}_.assign(x.getEndXY()),d=y,e=E,e>=1?(u.addSegment(x,i),i=!1):i=!0}}else e=d,e>=1?(u.addSegment(o,i),i=!1):i=!0}}}return u}static checkSegmentIntersection(e,t,n){switch(t){case 0:return e.xmin<n&&e.xmax<=n?0:e.xmin>=n?e.xmax===n?2:1:-1;case 1:return e.ymin<n&&e.ymax<=n?0:e.ymin>=n?e.ymax===n?2:1:-1;case 2:return e.xmin>=n&&e.xmax>n?0:e.xmax<=n?e.xmin===n?2:1:-1;case 3:return e.ymin>=n&&e.ymax>n?0:e.ymax<=n?e.ymin===n?2:1:-1}return s.throwInternalErrorException(""),0}static checkSegmentIntersectionLoose(e,t,n){switch(t){case 0:{const t=Math.abs(e.xmin-n),i=Math.abs(e.xmax-n);return e.xmin<n?t>i?0:1:(s.throwInternalErrorException(""),1)}case 1:{const t=Math.abs(e.ymin-n),i=Math.abs(e.ymax-n);return e.ymin<n?t>i?0:1:(s.throwInternalErrorException(""),1)}case 2:{const t=Math.abs(e.xmin-n),i=Math.abs(e.xmax-n);return e.xmax>n?t<i?0:1:(s.throwInternalErrorException(""),1)}case 3:{const t=Math.abs(e.ymin-n),i=Math.abs(e.ymax-n);return e.ymax>n?t<i?0:1:(s.throwInternalErrorException(""),1)}}return s.throwInternalErrorException(""),0}resolveBoundaryOverlaps(){this.m_verticesOnExtentIndex=-1,this.splitSegments(!1,this.m_extent.xmin),this.splitSegments(!1,this.m_extent.xmax),this.splitSegments(!0,this.m_extent.ymin),this.splitSegments(!0,this.m_extent.ymax),this.m_verticesOnExtent.length=0,this.m_verticesOnExtentIndex=this.m_shape.createUserIndex();const e=new o.Point2D;for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==r.nullHandle;t=this.m_shape.getNextPath(t)){let s=this.m_shape.getFirstVertex(t);for(let n=0,i=this.m_shape.getPathSize(t);n<i;n++,s=this.m_shape.getNextVertex(s))this.progress_(),this.m_shape.queryXY(s,e),this.m_extent.xmin!==e.x&&this.m_extent.xmax!==e.x&&this.m_extent.ymin!==e.y&&this.m_extent.ymax!==e.y||(this.m_shape.setUserIndex(s,this.m_verticesOnExtentIndex,this.m_verticesOnExtent.length),this.m_verticesOnExtent.push(s))}this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmin),this.dbgCheckPathFirst(),this.resolveOverlaps(!1,this.m_extent.xmax),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymin),this.dbgCheckPathFirst(),this.resolveOverlaps(!0,this.m_extent.ymax),this.fixPaths()}densifyAlongClipExtent(e){const t=new o.Point2D(0,0),n=new o.Point2D(0,0),i=o.makePrimitiveArray(2048,Number.NaN);for(let a=this.m_shape.getFirstPath(this.m_geometry);a!==r.nullHandle;a=this.m_shape.getNextPath(a)){const r=this.m_shape.getFirstVertex(a);let m=r;do{const r=this.m_shape.getNextVertex(m);this.m_shape.queryXY(m,t);let a=-1;if(t.x===this.m_extent.xmin?(this.m_shape.queryXY(r,n),n.x===this.m_extent.xmin&&(a=1)):t.x===this.m_extent.xmax&&(this.m_shape.queryXY(r,n),n.x===this.m_extent.xmax&&(a=1)),t.y===this.m_extent.ymin?(this.m_shape.queryXY(r,n),n.y===this.m_extent.ymin&&(a=0)):t.y===this.m_extent.ymax&&(this.m_shape.queryXY(r,n),n.y===this.m_extent.ymax&&(a=0)),-1===a){m=r;continue}if(this.isCurve(m)){m=r;continue}const h=t.clone(),l=new o.Point2D(0,0);if(a){const s=t.y-this.m_extent.ymin;l.y=o.sign(n.y-t.y),h.y=e*o.copySign(Math.floor(Math.abs(s)/e),s)+this.m_extent.ymin,l.y<0&&(h.y+=e)}else{const s=t.x-this.m_extent.xmin;l.x=o.sign(n.x-t.x),h.x=e*o.copySign(Math.floor(Math.abs(s)/e),s)+this.m_extent.xmin,l.x<0&&(h.x+=e)}const u=a?n.y-t.y:n.x-t.x,c=Math.abs(u);if(c/e>65536&&s.throwInternalErrorException(""),c>0){const n=Math.trunc(c/e)+2;i.length<n&&(i.length=n);let r=0;for(let n=0;;n++){const o=h.add(l.mul(n*e)),m=(a?o.y-t.y:o.x-t.x)/u;if(m>=1)break;m<=0||(s.geometryReleaseAssert(r<=i.length),i[r]=m,r++)}0!==r&&this.m_shape.splitSegment(m,i,r)}m=r}while(m!==r)}}splitSegments(e,t){let s=-1;const n=new o.Point2D,i=[];for(let o=this.m_shape.getFirstPath(this.m_geometry);o!==r.nullHandle;o=this.m_shape.getNextPath(o)){let a=this.m_shape.getFirstVertex(o),m=r.nullHandle;for(let r=0,h=this.m_shape.getPathSize(o);r<h;r++,a=m)if(this.progress_(),m=this.m_shape.getNextVertex(a),this.m_shape.queryXY(a,n),(e?n.y===t:n.x===t)&&(this.m_shape.queryXY(m,n),e?n.y===t:n.x===t)){if(this.isCurve(a))continue;-1===s&&(s=this.m_shape.createUserIndex()),1!==this.m_shape.getUserIndex(a,s)&&(i.push(a),this.m_shape.setUserIndex(a,s,1)),1!==this.m_shape.getUserIndex(m,s)&&(i.push(m),this.m_shape.setUserIndex(m,s,1))}}if(-1!==s&&this.m_shape.removeUserIndex(s),i.length<3)return;i.sort((e,t)=>this.compareVertices(e,t));const a=new o.Point2D,m=new o.Point2D,h=new o.Point2D;m.setNAN();let l=-1,u=[],c=[];const g=this.m_shape.createUserIndex(),d=this.m_shape.createUserIndex();for(let s=0,r=i.length;s<r;s++){const r=i[s];if(this.m_shape.queryXY(r,n),!n.isEqualPoint2D(m)){if(-1===l){l=s,m.setCoordsPoint2D(n);continue}for(let n=l;n<s;n++){const s=i[n],r=this.m_shape.getNextVertex(s),o=this.m_shape.getPrevVertex(s);let h=!1;this.m_shape.queryXY(r,a),m.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(s)||(u.push(s),h=!0,this.m_shape.setUserIndex(s,d,1))),this.m_shape.queryXY(o,a),m.compare(a)<0&&(e?a.y===t:a.x===t)&&(this.isCurve(o)||(h||u.push(s),this.m_shape.setUserIndex(s,g,1)))}for(let e=0,t=u.length;e<t;e++){const t=u[e],s=this.m_shape.getUserIndex(t,g),i=this.m_shape.getUserIndex(t,d);if(1===s){const e=this.m_shape.getPrevVertex(t);this.m_shape.queryXY(e,h);let s=0;if(!h.isEqualPoint2D(n)){const i=o.Point2D.distance(m,h);s=o.Point2D.distance(h,n)/i,0===s?s=Number.EPSILON:1===s&&(s=1-Number.EPSILON),this.m_shape.splitSegment(e,[s],1);const r=this.m_shape.getPrevVertex(t);this.m_shape.setXY(r,n),c.push(r),this.m_shape.setUserIndex(r,g,1),this.m_shape.setUserIndex(r,d,-1)}}if(1===i){const e=this.m_shape.getNextVertex(t);this.m_shape.queryXY(e,h);let s=0;if(!h.isEqualPoint2D(n)){const e=o.Point2D.distance(m,h);s=o.Point2D.distance(m,n)/e,0===s?s=Number.EPSILON:1===s&&(s=1-Number.EPSILON),this.m_shape.splitSegment(t,[s],1);const i=this.m_shape.getNextVertex(t);this.m_shape.setXY(i,n),c.push(i),this.m_shape.setUserIndex(i,g,-1),this.m_shape.setUserIndex(i,d,1)}}}const r=u;u=c,c=r,c.length=0,l=s,m.setCoordsPoint2D(n)}}this.m_shape.removeUserIndex(g),this.m_shape.removeUserIndex(d)}resolveOverlaps(e,t){const n=new o.Point2D,i=[];let a=-1;for(let s=0,o=this.m_verticesOnExtent.length;s<o;s++){this.progress_();const o=this.m_verticesOnExtent[s];if(o===r.nullHandle)continue;const m=this.m_shape.getNextVertex(o);if(this.m_shape.queryXY(o,n),(e?n.y===t:n.x===t)&&(this.m_shape.queryXY(m,n),e?n.y===t:n.x===t)){if(this.isCurve(o))continue;-1===a&&(a=this.m_shape.createUserIndex()),-2!==this.m_shape.getUserIndex(o,a)&&(i.push(o),this.m_shape.setUserIndex(o,a,-2)),-2!==this.m_shape.getUserIndex(m,a)&&(i.push(m),this.m_shape.setUserIndex(m,a,-2))}}if(0===i.length)return void(-1!==a&&this.m_shape.removeUserIndex(a));s.geometryReleaseAssert(-1!==a),i.sort((e,t)=>this.compareVertices(e,t));for(let e=0,t=i.length;e<t;e++){const t=i[e];this.m_shape.setUserIndex(t,a,e)}const m=new o.Point2D,h=new o.Point2D;h.setNAN();let l=-1;for(let s=0,o=i.length;s<o;s++){this.progress_();const o=i[s];if(o!==r.nullHandle&&(this.m_shape.queryXY(o,n),!n.isEqualPoint2D(h))){if(-1!==l)for(;;){let n=!1;const o=s;for(let u=l;u<o;u++){const o=i[u];if(o===r.nullHandle)continue;let l=r.nullHandle;const c=this.m_shape.getNextVertex(o);this.m_shape.queryXY(c,m),h.compare(m)<0&&(e?m.y===t:m.x===t)&&(this.isCurve(o)||(l=c));let g=r.nullHandle;const d=this.m_shape.getPrevVertex(o);if(this.m_shape.queryXY(d,m),h.compare(m)<0&&(e?m.y===t:m.x===t)&&(this.isCurve(d)||(g=d)),l===r.nullHandle||g===r.nullHandle){if(l!==r.nullHandle||g!==r.nullHandle){for(let c=u+1;c<s;c++){const s=i[c];if(s===r.nullHandle)continue;const u=this.m_shape.getNextVertex(s);let d=r.nullHandle;this.m_shape.queryXY(u,m),h.compare(m)<0&&(e?m.y===t:m.x===t)&&(this.isCurve(s)||(d=u));const p=this.m_shape.getPrevVertex(s);let _=r.nullHandle;if(this.m_shape.queryXY(p,m),h.compare(m)<0&&(e?m.y===t:m.x===t)&&(this.isCurve(p)||(_=p)),d!==r.nullHandle&&_!==r.nullHandle){this.beforeRemoveVertex(s,i,a),this.m_shape.removeVertex(s,!1),this.beforeRemoveVertex(d,i,a),this.m_shape.removeVertex(d,!1),n=!0;break}if(l!==r.nullHandle&&_!==r.nullHandle){this.removeOverlap(i,o,l,s,_,a),n=!0;break}if(g!==r.nullHandle&&d!==r.nullHandle){this.removeOverlap(i,s,d,o,g,a),n=!0;break}}if(n)break}}else this.beforeRemoveVertex(o,i,a),this.m_shape.removeVertex(o,!1),this.beforeRemoveVertex(l,i,a),this.m_shape.removeVertex(l,!1),n=!0}if(!n)break}l=s,h.setCoordsPoint2D(n)}}this.m_shape.removeUserIndex(a)}beforeRemoveVertex(e,t,n){let i=this.m_shape.getUserIndex(e,n);s.geometryReleaseAssert(i>=0),t[i]=r.nullHandle,i=this.m_shape.getUserIndex(e,this.m_verticesOnExtentIndex),s.geometryReleaseAssert(i>=0),this.m_verticesOnExtent[i]=r.nullHandle;const o=this.m_shape.getPathFromVertex(e);o!==r.nullHandle&&this.m_shape.getFirstVertex(o)===e&&(this.m_shape.setFirstVertex(o,r.nullHandle),this.m_shape.setLastVertex(o,r.nullHandle))}removeOverlap(e,t,s,n,i,r){this.m_shape.setNextVertex(t,n),this.m_shape.setPrevVertex(n,t),this.m_shape.setPrevVertex(s,i),this.m_shape.setNextVertex(i,s),this.beforeRemoveVertex(n,e,r),this.m_shape.removeVertexInternal(n,!1),this.beforeRemoveVertex(i,e,r),this.m_shape.removeVertexInternal(i,!0)}removeSpikesAlongPoles(){this.removeSpikesOnPole(this.m_extent.ymin),this.removeSpikesOnPole(this.m_extent.ymax)}removeSpikesOnPole(e){for(let t=this.m_shape.getFirstPath(this.m_geometry);t!==r.nullHandle;t=this.m_shape.getNextPath(t)){const s=this.m_shape.getPathSize(t);if(s<3)continue;let n=this.m_shape.getFirstVertex(t);const i=new o.Point2D;this.m_shape.queryXY(n,i);let r=i.y===e&&!this.isCurve(n);n=this.m_shape.getNextVertex(n);const a=new o.Point2D;this.m_shape.queryXY(n,a);let m=a.y===e&&!this.isCurve(n);n=this.m_shape.getNextVertex(n);const h=new o.Point2D;for(let t=0,o=s-2;t<o;t++,n=this.m_shape.getNextVertex(n)){this.progress_(),this.m_shape.queryXY(n,h);const t=h.y===e;m&&r&&t&&(a.x-i.x)*(h.x-a.x)<=0?(this.m_shape.removeVertex(this.m_shape.getPrevVertex(n),!1),a.setCoordsPoint2D(h),m=t&&!this.isCurve(n)):(i.setCoordsPoint2D(a),r=m,a.setCoordsPoint2D(h),m=t&&!this.isCurve(n))}}}fixPaths(){for(let e=0,t=this.m_verticesOnExtent.length;e<t;e++){const t=this.m_verticesOnExtent[e];t!==r.nullHandle&&this.m_shape.setPathToVertex(t,r.nullHandle)}const e=this.m_shape.hasCurves();let t=0,n=0;for(let e=this.m_shape.getFirstPath(this.m_geometry);e!==r.nullHandle;){const s=this.m_shape.getFirstVertex(e);if(s===r.nullHandle||e!==this.m_shape.getPathFromVertex(s)){const t=e;e=this.m_shape.getNextPath(e),this.m_shape.setFirstVertex(t,r.nullHandle),this.m_shape.removePathOnly(t);continue}let i=s,o=0;do{this.m_shape.setPathToVertex(i,e),o++,i=this.m_shape.getNextVertex(i)}while(i!==s);this.m_shape.setRingAreaValid(e,!1),this.m_shape.setLastVertex(e,this.m_shape.getPrevVertex(s)),this.m_shape.setPathSize(e,o),n+=o,t++,e=this.m_shape.getNextPath(e)}for(let i=0,o=this.m_verticesOnExtent.length;i<o;i++){let o=this.m_verticesOnExtent[i];if(o===r.nullHandle)continue;let a=this.m_shape.getPathFromVertex(o);if(a!==r.nullHandle)continue;a=this.m_shape.insertPath(this.m_geometry,r.nullHandle);let m=!1,h=0;const l=o;do{this.m_shape.setPathToVertex(o,a),h++,e&&h<=2&&(m||=this.isCurve(o)),o=this.m_shape.getNextVertex(o)}while(o!==l);if(m?0===h:h<=2){let e=this.m_shape.getUserIndex(l,this.m_verticesOnExtentIndex);s.geometryReleaseAssert(e>=0),this.m_verticesOnExtent[e]=r.nullHandle;const t=this.m_shape.removeVertex(l,!1);2===h&&(e=this.m_shape.getUserIndex(t,this.m_verticesOnExtentIndex),e>=0&&(this.m_verticesOnExtent[e]=r.nullHandle),this.m_shape.removeVertex(t,!1));const n=a;a=this.m_shape.getNextPath(a),this.m_shape.setFirstVertex(n,r.nullHandle),this.m_shape.removePathOnly(n);continue}this.m_shape.setClosedPath(a,!0),this.m_shape.setPathSize(a,h),this.m_shape.setFirstVertex(a,l),this.m_shape.setLastVertex(a,this.m_shape.getPrevVertex(l)),this.m_shape.setRingAreaValid(a,!1),n+=h,t++}this.m_shape.setGeometryPathCount(this.m_geometry,t),this.m_shape.setGeometryVertexCount(this.m_geometry,n);let i=0;for(let e=this.m_shape.getFirstGeometry();e!==r.nullHandle;e=this.m_shape.getNextGeometry(e))i+=this.m_shape.getPointCount(e);this.m_shape.setTotalPointCount(i)}dbgCheckPathFirst(){}isCurve(e){return null!==this.m_shape.getSegment(e)}compareVertices(e,t){const s=new o.Point2D;this.m_shape.queryXY(e,s);const n=new o.Point2D;return this.m_shape.queryXY(t,n),s.compare(n)}clipPolesOut(e,t){return this.clipPolygonOrProjectedPolyline2(e,t)}}class l extends t.GeometryCursor{constructor(e,t,i,r){super(),this.m_progressTracker=r,this.m_index=-1,e||s.throwInvalidArgumentException(""),this.m_envelope=t,this.m_inputGeometryCursor=e,this.m_spatialRefImpl=i,this.m_tolerance=n.calculateToleranceFromGeometryForOp(i,t,!1).total()}next(){let e;return(e=this.m_inputGeometryCursor.next())?(s.throwIfMesh(e),this.m_index=this.m_inputGeometryCursor.getGeometryID(),a(e,this.m_envelope,this.m_tolerance,0,this.m_progressTracker)):null}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}}e.OperatorClip=class{getOperatorType(){return 10004}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s,n){return new l(e,t,s,n)}execute(e,t,s,n){return function(e,t,s,n){return m(e,t,s,Number.NaN,0,n)}(e,t,s,n)}},e.clip$1=a,e.clipPolesOut=function(e,t,s,n,r,o){const a=new h(t,o),m=new i.Envelope2D;return e.queryLooseEnvelope(m),t.containsEnvelope(m)?e:t.isIntersecting(m)?a.clipPolesOut(e,r):e.createInstance()}})},"esri/chunks/OperatorDensify":function(){define(["exports","./SimpleGeometryCursor","./Geometry","./MultiPathImpl"],function(e,t,s,n){"use strict";var i=n.Densificator;class r extends t.GeometryCursor{constructor(e,t,s,n,r,o){super(),this.m_densificator=new i(t,s,n,o,!1,r),this.m_index=-1,this.m_inputGeoms=e}tock(){return!0}getRank(){return 1}next(){let e=null;for(;e=this.m_inputGeoms.next();)return s.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.densify(e);return null}getGeometryID(){return this.m_index}densify(e){return this.m_densificator.densify(e)}}e.OperatorDensify=class{getOperatorType(){return 10202}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,t,s,n,i,o=12e3){return new r(e,t,s,n,o,i)}execute(e,t,s,i,r,o=12e3){return n.densify(e,t,s,i,r,o)}}})},"esri/geometry/operators/support/initNoPeFactory":function(){define(["../../../chunks/Envelope2D","../../../chunks/Geometry","../../../chunks/MultiPathImpl","../../../chunks/Envelope","../../../chunks/Point2D","../../../chunks/ProjectionTransformation","../../../core/unitUtils","../../support/spatialReferenceUtils"],function(e,t,s,n,i,r,o,a){"use strict";r.injectNoPe$1(e=>{let t,s;"number"==typeof e?t=e:s=e;const n={wkid:t,wkt:s};let i,r;if(s){i=o.isProjectedWKT(s);const e=a.isGeographic(n);if(!i&&!e)throw new Error(`Unsupported WKT type: ${s}`)}else i=!a.isGeographic(n);return r=t&&o.gradGcsIds.has(t)?Math.PI/200:i?o.getMetersPerUnit(n):Math.PI/180,{isPCS:i,metersOrRadiansPerUnit:r,semiMajor:0,wkidOrWkt:e}})})},"esri/geometry/operators/support/jsonConverter":function(){define(["exports","../../../chunks/Geometry","../../../chunks/Point2D","../../../chunks/ProjectionTransformation","../../../chunks/Envelope","../../../chunks/MultiPathImpl","./initNoPeFactory"],function(e,t,s,n,i,r,o){"use strict";function a(){if(-1===this.m_i)return this.m_i=0,{value:{m_token:1,m_value:null},done:!1};if(this.m_i<this.m_keys.length){const e=this.m_bReturnKey,t=Math.trunc(this.m_i);return this.m_bReturnKey=!this.m_bReturnKey,this.m_i+=.5,e?{value:{m_token:5,m_value:this.m_keys[t]},done:!1}:{value:{m_token:6,m_value:this.m_o[this.m_keys[t]]},done:!1}}return{value:{m_token:3,m_value:null},done:!0}}function m(){if(-1===this.m_i)return this.m_i=0,{value:{m_token:2,m_value:null},done:!1};if(this.m_i<this.m_a.length){const e={value:{m_token:6,m_value:this.m_a[this.m_i++]},done:!1};return this.m_strict||void 0===e.value.m_value&&(e.value.m_value=Number.NaN),e}return{value:{m_token:4,m_value:null},done:!0}}class h{createJSONObjectIterator(e){return{m_iteratorType:"object",m_o:e,m_keys:this.m_options.strict?Object.keys(e):Object.keys(e).filter(t=>void 0!==e[t]),m_i:-1,m_bReturnKey:!0,next:a}}createJSONArrayIterator(e){return{m_iteratorType:"array",m_strict:this.m_options.strict,m_i:-1,m_a:e,next:m}}constructor(e,t){this.m_currentToken=0,this.m_options=t?{...t}:{strict:!0};const s=e;this.m_iteratorStack=[s instanceof Array?this.createJSONArrayIterator(s):this.createJSONObjectIterator(s)],this.m_nextFlatToken={m_value:null,m_token:0}}nextToken(){if(0===this.m_iteratorStack.length)return this.m_currentToken=0;switch(this.m_nextFlatToken=this.m_iteratorStack.at(-1).next().value,this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_currentToken=1;case 3:return this.m_iteratorStack.pop(),this.m_currentToken=3;case 2:return this.m_currentToken=2;case 4:return this.m_iteratorStack.pop(),this.m_currentToken=4;case 5:return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=5;case 6:if(this.m_nextFlatToken.m_value instanceof Array)return this.m_iteratorStack.push(this.createJSONArrayIterator(this.m_nextFlatToken.m_value)),this.nextToken();if(this.m_nextFlatToken.m_value instanceof Object)return this.m_iteratorStack.push(this.createJSONObjectIterator(this.m_nextFlatToken.m_value)),this.nextToken();if("number"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,Number.isSafeInteger(this.m_currentValue)&&this.m_currentValue>=s.intMin()&&this.m_currentValue<=s.intMax()?this.m_currentToken=8:this.m_currentToken=7;if("string"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=6;if("boolean"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=this.m_nextFlatToken.m_value,this.m_currentToken=this.m_nextFlatToken.m_value?11:12;if("object"==typeof this.m_nextFlatToken.m_value)return this.m_currentValue=null,this.m_currentToken=10;t.throwInternalErrorException("unrecognized json element type")}return t.throwInternalErrorException("unrecognized json element type"),0}currentToken(){return this.m_currentToken}skipChildren(){if(0!==this.m_iteratorStack.length)switch(this.m_currentValue=void 0,this.m_nextFlatToken.m_token){case 1:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=3,void(this.m_currentToken=3);case 2:return this.m_iteratorStack.pop(),this.m_nextFlatToken.m_token=4,void(this.m_currentToken=4)}}currentString(){return 6!==this.m_currentToken&&5!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}currentDoubleValue(){return 7!==this.m_currentToken&&8!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}currentInt32Value(){return 8!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}currentInt64Value(){return t.geometryReleaseAssert(0),0n}currentBoolValue(){return 12!==this.m_currentToken&&11!==this.m_currentToken&&t.throwInvalidArgumentException("invalid token"),this.m_currentValue}isError(){return 0}}class l{constructor(e){return this.m_buffer=null,this.m_view=null,this.m_sz=0,this.m_offset=0,this.m_bOwnsBuffer=!0,this.m_bLittleEndian=!0,this.m_element=new ArrayBuffer(8),this.m_elementBytes=new Uint8Array(this.m_element),this.m_elementView=new DataView(this.m_element),this.m_elementDouble=new Float64Array(this.m_element),this.m_elementFloat=new Float32Array(this.m_element),this.m_elementInt64=new BigInt64Array(this.m_element),this.m_elementInt32=new Int32Array(this.m_element),this.m_elementInt16=new Int16Array(this.m_element),void 0!==e.sz?(this.m_sz=e.sz,e.buffer?(this.m_sz<0&&t.throwOutOfRangeException("size out of range"),this.m_buffer=e.buffer,this.m_offset=void 0!==e.offset?e.offset:0,this.m_view=void 0!==e.offset?new DataView(e.buffer,e.offset,e.sz):new DataView(this.m_buffer),this.m_bOwnsBuffer=!1,void(this.m_bLittleEndian=!0)):(this.m_sz<0&&t.throwOutOfRangeException("size out of range"),void(this.m_sz>0&&(this.m_buffer=new ArrayBuffer(this.m_sz),this.m_view=new DataView(this.m_buffer))))):e.move?(this.m_sz=e.move.m_sz,this.m_buffer=e.move.m_buffer,this.m_view=e.move.m_view,this.m_bOwnsBuffer=e.move.m_bOwnsBuffer,this.m_bLittleEndian=e.move.m_bLittleEndian,e.move.m_buffer=null,e.move.m_view=null,e.move.m_sz=0,void(e.move.m_bOwnsBuffer=!0)):void t.throwInternalErrorException("unrecognized constructor options")}swapBytesDouble(){this.doSwap()&&(this.m_elementDouble[0]=this.m_elementBytes[0]<<56|this.m_elementBytes[1]<<48|this.m_elementBytes[2]<<40|this.m_elementBytes[3]<<32|this.m_elementBytes[4]<<24|this.m_elementBytes[5]<<16|this.m_elementBytes[6]<<8|this.m_elementBytes[7])}swapBytesInt32(){this.doSwap()&&(this.m_elementInt32[0]=this.m_elementBytes[0]<<24|this.m_elementBytes[1]<<16|this.m_elementBytes[2]<<8|this.m_elementBytes[3])}getOffset(){return this.m_offset}assignMove(e){return this===e||(this.clear(),this.m_sz=e.m_sz,this.m_buffer=e.m_buffer,this.m_view=e.m_view,this.m_bOwnsBuffer=e.m_bOwnsBuffer,this.m_bLittleEndian=e.m_bLittleEndian,e.m_buffer=null,e.m_sz=0,e.m_bOwnsBuffer=!0),this}doSwap(){return this.m_bLittleEndian!==(1===l.getNativeByteOrder())}setNativeByteOrder(){this.m_bLittleEndian=1===l.getNativeByteOrder()}setOrder(e){this.m_bLittleEndian=1===e}getOrder(){return this.m_bLittleEndian?1:0}getView(){return this.m_view||t.throwInvalidCallException("buffer not defined"),this.m_view}static getNativeByteOrder(){return 1}clear(){this.m_buffer=null,this.m_sz=0,this.m_bOwnsBuffer=!0}size(){return this.m_sz}readDouble(e){return this.doSwap()?(this.m_elementDouble[0]=this.m_view.getFloat64(e,this.m_bLittleEndian),this.swapBytesDouble(),this.m_elementDouble[0]):this.m_view.getFloat64(e,this.m_bLittleEndian)}writeDouble(e,t){this.m_elementDouble[0]=t,this.swapBytesDouble(),this.m_view.setFloat64(e,this.m_elementDouble[0],this.m_bLittleEndian)}readInt32(e){return this.doSwap()?(this.m_elementInt32[0]=this.m_view.getInt32(e,this.m_bLittleEndian),this.swapBytesInt32(),this.m_elementInt32[0]):this.m_view.getInt32(e,this.m_bLittleEndian)}writeInt32(e,t){this.m_elementInt32[0]=t,this.swapBytesInt32(),this.m_view.setInt32(e,this.m_elementInt32[0],this.m_bLittleEndian)}getPtr(){return this.m_buffer}setSizeNoRealloc(e){t.geometryReleaseAssert(e>=0&&e<=this.m_sz),this.m_sz=e}}function u(e){let t=!1;for(;3!==e.nextToken();){const s=e.currentString();e.nextToken(),"uwkid"===s?t||(t=!0,8===e.currentToken()&&e.currentInt32Value()):e.skipChildren()}return null}function c(e){let t=!1,s=!1,i=!1,r=!1,o=!1,a=!1,m=!1,h=!1,l=!1,c=!1,g=!1,d=!1,p=!1,_=!1,f=!1,y=!1,x=!1,P=-1,E=-1,v=-1,C=-1,D=0,b=0,S=0,I=0,w=0,T=0,A=0,N=0,G=0,M=0,R="",k="",F=null;for(;3!==e.nextToken();){const n=e.currentString();e.nextToken(),"wkid"===n?t||(t=!0,8===e.currentToken()&&(P=e.currentInt32Value())):"latestWkid"===n?s||(s=!0,8===e.currentToken()&&(E=e.currentInt32Value())):"wkt"===n?o||(o=!0,6===e.currentToken()&&(R=e.currentString())):"wkt2"===n?o||6===e.currentToken()&&(k=e.currentString()):"vcsWkid"===n?i||(i=!0,8===e.currentToken()&&(v=e.currentInt32Value())):"latestVcsWkid"===n?r||(r=!0,8===e.currentToken()&&(C=e.currentInt32Value())):"xyTolerance"===n?m||(m=!0,a=!0,D=e.currentDoubleValue()):"zTolerance"===n?h||(h=!0,a=!0,b=e.currentDoubleValue()):"mTolerance"===n?l||(l=!0,a=!0,S=e.currentDoubleValue()):"falseX"===n?c||(c=!0,a=!0,A=e.currentDoubleValue()):"falseY"===n?g||(g=!0,a=!0,N=e.currentDoubleValue()):"falseZ"===n?d||(d=!0,a=!0,G=e.currentDoubleValue()):"falseM"===n?p||(p=!0,a=!0,M=e.currentDoubleValue()):"xyUnits"===n?_||(_=!0,a=!0,I=e.currentDoubleValue()):"zUnits"===n?f||(f=!0,a=!0,w=e.currentDoubleValue()):"mUnits"===n?y||(y=!0,a=!0,T=e.currentDoubleValue()):"unit"===n?x||(x=!0,F=u(e)):e.skipChildren()}C<=0&&v>0&&(C=v),v<=0&&C>0&&(v=C);let q=null,V=!0;if(0!==R.length&&(V=!1,n.isValidWkt$1(R)&&(q=n.createFromWKT$2(R))),q||0===k.length||(V=!1,n.isValidWkt$1(k)&&(q=n.createFromWKT$2(k))),!q&&E>0&&(V=!1,n.isValidWkid$1(E)&&(C<=0||n.isValidWkid$2())&&(q=n.create$2(E,C))),!q&&P>0&&(V=!1,n.isValidWkid$1(P)&&(v<=0||n.isValidWkid$2())&&(q=n.create$2(P,v))),V&&(q=n.createLocal(F)),a&&q){const e=new n.SpatialReferencePrecisionDescriptor;q.queryPrecisionDescriptorWithoutFalseXY(e),m&&e.setTolerance(0,D),h&&e.setTolerance(1,b),l&&e.setTolerance(2,S),_&&c&&g&&e.setGridParams(A,N,I),f&&d&&e.setZParams(G,w),y&&p&&e.setMParams(M,T),q=n.createWithNewPrecision(q,e)}return q}function g(e,n,o,a){2!==a.currentToken()&&t.throwInvalidArgumentException("failed to parse multipath: array of array of vertices is expected");const m=e?new r.Polygon:new r.Polyline,h=m,l=i.createIndexStream(0),u=i.createDoubleStream(2,0),c=i.createByteStream(0);let g=null,d=null,p=null,f=null,E=null,v=0,C=0,D=0;const b=new r.SegmentBuffer,S=s.Point2D.getNAN();let I=0,w=0;const T=e?1:0;for(;4!==a.nextToken();){2!==a.currentToken()&&t.throwInvalidArgumentException("failed to parse multipath: ring/path array is expected");let o=2,m=0,A=!0;const N=4;let G=0,M=0;const R=s.Point2D.getNAN(),k=s.makePrimitiveArray(N,Number.NaN),F=s.makePrimitiveArray(N,Number.NaN);let q=!1;for(a.nextToken();4!==a.currentToken();){if(n&&1===a.currentToken())A&&t.throwInvalidArgumentException("failed to parse multipath: starting vertex array is expected"),p||(p=i.createByteStream(I-1,1),f=i.createIndexStream(I-1,-1),E=i.createDoubleStream(0)),q=!0,o=1,({segFlag:D,toPointSz:G}=P(b,k,S,a));else{for(q=!1,2!==a.currentToken()&&t.throwInvalidArgumentException("failed to parse multipath: array is expected, rings/paths vertices consist of arrays of coordinates"),G=0;4!==a.nextToken();)G===N&&t.throwInvalidArgumentException("failed to parse multipath: each vertex array has to have at most 4 elements"),k[G++]=_(a);G<2&&t.throwInvalidArgumentException("failed to parse multipath: each vertex array has to have at least 2 elements"),i.checkFinite(k[0],k[1])||t.throwInvalidArgumentException("failed to parse multipath: x and y must be finite")}a.nextToken();do{if(u.size()===2*I&&u.resize(y(I)),u.writePoint2D(2*I,R.setCoords(k[0],k[1])),g&&g.size()===I&&g.resize(x(I)),G>2?(g||(g=i.createDoubleStream(I+1,Number.NaN)),g.write(I,k[2])):g&&g.write(I,Number.NaN),d&&d.size()===I&&d.resize(x(I)),G>3?(d||(d=i.createDoubleStream(I+1,Number.NaN)),d.write(I,k[3])):d&&d.write(I,Number.NaN),A)w++,l.add(I),c.add(T),A=!1,M=G,s.memcpy(F,k,0,0,M);else if(null!==p)if(q){const e=r.sizeInBuffer(D),t=E.size();E.resize(t+e),p.add(D),f.add(v),b.get().writeInBufferStream(E,v),v+=e,h.incCurveType(D,1),C++}else p.add(1),f.add(-1);I++,m++,S.setCoords(k[0],k[1])}while(m<o&&4===a.currentToken())}0!==m&&(e&&m>o&&G===M&&0===s.memcmp(k,F,G)?(I--,m--):null!==p&&(p.add(1),f.add(-1)))}return I&&(l.resize(w),c.resize(w),I>0&&(l.add(I),c.add(0)),h.setAttributeStreamRef(0,u),h.setPathFlagsStreamRef(c),h.setPathStreamRef(l),null!==p&&(h.updateCurveCounter(C),h.setSegmentData(f,E,p,v)),h.notifyModifiedFlags(65535)),{geometry:m,as:g,bs:d}}function d(e,n){2!==n.currentToken()&&t.throwInvalidArgumentException("failed to parse multipoint: array of vertices is expected");let o=0;const a=new r.MultiPoint,m=i.createDoubleStream(2,0);let h=0;const l=s.makePrimitiveArray(4,Number.NaN),u=new s.Point2D;let c=null,g=null;for(;4!==n.nextToken();){for(2!==n.currentToken()&&t.throwInvalidArgumentException("failed to parse multipoint: array is expected, multipoint vertices consist of arrays of cooridinates"),h=0;4!==n.nextToken();)4===h&&t.throwInvalidArgumentException("failed to parse multipoint: each vertex array has to have at most 4 elements"),l[h++]=_(n);h<2&&t.throwInvalidArgumentException("failed to parse multipoint: each vertex array has to have at least 2 elements"),i.checkFinite(l[0],l[1])||t.throwInvalidArgumentException("failed to parse multipoint: x and y must be finite"),m.size()===2*o&&m.resize(y(o)),m.writePoint2D(2*o,u.setCoords(l[0],l[1])),c&&c.size()===o&&c.resize(x(o)),h>2?(c||(c=i.createDoubleStream(o+1,Number.NaN)),c.write(o,l[2])):c&&c.write(o,Number.NaN),g&&g.size()===o&&g.resize(x(o)),h>3?(g||(g=i.createDoubleStream(o+1,Number.NaN)),g.write(o,l[3])):g&&g.write(o,Number.NaN),o++}if(o){const e=a.getImpl();e.setAttributeStreamRef(0,m),e.resizeNoInit(o),e.notifyModifiedFlags(65535)}return{geometry:a,as:c,bs:g}}function p(e,s){2!==s.currentToken()&&t.throwInvalidArgumentException("failed to parse array of IDs: array of array of integers is expected");const n=i.createAttributeStream(2,0);let r=0,o=-1;for(;4!==s.nextToken();){const e=r;n.size()===r&&n.resize(x(r)),r++;let i=0;for(-1===o?o=2===s.currentToken()?1:0:1===o&&2!==s.currentToken()&&t.throwInvalidArgumentException("failed to parse array of IDs: array of array of integers is expected"),0===o&&(n.size()===r&&n.resize(x(r)),n.write(r,f(s)),i++,r++);4!==s.nextToken();)n.size()===r&&n.resize(x(r)),n.write(r,f(s)),i++,r++;if(n.write(e,i),0===o)break}return n.resize(r),n}function _(e){const t=e.currentToken();if(10===t||6===t&&"NaN"===e.currentString())return Number.NaN;{const t=e.currentDoubleValue();return Number.isNaN(t)?Number.NaN:t}}function f(e){return e.currentInt32Value()}function y(e){let t=2*Math.trunc(3*(e+1)/2);return t<8?t=8:t<32&&(t=32),t}function x(e){let t=Math.trunc(3*(e+1)/2);return t<4?t=4:t<16&&(t=16),t}function P(e,n,i,o,a){const m={segFlag:0,toPointSz:0};let h=o.currentToken();h=o.nextToken();const u=o.currentString(),c=u[0];for((1!==u.length||"a"!==c&&"b"!==c&&"c"!==c&&"n"!==c&&"q"!==c)&&t.throwInvalidArgumentException('failed to parse curve: expecting "a", "b", "n", "q", or "c"'),h=o.nextToken(),2!==h&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for curve parameters"),h=o.nextToken(),2!==h&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for to point"),m.toPointSz=0;4!==o.nextToken();)4===m.toPointSz&&t.throwInvalidArgumentException("failed to parse curve: vertex array cannot have more than 4 elements"),n[m.toPointSz++]=_(o);m.toPointSz<2&&t.throwInvalidArgumentException("failed to parse curve: vertex array must have at least 2 elements");const g=s.Point2D.construct(n[0],n[1]),d=s.Point2D.getNAN();let p=-1,f=-1,y=!1,x=Number.NaN,P=Number.NaN,v=Number.NaN;const C=[s.Point2D.getNAN(),s.Point2D.getNAN(),s.Point2D.getNAN()],D=s.Point2D.getNAN();if("a"===c){h=o.nextToken(),2!==h&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for center point"),h=o.nextToken();const e=_(o);h=o.nextToken();const s=_(o);h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for center point"),d.setCoords(e,s),h=o.nextToken(),p=o.currentInt32Value(),h=o.nextToken(),f=o.currentInt32Value(),h=o.nextToken(),4!==h?(y=!1,x=_(o),h=o.nextToken(),P=_(o),h=o.nextToken(),v=_(o),h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters")):y=!0,m.segFlag=4}else if("b"===c){for(let e=0;e<2;e++){h=o.nextToken(),2!==h&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for control point"),h=o.nextToken();const s=_(o);h=o.nextToken();const n=_(o);h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for control point"),C[e].setCoords(s,n)}h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),m.segFlag=2}else if("n"===c){{h=o.nextToken(),2!==h&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for control point"),h=o.nextToken();const e=_(o);h=o.nextToken();const s=_(o);h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for control point"),C[0].setCoords(e,s)}h=o.nextToken();const e=_(o);h=o.nextToken();const s=_(o);h=o.nextToken();const n=_(o);C[1].setCoords(e,s),C[2].setCoords(n,n),h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),m.segFlag=8}else if("q"===c){for(let e=0;e<1;e++){h=o.nextToken(),2!==h&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for control point"),h=o.nextToken();const s=_(o);h=o.nextToken();const n=_(o);h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for control point"),C[e].setCoords(s,n)}h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),m.segFlag=16}else{h=o.nextToken(),2!==h&&t.throwInvalidArgumentException("failed to parse curve: start array is expected for interior point"),h=o.nextToken();const e=_(o);h=o.nextToken();const s=_(o);h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for interior point"),D.setCoords(e,s),h=o.nextToken(),4!==h&&t.throwInvalidArgumentException("failed to parse curve: end array is expected for curve parameters"),m.segFlag=4}if(h=o.nextToken(),3!==h&&t.throwInvalidArgumentException("failed to parse curve: end object is expected for curve"),"a"===c)if(e.createEllipticArc(),y){const t=!0;E(e.get(),i,g,d,t,p,f)}else!function(e,t,s,n,i,o,a,m,h){e.dropAllAttributes();const u=new ArrayBuffer(44),c=new l({sz:44,buffer:u});let g=0;c.writeDouble(g,n.x),g+=8,c.writeDouble(g,n.y),g+=8,c.writeDouble(g,a),g+=8,c.writeDouble(g,m),g+=8,c.writeDouble(g,h),g+=8;let d=0;o||(d|=2048),i&&(d|=4096),c.writeInt32(g,d),g+=4,function(e,t,s,n){e.m_bits=0,e.m_center.x=n.readDouble(0),e.m_center.y=n.readDouble(8),e.m_rotation=n.readDouble(16),e.m_semiMajorAxis=n.readDouble(24),e.m_minorMajorRatio=n.readDouble(32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=s.x,e.m_YEnd=s.y;const i=n.readInt32(40);if(1&i)return!1;let o=!!(64&i),a=!!(128&i);const m=!!(2048&i),h=!!(4096&i);!(512&i)&&!(1024&i)||a||(o=!0),a&&!t.equals(s)?(a=!1,o=!0):o&&t.equals(s)&&(a=!0,o=!1),a?(e.m_center.assign(t),e.m_startAngle=e.m_center.x,e.m_sweepAngle=e.m_center.y,r.arcimpl_NormalizeAngles(e,Number.NaN,m,h),e.m_semiMajorAxis=0,e.m_interior.setCoordsPoint2D(t)):o?(e.m_center.setNAN(),e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,r.clearEndPointModified(e),e.queryCoord2D(.5,e.m_interior)):e.constructEllipticArcEndPointsCenter(t,s,e.m_semiMajorAxis,e.m_minorMajorRatio,e.m_rotation,!h,m,e.m_center),e.setProjectionBehavior(1),r.clearEndPointModified(e)}(e,t,s,c)}(e.get(),i,g,d,p,f,x,P,v);else if("b"===c)e.createCubicBezier(),function(e,n,i,r){e.dropAllAttributes();const o=new ArrayBuffer(32),a=new l({sz:32,buffer:o});let m=0;a.writeDouble(m,r[0].x),m+=8,a.writeDouble(m,r[0].y),m+=8,a.writeDouble(m,r[1].x),m+=8,a.writeDouble(m,r[1].y),m+=8,function(e,n,i,r){t.geometryReleaseAssert(32<=r.size()),e.m_cp=s.makeObjectArray(s.Point2D,2),e.m_cp[0].x=r.readDouble(0),e.m_cp[0].y=r.readDouble(8),e.m_cp[1].x=r.readDouble(16),e.m_cp[1].y=r.readDouble(24),e.m_XStart=n.x,e.m_YStart=n.y,e.m_XEnd=i.x,e.m_YEnd=i.y}(e,n,i,a)}(e.get(),i,g,C);else if("n"===c)e.createQuadraticRationalBezier(),function(e,t,s,n,i,r,o){e.dropAllAttributes();const a=new ArrayBuffer(40),m=new l({sz:40,buffer:a});let h=0;m.writeDouble(h,n.x),h+=8,m.writeDouble(h,n.y),h+=8,m.writeDouble(h,i),h+=8,m.writeDouble(h,r),h+=8,m.writeDouble(h,o),h+=8,function(e,t,s,n){e.m_cp.x=n.readDouble(0),e.m_cp.y=n.readDouble(8),e.m_weights[0]=n.readDouble(16),e.m_weights[1]=n.readDouble(24),e.m_weights[2]=n.readDouble(32),e.m_XStart=t.x,e.m_YStart=t.y,e.m_XEnd=s.x,e.m_YEnd=s.y}(e,t,s,m)}(e.get(),i,g,C[0],C[1].x,C[1].y,C[2].x);else if("q"===c)e.createQuadraticBezier(),e.get().construct(i,C[0],g);else{e.createEllipticArc();const t=!1;E(e.get(),i,g,D,t,-1,-1)}return m}function E(e,n,i,o,a,m,h){e.dropAllAttributes();const u=new ArrayBuffer(20),c=new l({sz:20,buffer:u});let g=0;c.writeDouble(g,o.x),g+=8,c.writeDouble(g,o.y),g+=8;let d=0;a?(h||(d|=8),m&&(d|=16)):d|=128,c.writeInt32(g,d),g+=4,function(e,n,i,o){0>=o.size()&&t.throwOutOfRangeException("Byte_buffer out of range access"),e.m_bits=0,e.m_rotation=0,e.m_cosr=1,e.m_sinr=0,e.setStartXY(n),e.setEndXY(i);const a=s.Point2D.getNAN();a.x=o.readDouble(0),a.y=o.readDouble(8);const m=o.readInt32(16);if(1&m)return e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,r.clearEndPointModified(e),!1;let h=!!(64&m);const l=!!(128&m);let u=!!(32&m);const c=!!(8&m),g=!!(16&m),d=n.equals(i);h&&!d&&(h=!1,u=!0),u&&d&&(h=!0,u=!1,a.setCoords(0,0)),h||(l?u?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_interior.assign(a),e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0):(e.constructCircularArcThreePoint(n,i,a),d&&c===e.isClockwise()&&e.reverse()):u?(e.m_semiMajorAxis=1,e.m_minorMajorRatio=0,e.m_center.setNAN(),e.m_sweepAngle=0,e.m_startAngle=0,r.clearEndPointModified(e),e.queryCoord2D(.5,e.m_interior)):r.constructCircularArcHelperForOldFormat(e,n,i,a,c,g)),h&&(e.m_center.assign(n),e.m_startAngle=a.x,e.m_sweepAngle=a.y,r.arcimpl_NormalizeAngles(e,Number.NaN,c,g),e.m_semiMajorAxis=0,e.m_minorMajorRatio=1,e.m_interior.setCoordsPoint2D(n)),e.setProjectionBehavior(0),r.clearEndPointModified(e)}(e,n,i,c)}function v(e,s,n,i,o){const a=e.getGeometryType();if(a===t.GeometryType.enumEllipticArc)return function(e,s,n,i,o){t.geometryReleaseAssert(!r.isEndPointModified(e));const a=e.getEndXY(),m=e.hasAttribute(1)&&!s,h=e.hasAttribute(2)&&!n;let l=Number.NaN,u=Number.NaN;if(m&&(l=e.getEndAttributeAsDbl(1,0)),h&&(u=e.getEndAttributeAsDbl(2,0)),e.isDegenerateToLine()||e.isDegenerate(0))return D(m,h,a.x,a.y,l,u,i,o),!0;const c=0===e.projectionBehavior(),g=!!c&&e.isClosed();if(c&&!g)o.startObject(),o.addFieldName("c"),o.startArray(),D(m,h,a.x,a.y,l,u,i,o),b(e.m_interior.x,e.m_interior.y,17,o),o.endArray(),o.endObject();else if(c){o.startObject(),o.addFieldName("a"),o.startArray(),D(m,h,a.x,a.y,l,u,i,o);const t=0,s=0;b(e.m_center.x+t,e.m_center.y+s,17,o);const n=!e.isMajor();o.addInt32(n?1:0);const r=e.isClockwise();o.addInt32(r?1:0),o.endArray(),o.endObject()}else{o.startObject(),o.addFieldName("a"),o.startArray(),D(m,h,a.x,a.y,l,u,i,o);const t=e;b(t.m_center.x,t.m_center.y,17,o);const s=!t.isMajor();o.addInt32(s?1:0);const n=t.isClockwise();o.addInt32(n?1:0),o.addDouble(t.m_rotation,17),o.addDouble(t.m_semiMajorAxis,17),o.addDouble(t.m_minorMajorRatio,17),o.endArray(),o.endObject()}return!1}(e,s,n,i,o);if(a===t.GeometryType.enumBezier)return C(e,s,n,i,o);if(a===t.GeometryType.enumRationalBezier2)return function(e,t,s,n,i){const r=e.getEndXY(),o=e.hasAttribute(1)&&!t,a=e.hasAttribute(2)&&!s;let m=Number.NaN,h=Number.NaN;o&&(m=e.getEndAttributeAsDbl(1,0)),a&&(h=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName("n"),i.startArray(),D(o,a,r.x,r.y,m,h,n,i),b(e.m_cp.x,e.m_cp.y,n,i);const l=n;return i.addDouble(e.m_weights[0],l),i.addDouble(e.m_weights[1],l),i.addDouble(e.m_weights[2],l),i.endArray(),i.endObject(),!1}(e,s,n,i,o);if(a===t.GeometryType.enumBezier2){const t=new r.CubicBezier;return t.constructFromQuadraticSegment(e),C(t,s,n,i,o)}t.throwNotImplementedException("")}function C(e,t,s,n,i){const r=e.getEndXY(),o=e.hasAttribute(1)&&!t,a=e.hasAttribute(2)&&!s;let m=Number.NaN,h=Number.NaN;return o&&(m=e.getEndAttributeAsDbl(1,0)),a&&(h=e.getEndAttributeAsDbl(2,0)),i.startObject(),i.addFieldName("b"),i.startArray(),D(o,a,r.x,r.y,m,h,n,i),b(e.m_cp[0].x,e.m_cp[0].y,n,i),b(e.m_cp[1].x,e.m_cp[1].y,n,i),i.endArray(),i.endObject(),!1}function D(e,t,s,n,i,r,o,a){a.startArray(),a.addDouble(s,o),a.addDouble(n,o),e&&a.addDouble(i,o),t&&a.addDouble(r,o),a.endArray()}function b(e,t,s,n){n.startArray(),n.addDouble(e,s),n.addDouble(t,s),n.endArray()}function S(e,s,n,o){const a=n.getImpl(),m=!!(2&s),h=!!(4&s),l=!!(8&s),u=a.hasAttribute(1)&&!m,c=a.hasAttribute(2)&&!h,g=a.hasAttribute(3)&&!l,d=a.hasNonLinearSegments();u&&(o.addFieldName("hasZ"),o.addBool(!0)),c&&(o.addFieldName("hasM"),o.addBool(!0)),e?d?o.addFieldName("curveRings"):o.addFieldName("rings"):d?o.addFieldName("curvePaths"):o.addFieldName("paths");let p=null;const _=[];if(n.isEmpty())o.startArray(),o.endArray();else{const e=17-(31&s>>13);o.startArray();const l=n.getPathCount();let f=0;const y=a.getAttributeStreamRef(0);let x=null,P=null,E=null;const C=new r.SegmentBuffer;let D=null,b=null,S=null;d&&(D=a.getSegmentFlagsStreamRef(),b=a.getSegmentIndexStreamRef(),S=a.getSegmentDataStreamRef()),u&&(x=a.getAttributeStreamRef(1)),c&&(P=a.getAttributeStreamRef(2)),g&&(E=a.getAttributeStreamRef(3),p=i.createAttributeStreamFromSemantics(3,0));for(let s=0;s<l;s++){o.startArray(),g&&_.push(0);const i=n.getPathEnd(s);if(f===i){o.endArray();continue}const r=n.isClosedPath(s);let a=y.read(2*f),l=y.read(2*f+1),d=u?x.read(f):Number.NaN,w=c?P.read(f):Number.NaN,T=g?E.read(f):0;I(u,c,a,l,d,w,e,o);let A=1;g&&(p.add(T),_[_.length-1]++);const N=a,G=l,M=d,R=w,k=T;let F=!1,q=0,V=Number.NaN,H=Number.NaN,O=0;for(let s=f+1,n=f,Y=r?i+1:i;s<Y;s++,n++){const r=null!==D?31&D.read(n):1;let f,Y;if(s<i?(f=y.read(2*s),Y=y.read(2*s+1),u&&(V=x.read(s)),c&&(H=P.read(s)),g&&(O=E.read(s))):(f=N,Y=G,V=M,H=R,O=k),1!==r){F=!0,4===r?C.createEllipticArc():2===r?C.createCubicBezier():16===r?C.createQuadraticBezier():8===r?C.createQuadraticRationalBezier():t.throwNotImplementedException("JSON export.unsupported curve");const s=C.get(),i=b.read(n);s.setStartXYCoords(a,l),s.setEndXYCoords(f,Y),u&&(s.setStartAttribute(1,0,d),s.setEndAttribute(1,0,V)),c&&(s.setStartAttribute(2,0,w),s.setEndAttribute(2,0,H)),s.readFromBufferStream(S,i),v(C.get(),m,h,e,o)&&q++}else I(u,c,f,Y,V,H,e,o);g&&(p.add(O),_[_.length-1]++),A++,a=f,l=Y,d=V,w=H,T=O}F&&0===q||(A<2&&q<1&&(I(u,c,a,l,d,w,e,o),A++,g&&(p.add(T),_[_.length-1]++)),r&&A<3&&q<2&&(I(u,c,N,G,M,R,e,o),A++,a=N,l=G,d=M,w=R,T=k,g&&(p.add(k),_[_.length-1]++))),o.endArray(),f=i}o.endArray()}if(g){o.addFieldName("ids"),o.startArray();let e=0;for(let s=0,n=_.length;s<n;++s){const n=_[s];t.geometryReleaseAssert(0===n||null!==p&&e+n<=p.size()),o.startArray();for(let t=0;t<n;++t)o.addInt32(p.read(e)),e++;o.endArray()}o.endArray()}}function I(e,t,s,n,i,r,o,a){a.startArray(),a.addDouble(s,o),a.addDouble(n,o),e&&a.addDouble(i,o),t&&a.addDouble(r,o),a.endArray()}const w="a".charCodeAt(0),T="A".charCodeAt(0),A="*".charCodeAt(0),N="b".charCodeAt(0),G="\\".charCodeAt(0),M="[".charCodeAt(0),R="{".charCodeAt(0),k=":".charCodeAt(0),F=".".charCodeAt(0),q=",".charCodeAt(0),V='"'.charCodeAt(0),H="]".charCodeAt(0),O="}".charCodeAt(0),Y="e".charCodeAt(0),X="E".charCodeAt(0),L="f".charCodeAt(0),B="F".charCodeAt(0),z="/".charCodeAt(0),U="-".charCodeAt(0),j="+".charCodeAt(0),W="n".charCodeAt(0),Z="N".charCodeAt(0),Q="r".charCodeAt(0),K="t".charCodeAt(0),$="u".charCodeAt(0),J="0".charCodeAt(0),ee="9".charCodeAt(0);class te{constructor(e){this.m_functionStack=[],this.m_pushPositions=[],this.m_utf8Decoder=new TextDecoder("utf-8",{fatal:!0}),void 0===e?(this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_endToken=0,this.m_currentTokenType=0,this.m_functionStack.push(()=>this.accept_()),this.m_jsonString=null,this.m_bHasEscapes=!1):e.jsonString?this.resetParserFromString(e.jsonString):e.jsonStream?t.throwNotImplementedException("streaming json parsing not yet impl"):t.throwInternalErrorException("invalid constructor parameter")}prepSubstrString_(){}getCurrentSubstrString_(){return this.m_jsonString.slice(this.m_startToken,this.m_endToken)}stepOverCharString_(){this.m_endToken++}peekCharString_(){return this.m_jsonString.charCodeAt(this.m_endToken)}getString_(e){const t=this.m_jsonString?.slice(this.m_startToken,this.m_startToken+e-1);return this.m_endToken+=e-1,{s:t,bDone:this.m_endToken>=this.m_jsonString.length}}incrementString_(){this.m_endToken++}eofString_(){return this.m_endToken>=this.m_jsonString.length}setStringFunctions_(){this.m_prepSubstr=this.prepSubstrString_,this.m_getCurrentSubstr=this.getCurrentSubstrString_,this.m_stepOverChar=this.stepOverCharString_,this.m_peekChar=this.peekCharString_,this.m_get=this.getString_,this.m_increment=this.incrementString_,this.m_eof=this.eofString_}setStreamFunctions_(){t.throwNotImplementedException("streaming json parsing not yet impl")}reset_(){this.m_jsonString=null,this.m_endToken=0,this.m_startToken=Number.MAX_SAFE_INTEGER,this.m_currentTokenType=0,this.m_bHasEscapes=!1,this.m_functionStack.length=0,this.m_functionStack.push(()=>this.start_()),this.m_pushPositions.length=0}resetParserFromString(e){this.reset_(),this.setStringFunctions_(),this.m_jsonString=e}resetParserFromStream(e){t.throwNotImplementedException("streaming json parsing not yet impl")}resetToPosition(e){return!!this.m_jsonString&&(this.m_endToken=e,this.m_startToken=Number.MAX_VALUE,this.m_currentTokenType=0,this.m_functionStack.length=0,e>=this.m_jsonString.length?(this.m_functionStack.push(()=>this.accept_()),!1):(this.m_functionStack.push(()=>this.start_()),!0))}nextToken(){return this.m_functionStack.at(-1)(),this.m_currentTokenType}currentToken(){return this.m_currentTokenType}currentTokenStartIndex(){return this.m_startToken}currentTokenEndIndex(){return this.m_endToken}currentText(){return t.geometryReleaseAssert(0),""}childrenAsString(){return t.geometryReleaseAssert(0),""}skipChildren(){this.skipChildren_()}skipChildren_(){if(1===this.m_currentTokenType){let e=1;do{this.m_currentTokenType=this.nextToken(),1===this.m_currentTokenType?e++:3===this.m_currentTokenType&&e--}while(3!==this.m_currentTokenType||0!==e);return}if(2===this.m_currentTokenType){let e=1;do{this.m_currentTokenType=this.nextToken(),2===this.m_currentTokenType?e++:4===this.m_currentTokenType&&e--}while(4!==this.m_currentTokenType||0!==e);return}}currentTerminalAsString_(){switch(this.m_currentTokenType){case 7:case 8:case 9:return this.m_getCurrentSubstr().slice(0,this.m_endToken-this.m_startToken);case 10:return"null";case 11:return"true";case 12:return"false"}t.throwInvalidArgumentException("invalid token")}toUTF8_(e,t){let s=0,n=e;for(;t.charCodeAt(n)===G&&t.charCodeAt(n+1)===$;)s++,n+=6;n=e;const i=new Uint8Array(s);let r=0;for(;t.charCodeAt(n)===G&&t.charCodeAt(n+1)===$;)i[r++]=Number.parseInt(t.slice(n+2,n+6),16),n+=6;return{u8s:this.m_utf8Decoder.decode(i),end:n}}unquoteCurrentString_(){let e="",t=1;const s=this.m_endToken-this.m_startToken-1;let n=0;const i=this.m_getCurrentSubstr();for(let r=t;r<s;r++)if(i.charCodeAt(r)!==G)n++;else{switch(n>0&&(e+=i.slice(t,t+n)),i.charCodeAt(++r)){case V:e+='"';break;case $:{const{u8s:t,end:s}=this.toUTF8_(r-1,i);r=s-1,e+=t;break}case G:e+="\\";break;case z:e+="/";break;case N:e+="\b";break;case L:e+="\f";break;case W:e+="\n";break;case Q:e+="\r";break;case K:e+="\t"}t=r+1,n=0}return n>0&&(e+=i.slice(t,t+n)),e}currentString(){return 5!==this.m_currentTokenType&&6!==this.m_currentTokenType?this.currentTerminalAsString_():this.m_bHasEscapes?this.unquoteCurrentString_():this.m_getCurrentSubstr().slice(1,this.m_endToken-this.m_startToken-2+1)}currentDoubleValue(){if(7!==this.m_currentTokenType&&8!==this.m_currentTokenType&&9!==this.m_currentTokenType&&6!==this.m_currentTokenType&&10!==this.m_currentTokenType&&t.throwInvalidArgumentException("invalid token"),10===this.m_currentTokenType)return Number.NaN;let e=this.m_getCurrentSubstr(),s=this.m_endToken-this.m_startToken;if(6===this.m_currentTokenType){if("NaN"===this.currentString())return Number.NaN;e=e.slice(1),s-=2,0===s&&t.throwInvalidArgumentException("invalid token")}const n=Number.parseFloat(e);if(6===this.m_currentTokenType)Number.isNaN(n)&&t.throwInvalidArgumentException("invalid token");else if(Number.isNaN(n))return Number.NaN;return n}currentInt32Value(){8!==this.m_currentTokenType&&6!==this.m_currentTokenType&&t.throwInvalidArgumentException("invalid token");let e=this.m_getCurrentSubstr(),s=this.m_endToken-this.m_startToken;6===this.m_currentTokenType&&(e=e.slice(1),s-=2,0===s&&t.throwInvalidArgumentException("invalid token"));const n=parseInt(e);return Number.isNaN(n)&&t.throwInvalidArgumentException("invalid token"),n}currentInt64Value(){return t.geometryReleaseAssert(0),0n}currentBoolValue(){return t.geometryReleaseAssert(0),!1}isError(){return 0}JSONString(){return t.geometryReleaseAssert(0),""}pushPosition(){return t.geometryReleaseAssert(0),!1}popPosition(){return t.geometryReleaseAssert(0),!1}skipCStyleComments_(){t.geometryReleaseAssert(0)}skipCppStyleComments_(){t.geometryReleaseAssert(0)}skipComments_(){this.m_prepSubstr();let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e===A?this.skipCStyleComments_():e===z?this.skipCppStyleComments_():t.throwInvalidArgumentException("invalid token")}skipWhiteSpace_(){let e;do{this.m_eof()&&t.throwInvalidArgumentException("invalid token");let s=this.m_peekChar();for(;s>=9&&s<=13||32===s;)this.m_increment(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),s=this.m_peekChar();s===z?(this.m_startToken=this.m_endToken,e=!0,this.skipComments_()):e=!1}while(e)}rightBracket_(){return this.m_peekChar()===H&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=4,!0)}rightBrace_(){return this.m_peekChar()===O&&(this.m_startToken=this.m_endToken,this.m_increment(),this.m_currentTokenType=3,!0)}string_(){this.m_prepSubstr(),this.m_bHasEscapes=!1,this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token");let e=this.m_peekChar();for(;e!==V;){const s=e===G;if(this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),s)if(this.m_bHasEscapes=!0,e===V||e===G||e===z||e===N||e===L||e===W||e===Q||e===K)this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar();else if(e===$)for(let s=0;s<4;s++)this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e>=J&&e<=ee||e>=w&&e<=L||e>=T&&e<=B||t.throwInvalidArgumentException("invalid token");else t.throwInvalidArgumentException("invalid token")}this.m_stepOverChar()}comma_(){return this.m_peekChar()===q&&(this.m_increment(),!0)}colon_(){return this.m_peekChar()===k&&(this.m_increment(),!0)}fieldNameEnd_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.colon_()?(this.skipWhiteSpace_(),this.value_()):t.throwInvalidArgumentException("invalid token")}fieldNameStart_(){this.m_startToken=this.m_endToken,this.m_peekChar()!==V&&t.throwInvalidArgumentException("invalid token"),this.string_(),this.m_currentTokenType=5,this.m_functionStack.push(()=>this.fieldNameEnd_())}pairEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.fieldNameStart_()):this.rightBrace_()?this.m_functionStack.pop():t.throwInvalidArgumentException("invalid token")}arrayStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBracket_()||(this.m_functionStack.push(()=>this.elementEnd_()),this.value_())}elementEnd_(){this.skipWhiteSpace_(),this.comma_()?(this.skipWhiteSpace_(),this.value_()):this.rightBracket_()?this.m_functionStack.pop():t.throwInvalidArgumentException("invalid token")}objectStart_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.rightBrace_()||(this.m_functionStack.push(()=>this.pairEnd_()),this.fieldNameStart_())}valueStartObject_(){this.m_increment(),this.m_currentTokenType=1,this.m_functionStack.push(()=>this.objectStart_())}valueStartArray_(){this.m_increment(),this.m_currentTokenType=2,this.m_functionStack.push(()=>this.arrayStart_())}valueString_(){this.string_(),this.m_currentTokenType=6}int_(){this.m_peekChar()!==J?this.digits_():this.m_stepOverChar()}digits_(){let e=this.m_peekChar();do{this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar()}while(e>=J&&e<=ee)}frac_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e>=J&&e<=ee||t.throwInvalidArgumentException("invalid token"),this.digits_()}exp_(){let e=this.m_peekChar();this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar(),e!==j&&e!==U||(this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),e=this.m_peekChar()),e>=J&&e<=ee||t.throwInvalidArgumentException("invalid token"),this.digits_()}valueNumber_(){this.m_prepSubstr();let e=!1,s=this.m_peekChar();if(s===U?(this.m_stepOverChar(),this.m_eof()&&t.throwInvalidArgumentException("invalid token"),s=this.m_peekChar(),e=!0,s>=J&&s<=ee||t.throwInvalidArgumentException("invalid token"),this.int_()):this.int_(),s=this.m_peekChar(),s===F)this.m_currentTokenType=7,this.frac_(),s=this.m_peekChar(),s!==Y&&s!==X||this.exp_();else if(s===Y||s===X)this.m_currentTokenType=7,this.exp_();else{let t=0;e&&t++;const s=this.m_endToken-this.m_startToken-t;if(s<10)this.m_currentTokenType=8;else if(10===s){const s=this.m_getCurrentSubstr();e?s.slice(t)<="2147483648"?this.m_currentTokenType=8:this.m_currentTokenType=9:s.slice(t)<="2147483647"?this.m_currentTokenType=8:this.m_currentTokenType=9}else if(s<19)this.m_currentTokenType=9;else if(19===s){const s=this.m_getCurrentSubstr();e?s.slice(t)<="9223372036854775808"?this.m_currentTokenType=9:this.m_currentTokenType=7:s.slice(t)<="9223372036854775807"?this.m_currentTokenType=9:this.m_currentTokenType=7}else this.m_currentTokenType=7}}valueNull_(){const{s:e,bDone:s}=this.m_get(5);s&&t.throwInvalidArgumentException("invalid token"),"null"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=10}valueTrue_(){const{s:e,bDone:s}=this.m_get(5);s&&t.throwInvalidArgumentException("invalid token"),"true"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=11}valueFalse_(){const{s:e,bDone:s}=this.m_get(6);s&&t.throwInvalidArgumentException("invalid token"),"false"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=12}valueNan_(){const{s:e,bDone:s}=this.m_get(4);s&&t.throwInvalidArgumentException("invalid token"),"NaN"!==e&&t.throwInvalidArgumentException("invalid token"),this.m_currentTokenType=7}value_(){this.m_startToken=this.m_endToken;const e=this.m_peekChar();e===R?this.valueStartObject_():e===M?this.valueStartArray_():e===V?this.valueString_():e===U||e>=J&&e<=J+9?this.valueNumber_():e===W?this.valueNull_():e===K?this.valueTrue_():e===L?this.valueFalse_():e===Z?this.valueNan_():t.throwInvalidArgumentException("invalid token")}start_(){this.skipWhiteSpace_(),this.m_functionStack.pop(),this.m_functionStack.push(()=>this.accept_());const e=this.m_peekChar();e!==R&&e!==M&&t.throwInvalidArgumentException("invalid token"),this.value_()}accept_(){this.m_startToken=this.m_endToken,this.m_currentTokenType=0}}const se=new class{constructor(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject=[]}reset(){this.m_pendingKey=null,this.m_acceptedObject=null,this.m_currentObject.length=0}startObject(){const e={};this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}startArray(){const e=[];this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):Array.isArray(this.m_currentObject.at(-1))&&this.m_currentObject.at(-1).push(e),this.m_currentObject.push(e)}endObject(){this.m_acceptedObject=this.m_currentObject.at(-1),this.m_currentObject.pop()}endArray(){this.m_currentObject.pop()}addFieldName(e){this.m_pendingKey=e}addValue_(e){this.m_pendingKey?(this.m_currentObject.at(-1)[this.m_pendingKey]=e,this.m_pendingKey=null):this.m_currentObject.at(-1).push(e)}addString(e){this.addValue_(e)}addDouble(e,t){this.addValue_(e)}addInt64(e){t.geometryReleaseAssert(0)}addInt32(e){this.addValue_(e)}addBool(e){this.addValue_(e)}addNull(){this.addValue_(null)}getObject(){return this.m_acceptedObject}},ne=new class{getOperatorType(){return 10405}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,s,i,r,o,a){!function(e,s,i,r){if(s||i){if(r.startObject(),null!==s)switch(s.getGeometryType()){case t.GeometryType.enumPolygon:S(!0,e,s,r);break;case t.GeometryType.enumPolyline:S(!1,e,s,r);break;case t.GeometryType.enumMultiPoint:!function(e,s,n){const i=s.getImpl(),r=i.hasAttribute(1)&&!(2&e),o=i.hasAttribute(2)&&!(4&e),a=i.hasAttribute(3)&&!(8&e);r&&(n.addFieldName("hasZ"),n.addBool(!0)),o&&(n.addFieldName("hasM"),n.addBool(!0)),n.addFieldName("points");const m=s.getPointCount();if(s.isEmpty())n.startArray(),n.endArray();else{const t=17-(31&e>>13);n.startArray();const s=i.getAttributeStreamRef(0);let a=null,h=null;r&&(a=i.getAttributeStreamRef(1)),o&&(h=i.getAttributeStreamRef(2));for(let e=0;e<m;e++){const i=s.read(2*e),m=s.read(2*e+1);let l=Number.NaN,u=Number.NaN;r&&(l=a.read(e)),o&&(u=h.read(e)),I(r,o,i,m,l,u,t,n)}n.endArray()}if(a){let e=null;i.isEmpty()||(e=i.getAttributeStreamRef(3)),t.geometryReleaseAssert(0===m||null!==e&&e.size()>=m),n.addFieldName("ids"),n.startArray();for(let t=0;t<m;t++)n.addInt32(e.read(t));n.endArray()}}(e,s,r);break;case t.GeometryType.enumPoint:!function(e,t,s){const n=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),r=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return s.addFieldName("x"),s.addNull(),s.addFieldName("y"),s.addNull(),n&&(s.addFieldName("z"),s.addNull()),i&&(s.addFieldName("m"),s.addNull()),void(r&&(s.addFieldName("id"),s.addInt32(0)));const o=17-(31&e>>13);s.addFieldName("x"),s.addDouble(t.getX(),o),s.addFieldName("y"),s.addDouble(t.getY(),o),n&&(s.addFieldName("z"),s.addDouble(t.getZ(),o)),i&&(s.addFieldName("m"),s.addDouble(t.getM(),o)),r&&(s.addFieldName("id"),s.addInt32(t.getID()))}(e,s,r);break;case t.GeometryType.enumEnvelope:!function(e,t,s){const n=t.hasAttribute(1)&&!(2&e),i=t.hasAttribute(2)&&!(4&e),r=t.hasAttribute(3)&&!(8&e);if(t.isEmpty())return s.addFieldName("xmin"),s.addNull(),s.addFieldName("ymin"),s.addNull(),s.addFieldName("xmax"),s.addNull(),s.addFieldName("ymax"),s.addNull(),n&&(s.addFieldName("zmin"),s.addNull(),s.addFieldName("zmax"),s.addNull()),i&&(s.addFieldName("mmin"),s.addNull(),s.addFieldName("mmax"),s.addNull()),void(r&&(s.addFieldName("idmin"),s.addInt32(0),s.addFieldName("idmax"),s.addInt32(0)));const o=17-(31&e>>13);if(s.addFieldName("xmin"),s.addDouble(t.getXMin(),o),s.addFieldName("ymin"),s.addDouble(t.getYMin(),o),s.addFieldName("xmax"),s.addDouble(t.getXMax(),o),s.addFieldName("ymax"),s.addDouble(t.getYMax(),o),n){const e=t.queryInterval(1,0);s.addFieldName("zmin"),s.addDouble(e.vmin,o),s.addFieldName("zmax"),s.addDouble(e.vmax,o)}if(i){const e=t.queryInterval(2,0);s.addFieldName("mmin"),s.addDouble(e.vmin,o),s.addFieldName("mmax"),s.addDouble(e.vmax,o)}if(r){const e=t.queryInterval(3,0);s.addFieldName("idmin"),s.addInt32(e.vmin),s.addFieldName("idmax"),s.addInt32(e.vmax)}}(e,s,r);break;case t.GeometryType.enumMultipatch:t.geometryReleaseAssert(0);break;default:t.throwInternalErrorException("exportToJSON")}null!==i&&(r.addFieldName("spatialReference"),function(e,s,i){i.startObject();let r=0;s.isCustomWkid()||(r=s.getOldID());let o=0;const a=s.getVCS();if(null!==a&&(a.isCustomWkid()||(o=a.getOldID()),o<=0&&(r=0)),r>0){i.addFieldName("wkid"),i.addInt32(r);const e=s.getLatestID();if(e>0&&e!==r&&(i.addFieldName("latestWkid"),i.addInt32(e)),o>0){i.addFieldName("vcsWkid"),i.addInt32(o);const e=s.getLatestVerticalID();e!==o&&(i.addFieldName("latestVcsWkid"),i.addInt32(e))}}if(0===s.getCoordinateSystemType())i.addFieldName("wkid"),i.addNull(),null!==s.getUnit()&&(i.addFieldName("unit"),function(e,s,n){n.startObject();const i=s.getID();i<=0&&t.throwInvalidArgumentException("cannot export unit that has no valid WKID"),n.addFieldName("uwkid"),n.addInt32(i),n.endObject()}(0,s.getUnit(),i));else if(r<=0||1&e){let t="";64&e&&(t=s.getText2(),i.addFieldName("wkt2"),i.addString(t));const n=s.getText();n!==t&&(i.addFieldName("wkt"),i.addString(n))}if(16&e){const e=new n.SpatialReferencePrecisionDescriptor;s.queryPrecisionDescriptor(e),i.addFieldName("xyTolerance"),i.addDouble(e.getTolerance(0)),i.addFieldName("zTolerance"),i.addDouble(e.getTolerance(1)),i.addFieldName("mTolerance"),i.addDouble(e.getTolerance(2)),i.addFieldName("falseX"),i.addDouble(e.getFalseX()),i.addFieldName("falseY"),i.addDouble(e.getFalseY()),i.addFieldName("xyUnits"),i.addDouble(e.getGridUnitsXY()),i.addFieldName("falseZ"),i.addDouble(e.getFalseZ()),i.addFieldName("zUnits"),i.addDouble(e.getGridUnitsZ()),i.addFieldName("falseM"),i.addDouble(e.getFalseM()),i.addFieldName("mUnits"),i.addDouble(e.getGridUnitsM())}i.endObject()}(e,i,r)),r.endObject()}}(e,s,i,r)}exportSpatialReference(e,s,n,i){t.geometryReleaseAssert(0)}exportProjectionTransformation(e,s,n,i){t.geometryReleaseAssert(0)}exportDatumTransformation(e,s,n,i){t.geometryReleaseAssert(0)}static geometryTypeToString(e){return t.geometryReleaseAssert(0),""}},ie=new class{getOperatorType(){return 10404}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,s,o,a,m,h,l){let u;"string"==typeof o?(u=new te({jsonString:o}),u.nextToken()):u=o,1!==u.currentToken()&&t.throwInvalidArgumentException("failed to import map geometry: start of object is expected");const y=function(e,s,n,o,a){let m=!1,h=!1,l=!1,u=!1,y=!1,x=!1,P=!1,E=!1,v=!1,C=!1,D=!1,b=!1,S=!1,I=!1,w=!1,T=!1,A=!1,N=!1,G=!1,M=!1,R=!1,k=!1,F=!1,q=!1,V=Number.NaN,H=Number.NaN,O=Number.NaN,Y=Number.NaN,X=0,L=Number.NaN,B=Number.NaN,z=Number.NaN,U=Number.NaN,j=Number.NaN,W=Number.NaN,Z=Number.NaN,Q=Number.NaN,K=0,$=0,J=!1,ee=!1,te=null,se=null,ne=null,ie=null,re=null;for(;3!==n.nextToken();){const s=n.currentString();if(n.nextToken(),"spatialReference"===s){if(a&&!m){m=!0,1===n.currentToken()?ie=c(n):10!==n.currentToken()&&t.throwInvalidArgumentException("failed to parse spatial reference: object or null is expected");continue}}else if(o)if("hasZ"===s){if(!h){h=!0,J=11===n.currentToken();continue}}else if("hasM"===s){if(!l){l=!0,ee=11===n.currentToken();continue}}else if("rings"===s){if(!(y||x||e!==t.GeometryType.enumUnknown&&e!==t.GeometryType.enumPolygon)){y=!0,({geometry:re,as:te,bs:se}=g(!0,!1,0,n));continue}}else if("curveRings"===s){if(!x&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPolygon)){x=!0,({geometry:re,as:te,bs:se}=g(!0,!0,0,n));continue}}else if("paths"===s){if(!(P||E||e!==t.GeometryType.enumUnknown&&e!==t.GeometryType.enumPolyline)){P=!0,({geometry:re,as:te,bs:se}=g(!1,!1,0,n));continue}}else if("curvePaths"===s){if(!E&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPolyline)){E=!0,({geometry:re,as:te,bs:se}=g(!1,!0,0,n));continue}}else if("points"===s){if(!v&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumMultiPoint)){v=!0,({geometry:re,as:te,bs:se}=d(0,n));continue}}else if("ids"===s){if(!u){u=!0,ne=p(0,n);continue}}else if("x"===s){if(!C&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){C=!0,V=_(n);continue}}else if("y"===s){if(!D&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){D=!0,H=_(n);continue}}else if("z"===s){if(!b&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){b=!0,O=_(n);continue}}else if("m"===s){if(!S&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){S=!0,Y=_(n);continue}}else if("id"===s){if(!I&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumPoint)){I=!0,X=f(n);continue}}else if("xmin"===s){if(!w&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){w=!0,L=_(n);continue}}else if("ymin"===s){if(!T&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){T=!0,B=_(n);continue}}else if("mmin"===s){if(!R&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){R=!0,Z=_(n);continue}}else if("zmin"===s){if(!G&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){G=!0,j=_(n);continue}}else if("idmin"===s){if(!F&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){F=!0,K=f(n);continue}}else if("xmax"===s){if(!A&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){A=!0,z=_(n);continue}}else if("ymax"===s){if(!N&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){N=!0,U=_(n);continue}}else if("mmax"===s){if(!k&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){k=!0,Q=_(n);continue}}else if("zmax"===s){if(!M&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){M=!0,W=_(n);continue}}else if("idmax"===s){if(!q&&(e===t.GeometryType.enumUnknown||e===t.GeometryType.enumEnvelope)){q=!0,$=f(n);continue}}else"materials"===s&&t.geometryReleaseAssert(0);n.skipChildren()}if(y||x||P||E||v){let e=null,s=null;const n=re;J&&(re.addAttribute(1),e=te,e||(e=i.createDoubleStream(n.getPointCount(),Number.NaN))),ee&&(re.addAttribute(2),s=J?se:te),null!=ne&&re.addAttribute(3),J&&null!=e&&n.setAttributeStreamRef(1,e),ee&&null!=s&&n.setAttributeStreamRef(2,s),null!=ne&&function(e,s){if(e.isEmpty())return;const n=i.createAttributeStream(2,0),o=e.getGeometryType();let a=0;o===r.MultiPoint.type?a=1:o===r.Polyline.type||o===r.Polygon.type?a=e.getPathCount():t.throwInternalErrorException("not implemented"),n.resize(e.getPointCount(),0);let m=0;for(let i=0;i<a;++i){const a=s.read(m);m++;const h=m+a;let l=0,u=0;o===r.MultiPoint.type?l=e.getPointCount():o===r.Polyline.type||o===r.Polygon.type?(l=e.getPathSize(i),u=e.getPathStart(i)):t.throwInternalErrorException("not implemented");for(let e=0,t=Math.min(a,l);e<t;++e)n.write(u,s.read(m)),m++,u++;m=h}e.getImpl().setAttributeStreamRef(3,n)}(n,ne)}else if(C||D||S||b||I){i.checkNanOrFinite(V,H)||t.throwInvalidArgumentException("failed to parse point: x and y must be finite or nan"),(Number.isNaN(H)||Number.isNaN(V))&&(V=Number.NaN,H=Number.NaN);const e=new i.Point({x:V,y:H});b&&e.setZ(O),S&&e.setM(Y),I&&e.setID(X),re=e}else if(w||T||A||N||G||M||R||k||F||q){(Number.isNaN(B)||Number.isNaN(z)||Number.isNaN(U))&&(L=Number.NaN);const e=new i.Envelope({xmin:L,ymin:B,xmax:z,ymax:U});G&&M&&e.setInterval(1,0,j,W),R&&k&&e.setInterval(2,0,Z,Q),F&&q&&e.setInterval(3,0,K,$),re=e}return{...re?{geom:re}:{},...ie?{sr:ie}:{}}}(s,0,u,a,m);return new n.MapGeometry(y)}importSpatialReference(e){const s=c(e);return null===s&&t.throwInternalErrorException("failed to import spatial reference"),s}importProjectionTransformation(e,s){return t.geometryReleaseAssert(0),{}}importDatumTransformation(e,s){return t.geometryReleaseAssert(0),{}}static stringToGeometryType(e){return(e=e.toLowerCase()).startsWith("esrigeometry")||t.throwInvalidArgumentException("string_to_geometry_type"),e.endsWith("point")?t.GeometryType.enumPoint:e.endsWith("envelope")?t.GeometryType.enumEnvelope:e.endsWith("multipoint")?t.GeometryType.enumMultiPoint:e.endsWith("polyline")?t.GeometryType.enumPolyline:e.endsWith("polygon")?t.GeometryType.enumPolygon:void t.throwInvalidArgumentException("string_to_geometry_type")}};function re(e,s){const n=new h(e,{strict:!1});return n.nextToken(),ie.execute(0,t.GeometryType.enumUnknown,n,!0,s)}function oe(e){return re(e,!0)}function ae(e){return re(e,!1).getGeometry()}e.fromGeometries=function(e){let t=null;return[e.map(e=>{if(null==t){const s=oe(e);return t=s.getSpatialReference(),s.getGeometry()}return ae(e)}),t]},e.fromGeometry=oe,e.fromGeometryToGXGeometry=ae,e.getSpatialReference=function(e){return Array.isArray(e)?e[0].spatialReference:e.spatialReference},e.toGeometry=function(e,t){return e instanceof n.MapGeometry&&(t=e.getSpatialReference(),e=e.getGeometry()),e?.isEmpty()?null:(se.reset(),ne.execute(0,e,t,se),se.getObject())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/geodesicBufferOperator":function(){define(["require","exports","../core/arrayUtils","../core/unitUtils","../geometry/operators/gx/operatorGeodesicBuffer","../geometry/operators/support/geodeticCurveType"],function(e,t,s,n,i,r){"use strict";let o,a,m,h;function l(){return!!o&&i.isLoaded()}async function u(){if(!l()){const[s]=await Promise.all([new Promise((t,s)=>e(["../geometry/operators/support/apiConverter"],t,s)),i.load()]);o=s.fromGeometry,a=s.fromSpatialReference,m=s.getSpatialReference,h=s.toPolygon,t.supportsCurves=i.supportsCurves()}}function c(e,t,s={}){let{curveType:l="geodesic",maxDeviation:u=NaN,unit:c}=s;c&&(t=n.convertUnit(t,c,"meters"),u&&(u=n.convertUnit(u,c,"meters")));const g=m(e);return h(i.execute(o(e),a(g),r.geodeticCurveType[l],t,u),g)}function g(e,t,l={}){let{curveType:u="geodesic",maxDeviation:c=NaN,union:g=!1,unit:d}=l;d&&(t=t.map(e=>n.convertUnit(e,d,"meters")),c&&(c=n.convertUnit(c,d,"meters")));const p=e.map(o),_=m(e);return i.executeMany(p,a(_),r.geodeticCurveType[u],t,c,g).map(e=>h(e,_)).filter(s.isSome)}t.supportsCurves=void 0;const d=Object.freeze(Object.defineProperty({__proto__:null,execute:c,executeMany:g,isLoaded:l,load:u,get supportsCurves(){return t.supportsCurves}},Symbol.toStringTag,{value:"Module"}));t.execute=c,t.executeMany=g,t.geodesicBufferOperator=d,t.isLoaded=l,t.load=u})},"esri/geometry/operators/gx/operatorGeodesicBuffer":function(){define(["require","exports","../../../chunks/SimpleGeometryCursor","../../../chunks/pe"],function(e,t,s,n){"use strict";let i;function r(){return!!i&&n.isLoaded()}t.execute=function(e,t,s,n,r){return i.execute(e,t,s,n,r,!1,null)},t.executeMany=function(e,t,n,r,o,a){const m=i.executeMany(new s.SimpleGeometryCursor(e),t,n,r,o,!1,a,null);return Array.from(m)},t.isLoaded=r,t.load=async function(){if(!r()){const[t,s]=await Promise.all([new Promise((t,s)=>e(["../../../chunks/OperatorGeodesicBuffer"],t,s)),new Promise((t,s)=>e(["../../../chunks/ProjectionTransformation"],t,s)).then(e=>e.SpatialReference).then(({injectPe:e})=>e),n.load()]);i=new t.OperatorGeodesicBuffer,s(n.pe)}},t.supportsCurves=function(){return i.supportsCurves()},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/operators/support/geodeticCurveType":function(){define(["exports"],function(e){"use strict";e.geodeticCurveType={geodesic:0,loxodrome:1,"great-elliptic":2,"normal-section":3,"shape-preserving":4},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/geodeticAreaOperator":function(){define(["require","exports","../core/unitUtils","../geometry/operators/gx/operatorGeodeticArea","../geometry/operators/support/geodeticCurveType"],function(e,t,s,n,i){"use strict";let r,o,a;function m(){return!!r&&n.isLoaded()}async function h(){if(!m()){const[s]=await Promise.all([new Promise((t,s)=>e(["../geometry/operators/support/apiConverter"],t,s)),n.load()]);r=s.fromGeometry,o=s.fromSpatialReference,a=s.getSpatialReference,t.supportsCurves=n.supportsCurves()}}function l(e,t={}){const{curveType:m="geodesic",unit:h}=t,l=a(e);let u=n.execute(r(e),o(l),i.geodeticCurveType[m]);return u&&h&&(u=s.convertUnit(u,"square-meters",h)),u}t.supportsCurves=void 0;const u=Object.freeze(Object.defineProperty({__proto__:null,execute:l,isLoaded:m,load:h,get supportsCurves(){return t.supportsCurves}},Symbol.toStringTag,{value:"Module"}));t.execute=l,t.geodeticAreaOperator=u,t.isLoaded=m,t.load=h})},"esri/geometry/operators/gx/operatorGeodeticArea":function(){define(["require","exports","../../../chunks/pe"],function(e,t,s){"use strict";let n;function i(){return!!n&&s.isLoaded()}t.execute=function(e,t,s){return n.execute(e,t,s,null)},t.isLoaded=i,t.load=async function(){if(!i()){const[t,i]=await Promise.all([new Promise((t,s)=>e(["../../../chunks/OperatorGeodeticArea"],t,s)),new Promise((t,s)=>e(["../../../chunks/ProjectionTransformation"],t,s)).then(e=>e.SpatialReference).then(({injectPe:e})=>e),s.load()]);n=new t.OperatorGeodeticArea,i(s.pe)}},t.supportsCurves=function(){return n.supportsCurves()},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/geodeticDensifyOperator":function(){define(["require","exports","../core/unitUtils","../geometry/operators/gx/operatorGeodeticDensify","../geometry/operators/support/geodeticCurveType"],function(e,t,s,n,i){"use strict";let r,o,a,m;function h(){return!!r&&n.isLoaded()}async function l(){if(!h()){const[s]=await Promise.all([new Promise((t,s)=>e(["../geometry/operators/support/apiConverter"],t,s)),n.load()]);r=s.fromGeometry,o=s.fromSpatialReference,a=s.getSpatialReference,m=s.toGeometry,t.supportsCurves=n.supportsCurves()}}function u(e,t,h={}){const{curveType:l="geodesic",unit:u}=h;u&&(t=s.convertUnit(t,u,"meters"));const c=a(e);return m(n.execute(r(e),t,o(c),i.geodeticCurveType[l]),c)}function c(e,t,h={}){const{curveType:l="geodesic",unit:u}=h;u&&(t=s.convertUnit(t,u,"meters"));const c=e.map(r),g=a(e);return n.executeMany(c,t,o(g),i.geodeticCurveType[l]).map(e=>m(e,g))}t.supportsCurves=void 0;const g=Object.freeze(Object.defineProperty({__proto__:null,execute:u,executeMany:c,isLoaded:h,load:l,get supportsCurves(){return t.supportsCurves}},Symbol.toStringTag,{value:"Module"}));t.execute=u,t.executeMany=c,t.geodeticDensifyOperator=g,t.isLoaded=h,t.load=l})},"esri/geometry/operators/gx/operatorGeodeticDensify":function(){define(["require","exports","../../../chunks/SimpleGeometryCursor","../../../chunks/pe"],function(e,t,s,n){"use strict";let i;function r(){return!!i&&n.isLoaded()}t.execute=function(e,t,s,n){return i.execute(e,t,s,n,null)},t.executeMany=function(e,t,n,r){const o=i.executeMany(new s.SimpleGeometryCursor(e),t,n,r,null);return Array.from(o)},t.isLoaded=r,t.load=async function(){if(!r()){const[t,s]=await Promise.all([new Promise((t,s)=>e(["../../../chunks/OperatorGeodeticDensifyByLength"],t,s)),new Promise((t,s)=>e(["../../../chunks/ProjectionTransformation"],t,s)).then(e=>e.SpatialReference).then(({injectPe:e})=>e),n.load()]);i=new t.OperatorGeodeticDensifyByLength,s(n.pe)}},t.supportsCurves=function(){return i.supportsCurves()},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/geodeticLengthOperator":function(){define(["require","exports","../core/unitUtils","../geometry/operators/gx/operatorGeodeticLength","../geometry/operators/support/geodeticCurveType"],function(e,t,s,n,i){"use strict";let r,o,a;function m(){return!!r&&n.isLoaded()}async function h(){if(!m()){const[s]=await Promise.all([new Promise((t,s)=>e(["../geometry/operators/support/apiConverter"],t,s)),n.load()]);r=s.fromGeometry,o=s.fromSpatialReference,a=s.getSpatialReference,t.supportsCurves=n.supportsCurves()}}function l(e,t={}){const{curveType:m="geodesic",unit:h}=t,l=a(e);let u=n.execute(r(e),o(l),i.geodeticCurveType[m]);return u&&h&&(u=s.convertUnit(u,"meters",h)),u}t.supportsCurves=void 0;const u=Object.freeze(Object.defineProperty({__proto__:null,execute:l,isLoaded:m,load:h,get supportsCurves(){return t.supportsCurves}},Symbol.toStringTag,{value:"Module"}));t.execute=l,t.geodeticLengthOperator=u,t.isLoaded=m,t.load=h})},"esri/geometry/operators/gx/operatorGeodeticLength":function(){define(["require","exports","../../../chunks/pe"],function(e,t,s){"use strict";let n;function i(){return!!n&&s.isLoaded()}t.execute=function(e,t,s){return n.execute(e,t,s,null)},t.isLoaded=i,t.load=async function(){if(!i()){const[t,i]=await Promise.all([new Promise((t,s)=>e(["../../../chunks/OperatorGeodeticLength"],t,s)),new Promise((t,s)=>e(["../../../chunks/ProjectionTransformation"],t,s)).then(e=>e.SpatialReference).then(({injectPe:e})=>e),s.load()]);n=new t.OperatorGeodeticLength,i(s.pe)}},t.supportsCurves=function(){return n.supportsCurves()},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/operators/simplifyOGCOperator":function(){define(["exports","./gx/operatorSimplifyOGC","./support/apiConverter"],function(e,t,s){"use strict";const n=t.supportsCurves();e.execute=function(e){const n=s.getSpatialReference(e);return s.toGeometry(t.execute(s.fromGeometry(e),s.fromSpatialReference(n),!1),n)},e.executeMany=function(e){const n=e.map(s.fromGeometry),i=s.getSpatialReference(e);return t.executeMany(n,s.fromSpatialReference(i),!1).map(e=>s.toGeometry(e,i))},e.isSimple=function(e,n){return t.isSimple(s.fromGeometry(e),s.fromSpatialReference(s.getSpatialReference(e)),null!=n,n??null)},e.supportsCurves=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/operators/gx/operatorSimplifyOGC":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/OperatorSimplifyOGC"],function(e,t,s){"use strict";const n=new s.OperatorSimplifyOGC;e.execute=function(e,t,s){return n.execute(e,t,s,null)},e.executeMany=function(e,s,i){const r=n.executeMany(new t.SimpleGeometryCursor(e),s,i,null);return Array.from(r)},e.isSimple=function(e,t,s,i){return n.isSimple(e,t,s,i,null)},e.supportsCurves=function(){return n.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OperatorSimplifyOGC":function(){define(["exports","./SimpleGeometryCursor","./Geometry","./ProjectionTransformation"],function(e,t,s,n){"use strict";class i extends t.GeometryCursor{constructor(e,t,n,i){super(),e||s.throwInvalidArgumentException(""),this.m_progressTracker=i,this.m_bForceSimplify=n,this.m_index=-1,this.m_inputGeometryCursor=e,this.m_spatialReference=t}next(){const e=this.m_inputGeometryCursor.next();return e?(s.throwIfMesh(e),this.m_index=this.m_inputGeometryCursor.getGeometryID(),this.simplify(e)):null}getGeometryID(){return this.m_index}tock(){return!1}getRank(){return 1}simplify(e){return e||s.throwInvalidArgumentException(""),n.simplifyOGC(e,this.m_spatialReference,this.m_bForceSimplify,this.m_progressTracker)}}e.OperatorSimplifyOGC=class{getOperatorType(){return 10104}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}isSimple(e,t,s,i,r){return 5===n.isSimpleOGC(e,t,s,i,r)}executeMany(e,t,s,n){return new i(e,t,s,n)}execute(e,n,i,r){const o=new t.SimpleGeometryCursor([e]),a=this.executeMany(o,n,i,r).next();return a||s.throwInternalErrorException("null output"),a}}})},"esri/geometry/operators/support/Transformation":function(){define(["../../../chunks/Point2D","../../../chunks/Transformation2D","../../../core/mathUtils"],function(e,t,s){"use strict";const n={uniform:0,conformal:1,rigid:2,"rigid-motion":3,general:4},i=t=>t.map(t=>new e.Point2D(t.x,t.y));return class{constructor(){this.transform=new t.Transformation2D}calculateErrors(e,t){const s=e.length,n=t.length;if(s!==n)throw new Error(`The input length (${s}) is not the same as output length (${n})`);const r=[];return{rms:this.transform.calculateErrors(s,i(e),i(t),r),errorsOut:r}}flipX(e,t){return this.transform.flipX(e,t),this}flipY(e,t){return this.transform.flipY(e,t),this}initializeFromControlPoints(e,t,s,r){const o=t.length,a=s.length;if(o!==a)throw new Error(`The input length (${o}) is not the same as output length (${a})`);this.transform.initializeFromControlPoints(n[e],o,i(t),i(s),r?.transform)}isIdentity(){return this.transform.isIdentity()}rotate(t,n,i){const r=s.deg2rad(t);return null!=n&&null!=i?this.transform.rotateAngleAbout(r,new e.Point2D(n,i)):this.transform.rotateAngle(r),this}scale(e,t){return this.transform.scale(e,t),this}setIdentity(){this.transform.setIdentity()}setSwapCoordinates(){return this.transform.setSwapCoordinates(),this}shear(e,t){return this.transform.shear(e,t),this}shift(e,t){return this.transform.shiftCoords(e,t),this}}})},"esri/chunks/areaOperator":function(){define(["exports","../core/unitUtils","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";function n(e,n={}){const{unit:i}=n;let r=s.fromGeometry(e).calculateArea2D();if(r&&i){const n=s.getSpatialReference(e);if(n.isGeographic)throw new Error("Unable to convert from an angular area unit to a linear area unit.");const o=t.areaUnitFromSpatialReference(n);o!==i&&(o?r=t.convertUnit(r,o,i):(r=Math.sqrt(r),r*=t.getMetersPerUnitForSR(n),r**=2,r=t.convertUnit(r,"square-meters",i)))}return r}const i=!0,r=Object.freeze(Object.defineProperty({__proto__:null,execute:n,supportsCurves:i},Symbol.toStringTag,{value:"Module"}));e.areaOperator=r,e.execute=n,e.supportsCurves=i})},"esri/chunks/bufferOperator":function(){define(["exports","../core/arrayUtils","../core/unitUtils","../geometry/operators/gx/operatorBuffer","../geometry/operators/support/apiConverter"],function(e,t,s,n,i){"use strict";function r(e,t,r={}){const{unit:o}=r,a=i.getSpatialReference(e);return o&&(t=s.convertToSpatialReferenceUnit(t,o,a)),i.toPolygon(n.execute(i.fromGeometry(e),i.fromSpatialReference(a),t),a)}function o(e,r,o={}){let{maxDeviation:a=NaN,maxVerticesInFullCircle:m=96,union:h=!1,unit:l}=o;const u=i.getSpatialReference(e);l&&(r=r.map(e=>s.convertToSpatialReferenceUnit(e,l,u)),a&&(a=s.convertToSpatialReferenceUnit(a,l,u)));const c=e.map(i.fromGeometry);return n.executeManyEx(c,i.fromSpatialReference(u),r,a,m,h).map(e=>i.toPolygon(e,u)).filter(t.isSome)}const a=n.supportsCurves(),m=Object.freeze(Object.defineProperty({__proto__:null,execute:r,executeMany:o,supportsCurves:a},Symbol.toStringTag,{value:"Module"}));e.bufferOperator=m,e.execute=r,e.executeMany=o,e.supportsCurves=a})},"esri/geometry/operators/gx/operatorBuffer":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/ProjectionTransformation","../../../chunks/Envelope2D","../../../chunks/Bufferer-Dw9Qi4T1"],function(e,t,s,n,i,r){"use strict";class o extends t.GeometryCursor{constructor(e,t,s,n,o,a,m){super(),this.m_currentUnionEnvelope2D=new i.Envelope2D,this.m_index=-1,this.m_dindex=-1,this.m_progressTracker=m,this.m_bufferer=new r.Bufferer(m),this.m_inputGeoms=e,this.m_spatialReference=t,this.m_distances=s,this.m_maxDeviation=n,this.m_maxVerticesInFullCircle=o}tock(){return!0}getRank(){return 1}next(){{let e;for(;e=this.m_inputGeoms.next();)return s.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.m_dindex+1<this.m_distances.length&&this.m_dindex++,this.buffer(e,this.m_distances[this.m_dindex]);return null}}getGeometryID(){return this.m_index}buffer(e,t){return this.m_bufferer.buffer(e,t,this.m_spatialReference,0,0,4,this.m_maxDeviation,this.m_maxVerticesInFullCircle)}}const a=new class{getOperatorType(){return 10004}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s,n,i){return this.executeManyEx(e,t,s,Number.NaN,96,n,i)}execute(e,n,i,r){Number.isFinite(i)||s.throwInvalidArgumentException("Invalid distance for buffer operation");const o=new t.SimpleGeometryCursor([e]),a=[i],m=this.executeMany(o,n,a,!1,r).next();return m||s.throwInternalErrorException("null buffer output"),m}executeManyEx(e,t,i,r,a,m,h){if(void 0!==i.find(e=>!Number.isFinite(e))&&s.throwInvalidArgumentException("Invalid distance for buffer operation"),m){const s=new o(e,t,i,r,a,!1,h);return(new n.OperatorUnion).executeMany(s,t,h,2)}return new o(e,t,i,r,a,!1,h)}};e.execute=function(e,t,s){return a.execute(e,t,s,null)},e.executeMany=function(e,s,n,i){const r=a.executeMany(new t.SimpleGeometryCursor(e),s,n,i,null);return Array.from(r)},e.executeManyEx=function(e,s,n,i,r,o){const m=a.executeManyEx(new t.SimpleGeometryCursor(e),s,n,i,r,o,null);return Array.from(m)},e.supportsCurves=function(){return a.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Bufferer-Dw9Qi4T1":function(){define(["exports","./tslib.es6","./Geometry","./SimpleGeometryCursor","./Envelope","./Point2D","./MultiPathImpl","./Envelope2D","./Transformation2D","./GeometryCleaner-BEJM7I4l","./ProjectionTransformation","./OperatorSimplifyOGC","./OperatorGeneralize"],function(e,t,s,n,i,r,o,a,m,h,l,u,c){"use strict";var g;function d(e,t,s,n,i,r){return{m_from:e.clone(),m_to:t.clone(),m_center:s.clone(),m_next:i,m_type:n}}function p(e,t,s,n,i){return{m_from:e.clone(),m_to:t.clone(),m_next:s,m_type:4,m_center:new r.Point2D}}!function(e){e[e.enumDummy=256]="enumDummy",e[e.enumLine=1]="enumLine",e[e.enumArc=2]="enumArc",e[e.enumMiter=8]="enumMiter",e[e.enumBevel=16]="enumBevel",e[e.enumJoinMask=26]="enumJoinMask",e[e.enumConnectionMask=27]="enumConnectionMask"}(g||(g={}));class _ extends n.GeometryCursor{constructor(e,t,s,n,i,r,o,a,m,h){super(),this.m_index=0,this.m_bufferedPolygon=null,this.m_x=0,this.m_y=0,this.m_progressTracker=h,this.m_parent=e,this.m_mp=t,this.m_distance=s,this.m_spatialReference=n,this.m_densifyDist=a,this.m_maxVertexInCompleteCircle=m,this.m_joins=i,this.m_caps=r,this.m_miterLimit=o}next(){const e=new i.Point;for(;;){if(this.m_index===this.m_mp.getPointCount())return null;if(1===this.m_caps)return this.m_index=this.m_mp.getPointCount(),new o.Polygon({vd:this.m_mp.getDescription()});if(this.m_mp.getPointByVal(this.m_index,e),this.m_index++,!e.isEmpty())break}let t,s=!1;if(null===this.m_bufferedPolygon&&(this.m_x=e.getX(),this.m_y=e.getY(),this.m_bufferedPolygon=this.m_parent.buffer(e,this.m_distance,this.m_spatialReference,this.m_joins,this.m_caps,this.m_miterLimit,this.m_densifyDist,this.m_maxVertexInCompleteCircle),s=!0),t=this.m_index<this.m_mp.getPointCount()?this.m_bufferedPolygon.clone():this.m_bufferedPolygon,!s){const s=new m.Transformation2D,n=e.getX()-this.m_x,i=e.getY()-this.m_y;s.setShiftCoords(n,i),t.applyTransformation(s)}return i.setWeakSimple(t,0),t}getGeometryID(){return 0}getRank(){return 1}tock(){return!0}}class f extends n.GeometryCursor{constructor(e){super(),this.m_currentPathIndex=0,this.m_polyline=e}next(){if(!this.m_polyline)return null;const e=this.m_polyline.getImpl(),t=e.getPathCount();if(this.m_currentPathIndex<t){const t=this.m_currentPathIndex;if(this.m_currentPathIndex++,!e.isClosedPathInXYPlane(t)){let s=e.getXY(e.getPathEnd(t)-1);for(;this.m_currentPathIndex<e.getPathCount();){const t=e.getXY(e.getPathStart(this.m_currentPathIndex));if(e.isClosedPathInXYPlane(this.m_currentPathIndex))break;if(!t.equals(s))break;s=e.getXY(e.getPathEnd(this.m_currentPathIndex)-1),this.m_currentPathIndex++}}if(0===t&&this.m_currentPathIndex===this.m_polyline.getPathCount()){const e=this.m_polyline;return this.m_polyline=null,e}const s=new o.Polyline({vd:this.m_polyline.getDescription()});s.addPath(this.m_polyline,t,!0);for(let n=t+1;n<this.m_currentPathIndex;n++)s.addSegmentsFromPath(this.m_polyline,n,0,e.getSegmentCountPath(n),!1);return this.m_currentPathIndex===this.m_polyline.getPathCount()&&(this.m_polyline=null),s}return null}getGeometryID(){return 0}getRank(){return 1}tock(){return!0}}class y extends n.GeometryCursor{constructor(e,t,s){super(),this.m_geometry=null,this.m_index=0,this.m_bufferer=e,this.m_geoms=t,this.m_index=0,this.m_bFilter=s}next(){if(null===this.m_geometry&&(this.m_index=0,this.m_geometry=this.m_geoms.next(),!this.m_geometry))return null;const e=this.m_geometry.getImpl();if(this.m_index<e.getPathCount()){const e=this.m_index;return this.m_index++,this.m_bufferer.bufferPolylinePath(this.m_geometry,e,this.m_bFilter)}return this.m_geometry=null,this.next()}getGeometryID(){return 0}getRank(){return 1}tock(){return!0}}class x extends n.GeometryCursor{constructor(e){super(),this.m_index=0,this.m_bufferer=e}next(){const e=this.m_bufferer.m_geometry;if(this.m_index<e.getPathCount()){const t=this.m_index,n=e.calculateRingArea2D(this.m_index);for(s.geometryReleaseAssert(n>0),this.m_index++;this.m_index<e.getPathCount()&&!(e.calculateRingArea2D(this.m_index)>0);)this.m_index++;let i;return i=0===t&&this.m_index===e.getPathCount()?this.m_bufferer.bufferPolygonImpl(e,0,e.getPathCount()):this.m_bufferer.bufferPolygonImpl(e,t,this.m_index),i}return null}getGeometryID(){return 0}getRank(){return 1}tock(){return!0}}function P(e){return i.setWeakSimple(e,0),e}function E(e,t){return!!e.isEmpty()||Math.min(e.width(),e.height())>t}function v(e,t,n,i,o,a,m,h){const l=e.getXY(n),u=e.getXY(i);if(l.equals(u))return-1;const c=.25*m,g=.25*m,d=new r.Point2D;d.setSub(u,l);const p=d.length(),_=p*p*.25,f=a*a-_;if(f<=_)return-1;const y=Math.sqrt(f);d.normalize();const x=d.clone();x.rightPerpendicularThis();const P=_/y,E=P<=g,v=r.Point2D.lerp(u,l,.5),C=x.clone(),D=P-c;C.scaleAddThis(Math.max(0,D),v),x.negate().scaleAddThis(y,v);const b=a-g,S=3.61*r.sqr(b),I=C.sub(l),w=C.sub(u);let T=!1,A=0;const N=r.makePrimitiveArray(64,0);s.geometryReleaseAssert(h===N.length);{for(let s=e.getPrevVertexEx(i,o);s!==n;){if(1===e.getUserIndex(s,t))return-1;if(e.getXY(s).equals(u)){const t=e.getPrevVertexEx(s,o);e.removeVertex(s,!1),s=t;continue}break}const a=new r.Point2D,m=l.clone();N[A++]=1;for(let s=e.getNextVertexEx(n,o);s!==i;){if(1===e.getUserIndex(s,t))return-1;const n=e.getXY(s);if(n.equals(m)){const t=e.getNextVertexEx(s,o);e.removeVertex(s,!1),s=t;continue}N[A++]=0;const i=new r.Point2D;if(i.setSub(n,l),i.dotProduct(x)<0)return 0;(r.Point2D.sqrDistance(n,l)>S||r.Point2D.sqrDistance(n,u)>S)&&(T=!0);let h=0;if(n.sub(l).crossProduct(I)>=0&&(h=1),n.sub(u).crossProduct(w)<=0&&(h|=2),0===h)return 0;N[A-1]=h,a.assign(m),m.assign(n),s=e.getNextVertexEx(s,o)}if(1===A)return 0;s.geometryReleaseAssert(A<N.length),N[A++]=2}let G=!0;for(let e=1,t=0;e<A;e++)if(N[e]!==N[e-1]&&(t++,G=t<3&&(1===t&&3===N[e]||2===t&&2===N[e]),!G))return 0;if(A>2&&G&&(3===A||!T)){let t=0,s=e.getNextVertexEx(n,o);for(E||(e.setXY(s,C),s=e.getNextVertexEx(s,o));s!==i;){const n=e.getNextVertexEx(s,o);e.removeVertex(s,!1),s=n,++t}return t}if(s.geometryReleaseAssert(3!==A),T&&A>3)return 0;const M=l.clone();let R=n;const k=l.clone();let F=1,q=-1,V=R,H=0;for(A=1;V!==i;){V=e.getNextVertexEx(V,o);const t=N[A++];if(0===t){if(V===i)break;continue}const s=e.getXY(V);if(-1!==q){if(q&F&t&3){e.removeVertex(R,!0),H++,R=V,k.setCoordsPoint2D(s),F=t;continue}if(3===F&&0!==q&&0!==t){if(k.setCoordsPoint2D(C),E||k.equals(M)){e.removeVertex(R,!0),H++,R=V,k.setCoordsPoint2D(s),F=t;continue}e.setXY(R,k)}}q=F,M.setCoordsPoint2D(k),R=V,F=t,k.setCoordsPoint2D(s)}return H}function C(e,t,s,n){for(let i=0,r=e.getPathCount();i<r;i++){const r=e.getXY(e.getPathStart(i));r.x!==s.xmin&&r.x!==s.xmax&&t.addPath(e,i,n)}}e.Bufferer=class{constructor(e){this.m_geometry=null,this.m_bufferCommands=[],this.m_originalGeomType=s.GeometryType.enumUnknown,this.m_maxVertexInCompleteCircle=-1,this.m_circleTemplateSize=-1,this.m_oldCircleTemplateSize=0,this.m_spatialReference=null,this.m_tolerance=new i.CombinedTolerance(0,0),this.m_smallTolerance=new i.CombinedTolerance(0,0),this.m_filterTolerance=0,this.m_densifyDist=-1,this.m_distance=Number.NaN,this.m_absDistance=0,this.m_absDistanceReversed=0,this.m_dA=-1,this.m_miterLimit=4,this.m_joins=0,this.m_caps=0,this.m_bRoundBuffer=!0,this.m_bOutputLoops=!0,this.m_bFilter=!0,this.m_circleTemplate=[],this.m_leftStack=[],this.m_middleStack=[],this.m_helperLine1=new o.Line,this.m_helperLine2=new o.Line,this.m_helperArray=[],this.m_progressCounter=0,this.m_densificator=o.Densificator.constructDefault(e),this.m_progressTracker=e}buffer(e,t,n,m,l,u,c,g){if(e||s.throwInvalidArgumentException("Geometry.Bufferer.Impl.Buffer"),c<0&&s.throwInvalidArgumentException("Geometry.Bufferer.Impl.Buffer"),s.isMesh(e.getGeometryType())&&s.throwNotImplementedException("Unsupported geometry type."),e.isEmpty())return new o.Polygon({vd:e.getDescription()});if(this.m_joins=m,this.m_caps=l,this.m_bRoundBuffer=!1,this.m_miterLimit=u,this.m_originalGeomType=e.getGeometryType(),s.isArea(this.m_originalGeomType)?this.m_bRoundBuffer=0===this.m_joins:s.isPoint(this.m_originalGeomType)?this.m_bRoundBuffer=0===this.m_caps:s.isLinear(this.m_originalGeomType)&&(this.m_bRoundBuffer=0===this.m_joins&&0===this.m_caps),this.m_bFilter=this.m_bRoundBuffer,this.m_geometry=h.clean(e),this.m_geometry.isEmpty())return new o.Polygon({vd:e.getDescription()});const d=new a.Envelope2D;this.m_geometry.queryLooseEnvelope(d),t>0&&d.inflateCoords(t,t),this.m_tolerance=i.calculateToleranceFromGeometryForOp(n,d,!0),this.m_smallTolerance=i.calculateToleranceFromGeometryForOp(null,d,!0),g<=0&&(g=96),this.m_spatialReference=n,this.m_distance=t,this.m_absDistance=Math.abs(this.m_distance),this.m_absDistanceReversed=0!==this.m_absDistance?1/this.m_absDistance:0,Number.isNaN(c)||0===c?c=1e-5*this.m_absDistance:c>.5*this.m_absDistance&&(c=.5*this.m_absDistance),g<12&&(g=12);const p=Math.abs(t)*(1-Math.cos(Math.PI/g));if(p>c)c=p;else if(0!==t){const e=Math.PI/Math.acos(1-c/Math.abs(t));e<g-1&&(g=Math.trunc(e))<12&&(g=12,c=Math.abs(t)*(1-Math.cos(Math.PI/g)))}this.m_densifyDist=c,this.m_maxVertexInCompleteCircle=g,this.m_filterTolerance=this.m_bRoundBuffer?Math.min(this.m_smallTolerance.total(),.25*this.m_densifyDist):0,this.m_circleTemplateSize=this.calcN(),this.m_circleTemplateSize!==this.m_oldCircleTemplateSize&&(this.m_circleTemplate.length=0,this.m_oldCircleTemplateSize=this.m_circleTemplateSize),this.m_densifyDist>0&&s.hasNonLinearSegments(this.m_geometry)&&(this.m_geometry=this.m_densificator.densifyEx(this.m_geometry,0,this.m_densifyDist,0,0!==this.m_joins,r.intMax()));const _=this.bufferImpl();return this.m_geometry=null,_}generateCircleTemplate(){if(this.m_circleTemplate.length)return;const e=this.m_circleTemplateSize,t=Math.trunc((e+3)/4),s=.5*Math.PI/t;this.m_dA=s,this.m_circleTemplate=r.makeObjectArray(r.Point2D,4*t);const n=Math.cos(s),i=Math.sin(s),o=r.Point2D.construct(0,1);for(let e=0;e<t;e++)this.m_circleTemplate[e+0*t].setCoords(o.y,-o.x),this.m_circleTemplate[e+1*t].setCoords(-o.x,-o.y),this.m_circleTemplate[e+2*t].setCoords(-o.y,o.x),this.m_circleTemplate[e+3*t].setCoords(o.x,o.y),o.rotateReverse(n,i)}bufferImpl(){const e=this.m_geometry.getGeometryType();if(s.isSegment(e)){const e=new o.Polyline({vd:this.m_geometry.getDescription()});return e.addSegment(this.m_geometry,!0),this.m_geometry=e,this.bufferImpl()}if(this.m_distance<=this.m_tolerance.total()){if(!s.isArea(e))return new o.Polygon({vd:this.m_geometry.getDescription()});if(this.m_distance<0){const e=new a.Envelope2D;if(this.m_geometry.queryEnvelope(e),e.width()<=2*this.m_absDistance||e.height()<=2*this.m_absDistance)return new o.Polygon({vd:this.m_geometry.getDescription()})}}switch(this.m_geometry.getGeometryType()){case s.GeometryType.enumPoint:return this.bufferPoint();case s.GeometryType.enumMultiPoint:return this.bufferMultiPoint();case s.GeometryType.enumPolyline:return this.bufferPolyline();case s.GeometryType.enumPolygon:return this.bufferPolygon();case s.GeometryType.enumEnvelope:return this.bufferEnvelope();default:s.throwInternalErrorException("")}}bufferPolyline(){if(this.isDegenerateGeometry(this.m_geometry)){const e=new i.Point;this.m_geometry.getPointByVal(0,e);const t=new a.Envelope2D;return this.m_geometry.queryEnvelope(t),e.setXY(t.getCenter()),this.bufferDegeneratePath(e,!0)}const e=this.m_geometry,t=this.m_geometry.getDescription();this.m_geometry=null;const s=new f(e);let n,r;n=0===this.m_joins?(new c.OperatorGeneralize).executeMany(s,.25*this.m_densifyDist,!1,this.m_progressTracker):s,r=this.m_bRoundBuffer?(new u.OperatorSimplifyOGC).executeMany(n,null,!0,this.m_progressTracker):n;const m=new y(this,r,this.m_bFilter),h=(new l.OperatorUnion).executeMany(m,this.m_spatialReference,this.m_progressTracker,2),g=(new l.OperatorSimplify).executeMany(h,this.m_spatialReference,!1,this.m_progressTracker).next();return null!==g?g:new o.Polygon({vd:t})}bufferPolygon(){if(0===this.m_distance)return this.m_geometry;this.generateCircleTemplate();const e=(new l.OperatorSimplify).execute(this.m_geometry,null,!1,this.m_progressTracker);if(this.m_distance<0){if(this.m_geometry=e,this.m_geometry.isEmpty())return this.m_geometry;const t=this.m_geometry,s=this.bufferPolygonImpl(t,0,t.getPathCount());return(new l.OperatorSimplify).execute(s,this.m_spatialReference,!1,this.m_progressTracker)}{if(this.m_geometry=e,this.isDegenerateGeometry(this.m_geometry)){const e=new i.Point;this.m_geometry.getPointByVal(0,e);const t=new a.Envelope2D;return this.m_geometry.queryEnvelope(t),e.setXY(t.getCenter()),this.bufferDegeneratePath(e,!0)}const t=new x(this),s=(new l.OperatorUnion).executeMany(t,this.m_spatialReference,this.m_progressTracker,2),n=(new l.OperatorSimplify).executeMany(s,this.m_spatialReference,!1,this.m_progressTracker).next();return null!==n?n:new o.Polygon({vd:this.m_geometry.getDescription()})}}bufferPolygonImpl(e,t,s){const n=e,r=n.getImpl();let m=new o.Polygon({vd:e.getDescription()});for(let h=t;h<s;h++){if(r.getPathSize(h)<1)continue;const t=r.calculateRingArea2D(h),s=new a.Envelope2D;if(r.queryPathEnvelope(h,s),this.m_distance>0)if(t>0)if(this.isDegeneratePath(r,h)){const e=new i.Point;r.getPointByVal(r.getPathStart(h),e),e.setXY(s.getCenter()),m.add(this.bufferDegeneratePath(e,!0),!1)}else{const t=new o.Polyline({vd:e.getDescription()}),s=t.getImpl();if(o.isPathConvex(this.m_geometry,h)){const e=this.bufferConvexPath(n,h);m.add(e,!1)}else{this.bufferClosedPath(this.m_geometry,h,s,this.m_bRoundBuffer,1);const e=this.bufferCleanup(t);m.add(e,!1)}}else{if(s.width()+this.m_tolerance.total()<=2*this.m_absDistance||s.height()+this.m_tolerance.total()<=2*this.m_absDistance)continue;const t=new o.Polyline({vd:e.getDescription()}),n=t.getImpl();if(this.bufferClosedPath(this.m_geometry,h,n,this.m_bRoundBuffer,1),!t.isEmpty()){const e=s,i=Math.max(1,this.m_absDistance),r=e.clone();r.inflateCoords(i,i),n.addEnvelope(r,!1);const o=this.bufferCleanup(t);m.reserve(m.getPointCount()+o.getPointCount()-4),C(o,m,r,!0)}}else if(t>0){if(s.width()+this.m_tolerance.total()<=2*this.m_absDistance||s.height()+this.m_tolerance.total()<=2*this.m_absDistance)continue;const t=new o.Polyline({vd:e.getDescription()}),n=t.getImpl();if(this.bufferClosedPath(this.m_geometry,h,n,this.m_bRoundBuffer,-1),!t.isEmpty()){const e=new a.Envelope2D;n.queryLooseEnvelope(e);const s=Math.max(1,this.m_absDistance),i=e.clone();i.inflateCoords(s,s),n.addEnvelope(i,!1),C(this.bufferCleanup(t),m,i,!0)}}else{const t=new o.Polyline({vd:e.getDescription()}),s=t.getImpl();this.bufferClosedPath(this.m_geometry,h,s,this.m_bRoundBuffer,-1);const n=this.bufferCleanup(t);for(let e=0,t=n.getPathCount();e<t;e++)m.addPath(n,e,!0)}}if(this.m_distance>0)return m.getPathCount()>1?this.bufferCleanup(m):P(m);{const e=new a.Envelope2D;if(m.queryLooseEnvelope(e),m.isEmpty())return P(m);{const t=Math.max(1,this.m_absDistance),s=e.clone();s.inflateCoords(t,t),m.addEnvelope(s,!1);const n=this.bufferCleanup(m);m=new o.Polygon;const i=new o.Polygon({vd:n.getDescription()});return C(n,i,s,!1),P(i)}}}bufferPoint(){return this.bufferPointImpl(this.m_geometry)}bufferPointImpl(e){const t=new o.Polygon({vd:e.getDescription()});return 0===this.m_caps?(this.addCircle(t.getImpl(),e),this.setStrongSimple(t)):2===this.m_caps?(this.addSquare(t.getImpl(),e),this.setStrongSimple(t)):t}bufferDegeneratePath(e,t){const s=new o.Polygon({vd:e.getDescription()});return t&&0===this.m_joins||!t&&0===this.m_caps?(this.addCircle(s.getImpl(),e),this.setStrongSimple(s)):t||2!==this.m_caps?s:(this.addSquare(s.getImpl(),e),this.setStrongSimple(s))}bufferMultiPoint(){const e=new _(this,this.m_geometry,this.m_distance,this.m_spatialReference,this.m_joins,this.m_caps,this.m_miterLimit,this.m_densifyDist,this.m_maxVertexInCompleteCircle,this.m_progressTracker);return(new l.OperatorUnion).executeMany(e,this.m_spatialReference,this.m_progressTracker,2).next()}bufferEnvelope(){let e=new o.Polygon({vd:this.m_geometry.getDescription()});if(this.m_distance<=0){if(0===this.m_distance)e.addEnvelope(this.m_geometry,!1),E(this.m_geometry,this.m_tolerance.total())&&(e=this.setStrongSimple(e));else{const t=new i.Envelope;this.m_geometry.queryEnvelope(t),t.inflateCoords(this.m_distance,this.m_distance),e.addEnvelope(t,!1),E(t,this.m_tolerance.total())&&(e=this.setStrongSimple(e))}return e}if(1===this.m_joins){const t=new i.Envelope({copy:this.m_geometry});return t.inflateCoords(this.m_absDistance,this.m_absDistance),e.addEnvelope(t,!1),e}const t=this.m_geometry.clone();if(0===t.width()||0===t.height()){if(0===t.width()&&0===t.height()){const e=new i.Point({vd:this.m_geometry.getDescription()});return t.queryCornerByVal(0,e),this.m_geometry=e,this.bufferImpl()}const e=new o.Polyline({vd:this.m_geometry.getDescription()}),s=new i.Point;return t.queryCornerByVal(0,s),e.startPathPoint(s),t.queryCornerByVal(2,s),e.lineToPoint(s),this.m_geometry=e,this.bufferImpl()}return e.addEnvelope(this.m_geometry,!1),this.m_geometry=e,this.bufferConvexPath(e,0)}bufferConvexPath(e,t){this.generateCircleTemplate();const n=e.hasAttribute(10),i=new o.Polygon({vd:e.getDescription()}),a=i.getImpl();i.reserve((this.m_circleTemplate.length/10+4)*e.getPathSize(t));const m=new r.Point2D,h=new r.Point2D,l=new r.Point2D,u=new r.Point2D(0,0),c=new r.Point2D,d=new r.Point2D,p=e.getImpl(),_=e.getPathSize(t),f=e.getPathStart(t);for(let i=0,r=e.getPathSize(t);i<r;i++){const e=p.getXY(f+i),t=p.getXY(f+(i+1)%_),r=p.getXY(f+(i+2)%_);c.setSub(t,e),0===c.length()&&s.throwInternalErrorException("");const o=n&&!!(1&p.getAttributeAsInt(10,(i+1)%_,0));c.normalize();const y=c.clone();c.leftPerpendicularThis(),c.scale(this.m_absDistance),m.setAdd(c,e),h.setAdd(c,t),0===i?a.startPath(m):a.lineTo(m),a.lineTo(h),d.setSub(r,t),0===d.length()&&s.throwInternalErrorException(""),d.normalize();const x=d.clone();d.leftPerpendicularThis(),d.scale(this.m_absDistance),l.setAdd(d,t);let P=g.enumArc;const E=o?0:this.m_joins;if(2===E)P=g.enumBevel;else if(1===E){const e=-y.crossProduct(x);u.setSub(y,x),u.scale(this.m_absDistance/e),u.length()<this.m_miterLimit*this.m_absDistance?(u.addThis(t),P=g.enumMiter):P=g.enumBevel}else u.assign(t);this.addJoin(P,a,u,h,l,!1,!1)}return P(i)}bufferPolylinePath(e,t,s){this.generateCircleTemplate();const n=e,r=n.getImpl();if(r.getPathSize(t)<1)return null;let m;if(m=this.m_bRoundBuffer?r.isClosedPathInXYPlane(t):r.isClosedPath(t),this.isDegeneratePath(r,t)&&this.m_distance>0){const e=new i.Point;r.getPointByVal(r.getPathStart(t),e);const s=new a.Envelope2D;return r.queryPathEnvelope(t,s),e.setXY(s.getCenter()),this.bufferDegeneratePath(e,m)}const h=new o.Polyline({vd:e.getDescription()});h.reserve((Math.trunc(this.m_circleTemplate.length/10)+4)*r.getPathSize(t));const l=h.getImpl();return m?2!==this.bufferClosedPath(n,t,l,s,1)&&this.bufferClosedPath(n,t,l,s,-1):this.bufferOpenPath(n,t,l,s),this.bufferCleanup(h)}progress_(){}bufferCleanup(e,t=!1){const s=t?this.m_tolerance:this.m_smallTolerance;return l.planarSimplify(e,s,!0,!t,-1,this.m_progressTracker,0,!1)}calcN(){if(0===this.m_densifyDist)return this.m_maxVertexInCompleteCircle;const e=1-this.m_densifyDist*Math.abs(this.m_absDistanceReversed);let t=4;return t=e<-1?4:2*Math.PI/Math.acos(e)+.5,t<4?t=4:t>this.m_maxVertexInCompleteCircle&&(t=this.m_maxVertexInCompleteCircle),Math.trunc(t)}addJoin(e,t,s,n,i,o,a){if(this.generateCircleTemplate(),o&&(t.startPath(n),o=!1),e===g.enumBevel)return void(a&&t.lineTo(i));if(e===g.enumMiter){const e=s.clone();return t.lineTo(e),void(a&&t.lineTo(i))}const m=new r.Point2D;m.setSub(n,s),m.scale(this.m_absDistanceReversed);const h=new r.Point2D;h.setSub(i,s),h.scale(this.m_absDistanceReversed);let l=Math.atan2(m.y,m.x)/this.m_dA;l<0&&(l=this.m_circleTemplate.length+l),l=this.m_circleTemplate.length-l;let u=Math.atan2(h.y,h.x)/this.m_dA;u<0&&(u=this.m_circleTemplate.length+u),u=this.m_circleTemplate.length-u,u<l&&(u+=this.m_circleTemplate.length);let c=Math.trunc(u),d=Math.ceil(l),p=this.m_circleTemplate[d%this.m_circleTemplate.length].clone();p.scaleAddThis(this.m_absDistance,s);const _=10*this.m_tolerance.total();p.sub(n).length()<_&&(d+=1),p=this.m_circleTemplate[c%this.m_circleTemplate.length].clone(),p.scaleAddThis(this.m_absDistance,s),p.sub(i).length()<_&&(c-=1);let f=c-d;f++;for(let e=0,n=d%this.m_circleTemplate.length;e<f;e++,n=(n+1)%this.m_circleTemplate.length)p=this.m_circleTemplate[n].clone(),p.scaleAddThis(this.m_absDistance,s),t.lineTo(p),this.progress_();a&&t.lineTo(i)}bufferClosedPath(e,t,s,n,i){const r=new o.EditShape,a=r.addPathFromMultiPath(e,t,!0);return this.bufferClosedPathImpl(r,a,s,n,i)}bufferClosedPathImpl(e,n,a,h,l){const u=e.getFirstVertex(e.getFirstPath(n)),c=new i.Point;if(e.queryPoint(u,c),e.filterClosePoints(this.m_filterTolerance,!1,!1,!1,-1),e.getPointCount(n)<2)return l<0?0:(this.m_bRoundBuffer&&this.addCircle(a,c),2);s.geometryReleaseAssert(e.getFirstPath(n)!==o.nullHandle),s.geometryReleaseAssert(e.getFirstVertex(e.getFirstPath(n))!==o.nullHandle);const _=e.getXY(e.getFirstVertex(e.getFirstPath(n))),f=new m.Transformation2D;if(f.setShift(_.negate()),e.applyTransformation(f),h){const i=function(e,s,n,i,a,m,h){const l=function(e,s,n,i,a,m,h){const l={stack:[],error:void 0,hasError:!1};try{const i=e.getFirstPath(s),u=e.createUserIndex(),c=()=>{e.removeUserIndex(u)};t.__addDisposableResource(l,r.makeScopedCall(c,!1),!1),function(e,t,s,n){let i=-1;const o=new r.Point2D,a=new r.Point2D,m=new r.Point2D;for(let s=0,r=e.getPathSize(n),h=e.getFirstVertex(n);s<r;++s){-1===i&&(e.queryXY(h,a),i=e.getPrevVertex(h),-1!==i&&(e.queryXY(i,o),m.setSub(a,o),m.normalize()));const s=e.getNextVertex(h);if(-1===s)break;const n=e.getXY(s),r=n.sub(a);r.normalize(),-1!==i&&r.dotProduct(m)<-.99&&Math.abs(r.crossProduct(m))<1e-7&&e.setUserIndex(h,t,1),i=h,h=s,o.assign(a),a.assign(n),m.assign(r)}}(e,u,0,i);for(let t=0;t<100;++t){if(0===e.getPathSize(i))return 1;let t=e.getFirstVertex(i),s=e.getPathSize(i);if(s<3)return 1;e.isClosedPath(i)||(s-=1);const r=64;let m=0,l=!1;for(let i=0;i<s&&t!==o.nullHandle;i++){let o=0,c=t;for(let m=1,l=Math.min(r,s-i);m<l;m++)if(c=e.getNextVertexEx(c,n),m>1){const i=v(e,u,t,c,n,a,h,r);if(-1===i)break;o+=i,s-=i}if(m+=o,l=o>0,l){const i=e.getPrevVertexEx(t,n);if(-1!==i){t=i,s++;continue}}t=e.getNextVertexEx(t,n)}if(0===m)break}return e.filterClosePoints(m,!1,!1,!1,-1),1}catch(e){l.error=e,l.hasError=!0}finally{t.__disposeResources(l)}}(e,s,n,0,a,m,h);return l}(e,n,l,0,this.m_absDistance,this.m_filterTolerance,this.m_densifyDist);if(s.geometryReleaseAssert(1===i),e.getPointCount(n)<2)return l<0?0:(this.addCircle(a,c),2)}const y=0!==this.m_joins&&e.getVertexDescription().hasAttribute(10);this.m_bufferCommands.length=0;const x=e.getFirstPath(n);let P=e.getFirstVertex(x),E=1===l?e.getPrevVertex(P):e.getNextVertex(P),C=1===l?e.getNextVertex(P):e.getPrevVertex(P),D=!0;const b=new r.Point2D,S=new r.Point2D,I=new r.Point2D,w=new r.Point2D,T=new r.Point2D,A=new r.Point2D,N=new r.Point2D,G=new r.Point2D,M=this.m_absDistance,R=e.getPathSize(x),k=new r.Point2D(0,0);for(let t=0;t<R;t++){S.assign(e.getXY(C)),D&&(b.assign(e.getXY(P)),I.assign(e.getXY(E)),A.setSub(b,I),A.normalize(),G.leftPerpendicularOther(A),G.scale(M),w.setAdd(G,b));const t=y&&!!(1&e.getAttributeAsDbl(10,P,0));T.setSub(S,b),T.normalize(),N.leftPerpendicularOther(T),N.scale(M);const s=new r.Point2D;s.setAdd(b,N);const n=A.crossProduct(T),i=A.dotProduct(T);if(n<0||i<0&&n<Math.abs(i)*Number.EPSILON*8){let e=!1;const i=t?0:this.m_joins;if(1===i){const t=-n;k.setSub(A,T),k.scale(this.m_absDistance/t),k.length()<this.m_miterLimit*this.m_absDistance&&(k.addThis(b),e=!0),this.m_bufferCommands.push(d(w,s,k,e?g.enumMiter:g.enumBevel,this.m_bufferCommands.length+1))}else this.m_bufferCommands.push(d(w,s,b,0===i?g.enumArc:g.enumBevel,this.m_bufferCommands.length+1))}else w.equals(s)||(this.m_bufferCommands.push(p(w,b,this.m_bufferCommands.length+1)),this.m_bufferCommands.push(p(b,s,this.m_bufferCommands.length+1)));const o=new r.Point2D;o.setAdd(S,N),this.m_bufferCommands.push(d(s,o,b,g.enumLine,this.m_bufferCommands.length+1)),w.setCoordsPoint2D(o),G.setCoordsPoint2D(N),I.setCoordsPoint2D(b),b.setCoordsPoint2D(S),A.setCoordsPoint2D(T),E=P,P=C,D=!1,C=1===l?e.getNextVertex(P):e.getPrevVertex(P)}return this.m_bufferCommands.at(-1).m_next=0,this.processBufferCommands(a),f.setShift(_),a.applyTransformationToPath(f,a.getPathCount()-1),1}bufferOpenPath(e,t,n,a){if(this.m_bRoundBuffer){const s=new o.Polyline({vd:e.getDescription()});return s.addPath(e,t,!1),s.addSegmentsFromPath(e,t,0,e.getSegmentCountPath(t),!1),this.bufferClosedPath(s,0,n,a,1)}let h=0;const l=new o.Polyline({vd:e.getDescription()}),u=new r.Point2D(0,0);{const s=new o.EditShape,r=s.addPathFromMultiPath(e,t,!1),a=s.getFirstVertex(s.getFirstPath(r)),m=new i.Point;if(s.queryPoint(a,m),u.assign(m.getXY()),s.filterClosePoints(0,!1,!1,!1,-1),s.getPointCount(r)<2)return this.m_bRoundBuffer&&this.addCircle(n,m),2;const c=s.getGeometry(s.getFirstGeometry());l.addPath(c,0,!1),h=l.getPointCount()-1,l.addSegmentsFromPath(c,0,0,c.getSegmentCountPath(0)-1,!1)}const c=new o.EditShape,_=c.addPathFromMultiPath(l,0,!0);s.geometryReleaseAssert(c.getFirstPath(_)!==o.nullHandle),s.geometryReleaseAssert(c.getFirstVertex(c.getFirstPath(_))!==o.nullHandle);const f=new m.Transformation2D;f.setShift(u.negate()),c.applyTransformation(f),this.m_bufferCommands.length=0;const y=c.getFirstPath(_),x=0!==this.m_joins&&c.getVertexDescription().hasAttribute(10);let P=c.getFirstVertex(y),E=c.getPrevVertex(P),v=c.getNextVertex(P),C=!0;const D=new r.Point2D,b=new r.Point2D,S=new r.Point2D,I=new r.Point2D,w=new r.Point2D,T=new r.Point2D,A=new r.Point2D,N=new r.Point2D,G=this.m_absDistance,M=c.getPathSize(y),R=new r.Point2D(0,0);for(let e=0;e<M;e++){let t=!1;0!==e&&e!==h||(t=!0),b.assign(c.getXY(v)),C&&(D.assign(c.getXY(P)),S.assign(c.getXY(E)),T.setSub(D,S),T.normalize(),N.leftPerpendicularOther(T),N.scale(G),I.setAdd(N,D));const s=x&&!!(1&c.getAttributeAsDbl(10,P,0));w.setSub(b,D),w.normalize(),A.leftPerpendicularOther(w),A.scale(G);const n=new r.Point2D;n.setAdd(D,A);const i=T.crossProduct(w),o=T.dotProduct(w);if(i<0||o<0&&i<Math.abs(o)*Number.EPSILON*8)if(t)if(0===this.m_caps)this.m_bufferCommands.push(d(I,n,D,g.enumArc,this.m_bufferCommands.length+1));else if(1===this.m_caps)this.m_bufferCommands.push(d(I,n,D,g.enumLine,this.m_bufferCommands.length+1));else{const e=w.mul(this.m_absDistance).negate(),t=e.clone();e.addThis(I),t.addThis(n),this.m_bufferCommands.push(d(I,e,D,g.enumLine,this.m_bufferCommands.length+1)),this.m_bufferCommands.push(d(e,t,D,g.enumLine,this.m_bufferCommands.length+1)),this.m_bufferCommands.push(d(t,n,D,g.enumLine,this.m_bufferCommands.length+1))}else{let e=!1;const t=s?0:this.m_joins;if(1===t){const t=-i;R.setSub(T,w),R.scale(this.m_absDistance/t),R.length()<this.m_miterLimit*this.m_absDistance&&(R.addThis(D),e=!0),this.m_bufferCommands.push(d(I,n,R,e?g.enumMiter:g.enumBevel,this.m_bufferCommands.length+1))}else this.m_bufferCommands.push(d(I,n,D,0===t?g.enumArc:g.enumBevel,this.m_bufferCommands.length+1))}else I.equals(n)||(this.m_bufferCommands.push(p(I,D,this.m_bufferCommands.length+1)),this.m_bufferCommands.push(p(D,n,this.m_bufferCommands.length+1)));const a=new r.Point2D;a.setAdd(b,A),this.m_bufferCommands.push(d(n,a,D,g.enumLine,this.m_bufferCommands.length+1)),I.setCoordsPoint2D(a),N.setCoordsPoint2D(A),S.setCoordsPoint2D(D),D.setCoordsPoint2D(b),T.setCoordsPoint2D(w),E=P,P=v,C=!1,v=c.getNextVertex(P)}return this.m_bufferCommands.at(-1).m_next=0,this.processBufferCommands(n),f.setShift(u),n.applyTransformationToPath(f,n.getPathCount()-1),1}processBufferCommands(e){const t=this.cleanupBufferCommands();let s=!0,n=t+1;for(let i=t;n!==t;i=n){const t=this.m_bufferCommands[i];n=-1!==t.m_next?t.m_next:(i+1)%this.m_bufferCommands.length,t.m_type&&(s&&(e.startPath(t.m_from),s=!1),t.m_type&g.enumJoinMask?this.addJoin(t.m_type,e,t.m_center,t.m_from,t.m_to,!1,!0):e.lineTo(t.m_to))}}cleanupBufferCommands(){this.m_helperArray=r.makeObjectArray(r.Point2D,9);let e=0;for(let t=0,s=this.m_bufferCommands.length;t<s;){const s=this.m_bufferCommands[t];if(s.m_type&g.enumConnectionMask){e=t;break}t=s.m_next}let t=e+1;for(let s=e;t!==e;s=t){const e=this.m_bufferCommands[s];t=e.m_next;let n=1,i=null;for(;t!==s&&(i=this.m_bufferCommands[t],!(i.m_type&g.enumConnectionMask));)t=i.m_next,n++;1!==n&&(e.m_type&i.m_type)===g.enumLine&&(this.m_helperLine1.setStartXY(e.m_from),this.m_helperLine1.setEndXY(e.m_to),this.m_helperLine2.setStartXY(i.m_from),this.m_helperLine2.setEndXY(i.m_to),1===this.m_helperLine1.intersect(this.m_helperLine2,this.m_helperArray,null,null,this.m_smallTolerance.total())&&(e.m_to.assign(this.m_helperArray[0]),i.m_from.assign(this.m_helperArray[0]),e.m_next=t))}return e}isDegeneratePath(e,t){if(1===e.getPathSize(t))return!0;if(0===this.m_joins&&0===this.m_caps){const s=new a.Envelope2D;if(e.queryPathEnvelope(t,s),Math.max(s.width(),s.height())<.5*this.m_densifyDist)return!0}return!1}isDegenerateGeometry(e){if(0===this.m_joins&&0===this.m_caps){const t=new a.Envelope2D;if(e.queryEnvelope(t),Math.max(t.width(),t.height())<.5*this.m_densifyDist)return!0}return!1}addCircle(e,t){const s=t.getXY();if(0!==this.m_circleTemplate.length){let t=this.m_circleTemplate[0].clone();t.scaleAddThis(this.m_absDistance,s),e.startPath(t);for(let n=1,i=this.m_circleTemplate.length;n<i;n++)t=this.m_circleTemplate[n].clone(),t.scaleAddThis(this.m_absDistance,s),e.lineTo(t);return}const n=this.m_circleTemplateSize,i=Math.trunc((n+3)/4),o=.5*Math.PI/i;e.reserve(4*i);const a=Math.cos(o),m=Math.sin(o);for(let t=3;t>=0;t--){const n=r.Point2D.construct(0,this.m_absDistance);switch(t){case 0:for(let t=0;t<i;t++)e.lineToCoords(n.x+s.x,n.y+s.y),n.rotateReverse(a,m);break;case 1:for(let t=0;t<i;t++)e.lineToCoords(-n.y+s.x,n.x+s.y),n.rotateReverse(a,m);break;case 2:for(let t=0;t<i;t++)e.lineToCoords(-n.x+s.x,-n.y+s.y),n.rotateReverse(a,m);break;default:e.startPathCoords(n.y+s.x,-n.x+s.y);for(let t=1;t<i;t++)n.rotateReverse(a,m),e.lineToCoords(n.y+s.x,-n.x+s.y)}this.progress_()}}addSquare(e,t){const s=new i.Envelope({vd:t.getDescription()});s.setCoords(t.getX(),t.getY(),t.getX(),t.getY()),s.inflateCoords(this.m_absDistance,this.m_absDistance),e.addEnvelope(s,!1)}setStrongSimple(e){return e.getImpl().setIsSimple(4,this.m_tolerance.total()),e.getImpl().updateOGCFlagsProtected(),e}}})},"esri/chunks/GeometryCleaner-BEJM7I4l":function(){define(["exports","./Geometry"],function(e,t){"use strict";e.clean=function(e,s){const n=e.getGeometryType();return n===t.GeometryType.enumPoint?e:t.isMultiPath(n)?function(e){if(function(e){for(let s=0,n=e.getPathCount();s<n;s++){const n=e.getPathSize(s);if(0===n)return!1;if(1===n){if(0===e.getSegmentCountPath(s))return!1;if(e.getSegmentType(e.getPathStart(s))===t.GeometryType.enumLine)return!1;if(!e.isClosedPath(s))return!1}}return!0}(e))return e;const s=e.createInstance();for(let n=0,i=e.getPathCount();n<i;n++){const i=e.getPathSize(n);if(0!==i){if(1===i){if(0===e.getSegmentCountPath(n))continue;if(e.getSegmentType(e.getPathStart(n))===t.GeometryType.enumLine)continue;if(!e.isClosedPath(n))continue}s.addPath(e,n,!0)}}return s}(e):n===t.GeometryType.enumMultiPoint||n===t.GeometryType.enumEnvelope?e:n===t.GeometryType.enumMultipatch?(t.throwNotImplementedException("not implemented for multipatch"),e):e}})},"esri/chunks/OperatorGeneralize":function(){define(["exports","./tslib.es6","./SimpleGeometryCursor","./Geometry","./MultiPathImpl","./Envelope","./Point2D","./OperatorDensify"],function(e,t,s,n,i,r,o,a){"use strict";class m extends s.GeometryCursor{constructor(e,t,s,n){super(),this.m_pline=null,this.m_point=new r.Point,this.m_stack=[],this.m_resultstack=[],this.m_callCount=0,this.m_progressTracker=n,this.m_geoms=e,this.m_maxDeviation=t,this.m_bRemoveDegenerateParts=s}tock(){return!0}getRank(){return 1}next(){const e=this.m_geoms.next();return null===e?null:(n.throwIfMesh(e),this.generalize(e))}getGeometryID(){return this.m_geoms.getGeometryID()}generalize(e){const s=e.getGeometryType();if(n.isPoint(s))return e;if(s===n.GeometryType.enumEnvelope){const t=new i.Polygon({vd:e.getDescription()});return t.addEnvelope(e,!1),this.generalize(t)}if(n.isSegment(s)){const t=new i.Polyline({vd:e.getDescription()});return t.addSegment(e,!0),this.generalize(t)}if(n.isMultiPath(s)||n.throwNotImplementedException(""),e.isEmpty()||this.m_maxDeviation<=0)return e;const r=(new a.OperatorDensify).execute(e,0,.05*this.m_maxDeviation,0,this.m_progressTracker);e.hasNonLinearSegments()&&(this.m_maxDeviation*=.95);const m=r,h=e.createInstance();h.getGeometryType()===n.GeometryType.enumPolygon&&h.setFillRule(e.getFillRule()),this.m_xy=m.getAttributeStreamRef(0);{const e={stack:[],error:void 0,hasError:!1};try{const s=new i.Line;this.m_pline=s,t.__addDisposableResource(e,o.makeScopedCall(()=>{this.m_pline=null},!1),!1);for(let e=0,t=m.getPathCount();e<t;e++)this.generalizePath(m.getImpl(),e,h.getImpl())}catch(t){e.error=t,e.hasError=!0}finally{t.__disposeResources(e)}}return this.m_resultstack.length=0,this.m_stack.length=0,h}generalizePath(e,t,s){if(e.getPathSize(t)<2)return;this.m_resultstack.length=0,this.m_stack.length=0;const n=e.getPathStart(t),i=e.getPathEnd(t)-1,r=e.isClosedPath(t),a=e.isClosedPathInXYPlane(t);let m=0,h=-1;this.m_stack.push(r?n:i),this.m_stack.push(n);let l=!1,u=!1;for(!this.m_bRemoveDegenerateParts&&a&&(l=!0,u=!0);this.m_stack.length>1;){const t=this.m_stack.at(-1);this.m_stack.pop();const s=this.m_stack.at(-1);let n=e.getXY(t);this.m_pline.setStartXY(n),n=e.getXY(s),this.m_pline.setEndXY(n);const r=[Number.NaN];let o=this.findGreatestDistance(t,s,i,r);o>=0&&(l?l=!1:(u&&r[0]>m&&(m=r[0],h=o),r[0]<=this.m_maxDeviation&&(o=-1))),o>=0?(this.m_stack.push(o),this.m_stack.push(t)):this.m_resultstack.push(t)}r||this.m_resultstack.push(this.m_stack[0]);const c=this.m_resultstack.length;if(c===e.getPathSize(t)&&c===this.m_stack.length)s.addPath(e,t,!0);else if(this.m_resultstack.length>0){if(this.m_bRemoveDegenerateParts&&this.m_resultstack.length<=2){if(r||1===this.m_resultstack.length)return;if(o.Point2D.distance(e.getXY(this.m_resultstack[0]),e.getXY(this.m_resultstack[1]))<=this.m_maxDeviation)return}if(u&&h>=0&&m<=this.m_maxDeviation){const e=this.m_resultstack.at(-1)>h;this.m_resultstack.push(h),e&&(this.m_resultstack[this.m_resultstack.length-2]=o.swap(this.m_resultstack[this.m_resultstack.length-1],this.m_resultstack[this.m_resultstack.length-1]=this.m_resultstack[this.m_resultstack.length-2]))}for(let t=0,n=this.m_resultstack.length;t<n;t++)e.getPointByVal(this.m_resultstack[t],this.m_point),0===t?s.startPathPoint(this.m_point):s.lineToPoint(this.m_point);if(r){for(let e=this.m_resultstack.length;e<3;e++)s.lineToPoint(this.m_point);s.closePathWithLine()}}}findGreatestDistance(e,t,s,n){let i=t-1;t<=e&&(i=s);let r=-1,a=0;const m=new o.Point2D;for(let t=e+1;t<=i;t++){this.m_xy.queryPoint2D(2*t,m);const e=m.x,s=m.y,n=this.m_pline.getClosestCoordinate(m,!1);m.assign(this.m_pline.getCoord2D(n)),m.x-=e,m.y-=s;const i=m.length();i>a&&(r=t,a=i),this.m_callCount++}return n[0]=a,r}}e.OperatorGeneralize=class{getOperatorType(){return 10204}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s,n){return new m(e,t,s,n)}execute(e,t,s,i){return e||n.throwInvalidArgumentException("null param is not allowed."),new m(null,t,s,i).generalize(e)}}})},"esri/chunks/centroidOperator":function(){define(["exports","./Centroid-DZi-eb9F","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";const n=new class{getOperatorType(){return 10205}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,s){return t.calculateCentroid2D(e)}};function i(e){const t=n.execute(s.fromGeometry(e),null);return s.toPoint(t,s.getSpatialReference(e))}const r=n.supportsCurves(),o=Object.freeze(Object.defineProperty({__proto__:null,execute:i,supportsCurves:r},Symbol.toStringTag,{value:"Module"}));e.centroidOperator=o,e.execute=i,e.supportsCurves=r})},"esri/chunks/Centroid-DZi-eb9F":function(){define(["exports","./Geometry","./Point2D"],function(e,t,s){"use strict";function n(e,t=-1){const n=new s.KahanSummator(0),a=new s.KahanSummator(0),m=e.getImpl();let h;const l=m.hasNonLinearSegments();let u;const c=m.getXY(0);if(-1===t){if(u=m.calculateArea2D(),0===u)return o(e);l&&(h=m.querySegmentIterator());for(let e=0,t=m.getPathCount();e<t;e++)i(c,m,e,n,a),l&&r(c,h,n,a)}else{if(u=m.calculateRingArea2D(t),0===u)return o(e,t);l&&(h=m.querySegmentIterator(),h.resetToPath(t)),i(c,m,t,n,a),l&&r(c,h,n,a)}const g=new s.Point2D,d=new s.Point2D;return g.setCoords(n.getResult(),a.getResult()),d.assign(g.mul(1/u).add(c)),d}function i(e,t,n,i,r){const o=t.getPathStart(n),a=t.getPathEnd(n);if(a-o<3)return;const m=t.getAttributeStreamRef(0),h=m.readPoint2D(2*o),l=m.readPoint2D(2*(o+1));l.subThis(h);const u=new s.KahanSummator(0),c=t.hasNonLinearSegments(),g=1/3,d=new s.Point2D;for(let e=o+2;e<a;e++){m.queryPoint2D(2*e,d),d.subThis(h);const t=.5*d.crossProduct(l);c&&u.add(t);const s=g*t;i.add((l.x+d.x)*s),r.add((l.y+d.y)*s),l.setCoordsPoint2D(d)}const p=c?u.getResult():t.calculateRingArea2D(n),_=h.sub(e).mul(p);i.add(_.x),r.add(_.y)}function r(e,s,n,i){let r;for(s.nextPath()||t.throwInternalErrorException("centroid");null!==(r=s.nextCurve());){const t=r.calculateWeightedAreaCentroid2D(e);n.add(t.x),i.add(t.y)}}function o(e,t=-1){return a(e.getImpl(),t)}function a(e,t=-1){const n=-1===t?e.calculateLength2D():e.calculatePathLength2D(t);if(0===n)return function(e,t=-1){if(-1!==t)return e.getXY(e.getPathStart(t));const n=new s.KahanSummator(0),i=new s.KahanSummator(0);for(let t=0;t<e.getPathCount();++t){const s=e.getXY(e.getPathStart(t));n.add(s.x),i.add(s.y)}return s.Point2D.construct(n.getResult(),i.getResult()).mul(1/e.getPathCount())}(e,t);const i=new s.KahanSummator(0),r=new s.KahanSummator(0),o=e.querySegmentIterator();for(-1!==t&&o.resetToPath(t);o.nextPath();){const s=o.getPathIndex(),n=e.getXY(e.getPathStart(s));for(;o.hasNextSegment();){const e=o.nextSegment(),t=e.calculateLength2D();if(0===t)continue;const s=e.calculateWeightedCentroid2D().sub(n.mul(t));i.add(s.x),r.add(s.y)}const a=n.mul(e.calculatePathLength2D(s));if(i.add(a.x),r.add(a.y),-1!==t)break}const a=new s.Point2D;return a.setCoords(i.getResult(),r.getResult()),a.mul(1/n)}e.calculateCentroid2D=function(e,i){if(!e.isEmpty())switch(e.getGeometryType()){case t.GeometryType.enumPolygon:return n(e);case t.GeometryType.enumPolyline:return a(e.getImpl());case t.GeometryType.enumLine:case t.GeometryType.enumBezier:case t.GeometryType.enumEllipticArc:return function(e){const t=e.calculateLength2D();return 0===t?e.getStartXY():e.calculateWeightedCentroid2D().mul(1/t)}(e);case t.GeometryType.enumMultiPoint:return function(e){const t=new s.KahanSummator(0),n=new s.KahanSummator(0),i=e.getImpl(),r=i.getAttributeStreamRef(0),o=i.getPointCount(),a=new s.Point2D;for(let e=0;e<o;e++)r.queryPoint2D(2*e,a),t.add(a.x),n.add(a.y);const m=new s.Point2D;return m.setCoords(t.getResult(),n.getResult()),m.divThis(o)}(e);case t.GeometryType.enumEnvelope:return e.getCenterXY();case t.GeometryType.enumPoint:return e.getXY();default:return s.Point2D.construct(Number.NaN,Number.NaN)}return s.Point2D.construct(Number.NaN,Number.NaN)},e.calculatePolygonCentroid2D=function(e,t){return n(e,t)}})},"esri/chunks/clipOperator":function(){define(["exports","../geometry/operators/gx/operatorClip","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";function n(e,n){const i=s.getSpatialReference(e),r=s.fromExtent(n).asEnvelope2D();return s.toGeometry(t.execute(s.fromGeometry(e),r,s.fromSpatialReference(i)),i)}function i(e,n){const i=e.map(s.fromGeometry),r=s.getSpatialReference(e),o=s.fromExtent(n).asEnvelope2D();return t.executeMany(i,o,s.fromSpatialReference(r)).map(e=>s.toGeometry(e,r))}const r=t.supportsCurves(),o=Object.freeze(Object.defineProperty({__proto__:null,execute:n,executeMany:i,supportsCurves:r},Symbol.toStringTag,{value:"Module"}));e.clipOperator=o,e.execute=n,e.executeMany=i,e.supportsCurves=r})},"esri/geometry/operators/gx/operatorClip":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/OperatorClip"],function(e,t,s){"use strict";const n=new s.OperatorClip;e.execute=function(e,t,s){return n.execute(e,t,s,null)},e.executeMany=function(e,s,i){const r=n.executeMany(new t.SimpleGeometryCursor(e),s,i,null);return Array.from(r)},e.supportsCurves=function(){return n.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/containsOperator":function(){define(["exports","./ProjectionTransformation","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";const n=new t.OperatorContains;function i(e){const t=s.getSpatialReference(e);return n.accelerateGeometry(s.fromGeometry(e),s.fromSpatialReference(t),1)}function r(e,t){return n.execute(s.fromGeometry(e),s.fromGeometry(t),s.fromSpatialReference(e.spatialReference),null)}const o=n.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:i,execute:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=i,e.containsOperator=a,e.execute=r,e.supportsCurves=o})},"esri/chunks/convexHullOperator":function(){define(["exports","../geometry/operators/gx/operatorConvexHull","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";function n(e){const n=s.getSpatialReference(e);return s.toGeometry(t.execute(s.fromGeometry(e)),n)}function i(e,n={}){const{merge:i=!1}=n,r=e.map(s.fromGeometry),o=s.getSpatialReference(e);return t.executeMany(r,i).map(e=>s.toGeometry(e,o))}function r(e){return t.isConvex(s.fromGeometry(e))}const o=t.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,execute:n,executeMany:i,isConvex:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.convexHullOperator=a,e.execute=n,e.executeMany=i,e.isConvex=r,e.supportsCurves=o})},"esri/geometry/operators/gx/operatorConvexHull":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/Envelope","../../../chunks/MultiPathImpl","../../../chunks/Envelope2D"],function(e,t,s,n,i,r){"use strict";class o extends t.GeometryCursor{constructor(e,t,n){super(),t||s.throwInvalidArgumentException(""),this.m_progressTracker=n,this.m_index=-1,this.m_bMerge=e,this.m_bDone=!1,this.m_inputGeometryCursor=t}getGeometryID(){return this.m_index}tock(){return!0}getRank(){return 1}next(){if(this.m_bMerge){if(!this.m_bDone){const e=a(this.m_inputGeometryCursor);return this.m_bDone=!0,e}return null}if(!this.m_bDone){const e=this.m_inputGeometryCursor.next();if(null!==e)return s.throwIfCurves(e),s.throwIfMesh(e),this.m_index=this.m_inputGeometryCursor.getGeometryID(),m(e);this.m_bDone=!0}return null}}function a(e,t){const n=new i.ConvexHull;let r;for(;r=e.next();)s.throwIfCurves(r),s.throwIfMesh(r),n.addGeometry(r);return n.getBoundingGeometry()}function m(e,t){if(s.throwIfMesh(e),e.isEmpty())return e.createInstance();const o=e.getGeometryType();if(s.isSegment(o)){const t=e;if(t.isDegenerate(0)){const e=new n.Point;return t.queryStart(e),e}if(t.getGeometryType()===s.GeometryType.enumLine){const s=new n.Point,r=new i.Polyline({vd:e.getDescription()});return t.queryStart(s),r.startPathPoint(s),t.queryEnd(s),r.lineToPoint(s),r}{const s=new i.Polyline({vd:e.getDescription()});return s.addSegment(t,!0),m(s)}}if(o===s.GeometryType.enumEnvelope){const t=e,s=new r.Envelope2D;if(t.queryEnvelope(s),s.xmin===s.xmax&&s.ymin===s.ymax){const e=new n.Point;return t.queryCornerByVal(0,e),e}if(s.xmin===s.xmax||s.ymin===s.ymax){const s=new n.Point,r=new i.Polyline({vd:e.getDescription()});return t.queryCornerByVal(0,s),r.startPathPoint(s),t.queryCornerByVal(1,s),r.lineToPoint(s),r}{const s=new i.Polygon({vd:e.getDescription()});return s.addEnvelope(t,!1),s}}if(o===s.GeometryType.enumGeometryCollection)return a(i.generateGeometryCursor(e,-1));if(h(e)){if(o===s.GeometryType.enumMultiPoint){const t=e,s=new n.Point;return t.getPointByVal(0,s),s}return e}return s.geometryReleaseAssert(s.isMultiVertex(o)),i.construct(e)}function h(e,t){if(s.throwIfMesh(e),e.isEmpty())return!0;const n=e.getGeometryType();if(n===s.GeometryType.enumPoint)return!0;if(n===s.GeometryType.enumEnvelope){const t=e;return t.getXMin()!==t.getXMax()&&t.getYMin()!==t.getYMax()}if(s.isSegment(n)){const t=e;if(t.isDegenerate(0))return!1;if(n===s.GeometryType.enumLine)return!0;const r=new i.Polyline;return r.addSegment(t,!0),h(r)}if(n===s.GeometryType.enumMultiPoint)return 1===e.getPointCount();if(n===s.GeometryType.enumPolyline){const t=e;return!t.hasNonLinearSegments()&&1===t.getPathCount()&&2===t.getPointCount()&&!t.getXY(0).equals(t.getXY(1))}if(n===s.GeometryType.enumGeometryCollection){const t=e;return 1===t.getGeometryCount()&&h(t.getGeometry(0))}const r=e;return!(1!==r.getPathCount()||r.getPointCount()<3)&&i.isPathConvex(r,0)}const l=new class{getOperatorType(){return 10102}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s){return new o(t,e,s)}execute(e,t){return m(e)}isConvex(e,t){if(s.throwIfMesh(e),e.isEmpty())return!0;const n=e.getGeometryType();if(n===s.GeometryType.enumPoint)return!0;if(n===s.GeometryType.enumEnvelope){const t=e;return t.getXMin()!==t.getXMax()&&t.getYMin()!==t.getYMax()}if(s.isSegment(n)){const t=e;return!t.getStartXY().equals(t.getEndXY())}if(n===s.GeometryType.enumMultiPoint)return 1===e.getPointCount();if(n===s.GeometryType.enumPolyline){const t=e;return 1===t.getPathCount()&&2===t.getPointCount()&&!t.getXY(0).equals(t.getXY(1))}if(n===s.GeometryType.enumGeometryCollection){const s=e;return 1===s.getGeometryCount()&&this.isConvex(s.getGeometry(0),t)}const r=e;return!(1!==r.getPathCount()||r.getPointCount()<3)&&i.isPathConvex(r,0)}constructOrientedMinimumBoundingBox(e,t,s,n,r){i.constructOrientedMinimumBoundingBox(e,t,s,n,r)}};e.constructOrientedMinimumBoundingBox=function(e,t,s,n,i){return l.constructOrientedMinimumBoundingBox(e,t,s,n,i)},e.execute=function(e){return l.execute(e,null)},e.executeMany=function(e,s){const n=l.executeMany(new t.SimpleGeometryCursor(e),s,null);return Array.from(n)},e.isConvex=function(e){return l.isConvex(e,null)},e.supportsCurves=function(){return l.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/crossesOperator":function(){define(["exports","./OperatorCrosses","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";const n=new t.OperatorCrosses;function i(e){const t=s.getSpatialReference(e);return n.accelerateGeometry(s.fromGeometry(e),s.fromSpatialReference(t),1)}function r(e,t){return n.execute(s.fromGeometry(e),s.fromGeometry(t),s.fromSpatialReference(e.spatialReference),null)}const o=n.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:i,execute:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=i,e.crossesOperator=a,e.execute=r,e.supportsCurves=o})},"esri/chunks/OperatorCrosses":function(){define(["exports","./ProjectionTransformation"],function(e,t){"use strict";class s extends t.OperatorSimpleRelation{getOperatorType(){return 6}execute(e,s,n,i){return t.relate(e,s,n,16,i)}}e.OperatorCrosses=s})},"esri/chunks/cutOperator":function(){define(["exports","../core/arrayUtils","../geometry/operators/gx/operatorCut","../geometry/operators/support/apiConverter"],function(e,t,s,n){"use strict";function i(e,i){const r=n.getSpatialReference(e);return s.execute(n.fromGeometry(e),n.fromPolyline(i),n.fromSpatialReference(r)).map(e=>n.toGeometry(e,r)).filter(t.isSome)}const r=s.supportsCurves(),o=Object.freeze(Object.defineProperty({__proto__:null,execute:i,supportsCurves:r},Symbol.toStringTag,{value:"Module"}));e.cutOperator=o,e.execute=i,e.supportsCurves=r})},"esri/geometry/operators/gx/operatorCut":function(){define(["exports","../../../chunks/OperatorCut"],function(e,t){"use strict";const s=new t.OperatorCut;e.execute=function(e,t,n){const i=s.execute(!0,e,t,n,null);return Array.from(i)},e.supportsCurves=function(){return s.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OperatorCut":function(){define(["exports","./SimpleGeometryCursor","./Geometry","./MultiPathImpl","./Envelope","./ProjectionTransformation"],function(e,t,s,n,i,r){"use strict";var o=r.CurveStitcher;function a(e,t){return{m_geometry:e,m_side:t}}class m extends t.GeometryCursor{constructor(e,t,s,r,o){super(),this.m_cutIndex=-1,this.m_cuts=[],this.m_progressTracker=o,this.m_cuttee=t.clone(),this.m_cutter=new n.Polyline({copy:s}),this.m_bConsiderTouch=e;const a=i.getMergedExtent(t,s);this.m_tolerance=i.calculateToleranceFromGeometryForOp(r,a,!0)}next(){return-1===this.m_cutIndex&&this.generateCuts(),++this.m_cutIndex<this.m_cuts.length?this.m_cuts[this.m_cutIndex]:null}getGeometryID(){return this.m_cutIndex}tock(){return!0}getRank(){return 1}generateCuts(){switch(this.m_cuttee.getGeometryType()){case s.GeometryType.enumPolyline:this.generatePolylineCuts();break;case s.GeometryType.enumPolygon:this.generatePolygonCuts()}}generatePolylineCuts(){const e=new n.Polyline,t=new n.Polyline,i=new n.Polyline;this.m_cuts.length=0,this.m_cuts.push(e),this.m_cuts.push(t);const m=[];!function(e,t,s,i,m,h){if(t.isEmpty()){const e=a(t,0);return void m.push(e)}if(s.isEmpty()){const e=a(t,0);return void m.push(e)}const l=[],u=new n.EditShape;{const n=u.createGeometryUserIndex(),c=u.addGeometry(t),g=u.addGeometry(s),d=new r.TopologicalOperations(h);let p=0,_=null;if(u.hasCurves()){_=new o;const e=u.getEnvelope2D(h);p=r.stitchingDensificationDeviationFromTolerance(i.total());const t=r.densificationDeviationFromTolerance(i.total(),e);r.buildSegmentParentage(u,t,i.total(),12e3,_,null,h)}u.dbgVerifyCurves(),d.setEditShapeCrackAndCluster(u,i),d.cut(e,n,c,g,l);for(const e of l){null!==_&&_.stitchCurves(u,e,p,!1);const t=a(u.getGeometry(e),r.s_IntToPublicCutSide(u.getGeometryUserIndex(e,n)));m.push(t)}null!==_&&_.clearStitcher(u)}}(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,m,this.m_progressTracker);for(let n=0;n<m.length;n++){const r=m[n];1===r.m_side?e.add(r.m_geometry,!1):2===r.m_side||4===r.m_side?t.add(r.m_geometry,!1):3===r.m_side?this.m_cuts.push(r.m_geometry):0===r.m_side?i.add(r.m_geometry,!1):s.throwInternalErrorException("")}i.isEmpty()||e.isEmpty()&&t.isEmpty()&&!(this.m_cuts.length>=3)||this.m_cuts.push(i),e.isEmpty()&&t.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}generatePolygonCuts(){const e=new n.Polygon,t=new n.Polygon,i=new n.Polygon;this.m_cuts.length=0,this.m_cuts.push(e),this.m_cuts.push(t);const m=[];!function(e,t,s,i,m,h){if(t.isEmpty()){const e=a(t,0);return void m.push(e)}if(s.isEmpty()){const e=a(t,0);return void m.push(e)}const l=[],u=new n.EditShape;{const e=u.createGeometryUserIndex(),c=u.addGeometry(t),g=u.addGeometry(s),d=new r.TopologicalOperations(h);let p=0,_=null;if(u.hasCurves()){_=new o;const e=u.getEnvelope2D(h);p=r.stitchingDensificationDeviationFromTolerance(i.total());const t=r.densificationDeviationFromTolerance(i.total(),e);r.buildSegmentParentage(u,t,i.total(),12e3,_,null,h)}u.dbgVerifyCurves(),d.setEditShapeCrackAndCluster(u,i),d.cut(!1,e,c,g,l),null!==_&&_.stitchCurves(u,n.nullHandle,p,!0);let f=u.getGeometry(c);const y=new n.Polygon,x=new n.Polygon,P=[];for(let t=0;t<l.length;t++){let s=null;{const o=new n.EditShape,a=o.addGeometry(f),m=o.addGeometry(u.getGeometry(l[t]));if(o.hasCurves()){const e=o.getEnvelope2D(h);p=r.stitchingDensificationDeviationFromTolerance(i.total());const t=r.densificationDeviationFromTolerance(i.total(),e);r.buildSegmentParentage(o,t,i.total(),12e3,_,null,h)}d.setEditShapeCrackAndCluster(o,i);const c=d.intersection(a,m);if(null!==_&&_.stitchCurves(o,n.nullHandle,p,!0),s=o.getGeometry(c),s.isEmpty())continue;const g=u.getGeometryUserIndex(l[t],e);2===g?y.add(s,!1):1===g?x.add(s,!1):P.push(s)}{const e=new n.EditShape,s=e.addGeometry(f),o=e.addGeometry(u.getGeometry(l[t]));if(e.hasCurves()){const t=e.getEnvelope2D(h);p=r.stitchingDensificationDeviationFromTolerance(i.total());const s=r.densificationDeviationFromTolerance(i.total(),t);r.buildSegmentParentage(e,s,i.total(),12e3,_,null,h)}d.setEditShapeCrackAndCluster(e,i);const a=d.difference(s,o);null!==_&&_.stitchCurves(e,n.nullHandle,p,!0),f=e.getGeometry(a)}}if(!f.isEmpty()&&l.length>0&&P.push(f),y.isEmpty()&&x.isEmpty())return;if(!y.isEmpty()){const e=a(y,1);m.push(e)}if(!x.isEmpty()){const e=a(x,2);m.push(e)}for(let e=0,t=P.length;e<t;++e){const t=a(P[e],3);m.push(t)}}}(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,m,this.m_progressTracker);for(let n=0;n<m.length;n++){const r=m[n];1===r.m_side?e.add(r.m_geometry,!1):2===r.m_side?t.add(r.m_geometry,!1):3===r.m_side?this.m_cuts.push(r.m_geometry):0===r.m_side?i.add(r.m_geometry,!1):s.throwInternalErrorException("")}s.geometryReleaseAssert(i.isEmpty()||1===m.length),e.isEmpty()&&t.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}}e.OperatorCut=class{getOperatorType(){return 10005}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,s,n,i){return new m(e,t,s,n,i)}}})},"esri/chunks/densifyOperator":function(){define(["exports","../core/arrayUtils","../core/mathUtils","../core/unitUtils","../geometry/operators/gx/operatorDensify","../geometry/operators/support/apiConverter"],function(e,t,s,n,i,r){"use strict";function o(e,t,o={}){let{maxAngleInDegrees:a=0,maxDeviation:m=0,unit:h}=o;const l=r.getSpatialReference(e);return h&&(t=n.convertToSpatialReferenceUnit(t,h,l),m&&(m=n.convertToSpatialReferenceUnit(m,h,l))),r.toGeometry(i.execute(r.fromGeometry(e),t,m,s.deg2rad(a)),l)}function a(e,o,a={}){let{maxAngleInDegrees:m=0,maxDeviation:h=0,unit:l}=a;const u=e.map(r.fromGeometry),c=r.getSpatialReference(e);return l&&(o=n.convertToSpatialReferenceUnit(o,l,c),h&&(h=n.convertToSpatialReferenceUnit(h,l,c))),i.executeMany(u,o,h,s.deg2rad(m)).map(e=>r.toGeometry(e,c)).filter(t.isSome)}const m=i.supportsCurves(),h=Object.freeze(Object.defineProperty({__proto__:null,execute:o,executeMany:a,supportsCurves:m},Symbol.toStringTag,{value:"Module"}));e.densifyOperator=h,e.execute=o,e.executeMany=a,e.supportsCurves=m})},"esri/geometry/operators/gx/operatorDensify":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/OperatorDensify"],function(e,t,s){"use strict";const n=new s.OperatorDensify;e.execute=function(e,t,s,i){return n.execute(e,t,s,i,null)},e.executeMany=function(e,s,i,r){const o=n.executeMany(new t.SimpleGeometryCursor(e),s,i,r,null);return Array.from(o)},e.supportsCurves=function(){return n.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/differenceOperator":function(){define(["exports","../geometry/operators/gx/operatorDifference","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";function n(e,n){const i=s.getSpatialReference(e);return s.toGeometry(t.execute(s.fromGeometry(e),s.fromGeometry(n),s.fromSpatialReference(i)),i)}function i(e,n){const i=e.map(s.fromGeometry),r=s.getSpatialReference(e);return t.executeMany(i,s.fromGeometry(n),s.fromSpatialReference(r)).map(e=>s.toGeometry(e,r))}const r=t.supportsCurves(),o=Object.freeze(Object.defineProperty({__proto__:null,execute:n,executeMany:i,supportsCurves:r},Symbol.toStringTag,{value:"Module"}));e.differenceOperator=o,e.execute=n,e.executeMany=i,e.supportsCurves=r})},"esri/geometry/operators/gx/operatorDifference":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/ProjectionTransformation","../../../chunks/Point2D","../../../chunks/MultiPathImpl","../../../chunks/Envelope2D","../../../chunks/Envelope"],function(e,t,s,n,i,r,o,a){"use strict";const m=new n.OperatorDifference;e.execute=function(e,t,s){return m.execute(e,t,s,null)},e.executeMany=function(e,s,n){const i=m.executeMany(new t.SimpleGeometryCursor(e),new t.SimpleGeometryCursor([s]),n,null);return Array.from(i)},e.supportsCurves=function(){return m.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/disjointOperator":function(){define(["exports","./ProjectionTransformation","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";const n=new t.OperatorDisjoint;function i(e){const t=s.getSpatialReference(e);return n.accelerateGeometry(s.fromGeometry(e),s.fromSpatialReference(t),1)}function r(e,t){return n.execute(s.fromGeometry(e),s.fromGeometry(t),s.fromSpatialReference(e.spatialReference))}const o=n.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:i,execute:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=i,e.disjointOperator=a,e.execute=r,e.supportsCurves=o})},"esri/chunks/distanceOperator":function(){define(["exports","./Geometry","./Distance2DCalculator-CXhBP-8I","../core/unitUtils","../geometry/operators/support/apiConverter"],function(e,t,s,n,i){"use strict";const r=new class{getOperatorType(){return 10100}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}execute(e,t,s){return this.executeEx(e,t,s,null,null,Number.NaN)}executeEx(e,n,i,r,o,a){if(e.isEmpty()||n.isEmpty())return Number.NaN;t.throwIfMesh(e),t.throwIfMesh(n);const m=e,h=n;Number.isNaN(a)&&(a=Number.POSITIVE_INFINITY);const l=new s.DistanceCalculator(a,i).calculate(m,h,r,o);return Number.isFinite(l)?l:Number.NaN}};function o(e,t,s={}){const{unit:o}=s;let a=r.execute(i.fromGeometry(e),i.fromGeometry(t),null);if(a&&o){const t=i.getSpatialReference(e);a=n.convertFromSpatialReferenceUnit(a,t,o)}return a}const a=r.supportsCurves(),m=Object.freeze(Object.defineProperty({__proto__:null,execute:o,supportsCurves:a},Symbol.toStringTag,{value:"Module"}));e.distanceOperator=m,e.execute=o,e.supportsCurves=a})},"esri/chunks/Distance2DCalculator-CXhBP-8I":function(){define(["exports","./tslib.es6","./Geometry","./MultiPathImpl","./ProjectionTransformation","./Point2D","./Envelope2D","./Envelope"],function(e,t,s,n,i,r,o,a){"use strict";function m(){return{outPoint:new r.Point2D,index:-1,t:Number.NaN}}function h(e,t,s){return{outPoint:e.clone(),index:t,t:s}}function l(e,t,s,n){e.outPoint.assign(t),e.index=s,e.t=n}function u(e,t){e.outPoint.assign(t.outPoint),e.index=t.index,e.t=t.t}function c(e,t,s,n){e.index=s,e.t=n,t.queryCoord2D(e.t,e.outPoint)}function g(e,t){const s=m();u(s,e),u(e,t),u(t,s)}function d(e,t,n,r,o,a){if(e.getGeometryType()===s.GeometryType.enumPolygon){for(;r.nextPath();)if(r.hasNextSegment()){const t=r.nextSegment();if(0!==i.isPoint2DInPolygon2D(e,t.getEndXY(),0))return l(o,t.getEndXY(),-1,Number.NaN),l(a,t.getEndXY(),-1,Number.NaN),!0}r.resetToFirstPath()}if(t.getGeometryType()===s.GeometryType.enumPolygon){for(;n.nextPath();)if(n.hasNextSegment()){const e=n.nextSegment();if(0!==i.isPoint2DInPolygon2D(t,e.getEndXY(),0))return l(o,e.getEndXY(),-1,Number.NaN),l(a,e.getEndXY(),-1,Number.NaN),!0}n.resetToFirstPath()}return!1}function p(e){const t=e.getPathCount(),s=r.makePrimitiveArray(e.getSegmentCount(),0);let i=0;for(let n=0;n<t;++n){const t=i+e.getSegmentCountPath(n);for(let r=i,o=e.getPathStart(n);r<t;++r,++o)s[r]=o;i=t}return n.shuffle(e.getPointCount(),s),s}function _(e,t){return!!Number.isNaN(t)||e<=t}function f(e){const t=new n.Polygon;return t.addEnvelope(e,!1),t}e.DistanceCalculator=class{constructor(e,t){if(this.m_env2DgeometryA=null,this.m_env2DgeometryB=null,this.m_progressCounter=0,this.m_progressTracker=t,this.m_maxSqrDistance=e*e,this.m_maxDistance=e,this.m_bIsNearCalc=!1,Number.isNaN(this.m_maxDistance)?this.m_maxDistance=Number.POSITIVE_INFINITY:this.m_maxDistance=e,this.m_maxSqrDistance=this.m_maxDistance*this.m_maxDistance,Number.isFinite(this.m_maxSqrDistance)){let e=Math.sqrt(this.m_maxSqrDistance);for(;e<this.m_maxDistance;)this.m_maxSqrDistance*=1+Number.EPSILON,e=Math.sqrt(this.m_maxSqrDistance)}}calculate(e,t,s,n){if((e.getGeometryType()!==a.Point.type||t.getGeometryType()!==a.Point.type)&&(this.m_env2DgeometryA=new o.Envelope2D,this.m_env2DgeometryB=new o.Envelope2D,e.queryEnvelope(this.m_env2DgeometryA),t.queryEnvelope(this.m_env2DgeometryB),!_(this.m_env2DgeometryA.distanceFromEnvelope(this.m_env2DgeometryB),this.m_maxDistance)))return Number.POSITIVE_INFINITY;const i=h(new r.Point2D,r.indexTypeMax(),Number.NaN),m=h(new r.Point2D,r.indexTypeMax(),Number.NaN),l=this._ExecuteBruteForce(e,t,i,m);return _(l,this.m_maxDistance)?(null!==s&&u(s,i),null!==n&&u(n,m),l):Number.POSITIVE_INFINITY}isNear(e,t){if(this.m_bIsNearCalc=!0,e.isEmpty()||t.isEmpty())return!1;if(e===t)return!0;let s=!0;if(e.getGeometryType()!==a.Point.type&&e.getGeometryType()!==a.Envelope.type||t.getGeometryType()!==a.Point.type&&t.getGeometryType()!==a.Envelope.type||(s=!1),s){if(this.m_env2DgeometryA=new o.Envelope2D,this.m_env2DgeometryB=new o.Envelope2D,e.queryEnvelope(this.m_env2DgeometryA),t.queryEnvelope(this.m_env2DgeometryB),!(this.m_env2DgeometryA.sqrMaxMinDistanceEnvelope(this.m_env2DgeometryB)>this.m_maxSqrDistance))return!0;if(this.m_env2DgeometryA.sqrDistanceEnvelope(this.m_env2DgeometryB,null,null)>this.m_maxSqrDistance)return!1}const n=h(new r.Point2D,r.indexTypeMax(),Number.NaN),i=h(new r.Point2D,r.indexTypeMax(),Number.NaN);return this._ExecuteBruteForce(e,t,n,i)<=this.m_maxDistance}progress_(e=!1){}_ExecuteBruteForce(e,t,n,i){switch(e.getGeometryType()){case s.GeometryType.enumPoint:return this.distancePointGeometry(e,t,n,i);case s.GeometryType.enumMultiPoint:return this.distanceMultipointGeometry(e,t,n,i);case s.GeometryType.enumEnvelope:return this.distanceEnvelopeGeometry(e,t,n,i);case s.GeometryType.enumPolyline:case s.GeometryType.enumPolygon:return this.distanceMultipathGeometry(e,t,n,i);default:return Number.NaN}}distancePointGeometry(e,t,n,i){switch(t.getGeometryType()){case s.GeometryType.enumPoint:return this.distancePointPoint(e,t,n,i);case s.GeometryType.enumMultiPoint:return this.distancePointMultipoint(e,t,n,i);case s.GeometryType.enumPolyline:case s.GeometryType.enumPolygon:return this.distancePointMultipath(e,t,n,i);case s.GeometryType.enumEnvelope:return this.distancePointEnvelope(e,t,n,i);default:return Number.NaN}}distancePointPoint(e,t,s,n){const i=e.getXY(),o=t.getXY();return l(s,i,0,0),l(n,o,0,0),Math.sqrt(r.Point2D.sqrDistance(i,o))}distancePointMultipoint(e,t,s,n){const i=e.getXY();let o=this.m_maxSqrDistance,a=o,m=!1;const h=t.getPointCount(),u=new r.Point2D;for(let e=0;e<h;++e)if(t.queryXY(e,u),a=r.Point2D.sqrDistance(i,u),this.m_bIsNearCalc){if(a<=o)return 0}else if(!(a>o)&&(!m&&a===o||a<o)&&(o=a,l(s,i,0,0),l(n,u,e,0),m=!0,0===o))return 0;return m?Math.sqrt(o):Number.POSITIVE_INFINITY}distancePointMultipath(e,t,n,a){const m=!this.m_env2DgeometryA.isIntersecting(this.m_env2DgeometryB),h=e.getXY();if(!m&&t.getGeometryType()===s.GeometryType.enumPolygon&&0!==i.isPoint2DInPolygon2D(t,h,0))return l(n,h,0,0),l(a,h,-1,Number.NaN),0;t.getImpl().getAccelerators();let u=this.m_maxSqrDistance,c=u,g=-1;const d=new o.Envelope2D,p=t.querySegmentIterator();let _=!1;for(;p.nextPath();)for(;p.hasNextSegment();){const e=p.nextSegment();e.queryEnvelope(d);const t=d.sqrDistance(h);if(t>u)continue;if(!this.m_bIsNearCalc&&_&&t===u)continue;g=e.getClosestCoordinate(h,!1);const s=e.getCoord2D(g);if(c=r.Point2D.sqrDistance(h,s),this.m_bIsNearCalc){if(c<=u)return 0}else if(!(c>u)&&(!_||c<u)&&(u=c,l(n,h,0,0),l(a,s,p.getStartPointIndex(),g),_=!0,0===u))return 0}return _?Math.sqrt(u):Number.POSITIVE_INFINITY}distancePointEnvelope(e,t,s,n){const i=e.getXY();l(s,i,0,0),l(n,i,-1,Number.NaN);const r=t.asEnvelope2D();return r.contains(i)?0:Math.sqrt(r.sqrDistance(i,n.outPoint))}distanceMultipointGeometry(e,t,n,i){switch(t.getGeometryType()){case s.GeometryType.enumPoint:{this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB);const s=this.distancePointMultipoint(t,e,i,n);return this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),s}case s.GeometryType.enumMultiPoint:return this.distanceMultipointMultipoint(e,t,n,i,1,1);case s.GeometryType.enumPolyline:case s.GeometryType.enumPolygon:return this.distanceMultipointMultipath(e,t,n,i);case s.GeometryType.enumEnvelope:return this.distanceMultipointMultipath(e,f(t),n,i);default:return Number.NaN}}distanceMultipointMultipoint(e,s,n,i,o,a){const m={stack:[],error:void 0,hasError:!1};try{if(this.m_bIsNearCalc&&1===o&&1===a){const t=Math.trunc(r.snap(Math.sqrt(e.getPointCount())+1,1,r.intMax())),o=Math.trunc(r.snap(Math.sqrt(s.getPointCount())+1,1,r.intMax()));if((t>=4||o>=4)&&this.distanceMultipointMultipoint(e,s,n,i,t,o)<=this.m_maxSqrDistance)return 0}let h=this.m_maxSqrDistance;const u=[e],c=[s],d=this.swapGeometriesIfBGtA(u,c);d&&(this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),a=r.swap(o,o=a),g(n,i)),t.__addDisposableResource(m,r.makeScopedCall(()=>{g(n,i),this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB)},!d),!1);const p=u[0].getImpl(),_=c[0].getImpl(),f=p.getPointCount(),y=_.getPointCount(),x=y>1;let P=!1;const E=new r.Point2D,v=new r.Point2D;for(let e=0;e<f;e+=o){if(p.queryXY(e,E),x){const e=this.m_env2DgeometryB.sqrDistance(E);if(this.m_bIsNearCalc){if(e>h)continue;if(this.m_env2DgeometryB.sqrMaxMinDistance(E)<=h)return 0}else if(e>=h)continue}for(let t=0;t<y;t+=a){_.queryXY(t,v);const s=r.Point2D.sqrDistance(E,v);if(this.m_bIsNearCalc){if(s<=h)return 0}else if(!(s>h||P&&s===h)&&(!P||s<h)&&(l(n,E,e,0),l(i,v,t,0),P=!0,h=s,0===h))return P?Math.sqrt(h):Number.POSITIVE_INFINITY}}return P?Math.sqrt(h):Number.POSITIVE_INFINITY}catch(e){m.error=e,m.hasError=!0}finally{t.__disposeResources(m)}}distanceMultipointMultipath(e,t,n,a){let m=!!this.m_env2DgeometryA.isIntersecting(this.m_env2DgeometryB)&&t.getGeometryType()===s.GeometryType.enumPolygon;const h=t.querySegmentIterator();h.stripAttributes();const u=new o.Envelope2D,c=new r.Point2D;let g=this.m_maxSqrDistance;const d=e.getImpl(),p=d.getPointCount(),_=p>1;let f=!1;for(;h.nextPath();)for(;h.hasNextSegment();){const e=h.nextSegment();if(e.queryLooseEnvelope(u),_){const e=u.sqrDistanceEnvelope(this.m_env2DgeometryA,null,null);if(this.m_bIsNearCalc){if(e>g)continue}else if(e>g||f&&e===g)continue}for(let s=0;s<p;s++){if(d.queryXY(s,c),m&&0!==i.isPoint2DInPolygon2D(t,c,0))return l(n,c,-1,Number.NaN),l(a,c,s,0),0;{const e=u.sqrDistance(c);if(this.m_bIsNearCalc){if(e>g)continue}else if(e>g)continue}const r=e.getClosestCoordinate(c,!1),o=e.getCoord2D(r);c.subThis(o);const p=c.sqrLength();if(this.m_bIsNearCalc){if(p<=g)return 0}else if(!(p>g)&&(!f||p<g)&&(g=p,l(n,d.getXY(s),s,0),l(a,o,h.getStartPointIndex(),r),f=!0,0===g))return 0}m=!1}return f?Math.sqrt(g):Number.POSITIVE_INFINITY}distanceEnvelopeGeometry(e,t,n,i){switch(t.getGeometryType()){case s.GeometryType.enumPoint:return this.distancePointEnvelope(t,e,i,n);case s.GeometryType.enumMultiPoint:{this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB);const s=this.distanceMultipointMultipath(t,f(e),i,n);return this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),s}case s.GeometryType.enumPolyline:case s.GeometryType.enumPolygon:return this.distanceMultipathMultipath(f(e),t,n,i);case s.GeometryType.enumEnvelope:return this.distanceEnvelopeEnvelope(e,t,n,i);default:return Number.NaN}}distanceEnvelopeEnvelope(e,t,s,n){s.t=Number.NaN,s.index=-1,n.t=Number.NaN,n.index=-1;const i=e.asEnvelope2D(),r=t.asEnvelope2D();return Math.sqrt(i.sqrDistanceEnvelope(r,s.outPoint,n.outPoint))}distanceMultipathGeometry(e,t,n,i){switch(t.getGeometryType()){case s.GeometryType.enumPoint:{this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB);const s=this.distancePointMultipath(t,e,i,n);return this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),s}case s.GeometryType.enumMultiPoint:{this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB);const s=this.distanceMultipointMultipath(t,e,i,n);return this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),s}case s.GeometryType.enumPolyline:case s.GeometryType.enumPolygon:return this.distanceMultipathMultipath(e,t,n,i);case s.GeometryType.enumEnvelope:return this.distanceMultipathMultipath(e,f(t),n,i);default:return Number.NaN}}distanceMultipathMultipath(e,s,i,a){const h={stack:[],error:void 0,hasError:!1};try{const l=[e],_=[s],f=this.swapGeometriesIfAGtB(l,_);f&&(this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB),g(i,a)),t.__addDisposableResource(h,r.makeScopedCall(()=>{g(i,a),this.m_env2DgeometryB=r.swap(this.m_env2DgeometryA,this.m_env2DgeometryA=this.m_env2DgeometryB)},!f),!1);const y=l[0],x=_[0],P=y.querySegmentIterator();P.stripAttributes();const E=x.querySegmentIterator();if(E.stripAttributes(),this.m_bIsNearCalc&&this.m_env2DgeometryA.sqrMaxMinDistanceEnvelope(this.m_env2DgeometryB)<=this.m_maxSqrDistance)return 0;if(this.m_bIsNearCalc){const e=Math.trunc(r.snap(Math.sqrt(y.getPointCount())+1,1,r.intMax())),t=Math.trunc(r.snap(Math.sqrt(y.getPointCount())+1,1,r.intMax()));if(this.distanceMultipointMultipoint(y,x,i,a,e,t)<=this.m_maxSqrDistance)return 0}if(this.m_env2DgeometryA.isIntersecting(this.m_env2DgeometryB)){const e=m(),t=m();if(d(y,x,P,E,e,t))return u(i,e),u(a,t),0}const v=p(y),C=[],D=new n.SegmentBuffer,b=new o.Envelope2D,S=new o.Envelope2D,I=new o.Envelope2D;let w=this.m_maxSqrDistance,T=!0,A=!1;for(let e=0,t=v.length;e<t;++e){y.querySegment(v[e],D,!0);const t=D.get();if(t.queryEnvelope(b),!(b.sqrDistanceEnvelope(this.m_env2DgeometryB,null,null)>w)){if(this.m_bIsNearCalc&&b.sqrMaxDistanceEnvelope(this.m_env2DgeometryB)<=w)return 0;for(;E.nextPath();){if(this.progress_(),T)x.queryPathEnvelope(E.getPathIndex(),I),C[E.getPathIndex()]=I.clone();else if(b.sqrDistanceEnvelope(C[E.getPathIndex()],null,null)>w)continue;for(;E.hasNextSegment();){const s=E.nextSegment();if(s.queryEnvelope(S),b.sqrDistanceEnvelope(S,null,null)<=w){const n=!b.isIntersecting(S),r=[0],o=[0];let m=t.distance(s,n,r,o);if(m*=m,this.m_bIsNearCalc&&m<=this.m_maxSqrDistance)return 0;if(m<w||m===w&&v[e]<i.index){if(A=!0,c(i,t,v[e],r[0]),c(a,s,E.getStartPointIndex(),o[0]),0===m)return 0;w=m}}}}E.resetToFirstPath(),T=!1}}return A?Math.sqrt(w):Number.POSITIVE_INFINITY}catch(e){h.error=e,h.hasError=!0}finally{t.__disposeResources(h)}}swapGeometriesIfAGtB(e,t){return s.vertexCount(e[0])>s.vertexCount(t[0])&&(t[0]=r.swap(e[0],e[0]=t[0]),!0)}swapGeometriesIfBGtA(e,t){return this.swapGeometriesIfAGtB(t,e)}},e.makeOutput=m,e.shuffleMultipathSegments=p,e.weakIntersectionTest=d})},"esri/chunks/equalsOperator":function(){define(["exports","./ProjectionTransformation","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";class n extends t.OperatorSimpleRelation{getOperatorType(){return 2}execute(e,s,n,i){return t.relate(e,s,n,3,i)}}const i=new n;function r(e){const t=s.getSpatialReference(e);return i.accelerateGeometry(s.fromGeometry(e),s.fromSpatialReference(t),1)}function o(e,t){return i.execute(s.fromGeometry(e),s.fromGeometry(t),s.fromSpatialReference(e.spatialReference),null)}const a=i.supportsCurves(),m=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:r,execute:o,supportsCurves:a},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=r,e.equalsOperator=m,e.execute=o,e.supportsCurves=a})},"esri/chunks/generalizeOperator":function(){define(["exports","../core/arrayUtils","../core/unitUtils","../geometry/operators/gx/operatorGeneralize","../geometry/operators/support/apiConverter"],function(e,t,s,n,i){"use strict";function r(e,t,r={}){const{removeDegenerateParts:o=!1,unit:a}=r,m=i.getSpatialReference(e);return a&&(t=s.convertToSpatialReferenceUnit(t,a,m)),i.toGeometry(n.execute(i.fromGeometry(e),t,o),m)}function o(e,r,o={}){const{removeDegenerateParts:a=!1,unit:m}=o,h=e.map(i.fromGeometry),l=i.getSpatialReference(e);return m&&(r=s.convertToSpatialReferenceUnit(r,m,l)),n.executeMany(h,r,a).map(e=>i.toGeometry(e,l)).filter(t.isSome)}const a=n.supportsCurves(),m=Object.freeze(Object.defineProperty({__proto__:null,execute:r,executeMany:o,supportsCurves:a},Symbol.toStringTag,{value:"Module"}));e.execute=r,e.executeMany=o,e.generalizeOperator=m,e.supportsCurves=a})},"esri/geometry/operators/gx/operatorGeneralize":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/OperatorGeneralize"],function(e,t,s){"use strict";const n=new s.OperatorGeneralize;e.execute=function(e,t,s){return n.execute(e,t,s,null)},e.executeMany=function(e,s,i){const r=n.executeMany(new t.SimpleGeometryCursor(e),s,i,null);return Array.from(r)},e.supportsCurves=function(){return n.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/intersectionOperator":function(){define(["exports","../core/arrayUtils","../geometry/operators/gx/operatorIntersection","../geometry/operators/support/apiConverter"],function(e,t,s,n){"use strict";function i(e){const t=n.getSpatialReference(e);return s.accelerateGeometry(n.fromGeometry(e),n.fromSpatialReference(t))}function r(e,t){const i=n.getSpatialReference(e);return n.toGeometry(s.execute(n.fromGeometry(e),n.fromGeometry(t),n.fromSpatialReference(i)),i)}function o(e,i){const r=e.map(n.fromGeometry),o=n.getSpatialReference(e);return s.executeMany(r,n.fromGeometry(i),n.fromSpatialReference(o),7).map(e=>n.toGeometry(e,o)).filter(t.isSome)}const a=s.supportsCurves(),m=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:i,execute:r,executeMany:o,supportsCurves:a},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=i,e.execute=r,e.executeMany=o,e.intersectionOperator=m,e.supportsCurves=a})},"esri/geometry/operators/gx/operatorIntersection":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/ProjectionTransformation","../../../chunks/MultiPathImpl","../../../chunks/Envelope"],function(e,t,s,n,i,r){"use strict";const o=new n.OperatorIntersection;e.accelerateGeometry=function(e,t){return o.accelerateGeometry(e,t,1)},e.execute=function(e,t,s){return o.execute(e,t,s,null)},e.executeMany=function(e,s,n,i){const r=o.executeMany(new t.SimpleGeometryCursor(e),new t.SimpleGeometryCursor([s]),n,null,i);return Array.from(r)},e.supportsCurves=function(){return o.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/intersectsOperator":function(){define(["exports","./OperatorIntersects","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";const n=new t.OperatorIntersects;function i(e){const t=s.getSpatialReference(e);return n.accelerateGeometry(s.fromGeometry(e),s.fromSpatialReference(t),1)}function r(e,t){return n.execute(s.fromGeometry(e),s.fromGeometry(t),s.fromSpatialReference(e.spatialReference),null)}const o=n.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:i,execute:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=i,e.execute=r,e.intersectsOperator=a,e.supportsCurves=o})},"esri/chunks/OperatorIntersects":function(){define(["exports","./ProjectionTransformation"],function(e,t){"use strict";class s extends t.OperatorSimpleRelation{getOperatorType(){return 4}execute(e,s,n,i){return!t.relate(e,s,n,4,i)}}e.OperatorIntersects=s})},"esri/chunks/labelPointOperator":function(){define(["exports","../geometry/operators/gx/operatorLabelPoint","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";function n(e){return s.toPoint(t.execute(s.fromGeometry(e)),s.getSpatialReference(e))}function i(e){const n=e.map(s.fromGeometry),i=s.getSpatialReference(e);return t.executeMany(n).map(e=>s.toPoint(e,i))}const r=t.supportsCurves(),o=Object.freeze(Object.defineProperty({__proto__:null,execute:n,executeMany:i,supportsCurves:r},Symbol.toStringTag,{value:"Module"}));e.execute=n,e.executeMany=i,e.labelPointOperator=o,e.supportsCurves=r})},"esri/geometry/operators/gx/operatorLabelPoint":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/Envelope","../../../chunks/MultiPathImpl","../../../chunks/Envelope2D","../../../chunks/Point2D","../../../chunks/ProjectionTransformation","../../../chunks/Centroid-DZi-eb9F","../../../chunks/OperatorProximity"],function(e,t,s,n,i,r,o,a,m,h){"use strict";class l extends t.GeometryCursor{progress_(){}tock(){return!0}getRank(){return 1}constructor(e,t){super(),this.m_index=-1,this.m_progressCounter=0,this.m_progressTracker=t,this.m_inputGeoms=e}next(){const e=this.m_inputGeoms.next();return e?(s.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID(),this.labelPoint(e)):null}getGeometryID(){return this.m_index}labelPoint(e){if(null===e&&s.throwInvalidArgumentException("null pointer is not allowed"),e.getGeometryType()===s.GeometryType.enumPoint)return e;if(e.isEmpty())return new n.Point({vd:e.getDescription()});switch(e.getGeometryType()){case s.GeometryType.enumPolygon:return this.labelPointPolygon(e);case s.GeometryType.enumPolyline:return this.labelPointPolyline(e);case s.GeometryType.enumMultiPoint:return this.labelPointMultiPoint(e);case s.GeometryType.enumEnvelope:return this.labelPointEnvelope(e);default:s.throwInvalidArgumentException("geometry is not supported")}}labelPointPolygon(e){const t=new r.Envelope2D;e.queryEnvelope(t);const l=n.calculateToleranceFromGeometryForOp(null,t,!0).total();let u=null,c=e;if(e.hasNonLinearSegments()){const t=new i.Polygon({copy:e}),n=a.processCurves(t,.25*l,l);s.geometryReleaseAssert(n!==e),u=n,c=u}let g=0,d=0;for(let e=0,t=c.getPathCount();e<t;++e){const t=Math.abs(c.calculateRingArea2D(e));t>d&&(d=t,g=e)}const p=new o.Point2D;if(Math.abs(d)<=2*l*l?p.setNAN():p.assign(m.calculatePolygonCentroid2D(c,g)),Number.isNaN(p.x)){const e=new r.Envelope2D;return c.queryPathEnvelope(g,e),new n.Point({pt:e.getCenter()})}if(c.getPointCount()<4)return new n.Point({x:p.x,y:p.y});const _=o.Point2D.getNAN(),f=[_.clone(),_.clone(),_.clone(),_.clone()],y=[Number.NaN,Number.NaN,Number.NaN,Number.NaN],x=[Number.NaN,Number.NaN,Number.NaN,Number.NaN];let P=!1,E=(new h.OperatorProximity2D).getNearestCoordinate(c,p,!0,!1);if(0===E.m_distance&&(P=!0,f[0]=p,E=(new h.OperatorProximity2D).getNearestCoordinate(c,p,!1,!1),E.m_distance>.25*t.minDimension()*1.66666666))return new n.Point({x:p.x,y:p.y});y[0]=E.m_distance,x[0]=0;const v=new o.Point2D;let C=!1,D=.25,b=-1;const S=new r.Envelope2D;c.queryPathEnvelope(g,S);do{let e=Number.NaN;if(f[1]=this.calculateParacentroid_(c,o.lerp(S.xmin,S.xmax,D),l),f[1].isNAN()||(E=(new h.OperatorProximity2D).getNearestCoordinate(c,f[1],!1,!1),e=E.m_distance),e>l&&1===a.isPoint2DInPolygon2D(c,f[1],l))C=!0,y[1]=e,x[1]=o.Point2D.sqrDistance(f[1],p);else if(e>b&&(b=e,v.setCoordsPoint2D(f[1])),D-=.01,D<.1){if(!(b>=0))break;C=!0,y[1]=b,f[1]=v,x[1]=o.Point2D.sqrDistance(f[1],p)}}while(!C);C=!1,D=.5,b=-1;let I=.01,w=1;do{let e=Number.NaN;if(f[2]=this.calculateParacentroid_(c,o.lerp(S.xmin,S.xmax,D),l),f[2].isNAN()||(E=(new h.OperatorProximity2D).getNearestCoordinate(c,f[2],!1,!1),e=E.m_distance),e>l&&1===a.isPoint2DInPolygon2D(c,f[2],l))C=!0,y[2]=e,x[2]=o.Point2D.sqrDistance(f[2],p);else if(e>b&&(b=e,v.setCoordsPoint2D(f[2])),D=.5+I*w,I+=.01,w*=-1,D<.3||D>.7){if(!(b>=0))break;C=!0,y[2]=b,f[2]=v,x[2]=o.Point2D.sqrDistance(f[2],p)}}while(!C);C=!1,D=.75,b=-1;do{let e=Number.NaN;if(f[3]=this.calculateParacentroid_(c,o.lerp(S.xmin,S.xmax,D),l),f[3].isNAN()||(E=(new h.OperatorProximity2D).getNearestCoordinate(c,f[3],!1,!1),e=E.m_distance),e>l&&1===a.isPoint2DInPolygon2D(c,f[3],l))C=!0,y[3]=e,x[3]=o.Point2D.sqrDistance(f[3],p);else if(e>b&&(b=e,v.setCoordsPoint2D(f[3])),D+=.01,D>.9){if(!(b>=0))break;C=!0,y[3]=b,f[3]=v,x[3]=o.Point2D.sqrDistance(f[3],p)}}while(!C);const T=[0,1,2,3],A=P?0:1;for(let e=A;e<4;e++)for(let e=A;e<3;e++){const t=x[e],s=x[e+1];if(o.compareWithNANs(t,s)>0){const n=T[e];T[e]=T[e+1],T[e+1]=n,x[e]=s,x[e+1]=t}}let N=A,G=0,M=0;for(let e=A;e<4;e++){switch(e){case 0:M=2*y[T[e]];break;case 1:M=1.66666666*y[T[e]];break;case 2:M=1.33333333*y[T[e]];break;case 3:M=y[T[e]]}M>G&&(G=M,N=T[e])}return s.geometryReleaseAssert(!f[N].isNAN()),new n.Point({x:f[N].x,y:f[N].y})}labelPointPolyline(e){const t=new o.Point2D;if(e.getPointCount()>2*e.getPathCount()){let s=-1,n=-Number.MAX_VALUE;for(let t=0,i=e.getPathCount();t<i;t++)if(e.getPathSize(t)>2){const i=e.calculatePathLength2D(t);i>n&&(n=i,s=t)}const i=e.getPathStart(s),r=e.getPathEnd(s),o=Math.trunc((i+r)/2);t.assign(e.getXY(o))}else{let s=-Number.MAX_VALUE;const n=e.querySegmentIterator();for(;n.nextPath();)if(n.hasNextSegment()){const e=n.nextSegment(),i=e.calculateLength2D();i>s&&(s=i,t.assign(e.getCoord2D(e.lengthToT(.5*i))))}}return new n.Point({x:t.x,y:t.y})}labelPointMultiPoint(e){const t=new r.Envelope2D;e.queryEnvelope(t);const s=t.getCenter(),i=(new h.OperatorProximity2D).getNearestCoordinate(e,s,!1,!1).m_coordinate;return new n.Point({x:i.x,y:i.y})}labelPointEnvelope(e){const t=e.getCenterXY();return new n.Point({x:t.x,y:t.y})}calculateParacentroid_(e,t,n){const a=new r.Envelope2D;e.queryEnvelope(a);const m=new o.Point2D(t,0);let h=Number.MAX_VALUE,l=Number.MAX_VALUE,u=!1,c=!1;const g=new i.Line;g.setStartXYCoords(m.x,a.ymin-1),g.setEndXYCoords(m.x,a.ymax+1);const d=new r.Envelope2D,p=new o.Point2D,_=new o.Point2D,f=o.makeObjectArray(o.Point2D,2),y=e.querySegmentIterator();for(;y.nextPath();)for(;y.hasNextSegment();){const e=y.nextSegment();if(e.queryEnvelope(d),s.geometryReleaseAssert(e.isMonotoneQuickAndDirty()),p.setCoordsPoint2D(g.getStartXY()),_.setCoordsPoint2D(g.getEndXY()),0===d.clipLine(p,_))continue;if(1!==g.intersect(e,f,null,null,n))continue;const t=f[0].y;h>l?t<h&&(h=t,u=!0):t<l&&(l=t,c=!0)}return u&&c?m.y=(h+l)/2:m.setNAN(),m}}const u=new class{getOperatorType(){return 10203}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,t){return new l(e,t)}execute(e,t){return new l(null,t).labelPoint(e)}};e.execute=function(e){return u.execute(e,null)},e.executeMany=function(e){const s=u.executeMany(new t.SimpleGeometryCursor(e),null);return Array.from(s)},e.supportsCurves=function(){return u.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OperatorProximity":function(){define(["exports","./Geometry","./Envelope2D","./SideCalculator2D-BNwb5gvz","./Envelope","./Point2D","./ProjectionTransformation"],function(e,t,s,n,i,r,o){"use strict";e.OperatorProximity2D=class{getOperatorType(){return 10500}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}getNearestCoordinate(e,s,i,r){if(s.isNAN()&&t.throwInvalidArgumentException("NAN xy coordinates are not allowed"),e.isEmpty())return n.makeEmptyProximity2DResult();switch(e.getGeometryType()){case t.GeometryType.enumPoint:return this.pointGetNearestVertex(e,s);case t.GeometryType.enumMultiPoint:return this.multiVertexGetNearestVertex(e,s);case t.GeometryType.enumPolyline:case t.GeometryType.enumPolygon:return this.multiPathGetNearestCoordinate(e,s,i,r);default:t.throwNotImplementedException("")}}getNearestVertex(e,s){if(s.isNAN()&&t.throwInvalidArgumentException("NAN xy coordinates are not allowed"),e.isEmpty())return n.makeEmptyProximity2DResult();switch(e.getGeometryType()){case t.GeometryType.enumPoint:return this.pointGetNearestVertex(e,s);case t.GeometryType.enumMultiPoint:case t.GeometryType.enumPolyline:case t.GeometryType.enumPolygon:return this.multiVertexGetNearestVertex(e,s);default:t.throwNotImplementedException("")}}getNearestVertices(e,s,n,i){if(0===i&&t.throwInvalidArgumentException(""),s.isNAN()&&t.throwInvalidArgumentException("NAN xy coordinates are not allowed"),e.isEmpty())return[];switch(e.getGeometryType()){case t.GeometryType.enumPoint:return this.pointGetNearestVertices(e,s,n,i);case t.GeometryType.enumMultiPoint:case t.GeometryType.enumPolyline:case t.GeometryType.enumPolygon:return this.multiVertexGetNearestVertices(e,s,n,i);default:t.throwNotImplementedException("")}}multiPathGetNearestCoordinate(e,a,m,h){if(e.getGeometryType()===t.GeometryType.enumPolygon&&m){const t=new s.Envelope2D;e.queryEnvelope(t);const r=i.calculateToleranceFromGeometryForRel(null,t,!1);let m;if(m=h?o.isPoint2DInPolygon2D(e,a,0):o.isPoint2DInPolygon2D(e,a,r),0!==m){const e=n.makeProximity2DResult(a,-1,0);return h&&(e.m_bRightSide=!0),e}}const l=e.querySegmentIterator(),u=new r.Point2D;let c=-1,g=-1,d=Number.MAX_VALUE,p=0;for(;l.nextPath();)for(;l.hasNextSegment();){const e=l.nextSegment(),t=e.getClosestCoordinate(a,!1),s=e.getCoord2D(t),n=r.Point2D.sqrDistance(s,a);n<d?(p=1,u.assign(s),c=l.getStartPointIndex(),g=l.getPathIndex(),d=n):n===d&&p++}-1===c&&t.throwInvalidArgumentException("");const _=n.makeProximity2DResult(u,c,Math.sqrt(d));if(h)if(e.getGeometryType()!==t.GeometryType.enumPolygon){let t=!1;if(p>1){const s=n.calculateSide(e,a,c,g);t=0!==s&&3!==s}else{l.resetToVertex(c,g);const e=l.nextSegment();t=0!==n.calculateSide(e,a)}_.m_bRightSide=t}else m||0!==o.isPoint2DInPolygon2D(e,a,0)&&(_.m_bRightSide=!0);return _}pointGetNearestVertex(e,t){const s=e.getXY(),i=r.Point2D.distance(s,t);return n.makeProximity2DResult(s,0,i)}multiVertexGetNearestVertex(e,t){const s=e.getAttributeStreamRef(0),i=e.getPointCount();let o=-1;const a=new r.Point2D;let m=Number.MAX_VALUE;const h=new r.Point2D;for(let e=0;e<i;e++){s.queryPoint2D(2*e,h);const n=r.Point2D.sqrDistance(h,t);n<m&&(a.assign(h),o=e,m=n)}return n.makeProximity2DResult(a,o,Math.sqrt(m))}pointGetNearestVertices(e,t,s,i){const o=[];if(0!==i){const i=s*s,a=e.getXY(),m=r.Point2D.sqrDistance(a,t);m<=i&&o.push(n.makeProximity2DResult(a,0,Math.sqrt(m)))}return o}multiVertexGetNearestVertices(e,t,s,i){const o=[];if(0!==i){const a=e.getAttributeStreamRef(0),m=e.getPointCount();o.length=i+1;const h=s*s;for(let e=0;e<m;e++){const s=a.read(2*e),i=a.read(2*e+1),m=t.x-s,l=t.y-i,u=m*m+l*l;u<=h&&o.push(n.makeProximity2DResult(r.Point2D.construct(s,i),e,Math.sqrt(u)))}o.sort((e,t)=>e.m_distance-t.m_distance)}return o.slice(0,i)}}})},"esri/chunks/SideCalculator2D-BNwb5gvz":function(){define(["exports","./Point2D","./Geometry","./Envelope2D","./ProjectionTransformation"],function(e,t,s,n,i){"use strict";function r(e,t,s){return{m_coordinate:e.clone(),m_vertexIndex:t,m_geometryIndex:0,m_distance:s,m_bRightSide:!1,isEmpty:o}}function o(){return Number.isNaN(this.m_distance)}e.calculateSide=function e(r,o,a=-1,m=-1){if(r.isEmpty())return 3;const h=r.getGeometryType();if(s.isSegment(h))return function(e,n,i,r){if(i>=0||r>=0)return s.throwInvalidArgumentException("");if(e.isDegenerate(0))return e.getStartXY().equals(n)?2:3;if(!e.isCurve()){const s=t.Point2D.orientationRobust(n,e.getStartXY(),e.getEndXY());return s<0?1:s>0?0:2}const o=e.getClosestCoordinate(n,!1),a=e.getTangent(o),m=e.getCoord2D(o),h=t.Point2D.orientationRobust(n,m,m.add(a));return h<0?1:h>0?0:2}(r,o,a,m);if(h===s.GeometryType.enumPolygon)return function(e,t,r,o){(r>=0||o>=0)&&s.throwInvalidArgumentException("");const a=new n.Envelope2D;e.queryEnvelope(a);const m=i.isPoint2DInPolygon2D(e,t,0);return 0===m?0:1===m?1:2}(r,o,a,m);if(h===s.GeometryType.enumPolyline)return function(n,i,r,o){(r<0&&o>=0||r>=0&&o<0)&&s.throwInvalidArgumentException("");const a=n.querySegmentIterator();if(r<0){let s=Number.MAX_VALUE,n=0;for(;a.nextPath();)for(;a.hasNextSegment();){const e=a.nextSegment(),m=e.getClosestCoordinate(i,!1),h=e.getCoord2D(m),l=t.Point2D.sqrDistance(h,i);l<s?(n=1,r=a.getStartPointIndex(),o=a.getPathIndex(),s=l):l===s&&n++}if(0===n)return 3;if(1===n)return a.resetToVertex(r,o),e(a.nextSegment(),i)}const m=function(e,s,n,i){const r={i1:-1,i2:-1,bRight1:!1,bRight2:!1};if(r.i1=function(e,t,s){for(e.resetToVertex(t,s);e.hasNextSegment();)if(!e.nextSegment().isDegenerate(0))return e.getStartPointIndex();for(e.resetToVertex(t,s);e.hasPreviousSegment();)if(!e.previousSegment().isDegenerate(0))return e.getStartPointIndex();return-1}(s,n,i),-1!==r.i1){s.resetToVertex(r.i1,-1);const n=s.nextSegment(),i=n.getClosestCoordinate(e,!1),o=n.getCoord2D(i),a=t.Point2D.sqrDistance(o,e);{const t=o.clone();t.subThis(n.getStartXY());const s=e.clone();s.subThis(n.getStartXY()),r.bRight1=t.crossProduct(s)<0}if(r.i2=function(e,t){for(e.resetToVertex(t,-1),e.nextSegment();e.hasNextSegment();)if(!e.nextSegment().isDegenerate(0))return e.getStartPointIndex();return-1}(s,r.i1),-1!==r.i2){s.resetToVertex(r.i2,-1);const n=s.nextSegment(),i=n.getClosestCoordinate(e,!1),o=n.getCoord2D(i);if(t.Point2D.sqrDistance(o,e)>a)r.i2=-1;else{const t=o.clone();t.subThis(n.getStartXY());const s=e.clone();s.subThis(n.getStartXY()),r.bRight2=t.crossProduct(s)<0}}if(-1===r.i2&&(r.i2=function(e,t){for(e.resetToVertex(t,-1);e.hasPreviousSegment();)if(!e.previousSegment().isDegenerate(0))return e.getStartPointIndex();return-1}(s,r.i1),-1!==r.i2)){s.resetToVertex(r.i2,-1);const n=s.nextSegment(),i=n.getClosestCoordinate(e,!1),o=n.getCoord2D(i);if(t.Point2D.sqrDistance(o,e)>a)r.i2=-1;else{const t=o.clone();t.subThis(n.getStartXY());const s=e.clone();s.subThis(n.getStartXY()),r.bRight2=t.crossProduct(s)<0;const i=r.i1;r.i1=r.i2,r.i2=i;const a=r.bRight1;r.bRight1=r.bRight2,r.bRight2=a}}}return r}(i,a,r,o);if(-1!==m.i1&&-1===m.i2)return m.bRight1?1:0;if(-1!==m.i1&&-1!==m.i2){if(m.bRight1===m.bRight2)return m.bRight1?1:0;{a.resetToVertex(m.i1,-1);const e=a.nextSegment().getTangent(1);a.resetToVertex(m.i2,-1);const t=a.nextSegment().getTangent(0);return e.crossProduct(t)>=0?1:0}}return a.resetToVertex(r,o),e(a.nextSegment(),i)}(r,o,a,m);if(h===s.GeometryType.enumEnvelope){const e=new n.Envelope2D;return r.queryEnvelope(e),e.contains(o)?e.containsExclusive(o)?1:2:0}return 3},e.makeEmptyProximity2DResult=function(){return r(new t.Point2D,-1,Number.NaN)},e.makeProximity2DResult=r})},"esri/chunks/lengthOperator":function(){define(["exports","../core/unitUtils","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";function n(e,n={}){const{unit:i}=n;let r=s.fromGeometry(e).calculateLength2D();if(r&&i){const n=s.getSpatialReference(e);r=t.convertFromSpatialReferenceUnit(r,n,i)}return r}const i=!0,r=Object.freeze(Object.defineProperty({__proto__:null,execute:n,supportsCurves:i},Symbol.toStringTag,{value:"Module"}));e.execute=n,e.lengthOperator=r,e.supportsCurves=i})},"esri/chunks/offsetOperator":function(){define(["exports","../core/arrayUtils","../core/unitUtils","../geometry/operators/gx/operatorOffset","../geometry/operators/support/apiConverter"],function(e,t,s,n,i){"use strict";const r={round:0,bevel:1,miter:2,square:3};function o(e,t,o={}){const{miterLimit:a=10,flattenError:m=0,joins:h="round",unit:l}=o,u=i.getSpatialReference(e);return l&&(t=s.convertToSpatialReferenceUnit(t,l,u)),i.toGeometry(n.execute(i.fromGeometry(e),i.fromSpatialReference(u),t,r[h],a,m),u)}function a(e,o,a={}){const{miterLimit:m=10,flattenError:h=0,joins:l="round",unit:u}=a,c=i.getSpatialReference(e);u&&(o=s.convertToSpatialReferenceUnit(o,u,c));const g=e.map(i.fromGeometry);return n.executeMany(g,i.fromSpatialReference(c),o,r[l],m,h).map(e=>i.toGeometry(e,c)).filter(t.isSome)}const m=n.supportsCurves(),h=Object.freeze(Object.defineProperty({__proto__:null,execute:o,executeMany:a,supportsCurves:m},Symbol.toStringTag,{value:"Module"}));e.execute=o,e.executeMany=a,e.offsetOperator=h,e.supportsCurves=m})},"esri/geometry/operators/gx/operatorOffset":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Envelope","../../../chunks/Geometry","../../../chunks/MultiPathImpl","../../../chunks/Point2D"],function(e,t,s,n,i,r){"use strict";const o=1.4142135623730951,a=.017453292519943295,m=256,h=1024;class l{static construct(e,t,s){const n=new l;return n.x=e.x,n.y=e.y,n.m_next=-1,n.m_prev=-1,n.z=t,n.m=s,n.type=0,n}clone(){const e=new l;return e.x=this.x,e.y=this.y,e.m_next=this.m_next,e.m_prev=this.m_prev,e.z=this.z,e.m=this.m,e.type=this.type,e}asPoint2D(){return new r.Point2D(this.x,this.y)}}class u{constructor(e){this.m_distance=-1,this.m_tolerance=-1,this.m_miterLimit=10,this.m_joins=0,this.m_progressCounter=0,this.m_bUseZ=!1,this.m_bUseM=!1,this.m_srcPts=[],this.m_srcPtCount=0,this.m_offsetPts=[],this.m_offsetPtCount=0,this.m_a1=0,this.m_a2=0,this.m_progressTracker=e}constructOffset(){const e=this.m_inputGeometry.getGeometryType();if(e===n.GeometryType.enumLine)return this.offsetLine();if(e===n.GeometryType.enumEnvelope)return this.offsetEnvelope();if(n.isSegment(e)){const e=new i.Polyline;return e.addSegment(this.m_inputGeometry,!0),this.m_inputGeometry=e,this.constructOffset()}if(e===n.GeometryType.enumPolyline){const e=new i.Polyline;return this.offsetMultiPath(e),e}if(e===n.GeometryType.enumPolygon){const e=new i.Polygon;return this.offsetMultiPath(e),e}n.throwNotImplementedException("")}offsetLine(){const e=this.m_inputGeometry,t=e.getStartXY(),s=e.getEndXY(),n=new r.Point2D;n.setSub(s,t),n.normalize(),n.leftPerpendicularThis(),n.scale(this.m_distance),t.addThis(n),s.addThis(n);const i=e.clone();return i.setStartXY(t),i.setEndXY(s),i}offsetEnvelope(){const e=this.m_inputGeometry;if(this.m_distance>0&&2!==this.m_joins){const t=new i.Polygon;return t.addEnvelope(e,!1),this.m_inputGeometry=t,this.constructOffset()}const t=e.clone();return t.inflateCoords(this.m_distance,this.m_distance),t}progress(){}static buildPoint(e,t,s,n){n.x=e.x+t*Math.cos(s),n.y=e.y+t*Math.sin(s),n.type=e.type,n.z=e.z,n.m=e.m,n.m_next=-1,n.m_prev=-1}addPoint(e){this.m_offsetPts.push(e.clone()),this.m_offsetPtCount++}addPointEx(e,t){if(0===this.m_offsetPtCount)return void this.addPoint(e);const s=this.m_srcPtCount,n=this.m_srcPts[0===t?s-1:t-1],i=this.m_srcPts[t],o=u.dotSign(n,i,this.m_offsetPts[this.m_offsetPtCount-1],e);if(o>0)this.addPoint(e);else if(o<0)if(u.dotSign(n,i,i,this.m_offsetPts[this.m_offsetPtCount-1])>0){const i=new l;let o;o=0===t?s-2:1===t?s-1:t-2;const a=this.m_srcPts[o],h=Math.atan2(n.y-a.y,n.x-a.x);if(u.buildPoint(n,this.m_distance,h-r.geometryHalfPi,i),this.m_offsetPts[this.m_offsetPtCount-1]=i,1===this.m_joins||2===this.m_joins){i.x=.5*(i.x+n.x),i.y=.5*(i.y+n.y),this.addPoint(i),u.buildPoint(n,this.m_distance,this.m_a1+r.geometryHalfPi,i);const e=i.clone();e.x=.5*(e.x+n.x),e.y=.5*(e.y+n.y),e.type|=m,this.addPoint(e),this.addPoint(i)}else u.buildPoint(n,this.m_distance,this.m_a1+r.geometryHalfPi,i),i.type|=m,this.addPoint(i);this.addPointEx(e,t)}else{const e=new l;if(u.buildPoint(i,this.m_distance,this.m_a1+r.geometryHalfPi,e),this.addPoint(e),1===this.m_joins||2===this.m_joins){e.x=.5*(e.x+i.x),e.y=.5*(e.y+i.y),this.addPoint(e),u.buildPoint(i,this.m_distance,this.m_a2-r.geometryHalfPi,e);const t=e.clone();t.x=.5*(t.x+i.x),t.y=.5*(t.y+i.y),t.type|=m,this.addPoint(t),this.addPoint(e)}else u.buildPoint(i,this.m_distance,this.m_a2-r.geometryHalfPi,e),e.type|=m,this.addPoint(e)}}buildOffset(){const e=new l,t=this.m_srcPtCount;this.m_offsetPtCount=0;const s=.5*this.m_tolerance;let n=0,i=0;for(let l=0;l<t;l++){const c=this.m_srcPts[l],g=0===l?this.m_srcPts[t-1]:this.m_srcPts[l-1],d=l===t-1?this.m_srcPts[0]:this.m_srcPts[l+1];let p,_,f=0;{const e=g.x-c.x,t=g.y-c.y,s=d.x-c.x,o=d.y-c.y;p=Math.atan2(t,e),_=Math.atan2(o,s),this.m_a1=p,this.m_a2=_,0===l&&(n=p,i=_),f=r.Point2D.orientationRobust(c.asPoint2D(),g.asPoint2D(),d.asPoint2D())}const y=_;if(_<p&&(_+=r.geometry2Pi),f*this.m_distance>0)if(1===this.m_joins||2===this.m_joins){u.buildPoint(c,this.m_distance,p+r.geometryHalfPi,e),this.addPoint(e);const t=.001;e.x=c.x+(e.x-c.x)*t,e.y=c.y+(e.y-c.y)*t,this.addPoint(e),u.buildPoint(c,this.m_distance,_-r.geometryHalfPi,e);const s=e.clone();s.x=c.x+(s.x-c.x)*t,s.y=c.y+(s.y-c.y)*t,s.type|=m,this.addPoint(s),this.addPoint(e)}else{const t=.5*(_-p),s=0===t?this.m_distance:this.m_distance/Math.abs(Math.sin(t));u.buildPoint(c,s,.5*(p+_),e),this.addPointEx(e,l)}else{if(512&c.type){const t=1-s/Math.abs(this.m_distance);let n=1,i=this.m_distance<0?-Math.PI:Math.PI;if(t>-1&&t<1){let e=2*Math.acos(t);e<a&&(e=a),n=Math.trunc(Math.PI/e+1.5),n>1&&(i/=n)}n<=1&&(n=2,i/=2);let o=p+r.geometryHalfPi;u.buildPoint(c,this.m_distance,o,e),0===l&&(e.type|=h),this.addPointEx(e,l);const m=this.m_distance/Math.cos(i/2);for(o+=i/2,u.buildPoint(c,m,o,e),e.type|=h,this.addPoint(e);--n>0;)o+=i,u.buildPoint(c,m,o,e),e.type|=h,this.addPoint(e);u.buildPoint(c,this.m_distance,_-r.geometryHalfPi,e),e.type|=h,this.addPoint(e);continue}if(1!==this.m_joins){if(0===this.m_joins){const t=1-s/Math.abs(this.m_distance);let n=1,i=_-r.geometryHalfPi-(p+r.geometryHalfPi);if(t>-1&&t<1){let e=2*Math.acos(t);e<a&&(e=a),n=Math.trunc(Math.abs(i)/e+1.5),n>1&&(i/=n)}const o=this.m_distance/Math.cos(.5*i);let m=p+r.geometryHalfPi+.5*i;for(u.buildPoint(c,o,m,e),this.addPointEx(e,l);--n>0;)m+=i,u.buildPoint(c,o,m,e),this.addPoint(e);continue}if(2===this.m_joins){const t=g.x-c.x,s=g.y-c.y,n=d.x-c.x,i=d.y-c.y,a=(t*n+s*i)/Math.sqrt(t*t+s*s)/Math.sqrt(n*n+i*i);if(a>1-1e-8){u.buildPoint(c,o*this.m_distance,_-.25*Math.PI,e),this.addPointEx(e,l),u.buildPoint(c,o*this.m_distance,_+.25*Math.PI,e),this.addPoint(e);continue}const m=Math.abs(this.m_distance/Math.sin(.5*Math.acos(a))),h=Math.abs(this.m_miterLimit*this.m_distance);if(m>h){const t=.5*(_-p),s=this.m_distance/Math.abs(Math.sin(t));u.buildPoint(c,s,.5*(p+_),e);const n=r.Point2D.construct(e.x,e.y),i=r.Point2D.construct(c.x,c.y),o=new r.Point2D;o.setSub(n,i);const a=new r.Point2D;a.setScaleAdd(h/o.length(),o,i);const g=Math.sqrt(m*m-this.m_distance*this.m_distance),d=(m-h)*Math.abs(this.m_distance)/g;this.m_distance>0?o.leftPerpendicularThis():o.rightPerpendicularThis(),o.scale(d/o.length());const f=new r.Point2D;f.setAdd(a,o);const y=new r.Point2D;y.setSub(a,o),e.x=f.x,e.y=f.y,this.addPointEx(e,l),e.x=y.x,e.y=y.y,this.addPoint(e);continue}const f=.5*(_-p),y=this.m_distance/Math.abs(Math.sin(f));u.buildPoint(c,y,.5*(p+_),e),this.addPointEx(e,l);continue}{let t;if(_=y,this.m_distance>0?(_>p&&(_-=r.geometry2Pi),t=p-_<r.geometryHalfPi):(_<p&&(_+=r.geometry2Pi),t=_-p<r.geometryHalfPi),t){const t=this.m_distance*o;let s;s=t<0?p+.25*Math.PI:p+3*Math.PI*.25,u.buildPoint(c,t,s,e),this.addPointEx(e,l),s=t<0?_-.25*Math.PI:_-3*Math.PI*.25,u.buildPoint(c,t,s,e),this.addPoint(e)}else{const t=.5*(_-p),s=this.m_distance/Math.abs(Math.sin(t));_<p&&(_+=r.geometry2Pi),u.buildPoint(c,s,(p+_)/2,e),this.addPointEx(e,l)}}}else u.buildPoint(c,this.m_distance,p+r.geometryHalfPi,e),this.addPointEx(e,l),u.buildPoint(c,this.m_distance,_-r.geometryHalfPi,e),this.addPoint(e)}}return this.m_a1=n,this.m_a2=i,this.addPointEx(this.m_offsetPts[0],0),this.m_offsetPts[0]=this.m_offsetPts[this.m_offsetPtCount-1].clone(),this.removeBadSegsFast()}removeBadSegsFast(){let e=!1;for(let e=0;e<this.m_offsetPtCount;e++){const t=this.m_offsetPts[e];t.m_next=e+1,t.m_prev=e-1}this.m_offsetPts[0].m_prev=this.m_offsetPtCount-2,this.m_offsetPts[this.m_offsetPtCount-2].m_next=0;let t=0;for(let s=0;s<this.m_offsetPtCount;s++)if(this.m_offsetPts[t].type&m){const s=this.deleteClosedSeg(t);if(-1===s){e=!0;break}t=s}else t=this.m_offsetPts[t].m_next;return!e&&(this.compressOffsetArray(t),!0)}deleteClosedSeg(e){const t=this.m_offsetPtCount-1;let s,n,i=e;for(let r=1;r<=t-2;r++){i=this.m_offsetPts[i].m_next,s=i,n=e;for(let e=1;e<=r;e++){if(n=this.m_offsetPts[n].m_prev,0===(this.m_offsetPts[n].type&m)&&0===(this.m_offsetPts[s].type&m)){const e=this.handleClosedIntersection(n,s);if(-1!==e)return e}s=this.m_offsetPts[s].m_prev}}return-1}handleClosedIntersection(e,t){const s=this.m_offsetPts[this.m_offsetPts[e].m_prev],n=this.m_offsetPts[e],i=this.m_offsetPts[this.m_offsetPts[t].m_prev],r=this.m_offsetPts[t];if(!this.sectGraphicRect(s,n,i,r))return-1;const o={pt:new l,bAtExistingPt:!1};if(((n.x-s.x)*(r.y-i.y)-(n.y-s.y)*(r.x-i.x))*this.m_distance<0&&this.findIntersection(s,n,i,r,o)&&!o.bAtExistingPt){const a=1e-8,m=Math.sqrt((n.x-s.x)*(n.x-s.x)+(n.y-s.y)*(n.y-s.y)),h=(n.x-s.x)/m,l=(n.y-s.y)/m,u=Math.sqrt((r.x-i.x)*(r.x-i.x)+(r.y-i.y)*(r.y-i.y)),c=(r.x-i.x)/u,g=(r.y-i.y)/u;let d=!1;const p=o.pt.clone();p.x+=(h+c)*a,p.y+=(l+g)*a;let _=i,f=o.pt,y=this.m_offsetPts[e].m_prev;for(;f.y>p.y!=_.y>p.y&&p.x<(_.x-f.x)*(p.y-f.y)/(_.y-f.y)+f.x&&(d=!d),_=f,y=this.m_offsetPts[y].m_next,y!==t;)f=this.m_offsetPts[y];if(d)return-1;const x=this.m_offsetPts[e].m_prev;return o.pt.type=n.type,o.pt.m_next=t,o.pt.m_prev=x,this.m_offsetPts[e]=o.pt,this.m_offsetPts[t].m_prev=e,t}return-1}sectGraphicRect(e,t,s,n){return Math.max(e.x,t.x)>=Math.min(s.x,n.x)&&Math.max(s.x,n.x)>=Math.min(e.x,t.x)&&Math.max(e.y,t.y)>=Math.min(s.y,n.y)&&Math.max(s.y,n.y)>=Math.min(e.y,t.y)}findIntersection(e,t,s,n,i){let r,o,a,m;return i.bAtExistingPt=!1,r=(t.y-e.y)*(n.x-s.x)-(t.x-e.x)*(n.y-s.y),o=(s.y-e.y)*(t.x-e.x)-(s.x-e.x)*(t.y-e.y),a=0===r?2:o/r,a>=0&&a<=1&&(m=a,r=(n.y-s.y)*(t.x-e.x)-(n.x-s.x)*(t.y-e.y),o=(e.y-s.y)*(n.x-s.x)-(e.x-s.x)*(n.y-s.y),a=0===r?2:o/r,a>=0&&a<=1)&&(i.pt.x=e.x+a*(t.x-e.x),i.pt.y=e.y+a*(t.y-e.y),this.m_bUseZ&&(i.pt.z=s.z+m*(n.z-s.z)),this.m_bUseM&&(i.pt.m=s.m+m*(n.m-s.m)),0!==m&&1!==m||0!==a&&1!==a||(i.bAtExistingPt=!0),!((0===m||1===m)&&a>0&&a<1||(0===a||1===a)&&m>0&&m<1))}compressOffsetArray(e){for(;this.m_offsetPts[e].m_prev<e;)e=this.m_offsetPts[e].m_prev;let t=0,s=e;do{const e=this.m_offsetPts[s].clone();this.m_offsetPts[t]=e,s=e.m_next,t++}while(s!==e);this.m_offsetPts[t]=this.m_offsetPts[0].clone(),this.m_offsetPtCount=t+1}addPart(e,t){if(!(t<2))for(let s=0;s<t;s++){const t=this.m_offsetPts[e+s];if(s?this.m_bUseZ?this.m_resultPath.lineTo3DCoords(t.x,t.y,t.z):this.m_resultPath.lineToCoords(t.x,t.y):this.m_bUseZ?this.m_resultPath.startPath3DCoords(t.x,t.y,t.z):this.m_resultPath.startPathCoords(t.x,t.y),this.m_bUseM){const e=this.m_resultPath.getPointCount()-1;this.m_resultPath.setAttribute(2,e,0,t.m)}}}offsetMultiPath(e){const t=i.densify(this.m_inputGeometry,0,this.m_tolerance,0,this.m_progressTracker,12e3),s=t.querySegmentIterator();s.resetToFirstPath();let n=-1;for(;s.nextPath();)n++,this.offsetPath(t,n,e)}offsetPath(e,t,s){let n=e.getPathStart(t),i=e.getPathEnd(t);if(this.m_resultPath=s,e.isClosedPath(t)){const t=e.getXY(n);for(;i>n&&e.getXY(i-1).equals(t);)i--;if(i-n>=2){this.m_srcPtCount=i-n,this.m_srcPts.length=this.m_srcPtCount;for(let t=n;t<i;t++)this.progress(),this.m_srcPts[t-n]=l.construct(e.getXY(t),this.m_bUseZ?e.getAttributeAsDbl(1,t,0):0,this.m_bUseM?e.getAttributeAsDbl(2,t,0):0);this.buildOffset()&&this.addPart(0,this.m_offsetPtCount-1)}}else{const t=e.getXY(n);for(;n<i-1&&e.getXY(n+1).equals(t);)n++;const s=e.getXY(i-1);for(;n<i-1&&e.getXY(i-2).equals(s);)i--;if(i-n>=2){this.m_srcPtCount=2*(i-n)-2,this.m_srcPts.length=this.m_srcPtCount;let s=l.construct(t,this.m_bUseZ?e.getAttributeAsDbl(1,n,0):0,this.m_bUseM?e.getAttributeAsDbl(2,n,0):0);s.type|=1536,this.m_srcPts[0]=s;let r=1,o=this.m_srcPtCount-1;for(let t=n+1;t<i-1;t++,r++,o--)this.progress(),s=l.construct(e.getXY(t),this.m_bUseZ?e.getAttributeAsDbl(1,t,0):0,this.m_bUseM?e.getAttributeAsDbl(2,t,0):0),this.m_srcPts[r]=s.clone(),s.type|=h,this.m_srcPts[o]=s.clone();if(s=l.construct(e.getXY(i-1),this.m_bUseZ?e.getAttributeAsDbl(1,i-1,0):0,this.m_bUseM?e.getAttributeAsDbl(2,i-1,0):0),s.type|=512,this.m_srcPts[r]=s.clone(),this.buildOffset())if(this.m_offsetPts.length>=2){let e=-1,t=-1,s=0!==(this.m_offsetPts[this.m_offsetPtCount-1].type&h);s||(e=0);for(let n=1;n<this.m_offsetPtCount;n++){this.progress();const i=0!==(this.m_offsetPts[n].type&h);i?s||(t=n-1,t-e+1>1&&this.addPart(e,t-e+1)):s&&(e=n-1),s=i}s||(t=this.m_offsetPtCount-1,t-e+1>1&&this.addPart(e,t-e+1))}else{const e=0,t=this.m_offsetPtCount-1;t-e>=1&&this.addPart(e,t-e+1)}}}this.m_srcPts.length=0,this.m_srcPtCount=0,this.m_offsetPts.length=0,this.m_offsetPtCount=0}static dotSign(e,t,s,n){const i=t.x-e.x,o=t.y-e.y,a=n.x-s.x,m=n.y-s.y,h=r.compensatedDot(i,o,a,m);return r.sign(h)}}class c extends t.GeometryCursor{constructor(e,t,s,n,i,r,o){super(),this.m_progressTracker=o,this.m_index=-1,this.m_inputGeoms=e,this.m_spatialReference=t,this.m_distance=s,this.m_joins=n,this.m_miterLimit=i,this.m_flattenError=r}tock(){return!0}getRank(){return 1}next(){if(!this.m_inputGeoms)return null;let e;for(;e=this.m_inputGeoms.next();)return this.m_index=this.m_inputGeoms.getGeometryID(),this.offset(e);return null}getGeometryID(){return this.m_index}offset(e){let t;return n.throwIfMesh(e),t=this.m_flattenError<=0?s.calculateToleranceFromGeometryForOpFromGeom(this.m_spatialReference,e,!0).total():this.m_flattenError,function(e,t,s,i,r,o){if(null===e&&n.throwInvalidArgumentException(""),e.getDimension()<1&&n.throwInvalidArgumentException(""),r>0||n.throwInvalidArgumentException(""),n.throwIfMesh(e),0===t||e.isEmpty())return e;const a=new u(o);return a.m_bUseZ=e.hasAttribute(1),a.m_bUseM=e.hasAttribute(2),a.m_inputGeometry=e,a.m_distance=t,a.m_tolerance=r,a.m_joins=s,a.m_miterLimit=i>1?i:1,a.m_progressCounter=0,a.constructOffset()}(e,this.m_distance,this.m_joins,this.m_miterLimit,t,this.m_progressTracker)}}const g=new class{getOperatorType(){return 10108}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,t,s,n,i,r,o){return new c(e,t,s,n,i,r,o)}execute(e,t,s,n,i,r,o){return new c(null,t,s,n,i,r,o).offset(e)}};e.execute=function(e,t,s,n,i,r){return g.execute(e,t,s,n,i,r,null)},e.executeMany=function(e,s,n,i,r,o){const a=g.executeMany(new t.SimpleGeometryCursor(e),s,n,i,r,o,null);return Array.from(a)},e.supportsCurves=function(){return g.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/overlapsOperator":function(){define(["exports","./OperatorOverlaps","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";const n=new t.OperatorOverlaps;function i(e){const t=s.getSpatialReference(e);return n.accelerateGeometry(s.fromGeometry(e),s.fromSpatialReference(t),1)}function r(e,t){return n.execute(s.fromGeometry(e),s.fromGeometry(t),s.fromSpatialReference(e.spatialReference),null)}const o=n.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:i,execute:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=i,e.execute=r,e.overlapsOperator=a,e.supportsCurves=o})},"esri/chunks/OperatorOverlaps":function(){define(["exports","./ProjectionTransformation"],function(e,t){"use strict";class s extends t.OperatorSimpleRelation{getOperatorType(){return 9}execute(e,s,n,i){return t.relate(e,s,n,32,i)}}e.OperatorOverlaps=s})},"esri/chunks/proximityOperator":function(){define(["exports","./OperatorProximity","../core/unitUtils","../geometry/operators/support/apiConverter","../geometry/operators/support/proximityResult"],function(e,t,s,n,i){"use strict";const r=new t.OperatorProximity2D;function o(e,t,o={}){const{calculateLeftRightSide:a=!1,testPolygonInterior:m=!0,unit:h}=o,l=r.getNearestCoordinate(n.fromGeometry(e),n.fromPoint(t).getXY(),m,a);if(h&&l.m_distance){const t=n.getSpatialReference(e);l.m_distance=s.convertFromSpatialReferenceUnit(l.m_distance,t,h)}return i.toProximityResult(l,e,a)}function a(e,t,o={}){const{unit:a}=o,m=r.getNearestVertex(n.fromGeometry(e),n.fromPoint(t).getXY());if(a&&m.m_distance){const t=n.getSpatialReference(e);m.m_distance=s.convertFromSpatialReferenceUnit(m.m_distance,t,a)}return i.toProximityResult(m,e)}function m(e,t,o,a,m={}){const{unit:h}=m,l=n.getSpatialReference(e);return h&&o&&(o=s.convertToSpatialReferenceUnit(o,h,l)),r.getNearestVertices(n.fromGeometry(e),n.fromPoint(t).getXY(),o,a).map(t=>(h&&t.m_distance&&(t.m_distance=s.convertFromSpatialReferenceUnit(t.m_distance,l,h)),i.toProximityResult(t,e)))}const h=r.supportsCurves(),l=Object.freeze(Object.defineProperty({__proto__:null,getNearestCoordinate:o,getNearestVertex:a,getNearestVertices:m,supportsCurves:h},Symbol.toStringTag,{value:"Module"}));e.getNearestCoordinate=o,e.getNearestVertex=a,e.getNearestVertices=m,e.proximityOperator=l,e.supportsCurves=h})},"esri/geometry/operators/support/proximityResult":function(){define(["exports","./apiConverter"],function(e,t){"use strict";e.toProximityResult=function(e,s,n=!1){const i=t.toPoint(e.m_coordinate,t.getSpatialReference(s)),r=e.m_distance,o=e.isEmpty(),a=e.m_bRightSide;return{coordinate:i,distance:r,isEmpty:o,...n&&{isRightSide:a},vertexIndex:e.m_vertexIndex}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/relateOperator":function(){define(["exports","./ProjectionTransformation","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";const n=new class{supportsCurves(){return!0}getOperatorType(){return 1}execute(e,s,n,i,r){return t.relate$1(e,s,n,i,r)}isValidDE9IM(e){return 0===t.validateSclString(e)}accelerateGeometry(e,s,n){return t.accelerateGeometry(e,s,n)}canAccelerateGeometry(e){return t.canAccelerateGeometry(e)}};function i(e){const t=s.getSpatialReference(e);return n.accelerateGeometry(s.fromGeometry(e),s.fromSpatialReference(t),1)}function r(e,t,i){return n.execute(s.fromGeometry(e),s.fromGeometry(t),s.fromSpatialReference(e.spatialReference),i,null)}function o(e){return n.isValidDE9IM(e)}const a=n.supportsCurves(),m=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:i,execute:r,isValidDE9IM:o,supportsCurves:a},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=i,e.execute=r,e.isValidDE9IM=o,e.relateOperator=m,e.supportsCurves=a})},"esri/chunks/simplifyOperator":function(){define(["exports","../geometry/operators/gx/operatorSimplify","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";function n(e){const n=s.getSpatialReference(e);return s.toGeometry(t.execute(s.fromGeometry(e),s.fromSpatialReference(n),!1),n)}function i(e){const n=e.map(s.fromGeometry),i=s.getSpatialReference(e);return t.executeMany(n,s.fromSpatialReference(i),!1).map(e=>s.toGeometry(e,i))}function r(e){return t.isSimpleAsFeature(s.fromGeometry(e),s.fromSpatialReference(s.getSpatialReference(e)),!1)}const o=t.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,execute:n,executeMany:i,isSimple:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.execute=n,e.executeMany=i,e.isSimple=r,e.simplifyOperator=a,e.supportsCurves=o})},"esri/geometry/operators/gx/operatorSimplify":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/MultiPathImpl","../../../chunks/ProjectionTransformation","../../../chunks/Envelope"],function(e,t,s,n,i,r){"use strict";const o=new i.OperatorSimplify;e.execute=function(e,t,s){return o.execute(e,t,s,null)},e.executeMany=function(e,s,n){const i=o.executeMany(new t.SimpleGeometryCursor(e),s,n,null);return Array.from(i)},e.isSimpleAsFeature=function(e,t,s){return o.isSimpleAsFeature(e,t,s,null,null)},e.supportsCurves=function(){return o.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/symmetricDifferenceOperator":function(){define(["exports","../core/arrayUtils","../geometry/operators/gx/operatorSymmetricDifference","../geometry/operators/support/apiConverter"],function(e,t,s,n){"use strict";function i(e,t){const i=n.getSpatialReference(e);return n.toGeometry(s.execute(n.fromGeometry(e),n.fromGeometry(t),n.fromSpatialReference(i)),i)}function r(e,i){const r=e.map(n.fromGeometry),o=n.getSpatialReference(e);return s.executeMany(r,n.fromGeometry(i),n.fromSpatialReference(o)).map(e=>n.toGeometry(e,o)).filter(t.isSome)}const o=s.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,execute:i,executeMany:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.execute=i,e.executeMany=r,e.supportsCurves=o,e.symmetricDifferenceOperator=a})},"esri/geometry/operators/gx/operatorSymmetricDifference":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/Point2D","../../../chunks/MultiPathImpl","../../../chunks/Envelope2D","../../../chunks/Envelope","../../../chunks/ProjectionTransformation"],function(e,t,s,n,i,r,o,a){"use strict";function m(e,t,s,i){const a=e.getImpl().getAttributeStreamRef(0),m=e.getPointCount(),h=t.getXY(),l=e.createInstance(),u=o.adjustToleranceForTEClustering(s),c=new r.Envelope2D;if(e.queryEnvelope(c),c.inflateCoords(u,u),c.contains(h)){const s=u*u;let i=!1;const r=n.makePrimitiveArray(m,!1);for(let e=0;e<m;e++){const t=a.read(2*e),n=a.read(2*e+1),o=t-h.x,m=n-h.y;o*o+m*m<=s&&(i=!0,r[e]=!0)}if(i)for(let t=0;t<m;t++)r[t]||l.addPoints(e,t,t+1);else l.addPoints(e,0,m),l.add(t)}else l.addPoints(e,0,m),l.add(t);return l}class h extends t.GeometryCursor{constructor(e,t,n,i){super(),this.m_progressTracker=i,this.m_index=-1,this.m_inputGeoms=e,this.m_spatialReference=n,this.m_rightGeom=t.next(),this.m_bEmpty=!this.m_rightGeom,s.throwIfMesh(this.m_rightGeom)}tock(){return!0}getRank(){return 1}next(){if(this.m_bEmpty)return null;const e=this.m_inputGeoms.next();return e?(s.throwIfMesh(e),this.m_index=this.m_inputGeoms.getGeometryID(),function(e,t,h,l){const u=e.getDimension(),c=t.getDimension();if(u!==c)return u>c?e:t;if(e.isEmpty())return t;if(t.isEmpty())return e;const g=new r.Envelope2D,d=new r.Envelope2D,p=new r.Envelope2D;e.queryEnvelope(g),t.queryEnvelope(d),p.setCoords({env2D:g}),p.mergeEnvelope2D(d);const _=o.calculateToleranceFromGeometryForOp(h,p,!0),f=e.getGeometryType(),y=t.getGeometryType();return f===s.GeometryType.enumPoint&&y===s.GeometryType.enumPoint?function(e,t,s){const r=o.adjustToleranceForTEClustering(s),a=r*r,m=e.getXY(),h=t.getXY(),l=new i.MultiPoint({vd:e.getDescription()});return n.Point2D.sqrDistance(m,h)>a&&(l.add(e),l.add(t)),l}(e,t,_):f===s.GeometryType.enumPoint&&y===s.GeometryType.enumMultiPoint?m(t,e,_):f===s.GeometryType.enumMultiPoint&&y===s.GeometryType.enumPoint?m(e,t,_):a.symmetricDifference(e,t,h,l)}(e,this.m_rightGeom,this.m_spatialReference,this.m_progressTracker)):null}getGeometryID(){return this.m_index}}const l=new class{getOperatorType(){return 10003}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}executeMany(e,t,s,n){return new h(e,t,s,n)}execute(e,n,i,r){const o=new t.SimpleGeometryCursor([e]),a=new t.SimpleGeometryCursor([n]),m=this.executeMany(o,a,i,r).next();return m||s.throwInternalErrorException("null output"),m}};e.execute=function(e,t,s){return l.execute(e,t,s,null)},e.executeMany=function(e,s,n){const i=l.executeMany(new t.SimpleGeometryCursor(e),new t.SimpleGeometryCursor([s]),n,null);return Array.from(i)},e.supportsCurves=function(){return l.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/touchesOperator":function(){define(["exports","./OperatorTouches","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";const n=new t.OperatorTouches;function i(e){const t=s.getSpatialReference(e);return n.accelerateGeometry(s.fromGeometry(e),s.fromSpatialReference(t),1)}function r(e,t){return n.execute(s.fromGeometry(e),s.fromGeometry(t),s.fromSpatialReference(e.spatialReference),null)}const o=n.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:i,execute:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=i,e.execute=r,e.supportsCurves=o,e.touchesOperator=a})},"esri/chunks/OperatorTouches":function(){define(["exports","./ProjectionTransformation"],function(e,t){"use strict";class s extends t.OperatorSimpleRelation{getOperatorType(){return 5}execute(e,s,n,i){return t.relate(e,s,n,8,i)}}e.OperatorTouches=s})},"esri/chunks/unionOperator":function(){define(["exports","../geometry/operators/gx/operatorUnion","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";function n(e,n){const i=s.getSpatialReference(e);return s.toGeometry(t.execute(s.fromGeometry(e),s.fromGeometry(n),s.fromSpatialReference(i)),i)}function i(e){const n=e.map(s.fromGeometry),i=s.getSpatialReference(e);return s.toGeometry(t.executeMany(n,s.fromSpatialReference(i)),i)}const r=t.supportsCurves(),o=Object.freeze(Object.defineProperty({__proto__:null,execute:n,executeMany:i,supportsCurves:r},Symbol.toStringTag,{value:"Module"}));e.execute=n,e.executeMany=i,e.supportsCurves=r,e.unionOperator=o})},"esri/geometry/operators/gx/operatorUnion":function(){define(["exports","../../../chunks/SimpleGeometryCursor","../../../chunks/Geometry","../../../chunks/Point2D","../../../chunks/MultiPathImpl","../../../chunks/Envelope2D","../../../chunks/ProjectionTransformation","../../../chunks/Envelope"],function(e,t,s,n,i,r,o,a){"use strict";const m=new o.OperatorUnion;e.execute=function(e,t,s){return m.execute(e,t,s,null)},e.executeMany=function(e,s){return m.executeMany(new t.SimpleGeometryCursor(e),s,null).next()},e.supportsCurves=function(){return m.supportsCurves()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/withinOperator":function(){define(["exports","./OperatorWithin","../geometry/operators/support/apiConverter"],function(e,t,s){"use strict";const n=new t.OperatorWithin;function i(e){const t=s.getSpatialReference(e);return n.accelerateGeometry(s.fromGeometry(e),s.fromSpatialReference(t),1)}function r(e,t){return n.execute(s.fromGeometry(e),s.fromGeometry(t),s.fromSpatialReference(e.spatialReference),null)}const o=n.supportsCurves(),a=Object.freeze(Object.defineProperty({__proto__:null,accelerateGeometry:i,execute:r,supportsCurves:o},Symbol.toStringTag,{value:"Module"}));e.accelerateGeometry=i,e.execute=r,e.supportsCurves=o,e.withinOperator=a})},"esri/chunks/OperatorWithin":function(){define(["exports","./ProjectionTransformation"],function(e,t){"use strict";class s extends t.OperatorSimpleRelation{getOperatorType(){return 7}execute(e,s,n,i){return t.relate(e,s,n,2,i)}}e.OperatorWithin=s})},"*noref":1}}),define(["exports","../../chunks/OperatorDefinitions","../../geometry/operators/affineTransformOperator","../../chunks/geodesicBufferOperator","../../chunks/geodeticAreaOperator","../../chunks/geodeticDensifyOperator","../../chunks/geodeticLengthOperator","../../geometry/operators/simplifyOGCOperator","../../geometry/operators/support/Transformation","../../chunks/areaOperator","../../chunks/bufferOperator","../../chunks/centroidOperator","../../chunks/clipOperator","../../chunks/containsOperator","../../chunks/convexHullOperator","../../chunks/crossesOperator","../../chunks/cutOperator","../../chunks/densifyOperator","../../chunks/differenceOperator","../../chunks/disjointOperator","../../chunks/distanceOperator","../../chunks/equalsOperator","../../chunks/generalizeOperator","../../chunks/intersectionOperator","../../chunks/intersectsOperator","../../chunks/labelPointOperator","../../chunks/lengthOperator","../../chunks/offsetOperator","../../chunks/overlapsOperator","../../chunks/proximityOperator","../../chunks/relateOperator","../../chunks/simplifyOperator","../../chunks/symmetricDifferenceOperator","../../chunks/touchesOperator","../../chunks/unionOperator","../../chunks/withinOperator"],function(e,t,s,n,i,r,o,a,m,h,l,u,c,g,d,p,_,f,y,x,P,E,v,C,D,b,S,I,w,T,A,N,G,M,R,k){"use strict";const F=new Set([5,6,7,10,11,12]);e.geodesicBuffer=n.geodesicBufferOperator,e.geodeticArea=i.geodeticAreaOperator,e.geodeticDensify=r.geodeticDensifyOperator,e.geodeticLength=o.geodeticLengthOperator,e.area=h.areaOperator,e.buffer=l.bufferOperator,e.centroid=u.centroidOperator,e.clip=c.clipOperator,e.contains=g.containsOperator,e.convexHull=d.convexHullOperator,e.crosses=p.crossesOperator,e.cut=_.cutOperator,e.densify=f.densifyOperator,e.difference=y.differenceOperator,e.disjoint=x.disjointOperator,e.distance=P.distanceOperator,e.equals=E.equalsOperator,e.generalize=v.generalizeOperator,e.intersection=C.intersectionOperator,e.intersects=D.intersectsOperator,e.labelPoint=b.labelPointOperator,e.length=S.lengthOperator,e.offset=I.offsetOperator,e.overlaps=w.overlapsOperator,e.proximity=T.proximityOperator,e.relate=A.relateOperator,e.simplify=N.simplifyOperator,e.symmetricDifference=G.symmetricDifferenceOperator,e.touches=M.touchesOperator,e.union=R.unionOperator,e.within=k.withinOperator,e.isSelfIntersecting=function(e){const s=new t.NonSimpleResult;return!a.isSimple(e,s)&&F.has(s.m_reason)},e.loadAll=async function(){await Promise.all([i.load(),n.load(),r.load(),o.load()])},e.rotate=function(e,t,n,i){const r=(new m).rotate(t,n,i);return s.execute(e,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});