// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./ArcadeDate","./executionError","./ImmutableArray","../chunks/languageUtils","../support/guards"],function(e,t,r,i,n,o){"use strict";const s="Voxel.Position",a="Voxel.LocalTime";e.Voxel=class{constructor(e,t){this._graphic=e,this._timeZone=t,this.arcadeDeclaredClass="esri.arcade.Voxel",this._layer=e.sourceLayer}getPosition(){return void 0!==this._position?this._position:this._position=function(e){const t=e.getAttribute(s);if("string"!=typeof t)throw new r.ArcadeExecutionError(null,"InvalidParameter",null);const n=JSON.parse(t);if(!Array.isArray(n)||"number"!=typeof n[0]||"number"!=typeof n[1]||"number"!=typeof n[2])throw new r.ArcadeExecutionError(null,"InvalidParameter",null);return new i(n)}(this._graphic)}getLocalTime(){return void 0!==this._localTime?this._localTime:this._localTime=function(e,i){const n=e.getAttribute(a);if(null==n)return null;if(!o.isDate(n))throw new r.ArcadeExecutionError(null,"InvalidParameter",null);return t.ArcadeDate.dateJSAndZoneToArcadeDate(n,i)}(this._graphic,this._timeZone??"system")}keys(){return this._layer.fields.map(e=>e.name).sort()}hasField(e){return this._layer.fieldsIndex.has(e)}field(e){const t=this._layer.fieldsIndex?.get(e)?.name;if(null==t)throw new r.ArcadeExecutionError(null,"FieldNotFound",null,{key:e});switch(t){case s:return this.getPosition();case a:return this.getLocalTime()}return this._graphic.attributes[t]??null}castToText(e=!1){const t={...this._graphic.attributes};t[s]=this.getPosition(),a in t&&(t[a]=this.getLocalTime());for(const e of Object.keys(t))this._layer.fieldsIndex?.has(e)||delete t[e];return n.castRecordToText(t,{useNumbersForDates:e})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});