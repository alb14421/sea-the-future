// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./errorsupport","./shared","./sqlUtils","../../../core/sql/DateOnly","../../../core/sql/SqlTimestampOffset","../../../core/sql/TimeOnly"],function(t,e,n,r,a,i,c){"use strict";function s(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}function l(t){const e=s(t);let n=0;for(let r=0;r<t.length;r++)n+=(e-t[r])**2;return n/t.length}function u(t){const e=s(t);let n=0;for(let r=0;r<t.length;r++)n+=(e-t[r])**2;return n/(t.length-1)}function o(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}async function f(t,n,r){const s=t.iterator(r),l=[],u={ticker:0};let o=await s.next();for(;null!==o;){if(u.ticker++,r.aborted)throw new e.FeatureSetError("Cancelled");u.ticker%100==0&&(u.ticker=0,await new Promise(t=>{setTimeout(t,0)}));const t=n?.calculateValue(o);null===t||(t instanceof a.DateOnly||t instanceof c.TimeOnly?l[l.length]=t.toNumber():t instanceof i.SqlTimeStampOffset?l[l.length]=t.toMilliseconds():l[l.length]=t),o=await s.next()}return l}t.calculateStat=function(t,e,r=1e3){switch(t.toLowerCase()){case"distinct":return function(t,e){const r=[],a={},i=[];for(let c=0;c<t.length;c++){if(void 0!==t[c]&&null!==t[c]){const e=t[c];if(n.isNumber(e)||n.isString(e))void 0===a[e]&&(r.push(e),a[e]=1);else{let t=!1;for(let r=0;r<i.length;r++)!0===n.equalityTest(i[r],e)&&(t=!0);!1===t&&(i.push(e),r.push(e))}}if(r.length>=e&&-1!==e)return r}return r}(e,r);case"avg":case"mean":return s(e);case"min":return Math.min.apply(Math,e);case"sum":return o(e);case"max":return Math.max.apply(Math,e);case"stdev":case"stddev":return Math.sqrt(l(e));case"var":case"variance":return l(e);case"count":return e.length}return 0},t.count=async function(t,e){return t.iterator(e).count()},t.decodeStatType=function(t){switch(t.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""},t.distinct=async function(t,n,r=1e3,s=null){const l=t.iterator(s),u=[],o={},f={ticker:0};let h=await l.next();for(;null!==h;){if(f.ticker++,s?.aborted)throw new e.FeatureSetError("Cancelled");f.ticker%100==0&&(f.ticker=0,await new Promise(t=>{setTimeout(t,0)}));const t=n?.calculateValue(h);let m=t;if(t instanceof a.DateOnly?m="!!DATEONLY!!-"+t.toString():t instanceof i.SqlTimeStampOffset?m="!!TSOFFSETONLY!!-"+t.toString():t instanceof c.TimeOnly?m="!!TIMEONLY!!-"+t.toString():t instanceof Date&&(m="!!DATE!!-"+t.toString()),null!=t&&void 0===o[m]&&(u.push(t),o[m]=1),u.length>=r&&-1!==r)return u;h=await l.next()}return u},t.max=async function(t,e,n){const r=await f(t,e,n);return 0===r.length?null:Math.max.apply(Math,r)},t.mean=async function(t,e,n){let a="";e&&!r.isSingleField(e)&&(a=r.predictType(e,t.fields));const i=await f(t,e,n);if(0===i.length)return null;const c=s(i);return null===c?c:"integer"===a?(l=+(l=c),isFinite(l)?l-l%1||(l<0?-0:0===l?l:0):l):c;var l},t.min=async function(t,e,n){const r=await f(t,e,n);return 0===r.length?null:Math.min.apply(Math,r)},t.stdev=async function(t,e,n){const r=await f(t,e,n);return 0===r.length?null:Math.sqrt(u(r))},t.sum=async function(t,e,n){const r=await f(t,e,n);return 0===r.length?null:o(r)},t.variance=async function(t,e,n){const r=await f(t,e,n);return 0===r.length?null:u(r)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});