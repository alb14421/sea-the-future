// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],function(t,n,o,e,i){"use strict";function r(t){let n=1/0,o=-1/0,e=1/0,i=-1/0;for(const r of t)for(const t of r)t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<e&&(e=t[1]),t[1]>i&&(i=t[1]);return[n,e,o,i]}function a(t){return t?t.rings?r(t.rings):t.paths?r(t.paths):o.isExtent(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function l(t,o){const e=2*o,i=t.length,r=new Uint8Array(4*i);for(let o=0;o<i;++o){const i=.5-t[o]/e;n.packFloatRGBA(i,r,4*o)}return r}t.buildSDF=function(t){const n=(o=t.geom)?o.rings?o.rings:o.paths?o.paths:void 0!==o.xmin&&void 0!==o.ymin&&void 0!==o.xmax&&void 0!==o.ymax?[[[o.xmin,o.ymin],[o.xmin,o.ymax],[o.xmax,o.ymax],[o.xmax,o.ymin],[o.xmin,o.ymin]]]:null:null;var o;const r=function(t){let n=1/0,o=-1/0,i=1/0,r=-1/0;for(const e of t)for(const t of e)t[0]<n&&(n=t[0]),t[0]>o&&(o=t[0]),t[1]<i&&(i=t[1]),t[1]>r&&(r=t[1]);return new e(n,i,o-n,r-i)}(n),a=i.defaultSdfTextureSize,s=i.spritePadding,f=Math.floor(.5*(a*t.sdfPaddingRatio-s)),c=a-2*(f+s),u=c/Math.max(r.width,r.height),d=Math.round(r.width*u)+2*f,m=Math.round(r.height*u)+2*f,h=[];for(const o of n)if(o&&o.length>1){const n=[];for(const e of o){let[o,i]=e;o-=r.x,i-=r.y,o*=u,i*=u,o+=f-.5,i+=f-.5,t.asFill?n.push([o,i]):n.push([Math.round(o),Math.round(i)])}if(t.asFill){const t=n.length-1;n[0][0]===n[t][0]&&n[0][1]===n[t][1]||n.push(n[0])}h.push(n)}const y=function(t,n,o,e){const i=n*o,r=new Array(i),a=e*e+1;for(let t=0;t<i;++t)r[t]=a;for(const i of t){const t=i.length;for(let a=1;a<t;++a){const t=i[a-1],l=i[a];let s,f,c,u;t[0]<l[0]?(s=t[0],f=l[0]):(s=l[0],f=t[0]),t[1]<l[1]?(c=t[1],u=l[1]):(c=l[1],u=t[1]);let d=Math.floor(s)-e,m=Math.floor(f)+e,h=Math.floor(c)-e,y=Math.floor(u)+e;d<0&&(d=0),m>n&&(m=n),h<0&&(h=0),y>o&&(y=o);const x=l[0]-t[0],g=l[1]-t[1],M=x*x+g*g;for(let e=d;e<m;e++)for(let i=h;i<y;i++){const a=e+.5,s=i+.5;let f,c,u=(a-t[0])*x+(s-t[1])*g;u<0?(f=t[0],c=t[1]):u>M?(f=l[0],c=l[1]):(u/=M,f=t[0]+u*x,c=t[1]+u*g);const d=(a-f)*(a-f)+(s-c)*(s-c),m=(o-i-1)*n+e;d<r[m]&&(r[m]=d)}}}for(let t=0;t<i;++t)r[t]=Math.sqrt(r[t]);return r}(h,d,m,f);return t.asFill&&function(t,n,o,e,i){for(const r of t){const t=r.length;for(let a=1;a<t;++a){const t=r[a-1],l=r[a];let s,f,c,u;t[0]<l[0]?(s=t[0],f=l[0]):(s=l[0],f=t[0]),t[1]<l[1]?(c=t[1],u=l[1]):(c=l[1],u=t[1]);let d=Math.floor(s),m=Math.floor(f)+1,h=Math.floor(c),y=Math.floor(u)+1;d<e&&(d=e),m>n-e&&(m=n-e),h<e&&(h=e),y>o-e&&(y=o-e);for(let r=h;r<y;++r){if(t[1]>r==l[1]>r)continue;const a=r+.5,s=(o-r-1)*n;for(let n=d;n<m;++n)n+.5<(l[0]-t[0])*(a-t[1])/(l[1]-t[1])+t[0]&&(i[s+n]=-i[s+n]);for(let t=e;t<d;++t)i[s+t]=-i[s+t]}}}}(h,d,m,f,y),{data:l(y,f),width:d,height:m,sdfPaddingRatio:t.sdfPaddingRatio,sdfDecodeCoeff:2*f/c}},t.getExtent=a,t.getSDFDimensions=function(t,n){const[o,e,r,l]=a(t),s=r-o,f=l-e,c=i.defaultSdfTextureSize,u=i.spritePadding,d=Math.floor(.5*(c*n-u)),m=(c-2*(d+u))/Math.max(s,f),h=Math.round(s*m),y=Math.round(f*m);return{pixelDimensions:[s,f],texelDimensions:[Math.round((h+2*d)/m),Math.round((y+2*d)/m)]}},t.getSDFInfo=function t(n,o=.5){switch(n.type){case"CIMPointSymbol":{const o=n.symbolLayers;if(!o||1!==o.length)return null;const e=o[0];return"CIMVectorMarker"!==e.type?null:t(e)}case"CIMVectorMarker":{const t=n.markerGraphics;if(!t||1!==t.length)return null;const e=t[0];if(!e)return null;const i=e.geometry;if(!i)return null;const r=e.symbol;return!r||"CIMPolygonSymbol"!==r.type&&"CIMLineSymbol"!==r.type||r.symbolLayers?.some(t=>!!t.effects)?null:{type:"sdf",geom:i,sdfPaddingRatio:o,asFill:"CIMPolygonSymbol"===r.type}}}},t.getSDFMetrics=function(t,n,o,e,r,a,l){const[s,f,c,u]=t;if(c<s||u<f)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const d=c-s,m=u-f,h=Math.max(d,m);let y=.5;if(null!=a&&null!=o){l||null==n||(a*=(n.ymax-n.ymin)/o);const t=a/(a+h),e=.1;t>.45&&t<1&&(y=Math.min(t+e,.99))}const x=i.defaultSdfTextureSize,g=i.spritePadding,M=Math.floor(.5*(x*y-g)),p=(x-2*(M+g))/h,S=Math.round(d*p)+2*M,P=Math.round(m*p)+2*M;let R=1;n&&(R=P*(1-y)/((n.ymax-n.ymin)*p));let b=0,w=0,F=1;e&&(r?n&&o&&n.ymax-n.ymin>0&&(F=(n.xmax-n.xmin)/(n.ymax-n.ymin),b=e.x/(o*F),w=e.y/o):(b=e.x,w=e.y)),n&&(b=.5*(n.xmax+n.xmin)+b*(n.xmax-n.xmin),w=.5*(n.ymax+n.ymin)+w*(n.ymax-n.ymin)),b-=s,w-=f,b*=p,w*=p,b+=M,w+=M;let D=b/S-.5,v=w/P-.5;return r&&o&&(D*=o*F,v*=o),{frameSizeRatio:R,anchorX:D,anchorY:v,widthRatio:F,sdfPaddingRatio:y}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});