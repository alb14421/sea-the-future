// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../CIMCursor","../CurveHelper"],function(e,t,n){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,n){return new s(e,t,n)}}class s extends t.PathTransformationCursor{constructor(e,t,i){super(e),this._curveHelper=new n.CurveHelper,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*i:0,this._epsilon=.001*i}processPath(e){const t=this._position;if("SegmentMidpoint"===this._relativeTo){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[t,n]=[e.x,e.y],[i,s]=[0,0];const r=[0,0];for(;e.nextPoint();){i=e.x,s=e.y;const o=this._curveHelper.getLength(t,n,i,s);if(o<this._epsilon){t=i,n=s;continue}const a=.5+this._position/o,[l,h]=this._curveHelper.getAngleCS(r,t,n,i,s,a),c=this._curveHelper.getCoord2D(t,n,i,s,a);return this.internalPlacement.setTranslate(c[0]-this._offset*h,c[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(l,h),this.internalPlacement}}return this.iteratePath=!1,null}const n="LineEnd"===this._relativeTo;return this.onLine(e,t,n)}onLine(e,t,n){let i,s=!1;switch(this._relativeTo){case"LineMiddle":default:e.seekPathStart(),i=e.pathLength()/2+t;break;case"LineBeginning":i=t;break;case"LineEnd":i=t,s=!0}n?e.seekPathEnd():e.seekPathStart();let r=0;if(n?e.prevPoint():e.nextPoint()){let[t,o]=[e.x,e.y],[a,l]=[0,0];const h=[0,0];for(;n?e.prevPoint():e.nextPoint();){a=e.x,l=e.y;const n=this._curveHelper.getLength(t,o,a,l);if(r+n>i){const e=(i-r)/n,[c,u]=this._curveHelper.getAngleCS(h,t,o,a,l,e),f=this._curveHelper.getCoord2D(t,o,a,l,e),P=s?-this._offset:this._offset;return this.internalPlacement.setTranslate(f[0]-P*u,f[1]+P*c),this._angleToLine&&(s?this.internalPlacement.setRotateCS(-c,-u):this.internalPlacement.setRotateCS(c,u)),this.internalPlacement}t=a,o=l,r+=n}}return null}}e.PlacementOnLine=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});