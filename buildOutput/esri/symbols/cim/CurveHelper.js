// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../geometry/GeometryCursor"],function(t,e){"use strict";t.CurveHelper=class{constructor(t=0,e=!1){}isEmpty(t){if(!t.nextPoint())return!0;let e,n,s,r;for(e=t.x,n=t.y;t.nextPoint();e=n,n=r)if(s=t.x,r=t.y,s!==e||r!==n)return t.seekPathStart(),!1;return t.seekPathStart(),!0}normalize(t){const e=Math.sqrt(t[0]*t[0]+t[1]*t[1]);0!==e&&(t[0]/=e,t[1]/=e)}getLength(t,e,n,s){const r=n-t,o=s-e;return Math.sqrt(r*r+o*o)}getSegLength(t){const[[e,n],[s,r]]=t;return this.getLength(e,n,s,r)}getCoord2D(t,e,n,s,r){return[t+(n-t)*r,e+(s-e)*r]}getSegCoord2D(t,e){const[[n,s],[r,o]]=t;return this.getCoord2D(n,s,r,o,e)}getAngle(t,e,n,s,r){const o=n-t,i=s-e;return Math.atan2(i,o)}getAngleCS(t,e,n,s,r,o){null==t&&(t=[0,0]);const i=s-e,u=r-n,l=Math.sqrt(i*i+u*u);return 0!==l?(t[0]=i/l,t[1]=u/l,t):(t[0]=1,t[1]=0,t)}getSegAngleCS(t,e,n){const[[s,r],[o,i]]=e;return this.getAngleCS(t,s,r,o,i,n)}cut(t,e,n,s,r,o){return[r<=0?[t,e]:this.getCoord2D(t,e,n,s,r),o>=1?[n,s]:this.getCoord2D(t,e,n,s,o)]}getSubCurve(t,n,s){const r=e.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(r,t,n,s)?r:null}appendSubCurve(t,e,n,s){t.startPath(),e.seekPathStart();let r=0,o=!0;if(!e.nextPoint())return!1;let i=e.x,u=e.y;for(;e.nextPoint();){const l=this.getLength(i,u,e.x,e.y);if(0!==l){if(o){if(r+l>n){const h=(n-r)/l;let c=1,a=!1;r+l>=s&&(c=(s-r)/l,a=!0);const f=this.cut(i,u,e.x,e.y,h,c);if(f&&t.pushPoints(f),a)break;o=!1}}else{if(r+l>s){const n=this.cut(i,u,e.x,e.y,0,(s-r)/l);n&&t.pushPoint(n[1]);break}t.pushXY(e.x,e.y)}r+=l,i=e.x,u=e.y}else i=e.x,u=e.y}return!0}getCIMPointAlong(t,e){if(!t.nextPoint())return null;let n,s,r,o,i=0;for(n=t.x,s=t.y;t.nextPoint();n=r,s=o){r=t.x,o=t.y;const u=this.getLength(n,s,r,o);if(0!==u){if(i+u>e){const t=(e-i)/u;return this.getCoord2D(n,s,r,o,t)}i+=u}}return null}offset(t,e,n,s,r){if(!t||t.length<2)return null;let o=0,i=t[o++],u=o;for(;o<t.length;){const e=t[o];e[0]===i[0]&&e[1]===i[1]||(o!==u&&(t[u]=t[o]),i=t[u++]),o++}const l=t[0][0]===t[u-1][0]&&t[0][1]===t[u-1][1];if(l&&--u,u<(l?3:2))return null;const h=[];i=l?t[u-1]:null;let c=t[0];for(let r=0;r<u;r++){const o=r===u-1?l?t[0]:null:t[r+1];if(i)if(o){const t=[o[0]-c[0],o[1]-c[1]];this.normalize(t);const r=[c[0]-i[0],c[1]-i[1]];this.normalize(r);const u=r[0]*t[1]-r[1]*t[0],l=r[0]*t[0]+r[1]*t[1];if(0===u&&1===l){c=o;continue}if(u>=0==e<=0){if(l<1){const n=[t[0]-r[0],t[1]-r[1]];this.normalize(n);const o=Math.sqrt((1+l)/2);if(o>1/s){const t=-Math.abs(e)/o;h.push([c[0]-n[0]*t,c[1]-n[1]*t])}}}else switch(n){case"Mitered":{const n=Math.sqrt((1+l)/2);if(n>0&&1/n<s){const s=[t[0]-r[0],t[1]-r[1]];this.normalize(s);const o=Math.abs(e)/n;h.push([c[0]-s[0]*o,c[1]-s[1]*o]);break}}case"Bevelled":h.push([c[0]+r[1]*e,c[1]-r[0]*e]),h.push([c[0]+t[1]*e,c[1]-t[0]*e]);break;case"Rounded":if(l<1){h.push([c[0]+r[1]*e,c[1]-r[0]*e]);const n=Math.floor(2.5*(1-l));if(n>0){const s=1/n;let o=s;for(let i=1;i<n;i++,o+=s){const n=[r[1]*(1-o)+t[1]*o,-r[0]*(1-o)-t[0]*o];this.normalize(n),h.push([c[0]+n[0]*e,c[1]+n[1]*e])}}h.push([c[0]+t[1]*e,c[1]-t[0]*e])}break;default:if(u<0)h.push([c[0]+(r[1]+r[0])*e,c[1]+(r[1]-r[0])*e]),h.push([c[0]+(t[1]-t[0])*e,c[1]-(t[0]+t[1])*e]);else{const n=Math.sqrt((1+Math.abs(l))/2),s=[t[0]-r[0],t[1]-r[1]];this.normalize(s);const o=e/n;h.push([c[0]-s[0]*o,c[1]-s[1]*o])}}}else{const t=[c[0]-i[0],c[1]-i[1]];this.normalize(t),h.push([c[0]+t[1]*e,c[1]-t[0]*e])}else{const t=[o[0]-c[0],o[1]-c[1]];this.normalize(t),h.push([c[0]+t[1]*e,c[1]-t[0]*e])}i=c,c=o}return h.length<(l?3:2)?null:(l&&h.push([h[0][0],h[0][1]]),h)}},t.pixelTolerance=.03,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});