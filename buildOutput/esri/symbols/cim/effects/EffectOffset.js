// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/SpatialReference","../../../geometry/support/jsonUtils","../CIMEffects","../CurveHelper"],function(e,t,r,s,i,o,n){"use strict";class f{static{this.instance=null}static local(){return null===f.instance&&(f.instance=new f),f.instance}execute(e,t,r,s,i,o){return new l(e,t,r,s,i,o)}}class l{constructor(e,t,r,s,i,o){this._preventClipping=o,this._inputGeometries=e,this._tileKey=s,this._curveHelper=new n.CurveHelper,this._offset=(t.offset??1)*r,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(i*r),10),this._option=t.option,this._offsetFlattenError=n.pixelTolerance*r}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if("Rounded"===this._method&&this._offset>0){const s=r.collectPath(e),i=this._curveHelper.offset(s,-this._offset,this._method,4,this._offsetFlattenError);if(i){const r=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);return r.pushPath(i),r}return null}const s=e.asJSON();if(i.isExtent(s)&&Math.min(s.xmax-s.xmin,s.ymax-s.ymin)+2*this._offset>0)return t.GeometryCursor.fromJSONCIM({xmin:s.xmin-this._offset,xmax:s.xmax+this._offset,ymin:s.ymin-this._offset,ymax:s.ymax+this._offset})}const n=!this._preventClipping&&this._tileKey?o.clipCursorToTileExtent(e,this._maxInflateSize,!0):e.clone();if(!n)continue;const f=o.lazyOffsetOperator.module,l={...n.asJSON(),spatialReference:{wkid:s.WebMercator.wkid}},u=f.execute(l,-this._offset,{joins:a(this._method),flattenError:this._offsetFlattenError,miterLimit:4});return u?t.GeometryCursor.fromJSONCIM(u):null}return null}}function a(e){switch(e){case"Rounded":return"round";case"Bevelled":return"bevel";case"Mitered":return"miter";case"Square":return"square"}}e.EffectOffset=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});