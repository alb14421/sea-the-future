// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/SpatialReference","../CIMEffects","../CurveHelper"],function(e,t,i,r,s,n){"use strict";class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i,r,s,n){return new l(e,t,i,r,s,n)}}class l{constructor(e,t,i,r,s,o){this._preventClipping=o,this._inputGeometries=e,this._tileKey=r,this._curveHelper=new n.CurveHelper,this._size=(void 0!==t.size?t.size:1)*i,this._maxInflateSize=s*i,this._offsetFlattenError=n.pixelTolerance*i}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===e.geometryType)if(this._size>0){const r=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType),s=i.collectMultipath(e)[0],n=this._curveHelper.offset(s,this._size,"Rounded",4,this._offsetFlattenError);if(n)return r.pushPath(n),r}else if(this._size<0){const i=e.asJSON();if(Math.min(i.xmax-i.xmin,i.ymax-i.ymin)+2*this._size>0)return t.GeometryCursor.fromJSONCIM({xmin:i.xmin-this._size,xmax:i.xmax+this._size,ymin:i.ymin-this._size,ymax:i.ymax+this._size})}const n=!this._preventClipping&&this._tileKey?s.clipCursorToTileExtent(e,this._maxInflateSize,!0):e;if(!n)continue;const o=s.lazyBufferOperator.module,l={...n.asJSON(),spatialReference:{wkid:r.WebMercator.wkid}},a=o.execute(l,this._size);return a?t.GeometryCursor.fromJSONCIM(a):null}return null}}e.EffectBuffer=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});