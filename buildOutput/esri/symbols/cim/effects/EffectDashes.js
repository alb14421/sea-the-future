// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../GeometryWalker","../utils"],function(t,e,s,r,a,i){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(t,e,s){return new h(t,e,s)}}class h extends r.PathEffectCursor{constructor(t,e,s){super(t,!0,!0),this._firstCurve=null,this._walker=new a.GeometryWalker,this._walker.updateTolerance(s),this._endings=e.lineDashEnding,this._customDashPos=-(e.offsetAlongLine??0)*s,this._offsetAtEnd=(e.customEndingOffset??0)*s;let r=i.normalizeDashEffectTemplate(e).dashTemplate;null==r&&(r=[]),r.length%2&&(r=[...r,...r]),this._pattern=new a.DashPattern,this._pattern.init(r,!0),this._pattern.scale(s)}processPath(t){if(0===this._pattern.length()){this.iteratePath=!1;const r=s.collectPath(t);return e.GeometryCursor.fromJSONCIM({paths:[r]})}if(!this.iteratePath){let r=!0;switch(this._endings){case"HalfPattern":case"HalfGap":default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(r=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const a=t.pathLength();if(this._pattern.isEmpty()||a<.1*this._pattern.length()){const r=s.collectPath(t);return e.GeometryCursor.fromJSONCIM({paths:[r]})}if(!this._walker.init(t,this._pattern,r)){const r=s.collectPath(t);return e.GeometryCursor.fromJSONCIM({paths:[r]})}}let r;if(this.iteratePath)r=this._pattern.nextValue();else{let t;switch(this._endings){case"HalfPattern":default:t=.5*this._pattern.firstValue();break;case"HalfGap":t=.5*-this._pattern.lastValue();break;case"FullGap":t=-this._pattern.lastValue();break;case"FullPattern":t=0;break;case"NoConstraint":case"Custom":t=-this._customDashPos}let e=t/this._pattern.length();e-=Math.floor(e),t=e*this._pattern.length(),this._pattern.reset(),r=this._pattern.nextValue();let s=!1;for(;t>=r;)t-=r,r=this._pattern.nextValue(),s=!s;r-=t,s?(this._walker.nextPosition(r),r=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(r),r=this._pattern.nextValue(),this._walker.nextPosition(r),r=this._pattern.nextValue())}let a=this._walker.nextCurve(r);if(a)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)a.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else r=this._pattern.nextValue(),!this._walker.nextPosition(r)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(a.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,a=this._firstCurve,this._firstCurve=null;return a?.reset(),a}}t.EffectDashes=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});