// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../request","../../core/Error","../../core/has","../../core/promiseUtils","../../core/urlUtils","../../portal/Portal","../../portal/PortalQueryParams","./styleCache"],function(e,t,r,o,s,l,n,a,u){"use strict";function c(e,t){if(!o("enable-feature:force-wosr"))return e.formatInfos?.find(e=>e.type===t)?.href}function f(e,r){const o={responseType:"json",query:{f:"json"},...r};return t(l.normalize(e),o)}const i="esri_en",y="Style";e.Style2DUrlTemplate="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",e.fetchStyle=function(e,t,o){return null!=e?.styleUrl?async function(e,t){try{return{data:(await f(e,t)).data,baseUrl:l.removeFile(e),styleUrl:e}}catch(e){return s.throwIfAbortError(e),null}}(e.styleUrl,o):null!=e?.styleName?function(e,t,o){const s=null!=t.portal?t.portal:n.getDefault();let l;const c=`${s.url} - ${s.user?.username} - ${e}`,f=u.cachedStyles.get(c);if(f)return f;const m=function(e,t,o){return t.load(o).then(()=>{const r=new a({disableExtraQuery:!0,query:`owner:${i} AND type:${y} AND typekeywords:"${e}"`});return t.queryItems(r,o)}).then(({results:t})=>{let s=null;const l=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const t=e.typeKeywords?.some(e=>e.toLowerCase()===l);if(t&&e.type===y&&e.owner===i){s=e;break}}if(!s)throw new r("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return s.load(o)})}(e,s,o).then(e=>(l=e,e.fetchData())).then(t=>({data:t,baseUrl:l.itemUrl??"",styleName:e}));return u.cachedStyles.set(c,m),m}(e.styleName,t,o):Promise.reject(new r("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))},e.makeCIMSymbolRef=function(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}},e.requestJSON=f,e.symbolUrlFromStyleItem=function(e,t){for(const r of t)switch(r){case"cim":if(e.cimRef)return{format:r,url:encodeURI(e.cimRef)};break;case"web-gltf-basisu":{const t=c(e,"gltf_basisu");if(t)return{format:r,url:t};break}case"web-gltf":{const t=c(e,"gltf");if(t)return{format:r,url:t};break}case"web":{const t=c(e,"gltf");if(t)return{format:"web-gltf",url:t};if(e.webRef)return{format:r,url:encodeURI(e.webRef)};break}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});