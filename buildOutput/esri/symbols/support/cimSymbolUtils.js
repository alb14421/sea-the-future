// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../Color","../cim/utils"],function(e,o,t){"use strict";function r(e){const o=t.toCIMSymbolJSON(e);if("CIMTextSymbol"===o?.type)return o.height??0;let r=0;if(o?.symbolLayers)for(const e of o.symbolLayers)t.isCIMMarker(e)&&null!=e.size&&e.size>r?r=e.size:t.isCIMStroke(e)&&null!=e.width&&e.width>r?r=e.width:t.isCIMFill(e);return r}function a(e,o,t,r){if(e)if("CIMTextSymbol"!==e.type){if(t&&e.effects)for(const t of e.effects)n(t,o);if(e.symbolLayers)for(const t of e.symbolLayers){switch(t.type){case"CIMPictureMarker":case"CIMVectorMarker":s(t,o,r);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!r?.preserveOutlineWidth&&t.width&&(t.width*=o);break;case"CIMPictureFill":t.height&&(t.height*=o),t.offsetX&&(t.offsetX*=o),t.offsetY&&(t.offsetY*=o);break;case"CIMHatchFill":a(t.lineSymbol,o,!0,{...r,preserveOutlineWidth:!1}),t.offsetX&&(t.offsetX*=o),t.offsetY&&(t.offsetY*=o),t.separation&&(t.separation*=o)}if(t.effects)for(const e of t.effects)n(e,o)}}else null!=e.height&&(e.height*=o)}function s(e,o,r){if(e&&(e.markerPlacement&&function(e,o){switch(t.isCIMMarkerStrokePlacement(e)&&e.offset&&(e.offset*=o),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=o),e.offsetAlongLine&&(e.offsetAlongLine*=o),e.placementTemplate&&e.placementTemplate.length){const t=e.placementTemplate.map(e=>e*o);e.placementTemplate=t}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=o),e.placementTemplate&&e.placementTemplate.length){const t=e.placementTemplate.map(e=>e*o);e.placementTemplate=t}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=o);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=o);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=o),e.endPosition&&(e.endPosition*=o);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=o),e.offsetY&&(e.offsetY*=o);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=o),e.offsetY&&(e.offsetY*=o),e.stepX&&(e.stepX*=o),e.stepY&&(e.stepY*=o)}}(e.markerPlacement,o),e.offsetX&&(e.offsetX*=o),e.offsetY&&(e.offsetY*=o),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*o,y:e.anchorPoint.y*o}),e.size=null!=e.size?e.size*o:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const t of e.markerGraphics)e.scaleSymbolsProportionally||a(t.symbol,o,!0,r)}function n(e,o){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=o);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=o);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=o),e.endCut&&(e.endCut*=o),e.middleCut&&(e.middleCut*=o);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=o),e.offsetAlongLine&&(e.offsetAlongLine*=o),e.dashTemplate&&e.dashTemplate.length){const t=e.dashTemplate.map(e=>e*o);e.dashTemplate=t}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=o);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=o),e.offsetY&&(e.offsetY*=o);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=o);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=o);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=o),e.length&&(e.length*=o),e.toWidth&&(e.toWidth*=o);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=o),e.period&&(e.period*=o)}}function i(e,o){if(!e)return;let r;r="CIMTextSymbol"===e.type?e.symbol:e;const a="CIMPolygonSymbol"===e.type;if(r?.symbolLayers)for(const e of r.symbolLayers)if(!(e.colorLocked||a&&(t.isCIMStroke(e)||t.isCIMMarker(e)&&e.markerPlacement&&t.isCIMMarkerStrokePlacement(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&l(o,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach(e=>{i(e.symbol,o)});break;case"CIMSolidStroke":case"CIMSolidFill":l(o,e.color);break;case"CIMGradientFill":c(o,e);break;case"CIMHatchFill":i(e.lineSymbol,o)}}function l(e,o){for(const t of e)if(t.join(".")===o.join("."))return;e.push(o)}function c(e,o){const t=o.colorRamp?.type;switch(t){case"CIMMultipartColorRamp":o.colorRamp.colorRamps?.forEach(o=>{"CIMLinearContinuousColorRamp"===o.type&&f(e,o)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":f(e,o.colorRamp)}}function f(e,o){o&&(o.fromColor&&l(e,o.fromColor),o.toColor&&l(e,o.toColor))}function m(e,o,r){if(!e)return;let a;a="CIMTextSymbol"===e.type?e.symbol:e;const s="CIMPolygonSymbol"===a?.type;if(a?.symbolLayers)for(const e of a.symbolLayers){if(e.colorLocked)continue;if(s)if(r){const{layersToColor:o}=r;if((t.isCIMStroke(e)||t.isCIMMarker(e)&&e.markerPlacement&&t.isCIMMarkerStrokePlacement(e.markerPlacement))&&"fill"===o||t.isCIMFill(e)&&"outline"===o)continue}else if(t.isCIMStroke(e)||t.isCIMMarker(e)&&e.markerPlacement&&t.isCIMMarkerStrokePlacement(e.markerPlacement))continue;const a=o.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=a;break;case"CIMVectorMarker":e.markerGraphics?.forEach(e=>{m(e.symbol,o,r)});break;case"CIMSolidStroke":case"CIMSolidFill":e.color=a;break;case"CIMGradientFill":C(e,o);break;case"CIMHatchFill":m(e.lineSymbol,o,r)}}}function C(e,o){const t=e.colorRamp?.type;switch(t){case"CIMMultipartColorRamp":e.colorRamp.colorRamps?.forEach(e=>{"CIMLinearContinuousColorRamp"===e.type&&M(e,o)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":M(e.colorRamp,o)}}function M(e,o){if(e&&(e.fromColor&&(e.fromColor=o.toArray()),e.toColor)){const t=o.clone();t.a=0,e.toColor=t.toArray()}}e.applyCIMSymbolColor=function(e,r,a){r instanceof o||(r=new o(r));const s=t.toCIMSymbolJSON(e);s&&m(s,r,a)},e.applyCIMSymbolRotation=function(e,o,r=!1){const a=t.toCIMSymbolJSON(e);if(r&&(o=360-o),"CIMTextSymbol"!==a?.type){if("CIMPointSymbol"===a?.type&&a.symbolLayers){const e=o-(a.angle||0);for(const o of a.symbolLayers)if(t.isCIMMarker(o)){let t=o.rotation||0;o.rotateClockwise?t-=e:t+=e,o.rotation=t}a.angle=o}}else a.angle=o},e.getCIMSymbolColor=function(e){const r=[];return i(t.toCIMSymbolJSON(e),r),r.length?new o(t.normalizeAlpha(r[0])):null},e.getCIMSymbolRotation=function(e,o=!1){const r=t.toCIMSymbolJSON(e);if("CIMTextSymbol"===r?.type||"CIMPointSymbol"===r?.type){const e=r.angle;return null!=e&&o?360-e:e??0}return 0},e.getCIMSymbolSize=r,e.getCIMSymbolType=function(e){const o=t.toCIMSymbolJSON(e);if(!o)return null;switch(o.type){case"CIMPointSymbol":return"CIMPointSymbol";case"CIMLineSymbol":return"CIMLineSymbol";case"CIMPolygonSymbol":return"CIMPolygonSymbol";case"CIMTextSymbol":return"CIMTextSymbol";case"CIMMeshSymbol":return"CIMMeshSymbol";default:return null}},e.scaleCIMMarker=s,e.scaleCIMSymbol=a,e.scaleCIMSymbolTo=function(e,o,s){if(!e)return;const n=t.toCIMSymbolJSON(e),i=r(e);0!==i?a(n,o/i,!1,s):function(e,o){if(e)if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const t of e.symbolLayers)switch(t.type){case"CIMPictureMarker":case"CIMVectorMarker":t.size=o;break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":t.width=o}}else e.height=o}(n,o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});