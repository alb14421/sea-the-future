// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../kernel","../../request","../../core/colorUtils","../../core/Error","../../core/has","../../libs/maquette/projection","../../libs/maquette/projector","./svgUtils","./utils"],function(t,e,i,n,r,o,a,c,l,s){"use strict";const h=c.createProjector();function g(t,e){h.append(t,e),h.detach(e)}function u(t,e,i,r,o){switch(o){case"multiply":t[e]*=i[0],t[e+1]*=i[1],t[e+2]*=i[2],t[e+3]*=i[3];break;default:{const o=n.toHSV({r:t[e],g:t[e+1],b:t[e+2]});o.h=r.h,o.s=r.s,o.v=o.v/100*r.v;const a=n.toRGB(o);t[e]=a.r,t[e+1]=a.g,t[e+2]=a.b,t[e+3]*=i[3];break}}}t.renderOnce=g,t.renderSymbol=function(t,e,i){const n=Math.ceil(e[0]),r=Math.ceil(e[1]);if(!t.some(t=>!!t.length))return null;const o=i?.node||document.createElement("div");return null!=i.opacity&&(o.style.opacity=i.opacity.toString()),null!=i.effectView&&(o.style.filter=s.getCSSFilterFromEffectList(i.effectView)),g(o,()=>l.renderSVG(t,n,r,i)),o},t.tintImageWithColor=function(t,a,c,l,s){return function(t,e,n){return t?i(t,{responseType:"image"}).then(t=>{const i=t.data,r=i.width,o=i.height,a=r/o;let c=e;if(n){const t=Math.max(r,o);c=Math.min(c,t)}return{image:i,width:a<=1?Math.ceil(c*a):c,height:a<=1?c:Math.ceil(c/a)}}):Promise.reject(new r("renderUtils: imageDataSize","href not provided."))}(t,a,s).then(i=>{const r=i.width??a,s=i.height??a;if(i.image&&function(t,e){return!(!t||"ignore"===e||"multiply"===e&&255===t.r&&255===t.g&&255===t.b&&1===t.a)}(c,l)){let e=i.image.width,a=i.image.height;o("edge")&&/\.svg$/i.test(t)&&(e-=1,a-=1);const h=function(t,e){t=Math.ceil(t),e=Math.ceil(e);const i=document.createElement("canvas");i.width=t,i.height=e,i.style.width=t+"px",i.style.height=e+"px";const n=i.getContext("2d");return n.clearRect(0,0,t,e),n}(r,s);h.drawImage(i.image,0,0,e,a,0,0,r,s);const g=h.getImageData(0,0,r,s),d=[c.r/255,c.g/255,c.b/255,c.a],m=n.toHSV(c);for(let t=0;t<g.data.length;t+=4)u(g.data,t,d,m,l);h.putImageData(g,0,0),t=h.canvas.toDataURL("image/png")}else{const i=e.id?.findCredential(t);if(i?.token){const e=t.includes("?")?"&":"?";t=`${t}${e}token=${i.token}`}}return{url:t,width:r,height:s}}).catch(()=>({url:t,width:a,height:a}))},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});