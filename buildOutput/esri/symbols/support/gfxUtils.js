// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../assets","../../Color","../../request","../../core/LRUCache","../../core/screenUtils","./cimSymbolUtils"],function(t,e,o,r,s,n,l){"use strict";const a="picture-fill",i="simple-fill",c="simple-marker",h=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),d=new s.LRUCache(1e3);function p(t){if(!t?.style)return[];const{dashArray:e,style:o,width:r}=t;if("string"==typeof e&&"none"!==e)return e.split(",").map(t=>Number(t));const s=r??0,n=h.has(o)?h.get(o).map(t=>t*s):[];if("butt"!==t.cap)for(const[t,e]of n.entries())n[t]=t%2==1?e+s:Math.max(e-s,1);return n}const u=(()=>{const t={};return e=>{if(t[e])return t[e];const o=e.replaceAll("-","");return t[e]=o,o}})(),y=new o([128,128,128]);t.defaultThematicColor=y,t.dekebabifyLineStyle=u,t.getDashArray=p,t.getFill=function(t){const o=t.style;let r=null;if(t)switch(t.type){case c:"cross"!==o&&"x"!==o&&(r=t.color);break;case i:o&&"solid"!==o?"none"!==o&&(r={type:"pattern",x:0,y:0,src:e.getAssetUrl(`esri/symbols/patterns/${o}.png`),width:5,height:5}):r=t.color;break;case a:r={type:"pattern",src:t.url,width:n.pt2px(t.width)*t.xscale,height:n.pt2px(t.height)*t.yscale,x:n.pt2px(t.xoffset),y:n.pt2px(t.yoffset)};break;case"text":r=t.color;break;case"cim":r=l.getCIMSymbolColor(t)}return r},t.getPatternUrlWithColor=function(t,e){const o=t+"-"+e,s=d.get(o);return null!=s?Promise.resolve(s):r(t,{responseType:"image"}).then(t=>{const r=t.data,s=r.naturalWidth,n=r.naturalHeight,l=document.createElement("canvas");l.width=s,l.height=n;const a=l.getContext("2d");a.fillStyle=e,a.fillRect(0,0,s,n),a.globalCompositeOperation="destination-in",a.drawImage(r,0,0);const i=l.toDataURL();return d.put(o,i),i})},t.getStroke=function t(e){if(!e)return null;let o=null;switch(e.type){case i:case a:case c:o=t(e.outline);break;case"simple-line":{const t=n.pt2px(e.width);null!=e.style&&"none"!==e.style&&0!==t&&(o={color:e.color,style:u(e.style),width:t,cap:e.cap,join:"miter"===e.join?n.pt2px(e.miterLimit):e.join},o.dashArray=p(o).join(",")||"none");break}default:o=null}return o},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});