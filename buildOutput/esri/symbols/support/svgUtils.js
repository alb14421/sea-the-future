// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../Color","../../core/has","../../core/maybe","../../core/libs/gl-matrix-2/factories/mat2df32","../../core/libs/gl-matrix-2/math/mat2d","./gfxUtils","./svgGlobalState","../../widgets/support/widgetUtils","../../widgets/support/jsxFactory"],function(t,e,i,n,r,o,s,a,l,h){"use strict";const c=i("android"),f=i("chrome")||c&&c>=4?"auto":"optimizeLegibility",u={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},d=/([A-DF-Za-df-z])|([-+]?\d*\.?\d+(?:[eE][-+]?\d+)?)/g;let y={},x={};const g=Math.PI;function p(t,e){const i=t*(g/180);return Math.abs(e*Math.sin(i))+Math.abs(e*Math.cos(i))}function m(t){return t.map(t=>`${t.command} ${t.values.join(" ")}`).join(" ").trim()}function w(t,e,i,r,o){if(t){if("circle"===t.type)return h.tsx("circle",{cx:t.cx,cy:t.cy,fill:e,"fill-rule":"evenodd",r:t.r,stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-dashoffset":i.dashOffset,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width});if("ellipse"===t.type)return h.tsx("ellipse",{cx:t.cx,cy:t.cy,fill:e,"fill-rule":"evenodd",rx:t.rx,ry:t.ry,stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width});if("rect"===t.type)return h.tsx("rect",{fill:e,"fill-rule":"evenodd",height:t.height,stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width,width:t.width,x:t.x,y:t.y});if("image"===t.type)return h.tsx("image",{alt:o||"image",height:t.height,href:t.src,preserveAspectRatio:"none",width:t.width,x:t.x,y:t.y});if("path"===t.type){const n="string"!=typeof t.path?m(t.path):t.path;return h.tsx("path",{d:n,fill:e,"fill-rule":"evenodd",stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width})}if("text"===t.type)return n.assertIsSome(r),h.tsx("text",{"dominant-baseline":r.dominantBaseline,fill:e,"fill-rule":"evenodd","font-family":r.font.family,"font-size":r.font.size,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,kerning:r.kerning,rotate:r.rotate,stroke:i.color,"stroke-dasharray":i.dashArray,"stroke-linecap":i.cap,"stroke-linejoin":i.join,"stroke-miterlimit":"4","stroke-width":i.width,"text-anchor":r.align,"text-decoration":r.decoration,"text-rendering":f,x:t.x,y:t.y},t.text)}return null}function k(t){if(!t)return{fill:"none",pattern:null,linearGradient:null};if(!("type"in t))return{fill:new e(t).toString(),pattern:null,linearGradient:null};if("pattern"===t.type){const e=`patternId-${a.nextPatternId()}`;return{fill:`url(#${e})`,pattern:{id:e,x:t.x,y:t.y,width:t.width,height:t.height,image:{x:0,y:0,width:t.width,height:t.height,href:t.src}},linearGradient:null}}const i=`linearGradientId-${a.nextLinearGradientId()}`;return{fill:`url(#${i})`,pattern:null,linearGradient:{id:i,x1:t.x1,y1:t.y1,x2:t.x2,y2:t.y2,stops:t.colors.map(t=>({offset:t.offset,color:t.color&&new e(t.color).toString()}))}}}function b(t){const i={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};return t&&(null!=t.width&&(i.width=t.width),t.cap&&(i.cap=t.cap),t.join&&(i.join=t.join.toString()),t.color&&(i.color=new e(t.color).toString()),t.dashArray&&(i.dashArray=t.dashArray),t.dashoffset&&(i.dashOffset=t.dashoffset),t.style&&!t.dashArray&&(i.dashArray=s.getDashArray(t).join(",")||"none")),i}function S(t,e){const i={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(t){const r=t.alignBaseline,o="baseline"===r?"auto":"top"===r?"text-top":"bottom"===r?"hanging":r;i.align=t.align,i.dominantBaseline=o,i.decoration=t.decoration,i.kerning=t.kerning?"auto":"0",i.rotate=t.rotated?"90":"0",n.assertIsSome(e),i.font.style=e.style||"normal",i.font.variant=e.variant||"normal",i.font.weight=e.weight||"normal",i.font.size=e.size&&e.size.toString()||"10pt",i.font.family=e.family||"serif"}return i}function M(t){const{pattern:e,linearGradient:i}=t;if(e)return h.tsx("pattern",{height:e.height,id:e.id,patternUnits:"userSpaceOnUse",width:e.width,x:e.x,y:e.y},h.tsx("image",{height:e.image.height,href:e.image.href,width:e.image.width,x:e.image.x,y:e.image.y}));if(i){const t=i.stops.map((t,e)=>h.tsx("stop",{key:`${e}-stop`,offset:t.offset,"stop-color":t.color}));return h.tsx("linearGradient",{gradientUnits:"userSpaceOnUse",id:i.id,x1:i.x1,x2:i.x2,y1:i.y1,y2:i.y2},t)}return null}function v(t,e){if(!t||0===t.length)return null;const i=[];for(const e of t){const{shape:t,fill:n,stroke:r,font:o}=e,s=k(n),a=b(r),l="text"===t.type?S(t,o):null,h=w(t,s.fill,a,l);h&&i.push(h)}return h.tsx("mask",{id:e,maskUnits:"userSpaceOnUse"},h.tsx("g",null,i))}function A(t,e,i){return o.translate(t,o.identity(t),[e,i])}function j(t,e,i,n,r){return o.scale(t,o.identity(t),[e,i]),t[4]=t[4]*e-n*e+n,t[5]=t[5]*i-r*i+r,t}function G(t,e){y&&"left"in y?(null!=y.left&&y.left>t&&(y.left=t),(null==y.right||y.right<t)&&(y.right=t),(null==y.top||y.top>e)&&(y.top=e),(null==y.bottom||y.bottom<e)&&(y.bottom=e)):y={left:t,bottom:e,right:t,top:e}}function I(t){const e=t.args,i=e.length;let n;switch(t.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(n=0;n<i;n+=2)G(e[n],e[n+1]);x.x=e[i-2],x.y=e[i-1];break;case"H":for(n=0;n<i;++n)G(e[n],x.y);x.x=e[i-1];break;case"V":for(n=0;n<i;++n)G(x.x,e[n]);x.y=e[i-1];break;case"m":{let t=0;"x"in x||(G(x.x=e[0],x.y=e[1]),t=2);for(n=t;n<i;n+=2)G(x.x+=e[n],x.y+=e[n+1]);break}case"l":case"t":for(n=0;n<i;n+=2)G(x.x+=e[n],x.y+=e[n+1]);break;case"h":for(n=0;n<i;++n)G(x.x+=e[n],x.y);break;case"v":for(n=0;n<i;++n)G(x.x,x.y+=e[n]);break;case"c":for(n=0;n<i;n+=6)G(x.x+e[n],x.y+e[n+1]),G(x.x+e[n+2],x.y+e[n+3]),G(x.x+=e[n+4],x.y+=e[n+5]);break;case"s":case"q":for(n=0;n<i;n+=4)G(x.x+e[n],x.y+e[n+1]),G(x.x+=e[n+2],x.y+=e[n+3]);break;case"A":for(n=0;n<i;n+=7)G(e[n+5],e[n+6]);x.x=e[i-2],x.y=e[i-1];break;case"a":for(n=0;n<i;n+=7)G(x.x+=e[n+5],x.y+=e[n+6])}}function B(t,e,i){const n=u[t.toLowerCase()];let r;"number"==typeof n&&(n?e.length>=n&&(r={action:t,args:e.slice(0,e.length-e.length%n)},i.push(r),I(r)):(r={action:t,args:[]},i.push(r),I(r)))}function $(t){const e={x:0,y:0,width:0,height:0};if("circle"===t.type)e.x=t.cx-t.r,e.y=t.cy-t.r,e.width=2*t.r,e.height=2*t.r;else if("ellipse"===t.type)e.x=t.cx-t.rx,e.y=t.cy-t.ry,e.width=2*t.rx,e.height=2*t.ry;else if("image"===t.type||"rect"===t.type)e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height;else if("path"===t.type){const i=function(t){const e=("string"!=typeof t.path?m(t.path):t.path).match(d),i=[];if(y={},x={},!e)return null;let n="",r=[];const o=e.length;for(let t=0;t<o;++t){const o=e[t],s=parseFloat(o);isNaN(s)?(n&&B(n,r,i),r=[],n=o):r.push(s)}B(n,r,i);const s={x:0,y:0,width:0,height:0};return y&&"left"in y&&(s.x=y.left,s.y=y.top,s.width=y.right-y.left,s.height=y.bottom-y.top),s}(t);e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height}return e}function N(t){const e={x:0,y:0,width:0,height:0};let i=null,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const o of t)i?(i.x=Math.min(i.x,o.x),i.y=Math.min(i.y,o.y),n=Math.max(n,o.x+o.width),r=Math.max(r,o.y+o.height)):(i=e,i.x=o.x,i.y=o.y,n=o.x+o.width,r=o.y+o.height);return i&&(i.width=n-i.x,i.height=r-i.y),i}function z(t,e,i,n,s,a,l,h,c){let f=(l&&a?p(a,e):e)/2,u=(l&&a?p(a,i):i)/2;if(c){const t=c[0],e=c[1];f=(l&&a?p(a,t):t)/2,u=(l&&a?p(a,e):e)/2}const d=t.width+n,y=t.height+n,x=r.create(),g=r.create();let m=!1;if(s&&0!==d&&0!==y){const t=e!==i?e/i:d/y,n=e>i?e:i;let r=1,s=1;isNaN(n)||(t>1?(r=n/d,s=n/t/y):(s=n/y,r=n*t/d)),o.multiply(g,g,j(x,r,s,f,u)),m=!0}const w=t.x+(d-n)/2,k=t.y+(y-n)/2,b=f-w,S=u-k;if(o.multiply(g,g,A(x,b,S)),!m&&(d>e||y>i)){const t=d/e>y/i,n=(t?e:i)/(t?d:y);o.multiply(g,g,j(x,n,n,w,k))}return h&&o.multiply(g,g,A(x,h[0],h[1])),a&&o.multiply(g,g,function(t,e,i,n){const r=e%360*Math.PI/180;o.rotate(t,o.identity(t),r);const s=Math.cos(r),a=Math.sin(r),l=t[4],h=t[5];return t[4]=l*s-h*a+n*a-i*s+i,t[5]=h*s+l*a-i*a-n*s+n,t}(x,a,w,k)),`matrix(${g[0]},${g[1]},${g[2]},${g[3]},${g[4]},${g[5]})`}t.computeBBox=N,t.generateFillAttributes=k,t.generateStrokeAttributes=b,t.generateTextAttributes=S,t.getBoundingBox=$,t.getTransformMatrix=z,t.renderDef=M,t.renderSVG=function(t,e,i,r={}){const o=[],s=[],l=a.nextBloomId(),c=function(t,e,i){const n=t?.effects.find(t=>"bloom"===t.type);if(!n)return null;const{strength:r,radius:o}=n,s=r>0?o:0,a=(r+.5*s)*(5**(e/100)*(.4+e/100)),l=(r+s)*e,c=4*r+1;return h.tsx("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:`bloom${i}`,width:"300%",x:"-100%",y:"-100%"},h.tsx("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:a,result:"dilate"}),h.tsx("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:l/25}),h.tsx("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:l/50}),h.tsx("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},h.tsx("feFuncR",{slope:c,type:"linear"}),h.tsx("feFuncG",{slope:c,type:"linear"}),h.tsx("feFuncB",{slope:c,type:"linear"})),h.tsx("feMerge",null,h.tsx("feMergeNode",{in:"intensityBlur"}),h.tsx("feMergeNode",{in:"intensityBrightness"}),h.tsx("feGaussianBlur",{stdDeviation:r/10})))}(r.effectView,e,l);let f=null;if(c){const t=r.effectView?.effects.find(t=>"bloom"===t.type),n=r.clipBloomEffect||!t.strength?0:(t.strength+t.radius/2)/3,o=e+e*n,s=i+i*n;f=[Math.max(o,10),Math.max(s,10)]}let u=e,d=i;if(r.useRotationSize)for(let n=0;n<t.length;n++){const t=r.rotations?.[n]??0;u=Math.max(p(t,e),u),d=Math.max(p(t,i),d)}for(let n=0;n<t.length;n++){const a=t[n],l=[],c=[];let y=0,x=0,g=0;for(const t of a){const{shape:e,fill:i,stroke:n,font:s,offset:a}=t;r.ignoreStrokeWidth||"text"===e.type||(y+=n?.width||0);const h=k(i),f=b(n),u="text"===e.type?S(e,s):null;o.push(M(h)),l.push(w(e,h.fill,f,u,r.ariaLabel)),c.push($(e)),a&&(x+=a[0],g+=a[1])}const m=r.rotations?.[n]??0;r.useRotationSize&&(x+=(u-p(m,e))/2,g+=(d-p(m,i))/2);const A=z(N(c),e,i,y,r.scale??!1,m,r.useRotationSize??!1,[x,g],f);let j=null;if(r.masking){const t=`mask-${n}`,e=r.masking[n];o.push(v(e,t)),j=`url(#${t})`}s.push(j?h.tsx("g",{mask:j},h.tsx("g",{transform:A},l)):h.tsx("g",{transform:A},l))}return c&&(n.assertIsSome(f),u=f[0],d=f[1]),h.tsx("svg",{"aria-label":r.ariaLabel,focusable:!1,height:d,role:"img",style:"display: block;",width:u,xmlns:"http://www.w3.org/2000/svg"},c,h.tsx("defs",null,o),c?h.tsx("g",{filter:`url(#bloom${l})`},s):s)},t.renderShape=w,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});