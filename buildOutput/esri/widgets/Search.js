// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Search/css":function(){define(["exports"],function(e){"use strict";const t="esri-search",r={base:t,autocomplete:`${t}__autocomplete`,dropdown:`${t}__dropdown`,container:`${t}__container`,form:`${t}__form`};e.css=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Search/SearchResultRenderer":function(){define(["require","../../chunks/tslib.es6","../../intl","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../Widget","./searchResultRendererCSS","./SearchViewModel","../../chunks/componentsUtils","../support/globalCss","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory","../../intl/substitute"],function(e,t,r,o,s,i,n,a,l,c,u,p,d,h,g,y,m){"use strict";let _=class extends l{constructor(e,t){super(e,t),this.messages=null,this.showMoreResultsOpen=!1,this.viewModel=null}loadDependencies(){return p.loadCalciteComponents({block:()=>new Promise((t,r)=>e(["../../chunks/index13"],t,r)),list:()=>new Promise((t,r)=>e(["../../chunks/index16"],t,r)),"list-item":()=>new Promise((t,r)=>e(["../../chunks/index20"],t,r)),"list-item-group":()=>new Promise((t,r)=>e(["../../chunks/index55"],t,r))})}destroy(){this.viewModel=null}render(){return y.tsx("div",{class:this.classes(c.css.base,d.globalCss.widget)},this.viewModel?.selectedResult?.name??"",this._renderMoreResults())}_renderMoreResults(){if(!this.viewModel)return null;const{resultCount:e,results:t}=this.viewModel;return!e||e<2||!t?null:y.tsx("calcite-block",{class:c.css.moreResults,collapsible:!0,expanded:this.showMoreResultsOpen,heading:m.substitute(this.messages.showMoreResults,{count:e-1}),onCalciteBlockClose:()=>this._toggleShowMoreResults(!1),onCalciteBlockOpen:()=>this._toggleShowMoreResults(!0)},t.map(e=>this._renderMoreResultsList(e,t?.length>1)))}_renderListItem(e){return y.tsx("calcite-list-item",{key:`result-${e.sourceIndex}-${e.key}`,label:e.name,onCalciteListItemSelect:()=>this._selectResult(e)})}_renderMoreResultsList(e,t){const{results:r}=e;if(!r?.length||!r)return null;const o=this.viewModel?.selectedResult,s=this._getSourceName(e.source,e.sourceIndex),i=r.filter(e=>e!==o).map(e=>this._renderListItem(e));return y.tsx("calcite-list",{label:s},t?y.tsx("calcite-list-item-group",{heading:s,key:`group-${e.sourceIndex}`},i):i)}_selectResult(e){this.showMoreResultsOpen=!1,this.viewModel?.select(e)}_toggleShowMoreResults(e){this.showMoreResultsOpen=e;const t=this.viewModel?.view?.popup;t&&"reposition"in t&&t.reposition()}_getSourceName(e,t){return t===u.ALL_INDEX?this.messages.all:e.name}};return t.__decorate([o.property(),g.messageBundle("esri/widgets/Search/t9n/Search")],_.prototype,"messages",void 0),t.__decorate([o.property()],_.prototype,"showMoreResultsOpen",void 0),t.__decorate([o.property()],_.prototype,"viewModel",void 0),_=t.__decorate([a.subclass("esri.widgets.Search.SearchResultRenderer")],_),_})},"esri/widgets/Search/searchResultRendererCSS":function(){define(["exports"],function(e){"use strict";const t="esri-search-result-renderer",r={base:t,moreResults:`${t}--more-results`};e.css=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Search/SearchViewModel":function(){define(["../../chunks/tslib.es6","../../assets","../../Graphic","../../PopupTemplate","../../core/arrayUtils","../../core/Collection","../../core/Error","../../core/Evented","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/decorators/subclass","../../geometry/Point","../../geometry/SpatialReference","../../geometry/support/geometryUtils","../../intl/locale","../../intl/messages","../../portal/Portal","../../support/apiKeyUtils","../../symbols/PictureMarkerSymbol","../../symbols/SimpleFillSymbol","../../symbols/SimpleLineSymbol","../../symbols/TextSymbol","../../views/support/layerViewUtils","./LayerSearchSource","./LocatorSearchSource","./SearchSource","./support/locatorUtils","../support/geolocationUtils","../support/GoTo"],function(e,t,r,o,s,i,n,a,l,c,u,p,d,h,g,y,m,_,f,S,v,w,b,x,T,R,L,M,C,F,E,I,P){"use strict";function A(e,t){return e.hasOwnProperty(t)&&null!=e[t]&&""!==e[t]}const O="highlight",N=i.ofType({key:e=>e.layer?"layer":"locator",base:F,typeMap:{layer:M,locator:C}}),j=m.WGS84,G=/<[\s\S]*?>/g,k=-1;let $=class extends(P.GoTo(a.EventedAccessor)){constructor(e){super(e),this._gotoController=null,this._searching=null,this._updatingPromise=null,this._createdFeatureLayers=[],this.autoNavigate=!0,this.autoSelect=!0,this.defaultPopupTemplate=null,this.defaultSources=new N,this.defaultSymbols={point:new b({url:t.getAssetUrl("esri/images/search/search-symbol-32.png"),size:24,width:24,height:24}),polyline:new T({color:[130,130,130,1],width:2}),polygon:new x({color:[235,235,235,.4],outline:{color:[130,130,130,1],width:2}})},this.includeDefaultSources=!0,this.maxInputLength=128,this.maxResults=6,this.maxSuggestions=6,this.messages=null,this.minSuggestCharacters=3,this.popupEnabled=!0,this.popupTemplate=null,this.portal=v.getDefault(),this.resultCount=null,this.resultGraphicEnabled=!0,this.resultGraphic=null,this.results=null,this.selectedSuggestion=null,this.searchAllEnabled=!0,this.selectedResult=null,this.sources=new N,this.suggestionDelay=350,this.suggestionCount=null,this.suggestions=null,this.suggestionsEnabled=!0,this.view=null}initialize(){const e=async()=>{const e=await S.fetchMessageBundle("esri/widgets/Search/t9n/Search");this.messages=e,this.defaultPopupTemplate=new o({title:e.searchResult,content:"{Match_addr}"})};e(),this.addHandles([p.watch(()=>[this.includeDefaultSources,this.view,this.portal],()=>this._update(),p.initial),f.onLocaleChange(e)])}destroy(){this._destroyFeatureLayers(),this._abortGoTo(),this.clearGraphics()}static{this.ALL_INDEX=k}get activeSource(){return this.allSources.at(this.activeSourceIndex)??null}get activeSourceIndex(){return 1!==this.allSources.length&&this.searchAllEnabled?k:0}set activeSourceIndex(e){this._overrideIfSome("activeSourceIndex",e)}get allPlaceholder(){return this.messages?.allPlaceholder}set allPlaceholder(e){this._overrideIfSome("allPlaceholder",e)}get allSources(){const{sources:e,defaultSources:t,includeDefaultSources:r}=this,o="function"==typeof r?r.call(null,{sources:e,defaultSources:t}):r?t.concat(e):e,s=this._get("allSources")||new N;return s.removeAll(),s.addMany(o.filter(Boolean)),s}get locationEnabled(){return this._get("locationEnabled")||I.supported()}set locationEnabled(e){if(void 0===e)return void this._clearOverride("locationEnabled");const t=I.supported();if(e&&!t){const e=new n("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});l.getLogger(this).error(e)}this._override("locationEnabled",!!e&&t)}get placeholder(){const{allSources:e,activeSourceIndex:t,allPlaceholder:r}=this;if(t===k)return r??"";const o=e.at(t);return o?.placeholder??""}set searchTerm(e){this._set("searchTerm",e||""),this.clearGraphics(),this.selectedSuggestion&&this.selectedSuggestion.text!==e&&this._set("selectedSuggestion",null),""===e&&this._clear()}get searchTerm(){return this._get("searchTerm")||""}get state(){return this._searching?"searching":this.updating?"loading":0===this.allSources.length?"disabled":"ready"}get updating(){return null!=this._updatingPromise}clear(){this.searchTerm=""}clearGraphics(){this._removeHighlight(),this._closePopup();const{view:e,resultGraphic:t}=this;e&&t&&e.graphics.remove(t),this._set("resultGraphic",null)}search(e,t){this.emit("search-start"),this.clearGraphics();const r=this._createSuggestionForSearch(e),o=(async()=>{try{await this.when();const e=await this._getResultsFromSources(r,t);if(t?.signal?.aborted)return null;const o={activeSourceIndex:this.activeSourceIndex,searchTerm:r.text??"",numResults:0,numErrors:0,errors:[],results:[]};this._formatResponse(o,e,r);const s=this._getFirstResult(o.results),i=r.location&&s?s.name:r.text,n=i?.replace(G,"");return this._set("searchTerm",n),(r.key&&"number"==typeof r.sourceIndex||r.location)&&this._set("selectedSuggestion",r),this._set("results",o.results),this._set("resultCount",o.results.reduce((e,t)=>e+(t.results?.length??0),0)),this.emit("search-complete",o),await this._selectFirstResult(s),o}finally{this._clearSearching()}})();return this._searching=o,o}async searchNearby(e){if(!this.locationEnabled){const e=new n("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});throw l.getLogger(this).error(e),e}const t=(async()=>{try{const t=await I.getCurrentPosition(),r=await I.positionToPoint({position:t,view:this.view},e);return await this.search(r,e)}finally{this._clearSearching()}})();return this._searching=t,t}async select(e){if(this.clearGraphics(),!e){const t=new n("select:missing-parameter","Cannot select without a searchResult.",{searchResult:e});throw l.getLogger(this).error(t),t}const{view:t}=this,o=A(e,"sourceIndex")?e.sourceIndex:this._getSourceIndexOfResult(e),s=null!=o?this.allSources.at(o):null;if(!s){const e=new n("select:missing-source","Cannot select without a source.",{source:s});throw l.getLogger(this).error(e),e}const i=s instanceof M?this._getLayerSourcePopupTemplate(s):s.popupTemplate,a=s.resultSymbol||this._getDefaultSymbol(e),c=A(s,"resultGraphicEnabled")?s.resultGraphicEnabled:this.resultGraphicEnabled,p=A(s,"autoNavigate")?s.autoNavigate:this.autoNavigate,d=A(s,"popupEnabled")?s.popupEnabled:this.popupEnabled,h=d?i||this.popupTemplate||this.defaultPopupTemplate:null,{feature:g}=e;if(!g){const e=new n("select:missing-feature","Cannot select without a feature.",{feature:g});throw l.getLogger(this).error(e),e}const{attributes:y,geometry:m,layer:f,sourceLayer:S}=g,v=m?_.getPointFromGeometry(m):null,w={layerViewQuery:this._getLayerView(g),elevationQuery:t&&null!=v?_.getPointWithElevation(v,t):Promise.resolve(v)},b=await u.eachAlways(w),x=b.layerViewQuery.value,T=b.elevationQuery.value;a instanceof R&&(a.text=e.name);const C=t&&p?e.target||e.extent:null,F=null!=C?this._goToSearchResult(C):Promise.resolve();await F;const E=x?g:new r({geometry:m,symbol:a,attributes:y,layer:f,sourceLayer:S,popupTemplate:h}),I=t?.popup,P=I&&d&&E.getEffectivePopupTemplate(I.defaultPopupTemplateEnabled);return P&&await t.openPopup({features:[E],location:T}),x&&L.highlightsSupported(x)&&!P&&this._highlightFeature({graphic:E,layerView:x}),!x&&c&&t&&t.graphics.push(E),this._setResultFloor(e),this._set("selectedResult",e),this._set("resultGraphic",E),this.emit("select-result",{result:e,source:s,sourceIndex:o}),e}async suggest(e,t,r){const o=e||this.searchTerm;this.emit("suggest-start",{searchTerm:o}),await this._suggestTimer(t,r);const s=await this._suggestImmediate(o,r);return this._set("suggestions",s?.results),this._set("suggestionCount",s?.results.reduce((e,t)=>e+(t.results?.length??0),0)??null),this.emit("suggest-complete",s),s}async when(){await p.whenOnce(()=>!this.updating)}async _update(){const{portal:e,view:t}=this;if(this.includeDefaultSources){const r=this._updatingPromise=u.eachAlways([e?.load(),t?.when()]);if(this.destroyed)return;if(await r,r!==this._updatingPromise)return}await p.whenOnce(()=>this.messages),this.destroyed||this._updateDefaultSources(),this._updatingPromise=null}_clearSearching(){this._searching=null}_convertHelperServices(){const e=this.portal?.helperServices?.geocode;return e?e.map(e=>{if(!1===e.placefinding)return;const t=E.isArcGISWorldGeocoder(e.url)&&w.isApiKeyApplicable(e.url)?{url:E.meteredArcGISLocatorUrl}:null,r=C.fromJSON({...e,...t}),o=r.url;if(E.isArcGISWorldGeocoder(o)||E.isProxiedArcGISWorldGeocoder(o)||E.isMeteredArcGISWorldGeocoder(o)){const e=r.outFields??["Addr_type","Match_addr","StAddr","City"],t=(r.placeholder||this.messages?.placeholder)??"",o="number"==typeof r.defaultZoomScale?r.defaultZoomScale:2500;r.singleLineFieldName="SingleLine",r.outFields=e,r.placeholder=t,r.defaultZoomScale=o}return r.singleLineFieldName?r:void 0}).filter(s.isSome):[]}_destroyFeatureLayers(){this._createdFeatureLayers.forEach(e=>e?.destroy()),this._createdFeatureLayers=[]}_getLayerSources(e,t){const r=this.view?.map;return e.map(e=>{const o=r.findLayerById(e.id);if(!o)return;const s=this._getLayerJSON(e),i=M.fromJSON(s);return i.placeholder=t,this._getLayer(o,s).then(e=>{i.layer=e}),i}).filter(s.isSome).toArray()}_getTableSources(e,t){const r=this.view?.map;return e.map(e=>{if(!e.id)return;const o=r.findTableById(e.id);if(!o)return;const s=this._getLayerJSON(e),i=M.fromJSON(s);return i.placeholder=t,this._getLayer(o,s).then(e=>{i.layer=e}),i}).filter(s.isSome).toArray()}_convertApplicationProperties(){const e=this.view?.map,t=e?.applicationProperties?.viewing?.search;if(!t)return[];const{enabled:r,hintText:o,layers:s,tables:i}=t;return r?[...this._getLayerSources(s,o),...this._getTableSources(i,o)]:[]}async _getSubLayer(e,t){if(await e.load(),!e.allSublayers)throw new Error;const r=e.allSublayers.find(e=>e.id===t.subLayer);if(!r)throw new Error;const o=await(r.createFeatureLayer?.());if(!o)throw new Error;return this._createdFeatureLayers.push(o),o}async _getBuildingSubLayer(e,t){await e.load();const r=e.allSublayers.find(e=>e.id===t.subLayer);if("building-component"!==r?.type)throw new Error;if(await r.load(),null==r.associatedLayer)throw new Error;return await r.associatedLayer.load(),r}async _getLayer(e,t){if("feature"===e.type||"scene"===e.type||"csv"===e.type||"geojson"===e.type||"ogc-feature"===e.type)return e;if("map-image"===e.type)try{return await this._getSubLayer(e,t)}catch(t){const r=new n("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",{layer:e});return l.getLogger(this).error(r),null}return"building-scene"===e.type?this._getBuildingSubLayer(e,t):null}_getLayerJSON(e){return"function"==typeof e.toJSON?e.toJSON():e}_updateDefaultSources(){const{defaultSources:e,includeDefaultSources:t}=this;this._destroyFeatureLayers(),e.removeAll(),t&&e.addMany([...this._convertApplicationProperties(),...this._convertHelperServices()])}_abortGoTo(){this._gotoController&&this._gotoController.abort(),this._gotoController=null}_clear(){this._abortGoTo(),this._set("resultCount",null),this._set("results",null),this._set("suggestions",null),this._set("suggestionCount",null),this._set("selectedResult",null),this._set("selectedSuggestion",null),this.emit("search-clear")}_closePopup(){const e=this.view?.popup,{resultGraphic:t}=this;if(!e||!t)return;const r="selectedFeature"in e,o=r?e.selectedFeature:null;r&&o&&o===t&&e.close()}_suggestTimer(e,t){const r=null!=e?e:this.suggestionDelay;return u.after(r,null,t?.signal)}_createLocationForSearch(e){return e instanceof r&&e.geometry?_.getPointFromGeometry(e.geometry):e instanceof y?e:Array.isArray(e)&&2===e.length?new y({longitude:e[0],latitude:e[1]}):null}_createSuggestionForSearch(e){if(e&&A(e,"key")&&A(e,"text")&&A(e,"sourceIndex"))return e;const t=this._createLocationForSearch(e),r="string"==typeof e?e:this.searchTerm,{selectedSuggestion:o,selectedResult:s}=this,i=!e&&o&&s,n=i&&o.key===s.key&&o.sourceIndex===s.sourceIndex,a=i&&o.location;return n||a?o:{location:t,text:t?"":r,sourceIndex:null,key:null}}_getFirstResult(e){return c.mappedFind(e,({results:e})=>e?.[0])??null}async _selectFirstResult(e){return this.autoSelect&&e?this.select(e):null}async _suggestImmediate(e,t){await this.when();const r=await this._getSuggestionsFromSources(e,t);if(t?.signal?.aborted)return null;const o={activeSourceIndex:this.activeSourceIndex,searchTerm:e??"",numResults:0,numErrors:0,errors:[],results:[]};return this._formatResponse(o,r),o}_formatSourceResponse(e,t,r){const o=t?.value||[],s=t?.error,i=this.allSources.at(r);if(s){const t={sourceIndex:r,source:i,error:s};e.errors.push(t),l.getLogger(this).error(s),e.numErrors++}else{const t={sourceIndex:r,source:i,results:o};e.results.push(t),e.numResults+=o.length}}_formatResponse(e,t,r){if(t)if(e.activeSourceIndex===k){const o=r&&A(r,"sourceIndex")&&-1!==r.sourceIndex?r.sourceIndex:void 0;t.forEach((t,r)=>{const s=void 0!==o?o:r;this._formatSourceResponse(e,t,s)})}else this._formatSourceResponse(e,t[0],e.activeSourceIndex)}async _getResultsFromSources(e,t){const{allSources:r}=this,o=!e.location&&A(e,"sourceIndex")?e.sourceIndex:this.activeSourceIndex,s=[];if(!r.length){const e=new n("search:no-sources-defined","At least one source is required.",{allSources:r});throw l.getLogger(this).error(e),e}return o===k?r.forEach((r,o)=>{s.push(this._getResultsFromSource(e,o,t))}):s.push(this._getResultsFromSource(e,o,t)),u.eachAlways(s)}async _getSuggestionsFromSources(e,t){const{allSources:r,activeSourceIndex:o}=this,s=[];if(!r.length){const e=new n("suggest:no-sources-defined","At least one source is required.",{allSources:r});throw l.getLogger(this).error(e),e}return o===k?r.forEach((r,o)=>{s.push(this._getSuggestionsFromSource(e,o,t))}):s.push(this._getSuggestionsFromSource(e,o,t)),u.eachAlways(s)}async _getResultsFromSource(e,t,r){const o=null!=t?this.allSources.at(t):null;if(!o)return null;const{location:s=null}=e,i=this.view?.spatialReference??j,n=A(o,"maxResults")?o.maxResults:this.maxResults,a=!!(o instanceof M&&A(o,"exactMatch"))&&o.exactMatch,{view:l}=this;return o.getResults?.({exactMatch:a,location:s,maxResults:n,sourceIndex:t,spatialReference:i,suggestResult:e,view:l},r)}async _getSuggestionsFromSource(e,t,r){const o=this.allSources.at(t);if(!o)return null;e??="";const s=A(o,"suggestionsEnabled")?o.suggestionsEnabled:this.suggestionsEnabled,i=e?.length,n=A(o,"minSuggestCharacters")?o.minSuggestCharacters:this.minSuggestCharacters;if(s&&e.trim()&&i>=n){const s=this.view?.spatialReference||j,i=A(o,"maxSuggestions")?o.maxSuggestions:this.maxSuggestions,{view:n}=this,a=!!(o instanceof M&&A(o,"exactMatch"))&&o.exactMatch;return o.getSuggestions?.({view:n,sourceIndex:t,suggestTerm:e,spatialReference:s,maxSuggestions:i,exactMatch:a},r)}return null}_getLayerSourcePopupTemplate(e){const{layer:t}=e;if(t)return A(e,"popupTemplate")?e.popupTemplate:t.popupTemplate}_getSourceIndexOfResult(e){return c.mappedFind(this.results??[],({results:t,sourceIndex:r})=>{const o=t?.includes(e);return o?r:null})??null}async _goToSearchResult(e){this._abortGoTo();const t=new AbortController;this._gotoController=t;const r={target:{target:e},options:{signal:t.signal}};e||(r.options.animate=!1),await this.callGoTo(r),this._gotoController=null}_getDefaultSymbol(e){const{defaultSymbols:t}=this,r=e.feature?.geometry;if(null==r)return null;switch(r.type){case"point":case"multipoint":return t.point;case"polyline":return t.polyline;case"extent":case"polygon":return t.polygon;default:return null}}_removeHighlight(){this.removeHandles(O)}async _getLayerView(e){const{view:t}=this;if(!e||!t)return null;const{layer:r,sourceLayer:o}=e,s=r??o;return s&&"building-component"!==s.type&&"subtype-sublayer"!==s.type?(await t.when(),t.whenLayerView(s)):null}_highlightFeature(e){const{graphic:t,layerView:r}=e,{attributes:o,layer:s,sourceLayer:i}=t,n=s??i,{objectIdField:a}=n,l=(a&&o?.[a])??null,c=r.highlight(l??t);this.addHandles(c,O)}_setResultFloor(e){const{view:t}=this,r=e.feature?.attributes,o=e.feature?.sourceLayer;if(o&&"floorInfo"in o&&o?.floorInfo?.floorField&&r){const e=r[o.floorInfo.floorField];t?.emit("select-result-floor",e)}}};return e.__decorate([d.property()],$.prototype,"_searching",void 0),e.__decorate([d.property()],$.prototype,"_updatingPromise",void 0),e.__decorate([d.property({readOnly:!0,value:null})],$.prototype,"activeSource",null),e.__decorate([d.property()],$.prototype,"activeSourceIndex",null),e.__decorate([d.property()],$.prototype,"allPlaceholder",null),e.__decorate([d.property({readOnly:!0})],$.prototype,"allSources",null),e.__decorate([d.property()],$.prototype,"autoNavigate",void 0),e.__decorate([d.property()],$.prototype,"autoSelect",void 0),e.__decorate([d.property({type:o})],$.prototype,"defaultPopupTemplate",void 0),e.__decorate([d.property({readOnly:!0})],$.prototype,"defaultSources",void 0),e.__decorate([d.property()],$.prototype,"defaultSymbols",void 0),e.__decorate([d.property()],$.prototype,"includeDefaultSources",void 0),e.__decorate([d.property()],$.prototype,"locationEnabled",null),e.__decorate([d.property()],$.prototype,"maxInputLength",void 0),e.__decorate([d.property()],$.prototype,"maxResults",void 0),e.__decorate([d.property()],$.prototype,"maxSuggestions",void 0),e.__decorate([d.property()],$.prototype,"messages",void 0),e.__decorate([d.property()],$.prototype,"minSuggestCharacters",void 0),e.__decorate([d.property({readOnly:!0})],$.prototype,"placeholder",null),e.__decorate([d.property()],$.prototype,"popupEnabled",void 0),e.__decorate([d.property({type:o})],$.prototype,"popupTemplate",void 0),e.__decorate([d.property({type:v})],$.prototype,"portal",void 0),e.__decorate([d.property()],$.prototype,"resultCount",void 0),e.__decorate([d.property()],$.prototype,"resultGraphicEnabled",void 0),e.__decorate([d.property({readOnly:!0})],$.prototype,"resultGraphic",void 0),e.__decorate([d.property({readOnly:!0})],$.prototype,"results",void 0),e.__decorate([d.property({readOnly:!0})],$.prototype,"selectedSuggestion",void 0),e.__decorate([d.property()],$.prototype,"searchAllEnabled",void 0),e.__decorate([d.property({readOnly:!0})],$.prototype,"selectedResult",void 0),e.__decorate([d.property()],$.prototype,"searchTerm",null),e.__decorate([d.property({type:N})],$.prototype,"sources",void 0),e.__decorate([d.property({readOnly:!0})],$.prototype,"state",null),e.__decorate([d.property()],$.prototype,"suggestionDelay",void 0),e.__decorate([d.property()],$.prototype,"suggestionCount",void 0),e.__decorate([d.property({readOnly:!0})],$.prototype,"suggestions",void 0),e.__decorate([d.property()],$.prototype,"suggestionsEnabled",void 0),e.__decorate([d.property({readOnly:!0})],$.prototype,"updating",null),e.__decorate([d.property()],$.prototype,"view",void 0),e.__decorate([d.property()],$.prototype,"clear",null),$=e.__decorate([g.subclass("esri.widgets.Search.SearchViewModel")],$),$})},"esri/geometry/support/geometryUtils":function(){define(["exports","../Extent","./scaleUtils"],function(e,t,r){"use strict";function o(e,o,s){const i=e.hasZ?e.z:void 0;if(o?.map)return(null!=s?r.getExtentForScale(o,s):o.extent).clone().centerAt(e).set({zmax:i,zmin:i});const{x:n,y:a,spatialReference:l}=e;return new t({xmin:n-.25,ymin:a-.25,xmax:n+.25,ymax:a+.25,spatialReference:l,zmin:i,zmax:i})}e.createExtentFromGeometry=function(e,t,r){switch(e?.type){case"extent":return e;case"multipoint":case"polygon":case"polyline":return e.extent;case"point":return o(e,t,r);default:return null}},e.createExtentFromPoint=o,e.getPointFromGeometry=function(e){switch(e?.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"multipoint":case"polyline":return e.extent?.center;default:return null}},e.getPointWithElevation=async function(e,t){if(e.hasZ||"2d"===t.type)return e;const r=t.map?.ground;if(!r?.layers.length)return e;const{geometry:o}=await r.queryElevation(e,{cache:t.basemapTerrain?.elevationQueryCache});return o},e.scaleExtent=function(e,t,r){return o(e.center,t,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Search/LayerSearchSource":function(){define(["../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./SearchSource","./support/layerSearchUtils"],function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.displayField=null,this.exactMatch=null,this.orderByFields=null,this.searchFields=null,this.searchTemplate=null,this.suggestionTemplate=null,this.getResults=(e,t)=>a.getResults({source:this,...e},t),this.getSuggestions=(e,t)=>a.getSuggestions({source:this,...e},t)}set layer(e){this._set("layer",e),e&&e.load().catch(()=>{})}get name(){return this._getLayerTitle()??""}set name(e){this._overrideIfSome("name",e)}clone(){return new l({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?t.clone(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,layer:this.layer,searchFields:this.searchFields?t.clone(this.searchFields):null,suggestionTemplate:this.suggestionTemplate,zoomScale:this.zoomScale})}_getFirstStringField(){return this.layer.fieldsIndex?.fields.find(e=>"string"===e.type)?.name??""}_getDisplayField(){return this.displayField||this.layer.displayField||this._getFirstStringField()}_getSearchFieldsString(){const{layer:e,searchFields:t}=this;return e.loaded?`: ${(t||[this._getDisplayField()]).map(t=>{const r=e.getField(t);return r?.alias||t}).join(", ")}`:""}_getLayerTitle(){const{layer:e}=this;if(!e)return;const{title:t}=e;return t?`${t}${this._getSearchFieldsString()}`:void 0}};return e.__decorate([r.property({json:{read:{source:"field.name"},write:{target:"field.name"}}})],c.prototype,"displayField",void 0),e.__decorate([r.property({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],c.prototype,"exactMatch",void 0),e.__decorate([r.property({value:null})],c.prototype,"layer",null),e.__decorate([r.property()],c.prototype,"name",null),e.__decorate([r.property({type:[String],json:{write:!0}})],c.prototype,"orderByFields",void 0),e.__decorate([r.property()],c.prototype,"searchFields",void 0),e.__decorate([r.property()],c.prototype,"searchTemplate",void 0),e.__decorate([r.property()],c.prototype,"suggestionTemplate",void 0),c=l=e.__decorate([i.subclass("esri.widgets.Search.LayerSearchSource")],c),c})},"esri/widgets/Search/SearchSource":function(){define(["../../chunks/tslib.es6","../../PopupTemplate","../../core/Identifiable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n,a,l){"use strict";let c=class extends(r.IdentifiableMixin(o.JSONSupport)){constructor(e){super(e),this.autoNavigate=null,this.filter=null,this.getResults=null,this.getSuggestions=null,this.maxResults=null,this.maxSuggestions=null,this.minSuggestCharacters=null,this.outFields=null,this.placeholder="",this.popupEnabled=null,this.popupTemplate=null,this.prefix="",this.resultGraphicEnabled=null,this.resultSymbol=null,this.suffix="",this.suggestionsEnabled=null,this.withinViewEnabled=!1,this.zoomScale=null}};return e.__decorate([s.property()],c.prototype,"autoNavigate",void 0),e.__decorate([s.property()],c.prototype,"filter",void 0),e.__decorate([s.property()],c.prototype,"getResults",void 0),e.__decorate([s.property()],c.prototype,"getSuggestions",void 0),e.__decorate([s.property()],c.prototype,"maxResults",void 0),e.__decorate([s.property()],c.prototype,"maxSuggestions",void 0),e.__decorate([s.property()],c.prototype,"minSuggestCharacters",void 0),e.__decorate([s.property()],c.prototype,"outFields",void 0),e.__decorate([s.property()],c.prototype,"placeholder",void 0),e.__decorate([s.property()],c.prototype,"popupEnabled",void 0),e.__decorate([s.property({type:t})],c.prototype,"popupTemplate",void 0),e.__decorate([s.property()],c.prototype,"prefix",void 0),e.__decorate([s.property()],c.prototype,"resultGraphicEnabled",void 0),e.__decorate([s.property()],c.prototype,"resultSymbol",void 0),e.__decorate([s.property()],c.prototype,"suffix",void 0),e.__decorate([s.property()],c.prototype,"suggestionsEnabled",void 0),e.__decorate([s.property()],c.prototype,"withinViewEnabled",void 0),e.__decorate([s.property()],c.prototype,"zoomScale",void 0),c=e.__decorate([l.subclass("esri.widgets.Search.SearchSource")],c),c})},"esri/widgets/Search/support/layerSearchUtils":function(){define(["exports","../../../intl","../../../core/Error","../../../core/has","../../../core/lang","../../../core/Logger","../../../core/maybe","../../../core/unitUtils","../../../geometry/Polygon","../../../geometry/support/geometryUtils","../../../rest/support/FullTextSearch","../../../intl/substitute","../../../intl/date"],function(e,t,r,o,s,i,n,a,l,c,u,p,d){"use strict";const h=/https?:\/\/services.*\.arcgis\.com/i,g=/(?:\{([^}]+)\})/g,y=()=>i.getLogger("esri.widgets.Search.support.layerSearchUtils");function m(e,t){const{filter:r,withinViewEnabled:o}=e,s=t?.extent,i=r?.geometry;return i??(o&&s?s:void 0)}function _(e){return e&&e.includes("*")}async function f(e){e&&await e.load()}function S(e){return!(!e.fullText&&!e.where)}function v(e,t){const r=e?.indexes;return!(!r||!t?.length)&&r.filter(e=>"FullText"===e.indexType).some(e=>{const r=e.fields?.split(",").map(e=>e.trim().toLowerCase())||[];return t.every(e=>r.includes(e.toLowerCase()))})}function w({text:e,searchFields:t}){return e.trim().split(" ").filter(e=>!!e.trim()).map(e=>new u({onFields:t,searchTerm:e,searchType:"prefix"}))}function b(e){return e?.capabilities?.query?.supportsFullTextSearch??!1}function x(e){return e?.capabilities?.query?.supportsPagination??!1}function T(e){return e.displayField||e.layer.displayField||(t=e.layer,t?.fieldsIndex?.fields?.find(e=>"string"===e.type)?.name??"");var t}function R(e,t){return!(!e||!t?.length)&&t.every(t=>L(e,t))}function L(e,t){return!!e.getField(t)}function M(e){return e.replaceAll("'","''")}function C(e,t){const r=t?.where;return r?`(${e}) AND (${r})`:e}function F({searchTerm:e,layer:t,searchFields:r,filter:s,exactMatch:i,query:a,type:l}){const{definitionExpression:c,url:u}=t;let p="";return!a.fullText&&e&&r&&r.forEach(r=>{const a=t.getField(r),c=t.getFieldDomain?.(r,{excludeImpliedDomains:o("esri-widget-legacy-field-domain-calculation")}),d=c&&"coded-value"===c.type?function({codedValues:e},t,r){return n.mappedFind(e??[],e=>{const o=e.name,s=r?o:o.toLowerCase();return(r?t:t.toLowerCase())===s?e.code.toString():null})??null}(c,e,i):null,g=d||e||null;if(null!==g){const e=function({currentTerm:e,field:t,filter:r,exactMatch:o,url:s,type:i}){const n=t?.type,a=t?.name;if("string"===n||"date"===n||"global-id"===n){const t=h.test(s??""),n=t&&function(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}(e)?"N":"";return C(o&&"search"===i?`${a} = ${n}'${e}'`:t?`${a} LIKE ${n}'${e}%'`:`LOWER(${a}) LIKE ${n}'${e.toLowerCase()}%'`,r)}if("oid"===n||"small-integer"===n||"integer"===n||"single"===n||"double"===n){const t=Number(e);return isNaN(t)?null:C(`${a} = ${t}`,r)}return C(`${a} = ${e}`,r)}({currentTerm:g,field:a,filter:s,exactMatch:i,url:u,type:l});e&&(p+=function(e,t){return e?` OR (${t})`:`(${t})`}(p,e))}}),c&&p?`(${c}) AND (${p})`:c||p}function E(e,t,r){const s=e.sourceLayer,{attributes:i}=e,n=s.getFieldDomain?.(r,{feature:e,excludeImpliedDomains:o("esri-widget-legacy-field-domain-calculation")});if(t)return p.substitute(t,i);if(r&&i){const e=s.getField(r),t=(a=i)[l=r]??a[Object.keys(a).find(e=>e.toLowerCase()===l.toLowerCase())];return null==t?"":n&&"coded-value"===n.type?function(e,t){let r=null;const{codedValues:o}=e;return o&&o.length&&o.some(e=>e.code===t&&(r=e.name,!0)),r}(n,t)??"":"date"===e?.type?d.formatDate(new Date(t)):"number"==typeof t?t.toString():"string"!=typeof t?"":t.trim()}var a,l;return""}e.createFullTextSearchInfos=w,e.getResults=function(e,t){const{exactMatch:o=!1,location:i,maxResults:n,spatialReference:u,source:p,sourceIndex:d,suggestResult:h,view:g}=e,{layer:C,filter:I,zoomScale:P}=p,A=g?.scale,O=m(p,g),N=t?.signal;return f(C).then(()=>{const e=C.popupTemplate;return e?e.getRequiredFields(C.fieldsIndex):null}).then(e=>{const{objectIdField:t,returnZ:m}=C,f=T(p);if(!L(C,f))throw y().error("invalid-field: displayField is invalid."),new r("getResults():invalid-field","displayField is invalid.");const j=e?.length?e:[f],G=p.outFields||j,k=_(G);if(G.includes(t)||k||G.push(t),C.floorInfo?.floorField&&G.push(C.floorInfo.floorField),!k&&!R(C,G))throw y().error("invalid-field: outField is invalid."),new r("getResults():invalid-field","outField is invalid.");const $=C.createQuery(),{orderByFields:D}=p;if(D&&($.orderByFields=D),u){$.outSpatialReference=u;const e=1/a.getMetersPerUnitForSR(u);e&&($.maxAllowableOffset=e)}const J="mesh"===C.geometryType||"multipatch"===C.geometryType,U=C.capabilities?.data?.supportsZ&&!J;if($.returnZ=U&&!1!==m,$.returnGeometry=!0,$.multipatchOption=J?"xyFootprint":null,G&&($.outFields=G),i)$.geometry=i;else if(h.key)$.objectIds=[h.key];else{const e=p.searchFields||[f];if(!R(C,e))throw y().error("invalid-field: search field is invalid."),new r("getResults():invalid-field","search field is invalid.");x(C)&&($.num=n),O&&($.geometry=O);const t=h.text?.trim();if(!t)return[];const s=h.text,{prefix:i="",suffix:a=""}=p,l=M(`${i}${s}${a}`);b(C)&&v(C,e)&&!o&&s&&($.fullText=w({text:s,searchFields:e}));const c=F({searchTerm:l,layer:C,searchFields:e,filter:I,exactMatch:o,query:$,type:"search"});if($.where=c,!S($))return[]}return C.queryFeatures($,{signal:N}).then(e=>function(e,t,r,o,i,n,a){return e.features.map(e=>function(e,t,r,o,i,n,a){const u=e.clone();u.layer=e.layer;const p=e.sourceLayer,d=p?.objectIdField,h=d?e.attributes[d]:null,g=E(e,r.searchTemplate,i);null!=n&&function(e){return null!=e&&null!=e.minScale&&null!=e.maxScale}(p)&&(p.minScale&&p.minScale<n?n=p.minScale:p.maxScale&&p.maxScale>n&&(n=p.maxScale));const y=u.geometry?c.createExtentFromGeometry(u.geometry,t??void 0,n??void 0):void 0,m="number"==typeof a&&y?c.scaleExtent(s.clone(y),t??void 0,a):y,_=e.clone();return _.layer=e.layer,null!=m&&(_.geometry=l.fromExtent(m)),{extent:m,target:_,feature:u,key:h,name:g,sourceIndex:o}}(e,t,r,o,i,n,a))}(e,g,p,d,f,A,P))})},e.getSuggestions=function(e,t){const{source:o,spatialReference:s,view:i,suggestTerm:n,maxSuggestions:a,sourceIndex:l,exactMatch:c}=e,{layer:u,filter:p}=o,d=t?.signal,h=m(o,i);return f(u).then(()=>{if(!x(u))return[];const e=T(o),t=o.searchFields||[e],i=[];o.suggestionTemplate?o.suggestionTemplate.replaceAll(g,(e,t)=>(i.push(t),e)):i.push(e);const m=_(i);i.includes(u.objectIdField)||m||i.push(u.objectIdField);const f=L(u,e),C=m||R(u,i),I=R(u,t);if(!f)throw y().error("invalid-field: displayField is invalid."),new r("getSuggestions():invalid-field","displayField is invalid.");if(!C)throw y().error("invalid-field: outField is invalid."),new r("getSuggestions():invalid-field","outField is invalid.");if(!I)throw y().error("invalid-field: search field is invalid."),new r("getSuggestions():invalid-field","search field is invalid.");const P=u.createQuery(),{orderByFields:A}=o;if(A&&(P.orderByFields=A),P.outSpatialReference=s,P.returnGeometry=!1,P.num=a,P.outFields=i,h&&(P.geometry=h),!n.trim())return[];const{prefix:O="",suffix:N=""}=o,j=M(`${O}${n}${N}`);b(u)&&v(u,t)&&!c&&n&&(P.fullText=w({text:n,searchFields:t}));const G=F({searchTerm:j,layer:u,searchFields:t,filter:p,exactMatch:c,query:P,type:"suggest"});return P.where=G,S(P)?u.queryFeatures(P,{signal:d}).then(t=>function(e,t,r,o){return e.features.map(e=>function(e,t,r,o){const s=e.sourceLayer,{attributes:i}=e,{objectIdField:n}=s,a=n?i[n]:null;return{text:E(e,t.suggestionTemplate,o),key:a,sourceIndex:r}}(e,t,r,o))}(t,o,l,e)):[]})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Search/LocatorSearchSource":function(){define(["../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./SearchSource","./support/locatorUtils"],function(e,t,r,o,s,i,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.defaultZoomScale=null,this.localSearchDisabled=!1,this.language=null,this.locationType=null,this.name="",this.placeholder="",this.searchTemplate="",this.singleLineFieldName=null,this.suggestionsEnabled=null,this.url=null,this.zoomScale=null,this.getResults=(e,t)=>a.getResults({source:this,...e},t),this.getSuggestions=(e,t)=>a.getSuggestions({source:this,...e},t)}clone(){return new l({apiKey:this.apiKey,autoNavigate:this.autoNavigate,categories:this.categories?t.clone(this.categories):null,countryCode:this.countryCode,filter:this.filter,language:this.language,locationType:this.locationType,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?t.clone(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?.clone()??null,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,suffix:this.suffix,suggestionsEnabled:this.suggestionsEnabled,url:this.url,withinViewEnabled:this.withinViewEnabled,zoomScale:this.zoomScale})}};return e.__decorate([r.property()],c.prototype,"apiKey",void 0),e.__decorate([r.property()],c.prototype,"categories",void 0),e.__decorate([r.property()],c.prototype,"countryCode",void 0),e.__decorate([r.property({json:{write:!0}})],c.prototype,"defaultZoomScale",void 0),e.__decorate([r.property()],c.prototype,"localSearchDisabled",void 0),e.__decorate([r.property()],c.prototype,"language",void 0),e.__decorate([r.property()],c.prototype,"locationType",void 0),e.__decorate([r.property({json:{write:!0}})],c.prototype,"name",void 0),e.__decorate([r.property({json:{write:!0}})],c.prototype,"placeholder",void 0),e.__decorate([r.property()],c.prototype,"searchTemplate",void 0),e.__decorate([r.property({json:{write:!0}})],c.prototype,"singleLineFieldName",void 0),e.__decorate([r.property({json:{read:{source:"suggest"},write:{target:"suggest"}}})],c.prototype,"suggestionsEnabled",void 0),e.__decorate([r.property({json:{write:!0}})],c.prototype,"url",void 0),e.__decorate([r.property({json:{write:!0}})],c.prototype,"zoomScale",void 0),c=l=e.__decorate([i.subclass("esri.widgets.Search.LocatorSearchSource")],c),c})},"esri/widgets/Search/support/locatorUtils":function(){define(["exports","../../../Graphic","../../../geometry/Polygon","../../../geometry/support/geometryUtils","../../../rest/locator/addressToLocations","../../../rest/locator/locationToAddress","../../../rest/locator/suggestLocations","../../../rest/support/AddressToLocationsParameters","../../../rest/support/LocationToAddressParameters","../../../rest/support/SuggestLocationsParameters"],function(e,t,r,o,s,i,n,a,l,c){"use strict";function u(e,t){if(t.localSearchDisabled)return null;const r=e?.scale;return"number"==typeof r&&r<=3e5?e?.extent?.center:null}function p(e,t){const{filter:r,withinViewEnabled:s}=e,i=t?.scale,n=t?.extent,a=r?.geometry;return(a?o.createExtentFromGeometry(a,t??void 0,i):void 0)||(s&&n?n:void 0)}function d(e,s){return e.filter(Boolean).map(e=>function(e,s){const{key:i,scale:n,sourceIndex:a,view:l,zoomScale:c,defaultZoomScale:u}=s,{attributes:p,extent:d,location:h,address:g}=e,y=new t({geometry:h,attributes:p}),m=d||h,_=m?o.createExtentFromGeometry(m,l??void 0,n??void 0):void 0,f=_?"number"==typeof c?o.scaleExtent(_,l??void 0,c):"number"==typeof u&&"point"===m?.type?o.scaleExtent(_,l??void 0,u):_:null,S=h?`${h.x},${h.y}`:"",v=g||S,w=y.clone();return null!=f&&(w.geometry=r.fromExtent(f)),{extent:f,feature:y,target:w,key:i,name:v,sourceIndex:a}}(e,s))}e.getLocation=u,e.getResults=function(e,t){return e.location?async function(e,t){const{location:r,source:o,sourceIndex:s,spatialReference:n,view:a}=e,{apiKey:c,defaultZoomScale:u,language:p,url:h,zoomScale:g}=o;if(null==h)return[];const y=a?.scale,m=t?.signal,_=new l({language:p,location:r,apiKey:c,outSpatialReference:n});try{return d([await i.locationToAddress(h,_,{signal:m})],{defaultZoomScale:u,scale:y,sourceIndex:s,view:a,zoomScale:g})}catch{return[]}}(e,t):async function(e,t){const{source:r,suggestResult:o,spatialReference:i,view:n,maxResults:l,sourceIndex:c}=e,h=r?.zoomScale,g=r?.defaultZoomScale,y=o.text?.trim();if(!y)return null;const m=!o.key&&r.prefix?r.prefix:"",_=!o.key&&r.suffix?r.suffix:"",f=`${m}${o.text}${_}`,S=new a,{apiKey:v,url:w}=r,b=n?.scale,x=p(r,n),T=t?.signal;if(v&&(S.apiKey=v),!w)return null;r.categories&&(S.categories=r.categories),r.locationType&&(S.locationType=r.locationType),i&&(S.outSpatialReference=i);const R=u(n,r);R&&(S.location=R),S.maxLocations=l,x&&(S.searchExtent=x),r.countryCode&&(S.countryCode=r.countryCode);const{key:L}=o,M=`${L}`;return L&&(S.magicKey=M),S.address={},S.address[r.singleLineFieldName||"Single Line Input"]=f,r.outFields&&(S.outFields=r.outFields),s.addressToLocations(w,S,{signal:T}).then(e=>d(e,{key:M,scale:b,sourceIndex:c,view:n,zoomScale:h,defaultZoomScale:g}))}(e,t)},e.getSuggestions=async function(e,t){const{source:r,spatialReference:o,view:s,suggestTerm:i,maxSuggestions:a,sourceIndex:l}=e,d=new c,{apiKey:h,url:g}=r,y=p(r,s),m=t?.signal;if(!g)return null;h&&(d.apiKey=h),r.categories&&(d.categories=r.categories),o&&(d.outSpatialReference=o);const _=u(s,r);if(_&&(d.location=_),!i.trim())return null;const{prefix:f="",suffix:S=""}=r,v=`${f}${i}${S}`;return d.text=v,y&&(d.searchExtent=y),d.maxSuggestions=a,r.countryCode&&(d.countryCode=r.countryCode),n.suggestLocations(g,d,{signal:m}).then(e=>function(e,t){return e.map(e=>function(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}(e,t))}(e,l))},e.isArcGISWorldGeocoder=function(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)},e.isMeteredArcGISWorldGeocoder=function(e){return!!e&&/(?:geocode-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)},e.isProxiedArcGISWorldGeocoder=function(e){return!!e&&/(?:\/servers\/[\da-z.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)},e.meteredArcGISLocatorUrl="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/locator/addressToLocations":function(){define(["exports","../../request","../utils","./utils","../support/AddressCandidate","../support/AddressToLocationsParameters"],function(e,t,r,o,s,i){"use strict";function n({data:e}){if(!e)return[];const{candidates:t,spatialReference:r}=e;return t?t.map(e=>{if(!e)return;const{extent:t,location:i}=e,n=!t||o.isValidExtent(t);return o.isValidLocation(i)&&n?(t&&(t.spatialReference=r),i&&(i.spatialReference=r),s.fromJSON(e)):void 0}):[]}e.addressToLocations=async function(e,o,s){o=i.from(o);const a=r.parseUrl(e),{address:l,...c}=o.toJSON(),u={...l,...c,f:"json"},p=r.encode({...a.query,...u}),d=r.asValidOptions(p,s),h=`${a.path}/findAddressCandidates`;return t(h,d).then(n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/locator/utils":function(){define(["exports"],function(e){"use strict";e.isValidExtent=function(e){return e&&"number"==typeof e.xmin&&"number"==typeof e.ymin&&"number"==typeof e.xmax&&"number"==typeof e.ymax},e.isValidLocation=function(e){return!!e&&"number"==typeof e.x&&"number"==typeof e.y},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/AddressCandidate":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/Extent","../../geometry/Point"],function(e,t,r,o,s,i,n,a,l){"use strict";let c=class extends t.JSONSupport{constructor(e){super(e),this.address=null,this.attributes=null,this.extent=null,this.location=null,this.score=null}};return e.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"address",void 0),e.__decorate([r.property({type:Object,json:{write:!0}})],c.prototype,"attributes",void 0),e.__decorate([r.property({type:a,json:{write:!0}})],c.prototype,"extent",void 0),e.__decorate([r.property({type:l,json:{write:!0}})],c.prototype,"location",void 0),e.__decorate([r.property({type:Number,json:{write:!0}})],c.prototype,"score",void 0),c=e.__decorate([n.subclass("esri.rest.support.AddressCandidate")],c),c})},"esri/rest/support/AddressToLocationsParameters":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/Extent","../../geometry/Point","../../geometry/SpatialReference","./commonProperties"],function(e,t,r,o,s,i,n,a,l,c,u){"use strict";let p=class extends t.JSONSupport{constructor(e){super(e),this.address=null,this.apiKey=null,this.categories=null,this.countryCode=null,this.forStorage=null,this.location=null,this.locationType=null,this.magicKey=null,this.maxLocations=null,this.outFields=null,this.outSpatialReference=null,this.searchExtent=null}};return e.__decorate([r.property({type:Object,json:{write:!0}})],p.prototype,"address",void 0),e.__decorate([r.property(u.apiKey)],p.prototype,"apiKey",void 0),e.__decorate([r.property({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],p.prototype,"categories",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],p.prototype,"countryCode",void 0),e.__decorate([r.property({type:Boolean,json:{write:!0}})],p.prototype,"forStorage",void 0),e.__decorate([r.property({type:l,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],p.prototype,"location",void 0),e.__decorate([r.property({type:["rooftop","street"],json:{write:!0}})],p.prototype,"locationType",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],p.prototype,"magicKey",void 0),e.__decorate([r.property({type:Number,json:{write:!0}})],p.prototype,"maxLocations",void 0),e.__decorate([r.property({type:[String],json:{write:{writer:(e,t)=>{t.outFields=e?e.join(","):null}}}})],p.prototype,"outFields",void 0),e.__decorate([r.property({type:c,json:{read:{source:"outSR"},write:{target:"outSR"}}})],p.prototype,"outSpatialReference",void 0),e.__decorate([r.property({type:a,json:{write:{writer:(e,t)=>{const r=e?e.shiftCentralMeridian():null;t.searchExtent=r}}}})],p.prototype,"searchExtent",void 0),p=e.__decorate([n.subclass("esri.rest.support.AddressToLocationsParameters")],p),p.from=o.ensureType(p),p})},"esri/rest/support/commonProperties":function(){define(["exports"],function(e){"use strict";const t={type:String,json:{read:{source:"token"},write:{target:"token"}}};e.apiKey=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/locator/locationToAddress":function(){define(["exports","../../request","../../core/Error","../utils","../support/AddressCandidate","../support/LocationToAddressParameters"],function(e,t,r,o,s,i){"use strict";e.locationToAddress=async function(e,n,a){const l=o.parseUrl(e),{path:c,query:u}=l,p=i.from(n);if(!p.location)throw new r("location-to-address:location-required","The location parameter is required");const d=function(e){const t=e.toJSON(),{featureTypes:r,forStorage:o,langCode:s,location:i,locationType:n,outFields:a,outSR:l,preferredLabelValues:c,returnInputLocation:u,token:p}=t;return{featureTypes:r?.join(","),forStorage:o,langCode:s,location:JSON.stringify(i),locationType:n,outFields:a?.join(","),outSR:l?.wkid??void 0,preferredLabelValues:c,returnInputLocation:u,token:p}}(p),h={...a,query:{...u,...d,f:"json"}},g=`${c}/reverseGeocode`,{data:y}=await t(g,h),{address:m,location:_}=y;return s.fromJSON({address:m?.Match_addr??"",attributes:m,location:_,score:100})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/LocationToAddressParameters":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../geometry/Point","../../geometry/SpatialReference","./commonProperties","./geocodeEnums"],function(e,t,r,o,s,i,n,a,l,c,u,p,d){"use strict";var h;let g=h=class extends t.JSONSupport{constructor(e){super(e),this.apiKey=null,this.featureTypes=null,this.forStorage=null,this.language=null,this.location=null,this.locationType=null,this.outFields=null,this.outSpatialReference=null,this.preferredLabelValues=null,this.returnInputLocation=null}writeFeatureTypes(e,t){e?.length&&(t.featureTypes=e.map(e=>d.geocodeFeatureTypeJsonMap.toJSON(e)))}writeLocation(e,t){t.location=e?.clone().normalize().toJSON()}static from(e){return o.ensureClass(h,e)}};return e.__decorate([r.property(p.apiKey)],g.prototype,"apiKey",void 0),e.__decorate([r.property({type:[["distance-marker","locality","poi","point-address","postal","street-address","street-intersection","street-name","sub-address"]],json:{write:!0}})],g.prototype,"featureTypes",void 0),e.__decorate([l.writer("featureTypes")],g.prototype,"writeFeatureTypes",null),e.__decorate([r.property({type:Boolean,json:{write:!0}})],g.prototype,"forStorage",void 0),e.__decorate([r.property({type:String,json:{name:"langCode",write:!0}})],g.prototype,"language",void 0),e.__decorate([r.property({type:c,json:{write:!0}})],g.prototype,"location",void 0),e.__decorate([l.writer("location")],g.prototype,"writeLocation",null),e.__decorate([r.property({type:["street","rooftop"],json:{write:!0}})],g.prototype,"locationType",void 0),e.__decorate([r.property({type:[String],json:{write:!0}})],g.prototype,"outFields",void 0),e.__decorate([r.property({type:u,json:{name:"outSR",write:!0}})],g.prototype,"outSpatialReference",void 0),e.__decorate([n.enumeration(d.geocodePreferredLabelJsonMap)],g.prototype,"preferredLabelValues",void 0),e.__decorate([r.property({type:Boolean,json:{write:!0}})],g.prototype,"returnInputLocation",void 0),g=h=e.__decorate([a.subclass("esri.rest.support.LocationToAddressParameters")],g),g})},"esri/rest/support/geocodeEnums":function(){define(["exports","../../core/jsonMap"],function(e,t){"use strict";const r=t.strict()({DistanceMarker:"distance-marker",Locality:"locality",POI:"poi",PointAddress:"point-address",Postal:"postal",StreetAddress:"street-address",StreetInt:"street-intersection",StreetName:"street-name",Subaddress:"sub-address"}),o=t.strict()({localCity:"local-city",postalCity:"postal-city"});e.geocodeFeatureTypeJsonMap=r,e.geocodePreferredLabelJsonMap=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/locator/suggestLocations":function(){define(["exports","../../request","../utils","../support/SuggestionCandidate","../support/SuggestLocationsParameters"],function(e,t,r,o,s){"use strict";function i(e){const{data:t}=e;if(!t)return[];const{suggestions:r}=t;return r?r.map(e=>new o(e)):[]}e.suggestLocations=async function(e,o,n){const a=r.parseUrl(e),l={...(o=s.from(o)).toJSON(),f:"json"},c=r.encode({...a.query,...l}),u=r.asValidOptions(c,n),p=`${a.path}/suggest`;return t(p,u).then(i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/SuggestionCandidate":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,s,i,n){"use strict";let a=class extends t.JSONSupport{constructor(e){super(e),this.isCollection=null,this.magicKey=null,this.text=null}};return e.__decorate([r.property({type:Boolean,json:{write:!0}})],a.prototype,"isCollection",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"magicKey",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"text",void 0),a=e.__decorate([n.subclass("esri.rest.support.SuggestionCandidate")],a),a})},"esri/rest/support/SuggestLocationsParameters":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/Extent","../../geometry/Point","../../geometry/SpatialReference","./commonProperties"],function(e,t,r,o,s,i,n,a,l,c,u){"use strict";let p=class extends t.JSONSupport{constructor(e){super(e),this.apiKey=null,this.categories=null,this.countryCode=null,this.location=null,this.maxSuggestions=null,this.outSpatialReference=null,this.searchExtent=null,this.text=null}};return e.__decorate([r.property(u.apiKey)],p.prototype,"apiKey",void 0),e.__decorate([r.property({type:[String],json:{read:{source:"category",reader:e=>e?e.split(","):null},write:{target:"category",writer:(e,t)=>{t.category=e?e.join(","):null}}}})],p.prototype,"categories",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],p.prototype,"countryCode",void 0),e.__decorate([r.property({type:l,json:{write:{writer:(e,t)=>{t.location=e?e.clone().normalize():null}}}})],p.prototype,"location",void 0),e.__decorate([r.property({type:Number,json:{write:!0}})],p.prototype,"maxSuggestions",void 0),e.__decorate([r.property({type:c,json:{read:{source:"outSR"},write:{target:"outSR"}}})],p.prototype,"outSpatialReference",void 0),e.__decorate([r.property({type:a,json:{write:{writer:(e,t)=>{const r=e?e.shiftCentralMeridian():null;t.searchExtent=JSON.stringify(r)}}}})],p.prototype,"searchExtent",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],p.prototype,"text",void 0),p=e.__decorate([n.subclass("esri.rest.support.SuggestLocationsParameters")],p),p.from=o.ensureType(p),p})},"esri/widgets/support/geolocationUtils":function(){define(["exports","../../config","../../core/Error","../../core/has","../../core/Logger","../../geometry/Point","../../geometry/support/webMercatorUtils","../../portal/Portal","../../rest/geometryService/project","../../rest/support/ProjectParameters"],function(e,t,r,o,s,i,n,a,l,c){"use strict";const u=()=>s.getLogger("esri.widgets.support.geolocationUtils"),p={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};let d;e.getCurrentPosition=function(e){return e??=p,new Promise((t,o)=>{setTimeout(()=>o(new r("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(t,o,e??void 0)})},e.overridePositionToPoint=function(e){d=e},e.positionToPoint=function(e,o){if(d)return d(e,o);const{position:s,view:u}=e,p=function(e){const t=e&&e.coords||{},r={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed,toJSON:()=>({})};return e?{coords:r,timestamp:e.timestamp,toJSON:()=>({})}:e}(s),h=p?.coords;if(!h)throw new r("geometry-service:no-coords","Geolocation has no coordinates");return function(e,o,s){if(!o)return Promise.resolve(e);const i=o.spatialReference;return i.isWGS84?Promise.resolve(e):i.isWebMercator?Promise.resolve(n.geographicToWebMercator(e)):function(e){if(t.geometryServiceUrl)return Promise.resolve(t.geometryServiceUrl);const r=a.getDefault();return r.load(e).catch(()=>{}).then(()=>r.helperServices?.geometry?.url)}(s).then(t=>{if(!t)throw new r("geometry-service:missing-url","Geometry service URL is missing");const o=new c({geometries:[e],outSpatialReference:i});return l.project(t,o,s).then(e=>e[0])})}(function({longitude:e,latitude:t,altitude:r}){return new i({longitude:e,latitude:t,z:r||void 0,spatialReference:{wkid:4326}})}(h),u,o)},e.supported=function(){return function(){const e=!!o("esri-geolocation");return e||u().warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||u().warnOnce("insecure-context","Geolocation requires a secure origin."),e}()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/project":function(){define(["exports","../../request","../../core/accessorSupport/ensureType","../../geometry/support/jsonUtils","../utils","./utils","../support/ProjectParameters"],function(e,t,r,o,s,i,n){"use strict";const a=r.ensureType(n);e.project=async function(e,r,n){r=a(r);const l=s.parseUrl(e),c={...l.query,f:"json",...r.toJSON()},u=r.outSpatialReference,p=o.getJsonType(r.geometries[0]),d=s.asValidOptions(c,n);return t(l.path+"/project",d).then(({data:{geometries:e}})=>i.decodeGeometries(e,p,u))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/SpatialReference","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils"],function(e,t,r,o,s,i,n,a,l,c,u){"use strict";return e.default=class extends r.JSONSupport{constructor(e){super(e),this.geometries=[],this.outSpatialReference=null,this.transformation=null,this.transformForward=null}toJSON(){const e=this.geometries.map(e=>e.toJSON()),t=this.geometries[0],r={};return r.outSR=u.srToRESTValue(this.outSpatialReference),r.inSR=u.srToRESTValue(t.spatialReference),r.geometries=JSON.stringify({geometryType:c.getJsonType(t),geometries:e}),this.transformation&&(r.transformation=this.transformation.wkid||JSON.stringify(this.transformation)),null!=this.transformForward&&(r.transformForward=this.transformForward),r}},t.__decorate([o.property()],e.default.prototype,"geometries",void 0),t.__decorate([o.property({type:l,json:{read:{source:"outSR"}}})],e.default.prototype,"outSpatialReference",void 0),t.__decorate([o.property()],e.default.prototype,"transformation",void 0),t.__decorate([o.property()],e.default.prototype,"transformForward",void 0),e.default=t.__decorate([a.subclass("esri.rest.support.ProjectParameters")],e.default),e.default})},"esri/widgets/support/GoTo":function(){define(["exports","../../chunks/tslib.es6","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./goToUtils"],function(e,t,r,o,s,i,n,a,l){"use strict";e.GoTo=e=>{const s=e;let i=class extends s{constructor(...e){super(...e),this.goToOverride=null,this.view=null}callGoTo(e){const{view:t}=this;return r.assertIsSome(t),this.goToOverride?this.goToOverride(t,e):l.goTo(t,e.target,e.options)}};return t.__decorate([o.property()],i.prototype,"goToOverride",void 0),t.__decorate([o.property()],i.prototype,"view",void 0),i=t.__decorate([a.subclass("esri.widgets.support.GoTo")],i),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/goToUtils":function(){define(["exports"],function(e){"use strict";e.goTo=function(e,t,r){return e.goTo(t,r)},e.makeGoToWithoutAnimation=function(){return(e,t)=>e.goTo(t.target,{...t.options,animate:!1})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/globalCss":function(){define(["exports"],function(e){"use strict";e.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",primaryTickLabelKeepAll:"primary-tick__label--keep-all",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["require","../chunks/tslib.es6","../intl","../core/deprecate","../core/Logger","../core/maybe","../core/promiseUtils","../core/reactiveUtils","../core/scheduling","../core/accessorSupport/decorators/property","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Widget","./Search/css","./Search/SearchResultRenderer","./Search/SearchViewModel","../chunks/componentsUtils","./support/globalCss","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","../intl/substitute"],function(e,t,r,o,s,i,n,a,l,c,u,p,d,h,g,y,m,_,f,S,v,w,b,x){"use strict";let T=class extends h{constructor(e,t){super(e,t),this._currentLocationValue=`${this.id}-search-use-current-location`,this._autocompleteNode=null,this._focusAbortController=null,this._searchResultRenderer=new y,this._suggestController=null,this._searchController=null,this._lastSearchTerm="",this._locateFailed=!1,this._showNoResults=!1,this.disabled=!1,this.messages=null,this.messagesCommon=null,this.viewModel=new m,this._renderSearchResultsContent=()=>this._searchResultRenderer,o.deprecateWidget(s.getLogger(this),"Search","arcgis-search",{version:"4.33"}),this.addHandles([a.watch(()=>this.viewModel,e=>this._searchResultRenderer.viewModel=e,a.initial),a.watch(()=>this.viewModel.results,()=>this._searchResultRenderer.showMoreResultsOpen=!1),a.watch(()=>this.viewModel?.defaultPopupTemplate,e=>{e&&(e.content=this._renderSearchResultsContent)},a.initial)])}loadDependencies(){return _.loadCalciteComponents({autocomplete:()=>new Promise((t,r)=>e(["../chunks/index52"],t,r)),"autocomplete-item-group":()=>new Promise((t,r)=>e(["../chunks/index53"],t,r)),"autocomplete-item":()=>new Promise((t,r)=>e(["../chunks/index54"],t,r)),button:()=>new Promise((t,r)=>e(["../chunks/index2"],t,r)),dropdown:()=>new Promise((t,r)=>e(["../chunks/index24"],t,r)),"dropdown-group":()=>new Promise((t,r)=>e(["../chunks/index25"],t,r)),"dropdown-item":()=>new Promise((t,r)=>e(["../chunks/index26"],t,r)),notice:()=>new Promise((t,r)=>e(["../chunks/index6"],t,r))})}destroy(){this._cancelQueries(),this._searchResultRenderer=i.destroyMaybe(this._searchResultRenderer),this._focusAbortController?.abort()}get _isDisabled(){const{state:e}=this.viewModel;return"disabled"===e||"loading"===e||this.disabled}get _showCurrentLocation(){return this.locationEnabled&&!this.searchTerm?.trim()}get _effectiveActiveMenu(){const{activeMenu:e}=this;return this._isDisabled?"none":"warning"===e?"suggestion":e}get activeMenu(){return"none"}set activeMenu(e){"warning"===e&&o.deprecatedPropertyValue(s.getLogger(this),"activeMenu","warning",{replacement:"Use the value 'suggestion' instead",version:"4.32",warnOnce:!0}),this._overrideIfSome("activeMenu",e)}get activeSource(){return this.viewModel?.activeSource}get activeSourceIndex(){return this.viewModel.activeSourceIndex}set activeSourceIndex(e){this.viewModel.activeSourceIndex=e}get allPlaceholder(){return this.viewModel.allPlaceholder}set allPlaceholder(e){this.viewModel.allPlaceholder=e}get allSources(){return this.viewModel.allSources}get autoNavigate(){return this.viewModel.autoNavigate}set autoNavigate(e){this.viewModel.autoNavigate=e}get autoSelect(){return this.viewModel.autoSelect}set autoSelect(e){this.viewModel.autoSelect=e}get defaultSources(){return this.viewModel.defaultSources}get goToOverride(){return this.viewModel.goToOverride}set goToOverride(e){this.viewModel.goToOverride=e}get icon(){return"search"}set icon(e){this._overrideIfSome("icon",e)}get includeDefaultSources(){return this.viewModel.includeDefaultSources}set includeDefaultSources(e){this.viewModel.includeDefaultSources=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get locationEnabled(){return this.viewModel.locationEnabled}set locationEnabled(e){this.viewModel.locationEnabled=e}get maxResults(){return this.viewModel.maxResults}set maxResults(e){this.viewModel.maxResults=e}get maxSuggestions(){return this.viewModel.maxSuggestions}set maxSuggestions(e){this.viewModel.maxSuggestions=e}get minSuggestCharacters(){return this.viewModel.minSuggestCharacters}set minSuggestCharacters(e){this.viewModel.minSuggestCharacters=e}get popupEnabled(){return this.viewModel.popupEnabled}set popupEnabled(e){this.viewModel.popupEnabled=e}get popupTemplate(){return this.viewModel.popupTemplate}set popupTemplate(e){this.viewModel.popupTemplate=e}get portal(){return this.viewModel?.portal}set portal(e){this.viewModel&&(this.viewModel.portal=e)}get resultGraphic(){return this.viewModel.resultGraphic}set resultGraphic(e){this.viewModel.resultGraphic=e}get resultGraphicEnabled(){return this.viewModel.resultGraphicEnabled}set resultGraphicEnabled(e){this.viewModel.resultGraphicEnabled=e}get results(){return this.viewModel.results}get searchAllEnabled(){return this.viewModel.searchAllEnabled}set searchAllEnabled(e){this.viewModel.searchAllEnabled=e}get searchTerm(){return this.viewModel.searchTerm}set searchTerm(e){this.viewModel.searchTerm=e}get selectedResult(){return this.viewModel.selectedResult}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get suggestions(){return this.viewModel.suggestions}get suggestionsEnabled(){return this.viewModel.suggestionsEnabled}set suggestionsEnabled(e){this.viewModel.suggestionsEnabled=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}clear(){this._locateFailed=!1,this.viewModel.clear()}focus(){this._handleFocus(),this._emitFocus()}blur(){this._autocompleteNode?.blur(),this._emitBlur()}async search(e){this._cancelQueries();const t=new AbortController,{signal:r}=t;this._searchController=t;try{const o=await this.viewModel.search(e,{signal:r});if(this._searchController!==t)return;return o?.numResults||(this._showNoResults=!0,this.activeMenu="suggestion"),this._searchController=null,o}catch(e){if(this._searchController!==t)return;return void(this._searchController=null)}}async suggest(e){this._cancelSuggest();const t=new AbortController,{signal:r}=t;this._suggestController=t;try{const o=await this.viewModel.suggest(e,null,{signal:r});if(this._suggestController!==t)return;return this._suggestController=null,o?.numResults&&(this.activeMenu="suggestion",this._scrollToTopSuggestion()),o}catch(e){return this._suggestController!==t||(this._suggestController=null),null}}render(){return b.tsx("div",{class:this.classes(g.css.base,f.globalCss.widget)},b.tsx("div",{class:g.css.container},this._renderSourcesMenu(),this._renderForm()))}_handleInputKeydown(e){"Tab"===e.key&&this._cancelSuggest()}_emitFocus(){this.emit("search-focus")}_emitBlur(){this.emit("search-blur")}async _handleFocus(){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const e=this._focusAbortController.signal;await n.ignoreAbortErrors(l.waitAnimationFrame(e)),this._autocompleteNode?.setFocus()}_renderSourcesMenu(){const{messages:e,_isDisabled:t,_effectiveActiveMenu:r}=this,{allSources:o,searchAllEnabled:s}=this.viewModel;return o.length>1?b.tsx("calcite-dropdown",{bind:this,class:g.css.dropdown,disabled:t,open:"source"===r,overlayPositioning:"fixed",onCalciteDropdownClose:this._handleSourceClose,onCalciteDropdownOpen:this._handleSourceOpen,onCalciteDropdownSelect:this._handleSourceSelect},b.tsx("calcite-button",{appearance:"outline-fill",iconStart:"caret-down",kind:"neutral",label:e.searchIn,slot:"trigger"}),b.tsx("calcite-dropdown-group",{groupTitle:e.searchIn},s?this._renderSource(m.ALL_INDEX):null,o.map((e,t)=>this._renderSource(t)).toArray())):null}_renderUseCurrentLocation(){const{_currentLocationValue:e}=this;return b.tsx("calcite-autocomplete-item",{heading:this.messages.useCurrentLocation,iconStart:"gps-on",key:e,value:e})}_handleAutocompleteCreate(e){this._autocompleteNode=e}_handleCalciteAutocompleteTextInput(e){const t=e.target.inputValue;t!==this.viewModel.searchTerm&&(this.viewModel.searchTerm=t,t||this.clear(),this.suggest())}_handleAutocompleteOpen(){this.activeMenu="suggestion"}_handleAutocompleteClose(){"suggestion"===this.activeMenu&&(this.activeMenu="none")}_handleCalciteAutocompleteChange(e){const t=e.target.value;if(t===this._currentLocationValue)return void this._useCurrentLocation();const r=JSON.parse(t),o=this.viewModel.suggestions?.find(({sourceIndex:e})=>e===r.sourceIndex)?.results?.find(({key:e})=>`${e}`==`${r.key}`);o&&this.search(o)}_renderAutocomplete(){const{_effectiveActiveMenu:e,messages:t,_isDisabled:r}=this,{maxInputLength:o,placeholder:s,searchTerm:i,state:n}=this.viewModel,a=this.label??t.searchButtonTitle??"";return b.tsx("calcite-autocomplete",{afterCreate:this._handleAutocompleteCreate,autocomplete:"off",bind:this,class:g.css.autocomplete,disabled:r,icon:this.icon||!1,inputValue:i,label:a,loading:"searching"===n,maxLength:o,name:this.id,onblur:this._emitBlur,onfocus:this._emitFocus,onkeydown:this._handleInputKeydown,open:"suggestion"===e,overlayPositioning:"fixed",placeholder:s,title:i?"":s,onCalciteAutocompleteChange:this._handleCalciteAutocompleteChange,onCalciteAutocompleteClose:this._handleAutocompleteClose,onCalciteAutocompleteOpen:this._handleAutocompleteOpen,onCalciteAutocompleteTextChange:this._handleCalciteAutocompleteTextInput,onCalciteAutocompleteTextInput:this._handleCalciteAutocompleteTextInput},this._renderSuggestions(),this._renderNotices())}_renderForm(){return b.tsx("form",{bind:this,class:g.css.form,disabled:this._isDisabled,key:g.css.form,onsubmit:this._formSubmit,role:"search"},this._renderAutocomplete())}_renderSuggestGroup(e){return e.results?.map(e=>this._renderSuggestion(e))}_renderSuggestions(){const{suggestions:e}=this.viewModel;return this._showNoResults?null:this._showCurrentLocation?this._renderUseCurrentLocation():e?.map(e=>this._renderSuggestResults(e))}_renderSuggestResults(e){const{allSources:t,activeSourceIndex:r}=this.viewModel,{sourceIndex:o}=e,s=e.results?.length,i=t.length>1&&r===m.ALL_INDEX,n=this._getSourceName(o);return s&&i?b.tsx("calcite-autocomplete-item-group",{heading:n,key:`suggestion-group-${n}-${o}`},this._renderSuggestGroup(e)):this._renderSuggestGroup(e)}_renderSuggestion({key:e,sourceIndex:t,text:r}){const o={key:e,sourceIndex:t};return b.tsx("calcite-autocomplete-item",{heading:r??this.messages.untitledResult,key:`suggestion_${e}`,value:JSON.stringify(o)})}_renderSource(e){const t=this._getSourceName(e);return b.tsx("calcite-dropdown-item",{"data-source-index":`${e}`,key:`source-${t}-${e}`,selected:e===this.viewModel.activeSourceIndex},t)}_renderNoResultsWarning(e){const{messages:t}=this,r=e?x.substitute(t.noResultsFoundForValue,{value:`"${e}"`}):t.noResultsFound;return b.tsx("calcite-notice",{icon:"exclamation-mark-triangle",key:"no-results-warning",kind:"warning",open:!0,slot:"content-bottom"},b.tsx("div",{slot:"title"},t.noResults),b.tsx("div",{slot:"message"},r))}_renderLocateError(){return b.tsx("calcite-notice",{icon:"exclamation-mark-circle",key:"locate-warning",kind:"danger",open:!0,slot:"content-bottom"},b.tsx("div",{slot:"message"},this.messages.locateError))}_renderNotices(){return this._locateFailed?this._renderLocateError():this._showNoResults?this._renderNoResultsWarning(this._lastSearchTerm??this.viewModel.searchTerm):null}async _useCurrentLocation(){this._cancelQueries();const e=new AbortController,{signal:t}=e;this._searchController=e;try{await this.viewModel.searchNearby({signal:t})}catch(e){n.isAbortError(e)||(this._locateFailed=!0,this.activeMenu="suggestion")}finally{this._searchController=null}}_handleSourceOpen(){this.activeMenu="source"}_handleSourceClose(){"source"===this.activeMenu&&(this.activeMenu="none")}_handleSourceSelect(e){const t=e.target.selectedItems[0].getAttribute("data-source-index");t&&(this.viewModel.activeSourceIndex=parseInt(t,10))}_cancelSuggest(){this.activeMenu="none",this._locateFailed=!1,this._showNoResults=!1,this._suggestController=i.abortMaybe(this._suggestController)}_cancelQueries(){this._cancelSuggest(),this._searchController=i.abortMaybe(this._searchController)}_scrollToTopSuggestion(){this._autocompleteNode?.scrollContentTo({top:0})}_formSubmit(e){e.preventDefault(),this.activeMenu="none",this._lastSearchTerm=this.searchTerm,this.searchTerm&&this.search()}_getSourceName(e){const{messages:t}=this,{allSources:r}=this.viewModel,o=r.at(e);return e===m.ALL_INDEX?t.all:o?.name||t.untitledSource}};return t.__decorate([c.property()],T.prototype,"_locateFailed",void 0),t.__decorate([c.property()],T.prototype,"_showNoResults",void 0),t.__decorate([c.property()],T.prototype,"_isDisabled",null),t.__decorate([c.property()],T.prototype,"_showCurrentLocation",null),t.__decorate([c.property()],T.prototype,"_effectiveActiveMenu",null),t.__decorate([c.property()],T.prototype,"activeMenu",null),t.__decorate([c.property({readOnly:!0})],T.prototype,"activeSource",null),t.__decorate([c.property()],T.prototype,"activeSourceIndex",null),t.__decorate([c.property()],T.prototype,"allPlaceholder",null),t.__decorate([c.property({readOnly:!0})],T.prototype,"allSources",null),t.__decorate([c.property()],T.prototype,"autoNavigate",null),t.__decorate([c.property()],T.prototype,"autoSelect",null),t.__decorate([c.property({readOnly:!0})],T.prototype,"defaultSources",null),t.__decorate([c.property()],T.prototype,"disabled",void 0),t.__decorate([c.property()],T.prototype,"goToOverride",null),t.__decorate([c.property()],T.prototype,"icon",null),t.__decorate([c.property()],T.prototype,"includeDefaultSources",null),t.__decorate([c.property()],T.prototype,"label",null),t.__decorate([c.property()],T.prototype,"locationEnabled",null),t.__decorate([c.property()],T.prototype,"maxResults",null),t.__decorate([c.property()],T.prototype,"maxSuggestions",null),t.__decorate([c.property(),v.messageBundle("esri/widgets/Search/t9n/Search")],T.prototype,"messages",void 0),t.__decorate([c.property(),v.messageBundle("esri/t9n/common")],T.prototype,"messagesCommon",void 0),t.__decorate([c.property()],T.prototype,"minSuggestCharacters",null),t.__decorate([c.property()],T.prototype,"popupEnabled",null),t.__decorate([c.property()],T.prototype,"popupTemplate",null),t.__decorate([c.property()],T.prototype,"portal",null),t.__decorate([c.property()],T.prototype,"resultGraphic",null),t.__decorate([c.property()],T.prototype,"resultGraphicEnabled",null),t.__decorate([c.property({readOnly:!0})],T.prototype,"results",null),t.__decorate([c.property()],T.prototype,"searchAllEnabled",null),t.__decorate([c.property()],T.prototype,"searchTerm",null),t.__decorate([c.property({readOnly:!0})],T.prototype,"selectedResult",null),t.__decorate([c.property()],T.prototype,"sources",null),t.__decorate([c.property({readOnly:!0})],T.prototype,"suggestions",null),t.__decorate([c.property()],T.prototype,"suggestionsEnabled",null),t.__decorate([c.property()],T.prototype,"view",null),t.__decorate([w.vmEvent(["search-complete","search-clear","search-start","select-result","suggest-start","suggest-complete"]),c.property({type:m})],T.prototype,"viewModel",void 0),T=t.__decorate([d.subclass("esri.widgets.Search")],T),T});