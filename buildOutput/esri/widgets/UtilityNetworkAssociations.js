// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../chunks/tslib.es6","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Widget","../chunks/componentsUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","./UtilityNetworkAssociations/UtilityNetworkAssociationsLineSymbolPicker","./UtilityNetworkAssociations/UtilityNetworkAssociationsViewModel","./UtilityNetworkAssociations/VisibleElements"],function(t,e,s,i,o,n,a,l,c,r,d,h,u,A,w,m){"use strict";const b="esri-un-associations",g={action:`${b}__action`,actionRefresh:`${b}__action-refresh`,blockContent:`${b}__block-content`,blockSectionSettings:`${b}__block-section-settings`,combobox:`${b}__combobox`,comboboxItem:`${b}__combobox-item`,divControlsMain:`${b}__div-controls-main`,label:`${b}__label`,labelAndCombobox:`${b}__label-and-combobox`,labelAndSlider:`${b}__label-and-slider`,labelAndToggle:`${b}__label-and-toggle`,panel:`${b}__panel`,slider:`${b}__slider`,statusIconContainer:`${b}__status-icon-container`,statusIconWarning:`${b}__status-icon-warning`,switch:`${b}__switch`,switchContainer:`${b}__switch-container`,widgetContainer:`${b}__widget-container`};let p=class extends c{constructor(t,e){super(t,e),this._autoRefreshAssociations=!0,this._associationsOptionsEnabled=!1,this._maxAllowableAssociationsSliderMax=1e3,this._maxAllowableAssociationsSliderMin=250,this._maxAllowableAssociationsSliderStep=250,this.messages=null,this.messagesCommon=null,this.viewModel=new w,this.visibleElements=new m}initialize(){this.addHandles([s.watch(()=>[this.view?.stationary,this.showAssociationsEnabled,this.includeConnectivityAssociations,this.includeStructuralAttachmentAssociations,this.maxAllowableAssociations],()=>{!0===this.autoRefreshAssociations&&(!0===this.showAssociationsEnabled?this.viewModel.showAssociations():this.viewModel.removeAssociations())}),s.watch(()=>this.view?.map?.utilityNetworks,t=>{t?.items.forEach(async(t,e)=>{t.loaded||await t.load(),0===e&&(this.utilityNetwork=t)})},s.initial),s.on(()=>this.view?.map?.utilityNetworks,"change",t=>{const e=t.target;t.added.forEach(async t=>{t.loaded||await t.load()}),t.removed.some(t=>t.layerUrl===this.utilityNetwork?.layerUrl)&&(this.utilityNetwork=null),this.utilityNetwork=e.length?e.getItemAt(0):null})])}get autoRefreshAssociations(){return this._autoRefreshAssociations}set autoRefreshAssociations(t){this._autoRefreshAssociations=t}get connectivityAssociationsLineSymbol(){return this.viewModel.connectivityAssociationsLineSymbol}set connectivityAssociationsLineSymbol(t){this.viewModel.connectivityAssociationsLineSymbol=t}get icon(){return"view-associations"}set icon(t){this._overrideIfSome("icon",t)}get includeConnectivityAssociations(){return this.viewModel.includeConnectivityAssociations}set includeConnectivityAssociations(t){this.viewModel.includeConnectivityAssociations=t}get includeStructuralAttachmentAssociations(){return this.viewModel.includeStructuralAttachmentAssociations}set includeStructuralAttachmentAssociations(t){this.viewModel.includeStructuralAttachmentAssociations=t}get label(){return this.messages?.widgetLabel??""}set label(t){this._overrideIfSome("label",t)}get maxAllowableAssociations(){return this.viewModel.maxAllowableAssociations}set maxAllowableAssociations(t){this.viewModel.maxAllowableAssociations=t}get maxAllowableAssociationsSliderMax(){return this._maxAllowableAssociationsSliderMax}set maxAllowableAssociationsSliderMax(t){t<=this.maxAllowableAssociationsSliderMin||(this._maxAllowableAssociationsSliderMax=t)}get maxAllowableAssociationsSliderMin(){return this._maxAllowableAssociationsSliderMin}set maxAllowableAssociationsSliderMin(t){t<0||t>=this.maxAllowableAssociationsSliderMax||(this._maxAllowableAssociationsSliderMin=t)}get maxAllowableAssociationsSliderStep(){return this._maxAllowableAssociationsSliderStep}set maxAllowableAssociationsSliderStep(t){this._maxAllowableAssociationsSliderStep=t}get showArrowsConnectivity(){return this.viewModel.showArrowsConnectivity}set showArrowsConnectivity(t){this.viewModel.showArrowsConnectivity=t}get showArrowsStructuralAttachment(){return this.viewModel.showArrowsStructuralAttachment}set showArrowsStructuralAttachment(t){this.viewModel.showArrowsStructuralAttachment=t}get showAssociationsEnabled(){return this.viewModel.showAssociationsEnabled}set showAssociationsEnabled(t){this.viewModel.showAssociationsEnabled=t}get structuralAttachmentAssociationsLineSymbol(){return this.viewModel.structuralAttachmentAssociationsLineSymbol}set structuralAttachmentAssociationsLineSymbol(t){this.viewModel.structuralAttachmentAssociationsLineSymbol=t}get utilityNetwork(){return this.viewModel.utilityNetwork}set utilityNetwork(t){this.viewModel.utilityNetwork=t}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){const{label:t}=this;return u.tsx("div",{class:g.widgetContainer},u.tsx("calcite-block",{class:g.blockContent,collapsible:!0,heading:t},this._renderStatusIcon(),this.autoRefreshAssociations?this._renderShowAssociationsSwitch():this._renderRefreshAssociationsAction(),this._renderContent()))}loadDependencies(){return r.loadCalciteComponents({action:()=>new Promise((e,s)=>t(["../chunks/index12"],e,s)),block:()=>new Promise((e,s)=>t(["../chunks/index13"],e,s)),"block-section":()=>new Promise((e,s)=>t(["../chunks/index50"],e,s)),icon:()=>new Promise((e,s)=>t(["../chunks/index7"],e,s)),combobox:()=>new Promise((e,s)=>t(["../chunks/index21"],e,s)),"combobox-item":()=>new Promise((e,s)=>t(["../chunks/index22"],e,s)),label:()=>new Promise((e,s)=>t(["../chunks/index5"],e,s)),notice:()=>new Promise((e,s)=>t(["../chunks/index6"],e,s)),panel:()=>new Promise((e,s)=>t(["../chunks/index51"],e,s)).then(t=>t.index),slider:()=>new Promise((e,s)=>t(["../chunks/index47"],e,s)),switch:()=>new Promise((e,s)=>t(["../chunks/index33"],e,s)),tooltip:()=>new Promise((e,s)=>t(["../chunks/index17"],e,s))})}_connectivityAssociationsSwitchChange(t){this.includeConnectivityAssociations=t.currentTarget.checked}_getLoadErrorMessagesAsNotices(t,e){return u.tsx("calcite-notice",{closable:!1,key:`error-notice-${e}`,kind:"warning",open:!0,scale:"s"},u.tsx("div",{slot:"message"},t))}_maxAllowableAssociationsSliderChange(t){this.maxAllowableAssociations=Number(t.currentTarget.value)}_refreshAssociations(){const{viewModel:t,viewModel:{state:e}}=this;"ready"!==e&&"warning"!==e||t.showAssociations()}_renderConnectivityAssociationsSettings(){const{messages:{input:{enableConnectivity:t}},visibleElements:{connectivityAssociationsSettings:e}}=this;if(e)return u.tsx("calcite-block-section",{class:g.blockSectionSettings,text:t},u.tsx(A,{id:`${this.id}-symbol-picker-connectivity`,lineSymbol:this.connectivityAssociationsLineSymbol,showArrows:this.showArrowsConnectivity,visibleElements:e}))}_renderConnectivityAssociationsToggle(){const{messages:{input:{enableConnectivity:t}}}=this;return u.tsx("div",{class:g.labelAndToggle,key:"connectivityAssociationsToggleDiv"},u.tsx("calcite-label",{class:g.label},t),u.tsx("calcite-switch",{bind:this,checked:this.includeConnectivityAssociations,disabled:!this._associationsOptionsEnabled&&this.autoRefreshAssociations,onCalciteSwitchChange:this._connectivityAssociationsSwitchChange}))}_renderComboboxItem({heading:t,value:e,selected:s}){return u.tsx("calcite-combobox-item",{class:g.comboboxItem,heading:t,selected:s,textLabel:t,value:e})}_renderContent(){const{viewModel:{loadErrors:t,state:e}}=this;return"disabled"===e?u.tsx("div",{class:g.divControlsMain,key:"loadErrorsDiv"},t.items.map(this._getLoadErrorMessagesAsNotices)):u.tsx("calcite-panel",{class:g.panel,disabled:"loading"===e},u.tsx("div",{class:g.divControlsMain},this._renderConnectivityAssociationsToggle(),this._renderStructuralAttachmentAssociationsToggle(),this._renderSettingsPane()))}_renderLoadingAction(t,e,s){return u.tsx("div",{key:t,slot:"control"},u.tsx("calcite-action",{id:e,loading:!0,text:s}),u.tsx("calcite-tooltip",{overlayPositioning:"fixed",referenceElement:e},u.tsx("span",null,s)))}_renderMaxAllowableAssociationsSlider(){const{messages:{input:{maxAllowableAssociations:t}},visibleElements:{maxAllowableAssociationsSlider:e}}=this;if(e)return u.tsx("div",{class:g.labelAndSlider,key:"maxAllowableAssociationsSliderDiv"},u.tsx("calcite-label",{class:g.label},t),u.tsx("calcite-slider",{bind:this,class:g.slider,labelTicks:!0,max:this.maxAllowableAssociationsSliderMax,min:this.maxAllowableAssociationsSliderMin,scale:"s",snap:!0,step:this.maxAllowableAssociationsSliderStep,ticks:this.maxAllowableAssociationsSliderStep,value:this.maxAllowableAssociations,onCalciteSliderChange:this._maxAllowableAssociationsSliderChange}))}_renderRefreshAssociationsAction(){const{messages:{input:{refreshAssociations:t}},messagesCommon:{loading:e},viewModel:{state:s}}=this,i=`${this.id}-refresh-action`;if("disabled"!==s)return u.tsx("div",{class:g.actionRefresh,slot:"control"},u.tsx("calcite-action",{bind:this,class:g.action,icon:"refresh-f",id:i,loading:"loading"===s,onclick:this._refreshAssociations,text:t}),u.tsx("calcite-tooltip",{overlayPositioning:"fixed",referenceElement:i},u.tsx("span",null,"loading"===s?e:t)))}_renderSettingsPane(){const{messagesCommon:{settings:t},visibleElements:{maxAllowableAssociationsSlider:e,connectivityAssociationsSettings:s,structuralAttachmentAssociationsSettings:i}}=this,o=(this.view?.map).utilityNetworks?.items;if(1!==o?.length||e||s||i)return u.tsx("calcite-block",{class:g.blockContent,collapsible:!0,heading:t},u.tsx("div",{class:g.divControlsMain},this._renderUtilityNetworkSettings(),this._renderMaxAllowableAssociationsSlider()),this._renderConnectivityAssociationsSettings(),this._renderStructuralAttachmentAssociationsSettings())}_renderShowAssociationsSwitch(){const{messages:{input:{enableAssociations:t}},messagesCommon:{loading:e},viewModel:{state:s}}=this,i=`${this.id}-show-associations-switch`;if("disabled"!==s)return"loading"===s?this._renderLoadingAction("loadingActionDiv",`${this.id}-loading-action`,e):u.tsx("div",{class:g.switchContainer,key:"switchDiv",slot:"control"},u.tsx("calcite-switch",{bind:this,checked:this.showAssociationsEnabled,class:g.switch,id:i,onCalciteSwitchChange:this._showAssociationsSwitchChange}),u.tsx("calcite-tooltip",{overlayPositioning:"fixed",referenceElement:i},u.tsx("span",null,t)))}_renderStatusIcon(){const{messagesCommon:{executing:t},viewModel:{executionError:e,state:s}}=this;switch(s){case"disabled":return this._renderWarningIcon("statusDiv",`${this.id}-disabled-icon`,null);case"warning":return this._renderWarningIcon("statusDiv",`${this.id}-warning-icon`,e);case"executing":return this._renderLoadingAction("executingActionDiv",`${this.id}-executing-action`,t);default:return}}_renderStructuralAttachmentAssociationsSettings(){const{messages:{input:{enableStructuralAttachment:t}},visibleElements:{structuralAttachmentAssociationsSettings:e}}=this;if(e)return u.tsx("calcite-block-section",{class:g.blockSectionSettings,text:t},u.tsx(A,{id:`${this.id}-symbol-picker-structural-attachment`,lineSymbol:this.structuralAttachmentAssociationsLineSymbol,showArrows:this.showArrowsStructuralAttachment,visibleElements:e}))}_renderStructuralAttachmentAssociationsToggle(){const{messages:{input:{enableStructuralAttachment:t}}}=this;return u.tsx("div",{class:g.labelAndToggle,key:"structuralAttachmentAssociationsToggleDiv"},u.tsx("calcite-label",{class:g.label},t),u.tsx("calcite-switch",{bind:this,checked:this.includeStructuralAttachmentAssociations,disabled:!this._associationsOptionsEnabled&&this.autoRefreshAssociations,onCalciteSwitchChange:this._structuralAttAssociationsSwitchChange}))}_renderUtilityNetworkSettings(){const{messages:{input:{utilityNetwork:t}}}=this,e=(this.view?.map).utilityNetworks?.items;if(1===e?.length)return null;const s=e?.map(t=>{const e=t.title,s=t.layerUrl,i=t.layerUrl===this.utilityNetwork?.layerUrl;return this._renderComboboxItem({heading:e,value:s,selected:i})});return u.tsx("div",{class:g.labelAndCombobox,key:"utilityNetworkComboboxDiv"},u.tsx("calcite-label",{class:g.label},t),u.tsx("calcite-combobox",{class:g.combobox,clearDisabled:!0,label:"",maxItems:3,overlayPositioning:"fixed",selectionMode:"single-persist",onCalciteComboboxChange:t=>{const s=e?.find(e=>e.layerUrl===t.currentTarget.value);this.utilityNetwork=s}},s))}_showAssociationsSwitchChange({currentTarget:t}){const{viewModel:e}=this;this.showAssociationsEnabled=t.checked,this._associationsOptionsEnabled=t.checked,this.showAssociationsEnabled||e.removeAssociations()}_structuralAttAssociationsSwitchChange(t){this.includeStructuralAttachmentAssociations=t.currentTarget.checked}_renderWarningIcon(t,e,s){return s?u.tsx("div",{class:g.statusIconContainer,key:t,slot:"control"},u.tsx("calcite-icon",{class:g.statusIconWarning,icon:"exclamation-mark-triangle",id:e,scale:"s"}),u.tsx("calcite-tooltip",{overlayPositioning:"fixed",referenceElement:e},u.tsx("span",null,s))):u.tsx("div",{class:g.statusIconContainer,key:t,slot:"control"},u.tsx("calcite-icon",{class:g.statusIconWarning,icon:"exclamation-mark-triangle",id:e,scale:"s"}))}};return e.__decorate([i.property()],p.prototype,"autoRefreshAssociations",null),e.__decorate([i.property()],p.prototype,"connectivityAssociationsLineSymbol",null),e.__decorate([i.property()],p.prototype,"icon",null),e.__decorate([i.property()],p.prototype,"includeConnectivityAssociations",null),e.__decorate([i.property()],p.prototype,"includeStructuralAttachmentAssociations",null),e.__decorate([i.property()],p.prototype,"label",null),e.__decorate([i.property()],p.prototype,"maxAllowableAssociations",null),e.__decorate([i.property()],p.prototype,"maxAllowableAssociationsSliderMax",null),e.__decorate([i.property()],p.prototype,"maxAllowableAssociationsSliderMin",null),e.__decorate([i.property()],p.prototype,"maxAllowableAssociationsSliderStep",null),e.__decorate([i.property(),h.messageBundle("esri/widgets/UtilityNetworkAssociations/t9n/UtilityNetworkAssociations")],p.prototype,"messages",void 0),e.__decorate([i.property(),h.messageBundle("esri/t9n/common")],p.prototype,"messagesCommon",void 0),e.__decorate([i.property()],p.prototype,"showArrowsConnectivity",null),e.__decorate([i.property()],p.prototype,"showArrowsStructuralAttachment",null),e.__decorate([i.property()],p.prototype,"showAssociationsEnabled",null),e.__decorate([i.property()],p.prototype,"structuralAttachmentAssociationsLineSymbol",null),e.__decorate([i.property()],p.prototype,"utilityNetwork",null),e.__decorate([i.property()],p.prototype,"view",null),e.__decorate([i.property({type:w})],p.prototype,"viewModel",void 0),e.__decorate([i.property({type:m,nonNullable:!0})],p.prototype,"visibleElements",void 0),p=e.__decorate([l.subclass("esri.widgets.UtilityNetworkAssociations")],p),p});