// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/tslib.es6","../../core/Collection","../../core/Evented","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../LayerList/ListItem","../LayerList/support/layerListUtils"],function(e,t,s,a,i,o,r,l,d,c,n,h){"use strict";const y="layer-list-mode",p=s.ofType(n);return e.default=class extends a.EventedAccessor{constructor(e){super(e),this.catalogItems=new p,this.checkPublishStatusEnabled=!1,this.catalogLayer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.view=null}initialize(){this.addHandles([i.watch(()=>[this.catalogLayer?.loaded,this.view?.ready],()=>this._compileList(),i.initial),i.on(()=>this.catalogLayer?.dynamicGroupLayer.layers,"change",()=>this._compileList()),i.watch(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList())])}destroy(){this.view=null,this._removeAllItems()}get state(){const{view:e,catalogLayer:t}=this;return e?.ready&&t?.loaded?"ready":e&&t?"loading":"disabled"}get totalItems(){return this.catalogItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}_createListItem(e){const{view:t,listItemCreatedFunction:s,checkPublishStatusEnabled:a,listModeDisabled:i}=this;return new n({checkPublishStatusEnabled:a,listModeDisabled:i,layer:e,listItemCreatedFunction:s,view:t})}_removeAllItems(){this.catalogItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(e=>"hide"!==h.findLayerListMode(e)):void 0}_watchLayersListMode(e){this.removeHandles(y),e&&!this.listModeDisabled&&this.addHandles(i.watch(()=>e.filter(e=>"listMode"in e).map(e=>e.listMode).toArray(),()=>this._compileList()),y)}_compileList(){const{catalogLayer:e}=this;if(!e?.loaded)return;const t=e?.dynamicGroupLayer.layers;this._watchLayersListMode(t);const s=this._getViewableLayers(t);s?.length?(this._createNewItems(s),this._removeItems(s),this._sortItems(s)):this._removeAllItems()}_createNewItems(e){const{catalogItems:t}=this;e.forEach(e=>{t.some(t=>t.layer===e)||t.add(this._createListItem(e))})}_removeItems(e){const{catalogItems:t}=this,s=[];t.forEach(t=>{t&&e?.includes(t.layer)||s.push(t)}),t.destroyMany(s)}_sortItems(e){const{catalogItems:t}=this;t.sort((t,s)=>{const a=e.indexOf(t.layer),i=e.indexOf(s.layer);return a>i?-1:a<i?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}},t.__decorate([o.property({type:p})],e.default.prototype,"catalogItems",void 0),t.__decorate([o.property()],e.default.prototype,"checkPublishStatusEnabled",void 0),t.__decorate([o.property()],e.default.prototype,"catalogLayer",void 0),t.__decorate([o.property()],e.default.prototype,"listItemCreatedFunction",void 0),t.__decorate([o.property({nonNullable:!0})],e.default.prototype,"listModeDisabled",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"state",null),t.__decorate([o.property()],e.default.prototype,"totalItems",null),t.__decorate([o.property()],e.default.prototype,"view",void 0),e.default=t.__decorate([c.subclass("esri.widgets.CatalogLayerList.CatalogLayerListViewModel")],e.default),e.default});