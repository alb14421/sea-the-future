// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/tslib.es6","../../core/Collection","../../core/Evented","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../LayerList/support/layerListUtils","./ListItem"],function(e,t,s,l,i,a,o,r,d,c,n,h){"use strict";const p="layer-list-mode",m=s.ofType(h);return e.default=class extends l.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.tableItems=new m,this.map=null}initialize(){this.addHandles([i.watch(()=>[this.tables,this.map?.allTables.toArray()],()=>this._compileList(),i.initial),i.watch(()=>[this.map?.loaded,this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList())],"map")}destroy(){this._removeAllItems(),this.map=null,this.tables=null}get tables(){return this.map?.allTables}set tables(e){this._overrideIfSome("tables",e)}get state(){const{map:e,tables:t}=this;if(!e)return t?"ready":"disabled";const s=e?.loadStatus;return"string"==typeof s?"loaded"===s?"ready":"loading"===s?"loading":"disabled":"ready"}get totalItems(){return this.tableItems.length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}_removeAllItems(){this.tableItems.destroyAll()}_getViewableTables(e){return e?this.listModeDisabled?e:e.filter(e=>"hide"!==n.findLayerListMode(e)):void 0}_watchTablesListMode(e){this.removeHandles(p),e&&!this.listModeDisabled&&this.addHandles(i.watch(()=>e.filter(e=>"listMode"in e).map(e=>e.listMode).toArray(),()=>this._compileList()),p)}_compileList(){const{tables:e}=this;this._watchTablesListMode(e);const t=this._getViewableTables(e);t?.length?(this._createNewItems(t),this._removeItems(t),this._sortItems(t)):this._removeAllItems()}_createNewItems(e){const{tableItems:t,listItemCreatedFunction:s,checkPublishStatusEnabled:l}=this;e.forEach(e=>{t.some(t=>t.layer===e)||t.add(new h({checkPublishStatusEnabled:l,layer:e,listItemCreatedFunction:s}))})}_removeItems(e){const{tableItems:t}=this;t.forEach(s=>{if(!s)return;const l=e?.find(e=>s.layer===e);l||(t.remove(s),s.destroy())})}_sortItems(e){const{tableItems:t}=this;t.sort((t,s)=>{const l=e.indexOf(t.layer),i=e.indexOf(s.layer);return l>i?-1:l<i?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}},t.__decorate([a.property()],e.default.prototype,"checkPublishStatusEnabled",void 0),t.__decorate([a.property()],e.default.prototype,"listItemCreatedFunction",void 0),t.__decorate([a.property({nonNullable:!0})],e.default.prototype,"listModeDisabled",void 0),t.__decorate([a.property({type:m,readOnly:!0})],e.default.prototype,"tableItems",void 0),t.__decorate([a.property()],e.default.prototype,"tables",null),t.__decorate([a.property()],e.default.prototype,"map",void 0),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"state",null),t.__decorate([a.property()],e.default.prototype,"totalItems",null),e.default=t.__decorate([c.subclass("esri.widgets.TableList.TableListViewModel")],e.default),e.default});