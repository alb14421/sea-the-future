// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../chunks/tslib.es6","../core/deprecate","../core/Logger","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Widget","./Compass/utils","./DirectionalPad/constants","./DirectionalPad/css","./DirectionalPad/DirectionalPadViewModel","./DirectionalPad/utils","./DirectionalPad/VisibleElements","../chunks/componentsUtils","./support/globalCss","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],function(e,t,i,o,s,n,r,a,l,d,c,u,h,p,_,v,b,g,m,w,y){"use strict";let C=class extends d{constructor(e,t){super(e,t),this._buttonsContainer=null,this._buttons={},this.messages=null,this.visibleElements=new v,this.viewModel=new p,this.visualScale="s",this._rotateIcon=e=>({"--rotation":`rotate(${e}deg)`}),this._afterButtonContainerCreate=e=>{this._buttonsContainer=e,this._buttonsContainer.addEventListener("contextmenu",this._onContextMenu,{capture:!0})},this._afterButtonContainerRemoved=()=>{this._buttonsContainer?.removeEventListener("contextmenu",this._onContextMenu,{capture:!0}),this._buttonsContainer=null},this._afterButtonCreate=(e,t)=>{this._buttons[e]=t},this._afterButtonRemoved=e=>{this._buttons[e]=void 0},this._onContextMenu=e=>e.preventDefault(),this._onButtonPointerDown=e=>{if(null===this._buttonsContainer)return;const t=e.target,i=t?.shadowRoot?.querySelector("button");i?.hasPointerCapture(e.pointerId)&&i.releasePointerCapture(e.pointerId);const o=_.findElementCenter(this._buttonsContainer);this.viewModel.beginFollowingPointer(e,o)},this._onKeyDown=(e,{key:t})=>{m.isActivationKey(t)&&this.viewModel.moveOnce(e)},this._onSliderInput=({currentTarget:e})=>{"number"==typeof e.value&&(this.viewModel.rotation=e.value)},this._onRotationReset=()=>{this.viewModel.rotation=0},i.deprecateWidget(o.getLogger(this),"Directional Pad","arcgis-directional-pad",{version:"4.32"})}loadDependencies(){return b.loadCalciteComponents({action:()=>new Promise((t,i)=>e(["../chunks/index12"],t,i)),"action-group":()=>new Promise((t,i)=>e(["../chunks/index18"],t,i)).then(e=>e.index),"action-bar":()=>new Promise((t,i)=>e(["../chunks/index46"],t,i)),icon:()=>new Promise((t,i)=>e(["../chunks/index7"],t,i)),slider:()=>new Promise((t,i)=>e(["../chunks/index47"],t,i))})}initialize(){this.addHandles(s.watch(()=>this.viewModel.angle,()=>{const e=this._buttonsContainer?.contains(document.activeElement);e&&(null==this.viewModel.angle?this.container?.focus():m.setFocus(this._buttons[this.viewModel.angle]))}))}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get icon(){return"move"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get speed(){return this.viewModel.speed}set speed(e){this.viewModel.speed=e}get _rotationEnabled(){return!this.view?.ready||this.view.constraints.rotationEnabled}render(){const{label:e,disabled:t,viewModel:i}=this,o=this.classes(h.css.base,g.globalCss.widget,t?g.globalCss.disabled:null);return y.tsx("div",{"aria-label":e,class:o,tabIndex:-1},i.supported?this._renderContent():this._renderUnsupportedMessage())}_renderUnsupportedMessage(){return y.tsx("section",{class:h.css.error,key:"unsupported"},y.tsx("p",null,this.messages.unsupported))}_renderContent(){return[this.visibleElements.directionalButtons?this._renderDirectionalButtons():void 0,this.visibleElements.rotationSlider?this._renderRotation():void 0]}_renderDirectionalButtons(){return y.tsx("calcite-action-bar",{expandDisabled:!0,floating:!0,key:"directional-buttons-container",layout:"grid",overflowActionsDisabled:!0},y.tsx("calcite-action-group",{afterCreate:this._afterButtonContainerCreate,afterRemoved:this._afterButtonContainerRemoved,class:h.css.buttonsContainer,dir:"ltr"},u.directionalPadAngles.slice(0,4).map(e=>this._renderButton(e)),this._renderCompass(),u.directionalPadAngles.slice(4).map(e=>this._renderButton(e))))}_renderButton(e){const{label:t,iconName:i}=u.directionalPadArrows[e],o=this.messages[t];return y.tsx("calcite-action",{active:this.viewModel.angle===e,afterCreate:t=>this._afterButtonCreate(e,t),afterRemoved:()=>this._afterButtonRemoved(e),alignment:"center",class:h.css.button,"data-angle":e.toString(),disabled:this.disabled,key:e,onkeydown:this._onKeyDown.bind(void 0,e),onpointerdown:this._onButtonPointerDown,scale:this.visualScale,text:o,title:o},y.tsx("calcite-icon",{icon:i,scale:this.visualScale}))}_renderCompass(){const e=this.disabled||c.canShowNorth(this.view)?"compass-needle":"arrow-up",t=0===this.viewModel.rotation,i=this.messages.resetHeading;return y.tsx("calcite-action",{alignment:"center",class:h.css.compassButton,disabled:this.disabled||!this._rotationEnabled||t,key:"compass",onclick:this._onRotationReset,scale:this.visualScale,styles:this._rotateIcon(this.viewModel.rotation),text:i,title:i},!t&&y.tsx("calcite-icon",{icon:e,scale:this.visualScale}))}_renderRotation(){return y.tsx("calcite-action-bar",{expandDisabled:!0,floating:!0,key:"slider-container",layout:"horizontal"},y.tsx("calcite-action-group",{class:h.css.rotationContainer},this.visibleElements.rotationResetButton?this._renderRotationResetButton():null,this._renderRotationSlider()))}_renderRotationResetButton(){const e=this.messages.resetHeading;return y.tsx("calcite-action",{alignment:"center",class:h.css.rotationReset,disabled:this.disabled||!this._rotationEnabled,onclick:this._onRotationReset,scale:this.visualScale,text:e,title:e},y.tsx("calcite-icon",{flipRtl:!0,icon:"rotate",scale:this.visualScale}))}_renderRotationSlider(){return y.tsx("div",{class:h.css.rotationSliderContainer},y.tsx("calcite-slider",{"aria-label":this.messages.heading,disabled:this.disabled||!this._rotationEnabled,labelHandles:!0,max:360,min:0,required:!0,scale:this.visualScale,value:Math.round(this.viewModel.rotation),onCalciteSliderInput:this._onSliderInput}))}};return t.__decorate([n.property()],C.prototype,"_buttonsContainer",void 0),t.__decorate([n.property()],C.prototype,"_buttons",void 0),t.__decorate([n.property()],C.prototype,"disabled",null),t.__decorate([n.property()],C.prototype,"icon",null),t.__decorate([n.property()],C.prototype,"label",null),t.__decorate([n.property(),w.messageBundle("esri/widgets/DirectionalPad/t9n/DirectionalPad")],C.prototype,"messages",void 0),t.__decorate([n.property({type:v,nonNullable:!0})],C.prototype,"visibleElements",void 0),t.__decorate([n.property()],C.prototype,"view",null),t.__decorate([n.property({type:p})],C.prototype,"viewModel",void 0),t.__decorate([n.property()],C.prototype,"visualScale",void 0),t.__decorate([n.property()],C.prototype,"speed",null),t.__decorate([n.property({readOnly:!0})],C.prototype,"_rotationEnabled",null),C=t.__decorate([l.subclass("esri.widgets.DirectionalPad")],C),C});