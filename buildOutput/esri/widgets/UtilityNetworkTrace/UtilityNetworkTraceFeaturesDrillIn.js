// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../../chunks/tslib.es6","../../intl","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../intl/messages","../Widget","../Features/css","../Popup/actions","../../chunks/componentsUtils","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory","../../intl/substitute"],function(e,t,i,s,o,a,n,r,c,l,d,u,p,h,m,g,w){"use strict";const y=u.zoomToFeature.clone();let x=class extends l{constructor(e,t){super(e,t),this._utilityNetworkTraceMessages=null,this.closed=!1,this.closable=!0,this.messages=null,this.messagesCommon=null,this._handleAddNonspatialTraceLocation=e=>{this.emit("add-nso-trace-location",{featureWidget:e})},this._handleOpenFeature=e=>{this.emit("open-feature",{feature:e})},this._handleZoomToFeature=e=>{this.emit("zoom-to-feature",{featureWidget:e})}}initialize(){(async()=>{this._utilityNetworkTraceMessages=await c.fetchMessageBundle("esri/widgets/UtilityNetworkTrace/t9n/UtilityNetworkTrace")})()}loadDependencies(){return p.loadCalciteComponents({action:()=>new Promise((t,i)=>e(["../../chunks/index12"],t,i)),"action-bar":()=>new Promise((t,i)=>e(["../../chunks/index46"],t,i)),"action-group":()=>new Promise((t,i)=>e(["../../chunks/index18"],t,i)).then(e=>e.index),"flow-item":()=>new Promise((t,i)=>e(["../../chunks/index15"],t,i))})}get mode(){return this._get("mode")||"show-feature-info"}set mode(e){this._set("mode",e)}render(){const{flowItems:e}=this,t=e?.toArray();return g.tsx(g.tsxFragment,null,t?.map((t,i)=>this._renderFlowItem(t,i===e.length-1)))}_renderAddNonspatialTraceLocationAction(e){const{_utilityNetworkTraceMessages:t}=this;return g.tsx("calcite-action",{appearance:"solid",bind:this,icon:"utility-network-trace",onclick:()=>this._handleAddNonspatialTraceLocation(e),scale:"s",text:t.inputsStrings.addNonspatialOption,textEnabled:!0,title:t.inputsStrings.addNonspatialOption})}_renderFlowItem(e,t){const{messages:i,closable:s,closed:o}=this,a="graphic"in e&&!e.isTable,n="feature-association"===e.flowType,r=this._getExitMessage(e),c=i.selectFeature,l=e,u=l?l.graphic?.sourceLayer:null,p=!(u&&u.geometryType);return g.tsx("calcite-flow-item",{bind:this,closable:s,closed:o,description:this._getDrillInFlowItemDescription(e),heading:e.title??"",key:`flow-item-${e.viewModel.uid}`,selected:t,onCalciteFlowItemBack:e=>{e.preventDefault(),this._handleDrillInBackClick()}},g.tsx("calcite-action",{appearance:"transparent",bind:this,class:d.css.actionExit,icon:"move-up",key:"exit-action",onclick:this._handleExitClick,slot:"header-actions-start",text:r,title:r}),a?g.tsx("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-feature-action",onclick:()=>this._handleOpenFeature(e),slot:"header-actions-end",text:c,title:c}):null,"show-feature-info"===this.mode?g.tsx("calcite-action",{icon:"x",onclick:()=>{this.emit("close")},slot:"header-actions-end",text:this.messagesCommon.close}):void 0,n&&"add-nso"===this.mode?p?g.tsx("calcite-action-bar",{expandDisabled:!0,expanded:!0,key:"header-action-bar",scale:"s",slot:"action-bar"},g.tsx("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},this._renderAddNonspatialTraceLocationAction(e))):g.tsx("calcite-action-bar",{expandDisabled:!0,expanded:!0,key:"header-action-bar",scale:"s",slot:"action-bar"},g.tsx("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},this._renderZoomToFeatureAction(e))):null,g.tsx("div",{class:this.classes(d.css.container,"esri-utility-network-trace__feature-content")},e.render()))}_renderZoomToFeatureAction(e){const t=this._getActionTitle(y);return g.tsx("calcite-action",{active:y.active,appearance:"solid",bind:this,"data-action-uid":y.uid,disabled:y.disabled,icon:y.icon??"question",indicator:y.indicator,key:`action-${y.uid}`,loading:y.active,onclick:()=>this._handleZoomToFeature(e),scale:"s",text:t,textEnabled:!0,title:t})}_getActionTitle(e){const{messages:t}=this,{id:i}=e,s=e.title??"";return"zoom-to-feature"===i?w.substitute(s,{messages:t}):s}_getDrillInFlowItemDescription(e){switch(e.flowType){case"feature":case"feature-association":case"feature-utility-network-associations":return e.viewModel.description??"";case"feature-relationship":return e.allItemsDescription;case"feature-utility-network-association-type":return e.description??""}}_getExitMessage(e){switch(e.flowType){case"feature":case"feature-association":return"";case"feature-relationship":return this.messages.exitRelatedRecords;case"feature-utility-network-associations":case"feature-utility-network-association-type":return this.messages.exitAssociations}}_handleDrillInBackClick(){const e=this.flowItems?.pop();e&&("showAllEnabled"in e.viewModel&&(e.viewModel.showAllEnabled=!1),e&&(e.viewModel=null,e.destroy()))}_handleExitClick(){this.emit("exit")}};return t.__decorate([s.property()],x.prototype,"closed",void 0),t.__decorate([s.property()],x.prototype,"closable",void 0),t.__decorate([s.property()],x.prototype,"flowItems",void 0),t.__decorate([s.property(),m.messageBundle("esri/widgets/Features/t9n/Features")],x.prototype,"messages",void 0),t.__decorate([s.property(),m.messageBundle("esri/t9n/common")],x.prototype,"messagesCommon",void 0),t.__decorate([s.property()],x.prototype,"mode",null),x=t.__decorate([r.subclass("esri.widgets.UtilityNetworkTrace.UtilityNetworkTraceFeaturesDrillIn")],x),x});