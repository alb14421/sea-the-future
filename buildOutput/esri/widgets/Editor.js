// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/interactive/sketch/SketchValueOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./Units"],function(e,t,r,i,o,n,s,a,l){"use strict";return e.default=class extends r{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?"relative-bilateral":"relative";case"absolute":return"absolute"}}get displayUnits(){return this._get("displayUnits")??new l}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new l}set inputUnits(e){this._set("inputUnits",e)}},t.__decorate([i.property({type:String,nonNullable:!0})],e.default.prototype,"directionMode",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"relativeDirectionIsBilateral",void 0),t.__decorate([i.property()],e.default.prototype,"effectiveDirectionMode",null),t.__decorate([i.property({type:l,nonNullable:!0})],e.default.prototype,"displayUnits",null),t.__decorate([i.property({type:l,nonNullable:!0})],e.default.prototype,"inputUnits",null),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchValueOptions")],e.default),e.default})},"esri/views/interactive/sketch/Units":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a){"use strict";return e.default=class extends r{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}},t.__decorate([i.property()],e.default.prototype,"length",void 0),t.__decorate([i.property()],e.default.prototype,"verticalLength",void 0),t.__decorate([i.property()],e.default.prototype,"area",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.Units")],e.default),e.default})},"esri/widgets/Attachments":function(){define(["require","exports","../chunks/tslib.es6","../core/Error","../core/reactiveUtils","../core/unitFormatUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Widget","./Attachments/AttachmentsViewModel","./Attachments/support/attachmentUtils","../chunks/componentsUtils","./support/globalCss","./support/legacyIcon","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v){"use strict";const _={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},w="esri-attachments",S={base:w,loaderContainer:`${w}__loader-container`,loader:`${w}__loader`,container:`${w}__container`,containerList:`${w}__container--list`,containerPreview:`${w}__container--preview`,actions:`${w}__actions`,deleteButton:`${w}__delete-button`,addAttachmentButton:`${w}__add-attachment-button`,errorMessage:`${w}__error-message`,items:`${w}__items`,item:`${w}__item`,itemButton:`${w}__item-button`,itemMask:`${w}__item-mask`,itemMaskIcon:`${w}__item-mask--icon`,itemImage:`${w}__image`,itemImageResizable:`${w}__image--resizable`,itemLabel:`${w}__label`,itemFilename:`${w}__filename`,itemChevronIcon:`${w}__item-chevron-icon`,itemLink:`${w}__item-link`,itemLinkOverlay:`${w}__item-link-overlay`,itemLinkOverlayIcon:`${w}__item-link-overlay-icon`,itemAddIcon:`${w}__item-add-icon`,formNode:`${w}__form-node`,fileFieldset:`${w}__file-fieldset`,fileLabel:`${w}__file-label`,fileName:`${w}__file-name`,fileInput:`${w}__file-input`,metadata:`${w}__metadata`,metadataFieldset:`${w}__metadata-fieldset`,progressBar:`${w}__progress-bar`},x=window.CSS;return t.default=class extends d{constructor(e,t){super(e,t),this.displayType="auto",this.messages=null,this.messagesUnits=null,this.selectedFile=null,this.submitting=!1,this.viewModel=null,this.visibleElements={..._},this._supportsImageOrientation=x&&x.supports&&x.supports("image-orientation","from-image"),this._addAttachmentForm=null,this._updateAttachmentForm=null}normalizeCtorArgs(e){return e?.viewModel||(e={viewModel:new u,...e}),e}initialize(){this.addHandles([o.on(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),o.on(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),o.watch(()=>this.viewModel?.mode,()=>this._modeChanged(),o.initial)])}loadDependencies(){return y.loadCalciteComponents({icon:()=>new Promise((t,r)=>e(["../chunks/index7"],t,r))})}get capabilities(){return this.viewModel.capabilities}set capabilities(e){this.viewModel.capabilities=e}get effectiveDisplayType(){const{displayType:e}=this;return e&&"auto"!==e?e:this.viewModel.supportsResizeAttachments?"preview":"list"}get graphic(){return this.viewModel.graphic}set graphic(e){this.viewModel.graphic=e}get icon(){return"attachment"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}castVisibleElements(e){return{..._,...e}}addAttachment(){const{_addAttachmentForm:e,viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.addAttachment(e).then(e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e)).catch(e=>{throw this._set("submitting",!1),this._set("error",new i("attachments:add-attachment",this.messages.addErrorMessage,e)),e})}deleteAttachment(e){const{viewModel:t}=this;return this._set("submitting",!0),this._set("error",null),t.deleteAttachment(e).then(e=>(this._set("submitting",!1),this._set("error",null),t.mode="view",e)).catch(e=>{throw this._set("submitting",!1),this._set("error",new i("attachments:delete-attachment",this.messages.deleteErrorMessage,e)),e})}updateAttachment(){const{viewModel:e}=this,{_updateAttachmentForm:t}=this;return this._set("submitting",!0),this._set("error",null),e.updateAttachment(t).then(t=>(this._set("submitting",!1),this._set("error",null),e.mode="view",t)).catch(e=>{throw this._set("submitting",!1),this._set("error",new i("attachments:update-attachment",this.messages.updateErrorMessage,e)),e})}addFile(){const e=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);return this.viewModel.mode="view",e}updateFile(){const{viewModel:e}=this,t=e.updateFile(this.selectedFile,this._updateAttachmentForm,e.activeFileInfo);return e.mode="view",t}deleteFile(e){const t=this.viewModel.deleteFile(e||this.viewModel.activeFileInfo?.file);return this.viewModel.mode="view",t}render(){const{submitting:e,viewModel:t}=this,{state:r}=t;return v.tsx("div",{class:this.classes(S.base,m.globalCss.widget)},e?this._renderProgressBar():null,"loading"===r?this._renderLoading():this._renderAttachments(),this._renderErrorMessage())}_renderErrorMessage(){const{error:e,visibleElements:t}=this;return e&&t.errorMessage?v.tsx("div",{class:S.errorMessage,key:"error-message"},e.message):null}_renderAttachments(){const{activeFileInfo:e,mode:t,activeAttachmentInfo:r}=this.viewModel;return"add"===t?this._renderAddForm():"edit"===t?this._renderDetailsForm(r||e):this._renderAttachmentContainer()}_renderLoading(){return v.tsx("div",{class:S.loaderContainer,key:"loader"},v.tsx("div",{class:S.loader}))}_renderProgressBar(){return this.visibleElements.progressBar?v.tsx("div",{class:S.progressBar,key:"progress-bar"}):null}_renderAddForm(){const{submitting:e,selectedFile:t}=this,r=e||!t,i=this.visibleElements.cancelAddButton?v.tsx("button",{bind:this,class:this.classes(m.globalCss.button,m.globalCss.buttonTertiary,m.globalCss.buttonSmall,m.globalCss.buttonHalf,e&&m.globalCss.buttonDisabled),disabled:e,onclick:this._cancelForm,type:"button"},this.messages.cancel):null,o=this.visibleElements.addSubmitButton?v.tsx("button",{class:this.classes(m.globalCss.button,m.globalCss.buttonSecondary,m.globalCss.buttonSmall,m.globalCss.buttonHalf,{[m.globalCss.buttonDisabled]:r}),disabled:r,type:"submit"},this.messages.add):null,n=t?v.tsx("span",{class:S.fileName,key:"file-name"},t.name):null,s=v.tsx("form",{afterCreate:g.storeNode,afterRemoved:g.discardNode,bind:this,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},v.tsx("fieldset",{class:S.fileFieldset},n,v.tsx("label",{class:this.classes(S.fileLabel,m.globalCss.button,m.globalCss.buttonSecondary)},t?this.messages.changeFile:this.messages.selectFile,v.tsx("input",{bind:this,class:S.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))),o,i);return v.tsx("div",{class:S.formNode,key:"add-form-container"},s)}_renderDetailsForm(e){const{visibleElements:t,viewModel:r,selectedFile:i,submitting:o}=this,{capabilities:s}=r,a=o||!i;let l,c,p,d;i?(l=i.type,c=i.name,p=i.size):e&&"file"in e?(l=e.file.type,c=e.file.name,p=e.file.size):e&&"contentType"in e&&(l=e.contentType,c=e.name,p=e.size,d=e.url);const u=s.editing&&s.operations?.delete&&t.deleteButton?v.tsx("button",{bind:this,class:this.classes(m.globalCss.button,m.globalCss.buttonSmall,m.globalCss.buttonTertiary,S.deleteButton,{[m.globalCss.buttonDisabled]:o}),disabled:o,key:"delete-button",onclick:t=>this._submitDeleteAttachment(t,e),type:"button"},this.messages.delete):void 0,h=s.editing&&s.operations?.update&&t.updateButton?v.tsx("button",{class:this.classes(m.globalCss.button,m.globalCss.buttonSmall,m.globalCss.buttonThird,{[m.globalCss.buttonDisabled]:a}),disabled:a,key:"update-button",type:"submit"},this.messages.update):void 0,y=this.visibleElements.cancelUpdateButton?v.tsx("button",{bind:this,class:this.classes(m.globalCss.button,m.globalCss.buttonSmall,m.globalCss.buttonTertiary,m.globalCss.buttonThird,{[m.globalCss.buttonDisabled]:o}),disabled:o,key:"cancel-button",onclick:this._cancelForm,type:"button"},this.messages.cancel):void 0,f=s.editing&&s.operations?.update?v.tsx("fieldset",{class:S.fileFieldset,key:"file"},v.tsx("span",{class:S.fileName,key:"file-name"},c),v.tsx("label",{class:this.classes(S.fileLabel,m.globalCss.button,m.globalCss.buttonSecondary)},this.messages.changeFile,v.tsx("input",{bind:this,class:S.fileInput,name:"attachment",onchange:this._handleFileInputChange,type:"file"}))):void 0,b=v.tsx("fieldset",{class:S.metadataFieldset,key:"size"},v.tsx("label",null,n.formatFileSize(this.messagesUnits,p??0))),_=v.tsx("fieldset",{class:S.metadataFieldset,key:"content-type"},v.tsx("label",null,l)),w=null!=d?v.tsx("a",{class:S.itemLink,href:d,rel:"noreferrer",target:"_blank"},this._renderImageMask(e,400),v.tsx("div",{class:S.itemLinkOverlay},v.tsx("span",{class:S.itemLinkOverlayIcon},v.tsx("calcite-icon",{icon:"launch"})))):this._renderImageMask(e,400),x=v.tsx("form",{afterCreate:g.storeNode,afterRemoved:g.discardNode,bind:this,"data-node-ref":"_updateAttachmentForm",onsubmit:t=>this._submitUpdateAttachment(t,e)},v.tsx("div",{class:S.metadata},b,_),f,v.tsx("div",{class:S.actions},u,y,h));return v.tsx("div",{class:S.formNode,key:"edit-form-container"},w,x)}_renderImageMask(e,t){return e?"file"in e?this._renderGenericImageMask(e.file.name,e.file.type):this._renderImageMaskForAttachment(e,t):null}_renderGenericImageMask(e,t){const{supportsResizeAttachments:r}=this.viewModel,i=h.getIconPath(t),o={[S.itemImageResizable]:r};return v.tsx("div",{class:this.classes(S.itemMaskIcon,S.itemMask),key:i},v.tsx("img",{alt:e,class:this.classes(o,S.itemImage),src:i,title:e}))}_renderImageMaskForAttachment(e,t){const{supportsResizeAttachments:r}=this.viewModel;if(!e)return null;const{contentType:i,name:o,size:n,url:s}=e;if(!r||!h.isSupportedImage(i))return this._renderGenericImageMask(o,i);const a=this._getCSSTransform(e),l=a?{transform:a,"image-orientation":"none"}:{},c=`${s}${s?.includes("?")?"&":"?"}w=${t}&s=${n}`,p={[S.itemImageResizable]:r};return v.tsx("div",{class:this.classes(S.itemMask),key:c},v.tsx("img",{alt:o,class:this.classes(p,S.itemImage),src:c,styles:l,title:o}))}_renderFile(e){const{file:t}=e;return v.tsx("li",{class:S.item,key:t},v.tsx("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:S.itemButton,key:"details-button",onclick:()=>this._startEditFile(e),title:this.messages.attachmentDetails,type:"button"},this._renderImageMask(e),v.tsx("label",{class:S.itemLabel},v.tsx("span",{class:S.itemFilename},t.name||this.messages.noTitle),v.tsx("span",{"aria-hidden":"true",class:this.classes(S.itemChevronIcon,g.isRTL(this.container)?f.legacyIcon.left:f.legacyIcon.right)}))))}_renderAttachmentInfo({attachmentInfo:e,displayType:t}){const{viewModel:r,effectiveDisplayType:i}=this,{capabilities:o,supportsResizeAttachments:n}=r,{contentType:s,name:a,url:l}=e,c=this._renderImageMask(e,"list"===t?48:400),p=o.editing?v.tsx("span",{"aria-hidden":"true",class:this.classes(S.itemChevronIcon,g.isRTL(this.container)?f.legacyIcon.left:f.legacyIcon.right)}):null,d=[c,"preview"===i&&n&&h.isSupportedImage(s)?null:v.tsx("label",{class:S.itemLabel},v.tsx("span",{class:S.itemFilename},a||this.messages.noTitle),p)],u=o.editing?v.tsx("button",{"aria-label":this.messages.attachmentDetails,bind:this,class:S.itemButton,"data-attachment-info-id":e.id,key:"details-button",onclick:()=>this._startEditAttachment(e),title:this.messages.attachmentDetails,type:"button"},d):v.tsx("a",{class:S.itemButton,href:l??void 0,key:"details-link",rel:"noreferrer",target:"_blank"},d);return v.tsx("li",{class:S.item,key:e},u)}_renderAttachmentContainer(){const{effectiveDisplayType:e,viewModel:t,visibleElements:r}=this,{attachmentInfos:i,capabilities:o,fileInfos:n}=t,s=!!i?.length,a=!!n?.length,l={[S.containerList]:"preview"!==e,[S.containerPreview]:"preview"===e},c=o.editing&&o.operations?.add&&r.addButton?v.tsx("button",{bind:this,class:this.classes(m.globalCss.button,m.globalCss.buttonTertiary,S.addAttachmentButton),onclick:()=>this._startAddAttachment(),type:"button"},v.tsx("span",{"aria-hidden":"true",class:this.classes(S.itemAddIcon,f.legacyIcon.plus)}),this.messages.add):void 0,p=s?v.tsx("ul",{class:S.items,key:"attachments-list"},i.toArray().map(t=>this._renderAttachmentInfo({attachmentInfo:t,displayType:e}))):void 0,d=a?v.tsx("ul",{class:S.items,key:"file-list"},n.toArray().map(e=>this._renderFile(e))):void 0,u=a||s?void 0:v.tsx("div",{class:m.globalCss.empty},this.messages.noAttachments);return v.tsx("div",{class:this.classes(S.container,l),key:"attachments-container"},p,d,u,c)}_modeChanged(){this._set("error",null),this._set("selectedFile",null)}_handleFileInputChange(e){const t=e.target,r=t.files?.item(0);this._set("selectedFile",r)}_submitDeleteAttachment(e,t){e.preventDefault(),t&&("file"in t?this.deleteFile(t.file):t&&this.deleteAttachment(t))}_submitAddAttachment(e){e.preventDefault(),this.viewModel.filesEnabled?this.addFile():this.addAttachment()}_submitUpdateAttachment(e,t){e.preventDefault(),t&&"file"in t?this.updateFile():this.updateAttachment()}_startEditAttachment(e){const{viewModel:t}=this;t.activeFileInfo=null,t.activeAttachmentInfo=e,t.mode="edit"}_startEditFile(e){const{viewModel:t}=this;t.activeAttachmentInfo=null,t.activeFileInfo=e,t.mode="edit"}_startAddAttachment(){this.viewModel.mode="add"}_cancelForm(e){e.preventDefault(),this.viewModel.mode="view"}_getCSSTransform(e){const{orientationInfo:t}=e;return!this._supportsImageOrientation&&t?[t.rotation?`rotate(${t.rotation}deg)`:"",t.mirrored?"scaleX(-1)":""].join(" "):""}},r.__decorate([s.property()],t.default.prototype,"capabilities",null),r.__decorate([s.property()],t.default.prototype,"displayType",void 0),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"effectiveDisplayType",null),r.__decorate([s.property()],t.default.prototype,"graphic",null),r.__decorate([s.property()],t.default.prototype,"icon",null),r.__decorate([s.property()],t.default.prototype,"label",null),r.__decorate([s.property(),b.messageBundle("esri/widgets/Attachments/t9n/Attachments")],t.default.prototype,"messages",void 0),r.__decorate([s.property(),b.messageBundle("esri/core/t9n/Units")],t.default.prototype,"messagesUnits",void 0),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"selectedFile",void 0),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"submitting",void 0),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"error",void 0),r.__decorate([s.property({type:u})],t.default.prototype,"viewModel",void 0),r.__decorate([s.property()],t.default.prototype,"visibleElements",void 0),r.__decorate([a.cast("visibleElements")],t.default.prototype,"castVisibleElements",null),t.default=r.__decorate([p.subclass("esri.widgets.Attachments")],t.default),t.default})},"esri/core/unitFormatUtils":function(){define(["exports","./Cyclical","./mathUtils","./quantityUtils","./string","./unitUtils","../intl/number"],function(e,t,r,i,o,n,s){"use strict";function a(e,t,r){return e.units[t][r]}function l(e,t,r,i=2,o="abbr"){return`${s.formatNumber(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:t>0?"never":"exceptZero"})} ${a(e,r,o)}`}function c(e,t,r,i=2,o="abbr"){return`${s.formatNumber(t,{minimumFractionDigits:i,maximumFractionDigits:i,signDisplay:"exceptZero"})} ${a(e,r,o)}`}const p=new Map;function d(e,t){const r=JSON.stringify(t);let i=p.get(r);return i||(i=new Intl.NumberFormat("en-US",t),p.set(r,i)),/^[-+]?360\.?0*°?$/.test(i.format(e))?0:e}const u=["B","kB","MB","GB","TB"];e.formatAngleDegrees=function(e,r,o,a,l,c=t.cyclicalDegrees,p=!0){let u=c.normalize(i.convertRotationType(n.convertUnit(e,r,"degrees"),o,a),0,p);const h=((e,t)=>({style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:t,minimumFractionDigits:t,signDisplay:e>0?"never":"exceptZero"}))(u,l??2);return u=d(u,h),s.formatNumber(u,h)},e.formatDMS=function(e,t,r=2){let i=n.convertUnit(e,t,"degrees"),o=i-Math.floor(i);i-=o,o*=60;let s=o-Math.floor(o);return o-=s,s*=60,`${i.toFixed()}° ${o.toFixed()}' ${s.toFixed(r)}"`},e.formatDecimal=l,e.formatFileSize=function(e,t){let i=0===(t=Math.round(t))?0:Math.floor(Math.log(t)/Math.log(1024));i=r.clamp(i,0,u.length-1);const n=s.formatNumber(t/1024**i,{maximumFractionDigits:2});return o.replace(e.units.bytes[u[i]],{fileSize:n})},e.formatImperialArea=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveImperialAreaUnit(t,r);return l(e,n.convertUnit(t,r,s),s,i,o)},e.formatImperialLength=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveImperialLengthUnit(t,r);return l(e,n.convertUnit(t,r,s),s,i,o)},e.formatImperialRelativeLength=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveImperialLengthUnit(t,r);return c(e,n.convertUnit(t,r,s),s,i,o)},e.formatImperialRelativeVerticalLength=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveImperialVerticalLengthUnit(t,r);return c(e,n.convertUnit(t,r,s),s,i,o)},e.formatImperialVerticalLength=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveImperialVerticalLengthUnit(t,r);return l(e,n.convertUnit(t,r,s),s,i,o)},e.formatMetricArea=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveMetricAreaUnit(t,r);return l(e,n.convertUnit(t,r,s),s,i,o)},e.formatMetricLength=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveMetricLengthUnit(t,r);return l(e,n.convertUnit(t,r,s),s,i,o)},e.formatMetricRelativeLength=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveMetricLengthUnit(t,r);return c(e,n.convertUnit(t,r,s),s,i,o)},e.formatMetricRelativeVerticalLength=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveMetricVerticalLengthUnit(t,r);return c(e,n.convertUnit(t,r,s),s,i,o)},e.formatMetricVerticalLength=function(e,t,r,i=2,o="abbr"){const s=n.adaptiveMetricVerticalLengthUnit(t,r);return l(e,n.convertUnit(t,r,s),s,i,o)},e.formatRelativeAngleDegrees=function(e,t,r,i,o=2){r!==i&&(e=-e);const a={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:o,minimumFractionDigits:o,signDisplay:"exceptZero"};let l=n.convertUnit(e,t,"degrees")%360;return l=d(l,a),s.formatNumber(l,a)},e.formatRelativeDecimal=c,e.unitName=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/quantityUtils":function(){define(["exports","./unitUtils"],function(e,t){"use strict";function r(e,r){return{type:t.unitType(r),value:e,unit:r}}function i(e,r){return{type:t.unitType(r),value:e,unit:r}}function o(e,r){return{type:t.unitType(r),value:e,unit:r}}function n(e,r,i="arithmetic"){return{type:t.unitType(r),value:e,unit:r,rotationType:i}}function s(e,t){const i=a(e,t);return"angle"===e.type?n(i,t,e.rotationType):r(i,t)}function a(e,r){return t.convertUnit(e.value,e.unit,r)}const l=i(0,"meters"),c=o(0,"square-meters"),p=n(0,"radians"),d=n(0,"degrees"),u=n(0,"degrees","geographic");e.convertRotationType=function(e,t,r){if(t===r)return e;switch(r){case"arithmetic":case"geographic":return 90-e}},e.createAngle=n,e.createArea=o,e.createLength=i,e.createQuantity=r,e.createScalar=function(e){return{value:e}},e.isBaseUnit=function(e){return t.isBaseUnit(e.unit)},e.max=function(e,r){return null==e?r:null==r||e.value>t.convertUnit(r.value,r.unit,e.unit)?e:r},e.min=function(e,r){return null==e?r:null==r||e.value<t.convertUnit(r.value,r.unit,e.unit)?e:r},e.scale=function(e,t){return null==e?null:{...e,value:e.value*t}},e.toBaseUnit=function(e){return s(e,t.baseUnitForUnit(e.unit))},e.toUnit=s,e.valueInUnit=a,e.zeroDegrees=d,e.zeroDegreesGeographic=u,e.zeroMeters=l,e.zeroRadians=p,e.zeroSquareMeters=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define(["exports","../../chunks/tslib.es6","../../Graphic","../../core/Accessor","../../core/Collection","../../core/Error","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../popup/support/AttachmentsOrderByInfo","../../rest/query/support/AttachmentInfo","../../rest/support/AttachmentQuery","../Feature/support/featureUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m){"use strict";const f={editing:!1,operations:{add:!0,update:!0,delete:!0}},g=o.ofType(h);return e.default=class extends i{constructor(e){super(e),this._getAttachmentsPromise=null,this._attachmentLayer=null,this.capabilities={...f},this.activeAttachmentInfo=null,this.activeFileInfo=null,this.attachmentInfos=new g,this.fileInfos=new o,this.graphic=null,this.mode="view",this.orderByFields=null,this.filesEnabled=!1,this.addHandles(s.watch(()=>this.graphic,()=>this._graphicChanged(),s.initial))}destroy(){this._attachmentLayer=null,this.graphic=null}castCapabilities(e){return{...f,...e}}get state(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}get supportsResizeAttachments(){const{graphic:e}=this;if(!e)return!1;const t=e.layer||e.sourceLayer;return t?.loaded&&"capabilities"in t&&t.capabilities&&"attachment"in t.capabilities&&t.capabilities.attachment&&"supportsResize"in t.capabilities.attachment&&t.capabilities.attachment.supportsResize||!1}async getAttachments(){const{_attachmentLayer:e,attachmentInfos:t,orderByFields:r}=this;if(!e||"function"!=typeof e.queryAttachments)throw new n("invalid-layer","getAttachments(): A valid layer is required.");const i=this._getObjectId();if("number"!=typeof i)throw new n("invalid-object-id","getAttachments(): Numeric object id is required");const o=r?.map(e=>`${e.field} ${"descending"===e.order?"DESC":"ASC"}`),s=new y({objectIds:[i],returnMetadata:!0,orderByFields:o}),a=[],l=e.queryAttachments(s).then(e=>e[i]||a).catch(()=>a);this._getAttachmentsPromise=l,this.notifyChange("state");const c=await l;return t.destroyAll(),c.length&&t.addMany(c),this._getAttachmentsPromise=null,this.notifyChange("state"),c}async addAttachment(e,t=this.graphic){const{_attachmentLayer:r,attachmentInfos:i,capabilities:o}=this;if(!t)throw new n("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:t});if(!e)throw new n("invalid-attachment","addAttachment(): An attachment is required.",{attachment:e});if(!o.operations?.add)throw new n("invalid-capabilities","addAttachment(): add capabilities are required.");if(!r||"function"!=typeof r.addAttachment)throw new n("invalid-layer","addAttachment(): A valid layer is required.");const s=r.addAttachment(t,e).then(e=>this._queryAttachment(e.objectId,t)),a=await s;return i.add(a),a}async deleteAttachment(e){const{_attachmentLayer:t,attachmentInfos:r,graphic:i,capabilities:o}=this;if(!e)throw new n("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:e});if(!o.operations?.delete)throw new n("invalid-capabilities","deleteAttachment(): delete capabilities are required.");if(!t||"function"!=typeof t.deleteAttachments)throw new n("invalid-layer","deleteAttachment(): A valid layer is required.");if(!i)throw new n("invalid-graphic","deleteAttachment(): A graphic is required.");const s=t.deleteAttachments(i,[e.id]).then(()=>e),a=await s;return r.remove(a),a.destroy(),a}async updateAttachment(e,t=this.activeAttachmentInfo){const{_attachmentLayer:r,attachmentInfos:i,graphic:o,capabilities:s}=this;if(!e)throw new n("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:e});if(!t)throw new n("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:t});if(!s.operations?.update)throw new n("invalid-capabilities","updateAttachment(): Update capabilities are required.");const a=i.indexOf(t);if(!r||"function"!=typeof r.updateAttachment)throw new n("invalid-layer","updateAttachment(): A valid layer is required.");if(!o)throw new n("invalid-graphic","updateAttachment(): A graphic is required.");const l=r.updateAttachment(o,t.id,e).then(e=>this._queryAttachment(e.objectId)),c=await l;return i.splice(a,1,c),c}async commitFiles(){return await Promise.all(this.fileInfos.items.map(e=>this.addAttachment(e.form))),this.fileInfos.removeAll(),this.getAttachments()}addFile(e,t){if(!e||!t)return null;const r={file:e,form:t};return this.fileInfos.add(r),r}updateFile(e,t,r=this.activeFileInfo){if(!e||!t||!r)return null;const i=this.fileInfos.indexOf(r);return i>-1&&this.fileInfos.splice(i,1,{file:e,form:t}),this.fileInfos.items[i]}deleteFile(e){const t=this.fileInfos.find(t=>t.file===e);return t?(this.fileInfos.remove(t),t):null}async _queryAttachment(e,t){const{_attachmentLayer:r}=this;if(!e||!r?.queryAttachments)throw new n("invalid-attachment-id","Could not query attachment.");const i=this._getObjectId(t);if("number"!=typeof i)throw new n("invalid-object-id","getAttachments(): Numeric object id is required");const o=new y({objectIds:[i],attachmentsWhere:`AttachmentId=${e}`,returnMetadata:!0});return r.queryAttachments(o).then(e=>e[i][0])}_getObjectId(e=this.graphic){return e?.getObjectId()??null}_graphicChanged(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>this.attachmentInfos.destroyAll()))}_setAttachmentLayer(){const{graphic:e}=this,t=m.getSourceLayer(e);this._attachmentLayer=t?"scene"===t.type&&null!=t.associatedLayer?t.associatedLayer:t:null}},t.__decorate([a.property()],e.default.prototype,"capabilities",void 0),t.__decorate([l.cast("capabilities")],e.default.prototype,"castCapabilities",null),t.__decorate([a.property()],e.default.prototype,"activeAttachmentInfo",void 0),t.__decorate([a.property()],e.default.prototype,"activeFileInfo",void 0),t.__decorate([a.property({readOnly:!0,type:g})],e.default.prototype,"attachmentInfos",void 0),t.__decorate([a.property()],e.default.prototype,"fileInfos",void 0),t.__decorate([a.property({type:r})],e.default.prototype,"graphic",void 0),t.__decorate([a.property()],e.default.prototype,"mode",void 0),t.__decorate([a.property({type:[u]})],e.default.prototype,"orderByFields",void 0),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"state",null),t.__decorate([a.property()],e.default.prototype,"filesEnabled",void 0),t.__decorate([a.property({readOnly:!0})],e.default.prototype,"supportsResizeAttachments",null),e.default=t.__decorate([d.subclass("esri.widgets.Attachments.AttachmentsViewModel")],e.default),e.default})},"esri/rest/query/support/AttachmentInfo":function(){define(["exports","../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../layers/support/exifUtils"],function(e,t,r,i,o,n,s,a,l){"use strict";var c;const p={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};return e.default=c=class extends r.JSONSupport{constructor(e){super(e),this.contentType=null,this.exifInfo=null,this.id=null,this.globalId=null,this.keywords=null,this.name=null,this.parentGlobalId=null,this.parentObjectId=null,this.size=null,this.url=null}get orientationInfo(){const{exifInfo:e}=this,t=l.getExifValue({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:e});return p[t]||null}clone(){return new c({contentType:this.contentType,exifInfo:this.exifInfo,id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})}},t.__decorate([i.property({type:String})],e.default.prototype,"contentType",void 0),t.__decorate([i.property()],e.default.prototype,"exifInfo",void 0),t.__decorate([i.property({readOnly:!0})],e.default.prototype,"orientationInfo",null),t.__decorate([i.property({type:o.Integer})],e.default.prototype,"id",void 0),t.__decorate([i.property({type:String})],e.default.prototype,"globalId",void 0),t.__decorate([i.property({type:String})],e.default.prototype,"keywords",void 0),t.__decorate([i.property({type:String})],e.default.prototype,"name",void 0),t.__decorate([i.property({json:{read:!1}})],e.default.prototype,"parentGlobalId",void 0),t.__decorate([i.property({json:{read:!1}})],e.default.prototype,"parentObjectId",void 0),t.__decorate([i.property({type:o.Integer})],e.default.prototype,"size",void 0),t.__decorate([i.property({json:{read:!1}})],e.default.prototype,"url",void 0),e.default=c=t.__decorate([a.subclass("esri.rest.query.support.AttachmentInfo")],e.default),e.default})},"esri/layers/support/exifUtils":function(){define(["exports"],function(e){"use strict";e.getExifValue=function(e){const{exifInfo:t,exifName:r,tagName:i}=e;if(!t||!r||!i)return null;const o=t.find(e=>e.name===r);return o?function(e){const{tagName:t,tags:r}=e;if(!r||!t)return null;const i=r.find(e=>e.name===t);return i?.value||null}({tagName:i,tags:o.tags}):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/support/featureUtils":function(){define(["exports","../../../core/has","../../../core/Logger","../../../core/string","../../../intl/date","../../../intl/number","../../../layers/support/fieldUtils","../../../layers/support/layerUtils","../../../smartMapping/support/utils","../../../support/loadArcade","../../../time/timeZoneUtils"],function(e,t,r,i,o,n,s,a,l,c,p){"use strict";const d=()=>r.getLogger("esri.widgets.Feature.support.featureUtils"),u=/href=(""|'')/gi,h=/(\{([^{\r\n]+)\})/g,y=/'/g,m=/^\s*expression\//i,f=/(\n)/gi,g=/[\u00A0-\u9999<>&]/gim,b=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,v=/^(?:mailto:|tel:)/,_="relationships/",w=o.convertDateFormatToIntlOptions("short-date-short-time");function S(e){return!!e&&m.test(e)}function x(e,t){const r=M(t,e);return r?r.name:e}function M(e,t){return e&&"function"==typeof e.getField&&t?e.getField(t)??null:null}function C(e){return`${e}`.trim()}function F({formattedAttributes:e,template:t,fieldInfoMap:r}){return C((o=i.replace(i.replace(t,e=>function(e,t){const r=t.get(e.toLowerCase());return`{${r?.fieldName||e}}`}(e,r)),e),o.replaceAll(u,"")));var o}function k(e,t){return e.replaceAll(h,(e,r,i)=>{const o=M(t,i);return o?`{${o.name}}`:r})}function I(e,t,r){const o=k(e,r);return o?o.replaceAll(b,(e,r,o)=>function(e,t,r){const o=(t=C(t))&&!t.startsWith("{");return i.replace(e,function(e,t=!1){const r={...e};return Object.keys(r).forEach(e=>function(e,t,r=!1){const i=t[e];if("string"==typeof i){const o="%27",n=(r?encodeURIComponent(i):i).replaceAll(y,o);t[e]=n}}(e,r,t)),r}(r,o||!1))}(e,r||o,t)):o}function T(e){return null!=e&&"object"==typeof e&&"fieldsIndex"in e&&"geometryType"in e&&"getField"in e&&"load"in e&&"loaded"in e&&"objectIdField"in e&&"spatialReference"in e&&"type"in e&&("feature"===e.type||"scene"===e.type||"subtype-group"===e.type||"subtype-sublayer"===e.type||"sublayer"===e.type)&&"when"in e}function L(e){return null!=e&&"object"==typeof e&&"createQuery"in e&&"queryFeatureCount"in e&&"queryObjectIds"in e&&"queryRelatedFeatures"in e&&"queryRelatedFeaturesCount"in e&&"relationships"in e}function E(e){return T(e)&&L(e)}function A(e,t){const{fieldInfos:r,fieldName:i,preventPlacesFormatting:o,layer:a,timeZone:c}=t,p=O(r,i),d=M(a,i);if(p&&!s.isRasterPixelValueField(i)){const t=d?.type,r=p.format?.dateFormat;if("date"===t||"date-only"===t||"time-only"===t||"timestamp-offset"===t||r)return l.formatAnyDate(e,{format:r,fieldType:t,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:c,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a)||!a.datesInUnknownTimezone)}})}const u=p?.format;return"string"==typeof e&&s.isRasterPixelValueField(i)&&u?function(e,t){return e=e.trim(),/\d{2}-\d{2}/.test(e)?e:e.includes(",")?V(e,",",", ",t):e.includes(";")?V(e,";","; ",t):e.includes(" ")?V(e," "," ",t):n.formatNumber(Number(e),n.convertNumberFormatToIntlOptions(t))}(e,u):(e=function(e,t){if("string"==typeof e&&t&&null==t.dateFormat&&(null!=t.places||null!=t.digitSeparator)){const t=Number(e);if(!isNaN(t))return t}return e}(e,u),"string"==typeof e||null==e||null==u?P(e):o?n.formatNumber(e,{...n.convertNumberFormatToIntlOptions(u),minimumFractionDigits:0,maximumFractionDigits:20}):n.formatNumber(e,n.convertNumberFormatToIntlOptions(u)))}function V(e,t,r,i){return e.trim().split(t).map(e=>n.formatNumber(Number(e),n.convertNumberFormatToIntlOptions(i))).join(r)}function O(e,t){if(e?.length&&t)return e.find(e=>e.fieldName?.toLowerCase()===t.toLowerCase())}function P(e){return"string"==typeof e?e.replaceAll(f,'<br class="esri-text-new-line" />'):e}function U(e){const{value:r,fieldName:i,fieldInfos:o,fieldInfoMap:n,layer:a,graphic:c,timeZone:p}=e;if(null==r)return"";const d=function({fieldName:e,value:r,graphic:i,layer:o}){if(D(e))return null;if(!o||"function"!=typeof o.getFieldDomain)return null;const n=i&&o.getFieldDomain(e,{feature:i,excludeImpliedDomains:t("esri-widget-legacy-field-domain-calculation")});return n&&"coded-value"===n.type?n.getName(r):null}({fieldName:i,value:r,graphic:c,layer:a});if(d)return d;const u=function({fieldName:e,graphic:t,layer:r}){if(D(e))return null;if(!r||"function"!=typeof r.getFeatureType)return null;const{typeIdField:i}=r;if(!i||e!==i)return null;const o=r.getFeatureType(t);return o?o.name:null}({fieldName:i,graphic:c,layer:a});if(u)return u;if(n.get(i.toLowerCase()))return A(r,{fieldInfos:o||Array.from(n.values()),fieldName:i,layer:a,timeZone:p});const h=a?.fieldsIndex?.get(i);return h&&(l.isAnyDateField(h)||s.isTimeOnlyField(h))?l.formatAnyDate(r,{fieldType:h.type,timeZoneOptions:{layerTimeZone:a&&"preferredTimeZone"in a?a.preferredTimeZone:null,viewTimeZone:p,datesInUnknownTimezone:!(!a||!("datesInUnknownTimezone"in a)||!a.datesInUnknownTimezone)}}):P(r)}async function R(e,t){const{layer:r,graphic:i,outFields:o,objectIds:n,returnGeometry:s,spatialReference:l}=e,c=n[0];if("number"!=typeof c&&"string"!=typeof c){const e="Could not query required fields for the specified feature. The feature's ID is invalid.",t={layer:r,graphic:i,objectId:c,requiredFields:o};return d().warn(e,t),null}if(!a.getEffectiveLayerCapabilities(r)?.operations?.supportsQuery){const e="The specified layer cannot be queried. The following fields will not be available.",t={layer:r,graphic:i,requiredFields:o,returnGeometry:s};return d().warn(e,t),null}const p=r.createQuery();return p.objectIds=n,p.outFields=o?.length?o:[r.objectIdField],p.returnGeometry=!!s,p.returnZ=!!s,p.returnM=!!s,p.outSpatialReference=l,(await r.queryFeatures(p,t)).features[0]}function D(e=""){return!!e&&e.includes(_)}function G({attributes:e,graphic:t,relatedInfo:r,fieldInfos:i,fieldInfoMap:o,layer:n,timeZone:s}){e&&t&&r&&Object.keys(t.attributes).forEach(a=>{const l=(c={layerId:r.relation.id.toString(),fieldName:a})?`${_}${c.layerId}/${c.fieldName}`:"";var c;const p=t.attributes[a];e[l]=U({fieldName:l,fieldInfos:i,fieldInfoMap:o,layer:n,value:p,graphic:t,timeZone:s})})}const H=e=>{if(!e)return!1;const t=e.toUpperCase();return t.includes("CURRENT_TIMESTAMP")||t.includes("CURRENT_DATE")||t.includes("CURRENT_TIME")},N=({layer:e,method:t,query:r,definitionExpression:i})=>{if(!e.capabilities?.query?.supportsCacheHint||"attachments"===t)return;const o=null!=r.where?r.where:null,n=null!=r.geometry?r.geometry:null;H(i)||H(o)||"extent"===n?.type||"tile"===r.resultType||(r.cacheHint=!0)};function j(e,t){return e?.allTables.find(e=>"feature"===e.type&&e.layerId===t.id&&e.url===t.layer?.url)}function W({map:e,relationship:t,relationship:{relatedTableId:r},relatedLayer:i,layers:o}){if(!o)return null;for(const n of o){if("map-image"===n.type){const r=W({layers:n.sublayers,map:e,relatedLayer:i,relationship:t})||W({layers:n.subtables,map:e,relatedLayer:i,relationship:t});if(r)return r;continue}if(!E(n))continue;if("sublayer"===i.type){if(n!==i&&n.id===r)return n.isTable?j(e,n):n;continue}const o="scene"===i.type&&i.associatedLayer?i.associatedLayer.url:i.url;if(!o)return null;if("sublayer"!==n.type){if(n!==i&&n.url===o&&n.layerId===r)return n}else if(n!==i&&n.layer?.url===o&&n.id===r)return n.isTable?j(e,n):n}return null}e.applyTextFormattingHTML=P,e.createFieldInfoMap=function(e,t){const r=new Map;if(!e)return r;for(const i of e){if(!i.fieldName)continue;const e=x(i.fieldName,t);i.fieldName=e,r.set(e.toLowerCase(),i)}return r},e.findRelatedLayer=function(e,t,r){return e&&t&&r?"sublayer"===t.type?W({layers:t.layer?.allSublayers,map:e,relatedLayer:t,relationship:r})||W({layers:t.layer?.subtables,map:e,relatedLayer:t,relationship:r}):W({layers:e.allLayers,map:e,relatedLayer:t,relationship:r})||W({layers:e.allTables,map:e,relatedLayer:t,relationship:r}):null},e.findUtilityNetwork=function(e,t){return e&&"utilityNetworks"in e&&t?e.utilityNetworks?.find(e=>e.isUtilityLayer(t)):null},e.fixTokens=k,e.formatAttributes=function({fieldInfos:e,attributes:t,layer:r,graphic:i,fieldInfoMap:o,relatedInfos:n,timeZone:s}){const a={};return n?.forEach(t=>function({attributes:e,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:o,timeZone:n}){e&&t&&(t.relatedFeatures?.forEach(s=>G({attributes:e,graphic:s,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:o,timeZone:n})),t.relatedStatsFeatures?.forEach(s=>G({attributes:e,graphic:s,relatedInfo:t,fieldInfoMap:r,fieldInfos:i,layer:o,timeZone:n})))}({attributes:a,relatedInfo:t,fieldInfoMap:o,fieldInfos:e,layer:r,timeZone:s})),t&&Object.keys(t).forEach(n=>{const l=t[n];a[n]=U({fieldName:n,fieldInfos:e,fieldInfoMap:o,layer:r,value:l,graphic:i,timeZone:s})}),a},e.formatEditInfo=function(e,t,r,i){const{creatorField:n,creationDateField:s,editorField:a,editDateField:l}=e;if(!t)return;const c=p.getTimeZoneFormattingOptions(i&&"preferredTimeZone"in i?i.preferredTimeZone:null,!(!i||!("datesInUnknownTimezone"in i)||!i.datesInUnknownTimezone),r,w,"date"),d={...w,...c},u=t[l];if("number"==typeof u){const e=t[a];return{type:"edit",date:o.formatDate(u,d),user:e}}const h=t[s];if("number"==typeof h){const e=t[n];return{type:"create",date:o.formatDate(h,d),user:e}}return null},e.formatValueToFieldInfo=A,e.getAllFieldInfos=function(e){const t=[];if(!e)return t;const{fieldInfos:r,content:i}=e;return r&&t.push(...r),i&&Array.isArray(i)?(i.forEach(e=>{if("fields"===e.type){const r=e?.fieldInfos;r&&t.push(...r)}}),t):t},e.getFieldInfo=O,e.getFieldInfoLabel=function(e,t){const r=function(e,t){if(!t||!S(t)||!e)return;const r=t.replace(m,"").toLowerCase();return e.find(({name:e})=>e.toLowerCase()===r)}(t,e?.fieldName);return r?r.title||null:e?e.label||e.fieldName:null},e.getFixedFieldName=x,e.getFixedFieldNames=function(e,t){return e&&e.map(e=>x(e,t))},e.getSourceLayer=function(e){if(null!=e)return(e.sourceLayer||e.layer)??void 0},e.graphicCallback=async function({type:e,value:t,event:r}){try{return"function"==typeof t?t(r):await t}catch(i){return void d().error("error",`An error occurred when calling the "${e}" function`,{error:i,graphic:r.graphic,value:t})}},e.htmlEntities=function(e){return e.replaceAll(g,e=>`&#${e.charCodeAt(0)};`)},e.isAssociatedFeatureSupportedLayer=function(e){return!(!(e&&"object"==typeof e&&"createQuery"in e&&"getField"in e&&"queryFeatureCount"in e&&"queryFeatures"in e&&"queryObjectIds"in e&&"capabilities"in e&&"fields"in e&&"fieldsIndex"in e&&"type"in e)||"feature"!==e.type&&"subtype-group"!==e.type&&"subtype-sublayer"!==e.type&&"sublayer"!==e.type||!("when"in e))&&("subtype-sublayer"===e.type&&"parent"in e&&e.parent&&"object"==typeof e.parent?"globalIdField"in e.parent:"globalIdField"in e)},e.isExpressionField=S,e.isFeatureSupportedLayer=T,e.isGraphicForRelatableFeatureSupportedLayer=function(e){return!!e&&"object"==typeof e&&"sourceLayer"in e&&E(e.sourceLayer)},e.isRelatableFeatureSupportedLayer=E,e.isRelatableLayer=L,e.isRelatedField=D,e.preLayerQueryCallback=({query:e,layer:t,method:r})=>{N({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},e.preRequestCallback=({queryPayload:e,layer:t,method:r})=>{N({layer:t,method:r,query:e,definitionExpression:`${t.definitionExpression} ${t.serviceDefinitionExpression??""}`})},e.querySourceLayer=R,e.queryUpdatedFeature=async function({graphic:e,popupTemplate:t,layer:r,spatialReference:i},o){if(!r||!t)return;if("function"==typeof r.load&&await r.load(o),!e.attributes)return;const n=r.objectIdField,a=e.attributes[n];if(null==a)return;const l=[a],p=new Set(await t.getRequiredFields(r.fieldsIndex));null==r.timeInfo?.trackIdField||p.has(r.timeInfo.trackIdField)||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await c.loadArcade(),{arcadeUtils:{requiresTrack:r}}=t;return r(e)}(t)&&p.add(r.timeInfo.trackIdField);const d=s.featureHasFields(e,p),u=d?[]:p.has(n)?[...p]:[...p,n],h=t.returnGeometry||await async function(e){if(!e.expressionInfos?.length)return!1;const t=await c.loadArcade(),{arcadeUtils:{hasGeometryFunctions:r}}=t;return r(e)}(t);if(d&&!h)return;const y=await R({layer:r,graphic:e,outFields:u,objectIds:l,returnGeometry:h,spatialReference:i},o);y&&(y.geometry&&(e.geometry=y.geometry),y.attributes&&(e.attributes={...e.attributes,...y.attributes}))},e.shouldOpenInNewTab=function(e=""){if(e)return!v.test(e.trim().toLowerCase())},e.substituteAttributes=F,e.substituteFieldsInLinksAndAttributes=function({attributes:e,globalAttributes:t,layer:r,text:i,expressionAttributes:o,fieldInfoMap:n}){return i?F({formattedAttributes:t,template:I(i,{...t,...o,...e},r),fieldInfoMap:n}):""},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define(["exports","../../intl/date","../../layers/support/fieldUtils","../../support/basemapUtils","../../support/loadArcade","../../time/constants","../../time/timeZoneUtils"],function(e,t,r,i,o,n,s){"use strict";const a={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},c=new Set(["integer","small-integer"]);let p=null;function d(e){return String(e).padStart(2,"0")}function u(e,t,r){let i;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),i=`TIMESTAMP'${r?e.getFullYear():e.getUTCFullYear()}-${d((r?e.getMonth():e.getUTCMonth())+1)}-${d(r?e.getDate():e.getUTCDate())} ${d(r?e.getHours():e.getUTCHours())}:${d(r?e.getMinutes():e.getUTCMinutes())}:${d(r?e.getSeconds():e.getUTCSeconds())}'`):i=e,i}function h(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const i=e.getField(t);if("<now>"===t.toLowerCase())return;if(r.isDateField(i))return"field"}}e.castIntegerFieldToFloat=function(e){return`cast(${e} as float)`},e.dateTypes=["date","date-only","timestamp-offset"],e.defaultBasemapGroups=a,e.defaultStatisticTypes={exclude:["median"]},e.fieldDelimiter=",",e.formatAnyDate=function(e,r){const{format:i,timeZoneOptions:o,fieldType:a}=r??{};let l,c;if(o&&({timeZone:l,timeZoneName:c}=s.getTimeZoneFormattingOptions(o.layerTimeZone,o.datesInUnknownTimezone,o.viewTimeZone,t.convertDateFormatToIntlOptions(i||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const r=t.convertDateFormatToIntlOptions(i||"short-date");return"string"==typeof e?t.formatDateOnly(e,{...r}):t.formatDate(e,{...r,timeZone:n.utc})}case"time-only":{const r=t.convertDateFormatToIntlOptions(i||"short-time");return"string"==typeof e?t.formatTimeOnly(e,r):t.formatDate(e,{...r,timeZone:n.utc})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const r=i||o?t.convertDateFormatToIntlOptions(i||"short-date-short-time"):void 0,n=r?{...r,timeZone:l,timeZoneName:c}:void 0;return"string"==typeof e?t.formatTimestamp(e,n):t.formatDate(e,n)}default:{const r=i||o?t.convertDateFormatToIntlOptions(i||"short-date-short-time"):void 0;return t.formatDate("string"==typeof e?new Date(e):e,r?{...r,timeZone:l,timeZoneName:c}:void 0)}}},e.getBasemapGroup=function(e,t=a){for(const r in t)if(t[r].includes(e))return r},e.getBasemapId=function(e,t,r=!0){let o=null;return e&&("string"==typeof e?t.includes(e)&&(o=e):o=i.getWellKnownBasemapId(e)),r?o||"gray":o},e.getDateDiffSQL=function(e,t,r,i){const{hasQueryEngine:o}=e,n=`(${u(r,h(e,r),o)} - ${u(t,h(e,t),o)})`;let s=l[i],a="/";return s<1&&(s=1/s,a="*"),{sqlExpression:1===s?n:`(${n} ${a} ${s})`,sqlWhere:null}},e.getDateType=h,e.getFieldsList=async function(e){const{field:t,field2:r,field3:i,normalizationField:n,valueExpression:s}=e;let a=[];if(s){if(!p){const{arcadeUtils:e}=await o.loadArcade();p=e}a=p.extractFieldNames(s)}return t&&a.push(t),r&&a.push(r),i&&a.push(i),n&&a.push(n),a},e.getNormalizationType=function(e){let t=e.normalizationType;return t||(e.normalizationField?t="field":null!=e.normalizationTotal&&(t="percent-of-total")),t??void 0},e.isAnyDateField=function(e){return r.isDateField(e)||r.isDateOnlyField(e)||r.isTimestampOffsetField(e)},e.isIntegerField=function(e,t){const r=t&&e.getField(t);return!!r&&c.has(r.type)},e.unitValueInDays=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports","../../../assets"],function(e,t){"use strict";e.getCalciteIconForAttachment=function(e){return e?"text/plain"===e?"file-text":"application/pdf"===e?"file-pdf":"text/csv"===e?"file-csv":"application/gpx+xml"===e?"file-gpx":"application/x-dwf"===e?"file-cad":"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?"file-code":"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?"file-zip":e.includes("image/")?"file-image":e.includes("audio/")?"file-sound":e.includes("video/")?"file-video":e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?"file-excel":e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?"file-word":e.includes("powerpoint")||e.includes("presentationml")?"file-ppt":"file":"file"},e.getIconPath=function(e){const r=t.getAssetUrl("esri/themes/base/images/files/");return e?"text/plain"===e?`${r}text-32.svg`:"application/pdf"===e?`${r}pdf-32.svg`:"text/csv"===e?`${r}csv-32.svg`:"application/gpx+xml"===e?`${r}gpx-32.svg`:"application/x-dwf"===e?`${r}cad-32.svg`:"application/postscript"===e||"application/json"===e||"text/xml"===e||"model/vrml"===e?`${r}code-32.svg`:"application/x-zip-compressed"===e||"application/x-7z-compressed"===e||"application/x-gzip"===e||"application/x-tar"===e||"application/x-gtar"===e||"application/x-bzip2"===e||"application/gzip"===e||"application/x-compress"===e||"application/x-apple-diskimage"===e||"application/x-rar-compressed"===e||"application/zip"===e?`${r}zip-32.svg`:e.includes("image/")?`${r}image-32.svg`:e.includes("audio/")?`${r}sound-32.svg`:e.includes("video/")?`${r}video-32.svg`:e.includes("msexcel")||e.includes("ms-excel")||e.includes("spreadsheetml")?`${r}excel-32.svg`:e.includes("msword")||e.includes("ms-word")||e.includes("wordprocessingml")?`${r}word-32.svg`:e.includes("powerpoint")||e.includes("presentationml")?`${r}report-32.svg`:`${r}generic-32.svg`:`${r}generic-32.svg`},e.isSupportedImage=function(e){const t=e.toLowerCase();return"image/bmp"===t||"image/emf"===t||"image/exif"===t||"image/gif"===t||"image/x-icon"===t||"image/jpeg"===t||"image/png"===t||"image/tiff"===t||"image/x-wmf"===t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/globalCss":function(){define(["exports"],function(e){"use strict";e.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",primaryTickLabelKeepAll:"primary-tick__label--keep-all",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/legacyIcon":function(){define(["exports"],function(e){"use strict";e.legacyIcon={close:"esri-icon-close",collapse:"esri-icon-collapse",down:"esri-icon-down",downArrow:"esri-icon-down-arrow",dragHorizontal:"esri-icon-drag-horizontal",dragVertical:"esri-icon-drag-vertical",duplicate:"esri-icon-duplicate",expand:"esri-icon-expand",fontFallbackText:"esri-icon-font-fallback-text",forward:"esri-icon-forward",handleVertical:"esri-icon-handle-vertical",icon:"esri-icon",left:"esri-icon-left",locateCircled:"esri-icon-locate-circled",noticeTriangle:"esri-icon-notice-triangle",pause:"esri-icon-pause",play:"esri-icon-play",plus:"esri-icon-plus",radioChecked:"esri-icon-radio-checked",radioUnchecked:"esri-icon-radio-unchecked",refresh:"esri-icon-refresh",reverse:"esri-icon-reverse",right:"esri-icon-right",search:"esri-icon-search",swap:"esri-icon-swap",table:"esri-icon-table",trash:"esri-icon-trash",up:"esri-icon-up",upArrow:"esri-icon-up-arrow",upDownArrows:"esri-icon-up-down-arrows",urbanModel:"esri-icon-urban-model",zoomInMagnifyingGlass:"esri-icon-zoom-in-magnifying-glass",zoomToObject:"esri-icon-zoom-to-object"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm":function(){define(["require","../chunks/tslib.es6","../intl","../core/has","../core/MapUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","../support/guards","./Widget","./BatchAttributeForm/batchAttributeFormUtils","./BatchAttributeForm/BatchAttributeFormViewModel","./BatchAttributeForm/css","./BatchAttributeForm/VisibleElements","./BatchAttributeForm/inputs/support/inputUtils","../chunks/componentsUtils","./support/dateUtils","./support/globalCss","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/forms/formUtils","../intl/substitute"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F){"use strict";const k="data-element-id";let I=class extends u{constructor(e,t){super(e,t),this.headingLevel=2,this.messagesCommon=null,this.messages=null,this.featureFormMessages=null,this.viewModel=new y,this.visibleElements=new f.VisibleElements,this.groupDisplay="all",this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._touchedInputs=new Set,this._focusedFieldInput=null,this._batchSwitchInputInitialValues=new Map,this._saveInput=this._saveInput.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([n.watch(()=>this.features,()=>{this._dateComponentMap.clear()}),n.watch(()=>this.viewModel.activeForm,()=>{this._batchSwitchInputInitialValues.clear()}),n.on(()=>this.viewModel,"submit",()=>{this.valid||this.goToClosestError()})])}loadDependencies(){return b.loadCalciteComponents({input:()=>new Promise((t,r)=>e(["../chunks/index4"],t,r)),block:()=>new Promise((t,r)=>e(["../chunks/index13"],t,r)),button:()=>new Promise((t,r)=>e(["../chunks/index2"],t,r)),combobox:()=>new Promise((t,r)=>e(["../chunks/index21"],t,r)),"combobox-item":()=>new Promise((t,r)=>e(["../chunks/index22"],t,r)),"combobox-item-group":()=>new Promise((t,r)=>e(["../chunks/index23"],t,r)),dropdown:()=>new Promise((t,r)=>e(["../chunks/index24"],t,r)),"dropdown-group":()=>new Promise((t,r)=>e(["../chunks/index25"],t,r)),"dropdown-item":()=>new Promise((t,r)=>e(["../chunks/index26"],t,r)),"input-date-picker":()=>new Promise((t,r)=>e(["../chunks/index27"],t,r)),"input-number":()=>new Promise((t,r)=>e(["../chunks/index28"],t,r)),"input-time-picker":()=>new Promise((t,r)=>e(["../chunks/index29"],t,r)),"input-time-zone":()=>new Promise((t,r)=>e(["../chunks/index30"],t,r)),label:()=>new Promise((t,r)=>e(["../chunks/index5"],t,r)),"input-message":()=>new Promise((t,r)=>e(["../chunks/index31"],t,r)),loader:()=>new Promise((t,r)=>e(["../chunks/index32"],t,r)),notice:()=>new Promise((t,r)=>e(["../chunks/index6"],t,r)),switch:()=>new Promise((t,r)=>e(["../chunks/index33"],t,r)),"text-area":()=>new Promise((t,r)=>e(["../chunks/index34"],t,r)),"radio-button":()=>new Promise((t,r)=>e(["../chunks/index35"],t,r)),"radio-button-group":()=>new Promise((t,r)=>e(["../chunks/index36"],t,r))})}get activeFeatureIndex(){return this.viewModel.activeFeatureIndex}set activeFeatureIndex(e){this.viewModel.activeFeatureIndex=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get _effectiveDisabled(){return this.disabled||this.viewModel.updating}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get icon(){return"edit-attributes"}set icon(e){this._overrideIfSome("icon",e)}get readOnly(){return this.viewModel.readOnly}set readOnly(e){this.viewModel.readOnly=e}get valid(){return this.viewModel.valid}goToClosestError(){const e=this.viewModel.getFirstVisibleInvalidFieldInput();if(!e)return;const{groupInput:t}=e;t&&(t.open||(t.open=!0)),this._focusedFieldInput=e.input,this._attemptFocusOnNextRender=!0,this.scheduleRender()}render(){const{status:e}=this.viewModel;return"failed"===e?this.viewModel.hasTooManyComplexFeatures?this._renderErrorNotice(F.substitute(this.messages.formFailedToLoadTooManyComplexFeatures,{num:this.viewModel.maximumFeatureCountWithComplexForms})):this.viewModel.hasTooManyFeatures?this._renderErrorNotice(F.substitute(this.messages.formFailedToLoadTooManyFeatures,{num:this.viewModel.maximumFeatureCount})):this._renderErrorNotice(this.messages.formFailedToLoad):this.viewModel.expressionEvaluationFailed?this._renderErrorNotice(this.messages.expressionEvaluationFailed):this.viewModel.hasLayersWithContingentValues?this._renderErrorNotice(this.messages.unsupportedContingentValues):M.tsx("div",{class:this.classes(m.css.base,_.globalCss.widget,_.globalCss.panel)},"loaded"===e?this._renderForm():"loading"===e&&this.visibleElements.loadingIndicator?M.tsx("calcite-loader",{key:"loader",label:this.messagesCommon?.loading}):null)}submit(){this.viewModel.submit()}_setDateTimeTimeZoneMap(e){const{datePart:t,elementId:r}=e.dataset,i=o.getOrCreateMapValue(this._dateComponentMap,`${r}`,()=>({}));switch(t){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}}_renderErrorNotice(e){return M.tsx("div",{class:this.classes(m.css.base,_.globalCss.widget,_.globalCss.panel)},M.tsx("calcite-notice",{class:m.css.noticeError,icon:!0,kind:"warning",open:!0},M.tsx("div",{slot:"message"},e)))}_renderForm(){return M.tsx("form",{onsubmit:this._onFormSubmit},this._renderInvisibleFieldsError(),this._renderContent())}_renderInvisibleFieldsError(){const{viewModel:e}=this,{hasNonActiveInvalidFeatures:t,activeForm:r}=e;let i;if(!e.submitHasBeenAttempted)return null;if(r.invalidHiddenInputs.length>0)if(i=h.getHiddenFieldsValidationErrorMessage(r,e.mode,this.messages),"batch"===this.viewModel.mode){const e=r.invalidHiddenInputs.filter(e=>"hidden:group-visibility-expression:all-features"===e.effectiveVisibilityCode||"hidden:visibility-expression:all-features"===e.visibilityCode);e.length>0?i+=` (${e.map(e=>e.label).join(", ")})`:i=null}else i+=` (${r.invalidHiddenInputs.map(e=>e.label).join(", ")})`;else if(t)return null;return i?M.tsx("calcite-notice",{class:m.css.noticeError,icon:!0,kind:"danger",open:!0},M.tsx("div",{slot:"message"},i)):null}_renderContent(){if(!this.viewModel.hasVisibleInputs)return[M.tsx("calcite-notice",{class:m.css.noticeError,icon:!0,kind:"warning",open:!0},M.tsx("div",{slot:"message"},this.messages.noVisibleFields[this.viewModel.noVisibleElementsReason]))];const{inputs:e}=this.viewModel.activeForm;return e.filter(e=>e.visible).map(e=>this._renderInput(e))}_renderInput(e){return g.isGroupInput(e)?this._renderGroupInput(e):g.isFieldInput(e)?this._renderLabeledField(e):void 0}_renderGroupInput(e){const{inputs:t,template:r,open:i}=e,o=t.filter(e=>e.visible),n=r.label??"";return M.tsx("calcite-block",{class:this.classes(m.css.group,"sequential"===this.groupDisplay?m.css.groupSequential:null,this.disabled?m.css.inputDisabled:null),collapsible:!0,description:r.description??void 0,disabled:this._effectiveDisabled,expanded:i,heading:n,headingLevel:this.headingLevel,key:`{${r.elementId}-key}`,label:n,onCalciteBlockClose:()=>{e.open=!1},onCalciteBlockOpen:()=>{e.open=!0}},o.map(e=>this._renderInput(e)))}_renderLabeledField(e){const{label:t,elementId:r}=e.template,{required:i,dataType:o}=e,n=i?F.substitute(this.messages.requiredFieldLabel,{name:t}):t;return M.tsx("calcite-label",{"aria-label":n,class:m.css.label,key:`field--${r}`},M.tsx("div",{class:m.css.labelTextContent,key:"labelTextContainer"},t,i?M.tsx("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==o?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e))}_renderFieldInput(e){const t=this.getCommonInputProps(e),{dataType:r}=e;return"date"===r?this._renderDateComponents(e,t):"coded-value"===e.domain?.type?this._renderCodedInputs({input:e,props:t}):"number"===r?this._renderNumberComponent(e,t):this._renderStringComponent(e,t)}_renderAuxiliaryText(e){const{compositeError:t,description:r,submittable:i}=e,o=!i&&t&&(this.viewModel.submitHasBeenAttempted||this._touchedInputs.has(e.template.elementId))?h.getVisibleFieldInputValidationErrorMessage(e,t,this.messages):null;return o?M.tsx("calcite-input-message",{icon:!0,status:"invalid"},o):r?M.tsx("calcite-input-message",{class:m.css.description,icon:!1,status:"idle"},r):null}_renderCodedInputs({input:e,props:t}){const r=e.template.input?.type??null,i=e.codedValueOptions;switch(r){case"switch":return this._renderSwitchField({input:e,props:t});case"radio-buttons":return this._renderRadioButtonGroupComponent({input:e,options:i.flat(),props:t});default:return this._renderComboBoxComponent({options:i,props:t,input:e})}}_renderSwitchField({input:e,props:t}){if((this._batchSwitchInputInitialValues.get(e)===g.differentValuesString||e.value===g.differentValuesString)&&"batch"===this.viewModel.mode){const r={dropdown:{afterCreate:this._afterComponentCreateOrUpdate,afterUpdate:this._afterComponentCreateOrUpdate,disabled:t.readOnly,open:!1,[k]:t[k]},trigger:{appearance:"transparent",iconEnd:"chevron-down",kind:"neutral",slot:"trigger",label:t.label},group:{mode:"single"}};return this._renderDropdownComponent({buttonValue:e.value,dropdownProps:r,options:[{name:this.messages.differentValuesPlaceholder,value:g.differentValuesString,disabled:!0},...e.codedValueDomainOptions]})}return this._renderSwitchComponent({input:e,props:t})}_renderSwitchComponent({input:e,props:t}){return M.tsx("calcite-switch",{...t,checked:!!h.isElementTemplateWithInputType(e.template,"switch")&&e.value===e.template.input.onValue,class:m.css.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldInput=null},onCalciteSwitchChange:({currentTarget:e})=>this._saveInput(e)})}_renderDropdownComponent({buttonValue:e,options:t,dropdownProps:r}){const{trigger:i,dropdown:o,group:n}=r;return M.tsx("calcite-dropdown",{...o,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,onCalciteDropdownSelect:({currentTarget:e})=>this._saveInput(e)},M.tsx("calcite-button",{...i},e===g.differentValuesString?this.messages.differentValuesPlaceholder:e),M.tsx("calcite-dropdown-group",{selectionMode:n.mode},t.map(t=>M.tsx("calcite-dropdown-item",{disabled:t.disabled,label:String(t.name),selected:e===t.value},t.name))))}_renderComboBoxComponent({input:e,options:t,props:r}){const i="INSERT"===this.viewModel.editType,o=this._touchedInputs.has(e?.template?.elementId),n=i&&e.showNoValueOptionEnabled&&!o?()=>{}:r.onblur,s={...r,onblur:n};return M.tsx("calcite-combobox",{...s,selectionMode:"single",value:r.placeholder===this.messages.differentValuesPlaceholder?g.differentValuesString:String(r.value),onCalciteComboboxChange:({currentTarget:e})=>{e.value!==g.differentValuesString&&this._saveInput(e)}},this.renderComboboxOptionsList({input:e,options:t,props:r}))}renderComboboxOptionsList({input:e,options:t,props:r}){const[i,o]=t.map(e=>e.map(({name:e,value:t})=>M.tsx("calcite-combobox-item",{key:`#${t}`,selected:r.value===t,textLabel:e,value:`${t}`}))),n=[...i];o.length>0&&n.push(M.tsx("calcite-combobox-item-group",{key:"unsupported",label:this.featureFormMessages.subtypes.unsupportedDomainGroupTitle},o));const s=r.placeholder===this.messages.differentValuesPlaceholder,a=!s&&C.isEmptyValue(r.value);return e.showNoValueOptionEnabled&&n.unshift(M.tsx("calcite-combobox-item",{key:"empty-option",selected:a,textLabel:e.showNoValueLabel||this.messages.empty,value:""})),s&&n.unshift(M.tsx("calcite-combobox-item",{key:g.differentValuesString,selected:!0,textLabel:this.messages.differentValuesPlaceholder,value:g.differentValuesString})),n}_renderRadioButtonGroupComponent({input:e,options:t,props:r}){const i=t.map(({name:t,value:i})=>this._renderRadioButtons({label:t,value:i,selected:i===e.value,props:r}));if(e.showNoValueOptionEnabled){const t="",o=e.showNoValueLabel||this.messages.empty,n=C.isEmptyValue(e.value);i.unshift(this._renderRadioButtons({label:o,value:t,selected:n,props:r}))}return M.tsx("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:m.css.inputRadioGroup,disabled:r.readOnly,key:`${r.key}-radio-group`,layout:"vertical",name:r.name,required:r.required},i,r.placeholder===this.messages.differentValuesPlaceholder?M.tsx("calcite-label",{class:m.css.placeholderRadio,key:r.label,layout:"inline"},M.tsx("calcite-radio-button",{checked:!0,class:m.css.inputRadio,disabled:!0,name:r.placeholder,value:r.placeholder}),r.placeholder):null)}_renderRadioButtons({value:e,selected:t,label:r,props:i}){return M.tsx("calcite-label",{class:m.css.inputRadioLabel,key:i.label,layout:"inline"},M.tsx("calcite-radio-button",{...i,afterCreate:void 0,afterUpdate:void 0,checked:t,class:m.css.inputRadio,disabled:i.readOnly,name:i.label,onblur:()=>{this._focusedFieldInput=null},value:e,onCalciteRadioButtonChange:({currentTarget:e})=>{e.checked&&this._saveInput(e)}}),r)}_renderStringComponent(e,t){const{template:r}=e;return!r.field.editable||this.readOnly?this._renderReadOnlyComponent(e):r.input&&"text-area"===r.input.type?M.tsx("calcite-text-area",{...t,class:this.classes(m.css.individualElement),resize:"vertical",value:t.value?String(t.value):"",onCalciteTextAreaInput:({currentTarget:e})=>this._saveInput(e)}):M.tsx("calcite-input",{...t,class:this.classes(m.css.individualElement),type:"text",value:t.value?String(t.value):"",onCalciteInputInput:({currentTarget:e})=>this._saveInput(e)})}_renderNumberComponent(e,t){const r=p.isIntegerField(e.field);return M.tsx("calcite-input-number",{...t,integer:r,type:"number",value:r&&""!==t.value?Math.round(parseFloat(String(t.value))).toString():String(t.value),onCalciteInputNumberInput:({currentTarget:e})=>this._saveInput(e)})}_renderReadOnlyComponent(e,t){const r=this.getCommonInputProps(e);return M.tsx("calcite-input",{...r,class:this.classes(m.css.fieldInput,m.css.inputDisabled,m.css.individualElement),readOnly:!0,type:"text",value:String(t??r.value??"")})}_renderDateComponents(e,t){const{field:r}=e;let i;switch(r.type){case"date":i=this._renderDateFieldComponents(e,t);break;case"date-only":i=this._renderDateOnlyFieldComponent(e,t);break;case"time-only":i=this._renderTimeOnlyFieldComponent(e,t);break;case"timestamp-offset":i=this._renderTimestampOffsetFieldComponents(e,t);break;default:i=this._renderReadOnlyComponent(e,v.getLabelForDateFieldValue(r,t.value,{timeZone:e.effectiveTimeZone,...v.getIntlOptionsForField(e.template.field)}))}return e.value===g.differentValuesString?[i,M.tsx("calcite-input-message",{icon:"information",key:"diff-values-message",status:"idle"},this.messages.differentValues)]:i}_renderDateOnlyFieldComponent(e,t){const{class:r,key:i,readOnly:o}=t,{rawMax:n,rawMin:s}=e.range;return M.tsx("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,class:r,"data-date-part":"date","data-element-id":t[k],key:`${i}-date-input`,max:d.isString(n)?n:void 0,min:d.isString(s)?s:void 0,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:o,value:e.value===g.differentValuesString?"":e.value?String(e.value):"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.currentTarget)})}_renderTimeOnlyFieldComponent(e,t){const{class:r,key:i,readOnly:o}=t;return M.tsx("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,class:r,"data-date-part":"time","data-element-id":t[k],key:`${i}-time-input`,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:o,value:e.value===g.differentValuesString?"":e.value?String(e.value):"",onCalciteInputTimePickerChange:t=>this._saveValueFromDateComponent(e,t.currentTarget)})}_renderTimestampOffsetFieldComponents(e,t){const{class:r,key:i,readOnly:o}=t,{rawMax:n,rawMin:s}=e.range,a=v.prepareISOFieldValueForDateComponents(n),l=v.prepareISOFieldValueForDateComponents(s),c=v.prepareISOFieldValueForDateComponents(e.value===g.differentValuesString?"":e.value),p=e.includeTimeOffset,d={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,overlayPositioning:"fixed",readOnly:o,[k]:t[k],onfocus:this._onComponentFocus};return M.tsx("div",{class:m.css.dateInputContainer,key:`${i}-date-time-container`},M.tsx("calcite-input-date-picker",{...d,class:r,"data-date-part":"date",key:`${i}-date-input`,max:a?.date??void 0,min:l?.date??void 0,onblur:()=>{this._focusedFieldInput=null},value:c.date??"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),M.tsx("calcite-input-time-picker",{...d,class:r,"data-date-part":"time",key:`${i}-time-input`,onblur:()=>{this._focusedFieldInput=null},value:c.time??"",onCalciteInputTimePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),p?M.tsx("calcite-input-time-zone",{...d,class:r,clearable:e.value===g.differentValuesString||null==e.value,"data-date-part":"timeZone",key:`${i}-timezone-input`,onblur:()=>{this._focusedFieldInput=null},value:c.timeZoneOffset||"",onCalciteInputTimeZoneChange:t=>this._saveValueFromDateComponent(e,t.target)}):null)}_renderDateFieldComponents(e,t){const{class:r,key:i,readOnly:o,min:n,max:s}=t,a=e.effectiveTimeZone,l=v.prepareUnixFieldValueForDateComponents(e.value===g.differentValuesString?"":e.value,a),c=v.prepareUnixFieldValueForDateComponents(s,a),p=v.prepareUnixFieldValueForDateComponents(n,a),d=e.includeTime,u={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,overlayPositioning:"fixed",readOnly:o,[k]:t[k],onfocus:this._onComponentFocus};return M.tsx("div",{class:m.css.dateInputContainer,key:`${i}-date-time-container`},M.tsx("calcite-input-date-picker",{...u,class:r,"data-date-part":"date",key:`${i}-date-input`,max:c?.date??void 0,min:p?.date??void 0,onblur:()=>{this._focusedFieldInput=null},value:l.date??"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),d?M.tsx("calcite-input-time-picker",{...u,"data-date-part":"time",key:`${i}-time-input`,onblur:()=>{this._focusedFieldInput=null},step:1,value:l.time??"",onCalciteInputTimePickerChange:t=>{this._saveValueFromDateComponent(e,t.target)}}):null)}getCommonInputProps(e){const{template:t,valid:r,value:i,minLength:o,maxLength:n,required:s,fieldName:a,editable:l,userHasChangedValue:c,range:{max:p,min:d}}=e,u=!l||this.readOnly,h=!u&&this._effectiveDisabled;let y=t.hint??void 0,f=!1;return i===g.differentValuesString&&(y=this.messages.differentValuesPlaceholder,f=!0),{afterCreate:this._afterComponentCreateOrUpdate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":r?"false":"true",class:this.classes(m.css.fieldInput,u?m.css.inputDisabled:null),status:!c&&!this.viewModel.submitHasBeenAttempted||r?"idle":"invalid",maxLength:n&&n>-1?n:void 0,minLength:o&&o>-1?o:void 0,key:t.elementId,label:a,name:a,max:null!=p?p:void 0,min:null!=d?d:void 0,disabled:h,readOnly:u,onblur:this._onComponentBlur,required:s,placeholder:y,value:f?"":i??"",[k]:t.elementId,onfocus:this._onComponentFocus}}_onFormSubmit(e){e.preventDefault()}_getFieldInputFromHTMLElement(e){return this.viewModel.findFieldInput(e.getAttribute(k))}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,r=e.querySelector("calcite-radio-button"),i=t||r;i&&this._afterComponentCreateOrUpdate(i)}_onComponentFocus(e){const t=e.target,r=this._getFieldInputFromHTMLElement(t);this._touchedInputs.add(r.template.elementId),this._focusedFieldInput=r}_afterComponentCreateOrUpdate(e){const t=this._getFieldInputFromHTMLElement(e),r=this._focusedFieldInput;this._attemptFocusOnNextRender&&r===t&&(this._attemptFocusOnNextRender=!1,w.setFocus(e))}_onComponentBlur(){this._focusedFieldInput=null}_parseValue(e,t){if(h.isElementTemplateWithInputType(t.template,"switch")){if("calcite-dropdown"===e.localName&&t.domain)for(const r of t.domain.codedValues)if(r.name===e.selectedItems[0].textContent)return r.code;return e.checked?t.template.input.onValue:t.template.input.offValue}const r=e.value;return null==r||""===r?null:"number"===t.dataType?"-0"===r||"-0."===r||"-0,"===r?r:parseFloat(r):"date"===t.field.type?parseFloat(r):r}_saveInput(e){const t=this._getFieldInputFromHTMLElement(e),{elementId:r}=t.template;if(!t)return;const i=t?.value;if(h.isElementTemplateWithInputType(t.template,"switch")&&"single"!==this.viewModel.mode){const e=o.getOrCreateMapValue(this._batchSwitchInputInitialValues,t,()=>t.value);this._batchSwitchInputInitialValues.set(t,null===e?i:e)}const n=this._parseValue(e,t);n!==i&&this.viewModel.setValue(r,n)}_afterDateComponentCreate(e){this._setDateTimeTimeZoneMap(e),this._afterComponentCreateOrUpdate(e)}_saveValueFromDateComponent(e,t){const{elementId:r}=e.template,i=e.field.type,o=this._dateComponentMap.get(`${r}`);if(!o)return;const n=e.effectiveTimeZone;let s=e.value===g.differentValuesString?void 0:e.value,a=null;"date-only"===i?a=Array.isArray(t.value)?t.value[0]:t.value:"time-only"===i?(s=v.normalizeTimeOnlyString(s),a=v.normalizeTimeOnlyString(t.value)):a="timestamp-offset"===i?null!=t.value?v.getISOFieldValueFromDateComponents({dateComponent:o.date,timeComponent:o.time,oldValue:s,timeZoneComponent:o.timeZone,defaultTimeZone:n}):null:null!=t.value?v.getUnixFieldValueFromDateComponents({oldValue:s,dateComponent:o.date,timeZone:n,timeComponent:o.time?.value===g.differentValuesString?void 0:o.time}):null,s!==a&&(null!==a&&t.value?this.viewModel.setValue(`${r}`,a):this.viewModel.setValue(`${r}`,null))}};return t.__decorate([s.property()],I.prototype,"activeFeatureIndex",null),t.__decorate([s.property()],I.prototype,"disabled",null),t.__decorate([s.property()],I.prototype,"_effectiveDisabled",null),t.__decorate([s.property()],I.prototype,"features",null),t.__decorate([s.property()],I.prototype,"map",null),t.__decorate([s.property()],I.prototype,"spatialReference",null),t.__decorate([s.property()],I.prototype,"timeZone",null),t.__decorate([s.property()],I.prototype,"headingLevel",void 0),t.__decorate([s.property()],I.prototype,"icon",null),t.__decorate([s.property(),S.messageBundle("esri/t9n/common")],I.prototype,"messagesCommon",void 0),t.__decorate([s.property(),S.messageBundle("esri/widgets/BatchAttributeForm/t9n/BatchAttributeForm")],I.prototype,"messages",void 0),t.__decorate([s.property(),S.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],I.prototype,"featureFormMessages",void 0),t.__decorate([s.property()],I.prototype,"readOnly",null),t.__decorate([s.property()],I.prototype,"valid",null),t.__decorate([s.property(),x.vmEvent(["value-change","submit"])],I.prototype,"viewModel",void 0),t.__decorate([s.property({type:f.VisibleElements,nonNullable:!0})],I.prototype,"visibleElements",void 0),t.__decorate([s.property()],I.prototype,"groupDisplay",void 0),I=t.__decorate([c.subclass("esri.widgets.BatchAttributeForm")],I),I})},"esri/widgets/BatchAttributeForm/batchAttributeFormUtils":function(){define(["exports","../../intl","../../core/compilerUtils","./ReactiveGraphic","../support/dateUtils","../support/forms/formUtils","../../intl/substitute"],function(e,t,r,i,o,n,s){"use strict";e.createReactiveGraphic=function(e){return new i.ReactiveGraphic({source:e})},e.getHiddenFieldsValidationErrorMessage=function(e,t,i){const o=i?.validationErrors;if(!o)return null;let n=null;for(const i of e.invalidHiddenInputs)switch(i.effectiveVisibilityCode){case"hidden:visibility-expression:all-features":case"hidden:group-visibility-expression:all-features":case"hidden:field-definition":return"single"===t?o.nonVisibleError_changeValues:o.nonVisibleError_checkIndividualFeatures;case"hidden:no-domain-in-common":case"hidden:visibility-expression:some-features":case"hidden:group-visibility-expression:some-features":case"hidden:not-in-all-layers":n=o.nonVisibleError_checkIndividualFeatures;break;case"visible":continue;default:r.neverReached(i.effectiveVisibilityCode)}return n},e.getVisibleFieldInputValidationErrorMessage=function(e,t,r,i){const{dataType:a,minLength:l}=e,c=r?.validationErrors;if(!c||!t)return null;if("batch-attribute-form-validation::features-have-different-errors"===t)return c.invalidBatchFormType;if("input-validation-error::cannot-be-empty"===t)return c.cannotBeNull;if("domain-validation-error::value-out-of-range"===t||"numeric-range-validation-error::out-of-range"===t){const{field:t,range:r}=e,l={type:"date",intlOptions:{timeZone:"date"===t.type&&i?i:void 0,...o.getIntlOptionsForField(t)}},p=n.getRangeErrorMessage(r,c);return s.substitute(p,r,{format:{max:"date"===a?l:null!=r.max&&n.shouldUseScientificNotation(r.max)?n.scientificNumberFormatOptions:n.numberFormatOptions,min:"date"===a?l:null!=r.min&&n.shouldUseScientificNotation(r.min)?n.scientificNumberFormatOptions:n.numberFormatOptions}})}return"domain-validation-error::invalid-coded-value"===t?c.invalidCodedValue:"type-validation-error::invalid-type"===t?c.invalidType:"length-validation-error::too-short"===t?s.substitute(c.tooShort,{min:l}):null},e.isElementTemplateWithInputType=(e,t)=>null!=e&&e.input?.type===t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/ReactiveGraphic":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/proxy","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../support/forms/formUtils"],function(e,t,r,i,o,n,s,a,l,c){"use strict";e.ReactiveGraphic=class extends r{constructor(e){super(e),this.userChangesHaveMadeInvalid=!1,this.original=e.source.clone();const t=e.source.attributes??{},r=i.createObservableProxy({...t});this.attributes=r;const o=e.source.cloneShallow();o.attributes=r,this.plainGraphic=o}get geometry(){return this.plainGraphic.geometry}set geometry(e){this.plainGraphic.geometry=e}get layer(){return this.source.sourceLayer??this.source.layer}attributeHasChanged(e){return!c.valuesAreEquivalent(this.attributes[e],this.original.attributes?.[e])}getAttribute(e){return this.attributes[e]??null}setAttribute(e,t){this.attributes[e]=t}},t.__decorate([o.property()],e.ReactiveGraphic.prototype,"attributes",void 0),t.__decorate([o.property()],e.ReactiveGraphic.prototype,"geometry",null),t.__decorate([o.property()],e.ReactiveGraphic.prototype,"plainGraphic",void 0),t.__decorate([o.property()],e.ReactiveGraphic.prototype,"layer",null),t.__decorate([o.property({constructOnly:!0})],e.ReactiveGraphic.prototype,"original",void 0),t.__decorate([o.property({constructOnly:!0})],e.ReactiveGraphic.prototype,"source",void 0),t.__decorate([o.property()],e.ReactiveGraphic.prototype,"userChangesHaveMadeInvalid",void 0),e.ReactiveGraphic=t.__decorate([l.subclass("esri.widgets.BatchAttributeForm.ReactiveGraphic")],e.ReactiveGraphic),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/proxy":function(){define(["exports","./MapUtils","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t,r,i){"use strict";const o=new WeakMap;class n{constructor(){this._observables=new Map}get(e,o,n){const s=t.getOrCreateMapValue(this._observables,o,()=>new i.SimpleObservable);return r.trackAccess(s),Reflect.get(e,o)}set(e,t,r,i){return Reflect.set(e,t,r),this._observables.get(t)?.notify(),!0}}e.createObservableProxy=function(e){return!e||"object"!=typeof e||"__accessor__"in e?e:t.getOrCreateMapValue(o,e,()=>new Proxy(e,new n))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/forms/formUtils":function(){define(["exports","../../../form/support/formUtils","../../../layers/support/domainUtils","../../../layers/support/fieldUtils","../dateUtils"],function(e,t,r,i,o){"use strict";function n(e){return null==e||""===e}function s(e){return"number"==typeof e&&e>-1?e:-1}e.capabilitiesAllowEditType=(e,t)=>{if(!e)return!0;const{operations:r}=e;switch(t){case"INSERT":return r.supportsAdd;case"UPDATE":case"DELETE":return r.supportsUpdate;default:return!0}},e.dateIsValid=e=>e&&!Number.isNaN(e.valueOf()),e.ensureMinOrMaxLength=s,e.getMaxLength=function({dataType:e,field:r,input:i}){if("date"===e)return-1;const o=s(r.length);if(!i||!t.isTextInput(i))return o;const n=s(i.maxLength);return-1===n?o:-1===o?n:Math.min(o,n)},e.getMinLength=function({dataType:e,field:r,input:i}){if("date"===e)return-1;if(!i||!t.isTextInput(i))return-1;const o=s(i.minLength);if(o<0)return-1;const n=s(r.length);return n>-1&&n<o?-1:o},e.getRangeErrorMessage=function(e,t){return null!=e.max&&null!=e.min?t.outsideRange:null!=e.max?t.outsideRangeMax:t.outsideRangeMin},e.isEmptyValue=n,e.numberFormatOptions={type:"number"},e.scientificNumberFormatOptions={type:"number",intlOptions:{notation:"scientific"}},e.shouldUseScientificNotation=function(e){return e>=1e7||e<=-1e7},e.validateFormValue=function(e,t){const{dataType:n,domain:s,field:a,maxLength:l,minLength:c,range:p,required:d}=t;if(null==e)return d?"input-validation-error::cannot-be-empty":null;if("text"===n&&"string"==typeof e){if(c>-1&&e.length<c)return"length-validation-error::too-short";if(l>-1&&e.length>l)return"length-validation-error::too-long"}return"date"!==n||o.dateTimeIsInRange({type:a.type,range:p,value:e})?s?r.validateDomainValue(a,e,s):i.validateFieldValue(a,e)??r.validateDomainValue(a,e):"numeric-range-validation-error::out-of-range"},e.valuesAreEquivalent=function(e,t){return!(!n(e)||!n(t))||e===t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/dateUtils":function(){define(["exports","../../intl","../../core/has","../../core/Error","../../core/mathUtils","../../intl/date","../../support/dateUtils","../../support/guards","../../time/constants","../../chunks/datetime","../../intl/locale"],function(e,t,r,i,o,n,s,a,l,c,p){"use strict";const d=l.utc,u={date:null,time:null,timeZoneOffset:null},h=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),y="latn",m=new Set(["date-only","time-only","timestamp-offset"]),f=e=>"valueAsDate"in e;function g(e){return{locale:p.getLocale(),numberingSystem:y,zone:e??d}}function b(e,t){return null==e?null:c.DateTime.fromMillis(e,g(t))}function v(e,t){if(null==e||!a.isString(e)||""===e){if(t){const e=c.DateTime.local({zone:t});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return u}const r=c.DateTime.fromISO(e,{setZone:!0});return{date:r.toFormat(s.defaultDatePattern,g()),time:r.toFormat(s.TimeStampOffsetPattern.HMS_MS,g()),timeZoneOffset:r.offset.toString()}}function _(e,t){if(null==e?.value||Array.isArray(e.value))return null;let r=null;return r=f(e)?c.DateTime.fromFormat(e.value,s.defaultDatePattern,g(t)):s.timeOnlyToDateTime(e.value),r?.isValid?r:null}function w(e){const{max:t,min:r,value:i}=e;return!(isNaN(i)||null!=t&&i>t||null!=r&&i<r)}function S(e){const{max:t,min:r,value:i}=e;return null!=t&&null!=r?o.clamp(i,r,t):null!=t&&i>t?t:null!=r&&i<r?r:i}function x(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new i("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const r=t.split(":"),o=new Array(3);for(let e=0;e<3;e++){const t=r.at(e)??"";o[e]=t.padStart(2,"0")}return o.join(":")}e.arcadeDateToFieldValue=function(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return x(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}},e.clampValueToRange=S,e.createDateTimeFromFieldValue=b,e.dateFieldsWithStringFieldValue=m,e.dateTimeIsInRange=function(e){const{type:t,range:r,value:i}=e;if(null==i||!r||i===r.min||i===r.max)return!0;if("date"===t)return w({value:i,min:r.min,max:r.max});const{rawMax:o,rawMin:n}=r;let a=null,l=null,c=null;switch(t){case"date-only":a=s.dateOnlyToDateTime(o),l=s.dateOnlyToDateTime(n),c=s.dateOnlyToDateTime(i);break;case"time-only":a=s.timeOnlyToDateTime(o),l=s.timeOnlyToDateTime(n),c=s.timeOnlyToDateTime(i);break;case"timestamp-offset":a=s.timestampOffsetToDateTime(o),l=s.timestampOffsetToDateTime(n),c=s.timestampOffsetToDateTime(i)}return!c||w({value:c.valueOf(),min:l?.valueOf(),max:a?.valueOf()})},e.dateTimeToFieldValue=function(e){return e?.isValid?e.toMillis():null},e.getDefaultLocaleOptions=g,e.getISOFieldValueFromDateComponents=function(e){const{dateComponent:t,defaultTimeZone:r,timeComponent:i,timeZoneComponent:o,oldValue:n}=e;if(!t?.value)return null;const{year:a,month:p,day:d}=c.DateTime.fromFormat(t.value,s.defaultDatePattern),{hour:u,minute:h,second:y,millisecond:m}=_(i,l.utc)??c.DateTime.now(),f=v(n,r),g=""===o?.value?null:o?.value,b=g?parseInt(g,10):null!=f.timeZoneOffset?parseInt(f.timeZoneOffset,10):(new Date).getTimezoneOffset(),w=c.FixedOffsetZone.instance(b),S=c.DateTime.fromObject({year:a,month:p,day:d,hour:u,minute:h,second:y,millisecond:m},{zone:w});return S.isValid?S.toISO({includeOffset:!0}):null},e.getIntlOptionsForField=function(e){switch(e.type){case"date":default:return n.convertDateFormatToIntlOptions("short-date-short-time");case"date-only":return n.convertDateFormatToIntlOptions("short-date");case"time-only":return n.convertDateFormatToIntlOptions("short-time");case"timestamp-offset":return{...n.convertDateFormatToIntlOptions("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}},e.getLabelForDateFieldValue=function(e,t,r){if(!e||null==t)return null;switch(e.type){case"date":return n.formatDate(t,r);case"date-only":return n.formatDateOnly(t,r);case"time-only":return n.formatTimeOnly(t,r);case"timestamp-offset":return n.formatTimestamp(t,r);default:return null}},e.getLocalDateTimeFromComponent=_,e.getUnixFieldValueFromDateComponents=function(e){const{dateComponent:t,timeComponent:r,timeZone:i,max:o,min:n,oldValue:s}=e,a=_(t,i);let l=!!e.applyRange;if(!a)return null;let p=null;if(null!=r?.value){const e=_(r,i),t=Date.now(),n=null!=o&&o<t?o:t,s=c.DateTime.fromMillis(n,g(i)),l=a||s,{year:d,month:u,day:h}=l,{hour:y,minute:m,second:f,millisecond:b}=e||s;p=l.set({year:d,month:u,day:h,hour:y,minute:m,second:f,millisecond:b})}else{const e=b(S({value:s??Date.now(),max:o,min:n}),i),{year:t,month:r,day:c}=a,{hour:d,minute:u,second:h,millisecond:y}=e;l=!0,p=a.set({year:t,month:r,day:c,hour:d,minute:u,second:h,millisecond:y})}if(!p.isValid)return null;const d=p.toMillis();return l?S({value:d,max:o,min:n}):d},e.isArcadeDate=function(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e},e.isCalciteDateComponent=f,e.isInDST=function(e,t="system"){return c.DateTime.fromJSDate(e,{zone:t}).isInDST},e.normalizeTimeOnlyString=x,e.numberingSystem=y,e.prepareISOFieldValueForDateComponents=v,e.prepareUnixFieldValueForDateComponents=function(e,t){if(null==e||!a.isNumber(e)||isNaN(e))return u;const r=b(e,t);return r?{date:r.toFormat(s.defaultDatePattern,g(t)),time:r.toFormat(s.defaultTimePattern,g(t))}:u},e.timeResolutionToStepMap=h,e.valueIsInRange=w,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/BatchAttributeFormViewModel":function(){define(["../../chunks/tslib.es6","../../core/asyncUtils","../../core/Collection","../../core/Error","../../core/Evented","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/ReactiveMap","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles","../../geometry/SpatialReference","../../time/constants","./batchAttributeFormUtils","./expressions/ArcadeExecutorProvider","./expressions/ExpressionsManager","./expressions/ExpressionsModel","./inputs/BatchFormInputs","./inputs/support/createBatchFormInputs","./inputs/support/inputUtils","./templates/BatchFormTemplate","./templates/support/contingentValuesUtils","./templates/support/createBatchFormTemplate"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F){"use strict";let k=class extends o.EventedAccessor{constructor(e){super(e),this.activeFeatureIndex=-1,this.disabled=!1,this.editType="NA",this.features=new r,this._hasAsyncArcadeExpressions=!1,this.maximumFeatureCountWithComplexForms=50,this.maximumFeatureCount=2e3,this.map=null,this.readOnly=!1,this.spatialReference=null,this.submitHasBeenAttempted=!1,this.timeZone=null,this.userHasChangedValues=!1,this._arcadeExecutorProvider=new b.ArcadeExecutorProvider,this._activeFormInputsByElementId=new Map,this._emptyForm=new w({inputs:[]}),this._emptyFormTemplate=new M({elements:[]}),this._featureFormMap=new Map,this._prepareTask=null,this._reactiveGraphicLookup=new l,this._updatingHandles=new y.UpdatingHandles,this._layerTemplateMap=new l,this._layerContingentValuesMap=new l,this._workingFeatures=new r,this._expressionsManager=new v.ExpressionsManager({arcadeContext:{editType:"NA",spatialReference:null,map:null,timeZone:f.system}}),this.sharedForm=this._emptyForm,this.sharedFormTemplate=this._emptyFormTemplate}initialize(){this.addHandles([c.on(()=>this.features,"after-changes",()=>this._prepare(),{sync:!0}),c.watch(()=>[this.features,this.map,this.timeZone,this.editType],()=>this._prepare(),c.sync),c.watch(()=>this.activeForm,()=>this._activeFormInputsByElementId.clear(),c.sync)]),this._prepare()}destroy(){this._prepareTask=s.abortMaybe(this._prepareTask),this._workingFeatures.destroyAll(),this._expressionsManager&&this._expressionsManager.abort(),this._reactiveGraphicLookup=new l,this._emptyForm.destroy(),this._emptyFormTemplate.destroy()}get _effectiveTimeZone(){return this.timeZone??"system"}get activeFeature(){const e=this.activeFeatureIndex;return e<0?null:this.features.at(e)}get activeForm(){if("batch"===this.mode)return this.sharedForm;const e=this._workingFeatures.at(this.activeFeatureIndex);if(!e)return this._emptyForm;const t=this._featureFormMap.get(e);if(t)return t;const r=this._makeBatchFormInputsForFeature(e);return r!==this._emptyForm&&this._featureFormMap.set(e,r),r}get calculating(){return this._expressionsManager.calculating}get expressionEvaluationFailed(){return this._expressionsManager.expressionEvaluationFailed}get hasNonActiveInvalidFeatures(){if("batch"===this.mode)return!1;const{activeFeature:e}=this;return this.invalidFeatures.some(t=>t!==e)}get hasAsyncArcadeExpressions(){return this._hasAsyncArcadeExpressions}get hasTooManyFeatures(){return this._workingFeatures.length>this.maximumFeatureCount}get hasTooManyComplexFeatures(){return this._workingFeatures.length>this.maximumFeatureCountWithComplexForms&&this.hasAsyncArcadeExpressions}get invalidFeatures(){return this.sharedForm.invalidFeatures}get hasVisibleInputs(){return this.visibleInputs.length>0}get hasLayersWithContingentValues(){for(const e of this.layers){const t=this._layerContingentValuesMap.get(e);if(t&&t.size>0)return!0}return!1}get visibleInputs(){return this.activeForm.inputs.filter(e=>e.visible)}get noVisibleElementsReason(){if(this.hasVisibleInputs)return null;if(0===this.activeForm.inputs.length)return"noElements";const e=new Set;for(const t of this.activeForm.inputs)switch(t.visibilityCode){case"hidden:not-in-all-layers":case"hidden:no-domain-in-common":e.add("noElementsInCommon");break;case"hidden:field-definition":case"hidden:group-visibility-expression:all-features":case"hidden:visibility-expression:all-features":e.add("allElementsHidden");break;case"hidden:group-visibility-expression:some-features":case"hidden:visibility-expression:some-features":return"elementsHiddenInSome"}return e.has("allElementsHidden")?"allElementsHidden":"noElementsInCommon"}get status(){const e=this._prepareTask;return null==e?"not-loaded":e.finished?null!=e.error?"failed":"loaded":"loading"}get submittable(){return this.valid,!0}get updating(){return this._updatingHandles.updating||this.calculating}get valid(){return this.sharedForm.valid}get layers(){const e=new Set;return this.features.forEach(t=>{const r=t.sourceLayer??t.layer;e.add(r)}),Array.from(e)}get mode(){return this.activeFeatureIndex>-1?"single":"batch"}submit(){this.submitHasBeenAttempted=!0,this.emit("submit",{name:"submit",results:this._makeSubmitResults(),valid:this.valid})}findFieldInput(e){if(null==e)return;const t=this._activeFormInputsByElementId;if(t.has(e))return t.get(e);const r=this.activeForm.allFieldInputs.find(t=>t.template.elementId===e);return void 0!==r?(t.set(e,r),r):void 0}getFirstVisibleInvalidFieldInput(){if(this.hasVisibleInputs&&!this.activeForm.valid)for(const e of this.visibleInputs){if(x.isGroupInput(e)){const t=e.inputs.find(e=>!e.valid);if(t)return{input:t,groupInput:e}}if(x.isFieldInput(e)&&!e.valid)return{input:e}}}getFieldInputValue(e){return this.findFieldInput(e)?.value}getValues(e){const t=this._reactiveGraphicLookup.get(e);if(!t)throw new i("feature-not-found","The given feature is not present in the BatchAttributeForm");return{...t.attributes}}notifyGeometriesChanged(e){const t=[];for(const r of e){const e=this._reactiveGraphicLookup.get(r);e&&(t.push(e),e.geometry=r.geometry)}this._expressionsManager.runGeometryDependentExpressions(t)}async setFieldInputValue(e,t){const r=new Set(this.invalidFeatures);await e.setValueFromUser(t),this.userHasChangedValues=!0,this._trackValidityChange(r),this.emit("value-change",{features:e.features.toArray().map(e=>e.source),fieldName:e.fieldName,name:"value-change",value:t})}async setValue(e,t){const r=this.findFieldInput(e);if(null==r)throw new i("no-FieldInput-found",`Cannot set the value of FieldInput with ID: ${e} because none was found in the active form`);await this.setFieldInputValue(r,t)}userChangesHaveMadeFeatureInvalid(e){return!!this._reactiveGraphicLookup.get(e)?.userChangesHaveMadeInvalid}async _trackValidityChange(e){await c.whenOnce(()=>!1===this.calculating);const t=this.invalidFeatures;for(const r of t)!1===e.has(r)&&this._reactiveGraphicLookup.has(r)&&(this._reactiveGraphicLookup.get(r).userChangesHaveMadeInvalid=!0)}validate(){return!1}_makeBatchFormInputsForFeature(e){const t=this._layerTemplateMap.get(e.layer);return t?S.createBatchFormInputsFromBatchFormTemplate(t,new r([e]),this._expressionsManager):this._emptyForm}_makeSubmitResults(){const e=new Map;for(const[t,r]of this._reactiveGraphicLookup)e.set(t,{feature:t,values:{...r.attributes},invalidFields:[]});for(const t of this.sharedForm.allFieldInputs)for(const r of t.invalidFeatures)e.get(r)?.invalidFields.push(t.fieldName);return Array.from(e.values())}_prepare(){this._hasAsyncArcadeExpressions=!1,this._prepareTask=s.abortMaybe(this._prepareTask),this._updateWorkingFeatures(),s.abortMaybe(this._expressionsManager),this.userHasChangedValues=!1,this._expressionsManager=new v.ExpressionsManager({arcadeContext:{editType:this.editType,spatialReference:this.spatialReference??m.WebMercator,map:this.map,timeZone:this._effectiveTimeZone}});const{layers:e}=this;if(0===e.length)return;const r=t.createTask(async t=>{try{a.throwIfAborted(t);const r=new Map;for(const t of e){const e=await C.getLayerContingentValuesMetaData(t);if(e){const r=e.fieldGroups.flatMap(e=>e.fields);this._layerContingentValuesMap.set(t,new Set(r))}else this._layerContingentValuesMap.set(t,new Set);const i=await F.createBatchFormTemplate(t,{arcadeExecutorProvider:this._arcadeExecutorProvider,formTimeZone:this._effectiveTimeZone});this._layerTemplateMap.set(t,i);const o=i.getExpressionExecutorsForLayer(t);if(this._expressionsManager.layerExpressionsModelMap.set(t,new _.ExpressionsModel({preserveFieldValuesWhenHidden:i.preserveFieldValuesWhenHidden,executorMap:o})),!this._hasAsyncArcadeExpressions)for(const e of o.keys()){const t=o.get(e);if(this._hasAsyncArcadeExpressions=!0===(t.editableExpression?.isAsync||t.requiredExpression?.isAsync||t.valueExpression?.isAsync||t.visibilityExpression?.isAsync),this._hasAsyncArcadeExpressions)break}for(const e of i.elements){const{elementId:t}=e;r.has(t)?r.get(t).foldIn(e):r.set(t,e.clone())}}if(this.hasTooManyComplexFeatures)throw new i("too-many-features-with-complex-forms","There are too many features to load into the form with the configured complexity");if(this.hasTooManyFeatures)throw new i("too-many-features","There are too many features to load into the form.");const o=new M({elements:Array.from(r.values())});this.sharedFormTemplate=o,this.sharedForm=S.createBatchFormInputsFromBatchFormTemplate(o,this._workingFeatures,this._expressionsManager),await this._expressionsManager.runAllExpressions(this._workingFeatures.toArray())}catch(e){throw n.getLogger(this).error("Failed preparing form",e),e}});this._updatingHandles.addPromise(r.promise),this._prepareTask=r}_updateWorkingFeatures(){this._workingFeatures.destroyAll();const{features:e}=this;if(this._reactiveGraphicLookup=new l,0!==e.length){this._workingFeatures.addMany(e.map(g.createReactiveGraphic));for(const e of this._workingFeatures)this._reactiveGraphicLookup.set(e.source,e)}}};return e.__decorate([p.property()],k.prototype,"_effectiveTimeZone",null),e.__decorate([p.property({readOnly:!0})],k.prototype,"activeFeature",null),e.__decorate([p.property()],k.prototype,"activeFeatureIndex",void 0),e.__decorate([p.property({readOnly:!0})],k.prototype,"activeForm",null),e.__decorate([p.property()],k.prototype,"disabled",void 0),e.__decorate([p.property()],k.prototype,"calculating",null),e.__decorate([p.property()],k.prototype,"editType",void 0),e.__decorate([p.property()],k.prototype,"features",void 0),e.__decorate([p.property()],k.prototype,"expressionEvaluationFailed",null),e.__decorate([p.property()],k.prototype,"hasNonActiveInvalidFeatures",null),e.__decorate([p.property()],k.prototype,"hasAsyncArcadeExpressions",null),e.__decorate([p.property()],k.prototype,"_hasAsyncArcadeExpressions",void 0),e.__decorate([p.property()],k.prototype,"invalidFeatures",null),e.__decorate([p.property()],k.prototype,"hasVisibleInputs",null),e.__decorate([p.property()],k.prototype,"hasLayersWithContingentValues",null),e.__decorate([p.property()],k.prototype,"maximumFeatureCountWithComplexForms",void 0),e.__decorate([p.property()],k.prototype,"maximumFeatureCount",void 0),e.__decorate([p.property()],k.prototype,"visibleInputs",null),e.__decorate([p.property()],k.prototype,"map",void 0),e.__decorate([p.property()],k.prototype,"noVisibleElementsReason",null),e.__decorate([p.property()],k.prototype,"readOnly",void 0),e.__decorate([p.property()],k.prototype,"spatialReference",void 0),e.__decorate([p.property()],k.prototype,"submitHasBeenAttempted",void 0),e.__decorate([p.property()],k.prototype,"timeZone",void 0),e.__decorate([p.property()],k.prototype,"updating",null),e.__decorate([p.property()],k.prototype,"valid",null),e.__decorate([p.property()],k.prototype,"layers",null),e.__decorate([p.property()],k.prototype,"mode",null),e.__decorate([p.property()],k.prototype,"sharedForm",void 0),e.__decorate([p.property()],k.prototype,"sharedFormTemplate",void 0),e.__decorate([p.property()],k.prototype,"userHasChangedValues",void 0),e.__decorate([p.property()],k.prototype,"_arcadeExecutorProvider",void 0),e.__decorate([p.property()],k.prototype,"_prepareTask",void 0),e.__decorate([p.property()],k.prototype,"_reactiveGraphicLookup",void 0),e.__decorate([p.property()],k.prototype,"_layerTemplateMap",void 0),e.__decorate([p.property()],k.prototype,"_layerContingentValuesMap",void 0),e.__decorate([p.property()],k.prototype,"_workingFeatures",void 0),e.__decorate([p.property()],k.prototype,"_expressionsManager",void 0),k=e.__decorate([h.subclass("esri.widgets.BatchAttributeForm.BatchAttributeFormViewModel")],k),k})},"esri/widgets/BatchAttributeForm/expressions/ArcadeExecutorProvider":function(){define(["exports","../../../arcade"],function(e,t){"use strict";const r=t.createArcadeProfile("form-calculation");e.ArcadeExecutorProvider=class{constructor(){this._executors=new Map,this._executorPromises=new Map}async getArcadeExecutor(e){return this._executors.has(e)?this._executors.get(e):this._executorPromises.has(e)?this._executorPromises.get(e):this._createExecutor(e)}async _createExecutor(e){try{const i=t.createArcadeExecutor(e,r);this._executorPromises.set(e,i);const o=await i;return this._executors.set(e,o),o}finally{this._executorPromises.delete(e)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/arcade":function(){define(["exports","./Graphic","./arcade/ArcadeDate","./arcade/arcadeEnvironment","./arcade/ImmutableArray","./core/has","./core/deprecate","./core/Error","./core/lang","./core/Logger","./core/sql/DateOnly","./core/sql/TimeOnly","./layers/FeatureLayer","./portal/Portal","./rest/support/FeatureSet","./support/loadArcade"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m){"use strict";let f=null;function g(e,t,r,i={}){const n=t.elementType,s="value",a="array"===n.type?[{name:s,type:n.type,elementType:n.elementType}]:"dictionary"===n.type?[{name:s,type:n.type,properties:n.properties}]:[{name:s,type:n.type}];return new o(e.map(e=>{const t={};return w(t,a,{[s]:e},r,i),t[s]}))}function b(e,t,r={}){const i=e instanceof y?new u({source:e.features,geometryType:e.geometryType,fields:e.fields,spatialReference:e.spatialReference}):e;return t.constructFeatureSet(i,r.spatialReference,null,!0,r.lruCache,r.interceptor)}function v(e,t,r={}){const{spatialReference:i,interceptor:o,lruCache:n}=r;return"string"==typeof e?t.createFeatureSetCollectionFromService(e,i,n,o):t.createFeatureSetCollectionFromMap(e,i,n,o)}function _(e,t,r,i={}){const o=Object.create(null);return w(o,t.properties,e,r,i),new f.Dictionary(o)}function w(e,t,i,o,n={}){const s={};for(const e of Object.keys(i))s[e.toLowerCase()]=i[e];for(const i of t){const t=i.name.toLowerCase();if(n.variablesPreProcessed)e[t]=s[t];else switch(i.type){case"array":{const r=s[t];e[t]=null==r?null:g(r,i,o,n);break}case"feature":{const r=s[t];e[t]=null==r?null:f.Feature.createFromGraphic(r,n?.timeZone);break}case"featureSet":{const r=s[t];e[t]=null==r?null:o?b(r,o,n):null;break}case"featureSetCollection":{const r=s[t];e[t]=null==r?null:o?v(r,o,n):null;break}case"dictionary":{const r=s[t];e[t]=null==r?null:_(r,i,o,n);break}case"date":{const i=s[t];i?i instanceof r.ArcadeDate?e[t]=i:e[t]=n?.timeZone?r.ArcadeDate.dateJSAndZoneToArcadeDate(i,n?.timeZone):r.ArcadeDate.dateJSToArcadeDate(i):e[t]=null;break}case"dateOnly":{const r=s[t];r?r instanceof p.DateOnly?e[t]=r:e[t]=p.DateOnly.fromReader(r):e[t]=null;break}case"time":{const r=s[t];r?r instanceof d.TimeOnly?e[t]=r:e[t]=d.TimeOnly.fromReader(r):e[t]=null;break}case"knowledgeGraph":case"geometry":case"boolean":case"text":case"number":e[t]=s[t];break;case"voxel":{const r=s[t];e[t]=null==r?null:new f.Voxel(r,n?.timeZone);break}}}}function S(e,t){for(const r of e)t.push(r),"dictionary"===r.type&&S(r.properties,t);return t}function x(e,t,r,i,o){const{spatialReference:n,interceptor:s,lruCache:a,console:l,abortSignal:c,timeZone:p,services:d={portal:h.getDefault()},track:u}=r,y={vars:{},spatialReference:n,interceptor:s,timeZone:p,lrucache:a,useAsync:o,services:d,console:l,abortSignal:c,track:u};return t?(w(y.vars,e.variables,t,i,r),y):y}function M(e,r){switch(r.getArcadeType(e)){case"number":case"text":case"boolean":case"point":case"polygon":case"polyline":case"multipoint":case"extent":return e;case"date":return e.toJSDate();case"time":case"dateOnly":return e.toString();case"feature":{const r=(e.type,e),i="geometry"in r?r.geometry():null,o="readAttributes"in r?r.readAttributes():r.attributes;return new t({geometry:i,attributes:o})}case"dictionary":{const t=e,i=t.attributes,o={};for(const e of Object.keys(i))o[e]=M(t.field(e),r);return o}case"array":return("toArray"in e?e.toArray():e).map(e=>M(e,r))}return e}const C={variables:[{name:"$feature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$userInput",type:"geometry"},{name:"$graph",type:"knowledgeGraph"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]},F={variables:[{name:"$feature",type:"feature"},{name:"$aggregatedFeatures",type:"featureSet"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]},k={variables:[{name:"$voxel",type:"voxel"}]},I=new Map([["aggregate-field",{variables:[{name:"$feature",type:"feature"}]}],["form-constraint",{variables:[{name:"$feature",type:"feature"}]}],["feature-z",{variables:[{name:"$feature",type:"feature"}]}],["field-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$datastore",type:"featureSetCollection"}]}],["form-calculation",{variables:[{name:"$feature",type:"feature"},{name:"$originalFeature",type:"feature"},{name:"$layer",type:"featureSet"},{name:"$featureSet",type:"featureSet"},{name:"$datastore",type:"featureSetCollection"},{name:"$map",type:"featureSetCollection"},{name:"$editContext",type:"dictionary",properties:[{name:"editType",type:"text"}]}]}],["labeling",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]}],["popup",C],["popup-element",C],["popup-feature-reduction",F],["popup-element-feature-reduction",F],["visualization",{variables:[{name:"$feature",type:"feature"},{name:"$view",type:"dictionary",properties:[{name:"scale",type:"number"},{name:"timeProperties",type:"dictionary",properties:[{name:"currentStart",type:"date"},{name:"currentEnd",type:"date"},{name:"startIncluded",type:"boolean"},{name:"endIncluded",type:"boolean"}]}]}]}],["popup-voxel",k],["popup-element-voxel",k]]);e.createArcadeExecutor=async function(e,t,r={}){f||(f=await m.loadArcade());const{arcade:o,arcadeUtils:n,batchExec:{createBatchExecutor:s},aiServices:{BatchTranslationServiceFactory:l,PortalTranslationService:c}}=f,{loadScriptDependencies:p,referencesMember:d,scriptIsAsync:u}=o,y=S(t.variables,[]).filter(e=>"featureSet"===e.type||"featureSetCollection"===e.type).map(e=>i.toSymbolId(e.name)),g=o.parseScript(e,y);if(!g)throw new a("arcade:invalid-script","Unable to create SyntaxTree");const b=n.extractFieldNames(g),v=o.scriptTouchesGeometry(g),_=t.variables.map(e=>i.toSymbolId(e.name)).filter(e=>d(g,e)),w=u(g,y);await p(g,w,y);const C=o.compileScript(g,{vars:Object.fromEntries(_.map(e=>[e,!0])),useAsync:w}),{lruCache:F,services:k}=r,I=o.featureSetUtils();return{execute:(e,r={})=>{if(w)throw new a("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");const i={...k,...r.services},o={lruCache:F,...r,services:i},s=C(x(t,e,o,I,w));return r.rawOutput?s:M(s,n)},executeAsync:async(e,r={})=>{const i={...k,...r.services},o={lruCache:F,...r,services:i},s=await C(x(t,e,o,I,w));return r.rawOutput?s:M(s,n)},executeAsyncBatch:async(e,r,i={})=>{const o=[],a=s(e,async(e,s)=>{const a=r(e);try{const e={...p,translation:d.create(s)},r={lruCache:F,...i,services:e},l=await C(x(t,a,r,I,w)),c=i.rawOutput?l:M(l,n);o.push({id:s.id,result:{status:"fulfilled",value:c}})}catch(e){throw o.push({id:s.id,result:{status:"rejected",reason:e}}),e}},i.maxConcurrency??64,i.abortSignal),p={...k,...i.services},d=new l(a,p.translation??new c(p.portal??h.getDefault(),i.console));return await a.run(),o.sort(({id:e},{id:t})=>e-t).map(({result:e})=>e)},isAsync:w,variablesUsed:_,fieldsUsed:b,geometryUsed:v,syntaxTree:g}},e.createArcadeProfile=function(e){"feature-reduction-popup"===e?(s.deprecated(c.getLogger("esri.arcade"),'profile name: "feature-reduction-popup"',{replacement:'"popup-feature-reduction"',version:"4.32",warnOnce:!0}),e="popup-feature-reduction"):"feature-reduction-popup-element"===e&&(s.deprecated(c.getLogger("esri.arcade"),'profile name: "feature-reduction-popup-element"',{replacement:'"popup-element-feature-reduction"',version:"4.32",warnOnce:!0}),e="popup-element-feature-reduction");const t=I.get(e);if(!t){const t=Array.from(I.keys()).map(e=>`'${e}'`).join(", ");throw new a("createArcadeProfile:invalid-profile-name",`Invalid profile name '${e}'. You must specify one of the following values: ${t}`)}return l.clone(t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/arcadeEnvironment":function(){define(["exports","./executionError"],function(e,t){"use strict";const r=Object.freeze({aborted:!1});e.neverAbortedSignal=r,e.toSymbolId=function(e){if("string"==typeof e)return e.toLowerCase();if("name"in e)return e.name.toLowerCase();if("string"!=typeof e.value)throw new t.ArcadeExecutionError(null,"InvalidIdentifier",null);return e.value.toLowerCase()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/ImmutableArray":function(){define(function(){"use strict";return class{constructor(e=[]){this._elements=e}length(){return this._elements.length}get(e){return this._elements[e]}toArray(){return this.slice()}slice(e=0,t=this.length()){const r=[];for(let i=e;i<t;i++)r.push(this.get(i));return r}}})},"esri/widgets/BatchAttributeForm/expressions/ExpressionsManager":function(){define(["require","exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Error","../../../core/Logger","../../../core/MapUtils","../../../core/promiseUtils","../../../core/ReactiveMap","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../core/sql/DateOnly","../../../core/sql/TimeOnly","../inputs/support/inputUtils","../templates/support/templateUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f){"use strict";let g=null;t.ExpressionsManager=class extends i{constructor(e){super(e),this.calculating=!1,this.arcadeContext=null,this._abortController=new AbortController,this.layerExpressionsModelMap=new Map,this.evaluatedExpressions=new l,this.expressionEvaluationFailed=!1}abort(){this._abortController.abort()}async runAllExpressions(e,t=!1){return this._evaluateSpecifiedComponentsForEachFeature(e,_,t)}async runGeometryDependentExpressions(e,t=!1){return this._evaluateSpecifiedComponentsForEachFeature(e,w,t)}async valueChanged(e,t,r=!0){try{this.calculating=!0;const i=t.map(t=>this.evaluateValueChangedForFeature(e,t,r));await Promise.all(i)}catch(e){n.getLogger(this).error(e),this.expressionEvaluationFailed=!0}finally{this.calculating=!1}}async evaluateValueChangedForFeature(e,t,r){if(this._abortController.signal.aborted)return;const i=this.layerExpressionsModelMap.get(t.layer);if(!i||0===i.components.length)return;const o=new Set,n=new Set([e]),s=new Set;for(;n.size>0;){const[e]=n;if(n.delete(e),o.has(e))continue;o.add(e);const a=i.fieldReferencesMap.get(e.toLowerCase());if(!a)continue;for(const e of a)s.has(e)&&a.delete(e);if(0===a.size)continue;const l=new Set;await this.evaluateAffectedComponents([...a],t,i,r,l);for(const e of a)s.add(e);for(const e of l)o.has(e)||n.add(e)}}async evaluateAffectedComponents(e,t,r,i,o){const n=new Map;for(const i of e)n.has(i)||n.set(i,this.createSccEvaluator(i,t,n,r));if(0===n.size)return;const s=[...n.values()].map(e=>e.evaluate(i,o));await Promise.all(s)}createSccEvaluator(e,t,r,i){const o=new b(e,t,this.arcadeContext,i,this.evaluatedExpressions,this._abortController);for(const n of e.adjacencyList)o.dependentEvaluators.push(s.getOrCreateMapValue(r,n,()=>this.createSccEvaluator(n,t,r,i)));return o}async _evaluateSpecifiedComponentsForEachFeature(e,t,r=!1){this.calculating=!0;try{const i=[];for(const o of e){const e=this.layerExpressionsModelMap.get(o.layer);if(!e||0===e.components.length)continue;const n=new Set;i.push(this.evaluateAffectedComponents(t(e),o,e,r,n))}await a.whenOrAbort(Promise.all(i),this._abortController)}catch(e){n.getLogger(this).error(e),this.expressionEvaluationFailed=!0}finally{this.calculating=!1}}},r.__decorate([c.property()],t.ExpressionsManager.prototype,"calculating",void 0),r.__decorate([c.property({constructOnly:!0})],t.ExpressionsManager.prototype,"arcadeContext",void 0),r.__decorate([c.property()],t.ExpressionsManager.prototype,"_abortController",void 0),r.__decorate([c.property()],t.ExpressionsManager.prototype,"layerExpressionsModelMap",void 0),r.__decorate([c.property()],t.ExpressionsManager.prototype,"evaluatedExpressions",void 0),r.__decorate([c.property()],t.ExpressionsManager.prototype,"expressionEvaluationFailed",void 0),t.ExpressionsManager=r.__decorate([u.subclass("esri.widgets.BatchAttributeForm.expressions.ExpressionsManager")],t.ExpressionsManager);class b{constructor(e,t,r,i,o,n){this.scc=e,this.feature=t,this.arcadeContextInfo=r,this.expressionsModel=i,this.evaluatedExpressions=o,this._abortController=n,this.dependentEvaluators=[],this._evaluatorPromise=null}get baseContext(){const{editType:e,map:t,spatialReference:r,timeZone:i}=this.arcadeContextInfo,o=this.feature.layer,n="scene"===o?.type&&null!=o.associatedLayer?o.associatedLayer:o;return{variables:{$originalfeature:this.feature.original,$editcontext:{editType:e},$layer:n,$featureset:n,$datastore:n?.url,$feature:this.feature.plainGraphic,$map:t},executeContext:{rawOutput:!0,spatialReference:r??void 0,timeZone:i,abortSignal:this._abortController.signal}}}evaluate(e,t){return null==this._evaluatorPromise&&(this._evaluatorPromise=this._evaluate(e,t)),this._evaluatorPromise}async _evaluate(t,r){null===g&&(g=await new Promise((t,r)=>e(["../../../arcade/languageUtils"],t,r)));const i=this.dependentEvaluators.map(e=>e.evaluate(t,r));await a.whenOrAbort(Promise.all(i),this._abortController);for(const e of this.scc.executors){const i=this.baseContext;if(this._abortController.signal.aborted)break;const n=this.expressionsModel.arcadeExecutorUses.get(e)??[],a=s.getOrCreateMapValue(this.evaluatedExpressions,this.feature,()=>new l);let c=null,p=null;try{c=e.isAsync?await e.executeAsync(i.variables,i.executeContext):e.execute(i.variables,i.executeContext),p={result:c,status:"success"}}catch(e){p={error:e,status:"error"}}for(const e of n){const i=this.expressionsModel.elementTemplateMap.get(e.elementId);switch(e.executorPurpose){case"editable":case"required":a.set(m.makeUseId(e.elementId,e.executorPurpose),p);break;case"value":{if("error"===p?.status)continue;const e=i.getExpressionExecutorsForLayer(this.feature.layer);let t=!0;if(e?.editableExpression&&(t=!1===a.get(m.makeUseId(i.elementId,"editable"))?.result),t){const e=this.feature.getAttribute(i.fieldName)??null,t=v(p.result,this.feature,i.fieldName,this.arcadeContextInfo.timeZone);t!==e&&(this.feature.setAttribute(i.fieldName,t),r.add(i.fieldName))}}break;case"visibility":if(a.set(m.makeUseId(e.elementId,e.executorPurpose),p),!this.expressionsModel.preserveFieldValuesWhenHidden&&!1===p.result&&t)if(f.isGroupElementTemplate(i))for(const e of i.elements)f.isFieldElementTemplate(e)&&(null!==this.feature.getAttribute(e.fieldName)&&r.add(e.fieldName),this.feature.setAttribute(e.fieldName,null));else f.isFieldElementTemplate(i)&&(null!==this.feature.getAttribute(i.fieldName)&&r.add(i.fieldName),this.feature.setAttribute(i.fieldName,null))}}if("error"===p?.status){const e=new Set;for(const t of n){const r=this.expressionsModel.elementTemplateMap.get(t.elementId);if(r)switch(t.executorPurpose){case"editable":e.add(r.label+" - Editable expression");break;case"required":e.add(r.label+" - Required expression");break;case"value":e.add(r.label+" - Value expression");break;case"visibility":e.add(r.label+" - Visibility expression")}}if(e.size>0)throw new o("expression-evaluation-failed","Arcade evaluation failed ("+[...e].join(",")+")");throw new o("expression-evaluation-failed","Arcade evaluation failed ")}}}}function v(e,t,r,i){if(null===e)return null;const n=t.layer.fieldsIndex.get(r);if(!n)throw new o("field-not-found","Unable set field value as the field cannot be found. ("+r+")");switch(n.type){case"big-integer":case"integer":case"long":case"oid":case"small-integer":case"single":case"double":return g.toNumber(e);case"global-id":case"guid":case"string":return g.toString(e);case"date":{if(g.isDate(e))return e.getTime();const t=g.toDate(e,i);if(!t)throw new o("unsupported-value-type","Arcade return type is not a supported field type. ("+r+")");return t.getTime()}case"date-only":{if(g.isDateOnly(e))return e.toStorageFormat();if(g.isDate(e))return h.DateOnly.fromDateTime(e.toDateTime()).toStorageFormat();const t=h.DateOnly.fromString(g.toString(e));if(!t)throw new o("unsupported-value-type","Arcade return type is not a supported field type.");return t.toStorageFormat()}case"time-only":{if(g.isTime(e))return e.toStorageString();if(g.isDate(e))return y.TimeOnly.fromDateTime(e.toDateTime()).toStorageString();const t=y.TimeOnly.fromString(g.toString(e));if(!t)throw new o("unsupported-value-type","Arcade return type is not a supported field type.");return t.toStorageString()}case"timestamp-offset":{if(g.isDate(e))return e.toISOString(!1);const t=g.toDate(e,i);if(!t)throw new o("unsupported-value-type","Arcade return type is not a supported field type. ("+r+")");return t.toISOString(!1)}}throw new o("unsupported-value-type","Arcade return type is not a supported field type. ("+r+")")}function _(e){return e.components}function w(e){return Array.from(e.geometryReferences)}Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/inputs/support/inputUtils":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?.type===t}e.differentValuesString="esri_BatchAttributeForm_different_values",e.isFieldInput=function(e){return"field"===e.type},e.isFieldInputWithShowNoValueOptionInput=e=>null!=e&&(t(e,"combo-box")||t(e,"radio-buttons")),e.isGroupInput=function(e){return"group"===e.type},e.isInputWithInputType=t,e.makeUseId=function(e,t){return`${e}:${t}`},e.visibilityCodeToBoolean=function(e){return"visible"===e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/templates/support/templateUtils":function(){define(["exports"],function(e){"use strict";e.isFieldElementTemplate=function(e){return"field"===e.type},e.isGroupElementTemplate=function(e){return"group"===e.type},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/expressions/ExpressionsModel":function(){define(["exports","../../../core/arrayUtils","../../../core/MapUtils","../../../core/Queue","../../../core/SetUtils","../templates/support/templateUtils"],function(e,t,r,i,o,n){"use strict";let s=0;function a(e,t){e.index=e.lowlink=t.nextIndex++,t.nodeStack.push(e);for(const r of l(e,t))-1===r.index?(a(r,t),e.lowlink=Math.min(e.lowlink,r.lowlink)):r.index<e.index&&t.nodeStack.contains(r)&&(e.lowlink=Math.min(e.lowlink,r.index)),t.nodeStack.contains(r)||e.crossLinkNeighbors.add(r);if(e.lowlink===e.index){const r=function(){s++;const e=s.toString();return{executors:new Set,adjacencyList:new Set,componentId:e}}();for(t.components.push(r);u(t.nodeStack)>=e.index;){const e=t.nodeStack.pop();if(null!=e){e.component=r,r.executors.add(e.executor);for(const t of e.crossLinkNeighbors)null!=t.component&&r.adjacencyList.add(t.component)}}}}function l({executor:e},i){const n=new Set;for(const t of e.fieldsUsed){const s=t.toLowerCase();r.getOrCreateMapValue(i.fieldReferencesMap,s,()=>new Set).add(e),o.addMany(n,c(s,i))}e.geometryUsed&&i.geometryReferences.add(e);const s=i.arcadeExecutorUses.get(e)?.filter(e=>"value"===e.executorPurpose)??[];for(const t of s){const r=i.executorMap.get(i.elementTemplatesById.get(t.elementId));r?.editableExpression&&r.editableExpression!==e&&n.add(r.editableExpression)}return Array.from(n).map(e=>i.nodeInfoMap.get(e)).filter(t.isSome)}function c(e,{executorMap:r,fieldElementTemplateMap:i,shouldConsiderVisibility:o}){const n=[],s=i.get(e);if(null==s)return n;const a=r.get(s);if(null==a)return n;if(t.pushIfSome(n,a.editableExpression),t.pushIfSome(n,a.valueExpression),o){t.pushIfSome(n,a?.visibilityExpression);const{group:e}=s;if(null!=e){const i=r.get(e)?.visibilityExpression;t.pushIfSome(n,i)}}return n}function p(e){const t=new Map;for(const r of e.keys())n.isFieldElementTemplate(r)&&t.set(r.fieldName.toLowerCase(),r);return t}function d(e,t){const r=new Set;for(const i of e){const e=t.get(i);e?.component&&r.add(e.component)}return r}function u(e){return e.peek()?.index??-1}e.ExpressionsModel=class{constructor(e){this.arcadeExecutorUses=new Map,this.components=[],this.preserveFieldValuesWhenHidden=!1,this.executorMap=e.executorMap,this.preserveFieldValuesWhenHidden=!0===e.preserveFieldValuesWhenHidden,this.elementTemplateMap=new Map;for(const e of this.executorMap.keys())this.elementTemplateMap.set(e.elementId,e);this._buildDependencyGraph()}_buildDependencyGraph(){const e=function(e){const r=Array.from(e.values()).filter(t.isSome),i=new Set(r.flatMap(e=>Array.from(Object.values(e)))),o=Array.from(i).map(e=>({component:null,crossLinkNeighbors:new Set,executor:e,index:-1,lowlink:-1,onStack:!1}));return new Map(o.map(e=>[e.executor,e]))}(this.executorMap),n={components:[],arcadeExecutorUses:this.arcadeExecutorUses,elementTemplatesById:new Map([...this.executorMap.keys()].map(e=>[e.elementId,e])),executorMap:this.executorMap,fieldElementTemplateMap:p(this.executorMap),fieldReferencesMap:new Map,geometryReferences:new Set,nextIndex:0,nodeInfoMap:e,nodeStack:new i(o.last),shouldConsiderVisibility:!this.preserveFieldValuesWhenHidden};for(const e of this.executorMap.keys()){const t=this.executorMap.get(e);t.editableExpression&&r.getOrCreateMapValue(this.arcadeExecutorUses,t.editableExpression,()=>[]).push({elementId:e.elementId,executorPurpose:"editable"}),t.valueExpression&&r.getOrCreateMapValue(this.arcadeExecutorUses,t.valueExpression,()=>[]).push({elementId:e.elementId,executorPurpose:"value"}),t?.visibilityExpression&&r.getOrCreateMapValue(this.arcadeExecutorUses,t.visibilityExpression,()=>[]).push({elementId:e.elementId,executorPurpose:"visibility"}),t?.requiredExpression&&r.getOrCreateMapValue(this.arcadeExecutorUses,t.requiredExpression,()=>[]).push({elementId:e.elementId,executorPurpose:"required"})}for(const e of this.arcadeExecutorUses.values())e.sort(e=>"editable"===e.executorPurpose?-1:1);for(const t of e.values())-1===t.index&&a(t,n);this.dependencyGraphComponents=function(e){return new Map([...e.values()].map(({component:e,executor:t})=>[t,e]))}(n.nodeInfoMap),this.fieldReferencesMap=function({fieldReferencesMap:e,nodeInfoMap:t}){const r=new Map;for(const[i,o]of e.entries())r.set(i,d(o,t));return r}(n),this.geometryReferences=function({geometryReferences:e,nodeInfoMap:t}){return d(e,t)}(n),this.components=n.components}},e.getDirectDependencies=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/inputs/BatchFormInputs":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./support/inputUtils"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends t{constructor(e){super(e),this.inputs=[],this.template=null}get allFieldInputs(){const e=[];for(const t of this.inputs)a.isFieldInput(t)?e.push(t):a.isGroupInput(t)&&e.push(...t.inputs.filter(a.isFieldInput));return e}get description(){return this.template?.description??null}get hasInvalidHiddenInputs(){return this.invalidHiddenInputs.length>0}get invalidFeatures(){return Array.from(new Set(this.allFieldInputs.flatMap(e=>e.invalidFeatures)))}get invalidHiddenInputs(){return this.allFieldInputs.filter(e=>!e.valid&&!e.effectiveVisible)}get title(){return this.template?.title??null}get valid(){return this.allFieldInputs.every(e=>e.valid)}};return e.__decorate([r.property()],l.prototype,"allFieldInputs",null),e.__decorate([r.property()],l.prototype,"description",null),e.__decorate([r.property()],l.prototype,"inputs",void 0),e.__decorate([r.property()],l.prototype,"hasInvalidHiddenInputs",null),e.__decorate([r.property()],l.prototype,"invalidFeatures",null),e.__decorate([r.property()],l.prototype,"invalidHiddenInputs",null),e.__decorate([r.property()],l.prototype,"template",void 0),e.__decorate([r.property()],l.prototype,"title",null),e.__decorate([r.property()],l.prototype,"valid",null),l=e.__decorate([s.subclass("esri.widgets.BatchAttributeForm.inputs.BatchFormInputs")],l),l})},"esri/widgets/BatchAttributeForm/inputs/support/createBatchFormInputs":function(){define(["exports","../../../../core/Error","../BatchFormInputs","../FieldInput","../GroupInput","../../templates/support/templateUtils"],function(e,t,r,i,o,n){"use strict";function s(e,r,a){const l=new Set(e.layers),c=r.filter(e=>l.has(e.layer)),p=c.length===r.length;if(n.isFieldElementTemplate(e))return new i({existsInAllLayers:p,features:c,template:e,expressionsManager:a});if(n.isGroupElementTemplate(e)){const t=e.elements.map(e=>s(e,r,a));return new o({existsInAllLayers:p,features:c,inputs:t,template:e,expressionsManager:a})}throw new t("batch-attribute-form:unsupported-element-template","The type of form element template provided is not supported")}e.createBatchFormInputsFromBatchFormTemplate=function(e,t,i){const o=e.elements.map(e=>s(e,t,i));return new r({inputs:o,template:e})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/inputs/FieldInput":function(){define(["../../../chunks/tslib.es6","../../../core/arrayUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../../layers/support/CodedValue","../../../layers/support/CodedValueDomain","../../../layers/support/Domain","../../../layers/support/InheritedDomain","../../../layers/support/RangeDomain","../../../layers/support/domainUtils","../../../layers/support/fieldUtils","../../../smartMapping/support/utils","../../../support/guards","../../../time/constants","./EditableInput","./support/inputUtils","../../support/forms/formUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b){"use strict";let v=class extends f{constructor(e){super(e),this.group=null,this.type="field",this.userHasChangedValue=!1,this._hasIntersectionWithElementFieldDomain=!1}get compositeError(){if(this.valid)return null;const{errors:e}=this;if(e.length<this.features.length)return"batch-attribute-form-validation::features-have-different-errors";const t=e[0];for(const r of e)if(r.error!==t.error)return"batch-attribute-form-validation::features-have-different-errors";return t.error}get dataType(){const{field:e}=this;return u.isNumericField(e)?"number":u.isStringField(e)?"text":h.isAnyDateField(e)||u.isTimeOnlyField(e)?"date":"unsupported"}get domain(){const e=this._allDomains.toArray();return this.calculateDomain(e)}get distinctValues(){if(this.featuresHaveSameValue)return[this.value];const e=new Set;for(const t of this.features)e.add(t.getAttribute(this.fieldName));return Array.from(e)}get editable(){return!!this.field.editable&&(this._evaluatedEditableExpression??!0)}get effectiveVisible(){return g.visibilityCodeToBoolean(this.effectiveVisibilityCode)}get effectiveVisibilityCode(){const{visibilityCode:e}=this;if("visible"!==e)return e;const{group:t}=this;if(null==t)return e;const r=t.visibilityCode;return"hidden:visibility-expression:all-features"===r?"hidden:group-visibility-expression:all-features":"hidden:visibility-expression:some-features"===r?"hidden:group-visibility-expression:some-features":e}get errors(){return this._validate()}get featuresHaveSameValue(){const{fieldName:e}=this,t=this.features.at(0)?.getAttribute(e);return this.features.every(r=>r.getAttribute(e)===t)}get field(){return this.template.field}get fieldName(){return this.field.name}get invalidFeatures(){return this.errors.map(e=>e.feature)}get isSubtypeField(){return this.layers.some(e=>{if(e&&"subtypeField"in e){const{subtypeField:t,fieldsIndex:r}=e;return(r.get(t)?.name??t)===this.fieldName}return!1})}get showNoValueOptionEnabled(){const{input:e}=this.template;return!(this.required||g.isFieldInputWithShowNoValueOptionInput(e)&&!0!==e?.showNoValueOption)}get showNoValueLabel(){const{input:e}=this.template;return g.isFieldInputWithShowNoValueOptionInput(e)?e?.noValueOptionLabel:null}get includeTime(){const{template:e,field:t}=this;return"date"===this.dataType&&("time-only"===t.type||"date-only"!==t.type&&("datetime-picker"!==e.input?.type||e.input.includeTime))}get includeTimeOffset(){if("timestamp-offset"!==this.field.type)return!1;const e=this.template.input;return!e||"datetimeoffset-picker"===e.type&&e.includeTimeOffset}get maxLength(){return b.getMaxLength({dataType:this.dataType,field:this.field,input:this.template.input})}get minLength(){return b.getMinLength({dataType:this.dataType,field:this.field,input:this.template.input})}get range(){if("date"===this.dataType)return this._dateRange;const{domain:e,field:t}=this;if(e){const r=d.getDomainRange(t,e);return{max:r?.max,min:r?.min}}const r=this._allDomains.toArray().every(e=>!e)?u.getFieldRange(t):null;return{max:r?.max===Number.MAX_VALUE?null:r?.max??null,min:r?.min===-Number.MAX_VALUE?null:r?.min??null}}get required(){if(!this.editable)return!1;if(!this.field.nullable||this.isSubtypeField)return!0;const e=this.visible&&!1!==this.group?.visible,t=this._evaluatedRequiredExpression;return!(!e||null==t)&&t}get submittable(){return!(this.required&&this.distinctValues.some(e=>b.isEmptyValue(e))||!this.valid)}get valid(){return 0===this.errors.length}get value(){return this.featuresHaveSameValue?this.features.at(0)?.getAttribute(this.fieldName)??null:g.differentValuesString}get visibilityCode(){return this.field.visible?this._fieldShouldHaveDomain&&null==this.domain?"hidden:no-domain-in-common":this._baseVisibilityCode:"hidden:field-definition"}get effectiveTimeZone(){const e=this.template;let t=e.formTimeZone??"system";return e.layerTimeZone?e.layerTimeZone===m.unknown?t=m.utc:e.formTimeZone===m.unknown&&(t=e.layerTimeZone):e.formTimeZone===m.unknown&&(t=m.utc),t}get codedValueDomainOptions(){return"coded-value"===this.domain?.type?this.domain.codedValues.map(({name:e,code:t})=>({name:e,value:t})):[]}get codedValueOptions(){const e=this.codedValueDomainOptions,{value:t}=this,r=null==t||t===g.differentValuesString||e.some(e=>e.value===t)?[]:[{name:`${t}`,value:t}];return[e,r]}get _evaluatedRequiredExpression(){let e=!1,t=!0;const r=this.template;for(const i of this.features){if(null==r.getExpressionExecutorsForLayer(i.layer)?.requiredExpression)continue;t=!1;const o=this._lookupEvaluatedExpression(i,"required");e="success"!==o?.status||e||!0===o.result}return t?null:e}get _allDomains(){const e=this.template.domain;return this.features.map(t=>{const r=t.layer.getFieldDomain(this.fieldName,{feature:t.plainGraphic});return"range"===r?.type||"range"===e?.type?r??this.template.domain:r})}get _fieldShouldHaveDomain(){return!!this._hasIntersectionWithElementFieldDomain||this._allDomains.some(t.isSome)}get _dateFormRange(){if("date"!==this.dataType)return{};const e=this.template.input;if(!e)return{};const{type:t}=e;let r={};if("date-picker"!==t&&"time-picker"!==t&&"datetimeoffset-picker"!==t||(r=d.dateTimeFieldValuesToNumericRange(this.field,e.max,e.min)),"datetime-picker"===t){const{max:t,min:i}=e;r={max:null!=t&&b.dateIsValid(t)?t.getTime():null,min:null!=i&&b.dateIsValid(i)?i.getTime():null}}return{min:r.min,max:r.max,rawMax:r?.rawMax??null,rawMin:r?.rawMin??null}}get _dateRange(){const{_dateFormRange:e,template:t,field:r,domain:i}=this;if("date"!==this.dataType)return{};if(!i)return this._fieldShouldHaveDomain?{}:e;const o=d.getDomainRange(r,i);if(!o)return e;const{max:n,min:s,rawMax:a,rawMin:l}=e,{type:c}=t.field;if("date"===c){const{max:e,min:t}=o;return{max:y.isNumber(n)&&(null===e||null!=e&&n<=e)?n:e??null,min:y.isNumber(s)&&(null===t||null!=t&&s>=t)?s:t??null}}if("date-only"===c||"time-only"===c||"timestamp-offset"===c){const{max:e,min:t,rawMax:r,rawMin:i}=o,c=y.isNumber(n)&&a&&(null==e||n<e),p=y.isNumber(s)&&l&&(null==t||s>t);return{max:c?n:e,min:p?s:t,rawMax:c?a:r,rawMin:p?l:i}}return{}}async setValueFromUser(e){this.userHasChangedValue=!0;const t=[],r=this.fieldName;for(const i of this.features)i.getAttribute(r)!==e&&t.push(i);this._setValue(e),await this.expressionsManager.valueChanged(r,t)}_setValue(e){const{fieldName:t}=this;for(const r of this.features)r.setAttribute(t,e)}_validate(){const{dataType:e,fieldName:t,maxLength:r,minLength:i,range:o}=this,n=[];for(const s of this.features){const{layer:a}=s,l=a.getField(t)??this.field,c=a.getFieldDomain(t,{feature:s.plainGraphic}),p=this.calculateDomain([c]),d=this._requiredForFeature(s),u=s.getAttribute(t),h=b.validateFormValue(u,{dataType:e,domain:p,field:l,maxLength:r,minLength:i,range:o,required:d});h&&n.push({error:h,feature:s.source})}return n}_editableForFeature(e){if(!this.field.editable)return!1;if(null==this.template.getExpressionExecutorsForLayer(e.layer)?.editableExpression)return!0;const t=this._lookupEvaluatedExpression(e,"editable");return"success"===t?.status&&!0===t.result}_effectiveVisibleFeature(e){if(this.group&&!this.group.visibleForFeature(e))return!1;if(null==this.template.getExpressionExecutorsForLayer(e.layer)?.visibilityExpression)return!0;const t=this._lookupEvaluatedExpression(e,"visibility");return"success"===t?.status&&!0===t.result}_requiredForFeature(e){if(!this._editableForFeature(e))return!1;if(!this.field.nullable||this.isSubtypeField)return!0;const t=this._effectiveVisibleFeature(e);if(null==this.template.getExpressionExecutorsForLayer(e.layer)?.requiredExpression)return!1;const r=this._lookupEvaluatedExpression(e,"required");return"success"!==r?.status?t:t&&!0===r.result}calculateDomain(e){const t=e.find(e=>null!=e),r=this.template.domain;if(!t)return r&&d.isDomainValidForField(this.field,r)?r:null;switch(t.type){case"coded-value":if(e.some(e=>!e)){if(!r)return null;e=e.filter(e=>null!==e)}break;case"range":e=e.filter(e=>null!==e)}if(!e.every(e=>e?.type===t?.type))return null;let i=null;switch(t?.type){case"range":i=this._intersectRangeDomains(e);break;case"coded-value":i=this._intersectCodedValueDomains(e)}return i}_intersectCodedValueDomains(e){if(!e.length)return null;const t=new Map(e[0].codedValues.map(({code:e,name:t})=>[e,t])),r=this.template.domain?new Map(this.template.domain.codedValues.map(({code:e,name:t})=>[e,t])):null;for(const r of e)for(const[e,i]of t)r.codedValues.some(t=>t.code===e&&t.name===i)||t.delete(e);let i=t;if(r){i=new Map;for(const[e,o]of r)t.has(e)&&i.set(e,o)}const o=Array.from(i.entries()).map(([e,t])=>new s.CodedValue({code:e,name:t}));return o.length?new a({codedValues:o}):null}_intersectRangeDomains(e){if(!e.length)return null;let t=e[0];for(let r=1;r<e.length;r++){if(!t)return null;t=this._findMinMaxValuesBetweenTwoDomains(t,e[r])}if(t&&!d.isDomainValidForField(this.field,t))return null;const{domain:r}=this.template;if(t&&r&&r instanceof p){const e=this._findMinMaxValuesBetweenTwoDomains(t,r);return this._hasIntersectionWithElementFieldDomain=!!e,e}return t}_getMinMaxFromRangeDomain(e){const t=e.minValue,r=e.maxValue,{field:i}=this;return u.isDateOnlyField(i)||u.isTimeOnlyField(i)||u.isTimestampOffsetField(i)?d.dateTimeFieldValuesToNumericRange(i,r,t):{min:null!=t&&"number"==typeof t?t:null,max:null!=r&&"number"==typeof r?r:null}}_findMinMaxValuesBetweenTwoDomains(e,t){const r=new p,i=this._getMinMaxFromRangeDomain(e),o=this._getMinMaxFromRangeDomain(t),{field:n}=this,s=this._getValidRangeValue(i.min,-1/0),a=this._getValidRangeValue(i.max,1/0),l=this._getValidRangeValue(o.min,-1/0),c=this._getValidRangeValue(o.max,1/0);return r.minValue=Math.max(s,l),r.maxValue=Math.min(a,c),r.minValue===-1/0||r.maxValue===1/0||r.minValue>r.maxValue?null:((u.isDateOnlyField(n)||u.isTimeOnlyField(n)||u.isTimestampOffsetField(n))&&(r.minValue=Number(i.min)>Number(o.min)?i.rawMin:o.rawMin,r.maxValue=Number(i.max)<Number(o.max)?i.rawMax:o.rawMax),r.name="intersection",r)}_getValidRangeValue(e,t){return y.isNumber(e)?e:t}};return e.__decorate([r.property()],v.prototype,"dataType",null),e.__decorate([r.property()],v.prototype,"domain",null),e.__decorate([r.property()],v.prototype,"distinctValues",null),e.__decorate([r.property()],v.prototype,"editable",null),e.__decorate([r.property()],v.prototype,"effectiveVisible",null),e.__decorate([r.property()],v.prototype,"effectiveVisibilityCode",null),e.__decorate([r.property()],v.prototype,"errors",null),e.__decorate([r.property()],v.prototype,"featuresHaveSameValue",null),e.__decorate([r.property()],v.prototype,"field",null),e.__decorate([r.property()],v.prototype,"fieldName",null),e.__decorate([r.property()],v.prototype,"group",void 0),e.__decorate([r.property()],v.prototype,"invalidFeatures",null),e.__decorate([r.property()],v.prototype,"isSubtypeField",null),e.__decorate([r.property()],v.prototype,"showNoValueOptionEnabled",null),e.__decorate([r.property()],v.prototype,"showNoValueLabel",null),e.__decorate([r.property()],v.prototype,"includeTime",null),e.__decorate([r.property()],v.prototype,"includeTimeOffset",null),e.__decorate([r.property()],v.prototype,"maxLength",null),e.__decorate([r.property()],v.prototype,"minLength",null),e.__decorate([r.property()],v.prototype,"range",null),e.__decorate([r.property()],v.prototype,"required",null),e.__decorate([r.property()],v.prototype,"submittable",null),e.__decorate([r.property({readOnly:!0})],v.prototype,"type",void 0),e.__decorate([r.property()],v.prototype,"userHasChangedValue",void 0),e.__decorate([r.property()],v.prototype,"valid",null),e.__decorate([r.property()],v.prototype,"value",null),e.__decorate([r.property()],v.prototype,"visibilityCode",null),e.__decorate([r.property()],v.prototype,"effectiveTimeZone",null),e.__decorate([r.property()],v.prototype,"_evaluatedRequiredExpression",null),e.__decorate([r.property()],v.prototype,"_hasIntersectionWithElementFieldDomain",void 0),e.__decorate([r.property()],v.prototype,"_allDomains",null),e.__decorate([r.property()],v.prototype,"_fieldShouldHaveDomain",null),e.__decorate([r.property()],v.prototype,"_dateFormRange",null),e.__decorate([r.property()],v.prototype,"_dateRange",null),v=e.__decorate([n.subclass("esri.widgets.BatchAttributeForm.inputs.FieldInput")],v),v})},"esri/widgets/BatchAttributeForm/inputs/EditableInput":function(){define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./InputBase"],function(e,t,r,i,o,n,s){"use strict";let a=class extends s{constructor(){super(...arguments),this.editType="NA"}get editable(){return this._evaluatedEditableExpression??!0}get _evaluatedEditableExpression(){let e=!0,t=!0;for(const r of this.features){if(null==this.template.getExpressionExecutorsForLayer(r.layer)?.editableExpression){e=e&&!0;continue}t=!1;const i=this._lookupEvaluatedExpression(r,"editable");e="success"===i?.status&&e&&!0===i.result}return t?null:e}};return e.__decorate([t.property()],a.prototype,"editable",null),e.__decorate([t.property()],a.prototype,"editType",void 0),e.__decorate([t.property()],a.prototype,"_evaluatedEditableExpression",null),a=e.__decorate([n.subclass("esri.widgets.BatchAttributeForm.inputs.EditableInput")],a),a})},"esri/widgets/BatchAttributeForm/inputs/InputBase":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Collection","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./support/inputUtils"],function(e,t,r,i,o,n,s,a,l){"use strict";let c=class extends t{constructor(e){super(e),this.existsInAllLayers=!0,this.features=new r}get description(){return this.template.description}get featuresHaveSameCalculatedVisibility(){const e=new Set;for(const t of this.features){if(null==this.template.getExpressionExecutorsForLayer(t.layer)?.visibilityExpression){e.add(!0);continue}const r=this._lookupEvaluatedExpression(t,"visibility");if("success"===r?.status){if(e.add(!0===r.result),e.size>1)return!1}else e.add(!1)}return e.size<=1}get label(){return this.template.label}get layers(){return Array.from(new Set(this.features.map(e=>e.layer).filter(e=>null!=e&&("feature"===e.type||"geojson"===e.type||"scene"===e.type||"subtype-sublayer"===e.type||"oriented-imagery"===e.type))))}get visibilityCode(){return this._baseVisibilityCode}get visible(){return l.visibilityCodeToBoolean(this.visibilityCode)}get _baseVisibilityCode(){return this.existsInAllLayers?this.featuresHaveSameCalculatedVisibility?!1===this._evaluatedVisibilityExpression?"hidden:visibility-expression:all-features":"visible":"hidden:visibility-expression:some-features":"hidden:not-in-all-layers"}get _evaluatedVisibilityExpression(){let e=!0,t=!0;for(const r of this.features){if(null==this.template.getExpressionExecutorsForLayer(r.layer)?.visibilityExpression){e=e&&!0;continue}t=!1;const i=this._lookupEvaluatedExpression(r,"visibility");e="success"===i?.status&&e&&!0===i.result}return t?null:e}_lookupEvaluatedExpression(e,t){return this.expressionsManager.evaluatedExpressions.get(e)?.get(l.makeUseId(this.template.elementId,t))}};return e.__decorate([i.property({constructOnly:!0})],c.prototype,"expressionsManager",void 0),e.__decorate([i.property()],c.prototype,"description",null),e.__decorate([i.property()],c.prototype,"existsInAllLayers",void 0),e.__decorate([i.property()],c.prototype,"features",void 0),e.__decorate([i.property()],c.prototype,"featuresHaveSameCalculatedVisibility",null),e.__decorate([i.property()],c.prototype,"label",null),e.__decorate([i.property()],c.prototype,"layers",null),e.__decorate([i.property({constructOnly:!0})],c.prototype,"template",void 0),e.__decorate([i.property()],c.prototype,"visibilityCode",null),e.__decorate([i.property()],c.prototype,"visible",null),e.__decorate([i.property()],c.prototype,"_baseVisibilityCode",null),e.__decorate([i.property()],c.prototype,"_evaluatedVisibilityExpression",null),c=e.__decorate([a.subclass("esri.widgets.BatchAttributeForm.inputs.InputBase")],c),c})},"esri/widgets/BatchAttributeForm/inputs/GroupInput":function(){define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./InputBase","./support/inputUtils"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends s{constructor(e){super(e),this.inputs=[],this.type="group"}initialize(){for(const e of this.inputs)e.group=this}get open(){return"expanded"===this.template.initialState}set open(e){this._override("open",e)}get visible(){return a.visibilityCodeToBoolean(this.visibilityCode)&&this.inputs.some(e=>e.visible)}visibleForFeature(e){if(null==this.template.getExpressionExecutorsForLayer(e.layer)?.visibilityExpression)return!0;const t=this._lookupEvaluatedExpression(e,"visibility");return"success"===t?.status&&!0===t.result}};return e.__decorate([t.property()],l.prototype,"inputs",void 0),e.__decorate([t.property({readOnly:!0})],l.prototype,"type",void 0),e.__decorate([t.property()],l.prototype,"open",null),e.__decorate([t.property()],l.prototype,"visible",null),l=e.__decorate([n.subclass("esri.widgets.BatchAttributeForm.inputs.GroupInput")],l),l})},"esri/widgets/BatchAttributeForm/templates/BatchFormTemplate":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./support/templateUtils"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends t{constructor(e){super(e),this.description=null,this.preserveFieldValuesWhenHidden=!1,this.title=null}get elementsFlat(){const e=[];for(const t of this.elements)if(e.push(t),a.isGroupElementTemplate(t))for(const r of t.elements)e.push(r);return e}get elementsInCommon(){const e=this.layers.length;return this.elements.filter(t=>t.layers.length===e)}get layers(){const e=new Set(this.elements.flatMap(e=>e.layers));return Array.from(e)}getExpressionExecutorsForLayer(e){const t=new Map;for(const r of this.elementsFlat)r.layers.includes(e)&&t.set(r,r.getExpressionExecutorsForLayer(e));return t}};return e.__decorate([r.property()],l.prototype,"description",void 0),e.__decorate([r.property()],l.prototype,"elements",void 0),e.__decorate([r.property()],l.prototype,"elementsFlat",null),e.__decorate([r.property()],l.prototype,"elementsInCommon",null),e.__decorate([r.property()],l.prototype,"layers",null),e.__decorate([r.property()],l.prototype,"preserveFieldValuesWhenHidden",void 0),e.__decorate([r.property()],l.prototype,"title",void 0),l=e.__decorate([s.subclass("esri.widgets.BatchAttributeForm.templates.BatchFormTemplate")],l),l})},"esri/widgets/BatchAttributeForm/templates/support/contingentValuesUtils":function(){define(["exports","../../../../core/MapUtils","../../../../layers/support/LayerContingentValuesCache","../../../../layers/support/layerUtils"],function(e,t,r,i){"use strict";const o=new Map;e.getLayerContingentValuesMetaData=async function(e){if(!(e=i.isSubtypeSublayer(e)?e.parent:"feature"===e?.type?e:null))return null;const n=t.getOrCreateMapValue(o,e,()=>{const t=r.createLoadedLayerContingentValuesCache(e);return e.addHandles({remove(){o.delete(e)}}),t});return await n??null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LayerContingentValuesCache":function(){define(["../../chunks/tslib.es6","../../request","../../core/arrayUtils","../../core/JSONSupport","../../core/Loadable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./arcgisLayerUrl","./Contingency","./ContingencyConstraintViolation","./ContingentValue","./ContingentValuesResult","./FieldGroup","./fieldUtils","./Subtype","../../widgets/FeatureForm/featureFormUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g){"use strict";var b;let v=b=class extends(i.JSONSupportMixin(o.Loadable)){constructor(e){super(e),this.request=t,this.fieldGroups=null,this.fieldGroupDefinitions=null}initialize(){}get loaded(){return super.loaded}get subtypeFieldName(){return g.getNormalizedFeatureTypeInfo(this.layer).typeFieldName}static async createLoadedLayerContingentValuesCache(e){await e.load();const t=e.sourceJSON;if(void 0===e.layerId)return null;const r=t?.hasContingentValuesDefinition;if(r)return new b({layer:e}).load();if(void 0===r){const t=c.parse(e.url);if(null==t)return null;const r=t.url.path;if((await M(r)).supportsQueryDataElements){const t=e.layerId.toString(),i=await x(r,t);if(i){const t=i.map(t=>({name:t.name,isEditingRestrictive:t.isEditingRestrictive,fields:t.fieldNames.names.map(t=>e.fieldsIndex.normalizeFieldName(t))}));return new b({layer:e,fieldGroupDefinitions:t}).load()}}}return null}async load(e){const t=this.layer.load(e).then(()=>this._initializeContingentValues(this.fieldGroupDefinitions,e));return this.addResolvingPromise(t),this}validateContingencyConstraints(e,t){const r=Object.keys(e),i=[],o=[];for(const n of this.fieldGroups){const s=n.isEditingRestrictive?"error":"warning";if(t&&!n.fields.some(e=>t.includes(e)))continue;if(!n.fields.every(e=>r.includes(e))){o.push(new d({fieldGroup:n,type:s}));continue}let a=!1;const l=e[this.subtypeFieldName],c=n.contingencies.filter(e=>!(!e.isRetired&&e.subtype)||e.subtype.code===l);if(0!==c.length){for(const t of c){let r=!0;for(const i in t.values){const o=t.values[i];if("any"!==o.objectType)if("null"===o.objectType){if(null!=e[i]){r=!1;break}}else if("code"===o.objectType){if(e[i]!==o.codedValue.code){r=!1;break}}else if("range"===o.objectType){const t=e[i];if(t<o.minValue||t>o.maxValue){r=!1;break}}}if(r){a=!0;break}}a||i.push(new d({fieldGroup:n,type:s}))}}return{invalid:i,incomplete:o}}getContingentValues(e,t,r=!1){const i=e[this.subtypeFieldName],o=null!=i,n={};let s=[];const a=this.fieldGroups.filter(e=>e.fields.includes(t));s.push(new u({objectType:"any"}));for(const l of a){let a=[];const c=l.contingencies.filter(e=>!(e.isRetired||e.subtype&&o&&e.subtype.code!==i));let p=!1;const d={};for(const r of c){let i,o=!0;for(const n in r.values){const s=r.values[n];if(t!==n){if(void 0!==e[n]&&"any"!==s.objectType)if("null"===s.objectType)null!==e[n]&&(o=!1);else if("code"===s.objectType)e[n]!==s.codedValue.code&&(o=!1);else if("range"===s.objectType){const t=e[n];(t<s.minValue||t>s.maxValue)&&(o=!1)}}else i=s,p=p||"range"===s.objectType}if(i&&o){if("any"===i.objectType){a.length=0,a.push(i);break}const e=_(i);d[e]||a.push(i),d[e]=!0}}p&&(a=w(a)),n[l.name]=a,s=r?S(s,a):[]}return 1===a.length&&r&&(s=[]),new h({contingentValuesAllGroups:s,contingentValuesByFieldGroup:n})}async _initializeContingentValues(e,t){const r=e??await this._fetchFieldGroupDefs(t);if(0===r.length)return void(this.fieldGroups=[]);const i=await this._fetchContingentValues(r,t);this.fieldGroups=i}async _fetchFieldGroupDefs(e){if(void 0===this.layer.layerId)return[];const r=this.layer.sourceJSON,i=this.layer.layerId.toString(),o=c.parse(this.layer.url).url.path;if(r?.hasContingentValuesDefinition){const r=await async function(e,r,i){return t(`${e}/${r}/fieldgroups`,{responseType:"json",query:{f:"json"},...i}).then(e=>e.data.fieldGroups??[])}(o,i,e);return r.map(e=>({name:e.name,isEditingRestrictive:e.restrictive,fields:e.fields.map(e=>this.layer.fieldsIndex.normalizeFieldName(e))}))}return void 0!==r?.hasContingentValuesDefinition?[]:M(o,e).then(async t=>t.supportsQueryDataElements?(await x(o,i,e)).map(e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map(e=>this.layer.fieldsIndex.normalizeFieldName(e))})):[])}async _fetchContingentValues(e,r){if(void 0===this.layer.layerId)return[];const i=this.layer.sourceJSON,o=this.layer.layerId.toString(),n=c.parse(this.layer.url).url.path;if(i?.hasContingentValuesDefinition){const i=await async function(e,r,i){return t(`${e}/${r}/contingentValues`,{responseType:"json",query:{f:"json"},...i}).then(e=>e.data)}(n,o,r);return this._constructFieldGroupsAGOL(e,i)}const s=await async function(e,r,i){return t(`${e}/queryContingentValues`,{responseType:"json",query:{layers:JSON.stringify([r]),f:"json"},...i}).then(e=>e.data.contingentValueSets?.[0])}(n,o,r);return this._constructFieldGroupsEnterprise(e,s)}_constructFieldGroupsAGOL(e,t){return e.map(e=>{const r=t.contingentValuesDefinition.fieldGroups.find(t=>t.name===e.name);if(r){let i=[];return i=t.contingentValuesDefinition.hasSubType?this._parseAGOLFieldGroupSubtype(e,t,r.subTypes):this._parseAGOLFieldGroup(e,t,r.contingentValues),new y({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:i})}return null}).filter(r.isSome)}_parseAGOLFieldGroupSubtype(e,t,r){let i=[];return r?.forEach(r=>{const o=this._getSubtypeAGOL(r.name);i=i.concat(this._parseAGOLFieldGroup(e,t,r.contingentValues,o))}),i}_parseAGOLFieldGroup(e,t,r,i=null){const o=[];for(const n of r??[]){const r=this._parseAGOLContingency(n,e,t,i);o.push(r)}return o}_parseAGOLContingency(e,t,r,i){const o=e.id,n=!!e.retired&&1===e.retired,s={};for(let o=0,n=0;o<t.fields.length;o++){const a=t.fields[o],l=r.typeCodes[e.types[o]];if("Code"===l){let t=e.values[n];n++;const o=this._getDomain(i,a),l=this.layer.getField(a);if("string"===l?.type){const e=r.stringDicts.find(e=>e.domain===o?.name);e&&(t=e.entries[t])}const c=o?.codedValues.find(e=>e.code===t),p=new u({codedValue:c,objectType:"code"});s[a]=p}else if("Range"===l){const t=e.values[n];n++;const r=t.range[0],i=t.range[1],o=new u({minValue:r,maxValue:i,objectType:"range"});s[a]=o}else if("Any"===l){const e=new u({objectType:"any"});s[a]=e}else{const e=new u({objectType:"null"});s[a]=e}}return new p({id:o,isRetired:n,subtype:i,values:s})}_constructFieldGroupsEnterprise(e,t){const i=t.fieldGroups;return e.map(e=>{const r=i.find(t=>t.name===e.name);if(r){const i=r.contingencies.map(r=>{const i=r.id,o=r.isRetired||!1,n=this._getSubtypeEnterprise(r.subtypeCode),s={};for(let i=0;i<e.fields.length;i++){const o=e.fields[i];let a=r.values[i];if("number"==typeof a||"string"==typeof a){const e=this._getDomain(n,o),r=this.layer.getField(o);if(m.isStringField(r))a=t.stringDictionary[a];else if(m.isDateField(r)){const e=new Date(`${a}+00:00`);a=e.getTime()}const i=e?.codedValues.find(e=>e.code===a),l=new u({codedValue:i,objectType:"code"});s[o]=l}else if("object"==typeof a){const e=a.minValue,t=a.maxValue,r=new u({minValue:e,maxValue:t,objectType:"range"});s[o]=r}else if(a){const e=new u({objectType:"any"});s[o]=e}else{const e=new u({objectType:"null"});s[o]=e}}return new p({id:i,isRetired:o,subtype:n,values:s})});return new y({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:i})}return null}).filter(r.isSome)}_getSubtypeEnterprise(e){const t=this.layer.sourceJSON;let r;if(t?.subtypes){const i=t.subtypes.find(t=>t.code===e);r=f.fromJSON(i)}return r||null}_getSubtypeAGOL(e){const t=this.layer.sourceJSON;let r;if(t?.subtypes){const i=t.subtypes.find(t=>t.name===e);r=f.fromJSON(i)}return r||null}_getDomain(e,t){const r=e?function(e,t){const r=e.domains;if(r){const[e,i]=Object.entries(r).find(([e])=>e.trim().toLowerCase()===t.trim().toLowerCase())||[];return i||null}return null}(e,t):this.layer.getFieldDomain(t);return"inherited"===r?.type?this.layer.getFieldDomain(t):r}};function _(e){switch(e.objectType){case"any":return"@any@";case"null":return"@null@";case"code":return e.codedValue.name+e.codedValue.code.toString();case"range":return e.minValue.toString()+"-"+e.maxValue.toString()}}function w(e){let t,r;e.sort((e,t)=>"null"===e.objectType?-1:"null"===t.objectType?1:e.minValue-t.minValue);const i=[];for(const o of e)"null"!==o.objectType?null!=t&&null!=r?r<o.minValue?(i.push(new u({objectType:"range",minValue:t,maxValue:r})),t=o.minValue,r=o.maxValue):r<o.maxValue&&(r=o.maxValue):(t=o.minValue,r=o.maxValue):i.push(o);return i.push(new u({objectType:"range",minValue:t,maxValue:r})),i}function S(e,t){if(0===e.length||0===t.length)return[];if("any"===e[0].objectType)return t;if("any"===t[0].objectType)return e;const r="range"===e[0].objectType||"range"===e[1]?.objectType,i="range"===t[0].objectType||"range"===t[1]?.objectType;return r||i?function(e,t){const r=[];let i,o=0;for(const n of e)for(;o<t.length;o++){const e=t[o];if("null"===n.objectType&&"null"===e.objectType)r.push(new u({objectType:"null"}));else{if("null"===n.objectType)break;if("null"===e.objectType)continue}if(n.maxValue<e.minValue)break;if(n.maxValue===e.minValue){r.push(new u({objectType:"range",minValue:n.maxValue,maxValue:e.minValue}));break}if(!(n.minValue>e.maxValue))if(n.minValue!==e.maxValue){if(i=n.minValue>e.minValue?n.minValue:e.minValue,n.maxValue<e.maxValue){r.push(new u({objectType:"range",minValue:i,maxValue:n.maxValue}));break}r.push(new u({objectType:"range",minValue:i,maxValue:e.maxValue}))}else r.push(new u({objectType:"range",minValue:n.minValue,maxValue:e.maxValue}))}return r}(e,t):function(e,t){const r=[];for(const i of e)t.some(e=>{if(i.objectType===e.objectType)switch(i.objectType){case"any":case"null":return!0;case"code":return i.codedValue.code===e.codedValue.code&&i.codedValue.name===e.codedValue.name}return!1})&&r.push(i);return r}(e,t)}async function x(e,r,i){return t(`${e}/queryDataElements`,{responseType:"json",query:{layers:JSON.stringify([r]),f:"json"},...i}).then(e=>e.data.layerDataElements?.[0].dataElement.fieldGroups??[])}async function M(e,r){return t(e,{responseType:"json",query:{f:"json"},...r}).then(e=>e.data)}return e.__decorate([n.property({constructOnly:!0})],v.prototype,"layer",void 0),e.__decorate([n.property({constructOnly:!0})],v.prototype,"request",void 0),e.__decorate([n.property({type:[y]})],v.prototype,"fieldGroups",void 0),e.__decorate([n.property({constructOnly:!0})],v.prototype,"fieldGroupDefinitions",void 0),e.__decorate([n.property()],v.prototype,"subtypeFieldName",null),v=b=e.__decorate([l.subclass("esri.layers.support.LayerContingentValuesCache")],v),v})},"esri/layers/support/Contingency":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.isRetired=!1}};return e.__decorate([r.property()],a.prototype,"id",void 0),e.__decorate([r.property()],a.prototype,"isRetired",void 0),e.__decorate([r.property()],a.prototype,"subtype",void 0),e.__decorate([r.property()],a.prototype,"values",void 0),a=e.__decorate([s.subclass("esri.layers.support.Contingency")],a),a})},"esri/layers/support/ContingencyConstraintViolation":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e)}};return e.__decorate([r.property()],a.prototype,"fieldGroup",void 0),e.__decorate([r.property()],a.prototype,"type",void 0),a=e.__decorate([s.subclass("esri.layers.support.ContingencyConstraintViolation")],a),a})},"esri/layers/support/ContingentValue":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.maxValue=null,this.minValue=null,this.codedValue=null}};return e.__decorate([r.property()],a.prototype,"objectType",void 0),e.__decorate([r.property()],a.prototype,"maxValue",void 0),e.__decorate([r.property()],a.prototype,"minValue",void 0),e.__decorate([r.property()],a.prototype,"codedValue",void 0),a=e.__decorate([s.subclass("esri.layers.support.ContingentValue")],a),a})},"esri/layers/support/ContingentValuesResult":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e)}};return e.__decorate([r.property()],a.prototype,"contingentValuesAllGroups",void 0),e.__decorate([r.property()],a.prototype,"contingentValuesByFieldGroup",void 0),a=e.__decorate([s.subclass("esri.layers.support.ContingentValuesResult")],a),a})},"esri/layers/support/FieldGroup":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.fields=null,this.isEditingRestrictive=!1}};return e.__decorate([r.property()],a.prototype,"name",void 0),e.__decorate([r.property()],a.prototype,"fields",void 0),e.__decorate([r.property()],a.prototype,"isEditingRestrictive",void 0),e.__decorate([r.property()],a.prototype,"contingencies",void 0),a=e.__decorate([s.subclass("esri.layers.support.FieldGroup")],a),a})},"esri/widgets/FeatureForm/featureFormUtils":function(){define(["exports","../../intl","../../core/arrayUtils","../../core/compilerUtils","../../core/lang","../../core/Logger","../../core/string","../../form/support/formUtils","../../layers/support/fieldUtils","../../layers/support/layerUtils","../../smartMapping/support/utils","../support/dateUtils","../support/forms/formUtils","../../intl/substitute"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h){"use strict";const y=e=>"field"===e?.type,m=e=>"group"===e?.type,f=e=>"relationship"===e?.type,g=e=>"utilityNetworkAssociations"===e.type,b=e=>!m(e)&&null!=e.group,v=e=>e.reduce((e,t)=>m(t)?[...e,...t.inputs]:[...e,t],[]),_=(e,t)=>null!=e&&e.input?.type===t,w="expression/";function S(e){const{fields:t,values:r}=e,i=e.timeZone??void 0,o=t.map((e,t)=>{let o=r[t];if(e.domain&&"coded-value"===e.domain.type){const t=e.domain.codedValues.find(e=>e.code===o);t?.name&&(o=t.name)}return(p.isAnyDateField(e)||l.isTimeOnlyField(e))&&(o=d.getLabelForDateFieldValue(e,o,{timeZone:i,...d.getIntlOptionsForField(e)})),[e.name,o]});return Object.fromEntries(o)}function x(e,t){return s.replace(s.replace(e,e=>`{${e.toLowerCase()}}`),Object.fromEntries(Object.entries(t).map(([e,t])=>[e.toLowerCase(),t])))}e.extractExpressionNameFromString=function(e){const[t,r]=e.split(w);return""===t&&r?r:(n.getLogger("esri.widgets.FeatureForm/featureFormUtils").error("extractExpressionNameFromString:invalid-input",`The string ${e} is not a valid expression reference of the form '${w}/expressionName'`),"")},e.flattenAssociationInputs=e=>v(e).filter(g),e.flattenFieldInputs=e=>v(e).filter(y),e.flattenInputs=v,e.flattenRelationshipInputs=e=>v(e).filter(f),e.formTemplateHasInvalidFields=function(e,t){const r=t??("formTemplate"in e&&e.formTemplate);return!!r&&(r.elements?.filter(a.isFieldElement)??[]).some(({fieldName:t})=>!e.fieldsIndex.get(t))},e.getComputedAttributes=S,e.getErrorMessageForFieldInput=(e,t,r)=>{const{dataType:i,error:o,minLength:n}=e,s=t?.validationErrors;if(!s||!o)return null;if("input-validation-error::cannot-be-empty"===o)return s.cannotBeNull;if("domain-validation-error::value-out-of-range"===o||"numeric-range-validation-error::out-of-range"===o){const{field:t,range:o}=e,n={type:"date",intlOptions:{timeZone:"date"===t.type&&r?r:void 0,...d.getIntlOptionsForField(t)}},a=u.getRangeErrorMessage(o,s);return h.substitute(a,o,{format:{max:"date"===i?n:null!=o.max&&u.shouldUseScientificNotation(o.max)?u.scientificNumberFormatOptions:u.numberFormatOptions,min:"date"===i?n:null!=o.min&&u.shouldUseScientificNotation(o.min)?u.scientificNumberFormatOptions:u.numberFormatOptions}})}return"domain-validation-error::invalid-coded-value"===o?s.invalidCodedValue:"type-validation-error::invalid-type"===o?s.invalidType:"length-validation-error::too-short"===o?h.substitute(s.tooShort,{min:n}):null},e.getFieldsInTitleAndDesc=e=>{const t=[];if(e.formTemplate){const{description:r,title:i}=e.formTemplate;e.fields?.forEach(e=>{const o=i&&s.templateHasKey(i,e.name),n=r&&s.templateHasKey(r,e.name);(o||n)&&t.push(e.name)})}return t},e.getIconForFeature=e=>{if(!e)return;const t=e.layer,r=t&&"geometryType"in t?t.geometryType:void 0,i=e.geometry?.type;return"polyline"===i||"polyline"===r?"line":"mesh"===i||"mesh"===r||"multipatch"===r?"cube":"multipoint"===i||"multipoint"===r?"point":i||r||"table"},e.getNormalizedFeatureTypeInfo=e=>{const t={typeFieldName:null,types:[]};return e?(c.isSubtypeSublayer(e)?(t.typeFieldName=e.parent?.subtypeField,t.types=e.parent?.subtypes??[]):"subtype-group"===e.type||"feature"===e.type&&e.subtypes?.length?(t.typeFieldName=e.subtypeField,t.types=e.subtypes??[]):"types"in e&&e.types&&(t.typeFieldName=e.typeIdField,t.types=e.types.map(({id:e,name:t,domains:r})=>({code:e,name:t,domains:r}))),null!=t.typeFieldName&&(t.typeFieldName=e.getField(t.typeFieldName)?.name??t.typeFieldName),t):t},e.isExpressionReference=function(e){return e.startsWith(w)},e.isFieldElementWithInputType=_,e.isFieldElementWithShowNoValueOptionInput=e=>null!=e&&(_(e,"combo-box")||_(e,"radio-buttons")),e.isFieldInput=y,e.isGroupInput=m,e.isInputInGroupInput=b,e.isInputInThisGroupInput=(e,t)=>b(e)&&e.group===t,e.isLegacyFieldMapsExpressionReference=function(e){return e.startsWith("expr/")},e.isNumberFieldInput=({domain:e,inputType:t="text-box",dataType:r})=>"number"===r&&"text-box"===t&&(!e||"coded-value"!==e.type),e.isRelationshipInput=f,e.isTextElementInput=e=>"text"===e.type,e.isUtilityNetworkAssociationInput=g,e.parseFormTemplateString=function(e){const{attributes:t,fieldsIndex:i,label:o,timeZone:n}=e;if(!t||"object"!=typeof t)return o;const a=Object.keys(t).filter(e=>s.templateHasKey(o,e)),l=a.map(e=>t[e]),c=a.map(e=>i.get(e)).filter(r.isSome);return x(o,S({values:l,fields:c,timeZone:n}))},e.prependExpressionPrefix=function(e){return`${w}${e}`},e.prependFieldPrefix=function(e){return`field/${e}`},e.substituteFieldTemplatesInString=x,e.subtypeChangeShouldPrompt=function(e,t,r){const i=c.getSubtypesFromLayer(e),n=i?.find(e=>e.code===r);if(!n)return!1;const s=i?.find(e=>e.code===t);return!o.equalsShallow(n.defaultValues,s?.defaultValues)&&Object.values(n.defaultValues).some(e=>null!=e)},e.valueIsInvalidSwitchValue=function(e,t){return null==e||t.onValue!==e&&t.offValue!==e},e.valueIsValidContingentValue=function(e,t){switch(t.objectType){case"any":return!0;case"null":return null==e;case"code":return e===t.codedValue?.code;case"range":return null!=e&&null!=t.minValue&&null!=t.maxValue&&+e>=t.minValue&&+e<=t.maxValue;default:return i.neverReached(t.objectType),!1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/templates/support/createBatchFormTemplate":function(){define(["exports","../../../../core/Error","../../../../core/Logger","../../../../form/ExpressionInfo","../../../../form/support/formUtils","../../../../layers/support/fieldUtils","../../../../layers/support/layerUtils","../../../../time/constants","../../expressions/expressionUtils","../BatchFormTemplate","../FieldElementTemplate","../GroupElementTemplate"],function(e,t,r,i,o,n,s,a,l,c,p,d){"use strict";const u="expression/dea57012-47ca4b55a000-8df62742ed0c",h=()=>r.getLogger("esri.widgets.BatchAttributeForm.templates.templateUtils");async function y(e,{arcadeExecutorProvider:t,formTimeZone:r}){const i=new Set(n.getLowerCaseEditTrackingFields(e)),o={arcadeExecutorProvider:t,formTimeZone:r,layer:e},s=[];for(const t of e.fields)v(t,e,i)&&s.push(b(t,o));const a=await Promise.all(s);return new c({elements:a,preserveFieldValuesWhenHidden:!0})}function m(e,t){for(const r of e??[])if("group"!==r.type){if("field"===r.type){if(!1===r.editable&&!r.editableExpression)return!0;if(t.subtypeField&&(s.isSubtypeSublayer(t)||s.isSubtypeGroupLayer(t))&&r.fieldName?.toLowerCase()===t.subtypeField.toLowerCase())return!0}}else if(m(r.elements??[],t))return!0;return!1}async function f(e,t){const r=e.formTemplate;if(!r)return y(e,t);let o=null;m(r.elements??[],e)&&(o=new i({title:"",name:u,expression:"false"}));const n=l.makeExpressionInfosMap(o?[...r.expressionInfos??[],o]:r.expressionInfos),s={description:r.description,elements:new Array,title:r.title,preserveFieldValuesWhenHidden:r.preserveFieldValuesWhenHidden},{elements:a}=r;if(!a)return new c(s);const{arcadeExecutorProvider:p,formTimeZone:d}=t;for(const t of a){const r=await g(t,{arcadeExecutorProvider:p,expressionInfos:n,layer:e,formTimeZone:d});r&&s.elements.push(r)}return new c(s)}async function g(e,r){return o.isFieldElement(e)?async function(e,{arcadeExecutorProvider:r,expressionInfos:i,layer:o,formTimeZone:n}){const{fieldsIndex:a}=o,{description:c,domain:d,fieldName:y,hint:m,input:f,label:g}=e;if(null==y||!a.has(y))return h().warn(new t("batch-attribute-form:invalid-form-element-field",`Field element with label '${g}' does not refer to a valid field`)),null;const b={description:c,domain:d,field:a.get(y),hint:m,input:f,formTimeZone:n,layerTimeZone:_(o),label:g};!1!==e.editable||e.editableExpression||((e=e.clone()).editableExpression=u),o.subtypeField&&(s.isSubtypeSublayer(o)||s.isSubtypeGroupLayer(o))&&e.fieldName?.toLowerCase()===o.subtypeField.toLowerCase()&&((e=e.clone()).editableExpression=u);const v=new p.FieldElementTemplate(b),w=await l.makeExecutorSetForFormElement({element:e,expressionInfos:i,provider:r});return v.addLayer(o,w),v}(e,r):o.isGroupElement(e)?async function(e,t){const{arcadeExecutorProvider:r,expressionInfos:i,layer:o}=t,{description:n,label:s,initialState:a}=e,c={description:n,elements:[],label:s,initialState:a??"expanded"};for(const r of e.elements){const e=await g(r,t);e&&c.elements.push(e)}const p=new d.GroupElementTemplate(c),u=await l.makeExecutorSetForFormElement({element:e,expressionInfos:i,provider:r});return p.addLayer(o,u),p}(e,r):(h().warn(new t("batch-attribute-form:unsupported-element-type",`Form elements of type ${e.type} are not supported`)),null)}async function b(e,{arcadeExecutorProvider:t,layer:r,formTimeZone:i}){const o=new p.FieldElementTemplate({field:e,label:e.alias??e.name,formTimeZone:i,layerTimeZone:_(r)}),n={},a=(s.isSubtypeGroupLayer(r)||s.isSubtypeSublayer(r))&&r.subtypeField&&r.subtypeField.toLowerCase()===e.name.toLowerCase();return!a&&e.editable&&r.userHasUpdateItemPrivileges&&(n.editableExpression=await t.getArcadeExecutor("true")),a&&(n.editableExpression=await t.getArcadeExecutor("false")),o.addLayer(r,n),o}function v(e,t,r){return!r.has(e.name.toLowerCase())&&n.isFieldVisibleByDefault(e,t)}function _(e){return s.isSubtypeSublayer(e)&&e.parent&&(e=e.parent),e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone?a.unknown:e&&"preferredTimeZone"in e&&e.preferredTimeZone?e.preferredTimeZone:null}e.convertFormTemplateToBatchFormTemplate=f,e.createBatchFormTemplate=async function(e,t){return e.formTemplate?.elements&&e.formTemplate?.elements.length>0?f(e,t):y(e,t)},e.createBatchFormTemplateFromFields=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/expressions/expressionUtils":function(){define(["exports"],function(e){"use strict";e.makeExecutorSetForFormElement=async function({element:e,expressionInfos:t,provider:r}){const i={};if(e.visibilityExpression){const o=t.get(e.visibilityExpression);i.visibilityExpression=o?await r.getArcadeExecutor(o.expression):void 0}if("editableExpression"in e&&e.editableExpression){const o=t.get(e.editableExpression);i.editableExpression=o?await r.getArcadeExecutor(o.expression):void 0}if("requiredExpression"in e&&e.requiredExpression){const o=t.get(e.requiredExpression);i.requiredExpression=o?await r.getArcadeExecutor(o.expression):void 0}if("valueExpression"in e&&e.valueExpression){const o=t.get(e.valueExpression);i.valueExpression=o?await r.getArcadeExecutor(o.expression):void 0}return i},e.makeExpressionInfosMap=function(e){return new Map(e?.map(e=>[e.name,e]))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/templates/FieldElementTemplate":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ElementTemplateBase"],function(e,t,r,i,o,n,s,a){"use strict";e.FieldElementTemplate=class extends a.ElementTemplateBase{constructor(e){super(e),this.domain=null,this.group=null,this.hint=null,this.input=null,this.type="field",this.layerTimeZone=null,this.formTimeZone=null}get fieldName(){return this.field.name}get hasValueCalculations(){for(const e of this.layers){const t=this.getExpressionExecutorsForLayer(e);if(t?.valueExpression)return!0}return!1}},t.__decorate([r.property({clonable:"reference"})],e.FieldElementTemplate.prototype,"domain",void 0),t.__decorate([r.property({clonable:"reference",constructOnly:!0})],e.FieldElementTemplate.prototype,"field",void 0),t.__decorate([r.property()],e.FieldElementTemplate.prototype,"fieldName",null),t.__decorate([r.property({clonable:!1})],e.FieldElementTemplate.prototype,"group",void 0),t.__decorate([r.property()],e.FieldElementTemplate.prototype,"hint",void 0),t.__decorate([r.property()],e.FieldElementTemplate.prototype,"input",void 0),t.__decorate([r.property()],e.FieldElementTemplate.prototype,"type",void 0),t.__decorate([r.property()],e.FieldElementTemplate.prototype,"layerTimeZone",void 0),t.__decorate([r.property()],e.FieldElementTemplate.prototype,"formTimeZone",void 0),t.__decorate([r.property()],e.FieldElementTemplate.prototype,"hasValueCalculations",null),e.FieldElementTemplate=t.__decorate([s.subclass("esri.widgets.BatchAttributeForm.templates.FieldElementTemplate")],e.FieldElementTemplate),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/templates/ElementTemplateBase":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Clonable","../../../core/ReactiveMap","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./support/hashElementTemplate"],function(e,t,r,i,o,n,s,a,l,c){"use strict";e.ElementTemplateBase=class extends r.Clonable{constructor(e){super(e),this.description=null,this.label=null,this._expressionExecutorsByLayer=new i}get elementId(){return c.hashElementTemplate(this)}get layers(){return Array.from(this._expressionExecutorsByLayer.keys())}addLayer(e,t=null){this._expressionExecutorsByLayer.set(e,t)}foldIn(e){for(const t of e.layers)this.addLayer(t,e.getExpressionExecutorsForLayer(t))}getExpressionExecutorsForLayer(e){return this._expressionExecutorsByLayer.get(e)??null}},t.__decorate([o.property()],e.ElementTemplateBase.prototype,"description",void 0),t.__decorate([o.property({readOnly:!0})],e.ElementTemplateBase.prototype,"elementId",null),t.__decorate([o.property()],e.ElementTemplateBase.prototype,"label",void 0),t.__decorate([o.property({readOnly:!0})],e.ElementTemplateBase.prototype,"layers",null),t.__decorate([o.property({readOnly:!0})],e.ElementTemplateBase.prototype,"type",void 0),t.__decorate([o.property({clonable:e=>new i(Array.from(e))})],e.ElementTemplateBase.prototype,"_expressionExecutorsByLayer",void 0),e.ElementTemplateBase=t.__decorate([l.subclass("esri.widgets.BatchAttributeForm.templates.ElementTemplateBase")],e.ElementTemplateBase),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/templates/support/hashElementTemplate":function(){define(["exports","../../../../core/has","../../../../core/string","../../../../form/elements/inputs/inputUtils","./templateUtils"],function(e,t,r,i,o){"use strict";const n="";function s(e){return`${e.label??n}.${e.description??n}`}function a(e){return`${e.min??n}.${e.max??n}`}function l(e){return"number"==typeof e?`num:${e}`:e}e.hashElementTemplate=function e(t){return o.isFieldElementTemplate(t)?r.numericHash((p=t,`${s(p)}.${function(e){const t=e.name,r=e.alias??n;return`${t}.${r===t?n:r}.${e.nullable}.${e.type}.${e.length??n}.${e.defaultValue??n}.${e.description??n}.${e.editable}.${e.visible}`}(p.field)}.${c=p.domain,c?"coded-value"===c.type?function(e){const{type:t}=e;return`${t}.${e.codedValues.map(({code:e,name:t})=>`${l(e)}.${t}`).sort().join(".")}`}(c):"range"===c.type?function(e){const{maxValue:t,minValue:r,type:i}=e;return`${i}.${r}.${t}`}(c):JSON.stringify(c):n}.${p.hint??n}.${function(e){if(!e)return n;const{type:t}=e;if(i.isBarcodeScannerInput(e))return t??n;if(i.isComboBoxInput(e)||i.isRadioButtonsInput(e)){const{showNoValueOption:r}=e;return`${t}.${r}.${e.noValueOptionLabel??n}`}if(i.isDatePickerInput(e))return`${t}.${a(e)}`;if(i.isDateTimePickerInput(e)){const r=e.min?.getTime(),i=e.max?.getTime(),{includeTime:o}=e;return`${t}.${r}.${i}.${o}`}if(i.isDateTimeOffsetPickerInput(e)){const r=a(e),{includeTimeOffset:i,timeResolution:o}=e;return`${t}.${r}.${i}.${o}`}if(i.isSwitchInput(e)){const{offValue:r,onValue:i}=e;return`${t}.${l(r)}.${l(i)}`}if(i.isTextAreaInput(e)||i.isTextBoxInput(e))return`${t}.${e.minLength?.toString()??n}.${e.maxLength?.toString()??n}`;if(i.isTimePickerInput(e)){const r=a(e),{timeResolution:i}=e;return`${t}.${r}.${i}`}return JSON.stringify(e)}(p.input)}.${p.layerTimeZone??""}`)).toString():o.isGroupElementTemplate(t)?r.numericHash(function(t){const r=s(t)+`.${t.initialState}`;let i=n;for(const r of t.elements)i+="."+e(r).toString();return`${r}${i}`}(t)).toString():r.numericHash(JSON.stringify(t)).toString();var c,p},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/form/elements/inputs/inputUtils":function(){define(["exports"],function(e){"use strict";e.isBarcodeScannerInput=function(e){return"barcode-scanner"===e.type},e.isComboBoxInput=function(e){return"combo-box"===e.type},e.isDatePickerInput=function(e){return"date-picker"===e.type},e.isDateTimeOffsetPickerInput=function(e){return"datetimeoffset-picker"===e.type},e.isDateTimePickerInput=function(e){return"datetime-picker"===e.type},e.isRadioButtonsInput=function(e){return"radio-buttons"===e.type},e.isSwitchInput=function(e){return"switch"===e.type},e.isTextAreaInput=function(e){return"text-area"===e.type},e.isTextBoxInput=function(e){return"text-box"===e.type},e.isTimePickerInput=function(e){return"time-picker"===e.type},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/templates/GroupElementTemplate":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Error","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ElementTemplateBase"],function(e,t,r,i,o,n,s,a,l){"use strict";e.GroupElementTemplate=class extends l.ElementTemplateBase{constructor(e){super(e),this.initialState="expanded",this.type="group"}initialize(){for(const e of this.elements)e.group=this}foldIn(e){const{elements:t}=this,i=e.elements;if(t.length!==i.length)throw new r("unable-to-fold-in","Unable to fold in the given GroupElementTemplate because it has a different number of child elements");for(const r of e.layers){this.addLayer(r,e.getExpressionExecutorsForLayer(r));for(let e=0;e<t.length;e++)t.at(e).foldIn(i.at(e))}}},t.__decorate([i.property()],e.GroupElementTemplate.prototype,"initialState",void 0),t.__decorate([i.property({constructOnly:!0})],e.GroupElementTemplate.prototype,"elements",void 0),t.__decorate([i.property()],e.GroupElementTemplate.prototype,"type",void 0),e.GroupElementTemplate=t.__decorate([a.subclass("esri.widgets.BatchAttributeForm.templates.GroupElementTemplate")],e.GroupElementTemplate),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/css":function(){define(["exports"],function(e){"use strict";const t="esri-batch-attribute-form",r=`${t}__group`,i=`${t}__input`,o={base:t,form:`${t}__form`,formHeader:`${t}__form-header`,noticeError:`${t}__notice-error`,label:`${t}__label`,labelTextContent:`${t}__label-text-content`,fieldInput:`${i}`,inputRadio:`${i}--radio`,placeholderRadio:`${i}--radio-placeholder`,inputRadioGroup:`${i}--radio-group`,inputRadioLabel:`${i}--radio-label`,inputDisabled:`${i}--disabled`,inputSwitch:`${i}--switch`,centeredButton:`${t}__centered-button`,description:`${t}__description-text`,dateInputContainer:`${t}__date-input-container`,block:`${t}__block`,group:r,groupSequential:`${r}--sequential`,individualElement:`${r}__individual-element`};e.css=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/BatchAttributeForm/VisibleElements":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a){"use strict";e.VisibleElements=class extends r{constructor(e){super(e),this.errorsForNonVisibleFields=!0,this.featureInfo=!0,this.featureSwitcher=!0,this.loadingIndicator=!0}},t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"errorsForNonVisibleFields",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"featureInfo",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"featureSwitcher",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"loadingIndicator",void 0),e.VisibleElements=t.__decorate([a.subclass("esri.widgets.BatchAttributeForm.VisibleElements")],e.VisibleElements),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/FeatureForm":function(){define(["require","../chunks/tslib.es6","../intl","../core/arrayUtils","../core/has","../core/Logger","../core/promiseUtils","../core/ReactiveMap","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","../layers/support/layerUtils","../support/guards","./Widget","./Editor/components/Prompt","./Feature/support/featureUtils","./FeatureForm/css","./FeatureForm/featureFormUtils","./FeatureForm/FeatureFormViewModel","./FeatureForm/VisibleElements","../chunks/componentsUtils","./support/dateUtils","./support/globalCss","./support/Heading","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","../intl/substitute","../intl/number"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F,k,I,T,L){"use strict";const E=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),A="data-field-name";let V=class extends y{constructor(e,t){super(e,t),this._associationsWidgetsMap=new a,this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._inputsWithChanges=new Set,this._focusedFieldName=null,this._pendingSubtypeChoice=null,this._listObserverNode=null,this._listObserver=new IntersectionObserver(e=>{e.length&&e[0].isIntersecting&&this._incrementRelatedRecordPage()},{root:window.document}),this._prompt=null,this._featureFormUNAssociationList=null,this.groupDisplay="all",this.headingLevel=2,this.messages=null,this.messagesCommon=null,this.messagesFeature=null,this.messagesTemplates=null,this.viewModel=new v,this.visibleElements=new _,this._onShowAllRelatedRecordsClick=e=>{const{feature:t,callbacks:r}=this;t&&r?.showAllRelatedRecords&&r.showAllRelatedRecords({parentFeature:t,relationshipId:e})},this._onAddRelatedRecordsClick=(e,t,r)=>{const{feature:i,callbacks:o}=this;let n=r;if(i&&o?.addRelatedRecord){if(u.isSubtypeGroupLayer(r)&&e.activeCategory){const t=e.activeCategory.value,i=r.findSublayerForSubtypeCode(t);i&&f.isRelatableFeatureSupportedLayer(i)&&(n=i)}o.addRelatedRecord({parentFeature:i,relatedLayer:n,relationshipId:t})}},this._onFormKeyDown=this._onFormKeyDown.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onGroupToggle=this._onGroupToggle.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentKeyDown=this._onComponentKeyDown.bind(this),this._afterComponentCreate=this._afterComponentCreate.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterDateComponentCreateOrUpdate=this._afterDateComponentCreateOrUpdate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this),this._afterGroupCreate=this._afterGroupCreate.bind(this)}initialize(){this.addHandles([l.watch(()=>this.feature,()=>{this._inputsWithChanges.clear(),this._dateComponentMap.clear(),l.whenOnce(()=>!this.viewModel.updating).then(()=>{const e=this._getFocusableInput("forward");this._syncGroupInputStates(),this._focusedFieldName=e?.name||null,this._attemptFocusOnNextRender=!0})}),l.watch(()=>[this._featureFormUNAssociationList,this.visibleElements.associationDetails],([e,t])=>{e&&(e.visibleElements.associationDetails=t)},l.initial),l.watch(()=>this.groupDisplay,()=>this._syncGroupInputStates()),this.on("submit",e=>{if(e.invalid.length>0){const[t]=e.invalid;e.invalid.forEach(e=>this._inputsWithChanges.add(e)),this._focusedFieldName=t,this._attemptFocusOnNextRender=!0,this.scheduleRender()}}),l.watch(()=>[this.viewModel.activeRelationshipInput,this._listObserverNode],()=>this._onObserverChange()),l.watch(()=>this.viewModel.activeAssociationInput,e=>{e&&this._featureFormUNAssociationList&&(this._featureFormUNAssociationList.associationInput=e,this._featureFormUNAssociationList.viewModel=e.viewModel)}),l.watch(()=>this.viewModel.inputs.filter(b.isUtilityNetworkAssociationInput),async e=>{this._featureFormUNAssociationList||await this._setUpUtilityNetworkAssociationList();for(const t of e)this._associationsWidgetsMap.has(t)||this._associationsWidgetsMap.set(t,await this._makeAssociationsWidget(t))})])}loadDependencies(){return w.loadCalciteComponents({block:()=>new Promise((t,r)=>e(["../chunks/index13"],t,r)),button:()=>new Promise((t,r)=>e(["../chunks/index2"],t,r)),chip:()=>new Promise((t,r)=>e(["../chunks/index11"],t,r)),combobox:()=>new Promise((t,r)=>e(["../chunks/index21"],t,r)),"combobox-item":()=>new Promise((t,r)=>e(["../chunks/index22"],t,r)),"combobox-item-group":()=>new Promise((t,r)=>e(["../chunks/index23"],t,r)),icon:()=>new Promise((t,r)=>e(["../chunks/index7"],t,r)),input:()=>new Promise((t,r)=>e(["../chunks/index4"],t,r)),"input-date-picker":()=>new Promise((t,r)=>e(["../chunks/index27"],t,r)),"input-message":()=>new Promise((t,r)=>e(["../chunks/index31"],t,r)),"input-number":()=>new Promise((t,r)=>e(["../chunks/index28"],t,r)),"input-time-picker":()=>new Promise((t,r)=>e(["../chunks/index29"],t,r)),"input-time-zone":()=>new Promise((t,r)=>e(["../chunks/index30"],t,r)),label:()=>new Promise((t,r)=>e(["../chunks/index5"],t,r)),list:()=>new Promise((t,r)=>e(["../chunks/index16"],t,r)),"list-item":()=>new Promise((t,r)=>e(["../chunks/index20"],t,r)),loader:()=>new Promise((t,r)=>e(["../chunks/index32"],t,r)),notice:()=>new Promise((t,r)=>e(["../chunks/index6"],t,r)),"radio-button":()=>new Promise((t,r)=>e(["../chunks/index35"],t,r)),"radio-button-group":()=>new Promise((t,r)=>e(["../chunks/index36"],t,r)),switch:()=>new Promise((t,r)=>e(["../chunks/index33"],t,r)),"text-area":()=>new Promise((t,r)=>e(["../chunks/index34"],t,r))})}destroy(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode)}get _relatedRecordsEnabled(){const{callbacks:e}=this;return!(!e||!(e.addRelatedRecord||e.editRelatedRecord||e.showAllRelatedRecords))}get _utilityNetworkAssociationsEnabled(){const{callbacks:e}=this;return!(!e?.viewAssociatedLayers||!e.viewAssociatedFeatures)}get _subtypes(){return u.getSubtypesFromLayer(this.layer)}get associationId(){return this.viewModel.associationId}set associationId(e){this.viewModel.associationId=e}get associatedLayer(){return this.viewModel.associatedLayer}set associatedLayer(e){this.viewModel.associatedLayer=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get feature(){return this.viewModel.feature}set feature(e){this.viewModel.feature=e}get formTemplate(){return this.viewModel.formTemplate}set formTemplate(e){this.viewModel.formTemplate=e}get icon(){return"form-field"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get callbacks(){return this.viewModel.callbacks}set callbacks(e){this.viewModel.callbacks=e}get relationshipId(){return this.viewModel.relationshipId}set relationshipId(e){this.viewModel.relationshipId=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get strict(){return this.viewModel.strict}set strict(e){this.viewModel.strict=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get showPrompt(){return e=>{this._prompt?.cancel?.(),this._prompt=e}}set showPrompt(e){this._overrideIfSome("showPrompt",e)}get clearPrompt(){return()=>this._prompt=null}set clearPrompt(e){this._overrideIfSome("clearPrompt",e)}getValues(){return this.viewModel.getValues()}submit(){return this.viewModel.submit()}render(){const{state:e}=this.viewModel;return I.tsx("div",{class:this.classes(g.css.base,x.globalCss.widget,x.globalCss.panel)},"ready"===e?this._renderForm():null)}_renderForm(){return I.tsx("div",null,I.tsx("form",{class:g.css.form,inert:!!this._prompt,novalidate:!0,onkeydown:this._onFormKeyDown,onsubmit:this._onFormSubmit},this._renderReadOnlyNotice(),this._renderHeader(),this._renderContent()),this._prompt?I.tsx(m.Prompt,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderReadOnlyNotice(){const{disabled:e,messages:t}=this;if(e&&this.visibleElements.readOnlyNotice)return I.tsx("calcite-notice",{class:g.css.disabledNotice,icon:"read-only-non-editable",kind:"brand",open:!0,scale:"s",width:"full"},I.tsx("div",{slot:"message"},t.disabledForm))}_renderHeader(){const e=this.viewModel,{formTitle:t,formDescription:r}=e;if(!e.formHeaderVisible)return;const i=null!=t&&I.tsx(M.Heading,{key:"title",level:this.headingLevel},t),o=null!=r&&I.tsx("p",{class:g.css.description,key:"description"},r);return I.tsx("div",{class:g.css.formHeader},i,o)}_renderContent(){const{viewModel:e}=this;return e.activeRelationshipInput?this._renderRelationshipInput(e.activeRelationshipInput):e.activeAssociationInput?this._renderFeatureFormUtilityNetworkAssociationList():e.inputs.filter(i.isSome).filter(e=>e.visible).map(e=>this._renderInput(e))}_renderInput(e){return b.isGroupInput(e)?this._renderGroup(e):b.isFieldInput(e)?this._renderLabeledField(e):b.isRelationshipInput(e)?this._renderRelationshipInput(e):b.isTextElementInput(e)?this._renderTextElementInput(e):b.isUtilityNetworkAssociationInput(e)?this._renderUtilityNetworkAssociationsElementInput(e):void 0}_renderFeatureFormUtilityNetworkAssociationList(){return this._featureFormUNAssociationList?.render()}_selectAssociatedLayer(e){const{feature:t,callbacks:r}=this;t&&r?.viewAssociatedFeatures&&r.viewAssociatedFeatures({associatedLayer:e.layer})}async _selectAssociatedFeature(e){const{feature:t,callbacks:r}=this;t&&r?.selectAssociatedFeature&&await r.selectAssociatedFeature({parentFeature:t,...e})}_onAddAssociation(e){const{feature:t,callbacks:r}=this;t&&r?.addAssociation&&r.addAssociation(e)}async _setUpUtilityNetworkAssociationList(){if(!this._featureFormUNAssociationList){const t=(await new Promise((t,r)=>e(["./FeatureForm/FeatureFormUtilityNetworkAssociations/FeatureFormUtilityNetworkAssociationList"],e=>t(E(e)),r))).default;this._featureFormUNAssociationList=new t({onSelectLayer:this._selectAssociatedLayer.bind(this),onSelectFeature:this._selectAssociatedFeature.bind(this),onAddAssociation:this._onAddAssociation.bind(this)})}}async _makeAssociationsWidget(t){return new(0,(await new Promise((t,r)=>e(["./Feature/FeatureUtilityNetworkAssociations"],e=>t(E(e)),r))).default)({onSelectAssociationType:({viewModel:e,listType:r})=>{e.activeAssociationType=r;const{feature:i,callbacks:o}=this;i&&o?.viewAssociatedLayers&&o.viewAssociatedLayers({associationId:t.uid})},viewModel:t.associationsViewModel})}_renderUtilityNetworkAssociationsElementInput(e){if(this._utilityNetworkAssociationsEnabled)return this._associationsWidgetsMap.get(e)?.render()}_renderDescriptionOrEmpty(e,t){return null==e?null:I.tsx("div",{class:this.classes(g.css.description),id:t},e)}_renderGroup(e){const{formTemplate:t,headingLevel:r}=this,{description:i,id:o,inputs:n,label:s,open:a}=e,l=n.filter(e=>e.visible),c=this.viewModel.findField(this._focusedFieldName),p=c?.group===e,d="sequential"===this.groupDisplay;return I.tsx("calcite-block",{afterCreate:this._afterGroupCreate,class:this.classes(g.css.group,d?g.css.groupSequential:null,p?g.css.groupActive:null),collapsible:!0,"data-group":e,description:i||void 0,expanded:a,heading:s??"",headingLevel:t?.title?M.incrementHeadingLevel(r):r,id:o,key:o,onCalciteBlockToggle:({currentTarget:t})=>this._onGroupToggle(t,e)},l.map(e=>this._renderInput(e)))}_getFocusableInput(e,t){const r=b.flattenInputs(this.viewModel.inputs);let i;if("backward"===e&&r.reverse(),t)if(b.isGroupInput(t)){const e=t.inputs.find(e=>e.visible);i=e?r.indexOf(e):0}else{let o;if(b.isInputInGroupInput(t)&&!t.group.open){const r=t.group.inputs.filter(b.isFieldInput);o="forward"===e?r[r.length-1]:r[0]}else o=t;i=r.indexOf(o)+1}else i=0;for(let e=i;e<r.length;e++){const t=r[e];if(t.visible&&b.isFieldInput(t)){if(this.disabled&&t.inputType&&("switch"===t.inputType||"radio-buttons"===t.inputType))continue;return t}}return null}_renderLabeledField(e){const{dataType:t,feature:r,label:i,layer:o,required:n}=e,s={"aria-label":n?T.substitute(this.messages.requiredFieldLabel,{name:i}):i,class:g.css.label,key:`${o.id}-${r.uid}-${e.name}`},a=[I.tsx("div",{class:g.css.labelTextContent,key:"labelTextContainer"},i,n?I.tsx("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==t?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e)];return"date"===t&&"coded-value"!==e.domain?.type?I.tsx("label",{...s},a):I.tsx("calcite-label",{...s},a)}_renderFieldInput(e){const{dataType:t,domain:r,inputType:i,name:o}=e,n=this.getCommonInputProps(e);if("coded-value"===r?.type){const t=this.viewModel.getFieldValueOptionsForField(o,this.messages.empty);return"switch"!==i||e.hasInvalidSwitchValue?"radio-buttons"===i?this._renderRadioButtonComponents(e,t.flat(),n):this._renderComboBoxComponent(e,t,n):this._renderSwitchComponent(e,n)}return"datetime-picker"===i||"date"===t?this._renderDateComponents(e,n):"number"===t?this._renderNumberComponent(e,n):this._renderStringComponent(e,n)}_renderStringComponent(e,t){return"text-area"===e.inputType?t.readOnly?I.tsx("calcite-input",{...t,loading:e.updating,type:"textarea",onCalciteInputInput:e=>this._saveValueFromComponent(e.currentTarget)}):I.tsx("calcite-text-area",{...t,resize:"vertical",onCalciteTextAreaInput:e=>this._saveValueFromComponent(e.currentTarget)}):I.tsx("calcite-input",{...t,loading:e.updating,type:"text",onCalciteInputInput:e=>this._saveValueFromComponent(e.currentTarget)})}_renderNumberComponent(e,t){const r=d.isIntegerField(e.field),i=r&&""!==t.value?Math.round(parseFloat(t.value)).toString():t.value;return I.tsx("calcite-input-number",{...t,integer:r,loading:e.updating,type:"number",value:i,onCalciteInputNumberInput:e=>this._saveValueFromComponent(e.currentTarget)})}_renderDateComponents(e,t){const{field:r}=e;switch(r.type){case"date":return this._renderDateFieldComponents(e,t);case"date-only":return this._renderDateOnlyFieldComponent(e,t);case"time-only":return this._renderTimeOnlyFieldComponent(e,t);case"timestamp-offset":return this._renderTimestampOffsetFieldComponents(e,t);default:return this._renderReadOnlyComponent(e,S.getLabelForDateFieldValue(r,t.value,{timeZone:this.timeZone,...S.getIntlOptionsForField(r)}))}}_renderDateOnlyFieldComponent(e,t){const{range:r,valid:i,value:o}=e,{class:n,key:s,readOnly:a}=t,{rawMax:l,rawMin:c}=r;return I.tsx("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!i,class:n,"data-date-part":"date","data-field-name":t[A],key:`${s}-date-input`,max:h.isString(l)?l:void 0,min:h.isString(c)?c:void 0,numberingSystem:S.numberingSystem,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:a,value:null!=o?`${o}`:void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)})}_renderTimeOnlyFieldComponent(e,t){const{valid:r,value:i}=e,{class:o,key:n,readOnly:s}=t;return I.tsx("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!r,class:o,"data-date-part":"time","data-field-name":t[A],key:`${n}-time-input`,numberingSystem:S.numberingSystem,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:s,step:e.timeStep,value:null!=i?`${i}`:void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)})}_renderTimestampOffsetFieldComponents(e,t){const{name:r,range:i,timeZone:o,valid:n,value:s}=e,{class:a,key:l,readOnly:c}=t,{rawMax:p,rawMin:d}=i,u={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!n,numberingSystem:S.numberingSystem,overlayPositioning:"fixed",readOnly:c,[A]:r,onfocus:this._onComponentFocus},h=S.prepareISOFieldValueForDateComponents(p,o),y=S.prepareISOFieldValueForDateComponents(d,o),m=S.prepareISOFieldValueForDateComponents(s,o);return I.tsx("div",{class:g.css.dateInputContainer,key:`${l}-date-time-container`},I.tsx("calcite-input-date-picker",{...u,class:a,"data-date-part":"date",key:`${l}-date-input`,max:h?.date??void 0,min:y?.date??void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:m.date??void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}),I.tsx("calcite-input-time-picker",{...u,class:a,"data-date-part":"time",key:`${l}-time-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:e.timeStep,value:m.time??void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}),e.includeTimeOffset?I.tsx("calcite-input-time-zone",{...u,class:a,"data-date-part":"timeZone",disabled:c,key:`${l}-timezone-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:m.timeZoneOffset??"0",onCalciteInputTimeZoneChange:e=>this._saveValueFromDateComponent(e.currentTarget)}):null)}_renderDateFieldComponents(e,t){const{includeTime:r,name:i,valid:o,value:n}=e,{class:s,key:a,max:l,min:c,readOnly:p}=t,{timeZone:d}=this,u={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterDateComponentCreateOrUpdate,"aria-invalid":!o,numberingSystem:S.numberingSystem,overlayPositioning:"fixed",readOnly:p,[A]:i,onfocus:this._onComponentFocus},h=S.prepareUnixFieldValueForDateComponents(n,d),y=S.prepareUnixFieldValueForDateComponents(l,d),m=S.prepareUnixFieldValueForDateComponents(c,d);return I.tsx("div",{class:g.css.dateInputContainer,key:`${a}-date-time-container`},I.tsx("calcite-input-date-picker",{...u,class:s,"data-date-part":"date",key:`${a}-date-input`,max:y?.date??void 0,min:m?.date??void 0,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},value:h.date??void 0,onCalciteInputDatePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}),r?I.tsx("calcite-input-time-picker",{...u,class:s,"data-date-part":"time",key:`${a}-time-input`,onblur:e=>{this._focusedFieldName=null,this._saveValueFromDateComponent(e.target)},step:1,value:h.time??void 0,onCalciteInputTimePickerChange:e=>this._saveValueFromDateComponent(e.currentTarget)}):null)}_renderReadOnlyComponent(e,t){const r=this.getCommonInputProps(e);return I.tsx("calcite-input",{...r,class:this.classes(g.css.fieldInput,g.css.inputDisabled),readOnly:!0,type:"text",value:null!=t?`${t}`:r.value})}_renderComboBoxComponent(e,t,r){const{value:i,name:o}=e,{viewModel:n,_inputsWithChanges:s}=this,a="INSERT"===n.editType,l=s.has(o),c=null==i&&(!a||l),p=a&&e.showNoValueOptionEnabled&&!l?()=>{}:r.onblur;return I.tsx("calcite-combobox",{...r,allowCustomValues:!1,clearDisabled:!0,onblur:p,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:t})=>{c&&0===t.selectedItems.length?this._ignoreDeselectionOfNoValueOption(t):e.isSubtypeField&&0===t.selectedItems.length?t.value=`${e.value}`:this._saveValueFromComponent(t)}},this.renderComboboxOptionsList(e,t))}renderComboboxOptionsList(e,t){const{value:r,name:i}=e,{messages:o,messagesTemplates:n,viewModel:s,_inputsWithChanges:a}=this,[l,c,p]=t.map(e=>e.map(({name:e,value:t})=>I.tsx("calcite-combobox-item",{key:`#${t}`,selected:r===t,textLabel:e,value:`${t}`}))),d=[];c.length>0&&d.push(I.tsx("calcite-combobox-item-group",{key:"other",label:n.other},c)),p.length>0&&d.push(I.tsx("calcite-combobox-item-group",{key:"unsupported",label:o.subtypes.unsupportedDomainGroupTitle},p)),d.length>0?d.unshift(I.tsx("calcite-combobox-item-group",{key:"recommended",label:o.recommended},l)):d.push(...l);const u="INSERT"===s.editType,h=a.has(i),y=null==r&&(!u||h);return e.showNoValueOptionEnabled&&d.unshift(I.tsx("calcite-combobox-item",{key:"empty-option",selected:y,textLabel:e.showNoValueLabel||o.empty,value:""})),d}_renderRadioButtonComponents(e,t,r){const{name:i,value:o}=e,n=t.map(({name:e,value:t})=>this._renderRadioButtonComponent({key:e,label:e,name:i,value:t,selected:t===o,props:r}));if(e.showNoValueOptionEnabled){const t="",s=e.showNoValueLabel||this.messages.empty,a=o===t||null===o;n.unshift(this._renderRadioButtonComponent({key:"empty-option",label:s,name:i,value:t,selected:a,props:r}))}return I.tsx("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:g.css.inputRadioGroup,"data-field-name":r[A],key:`${r.key}-radio-group`,layout:"vertical",name:r.key,required:r.required},n)}_renderSwitchComponent(e,t){const{value:r}=e,i=!!b.isFieldElementWithInputType(e.element,"switch")&&r===e.element.input.onValue;return I.tsx("calcite-switch",{...t,checked:i,class:g.css.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldName=null},onCalciteSwitchChange:e=>this._saveValueFromComponent(e.currentTarget)})}_renderRadioButtonComponent({key:e,name:t,value:r,selected:i,label:o,props:n}){return I.tsx("calcite-label",{class:g.css.inputRadioLabel,key:e,layout:"inline"},I.tsx("calcite-radio-button",{...n,afterCreate:void 0,afterUpdate:void 0,checked:i,class:g.css.inputRadio,disabled:n.readOnly,name:t,onblur:()=>{this._focusedFieldName=null},value:r,onCalciteRadioButtonChange:({currentTarget:e})=>{e.checked&&this._saveValueFromComponent(e)}}),o)}_renderAuxiliaryText(e){const t=e.name,r=this._inputsWithChanges.has(t)&&!e.submittable?b.getErrorMessageForFieldInput(e,this.messages,this.timeZone):null!=this.viewModel.contingencyConstraintViolations.get(t)?this.messages.validationErrors.valuesIncompatible:null!=e.valueExpressionExecutor&&e.valueExpressionExecutor.stale?this.messages.valueExpressionError:null;return null!=r?I.tsx("calcite-input-message",{icon:!0,status:"invalid"},r):this._inputsWithChanges.has(t)&&e.valueIsOutOfDomain?I.tsx("calcite-input-message",{icon:!0,status:"idle"},this.messages.subtypes.fieldOutOfSubtypeDomainWarning):this._renderDescriptionOrEmpty(e.description)}_renderShowAllRelatedRecordsListItem(e){if(!e.showAllActionVisible||!this.callbacks?.showAllRelatedRecords)return;const t=this.messages;return I.tsx("calcite-list-item",{description:T.substitute(t.totalCount,{count:e.featureCount}),key:"show-all-related-features",label:t.showAll,value:!0,onCalciteListItemSelect:()=>this._onShowAllRelatedRecordsClick(e.relationshipId)},I.tsx("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderAddRelatedRecordButton(e){const{canAddRelatedFeature:t,relationshipId:r,relatedLayer:i,editable:o}=e,{messages:n,callbacks:s,disabled:a}=this,l=!o||a;if(t&&s?.addRelatedRecord&&i&&!l)return I.tsx("calcite-button",{alignment:"center",appearance:"outline-fill",class:g.css.centeredButton,disabled:e.updating||!e.originHasValidKey,iconStart:"plus",key:`${r}-add-button`,onclick:()=>{!e.updating&&e.originHasValidKey&&this._onAddRelatedRecordsClick(e,r,i)},round:!0,scale:"s",width:"full"},e.relatedLayerIsTable?n.addRecord:n.addFeature)}_renderRelatedRecordListItem(e,t,r){const{feature:i,description:o,title:n}=e,{feature:s,callbacks:a}=this,{highlightHelper:l}=this.viewModel,c=l?()=>l.add(i):void 0,p=l?()=>l.remove(i):void 0;return I.tsx("calcite-list-item",{bind:this,description:o,key:`${t}-${i.uid}`,label:n,onmouseenter:c,onmouseleave:p,value:n,onCalciteListItemSelect:()=>{l?.removeAll(),a?.editRelatedRecord&&s&&a.editRelatedRecord({parentFeature:s,relationshipId:t,relatedFeature:i,readOnly:r})}},I.tsx("calcite-icon",{icon:b.getIconForFeature(i),slot:"content-start"}),I.tsx("calcite-icon",{icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderRelationshipInput(e){if(!this._relatedRecordsEnabled)return;const{relationshipId:t,activeCategory:r}=e,i=r?null:this._renderDescriptionOrEmpty(e.description);return I.tsx("calcite-label",{class:this.classes(g.css.label,g.css.relatedRecordsLabel),key:`relationship-${t}-container`},I.tsx("div",null,this._renderRelatedRecordsHeaderContainer(e),i,this._renderRelationshipInputContent(e)),this._renderAddRelatedRecordButton(e))}_renderRelationshipInputContent(e){return e.featureCount>0?this._renderRelatedRecordsList(e):e.activeCategory&&0===e.featureCount?this._renderNoRelatedRecordsNotice():e.allCategories?.length?this._renderCategoryList(e):e.loaded?e.originHasValidKey?this._renderNoRelatedRecordsNotice():this._renderNoValidOriginKeyNotice(e):void 0}_renderCategoryList(e){return I.tsx("calcite-list",{displayMode:"flat",label:this.messages.relatedRecordsList,loading:e.updating},e.categories?.map(t=>this._renderCategory(e,t)),this._renderShowAllCategoriesListItem(e))}_renderCategory(e,t){const{count:r,name:i,value:o}=t,n=L.formatNumber(r);return I.tsx("calcite-list-item",{key:`${i}-${o}`,label:i,onCalciteListItemSelect:()=>this._selectCategory(e,t)},I.tsx("calcite-chip",{label:n,scale:"s",slot:"content-end"},n),I.tsx("calcite-icon",{flipRtl:!0,icon:"chevron-left",scale:"s",slot:"content-end"}))}_selectCategory(e,t){this.relationshipId=e.relationshipId,e.activeCategory=t}_renderShowAllCategoriesListItem(e){if(!e.showAllCategoriesVisible)return;const t=this.messages;return I.tsx("calcite-list-item",{description:T.substitute(t.totalCount,{count:e.allCategories?.length??0}),key:"show-all-categories",label:t.showAll,value:!0,onCalciteListItemSelect:()=>e.showAllEnabled=!0},I.tsx("calcite-icon",{icon:"list",scale:"s",slot:"content-end"}))}_renderRelatedRecordsHeaderContainer(e){const t=e.updating||!e.loaded;return I.tsx("div",{class:g.css.relatedRecordsHeader,key:`relationship-${e.relationshipId}-header`},I.tsx("span",null,e.label),t?I.tsx("calcite-loader",{inline:!0,key:"loader",label:this.messagesCommon?.loading,scale:"s",type:"indeterminate"}):void 0)}_renderRelatedRecordsList(e){const{relationshipId:t,editable:r}=e,{disabled:i}=this,o=!r||i;return I.tsx("calcite-list",{class:g.css.relatedRecordsList,label:this.messages?.relatedRecordsList},e.relatedFeatureInfos.map(e=>this._renderRelatedRecordListItem(e,t,o)),this._renderShowAllRelatedRecordsListItem(e),this._renderObserverNode())}_renderNoValidOriginKeyNotice(e){const{messages:t}=this,r=e.relatedLayerIsTable?t.noOriginKeyRecord:t.noOriginKeyFeature,i=e.relationship?.keyField,o=this.viewModel.findField(i),n=e.layer?.fieldsIndex.get(i),s=o?.label||n?.alias||i,a=T.substitute(r,{relatedLayerName:e.relatedLayer?.title,originKeyField:s});return I.tsx("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},I.tsx("div",{slot:"message"},a))}_renderNoRelatedRecordsNotice(){return I.tsx("calcite-notice",{icon:"information",kind:"brand",open:!0,scale:"s",width:"full"},I.tsx("div",{slot:"message"},this.messagesFeature.noRelatedFeatures))}_renderObserverNode(){if(this.viewModel.activeRelationshipInput?.showAllEnabled)return I.tsx("div",{afterCreate:this._afterListObserverCreated,afterRemoved:this._afterListObserverRemoved,bind:this,class:g.css.listObserver,key:"feature-observer"})}_renderTextElementInput(e){return I.tsx("div",{class:g.css.textElement,"data-testid":`text-element-${e.label}`,innerHTML:e.text,key:e.id})}getCommonInputProps(e){const{disabled:t}=this,{editable:r,hint:i,label:o,maxLength:n,minLength:s,name:a,range:{max:l,min:c},required:p,valid:d,value:u}=e,h=this._inputsWithChanges.has(a),y=!r||t;return{afterCreate:this._afterComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":d?"false":"true",class:this.classes(g.css.fieldInput,y?g.css.inputDisabled:null),status:h&&!d?"invalid":"idle",key:a,label:o,max:null!=l?l:void 0,min:null!=c?c:void 0,maxLength:n>-1?n:void 0,minLength:s>-1?s:void 0,placeholder:i??void 0,readOnly:y,required:p,value:null==u?"":`${u}`,onblur:this._onComponentBlur,onfocus:this._onComponentFocus,onkeydown:this._onComponentKeyDown,[A]:a}}_getFieldInputFromHTMLElement(e){return this.viewModel.findField(e.getAttribute(A))}_afterDateComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e),r=e.dataset.datePart,i=this._dateComponentMap.get(t.name);if("valueAsDate"in e&&null!=e.value&&null!=t.value){const r=new ResizeObserver(()=>{switch(e.value=void 0,t.field.type){case"date":e.value=S.prepareUnixFieldValueForDateComponents(t.value,this.timeZone).date??"";break;case"timestamp-offset":e.value=S.prepareISOFieldValueForDateComponents(t.value,this.timeZone).date??"";break;default:e.value=`${t.value}`}r.unobserve(e)});r.observe(e)}if(null!=i)switch(r){case"date":i.date=e;break;case"time":i.time=e;break;case"timeZone":i.timeZone=e}else this._dateComponentMap.set(t.name,{[r]:e});this._afterDateComponentCreateOrUpdate(e)}_afterDateComponentCreateOrUpdate(e){this._afterComponentCreateOrUpdate(e)}_afterComponentCreate(e){const t=this._getFieldInputFromHTMLElement(e);b.isNumberFieldInput(t)&&null!=e.value&&"setNumberValue"in e&&e.setNumberValue({committing:!1,value:e.value,origin:"direct"}),this._afterComponentCreateOrUpdate(e)}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,r=e.querySelector("calcite-radio-button"),i=t||r;i&&this._afterComponentCreateOrUpdate(i)}_afterComponentCreateOrUpdate(e){const{viewModel:t}=this,r=this._getFieldInputFromHTMLElement(e),i=t.findField(this._focusedFieldName);this._attemptFocusOnNextRender&&i===r&&(this._attemptFocusOnNextRender=!1,b.isInputInGroupInput(r)&&(r.group.open=!0),C.setFocus(e))}async _afterGroupCreate(e){const t=this.viewModel.findGroup(e.id),r=this.viewModel.findField(this._focusedFieldName);r&&t&&b.isInputInThisGroupInput(r,t)&&(!r.editable||this.disabled)&&(await e.componentOnReady(),this._attemptFocusOnNextRender=!0,this.scheduleRender())}_onComponentFocus(e){const t=e.target,r=this._getFieldInputFromHTMLElement(t);this._focusedFieldName=r.name}_onComponentBlur(e){const t=e.target;this._focusedFieldName=null,"readOnly"in t&&t.readOnly||this._saveValueFromComponent(t)}_saveValueFromDateComponent(e){const{timeZone:t}=this,r=this._getFieldInputFromHTMLElement(e),i=r.field.type,{name:o,range:n}=r,s=this._dateComponentMap.get(o);if(!s)return;let a=this.viewModel.getValue(o),l=null;"date-only"===i?l=Array.isArray(e.value)?e.value[0]:e.value:"time-only"===i?(a=S.normalizeTimeOnlyString(a),l=S.normalizeTimeOnlyString(e.value)):l="timestamp-offset"===i?null!=e.value?S.getISOFieldValueFromDateComponents({dateComponent:s.date,timeComponent:s.time,timeZoneComponent:s.timeZone,oldValue:a,defaultTimeZone:t}):null:null!=e.value?S.getUnixFieldValueFromDateComponents({oldValue:a,dateComponent:s.date,timeComponent:s.time,timeZone:t,max:n.max,min:n.min}):null,null!==l&&e.value?a!==l&&this._updateFieldValue(o,l):this._updateFieldValue(o,null)}_saveValueFromComponent(e){const t=this._getFieldInputFromHTMLElement(e),r=this._parseValue(e),i=t.value;t.isSubtypeField&&b.subtypeChangeShouldPrompt(this.layer,i,r)?this._pendingSubtypeChoice||r===i||(this._pendingSubtypeChoice=this._handleSubtypeChoice(t,r)):this._updateFieldValue(t.name,r)}async _handleSubtypeChoice(e,t){const{value:r,name:i}=e,{messages:o,viewModel:n,messagesCommon:a,_subtypes:l}=this;if(this._updateFieldValue(i,t),!l?.length)return;const c=l.find(e=>e.code===t),p=l.find(e=>e.code===r)?.name??`${r}`;if(!c)return;const d=s.createResolver();n.pendingSubtypeChoice=d;let u="update-fields";const h=[{label:o.subtypes.useDefaultValuesOption,value:"update-fields"},{label:o.subtypes.keepCurrentValuesOption,value:"keep-existing"}],y={context:"info",title:o.subtypes.changeWarningTitle,message:T.substitute(o.subtypes.changeWarning,{originalType:p,newType:c.name}),radios:h,defaultRadioSelection:"update-fields",onRadioSelection:e=>u=e,actions:{primary:{label:a.apply,action:()=>d.resolve(u),type:"positive"},secondary:{label:a.cancel,type:"neutral",action:()=>d.resolve("undo")}},cancel:()=>d.reject()};try{switch(this.showPrompt(y),await d.promise){case"update-fields":n.applySubtypeDefaults(c),this._validateContingenciesForNonNullFields();break;case"keep-existing":this._validateContingenciesForNonNullFields();break;case"undo":this._updateFieldValue(e.name,r)}}finally{n.pendingSubtypeChoice=null,this.clearPrompt(),this._pendingSubtypeChoice=null}}_onComponentKeyDown({key:e,target:t}){const r=this._getFieldInputFromHTMLElement(t);"Enter"===e&&b.isInputInGroupInput(r)&&!r.group.open&&(r.group.open=!0)}_updateFieldValue(e,t){const r=this.viewModel.getValue(e);this.viewModel.setValue(e,t),this._inputsWithChanges.add(e),r!==t&&this.viewModel.fieldsWithContingentValues.has(e)&&this._validateContingenciesForNonNullFields()}_validateContingenciesForNonNullFields(){const e=Object.fromEntries(Object.entries(this.getValues()).filter(([e,t])=>null!=t));this.viewModel.validateContingencyConstraints(e)}_parseValue(e){const t=this._getFieldInputFromHTMLElement(e),r=e.value;return b.isFieldElementWithInputType(t.element,"switch")?e.checked?t.element.input.onValue:t.element.input.offValue:null==r||""===r?null:"number"===t.dataType?"-0"===r||"-0."===r||"-0,"===r?r:parseFloat(r):"date"===t.field.type?parseFloat(r):r}_ignoreDeselectionOfNoValueOption(e){const{firstChild:t,selectedItems:r}=e;0===r.length&&t&&"selected"in t?t.selected=!0:n.getLogger(this).warnOnce("Failed to override user attempt to deselect 'No value' option.")}_onGroupToggle(e,t){e.expanded?(t.open=!0,this._focusedFieldName=this._getFocusableInput("forward",t)?.name||null,this._attemptFocusOnNextRender=!0,"sequential"===this.groupDisplay&&this.viewModel.allGroupInputs.forEach(e=>{e!==t&&(e.open=!1)})):t.open=!1,this.scheduleRender()}_onFormSubmit(e){e.preventDefault()}_onFormKeyDown(e){"Enter"===e.key&&this.viewModel.submit()}_afterListObserverCreated(e){this.viewModel.activeRelationshipInput&&(this._listObserverNode=e)}_afterListObserverRemoved(){this._listObserverNode=null}_onObserverChange(){this._listObserverNode&&this._listObserver.unobserve(this._listObserverNode);const e=this.viewModel.activeRelationshipInput;e&&this._listObserverNode&&e.showAllEnabled&&this._listObserver.observe(this._listObserverNode)}_incrementRelatedRecordPage(){const e=this.viewModel.activeRelationshipInput;e?.incrementPage()}_syncGroupInputStates(){if("sequential"!==this.groupDisplay)return;const e=this.viewModel.allGroupInputs;if(!e.length)return;const t=e.filter(e=>e.open);0===t.length?e[0].open=!0:t.length>1&&t.slice(1).forEach(e=>e.open=!1)}get test(){return{inputsWithChanges:this._inputsWithChanges,updateValue:this._saveValueFromComponent.bind(this)}}};return t.__decorate([c.property()],V.prototype,"_listObserverNode",void 0),t.__decorate([c.property()],V.prototype,"_relatedRecordsEnabled",null),t.__decorate([c.property()],V.prototype,"_utilityNetworkAssociationsEnabled",null),t.__decorate([c.property()],V.prototype,"_prompt",void 0),t.__decorate([c.property()],V.prototype,"_subtypes",null),t.__decorate([c.property()],V.prototype,"associationId",null),t.__decorate([c.property()],V.prototype,"associatedLayer",null),t.__decorate([c.property()],V.prototype,"disabled",null),t.__decorate([c.property()],V.prototype,"feature",null),t.__decorate([c.property()],V.prototype,"_featureFormUNAssociationList",void 0),t.__decorate([c.property()],V.prototype,"formTemplate",null),t.__decorate([c.property()],V.prototype,"groupDisplay",void 0),t.__decorate([c.property()],V.prototype,"headingLevel",void 0),t.__decorate([c.property()],V.prototype,"icon",null),t.__decorate([c.property()],V.prototype,"label",null),t.__decorate([c.property()],V.prototype,"layer",null),t.__decorate([c.property()],V.prototype,"map",null),t.__decorate([c.property(),F.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],V.prototype,"messages",void 0),t.__decorate([c.property(),F.messageBundle("esri/t9n/common")],V.prototype,"messagesCommon",void 0),t.__decorate([c.property(),F.messageBundle("esri/widgets/Feature/t9n/Feature")],V.prototype,"messagesFeature",void 0),t.__decorate([c.property(),F.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],V.prototype,"messagesTemplates",void 0),t.__decorate([c.property()],V.prototype,"callbacks",null),t.__decorate([c.property()],V.prototype,"relationshipId",null),t.__decorate([c.property()],V.prototype,"spatialReference",null),t.__decorate([c.property()],V.prototype,"strict",null),t.__decorate([c.property()],V.prototype,"timeZone",null),t.__decorate([c.property()],V.prototype,"showPrompt",null),t.__decorate([c.property()],V.prototype,"clearPrompt",null),t.__decorate([c.property(),k.vmEvent(["value-change","submit"])],V.prototype,"viewModel",void 0),t.__decorate([c.property({type:_,nonNullable:!0})],V.prototype,"visibleElements",void 0),t.__decorate([c.property()],V.prototype,"test",null),V=t.__decorate([p.subclass("esri.widgets.FeatureForm")],V),V})},"esri/widgets/Editor/components/Prompt":function(){define(["require","exports","../../../chunks/componentsUtils","../../support/Heading","../../support/iconUtils","../../support/widgetUtils","../../support/jsxFactory"],function(e,t,r,i,o,n,s){"use strict";const a="esri-editor__prompt",l={base:a,header:`${a}__header`,heading:`${a}__header__heading`,message:`${a}__message`,divider:`${a}__divider`,actions:`${a}__actions`,halfWidthButton:`${a}__half-width-button`};t.Prompt=function({actions:e,context:t,headingLevel:r,message:a,title:c,...p}){const{primary:d,secondary:u}=e;let h;switch(t){case"danger":h="danger";break;case"info":h="brand";break;default:h="neutral"}const y=s.tsx("calcite-button",{afterCreate:e=>n.setFocus(e),appearance:"solid",classes:{[l.halfWidthButton]:!!u},"data-testid":"primary-prompt-button",key:"prompt-primary-button",kind:h,onclick:d.action,width:"full"},d.label),m=u&&s.tsx("calcite-button",{appearance:"outline",class:l.halfWidthButton,"data-testid":"secondary-prompt-button",key:"prompt-secondary-button",kind:h,onclick:u.action,width:"full"},u.label);return s.tsx("calcite-scrim",{"data-testid":"prompt",key:"prompt"},s.tsx("div",{class:`${l.base}--${t}`},s.tsx("div",{class:l.header},s.tsx("calcite-icon",{icon:o.iconByKind.warning}),s.tsx(i.Heading,{class:l.heading,level:r},c)),s.tsx("div",{class:l.message},a),function({radios:e,onRadioSelection:t,defaultRadioSelection:r}){return e?.length?s.tsx("calcite-radio-button-group",{name:"PromptChoiceList"},e.map(e=>s.tsx("calcite-label",{layout:"inline"},s.tsx("calcite-radio-button",{checked:e.value===r,value:e.value,onCalciteRadioButtonChange:()=>t?.(e.value)}),e.label))):void 0}(p)??s.tsx("div",{class:l.divider}),s.tsx("div",{class:l.actions},m,y)))},t.css=l,t.loadPromptComponents=()=>r.loadCalciteComponents({button:()=>new Promise((t,r)=>e(["../../../chunks/index2"],t,r)),icon:()=>new Promise((t,r)=>e(["../../../chunks/index7"],t,r)),scrim:()=>new Promise((t,r)=>e(["../../../chunks/index10"],t,r)),label:()=>new Promise((t,r)=>e(["../../../chunks/index5"],t,r)),"radio-button":()=>new Promise((t,r)=>e(["../../../chunks/index35"],t,r)),"radio-button-group":()=>new Promise((t,r)=>e(["../../../chunks/index36"],t,r))}),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/Heading":function(){define(["exports","../../core/mathUtils","./globalCss","./widgetUtils","./jsxFactory"],function(e,t,r,i,o){"use strict";function n(e){return t.clamp(Math.ceil(e),1,6)}e.Heading=function({level:e,class:t,...s},a){const l=n(e),c=`h${l}`;return o.tsx(c,{...s,"aria-level":String(l),class:i.classes(r.globalCss.heading,t),role:"heading"},a)},e.incrementHeadingLevel=function(e,t=1){return n(e+t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/iconUtils":function(){define(["exports"],function(e){"use strict";e.getIconForLayer=function(e){if(null==e||"object"!=typeof e)return"layer";if("isTable"in e&&e.isTable)return"table";if("type"in e){if("feature"===e.type)return"feature-layer";if("group"===e.type)return"layers";if("subtype-group"===e.type)return"subtype";if("graphics"===e.type)return"layer-graphics"}return"layer"},e.iconByKind={danger:"exclamation-mark-circle",info:"information",success:"check",warning:"exclamation-mark-triangle",brand:void 0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/FeatureForm/css":function(){define(["exports"],function(e){"use strict";const t="esri-feature-form",r=`${t}__group`,i=`${t}__input`,o=`${t}__related-records`,n={base:t,form:`${t}__form`,formHeader:`${t}__form-header`,label:`${t}__label`,labelTextContent:`${t}__label-text-content`,fieldInput:`${i}`,inputRadio:`${i}--radio`,inputRadioGroup:`${i}--radio-group`,inputRadioLabel:`${i}--radio-label`,inputDisabled:`${i}--disabled`,inputSwitch:`${i}--switch`,centeredButton:`${t}__centered-button`,description:`${t}__description-text`,listObserver:`${t}__list-observer`,relatedRecordsHeader:`${o}_header`,relatedRecordsLabel:`${o}_label`,relatedRecordsList:`${o}_list`,dateInputContainer:`${t}__date-input-container`,textElement:`${t}__text-element`,group:r,groupSequential:`${r}--sequential`,groupActive:`${r}--active`,disabledNotice:`${t}__disabled-notice`};e.css=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/FeatureForm/FeatureFormViewModel":function(){define(["require","../../chunks/tslib.es6","../../Graphic","../../core/compilerUtils","../../core/Evented","../../core/Logger","../../core/maybe","../../core/Promise","../../core/promiseUtils","../../core/reactiveUtils","../../core/string","../../core/accessorSupport/decorators/property","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles","../../form/FormTemplate","../../form/support/formUtils","../../layers/support/ContingentValue","../../layers/support/editableLayers","../../layers/support/LayerContingentValuesCache","../../time/constants","./featureFormUtils","./FieldInput","./FormExpressionsManager","./GroupInput","./RelationshipInput","./TextElementInput","../support/forms/expressions/FormExpressionArcadeExecutor"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F,k){"use strict";const I=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),T=new r({attributes:{}}),L={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"],utilityNetworkAssociations:["editableExpression","visibilityExpression"]},E="#JSAPI_CONTINGENT_VALUE_ANY_HASH";let A=class extends(a.EsriPromiseMixin(o.EventedAccessor)){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=T.clone(),this._initialFeature=T.clone(),this._timeZone=null,this._updatingHandles=new y.UpdatingHandles,this.activeAssociation=null,this.editType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.callbacks=null,this.strict=!1,this.pendingSubtypeChoice=null,this._updateInputs=l.debounce(async()=>{this._stopExpressions();const{_featureClone:e,_initialFeature:t,editType:r,formTemplate:i,inputs:o,layer:n,timeZone:s}=this;if(!n)return;const a={editType:r,feature:e,initialFeature:t,layer:n,timeZone:s},l=o.slice(),c=i?.elements&&i.elements.length>0?await this._updateInputsUsingFormElements(l,i.elements,a):this._updateInputsUsingLayerFields(l,n?.fields,a);this.inputs=c,this._startExpressions()})}initialize(){const e=c.watch(()=>[this.layer,!!this.layer?.loaded,this.formTemplate,this.feature,this.timeZone,this.editType],([e,t])=>{null!=e&&(t?this._updatingHandles.addPromise(this._updateInputs()):e.load().catch(()=>{}))},c.syncAndInitial),t=c.watch(()=>this._arcadeContextInfo,e=>{null!=this._expressionsManager&&(this._expressionsManager.arcadeContextInfo=e,this._evaluateExpressions(e=>e.evaluateAll()))}),r=c.watch(()=>this.layer,e=>{const t="subtype-sublayer"===e?.type?e.parent:"feature"===e?.type?e:null;t&&this.addResolvingPromise(v.createLoadedLayerContingentValuesCache(t).then(e=>{this._contingentValuesCache=e,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([e,t,r])}destroy(){this.feature=null,this.layer=null,this._contingentValuesCache=s.destroyMaybe(this._contingentValuesCache),this.highlightHelper?.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){return new Map(this.formTemplate?.expressionInfos?.map(e=>[e.name,e]))}get activeAssociationInput(){return this.allAssociationInputs.find(e=>e.uid===this.associationId)}get activeRelationshipInput(){return this.allRelationshipInputs.find(e=>e.relationshipId===this.relationshipId||e.activeCategory||e.showAllEnabled)}get _arcadeContextInfo(){const{_initialFeature:e,editType:t,layer:r,map:i,spatialReference:o,timeZone:n}=this;return{layer:b.isEditableLayer(r)?r:null,originalFeature:e,editType:t,map:i,spatialReference:o,timeZone:n}}get associationId(){return this._get("associationId")}set associationId(e){null==e&&this.activeAssociationInput?.viewModel&&(this.activeAssociationInput.associatedLayer=null,this.activeAssociationInput.viewModel.activeAssociationType=null),this._set("associationId",e)}get associatedLayer(){return this.activeAssociationInput?.associatedLayer}set associatedLayer(e){this.activeAssociationInput&&(this.activeAssociationInput.associatedLayer=e)}get allAssociationInputs(){return w.flattenAssociationInputs(this.inputs)}get allFieldInputs(){return w.flattenFieldInputs(this.inputs)}get allGroupInputs(){return this.inputs.filter(w.isGroupInput)}get allRelationshipInputs(){return w.flattenRelationshipInputs(this.inputs)}get _layerFieldsByName(){return new Map(this.layer?.fields.map(e=>[e.name,e]))}get feature(){return this._get("feature")}set feature(e){const t=this._get("feature");this._featureClone=e?e.clone():T.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(t=>t.feature=e)):(this.inputs.forEach(e=>e.destroy()),this.inputs.length=0),t!==e&&(this.pendingSubtypeChoice=null),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(null==this._contingentValuesCache)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap(e=>e.fields);return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){void 0===e?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:t}=this;return e?.description&&t?w.parseFormTemplateString({label:e.description,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:t}=this;return e?.title&&t?w.parseFormTemplateString({label:e.title,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,activeAssociationInput:t,formDescription:r,formTitle:i}=this;return!(e||t||!r&&!i)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){return this.feature?.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const t=this.allRelationshipInputs;if(null!=e&&e===this.relationshipId||t.forEach(e=>{e.showAllEnabled=!1,e.activeCategory=null}),null!=e){const r=t.find(t=>t.relationshipId===e);r&&(r.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){return this.layer?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){return this.layer?.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(e=>!e.valid).every(({submittable:e})=>e)}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return _.utc;const t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===_.unknown?t||_.utc:this._timeZone||_.system}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every(({valid:e})=>e)}findField(e){return this.allFieldInputs.find(t=>t.name===e)}findGroup(e){return this.allGroupInputs.find(t=>t.id===e)}getFieldValueOptionsForField(e,t){const r=this.findField(e);if(!r)return[[],[],[]];const i="coded-value"===r.domain?.type?r.domain.codedValues.map(({name:e,code:t})=>({name:e,value:t})):[],o=null==r.value||i.some(e=>e.value===r.value)?[]:[{name:`${r.value}`,value:r.value}],n=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(n.length>0){const e=new Set(n.map(e=>e.value));return[n,i.filter(t=>!e.has(t.value)),o]}return[i,[],o]}getValue(e){const t=this.layer?.getField(e);if(null!=t)return this._featureClone.getAttribute(t.name)??null}setValue(e,t){const{_featureClone:r,strict:i}=this,o=this.findField(e);t=""===t?null:t,o&&r.getAttribute(e)!==t&&(o.value=t,i&&!o.valid||(this._afterValueChange(o),this._evaluateExpressions(t=>t.evaluateInvalidated([e]))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,t=new Set(e.filter(e=>e.valid).map(({name:e})=>e)),r=e.filter(e=>!e.valid).map(({name:e})=>e),i=this.getValues();if(this.validateContingencyConstraints(i,{includeIncompleteViolations:!0}).length>0)for(const[e,i]of this.contingencyConstraintViolations.entries())"error"===i.type&&(t.delete(e),r.push(e));this.notifyChange("submittable"),this.notifyChange("valid"),this.emit("submit",{valid:[...t],invalid:r,values:i})}validateContingencyConstraints(e,t){const{_contingentValuesCache:r}=this,i=new Map;if(this.contingencyConstraintViolations=i,null==r)return[];const{invalid:o,incomplete:n}=r.validateContingencyConstraints(e),s=[...o,...t?.includeIncompleteViolations?n:[]];for(const e of s)for(const t of e.fieldGroup.fields)i.set(t,e);return s}notifyFeatureGeometryChanged(){const{feature:e,_featureClone:t}=this;e&&(t.geometry=e.geometry,this._evaluateExpressions(e=>e.evaluateInvalidatedByGeometry()))}applySubtypeDefaults(e){const{defaultValues:t}=e,{allFieldInputs:r}=this;for(const{name:e}of r){const r=t[e];null!=r&&this.setValue(e,r)}}_emitChangeEvent({name:e,valid:t,value:r}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:r,valid:t})}_evaluateExpressions(e){const t=this._expressionsManager;null!=t&&this._updatingHandles.addPromise(e(t).finally(()=>this._afterExpressionsEvaluated()))}async _updateInputsUsingFormElements(e,t,r){const i=new Map;for(const t of e)if(w.isGroupInput(t)){i.set(t.element,t);for(const e of t.inputs)e.element&&i.set(e.element,e)}else t.element&&i.set(t.element,t);const o=new Map,n=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:i,updatedElements:t.filter(e=>this._isSupportedElement(e)),sharedInitializationProperties:r,group:null,newExpressionExecutorPromises:o});for(const[e,t]of i.entries())i.delete(e),t.destroy();return await Promise.all(Array.from(o.values())),n}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:t,updatedElements:r,sharedInitializationProperties:i,group:o,newExpressionExecutorPromises:n}=e,s=[];for(const e of r){const r=t.has(e),a=r?t.get(e):f.isUtilityNetworkAssociationsElement(e)?await this._makeUtilityNetworkAssociationInputFromElement(e,i,o):this._makeInputFromElement(e,i,o);if(a){if(s.push(a),await c.whenOnce(()=>!a.updating),this._assignExpressionExecutors(a,e,n),r)if(t.delete(e),w.isGroupInput(a)){const{feature:e,timeZone:t}=i;a.set({feature:e,timeZone:t})}else if(w.isRelationshipInput(a)){const t=this.relationshipId===e.relationshipId;a.set(i),a.set({map:this.map,showAllEnabled:t})}else f.isUtilityNetworkAssociationsElement(a)?(a.set(i),a.set({map:this.map})):a.set(i);if(f.isGroupElement(e)){const r=e.elements.filter(e=>this._isSupportedElement(e));a.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:t,updatedElements:r,sharedInitializationProperties:i,group:a,newExpressionExecutorPromises:n})}}}return s}_updateInputsUsingLayerFields(e,t,r){if(!Array.isArray(t))return n.getLogger(this).warn(this.declaredClass,"No attribute fields found."),[];const i=new Map;for(const t of e)if(w.isGroupInput(t)){for(const e of t.inputs)e.destroy();t.inputs.length=0,t.destroy()}else w.isRelationshipInput(t)?t.destroy():w.isFieldInput(t)&&(null!==t.element?t.destroy():i.set(t.field,t));const o=[];for(const e of t){const t=r.feature?.getAttribute(e.name)??null,n=i.get(e)??new S({field:e,preservesValueWhenHidden:this.formTemplate?.preserveFieldValuesWhenHidden});o.push(n.set({...r,value:t})),i.delete(e)}for(const[e,t]of i.entries())i.delete(e),t.destroy();return o}_resetFieldInputValues(e){for(const t of this.allFieldInputs)t.value=e.getAttribute(t.name)??null}_makeInputFromElement(e,t,r){return f.isGroupElement(e)?function(e,t){const{feature:r,layer:i}=t;return new M({element:e,inputs:[],feature:r,layer:i})}(e,t):f.isFieldElement(e)?this._makeFieldInputFromElement(e,t,r):f.isRelationshipElement(e)?this._makeRelationshipInputFromElement(e,t,r):f.isUtilityNetworkAssociationsElement(e)?this._makeUtilityNetworkAssociationInputFromElement(e,t,r):f.isTextElement(e)?function(e,t,r=null){const{feature:i,layer:o,timeZone:n}=t;return new F({element:e,feature:i,group:r,layer:o,timeZone:n})}(e,t):f.isUtilityNetworkAssociationsElement(e)?this._makeUtilityNetworkAssociationInputFromElement(e,t,r):i.neverReached()}_makeFieldInputFromElement(e,t,r){const{editType:i,feature:o,initialFeature:n,layer:s,timeZone:a}=t,{fieldName:l}=e,c=l&&this._layerFieldsByName.get(l);return c?new S({editType:i,element:e,field:c,value:o?.getAttribute(e.fieldName)??null,feature:o,initialFeature:n,layer:s,group:r,preservesValueWhenHidden:this.formTemplate?.preserveFieldValuesWhenHidden,timeZone:a}):null}_makeRelationshipInputFromElement(e,t,r=null){const{map:i}=this,{feature:o,layer:n,timeZone:s}=t,a=new C({element:e,feature:o,group:r,layer:n,map:i,timeZone:s});return a.addHandles(c.on(()=>a.relatedLayer,"edits",()=>this._evaluateExpressions(e=>e.evaluateAsyncExpressions()))),a}async _makeUtilityNetworkAssociationInputFromElement(t,r,i=null){const{map:o}=this,{feature:n,layer:s,timeZone:a}=r;return new(0,(await new Promise((t,r)=>e(["./UtilityNetworkAssociationInput"],e=>t(I(e)),r))).default)({element:t,feature:n,group:i,layer:s,map:o,timeZone:a})}_assignExpressionExecutors(e,t,r){const i=L[t.type],o=[];for(const n of i){const i=`${n}Executor`;if(e[i]){this._useExecutor(e[i]);continue}const s=t[n];if(null!=s&&""!==s){const t=this._expressionInfosLookup.get(s)?.expression??s;o.push(this._getOrCreateExecutorForExpression(t,r).then(t=>{e[i]=this._useExecutor(t)}))}}return w.isTextElementInput(e)&&o.push(...this._assignTextElementExpressionExecutors(e,r)),o}_assignTextElementExpressionExecutors(e,t){const{_expressionInfosLookup:r}=this,i=[];for(const o of e.expressionsUsed){const s=r.get(o);null!=s?i.push(this._getOrCreateExecutorForExpression(s.expression,t).then(t=>e.setExpressionExecutor(o,this._useExecutor(t)))):n.getLogger(this).error("feature-form:expression-not-found",`Could not find expressionInfo object with name '${o}'`)}for(const r of e.fieldsUsed){const o=`return $feature['${r}'];`;i.push(this._getOrCreateExecutorForExpression(o,t).then(t=>e.setFieldExecutor(r,this._useExecutor(t))))}return i}async _getOrCreateExecutorForExpression(e,t){const{_expressionExecutorLookup:r}=this;if(r.has(e))return r.get(e);if(t.has(e))return t.get(e);const i=k.createFormExpressionArcadeExecutor(e,this.layer);t.set(e,i);const o=await i;return r.set(e,o),o}_createExpressionsManager(e){const{_arcadeContextInfo:t,_featureClone:r,allFieldInputs:i,formTemplate:o}=this;this._expressionsManager=new x.FormExpressionsManager({executors:e,feature:r,arcadeContextInfo:t,fieldInputs:i,preserveFieldValuesWhenHidden:!0===o?.preserveFieldValuesWhenHidden})}_startExpressions(){if(0===this._expressionExecutorsInUse.size)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),this._evaluateExpressions(e=>e.evaluateAll())}_stopExpressions(){this._expressionsManager=s.destroyMaybe(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){const{name:t,value:r}=e,{_featureClone:i,formTemplate:o,layer:n}=this;if(!n)return;const s=i.getAttribute(t);i.setAttribute(t,r);const{typeFieldName:a,types:l}=w.getNormalizedFeatureTypeInfo(n);if((e.isSubtypeField||t===a)&&r!==s){if("subtype-sublayer"===n.type){const e=n.parent?.findSublayerForFeature(i);e&&(this.feature&&(this.feature.sourceLayer=e),i.sourceLayer=e)}const e=new Set;for(const t of l)if(t.domains&&"object"==typeof t.domains)for(const r of Object.keys(t.domains))e.add(r);for(const t of e){const e=this.findField(t);e&&e.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(null!=o){const{description:e,title:r}=o;r&&p.templateHasKey(r,t)&&this.notifyChange("formTitle"),e&&p.templateHasKey(e,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const t of this.allFieldInputs)t.value!==e.getAttribute(t.name)&&this._afterValueChange(t)}_joinContingentValues(){const e=this._contingentValuesCache;if(null==e)return[];const{typeFieldName:t}=w.getNormalizedFeatureTypeInfo(this.layer),r=t?this.getValue(t):null,i=[];for(const t of e.fieldGroups){const{contingencies:e,fields:o,name:n}=t,s=[];for(const t of e)t.isRetired||null!=t.subtype&&t.subtype.code!==r||s.push({values:t.values});s.length>0&&i.push({name:n,fields:o,contingencies:s})}const[o,n]=this._generateJoinPlan(i);return[...o.flatMap(e=>this._joinFieldGroupContingencies(e)),...n.flatMap(e=>e.contingencies)]}_generateJoinPlan(e){const t=new Map,r=[],i=new Set;for(const o of e)for(const e of o.fields)if(t.has(e)){const n=t.get(e),s=o,a=[n.name,s.name].sort().join("|");if(i.has(a))continue;r.push([n,s]),i.add(a),t.set(e,s)}else t.set(e,o);const o=new Set(r.flat()),n=new Set(e);for(const e of o)n.delete(e);const s=new Map,a=new Map;for(const e of new Set(r.flat())){const t=Symbol(e.name);s.set(t,new Set([e])),a.set(e,t)}for(const[e,t]of r){const r=a.get(e),i=a.get(t);if(r===i)continue;const o=s.get(r),n=s.get(i);for(const e of n)o.add(e),a.set(e,r);s.delete(i)}return[[...s.values()].map(e=>[...e]),[...n]]}_joinFieldGroupContingencies(e){const t=e.slice(),r=t.shift();let i=t.shift(),o=this._generateJoinKey(r.fields,i.fields),n=new Set([...r.fields,...i.fields]),s=new Map;for(const e of r.contingencies){const[t]=this._hashContingency(e,o.codedValueFields,!0);s.has(t)?s.get(t)?.push(e):s.set(t,[e])}for(;t.length>0;){const e=new Map,r=t.shift(),a=this._generateJoinKey(n,r.fields);for(const t of i.contingencies){const[r,i]=this._hashContingency(t,o.codedValueFields),n=i?this._findMatchingContingenciesWithAnyHashMask(s,r):s.get(r);if(s.has(E)&&n?.push(...this._findMatchingContingenciesContainingAny(t,s.get(E),o.codedValueFields)),null!=n)for(const r of n){const i=o.rangeFields.length>0?this._joinContingenciesWithRangeDomains(r,t,o.rangeFields):this._joinContingencies(r,t);if(null==i)break;const[n]=this._hashContingency(i,a.codedValueFields,!0);e.has(n)?e.get(n)?.push(i):e.set(n,[i])}}s=e,i=r,o=a,n=new Set([...n,...i.fields])}const a=[];for(const e of i.contingencies){const[t,r]=this._hashContingency(e,o.codedValueFields),i=r?this._findMatchingContingenciesWithAnyHashMask(s,t):s.get(t);if(s.has(E)&&i.push(...this._findMatchingContingenciesContainingAny(e,s.get(E),o.codedValueFields)),null!=i)for(const t of i){const r=o.rangeFields.length>0?this._joinContingenciesWithRangeDomains(t,e,o.rangeFields):this._joinContingencies(t,e);null!=r&&a.push(r)}}return a}_joinContingencies(e,t){const r={values:{...e.values,...t.values}};for(const[t,i]of Object.entries(r.values))"any"===i.objectType&&null!=e.values[t]&&(r.values[t]=e.values[t]);return r}_joinContingenciesWithRangeDomains(e,t,r){const i=this._joinContingencies(e,t);for(const o of r){const r=e.values[o],n=t.values[o],{leftIsNull:s,rightIsNull:a,bothAreNull:l,leftIsAny:c,rightIsAny:p,bothAreAny:d,leftIsRange:u,rightIsRange:h}=this._compareObjectTypes(r.objectType,n.objectType);if(l||d)continue;if(s&&p||a&&c){i.values[o]=new g({objectType:"null"});continue}if(s&&h||a&&u)return null;c?(r.minValue=-1/0,r.maxValue=1/0):p&&(n.minValue=-1/0,n.maxValue=1/0);const y=Math.max(r.minValue,n.minValue),m=Math.min(r.maxValue,n.maxValue);if(y>m)return null;i.values[o]=new g({objectType:"range",minValue:y,maxValue:m})}return i}_findMatchingContingenciesContainingAny(e,t,r){return t.filter(t=>r.every(r=>{const i=t.values[r],o=e.values[r];return"any"===i.objectType||"any"===o.objectType||i.codedValue?.code===o.codedValue?.code}))}_findMatchingContingenciesWithAnyHashMask(e,t){const r=RegExp(`${t}$`),i=[];for(const[t,o]of e){if(t===E)break;r.test(t)&&i.push(...o)}return i}_generateJoinKey(e,t){const r=Array.isArray(e)?new Set(e):e,i=Array.isArray(t)?new Set(t):t,o=r.size<i.size?r:i,n=o===r?i:r,{feature:s}=this,a=new Set,l=new Set;for(const e of o)if(n.has(e)){const t=this.layer?.getFieldDomain(e,{feature:s??void 0,excludeImpliedDomains:!0});if(null==t)continue;switch(t.type){case"coded-value":a.add(e);break;case"range":l.add(e)}}return{codedValueFields:[...a],rangeFields:[...l]}}_contingencyIsValid(e,t){const r={};for(const{name:t,value:i}of this.allFieldInputs)this.fieldsWithContingentValues.has(t)&&null!=i&&t!==e&&(r[t]=i);return Object.entries(r).every(([e,r])=>!t.values.hasOwnProperty(e)||w.valueIsValidContingentValue(r,t.values[e]))}_getContingentValueOptionsForField(e,t){const r=this.joinedContingentValues.slice(),i=new Map,o={code:"",name:t??"No value"};for(const t of r){const r=t.values[e];if("code"===r?.objectType||"null"===r?.objectType){const{code:n,name:s}=r.codedValue&&"null"!==r.objectType?r.codedValue:o;!i.has(n)&&this._contingencyIsValid(e,t)&&i.set(n,{name:s,value:n})}}return[...i.values()]}_hashContingency(e,t,r=!1){if(t.length<1)return["#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",!1];const i=[];let o=!1;for(const n of t){const t=e.values[n];if("any"===t.objectType){if(r)return[E,!0];o=!0,i.push(`${n}:.*`)}else"null"===t.objectType?i.push(`${n}:#JSAPI_CONTINGENT_VALUE_NULL_HASH`):i.push(`${n}:${t.codedValue?.code}`)}return[i.sort().join("&"),o]}_compareObjectTypes(e,t){return{leftIsNull:"null"===e,rightIsNull:"null"===t,bothAreNull:"null"===e&&"null"===t,leftIsAny:"any"===e,rightIsAny:"any"===t,bothAreAny:"any"===e&&"any"===t,leftIsRange:"range"===e,rightIsRange:"range"===t}}_isSupportedElement(e){return"field"===e.type||"group"===e.type||"relationship"===e.type||"text"===e.type||"utilityNetworkAssociations"===e.type||(n.getLogger(this).warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${e.label} has unsupported type '${e.type}'`),!1)}get test(){return{featureClone:this._featureClone}}};return t.__decorate([d.property()],A.prototype,"_expressionInfosLookup",null),t.__decorate([d.property()],A.prototype,"_featureClone",void 0),t.__decorate([d.property()],A.prototype,"_timeZone",void 0),t.__decorate([d.property()],A.prototype,"activeAssociation",void 0),t.__decorate([d.property()],A.prototype,"activeAssociationInput",null),t.__decorate([d.property()],A.prototype,"activeRelationshipInput",null),t.__decorate([d.property()],A.prototype,"_arcadeContextInfo",null),t.__decorate([d.property()],A.prototype,"associationId",null),t.__decorate([d.property()],A.prototype,"associatedLayer",null),t.__decorate([d.property()],A.prototype,"allAssociationInputs",null),t.__decorate([d.property()],A.prototype,"allFieldInputs",null),t.__decorate([d.property()],A.prototype,"allGroupInputs",null),t.__decorate([d.property()],A.prototype,"allRelationshipInputs",null),t.__decorate([d.property()],A.prototype,"_layerFieldsByName",null),t.__decorate([d.property()],A.prototype,"editType",void 0),t.__decorate([d.property()],A.prototype,"contingencyConstraintViolations",void 0),t.__decorate([d.property()],A.prototype,"disabled",void 0),t.__decorate([d.property()],A.prototype,"feature",null),t.__decorate([d.property()],A.prototype,"fieldsWithContingentValues",null),t.__decorate([d.property({type:m})],A.prototype,"formTemplate",null),t.__decorate([d.property()],A.prototype,"formDescription",null),t.__decorate([d.property()],A.prototype,"formTitle",null),t.__decorate([d.property()],A.prototype,"formHeaderVisible",null),t.__decorate([d.property()],A.prototype,"highlightHelper",void 0),t.__decorate([d.property()],A.prototype,"inputs",void 0),t.__decorate([d.property()],A.prototype,"joinedContingentValues",null),t.__decorate([d.property()],A.prototype,"layer",null),t.__decorate([d.property()],A.prototype,"map",void 0),t.__decorate([d.property()],A.prototype,"callbacks",void 0),t.__decorate([d.property()],A.prototype,"relationshipId",null),t.__decorate([d.property()],A.prototype,"spatialReference",null),t.__decorate([d.property()],A.prototype,"state",null),t.__decorate([d.property()],A.prototype,"strict",void 0),t.__decorate([d.property()],A.prototype,"submittable",null),t.__decorate([d.property()],A.prototype,"timeZone",null),t.__decorate([d.property()],A.prototype,"updating",null),t.__decorate([d.property()],A.prototype,"valid",null),t.__decorate([d.property()],A.prototype,"pendingSubtypeChoice",void 0),t.__decorate([d.property()],A.prototype,"getValues",null),t.__decorate([d.property()],A.prototype,"submit",null),t.__decorate([d.property()],A.prototype,"test",null),A=t.__decorate([h.subclass("esri.widgets.FeatureForm.FeatureFormViewModel")],A),A})},"esri/widgets/FeatureForm/FieldInput":function(){define(["../../chunks/tslib.es6","../../core/Error","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/support/domainUtils","../../layers/support/fieldUtils","../../smartMapping/support/utils","../../support/guards","../Feature/support/featureUtils","./EditableInput","./featureFormUtils","../support/dateUtils","../support/forms/formUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f){"use strict";let g=class extends h{constructor(e){super(e),this._storedValue=null,this.error=null,this.preservesValueWhenHidden=!0,this.field=null,this.group=null,this.requiredExpressionExecutor=null,this.type="field",this._fieldInputWasVisibleDuringLifetime=!1,this.valueExpressionExecutor=null}initialize(){this.addHandles(r.watch(()=>this.feature,()=>this._fieldInputWasVisibleDuringLifetime=!1,r.sync))}get _dateFormRange(){const{element:e,field:t}=this;if("date"!==this.dataType)return{};const r=e?.domain?l.getDomainRange(t,e.domain):null;if(!e?.input)return r??{};const i=e.input,{type:o}=i;let n={};if("date-picker"!==o&&"time-picker"!==o&&"datetimeoffset-picker"!==o||(n=l.dateTimeFieldValuesToNumericRange(t,i.max,i.min)),"datetime-picker"===o){const{max:e,min:t}=i;n={max:null!=e&&f.dateIsValid(e)?e.getTime():null,min:null!=t&&f.dateIsValid(t)?t.getTime():null}}const{max:s,min:a}=n;if(r){const{max:e,min:t}=r,i=d.isNumber(e)&&(null==s||null!=s&&e<s),o=d.isNumber(t)&&(null==a||null!=a&&t>a);return{max:i?e:s??null,min:o?t:a??null,rawMax:i?r.rawMax:n?.rawMax??null,rawMin:o?r.rawMin:n?.rawMin??null}}return{min:a,max:s,rawMax:n?.rawMax??null,rawMin:n?.rawMin??null}}get _dateRange(){const{_dateFormRange:e,field:t}=this;if("date"!==this.dataType)return{};const r=l.getDomainRange(t);if(!r)return e;const{max:i,min:o,rawMax:n,rawMin:s}=e;if("date"===t.type){const{max:e,min:t}=r;return{max:d.isNumber(i)&&(null===e||null!=e&&i<e)?i:e??null,min:d.isNumber(o)&&(null===t||null!=t&&o>t)?o:t??null}}if("date-only"===t.type||"time-only"===t.type||"timestamp-offset"===t.type){const{max:e,min:t,rawMax:a,rawMin:l}=r,c=d.isNumber(i)&&n&&(null==e||i<e),p=d.isNumber(o)&&s&&(null==t||o>t);return{max:c?i:e,min:p?o:t,rawMax:c?n:a,rawMin:p?s:l}}return{max:null,min:null}}get _configAllowsEdits(){const{element:e,layer:t,name:r}=this;if(null!=e)return e.editableExpression?!!this.evaluatedEditableExpression:!1!==e.editable;if(t?.userHasUpdateItemPrivileges)return!0;const i=t&&"popupTemplate"in t?t?.popupTemplate?.fieldInfos?.find(({fieldName:e})=>e===r):null;return i?.isEditable??!0}get _layerAndFieldAllowEdits(){return this.layerAllowsEdits&&this.field?.editable}get _isVisibleByDefault(){const{field:e,layer:t}=this;return!!e?.visible&&c.isFieldVisibleByDefault(e,t)}get _isEditTrackingField(){return c.getLowerCaseEditTrackingFields(this.layer).includes(this.name?.toLowerCase())}get _shouldUseValueExpression(){return this._layerAndFieldAllowEdits&&!this._configAllowsEdits&&null!=this.valueExpressionExecutor&&this.valueExpressionExecutor.initialExecutionComplete}get isSubtypeField(){const{layer:e}=this;if(e&&"subtypeField"in e){const{subtypeField:t,fieldsIndex:r}=e;return(r.get(t)?.name??t)===this.name}return!1}get valueIsOutOfDomain(){const{domain:e,value:t,field:r}=this;return!(!e||null==t)&&null!==l.validateDomainValue(r,t,e)}get dataType(){const{field:e}=this;return c.isNumericField(e)?"number":c.isStringField(e)?"text":p.isAnyDateField(e)||c.isTimeOnlyField(e)?"date":"unsupported"}get dateDataType(){if("date"===this.dataType)return"date"!==this.field.type?"string":"number"}get domain(){const{layer:e,feature:t,name:r,element:i}=this,o=i?.domain;return null!=o&&this._isDomainCompatible(o)?o:e.getFieldDomain(r,{feature:t})}get editable(){return!!this._layerAndFieldAllowEdits&&(this.evaluatedEditableExpression??this._configAllowsEdits)}get evaluatedRequiredExpression(){const{requiredExpressionExecutor:e}=this;return null!=e?!!e.lastEvaluatedValue:null}get evaluatedValueExpression(){const{valueExpressionExecutor:e}=this;return null!=e?e.lastEvaluatedValue:null}get hint(){return this.element?.hint}get includeDate(){return!("date"!==this.dataType||"time-only"===this.field.type)}get includeTime(){const{element:e,field:t}=this;if("date"!==this.dataType)return!1;if("time-only"===t.type)return!0;if("date-only"===t.type)return!1;const r="datetime-picker"===e?.input?.type?e.input.includeTime:void 0;return void 0===r||r}get includeTimeOffset(){if("timestamp-offset"!==this.field.type)return!1;const e=this.element?.input;return!e||"datetimeoffset-picker"===e.type&&e.includeTimeOffset}set initialFeature(e){this._set("initialFeature",e),this.notifyChange("valid")}get inputType(){return this.element?.input?.type}get hasInvalidSwitchValue(){const{element:e}=this,t=y.isFieldElementWithInputType(e,"switch")?e.input:null;return!t||y.valueIsInvalidSwitchValue(this.value,t)}get isRelationshipKeyField(){const{field:e,layer:t}=this;return u.isRelatableFeatureSupportedLayer(t)&&!!t.relationships?.some(t=>t.keyField===e.name)}get label(){const{field:e}=this;return this.getFormattedLabel(this.element?.label)||e.alias||e.name}get maxLength(){return f.getMaxLength({dataType:this.dataType,field:this.field,input:this.element?.input})}get minLength(){return f.getMinLength({dataType:this.dataType,field:this.field,input:this.element?.input})}get name(){return this.field?.name}get range(){const{domain:e,element:t,field:r}=this;if("date"===this.dataType)return this._dateRange;const i=l.getDomainRange(r,e)||c.getFieldRange(r,e),o=i?.max===Number.MAX_VALUE?null:i?.max??null,n=i?.min===-Number.MAX_VALUE?null:i?.min??null;if(!t?.domain||"range"!==t.domain.type)return{max:o,min:n};const{max:s,min:a}=l.getDomainRange(r)||{};return{max:null!=s&&(null===o||null!=o&&s<o)?s:o,min:null!=a&&(null===n||null!=n&&a>n)?a:n}}get required(){const{editable:e,evaluatedRequiredExpression:t,field:r,visible:i,isSubtypeField:o}=this;return!!e&&(!1===r?.nullable||!!o||!(!i||!1===this.group?.visible||null==t)&&t)}set required(e){this._overrideIfSome("required",e)}get showNoValueOptionEnabled(){const{element:e}=this;return!this.required&&(!y.isFieldElementWithShowNoValueOptionInput(e)||e.input.showNoValueOption)}get showNoValueLabel(){const{element:e}=this;return y.isFieldElementWithShowNoValueOptionInput(e)?e.input.noValueOptionLabel:null}get submittable(){const{field:e,required:t,valid:r,value:i}=this;return!(t&&null==i||!r&&this.initialFeature.getAttribute(e.name)!==i)}get timeResolution(){const e=this.element?.input;if(e&&("datetimeoffset-picker"===e.type||"time-picker"===e.type))return e.timeResolution??"minutes"}get timeStep(){return null!=this.timeResolution?m.timeResolutionToStepMap.get(this.timeResolution):void 0}get updating(){const{editableExpressionExecutor:e,valueExpressionExecutor:t,visibilityExpressionExecutor:r,preservesValueWhenHidden:i}=this;return null!=t&&t.updating||null!=e&&e.updating||!1===i&&null!=r&&r.updating}get valid(){const e=this.editable?this._validate():null;return this._set("error",e),null===e}get value(){if(this._fieldInputWasVisibleDuringLifetime=this._fieldInputWasVisibleDuringLifetime||this.visible&&!1!==this.group?.visible,!1===this.preservesValueWhenHidden&&this._fieldInputWasVisibleDuringLifetime&&(!1===this.visibilityExpressionExecutor?.lastEvaluatedValue||!1===this.group?.visibilityExpressionExecutor?.lastEvaluatedValue))return null!==this._storedValue&&this.set("_storedValue",null),null;if(this._shouldUseValueExpression){const e=this.evaluatedValueExpression;return"date"===this.dataType?this._arcadeOutputToDateFieldValue(e):null!=e&&"object"==typeof e?`${e}`:e}return this._storedValue}set value(e){this.notifyChange("evaluatedVisibilityExpression"),this.set("_storedValue",e),this.notifyChange("value"),this.notifyChange("valid")}get visible(){return!this._isEditTrackingField&&(null!=this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element&&!1!==this.field?.visible||this._isVisibleByDefault)}_arcadeOutputToDateFieldValue(e){const r=this.field.type;try{if("object"==typeof e){if(null===e)return null;if(m.isArcadeDate(e))return m.arcadeDateToFieldValue(e,r);if("getTime"in e&&"function"==typeof e.getTime&&"date"===r)return parseInt(e.getTime(),10);if("date-only"===r||"time-only"===r||"timestamp-offset"===r)return e.toString()}else{if("string"==typeof e)return"date"===r?parseInt(e,10):e;if("number"==typeof e&&"date"===r)return e}throw new t("feature-form:invalid-date-value","Date value is invalid")}catch{return"date"===r?NaN:""}}_isDomainCompatible(e){const{field:t}=this;if("coded-value"===e?.type){const r=typeof e.codedValues[0].code;if("string"===r&&c.isStringField(t)||"number"===r&&c.isNumericField(t))return!0}return!!("range"===e?.type&&c.isNumericField(t)||p.isAnyDateField(t)||c.isTimeOnlyField(t))}_validate(){const{dataType:e,domain:t,field:r,minLength:i,range:o,required:n,value:s,maxLength:a}=this;return f.validateFormValue(s,{dataType:e,domain:t,field:r,maxLength:a,minLength:i,range:o,required:n})}};return e.__decorate([i.property()],g.prototype,"_dateFormRange",null),e.__decorate([i.property()],g.prototype,"_dateRange",null),e.__decorate([i.property()],g.prototype,"_storedValue",void 0),e.__decorate([i.property()],g.prototype,"_configAllowsEdits",null),e.__decorate([i.property()],g.prototype,"_layerAndFieldAllowEdits",null),e.__decorate([i.property()],g.prototype,"_isVisibleByDefault",null),e.__decorate([i.property()],g.prototype,"_isEditTrackingField",null),e.__decorate([i.property()],g.prototype,"_shouldUseValueExpression",null),e.__decorate([i.property()],g.prototype,"isSubtypeField",null),e.__decorate([i.property()],g.prototype,"valueIsOutOfDomain",null),e.__decorate([i.property()],g.prototype,"dataType",null),e.__decorate([i.property()],g.prototype,"dateDataType",null),e.__decorate([i.property()],g.prototype,"domain",null),e.__decorate([i.property()],g.prototype,"editable",null),e.__decorate([i.property({readOnly:!0})],g.prototype,"error",void 0),e.__decorate([i.property({constructOnly:!0})],g.prototype,"preservesValueWhenHidden",void 0),e.__decorate([i.property()],g.prototype,"evaluatedRequiredExpression",null),e.__decorate([i.property()],g.prototype,"evaluatedValueExpression",null),e.__decorate([i.property()],g.prototype,"field",void 0),e.__decorate([i.property()],g.prototype,"group",void 0),e.__decorate([i.property({readOnly:!0})],g.prototype,"hint",null),e.__decorate([i.property()],g.prototype,"includeDate",null),e.__decorate([i.property()],g.prototype,"includeTime",null),e.__decorate([i.property()],g.prototype,"includeTimeOffset",null),e.__decorate([i.property()],g.prototype,"initialFeature",null),e.__decorate([i.property({readOnly:!0})],g.prototype,"inputType",null),e.__decorate([i.property()],g.prototype,"hasInvalidSwitchValue",null),e.__decorate([i.property()],g.prototype,"isRelationshipKeyField",null),e.__decorate([i.property()],g.prototype,"label",null),e.__decorate([i.property()],g.prototype,"maxLength",null),e.__decorate([i.property()],g.prototype,"minLength",null),e.__decorate([i.property({readOnly:!0})],g.prototype,"name",null),e.__decorate([i.property()],g.prototype,"range",null),e.__decorate([i.property()],g.prototype,"required",null),e.__decorate([i.property()],g.prototype,"requiredExpressionExecutor",void 0),e.__decorate([i.property()],g.prototype,"showNoValueOptionEnabled",null),e.__decorate([i.property()],g.prototype,"submittable",null),e.__decorate([i.property()],g.prototype,"timeResolution",null),e.__decorate([i.property()],g.prototype,"timeStep",null),e.__decorate([i.property({readOnly:!0})],g.prototype,"type",void 0),e.__decorate([i.property()],g.prototype,"updating",null),e.__decorate([i.property()],g.prototype,"valid",null),e.__decorate([i.property({value:null})],g.prototype,"value",null),e.__decorate([i.property()],g.prototype,"valueExpressionExecutor",void 0),e.__decorate([i.property()],g.prototype,"visible",null),g=e.__decorate([a.subclass("esri.widgets.FeatureForm.FieldInput")],g),g})},"esri/widgets/FeatureForm/EditableInput":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/support/layerUtils","./InputBase","../support/forms/formUtils"],function(e,t,r,i,o,n,s,a,l){"use strict";let c=class extends a{constructor(e){super(e),this.editType="NA",this.editableExpressionExecutor=null}get editable(){return!!this.layerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get evaluatedEditableExpression(){const{editableExpressionExecutor:e}=this;return null!=e?!!e.lastEvaluatedValue:null}get layerAllowsEdits(){const{layer:e}=this;if(!e)return!1;const t=s.getEffectiveLayerCapabilities(e),r=t?.operations.supportsEditing,i=l.capabilitiesAllowEditType(t,this.editType);return!(!r||!i)}};return e.__decorate([t.property()],c.prototype,"editType",void 0),e.__decorate([t.property()],c.prototype,"editable",null),e.__decorate([t.property()],c.prototype,"editableExpressionExecutor",void 0),e.__decorate([t.property()],c.prototype,"evaluatedEditableExpression",null),e.__decorate([t.property()],c.prototype,"layerAllowsEdits",null),c=e.__decorate([n.subclass("esri.widgets.FeatureForm.EditableInput")],c),c})},"esri/widgets/FeatureForm/InputBase":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./featureFormUtils"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends t{constructor(e){super(e),this.element=null,this.feature=null,this.layer=null,this.timeZone=null,this.type=null,this.visibilityExpressionExecutor=null}get description(){return this.getFormattedLabel(this.element?.description)}get evaluatedVisibilityExpression(){const{visibilityExpressionExecutor:e}=this;return null!=e?!!e.lastEvaluatedValue:null}get label(){return this.getFormattedLabel(this.element?.label)}get updating(){return!1}get visible(){return null!=this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element}getFormattedLabel(e){const{feature:t,layer:r,timeZone:i}=this;return null==r||null==e?e:a.parseFormTemplateString({label:e,attributes:t.attributes,fieldsIndex:r.fieldsIndex,timeZone:i})}};return e.__decorate([r.property({readOnly:!0})],l.prototype,"description",null),e.__decorate([r.property({constructOnly:!0})],l.prototype,"element",void 0),e.__decorate([r.property()],l.prototype,"evaluatedVisibilityExpression",null),e.__decorate([r.property()],l.prototype,"feature",void 0),e.__decorate([r.property()],l.prototype,"label",null),e.__decorate([r.property()],l.prototype,"layer",void 0),e.__decorate([r.property()],l.prototype,"timeZone",void 0),e.__decorate([r.property()],l.prototype,"type",void 0),e.__decorate([r.property()],l.prototype,"updating",null),e.__decorate([r.property()],l.prototype,"visible",null),e.__decorate([r.property()],l.prototype,"visibilityExpressionExecutor",void 0),l=e.__decorate([s.subclass("esri.widgets.FeatureForm.InputBase")],l),l})},"esri/widgets/FeatureForm/FormExpressionsManager":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/has","../../core/Logger","../../core/MapUtils","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a,l,c){"use strict";const p="#JSAPI_FORM_EXPRESSIONS_MANAGER_GEOMETRY";e.FormExpressionsManager=class extends r{constructor(e){super(e),this._fieldReferencesLookup=new Map,this._fieldsAffectedLookup=new Map,this.preserveFieldValuesWhenHidden=!0,this._latestFieldValues={...e.feature.attributes}}initialize(){this._dependencyGraph=this._buildDependencyGraph()}destroy(){this.resetExecutors()}get _asyncExecutors(){return this.executors.filter(e=>e.isAsync)}get _baseContext(){const{editType:e,layer:t,map:r,originalFeature:i,spatialReference:o,timeZone:n}=this.arcadeContextInfo,s="scene"===t?.type&&null!=t.associatedLayer?t.associatedLayer:t;return[{$originalfeature:i,$editcontext:{editType:e},$layer:s,$featureset:s,$datastore:t?.url,$map:r},{rawOutput:!0,spatialReference:o??void 0,timeZone:n}]}set feature(e){this._latestFieldValues={...e?.attributes},this._set("feature",e)}evaluateAll(){return this._evaluate(this.executors)}evaluateAsyncExpressions(){return this._evaluate(this._asyncExecutors)}evaluateExpressions(e){return this._evaluate(e)}evaluateInvalidated(e){const{_fieldReferencesLookup:t,_latestFieldValues:r,feature:i}=this,o=new Set;for(const n of e)if(r[n]=i.getAttribute(n),t.has(n))for(const e of t.get(n))o.add(e);return this._evaluate([...o])}async evaluateInvalidatedByGeometry(){if(this._fieldReferencesLookup.has(p))return this._evaluate([...this._fieldReferencesLookup.get(p)])}resetExecutors(){for(const e of this.executors)e.reset()}_buildDependencyGraph(){const{_fieldReferencesLookup:e,_fieldsAffectedLookup:t,executors:r,preserveFieldValuesWhenHidden:i}=this,o=new Map(this.fieldInputs.map(e=>[e.name,e])),s=!1===i,a=new Map(r.map(e=>[e,new Array]));for(const i of r){for(const r of i.fieldsUsed){n.getOrCreateMapValue(e,r,()=>new Set).add(i);const l=o.get(r);[l?.valueExpressionExecutor,l?.editableExpressionExecutor,s?l?.group?.visibilityExpressionExecutor:null,s?l?.visibilityExpressionExecutor:null].filter(e=>null!=e&&e!==i).forEach(e=>{a.get(e).push(i),n.getOrCreateMapValue(t,e,()=>new Set).add(l)})}i.geometryUsed&&n.getOrCreateMapValue(e,p,()=>new Set).add(i)}return a}async _evaluate(e){const t=new Map,{_dependencyGraph:r,_fieldsAffectedLookup:i,_latestFieldValues:n}=this;for(const i of e)d(i,t,r);for(const[e,{resolver:r,dependencyPromises:o}]of t)Promise.all(o).then(async()=>{const[t,r]=this._makeContext(n);return e.executeAsync(t,r)}).then(()=>{if(i.has(e))for(const t of i.get(e))this._latestFieldValues[t.name]=t.value;r.resolve()},t=>{!t||s.isAbortError(t)||u(t)||e.markStale(),r.reject(t)});const a=(await Promise.allSettled(Array.from(t.values(),({resolver:e})=>e.promise))).filter(e=>"rejected"===e.status&&!(s.isAbortError(e.reason)||u(e.reason)));if(a.length>0){const e=new AggregateError(a,`One or more expression executions failed. First error message: ${a[0].reason}`);throw o.getLogger(this).error(e),e}}_makeContext(e){const[t,r]=this._baseContext,i=this.feature.clone();return i.attributes=e,[{...t,$feature:i},r]}get test(){}},t.__decorate([a.property()],e.FormExpressionsManager.prototype,"_asyncExecutors",null),t.__decorate([a.property()],e.FormExpressionsManager.prototype,"_baseContext",null),t.__decorate([a.property()],e.FormExpressionsManager.prototype,"feature",null),t.__decorate([a.property({constructOnly:!0})],e.FormExpressionsManager.prototype,"preserveFieldValuesWhenHidden",void 0),t.__decorate([a.property()],e.FormExpressionsManager.prototype,"executors",void 0),t.__decorate([a.property()],e.FormExpressionsManager.prototype,"fieldInputs",void 0),t.__decorate([a.property()],e.FormExpressionsManager.prototype,"arcadeContextInfo",void 0),e.FormExpressionsManager=t.__decorate([c.subclass("esri.widgets.FeatureForm.FormExpressionsManager")],e.FormExpressionsManager);const d=(e,t,r)=>{if(t.has(e))return;const i=s.createResolver();t.set(e,{resolver:i,dependencyPromises:[]}),e.abort();const o=r.get(e);for(const e of o)d(e,t,r),t.get(e).dependencyPromises.push(i.promise)},u=e=>e&&"object"==typeof e&&"message"in e&&"Cancelled"===e.message;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/FeatureForm/GroupInput":function(){define(["../../chunks/tslib.es6","../../core/reactiveUtils","../../core/uid","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./featureFormUtils","./InputBase"],function(e,t,r,i,o,n,s,a,l,c){"use strict";let p=class extends c{constructor(e){super(e),this._expressionTrackingHandles=new Map,this.id=r.generateUID().toString(),this.type="group"}initialize(){this.addHandles([t.watch(()=>[this.visible,this.inputs],([e])=>{const{inputs:t}=this,r=!!e&&void 0;for(const e of t)l.isFieldInput(e)&&(e.required=r)},{initial:!0,equals:(e,t)=>t[0]===e[0]&&t[1]===e[1]})])}destroy(){for(const e of this._expressionTrackingHandles.values())e.remove()}get initialState(){return this.element.initialState||"expanded"}get inputs(){return this._get("inputs")}set inputs(e){this.removeAllHandles(),e&&this.addHandles(e.map(e=>t.watch(()=>e.visible,()=>this._dirtyEvaluatedVisibilityExpression()))),this._set("inputs",e)}get label(){return super.label}get open(){return"expanded"===this.initialState}set open(e){this._override("open",e)}get visible(){return!1!==this.evaluatedVisibilityExpression&&this.inputs&&this.inputs.some(e=>e.visible)}_dirtyEvaluatedVisibilityExpression(){const{element:e}=this;e.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};return e.__decorate([i.property()],p.prototype,"id",void 0),e.__decorate([i.property()],p.prototype,"initialState",null),e.__decorate([i.property()],p.prototype,"inputs",null),e.__decorate([i.property()],p.prototype,"open",null),e.__decorate([i.property()],p.prototype,"type",void 0),e.__decorate([i.property()],p.prototype,"visible",null),p=e.__decorate([a.subclass("esri.widgets.FeatureForm.GroupInput")],p),p})},"esri/widgets/FeatureForm/RelationshipInput":function(){define(["../../chunks/tslib.es6","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/support/layerUtils","../Feature/FeatureRelationship/FeatureRelationshipViewModel","../Feature/support/featureUtils","./EditableInput","./featureFormUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d){"use strict";let u=class extends p{constructor(e){super(e),this._relationshipVM=null,this.group=null,this.type="relationship",this.addHandles([t.watch(()=>({feature:this.feature,element:this.element,layer:this.layer}),e=>this._createRelationshipVM(e),t.initial),t.on(()=>this.relatedLayer,"edits",()=>this._relationshipVM?.refresh())])}destroy(){this._relationshipVM?.destroy()}get canAddRelatedFeature(){const{editable:e,featureCount:t,relationship:r}=this;if(!r||!this.loaded||!this.relatedLayerAllowsAdds)return!1;if(this.allCategories?.length&&!this.activeCategory)return!1;const{cardinality:i,role:o}=r;return!("one-to-one"===i&&t>0)&&"many-to-many"!==i&&!("one-to-many"===i&&"destination"===o&&t>0)&&e}get activeCategory(){return this._relationshipVM?.activeCategory}set activeCategory(e){const t=this._relationshipVM;t&&(t.activeCategory=e)}get allCategories(){const{relatedLayer:e}=this,t=this._relationshipVM?.categories;if(!a.isSubtypeGroupLayer(e))return;const r=(e.subtypes??[]).map(({code:e,name:r})=>{const i=t?.find(e=>e.name===r);return{name:r,count:i?.count??0,value:i?.value??e}});return r.length?r:null}get categories(){return this.showAllEnabled?this.allCategories:this.allCategories?.slice(0,this.displayCount)}get displayCount(){return this.element.displayCount??3}get displayType(){return this.element.displayType}get editable(){return!!this.relatedLayerAllowsEdits&&(this.evaluatedEditableExpression??!0)}get featureCount(){return this._relationshipVM?.featureCount??0}get label(){return this.activeCategory?.name?this.activeCategory.name:this.getFormattedLabel(this.element?.label)}get loaded(){return"loading"!==this._relationshipVM?.state}get map(){return this._get("map")}set map(e){e&&this._relationshipVM?.set("map",e),this._set("map",e)}get orderByFields(){return this.element.orderByFields}get originHasValidKey(){return!(!this.relationship||!this.feature.getAttribute(this.relationship.keyField))}get relationship(){return this._relationshipVM?.relationship}get relationshipId(){return this.element.relationshipId}get relatedFeatureInfos(){const{_relationshipVM:e,timeZone:t}=this;if(!e?.relatedFeatures?.length||!e?.relatedLayer)return[];const{itemDescriptionFieldName:r,relatedFeatures:i,relatedLayer:o}=e,n=o&&"formTemplate"in o&&o.formTemplate?o.formTemplate.title:void 0;return i.map(e=>{let i;if(r){const n=e.getAttribute(r),s=o.fieldsIndex.get(r);if(s){const e=d.getComputedAttributes({values:[n],fields:[s],timeZone:t??void 0})[r];null!=e&&(i=e.toString())}}return{feature:e,description:i,title:n?d.parseFormTemplateString({label:n,attributes:e.attributes,fieldsIndex:o.fieldsIndex,timeZone:t}):void 0}}).toArray()}get relatedLayer(){return this._relationshipVM?.relatedLayer}get relatedLayerIsTable(){return!!this.relatedLayer?.isTable}get relatedLayerAllowsAdds(){const{relatedLayer:e}=this;if(!e||!this.relatedLayerAllowsEdits)return!1;const t=a.getEffectiveLayerCapabilities(e);return!!t?.operations?.supportsAdd}get relatedLayerAllowsEdits(){const{relatedLayer:e}=this;if(!e)return!1;const t=a.getEffectiveLayerCapabilities(e);return!!t?.operations?.supportsEditing}get showAllEnabled(){return this._get("showAllEnabled")}set showAllEnabled(e){this._relationshipVM?.set("showAllEnabled",e),this._set("showAllEnabled",e)}get showAllActionVisible(){return!this.showAllEnabled&&this.featureCount>0&&this.featureCount>this.displayCount}get showAllCategoriesVisible(){const e=this.allCategories?.length??0;return!this.showAllEnabled&&e>0&&e>this.displayCount}get visible(){const{relationship:e}=this;if(!e)return!1;const{cardinality:t}=e;return"many-to-many"!==t&&(null!=this.evaluatedVisibilityExpression?this.evaluatedVisibilityExpression:null!=this.element)}get updating(){return"loading"===this._relationshipVM?.state||"querying"===this._relationshipVM?.state}incrementPage(){this._relationshipVM&&this._relationshipVM.featurePage++}getRelatedFeatureByObjectId(e){return this._relationshipVM?.getRelatedFeatureByObjectId(e)}_createRelationshipVM(e){const{feature:t,element:r,layer:i}=e;if(this._relationshipVM?.destroy(),!t||!r||!i)return;const{displayCount:o,map:n,orderByFields:s,relationshipId:a,showAllEnabled:p}=this;c.isRelatableFeatureSupportedLayer(i)&&(this._relationshipVM=new l({graphic:t,displayCount:o,layer:i,map:n,orderByFields:s,relationshipId:a,showAllEnabled:p}))}};return e.__decorate([r.property()],u.prototype,"_relationshipVM",void 0),e.__decorate([r.property()],u.prototype,"canAddRelatedFeature",null),e.__decorate([r.property()],u.prototype,"activeCategory",null),e.__decorate([r.property()],u.prototype,"allCategories",null),e.__decorate([r.property()],u.prototype,"categories",null),e.__decorate([r.property()],u.prototype,"displayCount",null),e.__decorate([r.property()],u.prototype,"displayType",null),e.__decorate([r.property()],u.prototype,"editable",null),e.__decorate([r.property()],u.prototype,"featureCount",null),e.__decorate([r.property()],u.prototype,"group",void 0),e.__decorate([r.property()],u.prototype,"label",null),e.__decorate([r.property()],u.prototype,"loaded",null),e.__decorate([r.property()],u.prototype,"map",null),e.__decorate([r.property()],u.prototype,"orderByFields",null),e.__decorate([r.property()],u.prototype,"originHasValidKey",null),e.__decorate([r.property()],u.prototype,"relationship",null),e.__decorate([r.property()],u.prototype,"relationshipId",null),e.__decorate([r.property()],u.prototype,"relatedFeatureInfos",null),e.__decorate([r.property()],u.prototype,"relatedLayer",null),e.__decorate([r.property()],u.prototype,"relatedLayerIsTable",null),e.__decorate([r.property()],u.prototype,"relatedLayerAllowsAdds",null),e.__decorate([r.property()],u.prototype,"relatedLayerAllowsEdits",null),e.__decorate([r.property()],u.prototype,"showAllEnabled",null),e.__decorate([r.property()],u.prototype,"showAllActionVisible",null),e.__decorate([r.property()],u.prototype,"showAllCategoriesVisible",null),e.__decorate([r.property({readOnly:!0})],u.prototype,"type",void 0),e.__decorate([r.property()],u.prototype,"visible",null),e.__decorate([r.property()],u.prototype,"updating",null),u=e.__decorate([s.subclass("esri.widgets.FeatureForm.RelationshipInput")],u),u})},"esri/widgets/Feature/FeatureRelationship/FeatureRelationshipViewModel":function(){define(["require","exports","../../../chunks/tslib.es6","../../../Graphic","../../../core/Accessor","../../../core/arrayUtils","../../../core/Clonable","../../../core/Collection","../../../core/Identifiable","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../../rest/support/RelationshipQuery","../support/featureUtils","../../FeatureForm/featureFormUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g){"use strict";const b=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));function v(e){return null!=e&&""!==e}return t.default=class extends(s.ClonableMixin(l.IdentifiableMixin(o))){constructor(e){super(e),this._loaded=!1,this._queryAbortController=null,this._queryPageAbortController=null,this._queryFeatureCountAbortController=null,this.featuresPerPage=10,this.activeCategory=null,this.allCategories=null,this.description=null,this.graphic=null,this.layer=null,this.map=null,this.orderByFields=null,this.featureCount=0,this.relationshipId=null,this.showAllEnabled=!1,this.title=null,this._cancelQuery=()=>{const{_queryAbortController:e}=this;e&&e.abort(),this._queryAbortController=null},this._cancelQueryFeatureCount=()=>{const{_queryFeatureCountAbortController:e}=this;e&&e.abort(),this._queryFeatureCountAbortController=null},this._cancelQueryPage=()=>{const{_queryPageAbortController:e}=this;e&&e.abort(),this._queryPageAbortController=null},this._queryController=async()=>{this._cancelQuery();const e=new AbortController;this._queryAbortController=e,await c.ignoreAbortErrors(this._query()),this._queryAbortController===e&&(this._queryAbortController=null)},this._queryFeatureCountController=async()=>{this._loaded=!1,this._cancelQueryFeatureCount();const e=new AbortController;this._queryFeatureCountAbortController=e,await c.ignoreAbortErrors(this._queryFeatureCount()),this._queryFeatureCountAbortController===e&&(this._queryFeatureCountAbortController=null),this._loaded=!0},this._queryPageController=async()=>{const e=new AbortController;this._queryPageAbortController=e,await c.ignoreAbortErrors(this._queryPage()),this._queryPageAbortController===e&&(this._queryPageAbortController=null)},this._queryDebounced=c.debounce(this._queryController,100),this._queryFeatureCountDebounced=c.debounce(this._queryFeatureCountController,100),this._queryPageDebounced=c.debounce(this._queryPageController,100),this._query=async()=>{const{_queryAbortController:e,relatedFeatures:t}=this;this.featureCount&&("subtype-group"!==this.relatedLayer?.type||this.activeCategory)&&(this._destroyRelatedFeatureViewModels(),this.featurePage=1,t.destroyAll(),this.destroyed||t.addMany(this._sliceFeatures(await this._queryRelatedFeatures({signal:e?.signal}))))},this.addHandles([p.watch(()=>[this.displayCount,this.graphic,this.layer,this.layer?.loaded,this.map,this.orderByFields,this.relationshipId,this.featuresPerPage,this.showAllEnabled,this.canQuery,this.featureCount,this.activeCategory],()=>this._queryDebounced(),p.initial),p.watch(()=>[this.featurePage,this.showAllEnabled],()=>this._queryPageDebounced()),p.watch(()=>[this.layer,this.relationshipId,this.objectId,this.canQuery,this.activeCategory],()=>this._queryFeatureCountDebounced())])}destroy(){this._destroyRelatedFeatureViewModels(),this.relatedFeatures.destroyAll(),this._cancelQuery(),this._cancelQueryFeatureCount(),this._cancelQueryPage()}set featurePage(e){const{featuresPerPage:t,featureCount:r}=this,i=Math.ceil(r/t)||1;this._set("featurePage",Math.min(Math.max(e,1),i))}get featurePage(){return this._get("featurePage")}get orderByFieldsFixedCasing(){const{orderByFields:e,relatedLayer:t}=this;return e&&t?.loaded?e.map(e=>{const r=e.clone();return r.field=f.getFixedFieldName(e.field,t),r}):e??[]}get supportsCacheHint(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}get canLoad(){return!!this.map&&null!=this.relationshipId&&"number"==typeof this.objectId}get canQuery(){const e=this.layer?.capabilities?.queryRelated;return!!(this.relatedLayer&&this.relationship&&null!=this.relationshipId&&null!=this.objectId&&e?.supportsCount&&e?.supportsPagination)}get allCategoriesCount(){return this.allCategories?.length??0}get categories(){const{allCategories:e}=this;return this.showAllEnabled?e:e?.slice(0,this.displayCount)??null}set displayCount(e){this._set("displayCount",Math.min(Math.max(e??3,0),10))}get displayCount(){return this._get("displayCount")}get itemDescriptionFieldName(){return this.orderByFieldsFixedCasing[0]?.field||null}get objectId(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??null}get objectIdField(){return this.layer?.objectIdField||null}get relatedFeatures(){return this._get("relatedFeatures")||new a}get relatedLayer(){const{layer:e,map:t,relationship:r}=this;if(!e?.loaded||!t||!r)return null;const i="subtype-sublayer"===e.type&&e.parent&&f.isRelatableFeatureSupportedLayer(e.parent)?e.parent:e;return f.findRelatedLayer(t,i,r)??null}get relatedLayerKeyField(){const{relatedLayer:e,relationshipId:t}=this;return e?.loaded&&null!=t?e.relationships?.find(e=>e.id===t)?.keyField:null}get relatedLayerKeyFields(){const{relatedLayer:e}=this;return e?.loaded?e.relationships?.map(e=>e.keyField).filter(n.isSome)??[]:[]}get relationship(){const{relationshipId:e,layer:t}=this;return null!=e&&t?.loaded?t.relationships?.find(({id:t})=>t===e)??null:null}get relationshipKey(){const{relationshipKeyField:e}=this;return(e&&this.graphic?.attributes?.[e])??null}get relationshipKeyField(){return this.relationship?.keyField||null}get relatedFeatureViewModels(){return this._get("relatedFeatureViewModels")||new a}get state(){const{_queryAbortController:e,_queryFeatureCountAbortController:t,_queryPageAbortController:r,canQuery:i,_loaded:o,canLoad:n}=this;return t||n&&!o?"loading":e||r?"querying":i?"ready":"disabled"}getRelatedFeatureByObjectId(e){return this.relatedFeatures.find(t=>t.getObjectId()===e)}refresh(){this._queryFeatureCountDebounced()}_destroyRelatedFeatureViewModels(){this.relatedFeatureViewModels?.destroyAll()}async _queryFeatureCount(){const{layer:t,relatedLayer:r}=this;await(t?.load()),await(r?.load());const{_queryFeatureCountAbortController:i,activeCategory:o,canQuery:s,objectId:a,relatedLayerKeyField:l,relationshipId:c,relationshipKey:p,supportsCacheHint:d}=this;if(!s||!t||!r||null==a)return this._set("featureCount",0),void this._set("allCategories",null);if("subtype-group"===r?.type&&!o){if(this._set("featureCount",0),this._destroyRelatedFeatureViewModels(),this.featurePage=1,this.relatedFeatures.destroyAll(),l&&null!=p){const{default:t}=await new Promise((t,r)=>e(["../../../smartMapping/statistics/uniqueValues"],e=>t(b(e)),r)),{uniqueValueInfos:o}=await t({layer:r,sqlWhere:`${l} = '${p}'`,field:r.subtypeField,signal:i?.signal}),s=o.map(({count:e,value:t})=>{const i=r.subtypes?.find(e=>e.code===t)?.name;return null!=t&&i?{count:e,value:t,name:i}:void 0}).filter(n.isSome);this._set("allCategories",s)}return}const{historicMoment:u,gdbVersion:h}=t,y=new m({cacheHint:d,gdbVersion:h,historicMoment:u,relationshipId:c,returnGeometry:!1,objectIds:[a],where:this._getRelationshipWhereClause(r)}),f=await t.queryRelatedFeaturesCount(y,{signal:i?.signal});this._set("allCategories",null),this._set("featureCount",f[a]||0)}_getRelationshipWhereClause(e){const{activeCategory:t}=this,r=e.createQuery(),i="subtypeField"in e?e.subtypeField:void 0,o=t&&i?`${i} = ${t.value}`:void 0,n=r.where;return n&&o?`(${n}) AND (${o})`:n??o}_sliceFeatures(e){const{showAllEnabled:t,displayCount:r}=this;return t?e:r?e.slice(0,r):[]}async _queryPage(){const{relatedFeatures:e,featurePage:t,showAllEnabled:r,_queryPageAbortController:i,featureCount:o}=this;!r||t<2||!o||"subtype-group"===this.relatedLayer?.type&&!this.activeCategory||e.addMany(await this._queryRelatedFeatures({signal:i?.signal}))}async _queryRelatedFeatures(e){const{displayCount:t,featureCount:r,featurePage:i,featuresPerPage:o,layer:n,orderByFieldsFixedCasing:s,relatedLayer:a,relatedLayerKeyFields:l,relationshipId:c,showAllEnabled:p,supportsCacheHint:d}=this,{canQuery:u,objectId:h}=this;if(!u||!n||!a||null==h)return[];const y=p?((i-1)*o+r)%r:0,f=p?o:t,b=a.objectIdField,_="subtypeField"in a?a.subtypeField:void 0,w=[...s.map(e=>e.field),...g.getFieldsInTitleAndDesc(a),...l,b,_].filter(v),S=s.map(e=>`${e.field} ${e.order}`),{historicMoment:x,gdbVersion:M}=n,C=new m({orderByFields:S,start:y,num:f,outFields:w,cacheHint:d,historicMoment:x,gdbVersion:M,relationshipId:c,returnGeometry:!1,objectIds:[h],where:this._getRelationshipWhereClause(a)}),F=await n.queryRelatedFeatures(C,{signal:e?.signal}),k=F[h]?.features||[];return"subtype-group"===a.type&&_?k.forEach(e=>{const t=e.attributes[_],r=a.findSublayerForSubtypeCode?.(t);e.sourceLayer=r,e.layer=r}):k.forEach(e=>{e.sourceLayer=a,e.layer=a}),k}},r.__decorate([d.property()],t.default.prototype,"_loaded",void 0),r.__decorate([d.property()],t.default.prototype,"_queryAbortController",void 0),r.__decorate([d.property()],t.default.prototype,"_queryPageAbortController",void 0),r.__decorate([d.property()],t.default.prototype,"_queryFeatureCountAbortController",void 0),r.__decorate([d.property({value:1})],t.default.prototype,"featurePage",null),r.__decorate([d.property()],t.default.prototype,"featuresPerPage",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"orderByFieldsFixedCasing",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"supportsCacheHint",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"canLoad",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"canQuery",null),r.__decorate([d.property()],t.default.prototype,"activeCategory",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"allCategories",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"allCategoriesCount",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"categories",null),r.__decorate([d.property()],t.default.prototype,"description",void 0),r.__decorate([d.property({value:3})],t.default.prototype,"displayCount",null),r.__decorate([d.property({type:i})],t.default.prototype,"graphic",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"itemDescriptionFieldName",null),r.__decorate([d.property()],t.default.prototype,"layer",void 0),r.__decorate([d.property()],t.default.prototype,"map",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"objectId",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"objectIdField",null),r.__decorate([d.property()],t.default.prototype,"orderByFields",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"relatedFeatures",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"relatedLayer",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"relatedLayerKeyField",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"relatedLayerKeyFields",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"relationship",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"relationshipKey",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"relationshipKeyField",null),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"featureCount",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"relatedFeatureViewModels",null),r.__decorate([d.property()],t.default.prototype,"relationshipId",void 0),r.__decorate([d.property()],t.default.prototype,"showAllEnabled",void 0),r.__decorate([d.property()],t.default.prototype,"state",null),r.__decorate([d.property()],t.default.prototype,"title",void 0),t.default=r.__decorate([y.subclass("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],t.default),t.default})},"esri/widgets/FeatureForm/TextElementInput":function(){define(["../../chunks/tslib.es6","../../core/Collection","../../core/ReactiveMap","../../core/ReactiveSet","../../core/sanitizerUtils","../../core/uid","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles","../../layers/support/fieldUtils","./featureFormUtils","./InputBase","./support/textElementInputUtils","./support/textManipulationUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f){"use strict";let g=class extends y{constructor(e){super(e),this.group=null,this.id=`TextElementInput-${n.generateUID()}`,this.type="text",this._expressionReferences=new r,this._expressionsUsed=new i,this._fieldsUsed=new i,this._literalParts=new t,this._templateParts=new t,this._updatingHandles=new d.UpdatingHandles}initialize(){const{rawText:e}=this;e?"markdown"===this.textFormat?this._updatingHandles.addPromise(f.compileTextElementMarkdownToHTML(e).then(e=>this._initializeTextParts(e))):this._initializeTextParts(e):this._literalParts.push("")}get expressionsUsed(){return Array.from(this._expressionsUsed)}get fieldsIndex(){return this.layer.fieldsIndex}set fieldsIndex(e){this._overrideIfSome("fieldsIndex",e)}get fieldsUsed(){return Array.from(this._fieldsUsed)}get rawText(){return this.element.text}get text(){const e=this._templateParts.map(e=>`${this._expressionReferences.get(e)?.lastEvaluatedValue??""}`);return o.renderingSanitizer.sanitize(m.assembleStringFromParts(this._literalParts,e))}get textFormat(){return this.element.textFormat}get updating(){return this._updatingHandles.updating||Array.from(this._expressionReferences.values()).some(e=>e?.updating)}setExpressionExecutor(e,t){this._expressionReferences.set(h.prependExpressionPrefix(e),t)}setFieldExecutor(e,t){this._expressionReferences.set(h.prependFieldPrefix(e),t)}_initializeTextParts(e){const{fieldsIndex:t}=this,{literals:r,templates:i}=m.splitStringIntoParts(e),o=[],n=[];for(let e=0;e<i.length;e++){const s=r[e],a=u.extractSubstitutionTemplatesFromString(i[e])[0];if(h.isExpressionReference(a))this._expressionsUsed.add(h.extractExpressionNameFromString(a)),this._expressionReferences.set(a,null),o.push(s),n.push(a);else if(h.isLegacyFieldMapsExpressionReference(a)){this._expressionsUsed.add(a);const e=h.prependExpressionPrefix(a);this._expressionReferences.set(e,null),o.push(s),n.push(e)}else if(t?.has(a)){const e=t.normalizeFieldName(a);this._fieldsUsed.add(e);const r=h.prependFieldPrefix(e);this._expressionReferences.set(r,null),o.push(s),n.push(r)}else r[e+1]=s.concat(a,r[e+1])}o.push(r.at(-1)),this._literalParts.addMany(o),this._templateParts.addMany(n)}};return e.__decorate([s.property()],g.prototype,"expressionsUsed",null),e.__decorate([s.property()],g.prototype,"fieldsIndex",null),e.__decorate([s.property()],g.prototype,"fieldsUsed",null),e.__decorate([s.property()],g.prototype,"group",void 0),e.__decorate([s.property()],g.prototype,"id",void 0),e.__decorate([s.property()],g.prototype,"rawText",null),e.__decorate([s.property()],g.prototype,"text",null),e.__decorate([s.property()],g.prototype,"textFormat",null),e.__decorate([s.property()],g.prototype,"type",void 0),e.__decorate([s.property()],g.prototype,"updating",null),g=e.__decorate([p.subclass("esri.widgets.FeatureForm.TextElementInput")],g),g})},"esri/core/ReactiveSet":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t){"use strict";class r{constructor(e){this._observable=new t.SimpleObservable,this._set=new Set(e)}get size(){return e.trackAccess(this._observable),this._set.size}add(e){const t=this._set.size;return this._set.add(e),this._set.size!==t&&this._observable.notify(),this}clear(){this._set.size>0&&(this._set.clear(),this._observable.notify())}delete(e){const t=this._set.delete(e);return t&&this._observable.notify(),t}entries(){return e.trackAccess(this._observable),this._set.entries()}forEach(t,r){e.trackAccess(this._observable),this._set.forEach((e,i)=>t.call(r,e,i,this),r)}has(t){return e.trackAccess(this._observable),this._set.has(t)}keys(){return e.trackAccess(this._observable),this._set.keys()}values(){return e.trackAccess(this._observable),this._set.values()}[Symbol.iterator](){return e.trackAccess(this._observable),this._set[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._set[Symbol.toStringTag]}}return r})},"esri/widgets/FeatureForm/support/textElementInputUtils":function(){define(["exports"],function(e){"use strict";e.assembleStringFromParts=function(e,t){return t.reduce((t,r,i)=>t.concat(e.at(i),r),"").concat(e.at(-1))},e.splitStringIntoParts=function(e){const t=[...e.matchAll(/{[^{]+?}/g)];let r=0;const i=[],o=[];for(const n of t){const t=n[0];i.push(e.slice(r,n.index)),o.push(t),r=n.index+t.length}return i.push(e.slice(r)),{literals:i,templates:o}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/FeatureForm/support/textManipulationUtils":function(){define(["require","exports"],function(e,t){"use strict";let r;const i=["blockquote","html","hr","checkbox","table","tablerow","tablecell","image"];t.compileTextElementMarkdownToHTML=async function(t){return r||await async function(){const{Marked:t}=await new Promise((t,r)=>e(["../../../chunks/marked.esm"],t,r)),o=()=>"",n={};for(const e of i)n[e]=o;r=new t({renderer:{del:function({text:e}){return`<span style="text-decoration:line-through;">${e}</span>`},link:function({href:e,text:t,title:r}){return`<a${null!=e?` href="${e}"`:""}${null!=r?` title="${r}"`:""} target="_blank">${t??""}</a>`},...n}})}(),r.parse(t)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/forms/expressions/FormExpressionArcadeExecutor":function(){define(["exports","../../../../chunks/tslib.es6","../../../../arcade","../../../../core/Accessor","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/support/UpdatingHandles","../../../../layers/support/fieldUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d){"use strict";var u;const h=Symbol("FormExpressionArcadeExecutor");e.FormExpressionArcadeExecutor=class extends i{static{u=h}constructor(e){super(e),this[u]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._initialExecutionComplete=!1,this._stale=!1,this._updatingTracking=new p.UpdatingHandles,this._executeAsyncDebounced=o.debounce(async(e,t,r)=>{const i=await this.executor.executeAsync(e,{...t,abortSignal:r});return r.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=i,this._stale=!1,i)})}get initialExecutionComplete(){return this._initialExecutionComplete}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,t){this._abortController=new AbortController;const r=this.executor.execute(e,{...t,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=r,this._initialExecutionComplete=!0,r}async executeAsync(e,t){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,t??{},this._abortController.signal).then(()=>{this._initialExecutionComplete=!0}))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}},t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"_lastEvaluatedValue",void 0),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"_initialExecutionComplete",void 0),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"_stale",void 0),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"_updatingTracking",void 0),t.__decorate([n.property({constructOnly:!0})],e.FormExpressionArcadeExecutor.prototype,"executor",void 0),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"initialExecutionComplete",null),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"isAsync",null),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"fieldsUsed",null),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"syntaxTree",null),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"updating",null),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"stale",null),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"geometryUsed",null),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"variablesUsed",null),t.__decorate([n.property()],e.FormExpressionArcadeExecutor.prototype,"lastEvaluatedValue",null),e.FormExpressionArcadeExecutor=t.__decorate([c.subclass("esri.widgets.support.forms.expressions.FormExpressionArcadeExecutor")],e.FormExpressionArcadeExecutor),e.createFormExpressionArcadeExecutor=async(t,i)=>{const o=r.createArcadeProfile("form-calculation"),n=await r.createArcadeExecutor(t,o,{});return i?.fieldsIndex&&(n.fieldsUsed=d.fixFields(i.fieldsIndex,n.fieldsUsed)),new e.FormExpressionArcadeExecutor({executor:n})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/FeatureForm/VisibleElements":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.associationDetails=!0,this.readOnlyNotice=!0}};return e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"associationDetails",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"readOnlyNotice",void 0),a=e.__decorate([s.subclass("esri.widgets.FeatureForm.VisibleElements")],a),a})},"esri/widgets/FeatureTemplates":function(){define(["require","../chunks/tslib.es6","../intl","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../layers/support/layerUtils","./Widget","./FeatureTemplates/featureTemplatesUtils","./FeatureTemplates/FeatureTemplatesViewModel","./FeatureTemplates/VisibleElements","../chunks/componentsUtils","./support/globalCss","./support/ItemList","./support/symbolPreviewUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","../intl/substitute"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S){"use strict";function x(e){return e.id}let M=class extends p{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.messagesLegend=null,this.selectionMode="none",this.viewModel=new u,this.visibleElements=new h,this.renderCustomItem=e=>null,this.renderCustomGroupContent=e=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=e=>null,this.renderItemContentEnd=e=>null,this._iconIntersectionObserver=new IntersectionObserver((e,t)=>{e.forEach(async e=>{if(e.isIntersecting){const i=e.target;if(r=i,r?.["data-has-icon"])return void t.unobserve(i);const o=function(e){return e?.["data-item"]}(i),{layer:n,template:s}=o;C(i,!0);const a=o.label?S.substitute(this.messagesLegend.previewTemplateAriaLabel,{label:o.label}):this.messagesCommon.preview,l=await g.fetchThumbnail(s,n,{ariaLabel:a}).catch(()=>(C(i,!1),null));if(null==l)return;i.appendChild(l)}var r})}),this._renderItemIcon=e=>c.isTable(e.layer)?w.tsx("span",{"data-has-icon":!0,"data-item":e,key:"icon"},w.tsx("calcite-icon",{icon:"table"})):w.tsx("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":e,key:"icon"}),this._afterItemCreateOrUpdate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)}}initialize(){const e=({label:e})=>!this.filterText||!!e?.toLowerCase().includes(this.filterText.toLowerCase());this.addHandles(i.watch(()=>this.viewModel,(t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)},i.initial))}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return y.loadCalciteComponents({icon:()=>new Promise((t,r)=>e(["../chunks/index7"],t,r)),loader:()=>new Promise((t,r)=>e(["../chunks/index32"],t,r)),input:()=>new Promise((t,r)=>e(["../chunks/index4"],t,r)),list:()=>new Promise((t,r)=>e(["../chunks/index16"],t,r)),"list-item":()=>new Promise((t,r)=>e(["../chunks/index20"],t,r)),notice:()=>new Promise((t,r)=>e(["../chunks/index6"],t,r))})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:r,headingLevel:i,messages:o,viewModel:{items:n,numberOfFeatureTemplates:s,selectedItem:a,state:l}}=this,c=this.visibleElements.filter&&s>1;if((p=n).length>0&&d.isTemplateItemGroup(p[0])){const e=n.find(e=>e.label===d.nullGroupBy.label);e&&(e.label=o.other)}var p;return w.tsx("div",{"aria-label":o.widgetLabel,class:this.classes("esri-feature-templates",m.globalCss.widget)},"loading"===l?w.tsx("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):"ready"===l?w.tsx(f.ItemList,{disabled:e,enableListScroll:t,filterEnabled:c,filterText:r,headingLevel:i,id:this.id,identify:x,items:n,messages:{filterPlaceholder:o.filterPlaceholder,noItems:o.noItems,noMatches:o.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:a??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:e=>{this.filterText=e},onItemSelect:e=>!d.isTemplateItemGroup(e)&&this.viewModel.select(e)}):null)}};function C(e,t){e&&(e["data-has-icon"]=t)}return t.__decorate([o.property()],M.prototype,"disabled",null),t.__decorate([o.property()],M.prototype,"enableListScroll",void 0),t.__decorate([o.property()],M.prototype,"filterFunction",null),t.__decorate([o.property()],M.prototype,"filterText",void 0),t.__decorate([o.property()],M.prototype,"groupBy",null),t.__decorate([o.property()],M.prototype,"headingLevel",void 0),t.__decorate([o.property()],M.prototype,"icon",null),t.__decorate([o.property()],M.prototype,"label",null),t.__decorate([o.property()],M.prototype,"layers",null),t.__decorate([o.property(),v.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],M.prototype,"messages",void 0),t.__decorate([o.property(),v.messageBundle("esri/t9n/common")],M.prototype,"messagesCommon",void 0),t.__decorate([o.property(),v.messageBundle("esri/widgets/Legend/t9n/Legend")],M.prototype,"messagesLegend",void 0),t.__decorate([o.property({readOnly:!0})],M.prototype,"selectedItem",null),t.__decorate([o.property()],M.prototype,"selectionMode",void 0),t.__decorate([o.property(),_.vmEvent("select")],M.prototype,"viewModel",void 0),t.__decorate([o.property({type:h,nonNullable:!0})],M.prototype,"visibleElements",void 0),t.__decorate([o.property()],M.prototype,"renderCustomItem",void 0),t.__decorate([o.property()],M.prototype,"renderCustomGroupContent",void 0),t.__decorate([o.property()],M.prototype,"renderItemLabel",void 0),t.__decorate([o.property()],M.prototype,"renderItemDescription",void 0),t.__decorate([o.property()],M.prototype,"renderItemContent",void 0),t.__decorate([o.property()],M.prototype,"renderItemContentEnd",void 0),M=t.__decorate([l.subclass("esri.widgets.FeatureTemplates")],M),M})},"esri/widgets/FeatureTemplates/featureTemplatesUtils":function(){define(["exports","../../core/MapUtils"],function(e,t){"use strict";const r={key:Symbol(),label:"Other​"},i=e=>"items"in e;e.isTemplateGroupInfo=function(e){return"templateInfos"in e},e.isTemplateItemGroup=i,e.loadLayerWithTemplates=async function(e,t){return"subtype-sublayer"===e.type?await(e.parent?.load(t)):await e.load(t),e},e.makeGroupItemInfos=function(e,i){const o=new Map;for(const n of e){const e=i(n),{key:s,label:a}=null!=e.key?e:r;t.getOrCreateMapValue(o,s,()=>({label:a,templateInfos:[]})).templateInfos.push(n)}return Array.from(o.values())},e.makeTemplateGroupInfoForLayer=function(e,t){return{label:e.title??"",templateInfos:t.map(t=>({layer:e,template:t}))}},e.makeTemplateItemInfos=function(e){const t=[];for(const{layer:r,templates:i}of e)for(const e of i)t.push({layer:r,template:e});return t},e.mapItemsByTemplate=function(e){const t=new Map,r=[];for(const o of e)if(i(o)){r.push(o);for(const e of o.items)t.set(e.template,e)}else t.set(o.template,o);return[t,r]},e.nullGroupBy=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/FeatureTemplates/FeatureTemplatesViewModel":function(){define(["../../chunks/tslib.es6","../../core/asyncUtils","../../core/Evented","../../core/maybe","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles","../../editing/templateUtils","../../layers/support/layerUtils","./featureTemplatesUtils","./TemplateItem","./TemplateItemGroup"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f){"use strict";const g=({layer:e})=>({key:e,label:e.title??""}),b=({layer:e})=>({key:e.geometryType,label:e.geometryType??""});let v=class extends r.EventedAccessor{constructor(e){super(e),this._allItems=[],this._updatingHandles=new d.UpdatingHandles,this._updateTask=null,this.disabled=!1,this.disabledItemFunction=null,this.filterFunction=null,this.selectedItem=null,this.templateInfos=null,this.view=null}initialize(){this._get("groupBy")||(this.groupBy="layer"),this.addHandles([n.watch(()=>[this.templateInfos,this.layers],([e],t)=>{e&&e===t?.at(0)||(this._updateTask=i.abortMaybe(this._updateTask),e?this._updateAllItems(e):this._getTemplatesAndUpdateAllItems())},n.syncAndInitial),n.watch(()=>this._groupByFunction,()=>{null==this.templateInfos&&(this._updateTask=i.abortMaybe(this._updateTask),this._getTemplatesAndUpdateAllItems())},n.sync),n.watch(()=>this.filterFunction,e=>{for(const t of this._allItems)y.isTemplateItemGroup(t)&&(t.filterFunction=e)},n.sync)])}set groupBy(e){if(this._set("groupBy",e),"function"!=typeof e)switch(e){case"layer":this._groupByFunction=g;break;case"geometry":this._groupByFunction=b;break;default:this._groupByFunction=null}else this._groupByFunction=t=>this._ensureGroupByObject(e(t))}get layers(){return this._get("layers")}set layers(e){const t="layers";if(this.removeHandles(t),e){const r=()=>this.notifyChange("state");this.addHandles(e.map(e=>n.when(()=>e.loadStatus,r)),t)}this._set("layers",e)}get state(){return this.updating?"loading":0!==this.layers.length||this.templateInfos?.length?"ready":"disabled"}get numberOfFeatureTemplates(){return this._allItems.reduce((e,t)=>y.isTemplateItemGroup(t)?e+t.allItems.length:e+1,0)}get items(){const{filterFunction:e}=this;return null==e?this._allItems:this._allItems.filter(t=>y.isTemplateItemGroup(t)?t.items.length>0:e(t))}get updating(){return this._updatingHandles.updating}refresh(){this.notifyChange("filterFunction");for(const e of this._allItems)y.isTemplateItemGroup(e)&&e.reapplyFilter()}select(e,{emit:t=!0}={}){const r=this.selectedItem,i=e?.clone()||null;this._set("selectedItem",i),t&&this.emit("select",{item:i,oldItem:r,template:i?.template??null})}_createItem(e,t){return new m({disabledFunction:this.disabledItemFunction,layer:t,template:e})}_ensureGroupByObject(e){return"string"==typeof e?{key:e,label:e}:e}_updateAllItems(e){const t=this._allItems;if(0===e.length)return function(e){for(const t of e){if(y.isTemplateItemGroup(t))for(const e of t.items)e.destroy();t.destroy()}}(t),void(this._allItems=[]);const[r,i]=y.mapItemsByTemplate(t),o=e=>{const t=r.get(e.template);return t?(r.delete(e.template),t):this._createItem(e.template,e.layer)},{filterFunction:n}=this,s=e.filter(_).map(e=>y.isTemplateGroupInfo(e)?new f({filterFunction:n,label:e.label,allItems:e.templateInfos.filter(_).map(e=>o(e))}):o(e));for(const e of[...r.values(),...i])e.destroy();this._allItems=s}async _getTemplatesFromLayers(e){const t=[],r={signal:e};await Promise.all(this.layers.map(async i=>{await y.loadLayerWithTemplates(i,r),o.throwIfAborted(e);const n=h.getEffectiveLayerCapabilities(i)?.operations;n?.supportsEditing&&n?.supportsAdd&&(h.isSubtypeGroupLayer(i)?t.push(...i.sublayers):t.push(i))}));const i=await u.getTemplatesForLayers(t,this.view,e);o.throwIfAborted(e);const n=y.makeTemplateItemInfos(i),s=this._groupByFunction;if(null==s)return n;const a=y.makeGroupItemInfos(n,s);return 1===a.length&&a[0].label===y.nullGroupBy.label?a[0].templateInfos:a}async _getTemplatesAndUpdateAllItems(){if(0===this.layers.length)return;const e=t.createTask(async e=>{const t=await this._getTemplatesFromLayers(e);o.throwIfAborted(e),this._updateAllItems(t)});this._updateTask=e,await this._updatingHandles.addPromise(e.promise)}};function _(e){return y.isTemplateGroupInfo(e)?e.templateInfos.some(_):!u.isSharedTemplateOrMetadata(e.template)||!1!==e.template.visible}return e.__decorate([s.property()],v.prototype,"_allItems",void 0),e.__decorate([s.property()],v.prototype,"_groupByFunction",void 0),e.__decorate([s.property()],v.prototype,"_updatingHandles",void 0),e.__decorate([s.property()],v.prototype,"disabled",void 0),e.__decorate([s.property()],v.prototype,"disabledItemFunction",void 0),e.__decorate([s.property({value:null})],v.prototype,"filterFunction",void 0),e.__decorate([s.property()],v.prototype,"groupBy",null),e.__decorate([s.property({value:[]})],v.prototype,"layers",null),e.__decorate([s.property()],v.prototype,"state",null),e.__decorate([s.property({readOnly:!0})],v.prototype,"numberOfFeatureTemplates",null),e.__decorate([s.property({readOnly:!0})],v.prototype,"items",null),e.__decorate([s.property({readOnly:!0})],v.prototype,"selectedItem",void 0),e.__decorate([s.property()],v.prototype,"templateInfos",void 0),e.__decorate([s.property()],v.prototype,"updating",null),e.__decorate([s.property()],v.prototype,"view",void 0),v=e.__decorate([p.subclass("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],v),v})},"esri/editing/templateUtils":function(){define(["exports","../core/Logger","../core/MapUtils","../core/promiseUtils","../core/SetUtils","./sharedTemplates/templateDefinitions/templateDefinitionUtils","../layers/support/layerUtils","../rest/sharedTemplates/querySharedTemplates","../undoredo/support/Services"],function(e,t,r,i,o,n,s,a,l){"use strict";const c=()=>t.getLogger("esri.editing.templateUtils");function p(e){return d(e)&&"definition"in e}function d(e){return null!=e&&"templateId"in e}const u=e=>null==e||"object"!=typeof e?[]:[..."templates"in e&&Array.isArray(e.templates)?e.templates:[],..."types"in e&&Array.isArray(e.types)?e.types.flatMap(e=>e.templates):[]];function h(e,t){return s.isSubtypeSublayer(t)&&t.parent?e.tablesAndLayersLookup.get(t.parent):s.isFeatureLayer(t)?e.tablesAndLayersLookup.get(t):null}function y(e){const t=new Map;for(const i of e)r.getOrCreateMapValue(t,i.subtypeCode??1/0,()=>[]).push(i);return t}e.getAllStandardFeatureTemplatesForLayer=u,e.getServiceInfoForLayer=h,e.getTemplatesForLayers=async function(e,t,n){if(null==t)return e.map(e=>({layer:e,templates:u(e)}));const p=await async function(e,t){const r=await l.getServices(t).load(),i=new Set;for(const t of e)o.addMaybe(i,h(r,t));return await Promise.all(Array.from(i).map(e=>e.featureService.load())),i}(e,t);i.throwIfAborted(n);const d=new Map,m=Array.from(p).map(e=>async function({serviceInfo:e,out:t,signal:o}){const{featureService:n,layersAndTables:l}=e,c=await async function({featureService:e,layers:t,signal:i}){if(!e.capabilities?.editing.supportsSharedTemplates)return new Map;const o=new Map(t.map(e=>[e.layerId,e])),n=await a.querySharedTemplates({featureService:e,query:{layers:Array.from(o.keys())},requestOptions:{signal:i}}),s=new Map;for(const e of n)for(const t of e.layerIds)o.has(t)&&r.getOrCreateMapValue(s,o.get(t),()=>[]).push(e);return s}({featureService:n,layers:l.toArray(),signal:o});i.throwIfAborted(o);for(const[e,r]of c.entries())if(0!==r.length)if(s.isSubtypeGroupLayer(e)){const i=y(r),o=[],n=i.get(1/0)??o;for(const r of e.sublayers){const e=i.get(r.subtypeCode)??o;t.set(r,[...e,...n])}}else t.set(e,r)}({serviceInfo:e,out:d,signal:n})),f=await Promise.allSettled(m);for(const e of f.filter(e=>"rejected"===e.status))c().warn("Failed to fetch shared templates for service. Will use standard templates if available.",e.reason);return e.map(e=>({layer:e,templates:d.get(e)??u(e)}))},e.isLoadedSharedTemplate=function(e){return p(e)&&null!=e?.definition},e.isSharedFeatureTemplate=function(e){return p(e)&&"feature"===e?.type&&(null==e.definition||n.isFeatureTemplateDefinition(e.definition))},e.isSharedGroupTemplate=function(e){return p(e)&&"group"===e?.type&&(null==e.definition||n.isGroupTemplateDefinition(e.definition))},e.isSharedPresetTemplate=function(e){return p(e)&&"preset"===e?.type&&(null==e.definition||n.isPresetTemplateDefinition(e.definition))},e.isSharedTemplate=p,e.isSharedTemplateMetadata=function(e){return d(e)&&!("definition"in e)},e.isSharedTemplateOrMetadata=d,e.isStandardFeatureTemplate=function(e){return null!=e&&"prototype"in e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/editing/sharedTemplates/templateDefinitions/templateDefinitionUtils":function(){define(["exports"],function(e){"use strict";e.isFeatureTemplateDefinition=function(e){return"feature"===e.type},e.isGroupTemplateDefinition=function(e){return"group"===e.type},e.isPresetTemplateDefinition=function(e){return"preset"===e.type},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/sharedTemplates/querySharedTemplates":function(){define(["exports","../../request","../../core/Error","../../core/urlUtils","../../editing/sharedTemplates/SharedTemplateMetadata"],function(e,t,r,i,o){"use strict";function n(e){return Array.isArray(e)?e.join(","):""}function s(e){return null==e||!e.length}e.querySharedTemplates=async function({featureService:e,query:a,requestOptions:l={}}){if(s(a.layers)&&s(a.templateIds)&&(a.layers=e.layerInfos.map(e=>e.id),!a.layers.length))throw new r("query-shared-templates:invalid-parameters","Must supply a value for either the 'layers' or the 'templateIds' parameters");const c=i.join(e.url,"sharedTemplates","query"),p={f:"json",...l.query,...a};p.layers&&(p.layers=n(p.layers)),p.templateIds&&(p.templateIds=n(p.templateIds)),p.tags&&(p.tags=n(p.tags));const d={...l,responseType:"json",query:p};return(await t(c,d)).data.templates.map(t=>{const r=o.fromJSON(t);return r.featureService=e,r})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/editing/sharedTemplates/SharedTemplateMetadata":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","./support/toolNames"],function(e,t,r,i,o,n,s,a,l){"use strict";let c=class extends t.JSONSupport{constructor(e){super(e),this.type="feature",this.templateId=null,this.defaultTool=null,this.description=null,this.globalId="",this.hash="",this.layerIds=[],this.name="",this.subtypeCode=null,this.status=null,this.userIdentity=null,this.tags=[],this.visible=!0}readThumbnail(e){return null==e||""===e?null:{contentType:"png",imageData:e,height:64,width:64}}readDefaultTool(e){return null==e?null:l.namedEditingToolGUIDDict.fromJSON(e.toLowerCase())}readLayerIds(e,t){return null!=t.layerIds?t.layerIds.split(",").map(e=>parseInt(e.trim(),10)):null!=t.layerId?[t.layerId]:[]}readTags(e,t){const r=t.tag;return null==r?[]:r.split(";").map(e=>e.trim())}};return e.__decorate([r.property()],c.prototype,"type",void 0),e.__decorate([r.property({json:{read:!1,write:!1}})],c.prototype,"featureService",void 0),e.__decorate([r.property()],c.prototype,"thumbnail",void 0),e.__decorate([s.reader("thumbnail")],c.prototype,"readThumbnail",null),e.__decorate([r.property()],c.prototype,"templateId",void 0),e.__decorate([r.property()],c.prototype,"defaultTool",void 0),e.__decorate([s.reader("defaultTool")],c.prototype,"readDefaultTool",null),e.__decorate([r.property()],c.prototype,"description",void 0),e.__decorate([r.property()],c.prototype,"globalId",void 0),e.__decorate([r.property()],c.prototype,"hash",void 0),e.__decorate([r.property()],c.prototype,"layerIds",void 0),e.__decorate([s.reader("layerIds",["layerIds","layerId"])],c.prototype,"readLayerIds",null),e.__decorate([r.property()],c.prototype,"name",void 0),e.__decorate([r.property({json:{name:"subtype"}})],c.prototype,"subtypeCode",void 0),e.__decorate([r.property()],c.prototype,"status",void 0),e.__decorate([r.property()],c.prototype,"userIdentity",void 0),e.__decorate([r.property()],c.prototype,"tags",void 0),e.__decorate([s.reader("tags",["tag"])],c.prototype,"readTags",null),e.__decorate([r.property()],c.prototype,"visible",void 0),c=e.__decorate([a.subclass("esri.editing.sharedTemplates.SharedTemplateMetadata")],c),c})},"esri/editing/sharedTemplates/support/toolNames":function(){define(["exports","../../../core/jsonMap"],function(e,t){"use strict";const r=new t.JSONMap({"{acd53634-cbc7-44d5-bde9-692fa8d45850}":"autocomplete-freehand-polygons","{6f5fc612-d1ef-4d32-a2e1-18a1cb22331c}":"autocomplete-polygons","{09c6f589-a3ce-48ab-81bc-46965c58f264}":"circle","{bccf295a-9c64-4adc-903e-62d827c10ef7}":"create-points-along-line","{756cadf6-91e6-04b1-2938-e172a97af51c}":"create-structures","{ddbe4c0c-063f-8b60-b2da-b349a1e42e84}":"difference-polygon","{a5f4db5f-4a6b-29bd-1f32-9d81bf262c76}":"elevation-point-from-contour","{285ec4bb-60a8-7184-2088-5bee2149f2a4}":"elevation-point-from-dem","{28c04532-3daf-4d3d-b7be-a589c9c9a03e}":"ellipse","{0a7c16b9-1cfd-467f-8ece-6ba376192431}":"freehand","{af2dbf8f-280e-44db-8860-e399d0b30cf1}":"line","{bc485127-2ea2-4c8b-85ef-e8237959eb64}":"multipoint","{d304243a-5c3a-4ccc-b98b-93684b15fd83}":"parcel-seed","{2a8b3331-5238-4025-972e-452a69535b06}":"point","{d376f8e5-69e0-4273-9478-724e9e0d81ac}":"point-and-rotation","{93ce7077-f09e-455e-ade7-b7413cddc393}":"point-at-end-of-line","{8f79967b-66a0-4a1c-b884-f44bc7e26921}":"polygon","{a947ba80-1c29-4bcd-8672-1963b7b9dde0}":"radial-line","{6f0ed2cc-c099-4895-bd7e-beec2f78adbf}":"rectangle","{a281e635-0f22-47d4-a438-e4d29b920e22}":"regular-polygon","{5664cae4-c7de-432a-9933-9586bc15ed39}":"regular-polyline","{c5c42e29-44da-4a1c-8688-e02c07535bc3}":"right-angle-line","{ee16991b-6303-4a8a-9143-1914b2010c1a}":"right-angle-polygon","{7d3e17cf-30dd-4593-9bd8-0b2b8770f52a}":"split","{e00209dd-05c5-4424-be62-51581f9f811d}":"stream-line","{6c6970a7-5ca9-448c-9c7d-0d716cd2ac64}":"stream-polygon","{e22f7d98-007d-427c-8282-13704f7c84c3}":"trace","{6cf59352-8e14-402c-8f4c-ed72647f5e42}":"two-point-line"});e.namedEditingToolGUIDDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/undoredo/support/Services":function(){define(["require","exports","../../chunks/tslib.es6","../../kernel","../../core/Collection","../../core/Error","../../core/Evented","../../core/Loadable","../../core/Logger","../../core/MapUtils","../../core/Promise","../../core/promiseUtils","../../core/ReactiveMap","../../core/reactiveUtils","../../core/urlUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles","../../layers/support/arcgisLayerUrl","../../layers/support/layerUtils","../../portal/Portal","../../portal/support/utils","../../rest/featureService/FeatureService","./ServiceVersionInfo"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C){"use strict";const F=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),k=new Map;t.Services=class extends(a.LoadableMixin(p.EsriPromiseMixin(s.EventedAccessor))){constructor(e){super(e),this._updatingHandles=new v.UpdatingHandles,this.items=new o,this.tablesAndLayersLookup=new u,this.additionalLayers=new o,this._debouncedCheckAndUpdateServiceInfos=d.debounce(async()=>{const e=[];for(const t of this.items){if(0===t.layersAndTables.length)continue;const r=t.layersAndTables.getItemAt(0);r?.gdbVersion!==t.versionInfo?.versionIdentifier.name&&e.push(t)}0!==e.length&&(await h.whenOnce(()=>!this.updating),await this._updateVersionInfos(e))}),this._debouncedLayersChanged=d.debounce(async()=>{const e=this._detectNewLayersAndTables();0!==e.length&&(await h.whenOnce(()=>!this._updatingHandles.updating),await this._updatingHandles.addPromise((async()=>{const t=new Set;for(const r of e)if("feature"===r.type||"subtype-group"===r.type){if(!r.url)continue;const e=_.parse(r.url).url.path,i=this._findServiceInfo(e);if(i)this.tablesAndLayersLookup.set(r,i),r.isTable?i.tables.push(r):i.layers.push(r);else if(!t.has(e))try{await this._addServiceInfo(e,r)}catch(t){l.getLogger(this).error(`Failed to load feature service: ${e}`,t)}finally{t.add(e)}}})()))}),this._processed=new Set}destroy(){this._set("view",null),this.items.removeAll(),this.tablesAndLayersLookup.clear()}async load(e){return d.throwIfAborted(e),this.addHandles([h.watch(()=>this.view.map,()=>{this._reset()}),h.watch(()=>this._allLayersAndTables,()=>{this._debouncedLayersChanged().catch(e=>{l.getLogger(this).warn("Failed to update service info",e)})}),h.watch(()=>this.items.map(e=>e.layersAndTables.map(e=>e.gdbVersion??"").join(",")),()=>{this.checkAndUpdateServiceInfos().catch(e=>{l.getLogger(this).warn("Failed to update service info",e)})})]),this.addResolvingPromise(this._debouncedLayersChanged()),this}get updating(){return"loading"===this.loadStatus||this._updatingHandles.updating}checkAndUpdateServiceInfos(){return this._debouncedCheckAndUpdateServiceInfos()}changeVersion(e,t,r){return this._updatingHandles.addPromise((async()=>{await this._changeVersionInternal(e,t,r)})())}createVersion(e){return this._updatingHandles.addPromise((async()=>{const t=e.featureServerUrl,r=this._findServiceInfo(t);if(!r?.versionService)throw new n("services:no-version-management-service","No version management service");const i=r.hasAdvancedEditingUserTypeExtension,o=r.loggedInServiceUser.toUpperCase(),s=(a=e.ownerName)&&0!==a.trim().length?e.ownerName?.trim().toUpperCase():o;var a;if(s!==o){if(r.featureServiceVersion<=11.1)throw new n("services:versioning-api-error","Version management API too old");if(!i)throw new n("services:no-advanced-editing-user-type-extension","No advanced editing extension on service")}if("SDE"===s?.toUpperCase()&&"DEFAULT"===e.versionName.toUpperCase())throw new n("services:no-valid-version-name","No valid version name");{const t=await r.versionService.getVersionInfos();if(t?.find(t=>t.versionIdentifier.name.toUpperCase()===(s+"."+e.versionName).toUpperCase()||t.versionIdentifier.name.toUpperCase()===(o+"."+e.versionName).toUpperCase()))throw new n("services:no-valid-version-name","No valid version name")}const l=await r.versionService.createVersion({versionName:e.versionName,access:s!==o?"public":e.access,description:e.description});if(s!==o){const{guid:t,name:i}=l.versionIdentifier;await r.versionService.alterVersion({guid:t,name:i},{ownerName:s,access:e.access})}e.switchToVersion&&await this._changeVersionInternal(t,l.versionIdentifier.name,l.versionIdentifier.guid),this.emit("version-created",{versionIdentifier:l.versionIdentifier,versionManagementService:r.versionService})})())}deleteVersion(e,t,r){return this._updatingHandles.addPromise((async()=>{const i=this._findServiceInfo(e);if(!i?.versionService)throw new n("services:no-version-management-service","No version management service");if(i.featureServiceVersion<=11.1)throw new n("services:versioning-api-error","Version management API too old");if(!i.hasAdvancedEditingUserTypeExtension)throw new n("services:no-advanced-editing-user-type-extension","No advanced editing extension on service");const o={name:t,guid:r};await i.versionService.deleteVersion(o)&&(await this._updateVersionInfo(i),this.emit("version-deleted",{versionIdentifier:o,versionManagementService:i.versionService}))})())}startEditing(e){return this._updatingHandles.addPromise((async()=>{const t=this._findServiceInfo(e);if(!t?.versionService)throw new n("services:no-version-management-service","No version management service");if(!t.hasAdvancedEditingUserTypeExtension)throw new n("services:no-advanced-editing-user-type-extension","No advanced editing extension on service");const r=t.versionInfo?.versionIdentifier??{name:t.versionService.defaultVersionIdentifier.name,guid:t.versionService.defaultVersionIdentifier.guid};let i=!0;("none"!==t.versionService.getLockType(r)||(i=await t.versionService.startReading(r),i))&&(i=await t.versionService.startEditing(r),t.updateLockType())})())}finishEditing(e,t){return this._updatingHandles.addPromise((async()=>{const r=this._findServiceInfo(e);if(!r?.versionService)throw new n("services:no-version-management-service","No version management service");if(!r.hasAdvancedEditingUserTypeExtension)throw new n("services:no-advanced-editing-user-type-extension","No advanced editing extension on service");const i=r.versionInfo?.versionIdentifier??{name:r.versionService.defaultVersionIdentifier.name,guid:r.versionService.defaultVersionIdentifier.guid},o=r.versionService.getLockType(i);if("none"!==o)return"read"===o?(await r.versionService.stopReading(i),void r.updateLockType()):"edit"===o?(await r.versionService.stopEditing(i,t),await r.versionService.stopReading(i),void r.updateLockType()):void 0})())}async _changeVersionInternal(e,t,r){const i=this._findServiceInfo(e);if(!i?.versionService)throw new n("services:no-version-management-service","No version management service");const o=i.versionInfo?.versionIdentifier??{name:i.versionService.defaultVersionIdentifier.name,guid:i.versionService.defaultVersionIdentifier.guid},s={name:t,guid:r};await i.versionService.changeVersion(this.view?.map,o,s)&&await this._updateVersionInfo(i)}async _updateVersionInfo(e){const t=e.versionService;if(!t)return;if(0===e.layersAndTables.length)return;const r=e.layersAndTables.getItemAt(0)?.gdbVersion,i=r?await t.getVersionIdentifierFromName(r):t.defaultVersionIdentifier;e.versionInfo=await t.getVersionInfoExtended(i)}_findServiceInfo(e){return this.items.find(t=>t.featureService.url===e)??null}_removeFeatureService(e){this.items.remove(e)}_reset(){this.additionalLayers.removeAll(),this._processed.clear(),this.tablesAndLayersLookup.clear(),this.items.removeAll()}async _findPortal(e){const t=i.id?.findServerInfo(e??"");if(!t?.owningSystemUrl)return null;const r=`${t.owningSystemUrl}/sharing/rest`,o=S.getDefault();return o?.loaded&&y.normalize(o.restUrl)===y.normalize(r)?o:new S({authMode:"immediate",url:t.owningSystemUrl}).load()}_updateVersionInfos(e){return this._updatingHandles.addPromise((async()=>{for(const t of e)await this._updateVersionInfo(t).catch(e=>{l.getLogger(this).error("Failed to update version details",e)})})())}async _addServiceInfo(t,r){const i=new M({url:t});await i.load();const n=await this._findPortal(t),s=n?.user?.username;let a=!1;s&&(a=await x.hasUserTypeExtension(n,s,"advediting"));let l=null;i.versionManagementServiceUrl&&(l=new(0,(await new Promise((t,r)=>e(["../../versionManagement/VersionManagementService"],e=>t(F(e)),r))).default)({url:i.versionManagementServiceUrl}),await l.load());const c=r.isTable?[]:[r],p=r.isTable?[r]:[],d=new C.ServiceVersionInfo({loggedInServiceUser:s??"",hasAdvancedEditingUserTypeExtension:a,versionInfo:null,lockType:"none",canEditVersionedData:!0,canCreateVersion:!0,featureService:i,versionService:l,layers:new o(c),tables:new o(p)});return l&&await this._updateVersionInfo(d),this.items.push(d),this.tablesAndLayersLookup.set(r,d),r.isTable?d.tables.push(r):d.layers.push(r),d}get _allLayersAndTables(){return[...this.view.map?.allLayers??[],...this.view.map?.allTables??[],...this.additionalLayers]}_detectNewLayersAndTables(){const e=new Set(this._allLayersAndTables),t=[];for(const r of e)"feature"!==r.type&&"subtype-group"!==r.type||this._processed.has(r)||t.push(r);for(const t of this._processed)if(!e.has(t)&&(w.isSubtypeGroupLayer(t)||w.isFeatureLayer(t))){const e=this.tablesAndLayersLookup.get(t);if(!e)continue;this.tablesAndLayersLookup.delete(t),t.isTable?e.tables.remove(t):e.layers.remove(t),0===e.layersAndTables.length&&this._removeFeatureService(e)}return this._processed=e,t}},r.__decorate([m.property({constructOnly:!0})],t.Services.prototype,"view",void 0),r.__decorate([m.property()],t.Services.prototype,"items",void 0),r.__decorate([m.property()],t.Services.prototype,"tablesAndLayersLookup",void 0),r.__decorate([m.property()],t.Services.prototype,"additionalLayers",void 0),r.__decorate([m.property()],t.Services.prototype,"updating",null),r.__decorate([m.property()],t.Services.prototype,"_allLayersAndTables",null),t.Services=r.__decorate([b.subclass("esri.undoredo.support.Services")],t.Services),t.getServices=function(e){return c.getOrCreateMapValue(k,e,()=>{const r=new t.Services({view:e});return e.addHandles({remove(){k.delete(e),r.destroy()}}),r.load().catch(e=>{l.getLogger("esri.views.Services").error("Failed to load service metadata",e)}),r})},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/utils":function(){define(["exports","../../kernel","../../request"],function(e,t,r){"use strict";async function i(e,i,o){const n=t.id?.findCredential(e.restUrl);if(!n)return null;if("loaded"===e.loadStatus&&""===i&&e.user?.sourceJSON&&!1===o)return e.user.sourceJSON;const s={responseType:"json",query:{f:"json"}};if(o&&(s.query.returnUserLicenseTypeExtensions=!0),""===i){const t=await r(e.restUrl+"/community/self",s);if(t.data){const e=t.data;if(e?.username)return e}return null}const a=await r(e.restUrl+"/community/users/"+i,s);if(a.data){const e=a.data;return e.error?null:e}return null}e.hasPrivilege=async function(e,t,r){const o=await i(e,t,!0);return o?.privileges?.includes(r)??!1},e.hasUserTypeExtension=async function(e,t,r){const o=await i(e,t,!0);return o?.userLicenseTypeExtensions?.includes(r)??!1},e.lookupUser=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/featureService/FeatureService":function(){define(["../../chunks/tslib.es6","../../config","../../kernel","../../request","../../core/arrayUtils","../../core/Error","../../core/Identifiable","../../core/JSONSupport","../../core/lang","../../core/Loadable","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../geometry/SpatialReference","../../layers/graphics/applyEditsUtils","../../layers/graphics/editingSupport","../../layers/mixins/EditBusLayer","../../layers/support/featureLayerUtils","../../layers/support/layerUtils","../../layers/support/serviceCapabilitiesUtils","../../portal/PortalItem","../../portal/support/portalItemUtils","../../portal/support/urlUtils","../utils","../query/operations/editsZScale","../support/jsonUtils","../../versionManagement/support/versionManagementUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F,k,I,T){"use strict";function L(e,t){const r=t.id;return{id:r,name:t.name,url:`${e}/${r}`,type:t.type||"Table"}}function E(e){return{isDataVersioned:I.readBoolean(e,"hasVersionedData",!1),isDataBranchVersioned:I.readBoolean(e,"hasBranchVersionedData",!1)}}function A(e,t){const r=e?e.toLowerCase().split(",").map(e=>e.trim()):[],i=r.includes("query"),o=r.includes("editing")&&!t.datesInUnknownTimezone;let n=o&&r.includes("create"),s=o&&r.includes("delete"),a=o&&r.includes("update");return o&&!(n||s||a)&&(n=s=a=!0),{supportsAdd:n,supportsDelete:s,supportsEditing:o,supportsChangeTracking:r.includes("changetracking"),supportsQuery:i,supportsQueryDataElements:I.readBoolean(t,"supportsQueryDataElements",!1),supportsQueryDomains:I.readBoolean(t,"supportsQueryDomains",!1),supportsQueryContingentValues:I.readBoolean(t,"supportsQueryContingentValues",!1),supportsSync:r.includes("sync"),supportsUpdate:a}}function V(e){return{maxRecordCountFactor:I.readNumber(e,"maxRecordCountFactor",void 0),maxRecordCount:I.readNumber(e,"maxRecordCount",void 0)}}function O(e){const t=e?.advancedEditingCapabilities;return{supportsAsyncApplyEdits:I.readBoolean(t,"supportsAsyncApplyEdits",!1),supportsGlobalId:I.readBoolean(e,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:I.readBoolean(t,"supportsReturnServiceEditsInSourceSR",!1),supportsSharedTemplates:I.readBoolean(e,"supportsSharedTemplates",!1)||I.readBoolean(e,"hasSharedTemplates",!1),supportsSplit:I.readBoolean(t,"supportsSplit",!1)}}function P(e){const t=e?.syncCapabilities,r=t?.supportedSyncDataOptions;return{supportsAsync:I.readBoolean(t,"supportsAsync",!1),supportedSyncDataOptions:{annotations:!(1&~r),dimensions:!(2&~r),contingentValues:!(4&~r),attributeRules:!(8&~r),utilityNetworkSystem:!(16&~r),annotationFullModel:!(32&~r),include3DObjects:!(64&~r),utilityNetworkMissingLayers:!(128&~r),preserveTrueCurves:!(256&~r)}}}let U=class extends(a.JSONSupportMixin(s.IdentifiableMixin(c.Loadable))){constructor(e){super(e),this.url=null,this.sourceJSON=null,this.userHasFullEditingPrivileges=!1,this.userHasUpdateItemPrivileges=!1,this.userTypeExtensions=[],this.layerInfos=null,this.tableInfos=null,this.capabilities=null}read(e,t){this.sourceJSON=e,super.read(e,t)}get utilityNetworkUrl(){if(this.sourceJSON)for(const e of this.sourceJSON.layers)if("Utility Network Layer"===e.type)return`${this.url}/${e.id}`;return null}get versionManagementServiceUrl(){return this.sourceJSON?.hasBranchVersionedData&&!C.isSecureProxyService(this.url)?this.url.replace(/\/FeatureServer/i,"/VersionManagementServer"):null}readLayerInfos(e,t){return(t.layers||[]).map(e=>{const{type:t,geometryType:r}=e;return{...L(this.url,e),type:t||"Feature Layer",geometryType:r}})}readTableInfos(e,t){return(t.tables||[]).map(e=>L(this.url,e))}readCapabilities(e,t){return function(e){return{data:E(e),sync:P(e),operations:A(e.capabilities,e),query:V(e),editing:O(e)}}(t)}get effectiveCapabilities(){const e=this.capabilities;if(!e)return null;const t=l.clone(e),{operations:r}=t;return this.userHasUpdateItemPrivileges?(r.supportsAdd=r.supportsDelete=r.supportsEditing=r.supportsQuery=r.supportsUpdate=!0,t):(this.userHasFullEditingPrivileges&&r.supportsEditing&&(r.supportsAdd=r.supportsDelete=r.supportsUpdate=!0),t)}get loaded(){return super.loaded}load(e){return this.addResolvingPromise(this._fetchService(this.url,e).then(()=>this._setUserPrivileges(e))),Promise.resolve(this)}async fetchAllLayersAndTables(e){return await this.load(e),this._fetchLayersAndTablesPromise||=this._fetchLayersAndTables(this.url),p.throwIfAborted(e),this._fetchLayersAndTablesPromise}async applyEdits(e,t){let r=null;try{const{results:i,edits:o,editedFeatures:n}=await this._internalApplyEdits(e,t),s=e=>e.filter(e=>!e.error).map(l.clone);let a=0;return i.map(e=>{r=v.emitApplyEditsEvent(this.url,e.id,t?.gdbVersion,!0);const i={edits:o[a],addedFeatures:s(e.addFeatureResults),updatedFeatures:s(e.updateFeatureResults),deletedFeatures:s(e.deleteFeatureResults),addedAttachments:s(e.addAttachmentResults),updatedAttachments:s(e.updateAttachmentResults),deletedAttachments:s(e.deleteAttachmentResults),exceededTransferLimit:!1,historicMoment:e.editMoment?new Date(e.editMoment):null};a+=1,n.length>0&&(i.editedFeatures=n),r.resolve(i),r=null}),i}catch(e){throw r&&r.reject(e),e}}async _setUserPrivileges(e){if(t.userPrivilegesApplied)try{const{features:{fullEdit:t},content:{updateItem:r}}=await this._fetchUserPrivileges(this.sourceJSON.serviceItemId,e);this._set("userHasFullEditingPrivileges",t),this._set("userHasUpdateItemPrivileges",r)}catch(e){p.throwIfAbortError(e)}}async _fetchUserPrivileges(e,t){const i=!0,o=!1,n=!1;if(!e)return{features:{edit:i,fullEdit:o},content:{updateItem:n}};let s,a,l;try{s=await w.getOwningPortalUrl(this.url,t)}catch(e){p.throwIfAbortError(e)}try{const e=null!=t?t.signal:null;a=await(r.id?.getCredential(`${s}/sharing`,{prompt:!1,signal:e}))}catch(e){p.throwIfAbortError(e)}if(!a)return{features:{edit:i,fullEdit:o},content:{updateItem:n}};try{if(l=new x({id:e,portal:{url:s}}),await l.load(t),l.portal.user)return M.getUserPrivileges(l)}catch(e){p.throwIfAbortError(e)}return{features:{edit:i,fullEdit:o},content:{updateItem:n}}}async _internalApplyEdits(e,t){await _.ensureCredentialIfSignedIn(this.url);const r=t?.globalIdUsed??!1,n=f.fromJSON(this.sourceJSON.spatialReference),{edits:s,options:a}=await this._processApplyEditsParams(e,t),l=await Promise.all(s.map(async e=>{const t=e.addFeatures?.map(e=>g.getFeatureJSON({spatialReference:n},e,null))??[],i=(await Promise.all(t)).filter(o.isSome),s=i.length>0?i:null,a=e.updateFeatures?.map(e=>g.getFeatureJSON({spatialReference:n},e,null))??[],l=(await Promise.all(a)).filter(o.isSome),c=l.length>0?l:null,p=g.getFeatureIds(e.identifierFields,e.deleteFeatures,r),d=p.length>0?p:null;k.unapplyEditsZUnitScaling(s,c,n);const u=await g.getAttachmentEditsJSON(e.identifierFields,e);let h=null;u&&(h={adds:u.adds.length>0?u.adds:void 0,updates:u.updates.length>0?u.updates:void 0,deletes:u.deletes.length>0?u.deletes:void 0});const y={};return e.deleteAssociations&&(y.deleteAssociations=e.deleteAssociations),e.combineGroupedObjects&&(y.combineGroupedObjects=e.combineGroupedObjects),e.divideGroupedObjects&&(y.divideGroupedObjects=e.divideGroupedObjects),{id:e.id,adds:s,updates:c,deletes:d,attachments:h,...y}})),c={gdbVersion:a?.gdbVersion,rollbackOnFailure:!0,useGlobalIds:r,returnEditMoment:!0,honorSequenceOfEdits:a?.honorSequenceOfEdits,usePreviousEditMoment:a?.usePreviousEditMoment,returnServiceEditsInSourceSR:!1,returnServiceEditsOption:"originalAndCurrentFeatures",async:!1};await T.isSafeToEditVersion(this.url,t?.gdbVersion,!0);const p=T.isVersionInEditSession(this.url,t?.gdbVersion||null);c.edits=JSON.stringify(l);const d=F.parseUrl(this.url),u=F.asValidOptions(d.query,{query:F.encode({...c,f:"json"}),method:"post"});let h;p&&(u.authMode="immediate",u.query.sessionId=T.currentSessionId);try{h=await i(this.url+"/applyEdits",u)}catch(e){if(!g.isProtectedOrPrivateVersionError(e))throw e;u.authMode="immediate",h=await i(this.url+"/applyEdits",u)}return{...R(h),edits:s}}async _processApplyEditsParams(e,t){const r={...t,usingFeatureServiceEndpoint:!0,usingTelecomOperations:e.some(e=>e.deleteAssociations||e.combineGroupedObjects||e.divideGroupedObjects)};return{edits:await Promise.all(e.map(async e=>{const t=this.effectiveCapabilities,i=e&&(e.addFeatures||e.updateFeatures||e.deleteFeatures),o=e&&(e.addAttachments||e.updateAttachments||e.deleteAttachments);if(b.checkEditingCapabilities(e,t,r,!!i,!!o,"feature-service"),!t.data.isDataVersioned&&r?.gdbVersion)throw new n("feature-service:invalid-parameter","'gdbVersion' is applicable only if the layer supports versioned data. See: 'capabilities.data.isDataVersioned'");const s=b.normalizeEdits(e,t,"feature-service"),a={};e.deleteAssociations&&(a.deleteAssociations=e.deleteAssociations),e.combineGroupedObjects&&(a.combineGroupedObjects=e.combineGroupedObjects),e.divideGroupedObjects&&(a.divideGroupedObjects=e.divideGroupedObjects);const l=await b.normalizeGeometries(s);return{id:e.id,...l,...a,identifierFields:e.identifierFields}})),options:r}}async _fetchService(e,t){if(this.sourceJSON)return void this.read(this.sourceJSON,{url:F.parseUrl(e)});const r=await i(e,{responseType:"json",query:{f:"json"},...t});this.read(r.data,{url:F.parseUrl(e)})}async _fetchLayersAndTables(e){const t=`${e}/layers`,r=await i(t,{responseType:"json",query:{f:"json"}});return{layers:r.data.layers.map(e=>{const{type:t,geometryType:r}=e,i=L(this.url,e),o=S.getFeatureLayerCapabilities(e,i.url);return{...i,type:t||"Feature Layer",geometryType:r,capabilities:o}}),tables:r.data.tables.map(e=>{const t=L(this.url,e),r=S.getFeatureLayerCapabilities(e,t.url);return{...t,capabilities:r}})}}};function R(e){const t=e.data,r=[];return{results:t.map(e=>{const t={addResults:e.addResults??[],updateResults:e.updateResults??[],deleteResults:e.deleteResults??[],attachments:e.attachments,editMoment:e.editMoment},i=g.unpackEditResultData(t),o=e.editedFeatures,n=o?.spatialReference?new f({wkid:o?.spatialReference.wkid,wkt:o?.spatialReference.wkt,latestWkid:o?.spatialReference.latestWkid,latestVcsWkid:o?.spatialReference.latestVcsWkid,vcsWkid:o?.spatialReference.vcsWkid}):null,s=o?g.createEditedFeatures(o,n):null;s&&r.push({layerId:e.id,editedFeatures:s});const a={};return e.divideGroupedObjectResults&&(a.divideGroupedObjectResults=e.divideGroupedObjectResults),e.combineGroupedObjectResults&&(a.combineGroupedObjectResults=e.combineGroupedObjectResults),{id:e.id,editedFeatures:s,...i,...a}}),editedFeatures:r}}return e.__decorate([d.property()],U.prototype,"url",void 0),e.__decorate([d.property()],U.prototype,"sourceJSON",void 0),e.__decorate([d.property()],U.prototype,"userHasFullEditingPrivileges",void 0),e.__decorate([d.property()],U.prototype,"userHasUpdateItemPrivileges",void 0),e.__decorate([d.property({readOnly:!0})],U.prototype,"utilityNetworkUrl",null),e.__decorate([d.property({readOnly:!0})],U.prototype,"versionManagementServiceUrl",null),e.__decorate([d.property()],U.prototype,"userTypeExtensions",void 0),e.__decorate([d.property({json:{read:{source:["layers"]}}})],U.prototype,"layerInfos",void 0),e.__decorate([y.reader("layerInfos",["layers"])],U.prototype,"readLayerInfos",null),e.__decorate([d.property({json:{read:{source:["tables"]}}})],U.prototype,"tableInfos",void 0),e.__decorate([y.reader("tableInfos",["tables"])],U.prototype,"readTableInfos",null),e.__decorate([d.property({readOnly:!0,json:{read:{source:["hasVersionedData","hasSharedTemplates","hasBranchVersionedData","capabilities","supportsQueryDataElements","supportsQueryDomains","supportsQueryContingentValues","maxRecordCountFactor","maxRecordCount","advancedEditingCapabilities","supportsApplyEditsWithGlobalIds","syncCapabilities","datesInUnknownTimezone"]}}})],U.prototype,"capabilities",void 0),e.__decorate([y.reader("capabilities",["hasVersionedData","hasSharedTemplates","hasBranchVersionedData","capabilities","supportsQueryDataElements","supportsQueryDomains","supportsQueryContingentValues","maxRecordCountFactor","maxRecordCount","advancedEditingCapabilities","supportsApplyEditsWithGlobalIds","syncCapabilities","datesInUnknownTimezone"])],U.prototype,"readCapabilities",null),e.__decorate([d.property({readOnly:!0})],U.prototype,"effectiveCapabilities",null),U=e.__decorate([m.subclass("esri.rest.featureService.FeatureService")],U),U})},"esri/undoredo/support/ServiceVersionInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/Collection","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a,l){"use strict";e.ServiceVersionInfo=class extends r{constructor(e){super(e),this.layers=new i,this.lockType="none",this.tables=new i,this.versionInfo=null,this.versionService=null}get layersAndTables(){return new i([...this.layers.toArray(),...this.tables.toArray()])}updateLockType(){this.lockType=this.versionInfo?this.versionService.getLockType(this.versionInfo.versionIdentifier)??"none":"none"}get featureServiceVersion(){return this.featureService.sourceJSON?.currentVersion??0}},t.__decorate([o.property({constructOnly:!0})],e.ServiceVersionInfo.prototype,"canCreateVersion",void 0),t.__decorate([o.property({constructOnly:!0})],e.ServiceVersionInfo.prototype,"canEditVersionedData",void 0),t.__decorate([o.property({constructOnly:!0})],e.ServiceVersionInfo.prototype,"featureService",void 0),t.__decorate([o.property({constructOnly:!0})],e.ServiceVersionInfo.prototype,"layers",void 0),t.__decorate([o.property()],e.ServiceVersionInfo.prototype,"layersAndTables",null),t.__decorate([o.property()],e.ServiceVersionInfo.prototype,"lockType",void 0),t.__decorate([o.property({constructOnly:!0})],e.ServiceVersionInfo.prototype,"tables",void 0),t.__decorate([o.property()],e.ServiceVersionInfo.prototype,"versionInfo",void 0),t.__decorate([o.property({constructOnly:!0})],e.ServiceVersionInfo.prototype,"versionService",void 0),t.__decorate([o.property()],e.ServiceVersionInfo.prototype,"hasAdvancedEditingUserTypeExtension",void 0),t.__decorate([o.property()],e.ServiceVersionInfo.prototype,"loggedInServiceUser",void 0),t.__decorate([o.property()],e.ServiceVersionInfo.prototype,"featureServiceVersion",null),e.ServiceVersionInfo=t.__decorate([l.subclass("esri.undoredo.support.ServiceVersionInfo")],e.ServiceVersionInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/FeatureTemplates/TemplateItem":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a){"use strict";var l;let c=l=class extends t{constructor(e){super(e),this._activeFetchInfo={id:null,request:null},this.disabledFunction=null,this.layer=null,this.template=null,this.thumbnail=null}initialize(){this.addHandles(r.watch(()=>{const{layer:e}=this;return[e&&"renderer"in e?e.renderer:null,this.template]},()=>{this._activeFetchInfo.id=null,this._activeFetchInfo.request=null,this._set("thumbnail",null)},r.initial))}get description(){return this.template?.description}set description(e){this.template&&(this.template.description=e)}get disabled(){return this.disabledFunction?.(this)??!1}get label(){return this.template?.name}set label(e){this.template&&(this.template.name=e)}get id(){return`${this.label??""}–${this.layer?.id}`}get supportsUpload(){return"scene"===this.layer?.type}clone(){const e=null!=this.thumbnail?this.thumbnail.cloneNode(!0):null,t=new l({layer:this.layer,template:this.template});return t._set("thumbnail",e),t}};return e.__decorate([i.property()],c.prototype,"description",null),e.__decorate([i.property()],c.prototype,"disabled",null),e.__decorate([i.property()],c.prototype,"disabledFunction",void 0),e.__decorate([i.property()],c.prototype,"label",null),e.__decorate([i.property()],c.prototype,"layer",void 0),e.__decorate([i.property()],c.prototype,"template",void 0),e.__decorate([i.property()],c.prototype,"thumbnail",void 0),e.__decorate([i.property()],c.prototype,"id",null),e.__decorate([i.property()],c.prototype,"supportsUpload",null),c=l=e.__decorate([a.subclass("esri.widgets.FeatureTemplates.TemplateItem")],c),c})},"esri/widgets/FeatureTemplates/TemplateItemGroup":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/Identifiable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends(r.IdentifiableMixin(t)){constructor(e){super(e),this.allItems=[],this.filterFunction=null,this.label=null}get items(){const{filterFunction:e}=this;return null==e||e(this)?this.allItems:this.allItems.filter(e)}get id(){return this.label}reapplyFilter(){this.notifyChange("filterFunction")}findByTemplate(e){return this.items.find(t=>t.template===e)}};return e.__decorate([i.property()],l.prototype,"allItems",void 0),e.__decorate([i.property()],l.prototype,"filterFunction",void 0),e.__decorate([i.property()],l.prototype,"items",null),e.__decorate([i.property()],l.prototype,"label",void 0),e.__decorate([i.property()],l.prototype,"id",null),l=e.__decorate([a.subclass("esri.widgets.FeatureTemplates.TemplateItemGroup")],l),l})},"esri/widgets/FeatureTemplates/VisibleElements":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.filter=!0}};return e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"filter",void 0),a=e.__decorate([s.subclass("esri.widgets.FeatureTemplates.VisibleElements")],a),a})},"esri/widgets/support/ItemList":function(){define(["exports","./Heading","./widgetUtils","./jsxFactory"],function(e,t,r,i){"use strict";const o="esri-item-list",n=`${o}__list-item`,s={filterContainerSticky:`${o}__filter-container--sticky`,group:`${o}__group`,groupHeader:`${o}__group__header`,item:n,itemDisabled:`${n}--disabled`,itemIcon:`${n}-icon`,itemContentEnd:`${n}-content-end`,noMatchesMessage:`${o}__no-matches-message`,scroller:`${o}__scroller`,scrollerEnabled:`${o}__scroller--enabled`},a=4;function l(e){const{disabled:t,identify:o,item:n,onItemMouseEnter:a,onItemMouseLeave:l,onItemSelect:d,renderIcon:u,renderCustomItem:h,renderItemContent:y,renderItemContentEnd:m,renderItemLabel:f,renderItemDescription:g,renderItemActionEnd:b,renderItemTitle:v,selectedItem:_}=e,w=c(n,o),S=w===c(_,o),x=h?.(e);if(x)return x;const M=y?.(n),C=m?.(n),F=b?.(n),k=!(!n.disabled&&!t),I=u?.(n);return i.tsx("calcite-list-item",{afterUpdate:e=>{e.selected=S},class:r.classes({[s.item]:!0,[s.itemDisabled]:k}),"data-item":n,description:M?void 0:g?.(n)??void 0,disabled:k,key:w,label:M?void 0:f?.(n)??n.label??void 0,onblur:e=>l?.(p(e)),onfocus:e=>a?.(p(e)),onmouseenter:e=>a?.(p(e)),onmouseleave:e=>l?.(p(e)),selected:S,title:v?.(n)??void 0,onCalciteListItemSelect:e=>{e.preventDefault(),d?.(p(e))}},I?i.tsx("div",{class:s.itemIcon,key:"content-start",slot:"content-start"},I):void 0,M?i.tsx("div",{key:"content",slot:"content"},M):null,C?i.tsx("div",{class:s.itemContentEnd,key:"content-end",slot:"content-end"},C):null,F??null)}function c(e,t){return e?`${t?.(e)||e.id}__${e.label}`:""}function p(e){return e.currentTarget["data-item"]}function d(e){const{disabled:r,group:o,headingLevel:n=a,selectionMode:c="none",renderCustomGroupContent:p,...d}=e,u=p?.(e);return i.tsx("div",{class:s.group,key:o.label??void 0},i.tsx(t.Heading,{class:s.groupHeader,level:n},o.label),u||i.tsx("calcite-list",{disabled:r,label:o.label??"",selectionAppearance:"border",selectionMode:c},o.items.map(e=>l({...d,disabled:r,item:e,grouped:!0}))))}e.ItemList=function(e){const{disabled:t,filterText:o="",id:n,messages:a,onFilterChange:c,...p}=e;return i.tsx("div",{key:n},e.filterEnabled??1?function(e){const{disabled:t,messages:r,filterText:o,enableListScroll:n}=e;return i.tsx("div",{class:n?void 0:s.filterContainerSticky,key:"filter"},i.tsx("calcite-input",{disabled:t,placeholder:r.filterPlaceholder,type:"search",value:o,onCalciteInputInput:t=>{const r=t.currentTarget;e.onFilterChange&&e.onFilterChange(r.value)}}))}({disabled:t,filterText:o,id:n,messages:a,onFilterChange:c}):null,function(e){const{headingLevel:t,items:o,...n}=e;return 0===o.length?i.tsx("div",{class:s.noMatchesMessage,key:"no-matches"},e.messages.noMatches):i.tsx("div",{class:r.classes({[s.scroller]:!0,[s.scrollerEnabled]:!!e.enableListScroll}),key:"item-container"},o.map(e=>e.items?d({...n,group:e,headingLevel:t}):l({...n,grouped:!0,item:e})))}({...p,disabled:t,enableListScroll:e.enableListScroll??!0,filterText:o,messages:a}))},e.renderGroup=d,e.renderItem=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/symbolPreviewUtils":function(){define(["require","exports","../../Graphic","../../core/screenUtils","../../editing/templateUtils","../../support/guards","../../symbols/support/symbolUtils"],function(e,t,r,i,o,n,s){"use strict";const a=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));async function l(t){if(!("geometryType"in t))return null;const{geometryType:r}=t,i="point"===r||"multipoint"===r?await new Promise((t,r)=>e(["../../symbols/SimpleMarkerSymbol"],e=>t(a(e)),r)):"polyline"===r?await new Promise((t,r)=>e(["../../symbols/SimpleLineSymbol"],e=>t(a(e)),r)):"polygon"===r||"mesh"===r||"multipatch"===r?await new Promise((t,r)=>e(["../../symbols/SimpleFillSymbol"],e=>t(a(e)),r)):null;return i?new i.default:null}t.fetchThumbnail=async function(e,t,a){if(!n.isGraphic(e)&&o.isSharedTemplateMetadata(e)&&e.thumbnail){const r=`data:image/png;base64,${e.thumbnail.imageData}`,i=document.createElement("div");return i.classList.add("esri-thumbnail-preview"),"geometryType"in t&&t.geometryType&&i.classList.add(`esri-thumbnail-preview--${t.geometryType}`),i.style.backgroundImage=`url(${r})`,i}const c=await async function(e,t){if(!n.isGraphic(t)&&o.isSharedTemplateMetadata(t))return l(e);if("renderer"in e&&e.renderer){const{renderer:i}=e,o=n.isGraphic(t)?t:new r({attributes:t.prototype.attributes});if("getSymbolAsync"in i){const e=await i.getSymbolAsync(o);if(e)return e}}return l(e)}(t,e);if(null==c)return null;const p={maxSize:i.px2pt(a?.maxSize??32),ariaLabel:a?.ariaLabel};if((n.isGraphic(e)||o.isStandardFeatureTemplate(e))&&"renderer"in t&&"dictionary"===t.renderer?.type&&(p.fieldMap=t.renderer.fieldMap??void 0,p.feature=n.isGraphic(e)?e:{attributes:e.prototype.attributes??{}}),n.isGraphic(e)&&e.geometry&&!1!==a?.useGeometry&&!e.geometry.type.includes("point")){p.geometry=e.geometry,p.useMarkerSymbolSize=!1;const t=i.px2pt(a?.maxSize??22);p.size={width:t,height:t}}return await s.renderPreviewHTML(c,p)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/has","../../core/screenUtils","../../layers/support/layerUtils","../../support/loadArcade","./gfxUtils","./renderUtils","./typeUtils","./utils","../../widgets/Legend/styles/support/relationshipUtils","../../widgets/Legend/support/relationshipRampUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d){"use strict";let u=null;const h=[255,255,255];function y(e,t){return Math.floor(Math.random()*(t-e+1)+e)}async function m(t,r){switch(t.type){case"web-style":{const{previewWebStyleSymbol:i}=await new Promise((t,r)=>e(["./previewWebStyleSymbol"],t,r));return i(t,m,r)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:i}=await new Promise((t,r)=>e(["./previewSymbol3D"],t,r));return i(t,r)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:i}=await new Promise((t,r)=>e(["./previewSymbol2D"],t,r));return i(t,r)}case"cim":{const{previewCIMSymbol:i}=await new Promise((t,r)=>e(["./previewCIMSymbol"],t,r));return i(t,r)}default:return}}function f(e){return e&&"opacity"in e?e.opacity*f(e.parent):1}async function g(t,r){if(!t)return;const i=t.sourceLayer,o=(null!=r&&r.useSourceLayer?i:t.layer)??i,s=r?.ignoreOpacity?1:f(o);if(null!=t.symbol&&(null==r||!0!==r.ignoreGraphicSymbol)){const e="web-style"===t.symbol.type?await t.symbol.fetchSymbol({...r,acceptedFormats:r?.webStyleAcceptedFormats,cache:r?.webStyleCache}):t.symbol.clone();return c.applyColorToSymbol(e,null,{add:s}),e}const a=r?.renderer??v(o);let l=a&&"getSymbolAsync"in a?await a.getSymbolAsync(t,r):null;if(!l)return;if(l="web-style"===l.type?await l.fetchSymbol({...r,acceptedFormats:r?.webStyleAcceptedFormats,cache:r?.webStyleCache}):l.clone(),!(a&&"visualVariables"in a&&a.visualVariables?.length&&b(l)))return c.applyColorToSymbol(l,null,{add:s}),l;if("arcadeRequiredForVisualVariables"in a&&a.arcadeRequiredForVisualVariables&&null==r?.arcade){const e={...r};e.arcade=await n.loadArcade(),r=e}const{getColor:p,getOpacity:d,getAllSizes:u,getRotationAngle:h}=await new Promise((t,r)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],t,r)),y=[],m=[],g=[],_=[];for(const e of a.visualVariables)switch(e.type){case"color":y.push(e);break;case"opacity":m.push(e);break;case"rotation":_.push(e);break;case"size":e.target||g.push(e)}const w=!!y.length&&y[y.length-1],S=w?p(w,t,r):null,x=!!r?.ignoreOpacity,M=!!m.length&&m[m.length-1],C=M?d(M,t,r):null;if(c.applyColorToSymbol(l,S,x?void 0:{override:C,add:s}),g.length&&!0!==r?.ignoreSizeVariables){const e=u(g,t,r);await c.applySizesToSymbol(l,e)}if(!0!==r?.ignoreRotationVariables)for(const e of _)c.applyRotationToSymbol(l,h(e,t,r),e.axis);return l}function b(e){return!l.isSymbol3D(e)||"water"!==e.symbolLayers.at(0)?.type}function v(e){if(e)return"renderer"in e?e.renderer:void 0}t.getDisplayedColor=async function(t,r){if(!t)return;const{layer:i,sourceLayer:o}=t,s=f(i??o);if(null!=t.symbol&&(null==r||!0!==r.ignoreGraphicSymbol)){const e="web-style"===t.symbol.type?await t.symbol.fetchSymbol({...r,acceptedFormats:r?.webStyleAcceptedFormats}):t.symbol.clone();return c.getColorFromSymbol(e,s)}const a=r?.renderer??v(i)??v(o);let l=a&&"getSymbolAsync"in a?await a.getSymbolAsync(t,r):void 0;if(!l)return;l="web-style"===l.type?await l.fetchSymbol({...r,acceptedFormats:r?.webStyleAcceptedFormats}):l.clone();const p=c.getColorFromSymbol(l,void 0);if(!a||!("visualVariables"in a)||"visualVariables"in a&&!a.visualVariables||"visualVariables"in a&&!a.visualVariables?.length||!b(l))return p?c.applyOpacityToColor(p,s):void 0;if("arcadeRequiredForVisualVariables"in a&&a.arcadeRequiredForVisualVariables&&null==r?.arcade){const e={...r};e.arcade=await n.loadArcade(),r=e}const{getColor:d,getOpacity:u}=await new Promise((t,r)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],t,r)),h=[],y=[];if(a.visualVariables)for(const e of a.visualVariables)switch(e.type){case"color":h.push(e);break;case"opacity":y.push(e)}const m=h.length>0?h[h.length-1]:null,g=(m?d(m,t,r):void 0)??p,_=y.length>0?y[y.length-1]:null,w=_?u(_,t,r):null;return null!=g&&null!=w&&(g.a=w),g?c.applyOpacityToColor(g,s):null},t.getDisplayedSymbol=g,t.getLegendLabel=async function(t,r,i){if(!t)return;const{layer:o,sourceLayer:n}=t,s=i?.renderer??v(o)??v(n);if(!s)return null;if("visualVariables"in s&&s.visualVariables?.length){const{getRampStops:n}=await new Promise((t,r)=>e(["../../widgets/Legend/support/colorRampUtils"],t,r)),{getRampStops:a}=await new Promise((t,r)=>e(["../../widgets/Legend/support/sizeRampUtils"],t,r)),{getDateFormatOptions:l}=await new Promise((t,r)=>e(["../../widgets/Legend/support/utils"],t,r));let c=null;for(const e of s.visualVariables){const p=r?l(o,e,r.timeZone):null;let d=null;switch(e.type){case"color":d=await n(e,null,p);break;case"opacity":d=await n(e);break;case"size":e.target||(d=await a(s,e,null,i?.scale||r?.scale,r,p))}if(d?.length){const r=d.find((r,i)=>{const o=t.attributes[e.field];return 0===i?o>=r.value:i===d?.length-1?o<=r.value:r.value===o});if(r){c=r.label;break}}}if(c)return c}switch(s.type){case"class-breaks":{const e="getClassBreakInfo"in s?await s.getClassBreakInfo(t,i):null;return e?.label??(e&&s.classBreakInfos?.length>1)?`${e.minValue} - ${e.maxValue}`:null}case"unique-value":{const e="getUniqueValueInfo"in s?await s.getUniqueValueInfo(t,i):null;return e?.label}}return null},t.previewGraphic=async function(e,t){e?.layer&&o.isSubtypeGroupLayer(e.layer)&&((e=e.cloneShallow()).layer=e.layer.findSublayerForFeature(e)??null);const r=null===e?t?.fallbackSymbol??null:await g(e,{ignoreGraphicSymbol:!!e.layer,ignoreOpacity:t?.ignoreOpacity??!0,ignoreRotationVariables:t?.ignoreRotationVariables??!0,ignoreSizeVariables:t?.ignoreSizeVariables??!0})??t?.fallbackSymbol??null;if(!r)return null;const n=await m(r,{geometry:t.useGeometryForShape?e?.geometry??null:null,useMarkerSymbolSize:!1!==t.useMarkerSymbolSize,size:{width:i.px2pt(t.widthInPixels??16),height:i.px2pt(t.heightInPixels??16)},..."cim"===r?.type?{cimOptions:{feature:{attributes:e?.attributes??{}}}}:{}});return n?"element"===(t?.format??"element")?n:n.outerHTML:null},t.renderColorRampPreviewHTML=function(e,t={}){const r="horizontal"===t.align,i=r?75:24,o=r?24:75,n=t.width??i,s=t.height??o,a=t.gradient??!0,l=window.devicePixelRatio,p=n*l,d=s*l,u=document.createElement("canvas");u.width=p,u.height=d,u.ariaLabel=t.ariaLabel??null,u.style.width=`${n}px`,u.style.height=`${s}px`;const h=u.getContext("2d"),y=r?p:0,m=r?0:d;if(a){const t=h.createLinearGradient(0,0,y,m),r=e.length,i=1===r?0:1/(r-1);e.forEach((e,r)=>t.addColorStop(r*i,e.toString())),h.fillStyle=t,h.fillRect(0,0,p,d)}else{const t=r?p/e.length:p,i=r?d:d/e.length;let o=0,n=0;for(const s of e)h.fillStyle=s.toString(),h.fillRect(o,n,t,i),o=r?o+t:0,n=r?0:n+i}const f=document.createElement("div");return f.style.width=`${n}px`,f.style.height=`${s}px`,function(e,t){if(!t)return;e.style.filter=c.getCSSFilterFromEffectList(t);const r=t.effects;if(r)for(const t of r)if("drop-shadow"===t?.type){t.offsetX<0?e.style.marginLeft=`${Math.abs(t.offsetX)}px`:e.style.marginRight=`${t.offsetX}px`;break}}(f,t?.effectList),f.appendChild(u),f},t.renderDotDensityPreviewHTML=function(e,t,r){const{backgroundColor:i,outline:o,dotSize:n}=e,s=r?.swatchSize||22,a=Math.round(s*s/Math.max(n,.5)**2*.8),l=window.devicePixelRatio,c=document.createElement("canvas"),p=s*l;c.width=p,c.height=p,c.style.width=c.width/l+"px",c.style.height=c.height/l+"px";const d=c.getContext("2d");if(i&&(d.fillStyle=i.toCss(!0),d.fillRect(0,0,p,p),d.fill()),d.fillStyle=t?.toCss(!0)??"",u&&u.length/2===a)for(let e=0;e<2*a;e+=2){const t=u[e],r=u[e+1];d.fillRect(t,r,n*l,n*l),d.fill()}else{u=[];for(let e=0;e<2*a;e+=2){const e=y(0,p),t=y(0,p);u.push(e,t),d.fillRect(e,t,n*l,n*l),d.fill()}}o&&(o.color&&(d.strokeStyle=o.color.toCss(!0)),d.lineWidth=o.width,d.strokeRect(0,0,p,p));const h=new Image(s,s);return h.src=c.toDataURL(),h.ariaLabel=r?.ariaLabel??null,h.alt=r?.ariaLabel??"",h},t.renderPieChartPreviewHTML=function(e,t={}){const r=t.radius||40,i=2*Math.PI*r,o=e.length,n=i/o,l=[],c=s.getStroke(t.outline);null!=c?.width&&(c.width*=2),(c||t.backgroundColor)&&l.push({shape:{type:"circle",cx:r,cy:r,r},fill:t.backgroundColor,stroke:c,offset:[0,0]});const p=t.values,d=p&&p.length===o&&100===p.reduce((e,t)=>e+t,0),u=[0];for(let t=0;t<o;t++){let o=null;d&&(o=p[t]*i/100,u.push(o+u[t])),l.push({shape:{type:"circle",cx:r,cy:r,r:r/2},fill:[0,0,0,0],stroke:{width:r,dashArray:`${(o??n)/2} ${i}`,dashoffset:"-"+(d?u[t]/2:t*(n/2)),color:e[t]},offset:[0,0]})}let y=null;const m=2*r+(c?.width||0),f=t.holePercentage;if(f){c&&l.push({shape:{type:"circle",cx:r,cy:r,r:r*f},fill:null,stroke:c,offset:[0,0]});const e=m/2;y=[[{shape:{type:"circle",cx:e,cy:e,r:e},fill:h,stroke:c?{...c,color:h}:null,offset:[0,0]},{shape:{type:"circle",cx:e,cy:e,r:r*f},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return a.renderSymbol([l],[m,m],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:y,rotations:[-90],ariaLabel:t.ariaLabel})},t.renderPreviewHTML=m,t.renderRelationshipRampPreviewHTML=function(e,t={}){const r=e?.authoringInfo;if("relationship"!==r?.type||!r?.numClasses||!e.uniqueValueInfos)return null;const{focus:i,numClasses:o}=r,n=d.getRelationshipRampElement({focus:i,numClasses:o,infos:e.uniqueValueInfos}),s=t?.node||document.createElement("div");return a.renderOnce(s,()=>p.renderRelationshipRamp(n,t.id||"relationship",{opacity:t.opacity||1,effectList:t.effectList,ariaLabel:t.ariaLabel})),s},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define(["exports","../../assets","../../Color","../../request","../../core/LRUCache","../../core/screenUtils","./cimSymbolUtils"],function(e,t,r,i,o,n,s){"use strict";const a="picture-fill",l="simple-fill",c="simple-marker",p=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),d=new o.LRUCache(1e3);function u(e){if(!e?.style)return[];const{dashArray:t,style:r,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map(e=>Number(e));const o=i??0,n=p.has(r)?p.get(r).map(e=>e*o):[];if("butt"!==e.cap)for(const[e,t]of n.entries())n[e]=e%2==1?t+o:Math.max(t-o,1);return n}const h=(()=>{const e={};return t=>{if(e[t])return e[t];const r=t.replaceAll("-","");return e[t]=r,r}})(),y=new r([128,128,128]);e.defaultThematicColor=y,e.dekebabifyLineStyle=h,e.getDashArray=u,e.getFill=function(e){const r=e.style;let i=null;if(e)switch(e.type){case c:"cross"!==r&&"x"!==r&&(i=e.color);break;case l:r&&"solid"!==r?"none"!==r&&(i={type:"pattern",x:0,y:0,src:t.getAssetUrl(`esri/symbols/patterns/${r}.png`),width:5,height:5}):i=e.color;break;case a:i={type:"pattern",src:e.url,width:n.pt2px(e.width)*e.xscale,height:n.pt2px(e.height)*e.yscale,x:n.pt2px(e.xoffset),y:n.pt2px(e.yoffset)};break;case"text":i=e.color;break;case"cim":i=s.getCIMSymbolColor(e)}return i},e.getPatternUrlWithColor=function(e,t){const r=e+"-"+t,o=d.get(r);return null!=o?Promise.resolve(o):i(e,{responseType:"image"}).then(e=>{const i=e.data,o=i.naturalWidth,n=i.naturalHeight,s=document.createElement("canvas");s.width=o,s.height=n;const a=s.getContext("2d");a.fillStyle=t,a.fillRect(0,0,o,n),a.globalCompositeOperation="destination-in",a.drawImage(i,0,0);const l=s.toDataURL();return d.put(r,l),l})},e.getStroke=function e(t){if(!t)return null;let r=null;switch(t.type){case l:case a:case c:r=e(t.outline);break;case"simple-line":{const e=n.pt2px(t.width);null!=t.style&&"none"!==t.style&&0!==e&&(r={color:t.color,style:h(t.style),width:e,cap:t.cap,join:"miter"===t.join?n.pt2px(t.miterLimit):t.join},r.dashArray=u(r).join(",")||"none");break}default:r=null}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(e,t,r){"use strict";function i(e){const t=r.toCIMSymbolJSON(e);if("CIMTextSymbol"===t?.type)return t.height??0;let i=0;if(t?.symbolLayers)for(const e of t.symbolLayers)r.isCIMMarker(e)&&null!=e.size&&e.size>i?i=e.size:r.isCIMStroke(e)&&null!=e.width&&e.width>i?i=e.width:r.isCIMFill(e);return i}function o(e,t,r,i){if(e)if("CIMTextSymbol"!==e.type){if(r&&e.effects)for(const r of e.effects)s(r,t);if(e.symbolLayers)for(const r of e.symbolLayers){switch(r.type){case"CIMPictureMarker":case"CIMVectorMarker":n(r,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!i?.preserveOutlineWidth&&r.width&&(r.width*=t);break;case"CIMPictureFill":r.height&&(r.height*=t),r.offsetX&&(r.offsetX*=t),r.offsetY&&(r.offsetY*=t);break;case"CIMHatchFill":o(r.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),r.offsetX&&(r.offsetX*=t),r.offsetY&&(r.offsetY*=t),r.separation&&(r.separation*=t)}if(r.effects)for(const e of r.effects)s(e,t)}}else null!=e.height&&(e.height*=t)}function n(e,t,i){if(e&&(e.markerPlacement&&function(e,t){switch(r.isCIMMarkerStrokePlacement(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map(e=>e*t);e.placementTemplate=r}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const r=e.placementTemplate.map(e=>e*t);e.placementTemplate=r}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const r of e.markerGraphics)e.scaleSymbolsProportionally||o(r.symbol,t,!0,i)}function s(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const r=e.dashTemplate.map(e=>e*t);e.dashTemplate=r}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function a(e,t){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const o="CIMPolygonSymbol"===e.type;if(i?.symbolLayers)for(const e of i.symbolLayers)if(!(e.colorLocked||o&&(r.isCIMStroke(e)||r.isCIMMarker(e)&&e.markerPlacement&&r.isCIMMarkerStrokePlacement(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&l(t,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach(e=>{a(e.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":l(t,e.color);break;case"CIMGradientFill":c(t,e);break;case"CIMHatchFill":a(e.lineSymbol,t)}}function l(e,t){for(const r of e)if(r.join(".")===t.join("."))return;e.push(t)}function c(e,t){const r=t.colorRamp?.type;switch(r){case"CIMMultipartColorRamp":t.colorRamp.colorRamps?.forEach(t=>{"CIMLinearContinuousColorRamp"===t.type&&p(e,t)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":p(e,t.colorRamp)}}function p(e,t){t&&(t.fromColor&&l(e,t.fromColor),t.toColor&&l(e,t.toColor))}function d(e,t,i){if(!e)return;let o;o="CIMTextSymbol"===e.type?e.symbol:e;const n="CIMPolygonSymbol"===o?.type;if(o?.symbolLayers)for(const e of o.symbolLayers){if(e.colorLocked)continue;if(n)if(i){const{layersToColor:t}=i;if((r.isCIMStroke(e)||r.isCIMMarker(e)&&e.markerPlacement&&r.isCIMMarkerStrokePlacement(e.markerPlacement))&&"fill"===t||r.isCIMFill(e)&&"outline"===t)continue}else if(r.isCIMStroke(e)||r.isCIMMarker(e)&&e.markerPlacement&&r.isCIMMarkerStrokePlacement(e.markerPlacement))continue;const o=t.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=o;break;case"CIMVectorMarker":e.markerGraphics?.forEach(e=>{d(e.symbol,t,i)});break;case"CIMSolidStroke":case"CIMSolidFill":e.color=o;break;case"CIMGradientFill":u(e,t);break;case"CIMHatchFill":d(e.lineSymbol,t,i)}}}function u(e,t){const r=e.colorRamp?.type;switch(r){case"CIMMultipartColorRamp":e.colorRamp.colorRamps?.forEach(e=>{"CIMLinearContinuousColorRamp"===e.type&&h(e,t)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":h(e.colorRamp,t)}}function h(e,t){if(e&&(e.fromColor&&(e.fromColor=t.toArray()),e.toColor)){const r=t.clone();r.a=0,e.toColor=r.toArray()}}e.applyCIMSymbolColor=function(e,i,o){i instanceof t||(i=new t(i));const n=r.toCIMSymbolJSON(e);n&&d(n,i,o)},e.applyCIMSymbolRotation=function(e,t,i=!1){const o=r.toCIMSymbolJSON(e);if(i&&(t=360-t),"CIMTextSymbol"!==o?.type){if("CIMPointSymbol"===o?.type&&o.symbolLayers){const e=t-(o.angle||0);for(const t of o.symbolLayers)if(r.isCIMMarker(t)){let r=t.rotation||0;t.rotateClockwise?r-=e:r+=e,t.rotation=r}o.angle=t}}else o.angle=t},e.getCIMSymbolColor=function(e){const i=[];return a(r.toCIMSymbolJSON(e),i),i.length?new t(r.normalizeAlpha(i[0])):null},e.getCIMSymbolRotation=function(e,t=!1){const i=r.toCIMSymbolJSON(e);if("CIMTextSymbol"===i?.type||"CIMPointSymbol"===i?.type){const e=i.angle;return null!=e&&t?360-e:e??0}return 0},e.getCIMSymbolSize=i,e.getCIMSymbolType=function(e){const t=r.toCIMSymbolJSON(e);if(!t)return null;switch(t.type){case"CIMPointSymbol":return"CIMPointSymbol";case"CIMLineSymbol":return"CIMLineSymbol";case"CIMPolygonSymbol":return"CIMPolygonSymbol";case"CIMTextSymbol":return"CIMTextSymbol";case"CIMMeshSymbol":return"CIMMeshSymbol";default:return null}},e.scaleCIMMarker=n,e.scaleCIMSymbol=o,e.scaleCIMSymbolTo=function(e,t,n){if(!e)return;const s=r.toCIMSymbolJSON(e),a=i(e);0!==a?o(s,t/a,!1,n):function(e,t){if(e)if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const r of e.symbolLayers)switch(r.type){case"CIMPictureMarker":case"CIMVectorMarker":r.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":r.width=t}}else e.height=t}(s,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/renderUtils":function(){define(["exports","../../kernel","../../request","../../core/colorUtils","../../core/Error","../../core/has","../../libs/maquette/projection","../../libs/maquette/projector","./svgUtils","./utils"],function(e,t,r,i,o,n,s,a,l,c){"use strict";const p=a.createProjector();function d(e,t){p.append(e,t),p.detach(t)}function u(e,t,r,o,n){switch(n){case"multiply":e[t]*=r[0],e[t+1]*=r[1],e[t+2]*=r[2],e[t+3]*=r[3];break;default:{const n=i.toHSV({r:e[t],g:e[t+1],b:e[t+2]});n.h=o.h,n.s=o.s,n.v=n.v/100*o.v;const s=i.toRGB(n);e[t]=s.r,e[t+1]=s.g,e[t+2]=s.b,e[t+3]*=r[3];break}}}e.renderOnce=d,e.renderSymbol=function(e,t,r){const i=Math.ceil(t[0]),o=Math.ceil(t[1]);if(!e.some(e=>!!e.length))return null;const n=r?.node||document.createElement("div");return null!=r.opacity&&(n.style.opacity=r.opacity.toString()),null!=r.effectView&&(n.style.filter=c.getCSSFilterFromEffectList(r.effectView)),d(n,()=>l.renderSVG(e,i,o,r)),n},e.tintImageWithColor=function(e,s,a,l,c){return function(e,t,i){return e?r(e,{responseType:"image"}).then(e=>{const r=e.data,o=r.width,n=r.height,s=o/n;let a=t;if(i){const e=Math.max(o,n);a=Math.min(a,e)}return{image:r,width:s<=1?Math.ceil(a*s):a,height:s<=1?a:Math.ceil(a/s)}}):Promise.reject(new o("renderUtils: imageDataSize","href not provided."))}(e,s,c).then(r=>{const o=r.width??s,c=r.height??s;if(r.image&&function(e,t){return!(!e||"ignore"===t||"multiply"===t&&255===e.r&&255===e.g&&255===e.b&&1===e.a)}(a,l)){let t=r.image.width,s=r.image.height;n("edge")&&/\.svg$/i.test(e)&&(t-=1,s-=1);const p=function(e,t){e=Math.ceil(e),t=Math.ceil(t);const r=document.createElement("canvas");r.width=e,r.height=t,r.style.width=e+"px",r.style.height=t+"px";const i=r.getContext("2d");return i.clearRect(0,0,e,t),i}(o,c);p.drawImage(r.image,0,0,t,s,0,0,o,c);const d=p.getImageData(0,0,o,c),h=[a.r/255,a.g/255,a.b/255,a.a],y=i.toHSV(a);for(let e=0;e<d.data.length;e+=4)u(d.data,e,h,y,l);p.putImageData(d,0,0),e=p.canvas.toDataURL("image/png")}else{const r=t.id?.findCredential(e);if(r?.token){const t=e.includes("?")?"&":"?";e=`${e}${t}token=${r.token}`}}return{url:e,width:o,height:c}}).catch(()=>({url:e,width:s,height:s}))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define(["exports","../Color","./arrayUtils","./lang","./mathUtils","../chunks/vec42","./libs/gl-matrix-2/factories/vec4f64"],function(e,t,r,i,o,n,s){"use strict";function a(e){return"r"in e&&"g"in e&&"b"in e}function l(e){return"h"in e&&"s"in e&&"v"in e}function c(e){return"l"in e&&"a"in e&&"b"in e}function p(e){return"l"in e&&"c"in e&&"h"in e}const d=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],u=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function h(e,t){const r=[];let i,o;if(e[0].length!==t.length)throw new Error("dimensions do not match");const n=e.length,s=e[0].length;let a=0;for(i=0;i<n;i++){for(a=0,o=0;o<s;o++)a+=e[i][o]*t[o];r.push(a)}return r}function y(e){const t=[e.r/255,e.g/255,e.b/255].map(e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4),r=h(d,t);return{x:100*r[0],y:100*r[1],z:100*r[2]}}function m(e){const t=h(u,[e.x/100,e.y/100,e.z/100]).map(e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function f(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function g(e){const t=e.l,r=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(e=>e>6/29?e**3:3*(6/29)**2*(e-4/29));return{x:95.047*r[0],y:100*r[1],z:108.883*r[2]}}function b(e){return a(e)?e:p(e)?function(e){return m(g(function(e){const t=e.l,r=e.c,i=e.h;return{l:t,a:r*Math.cos(i),b:r*Math.sin(i)}}(e)))}(e):c(e)?function(e){return m(g(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?m(e):l(e)?function(e){const t=(e.h+360)%360/60,r=e.s/100,i=e.v/100*255,o=i*r,n=o*(1-Math.abs(t%2-1));let s;switch(Math.floor(t)){case 0:s={r:o,g:n,b:0};break;case 1:s={r:n,g:o,b:0};break;case 2:s={r:0,g:o,b:n};break;case 3:s={r:0,g:n,b:o};break;case 4:s={r:n,g:0,b:o};break;case 5:case 6:s={r:o,g:0,b:n};break;default:s={r:0,g:0,b:0}}return s.r=Math.round(s.r+i-o),s.g=Math.round(s.g+i-o),s.b=Math.round(s.b+i-o),s}(e):e}function v(e){return l(e)?e:function(e){const t=e.r,r=e.g,i=e.b,o=Math.max(t,r,i),n=o-Math.min(t,r,i);let s=o,a=0===n?0:o===t?(r-i)/n%6:o===r?(i-t)/n+2:(t-r)/n+4,l=0===n?0:n/s;return a<0&&(a+=6),a*=60,l*=100,s*=100/255,{h:a,s:l,v:s}}(b(e))}function _(e){return c(e)?e:function(e){return f(y(e))}(b(e))}function w(e){let{r,g:i,b:o,a:n}=e;return n<1&&(r=Math.round(n*r+255*(1-n)),i=Math.round(n*i+255*(1-n)),o=Math.round(n*o+255*(1-n))),new t({r,g:i,b:o})}function S(e,t){const{r,g:i,b:o}=t?.ignoreAlpha?e:w(e);return.2126*r+.7152*i+.0722*o}function x(e){return e[0]??=0,e[1]??=0,e[2]??=0,e}const M=(e,t)=>{const r=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+r))};function C(e,i,o,n={}){const s=e.r,a=e.g,l=e.b,c=i.r,p=i.g,d=i.b,u=Math.round(s+(c-s)*o),h=Math.round(a+(p-a)*o),y=Math.round(l+(d-l)*o);if(!n.offset)return new t([u,h,y]);const m=r.getRandomNumberGenerator(n.seed);return new t([M(u,m),M(h,m),M(y,m)])}e.colorEquals=function(e,t){return e===t||null!=e&&e.equals(t)},e.colorVectorEquals=function(e,t){return e===t||null!=e&&null!=t&&n.equals(e,t)},e.colorVectorToColorAndOpacity=function(e){return s.fromValues(e[0],e[1],e[2],e.length>3?e[3]:1)},e.createUniqueColors=function(e,o,n={}){if(0===e.length||o<=0)return[];if(1===(e=e.map(e=>"string"==typeof e?new t(e):e)).length||1===o){const t=[],r=e[0];for(let e=0;e<o;e++)t.push(r.clone());return t}if(n.shuffle&&(e=r.shuffle(i.clone(e),n.seed)),e.length>=o){const t=[],r=(e.length-1)/(o-1);for(let i=0;i<o;i++){const o=Math.round(i*r);t.push(e[o].clone())}return t}return function(e,t,i={}){const o=[],n=e.length-1,s=Math.ceil((t-e.length)/n);e:for(let r=0;r<n;r++){const n=e[r],a=e[r+1];for(let r=1;r<=s;r++){const l=r/(s+1);if(o.push(C(n,a,l,i)),o.length+e.length===t)break e}}return[...e.map(e=>e.clone()),...r.shuffle(o,i.seed??1)]}(e,o,n)},e.darken=function(e,t){const r=_(e);r.l*=1-t;const i=b(r),o=e.clone();return o.setColor(i),o.a=e.a,o},e.desaturate=function(e,t){const r=v(e);r.s*=t;const i=b(r),o=e.clone();return o.setColor(i),o.a=e.a,o},e.getColorLuminance=S,e.getColorTheme=function(e){return w(e).isBright?"light":"dark"},e.getContrast=function(e,r=225){return S(e,{ignoreAlpha:!0})>r?new t([0,0,0,e.a]):new t([255,255,255,e.a])},e.isRGB=a,e.multiplyOpacity=function(e,t){const r=e.clone();return r.a*=t,r},e.multiplyOpacityToUnitRGBA=function(e,r){const i=t.toUnitRGBA(e);return i[3]*=r,i},e.toHSV=v,e.toLAB=_,e.toLCH=function(e){return p(e)?e:function(e){return function(e){const t=e.l,r=e.a,i=e.b,o=Math.sqrt(r*r+i*i);let n=Math.atan2(i,r);return n=n>0?n:n+2*Math.PI,{l:t,c:o,h:n}}(f(y(e)))}(b(e))},e.toRGB=b,e.unitRGBAFromColor=function(e){return t.toUnitRGBA(e)},e.validateColor=x,e.validateColorAndOpacity=function(e){return e.length=4,x(e),e[3]??=1,o.clamp(e[3],0,1),e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/svgUtils":function(){define(["exports","../../Color","../../core/has","../../core/maybe","../../core/libs/gl-matrix-2/factories/mat2df32","../../core/libs/gl-matrix-2/math/mat2d","./gfxUtils","./svgGlobalState","../../widgets/support/widgetUtils","../../widgets/support/jsxFactory"],function(e,t,r,i,o,n,s,a,l,c){"use strict";const p=r("android"),d=r("chrome")||p&&p>=4?"auto":"optimizeLegibility",u={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},h=/([A-DF-Za-df-z])|([-+]?\d*\.?\d+(?:[eE][-+]?\d+)?)/g;let y={},m={};const f=Math.PI;function g(e,t){const r=e*(f/180);return Math.abs(t*Math.sin(r))+Math.abs(t*Math.cos(r))}function b(e){return e.map(e=>`${e.command} ${e.values.join(" ")}`).join(" ").trim()}function v(e,t,r,o,n){if(e){if("circle"===e.type)return c.tsx("circle",{cx:e.cx,cy:e.cy,fill:t,"fill-rule":"evenodd",r:e.r,stroke:r.color,"stroke-dasharray":r.dashArray,"stroke-dashoffset":r.dashOffset,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-miterlimit":"4","stroke-width":r.width});if("ellipse"===e.type)return c.tsx("ellipse",{cx:e.cx,cy:e.cy,fill:t,"fill-rule":"evenodd",rx:e.rx,ry:e.ry,stroke:r.color,"stroke-dasharray":r.dashArray,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-miterlimit":"4","stroke-width":r.width});if("rect"===e.type)return c.tsx("rect",{fill:t,"fill-rule":"evenodd",height:e.height,stroke:r.color,"stroke-dasharray":r.dashArray,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-miterlimit":"4","stroke-width":r.width,width:e.width,x:e.x,y:e.y});if("image"===e.type)return c.tsx("image",{alt:n||"image",height:e.height,href:e.src,preserveAspectRatio:"none",width:e.width,x:e.x,y:e.y});if("path"===e.type){const i="string"!=typeof e.path?b(e.path):e.path;return c.tsx("path",{d:i,fill:t,"fill-rule":"evenodd",stroke:r.color,"stroke-dasharray":r.dashArray,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-miterlimit":"4","stroke-width":r.width})}if("text"===e.type)return i.assertIsSome(o),c.tsx("text",{"dominant-baseline":o.dominantBaseline,fill:t,"fill-rule":"evenodd","font-family":o.font.family,"font-size":o.font.size,"font-style":o.font.style,"font-variant":o.font.variant,"font-weight":o.font.weight,kerning:o.kerning,rotate:o.rotate,stroke:r.color,"stroke-dasharray":r.dashArray,"stroke-linecap":r.cap,"stroke-linejoin":r.join,"stroke-miterlimit":"4","stroke-width":r.width,"text-anchor":o.align,"text-decoration":o.decoration,"text-rendering":d,x:e.x,y:e.y},e.text)}return null}function _(e){if(!e)return{fill:"none",pattern:null,linearGradient:null};if(!("type"in e))return{fill:new t(e).toString(),pattern:null,linearGradient:null};if("pattern"===e.type){const t=`patternId-${a.nextPatternId()}`;return{fill:`url(#${t})`,pattern:{id:t,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}},linearGradient:null}}const r=`linearGradientId-${a.nextLinearGradientId()}`;return{fill:`url(#${r})`,pattern:null,linearGradient:{id:r,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map(e=>({offset:e.offset,color:e.color&&new t(e.color).toString()}))}}}function w(e){const r={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};return e&&(null!=e.width&&(r.width=e.width),e.cap&&(r.cap=e.cap),e.join&&(r.join=e.join.toString()),e.color&&(r.color=new t(e.color).toString()),e.dashArray&&(r.dashArray=e.dashArray),e.dashoffset&&(r.dashOffset=e.dashoffset),e.style&&!e.dashArray&&(r.dashArray=s.getDashArray(e).join(",")||"none")),r}function S(e,t){const r={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(e){const o=e.alignBaseline,n="baseline"===o?"auto":"top"===o?"text-top":"bottom"===o?"hanging":o;r.align=e.align,r.dominantBaseline=n,r.decoration=e.decoration,r.kerning=e.kerning?"auto":"0",r.rotate=e.rotated?"90":"0",i.assertIsSome(t),r.font.style=t.style||"normal",r.font.variant=t.variant||"normal",r.font.weight=t.weight||"normal",r.font.size=t.size&&t.size.toString()||"10pt",r.font.family=t.family||"serif"}return r}function x(e){const{pattern:t,linearGradient:r}=e;if(t)return c.tsx("pattern",{height:t.height,id:t.id,patternUnits:"userSpaceOnUse",width:t.width,x:t.x,y:t.y},c.tsx("image",{height:t.image.height,href:t.image.href,width:t.image.width,x:t.image.x,y:t.image.y}));if(r){const e=r.stops.map((e,t)=>c.tsx("stop",{key:`${t}-stop`,offset:e.offset,"stop-color":e.color}));return c.tsx("linearGradient",{gradientUnits:"userSpaceOnUse",id:r.id,x1:r.x1,x2:r.x2,y1:r.y1,y2:r.y2},e)}return null}function M(e,t){if(!e||0===e.length)return null;const r=[];for(const t of e){const{shape:e,fill:i,stroke:o,font:n}=t,s=_(i),a=w(o),l="text"===e.type?S(e,n):null,c=v(e,s.fill,a,l);c&&r.push(c)}return c.tsx("mask",{id:t,maskUnits:"userSpaceOnUse"},c.tsx("g",null,r))}function C(e,t,r){return n.translate(e,n.identity(e),[t,r])}function F(e,t,r,i,o){return n.scale(e,n.identity(e),[t,r]),e[4]=e[4]*t-i*t+i,e[5]=e[5]*r-o*r+o,e}function k(e,t){y&&"left"in y?(null!=y.left&&y.left>e&&(y.left=e),(null==y.right||y.right<e)&&(y.right=e),(null==y.top||y.top>t)&&(y.top=t),(null==y.bottom||y.bottom<t)&&(y.bottom=t)):y={left:e,bottom:t,right:e,top:t}}function I(e){const t=e.args,r=t.length;let i;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(i=0;i<r;i+=2)k(t[i],t[i+1]);m.x=t[r-2],m.y=t[r-1];break;case"H":for(i=0;i<r;++i)k(t[i],m.y);m.x=t[r-1];break;case"V":for(i=0;i<r;++i)k(m.x,t[i]);m.y=t[r-1];break;case"m":{let e=0;"x"in m||(k(m.x=t[0],m.y=t[1]),e=2);for(i=e;i<r;i+=2)k(m.x+=t[i],m.y+=t[i+1]);break}case"l":case"t":for(i=0;i<r;i+=2)k(m.x+=t[i],m.y+=t[i+1]);break;case"h":for(i=0;i<r;++i)k(m.x+=t[i],m.y);break;case"v":for(i=0;i<r;++i)k(m.x,m.y+=t[i]);break;case"c":for(i=0;i<r;i+=6)k(m.x+t[i],m.y+t[i+1]),k(m.x+t[i+2],m.y+t[i+3]),k(m.x+=t[i+4],m.y+=t[i+5]);break;case"s":case"q":for(i=0;i<r;i+=4)k(m.x+t[i],m.y+t[i+1]),k(m.x+=t[i+2],m.y+=t[i+3]);break;case"A":for(i=0;i<r;i+=7)k(t[i+5],t[i+6]);m.x=t[r-2],m.y=t[r-1];break;case"a":for(i=0;i<r;i+=7)k(m.x+=t[i+5],m.y+=t[i+6])}}function T(e,t,r){const i=u[e.toLowerCase()];let o;"number"==typeof i&&(i?t.length>=i&&(o={action:e,args:t.slice(0,t.length-t.length%i)},r.push(o),I(o)):(o={action:e,args:[]},r.push(o),I(o)))}function L(e){const t={x:0,y:0,width:0,height:0};if("circle"===e.type)t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if("ellipse"===e.type)t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if("image"===e.type||"rect"===e.type)t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if("path"===e.type){const r=function(e){const t=("string"!=typeof e.path?b(e.path):e.path).match(h),r=[];if(y={},m={},!t)return null;let i="",o=[];const n=t.length;for(let e=0;e<n;++e){const n=t[e],s=parseFloat(n);isNaN(s)?(i&&T(i,o,r),o=[],i=n):o.push(s)}T(i,o,r);const s={x:0,y:0,width:0,height:0};return y&&"left"in y&&(s.x=y.left,s.y=y.top,s.width=y.right-y.left,s.height=y.bottom-y.top),s}(e);t.x=r.x,t.y=r.y,t.width=r.width,t.height=r.height}return t}function E(e){const t={x:0,y:0,width:0,height:0};let r=null,i=Number.NEGATIVE_INFINITY,o=Number.NEGATIVE_INFINITY;for(const n of e)r?(r.x=Math.min(r.x,n.x),r.y=Math.min(r.y,n.y),i=Math.max(i,n.x+n.width),o=Math.max(o,n.y+n.height)):(r=t,r.x=n.x,r.y=n.y,i=n.x+n.width,o=n.y+n.height);return r&&(r.width=i-r.x,r.height=o-r.y),r}function A(e,t,r,i,s,a,l,c,p){let d=(l&&a?g(a,t):t)/2,u=(l&&a?g(a,r):r)/2;if(p){const e=p[0],t=p[1];d=(l&&a?g(a,e):e)/2,u=(l&&a?g(a,t):t)/2}const h=e.width+i,y=e.height+i,m=o.create(),f=o.create();let b=!1;if(s&&0!==h&&0!==y){const e=t!==r?t/r:h/y,i=t>r?t:r;let o=1,s=1;isNaN(i)||(e>1?(o=i/h,s=i/e/y):(s=i/y,o=i*e/h)),n.multiply(f,f,F(m,o,s,d,u)),b=!0}const v=e.x+(h-i)/2,_=e.y+(y-i)/2,w=d-v,S=u-_;if(n.multiply(f,f,C(m,w,S)),!b&&(h>t||y>r)){const e=h/t>y/r,i=(e?t:r)/(e?h:y);n.multiply(f,f,F(m,i,i,v,_))}return c&&n.multiply(f,f,C(m,c[0],c[1])),a&&n.multiply(f,f,function(e,t,r,i){const o=t%360*Math.PI/180;n.rotate(e,n.identity(e),o);const s=Math.cos(o),a=Math.sin(o),l=e[4],c=e[5];return e[4]=l*s-c*a+i*a-r*s+r,e[5]=c*s+l*a-r*a-i*s+i,e}(m,a,v,_)),`matrix(${f[0]},${f[1]},${f[2]},${f[3]},${f[4]},${f[5]})`}e.computeBBox=E,e.generateFillAttributes=_,e.generateStrokeAttributes=w,e.generateTextAttributes=S,e.getBoundingBox=L,e.getTransformMatrix=A,e.renderDef=x,e.renderSVG=function(e,t,r,o={}){const n=[],s=[],l=a.nextBloomId(),p=function(e,t,r){const i=e?.effects.find(e=>"bloom"===e.type);if(!i)return null;const{strength:o,radius:n}=i,s=o>0?n:0,a=(o+.5*s)*(5**(t/100)*(.4+t/100)),l=(o+s)*t,p=4*o+1;return c.tsx("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:`bloom${r}`,width:"300%",x:"-100%",y:"-100%"},c.tsx("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:a,result:"dilate"}),c.tsx("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:l/25}),c.tsx("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:l/50}),c.tsx("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},c.tsx("feFuncR",{slope:p,type:"linear"}),c.tsx("feFuncG",{slope:p,type:"linear"}),c.tsx("feFuncB",{slope:p,type:"linear"})),c.tsx("feMerge",null,c.tsx("feMergeNode",{in:"intensityBlur"}),c.tsx("feMergeNode",{in:"intensityBrightness"}),c.tsx("feGaussianBlur",{stdDeviation:o/10})))}(o.effectView,t,l);let d=null;if(p){const e=o.effectView?.effects.find(e=>"bloom"===e.type),i=o.clipBloomEffect||!e.strength?0:(e.strength+e.radius/2)/3,n=t+t*i,s=r+r*i;d=[Math.max(n,10),Math.max(s,10)]}let u=t,h=r;if(o.useRotationSize)for(let i=0;i<e.length;i++){const e=o.rotations?.[i]??0;u=Math.max(g(e,t),u),h=Math.max(g(e,r),h)}for(let i=0;i<e.length;i++){const a=e[i],l=[],p=[];let y=0,m=0,f=0;for(const e of a){const{shape:t,fill:r,stroke:i,font:s,offset:a}=e;o.ignoreStrokeWidth||"text"===t.type||(y+=i?.width||0);const c=_(r),d=w(i),u="text"===t.type?S(t,s):null;n.push(x(c)),l.push(v(t,c.fill,d,u,o.ariaLabel)),p.push(L(t)),a&&(m+=a[0],f+=a[1])}const b=o.rotations?.[i]??0;o.useRotationSize&&(m+=(u-g(b,t))/2,f+=(h-g(b,r))/2);const C=A(E(p),t,r,y,o.scale??!1,b,o.useRotationSize??!1,[m,f],d);let F=null;if(o.masking){const e=`mask-${i}`,t=o.masking[i];n.push(M(t,e)),F=`url(#${e})`}s.push(F?c.tsx("g",{mask:F},c.tsx("g",{transform:C},l)):c.tsx("g",{transform:C},l))}return p&&(i.assertIsSome(d),u=d[0],h=d[1]),c.tsx("svg",{"aria-label":o.ariaLabel,focusable:!1,height:h,role:"img",style:"display: block;",width:u,xmlns:"http://www.w3.org/2000/svg"},p,c.tsx("defs",null,n),p?c.tsx("g",{filter:`url(#bloom${l})`},s):s)},e.renderShape=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["exports"],function(e){"use strict";function t(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function r(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function i(e,t,r,i,o,n){const s=new Float32Array(6);return s[0]=e,s[1]=t,s[2]=r,s[3]=i,s[4]=o,s[5]=n,s}function o(e,t,r,i){const o=t[i],n=t[i+1];e[i]=r[0]*o+r[2]*n+r[4],e[i+1]=r[1]*o+r[3]*n+r[5]}function n(e,t,r,i=0,n=0,s=2){const a=n||t.length/s;for(let n=i;n<a;n++)o(e,t,r,n*s)}const s=Object.freeze(Object.defineProperty({__proto__:null,clone:r,create:t,fromValues:i,transform:o,transformMany:n},Symbol.toStringTag,{value:"Module"}));e.clone=r,e.create=t,e.fromValues=i,e.mat2df32=s,e.transform=o,e.transformMany=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["exports","./common"],function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function i(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function o(e,t,r,i,o,n,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e[4]=n,e[5]=s,e}function n(e,t){const r=t[0],i=t[1],o=t[2],n=t[3],s=t[4],a=t[5];let l=r*n-i*o;return l?(l=1/l,e[0]=n*l,e[1]=-i*l,e[2]=-o*l,e[3]=r*l,e[4]=(o*a-n*s)*l,e[5]=(i*s-r*a)*l,e):null}function s(e){return e[0]*e[3]-e[1]*e[2]}function a(e,t,r){const i=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=r[0],p=r[1],d=r[2],u=r[3],h=r[4],y=r[5];return e[0]=i*c+n*p,e[1]=o*c+s*p,e[2]=i*d+n*u,e[3]=o*d+s*u,e[4]=i*h+n*y+a,e[5]=o*h+s*y+l,e}function l(e,t,r){const i=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=Math.sin(r),p=Math.cos(r);return e[0]=i*p+n*c,e[1]=o*p+s*c,e[2]=i*-c+n*p,e[3]=o*-c+s*p,e[4]=a,e[5]=l,e}function c(e,t,r){const i=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=r[0],p=r[1];return e[0]=i*c,e[1]=o*c,e[2]=n*p,e[3]=s*p,e[4]=a,e[5]=l,e}function p(e,t,r){const i=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=r[0],p=r[1];return e[0]=i,e[1]=o,e[2]=n,e[3]=s,e[4]=i*c+n*p+a,e[5]=o*c+s*p+l,e}function d(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=-r,e[3]=i,e[4]=0,e[5]=0,e}function u(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function h(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function y(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function m(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function f(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function g(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function b(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function v(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e}function _(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function w(e,r){const i=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],c=r[0],p=r[1],d=r[2],u=r[3],h=r[4],y=r[5],m=t.getEpsilon();return Math.abs(i-c)<=m*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(o-p)<=m*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(n-d)<=m*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-u)<=m*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(a-h)<=m*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(l-y)<=m*Math.max(1,Math.abs(l),Math.abs(y))}const S=a,x=g,M=Object.freeze(Object.defineProperty({__proto__:null,add:f,copy:r,determinant:s,equals:w,exactEquals:_,frob:m,fromRotation:d,fromScaling:u,fromTranslation:h,identity:i,invert:n,mul:S,multiply:a,multiplyScalar:b,multiplyScalarAndAdd:v,rotate:l,scale:c,set:o,str:y,sub:x,subtract:g,translate:p},Symbol.toStringTag,{value:"Module"}));e.add=f,e.copy=r,e.determinant=s,e.equals=w,e.exactEquals=_,e.frob=m,e.fromRotation=d,e.fromScaling=u,e.fromTranslation=h,e.identity=i,e.invert=n,e.mat2d=M,e.mul=S,e.multiply=a,e.multiplyScalar=b,e.multiplyScalarAndAdd=v,e.rotate=l,e.scale=c,e.set=o,e.str=y,e.sub=x,e.subtract=g,e.translate=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/svgGlobalState":function(){define(["exports"],function(e){"use strict";let t=0;function r(e=0){t=e}let i=0;function o(e=0){i=e}let n=0;function s(e=0){n=e}e.nextBloomId=function(){return n++},e.nextLinearGradientId=function(){return i++},e.nextPatternId=function(){return t++},e.resetBloomId=s,e.resetLinearGradientId=o,e.resetPatternId=r,e.resetSVGGlobalState=function(){r(),o(),s()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define(["require","exports","../../Color","../../core/asyncUtils","../../core/has","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/vec3f64","../../layers/effects/jsonUtils","./cimSymbolUtils","./gfxUtils","./Symbol3DMaterial","./typeUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d){"use strict";function u(e,t){if(null==t||null==e)return e;const i=e.toRgba();return i[3]=i[3]*t,new r(i)}function h(e){for(const t of e)if("number"==typeof t)return t;return null}function y(e,t,r){for(let i=0;i<3;i++){const o=e[i];switch(o){case"symbol-value":{const e=r[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(o&&t[i])return o/t[i]}}return null}function m(e,t,r,i){switch(e){case"proportional":return r*i;case"symbol-value":return null!=t?t:r;default:return e}}t.applyColorToSymbol=function(e,t,i){e&&(t||null!=i)&&(t&&(t=new r(t)),d.isSymbol3D(e)?function(e,t,i){const o=e.symbolLayers;if(!o)return;const n=(e,o=!1)=>{let n=t??e??null;return null!=i?.override&&(!n&&o&&(n=new r([255,255,255])),n&&(n.a=i.override)),u(n,i?.add)};o.forEach(e=>{if("water"===e.type)return void(e.color=u(e.color,i?.add));const t=null!=e.material?e.material.color:null,r=n(t,"icon"===e.type&&null!=e.resource?.href);null==e.material?e.material=new p.Symbol3DMaterial({color:r}):e.material.color=r,"outline"in e&&e.outline?.color&&null!=i?.add&&(e.outline.color=u(e.outline.color,i.add)),"marker"in e&&null!=e.marker&&(e.marker.color=n(e.marker.color))})}(e,t,i):d.isSymbol2D(e)&&function(e,t,r){t=t??e.color,null!=r?.override&&t&&(t.a=r.override),t&&(e.color=u(t,r?.add)),"outline"in e&&e.outline?.color&&(e.outline.color=u(e.outline.color,r?.add))}(e,t,i))},t.applyOpacityToColor=u,t.applyRotationToSymbol=function(e,t,r){if(e&&null!=t)if(d.isSymbol3D(e)){const i=e.symbolLayers;i&&i.forEach(e=>{if("object"===e.type)switch(r){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)})}else d.isSymbol2D(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))},t.applySizesToSymbol=async function(t,r){if(t&&r)return d.isSymbol3D(t)?async function(t,r){const o=t.symbolLayers;o&&await i.forEach(o,async t=>async function(t,r){switch(t.type){case"extrude":!function(e,t){const r=t[2];"number"==typeof r&&(e.size=r)}(t,r);break;case"icon":case"line":case"text":!function(e,t){const r=h(t);null!=r&&(e.size=r)}(t,r);break;case"path":!function(e,t){const r=y(t,s.ONES,[e.width,void 0,e.height]);null!=r&&(e.width=m(t[0],e.width,1,r),e.height=m(t[2],e.height,1,r))}(t,r);break;case"object":await async function(t,r){const{resourceSize:i,symbolSize:o}=await async function(t){const{computeObjectLayerResourceSize:r}=await new Promise((t,r)=>e(["./symbolLayerUtils"],t,r)),i=await r(t,10),{width:o,height:n,depth:s}=t,a=[o,s,n];let l=1;for(let e=0;e<3;e++){const t=a[e];if(null!=t){l=t/i[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=i[e]*l);return{resourceSize:i,symbolSize:a}}(t),n=y(r,i,o);null!=n&&(t.width=m(r[0],o[0],i[0],n),t.depth=m(r[1],o[1],i[1],n),t.height=m(r[2],o[2],i[2],n))}(t,r)}}(t,r))}(t,r):void(d.isSymbol2D(t)&&function(e,t){const r=h(t);if(null!=r)switch(e.type){case"simple-marker":e.size=r;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=r,e.height=r*t):(e.width=r*t,e.height=r);break}case"simple-line":e.width=r;break;case"text":e.font.size=r}}(t,r))},t.getCSSFilterFromEffectList=function(e){if(!e)return null;const t=e.effects.filter(e=>"bloom"!==e.type).map(e=>e.toJSON());return a.effectFunctionsFromJSON(t)},t.getColorFromSymbol=function(e,t){if(!e)return null;let i=null;return d.isSymbol3D(e)?i=function(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach(e=>{"object"===e.type&&e.resource?.href||(i="water"===e.type?e.color:e.material?e.material.color:null)}),i?new r(i):null}(e):d.isSymbol2D(e)&&(i="cim"===e.type?l.getCIMSymbolColor(e):e.color?new r(e.color):null),i?u(i,t):null},t.getIconHref=function(e){return e.resource?.href??""},t.getSymbolOutlineColor=function(e){if(!e)return null;if(d.isSymbol3D(e))return function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.color}(e);const t=c.getStroke(e)?.color;return t?new r(t):null},t.getSymbolOutlineSize=function(e){if(!e)return 0;if(d.isSymbol3D(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return n.px2pt(c.getStroke(e)?.width)},t.isVolumetricSymbol=function(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(e=>"object"===e.type);case"line-3d":return e.symbolLayers.some(e=>"path"===e.type);case"polygon-3d":return e.symbolLayers.some(e=>"object"===e.type||"extrude"===e.type);default:return!1}},t.symbolHasExtrudeSymbolLayer=function(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some(e=>"extrude"===e.type)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/styles/support/relationshipUtils":function(){define(["exports","../../../../symbols/support/svgUtils","../../../../symbols/support/utils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,r,i,o){"use strict";const n="esri-relationship-ramp",s=`${n}--diamond`,a=`${n}--square`,l={diamondContainer:`${s}__container`,diamondLeftCol:`${s}__left-column`,diamondRightCol:`${s}__right-column`,diamondMidCol:`${s}__middle-column`,diamondMidColLabel:`${s}__middle-column--label`,diamondMidColRamp:`${s}__middle-column--ramp`,squareTable:`${a}__table`,squareTableRow:`${a}__table-row`,squareTableCell:`${a}__table-cell`,squareTableLabel:`${a}__table-label`,squareTableLabelLeftBottom:`${a}__table-label--left-bottom`,squareTableLabelRightBottom:`${a}__table-label--right-bottom`,squareTableLabelLeftTop:`${a}__table-label--left-top`,squareTableLabelRightTop:`${a}__table-label--right-top`};function c(e,t,r){const i=`${r}_arrowStart`,o=`${r}_arrowEnd`,n="left"===e,s={markerStart:null,markerEnd:null};switch(t){case"HL":n?s.markerStart=`url(#${o})`:s.markerEnd=`url(#${i})`;break;case"LL":s.markerStart=`url(#${o})`;break;case"LH":n?s.markerEnd=`url(#${i})`:s.markerStart=`url(#${o})`;break;default:s.markerEnd=`url(#${i})`}return s}e.renderRelationshipRamp=function(e,n,s={}){const{focus:a,labels:p}=e,d=!!a,u=function(e,i,n={}){const{focus:s,numClasses:a,colors:p,rotation:d}=e,{opacity:u,effectList:h,ariaLabel:y}=n,m=n.size??60,f=!!s,g=Math.sqrt(m**2+m**2)+(f?0:5),b=[],v=[],_=[],w=(m||75)/a;for(let e=0;e<a;e++){const r=e*w;for(let i=0;i<a;i++){const o=i*w,n=t.generateFillAttributes(p[e][i]),s=t.generateStrokeAttributes(null),a={type:"rect",x:o,y:r,width:w,height:w},l=t.renderDef(n);l&&b.push(l);const c=t.renderShape(a,n.fill,s,null);c&&v.push(c),_.push(t.getBoundingBox(a))}}let S=null;f||(S="margin: -15px -15px -18px -15px");const x=c("left",s,i),M=c("right",s,i),C=t.computeBBox(_),F=t.getTransformMatrix(C,g,g,0,!1,d,!1),k=t.getTransformMatrix(C,g,g,0,!1,f?-45:null,!1),I={filter:r.getCSSFilterFromEffectList(h)??void 0,opacity:null==u?"":`${u}`};return o.tsx("div",{class:f?l.diamondMidColRamp:l.squareTableCell,styles:I},o.tsx("svg",{"aria-label":y,focusable:!1,height:g,role:"image",style:S,width:g,xmlns:"http://www.w3.org/2000/svg"},o.tsx("defs",null,o.tsx("marker",{id:`${i}_arrowStart`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"5",refY:"5"},o.tsx("polyline",{fill:"none",points:"0,0 5,5 0,10",stroke:"#555555","stroke-width":"1"})),o.tsx("marker",{id:`${i}_arrowEnd`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"0",refY:"5"},o.tsx("polyline",{fill:"none",points:"5,0 0,5 5,10",stroke:"#555555","stroke-width":"1"})),b),o.tsx("g",{transform:F},v),o.tsx("g",{transform:k},o.tsx("line",{fill:"none","marker-end":x.markerEnd,"marker-start":x.markerStart,stroke:"#555555","stroke-width":"1",x1:-10,x2:-10,y1:m-15,y2:15}),o.tsx("line",{fill:"none","marker-end":M.markerEnd,"marker-start":M.markerStart,stroke:"#555555","stroke-width":"1",x1:15,x2:m-15,y1:m+10,y2:m+10}))))}(e,n,s),h=i.isRTL(),y=s.key??n;return d?o.tsx("div",{class:l.diamondContainer,key:`${y}-container`,styles:{justifyContent:"center"}},o.tsx("div",{class:l.diamondLeftCol},h?p.right:p.left),o.tsx("div",{class:l.diamondMidCol},o.tsx("div",{class:l.diamondMidColLabel},p.top),u,o.tsx("div",{class:l.diamondMidColLabel},p.bottom)),o.tsx("div",{class:l.diamondRightCol},h?p.left:p.right)):o.tsx("div",{class:l.squareTable,key:`${y}-container`},o.tsx("div",{class:l.squareTableRow},o.tsx("div",{class:i.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelRightBottom)},h?p.top:p.left),o.tsx("div",{class:l.squareTableCell}),o.tsx("div",{class:i.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelLeftBottom)},h?p.left:p.top)),o.tsx("div",{class:l.squareTableRow},o.tsx("div",{class:l.squareTableCell}),u,o.tsx("div",{class:l.squareTableCell})),o.tsx("div",{class:l.squareTableRow},o.tsx("div",{class:i.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelRightTop)},h?p.right:p.bottom),o.tsx("div",{class:l.squareTableCell}),o.tsx("div",{class:i.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelLeftTop)},h?p.bottom:p.right)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define(["exports","../../../core/lang","../../../symbols/support/gfxUtils","../../../symbols/support/previewSymbol3D"],function(e,t,r,i){"use strict";const o={HH:315,HL:45,LL:135,LH:225},n={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function s(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return i.getSymbolLayerFill(e.symbolLayers.at(0));if("simple-line"===t){const t=r.getStroke(e);return t&&t.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){const t=r.getStroke(e);return t&&t.color}return r.getFill(e)}function a(e){let t=o[e];return e&&null==t&&(t=o.HH),t||0}e.getRelationshipRampColors2D=function(e,r){const i=[],o=e.length**.5,n=t.clone(e),s=(r||"HH").split(""),a=s[0],l="H"===s[1];for(;n.length;){const e=[];for(;e.length<o;)e.push(n.shift());l&&e.reverse(),i.push(e)}return"L"===a&&i.reverse(),i},e.getRelationshipRampElement=function(e){const{focus:t,infos:r,numClasses:i}=e,o=n[i],l={};r.forEach(e=>{l[e.value]={label:e.label,fill:s(e.symbol)}});const c=[];for(let e=0;e<i;e++){const t=[];for(let r=0;r<i;r++){const i=l[o[e][r]];t.push(i.fill)}c.push(t)}const p=function(e,t){const r=t.HH.label,i=t.LL.label,o=t.HL.label,n=t.LH.label;switch(e){case"HH":default:return{top:r,bottom:i,left:o,right:n};case"HL":return{top:o,bottom:n,left:i,right:r};case"LL":return{top:i,bottom:r,left:n,right:o};case"LH":return{top:n,bottom:o,left:r,right:i}}}(t,l);return{type:"relationship-ramp",numClasses:i,focus:t,colors:c,labels:p,rotation:a(t)}},e.getRotationAngleForFocus=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/previewSymbol3D":function(){define(["exports","../../assets","../../core/colorUtils","../../core/has","../../core/Error","../../core/Logger","../../core/screenUtils","./gfxUtils","./IconSymbol3DLayerResource","./ObjectSymbol3DLayerResource","./previewUtils","./renderUtils","./utils","./webStyleSymbolUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h){"use strict";const y=22,m=120;function f(e){const t=e.outline,r=null!=e.material?e.material.color:null,i=null!=r?r.toHex():null;if(null==t||"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type&&"none"===t.pattern.style)return"fill"===e.type&&"#ffffff"===i?{color:"#bdc3c7",width:.75}:null;const o=s.pt2px(t.size)||0;return{color:"rgba("+(null!=t.color?t.color.toRgba():"255,255,255,1")+")",width:Math.min(o,80),style:"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type?a.dekebabifyLineStyle(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function g(e,t=1){const i=e.a,o=r.toHSV(e),n=o.h,s=o.s/t,a=100-(100-o.v)/t,{r:l,g:c,b:p}=r.toRGB({h:n,s,v:a});return[l,c,p,i]}function b(e){return"water"===e.type?null==e.color?null:e.color:null==e.material?.color?null:e.material.color}function v(e,t=0){const r=b(e);if(!r){if("fill"===e.type)return null;const r=a.defaultThematicColor.r,i=p.adjustColorComponentBrightness(r,t);return[i,i,i,100]}const i=r.toRgba();for(let e=0;e<3;e++)i[e]=p.adjustColorComponentBrightness(i[e],t);return i}async function _(e,r){const i=e.style;return"none"===i?null:{type:"pattern",x:0,y:0,src:await a.getPatternUrlWithColor(t.getAssetUrl(`esri/symbols/patterns/${i}.png`),r.toCss(!0)),width:5,height:5}}function w(e){return e.outline?f(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function S(e,t){const r=b(e);if(!r)return null;let i="rgba(";return i+=p.adjustColorComponentBrightness(r.r,t)+",",i+=p.adjustColorComponentBrightness(r.g,t)+",",i+=p.adjustColorComponentBrightness(r.b,t)+",",i+r.a+");"}function x(e,t){const r=e.edges;return r&&r.color&&r.size?{color:r.color.toCss(!0),width:Math.min(s.pt2px(r.size),t,80),join:"round"}:null}function M(e,t){const r=S(e,t);if(!r)return null;if("pattern"in e&&null!=e.pattern&&"style"===e.pattern.type&&"none"===e.pattern.style)return null;const i={color:r,width:Math.min(e.size?s.pt2px(e.size):.75,80)};return"pattern"in e&&"style"===e.pattern?.type&&(i.style=a.dekebabifyLineStyle(e.pattern.style)),"cap"in e&&e.cap&&(i.cap=e.cap),"join"in e&&e.join&&(i.join="miter"===e.join?s.pt2px(2):e.join),i}function C(e,t,r){const i=null!=r?.75*r:0;return{type:"linear",x1:i?.25*i:0,y1:i?.5*i:0,x2:i||4,y2:i?.5*i:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function F(e){const t="number"==typeof e?.size?e?.size:null;return t?s.pt2px(t):null}e.getPatternDescriptor=_,e.getSizeFromOptions=F,e.getSymbolLayerFill=v,e.previewSymbol3D=function(e,r){if(0===e.symbolLayers.length)return Promise.reject(new o("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return async function(e,r){const i=F(r),o=r?.maxSize?s.pt2px(r.maxSize):null,a=r?.disableUpsampling??!1,g=e.symbolLayers,b=[],_=[];let S=!1,x=0,M=0,k=0;g.forEach(n=>{if("icon"!==n.type&&"object"!==n.type)return;n&&"icon"===n.type&&(k=Math.max(n.size&&s.pt2px(n.size),k));const g="icon"===n.type?n.size&&s.pt2px(n.size):0,F=i||g?Math.ceil(Math.min(i||g,o||m)):y;let I="icon"===n.type?n.angle:null;if(null!=r?.rotation&&(I=(I??0)+r.rotation),_.push(I),n?.resource?.href){const r=async function(e,r){if(e.thumbnail?.url)return e.thumbnail.url;if("icon"===r.type){const e=r?.resource?.href;if(e)return u.getIconHref(r)}const i=t.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const t=await h.resolveWebStyleSymbol(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(t&&"thumbnail"in t&&t.thumbnail?.url)return t.thumbnail.url}return i}(e,n).then(e=>{const t=n?.material?.color,r=function(e){return"icon"===e.type?"multiply":"tint"}(n);return d.tintImageWithColor(e,F,t,r,a)}).then(e=>{const t=e.width,r=e.height;return x=Math.max(x,t),M=Math.max(M,r),I&&(S=!0),[{shape:{type:"image",x:0,y:0,width:t,height:r,src:e.url},fill:null,stroke:null}]});b.push(r)}else{let e=F;"icon"===n.type&&i&&(e=F*(g/k));const t="tall"===r?.symbolConfig||r?.symbolConfig?.isTall||"object"===n.type&&function(e){const t=e.depth,r=e.height,i=e.width;return 0!==i&&0!==t&&0!==r&&i===t&&null!=i&&null!=r&&i<r}(n);x=Math.max(x,t?20:e),M=Math.max(M,e),I&&n.resource?.primitive&&["square","triangle","x"].includes(n.resource?.primitive)&&(S=!0),b.push(Promise.resolve(function(e,t,r){const i=[];if(!e)return i;switch(e.type){case"icon":{const r=0,o=0,n=t,s=t;switch(e.resource?.primitive??l.defaultPrimitive){case"circle":i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:v(e,0),stroke:f(e)});break;case"square":i.push({shape:{type:"path",path:[{command:"M",values:[r,s]},{command:"L",values:[r,o]},{command:"L",values:[n,o]},{command:"L",values:[n,s]},{command:"Z",values:[]}]},fill:v(e,0),stroke:f(e)});break;case"triangle":i.push({shape:{type:"path",path:[{command:"M",values:[r,s]},{command:"L",values:[.5*n,o]},{command:"L",values:[n,s]},{command:"Z",values:[]}]},fill:v(e,0),stroke:f(e)});break;case"cross":i.push({shape:{type:"path",path:[{command:"M",values:[.5*n,o]},{command:"L",values:[.5*n,s]},{command:"M",values:[r,.5*s]},{command:"L",values:[n,.5*s]}]},stroke:w(e)});break;case"x":i.push({shape:{type:"path",path:[{command:"M",values:[r,o]},{command:"L",values:[n,s]},{command:"M",values:[n,o]},{command:"L",values:[r,s]}]},stroke:w(e)});break;case"kite":i.push({shape:{type:"path",path:[{command:"M",values:[r,.5*s]},{command:"L",values:[.5*n,o]},{command:"L",values:[n,.5*s]},{command:"L",values:[.5*n,s]},{command:"Z",values:[]}]},fill:v(e,0),stroke:f(e)})}break}case"object":switch(e.resource?.primitive??c.defaultPrimitive){case"cone":{const o=C(v(e,0),v(e,-.6),r?20:t),n=p.getConeShapes(t,r);i.push({shape:n[0],fill:o},{shape:n[1],fill:o});break}case"inverted-cone":{const r=v(e,0),o=C(r,v(e,-.6),t),n=p.getInvertedConeShapes(t);i.push({shape:n[0],fill:o},{shape:n[1],fill:r});break}case"cube":{const o=p.getCubeShapes(t,r);i.push({shape:o[0],fill:v(e,0)},{shape:o[1],fill:v(e,-.3)},{shape:o[2],fill:v(e,-.5)});break}case"cylinder":{const o=C(v(e,0),v(e,-.6),r?20:t),n=p.getCylinderShapes(t,r);i.push({shape:n[0],fill:o},{shape:n[1],fill:o},{shape:n[2],fill:v(e,0)});break}case"diamond":{const r=p.getDiamondShapes(t);i.push({shape:r[0],fill:v(e,-.3)},{shape:r[1],fill:v(e,0)},{shape:r[2],fill:v(e,-.3)},{shape:r[3],fill:v(e,-.7)});break}case"sphere":{const r=C(v(e,0),v(e,-.6));r.x1=0,r.y1=0,r.x2=.25*t,r.y2=.25*t,i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:r});break}case"tetrahedron":{const r=p.getTetrahedronShapes(t);i.push({shape:r[0],fill:v(e,-.3)},{shape:r[1],fill:v(e,0)},{shape:r[2],fill:v(e,-.6)});break}}}return i}(n,e,t)))}});const I=await Promise.allSettled(b),T=[];return I.forEach(e=>{"fulfilled"===e.status?T.push(e.value):e.reason&&n.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",e.reason)}),d.renderSymbol(T,[x,M],{node:r?.node,scale:!1,opacity:r?.opacity,ariaLabel:r?.ariaLabel,rotations:_,useRotationSize:S})}(e,r);case"line-3d":return function(e,t){const r=e.symbolLayers,i=[],o=u.isVolumetricSymbol(e),n=F(t),a=(t?.maxSize?s.pt2px(t.maxSize):null)||80;let l,c=0,h=0;return r.forEach((e,t)=>{if(!e)return;if("line"!==e.type&&"path"!==e.type)return;const r=[];switch(e.type){case"line":{const i=M(e,0);if(null==i)break;const o=i?.width||0;0===t&&(l=o);const s=Math.min(n||o,a),p=0===t?s:n?s*(o/l):s,d=p>25?2*p:50;h=Math.max(h,p),c=Math.max(c,d),i.width=p,r.push({shape:{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[c,.5*h]}]},stroke:i});break}case"path":{const t=Math.min(n||y,a),i=v(e,0),o=v(e,-.2),s=S(e,-.4),l=s?{color:s,width:1}:{};if("quad"===e.profile){const t=e.width,n=e.height,s=t&&n?t/n:1,a=p.getPathSymbolShapes(s,0===n,0===t),c={...l,join:"bevel"};r.push({shape:a[0],fill:o,stroke:c},{shape:a[1],fill:o,stroke:c},{shape:a[2],fill:i,stroke:c})}else r.push({shape:p.shapes.pathSymbol3DLayer[0],fill:o,stroke:l},{shape:p.shapes.pathSymbol3DLayer[1],fill:i,stroke:l});h=Math.max(h,t),c=h}}i.push(r)}),Promise.resolve(d.renderSymbol(i,[c,h],{node:t?.node,scale:o,opacity:t?.opacity,ariaLabel:t?.ariaLabel}))}(e,r);case"polygon-3d":case"mesh-3d":return async function(e,t){const r="mesh-3d"===e.type,i=e.symbolLayers,o=F(t),n=t?.maxSize?s.pt2px(t.maxSize):null,a=o||y,l=[];let c=0,u=0,h=!1;for(let e=0;e<i.length;e++){const t=i.at(e),o=[];if(!r||"fill"===t.type){switch(t.type){case"fill":{const e=Math.min(a,n||m);if(c=Math.max(c,e),u=Math.max(u,e),h=!0,r){const r=p.shapes.meshSymbol3DFill,i=S(t,-.4),n=x(t,.05*e)??(i?{join:"round",color:i,width:1}:null);o.push({shape:r[0],fill:v(t,0),stroke:n},{shape:r[1],fill:v(t,-.2),stroke:n},{shape:r[2],fill:v(t,-.6),stroke:n})}else{let e=v(t,0);const r="pattern"in t?t.pattern:null,i=f(t),n=b(t);null!=r&&"style"===r.type&&"solid"!==r.style&&n&&(e=await _(r,n)),o.push({shape:p.shapes.fill[0],fill:e,stroke:i})}break}case"line":{const e=M(t,0);if(null==e)break;const r={stroke:e,shape:p.shapes.fill[0]};c=Math.max(c,y),u=Math.max(u,y),o.push(r);break}case"extrude":{const e=v(t,0),r=v(t,-.2),i=Math.min(a,n||m),s=p.getExtrudeSymbolShapes(i),l=y,d=15.399999999999999+.5*i,h=x(t,.1*Math.min(l,d))??{join:"round",...M(t,-.4),width:1};o.push({shape:s[0],fill:r,stroke:h},{shape:s[1],fill:r,stroke:h},{shape:s[2],fill:e,stroke:h}),c=Math.max(c,l),u=Math.max(u,d);break}case"water":{const e=b(t),r=g(e),i=g(e,2),s=g(e,3),l=p.getWaterSymbolShapes();h=!0,o.push({shape:l[0],fill:r},{shape:l[1],fill:i},{shape:l[2],fill:s});const d=Math.min(a,n||m);c=Math.max(c,d),u=Math.max(u,d);break}}l.push(o)}}return d.renderSymbol(l,[c,u],{node:t?.node,scale:h,opacity:t?.opacity,ariaLabel:t?.ariaLabel})}(e,r)}return Promise.reject(new o("symbolPreview: swatchInfo3D","symbol not supported."))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/previewUtils":function(){define(["exports","../../Color"],function(e,t){"use strict";function r(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}e.adjustColorBrightness=function(e,i){if(null==e)return new t;if("type"in e&&("linear"===e.type||"pattern"===e.type))return e;const o=new t(e);return new t([r(o.r,i),r(o.g,i),r(o.b,i),o.a])},e.adjustColorComponentBrightness=r,e.getConeShapes=function(e,t){let r=t?20:e;const i=t?4:6;r-=r<=22?.5*i:i;const o=.15*r,n=e-o;return[{type:"ellipse",cx:.5*r,cy:n,rx:.5*r,ry:o},{type:"path",path:[{command:"M",values:[.5*r,0]},{command:"L",values:[r,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]}]},e.getCubeShapes=function(e,t){let r=t?20:e;const i=t?4:6;r-=r<=22?.5*i:i;const o=t?.35*r:.5*r;return[{type:"path",path:[{command:"M",values:[.5*r,0]},{command:"L",values:[r,.5*o]},{command:"L",values:[.5*r,o]},{command:"L",values:[0,.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*o]},{command:"L",values:[.5*r,o]},{command:"L",values:[.5*r,e]},{command:"L",values:[0,e-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*r,o]},{command:"L",values:[.5*r,e]},{command:"L",values:[r,e-.5*o]},{command:"L",values:[r,.5*o]},{command:"Z",values:[]}]}]},e.getCylinderShapes=function(e,t){let r=t?20:e;const i=t?4:6;r-=r<=22?.5*i:i;const o=.5*r,n=.15*r,s=e-n;return[{type:"ellipse",cx:.5*r,cy:s,rx:o,ry:n},{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[0,s]},{command:"L",values:[r,s]},{command:"L",values:[r,n]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*r,cy:n,rx:o,ry:n}]},e.getDiamondShapes=function(e){let t=e;const r=e;t-=t<22?2:4;const i=t,o=r,n=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*i,0]},{command:"L",values:[i,.5*o-n]},{command:"L",values:[.45*i-n,.5*o+n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*i,0]},{command:"L",values:[.45*i-n,.5*o+n]},{command:"L",values:[0,.5*o-n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*o-n]},{command:"L",values:[.45*i-n,.5*o+n]},{command:"L",values:[.45*i,r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*i,r]},{command:"L",values:[i,.5*o-n]},{command:"L",values:[.45*i-n,.5*o+n]},{command:"Z",values:[]}]}]},e.getExtrudeSymbolShapes=function(e){const t=.5*e,r=22;return[{type:"path",path:[{command:"M",values:[0,.7*r*.5]},{command:"L",values:[6.6,.7*r]},{command:"L",values:[6.6,.7*r+t]},{command:"L",values:[0,.7*r+t-.7*r*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,.7*r]},{command:"L",values:[6.6,.7*r+t]},{command:"L",values:[22,t]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,.7*r]},{command:"L",values:[0,.7*r*.5]},{command:"Z",values:[]}]}]},e.getInvertedConeShapes=function(e){let t=e;t-=t<22?3:6;const r=.15*t;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[.5*t,e-r]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:0,rx:.5*t,ry:r}]},e.getPathSymbolShapes=function(e,t,r){let i=22,o=22;e<1?i*=.75:e>1&&(o*=1.25);let n=22,s=22;return t&&r&&(i=o=n=s=0),[{type:"path",path:[{command:"M",values:[n,0]},{command:"L",values:[r?n:.875*n,0]},{command:"L",values:[r?i-.5*n:0,o-.5*s]},{command:"L",values:[i-.5*n,o-.5*s]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,0]},{command:"L",values:[n,t?0:.125*s]},{command:"L",values:[i-.5*n,t?o-.5*s:s]},{command:"L",values:[i-.5*n,o-.5*s]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[i-.5*n,o-.5*s]},{command:"L",values:[r?i-.5*n:0,o-.5*s]},{command:"L",values:[r?i-.5*n:0,t?o-.5*s:s]},{command:"L",values:[i-.5*n,t?o-.5*s:s]},{command:"Z",values:[]}]}]},e.getTetrahedronShapes=function(e){let t=e;return t-=t<22?1:2,[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,t]},{command:"L",values:[.45*e,.6*t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[0,t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,t]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[e,t]},{command:"Z",values:[]}]}]},e.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]},e.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define(["exports","../../core/devEnvironmentUtils","../../core/Error","../../core/urlUtils","../../portal/Portal","../../chunks/persistableUrlUtils","./jsonUtils","./StyleOrigin","./styleUtils","./Thumbnail","./typeUtils","./webStyleAcceptedFormats"],function(e,t,r,i,o,n,s,a,l,c,p,d){"use strict";function u(e,t){return t.items.find(t=>t.name===e)}async function h(e,h,y,m,f){const g=null!=y?.portal?y.portal:o.getDefault(),b={portal:g,url:i.urlToObject(e.baseUrl)},v=u(h,e.data);if(!v)throw new r("symbolstyleutils:symbol-name-not-found",`The symbol name '${h}' could not be found`,{symbolName:h});const _=f?.acceptedFormats??d.defaultAcceptedFormats,w=m(v,_);if(!w)throw new r("symbolstyleutils:symbol-reference-no-accepted-format",`The symbol name '${h}' does not have an accepted format (one of ${_})`,{symbolName:h});const{url:S,format:x}=w;let M=n.fromJSON(S,b),C=v.thumbnail?.href??null;const F=v.thumbnail?.imageData;t.isDevEnvironment()&&(M=t.adjustStaticAGOUrl(M)??"",C=t.adjustStaticAGOUrl(C));const k={portal:g,url:i.urlToObject(i.removeFile(M)),origin:"portal-item"};return l.requestJSON(M,f).then(t=>{const r="cim"===x?l.makeCIMSymbolRef(t.data):t.data,i=s.fromJSON(r,k);if(i&&p.isSymbol3D(i)){if(C){const e=n.fromJSON(C,b);i.thumbnail=new c.Thumbnail({url:e})}else F&&(i.thumbnail=new c.Thumbnail({url:`data:image/png;base64,${F}`}));e.styleUrl?i.styleOrigin=new a({portal:y.portal,styleUrl:e.styleUrl,name:h}):e.styleName&&(i.styleOrigin=new a({portal:y.portal,styleName:e.styleName,name:h}))}return i})}e.fetchSymbolFromStyle=h,e.getStyleItemFromStyle=u,e.resolveWebStyleSymbol=function(e,t,n){const a=e.name;return null==a?Promise.reject(new r("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,r){const n=l.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,e),a=null!=t.portal?t.portal:o.getDefault();return l.requestJSON(n,r).then(e=>{const t=l.makeCIMSymbolRef(e.data);return s.fromJSON(t,{portal:a,url:i.urlToObject(i.removeFile(n)),origin:"portal-item"})})}(a,t,n):l.fetchStyle(e,t,n).then(e=>h(e,a,t,l.symbolUrlFromStyleItem,n))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(e){"use strict";const t=/^devext\.arcgis\.com$/,r=/^qaext\.arcgis\.com$/,i=/^[\w-]*\.mapsdevext\.arcgis\.com$/,o=/^[\w-]*\.mapsqa\.arcgis\.com$/,n=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,t,r,/^jsapps\.esri\.com$/,i,o];e.adjustStaticAGOUrl=function(e,n){return e?(n=n||globalThis.location.hostname)?null!=n.match(t)||null!=n.match(i)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=n.match(r)||null!=n.match(o)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e:null},e.devHostnames=n,e.isDevEnvironment=function(e){return e=e||globalThis.location.hostname,n.some(t=>null!=e?.match(t))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleAcceptedFormats":function(){define(["exports"],function(e){"use strict";e.defaultAcceptedFormats=["web-gltf","web","cim"],Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Spinner":function(){define(["exports","../chunks/tslib.es6","../core/promiseUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Widget","./Spinner/SpinnerViewModel","./support/widgetUtils","./support/jsxFactory"],function(e,t,r,i,o,n,s,a,l,c,p,d,u){"use strict";const h="esri-spinner",y=h,m=`${h}--start`,f=`${h}--finish`;return e.default=class extends c{constructor(e,t){super(e,t),this._animationDelay=500,this._animationPromise=null,this.viewModel=new p}initialize(){this.addHandles(i.watch(()=>this.visible,e=>this._visibleChange(e)))}destroy(){this._animationPromise=null}get location(){return this.viewModel.location}set location(e){this.viewModel.location=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visible(){return this.viewModel.visible}set visible(e){this.viewModel.visible=e}show(e){const{location:t,promise:r}=e??{};t&&(this.viewModel.location=t),this.visible=!0,r?.catch(()=>{}).then(()=>this.hide())}hide(){this.visible=!1}render(){const{visible:e}=this,{screenLocation:t}=this.viewModel,r=!!t,i=e&&r,o=!e&&r,n={[m]:i,[f]:o},s=this._getPositionStyles();return u.tsx("div",{class:this.classes(y,n),styles:s})}_visibleChange(e){if(e)return void(this.viewModel.screenLocationEnabled=!0);const t=r.after(this._animationDelay);this._animationPromise=t,t.catch(()=>{}).then(()=>{this._animationPromise===t&&(this.viewModel.screenLocationEnabled=!1,this._animationPromise=null)})}_getPositionStyles(){const{screenLocation:e,view:t}=this.viewModel;if(null==t||null==e)return{};const{padding:r}=t;return{left:e.x-r.left+"px",top:e.y-r.top+"px"}}},t.__decorate([o.property()],e.default.prototype,"location",null),t.__decorate([o.property()],e.default.prototype,"view",null),t.__decorate([o.property({type:p})],e.default.prototype,"viewModel",void 0),t.__decorate([o.property()],e.default.prototype,"visible",null),e.default=t.__decorate([l.subclass("esri.widgets.Spinner")],e.default),e.default})},"esri/widgets/Spinner/SpinnerViewModel":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../support/AnchorElementViewModel"],function(e,t,r,i,o,n,s,a){"use strict";return e.default=class extends a{constructor(e){super(e),this.visible=!1}},t.__decorate([r.property()],e.default.prototype,"visible",void 0),e.default=t.__decorate([s.subclass("esri.widgets.Spinner.SpinnerViewModel")],e.default),e.default})},"esri/widgets/support/AnchorElementViewModel":function(){define(["exports","../../chunks/tslib.es6","../../core/Evented","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/projectionUtils"],function(e,t,r,i,o,n,s,a,l,c){"use strict";return e.default=class extends r.EventedAccessor{constructor(e){super(e),this.location=null,this.screenLocationEnabled=!1,this.view=null,this.addHandles([i.when(()=>{const e=this.screenLocationEnabled?this.view:null;return e?[e.size,"3d"===e.type?e.camera:e.viewpoint]:null},()=>this.notifyChange("screenLocation")),i.watch(()=>this.screenLocation,(e,t)=>{null!=e&&null!=t&&this.emit("view-change")})])}destroy(){this.view=null}get screenLocation(){const{location:e,view:t,screenLocationEnabled:r}=this,i=t?.spatialReference,o=i?c.projectOrLoad(e,i).geometry:null;return r&&o&&t?.ready?t.toScreen(o):null}},t.__decorate([o.property()],e.default.prototype,"location",void 0),t.__decorate([o.property()],e.default.prototype,"screenLocation",null),t.__decorate([o.property()],e.default.prototype,"screenLocationEnabled",void 0),t.__decorate([o.property()],e.default.prototype,"view",void 0),e.default=t.__decorate([l.subclass("esri.widgets.support.AnchorElementViewModel")],e.default),e.default})},"esri/widgets/Editor/css":function(){define(["exports"],function(e){"use strict";const t="esri-editor",r={base:t,helpMessage:`${t}__help-message`,updateActions:`${t}__update-actions`,updateActionsList:`${t}__update-actions-list`,featureTemplatesContainer:`${t}__feature-templates-container`,templateItemContentEnd:`${t}__template-item-content-end`,sketchContainer:`${t}__sketch-container`,pendingFeatureListIcon:`${t}__pending-feature-list-icon`,selectionToolbarContainer:`${t}__selection-toolbar-container`};e.css=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/EditorViewModel":function(){define(["../../chunks/tslib.es6","../../core/arrayUtils","../../core/asyncUtils","../../core/Collection","../../core/deprecate","../../core/Error","../../core/Evented","../../core/handleUtils","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles","../../editing/templateUtils","../../layers/GraphicsLayer","../../layers/support/editableLayers","../../layers/support/layerUtils","../../portal/support/urlUtils","../../views/SelectionManager","../../views/interactive/sketch/SketchOptions","../../views/interactive/snapping/SnappingManager","../../views/interactive/snapping/SnappingOptions","../../views/support/selectionUtils","../Attachments/AttachmentsViewModel","./CreateFeaturesWorkflow","./UpdateFeaturesWorkflow","./UpdateWorkflow","./workflowUtils","./support/EditorItem","../FeatureTemplates/featureTemplatesUtils","../FeatureTemplates/FeatureTemplatesViewModel","../Sketch/SketchViewModel","../Spinner/SpinnerViewModel","../support/goToUtils","../support/SelectionList/selectionListUtils","../support/SelectionList/SelectionListViewModel","../support/SelectionToolbar/SelectionToolbarViewModel"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F,k,I,T,L,E,A,V,O,P,U,R,D,G){"use strict";function H(e,t){return e?.find(e=>e.layer===t)}let N=class extends s.EventedAccessor{constructor(e){super(e),this._queuedSelectionTool=null,this._sketchEventListenerHandle=null,this._sketchGraphicsLayer=new g({listMode:"hide",internal:!0,title:"Editor sketch layer"}),this._snappingManager=null,this._templatesByLayer=new Map,this._updateItemsTask=null,this._updateTemplatesTask=null,this._updatingHandles=new m.UpdatingHandles,this._featureTemplatesViewModelIsRestricted=!1,this.activeWorkflow=null,this._activityQueue=new i,this.editorItems=new i,this.failures=[],this.hideTemplatesForInactiveLayers=!1,this.attachmentsViewModel=new F({capabilities:{editing:!0}}),this.featureTemplatesViewModel=new V({disabledItemFunction:({layer:e})=>this._itemIsSuspended(e)}),this.layerInfos=null,this.ownSketchViewModel=new O({layer:this._sketchGraphicsLayer}),this.selectionListViewModel=new D,this.selectionManager=new w,this.selectionToolbarViewModel=new G({continuousSelectionEnabled:!0,defaultOperationType:"replace",persistSelection:!1,returnGeometry:!1}),this.sketchOptions=new S,this.snappingOptions=new M({attributeRulesEnabled:!0}),this.spinnerViewModel=new P,this.pageStack=[],this.showDiscardEditsPrompt=()=>Promise.resolve(!0),this._candidateCommitted=!1,this.back=async()=>{if("viewing-selection-list"===this.state)return this.selectionListViewModel.filterText=void 0,void this.effectiveSelectionManager.clear();this.canGoBack&&(this.activeWorkflow?.hasPreviousStep?await this.activeWorkflow.back(this.showDiscardEditsPrompt):await this._cancelWorkflow({force:!this.hasPendingEdits}))},this.saveWorkflow=async()=>await(this.activeWorkflow?.save()),this.selectFeature=(e,t=!1)=>{const r=this.activeWorkflow;this._candidateCommitted||"update"!==r?.type||(r.data.rootFeature=e,t&&(r.next(),this._candidateCommitted=!0))}}initialize(){this.addHandles([d.watch(()=>{const e=this.view,t=e?.map?.editableLayers.toArray(),r=e?.allLayerViews,i=r?.filter(e=>!!t?.includes(e.layer));return[t,i,this.layerInfos]},()=>this._updateEditorItems(),d.syncAndInitial),d.watch(()=>this.hideTemplatesForInactiveLayers,()=>this.syncFeatureTemplates()),d.watch(()=>this._selectionSources,()=>this._syncSelectionSources(),d.initial),d.on(()=>this.activeWorkflow,"cancel",()=>this.emit("workflow-cancel")),d.on(()=>this.activeWorkflow,"commit",()=>this.emit("workflow-commit")),d.on(()=>this.activeWorkflow,"complete",()=>{this.emit("workflow-commit"),this._set("activeWorkflow",null)}),d.when(()=>!this.activeWorkflow&&this._queuedSelectionTool,()=>this._queuedSelectionTool&&this.selectionToolbarViewModel.activateTool(this._queuedSelectionTool)),d.watch(()=>this.activeWorkflow,e=>this.selectionManager.showHighlight=!e),d.when(()=>this.view?.map,e=>e.add(this._sketchGraphicsLayer),d.initial),d.on(()=>this.editorItems,"change",()=>this._afterEditorItemsChange()),d.watch(()=>[this.canCreate,this.canUpdateVisible],()=>this._afterEditorItemsChange()),d.watch(()=>this.page,(e,t)=>{const r=[...this.pageStack];if(-1===r.indexOf(e))r.push(e);else for(;r.length&&r.at(-1)!==e;)r.pop();this.pageStack=r},d.syncAndInitial),d.when(()=>"awaiting-update-feature-candidate"===this.state,()=>this._candidateCommitted=!1),d.on(()=>this.featureTemplatesViewModel,"select",async({item:e,oldItem:t})=>{const{activeWorkflow:r}=this;if(r){if("update"===r.type&&"awaiting-feature-creation-info"===r.activeWorkflow?.stepId)return;try{await this.cancelWorkflow({force:!this.hasPendingEdits})}catch{return void this.featureTemplatesViewModel.select(t,{emit:!1})}}if(!e)return;const i={layer:e.layer,template:e.template};if(e.supportsUpload)return this.featureTemplatesViewModel.select(t,{emit:!1}),this.startCreateFeaturesWorkflow(i);await this.startCreateFeaturesWorkflowAtFeatureCreation(i)}),d.watch(()=>[this.view,this.featureTemplatesViewModel],([e,t])=>{t.view=e},d.syncAndInitial),d.on(()=>this.view,"key-down",e=>{"Escape"===e.key&&this.activeWorkflow?.keyboardCancellationEnabled&&(e.stopPropagation(),this.back())}),d.on(()=>this.sketchViewModel,["create","delete","update"],e=>{const{activeWorkflow:t}=this,r="update"===t?.type,i=L.getLayersFromWorkflow(t),o=r?t?.activeWorkflow?.parentLayer??void 0:void 0,n=`sketch-${e.type}`;this.emit(n,{type:n,detail:e,layer:i[0],layers:i,parentLayer:o})},d.sync),d.watch(()=>this.view,e=>{if(this._snappingManager=c.destroyMaybe(this._snappingManager),!e)return;const t=this.snappingOptions;this._snappingManager=new x.SnappingManager({view:e,options:t}),this.ownSketchViewModel.snappingManager=this._snappingManager},d.syncAndInitial),d.watch(()=>this.snappingOptions,e=>{this._snappingManager&&(this._snappingManager.options=e)},d.syncAndInitial),d.on(()=>this.selectionToolbarViewModel,"complete",e=>this._onSelectionComplete(e)),d.watch(()=>({view:this.view,selectionManager:this.effectiveSelectionManager,selectionListViewModel:this.selectionListViewModel,selectionToolbarViewModel:this.selectionToolbarViewModel}),({view:e,selectionManager:t,selectionListViewModel:r,selectionToolbarViewModel:i})=>{t.view=e,r.view=e,i.view=e},d.syncAndInitial),d.watch(()=>this.effectiveSelectionManager,e=>{this.selectionListViewModel.selectionManager=e,this.selectionToolbarViewModel.selectionManager=e},d.syncAndInitial)])}destroy(){this._cancelWorkflow({warnIfNoWorkflow:!1}).then(()=>{this.view?.map?.remove(this._sketchGraphicsLayer),this.view=null}),this._updateItemsTask=c.abortMaybe(this._updateItemsTask),this._updatingHandles.destroy(),this._sketchEventListenerHandle=c.removeMaybe(this._sketchEventListenerHandle),this.selectionListViewModel?.destroy(),this.selectionToolbarViewModel?.destroy(),this.selectionManager.destroy()}get _featureTemplatesLayersAndTables(){const e=new i;for(const t of this.editorItems){const r=this.hideTemplatesForInactiveLayers&&!t.visible;t.supportsCreateFeaturesWorkflow&&!r&&e.push(t.layer)}return e}get _selectionSources(){const e=new i;for(const t of this.editorItems)C.isSelectableLayer(t.layer)&&t.supportsUpdateWorkflow&&t.visible&&e.push(t.layer);return e}get activeFeatureCount(){const e=this.activeLeafWorkflow;return L.isCreateFeaturesWorkflow(e)?e.pendingFeatures.length:L.isUpdateRecordWorkflow(e)&&e.data.edits.feature?1:L.isUpdateFeaturesWorkflow(e)?e.data.features.length:0}get activeLeafWorkflow(){const e=this.activeWorkflow;return e&&L.isUpdateWorkflow(e)?e.activeWorkflow??e:e}get canCreate(){return this.editorItems.some(e=>e.supportsCreateFeaturesWorkflow)}get canCreateVisible(){return!!this.featureTemplatesLayers.length}get canUpdate(){return this.editorItems.some(e=>e.supportsUpdateWorkflow)}get canUpdateVisible(){return this.editorItems.some(e=>e.supportsUpdateWorkflow&&e.visible)}get featureTemplatesLayers(){return this._featureTemplatesLayersAndTables.filter(e=>"scene"===e.type||!e.isTable)}get effectiveSelectionManager(){return this.selectionManager}get featureFormViewModel(){const{activeWorkflow:e}=this;return"update"===e?.type?e.activeFeatureFormViewModel:"create-features"===e?.type?e.featureFormViewModel:null}get formViewModel(){const{activeWorkflow:e}=this;return"update"===e?.type?e.activeFeatureFormViewModel:"create-features"===e?.type?e.featureFormViewModel:"update-features"===e?.type?e.formViewModel:null}get utilityNetworkAssociationAddAssociationViewModel(){const{activeWorkflow:e}=this;return"update"===e?.type?e.activeUtilityNetworkAssociationAddAssociationViewModel:null}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get sketchViewModel(){const{activeWorkflow:e}=this;return"update"===e?.type?e.activeSketchViewModel:"create-features"===e?.type||"update-features"===e?.type?e.sketchViewModel:this.ownSketchViewModel}get state(){if(!this.view?.ready)return"disabled";const e=this.attachmentsViewModel.mode;if("add"===e)return"adding-attachment";if("edit"===e)return"editing-attachment";const{activeWorkflow:t}=this,r=!t?.stepId;return this.effectiveSelectionManager.count&&r?"viewing-selection-list":r?"ready":"update"===t.type&&t.activeWorkflow?.stepId?t.activeWorkflow.stepId:t.stepId}get syncing(){return this._activityQueue.length>0}get updating(){return this._updatingHandles.updating||!0===this.activeWorkflow?.updating}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}set view(e){this.ownSketchViewModel.view=e,this.spinnerViewModel.view=e,this._set("view",e)}get canZoomTo(){const e=this.sketchViewModel,t=e?.createGraphic?.geometry?.type;return!(!e?.updateGraphics?.length&&"multipoint"!==t)}get page(){const{activeWorkflow:e,state:t}=this;if("update"===e?.type&&null!=e?.activeWorkflow?.featureFormViewModel?.associatedLayer)return"viewing-associated-features";if("update"===e?.type&&null!=e?.activeWorkflow?.featureFormViewModel?.associationId)return"viewing-associated-layers";if("update"===e?.type&&"awaiting-feature-to-update"===e.stepId)return"ready";if("create-features"===e?.type&&0===e.numPendingFeatures){const t=e.data.upload;if(t)return"default"===t.state?"ready":"creating-features-upload-details"}return t??"disabled"}get featureFormDisabled(){const{activeLeafWorkflow:e}=this;if(L.isUpdateRecordWorkflow(e))return!1===e.data.editorItem?.capabilities.update.attributes||!0===e.featureFormViewModel.disabled;if(L.isUpdateFeaturesWorkflow(e)){const{formViewModel:t}=e;return t.disabled||t.readOnly}return!1}get featureFormHasAssociation(){return!!this.featureFormViewModel?.activeAssociation}get canGoBack(){return null!=this.activeWorkflow&&!this.syncing}get shouldShowDeleteButton(){const{activeLeafWorkflow:e}=this;if(L.isUpdateRecordWorkflow(e)){const{data:t}=e;return t.editorItem?.capabilities.delete.enabled&&!t.readOnly}return!!L.isUpdateFeaturesWorkflow(e)&&e.data.editorItems.every(e=>e.capabilities.delete.enabled)}get hasPendingEdits(){return this.activeWorkflow?.hasPendingEdits??!1}get snappingManager(){return this._snappingManager}getTemplatesForLayer(e){return this._templatesByLayer.get(e)??[]}async startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.startCreateFeaturesWorkflow()}async startCreateFeaturesWorkflowAtFeatureCreation(e){return this.startCreateFeaturesWorkflow(e,"creating-features")}async startCreateFeaturesWorkflow(e,t="awaiting-feature-creation-info"){if(await d.whenOnce(()=>!this.updating),!this.canCreate)throw new n("editing:unsupported-workflow","Creating features is unsupported or disabled.");const r=this._createUpdatingResolver();try{await this._cancelWorkflow();const r=this._createCreateFeaturesWorkflow(e,t);this._set("activeWorkflow",r),await r.start()}catch(e){this._logErrorAndCancelWorkflow(e)}finally{r.resolve()}}async startCreateFeaturesWorkflowAtFeatureEdit(e){await d.whenOnce(()=>!this.updating);const t=this._createUpdatingResolver();try{const{initialFeature:t}=e,r=t.sourceLayer=t.layer,i=r?this.findEditorItemForLayer(r):void 0;if(!i?.supportsCreateFeaturesWorkflow)throw new n("editing:unsupported-workflow","Creating features is unsupported or disabled for this layer.");await this._cancelWorkflow();const o=this._createCreateFeaturesWorkflow({initialFeature:t,layer:i.layer,maxFeatures:1},"creating-features");this._set("activeWorkflow",o),await o.start()}catch(e){this._logErrorAndCancelWorkflow(e)}finally{t.resolve()}}async startUpdateFeaturesWorkflow(e){if(await d.whenOnce(()=>!this.updating),!this.canUpdate)return void this._logError("editing:unsupported-workflow","Update features workflow is unsupported or disabled.");if(t.unique(e.map(e=>e.sourceLayer??e.layer)).length>1)throw L.makeMultipleSourceLayersError();const r=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateFeaturesWorkflow(e);this._set("activeWorkflow",t),await t.start()}catch(e){this._logErrorAndCancelWorkflow(e)}finally{r.resolve()}}async startUpdateWorkflowAtFeatureSelection(){if(await d.whenOnce(()=>!this.updating),!this.canUpdate)return void this._logError("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const e=this._createUpdatingResolver();try{await this._cancelWorkflow();const e=this._createUpdateWorkflow();this._set("activeWorkflow",e),await e.start()}catch(e){this._logErrorAndCancelWorkflow(e)}finally{e.resolve()}}async startUpdateWorkflowAtMultipleFeatureSelection(e){if(await d.whenOnce(()=>!this.updating),!this.canUpdate)return void this._logError("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow("awaiting-update-feature-candidate");t.data.candidates=e,this._set("activeWorkflow",t),await t.start()}catch(e){this._logErrorAndCancelWorkflow(e)}finally{t.resolve()}}async startUpdateWorkflowAtFeatureEdit(e){if(await d.whenOnce(()=>!this.updating),!this.canUpdate)return void this._logError("editing:unsupported-workflow","Update workflow is unsupported or disabled.");const t=this._createUpdatingResolver();try{await this._cancelWorkflow();const t=this._createUpdateWorkflow("editing-existing-feature");t.data.rootFeature=e,t.addHandles(d.on(()=>t,"commit",()=>{t.destroy(),this.activeWorkflow===t&&this._set("activeWorkflow",null)})),this._set("activeWorkflow",t),await t.start()}catch(e){this._logErrorAndCancelWorkflow(e)}finally{t.resolve()}}async startUpdateWorkflowWithActiveSelection(){const{selectionListViewModel:e}=this;if(!e.visibleFeatureCount)throw new n("editing:missing-selection","Unable to determine visible selection.");if(e.visibleLayerCount>1)throw new n("editing:features-different-layers","Cannot start workflow with features from different layers.");const t=e.visibleFeatureItems.map(e=>e.graphic);1===t.length?await this.startUpdateWorkflowAtFeatureEdit(t[0]):await this.startUpdateFeaturesWorkflow(t)}async deleteFeatureFromWorkflow(){o.deprecatedFunction(l.getLogger(this),"EditorViewModel.deleteFeatureFromWorkflow is deprecated. Use EditorViewModel.deleteFeatures instead.",{version:"4.33",replacement:"EditorViewModel.deleteFeatures",warnOnce:!0}),await this.deleteFeatures()}async deleteFeatures(){const e=this.activeWorkflow;return L.isUpdateWorkflow(e)?e.deleteActiveFeature():L.isUpdateFeaturesWorkflow(e)?e.deleteAndCommit():void this._logError("editing:unsupported-workflow","Deleting features requires an active update workflow.")}async deleteAssociationFromWorkflow(){const{activeWorkflow:e}=this;e&&"update"===e.type?await e.deleteActiveAssociation():this._logError("editing:unsupported-workflow","Deleting an association requires an active update workflow.")}async cancelWorkflow(e){return this._cancelWorkflow({warnIfNoWorkflow:!0,...e})}findEditorItemForLayer(e){return this.editorItems.find(t=>t.layer===e)}itemHasInvalidFormTemplate(e){return null!=e&&!0===this.findEditorItemForLayer(e.layer)?.hasInvalidFormTemplate}syncFeatureTemplates(){this._featureTemplatesViewModelIsRestricted||this._updateTemplates()}zoomTo(e){const{view:r,sketchViewModel:i}=this;if(!r)return;const o=e??i?.createGraphic;if(o)"mesh"===o.geometry?.type?U.goTo(r,o.geometry):U.goTo(r,o);else{const e=i?.updateGraphics?.toArray();"3d"===r.type&&e?.some(e=>"mesh"===e.geometry?.type)?U.goTo(r,e.map(e=>e.geometry).filter(t.isSome)):e&&U.goTo(r,e)}}async toggleUpdateWorkflow(){this.canUpdate&&(this.hasPendingEdits&&!await this.showDiscardEditsPrompt()||(this.activeWorkflow&&"awaiting-feature-to-update"===this.state?await this.cancelWorkflow({force:!0}):await this.startUpdateWorkflowAtFeatureSelection()))}async onSelectionListItemSelect(e){R.isFeatureItem(e)&&await this.startUpdateWorkflowAtFeatureEdit(e.graphic)}async onSelectionListMenuItemSelect(e){if(R.isFeatureItem(e))await this.startUpdateWorkflowAtFeatureEdit(e.graphic);else if(R.isLayerItem(e)){const t=e.featureItems.filter(e=>e.visible).map(e=>e.graphic);1===t.length?await this.startUpdateWorkflowAtFeatureEdit(t[0]):await this.startUpdateFeaturesWorkflow(t)}}restrictFeatureTemplatesViewModelToLayer(e){return this._featureTemplatesViewModelIsRestricted=!0,this._setFeatureTemplatesViewModelLayers([e]),a.makeHandle(()=>{this._featureTemplatesViewModelIsRestricted=!1,this._setFeatureTemplatesViewModelLayers(this.featureTemplatesLayers)})}async _getEditorItemCandidates(e){const{view:t}=this;if(!t?.map)return[];const{map:r}=t,i=r.editableLayers.toArray(),o=r.allTables.toArray().filter(e=>v.isFeatureLayer(e)||v.isSubtypeGroupLayer(e));return await Promise.allSettled([...i.flatMap(e=>this._getLayerLoadPromise(e)),...o.flatMap(e=>this._getLayerLoadPromise(e))]),p.throwIfAborted(e),[...i.reverse(),...o.reverse()].filter(e=>b.isEditableLayer(e)&&("mesh"!==e.geometryType||"3d"===t.type)).flatMap(e=>"subtype-group"===e.type?e.sublayers.toArray():e)}_getLayerLoadPromise(e){return v.isSubtypeGroupLayer(e)?e.loadAll():e.load()}_drainEditorItems(){this.editorItems.drain(e=>e.destroy())}_updateEditorItems(){c.abortMaybe(this._updateItemsTask);const{view:e}=this,t=r.createTask(async t=>{if(!e?.map||!e?.allLayerViews)return;const r=await this._getEditorItemCandidates(t);if(!r.length)return void this._drainEditorItems();const i=[],o=[],n=[],{layerInfos:s}=this;for(const t of r){const r=H(s,t),a=await L.whenEditorLayerView(e,t).catch(()=>null);(r?i:a?o:n).push(new E({layer:t,layerInfo:r,layerView:a}))}s?.length&&i.sort((e,t)=>s.findIndex(({layer:t})=>t===e.layer)-s.findIndex(({layer:e})=>e===t.layer));const a=[...i,...o,...n];t.aborted||(this._drainEditorItems(),this.editorItems.addMany(a))});this._updatingHandles.addPromise(t.promise),this._updateItemsTask=t}_updateTemplates(){c.abortMaybe(this._updateTemplatesTask);const e=r.createTask(async e=>{const t=this._templatesByLayer,r=this._featureTemplatesLayersAndTables.filter(e=>!t.has(e));if(r.length>0){const i=await f.getTemplatesForLayers(r.toArray(),this.view,e);for(const{layer:e,templates:r}of i)t.set(e,r)}this._setFeatureTemplatesViewModelLayers(this.featureTemplatesLayers)});this._updatingHandles.addPromise(e.promise),this._updateTemplatesTask=e}_setFeatureTemplatesViewModelLayers(e){const t=this._templatesByLayer,r=[];for(const i of e){const e=t.get(i);e&&e.length>0&&r.push(A.makeTemplateGroupInfoForLayer(i,e))}this.featureTemplatesViewModel.templateInfos=r}_afterEditorItemsChange(){const{activeWorkflow:e}=this;if(this.syncFeatureTemplates(),!e)return;const{stepId:t}=e;"create-features"!==e.type?"update"===e.type&&("awaiting-feature-to-update"===t&&!this.canUpdateVisible||"awaiting-update-feature-candidate"===t&&!e.hasUpdatableCandidates)&&this._cancelWorkflow():"awaiting-feature-creation-info"!==t||this.canCreate||this._cancelWorkflow()}async _cancelWorkflow(e){const t=this.activeWorkflow;if(t)if(e&&!1===e.force)try{await t.cancel(e),this._set("activeWorkflow",null),t.destroy()}catch(e){}else{this.emit("workflow-cancel"),this._set("activeWorkflow",null);try{await t.cancel(e)}finally{t.destroy()}}else e?.warnIfNoWorkflow&&this._logError("editing:no-active-workflow","There is no active workflow to cancel.")}_createCreateFeaturesWorkflow(e,t){return k.create({viewModel:this,creationInfo:e,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:t,applyEditsCallback:(e,t,r)=>this._applyEdits(e,t,r),applyEditsFeatureServiceCallback:(e,t,r)=>this._applyEditsFeatureService(e,t,r),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_createUpdateFeaturesWorkflow(e){const t=I.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,features:e,applyEdits:(e,t,r)=>this._applyEdits(e,t,r),applyEditsFeatureService:(e,t,r)=>this._applyEditsFeatureService(e,t,r)});return t.addHandles(d.on(()=>t,"commit",()=>{t.destroy(),this.activeWorkflow===t&&this._set("activeWorkflow",null)})),t}_createUpdateWorkflow(e){return T.create({viewModel:this,sketchOptions:this.sketchOptions,snappingManager:this._snappingManager,startAt:e,applyEditsCallback:(e,t,r)=>this._applyEdits(e,t,r),applyEditsFeatureServiceCallback:(e,t,r)=>this._applyEditsFeatureService(e,t,r),addAttachmentsCallback:(e,t)=>this._addAttachments(e,t)})}_addAttachments(e,t){const r=t.map(t=>this._addAttachment(e,t.feature,t.attachment))??[];return Promise.all(r)}async _addAttachment(e,t,r){let i=null;if(!("addAttachment"in e)||null==e.capabilities?.attachment)throw new n("editor:attachments-not-supported","Adding attachments is not supported for this layer type");return await this._queueOperation(async()=>(i=await(e.addAttachment?.(t,r).catch(e=>{throw e?.error||e}))??null,i)),i}async _applyEdits(e,t,r){let i=null;const o=e.url?await v.getOwningPortalUrl(e.url):null,n={returnServiceEditsOption:o&&_.parseKnownArcGISOnlineDomain(o)||RegExp("/hosted/","i").test(e.url)?void 0:"original-and-current-features",...r};return await this._queueOperation(async()=>{const{view:r}=this;if(!r)return null;const o=await L.whenEditorLayerView(r,e).catch(()=>null);return i=await e.applyEdits(t,n),o&&await d.whenOnce(()=>!o.updating),i}),i}async _applyEditsFeatureService(e,t,r){let i=null;return await this._queueOperation(async()=>i=await e.applyEdits(t,r)),i}_queueOperation(e){this._activityQueue.push(e);const t=(e,t)=>{const r=t.indexOf(e);r>-1&&t.splice(r,1)};return e().then(e=>(Array.isArray(e)?e.forEach(e=>this._handleEditsResultError(e)):this._handleEditsResultError(e),e)).catch(r=>{this._logError("editing:operation-error","An error occurred.",{error:r});const i={error:r,retry:()=>(t(i,this.failures),this._queueOperation(e)),cancel:()=>{t(i,this.failures)}};this._set("failures",[...this.failures,i])}).then(()=>{t(e,this._activityQueue)})}_handleEditsResultError(e){if(null!=e&&"error"in e&&null!=e.error)throw e.error;if(null!=e&&"addFeatureResults"in e){const{addFeatureResults:t,deleteFeatureResults:r,updateFeatureResults:i}=e,o=t.find(e=>!!e.error)||i.find(e=>!!e.error)||r.find(e=>!!e.error);if(o)throw o.error}}_createUpdatingResolver(){const e=p.createResolver();return this._updatingHandles.addPromise(e.promise),e}_logErrorAndCancelWorkflow(e){const{name:t,message:r,details:i}=e;this._logError(t??"editing:workflow-start-failed",r??void 0,i??e),this._cancelWorkflow({force:!0})}_itemIsSuspended(e){const t=this.findEditorItemForLayer(e);return null!=t&&(!t.visible||t.disabled)}_logError(e,t,r){l.getLogger(this).error(new n(e,t,r))}_syncSelectionSources(){this.selectionManager.sources.items=this._selectionSources.toArray()}async _onSelectionComplete(e){if(e.aborted)return;const{operationType:t,selection:r}=e,{effectiveSelectionManager:i}=this,o="ready"===this.state,n=1===r.length;if(this._queuedSelectionTool=void 0,o&&n&&(0===i.count&&"add"===t||"replace"===t))return this._queuedSelectionTool=e.toolName,this.startUpdateWorkflowAtFeatureEdit(r[0]);switch(t){case"remove":i.updateSelection({current:[],added:[],removed:r});break;case"replace":i.clear(),i.updateSelection({current:r,added:[],removed:[]});break;case"add":i.updateSelection({current:r,added:[],removed:[]})}}};return e.__decorate([u.property()],N.prototype,"_featureTemplatesLayersAndTables",null),e.__decorate([u.property()],N.prototype,"_queuedSelectionTool",void 0),e.__decorate([u.property()],N.prototype,"_snappingManager",void 0),e.__decorate([u.property()],N.prototype,"_selectionSources",null),e.__decorate([u.property()],N.prototype,"activeFeatureCount",null),e.__decorate([u.property({readOnly:!0})],N.prototype,"activeWorkflow",void 0),e.__decorate([u.property()],N.prototype,"activeLeafWorkflow",null),e.__decorate([u.property({readOnly:!0})],N.prototype,"_activityQueue",void 0),e.__decorate([u.property({readOnly:!0})],N.prototype,"canCreate",null),e.__decorate([u.property()],N.prototype,"canCreateVisible",null),e.__decorate([u.property({readOnly:!0})],N.prototype,"canUpdate",null),e.__decorate([u.property()],N.prototype,"canUpdateVisible",null),e.__decorate([u.property()],N.prototype,"featureTemplatesLayers",null),e.__decorate([u.property()],N.prototype,"editorItems",void 0),e.__decorate([u.property()],N.prototype,"effectiveSelectionManager",null),e.__decorate([u.property({readOnly:!0})],N.prototype,"failures",void 0),e.__decorate([u.property()],N.prototype,"hideTemplatesForInactiveLayers",void 0),e.__decorate([u.property({type:F})],N.prototype,"attachmentsViewModel",void 0),e.__decorate([u.property()],N.prototype,"featureFormViewModel",null),e.__decorate([u.property()],N.prototype,"formViewModel",null),e.__decorate([u.property()],N.prototype,"utilityNetworkAssociationAddAssociationViewModel",null),e.__decorate([u.property({type:V})],N.prototype,"featureTemplatesViewModel",void 0),e.__decorate([u.property()],N.prototype,"labelOptions",null),e.__decorate([u.property()],N.prototype,"layerInfos",void 0),e.__decorate([u.property()],N.prototype,"ownSketchViewModel",void 0),e.__decorate([u.property()],N.prototype,"selectionListViewModel",void 0),e.__decorate([u.property()],N.prototype,"selectionManager",void 0),e.__decorate([u.property()],N.prototype,"selectionToolbarViewModel",void 0),e.__decorate([u.property()],N.prototype,"sketchOptions",void 0),e.__decorate([u.property()],N.prototype,"sketchViewModel",null),e.__decorate([u.property({type:M,nonNullable:!0})],N.prototype,"snappingOptions",void 0),e.__decorate([u.property()],N.prototype,"spinnerViewModel",void 0),e.__decorate([u.property()],N.prototype,"state",null),e.__decorate([u.property({readOnly:!0})],N.prototype,"syncing",null),e.__decorate([u.property()],N.prototype,"updating",null),e.__decorate([u.property()],N.prototype,"tooltipOptions",null),e.__decorate([u.property()],N.prototype,"valueOptions",null),e.__decorate([u.property()],N.prototype,"view",null),e.__decorate([u.property()],N.prototype,"canZoomTo",null),e.__decorate([u.property()],N.prototype,"pageStack",void 0),e.__decorate([u.property()],N.prototype,"showDiscardEditsPrompt",void 0),e.__decorate([u.property()],N.prototype,"_candidateCommitted",void 0),e.__decorate([u.property()],N.prototype,"page",null),e.__decorate([u.property()],N.prototype,"featureFormDisabled",null),e.__decorate([u.property()],N.prototype,"featureFormHasAssociation",null),e.__decorate([u.property()],N.prototype,"canGoBack",null),e.__decorate([u.property()],N.prototype,"shouldShowDeleteButton",null),e.__decorate([u.property()],N.prototype,"hasPendingEdits",null),e.__decorate([u.property()],N.prototype,"snappingManager",null),N=e.__decorate([y.subclass("esri.widgets.Editor.EditorViewModel")],N),N})},"esri/layers/GraphicsLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/support/OwningCollection","./Layer","./mixins/BlendLayer","./mixins/ScaleRangeLayer","../support/GraphicsCollection","../symbols/support/ElevationInfo"],function(e,t,r,i,o,n,s,a,l,c,p,d,u){"use strict";return e.default=class extends(c.BlendLayer(p.ScaleRangeLayer(l))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new d.GraphicsCollection,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}get loaded(){return super.loaded}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}graphicChanged(e){this.emit("graphic-update",e)}},t.__decorate([r.property({type:u})],e.default.prototype,"elevationInfo",void 0),t.__decorate([r.property(a.owningCollectionProperty(d.GraphicsCollection,"graphics"))],e.default.prototype,"graphics",void 0),t.__decorate([r.property({type:["show","hide"]})],e.default.prototype,"listMode",void 0),t.__decorate([r.property()],e.default.prototype,"screenSizePerspectiveEnabled",void 0),t.__decorate([r.property({readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([r.property({constructOnly:!0})],e.default.prototype,"internal",void 0),e.default=t.__decorate([s.subclass("esri.layers.GraphicsLayer")],e.default),e.default})},"esri/views/interactive/sketch/SketchOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./SketchLabelOptions","./SketchTooltipOptions","./SketchValueOptions"],function(e,t,r,i,o,n,s,a,l,c,p){"use strict";return e.default=class extends r{constructor(e){super(e),this.labels=new l,this.tooltips=new c,this.values=new p}},t.__decorate([i.property({nonNullable:!0,type:l})],e.default.prototype,"labels",void 0),t.__decorate([i.property({nonNullable:!0,type:c})],e.default.prototype,"tooltips",void 0),t.__decorate([i.property({nonNullable:!0,type:p})],e.default.prototype,"values",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchOptions")],e.default),e.default})},"esri/views/interactive/sketch/SketchLabelOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a){"use strict";return e.default=class extends r{constructor(e){super(e),this.enabled=!1}},t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"enabled",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchLabelOptions")],e.default),e.default})},"esri/views/interactive/sketch/SketchTooltipOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./SketchTooltipElevationOptions","./SketchTooltipVisibleElements"],function(e,t,r,i,o,n,s,a,l,c){"use strict";return e.default=class extends r{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new l.SketchTooltipElevationOptions,this.placement="auto",this.offset=null,this.visibleElements=new c,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}},t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"enabled",void 0),t.__decorate([i.property()],e.default.prototype,"forceEnabled",void 0),t.__decorate([i.property()],e.default.prototype,"effectiveEnabled",null),t.__decorate([i.property()],e.default.prototype,"helpMessage",void 0),t.__decorate([i.property()],e.default.prototype,"helpMessageIcon",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"inputEnabled",void 0),t.__decorate([i.property({type:l.SketchTooltipElevationOptions,nonNullable:!0})],e.default.prototype,"elevation",void 0),t.__decorate([i.property()],e.default.prototype,"placement",void 0),t.__decorate([i.property()],e.default.prototype,"offset",void 0),t.__decorate([i.property({type:c,nonNullable:!0})],e.default.prototype,"visibleElements",void 0),t.__decorate([i.property()],e.default.prototype,"visualVariables",void 0),t.__decorate([i.property()],e.default.prototype,"xyMode",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchTooltipOptions")],e.default),e.default})},"esri/views/interactive/sketch/SketchTooltipElevationOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a){"use strict";e.SketchTooltipElevationOptions=class extends r{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}},t.__decorate([i.property({type:String,nonNullable:!0})],e.SketchTooltipElevationOptions.prototype,"mode",void 0),e.SketchTooltipElevationOptions=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchTooltipElevationOptions")],e.SketchTooltipElevationOptions),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/sketch/SketchTooltipVisibleElements":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a){"use strict";return e.default=class extends r{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}},t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"area",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"coordinates",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"direction",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"distance",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"elevation",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"header",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"helpMessage",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"orientation",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"radius",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"rotation",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"scale",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"size",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.default.prototype,"totalLength",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchTooltipVisibleElements")],e.default),e.default})},"esri/views/interactive/snapping/SnappingManager":function(){define(["require","exports","../../../chunks/tslib.es6","../../../core/asyncUtils","../../../core/Evented","../../../core/has","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/projectionUtils","../../../support/elevationInfoUtils","../sketch/normalizedPoint","./Settings","./SnappingOptions","./snappingUtils","./candidates/DrapedEdgeSnappingCandidate","./candidates/EdgeSnappingCandidate","./candidates/IntersectionSnappingCandidate","./candidates/LineSnappingCandidate","./candidates/ParallelLineSnappingCandidate","./candidates/RightAngleSnappingCandidate","./candidates/RightAngleTriangleSnappingCandidate","../support/viewUtils","../../support/geodesicLengthMeasurementUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F){"use strict";t.SnappingManager=class extends o.EventedAccessor{constructor(e){super(e),this.options=new f,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([a.watch(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:r,effectiveFeatureEnabled:i,effectiveGridEnabled:o}=this.options;return{selfEnabled:r,featureEnabled:i,gridEnabled:"2d"===this.view.type&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=i.createTask(r=>this._updateEngines(e,t,r))},a.syncAndInitial),a.watch(()=>this.options,e=>{for(const t of this._engines)t.options=e},a.sync)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,r){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const i=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!i.has("feature")?this._createFeatureSnappingEngine(r):void 0,e.selfEnabled&&!i.has("self")?this._createSelfSnappingEngine(r):void 0,e.gridEnabled&&!i.has("grid")?this._createGridSnappingEngine(r):void 0]);if(r.aborted)for(const e of o)"fulfilled"===e.status&&e.value?.engine.destroy();else{for(const e of o)"fulfilled"===e.status&&e.value&&i.set(e.value.type,e.value.engine);this._engines=Array.from(i.values())}}async _createSelfSnappingEngine(t){const[{SelfSnappingEngine:r},i]=await Promise.all([new Promise((t,r)=>e(["./SelfSnappingEngine"],t,r)),F.loadGeodesicLengthMeasurementUtils()]);return s.throwIfAborted(t),{type:"self",engine:new r({view:this.view,options:this.options,geodesicLengthMeasurementUtils:i})}}async _createGridSnappingEngine(t){const{view:r}=this;if("2d"!==r.type)return;const{GridSnappingEngine:i}=await new Promise((t,r)=>e(["./GridSnappingEngine"],t,r));return s.throwIfAborted(t),{type:"grid",engine:new i({view:r,options:this.options})}}async _createFeatureSnappingEngine(t){const{FeatureSnappingEngine:r}=await new Promise((t,r)=>e(["./FeatureSnappingEngine"],t,r));s.throwIfAborted(t);const{view:i,options:o}=this,{spatialReference:n}=i;return{type:"feature",engine:new r({view:i,options:o,spatialReference:n})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,r=e*t;return r*r}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:r}=e;this._removeVisualization();const i=this._currentMainCandidate;if(null==i)return t;const o=this._selectUpdateInput(e);if(null==o)return t;const{spatialReference:n}=r,s=u.project(o,n);if(null==s)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=r,p=[],d=y.fromPoint(s,a,l),h=i.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,h,r)||!T(i,r.drawConstraints))return this._resetSnappingState(),t;i.targetPoint=y.markAsTarget(h),p.push(...i.hints);for(const e of this._currentOtherActiveCandidates)T(e,r.drawConstraints)&&(e.targetPoint=y.markAsTarget(h),p.push(...e.hints));return null!=c&&this.addHandles(c.draw(p,{spatialReference:n,elevationInfo:E(r),view:a,selfSnappingZ:r.selfSnappingZ}),k),y.toElevationAlignedDehydratedPoint(h,a,t,r)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case 0:return e;case 1:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(k)}async _snapSinglePoint({point:e,context:t,signal:r}){const{view:i}=this,{elevationInfo:o}=t,n=y.fromPoint(e,i,o),s=await this._fetchCandidates(n,3,t,r);return this._createSnapResult(n,0,s,i,e,t,r)}async _snapMultiPoint({point:e,scenePoint:t,context:r,signal:i}){const{view:o}=this,{coordinateHelper:n,elevationInfo:s,spatialReference:a}=r;await u.initializeProjection(t.spatialReference,a);const l=u.project(t,a),c=y.fromPoint(l,o,s),p=await this._fetchCandidates(c,1,r,i);if(p.length>0){const e=await this._fetchCandidates(c,2,r,i);return this._createSnapResult(c,1,[...p,...e],o,l,r,i)}const d=y.fromPoint(e,o,s),h=await this._fetchCandidates(d,2,r,i);return this._createSnapResult(d,0,h,o,{z:n.hasZ()&&e.hasZ?e.z??0:void 0,m:n.hasM()&&e.hasM?e.m??0:void 0},r,i)}async _fetchCandidates(e,t,r,i){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,r,i)))).flat()}_createSnapResult(e,t,r,i,o,n,a){return{get valid(){return!s.isAborted(a)},apply:()=>{const{spatialReference:s}=n,{snappedPoint:a,hints:l}=this._processCandidates(e,t,r,n);return this._removeVisualization(),null!=n.visualizer&&this.addHandles(n.visualizer.draw(l,{spatialReference:s,elevationInfo:h.absoluteHeightElevationInfo,view:i,selfSnappingZ:n.selfSnappingZ}),k),y.toElevationAlignedDehydratedPoint(a,i,o,n)}}}_processCandidates(e,t,r,i){if(r.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),g.sortCandidatesInPlace(e,r);const o=this._currentMainCandidate;if(null!=o){const a=(s=r,(n=o)instanceof _.IntersectionSnappingCandidate?L(s,n.first)>=0&&L(s,n.second)>=0?0:-1:L(s,n));if(a>=0){if(!(r[a]instanceof _.IntersectionSnappingCandidate))return this._intersectWithOtherCandidates(a,r,e,t,i);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,i))return this._updateSnappingCandidate(o,t,r,i)}}var n,s;return this._intersectWithOtherCandidates(0,r,e,t,i)}_intersectWithOtherCandidates(e,t,r,i,o){const{coordinateHelper:n}=o,s=t[e],a=[];for(let i=0;i<t.length;++i){if(i===e)continue;const o=t[i],l=s.constraint.intersect(o.constraint);if(l)for(const e of l.closestPoints(s.targetPoint))a.push([new _.IntersectionSnappingCandidate(y.markAsTarget(e),s,o,o.isDraped),this._squaredScreenDistance(r,e,n)])}return a.length>0&&(a.sort((e,t)=>e[1]-t[1]),a[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(a[0][0],i,t,o):T(s,o.drawConstraints)?this._updateSnappingCandidate(s,i,t,o):{snappedPoint:r,hints:[]}}_updateSnappingCandidate(e,t,r,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,n=[];n.push(...e.hints);for(const t of r){if(e instanceof _.IntersectionSnappingCandidate){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;const r=t.constraint.closestTo(o);this._squaredScreenDistance(r,o,i.coordinateHelper)<I()&&(t.targetPoint=o,this._currentOtherActiveCandidates.push(t),n.push(...t.hints))}return{snappedPoint:o,hints:n}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,r){return this._squaredScreenDistance(e,t,r.coordinateHelper)<this._squaredPointProximityThreshold(r.pointer)}_squaredScreenDistance(e,t,r){return g.squaredScreenDistance(this._toScreen(e,r),this._toScreen(t,r))}_toScreen(e,t){return C.vectorToScreenPoint(e,t.spatialReference,h.absoluteHeightElevationInfo,this.view)}get test(){}},r.__decorate([l.property({constructOnly:!0})],t.SnappingManager.prototype,"view",void 0),r.__decorate([l.property()],t.SnappingManager.prototype,"options",void 0),r.__decorate([l.property({readOnly:!0})],t.SnappingManager.prototype,"updating",null),r.__decorate([l.property()],t.SnappingManager.prototype,"_loadTask",void 0),r.__decorate([l.property()],t.SnappingManager.prototype,"_engines",void 0),r.__decorate([l.property()],t.SnappingManager.prototype,"_squaredMouseProximityThreshold",null),r.__decorate([l.property()],t.SnappingManager.prototype,"_squaredTouchProximityThreshold",null),t.SnappingManager=r.__decorate([d.subclass("esri.views.interactive.snapping.SnappingManager")],t.SnappingManager);const k="visualization-handle";function I(){return m.defaults.satisfiesConstraintScreenThreshold*m.defaults.satisfiesConstraintScreenThreshold}function T(e,t){return!t||null==t.direction&&null==t.distance||!(e instanceof b.DrapedEdgeSnappingCandidate||e instanceof v.EdgeSnappingCandidate||e instanceof w.LineSnappingCandidate||e instanceof S.ParallelLineSnappingCandidate||e instanceof M.RightAngleTriangleSnappingCandidate)&&(!(e instanceof x.RightAngleSnappingCandidate)||null==t.direction&&1===e.selfSnappingType)}function L(e,t){let r=-1;for(let i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){r=i;break}return r}function E({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?h.absoluteHeightElevationInfo:t}Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/support/elevationInfoUtils":function(){define(["exports","../core/unitUtils","../symbols/support/unitConversionUtils"],function(e,t,r){"use strict";function i(e){return e?m:f}function o(e,t){return t?.mode?t.mode:i(e).mode}function n(e,t){return null!=t?t:i(e)}function s(e,t){return o(null==e||(e.hasZ??!1),t)}function a(e){const t=p(e),r=s(e.geometry,t),i=null!=t&&"on-the-ground"!==r?y(t):0,o=t?.featureExpressionInfo;return{mode:r,offset:i,featureExpressionInfo:o}}function l(e){return"0"===e?.featureExpressionInfo?.expression}function c(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function p(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function d(e,r){if(!e?.offset)return 0;const{offset:i,unit:o}=e;if("decimal-degrees"===o)return 0;const n="unknown"!==o&&o?o:"meters",s=t.verticalLengthUnitFromSpatialReference(r);return s?t.convertUnit(i,n,s):0}function u(e,t,r,i,o,n,s=null){if(null==n)return;const a=null!=s?s.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=h(t,r,i,o,e,n);return function(e,t,r,i,o,n,s,a){const l=d(s,o);switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-((n.elevationProvider.getElevation(t,r,i,o,"ground")??0)+l);case"relative-to-scene":return e-((n.elevationProvider.getElevation(t,r,i,o,"scene")??0)+l)}}(l,t,r,i,o,e,s,a)}function h(e,t,r,i,o,n){const s=d(n,i);switch(n.mode){case"absolute-height":return{absoluteZ:r+s,elevation:0};case"on-the-ground":{const r=o.elevationProvider.getElevation(e,t,0,i,"ground")??0;return{absoluteZ:r,elevation:r}}case"relative-to-ground":{const n=o.elevationProvider.getElevation(e,t,r,i,"ground")??0;return{absoluteZ:r+n+s,elevation:n}}case"relative-to-scene":{const n=o.elevationProvider.getElevation(e,t,r,i,"scene")??0;return{absoluteZ:r+n+s,elevation:n}}}}function y(e){return(e?.offset??0)*r.getMetersPerUnit(e?.unit)}const m={mode:"absolute-height",offset:0},f={mode:"on-the-ground",offset:null};e.absoluteHeightElevationInfo=m,e.elevationContextAffectsAlignment=function(e,t){if(null==t)return!1;const{mode:r}=t;return null!=r&&("scene"===e&&"relative-to-scene"===r||"ground"===e&&"absolute-height"!==r)},e.elevationModeRequiredMessage=function(e,t,r){return r&&r.mode!==t?`${e} only support ${t} elevation mode`:null},e.elevationModeUnsupportedMessage=function(e,t,r){return r?.mode===t?`${e} do not support ${t} elevation mode`:null},e.featureExpressionInfoIsZero=l,e.featureExpressionUnsupportedMessage=function(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null},e.getConvertedElevation=function(e,t,r,i=null){return u(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,r,i)},e.getConvertedElevationFromVector=function(e,t,r,i,o=null){return u(e,t[0],t[1],t.length>2?t[2]:0,r,i,o)},e.getConvertedElevationFromXYZ=u,e.getEffectiveElevationInfo=n,e.getEffectiveElevationMode=o,e.getElevationOffset=d,e.getElevationOffsetInMeters=y,e.getGeometryEffectiveElevationInfo=function(e,t){return n(null==e||(e.hasZ??!1),t)},e.getGeometryEffectiveElevationMode=s,e.getGraphicEffectiveElevationInfo=a,e.getGraphicEffectiveElevationMode=function(e){const t=p(e);return s(e.geometry,t)},e.getZForElevationMode=function(e,t,r){if(!r?.mode)return;const i=e.hasZ?e.z:0,o=d(r,e.spatialReference);switch(r.mode){case"absolute-height":return i-o;case"on-the-ground":return 0;case"relative-to-ground":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"ground")??0)+o);case"relative-to-scene":return i-((t.elevationProvider.getElevation(e.x,e.y,i,e.spatialReference,"scene")??0)+o)}},e.hasEffectiveFeatureExpressionInfo=c,e.hasFeatureExpressionInfo=function(e){return c(e)||l(e)},e.hasGraphicFeatureExpressionInfo=function(e){return c(a(e))},e.logInvalidElevationInfoWarning=function(e,t){t&&e.warn(".elevationInfo=",t)},e.onTheGroundElevationInfo=f,e.zValueInAbsoluteHeightMode=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/sketch/normalizedPoint":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../layers/graphics/dehydratedPoint","../../../support/elevationInfoUtils"],function(e,t,r,i){"use strict";function o(e=0,r=0,i=0){return t.fromValues(e,r,i)}function n(e,t,r,n=o()){return n[0]=e.x,n[1]=e.y,n[2]=e.z??0,null==t||("2d"===t.type?n[2]=0:n[2]=i.getConvertedElevation(t,e,r,i.absoluteHeightElevationInfo)??0),n}const s=r.makeDehydratedPoint(0,0,0,null);e.asVec2=function(e){return e},e.clone=function(e){const[t,r,i]=e;return e.length>3?[t,r,i,e[3]]:[t,r,i]},e.create=function(e,t,r){return o(e,t,r)},e.createWritable=o,e.fromAnyMapPoint=function(e,t,{coordinateHelper:r,elevationInfo:i},o){return e?n(r.vectorToDehydratedPoint(e,s),t,i,o):null},e.fromPoint=n,e.fromValues=function(e,r,i){return t.fromValues(e,r,i)},e.fromVec3=function(e){return e},e.isTarget=function(e){return Boolean(1&((e.length>3?e[3]:void 0)??0))},e.markAsTarget=function(e){return e[3]=1|((e.length>3?e[3]:void 0)??0),e},e.toDehydratedPoint=function(e,t,i){return i?(r.setDehydratedPoint(i,e[0],e[1],e[2],t),i):r.makeDehydratedPoint(e[0],e[1],e[2],t)},e.toElevationAlignedDehydratedPoint=function(e,t,{z:o,m:n},s,a){const{spatialReference:l,elevationInfo:c}=s;let p;if(null==o&&null==n)p=void 0;else if(null==t||"2d"===t.type)p=o??void 0;else{const r=i.absoluteHeightElevationInfo;p=i.getConvertedElevationFromVector(t,e,l,r,c)??0}const[d,u]=e;return a?r.setDehydratedPoint(a,d,u,p,l):a=r.makeDehydratedPoint(d,u,p,l),null!=n&&(a.m=n,a.hasM=!0),a},e.withSelfSnappingZ=function(e,t,r,n,s=o()){const[a,l]=e;return s[0]=a,s[1]=l,e.length>3&&(s[3]=e[3]??0),"3d"!==r?.type?(s[2]=t.value,s):(s[2]=i.getConvertedElevationFromXYZ(r,a,l,t.value,n,t.elevationInfo,i.absoluteHeightElevationInfo)??0,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],function(e){"use strict";e.ImmutableDehydratedPoint=class{constructor(e,t,r,i,o){this.spatialReference=e,this._position=void 0!==o?[t,r,i??0,o??0]:void 0!==i?[t,r,i??0]:[t,r],this._flags=(void 0!==i?1:0)+(void 0!==o?2:0)}get hasZ(){return!(1&~this._flags)}get hasM(){return!(2&~this._flags)}get type(){return"point"}get x(){return this._position[0]}get y(){return this._position[1]}get z(){return this.hasZ?this._position[2]:void 0}get m(){return this.hasM?this._position[3]:void 0}},e.makeDehydratedPoint=function(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}},e.setDehydratedPoint=function(e,t,r,i,o){e.x=t,e.y=r,e.z=i,e.hasZ=null!=i,e.spatialReference=o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/Settings":function(){define(["exports","../../../chunks/tslib.es6","../../../Color","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n){"use strict";let s=class extends i.JSONSupport{constructor(){super(...arguments),this.enabled=!0}};t.__decorate([o.property({type:Boolean})],s.prototype,"enabled",void 0),s=t.__decorate([n.subclass("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],s);let a=class extends i.JSONSupport{constructor(e){super(e),this.lineSnapper=new s,this.parallelLineSnapper=new s,this.rightAngleSnapper=new s,this.rightAngleTriangleSnapper=new s,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new r([255,127,0]),this.orangeTransparent=new r([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};t.__decorate([o.property({type:s,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"lineSnapper",void 0),t.__decorate([o.property({type:s,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"parallelLineSnapper",void 0),t.__decorate([o.property({type:s,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"rightAngleSnapper",void 0),t.__decorate([o.property({type:s,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"rightAngleTriangleSnapper",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],a.prototype,"shortLineThreshold",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],a.prototype,"distance",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"pointThreshold",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"intersectionParallelLineThreshold",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"parallelLineThreshold",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"verticalLineThresholdMeters",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"touchSensitivityMultiplier",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"pointOnLineThreshold",void 0),t.__decorate([o.property({type:r,nonNullable:!0})],a.prototype,"orange",void 0),t.__decorate([o.property({type:r,nonNullable:!0})],a.prototype,"orangeTransparent",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"lineHintWidthReference",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"lineHintWidthTarget",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"lineHintFadedExtensions",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"parallelLineHintWidth",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],a.prototype,"parallelLineHintLength",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],a.prototype,"parallelLineHintOffset",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],a.prototype,"rightAngleHintSize",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],a.prototype,"rightAngleHintOutlineSize",void 0),t.__decorate([o.property({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],a.prototype,"satisfiesConstraintScreenThreshold",void 0),a=t.__decorate([n.subclass("esri.views.interactive.snapping.Settings.Defaults")],a);const l=new a;e.defaults=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/SnappingOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/arrayUtils","../../../core/Collection","../../../core/Logger","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/decorators/subclass","./FeatureSnappingLayerSource","./Settings"],function(e,t,r,i,o,n,s,a,l,c,p){"use strict";function d(e){return"subtype-group"===e.layer.type}function u(e){return"subtype-group"!==e.layer.type}function h(e){return"subtype-sublayer"===e.layer.type}return e.default=class extends r{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new o,this.distance=p.defaults.distance,this.touchSensitivityMultiplier=p.defaults.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(d)&&n.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(h),r=this._get("_effectiveFeatureSources")?.filter(d)??new o;for(const e of t){const t=r.find(t=>t.layer===e.layer.parent);if(t)t.sublayerSources.includes(e)||t.sublayerSources.add(e);else if(e.layer.parent){const t=new c({layer:e.layer.parent});t.sublayerSources.add(e),r.add(t)}}for(const e of r){const r=e.sublayerSources.filter(e=>!t.includes(e));e.sublayerSources.removeMany(r)}r.removeMany(r.filter(e=>0===e.sublayerSources.length));const s=e.filter(u),a=this._get("_effectiveFeatureSources")??new o,{added:l,removed:p}=i.difference(a.toArray(),[...s,...r]);return a.removeMany(p),a.addMany(l),a}},t.__decorate([s.property()],e.default.prototype,"enabled",void 0),t.__decorate([s.property()],e.default.prototype,"enabledToggled",void 0),t.__decorate([s.property()],e.default.prototype,"forceDisabled",void 0),t.__decorate([s.property()],e.default.prototype,"selfEnabled",void 0),t.__decorate([s.property()],e.default.prototype,"featureEnabled",void 0),t.__decorate([s.property()],e.default.prototype,"gridEnabled",void 0),t.__decorate([s.property()],e.default.prototype,"attributeRulesEnabled",void 0),t.__decorate([s.property({type:o.ofType(c)})],e.default.prototype,"featureSources",void 0),t.__decorate([s.property()],e.default.prototype,"distance",void 0),t.__decorate([s.property()],e.default.prototype,"touchSensitivityMultiplier",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"effectiveEnabled",null),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"effectiveGridEnabled",null),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"effectiveSelfEnabled",null),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"effectiveFeatureEnabled",null),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"_effectiveFeatureSources",null),e.default=t.__decorate([l.subclass("esri.views.interactive.snapping.SnappingOptions")],e.default),e.default})},"esri/views/interactive/snapping/FeatureSnappingLayerSource":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Collection","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a,l){"use strict";return e.default=class extends r{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new i}},t.__decorate([o.property({constructOnly:!0})],e.default.prototype,"layer",void 0),t.__decorate([o.property()],e.default.prototype,"enabled",void 0),t.__decorate([o.property()],e.default.prototype,"updating",void 0),t.__decorate([o.property()],e.default.prototype,"availability",void 0),t.__decorate([o.property()],e.default.prototype,"sublayerSources",void 0),e.default=t.__decorate([l.subclass("esri.views.interactive.snapping.FeatureSnappingLayerSource")],e.default),e.default})},"esri/views/interactive/snapping/snappingUtils":function(){define(["exports","../../../core/reactiveUtils","../../../core/SetUtils","../../../core/sql","../../../core/timeUtils","../../../chunks/vec32","../../../layers/graphics/dehydratedPoint","../../../rest/support/Query","../../input/InputManager","../keybindings","../sketch/normalizedPoint","../../../webmap/utils"],function(e,t,r,i,o,n,s,a,l,c,p,d){"use strict";const u=Symbol("grid-placement-graphic");function h(e,t){const r=e.x-t.x,i=e.y-t.y;return r*r+i*i}const y=Symbol("snapping-toggle");e.editEdgeToSnappingEdge=function(e,t,r){return{left:p.fromAnyMapPoint(e.leftVertex.pos,t,r),right:p.fromAnyMapPoint(e.rightVertex.pos,t,r)}},e.gridPlacementGraphicSymbol=u,e.isUtilityNetworkWebMap=function(e){return d.isWebMap(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length},e.makeSnappingQuery=function({parameters:{point:e,distance:t,returnEdge:n,vertexMode:l,coordinateHelper:{spatialReference:c},filter:p},mode:d,returnZ:u,filter:h}){const y=h?.clone()??new a({where:"1=1"});return y.returnZ=u??"3d"===d,p&&(y.geometry=p.geometry,y.distance=p.distance,y.spatialRelationship=p.spatialRelationship,y.where=i.sqlAnd(y.where,p.where),y.timeExtent=o.mergeTimeExtents(y.timeExtent,p.timeExtent),y.objectIds=(m=y.objectIds,f=p.objectIds,m||f?f?m?Array.from(r.intersection(new Set(m),new Set(f))):f:m:null)),{point:s.makeDehydratedPoint(e[0],e[1],e[2],c.toJSON()),mode:d,distance:t,returnEdge:n,vertexMode:l,query:y.toJSON()};var m,f},e.objectEqual=function(e,t){const r=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return r;case 3:return r&&e[2]===t[2];case 4:return r&&e[2]===t[2]&&e[3]===t[3]}return!1},e.screenDistance=function(e,t){return Math.sqrt(h(e,t))},e.setupSnappingToggleHandles=function(e,r=()=>{}){const i=t.watch(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:t,snappingOptions:i})=>{if(e.removeHandles(y),!t||!i)return;const o=l.ViewEventPriorities.TOOL,n=[t.on("key-down",e=>{e.key!==c.snappingKeys.toggle||e.repeat||(i.enabledToggled=!0,r())},o),t.on("key-up",e=>{e.key===c.snappingKeys.toggle&&(i.enabledToggled=!1,r())},o),t.on("pointer-move",e=>{const t=e.native.ctrlKey;i.enabledToggled!==t&&(i.enabledToggled=t,r())},o)];e.addHandles(n,y)},t.syncAndInitial);e.addHandles(i)},e.sortCandidatesInPlace=function(e,t){t.sort((t,r)=>n.squaredDistance(t.targetPoint,e)-n.squaredDistance(r.targetPoint,e))},e.squaredScreenDistance=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webmap/utils":function(){define(["exports","./Version"],function(e,t){"use strict";const r=new t.Version(2,34);e.currentVersion=r,e.isWebMap=function(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webmap/Version":function(){define(["exports","../core/Version"],function(e,t){"use strict";class r extends t.Version{constructor(e,t){super(e,t,"webmap")}}e.Version=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/DrapedEdgeSnappingCandidate":function(){define(["exports","../../sketch/constraints","./FeatureSnappingCandidate","../hints/LineSnappingHint"],function(e,t,r,i){"use strict";class o extends r.FeatureSnappingCandidate{constructor(e){super({...e,isDraped:!0,constraint:new t.DrapedLineConstraint(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new i.LineSnappingHint(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}e.DrapedEdgeSnappingCandidate=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/sketch/constraints":function(){define(["exports","../../../core/arrayUtils","../../../core/mathUtils","../../../core/libs/gl-matrix-2/math/vec2","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../chunks/vec42","../../../core/libs/gl-matrix-2/factories/vec4f64","../../../geometry/support/geodesicConstants","../../../geometry/support/geodesicUtils","../../../geometry/support/plane","../../../chunks/sphere","../../3d/support/mathUtils","./normalizedPoint","../../support/geometry3dUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m){"use strict";class f{intersect(e){return N(this,e)}closestPoints(e){return[this.closestTo(e)]}}class g extends f{constructor(e){super(),this.point=e}equals(e){return this===e||ee(e)&&n.exactEquals(this.point,e.point)}closestTo(){return y.clone(this.point)}}class b extends f{constructor(e,t,r){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:r}}equals(e){return this===e||te(e)&&this.lineLike.type===e.lineLike.type&&n.exactEquals(this.start,e.start)&&n.exactEquals(this.end,e.end)}closestTo(e){const t=y.createWritable();return m.projectPointToLineLike(e,this.lineLike,t),t}}class v extends b{constructor(e,t){super(e,t,1)}}class _ extends b{constructor(e,t){super(e,t,0)}}class w extends f{constructor(e){super(),this.constraints=e}equals(e){return this===e||Y(e)&&t.equals(this.constraints,e.constraints,(e,t)=>e.equals(t))}closestTo(e){let t,r=1/0;for(const i of this.constraints){const o=i.closestTo(e),s=n.squaredDistance(e,o);s<r&&(r=s,t=o)}return y.clone(t??e)}closestPoints(e){return this.constraints.flatMap(t=>t===this?[]:t.closestPoints(e))}}class S extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||oe(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=y.createWritable();return m.projectPointToVerticalCylinder(e,this.center,this.radius,t),t}}class x extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ne(e)&&n.exactEquals(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=y.createWritable();return m.projectPointToVerticalCylinder(e,this.center,this.radius,t),t[2]=this.center[2],t}asCircle(){return new M(y.clone(this.center),this.radius,y.fromValues(0,0,1))}}class M extends f{constructor(e,t,r,i=void 0){super(),this.center=e,this.radius=t,this.normal=r,this.slicePlane=i}equals(e){return this===e||se(e)&&n.exactEquals(this.center,e.center)&&n.exactEquals(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:r}=this;d.projectPoint(this.getPlane(F),e,C);const i=n.sub(C,C,t),o=n.squaredLength(i);if(m.isClose(o,0))return y.clone(e);const s=r/Math.sqrt(o),a=y.createWritable();n.scaleAndAdd(a,t,i,s);const{slicePlane:l}=this;if(l&&!m.isPointInsidePlane(l,a)){const t=W(l,this);return t?.closestTo(e)??y.clone(e)}return a}getPlane(e=d.create()){return d.fromPositionAndNormal(this.center,this.normal,e)}}const C=s.create(),F=d.create();class k extends f{constructor(e){super(),this.z=e}equals(e){return this===e||re(e)&&this.z===e.z}closestTo(e){return y.fromValues(e[0],e[1],this.z)}getPlane(e=d.create()){return n.set(I,0,0,this.z),d.fromPositionAndNormal(I,s.UNIT_Z,e)}}const I=s.create();class T extends f{constructor(e,t,r){super(),this.start=e,this.end=t,this.planeLike={start:y.asVec2(e),end:y.asVec2(t),type:r}}equals(e){return this===e||ie(e)&&this.planeLike.type===e.planeLike.type&&n.exactEquals(this.start,e.start)&&n.exactEquals(this.end,e.end)}closestTo(e){const t=y.createWritable();return m.projectPointToVerticalPlane(e,this.planeLike,t),t}closestEndTo(e){const{start:t,end:r}=this.planeLike;return Math.sign(i.dot(i.subtract(L,r,t),i.subtract(E,y.asVec2(e),t)))>0?this.end:this.start}getPlane(e=d.create()){const t=n.copy(A,this.end);return t[2]+=1,d.fromPoints(this.start,this.end,t,e)}getSlicePlane(e=d.create()){const{start:t,end:r,type:i}=this.planeLike;if(0===i)return;const o=n.set(A,t[0],t[1],0),s=n.set(V,r[0],r[1],0),a=n.subtract(V,s,o);return d.fromPositionAndNormal(o,a,e),e}}const L=o.create(),E=o.create(),A=s.create(),V=s.create();class O extends f{constructor(e,t){super(),this.sphere=u.fromCenterAndRadius(e,t)}equals(e){return this===e||ae(e)&&u.exactEquals(this.sphere,e.sphere)}closestTo(e){const t=y.createWritable();return u.projectPoint(this.sphere,e,t),t}get center(){return u.getCenter(this.sphere)}get radius(){return this.sphere[3]}}class P extends f{constructor(e,t,r){super(),this.start=e,this.end=t,this.getZ=r,this.planeLike={start:y.asVec2(e),end:y.asVec2(t),type:0}}equals(e){return this===e||le(e)&&n.exactEquals(this.start,e.start)&&n.exactEquals(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){const r=y.createWritable();return m.projectPointToVerticalPlane(t,e.planeLike,r),r[2]=e.getZ(r[0],r[1])??ce,r}(this,e)}addIfOnTheGround(e,t){for(const r of t){const t=this.getZ(r[0],r[1])??0;m.isClose(r[2],t)&&(r[2]=t,e.push(r))}}}class U extends f{constructor(e,t,r){super(),this._x=e,this._y=t,this._z=r}equals(e){return this===e||e instanceof U&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,t,r]){return y.create(this._x??e,this._y??t,this._z??r)}}class R extends f{constructor(e,t,r,i,o){super(),this._origin=e,this._spatialReference=t,this._distanceMeters=r,this._z=i,this._directionDegrees=o}equals(e){return this===e||e instanceof R&&i.exactEquals(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,t,r]){return i.set(D,e,t),i.exactEquals(D,this._origin)||this._applyDirectionAndDistance(D),y.create(D[0],D[1],this._z??r)}_applyDirectionAndDistance(e){if(null!=this._directionDegrees&&null!=this._distanceMeters)p.directGeodeticSolver(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(null!=this._directionDegrees)!function(e,t,r,i,o){let{azimuth:n,distance:s}=p.inverseGeodeticSolver(H,t,i,o);n??=0;let a=s*Math.cos((n-r)*c.toRadians);a=Math.max(0,a),p.directGeodeticSolver(e,t,r,a,o)}(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(null!=this._distanceMeters){const{azimuth:t}=p.inverseGeodeticSolver(G,this._origin,e,this._spatialReference);p.directGeodeticSolver(e,this._origin,t??0,this._distanceMeters,this._spatialReference)}}}const D=[0,0],G=new p.InverseGeodeticSolverResult,H=new p.InverseGeodeticSolverResult;function N(e,t){if(Y(e)){const r=[];for(const i of e.constraints){const e=i.intersect(t);e&&r.push(e)}return X(r)}if(Y(t))return N(t,e);if(le(e))return Z(e,t);if(le(t))return Z(t,e);if(ee(e)){const{point:r}=e;if(ee(t))return n.exactEquals(r,t.point)?e:void 0;const i=t.closestTo(r);return n.equals(i,r)?e:void 0}if(te(e)){if(ee(t))return N(t,e);if(te(t))return J(m.intersectLineLikes(e.lineLike,t.lineLike));if(re(t))return j(e,t);if(ie(t))return J(m.intersectVerticalPlaneAndLineLike(t.planeLike,e.lineLike));if(oe(t))return J(m.intersectLineLikeAndVerticalCylinder(e.lineLike,t.center,t.radius));if(se(t))return J(m.intersectLineLikeAndCircle(e.lineLike,t));if(ne(t))return function({lineLike:e},{center:t,radius:r}){const i=t[2];return J(m.intersectLineLikeAndVerticalCylinder(e,t,r).filter(e=>m.isClose(e[2],i)))}(e,t);if(ae(t))return function({lineLike:e},{sphere:t}){return J(u.intersectLine(t,e.start,e.end))}(e,t)}else if(re(e)){if(ee(t)||te(t))return N(t,e);if(re(t))return function(e,t){return m.isClose(e.z,t.z)?e:void 0}(e,t);if(ie(t))return function({z:e},{planeLike:t}){const[r,i]=t.start,[o,n]=t.end,s=y.fromValues(r,i,e),a=y.fromValues(o,n,e);return 0===t.type?new v(s,a):new _(s,a)}(e,t);if(oe(t))return function(e,t){const[r,i]=t.center;return new x(y.fromValues(r,i,e.z),t.radius)}(e,t);if(se(t))return q(e,t);if(ne(t))return r=e,o=t,m.isClose(o.center[2],r.z)?o:void 0;if(ae(t))return function(e,{center:t,radius:r}){const i=Math.abs(t[2]-e.z);if(i>r&&!m.isClose(i,r))return;const o=y.fromValues(t[0],t[1],e.z),n=Math.sqrt(r**2-i**2);return m.isClose(n,0)?void 0:new x(o,n)}(e,t)}else if(ie(e)){if(ee(t)||te(t)||re(t))return N(t,e);if(ie(t))return K(m.intersectVerticalPlanes(e.planeLike,t.planeLike));if(oe(t))return K(m.intersectVerticalPlaneAndVerticalCylinder(e.planeLike,t.center,t.radius));if(se(t))return $(e,t);if(ne(t))return B(e,t);if(ae(t))return z(e,t)}else if(oe(e)){if(ee(t)||te(t)||re(t)||ie(t))return N(t,e);if(oe(t))return K(m.intersectVerticalCylinders(y.asVec2(e.center),e.radius,y.asVec2(t.center),t.radius));if(se(t))return;if(ne(t))return function(e,t){const r=i.squaredDistance(y.asVec2(e.center),y.asVec2(t.center));return m.isClose(r,0)&&m.isClose(e.radius,t.radius)?t:Q(m.intersectVerticalCylinders(y.asVec2(e.center),e.radius,y.asVec2(t.center),t.radius),t.center[2])}(e,t);if(ae(t))return}else if(se(e)){if(ee(t)||te(t)||re(t)||ie(t)||oe(t))return N(t,e);if(se(t))return;if(ne(t))return void t.asCircle();if(ae(t))return}else if(ne(e)){if(ee(t)||te(t)||re(t)||ie(t)||oe(t)||se(t))return N(t,e);if(ne(t))return function(e,t){if(!m.vectorsHaveCloseZ(e.center,t.center))return;const r=i.squaredDistance(y.asVec2(e.center),y.asVec2(t.center));return m.isClose(r,0)&&m.isClose(e.radius,t.radius)?e:Q(m.intersectVerticalCylinders(y.asVec2(e.center),e.radius,y.asVec2(t.center),t.radius),e.center[2])}(t,e);if(ae(t))return}else if(ae(e)){if(ee(t)||te(t)||re(t)||ie(t)||oe(t)||ne(t))return N(t,e);if(ae(t))return}var r,o}const j=(()=>{const e=d.create();return(t,r)=>{const{start:i,end:o}=t;if(m.vectorsHaveCloseZ(i,o)&&m.isClose(i[2],r.z))return t;const n=y.createWritable();return d.intersectLine(r.getPlane(e),i,o,n)?new g(n):void 0}})(),W=(()=>{const e=l.create(),t=s.create(),i=s.create();return(o,l,c)=>{const{normal:p,center:u,radius:f}=l;h.tangentFrame(p,t,i);const b=d.getNormal(o),v=f*n.dot(b,t),_=f*n.dot(b,i);a.set(e,u[0],u[1],u[2],1);const w=a.dot(o,e),S=Math.hypot(v,_),x=m.isClose(S,0);if(m.isClose(d.distance(o,u),0)){if(x)return l;if(m.isClose(f,0))return!c||m.isPointInsidePlane(c,u)?new g(y.clone(u)):void 0;n.cross(t,b,p),n.normalize(t,t);const e=new Array,r=s.clone(u);n.scaleAndAdd(r,r,t,f),c&&!m.isPointInsidePlane(c,r)||e.push(r);const i=s.clone(u);return n.scaleAndAdd(i,i,t,-f),c&&!m.isPointInsidePlane(c,i)||e.push(i),J(e)}if(x)return;const M=-w/S;if(Math.abs(M)>1||m.isClose(M,1))return;const C=Math.atan(v/_),F=r.asinClamped(M)-C,k=Math.PI-F,I=new Array,T=s.create();n.scaleAndAdd(T,u,t,f*Math.cos(F)),n.scaleAndAdd(T,T,i,f*Math.sin(F)),I.push(T);const L=s.create();return n.scaleAndAdd(L,u,t,f*Math.cos(k)),n.scaleAndAdd(L,L,i,f*Math.sin(k)),I.push(L),J(c?m.pointsInsidePlane(c,I):I)}})(),q=(()=>{const e=d.create();return(t,r)=>W(t.getPlane(e),r,r.slicePlane)})(),B=(()=>{const e=d.create();return(t,{center:r,radius:i})=>{const o=m.intersectVerticalPlaneAndVerticalCylinder(t.planeLike,r,i),n=r[2];t.getSlicePlane(e);const s=new Array;for(const[t,r]of o){const i=[t,r,n];m.isPointInsidePlane(e,i)&&s.push(i)}return J(s)}})(),$=(()=>{const e=d.create(),t=d.create();return(r,i)=>W(r.getPlane(e),i,r.getSlicePlane(t))})(),z=(()=>{const e=d.create();return(t,{center:r,radius:i})=>{const o=t.getPlane(e),a=d.signedDistance(o,r),l=Math.abs(a);if(l>i&&!m.isClose(l,i))return;const c=Math.sqrt(i**2-a**2);if(m.isClose(c,0)){const e=y.createWritable();return d.projectPoint(o,r,e),new g(e)}const p=y.createWritable(),u=s.clone(d.getNormal(o));return n.scaleAndAdd(p,r,u,a),new M(p,c,u,t.getSlicePlane())}})();function Z(e,t){const{planeLike:r,getZ:i}=e,o=new Array;if(ee(t))e.addIfOnTheGround(o,m.intersectVerticalPlaneAndPoint(r,t.point));else if(te(t))e.addIfOnTheGround(o,m.intersectVerticalPlaneAndLineLike(r,t.lineLike));else if(oe(t))for(const[e,n]of m.intersectVerticalPlaneAndVerticalCylinder(r,t.center,t.radius)){const t=i(e,n);null!=t&&o.push(s.fromValues(e,n,t))}else if(ie(t)||le(t))for(const[e,n]of m.intersectVerticalPlanes(r,t.planeLike)){const t=i(e,n)??ce;o.push(s.fromValues(e,n,t))}return J(o)}function K(e){return X(e.map(([e,t])=>{const r=y.fromValues(e,t,0),i=y.fromValues(e,t,1);return new v(r,i)}))}function J(e){return X(e.map(e=>e?new g(y.fromVec3(e)):void 0))}function Q(e,t){return J(e.map(([e,r])=>[e,r,t]))}function X(e){if(0!==e.length)return 1===e.length?e[0]??void 0:new w(e.filter(t.isSome))}function Y(e){return e instanceof w}function ee(e){return e instanceof g}function te(e){return e instanceof b}function re(e){return e instanceof k}function ie(e){return e instanceof T}function oe(e){return e instanceof S}function ne(e){return e instanceof x}function se(e){return e instanceof M}function ae(e){return e instanceof O}function le(e){return e instanceof P}const ce=0;e.CircleConstraint=M,e.Constraint=f,e.CoordinateConstraint=U,e.DrapedLineConstraint=P,e.GeodesicConstraint=R,e.HorizontalCircleConstraint=x,e.HorizontalPlaneConstraint=k,e.LineConstraint=v,e.LineLikeConstraint=b,e.PointConstraint=g,e.RayConstraint=_,e.SetConstraint=w,e.SphereConstraint=O,e.VerticalCylinderConstraint=S,e.VerticalHalfPlaneConstraint=class extends T{constructor(e,t){super(e,t,1)}},e.VerticalPlaneConstraint=class extends T{constructor(e,t){super(e,t,0)}},e.VerticalPlaneLikeConstraint=T,e.constraintOrSet=X,e.isPoint=ee,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e}function i(e,t,r){return e[0]=t,e[1]=r,e}function o(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function a(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function l(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function c(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function p(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function d(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function u(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function h(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function y(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function m(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function f(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function g(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function b(e){const t=e[0],r=e[1];return t*t+r*r}function v(e,t){return e[0]=-t[0],e[1]=-t[1],e}function _(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function w(e,t){const r=t[0],i=t[1];let o=r*r+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o),e}function S(e,t){return e[0]*t[0]+e[1]*t[1]}function x(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function M(e,t,r,i){const o=t[0],n=t[1];return e[0]=o+i*(r[0]-o),e[1]=n+i*(r[1]-n),e}function C(e,r=1){const i=2*t.RANDOM()*Math.PI;return e[0]=Math.cos(i)*r,e[1]=Math.sin(i)*r,e}function F(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[2]*o,e[1]=r[1]*i+r[3]*o,e}function k(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[2]*o+r[4],e[1]=r[1]*i+r[3]*o+r[5],e}function I(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[3]*o+r[6],e[1]=r[1]*i+r[4]*o+r[7],e}function T(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[4]*o+r[12],e[1]=r[1]*i+r[5]*o+r[13],e}function L(e,t,r,i){const o=t[0]-r[0],n=t[1]-r[1],s=Math.sin(i),a=Math.cos(i);return e[0]=o*a-n*s+r[0],e[1]=o*s+n*a+r[1],e}function E(e,t){const r=e[0],i=e[1],o=t[0],n=t[1];let s=r*r+i*i;s>0&&(s=1/Math.sqrt(s));let a=o*o+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*o+i*n)*s*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function A(e){return"vec2("+e[0]+", "+e[1]+")"}function V(e,t){return e[0]===t[0]&&e[1]===t[1]}function O(e,r){const i=e[0],o=e[1],n=r[0],s=r[1],a=t.getEpsilon();return Math.abs(i-n)<=a*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(o-s)<=a*Math.max(1,Math.abs(o),Math.abs(s))}function P(e,t,r,i,o){let n=t[0]-r[0],s=t[1]-r[1];const a=(i[0]*n+i[1]*s)*(o-1);return n=i[0]*a,s=i[1]*a,e[0]=t[0]+n,e[1]=t[1]+s,e}const U=g,R=n,D=s,G=a,H=m,N=f,j=b,W=Object.freeze(Object.defineProperty({__proto__:null,add:o,angle:E,ceil:l,copy:r,cross:x,dist:H,distance:m,div:G,divide:a,dot:S,equals:O,exactEquals:V,floor:c,inverse:_,len:U,length:g,lerp:M,max:d,min:p,mul:D,multiply:s,negate:v,normalize:w,projectAndScale:P,random:C,rotate:L,round:u,scale:h,scaleAndAdd:y,set:i,sqrDist:N,sqrLen:j,squaredDistance:f,squaredLength:b,str:A,sub:R,subtract:n,transformMat2:F,transformMat2d:k,transformMat3:I,transformMat4:T},Symbol.toStringTag,{value:"Module"}));e.add=o,e.angle=E,e.ceil=l,e.copy=r,e.cross=x,e.dist=H,e.distance=m,e.div=G,e.divide=a,e.dot=S,e.equals=O,e.exactEquals=V,e.floor=c,e.inverse=_,e.len=U,e.length=g,e.lerp=M,e.max=d,e.min=p,e.mul=D,e.multiply=s,e.negate=v,e.normalize=w,e.projectAndScale=P,e.random=C,e.rotate=L,e.round=u,e.scale=h,e.scaleAndAdd=y,e.set=i,e.sqrDist=N,e.sqrLen=j,e.squaredDistance=f,e.squaredLength=b,e.str=A,e.sub=R,e.subtract=n,e.transformMat2=F,e.transformMat2d=k,e.transformMat3=I,e.transformMat4=T,e.vec2=W,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(e){"use strict";function t(){return[0,0]}function r(e){return[e[0],e[1]]}function i(e,t){return[e,t]}function o(e,t){return[e,t]}function n(e,t=[0,0]){const r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function s(){return[0,0]}function a(){return i(1,1)}function l(){return i(1,0)}function c(){return i(0,1)}const p=[0,0],d=a(),u=l(),h=c(),y=Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:u,UNIT_Y:h,ZEROS:p,clone:r,create:t,freeze:o,fromArray:n,fromValues:i,ones:a,unitX:l,unitY:c,zeros:s},Symbol.toStringTag,{value:"Module"}));e.ONES=d,e.UNIT_X=u,e.UNIT_Y=h,e.ZEROS=p,e.clone=r,e.create=t,e.freeze=o,e.fromArray=n,e.fromValues=i,e.ones=a,e.unitX=l,e.unitY=c,e.vec2f64=y,e.zeros=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/geodesicUtils":function(){define(["exports","../../core/Error","../../core/unitUtils","../../core/accessorSupport/ensureType","../Point","../Polygon","../Polyline","../SpatialReference","./geodesicConstants","./spatialReferenceUtils"],function(e,t,r,i,o,n,s,a,l,c){"use strict";function p(e){if(!e)return null;const t=e.wkid;if(t)return l.spheroids[t];const r=e.wkt2??e.wkt;return r?function(e){const t=l.wktSpheroidRegex.exec(e);if(!t||2!==t.length)return null;const r=t[1].split(",");if(!r||r.length<3)return null;const i=parseFloat(r[1]),o=parseFloat(r[2]);return isNaN(i)||isNaN(o)?null:{a:i,f:0===o?0:1/o}}(r):null}function d(e){const t=p(e);if(function(e){return null!=e&&"b"in e&&"eSq"in e&&"radius"in e}(t))return t;const r=t.a*(1-t.f);return Object.assign(t,{b:r,eSq:1-(r/t.a)**2,radius:(2*t.a+r)/3,densificationRatio:1e4/((2*t.a+r)/3)})}function u(e){return null!=e&&e<0?e+360:e}function h(e,t,r){const{a:i,eSq:o}=d(r),n=Math.sqrt(o),s=Math.sin(t[1]*l.toRadians),a=i*t[0]*l.toRadians;let c;return c=o>0?i*((1-o)*(s/(1-o*(s*s))-1/(2*n)*Math.log((1-n*s)/(1+n*s))))*.5:i*s,e[0]=a,e[1]=c,e}function y(e){return c.isGeographic(e)&&!!p(e)}function m(e,r){if("polyline"!==e.type&&"polygon"!==e.type)throw new t("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:o}=e;if(!y(o))throw new t("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const l="polyline"===e.type?e.paths:e.rings,c=[],p=[0,0],d=new f;for(const e of l){const t=[];c.push(t),t.push([e[0][0],e[0][1]]);let i,n,s=e[0][0],a=e[0][1];for(let l=0;l<e.length-1;l++){if(i=e[l+1][0],n=e[l+1][1],s===i&&a===n)continue;const c=[s,a];b(d,[s,a],[i,n],o);const{azimuth:u,distance:h}=d,y=h/r;if(y>1){for(let e=1;e<=y-1;e++)g(p,c,u,e*r,o),t.push(p.slice());g(p,c,u,(h+Math.floor(y-1)*r)/2,o),t.push(p.slice())}g(p,c,u,h,o),t.push(p.slice()),s=p[0],a=p[1]}}const u=i.ensureClass(a,o);return"polyline"===e.type?new s({paths:c,spatialReference:u}):new n({rings:c,spatialReference:u})}class f{constructor(e=0,t=void 0,r=void 0){this.distance=e,this.azimuth=t,this.reverseAzimuth=r}}function g(e,t,r,i,o){const n=t[0],s=t[1],a=n*l.toRadians,c=s*l.toRadians,p=(r??0)*l.toRadians,{a:u,b:h,f:y}=d(o),m=Math.sin(p),f=Math.cos(p),g=(1-y)*Math.tan(c),b=1/Math.sqrt(1+g*g),v=g*b,_=Math.atan2(g,f),w=b*m,S=w*w,x=1-S,M=x*(u*u-h*h)/(h*h),C=1+M/16384*(4096+M*(M*(320-175*M)-768)),F=M/1024*(256+M*(M*(74-47*M)-128));let k,I,T,L=i/(h*C),E=2*Math.PI;for(;Math.abs(L-E)>1e-12;)T=Math.cos(2*_+L),k=Math.sin(L),I=Math.cos(L),E=L,L=i/(h*C)+F*k*(T+F/4*(I*(2*T*T-1)-F/6*T*(4*k*k-3)*(4*T*T-3)));const A=v*k-b*I*f,V=Math.atan2(v*I+b*k*f,(1-y)*Math.sqrt(S+A*A)),O=y/16*x*(4+y*(4-3*x)),P=Math.atan2(k*m,b*I-v*k*f)-(1-O)*y*w*(L+O*k*(T+O*I*(2*T*T-1)));return e[0]=(a+P)/l.toRadians,e[1]=V/l.toRadians,e}function b(e,t,r,i){const o=t[0]*l.toRadians,n=t[1]*l.toRadians,s=r[0]*l.toRadians,a=r[1]*l.toRadians,{a:c,b:p,f:u,radius:h}=d(i),y=s-o,m=Math.atan((1-u)*Math.tan(n)),f=Math.atan((1-u)*Math.tan(a)),g=Math.sin(m),b=Math.cos(m),v=Math.sin(f),_=Math.cos(f);let w,S,x,M,C,F,k,I,T,L,E=1e3,A=y;do{if(k=Math.sin(A),I=Math.cos(A),x=Math.sqrt(_*k*(_*k)+(b*v-g*_*I)*(b*v-g*_*I)),0===x)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;C=g*v+b*_*I,F=Math.atan2(x,C),T=b*_*k/x,S=1-T*T,M=C-2*g*v/S,isNaN(M)&&(M=0),L=u/16*S*(4+u*(4-3*S)),w=A,A=y+(1-L)*u*T*(F+L*x*(M+L*C*(2*M*M-1)))}while(Math.abs(A-w)>1e-12&&--E>0);if(0===E){const t=h,r=Math.acos(Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos(s-o))*t,i=s-o,c=Math.sin(i)*Math.cos(a),p=Math.cos(n)*Math.sin(a)-Math.sin(n)*Math.cos(a)*Math.cos(i),d=Math.atan2(c,p);return e.azimuth=d/l.toRadians,e.distance=r,e.reverseAzimuth=void 0,e}const V=S*(c*c-p*p)/(p*p),O=V/1024*(256+V*(V*(74-47*V)-128)),P=p*(1+V/16384*(4096+V*(V*(320-175*V)-768)))*(F-O*x*(M+O/4*(C*(2*M*M-1)-O/6*M*(4*x*x-3)*(4*M*M-3)))),U=Math.atan2(_*Math.sin(A),b*v-g*_*Math.cos(A)),R=Math.atan2(b*Math.sin(A),b*v*Math.cos(A)-g*_);return e.azimuth=U/l.toRadians,e.distance=P,e.reverseAzimuth=R/l.toRadians,e}e.InverseGeodeticSolverResult=f,e.directGeodeticSolver=g,e.geodesicAreas=function(e,i="square-meters"){if(e.some(e=>!y(e.spatialReference)))throw new t("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const o=[];for(let t=0;t<e.length;t++){const r=e[t],i=r.spatialReference,{radius:n,densificationRatio:s}=d(i),a=n*s;o.push(m(r,a))}const n=[],s=[0,0],a=[0,0];for(let e=0;e<o.length;e++){const{rings:t,spatialReference:l}=o[e];let c=0;for(let e=0;e<t.length;e++){const r=t[e];h(s,r[0],l),h(a,r[r.length-1],l);let i=a[0]*s[1]-s[0]*a[1];for(let e=0;e<r.length-1;e++)h(s,r[e+1],l),h(a,r[e],l),i+=a[0]*s[1]-s[0]*a[1];c+=i}c=r.convertUnit(c,"square-meters",i),n.push(c/-2)}return n},e.geodesicCompatibleSpatialReference=function(e){return y(e)?e:c.isWebMercator(e)?a.WGS84:null},e.geodesicDensify=m,e.geodesicDistance=function(e,i,o="meters"){if(!e||!i)throw new t("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!e.spatialReference||!i.spatialReference)throw new t("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!c.equals(e.spatialReference,i.spatialReference))throw new t("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");const{spatialReference:n}=e;if(!y(n))throw new t("geodesic-distance:not-supported","input geometry spatial reference is not supported");if(e.x===i.x&&e.y===i.y)return new f(0,0,0);const s=new f;return b(s,[e.x,e.y],[i.x,i.y],n),s.distance=r.convertUnit(s.distance,"meters",o),s.azimuth=u(s.azimuth),s.reverseAzimuth=u(s.reverseAzimuth),s},e.geodesicLengths=function(e,i="meters"){if(!e)throw new t("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some(e=>!y(e.spatialReference)))throw new t("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const o=[];for(let t=0;t<e.length;t++){const n=e[t],{spatialReference:s}=n,a="polyline"===n.type?n.paths:n.rings;let l=0;for(let e=0;e<a.length;e++){const t=a[e];let r=0;for(let e=1;e<t.length;e++){const i=t[e-1][0],o=t[e][0],n=t[e-1][1],a=t[e][1];if(n!==a||i!==o){const e=new f;b(e,[i,n],[o,a],s),r+=e.distance}}l+=r}l=r.convertUnit(l,"meters",i),o.push(l)}return o},e.inverseGeodeticSolver=b,e.isSupported=y,e.pointFromDistance=function(e,r,i){if(!e||null==r||null==i)throw new t("point-from-distance:missing-parameters","one or more input parameters are missing or undefined");if(i<0||i>360)throw new t("point-from-distance:-of-bounds","azimuth is restricted to angles between, and including, 0° to 360° degrees");if(!e.spatialReference)throw new t("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");const{spatialReference:n}=e;if(!y(n))throw new t("geodesic-distance:not-supported","input geometry spatial reference is not supported");const s=[0,0];return g(s,[e.x,e.y],i,r,n),new o({x:s[0],y:s[1],spatialReference:n})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/plane":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../chunks/vec42","./vector","./vectorStacks","../../views/3d/support/mathUtils"],function(e,t,r,i,o,n,s,a){"use strict";function l(e=F){return[e[0],e[1],e[2],e[3]]}const c=o.exactEquals,p=o.equals;function d(e,t){return u(t[0],t[1],t[2],t[3],e)}function u(e,t,r,i,o=l()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o}function h(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],o=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function y(e,t,r,i=l()){const o=r[0]-t[0],n=r[1]-t[1],s=r[2]-t[2],a=e[0]-t[0],c=e[1]-t[1],p=e[2]-t[2],d=n*p-s*c,u=s*a-o*p,h=o*c-n*a,y=d*d+u*u+h*h,m=Math.abs(y-1)>1e-5&&y>1e-12?1/Math.sqrt(y):1;return i[0]=d*m,i[1]=u*m,i[2]=h*m,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function m(e,t,i,o=0,n=Math.floor(i*(1/3)),s=Math.floor(i*(2/3))){if(i<3)return!1;t(g,o);let a=n,l=!1;for(;a<i-1&&!l;)t(b,a),a++,l=!r.exactEquals(g,b);if(!l)return!1;for(a=Math.max(a,s),l=!1;a<i&&!l;)t(v,a),a++,r.subtract(_,g,b),r.normalize(_,_),r.subtract(w,b,v),r.normalize(w,w),l=!r.exactEquals(g,v)&&!r.exactEquals(b,v)&&Math.abs(r.dot(_,w))<f;return l?(y(g,b,v,e),!0):(0!==o||1!==n||2!==s)&&m(e,t,i,0,1,2)}const f=.99619469809,g=i.create(),b=i.create(),v=i.create(),_=i.create(),w=i.create();function S(e,t,i){const o=r.scale(s.sv3d.get(),e,r.dot(e,t));return r.subtract(i,t,o),i}function x(e,t){return r.dot(e,t)+e[3]}function M(e){return 0===e||1===e}function C(e,i,o,n,s){const a=r.dot(e,o),l=x(e,i);if(0===a)return l>=0?2:3;let c=-l/a;return 1&n&&(c=t.clamp(c,0,1)),!(4&n)&&c<0||!(8&n)&&c>1?l>=0?2:3:(r.add(s,i,r.scale(s,o,c)),l>=0?0:1)}const F=[0,0,1,0];e.clip=function(e,t){const i=r.dot(e,t.ray.direction),o=-x(e,t.ray.origin);if(o<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return o>0;if((o<0||i<0)&&!(o<0&&i<0))return!0;const n=o/i;return i>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1},e.clipInfinite=function(e,t){const i=r.dot(e,t.ray.direction),o=-x(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return o>0;const n=o/i;return i>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1},e.copy=d,e.create=l,e.distance=function(e,t){return Math.abs(x(e,t))},e.equals=p,e.exactEquals=c,e.fromArray=function(e,t,i=!0){const o=t.length/3;return m(e,(e,i)=>r.set(e,t[3*i+0],t[3*i+1],t[3*i+2]),i?o-1:o)},e.fromManyPoints=m,e.fromNormalAndOffset=function(e,t,i){return r.copy(i,e),i[3]=t,i},e.fromPoints=y,e.fromPositionAndNormal=h,e.fromValues=u,e.fromVectorsAndPoint=function(e,t,i,o){return r.cross(v,t,e),h(i,v,o)},e.getNormal=function(e){return e},e.intersectLine=function(e,t,i,o){return M(C(e,t,r.subtract(s.sv3d.get(),i,t),12,o))},e.intersectLineOrRay=C,e.intersectLineSegment=function(e,t,r){return M(C(e,t.origin,t.vector,0,r))},e.intersectLineSegmentClamp=function(e,t,r){return M(C(e,t.origin,t.vector,1,r))},e.intersectRay=function(e,t,r){return null!=t&&M(C(e,t.origin,t.direction,8,r))},e.isPointInside=function(e,t){return x(e,t)>=0},e.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.projectPoint=function(e,t,i){const o=r.scale(s.sv3d.get(),e,-e[3]),n=S(e,r.subtract(s.sv3d.get(),t,o),s.sv3d.get());return r.add(i,n,o),i},e.projectPointLocal=function(e,t,i,o){const l=e,c=s.sv3d.get(),p=s.sv3d.get();a.tangentFrame(l,c,p);const d=r.subtract(s.sv3d.get(),i,t),u=n.projectPointSignedLength(c,d),h=n.projectPointSignedLength(p,d),y=n.projectPointSignedLength(l,d);return r.set(o,u,h,y)},e.projectVector=S,e.setOffsetFromPoint=function(e,t,i){return t!==e&&d(e,t),e[3]=-r.dot(e,i),e},e.signedDistance=x,e.up=F,e.wrap=function(e=F[0],t=F[1],r=F[2],i=F[3]){return u(e,t,r,i,s.sv4d.get())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,r,i){"use strict";const o=i.create(),n=i.create();e.angle=function(e,i){const o=r.dot(e,i)/(r.length(e)*r.length(i));return-t.acosClamped(o)},e.angleAroundAxis=function(e,i,s){r.normalize(o,e),r.normalize(n,i);const a=r.dot(o,n),l=t.acosClamped(a),c=r.cross(o,o,n);return r.dot(c,s)<0?2*Math.PI-l:l},e.projectPoint=function(e,t,i){const o=r.dot(e,t)/r.dot(e,e);return r.scale(i,e,o)},e.projectPointSignedLength=function(e,t){return r.dot(e,t)/r.length(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(e,t){"use strict";const r=t.VectorStack.createVec2f64(),i=t.VectorStack.createVec3f64(),o=t.VectorStack.createVec4f64(),n=t.VectorStack.createMat3f64(),s=t.VectorStack.createMat4f64(),a=t.VectorStack.createQuatf64();e.sm3d=n,e.sm4d=s,e.sq4d=a,e.sv2d=r,e.sv3d=i,e.sv4d=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define(["exports","./has","./nextTick","./libs/gl-matrix-2/factories/mat3f64","./libs/gl-matrix-2/factories/mat4f64","./libs/gl-matrix-2/factories/quatf64","./libs/gl-matrix-2/factories/vec2f64","./libs/gl-matrix-2/factories/vec3f64","./libs/gl-matrix-2/factories/vec4f64"],function(e,t,r,i,o,n,s,a,l){"use strict";class c{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&r.nextTick(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new c(s.create)}static createVec3f64(){return new c(a.create)}static createVec4f64(){return new c(l.create)}static createMat3f64(){return new c(i.create)}static createMat4f64(){return new c(o.create)}static createQuatf64(){return new c(n.create)}get test(){}}e.VectorStack=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,r,i){"use strict";const o=i.create(),n=i.create(),s=i.create(),a=i.create(),l=i.create();e.angle=function(e,i,o){e=r.normalize(a,e),i=r.normalize(l,i);const n=t.acosClamped(r.dot(e,i));if(o){const t=r.cross(s,e,i);if(r.dot(t,o)<0)return-n}return n},e.bilerp=function(e,t,r,i,o,n){const s=e+(t-e)*o;return s+(r+(i-r)*o-s)*n},e.cosCapped=function(e,t){return e>t?Math.cos(t):Math.cos(e)},e.fovx2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/t)},e.fovy2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/r)},e.makeOrthonormal=function(e,t,i){i=i||e;const o=r.dot(e,t);r.set(i,e[0]-o*t[0],e[1]-o*t[1],e[2]-o*t[2]),r.normalize(i,i)},e.makePiecewiseLinearFunction=function(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const o=e[i-1][0],n=e[i][0],s=(n-r)/(n-o);return s*e[i-1][1]+(1-s)*e[i][1]}},e.maxScale=function(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},e.midpoint3d=function(e,t){if(r.set(t,0,0,0),e.length>0){for(let i=0;i<e.length;++i)r.add(t,t,e[i]);r.scale(t,t,1/e.length)}},e.planeFromPoints=function(e,t,i,s){r.subtract(o,t,e),r.subtract(n,i,e),r.cross(s,o,n),r.normalize(s,s),s[3]=-r.dot(e,s)},e.scaleFromMatrix=function(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),o=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),n=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return r.set(e,i,o,n),e},e.slerp=function(e,t,o,n=i.create()){const s=r.length(e),c=r.length(t),p=r.dot(e,t)/(s*c);if(p<.9999999999999999){const i=Math.acos(p),d=((1-o)*s+o*c)/Math.sin(i),u=d/s*Math.sin((1-o)*i),h=d/c*Math.sin(o*i);return r.scale(a,e,u),r.scale(l,t,h),r.add(n,a,l)}return r.lerp(n,e,t,o)},e.slerpTangent=function(e,t,o,n=i.create(),s=i.create()){const c=r.length(e),p=r.length(t),d=r.dot(e,t)/(c*p);if(d<.9999999999999999){const i=Math.acos(d),u=Math.sin(i),h=Math.sin(o*i),y=Math.sin((1-o)*i),m=(1-o)*c+o*p;{const i=m/u,o=i/c*y,s=i/p*h;r.scale(a,e,o),r.scale(l,t,s),r.add(n,a,l)}{const n=1/c*(-Math.cos((1-o)*i)*i*m+y*(-c+p));r.scale(a,e,n);const d=1/p*(Math.cos(o*i)*i*m+h*(-c+p));r.scale(l,t,d),r.add(s,a,l),r.scale(s,s,1/u)}return s}return r.lerp(n,e,t,o),r.subtract(s,t,e),r.normalize(s,s),s},e.tangentFrame=function(e,t,i){Math.abs(e[0])>Math.abs(e[1])?r.set(t,0,1,0):r.set(t,1,0,0),r.cross(i,e,t),r.cross(t,i,e),r.normalize(i,i),r.normalize(t,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/sphere":function(){define(["exports","../core/has","../core/Logger","../core/mathUtils","../core/libs/gl-matrix-2/math/mat4","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","./vec42","../core/libs/gl-matrix-2/factories/vec4f64","../core/libs/gl-matrix-2/math/common","../geometry/support/ray","../geometry/support/sphereUtils","../geometry/support/vector","../geometry/support/vectorStacks"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h){"use strict";const y=m();function m(){return l.create()}const f=a.equals,g=a.equals;function b(e,t){return a.copy(t,e)}function v(e,t){return l.fromValues(e[0],e[1],e[2],t)}function _(e){return e}function w(e){e[0]=e[1]=e[2]=e[3]=0}function S(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function x(e){return e[3]}function M(e){return e}function C(e,t,r,i){return l.fromValues(e,t,r,i)}function F(e,t,r){return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=e[3]+t,r}function k(e,t,r){return e!==r&&b(e,r),r}function I(e,t){return t}function T(e,t,r){if(null==t)return!1;if(!A(e,t,E))return!1;let{t0:i,t1:o}=E;if((i<0||o<i&&o>0)&&(i=o),i<0)return!1;if(r){const{origin:e,direction:o}=t;r[0]=e[0]+o[0]*i,r[1]=e[1]+o[1]*i,r[2]=e[2]+o[2]*i}return!0}function L(e,t,r){const i=p.fromPoints(t,r);if(!A(e,i,E))return[];const{origin:o,direction:a}=i,{t0:l,t1:d}=E,u=t=>{const r=s.create();return n.scaleAndAdd(r,o,a,t),G(e,r,r)};return Math.abs(l-d)<c.getEpsilon()?[u(l)]:[u(l),u(d)]}const E={t0:0,t1:0};function A(e,t,r){const{origin:i,direction:o}=t,n=V;n[0]=i[0]-e[0],n[1]=i[1]-e[1],n[2]=i[2]-e[2];const s=o[0]*o[0]+o[1]*o[1]+o[2]*o[2];if(0===s)return!1;const a=2*(o[0]*n[0]+o[1]*n[1]+o[2]*n[2]),l=a*a-4*s*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);return r.t0=(-a-c)/(2*s),r.t1=(-a+c)/(2*s),!0}const V=s.create();function O(e,t){return T(e,t,null)}function P(e,t,r){if(T(e,t,r))return r;const i=U(e,t,h.sv3d.get());return n.add(r,t.origin,n.scale(h.sv3d.get(),t.direction,n.distance(t.origin,i)/n.length(t.direction))),r}function U(e,t,r){const i=h.sv3d.get(),s=h.sm4d.get();n.cross(i,t.origin,t.direction);const a=x(e);n.cross(r,i,t.origin),n.scale(r,r,1/n.length(r)*a);const l=N(e,t.origin),c=u.angle(t.origin,r);return o.fromRotation(s,c+l,i),n.transformMat4(r,r,s),r}function R(e,t,r,i){const o=x(e),n=o*o,s=t+.5*Math.PI,a=r*r+n-2*Math.cos(s)*r*o,l=Math.sqrt(a),c=a-n;if(c<=0)return.5;const p=Math.sqrt(c),d=Math.acos(p/l)-Math.asin(o/(l/Math.sin(s)));return Math.min(1,(d+.5*i)/i)}function D(e,t,r){return T(e,t,r)?r:(p.closestPoint(t,e,r),G(e,r,r))}function G(e,t,r){const i=n.subtract(h.sv3d.get(),t,e),o=n.scale(h.sv3d.get(),i,e[3]/n.length(i));return n.add(r,o,e)}function H(e,t){const r=n.subtract(h.sv3d.get(),t,e),i=n.squaredLength(r),o=e[3]*e[3];return Math.sqrt(Math.abs(i-o))}function N(e,t){const r=n.subtract(h.sv3d.get(),t,e),o=n.length(r),s=x(e),a=s+Math.abs(s-o);return i.acosClamped(s/a)}const j=s.create();function W(e,t,r,i){const o=n.subtract(j,t,e);switch(r){case 0:{const e=d.cartesianToSpherical(o,j)[2];return n.set(i,-Math.sin(e),Math.cos(e),0)}case 1:{const e=d.cartesianToSpherical(o,j),t=e[1],r=e[2],s=Math.sin(t);return n.set(i,-s*Math.cos(r),-s*Math.sin(r),Math.cos(t))}case 2:return n.normalize(i,o);default:return}}function q(e,t){const r=n.subtract(Z,t,e);return n.length(r)-e[3]}function B(e,t,r,i){const o=q(e,t),s=W(e,t,2,Z),a=n.scale(Z,s,r-o);return n.add(i,t,a)}function $(e,t){const r=n.squaredDistance(e,t),i=x(e);return r<=i*i}function z(e,t,r=l.create()){const i=n.distance(e,t),o=e[3],s=t[3];return i+s<o?(a.copy(r,e),r):i+o<s?(a.copy(r,t),r):(n.lerp(r,e,t,(i+s-o)/(2*i)),r[3]=(i+o+s)/2,r)}const Z=s.create(),K=m(),J=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:y,altitudeAt:q,angleToSilhouette:N,axisAt:W,cameraFrustumCoverage:R,clear:w,closestPoint:D,closestPointOnSilhouette:U,containsPoint:$,copy:b,create:m,distanceToSilhouette:H,elevate:F,equals:g,exactEquals:f,fromCenterAndRadius:v,fromRadius:S,fromValues:C,getCenter:M,getExtent:I,getRadius:x,intersectLine:L,intersectRay:T,intersectRayClosestSilhouette:P,intersectsRay:O,projectPoint:G,setAltitudeAt:B,setExtent:k,tmpSphere:K,union:z,wrap:_},Symbol.toStringTag,{value:"Module"}));e.NullSphere=y,e.altitudeAt=q,e.angleToSilhouette=N,e.axisAt=W,e.cameraFrustumCoverage=R,e.clear=w,e.closestPoint=D,e.closestPointOnSilhouette=U,e.containsPoint=$,e.copy=b,e.create=m,e.distanceToSilhouette=H,e.elevate=F,e.equals=g,e.exactEquals=f,e.fromCenterAndRadius=v,e.fromRadius=S,e.fromValues=C,e.getCenter=M,e.getExtent=I,e.getRadius=x,e.intersectLine=L,e.intersectRay=T,e.intersectRayClosestSilhouette=P,e.intersectsRay=O,e.projectPoint=G,e.setAltitudeAt=B,e.setExtent=k,e.sphere=J,e.tmpSphere=K,e.union=z,e.wrap=_})},"esri/geometry/support/ray":function(){define(["exports","../../core/arrayUtils","../../core/ObjectStack","../../core/libs/gl-matrix-2/math/mat3","../../core/libs/gl-matrix-2/factories/mat3f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],function(e,t,r,i,o,n,s,a){"use strict";function l(e){return e?c(s.clone(e.origin),s.clone(e.direction)):c(s.create(),s.create())}function c(e,t){return{origin:e,direction:t}}function p(e,t,r=l()){return n.copy(r.origin,e),n.copy(r.direction,t),r}const d=new r.ObjectStack(()=>l()),u=s.create(),h=s.create(),y=s.create(),m=o.create();e.closestPoint=function(e,t,r){const i=n.dot(e.direction,n.subtract(r,t,e.origin));return n.add(r,e.origin,n.scale(r,e.direction,i)),r},e.closestPoints=function(e,t,r,o){const s=e.origin,a=t.origin,l=e.direction,c=t.direction,p=n.dot(n.normalize(h,l),n.normalize(y,c));if(Math.abs(p)>=1)return null;const d=n.cross(h,l,c),f=n.sub(u,a,s),g=i.set(m,l[0],l[1],l[2],-c[0],-c[1],-c[2],d[0],d[1],d[2]),b=i.invert(m,g);if(null==b)return[r,o];const v=n.dot(n.set(h,b[0],b[3],b[6]),f),_=n.dot(n.set(y,b[1],b[4],b[7]),f);return n.add(r,s,n.scale(u,l,v)),n.add(o,a,n.scale(u,c,_)),[r,o]},e.copy=function(e,t=l()){return p(e.origin,e.direction,t)},e.create=l,e.distance2=function(e,t){const r=n.cross(a.sv3d.get(),n.normalize(a.sv3d.get(),e.direction),n.subtract(a.sv3d.get(),t,e.origin));return n.dot(r,r)},e.equals=function(e,r){return t.equals(e.origin,r.origin)&&t.equals(e.direction,r.direction)},e.fromPoints=function(e,t,r=l()){return n.copy(r.origin,e),n.subtract(r.direction,t,e),r},e.fromValues=p,e.wrap=function(e,t){const r=d.get();return r.origin=e,r.direction=t,r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(e,t){"use strict";e.ObjectStack=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&t.nextTick(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,1024));e++)this._items.push(this._allocator())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function o(e,t,r,i,o,n,s,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e[4]=n,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function s(e,t){if(e===t){const r=t[1],i=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function a(e,t){const r=t[0],i=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],p=t[8],d=p*s-a*c,u=-p*n+a*l,h=c*n-s*l;let y=r*d+i*u+o*h;return y?(y=1/y,e[0]=d*y,e[1]=(-p*i+o*c)*y,e[2]=(a*i-o*s)*y,e[3]=u*y,e[4]=(p*r-o*l)*y,e[5]=(-a*r+o*n)*y,e[6]=h*y,e[7]=(-c*r+i*l)*y,e[8]=(s*r-i*n)*y,e):null}function l(e,t){const r=t[0],i=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],p=t[8];return e[0]=s*p-a*c,e[1]=o*c-i*p,e[2]=i*a-o*s,e[3]=a*l-n*p,e[4]=r*p-o*l,e[5]=o*n-r*a,e[6]=n*c-s*l,e[7]=i*l-r*c,e[8]=r*s-i*n,e}function c(e){const t=e[0],r=e[1],i=e[2],o=e[3],n=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-s*l)+r*(-c*o+s*a)+i*(l*o-n*a)}function p(e,t,r){const i=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],p=t[7],d=t[8],u=r[0],h=r[1],y=r[2],m=r[3],f=r[4],g=r[5],b=r[6],v=r[7],_=r[8];return e[0]=u*i+h*s+y*c,e[1]=u*o+h*a+y*p,e[2]=u*n+h*l+y*d,e[3]=m*i+f*s+g*c,e[4]=m*o+f*a+g*p,e[5]=m*n+f*l+g*d,e[6]=b*i+v*s+_*c,e[7]=b*o+v*a+_*p,e[8]=b*n+v*l+_*d,e}function d(e,t,r){const i=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],p=t[7],d=t[8],u=r[0],h=r[1];return e[0]=i,e[1]=o,e[2]=n,e[3]=s,e[4]=a,e[5]=l,e[6]=u*i+h*s+c,e[7]=u*o+h*a+p,e[8]=u*n+h*l+d,e}function u(e,t,r){const i=t[0],o=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],p=t[7],d=t[8],u=Math.sin(r),h=Math.cos(r);return e[0]=h*i+u*s,e[1]=h*o+u*a,e[2]=h*n+u*l,e[3]=h*s-u*i,e[4]=h*a-u*o,e[5]=h*l-u*n,e[6]=c,e[7]=p,e[8]=d,e}function h(e,t,r){const i=r[0],o=r[1],n=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function y(e,t,r){const i=r[0],o=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e}function m(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function f(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function b(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function v(e,t){const r=t[0],i=t[1],o=t[2],n=t[3],s=r+r,a=i+i,l=o+o,c=r*s,p=i*s,d=i*a,u=o*s,h=o*a,y=o*l,m=n*s,f=n*a,g=n*l;return e[0]=1-d-y,e[3]=p-g,e[6]=u+f,e[1]=p+g,e[4]=1-c-y,e[7]=h-m,e[2]=u-f,e[5]=h+m,e[8]=1-c-d,e}function _(e,t){const r=t[0],i=t[1],o=t[2],n=t[4],s=t[5],a=t[6],l=t[8],c=t[9],p=t[10],d=p*s-a*c,u=-p*n+a*l,h=c*n-s*l,y=r*d+i*u+o*h;if(!y)return null;const m=1/y;return e[0]=d*m,e[1]=(-p*i+o*c)*m,e[2]=(a*i-o*s)*m,e[3]=u*m,e[4]=(p*r-o*l)*m,e[5]=(-a*r+o*n)*m,e[6]=h*m,e[7]=(-c*r+i*l)*m,e[8]=(s*r-i*n)*m,e}function w(e,t){const r=t[0],i=t[1],o=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],p=t[8],d=t[9],u=t[10],h=t[11],y=t[12],m=t[13],f=t[14],g=t[15],b=r*a-i*s,v=r*l-o*s,_=r*c-n*s,w=i*l-o*a,S=i*c-n*a,x=o*c-n*l,M=p*m-d*y,C=p*f-u*y,F=p*g-h*y,k=d*f-u*m,I=d*g-h*m,T=u*g-h*f;let L=b*T-v*I+_*k+w*F-S*C+x*M;return L?(L=1/L,e[0]=(a*T-l*I+c*k)*L,e[1]=(l*F-s*T-c*C)*L,e[2]=(s*I-a*F+c*M)*L,e[3]=(o*I-i*T-n*k)*L,e[4]=(r*T-o*F+n*C)*L,e[5]=(i*F-r*I-n*M)*L,e[6]=(m*x-f*S+g*w)*L,e[7]=(f*_-y*x-g*v)*L,e[8]=(y*S-m*_+g*b)*L,e):null}function S(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function x(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function M(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function C(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function F(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function k(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function I(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function T(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function L(e,r){const i=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],c=e[6],p=e[7],d=e[8],u=r[0],h=r[1],y=r[2],m=r[3],f=r[4],g=r[5],b=r[6],v=r[7],_=r[8],w=t.getEpsilon();return Math.abs(i-u)<=w*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(o-h)<=w*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(n-y)<=w*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-m)<=w*Math.max(1,Math.abs(s),Math.abs(m))&&Math.abs(a-f)<=w*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-g)<=w*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-b)<=w*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(p-v)<=w*Math.max(1,Math.abs(p),Math.abs(v))&&Math.abs(d-_)<=w*Math.max(1,Math.abs(d),Math.abs(_))}function E(e){const r=t.getEpsilon(),i=e[0],o=e[1],n=e[2],s=e[3],a=e[4],l=e[5],c=e[6],p=e[7],d=e[8];return Math.abs(1-(i*i+s*s+c*c))<=r&&Math.abs(1-(o*o+a*a+p*p))<=r&&Math.abs(1-(n*n+l*l+d*d))<=r}const A=p,V=F,O=Object.freeze(Object.defineProperty({__proto__:null,add:C,adjoint:l,copy:i,determinant:c,equals:L,exactEquals:T,frob:M,fromMat2d:b,fromMat4:r,fromQuat:v,fromRotation:f,fromScaling:g,fromTranslation:m,identity:n,invert:a,isOrthoNormal:E,mul:A,multiply:p,multiplyScalar:k,multiplyScalarAndAdd:I,normalFromMat4:w,normalFromMat4Legacy:_,projection:S,rotate:u,scale:h,scaleByVec2:y,set:o,str:x,sub:V,subtract:F,translate:d,transpose:s},Symbol.toStringTag,{value:"Module"}));e.add=C,e.adjoint=l,e.copy=i,e.determinant=c,e.equals=L,e.exactEquals=T,e.frob=M,e.fromMat2d=b,e.fromMat4=r,e.fromQuat=v,e.fromRotation=f,e.fromScaling=g,e.fromTranslation=m,e.identity=n,e.invert=a,e.isOrthoNormal=E,e.mat3=O,e.mul=A,e.multiply=p,e.multiplyScalar=k,e.multiplyScalarAndAdd=I,e.normalFromMat4=w,e.normalFromMat4Legacy=_,e.projection=S,e.rotate=u,e.scale=h,e.scaleByVec2=y,e.set=o,e.str=x,e.sub=V,e.subtract=F,e.translate=d,e.transpose=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/sphereUtils":function(){define(["exports","../../core/mathUtils","../../chunks/vec32"],function(e,t,r){"use strict";e.cartesianToSpherical=function(e,i){const o=r.length(e),n=t.asinClamped(e[2]/o),s=Math.atan2(e[1]/o,e[0]/o);return r.set(i,o,n,s),i},e.sphericalToCartesian=function(e,t){const i=e[0],o=e[1],n=e[2],s=Math.cos(o);r.set(t,i*s*Math.cos(n),i*s*Math.sin(n),i*Math.sin(o))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geometry3dUtils":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../core/libs/gl-matrix-2/math/common","../../geometry/support/plane","../3d/support/mathUtils","./geometry2dUtils"],function(e,t,r,i,o,n,s,a,l,c){"use strict";function p(e,{start:t,end:r,type:i},s=n.create()){const a=o.sub(w,e,t),l=o.sub(S,r,t),c=o.dot(a,l)/o.dot(l,l);return o.scaleAndAdd(s,t,l,0===i?Math.max(c,0):c)}function d({start:e,end:t,type:r},i){const n=o.sub(w,i,e),a=o.sub(S,t,e);if(0===r&&o.dot(a,n)<-s.getEpsilon())return o.distance(e,i);const l=o.cross(x,a,n);return o.len(l)/o.len(a)}const u=(()=>{const e=n.create(),t=n.create(),s=n.create();return({start:p,end:d},{center:u,radius:h,normal:y,slicePlane:m})=>{const b=a.fromPositionAndNormal(u,y,I);if(f(a.distance(b,p),0)&&f(a.distance(b,d),0)){l.tangentFrame(y,e,t);const a=(i,n)=>(o.subtract(s,n,u),r.set(i,o.dot(s,e),o.dot(s,t)),i),f=c.intersectLineLikeAndCircle({start:a(v,p),end:a(_,d),type:1},i.ZEROS,h),b=[];for(const[r,i]of f){const s=o.copy(n.create(),u);o.scaleAndAdd(s,s,e,r),o.scaleAndAdd(s,s,t,i),m&&!g(m,s)||b.push(s)}return b}const w=n.create();return a.intersectLine(b,p,d,w)?!f(o.distance(w,u),h)||m&&!g(m,w)?[]:[w]:[]}})();function h(e,t){const r=e.start,i=e.end,a=t.start,l=t.end,c=o.sub(w,i,r),p=o.sub(S,l,a),d=o.sub(x,a,r),u=o.cross(M,c,p);if(!f(o.dot(d,u),0))return[];const h=o.sqrLen(u);if(f(h,0))return[];const y=o.cross(C,d,p),m=o.dot(y,u)/h,g=o.scaleAndAdd(F,r,c,m);if(0===e.type){const e=o.sub(k,g,r);if(o.dot(c,e)<-s.getEpsilon())return[]}if(0===t.type){const e=o.sub(k,g,a);if(o.dot(p,e)<-s.getEpsilon())return[]}return[n.clone(g)]}function y({start:e,end:t,type:r},i){const a=o.sub(w,i,e),l=o.sub(S,t,e),c=o.cross(x,l,a),p=o.sqrLen(c)/o.sqrLen(l),d=s.getEpsilon();if(p<d)switch(r){case 1:return[n.clone(i)];case 0:return o.dot(l,a)<-d?[]:[n.clone(i)]}return[]}function m(e,t,{start:r,end:i,type:n}){return o.set(e.start,r[0],r[1],t),o.set(e.end,i[0],i[1],t),e.type=b[n],e}function f(e,r){return t.floatEqualAbsolute(Math.abs(e-r),0,s.getEpsilon())}function g(e,t){return a.isPointInside(e,t)}const b={0:1,1:0},v=i.create(),_=i.create(),w=n.create(),S=n.create(),x=n.create(),M=n.create(),C=n.create(),F=n.create(),k=n.create(),I=a.create(),T={start:n.create(),end:n.create(),type:1},L={start:n.create(),end:n.create(),type:1};e.intersectLineAndPoint=y,e.intersectLineLikeAndCircle=u,e.intersectLineLikeAndVerticalCylinder=function({start:e,end:t,type:i},s,a){const l=[],c=o.subtract(w,t,e),p=r.subtract(_,e,s),d=r.squaredLength(c),u=2*r.dot(c,p),h=u*u-4*d*(r.squaredLength(p)-a*a);if(0===h){const t=-u/(2*d);(1===i||t>=0)&&l.push(o.scaleAndAdd(n.create(),e,c,t))}else if(h>0){const t=Math.sqrt(h),r=(-u+t)/(2*d);(1===i||r>=0)&&l.push(o.scaleAndAdd(n.create(),e,c,r));const s=(-u-t)/(2*d);(1===i||s>=0)&&l.push(o.scaleAndAdd(n.create(),e,c,s))}return l},e.intersectLineLikes=h,e.intersectVerticalCylinderAndPoint=function(e,t,i){return f(r.squaredDistance(i,e),t*t)?[n.clone(i)]:[]},e.intersectVerticalCylinders=function(e,t,o,n){const[s,a]=e,[l,c]=o,p=l-s,d=c-a,u=p*p+d*d,h=Math.sqrt(u);if(h>t+n)return[];if(h<Math.abs(t-n))return[];if(f(h,0)&&f(t,n))return[];const y=(t*t-n*n+u)/(2*h),m=Math.sqrt(t*t-y*y),g=m*d/h,b=m*p/h,[_,w]=r.lerp(v,e,o,y/h);return f(g,b)?[i.fromValues(_,w)]:[i.fromValues(_+g,w-b),i.fromValues(_-g,w+b)]},e.intersectVerticalPlaneAndLineLike=function(e,t){const i=e.start,a=e.end,l=r.subtract(v,a,i),c=o.set(S,-l[1],l[0],0),p=t.start,d=t.end,u=o.sub(x,d,p),h=o.dot(u,c),y=o.set(M,i[0],i[1],0),m=o.sub(C,y,p),f=o.dot(m,c),g=s.getEpsilon();if(Math.abs(h)<g)return Math.abs(f),[];const b=f/h,w=o.scaleAndAdd(F,p,u,b);if(0===t.type){const e=o.sub(k,w,p);if(o.dot(e,u)<-g)return[]}if(1===e.type){const e=r.sub(_,w,i);if(r.dot(e,l)<-g)return[]}return[n.clone(w)]},e.intersectVerticalPlaneAndPoint=function(e,t){return y(m(T,t[2],e),t)},e.intersectVerticalPlaneAndVerticalCylinder=function({start:e,end:t,type:o},n,s){const a=[],l=r.subtract(v,t,e),c=r.subtract(_,e,n),p=r.squaredLength(l),d=2*r.dot(l,c),u=d*d-4*p*(r.squaredLength(c)-s*s);if(0===u){const t=-d/(2*p);(0===o||t>=0)&&a.push(r.scaleAndAdd(i.create(),e,l,t))}else if(u>0){const t=Math.sqrt(u),n=(-d+t)/(2*p);(0===o||n>=0)&&a.push(r.scaleAndAdd(i.create(),e,l,n));const s=(-d-t)/(2*p);(0===o||s>=0)&&a.push(r.scaleAndAdd(i.create(),e,l,s))}return a},e.intersectVerticalPlanes=function(e,t){return h(m(T,0,e),m(L,0,t)).map(([e,t])=>i.fromValues(e,t))},e.isClose=f,e.isPointInsidePlane=g,e.pointToLineLikeDistance=d,e.pointToVerticalCylinderDistance=function(e,t,i){return r.distance(e,t)-i},e.pointToVerticalPlaneDistance=function(e,t){return d(m(T,e[2],t),e)},e.pointsInsidePlane=function(e,t){return t.filter(t=>g(e,t))},e.projectPointToLineLike=p,e.projectPointToVerticalCylinder=function(e,t,i,o=n.create()){const s=r.subtract(v,e,t),a=r.length(s),l=0===a?1:i/a;return r.scaleAndAdd(o,t,s,l),o[2]=e[2],o},e.projectPointToVerticalPlane=function(e,t,r){return p(e,m(T,e[2],t),r)},e.vectorsHaveCloseZ=function(e,t){return f(e[2],t[2])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geometry2dUtils":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64"],function(e,t,r,i){"use strict";function o(e,t){return e[0]*t[1]-e[1]*t[0]}function n(e,t,i){const o=r.dot(i,t)/r.squaredLength(i);return r.scale(e,i,o)}function s(e,t,i,o,s=i){return r.subtract(l,o,i),r.subtract(p,t,s),n(d,p,l),r.add(e,s,d)}function a(e,t,i,o){r.subtract(l,t,i);const n=o/r.length(l);return r.scaleAndAdd(e,i,l,n)}const l=i.create(),c=i.create(),p=i.create(),d=i.create();e.cross=o,e.intersectCircleAndPoint=function(e,r,o){return a(p,o,e,r),t.floatEqualAbsolute(p[0],o[0])&&t.floatEqualAbsolute(p[1],o[1])?[i.clone(o)]:[]},e.intersectLineAndPoint=function(e,r){return s(p,r,e.start,e.end),t.floatEqualAbsolute(p[0],r[0])&&t.floatEqualAbsolute(p[1],r[1])?[i.clone(r)]:[]},e.intersectLineAndRay=function(e,t){const i=e.start,n=e.end,s=t.start,a=t.end,u=r.subtract(l,n,i),h=r.subtract(c,a,s),y=o(u,h);if(Math.abs(y)<=1e-6)return[];const m=r.subtract(p,i,s),f=o(h,m)/y,g=o(u,m)/y;if(f>=0){if(g>=0||1===t.type)return[r.scaleAndAdd(d,i,u,f)]}else if(1===e.type&&(g>=0||1===t.type))return[r.scaleAndAdd(d,i,u,f)];return[]},e.intersectLineLikeAndCircle=function(e,t,i){const o=[],n=r.subtract(l,e.end,e.start),s=r.subtract(c,e.start,t),a=r.squaredLength(n),u=2*r.dot(n,s),h=u*u-4*a*(r.squaredLength(s)-i*i);if(0===h){const t=-u/(2*a);(1===e.type||t>=0)&&o.push(r.scaleAndAdd(d,e.start,n,t))}else if(h>0){const t=Math.sqrt(h),i=(-u+t)/(2*a);(1===e.type||i>=0)&&o.push(r.scaleAndAdd(d,e.start,n,i));const s=(-u-t)/(2*a);(1===e.type||s>=0)&&o.push(r.scaleAndAdd(p,e.start,n,s))}return o},e.pointToLineDistance=function(e,t,i){const o=(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0]);return Math.abs(o)/r.distance(t,i)},e.projectPoint=n,e.projectPointToCircle=a,e.projectPointToLine=s,e.projectPointToRay=function(e,t,i,o){r.subtract(l,o,i),r.subtract(p,t,i);const n=r.dot(l,p)/r.squaredLength(l);return n>0?r.scaleAndAdd(e,i,l,n):r.copy(e,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/FeatureSnappingCandidate":function(){define(["exports","./SnappingCandidate"],function(e,t){"use strict";class r extends t.SnappingCandidate{constructor({targetPoint:e,objectId:t,constraint:r,isDraped:i}){super(e,r,i,1),this.objectId=t}}e.FeatureSnappingCandidate=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/SnappingCandidate":function(){define(["exports"],function(e){"use strict";e.SnappingCandidate=class{constructor(e,t,r,i){this.targetPoint=e,this.constraint=t,this.isDraped=r,this.domain=i}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/LineSnappingHint":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../chunks/vec32","./SnappingHint"],function(e,t,r,i,o){"use strict";class n extends o.SnappingHint{constructor(e,t,r,i,o=3,n=!0,s=!0){super(i,o),this.type=e,this.lineStart=t,this.lineEnd=r,this.fadeLeft=n,this.fadeRight=s}equals(e){return e instanceof n&&this.type===e.type&&i.exactEquals(this.lineStart,e.lineStart)&&i.exactEquals(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return i.distance(this.lineStart,this.lineEnd)}}e.LineSnappingHint=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/SnappingHint":function(){define(["exports"],function(e){"use strict";e.SnappingHint=class{constructor(e,t){this.isDraped=e,this.domain=t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/EdgeSnappingCandidate":function(){define(["exports","../../sketch/constraints","./FeatureSnappingCandidate","../hints/LineSnappingHint"],function(e,t,r,i){"use strict";class o extends r.FeatureSnappingCandidate{constructor(e){super({...e,constraint:new t.LineConstraint(e.edgeStart,e.edgeEnd)})}get hints(){return[new i.LineSnappingHint(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}e.EdgeSnappingCandidate=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/IntersectionSnappingCandidate":function(){define(["exports","../../sketch/constraints","./SnappingCandidate","../hints/IntersectionSnappingHint"],function(e,t,r,i){"use strict";class o extends r.SnappingCandidate{constructor(e,r,i,o){super(e,new t.PointConstraint(e),o,3),this.first=r,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new i.IntersectionSnappingHint(this.targetPoint,this.isDraped,this.domain)]}}e.IntersectionSnappingCandidate=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/IntersectionSnappingHint":function(){define(["exports","../../../../chunks/vec32","./SnappingHint"],function(e,t,r){"use strict";class i extends r.SnappingHint{constructor(e,t,r=3){super(t,r),this.intersectionPoint=e}equals(e){return e instanceof i&&t.exactEquals(this.intersectionPoint,e.intersectionPoint)}}e.IntersectionSnappingHint=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/LineSnappingCandidate":function(){define(["exports","../../sketch/constraints","./SnappingCandidate","../hints/LineSnappingHint"],function(e,t,r,i){"use strict";class o extends r.SnappingCandidate{constructor({lineStart:e,lineEnd:r,targetPoint:o,isDraped:n}){super(o,new t.VerticalPlaneConstraint(e,r),n,2),this._referenceLineHint=new i.LineSnappingHint(2,e,r,n,this.domain)}get hints(){return[this._referenceLineHint,new i.LineSnappingHint(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}e.LineSnappingCandidate=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/ParallelLineSnappingCandidate":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../sketch/constraints","../../sketch/normalizedPoint","./SnappingCandidate","../hints/LineSnappingHint","../hints/ParallelSnappingHint"],function(e,t,r,i,o,n,s,a){"use strict";class l extends n.SnappingCandidate{constructor({referenceLine:e,lineStart:n,targetPoint:s,isDraped:a}){const l=r.clone(n),{left:c,right:p}=e;t.subtract(l,t.add(l,l,p),c),super(s,new i.VerticalPlaneConstraint(n,o.fromVec3(l)),a,2),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new s.LineSnappingHint(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new a.ParallelSnappingHint(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new s.LineSnappingHint(1,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const r={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{t.exactEquals(e.right,i.edge.left)&&(i.fadeLeft=!1,r.fadeRight=!1),t.exactEquals(e.right,i.edge.right)&&(i.fadeRight=!1,r.fadeRight=!1),t.exactEquals(e.left,i.edge.right)&&(i.fadeRight=!1,r.fadeLeft=!1),t.exactEquals(e.left,i.edge.left)&&(i.fadeLeft=!1,r.fadeLeft=!1)}),this._referenceLines.push(r)}}e.ParallelLineSnappingCandidate=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/ParallelSnappingHint":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../chunks/vec32","./SnappingHint"],function(e,t,r,i,o){"use strict";class n extends o.SnappingHint{constructor(e,t,r,i=3){super(r,i),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof n&&i.exactEquals(this.lineStart,e.lineStart)&&i.exactEquals(this.lineEnd,e.lineEnd)}}e.ParallelSnappingHint=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/RightAngleSnappingCandidate":function(){define(["exports","./SnappingCandidate","../hints/LineSnappingHint","../hints/RightAngleSnappingHint"],function(e,t,r,i){"use strict";class o extends t.SnappingCandidate{constructor({targetPoint:e,constraint:t,previousVertex:r,otherVertex:i,otherVertexType:o,isDraped:n,selfSnappingType:s,objectId:a,domain:l}){super(e,t,n,l??2),this.previousVertex=r,this.otherVertex=i,this.otherVertexType=o,this.selfSnappingType=s??0,this.objectId=a??null}get hints(){const e=this.previousVertex,t=1===this.otherVertexType?this.otherVertex:this.targetPoint,o=1===this.otherVertexType?this.targetPoint:this.otherVertex;return[new r.LineSnappingHint(0,t,o,this.isDraped,this.domain),new r.LineSnappingHint(1,e,t,this.isDraped,this.domain),new i.RightAngleSnappingHint(this.previousVertex,t,o,this.isDraped,this.domain)]}}e.RightAngleSnappingCandidate=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/RightAngleSnappingHint":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../chunks/vec32","./SnappingHint"],function(e,t,r,i,o){"use strict";class n extends o.SnappingHint{constructor(e,t,r,i,o=3){super(i,o),this.previousVertex=e,this.centerVertex=t,this.nextVertex=r}equals(e){return e instanceof n&&i.exactEquals(this.previousVertex,e.previousVertex)&&i.exactEquals(this.centerVertex,e.centerVertex)&&i.exactEquals(this.nextVertex,e.nextVertex)}}e.RightAngleSnappingHint=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/RightAngleTriangleSnappingCandidate":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../sketch/constraints","../../sketch/normalizedPoint","./SnappingCandidate","../hints/LineSnappingHint","../hints/RightAngleSnappingHint"],function(e,t,r,i,o,n,s,a,l){"use strict";class c extends s.SnappingCandidate{constructor({targetPoint:e,point1:s,point2:a,isDraped:l}){super(e,new o.VerticalCylinderConstraint(n.fromVec3(r.lerp(i.create(),s,a,.5)),.5*t.distance(n.asVec2(s),n.asVec2(a))),l,2),this._p1=s,this._p2=a}get hints(){return[new a.LineSnappingHint(1,this.targetPoint,this._p1,this.isDraped,this.domain),new a.LineSnappingHint(1,this.targetPoint,this._p2,this.isDraped,this.domain),new l.RightAngleSnappingHint(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}e.RightAngleTriangleSnappingCandidate=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/support/viewUtils":function(){define(["exports","../../../core/screenUtils","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../layers/graphics/dehydratedPoint","../../3d/interactive/support/viewUtils"],function(e,t,r,i,o){"use strict";const n=i.makeDehydratedPoint(0,0,0,null),s=r.create(),a=t.createScreenPointArray();e.vectorToScreenPoint=function(e,r,i,l){return"2d"===l.type?(n.x=e[0],n.y=e[1],n.spatialReference=r,l.toScreen(n)):(o.vectorToRender(e,r,i,l,s),l.state.camera.projectToScreen(s,a),t.createScreenPoint(a[0],a[1]))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/interactive/support/viewUtils":function(){define(["exports","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/math/vec2","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../support/elevationInfoUtils"],function(e,t,r,i,o,n){"use strict";const s=o.create(),a=t.createRenderScreenPointArray(),l=t.createRenderScreenPointArray();e.renderScreenSpaceTangent=function(e,t,i,o){i.projectToRenderScreen(e,a),i.projectToRenderScreen(t,l),r.subtract(o,l,a),r.normalize(o,o)},e.vectorToRender=function(e,t,r,a,l=o.create()){const c=i.copy(s,e);return c[2]=n.getConvertedElevationFromVector(a,c,t,r)||0,a.renderCoordsHelper.toRenderCoords(c,t,l),l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geodesicLengthMeasurementUtils":function(){define(["exports","../../core/quantityUtils","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/Polyline","../../chunks/geodeticLengthOperator","../../geometry/support/geodesicUtils","../../geometry/support/spatialReferenceUtils","./geodesicMeasurementUtils"],function(e,t,r,i,o,n,s,a){"use strict";function l(e,t,r){return a.geodesicMeasure(r,p,d,e,t,r)}const c={geodesicLength:function(e){const{spatialReference:t}=e;return a.geodesicMeasure(t,u,h,e)},geodesicDistanceBetweenPoints:function(e,t){if(!s.equals(e.spatialReference,t.spatialReference))return null;const{spatialReference:r}=e;return m[0]=e.x,m[1]=e.y,m[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,l(m,f,r)},geodesicDistance:l};function p(e,r,i){return t.createLength(n.inverseGeodeticSolver(y,e,r,i).distance,"meters")}function d(e,r,n){return t.createLength(o.execute(function(e,t,r){return new i({spatialReference:r,paths:[[[...e],[...t]]]})}(e,r,n),{unit:"meters"}),"meters")}function u(e){return t.createLength(n.geodesicLengths([e],"meters")[0],"meters")}function h(e){return t.createLength(o.execute(e,{unit:"meters"}),"meters")}const y=new n.InverseGeodeticSolverResult,m=r.create(),f=r.create();e.loadGeodesicLengthMeasurementUtils=async function(){return await o.load(),c},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/geodeticLengthOperator":function(){define(["require","exports","../core/unitUtils","../geometry/operators/gx/operatorGeodeticLength","../geometry/operators/support/geodeticCurveType"],function(e,t,r,i,o){"use strict";let n,s,a;function l(){return!!n&&i.isLoaded()}async function c(){if(!l()){const[r]=await Promise.all([new Promise((t,r)=>e(["../geometry/operators/support/apiConverter"],t,r)),i.load()]);n=r.fromGeometry,s=r.fromSpatialReference,a=r.getSpatialReference,t.supportsCurves=i.supportsCurves()}}function p(e,t={}){const{curveType:l="geodesic",unit:c}=t,p=a(e);let d=i.execute(n(e),s(p),o.geodeticCurveType[l]);return d&&c&&(d=r.convertUnit(d,"meters",c)),d}t.supportsCurves=void 0;const d=Object.freeze(Object.defineProperty({__proto__:null,execute:p,isLoaded:l,load:c,get supportsCurves(){return t.supportsCurves}},Symbol.toStringTag,{value:"Module"}));t.execute=p,t.geodeticLengthOperator=d,t.isLoaded=l,t.load=c})},"esri/geometry/operators/gx/operatorGeodeticLength":function(){define(["require","exports","../../../chunks/pe"],function(e,t,r){"use strict";let i;function o(){return!!i&&r.isLoaded()}t.execute=function(e,t,r){return i.execute(e,t,r,null)},t.isLoaded=o,t.load=async function(){if(!o()){const[t,o]=await Promise.all([new Promise((t,r)=>e(["../../../chunks/OperatorGeodeticLength"],t,r)),new Promise((t,r)=>e(["../../../chunks/ProjectionTransformation"],t,r)).then(e=>e.SpatialReference).then(({injectPe:e})=>e),r.load()]);i=new t.OperatorGeodeticLength,o(r.pe)}},t.supportsCurves=function(){return i.supportsCurves()},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/operators/support/geodeticCurveType":function(){define(["exports"],function(e){"use strict";e.geodeticCurveType={geodesic:0,loxodrome:1,"great-elliptic":2,"normal-section":3,"shape-preserving":4},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geodesicMeasurementUtils":function(){define(["exports","../../geometry/support/geodesicUtils","../../geometry/support/spatialReferenceUtils"],function(e,t,r){"use strict";e.geodesicDistanceThreshold=1e5,e.geodesicMeasure=function(e,r,i,...o){return t.isSupported(e)?r.apply(void 0,o):e.isWebMercator?i.apply(void 0,o):null},e.supportsGeodesicMeasurement=function(e){return t.isSupported(e)||r.isWebMercator(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/CreateFeaturesWorkflow":function(){define(["require","../../chunks/tslib.es6","../../Graphic","../../core/Error","../../core/handleUtils","../../core/has","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/reactiveUtils","../../core/uuid","../../core/accessorSupport/decorators/property","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../editing/templateUtils","../../layers/GraphicsLayer","../../layers/support/layerUtils","../../support/guards","../../symbols/support/symbolUtils","../../views/draw/support/helpMessageUtils","../../views/draw/support/HighlightHelper","../../views/interactive/sketch/SketchOptions","../../views/interactive/snapping/FeatureSnappingLayerSource","../../views/support/HighlightDefaults","./CreateFeaturesWorkflowData","./modelUploadUtils","./Workflow","./workflowUtils","../FeatureForm/FeatureFormViewModel","../Sketch/SketchViewModel"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F,k,I,T){"use strict";var L;const E=Symbol(),A=Symbol(),V=Symbol(),O=Symbol(),P={point:["point"],multipoint:["multipoint"],polygon:["polygon","freehandPolygon","rectangle","circle"],polyline:["polyline","freehandPolyline"],mesh:[],multipatch:[]};let U=L=class extends F{constructor(e){super(e),this.type="create-features",this.createFeatureState="create-new",this.data=void 0,this.isNested=!1,this._getDrawMeshHelpMessage=void 0,this._webStyleCache=new Map,this._featureFormHandle=null,this._visualVariableAttributes={rotation:null,size:null},this._featureFormViewModel=new I,this._sketchViewModel=null,this._attachmentFileInfos=new Map,this._isActive=!0}initialize(){this.isNested&&(this._isActive=!1),this._initializeSketchViewModel()}destroy(){this._sketchViewModel.destroy()}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){if(this.pendingFeatures.some(e=>!!this.data.getEditsForPendingFeature(e)?.modified))return!0;const{creationInfo:e,upload:t}=this.data,r=this._sketchViewModel,{activeComponent:i}=r,o=r.createGraphic?.geometry?.type;return!("polyline"!==o&&"polygon"!==o&&"multipoint"!==o||"draw-2d"!==i?.type&&"draw-3d"!==i?.type)&&i.drawOperation.committedVertices.length>0||!(!t||"pending"!==t.state&&"success"!==t.state)||!!e?.geometryToPlace}get hasPreviousStep(){return this._stepIndex>0||"update-pending"===this.createFeatureState&&!!this.data.selectedPendingFeature&&!this.parent&&!C.isModelUpload(this.data.creationInfo)}get helpMessage(){const{creationInfo:t,viewModel:r}=this.data;if("creating-features"!==this.stepId||!t)return;const i=t.layer.geometryType,o=this._sketchViewModel.createGraphic;if("mesh"===i){this._getDrawMeshHelpMessage||new Promise((t,r)=>e(["../../views/draw/support/helpMessageUtils3d"],t,r)).then(e=>{this._getDrawMeshHelpMessage=e.getDrawMeshHelpMessage});const{view:t}=r;return"3d"===t?.type?this._getDrawMeshHelpMessage?.(o,t):void 0}const n=this._sketchViewModel.activeCreateToolDrawMode,s=this._sketchViewModel.activeTool,a="rectangle"===s?"rectangle":"circle"===s?"circle":i;return v.getDrawHelpMessage(a,o?.geometry,n)}get layer(){return this.data.creationInfo?.layer}get numPendingFeatures(){return this.pendingFeatures.length}get numPendingFeaturesExcludingHidden(){return this.pendingFeatures.filter(e=>this.data.isDisplayable(e)).length}get parent(){return this.data.parent}get parentLayer(){return this.parent?.data.editorItem.layer}get pendingFeatures(){return this.data.pendingFeatures}get keyboardCancellationEnabled(){return 0===this.numPendingFeatures}get reliesOnOwnerAdminPrivileges(){return this.data.editorItem?.capabilities.create.reliesOnOwnerAdminPrivileges??!1}get shouldShowAttachments(){return(this.data.selectedPendingFeature&&this.data.editorItem?.capabilities.create.attachments.enabled)??!1}get shouldAllowAttachmentEditing(){return this.shouldShowAttachments}get sketchViewModel(){return this._sketchViewModel}get test(){}get availableCreateTools(){const e=this.data.creationInfo?.layer.geometryType,t=this.data.viewModel.view;if(!e)return[];if(this.data.creationInfo?.maxFeatures&&this.data.creationInfo.maxFeatures<=this.numPendingFeatures)return[];if(y.isSharedTemplateOrMetadata(this.data.fullTemplate)){const{tool:t}=k.createToolFromGeometryType(e,this.data.fullTemplate);return[t]}return"2d"!==t?.type&&"multipoint"===e?[]:[...P[e]]}get _attachmentsActive(){const e=this.data.viewModel.attachmentsViewModel.mode,t=this.stepId;return this.shouldShowAttachments&&("add"===e||"edit"===e||"adding-attachment"===t||"editing-attachment"===t)}async enter(){this._isActive=!0,"awaiting-feature-creation-info"!==this.stepId&&await this._updatingHandles.addPromise(this._setUpCreatingFeaturesStep())}exit(){this._isActive=!1,this.removeHandles([V])}async updatePendingFeature(e){if(e!==this.data.selectedPendingFeature)return this._sketchViewModel.cancel(),this._startUpdating({feature:e})}async start(){return await super.start(),f.isTable(this.data.creationInfo?.layer)?null:{enter:async()=>{},exit:async()=>{},viewModel:this._sketchViewModel}}async save(){const{featureFormViewModel:e}=this;if(e.pendingSubtypeChoice)return;e.submit(),this._stashValidationState();const t=this.data.selectedPendingFeature,r=this._hasValidationErrors(t)?t:this.data.pendingFeatures.find(e=>this._hasValidationErrors(e));return r?(await this._startUpdating({feature:r}),void e?.submit()):super.save()}back(e){return"update-pending"!==this.createFeatureState||!this.data.selectedPendingFeature||C.isModelUpload(this.data.creationInfo)||this._attachmentsActive||this.parent?super.back(e):this._clearSelectedFeature()}previous(e){return"update-pending"!==this.createFeatureState||!this.data.selectedPendingFeature||C.isModelUpload(this.data.creationInfo)||this._attachmentsActive?super.previous(e):this._clearSelectedFeature()}cancelFeature(e){this.data.isSharedTemplateWorkflow?s.getLogger(this).warn("Cannot cancel individual features created by shared templates."):(this.data.removePendingFeature(e),this.sketchViewModel.layer.graphics.remove(e))}static create(e){const{addAttachmentsCallback:t,applyEditsCallback:r,applyEditsFeatureServiceCallback:i,isNested:o,creationInfo:n,parent:s,snappingManager:a,startAt:l,viewModel:c}=e,d=e.sketchOptions??new w,u=n?.layer,h=u?c.findEditorItemForLayer(u):void 0,m=new L({data:new M({creationInfo:n,editorItem:h,parent:s,sketchOptions:d,snappingManager:a,viewModel:c}),isNested:o,onCommit:async e=>{const{creationInfo:o}=e;if(!o)return;m._sketchViewModel.cancel();const n=e.pendingFeatures.toArray(),{layer:s}=o,a=s.capabilities?.editing.supportsGlobalId&&"globalIdField"in s,l=m._attachmentFileInfos,{fullTemplate:d}=e,u=k.getServiceEditsFromWorkflowData(m.data),h=y.isSharedTemplate(d)&&u;if(a){if(function(e){for(const t of e){const{sourceLayer:e}=t;e&&"globalIdField"in e&&null!=e.globalIdField&&(t.attributes[e.globalIdField]??=p.generateBracedUUID())}}(n),h){let t=function(e,t){return e.map(e=>{const{addFeatures:r}=e;if(!r||0===r.length)return e;const i=[];for(const e of r){const r=t.get(e);if(r)for(const{file:t}of r)i.push({feature:e,attachment:{globalId:p.generateBracedUUID(),data:t}})}return i.length?{...e,addAttachments:i}:e})}(u,l);const r=await k.getServiceInfoForLayer(s,c.view);r&&(t=k.orderEditsByRelationshipDependencies({edits:t,serviceInfo:r,view:c.view,findOriginalFeature:t=>e.getEditsForPendingFeature(t)?.initialFeature??t})),await i(d.featureService,t,{globalIdUsed:!0,gdbVersion:d.layer.gdbVersion??void 0})}else{const e=function(e,t){const r=[];if(!t||0===t.size)return{addFeatures:e};for(const[e,i]of t)for(const{file:t}of i)r.push({feature:e,attachment:{globalId:p.generateBracedUUID(),data:t}});return r.length?{addFeatures:e,addAttachments:r}:{addFeatures:e}}(n,l);await r(s,e,{globalIdUsed:!0})}return}const f=h?await i(d.featureService,u,{gdbVersion:d.layer.gdbVersion??void 0}):[await r(s,{addFeatures:n})];f&&l.size>0&&await Promise.all(f.map(e=>{if(e?.addFeatureResults)return t(s,function(e,t,r,i){const o=[];return t.forEach((t,n)=>{if(!t.error){const s=e[n],a=i.get(s)||[];s.attributes[r.objectIdField]=t.objectId,a.forEach(({form:e})=>o.push({feature:s,attachment:e}))}}),o}(n,e.addFeatureResults,s,l))}))}});return m._set("steps",this._createWorkflowSteps(m,l)),m}_fadeExistingFeatures(e){if("effect"in e){const t=e.effect;return e.effect="saturate(0.6) opacity(0.8)",o.makeHandle(()=>e.effect=t)}const t=e.opacity;return e.opacity=.7,o.makeHandle(()=>e.opacity=t)}async _initializeFullTemplateAndExecutorInfo(t){const{creationInfo:r}=t,{view:i}=t.viewModel;if(!r||!i)return null;const o=await k.getFullTemplateForCreationInfo(r,i);if(t.fullTemplate=o,o&&y.isSharedTemplate(o)){const{createTemplateExecutor:n}=await new Promise((t,r)=>e(["../../editing/sharedTemplates/executor/createTemplateExecutor"],t,r)),s={completionResults:[],executor:await n(o),serviceLayersById:await k.getServiceLayersById(r.layer,i)};t.templateExecutorInfo=s}return o}async _startCreating(){this.removeHandles(A);const{data:e}=this;if(!e.creationInfo)return;const t=this.data.creationInfo?.maxFeatures;if(t&&this.numPendingFeatures>=t)return this.sketchViewModel.cancel(),void(this.numPendingFeatures&&await this._startUpdating({feature:this.pendingFeatures.at(-1)}));this.createFeatureState="create-new",await k.startCreatingNewFeature(this._sketchViewModel,e,this._webStyleCache)}async _clearSelectedFeature(){const e=this._featureFormViewModel.pendingSubtypeChoice;e&&(e.resolve("undo"),await e.promise),this._stashValidationState(),this.sketchViewModel.cancel(),this.data.selectedPendingFeature=null,this._featureFormHandle=a.removeMaybe(this._featureFormHandle),this._featureFormViewModel.feature=null;const t=this.data.viewModel.attachmentsViewModel;"add"!==t.mode&&"edit"!==t.mode||await(this.data.viewModel.activeWorkflow?.previous())}_stashValidationState(){const e=this._featureFormViewModel.feature,t=e&&this.data.getEditsForPendingFeature(e);t&&(t.submittable=this._featureFormViewModel.submittable)}async _selectFeatureForUpdate({feature:e,initialFeature:t=e}){this._stashValidationState();const{data:r,pendingFeatures:i,_webStyleCache:n}=this;i.includes(e)||r.addPendingFeature(e,t),r.selectedPendingFeature=e;const{_featureFormViewModel:s,_sketchViewModel:l}=this,{creationInfo:p,viewModel:d}=r,{attachmentsViewModel:u,layerInfos:h,view:y}=d;if(!y||!p)return;a.removeMaybe(this._featureFormHandle);const m=e.sourceLayer,f=k.findLayerInfo(h,m),b=f?.formTemplate,v=y.spatialReference;s.set({editType:"INSERT",feature:e,formTemplate:b,spatialReference:v,map:y.map}),"add"!==u.mode&&"edit"!==u.mode||await(d.activeWorkflow?.previous()),u.graphic=e,u.fileInfos.removeAll(),u.mode="view",(this._attachmentFileInfos.get(e)||[]).forEach(({file:e,form:t})=>u.addFile(e,t)),await k.updateGraphicSymbolWhenRequired(e,n,"2d"===y.type?y.scale:null);const _=r.getEditsForPendingFeature(e);this._featureFormHandle=o.handlesGroup([s.on("value-change",async({fieldName:t,value:r})=>{if(_?.updateAttributes(s.getValues()),g.isNumber(r)){const e=this._visualVariableAttributes;e.size&&!e.size.isUpdatingInteractively&&t===e.size.field&&e.size.setInitialValue(r),e.rotation&&!e.rotation.isUpdatingInteractively&&t===e.rotation.field&&e.rotation.setInitialValue(r)}await k.updateGraphicSymbolWhenRequired(e,n,"2d"===y.type?y.scale:null)}),l.on(["update","undo","redo"],e=>{("undo"===e.type||"redo"===e.type||"update"===e.type&&null!=e.toolEventInfo&&k.isTerminalUpdateEventType(e.toolEventInfo.type))&&s.notifyFeatureGeometryChanged()}),c.watch(()=>s.feature?.sourceLayer,t=>e.sourceLayer=t),c.watch(()=>[s.feature,s.submittable],()=>this._stashValidationState())]),this.createFeatureState="update-pending"}async _startUpdating({feature:e,initialFeature:t=e}){await this._selectFeatureForUpdate({feature:e,initialFeature:t});const{_sketchViewModel:r,data:i}=this,{creationInfo:o,viewModel:n}=i,{view:s}=n;if(!s||!o)return;const a=e.sourceLayer??o.layer;return f.isTable(a)?void 0:(this._visualVariableAttributes=k.getVisualVariableAttributes(e),k.startUpdatingFeatureGeometry({graphic:e,sketchViewModel:r,sourceLayer:a,visualVariables:this._visualVariableAttributes,webStyleCache:this._webStyleCache}))}static _createWorkflowSteps(e,t="awaiting-feature-creation-info"){const{data:r}=e,i={"awaiting-feature-creation-info":()=>({id:"awaiting-feature-creation-info",async setUp(){const{creationInfo:t,viewModel:i}=r,{view:o}=i;o&&(C.isModelUpload(t)?e.addHandles(await C.handleModelUpload({view:o,data:r,next:()=>e.next(),cancel:()=>i.cancelWorkflow({warnIfNoWorkflow:!1})}),this.id):(r.parent&&t&&e.addHandles(i.restrictFeatureTemplatesViewModelToLayer(t.layer),this.id),e.addHandles(i.featureTemplatesViewModel.on("select",({item:t})=>{t&&(r.creationInfo={...r.creationInfo,layer:t.layer,template:t.template},e.next())}),this.id)))},async tearDown(){e.removeHandles(this.id)}}),"creating-features":()=>({id:"creating-features",async setUp(){e._isActive&&await e._setUpCreatingFeaturesStep()},async tearDown(t){const{viewModel:i}=r;t.canceled&&(e.removeHandles([V,E,A,O]),i.attachmentsViewModel.fileInfos.removeAll(),e._attachmentFileInfos.clear())}}),"adding-attachment":()=>({id:"adding-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=r.viewModel,{graphic:i,fileInfos:o}=t;e._attachmentFileInfos.set(i,o.toArray()),t.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"creating-features",async setUp(){},async tearDown(){const{attachmentsViewModel:t}=r.viewModel,{graphic:i,fileInfos:o}=t;e._attachmentFileInfos.set(i,o.toArray()),t.mode="view"}})},o=k.createWorkflowSteps(["awaiting-feature-creation-info","creating-features","adding-attachment","editing-attachment"],t,i);return k.avoidFeatureTemplateSelectionWithOnlyOneItem(r,o)}static _configureSketchViewModel(e){const{data:t}=e,r=e._webStyleCache,{creationInfo:i,viewModel:n}=t,{view:s}=n,p=e._sketchViewModel,d=[];if(!s)return o.makeHandle();if("2d"===s.type){i&&d.push(e._fadeExistingFeatures(i.layer));const t=l.debounce((e,t)=>Promise.all(e.map(e=>k.updateGraphicSymbolWhenRequired(e,r,t))));d.push(c.watch(()=>s.scale,e=>t(p.layer.graphics,e)))}const u=k.getCreationAttributes(t.fullTemplate,i?.attributeOverrides),h=c.watch(()=>p.createGraphic,i=>{i&&!e.hasHandles(A)&&e._updatingHandles.addPromise(k.setUpSketchCreateWatchers({creationAttributes:u,data:t,sketchViewModel:p,view:s,webStyleCache:r}).then(t=>e.addHandles(t,A)))});d.push(h,p.on("create",t=>e._updatingHandles.addPromise((async t=>{if("cancel"!==t.state&&"complete"!==t.state||e.removeHandles(A),"cancel"===t.state&&null!==s.activeTool&&s.activeTool!==e.sketchViewModel.activeComponent&&(await e._waitForActiveToolCleared(),await e._startCreating()),"complete"===t.state&&t.graphic){const r=await e._processEdits(t.graphic,{scale:"2d"===s.type?s.scale:null,useSourceLayer:!0,webStyleCache:e._webStyleCache});r&&(await e._waitForActiveToolCleared(),await e._startUpdating({feature:r}))}})(t))),p.on("update",r=>e._updatingHandles.addPromise((async r=>{const{attachmentsViewModel:o}=n,{_featureFormViewModel:a}=e;if(r.graphics.length>1)return void await e._clearSelectedFeature();const l=r.graphics[0];if("complete"===r.state){const{submittable:t}=a;if(e.numPendingFeatures!==i?.maxFeatures&&t||a.submit(),await e._clearSelectedFeature(),"add"!==o.mode&&"edit"!==o.mode||await(n.activeWorkflow?.previous()),!r.aborted&&s.activeTool===e.sketchViewModel.activeComponent&&(await e.sketchViewModel.wait(),"ready"===e.sketchViewModel.state&&"mesh"!==e.data.creationInfo?.layer.geometryType))return e._startCreating()}else{if("start"===r.state)return l.sourceLayer??=t.creationInfo?.layer,await k.setVisualVariablesAndElevationInfoForUpdate({sketchViewModel:p,graphic:l,visualVariables:e._visualVariableAttributes,webStyleCache:e._webStyleCache,sourceLayer:l.sourceLayer}),e._selectFeatureForUpdate({feature:l});if("active"===r.state){await e.updatePendingFeature(l);const t=e._visualVariableAttributes;k.visualVariableInteractiveUpdate(s,l,r,t)&&await k.updateGraphicSymbolWhenRequired(l,e._webStyleCache,"2d"===s.type?s.scale:null);const i=l.attributes,{rotation:o,size:n}=t;if(null!=o){const{field:e}=o;a.setValue(e,i[e])}if(null!=n){const{field:e}=n;a.setValue(e,i[e])}}}})(r))),p.on("delete",r=>e._updatingHandles.addPromise((async r=>{if(r.graphics.forEach(e=>{t.removePendingFeature(e)}),!C.isModelUpload(t.creationInfo))return e._startCreating()})(r))),c.when(()=>!e.numPendingFeatures,()=>e._updatingHandles.addPromise((async()=>{if(C.isModelUpload(t.creationInfo))try{await e.data.viewModel.back()}catch{}return e._startCreating()})())),o.makeHandle(()=>{p.cancel()}),function(e,t){let r=null;const i=()=>e.snappingOptions.featureSources,n=()=>{null!=r&&(i().remove(r),r=a.destroyMaybe(r))};return o.handlesGroup([c.watch(()=>{const e=t.creationInfo?.layer,r=i().find(t=>t.layer===e);return{hasFeatureLayerSource:!!r,enabled:r?.enabled??!1}},({hasFeatureLayerSource:t,enabled:o})=>{if(!t)return n();r??=(r=new S({layer:e.layer}),i().add(r),r),r.enabled=o},c.syncAndInitial),o.makeHandle(n)])}(p,t),...function(e){const t=e.viewModel.view;if(!t)return[];const r=[];if("3d"===t.type){const i=new _({view:t});r.push(c.watch(()=>e.selectedPendingFeature,(e,t)=>{i.remove(e),i.add(t)}),o.makeHandle(()=>i.destroy()))}const i=new _({view:t,highlightName:x.temporaryHighlightName});return r.push(c.watch(()=>e.temporaryHighlightFeature,e=>{i.removeAll(),i.add(e)}),o.makeHandle(()=>i.destroy())),r}(t));const y=o.handlesGroup(d);return p.addHandles(y),y}_initializeSketchViewModel(){const{data:e}=this,{view:t}=e.viewModel,r=new m({elevationInfo:e.creationInfo?.layer.elevationInfo,internal:!0,listMode:"hide",title:"createFeaturesWorkflow-internal"}),i=new T({layer:r,creationMode:"single",sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},view:t});this._sketchViewModel=i,t?.map.add(r),this.addHandles([o.makeHandle(()=>{t?.destroyed||t?.map.remove(r),r.destroy()}),c.watch(()=>this.numPendingFeatures>0,e=>this._sketchViewModel.updateOnGraphicClick=e,c.initial)])}_hasValidationErrors(e){return!(!e||this.data.isSubmittable(e)&&!this._featureFormViewModel.validateContingencyConstraints(e.attributes,{includeIncompleteViolations:!0})?.length)}async _processEdits(e,t){const{data:r,_featureFormViewModel:i}=this,{layerInfos:o,view:n}=r.viewModel;i.editType="INSERT",i.map=n?.map,i.spatialReference=n?.spatialReference;const{templateExecutorInfo:s}=r;if(!s){const t=e.clone();return t.geometry=null,await this._addAndInitializeEdits(e,t),e}const a=this.sketchViewModel.layer;a.remove(e);const{executor:p}=s,d=p(e.geometry,"completion"),u=l.isPromiseLike(d)?await d:d;s.completionResults.push(u),k.setRelationshipFields(u.relationships),i.editType="INSERT",i.map=n?.map,i.spatialReference=n?.spatialReference,u.primary&&r.creationInfo?.attributeOverrides&&(u.primary.graphic.attributes={...u.primary.graphic.attributes,...r.creationInfo.attributeOverrides});for(const e of u.edits){let r=null;if(e.addFeatures)for(const i of e.addFeatures){const e=i.clone();e.geometry=null,null!=i.geometry&&(i.symbol=await b.getDisplayedSymbol(i,t),a.add(i)),i.sourceLayer!==r?.layer&&(r=k.findLayerInfo(o,i.sourceLayer));const n=!!u.associationGraphics?.has(i);await this._addAndInitializeEdits(i,e,r,n)}}return i.feature=null,await c.whenOnce(()=>!i.updating),u.edits.reduce((e,t)=>e+(t.addFeatures?.length??0),0)>1?null:u.primary?.graphic}async _addAndInitializeEdits(e,t,r,i=!1){const{data:o,_featureFormViewModel:n}=this,{layerInfos:s}=o.viewModel,a=o.addPendingFeature(e,t,{isAssociation:i});r??=k.findLayerInfo(s,e.sourceLayer),n.feature=e,n.formTemplate=r?.formTemplate,await c.whenOnce(()=>!n.updating),a.submittable=n.submittable}async _setUpCreatingFeaturesStep(){if(this.hasHandles(V))return;const{data:e,sketchViewModel:t}=this,{creationInfo:n,viewModel:s}=e,{attachmentsViewModel:l,view:p}=s;if(!p||!n?.layer)throw new i("missing-parameters","CreateFeaturesWorkflow requires a view and creationInfo.");const{initialFeature:d,layer:u}=n,h=[],m=[];this._featureFormHandle=a.removeMaybe(this._featureFormHandle),this._visualVariableAttributes={rotation:null,size:null},e.editorItem=s.findEditorItemForLayer(n.layer),n.template&&(null==e.fullTemplate&&await this._initializeFullTemplateAndExecutorInfo(e),m.push(o.makeHandle(()=>{e.templateExecutorInfo&&(e.templateExecutorInfo.completionResults=[])}))),t.allowDeleteKey=!e.isSharedTemplateWorkflow,k.prepareAttachmentsForCreateFeaturesWorkflow(l),h.push(c.watch(()=>l.mode,e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}}));const g=k.showProgressCursor(p);h.push(g);const b=f.isTable(n.layer),{template:v}=n,_=!v||y.isStandardFeatureTemplate(v)||y.isSharedTemplateOrMetadata(v)&&"feature"===v.type,w=b&&_;try{if(w){const t=d??new r({attributes:k.getCreationAttributes(e.fullTemplate,n.attributeOverrides),sourceLayer:u}),i=await this._processEdits(t);i&&await this._startUpdating({feature:i})}else h.push(L._configureSketchViewModel(this)),d?(C.isModelUpload(n)&&n.geometryToPlace&&(d.attributes=k.getCreationAttributes(e.fullTemplate,n.attributeOverrides)),t.layer.add(d),await this._startUpdating({feature:d})):await this._startCreating()}finally{g.remove()}const S=o.makeHandle(()=>{for(const r of e.pendingFeatures)t.layer.remove(r),e.removePendingFeature(r)}),x=c.watch(()=>p?.timeZone,e=>{this._featureFormViewModel.timeZone=e,this.data.timeZone=e},c.initial),M=o.makeHandle(()=>{C.isModelUpload(n)&&s.cancelWorkflow({warnIfNoWorkflow:!1})});this._featureFormHandle&&h.push(this._featureFormHandle),this.addHandles(h,this._handleKeys.beforeCommit),this.addHandles(m,this._handleKeys.afterCommit),this.addHandles([o.makeHandle(()=>l.fileInfos.removeAll()),o.handlesGroup(h),o.handlesGroup(m),M,S,x],V)}async _waitForActiveToolCleared(){const e=this.data.viewModel.view;if(null==e?.activeTool)return;const t=new AbortController;this.addHandles(o.abortHandle(t),O),await c.whenOnce(()=>null==e?.activeTool,t.signal),t.abort()}};return t.__decorate([d.property()],U.prototype,"createFeatureState",void 0),t.__decorate([d.property()],U.prototype,"data",void 0),t.__decorate([d.property({constructOnly:!0})],U.prototype,"isNested",void 0),t.__decorate([d.property()],U.prototype,"featureFormViewModel",null),t.__decorate([d.property()],U.prototype,"hasPendingEdits",null),t.__decorate([d.property()],U.prototype,"hasPreviousStep",null),t.__decorate([d.property()],U.prototype,"_getDrawMeshHelpMessage",void 0),t.__decorate([d.property()],U.prototype,"helpMessage",null),t.__decorate([d.property()],U.prototype,"layer",null),t.__decorate([d.property()],U.prototype,"parent",null),t.__decorate([d.property()],U.prototype,"parentLayer",null),t.__decorate([d.property()],U.prototype,"keyboardCancellationEnabled",null),t.__decorate([d.property()],U.prototype,"reliesOnOwnerAdminPrivileges",null),t.__decorate([d.property()],U.prototype,"shouldShowAttachments",null),t.__decorate([d.property()],U.prototype,"shouldAllowAttachmentEditing",null),t.__decorate([d.property()],U.prototype,"sketchViewModel",null),t.__decorate([d.property()],U.prototype,"availableCreateTools",null),t.__decorate([d.property()],U.prototype,"_attachmentsActive",null),U=L=t.__decorate([h.subclass("esri.widgets.Editor.CreateFeaturesWorkflow")],U),U})},"esri/views/draw/support/helpMessageUtils":function(){define(["exports"],function(e){"use strict";e.getDrawHelpMessage=function(e,t,r){if(null==e)return"noTool";switch(e){case"point":return"point";case"multipoint":return"multipoint";case"polyline":return function(e,t){const r=null!=e&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0;return"freehand"===t?r<2?"freehandStart":"freehandEnd":r<2?"polylineZeroVertices":"polylineOneVertex"}(t,r);case"polygon":return function(e,t){const r=null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;if(r<3)switch(t){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(r<4)return"freehand"===t?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}(t,r);case"rectangle":case"circle":return function(e,t){if((null!=e&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0)<3)switch(t){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(t){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}(t,r);default:return}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/draw/support/HighlightHelper":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./layerUtils","../../support/HighlightDefaults","../../support/layerViewUtils"],function(e,t,r,i,o,n,s,a,l,c,p){"use strict";return e.default=class extends r{constructor(e){super(e),this._layerViewCache=new Map,this.highlightName=c.defaultHighlightName,this.view=null}add(e,t){const r=!e||Array.isArray(e)?e:[e];if(!r?.length)return;const i=t??this.highlightName;r.forEach(e=>this._highlight(e,i))}getKeyForFeature(e){const t=e.getObjectId();return null!=t?`oid:${t}`:`uid:${e.uid}`}remove(e){const t=!e||Array.isArray(e)?e:[e];t?.length&&t.forEach(e=>e&&this._removeHighlight(this.getKeyForFeature(e)))}removeByKey(e){e?.forEach(e=>e&&this._removeHighlight(e))}removeAll(){this.removeAllHandles()}update(e,t){this.remove(e),this.add(e,t)}_highlight(e,t){const r=e.layer??e.sourceLayer;if(!r)return;const i=this._layerViewCache.get(r);if(i)return void this.addHandles(i.highlight(e,{name:t}),this.getKeyForFeature(e));const o=l.findLayerView(this.view,r);p.highlightsSupported(o)&&(this._layerViewCache.set(r,o),this.addHandles(o.highlight(e,{name:t}),this.getKeyForFeature(e)))}_removeHighlight(e){this.removeHandles(e)}},t.__decorate([i.property()],e.default.prototype,"_layerViewCache",void 0),t.__decorate([i.property()],e.default.prototype,"highlightName",void 0),t.__decorate([i.property()],e.default.prototype,"view",void 0),e.default=t.__decorate([a.subclass("esri.views.draw.support.HighlightHelper")],e.default),e.default})},"esri/views/draw/support/layerUtils":function(){define(["exports","../../../layers/support/editableLayers","../../../layers/support/layerUtils"],function(e,t,r){"use strict";e.addUniqueLayer=function(e,t,r){if(!t||!e?.map)return;const{map:i}=e,o=i.layers.find(e=>e===t);o||i.add(t,r),o&&null!=r&&i.layers.reorder(o,r)},e.findLayerView=function(e,t){const r="subtype-sublayer"===t?.type?t.parent:t;return e.allLayerViews.find(e=>{const t=e.layer;return t===r||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(r)})},e.isConnectedReshapeSupportedLayer=function(e){return t.isEditableLayer(e)||r.isSubtypeSublayer(e)||r.isGraphicsLayer(e)||r.isKnowledgeGraphSublayer(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/CreateFeaturesWorkflowData":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/Collection","../../core/Logger","../../core/ReactiveMap","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../editing/templateUtils","./Edits"],function(e,t,r,i,o,n,s,a,l,c,p){"use strict";let d=class extends t{constructor(e){super(e),this.creationInfo=null,this.editorItem=null,this.fullTemplate=null,this.parent=null,this.temporaryHighlightFeature=null,this.sketchOptions=null,this.snappingManager=null,this.templateExecutorInfo=null,this.viewModel=null,this.upload=null,this._pendingEdits=new o}get isSharedTemplateWorkflow(){return!!this.fullTemplate&&c.isSharedTemplateOrMetadata(this.fullTemplate)}get pendingFeatures(){return new r([...this._pendingEdits.keys()])}set selectedPendingFeature(e){this._set("selectedPendingFeature",e),this.temporaryHighlightFeature=null}set timeZone(e){this._set("timeZone",e),this._pendingEdits.forEach(t=>{t.timeZone=e})}isSubmittable(e){const t=this._pendingEdits.get(e);return!!t?.submittable||!!t?.isAssociation}isDisplayable(e){return!this._pendingEdits.get(e)?.isAssociation}addPendingFeature(e,t=e,r={isAssociation:!1}){this.temporaryHighlightFeature=null;const{_pendingEdits:o}=this;if(o.has(e))return o.get(e);e.sourceLayer||i.getLogger("esri.widgets.Editor.CreateFeaturesWorkflowData").warn("source-layer-not-set","A feature added to `pendingFeatures` did not have `sourceLayer` set. This may cause problems throughout `CreateFeaturesWorkflow`.");const n=new p({feature:e,isAssociation:r.isAssociation});return n.trackChanges(t),o.set(e,n),n}getEditsForPendingFeature(e){return this._pendingEdits.get(e)}removePendingFeature(e){this.temporaryHighlightFeature=null;const{_pendingEdits:t}=this,r=t.get(e);r&&(r.destroy(),t.delete(e)),this.selectedPendingFeature===e&&(this.selectedPendingFeature=null)}getFeatureTitle(e){return this._pendingEdits.get(e)?.displayTitle}};return e.__decorate([n.property()],d.prototype,"creationInfo",void 0),e.__decorate([n.property()],d.prototype,"editorItem",void 0),e.__decorate([n.property()],d.prototype,"fullTemplate",void 0),e.__decorate([n.property()],d.prototype,"isSharedTemplateWorkflow",null),e.__decorate([n.property()],d.prototype,"parent",void 0),e.__decorate([n.property()],d.prototype,"pendingFeatures",null),e.__decorate([n.property()],d.prototype,"selectedPendingFeature",null),e.__decorate([n.property()],d.prototype,"temporaryHighlightFeature",void 0),e.__decorate([n.property({constructOnly:!0})],d.prototype,"sketchOptions",void 0),e.__decorate([n.property()],d.prototype,"snappingManager",void 0),e.__decorate([n.property()],d.prototype,"templateExecutorInfo",void 0),e.__decorate([n.property()],d.prototype,"viewModel",void 0),e.__decorate([n.property()],d.prototype,"upload",void 0),e.__decorate([n.property()],d.prototype,"timeZone",null),d=e.__decorate([l.subclass("esri.widgets.Editor.CreateFeaturesWorkflowData")],d),d})},"esri/widgets/Editor/Edits":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./support/editsUtils"],function(e,t,r,i,o,n,s,a,l){"use strict";let c=class extends t{constructor(e){super(e),this._stagedForDelete=!1,this.feature=null,this.initialFeature=null,this.submittable=!1,this.displayTitle=null,this.isAssociation=!1,this._debouncedRefreshDisplayTitle=r.debounce(this._refreshDisplayTitle.bind(this),100)}get attributesModified(){return!l.attributesAreEquivalent(this.initialFeature?.attributes,this.feature?.attributes)}get geometryModified(){return this._stringifyGeometry(this.feature)!==this._stringifyGeometry(this.initialFeature)}get stagedForDelete(){return this._stagedForDelete}get modified(){return this.attributesModified||this.geometryModified||this._stagedForDelete}set timeZone(e){this._set("timeZone",e),r.ignoreAbortErrors(this._debouncedRefreshDisplayTitle())}setAttribute(e,t){const{feature:i}=this;i&&(i.setAttribute(e,t),this.notifyChange("attributesModified")),r.ignoreAbortErrors(this._debouncedRefreshDisplayTitle())}stageDelete(){this._stagedForDelete=!0}unstageDelete(){this._stagedForDelete=!1}trackChanges(e=this.feature){this.initialFeature=e?.clone(),r.ignoreAbortErrors(this._debouncedRefreshDisplayTitle())}updateAttributes(e){const{feature:t}=this;t&&(t.attributes=e,this.notifyChange("attributesModified")),r.ignoreAbortErrors(this._debouncedRefreshDisplayTitle())}updateGeometry(e){const{feature:t}=this;t&&(t.geometry=e,this.notifyChange("geometryModified"))}_stringifyGeometry(e){const t=e?.geometry;return null==(r="mesh"===t?.type?{transform:t.transform??null,vertexSpace:t.vertexSpace}:t)?null:JSON.stringify(r);var r}async _refreshDisplayTitle(e){const t=this.feature,r=t?.sourceLayer;if(!r||!("getFeatureTitle"in r))return;const i=await r.getFeatureTitle(t,{fetchMissingFields:!1,timeZone:this.timeZone});e.aborted||(this.displayTitle=""===i?null:i)}};return e.__decorate([i.property()],c.prototype,"_stagedForDelete",void 0),e.__decorate([i.property()],c.prototype,"attributesModified",null),e.__decorate([i.property()],c.prototype,"feature",void 0),e.__decorate([i.property()],c.prototype,"geometryModified",null),e.__decorate([i.property()],c.prototype,"initialFeature",void 0),e.__decorate([i.property()],c.prototype,"modified",null),e.__decorate([i.property()],c.prototype,"submittable",void 0),e.__decorate([i.property()],c.prototype,"displayTitle",void 0),e.__decorate([i.property()],c.prototype,"isAssociation",void 0),e.__decorate([i.property()],c.prototype,"timeZone",null),c=e.__decorate([a.subclass("esri.widgets.Editor.Edits")],c),c})},"esri/widgets/Editor/support/editsUtils":function(){define(["exports","../../../core/SetUtils","../../support/forms/formUtils"],function(e,t,r){"use strict";e.attributesAreEquivalent=function(e,i){const o=e??{},n=i??{},s=new Set(Object.keys(o));t.addMany(s,Object.keys(n));for(const e of s){const t=o[e],i=n[e];if(!r.valuesAreEquivalent(t,i))return!1}return!0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/modelUploadUtils":function(){define(["require","exports","../../Graphic","../../core/handleUtils","../../core/promiseUtils","../../core/reactiveUtils","./workflowUtils"],function(e,t,r,i,o,n,s){"use strict";function a(e){const t=e?.layer;return"scene"===t?.type}t.handleModelUpload=async function({view:t,data:l,signal:c,next:p,cancel:d}){const{creationInfo:u}=l;if(!u)return i.makeHandle();if(!a(u))return i.makeHandle();const{layer:h}=u,y=null!=u.geometryToPlace;if(u.geometryToPlace=null,y)return d(),i.makeHandle();const{Upload:m}=await new Promise((t,r)=>e(["./Upload"],t,r));o.throwIfAborted(c);const f=new m;l.upload=f;let g=null;const b=()=>g?.remove(),v=i.handlesGroup([n.watch(()=>f.state,e=>{switch(e){case"default":case"error":b();break;case"pending":b(),g=s.showProgressCursor(t);break;case"success":{u.maxFeatures=1;const{result:e}=f;"georeferenced"===e?.type||"georeferenced-reprojected"===e?.type?(u.geometryToPlace=e.mesh,u.initialFeature=new r({geometry:e.mesh,sourceLayer:h})):u.geometryToPlace=e?.mesh,b(),p();break}}}),i.makeHandle(()=>{f.cancel(),b()})]);return f.uploadTo(h),v},t.isModelUpload=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/workflowUtils":function(){define(["require","exports","../../Color","../../Graphic","../../core/arrayUtils","../../core/asyncUtils","../../core/has","../../core/Error","../../core/handleUtils","../../core/lang","../../core/Logger","../../core/MapUtils","../../core/promiseUtils","../../core/reactiveUtils","../../core/screenUtils","../../core/accessorSupport/diffUtils","../../editing/templateUtils","../../editing/sharedTemplates/SharedTemplateProvider","../../layers/GraphicsLayer","../../layers/support/fieldUtils","../../layers/support/layerUtils","../../renderers/support/clickToleranceUtils","../../renderers/support/lengthUtils","../../renderers/support/typeUtils","../../renderers/visualVariables/support/sizeVariableUtils","../../symbols/SimpleFillSymbol","../../symbols/SimpleLineSymbol","../../symbols/SimpleMarkerSymbol","../../symbols/support/symbolConversion","../../symbols/support/symbolUtils","../../undoredo/support/Services","../../views/3d/layers/graphics/GraphicState","../../views/draw/DrawingMode","../../views/support/drapedUtils","../../views/support/hitTestSelectUtils","./support/dependencySort","../Sketch/support/sketchUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F,k,I,T,L,E,A,V,O,P,U){"use strict";const R=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));function D(e){return null!=e&&"update-features"===e.type}function G(e){return null!=e&&"update"===e.type}function H(e){const t=e&&"renderer"in e?e.renderer:null;if(!B(t))return{rotation:null,size:null};const r=t.getVisualVariablesForType("rotation").filter(e=>(!e.axis||"heading"===e.axis)&&e.field&&!e.valueExpression),i=t.getVisualVariablesForType("size").filter(e=>e.field&&!e.useSymbolValue&&!e.valueExpression&&"real-world-size"===M.getTransformationType(e));return{rotation:1===r.length?r[0]:null,size:1===i.length?i[0]:null}}function N(e){const t=e.sourceLayer;if(!(t&&"renderer"in t&&B(t.renderer)))return{rotation:null,size:null};const{rotation:r,size:i}=H(t);let o=null,n=null;if(r){const e=t.fields?.filter(e=>e.name===r.field),i=1===e?.length?e[0]:null;o=j(r,i)}if(i){const e=t.fields?.filter(e=>e.name===i.field),r=1===e?.length?e[0]:null;n=W(i,r)}return{rotation:o,size:n}}function j(e,t){const r="heading"===(e.axis||"heading")&&"arithmetic"===e.rotationType?-1:1,i=t?.type??"double",o={initial:0,current:0};return{field:e.field,fieldType:i,getDefaultValue:()=>Promise.resolve(0),getValue:e=>(o.current=o.initial-r*e,q((o.current+360)%360,i)),setInitialValue:e=>{o.initial=e,o.current=0},isUpdatingInteractively:!1,rotationType:e.rotationType??"geographic"}}function W(t,r){const i=t.axis,o=r?.type??"double",n={initial:0,current:0},s=S.meterIn[t.valueUnit]??1;let a;return a="area"===t.valueRepresentation?e=>(e*s/2)**2*Math.PI:"radius"===t.valueRepresentation||"distance"===t.valueRepresentation?e=>e*s/2:e=>e*s,{field:t.field,fieldType:o,getDefaultValue:async(t,r)=>q(a(await async function(t,r,i){if(null==r)return 0;const{symbol:o}=I.to3D(r);if(null==o||"web-style"===o.type||"cim"===o.type)return 0;const n=o.symbolLayers.at(0);if(!n)return 0;switch(n.type){case"icon":{const{computeIconLayerResourceSize:t}=await new Promise((t,r)=>e(["../../symbols/support/symbolLayerUtils"],t,r));return Math.min(me.icon,(await t(n,me.icon))[0])||me.icon}case"text":return me.text;case"line":return me.line;case"object":{const{computeObjectLayerResourceSize:r}=await new Promise((t,r)=>e(["../../symbols/support/symbolLayerUtils"],t,r));return function(e,t){switch(t){case"width":return e[0];case"depth":return e[1];case"height":return e[2];default:return e[2]||e[1]||e[0]}}(await r(n,t.scale/me.viewScaleSizeFactor),i)}case"path":case"extrude":return t.scale/me.viewScaleSizeFactor;default:return 0}}(r,t,i)),o),getValue:(e,t)=>(n.initial||(n.initial=t.pixelSizeAt(t.center)),n.current=n.initial*e,q(n.current,o)),setInitialValue:e=>{n.initial=e,n.current=0},isUpdatingInteractively:!1,displayUnit:fe(t.valueUnit),axis:t.axis}}function q(e,t){switch(t){case"small-integer":case"integer":case"long":return Math.round(e);case"double":case"single":return e;default:return 0}}function B(e){if(!x.isRenderer(e))return!1;switch(e?.type){case"class-breaks":case"simple":case"unique-value":case"dot-density":case"dictionary":case"pie-chart":return!0;default:return!1}}async function $(e,t,r){const i=await T.getDisplayedSymbol(e,{useSourceLayer:!0,ignoreGraphicSymbol:!0,webStyleCache:t,scale:r});null!=m.diff(e.symbol,i)&&(e.symbol=i)}function z(e,t){if(!e||!t)throw new Error("no geometry type");if("multipatch"===e)return{tool:"mesh",createOptions:{mode:"hybrid"}};const r=new Map;r.set("circle",{mode:"freehand"}),r.set("rectangle",{mode:"freehand"});const i={mode:A.defaultDrawingMode,optionsPerTool:r};if(f.isSharedTemplateOrMetadata(t)){const o=t.defaultTool,n=f.isSharedGroupTemplate(t)?t.definition?.inputGeometryType??e:e;switch(o){case"freehand":case"stream-line":return{tool:"polyline"===n?"freehandPolyline":"freehandPolygon",createOptions:i};case"autocomplete-freehand-polygons":case"stream-polygon":return{tool:"freehandPolygon",createOptions:i};case"autocomplete-polygons":case"difference-polygon":case"create-structures":case"polygon":case"trace":return{tool:"polygon"===n?"polygon":"polyline",createOptions:i};case"circle":return r.get("circle").preserveAspectRatio=!0,{tool:"circle",createOptions:i};case"ellipse":return r.get("circle").preserveAspectRatio=!1,{tool:"circle",createOptions:i};case"create-points-along-line":case"multipoint":return{tool:"multipoint",createOptions:i};case"line":case"radial-line":case"right-angle-line":case"split":case"two-point-line":return{tool:"polyline",createOptions:i};case"rectangle":case"regular-polygon":case"right-angle-polygon":return{tool:"rectangle",createOptions:i};case"elevation-point-from-contour":case"elevation-point-from-dem":case"parcel-seed":case"point":case"point-and-rotation":case"point-at-end-of-line":return{tool:"point",createOptions:i}}}else{const o=t.drawingTool;if("circle"===o||"ellipse"===o)return r.get("circle").preserveAspectRatio="circle"===o,{tool:"circle",createOptions:i};if("rectangle"===o)return{tool:"rectangle",createOptions:i};if("freehand"===o)return{tool:"polygon"===e?"freehandPolygon":"freehandPolyline",createOptions:i}}return{tool:e,createOptions:i}}function Z({creationAttributes:e,data:t,sketchViewModel:r,view:i,webStyleCache:o}){const{creationInfo:n}=t,{fullTemplate:s}=t;if(!n||"2d"!==i?.type||f.isSharedGroupTemplate(s)||f.isSharedPresetTemplate(s))return null;const a=u.debounce(t=>ae(r,n.layer,e,o,t));return h.watch(()=>i.scale,e=>a(e))}function K({data:e,sketchViewModel:t,view:i}){const{templateExecutorInfo:n}=e;if(!n)return null;const s=t.activeComponent;if(!i||!U.isDrawGraphicTool(s))return p.getLogger("esri.widgets.Editor.workflowUtils").error(new a("featureworkflow","Failed to set up template feedback.")),null;const c=new b({effect:"saturate(0.6) opacity(0.8)",listMode:"hide",title:"Shared Template Feedback Graphics"});i.map?.add(c);const{executor:d,serviceLayersById:y}=n,m=i.theme?.accentColor??new r([255,165,0,1]);return l.handlesGroup([h.on(()=>s,["cursor-update","vertex-add"],()=>{c.removeAll();const e=s.graphic?.geometry;if(!e||!function(e){switch(e.type){case"point":case"multipoint":return!0;case"polyline":return e.paths[0].length>1;case"polygon":{const t=e.rings[0];return o.equals(t.at(0),t.at(-1))?t.length>2:t.length>1}default:return!1}}(e))return;const t=d(e,"digitizing");if(!u.isPromiseLike(t))for(const e of t.edits){const t=y.get(e.id);if(t&&e.addFeatures&&0!==e.addFeatures.length)for(const r of t)if(!r.isTable)for(const t of e.addFeatures){const e=J(t,m);e&&c.add(e)}}}),l.makeHandle(()=>{i.map.remove(c),c.destroy()})])}function J(e,t){let r=null;switch(e.geometry?.type){case"point":case"multipoint":r=new k({angle:0,color:t,outline:new F({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:1}),path:"undefined",size:8,style:"circle",xoffset:0,yoffset:0});break;case"polygon":r=new C({color:t,outline:new F({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:3}),style:"none"});break;case"polyline":r=new F({cap:"round",color:t,join:"round",miterLimit:1,style:"solid",width:2});break;default:return null}return new i({geometry:e.geometry,symbol:r,attributes:{...e.attributes}})}async function Q(e,t){const r=await L.getServices(t).load(),i=_.isSubtypeSublayer(e)?e.parent:e;return r.tablesAndLayersLookup.get(i)}function X(e){const t=e.objectIdField,r=e.globalIdField??"";return{id:e.layerId,identifierFields:{objectIdField:t,globalIdField:r},addFeatures:[],deleteAttachments:[],addAttachments:[],deleteFeatures:[],updateFeatures:[]}}function Y(e){const t=new Map;for(const r of e)t.set(r.layerId,r);return t}function ee(e,t){const r=new Map;for(const i of e)for(const e of i.relationships??[])if(r.set(re(i,e),""),t.has(e.relatedTableId)){const o=t.get(e.relatedTableId);if(o.length>0)for(const t of o[0].layer.relationships??[])if(t.id===e.id){r.set(re(i,e),t.keyField);break}}return r}function te(e,t,r){const i=[];for(const o of e){const e=o.layer.relationships??[],{uniqueId:n}=o;for(const s of e){const e=s.keyField;if("origin"===s.role){const a=r.get(s.relatedTableId);if(!a||0===a.length)continue;const l=re(o.layer,s),c=t.get(l);if(void 0===c||""===c)continue;switch(o.operationType){case"add":for(const t of a)t!==o&&("add"!==t.operationType&&"modify"!==t.operationType||t.after.attributes[c]===o.after.attributes[e]&&i.push([n,t.uniqueId]));break;case"modify":if(o.before.attributes[e]!==o.after.attributes[e])for(const t of a){const r=t.uniqueId;t!==o&&("delete"===t.operationType?t.before.attributes[c]===o.before.attributes[e]?i.push([r,n]):t.before.attributes[c]===o.after.attributes[e]&&i.push([n,r]):"add"===t.operationType?t.after.attributes[c]===o.after.attributes[e]?i.push([n,r]):t.after.attributes[c]===o.before.attributes[e]&&i.push([r,n]):"modify"===t.operationType&&(t.before.attributes[c]!==t.after.attributes[c]?t.after.attributes[c]===o.after.attributes[e]?i.push([n,r]):i.push([r,n]):i.push([n,r])))}break;case"delete":for(const t of a)t!==o&&("delete"!==t.operationType&&"modify"!==t.operationType||t.before.attributes[c]===o.before.attributes[e]&&i.push([t.uniqueId,n]))}}}}return i}function re(e,t){return`${e.layerId}:${t.id}`}function ie(e,t){return!!(t?.map&&"utilityNetworks"in t.map&&t.map.utilityNetworks?.length&&t.map.utilityNetworks.some(t=>!(!t.loaded||!e.url?.startsWith(t.featureServiceUrl)||e.layerId!==t.networkSystemLayers.associationsTableId)))}function oe(e,t,r){const i=[];for(const t of e)ie(t.layer,r)&&i.push(t);if(0===i.length)return;let o=[];for(const r of i){const i=r.layer;switch(r.operationType){case"delete":o=[...ne(r.before.attributes[i.fieldsIndex.get("fromglobalid").name],e),...ne(r.before.attributes[i.fieldsIndex.get("toglobalid").name],e)];for(const e of o)t.push([r.uniqueId,e.uniqueId]);break;case"add":o=[...ne(r.after.attributes[i.fieldsIndex.get("fromglobalid").name],e),...ne(r.after.attributes[i.fieldsIndex.get("toglobalid").name],e)];for(const e of o)t.push([e.uniqueId,r.uniqueId])}}}function ne(e,t){const r=[],i=t.filter(({layer:e})=>""!==e.globalIdField&&null!=e.globalIdField);for(const t of i){const i=t.layer.globalIdField;("before"in t&&t.before?.attributes[i]===e||"after"in t&&t.after?.attributes[i]===e)&&r.push(t)}return r}function se(e,t={}){return f.isSharedGroupTemplate(e)||f.isSharedPresetTemplate(e)?{}:f.isStandardFeatureTemplate(e)?{...e.prototype.attributes,...t}:f.isSharedFeatureTemplate(e)?{...e.definition?.defaultValues,...t}:{...t}}async function ae(e,t,r,o,n){const s=new i({sourceLayer:t,attributes:r}),{rotation:a,size:l}=N(s);let c=await T.getDisplayedSymbol(s,{useSourceLayer:!0,webStyleCache:o,scale:n}),p=!1;for(const t of[l,a])null!=t&&null==r[t.field]&&(r[t.field]=await t.getDefaultValue(c,e.view),p=!0);switch(p&&(c=await T.getDisplayedSymbol(s,{useSourceLayer:!0,webStyleCache:o,scale:n})),c?.type){case"simple-fill":case"polygon-3d":e.polygonSymbol=c;break;case"simple-line":case"line-3d":e.polylineSymbol=c;break;case"simple-marker":case"picture-marker":case"point-3d":case"cim":e.pointSymbol=c;break;case"mesh-3d":e.meshSymbol=c}le(e.tooltipOptions,l,a)}function le(e,t,r){e.visualVariables=null!=t||null!=r?{size:null!=t?{unit:t.displayUnit,axis:t.axis,valueType:t.fieldType}:null,rotation:null!=r?{valueType:r.fieldType,rotationType:r.rotationType??"geographic"}:null}:null}function ce(e){return v.fixFields(e.fieldsIndex,[e.objectIdField,v.getDisplayFieldName({displayField:"displayField"in e?e.displayField:null,fields:e.fields})])}async function pe(e){const{graphic:t,sketchViewModel:r,sourceLayer:i,visualVariables:o}=e;await de(e);const n={multipleSelectionEnabled:!1};return"point"===i.geometryType&&(n.enableRotation=null!=o.rotation,n.enableScaling=null!=o.size),r.update(t,n)}async function de(e){const{graphic:t,sketchViewModel:r,sourceLayer:i,visualVariables:o,webStyleCache:n}=e;let s=!1;const{rotation:a,size:l}=o;for(const e of[a,l]){if(null==e)continue;const i=t.getAttribute(e.field);if(null!=i)e.setInitialValue(i);else{const i=await e.getDefaultValue(t.symbol,r.view);e.setInitialValue(i),t.setAttribute(e.field,i),s=!0}}if(s){const e="2d"===r.view?.type?r.view.scale:null;await $(t,n,e)}le(r.tooltipOptions,l,a),r.layer.elevationInfo=i.elevationInfo}function ue(e,t,r,i){if(null==t.geometry||"point"!==t.geometry?.type)return!1;const o=t.attributes;let n=!1;const s=i.rotation,a=null==(l=r.toolEventInfo)||"rotate-start"!==l.type&&"rotate"!==l.type&&"rotate-stop"!==l.type?null:l;var l;if(null!=s&&null!=a){const{field:r,getValue:i}=s;if("rotate-stop"===a.type)s.isUpdatingInteractively=!1,s.setInitialValue(t.getAttribute(r));else{s.isUpdatingInteractively=!0;const l=i(a.angle,e);l!==o[r]&&t.setAttribute(r,l),n=!0}}const c=i.size,p=function(e){return null==e||"scale-start"!==e.type&&"scale"!==e.type&&"scale-stop"!==e.type?null:e}(r.toolEventInfo);if(null!=c&&null!=p){const{field:r,getValue:i}=c;if("scale-stop"===p.type)c.isUpdatingInteractively=!1,c.setInitialValue(t.getAttribute(r));else{c.isUpdatingInteractively=!0;const s=i(p.xScale,e);s!==o[r]&&t.setAttribute(r,s),n=!0}}return n}function he(e,t,r){if("3d"===e.type){const i=new E.GraphicState({graphic:t});return l.handlesGroup([e.trackGraphicState(i),h.watch(()=>i.displaying,r)])}return h.watch(()=>t.visible,r)}async function ye(e,t){if("3d"===e.type){const r=new E.GraphicState({graphic:t}),i=e.trackGraphicState(r);await h.whenOnce(()=>r.displaying||r.error),i.remove()}else await h.whenOnce(()=>t.visible)}const me={icon:y.px2pt(24),text:y.px2pt(12),line:y.px2pt(1),viewScaleSizeFactor:100};function fe(e){return"unknown"===e?null:e}const ge=(e,t)=>{const r="subtype-sublayer"===t.type?t.parent:t;return e.whenLayerView(r)};function be(e){const t=e.geometry;if("mesh"===t?.type){const r=e.cloneShallow();return r.attributes=c.clone(e.attributes),r.geometry=t.cloneShallow(),r.geometry.transform=t.transform?.clone()??null,r}return e.clone()}function ve(e){for(const t of e){const{destinationGraphic:e,destinationField:r,sourceGraphic:i,sourceField:o}=t;e.setAttribute(r,i.getAttribute(o))}}t.appendAllUtilityNetworkAssociationRelationships=oe,t.avoidFeatureTemplateSelectionWithOnlyOneItem=function(e,t){e.viewModel.syncFeatureTemplates();const r=e.creationInfo;if("awaiting-feature-creation-info"===t[0].id&&r){const i=r.layer,o=e.viewModel.getTemplatesForLayer(i);1===o.length&&"scene"!==i.type&&(r.template=o[0],t.shift())}return t},t.canCreateInteractiveEditSession=function(e){return"createInteractiveEditSession"in e},t.cloneGraphicExceptMesh=be,t.createLayerIdMap=Y,t.createRelationshipKeyMap=ee,t.createToolFromGeometryType=z,t.createWorkflowSteps=function(e,t,r){let i=!1;return e.filter(e=>!!i||(i=e===t,i)).map(e=>r[e]())},t.fetchCandidates=async function(e,t,r,i){switch(t.type){case"3d":return async function(e,t,r,i){if(0===e.length)return[];const{updatable:n,graphicsByLayer:s}=await r.defer(async()=>{const{results:o}=await u.whenOrAbort(O.hitTestSelectSimilarDistance(t,r),i),n=new Map;O.filterGraphicHits(o).forEach(({graphic:e})=>(e=>{const t=e.layer,r=n.get(t);if(!r){const e=new Array;return n.set(t,e),e}return r})(e).push(e));const s=e.filter(({capabilities:e,layer:t})=>e.update.enabled&&n.has(t));return 0!==s.length&&r.stopPropagation(),{updatable:s,graphicsByLayer:n}});return u.whenOrAbort(Promise.allSettled(n.map(async({layer:e})=>{const t=s.get(e),r=ce(e);if(t.every(e=>v.featureHasFields(e,r)))return t;const n=[];for(const e of t){n.push(e.getObjectId());const t=Object.keys(e.attributes);o.addMany(r,t)}const a=e.createQuery();return a.returnGeometry=!1,a.objectIds=n,a.outFields=v.fixFields(e.fieldsIndex,r),e.queryFeatures(a,{signal:i}).then(({features:e})=>e)})),i)}(e,t,r,i);case"2d":return async function(e,t,r,i){if(0===e.length)return[];const{mapPoint:o}=r;if(null==o)return[];let n=null;const s=await r.defer(async()=>{const{results:o}=await u.whenOrAbort(t.hitTest(r),i);if(0===o.length)return[];const s=new Set;n=O.filterGraphicHits(o),n.forEach(({graphic:e})=>e&&s.add(e.layer));const a=e.filter(e=>s.has(e.layer)&&e.supportsUpdateWorkflow);return a.length>0&&r.stopPropagation(),a});return u.whenOrAbort(Promise.allSettled(s.map(async({layer:e})=>{const s=e.createQuery();s.returnGeometry=!0,s.outFields=ce(e);const a="renderer"in e?w.calculateTolerance({renderer:e.renderer,pointerType:r.pointerType}):0;s.geometry=V.createQueryGeometry(o,a,t),s.outSpatialReference=t.spatialReference;const{features:l}=await e.queryFeatures(s,{signal:i});return n?.forEach(({graphic:t})=>{t.layer!==e||l.some(e=>e.getObjectId()===t.getObjectId())||l.push(t)}),l})),i)}(e,t,r,i)}},t.fetchFullFeatures=async function(e,t,r,i){const n=t.createQuery();n.objectIds=e.map(e=>e.getObjectId()).filter(o.isSome),n.outFields=["*"],n.returnM=t.capabilities.data.supportsM,n.returnZ=t.capabilities.data.supportsZ,"scene"===t.type&&null!=t.infoFor3D||(n.outSpatialReference=r);const s=await t.queryFeatures(n,{signal:i});return u.throwIfAborted(i),s.features},t.findAllDependencies=te,t.findChangesByGlobalId=ne,t.findLayerInfo=function(e,t){return e?.find(e=>e.layer===t)},t.generateHashForRelationship=re,t.getCreationAttributes=se,t.getFullTemplateForCreationInfo=async function(t,r){const{template:i}=t;if(null==i)return null;if(f.isSharedTemplate(i))return i.load();if(f.isSharedTemplateOrMetadata(i)){const t=(await new Promise((t,r)=>e(["../../editing/sharedTemplates/SharedTemplate"],e=>t(R(e)),r))).default,o=e=>t.fromJSON(e),n=g.getSharedTemplateProvider(r,{makeSharedTemplateFromJSON:o}),s=await n.getTemplates({templateIds:[i.templateId],featureService:i.featureService});if(0===s.length)throw new a("editor:failed-to-load-template","Unable to load the provided template");return s[0].load()}return i},t.getLayersFromWorkflow=function(e){if(null==e)return[];if(D(e))return e.data.layers;const t=G(e)?e.activeWorkflow:e,r=t?.layer;return r?[r]:[]},t.getRotationVariableAttribute=j,t.getServiceEditsFromWorkflowData=function(e){const t=e.templateExecutorInfo?.completionResults;return t?.length?(t.forEach(e=>ve(e.relationships)),t.flatMap(e=>e.edits)):null},t.getServiceInfoForLayer=Q,t.getServiceLayersById=async function(e,t){const r=await Q(e,t);if(!r)return new Map;const i=new Map;for(const e of r.layersAndTables)d.getOrCreateMapValue(i,e.layerId,()=>[]).push(e);return i},t.getSizeVariableAttribute=W,t.getVisualVariableAttributes=N,t.getVisualVariablesForLayer=H,t.groupFeaturesByLayer=function(e){const t=new Map;for(const r of e){const e=r.sourceLayer,i=_.isSubtypeSublayer(e)?e.parent:e;d.getOrCreateMapValue(t,i,()=>[]).push(r)}return t},t.isBatchAttributeFormViewModel=function(e){return!!e&&"features"in e},t.isCreateFeaturesWorkflow=function(e){return null!=e&&"create-features"===e.type},t.isTerminalUpdateEventType=e=>e.includes("-stop")||e.includes("vertex-"),t.isUpdateFeaturesWorkflow=D,t.isUpdateRecordWorkflow=function(e){return null!=e&&e.type.includes("update-")&&"fullFeature"in e},t.isUpdateWorkflow=G,t.isUtilityNetworkAssociationsTable=ie,t.makeMultipleSourceLayersError=function(){return new a("editing:multiple-layers-not-supported","UpdateFeaturesWorkflow does not support updating features from multiple layers.")},t.orderEditsByRelationshipDependencies=function(e){const{edits:t,serviceInfo:r,view:i,findOriginalFeature:n}=e,s=Y(r.layersAndTables),l=r.layersAndTables.toArray(),{allEditData:c,editDataByLayerIdMap:p,editDataByIdMap:d}=function(e,t,r){const i=new Map,o=[],n=new Map;let s=1;for(const l of e){const e=[],c=t.get(l.id);if(!c)throw new a("featureworkflow",`Failed to prepare applyEdits payload. Layer with id ${l.id} not found.`);for(const t of l.addFeatures??[])e.push({uniqueId:"T"+s++,operationType:"add",layer:c,after:t});for(const t of l.deleteFeatures??[])e.push({uniqueId:"T"+s++,operationType:"delete",before:t,layer:c});for(const t of l.deleteAttachments??[])e.push({uniqueId:"T"+s++,operationType:"deleteAttachment",attachmentId:t,layer:c});for(const t of l.addAttachments??[])e.push({uniqueId:"T"+s++,operationType:"addAttachment",attachment:t,layer:c});for(const t of l.updateFeatures??[])e.push({uniqueId:"T"+s++,operationType:"modify",before:r(t),after:t,layer:c});i.set(c.layerId,e);for(const t of e)o.push(t),n.set(t.uniqueId,t)}return{allEditData:o,editDataByIdMap:n,editDataByLayerIdMap:i}}(t,s,n),u=te(c,ee(l,p),p);if(i&&oe(c,u,i),0===u.length)return t;const h=P.dependencySort(u,{continueOnCircularDependency:!0}).map(e=>d.get(e)).filter(o.isSome),y=new Map;for(const e of h)y.set(e.uniqueId,e);const m=[];for(const e of c)y.has(e.uniqueId)||m.push(e);const f=[];let g=null;for(const e of h){const{layer:t}=e;switch(null==g?g=X(t):g.id!==t.layerId&&(f.push(g),g=X(t)),e.operationType){case"add":case"modify":g.addFeatures.push(e.after);break;case"delete":g.deleteFeatures.push(e.before)}}null!==g&&f.push(g);for(const e of m){const t=e.layer.layerId,r=f.find(e=>e.id===t)??X(e.layer);switch(f.includes(r)||f.push(r),e.operationType){case"add":r.addFeatures.push(e.after);break;case"modify":r.updateFeatures.push(e.after);break;case"delete":r.deleteFeatures.push(e.before);break;case"deleteAttachment":r.deleteAttachments.push(e.attachmentId);break;case"addAttachment":r.addAttachments.push(e.attachment)}}for(const e of f)void 0!==e.deleteAttachments&&0===e.deleteAttachments.length&&delete e.deleteAttachments,void 0!==e.addAttachments&&0===e.addAttachments.length&&delete e.addAttachments;return f},t.prepareAttachmentsForCreateFeaturesWorkflow=function(e){e.filesEnabled=!0,e.mode="view",e.capabilities={editing:!0,operations:{add:!0,update:!0,delete:!0}}},t.setRelationshipFields=ve,t.setUpGeometryUpdate=async function({feature:e,featureClone:t,visualVariableAttributes:r,sketchViewModel:i,view:o,onUpdate:n,webStyleCache:s,addUpdatingPromise:a,addHandle:c}){await $(t,s,"2d"===o.type?o.scale:null);let p=null;if("2d"===i?.view?.type){const e=u.debounce(e=>$(t,s,e));p=h.watch(()=>i?.view?.scale,t=>e(t))}const d=t.sourceLayer,y=ge(o,d);await pe({graphic:t,sketchViewModel:i,sourceLayer:d,visualVariables:r,webStyleCache:s});let m=null;y.then(e=>m=e).catch(()=>{});const f=r.size,g=r.rotation,b=h.watch(()=>e.attributes,async e=>{let r=!1;for(const i in e){const o=e[i];o!==t.getAttribute(i)&&(t.setAttribute(i,o),null==f||f.isUpdatingInteractively||f.field!==i||f.setInitialValue(o),null==g||g.isUpdatingInteractively||g.field!==i||g.setInitialValue(o),(null==m||m.requiredFields.includes(i))&&(r=!0))}r&&await $(t,s,"2d"===o.type?o.scale:null)}),v=i.on("update",async e=>{const t=e.graphics[0],p={graphic:t,sketchViewModel:i,sourceLayer:d,visualVariables:r,webStyleCache:s};if("complete"===e.state){if(null===o.activeTool)return pe(p);const e=new AbortController,t=l.abortHandle(e);return c(t),a(h.whenOnce(()=>null===o.activeTool,e.signal).then(async()=>{if(!e.signal.aborted)return e.abort(),pe(p)}))}ue(o,t,e,r)&&await $(t,s,"2d"===o.type?o.scale:null),n(be(t),e)}),_=i.on(["undo","redo"],e=>{n(be(e.graphics[0]),e)});return l.handlesGroup([_,v,l.makeHandle(()=>i.cancel()),b,p])},t.setUpSketchCreateWatchers=async function(e){return l.handlesGroup([Z(e),K(e)])},t.setVisualVariablesAndElevationInfoForUpdate=de,t.showProgressCursor=function(e){return e.acquireCursor("progress")},t.sizeDefaults=me,t.sizeVariableUnitToLengthUnit=fe,t.startCreatingNewFeature=async function(e,t,r){const{creationInfo:i,fullTemplate:o}=t;if(!i)throw new a("featureworkflow","No creation info provided.");const n=i.layer,s=se(o,i.attributeOverrides),{view:l}=e,c="2d"===l?.type;f.isSharedGroupTemplate(o)||f.isSharedPresetTemplate(o)||await ae(e,n,s,r,c?l.scale:null);const{capabilities:p}=n;e.layer.elevationInfo=n.elevationInfo;const d=z(n.geometryType,o);e.defaultCreateOptions={graphicProperties:{attributes:s,sourceLayer:n},mode:d.createOptions.mode,optionsPerTool:d.createOptions.optionsPerTool,preserveAspectRatio:d.createOptions.preserveAspectRatio,hasZ:p.data.supportsZ,defaultZ:(c?p.editing.zDefault:null)??e.defaultCreateOptions.defaultZ},null==i.geometryToPlace?await e.create(d.tool):await e.place(i.geometryToPlace,{graphicProperties:{attributes:s,sourceLayer:n}})},t.startUpdatingFeatureGeometry=pe,t.swapForEditingSession=async function(e,t,r){const i=e.view;e.layer.add(r);const o=t.sourceLayer,s=t.layer,a=t.getAttribute(s.objectIdField);let c=null;function p(e){c?.abort(),c=n.createTask(async t=>{const r=await ge(i,o);u.throwIfAborted(t),r.setVisibility?.(a,e)})}return await ye(i,r),p(!1),l.handlesGroup([he(i,r,e=>p(!e)),l.makeHandle(async()=>{p(!0);try{if(!i.destroyed){const e=await ge(i,o).catch(()=>{});e&&!e.destroyed&&await h.whenOnce(()=>!e.updating)}}finally{e.layer.remove(r)}})])},t.updateGraphicSymbolWhenRequired=$,t.visualVariableInteractiveUpdate=ue,t.whenEditorLayerView=ge,t.whenGraphicDisplayed=ye,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/editing/sharedTemplates/SharedTemplateProvider":function(){define(["require","exports","../../chunks/tslib.es6","../../request","../../core/Accessor","../../core/handleUtils","../../core/MapUtils","../../core/maybe","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../templateUtils","./support/sharedTemplateErrors","../../layers/support/layerUtils","../../undoredo/support/Services","../../webmap/utils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v){"use strict";const _=new Map;function w(e){return null!=e&&e.subscribers.size>0}function S(){return{resolver:l.createResolver(),subscribers:new Set}}function x(e,t){return`${e.url}/${t}`}function M(e){return async({featureService:t,layerIds:r})=>{if(!e.map)throw new f.SharedTemplateLayerUnavailableError(r);const i=new Set(r),{allLayers:o,allTables:n}=e.map,s=o.concat(n).find(e=>e.url===t.url&&function(e){return g.isFeatureLayer(e)||g.isSubtypeGroupLayer(e)}(e)&&i.has(e.layerId));if(null==s)throw new f.SharedTemplateLayerUnavailableError(r);return s}}function C(e){return async t=>{const{map:r}=e;if(!v.isWebMap(r)||!r.utilityNetworks)return null;for(const e of r.utilityNetworks)if(e.featureServiceUrl===t.url)return e.load();return null}}t.SharedTemplateProvider=class extends o{constructor(e){super(e),this._abortController=null,this._cache=new Map,this._pending=new Map,this._utilityNetworkLookupHelperCache=new Map,this.layerResolver=null,this.makeSharedTemplateFromJSON=null,this.utilityNetworkResolver=null,this.view=null}initialize(){this.addHandles(c.watch(()=>this.view.spatialReference,()=>this._reset()))}destroy(){this._abortController=a.abortMaybe(this._abortController)}async getTemplates({templateIds:e,featureService:t,signal:r}){const i=this._cache,o=this._pending,n=[],s=new Set,a=new Set,c=Symbol();for(const r of new Set(e)){const e=x(t,r);if(i.has(e))n.push(i.get(e));else if(o.has(e)){const t=o.get(e);t.subscribers.add(c),a.add(t)}else s.add(r),o.set(e,S())}if(n.length===e.length)return n;const p=()=>{for(const{subscribers:e}of a)e.delete(c)},d=l.onAbort(r,p);try{const e=await this._loadTemplates({templateIds:Array.from(s),featureService:t,signal:r}),i=await Promise.all(Array.from(a).map(({resolver:e})=>e.promise));n.push(...e),n.push(...i)}catch(e){p();for(const r of s){const i=x(t,r),n=o.get(i);n?.resolver.reject(e),o.delete(i)}throw e}finally{d?.remove()}return l.throwIfAborted(r),n}async _loadTemplates({templateIds:e,featureService:t,signal:r}){if(0===e.length)return[];const o=this._cache,n=this._pending,s=this._abortController=new AbortController,a=l.onAbort(r,()=>{for(const r of e)if(w(n.get(x(t,r))))return;s.abort()}),c=await async function({templateIds:e,featureService:t,spatialReference:r,signal:o}){const n=`${t.url}/sharedTemplates/templates`,s=await i(n,{query:{f:"json",outSR:r,ids:e.join(",")},signal:o}).catch(t=>{throw l.throwIfAbortError(t),new f.SharedTemplateRequestError(e,t)});return s.data?.templates??[]}({featureService:t,templateIds:e,signal:s.signal,spatialReference:this.view.spatialReference});if(c.length<e.length)throw new f.SharedTemplateMissingTemplatesError(e,c);const p=await Promise.all(c.map(e=>this._makeTemplate({json:e,featureService:t})));for(const e of p){const i=x(t,e.templateId),s=n.get(i);!r?.aborted||w(s)?(o.set(i,e),s?.resolver.resolve(e)):s?.resolver.reject(l.createAbortError()),n.delete(i)}return a?.remove(),p}async _makeTemplate({json:e,featureService:t}){const{view:r}=this,i=this.makeSharedTemplateFromJSON(e);i.featureService=t,i.view=r;const{layerIds:o,subtypeCode:n}=i;try{i.layer=await this.layerResolver({featureService:t,layerIds:o,subtypeCode:n})}catch(e){throw new f.SharedTemplateLayerResolverError(i.templateId,e)}if(m.isSharedGroupTemplate(i)&&i.definition?.createUtilityNetworkAssociations){let e=null;try{e=await this.utilityNetworkResolver(t)}catch(e){throw new f.SharedTemplateUtilityNetworkResolverError(i.templateId,e)}if(e){i.definition.utilityNetwork=await this._getOrCreateUtilityNetworkLookupHelper(e);const t=e.associationsTable;i.definition.utilityNetworkAssociationsTable=t,b.getServices(r).additionalLayers.add(t)}}if(m.isSharedPresetTemplate(i)&&i.definition){i.definition.spatialReference=r.spatialReference;for(const e of i.definition.allParts)e.geometry&&(e.geometry.spatialReference=r.spatialReference)}if(m.isSharedFeatureTemplate(i)&&i.definition?.defaultValues){const e=i.definition.defaultValues,t={},{fieldsIndex:r}=i.layer;for(const o in i.definition.defaultValues)t[r.get(o)?.name??o]=e[o];i.definition.defaultValues=t}return i}async _getOrCreateUtilityNetworkLookupHelper(t){const r=this._utilityNetworkLookupHelperCache.get(t);if(r)return r;const{UtilityNetworkLookupHelper:i}=await new Promise((t,r)=>e(["../../networks/support/UtilityNetworkLookupHelper"],t,r)),o=await new i({utilityNetwork:t}).load();this._utilityNetworkLookupHelperCache.set(t,o);const s=n.makeHandle(()=>{o.destroy(),this._utilityNetworkLookupHelperCache.delete(t)});return t.addHandles(s),this.addHandles(s),o}_reset(){this._abortController?.abort(),this._cache.clear(),this._pending.clear()}},r.__decorate([p.property()],t.SharedTemplateProvider.prototype,"_abortController",void 0),r.__decorate([p.property()],t.SharedTemplateProvider.prototype,"_cache",void 0),r.__decorate([p.property()],t.SharedTemplateProvider.prototype,"_pending",void 0),r.__decorate([p.property({constructOnly:!0})],t.SharedTemplateProvider.prototype,"layerResolver",void 0),r.__decorate([p.property({constructOnly:!0})],t.SharedTemplateProvider.prototype,"makeSharedTemplateFromJSON",void 0),r.__decorate([p.property({constructOnly:!0})],t.SharedTemplateProvider.prototype,"utilityNetworkResolver",void 0),r.__decorate([p.property({constructOnly:!0})],t.SharedTemplateProvider.prototype,"view",void 0),t.SharedTemplateProvider=r.__decorate([y.subclass("esri.editing.sharedTemplates.SharedTemplateProvider")],t.SharedTemplateProvider),t.getSharedTemplateProvider=function(e,r){return s.getOrCreateMapValue(_,e,()=>{const i=new t.SharedTemplateProvider({layerResolver:r?.layerResolver??M(e),makeSharedTemplateFromJSON:r.makeSharedTemplateFromJSON,utilityNetworkResolver:r?.utilityNetworkResolver??C(e),view:e});return e.addHandles(n.makeHandle(()=>{_.delete(e),i.destroy()})),i})},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/editing/sharedTemplates/support/sharedTemplateErrors":function(){define(["exports","../../../core/Error","../../../core/SetUtils"],function(e,t,r){"use strict";e.SharedTemplateDefinitionRequiredPropsNotSetError=class extends t{constructor(){super("shared-template-definition-required-properties-not-set","The `featureService`, `makeSharedTemplateFromJSON`, and `view` properties must all be set in order to load a template definition")}},e.SharedTemplateLayerResolverError=class extends t{constructor(e,t){super("shared-template-layer-resolver-error",`The 'layerResolver' function failed to provide any layers for template with 'templateId: ${e}'`,{error:t}),this.templateId=e}},e.SharedTemplateLayerUnavailableError=class extends t{constructor(e){super("shared-template-layer-unavailable",`None of the layers with which the template is associated are present in the view. Layer IDs: [${e.join(",")}]`),this.layerIds=e}},e.SharedTemplateMissingTemplatesError=class extends t{constructor(e,t){const i=new Set(t.map(e=>e.templateId)),o=r.difference(new Set(e),i);super("shared-template-some-templates-missing",`The service failed to return templates for the following 'templateId's: ${Array.from(o).join(",")}`)}},e.SharedTemplateRelationshipNotFound=class extends t{constructor(e){super("shared-template-relationship-not-found",`Relationship class '${e}' could not be found.`),this.relationshipCatalogId=e}},e.SharedTemplateRequestError=class extends t{constructor(e,t){super("shared-template-query-failed",`Request to fetch templates failed. templateIds: ${e.join(",")}`,{error:t}),this.templateIds=e}},e.SharedTemplateRequiredPropsNotSetError=class extends t{constructor(){super("shared-template-required-properties-not-set","Values must be specified for the `definition`, `featureService`, `layer`, and `view` properties of a `SharedTemplate` in order to load it")}},e.SharedTemplateUnsupportedBuilderError=class extends t{constructor(e){super("shared-template-unsupported-builder",`This template uses an unsupported builder type, '${e}'`),this.builderType=e}},e.SharedTemplateUnsupportedDrawingTool=class extends t{constructor(e){super("shared-template-no-drawing-tools-allowed",`No drawing tools available for template '${e}. All supported drawing tools are listed in the template's 'excludedTools' list.`),this.templateId=e}},e.SharedTemplateUtilityNetworkResolverError=class extends t{constructor(e,t){super("shared-template-utility-network-resolver-error",`The 'utilityNetworkResolver' function threw an error while attempting to find a utility network for template with 'templateId: ${e}'`,{error:t}),this.templateId=e}},e.SharedTemplateUtilityNetworkUnavailableError=class extends t{constructor(e){super("shared-template-utility-network-unavailable","Template '${templateId}' requires a utility network that is not loaded or could not be found"),this.templateId=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(e){"use strict";function t(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function r(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,r=0;for(let i=0;i<e.length;i++){const o=e[i].size;"number"==typeof o&&(t+=o,r++)}return t/r}(e.stops):t}e.calculateTolerance=function(e){const i=e?.renderer,o=e?.pointerType,n="touch"===o?9:6;if(!i)return n;const s="visualVariables"in i?function(e,t){if(!t)return e;const i=t.filter(e=>"size"===e.type).map(t=>{const{maxSize:i,minSize:o}=t;return(r(i,e)+r(o,e))/2});let o=0;const n=i.length;if(0===n)return e;for(let e=0;e<n;e++)o+=i[e];const s=Math.floor(o/n);return Math.max(s,e)}(n,i.visualVariables):n;if("simple"===i.type)return t(s,i.symbol);if("unique-value"===i.type){let e=s;return i.uniqueValueInfos?.forEach(r=>{e=t(e,r.symbol)}),e}if("class-breaks"===i.type){let e=s;return i.classBreakInfos.forEach(r=>{e=t(e,r.symbol)}),e}return"dot-density"===i.type||i.type,s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicState":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Evented","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a){"use strict";e.GraphicState=class extends r.EventedAccessor{constructor(e){super(e),this.tracking=!1,this.displaying=!1,this.error=null,this.isDraped=!1}},t.__decorate([i.property({constructOnly:!0})],e.GraphicState.prototype,"graphic",void 0),t.__decorate([i.property()],e.GraphicState.prototype,"tracking",void 0),t.__decorate([i.property()],e.GraphicState.prototype,"displaying",void 0),t.__decorate([i.property()],e.GraphicState.prototype,"error",void 0),t.__decorate([i.property()],e.GraphicState.prototype,"isDraped",void 0),e.GraphicState=t.__decorate([a.subclass("esri.views.3d.layers.graphics.GraphicState")],e.GraphicState),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/draw/DrawingMode":function(){define(["exports"],function(e){"use strict";e.defaultDrawingMode="click",e.drawingModes=["freehand","hybrid","click"],Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/drapedUtils":function(){define(["exports","../../core/unitUtils","../../geometry/Extent","../../renderers/support/clickToleranceUtils"],function(e,t,r,i){"use strict";function o(e,i,o,n=new r){let s=0;if("2d"===o.type)s=i*(o.resolution??0);else if("3d"===o.type){const r=o.overlayPixelSizeInMapUnits(e),n=o.basemapSpatialReference;s=null==n||n.equals(o.spatialReference)?i*r:t.getMetersPerUnitForSR(n)/t.getMetersPerUnitForSR(o.spatialReference)}const a=e.x-s,l=e.y-s,c=e.x+s,p=e.y+s,{spatialReference:d}=o;return n.xmin=Math.min(a,c),n.ymin=Math.min(l,p),n.xmax=Math.max(a,c),n.ymax=Math.max(l,p),n.spatialReference=d,n}let n=new r;e.cleanupDrapedUtils=function(){n=new r},e.createQueryGeometry=o,e.intersectsDrapedGeometry=function(e,t,r){const s=r.toMap(e);return null!=s&&o(s,i.calculateTolerance(),r,n).intersects(t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],function(e){"use strict";function t(e){return"graphic"===e?.type}e.filterGraphicHits=function(e){return e.filter(t)},e.findFirstGraphicHit=function(e){return e.find(t)??null},e.hitTestSelectSimilarDistance=async function(e,t){if("2d"===e.type)return e.hitTest(t);const r=await e.hitTest(t);if(0===r.results.length)return r;const i=r.results[0],o=1.05*(i.distance??0),n=r.results.findIndex(e=>(e.distance??0)>o);return-1!==n&&(r.results=r.results.slice(0,n)),i&&r.ground.distance>o&&(r.ground.mapPoint=null),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/support/dependencySort":function(){define(["exports"],function(e){"use strict";class t{constructor(e){this.id=e,this.afters=[]}}function r(e,t){return e<t?1:e>t?-1:0}e.dependencySort=function(e,i){const o={};i=i||{continueOnCircularDependency:!1};const n=[],s={};e.forEach(e=>{const r=e[0];let i;(i=o[r])||(i=o[r]=new t(r)),e.forEach(e=>{e!==r&&(o[e]||(o[e]=new t(e)),i.afters.push(e))})});const a=Object.keys(o);return a.sort(r),a.forEach(function e(t,a){const l=o[t],c=l.id;if(s[t])return;const p=Array.isArray(a)?a:[];p.push(c),s[t]=!0,l.afters.sort(r),l.afters.forEach(t=>{if(p.includes(t)){if(i?.continueOnCircularDependency)return;throw new Error("Circular chain found: "+c+" must be before "+t+" due to a direct order specification, but "+t+" must be before "+c+" based on other specifications.")}e(t,p.slice())}),n.push(c)}),n.reverse()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Sketch/support/sketchUtils":function(){define(["exports"],function(e){"use strict";e.getDrawToolGeometryTypeFromCreateTool=function(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}},e.getModeFromCreateOptions=function(e,t){return"freehandPolygon"===t||"freehandPolyline"===t?"freehand":e??("rectangle"===t||"circle"===t?"hybrid":"click")},e.isDrawGraphicTool=function(e){return!!e&&("draw-2d"===e.type||"draw-3d"===e.type)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/Workflow":function(){define(["../../chunks/tslib.es6","../../core/Error","../../core/Evented","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles"],function(e,t,r,i,o,n,s,a,l,c){"use strict";let p=class extends r.EventedAccessor{constructor(e){super(e),this._indexHistory=[],this._lastStepIndex=-1,this._stepIndex=-1,this._updatingHandles=new c.UpdatingHandles,this._handleKeys={afterCommit:"after-commit",beforeCommit:"before-commit"},this.data=void 0,this.started=!1,this.steps=[],this.type=null,this._pendingOperation=null}destroy(){this._updatingHandles.destroy()}get hasNextStep(){const{steps:e}=this;return!!(e&&this._stepIndex<e.filter(e=>!e.parent).length-1)}get hasPreviousStep(){return this._stepIndex>0}get reliesOnOwnerAdminPrivileges(){return!1}get hasInvalidFormTemplate(){return!1}get shouldShowAttachments(){return!1}get shouldAllowAttachmentEditing(){return!1}get stepId(){const{steps:e}=this,t=e&&e[this._stepIndex];return t&&t.id}get helpMessage(){}get hasPendingEdits(){return!1}get keyboardCancellationEnabled(){return!0}get updating(){return this._updatingHandles.updating}async back(e=()=>Promise.resolve(!0)){this.hasPendingEdits&&!await e()||(this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0}))}async cancel(e={force:!0}){return!1!==e.force?this._cancel(e):new Promise((r,i)=>{this.emit("cancel-request",{controller:{allow:()=>{this._cancel({...e,force:!0}).then(r)},deny:()=>i(new t("workflow:cancel-denied","Request to cancel workflow was denied."))}})})}async commit(){this.removeHandles(this._handleKeys.beforeCommit),this.onCommit&&await this.onCommit(this.data),this.removeHandles(this._handleKeys.afterCommit),this.emit("commit")}async go(e){const{steps:t}=this,r=t.findIndex(t=>t.id===e);this._indexHistory.push(this._stepIndex),await this._go(r)}async next(){this._indexHistory.push(this._stepIndex),await this._go(this._stepIndex+1)}async previous(e={cancelCurrentStep:!1}){await this._go(this._indexHistory.pop(),e.cancelCurrentStep)}async reset(){await this._cancel({emitCancelEvent:!1}),await this.start()}async save(){await this.commit(),await this.reset()}async start(){this._set("started",!0);const e=-1===this._stepIndex?0:this._stepIndex;await this._go(e)}async _cancel({emitCancelEvent:e=!0,error:t}={}){this.started&&(this._set("started",!1),await this._transaction(()=>this.steps[this._stepIndex]?.tearDown({canceled:!0}))),this.removeHandles([this._handleKeys.afterCommit,this._handleKeys.beforeCommit]),this._resetIndexing(e),e&&this.emit("cancel",{error:t})}_go(e=-1,t=!1){return this._transaction(async()=>{const{steps:r}=this;if(!(e<=-1||e>=r.length)){if(!this.started)return this._stepIndex=e,void this._notifyStepProps();this._lastStepIndex>-1&&await r[this._lastStepIndex].tearDown({canceled:t});try{await r[e].setUp()}catch(e){i.throwIfNotAbortError(e)}this._lastStepIndex=e,this._stepIndex=e,this._notifyStepProps()}})}async _transaction(e){const t=this._pendingOperation,r=i.createResolver(),o=(t??Promise.resolve()).then(()=>r.promise);this._pendingOperation=o,this._updatingHandles.addPromise(o);try{t&&await t,await e()}finally{r.resolve(),o===this._pendingOperation&&(this._pendingOperation=null)}}_resetIndexing(e=!0){this._stepIndex=-1,this._lastStepIndex=-1,this._indexHistory.length=0,e&&this._notifyStepProps()}_notifyStepProps(){this.notifyChange("stepId"),this.notifyChange("hasPreviousStep"),this.notifyChange("hasNextStep")}};return e.__decorate([o.property()],p.prototype,"data",void 0),e.__decorate([o.property()],p.prototype,"hasNextStep",null),e.__decorate([o.property()],p.prototype,"hasPreviousStep",null),e.__decorate([o.property()],p.prototype,"onCommit",void 0),e.__decorate([o.property()],p.prototype,"reliesOnOwnerAdminPrivileges",null),e.__decorate([o.property()],p.prototype,"hasInvalidFormTemplate",null),e.__decorate([o.property()],p.prototype,"shouldShowAttachments",null),e.__decorate([o.property()],p.prototype,"shouldAllowAttachmentEditing",null),e.__decorate([o.property()],p.prototype,"started",void 0),e.__decorate([o.property({readOnly:!0})],p.prototype,"stepId",null),e.__decorate([o.property()],p.prototype,"steps",void 0),e.__decorate([o.property({readOnly:!0})],p.prototype,"type",void 0),e.__decorate([o.property()],p.prototype,"helpMessage",null),e.__decorate([o.property()],p.prototype,"hasPendingEdits",null),e.__decorate([o.property()],p.prototype,"keyboardCancellationEnabled",null),e.__decorate([o.property()],p.prototype,"updating",null),p=e.__decorate([l.subclass("esri.widgets.Editor.Workflow")],p),p})},"esri/widgets/Sketch/SketchViewModel":function(){define(["require","exports","../../chunks/tslib.es6","../../core/Collection","../../core/Error","../../core/Evented","../../core/handleUtils","../../core/has","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles","../../geometry/ellipsoidUtils","../../geometry/projectionUtils","../../geometry/support/coordsUtils","../../geometry/support/spatialReferenceUtils","../../layers/GraphicsLayer","../../layers/support/layerUtils","../../symbols/FillSymbol3DLayer","../../symbols/MeshSymbol3D","../../symbols/SimpleFillSymbol","../../symbols/SimpleLineSymbol","../../symbols/SimpleMarkerSymbol","../../symbols/support/typeUtils","../../views/3d/interactive/editingTools/isSupportedObjectUtils","../../views/3d/interactive/editingTools/move/isSupportedObject","../../views/3d/interactive/editingTools/reshape/isSupportedObject","../../views/3d/interactive/editingTools/transform/isSupportedGraphic","../../views/draw/support/layerUtils","../../views/input/InputManager","../../views/interactive/keybindings","../../views/interactive/sketch/SketchLabelOptions","../../views/interactive/sketch/SketchOptions","../../views/interactive/sketch/SketchTooltipOptions","../../views/interactive/sketch/SketchValueOptions","../../views/interactive/snapping/SnappingManager","../../views/interactive/snapping/SnappingOptions","../../views/interactive/snapping/snappingUtils","../../views/support/automaticAreaMeasurementUtils","../../views/support/automaticLengthMeasurementUtils","../../views/support/HighlightDefaults","../../views/support/hitTestSelectUtils","../../views/support/screenUtils","./support/OperationHandle","./support/sketchUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F,k,I,T,L,E,A,V,O,P,U,R,D,G,H,N,j,W,q,B,$,z,Z){"use strict";const K=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),J={defaultZ:0},Q={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:q.defaultHighlightName},tool:"transform"},X=Symbol();t.default=class extends n.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new m.UpdatingHandles,this._internalGraphicsLayer=new _({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new F({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new M({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new C({color:[130,130,130,1],width:2}),this.meshSymbol=new x({symbolLayers:new i([new S])}),this.updateGraphics=new i,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new F({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new U,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=J,this.defaultUpdateOptions=Q,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new H}initialize(){this.addHandles([d.on(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),d.on(()=>this.layer?.graphics,"change",e=>{if(null!=this._operationHandle)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),d.watch(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},d.syncAndInitial),d.watch(()=>this.view,t=>{this._defaultSnappingManager=c.destroyMaybe(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new G.SnappingManager({view:t,options:this.snappingOptions})),"2d"===t.type?new Promise((t,r)=>e(["../../views/2d/interactive/editingTools"],t,r)):"3d"===t.type&&(new Promise((t,r)=>e(["../../views/3d/interactive/editingTools"],t,r)),new Promise((t,r)=>e(["../../views/3d/layers/GraphicsLayerView3D"],e=>t(K(e)),r))))},d.syncAndInitial),d.watch(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),N.setupSnappingToggleHandles(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=c.destroyMaybe(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||null!=this.snappingManager&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return"create"===this._operationHandle?.type&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,r=!t&&e&&"tooltip"in e?e.tooltip:null;return r?.visible?r:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...J,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Q,...e,reshapeOptions:{...Q.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...Q.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=c.destroyMaybe(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new G.SnappingManager({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:r}=t;e&&this._clearCursor(),r?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const r="view-ready";this.removeHandles(r),e&&this.addHandles(d.when(()=>e.ready,t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},d.syncAndInitial),r),this._set("view",e)}cancel(){this._moduleLoaderAbortController=c.abortMaybe(this._moduleLoaderAbortController),this._viewReadyAbortController=c.abortMaybe(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:r}=this,i=t.toArray();r.removeMany(i),this.cancel(),this._emitDeleteEvent({graphics:i,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const e=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:r,layer:i}=this;if(!r||"disabled"===this.state)throw i||this._logMissingLayer(),p.createAbortError();if(null!=r.activeTool&&(r.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");A.addUniqueLayer(r,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));null==o||this.destroyed?r.map.remove(this._internalGraphicsLayer):(o.on("complete",()=>{if(o===this._operationHandle){const r=this.createGraphic,n=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||null==r||i.add(r),this._sketchContinuationFlag=!1,this.emit("create",{graphic:r,state:n?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),n||this._sketchContinuationFlag)return;const{creationMode:s}=this;if("continuous"===s){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(p.ignoreAbortErrors(this.create(e,t)))}else"update"===s&&r&&this._updatingHandles.addPromise(p.ignoreAbortErrors(this.update([r])))}}),this._operationHandle=o,r.ready&&r.focus())}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:r,view:i,state:o}=this;if(!i||"disabled"===o)throw r||this._logMissingLayer(),p.createAbortError();null!=i.activeTool&&(i.activeTool=null);const n=Array.isArray(e)?e:[e];if(null==e||!n?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some(e=>e.layer!==r?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const s=await this._updatingHandles.addPromise(this._setupUpdateOperation(n,t));this.destroyed||null==s||ae(s)||(A.addUniqueLayer(i,this._internalGraphicsLayer),this._setUpdateOperationHandle(s,t),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:s.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const r of e)null==r.geometry||"mesh"===r.geometry.type||v.equals(r.geometry.spatialReference,t.spatialReference)||(g.canProjectWithoutEngine(r.geometry.spatialReference,t.spatialReference)||g.isLoaded()||await g.load(),r.geometry=g.project(r.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){const r=[];t.map.allLayers.forEach(e=>{"vector-tile"!==e.type&&"imagery"!==e.type||r.push(e)});const i=await t.hitTest(e,{exclude:r});return B.findFirstGraphicHit(i.results)}const r=[t.map.ground];t.map.allLayers.forEach(e=>{w.isIntegratedMeshLayer(e.type)&&r.push(e)});const i=await t.hitTest(e,{exclude:r});if(i.results.length>0){const e=i.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!i.ground.mapPoint||t.map.ground.opacity<1||i.ground.distance-(e.distance??0)>-Math.min(3*i.ground.distance,"global"===t.viewingMode?f.getReferenceEllipsoid(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",async e=>{const t="active"===this.state&&"create"===this._operationHandle?.type;"disabled"!==this.state&&!t&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},V.ViewEventPriorities.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer(()=>this._getFirstHit($.createScreenPointFromEvent(e)));let r=null;if(null!=t){const i=t.graphic;this.updateGraphics.includes(i)||i.layer===this.layer?(e.stopPropagation(),r=i):"2d"!==this.view?.type||this._isComponentGraphic(i)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==r||this.updateGraphics.includes(r)||await this.update([r],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const r=this.view;if(!r)return this._logMissingView(),null;const i={hasZ:"3d"===r.type,...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,r,i);return null==o?null:(r.tools.add(o),r.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,r){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:i,defaultZ:o,hasZ:n,geometryToPlace:s,graphicProperties:a,mode:l,preserveAspectRatio:c}=r,p=Z.getModeFromCreateOptions(l,e),d=Z.getDrawToolGeometryTypeFromCreateTool(e),u=r?.optionsPerTool?.has(e)?r.optionsPerTool.get(e):{},h=u?.preserveAspectRatio??c??"rectangle"!==e,y={centered:"rectangle"!==e&&!("circle"===e&&!h),cursor:i,defaultZ:o,forceUniformSize:h,graphicProperties:{...a,attributes:{...a?.attributes}},geometryToPlace:s,geometryType:d,mode:p,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:n,snappingManager:this.snappingManager,snapToScene:!1,view:t,...u};return"2d"===t.type?this._makeDrawGraphicTool2D(y):this._makeDrawGraphicTool3D(y)}async _makeDrawGraphicTool2D(t){const[r,i,o]=await Promise.all([this._requireModule(new Promise((t,r)=>e(["../../views/2d/interactive/editingTools"],t,r))),j.loadAutomaticAreaMeasurementUtils(),W.loadAutomaticLengthMeasurementUtils()]);return ae(r)||this.destroyed?null:new r.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:(n=t.geometryType,"polygon"===n||"rectangle"===n||"circle"===n?this.activeFillSymbol:null),sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:o});var n}async _makeDrawGraphicTool3D(t){const[r,i,o]=await Promise.all([this._requireModule(new Promise((t,r)=>e(["../../views/3d/interactive/editingTools"],t,r))),j.loadAutomaticAreaMeasurementUtils(),W.loadAutomaticLengthMeasurementUtils()]);if(ae(r)||this.destroyed)return null;const{elevationInfo:n}=this.layer;return new r.module.DrawGraphicTool3D({...t,elevationInfo:n,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:o})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let r=null;const i=e.forceUniformSize,o=e.centered,n=[t.on("key-down",t=>{if(t.key===O.sketchKeys.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===O.sketchKeys.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==O.sketchKeys.vertexAdd||t.repeat)t.key===O.sketchKeys.undo?(t.stopPropagation(),a.undo()):t.key===O.sketchKeys.redo?(t.stopPropagation(),a.redo()):t.key!==O.sketchKeys.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===O.sketchKeys.center&&(t.repeat||(e.centered=!o,t.stopPropagation())):(e.forceUniformSize=!i,t.stopPropagation());else{const r=e.drawOperation.geometryType;"polyline"!==r&&"polygon"!==r&&"multipoint"!==r||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},V.ViewEventPriorities.WIDGET),t.on("key-up",t=>{t.key===O.sketchKeys.pan?e.enabled=!0:t.key!==O.sketchKeys.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===O.sketchKeys.center&&(e.centered=o,t.stopPropagation()):(e.forceUniformSize=i,t.stopPropagation())},V.ViewEventPriorities.WIDGET),e.on("vertex-add",t=>{switch(r=null==r?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:r,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",e=>{this._set("createGraphic",e.graphic),r="complete",e.aborted?a&&a.cancel():a&&a.complete()}),d.watch(()=>this._getGraphicSymbolFromTool(e.geometryType),t=>{e.graphicSymbol=t})],a=new z.CreateOperationHandle({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{s.drainHandles(n),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return a}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:r,view:i}=this;if(!i)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let n=o.tool??Q.tool;for(const t of e)r.remove(t),r.add(t);if("3d"===i.type){if(0===e.length)return null;switch(n){case"move":return this._setupMove3DOperation(e,o,i,n);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,i);case"transform":return this._setupGraphicTransform3DOperation(e,o,i)}}switch(n){case"move":return this._setupMove2DOperation(e,o,i);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,n,o,i);case"transform":if(1===e.length){const t=e[0].geometry?.type;"point"!==t&&"multipoint"!==t||(n="reshape")}return this._setupTransformOrReshape2DOperation(e,n,o,i)}}async _setupMove3DOperation(t,r,i,o,n=!1){const[a,l]=await Promise.all([this._requireModule(new Promise((t,r)=>e(["../../views/3d/interactive/editingTools"],t,r))),W.loadAutomaticLengthMeasurementUtils()]);if(ae(a))return a;const{ManipulatedObject3DGraphic:c,MoveTool3D:p}=a.module,d=new Map,u=()=>{d.forEach(e=>e.destroy()),d.clear()};for(const e of t){const t=new c({view:i,graphic:e}),r=T.isSupportedObject(t);if(0!==r)return u(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${I.isSupportedObjectResultMessage(r)}).`),null;d.set(e,t)}const h=new p({view:i,enableZ:r.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:l});i.tools.add(h),h.objects.addMany(Array.from(d.values())),n||this.updateGraphics.addMany(t);const y=[],m=new z.UpdateOperationHandle({activeComponent:h,tool:o,type:"update",onEnd:()=>{s.drainHandles(y),se(i,h),u()},undo:()=>{oe(this.view,h),te(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{re(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:e=>{this.updateGraphics.push(e);const t=new c({view:i,graphic:e});d.set(e,t),h.objects.push(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);if(m.history.undo.forEach(e=>e.updates.splice(t,1)),m.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0===this.updateGraphics.length)return void m.complete();const r=d.get(e);r&&(h.objects.remove(r),r.destroy(),d.delete(e))},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===r.toggleToolOnClick)return;if("transform"!==o)return;const e=this.updateGraphics.at(0),t=await this._setupReshape3DOperation(e,r,i,!0);t&&!ae(t)&&(m.onEnd(),m.destroy(),this._setUpdateOperationHandle(t,r))}});return y.push(...this._getHandlesForComponent(m,r),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(m,e,r),V.ViewEventPriorities.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)},V.ViewEventPriorities.WIDGET)),m}_setupGraphicTransform3DOperation(e,t,r,i=!1){if(1===e.length&&0===E.isSupportedGraphic(e[0])){const o=e[0],n=o.geometry;if(null!=n&&("point"===n.type||"mesh"===n.type))return this._setupPointTransform3DOperation(o,t,r);if(null!=n&&("polygon"===n.type||"polyline"===n.type))return this._setupPolyTransform3DOperation(o,t,r,i)}return this._setupMove3DOperation(e,t,r,"transform",i)}async _setupPointTransform3DOperation(t,r,i){const o="transform",{enableRotation:n,enableScaling:a,enableZ:l}=r,c=await this._requireModule(new Promise((t,r)=>e(["../../views/3d/interactive/editingTools"],t,r)));if(ae(c))return c;const{TransformTool3D:p,ManipulatedObject3DGraphic:d}=c.module,u=new d({graphic:t,view:i}),h=new p({object:u,view:i,enableRotation:n,enableScaling:a,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(h),this.updateGraphics.add(t);const y=[],m=new z.UpdateOperationHandle({activeComponent:h,tool:o,type:"update",onEnd:()=>{s.drainHandles(y),se(i,h),u.destroy()},undo:()=>{oe(this.view,h),te(m,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o})},redo:()=>{re(m,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const t=await this._setupMove3DOperation(this.updateGraphics.toArray(),r,i,"transform",!0);ae(t)||this._setUpdateOperationHandle(t,r)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),m.complete()},toggleTool:()=>{}});return y.push(...this._getHandlesForComponent(m,r),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(m,e,r),V.ViewEventPriorities.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)},V.ViewEventPriorities.WIDGET)),m}async _setupPolyTransform3DOperation(t,r,i,o=!1){const n="transform",{enableRotation:a,enableScaling:l,enableZ:c,preserveAspectRatio:p}=r,[d,u]=await Promise.all([this._requireModule(new Promise((t,r)=>e(["../../views/3d/interactive/editingTools"],t,r))),W.loadAutomaticLengthMeasurementUtils()]);if(ae(d))return d;const{ManipulatedObject3DGraphic:h,ExtentTransformTool:y}=d.module,m=this.view?.inputManager?.isModifierKeyDown(O.sketchKeys.constraint),f=new h({view:i,graphic:t}),g=new y({object:f,view:i,enableRotation:a,enableScaling:l,enableZ:c,preserveAspectRatio:!!p!=!!m,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:u});i.tools.add(g),o||this.updateGraphics.add(t);const b=[],v=new z.UpdateOperationHandle({activeComponent:g,tool:n,type:"update",onEnd:()=>{s.drainHandles(b),se(i,g),f.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),v.onEnd(),v.destroy();const t=await this._setupMove3DOperation(this.updateGraphics.toArray(),r,i,"transform",!0);ae(t)||this._setUpdateOperationHandle(t,r)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),v.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===r.toggleToolOnClick)return;const e=await this._setupReshape3DOperation(t,r,i,!0);e&&!ae(e)&&(v.onEnd(),v.destroy(),this._setUpdateOperationHandle(e,r))}});return b.push(...this._getHandlesForComponent(v,r),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(v,e,r),V.ViewEventPriorities.WIDGET),i.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(v,e),V.ViewEventPriorities.WIDGET),i.on("key-down",e=>{e.key!==O.sketchKeys.constraint||e.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,e.stopPropagation())},V.ViewEventPriorities.WIDGET),i.on("key-up",e=>{e.key===O.sketchKeys.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,e.stopPropagation())},V.ViewEventPriorities.WIDGET)),v}async _setupMove2DOperation(e,t,r){const i="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,r);if(ae(o))return o;const n=new z.UpdateOperationHandle({activeComponent:o,tool:i,type:"update",onEnd:()=>{this._clearCursor(),s.drainHandles(c),s.drainHandles(l),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();te(n,e),n.refreshComponent(),this._emitUndoEvent({graphics:e,tool:i})},redo:()=>{const e=this.updateGraphics.toArray();re(n,e),n.refreshComponent(),this._emitRedoEvent({graphics:e,tool:i})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);n.history.undo.forEach(e=>e.updates.splice(t,1)),n.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const r=this.updateGraphics.toArray();this.emit("update",{graphics:r,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?o.graphics=r:n.complete()}});let a=!1;const l=[r.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(n,e,t),V.ViewEventPriorities.WIDGET),r.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(n,e),e.key!==O.sketchKeys.constraint||e.repeat||(a=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},V.ViewEventPriorities.WIDGET),r.on("key-up",e=>{e.key===O.sketchKeys.constraint&&a&&(a=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},V.ViewEventPriorities.WIDGET)],c=this._getHandlesForComponent(n,t);return n}async _setupReshape3DOperation(t,r,i,o=!1){const n="reshape",[a,l,c]=await Promise.all([this._requireModule(new Promise((t,r)=>e(["../../views/3d/interactive/editingTools"],t,r))),j.loadAutomaticAreaMeasurementUtils(),W.loadAutomaticLengthMeasurementUtils()]);if(ae(a))return a;const{ManipulatedObject3DGraphic:p,ReshapeTool3D:d}=a.module,u=new p({view:i,graphic:t}),h=L.isSupportedObject(u);if(0!==h)return u.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${I.isSupportedObjectResultMessage(h)}).`),null;const y=r.reshapeOptions,m=new d({view:i,object:u,enableZVertex:r.enableZ&&"move"===y?.vertexOperation,enableZShape:r.enableZ&&"move"===y?.shapeOperation,enableMoveObject:"move"===y?.shapeOperation||"move-xy"===y?.shapeOperation,enableMidpoints:"split"===y?.edgeOperation,enableEdgeOffset:"offset"===y?.edgeOperation,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:c});i.tools.add(m),o||this.updateGraphics.add(u.graphic);const f=[],g=new z.UpdateOperationHandle({activeComponent:m,tool:n,type:"update",onEnd:()=>{s.drainHandles(f),se(i,m),u.destroy()},canUndo:()=>!m.destroyed&&m.canUndo,undo:()=>{m.destroyed||(m.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},canRedo:()=>!m.destroyed&&m.canRedo,redo:()=>{m.destroyed||(m.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const t=await this._setupMove3DOperation(this.updateGraphics.toArray(),r,i,"transform",!0);ae(t)||this._setUpdateOperationHandle(t,r)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),g.complete()},toggleTool:async()=>{if(!1===r.toggleToolOnClick)return;g.onEnd(),g.destroy();const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),r,i,!0);ae(e)||this._setUpdateOperationHandle(e,r)}});return f.push(...this._getHandlesForComponent(g,r),i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(g,e,r),V.ViewEventPriorities.WIDGET),i.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)},V.ViewEventPriorities.WIDGET)),g}async _setupTransformOrReshape2DOperation(e,t,r,i){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o="transform"===t?await this._getBox(e,r,i):await this._getReshape(e,r,i);if(ae(o))return o;const n=new z.UpdateOperationHandle({activeComponent:o,type:"update",onEnd:()=>{s.drainHandles(l),s.drainHandles(a),n.activeComponent&&!n.activeComponent.destroyed&&n.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{te(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},redo:()=>{re(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},addToSelection:async e=>{let t=n.activeComponent;if("reshape"===t?.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),n.onEnd(),n.destroy();const o=await this._setupTransformOrReshape2DOperation(t,"transform",r,i);if(ae(o))return;this._setUpdateOperationHandle(o,r)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),n.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);n.history.undo.forEach(e=>e.updates.splice(t,1)),n.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const r=this.updateGraphics.toArray();if(0===r.length)n.complete();else{const e=r[0].geometry;1!==r.length||null==e||"point"!==e.type&&"multipoint"!==e.type?n.activeComponent.graphics=r:n.toggleTool()}this.emit("update",{graphics:r,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.at(0),t=e.geometry;if(null!=t&&("reshape"===n.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===n.tool&&"extent"===t.type))return;let o=null;"transform"===n.tool?o=await this._getReshape([e],r,i):"reshape"===n.tool&&(o=await this._getBox([e],r,i)),ae(o)||(n.activeComponent?.destroy(),n.activeComponent=o,n.activeComponent&&(s.drainHandles(l),l=this._getHandlesForComponent(n,r)))}}),a=[i.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(n,e,r),V.ViewEventPriorities.WIDGET),i.on("key-down",e=>{if(this._getCommonUpdateOperationKeyDownHandlers(n,e),e.key===O.sketchKeys.constraint&&!e.repeat&&n){const e=n.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},V.ViewEventPriorities.WIDGET),i.on("key-up",e=>{if(e.key===O.sketchKeys.constraint&&n){const e=n.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},V.ViewEventPriorities.WIDGET)];let l=this._getHandlesForComponent(n,r);return n}async _getGraphicMover(t,r,i){const{enableMoveAllGraphics:o,highlightOptions:n}=r,s=await this._requireModule(new Promise((t,r)=>e(["../../views/draw/support/GraphicMover"],e=>t(K(e)),r)));return ae(s)?s:new s.module.default({enableMoveAllGraphics:o,highlightName:n?.name,highlightsEnabled:!!n?.enabled,indicatorsEnabled:!1,graphics:t,view:i,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:r})=>{this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:r,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:r,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:r})=>{this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:r,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(t,r,i){const{enableRotation:o,enableScaling:n,highlightOptions:s,preserveAspectRatio:a}=r,[l,c]=await Promise.all([this._requireModule(new Promise((t,r)=>e(["../../views/draw/support/Box"],e=>t(K(e)),r))),W.loadAutomaticLengthMeasurementUtils()]);if(ae(l))return l;const p=this.view?.inputManager?.isModifierKeyDown(O.sketchKeys.constraint);return new l.module.default({graphics:t,enableRotation:o,enableScaling:n,highlightName:s?.name,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!a!=!!p,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:c,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(t,r,i){const{highlightOptions:o,reshapeOptions:n}=r,s="split"===n?.edgeOperation,a="move"===n?.shapeOperation,[l,c,p]=await Promise.all([this._requireModule(new Promise((t,r)=>e(["../../views/draw/support/Reshape"],e=>t(K(e)),r))),j.loadAutomaticAreaMeasurementUtils(),W.loadAutomaticLengthMeasurementUtils()]);return ae(l)?l:new l.module.default({enableMidpoints:s,enableMovement:a,graphic:t[0],highlightName:o?.name,highlightsEnabled:!!o?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:c,automaticLengthMeasurementUtils:p,view:i,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:r,type:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:r,type:i},type:"update"}),onMove:({dx:e,dy:t,mover:r,type:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:r,type:i},type:"update"}),onMoveStop:({dx:e,dy:t,mover:r,type:i})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:r,type:i},type:"update"}),onVertexAdd:({added:e,type:t,vertices:r})=>{const i=e.map(e=>b.geometryToCoordinates(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:i,vertices:r,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:r})=>{const i=e.map(e=>b.geometryToCoordinates(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:i,vertices:r,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){const r=e.activeComponent;if(!r)return[];switch(r.type){case"graphic-mover":return[r.on("graphic-click",({graphic:r,viewEvent:i})=>{i.native?.shiftKey&&t.multipleSelectionEnabled&&(i.stopPropagation(),e.removeFromSelection(r))}),r.on("graphic-move-start",t=>e.addToHistory(ne(t.allGraphics)))];case"box":return[r.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(e,t,r)),r.on("move-start",t=>e.addToHistory(ne(t.graphics))),r.on("rotate-start",t=>e.addToHistory(ne(t.graphics))),r.on("scale-start",t=>e.addToHistory(ne(t.graphics)))];case"reshape":return[r.on("graphic-click",r=>this._onTransformOrReshape2DGraphicClick(e,t,r)),r.on("move-start",t=>e.addToHistory(ne([t.mover]))),r.on("reshape-start",t=>e.addToHistory(ne([t.graphic]))),r.on("vertex-add",t=>e.addToHistory(ne([t.oldGraphic]))),r.on("vertex-remove",t=>e.addToHistory(ne([t.oldGraphic])))];case"move-3d":return[r.events.on("record-undo",({updates:t})=>{e.addToHistory({updates:t})}),r.events.on("move-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-start"},type:"update"})}),r.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move"},type:"update"})}),r.events.on("move-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-stop"},type:"update"})}),r.events.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[r.events.on("record-undo",({updates:t})=>{e.addToHistory({updates:t})}),r.events.on("translate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})}),r.events.on("translate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})}),r.events.on("rotate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-start"},type:"update"})}),r.events.on("rotate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})}),r.events.on("scale-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})}),r.events.on("scale-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})}),r.events.on("translate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})}),r.events.on("rotate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate"},type:"update"})}),r.events.on("scale",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})}),r.events.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[r.events.on("reshape",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})}),r.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})}),r.events.on("vertex-add",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),r.events.on("vertex-remove",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),r.events.on("immediate-click",r=>{r.shiftKey?this._toggleSelection([r.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,r){const{graphic:i,viewEvent:o}=r;return o.native?.shiftKey&&i.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(i)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const r=this.view?.map;this._disablePopup(t),e.on("complete",()=>{if(e===this._operationHandle){const i=this.updateGraphics.toArray(),o=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),r&&r.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:i,state:"complete",aborted:e.cancelled,tool:o,toolEventInfo:null,type:"update"})}})}async _getCommonUpdateOperationClickHandlers(e,t,r){const i=$.createScreenPointFromEvent(t),o=await t.defer(()=>this._getFirstHit(i));null!=o&&(t.native.shiftKey&&this._toggleSelection([o.graphic],e,r)||this.updateGraphics.includes(o.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,r){const i=!!r.multipleSelectionEnabled;return e.some(e=>!(null==e||!i||e.layer!==this.layer||(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),0)))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const r=t.key;r===O.sketchKeys.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):r===O.sketchKeys.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):r===O.sketchKeys.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&O.sketchKeys.delete.includes(r)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,r=this.updateGraphics.toArray();null!=t&&("reshape"!==t.type||1===r.length&&"point"===r[0].geometry?.type)&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=c.destroyMaybe(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||null==t)&&(e.attributes?.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_clearCursor(){this.removeHandles(X)}_displayCursor(e){this.removeHandles(X),this.view?.container&&null!=e&&this.addHandles(this.view.acquireCursor(e,"high"),X)}_logError(e,t,r){l.getLogger(this).error(new o(e,t,r))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const r=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:r}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return d.whenOnce(()=>!this.updating)}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(c.abortMaybe(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await p.whenOrAbort(d.whenOnce(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",ee("view"))}_logMissingLayer(){this._logError(Y,ee("layer"))}},r.__decorate([u.property()],t.default.prototype,"_defaultSnappingManager",void 0),r.__decorate([u.property()],t.default.prototype,"updating",null),r.__decorate([u.property({readOnly:!0})],t.default.prototype,"_updatingHandles",void 0),r.__decorate([u.property()],t.default.prototype,"_operationHandle",void 0),r.__decorate([u.property({readOnly:!0})],t.default.prototype,"activeTool",null),r.__decorate([u.property({readOnly:!0})],t.default.prototype,"activeCreateToolDrawMode",null),r.__decorate([u.property()],t.default.prototype,"activeTooltip",null),r.__decorate([u.property({types:k.symbolTypes})],t.default.prototype,"activeFillSymbol",void 0),r.__decorate([u.property()],t.default.prototype,"activeLineSymbol",void 0),r.__decorate([u.property()],t.default.prototype,"activeVertexSymbol",void 0),r.__decorate([u.property()],t.default.prototype,"allowDeleteKey",void 0),r.__decorate([u.property({readOnly:!0})],t.default.prototype,"createGraphic",null),r.__decorate([u.property()],t.default.prototype,"defaultCreateOptions",null),r.__decorate([u.property()],t.default.prototype,"defaultUpdateOptions",null),r.__decorate([u.property({type:P,nonNullable:!0})],t.default.prototype,"labelOptions",null),r.__decorate([u.property()],t.default.prototype,"layer",void 0),r.__decorate([u.property({types:k.symbolTypes})],t.default.prototype,"pointSymbol",void 0),r.__decorate([u.property({types:k.symbolTypes})],t.default.prototype,"polygonSymbol",void 0),r.__decorate([u.property({types:k.symbolTypes})],t.default.prototype,"polylineSymbol",void 0),r.__decorate([u.property()],t.default.prototype,"meshSymbol",void 0),r.__decorate([u.property({type:H,nonNullable:!0})],t.default.prototype,"snappingOptions",null),r.__decorate([u.property()],t.default.prototype,"snappingManager",null),r.__decorate([u.property({readOnly:!0})],t.default.prototype,"state",null),r.__decorate([u.property({type:R,nonNullable:!0})],t.default.prototype,"tooltipOptions",null),r.__decorate([u.property({readOnly:!0})],t.default.prototype,"updateGraphics",void 0),r.__decorate([u.property()],t.default.prototype,"updateOnGraphicClick",void 0),r.__decorate([u.property()],t.default.prototype,"creationMode",void 0),r.__decorate([u.property({type:D,nonNullable:!0})],t.default.prototype,"valueOptions",null),r.__decorate([u.property({types:k.symbolTypes})],t.default.prototype,"vertexSymbol",void 0),r.__decorate([u.property({value:null})],t.default.prototype,"view",null),r.__decorate([u.property({constructOnly:!0,type:U})],t.default.prototype,"sketchOptions",void 0),t.default=r.__decorate([y.subclass("esri.widgets.Sketch.SketchViewModel")],t.default);const Y="sketch:missing-property",ee=e=>`Property '${e}' is missing on SketchViewModel.`;function te(e,t){ie("undo",e.history.undo,e.history.redo,t)}function re(e,t){ie("redo",e.history.redo,e.history.undo,t)}function ie(e,t,r,i){const o=t.pop();if(!o)return;const n=o.updates,s=[];i.forEach((t,r)=>{const i=n[r];null!=i&&("geometry"in i&&null!=i.geometry&&(s.push({geometry:t.geometry}),t.geometry=i.geometry),"symbol"in i&&null!=i.symbol&&(s.push({symbol:t.symbol}),t.symbol=i.symbol),"undo"in i&&(s.push(i),i[e](t)))}),r.push({updates:s})}function oe(e,t){null!=e&&t.hasGrabbedManipulators&&(e.activeTool=null)}function ne(e){return{updates:e.map(({geometry:e})=>"mesh"===e?.type?{geometry:e.cloneShallow()}:{geometry:e})}}function se(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function ae(e){return"requireError"in e&&"aborted"===e.requireError}return t.default})},"esri/views/3d/interactive/editingTools/isSupportedObjectUtils":function(){define(["exports","../../../../core/has"],function(e,t){"use strict";e.isSupportedObjectResultMessage=function(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the elevation mode is not supported";case 5:return"the symbol type is not supported"}return""},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/interactive/editingTools/move/isSupportedObject":function(){define(["exports","../../../../../core/has","../../../../../support/elevationInfoUtils"],function(e,t,r){"use strict";e.isSupportedObject=function(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return 1;const t=e.operations?.data.type;if(!t)return 3;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}const i=e.elevationInfo;return r.hasEffectiveFeatureExpressionInfo(i)?4:0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/interactive/editingTools/reshape/isSupportedObject":function(){define(["exports","../../../../../support/elevationInfoUtils"],function(e,t){"use strict";e.isSupportedObject=function(e){return function(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return{result:1};if(!e.operations)return{result:2};if(t.hasEffectiveFeatureExpressionInfo(e.elevationInfo))return{result:4};const r=e.operations.data.type,i=e.operations.data.geometry;return"point"===r||"mesh"===r||"polyline"===r||"polygon"===r?{result:0,geometry:i}:{result:3}}(e).result},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/interactive/editingTools/transform/isSupportedGraphic":function(){define(["exports","../../../../../core/has","../../../../../support/elevationInfoUtils"],function(e,t,r){"use strict";e.isSupportedGraphic=function(e){if("graphics"!==e.layer?.type)return 1;if(null==e.geometry)return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const t=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.some(e=>"object"===e.type)?"on-the-ground"!==r.getGraphicEffectiveElevationMode(e)&&r.hasGraphicFeatureExpressionInfo(e)?4:0:5},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/automaticAreaMeasurementUtils":function(){define(["exports","./euclideanAreaMeasurementUtils","./geodesicAreaMeasurementUtils"],function(e,t,r){"use strict";const i=e=>({autoAreaByElevationMode(r,i,o=t.createEuclideanPlanarAreaCache()){if("on-the-ground"===i){const i=e.geodesicArea(r);return null!=i?i:t.euclideanHorizontalPlanarArea(r,o)}return t.euclideanPlanarArea(r,o)},autoArea2D(e,r=t.createEuclideanPlanarAreaCache()){return this.autoAreaByElevationMode(e,"on-the-ground",r)}});let o=null;e.loadAutomaticAreaMeasurementUtils=async function(){return o||(o=i(await r.loadGeodesicAreaMeasurementUtils())),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/euclideanAreaMeasurementUtils":function(){define(["exports","../../core/quantityUtils","../../core/unitUtils","../../chunks/earcut","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/projection/projectVectorToVector","../../geometry/support/plane","../../geometry/support/triangle","./measurementUtils"],function(e,t,r,i,o,n,s,a,l,c){"use strict";function p(e,i,p=e.hasZ){const y=c.computeEuclideanMeasurementSR(e.spatialReference),m=r.areaUnitFromSpatialReference(y);if(null==m)return null;const f=(e,t)=>!(t.length<2||(o.set(e,t[0],t[1],p&&t[2]||0),0));let g=0;for(const t of e.rings){const r=t.length;if(r<3)continue;const{positionsWorldCoords:c}=i;for(;c.length<r;)c.push(n.create());const p=d,m=o.set(u,0,0,0),b=1/r;for(let i=0;i<r;i++){if(!f(p,t[i]))return null;if(!s.projectVectorToVector(p,e.spatialReference,c[i],y))return null;o.scaleAndAdd(m,m,c[i],b)}const v=a.fromPoints(c[0],c[1],m,a.wrap());if(0===o.squaredLength(a.getNormal(v)))continue;for(let e=0;e<r;e++)a.projectPointLocal(v,m,c[e],c[e]);const _=h(c);for(let e=0;e<_.length;e+=3)g+=l.areaPoints2d(c[_[e]],c[_[e+1]],c[_[e+2]])}return t.createArea(g,m)}const d=n.create(),u=n.create();function h(e){return i.earcut(function(e){const t=new Float64Array(2*e.length);for(let r=0;r<e.length;++r){const i=e[r],o=2*r;t[o]=i[0],t[o+1]=i[1]}return t}(e),[],2)}e.computeEuclideanPlanarArea=p,e.createEuclideanPlanarAreaCache=function(){return{positionsWorldCoords:[]}},e.euclideanHorizontalPlanarArea=function(e,t={positionsWorldCoords:[]}){return p(e,t,!1)},e.euclideanPlanarArea=function(e,t={positionsWorldCoords:[]}){return p(e,t)},e.triangulate=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports"],function(e){"use strict";function t(e,t,n){n=n||2;var s,a,l,p,u,h,m,f=t&&t.length,g=f?t[0]*n:e.length,b=r(e,0,g,n,!0),v=[];if(!b||b.next===b.prev)return v;if(f&&(b=function(e,t,o,n){var s,a,l,p=[];for(s=0,a=t.length;s<a;s++)(l=r(e,t[s]*n,s<a-1?t[s+1]*n:e.length,n,!1))===l.next&&(l.steiner=!0),p.push(y(l));for(p.sort(c),s=0;s<p.length;s++)o=i(o=d(p[s],o),o.next);return o}(e,t,b,n)),e.length>80*n){s=l=e[0],a=p=e[1];for(var _=n;_<g;_+=n)(u=e[_])<s&&(s=u),(h=e[_+1])<a&&(a=h),u>l&&(l=u),h>p&&(p=h);m=0!==(m=Math.max(l-s,p-a))?1/m:0}return o(b,v,n,s,a,m),v}function r(e,t,r,i,o){var n,s;if(o===k(e,t,r,i)>0)for(n=t;n<r;n+=i)s=M(n,e[n],e[n+1],s);else for(n=r-i;n>=t;n-=i)s=M(n,e[n],e[n+1],s);if(s&&b(s,s.next)){var a=s.next;C(s),s=a}return s}function i(e,t){if(!e)return e;t||(t=e);var r,i=e;do{if(r=!1,i.steiner||!b(i,i.next)&&0!==g(i.prev,i,i.next))i=i.next;else{var o=i.prev;if(C(i),(i=t=o)===i.next)break;r=!0}}while(r||i!==t);return t}function o(e,t,r,c,p,d,u){if(e){!u&&d&&function(e,t,r,i){var o=e;do{null===o.z&&(o.z=h(o.x,o.y,t,r,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,r,i,o,n,s,a,l,c=1;do{for(r=e,e=null,n=null,s=0;r;){for(s++,i=r,a=0,t=0;t<c&&(a++,i=i.nextZ);t++);for(l=c;a>0||l>0&&i;)0!==a&&(0===l||!i||r.z<=i.z)?(o=r,r=r.nextZ,a--):(o=i,i=i.nextZ,l--),n?n.nextZ=o:e=o,o.prevZ=n,n=o;r=i}n.nextZ=null,c*=2}while(s>1)}(o)}(e,c,p,d);for(var y,m,f=e;e.prev!==e.next;)if(y=e.prev,m=e.next,d?s(e,c,p,d):n(e))t.push(y.i/r),t.push(e.i/r),t.push(m.i/r),C(e),e=m.next,f=m.next;else if((e=m)===f){u?1===u?o(e=a(i(e),t,r),t,r,c,p,d,2):2===u&&l(e,t,r,c,p,d):o(i(e),t,r,c,p,d,1);break}}}function n(e){var t=e.prev,r=e,i=e.next;if(g(t,r,i)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(m(t.x,t.y,r.x,r.y,i.x,i.y,o.x,o.y)&&g(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function s(e,t,r,i){var o=e.prev,n=e,s=e.next;if(g(o,n,s)>=0)return!1;for(var a=o.x<n.x?o.x<s.x?o.x:s.x:n.x<s.x?n.x:s.x,l=o.y<n.y?o.y<s.y?o.y:s.y:n.y<s.y?n.y:s.y,c=o.x>n.x?o.x>s.x?o.x:s.x:n.x>s.x?n.x:s.x,p=o.y>n.y?o.y>s.y?o.y:s.y:n.y>s.y?n.y:s.y,d=h(a,l,t,r,i),u=h(c,p,t,r,i),y=e.prevZ,f=e.nextZ;y&&y.z>=d&&f&&f.z<=u;){if(y!==e.prev&&y!==e.next&&m(o.x,o.y,n.x,n.y,s.x,s.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,f!==e.prev&&f!==e.next&&m(o.x,o.y,n.x,n.y,s.x,s.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;y&&y.z>=d;){if(y!==e.prev&&y!==e.next&&m(o.x,o.y,n.x,n.y,s.x,s.y,y.x,y.y)&&g(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;f&&f.z<=u;){if(f!==e.prev&&f!==e.next&&m(o.x,o.y,n.x,n.y,s.x,s.y,f.x,f.y)&&g(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function a(e,t,r){var o=e;do{var n=o.prev,s=o.next.next;!b(n,s)&&v(n,o,o.next,s)&&S(n,s)&&S(s,n)&&(t.push(n.i/r),t.push(o.i/r),t.push(s.i/r),C(o),C(o.next),o=e=s),o=o.next}while(o!==e);return i(o)}function l(e,t,r,n,s,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&f(l,c)){var p=x(l,c);return l=i(l,l.next),p=i(p,p.next),o(l,t,r,n,s,a),void o(p,t,r,n,s,a)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const r=t.next;if(r.prev===t||r===t||r===e)break;t=r}return t}function d(e,t){var r=function(e,t){var r,i=t,o=e.x,n=e.y,s=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var a=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=o&&a>s){if(s=a,a===o){if(n===i.y)return i;if(n===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(o===s)return r;var l,c=r,p=r.x,d=r.y,h=1/0;i=r;do{o>=i.x&&i.x>=p&&o!==i.x&&m(n<d?o:s,n,p,d,n<d?s:o,n,i.x,i.y)&&(l=Math.abs(n-i.y)/(o-i.x),S(i,e)&&(l<h||l===h&&(i.x>r.x||i.x===r.x&&u(r,i)))&&(r=i,h=l)),i=i.next}while(i!==c);return r}(e,t);if(!r)return t;var o=x(r,e),n=i(r,r.next);let s=p(o);return i(s,s.next),n=p(n),p(t===r?n:t)}function u(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function h(e,t,r,i,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function m(e,t,r,i,o,n,s,a){return(o-s)*(t-a)-(e-s)*(n-a)>=0&&(e-s)*(i-a)-(r-s)*(t-a)>=0&&(r-s)*(n-a)-(o-s)*(i-a)>=0}function f(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&v(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(S(e,t)&&S(t,e)&&function(e,t){var r=e,i=!1,o=(e.x+t.x)/2,n=(e.y+t.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&o<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(i=!i),r=r.next}while(r!==e);return i}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||b(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function b(e,t){return e.x===t.x&&e.y===t.y}function v(e,t,r,i){var o=w(g(e,t,r)),n=w(g(e,t,i)),s=w(g(r,i,e)),a=w(g(r,i,t));return o!==n&&s!==a||!(0!==o||!_(e,r,t))||!(0!==n||!_(e,i,t))||!(0!==s||!_(r,e,i))||!(0!==a||!_(r,t,i))}function _(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function w(e){return e>0?1:e<0?-1:0}function S(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function x(e,t){var r=new F(e.i,e.x,e.y),i=new F(t.i,t.x,t.y),o=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=o,o.prev=r,i.next=r,r.prev=i,n.next=i,i.prev=n,i}function M(e,t,r,i){var o=new F(e,t,r);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function C(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function F(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function k(e,t,r,i){for(var o=0,n=t,s=r-i;n<r;n+=i)o+=(e[s]-e[n])*(e[n+1]+e[s+1]),s=n;return o}t.deviation=function(e,t,r,i){var o=t&&t.length,n=o?t[0]*r:e.length,s=Math.abs(k(e,0,n,r));if(o)for(var a=0,l=t.length;a<l;a++){var c=t[a]*r,p=a<l-1?t[a+1]*r:e.length;s-=Math.abs(k(e,c,p,r))}var d=0;for(a=0;a<i.length;a+=3){var u=i[a]*r,h=i[a+1]*r,y=i[a+2]*r;d+=Math.abs((e[u]-e[y])*(e[h+1]-e[u+1])-(e[u]-e[h])*(e[y+1]-e[u+1]))}return 0===s&&0===d?0:Math.abs((d-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},i=0,o=0;o<e.length;o++){for(var n=0;n<e[o].length;n++)for(var s=0;s<t;s++)r.vertices.push(e[o][n][s]);o>0&&(i+=e[o-1].length,r.holes.push(i))}return r},e.earcut=t})},"esri/geometry/projection/projectVectorToVector":function(){define(["exports","../projectionUtils","../SpatialReference","./projectPointToVector","../../layers/graphics/dehydratedPoint"],function(e,t,r,i,o){"use strict";function n(e,t,r,o,n){return!(null==t||null==o||e.length<2)&&(s.x=e[0],s.y=e[1],s.z=e[2],s.spatialReference=t,i.projectPointToVector(s,r,o,n))}const s=o.makeDehydratedPoint(0,0,0,r.WGS84);e.projectVectorToVector=n,e.projectVectorToVectorAsync=async function(e,r,i,o,s,a){return await t.initializeProjection(r,o,null,a),n(e,r,i,o,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projectionUtils","./projectBuffer"],function(e,t,r,i){"use strict";function o(e,t,o,s){if(r.canProjectWithoutEngine(e.spatialReference,o)){n[0]=e.x,n[1]=e.y;const r=e.z;return n[2]=r??s??0,i.projectBuffer(n,e.spatialReference,0,t,o,0)}const a=r.tryProjectWithZConversion(e,o);return!!a&&(t[0]=a?.x,t[1]=a?.y,t[2]=a?.z??s??0,!0)}const n=t.create();e.projectPointToVector=o,e.projectPointToVectorAsync=async function(e,t,i,n,s){return await r.initializeProjection(e.spatialReference,i,null,s),o(e,t,i,n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define(["exports","../../core/ObjectStack","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./lineSegment","./vectorStacks"],function(e,t,r,i,o,n){"use strict";function s(e){return e?{p0:i.clone(e.p0),p1:i.clone(e.p1),p2:i.clone(e.p2)}:{p0:i.create(),p1:i.create(),p2:i.create()}}function a(e,t,i,o=s()){return r.copy(o.p0,e),r.copy(o.p1,t),r.copy(o.p2,i),o}const l=new t.ObjectStack(o.create),c=new t.ObjectStack(()=>s()),p=i.create(),d=i.create();e.areaPoints2d=function(e,t,r){const i=t[0]-e[0],o=t[1]-e[1],n=r[0]-e[0],s=r[1]-e[1];return.5*Math.abs(i*s-o*n)},e.areaPoints3d=function(e,t,i){return r.subtract(p,t,e),r.subtract(d,i,e),.5*r.length(r.cross(p,p,d))},e.copy=function(e,t=s()){return a(e.p0,e.p1,e.p2,t)},e.create=s,e.distance2=function(e,t){const i=e.p0,s=e.p1,a=e.p2,c=r.subtract(n.sv3d.get(),s,i),p=r.subtract(n.sv3d.get(),a,s),d=r.subtract(n.sv3d.get(),i,a),u=r.subtract(n.sv3d.get(),t,i),h=r.subtract(n.sv3d.get(),t,s),y=r.subtract(n.sv3d.get(),t,a),m=r.cross(c,c,d),f=r.dot(r.cross(n.sv3d.get(),c,m),u),g=r.dot(r.cross(n.sv3d.get(),p,m),h),b=r.dot(r.cross(n.sv3d.get(),d,m),y);if(f>0&&g>0&&b>0){const e=r.dot(m,u);return e*e/r.dot(m,m)}const v=o.distance2(o.fromValues(i,c,l.get()),t),_=o.distance2(o.fromValues(s,p,l.get()),t),w=o.distance2(o.fromValues(a,d,l.get()),t);return Math.min(v,_,w)},e.fromValues=a,e.intersectRay=function(e,t,i){const o=1e-5,{direction:n,origin:s}=t,{p0:a,p1:l,p2:c}=e,p=l[0]-a[0],d=l[1]-a[1],u=l[2]-a[2],h=c[0]-a[0],y=c[1]-a[1],m=c[2]-a[2],f=n[1]*m-y*n[2],g=n[2]*h-m*n[0],b=n[0]*y-h*n[1],v=p*f+d*g+u*b;if(v>-o&&v<o)return!1;const _=1/v,w=s[0]-a[0],S=s[1]-a[1],x=s[2]-a[2],M=_*(w*f+S*g+x*b);if(M<0||M>1)return!1;const C=S*u-d*x,F=x*p-u*w,k=w*d-p*S,I=_*(n[0]*C+n[1]*F+n[2]*k);if(I<0||M+I>1)return!1;if(i){const e=_*(h*C+y*F+m*k);r.scale(i,n,e),r.add(i,s,i)}return!0},e.wrap=function(e,t,r){const i=c.get();return i.p0=e,i.p1=t,i.p2=r,i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/lineSegment":function(){define(["exports","../../core/mathUtils","../../core/ObjectStack","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],function(e,t,r,i,o,n){"use strict";function s(e){return e?{origin:o.clone(e.origin),vector:o.clone(e.vector)}:{origin:o.create(),vector:o.create()}}function a(e,t){const r=u.get();return r.origin=e,r.vector=t,r}function l(e,t,r=s()){return i.copy(r.origin,e),i.copy(r.vector,t),r}function c(e,r,o,s,a){const{vector:l,origin:c}=e,p=i.subtract(n.sv3d.get(),r,c),d=i.dot(l,p)/i.squaredLength(l);return i.scale(a,l,t.clamp(d,o,s)),i.add(a,a,e.origin)}function p(e,r,o,s){const a=1e-6,l=e.origin,c=i.add(n.sv3d.get(),l,e.vector),p=r.origin,d=i.add(n.sv3d.get(),p,r.vector),u=n.sv3d.get(),h=n.sv3d.get();if(u[0]=l[0]-p[0],u[1]=l[1]-p[1],u[2]=l[2]-p[2],h[0]=d[0]-p[0],h[1]=d[1]-p[1],h[2]=d[2]-p[2],Math.abs(h[0])<a&&Math.abs(h[1])<a&&Math.abs(h[2])<a)return!1;const y=n.sv3d.get();if(y[0]=c[0]-l[0],y[1]=c[1]-l[1],y[2]=c[2]-l[2],Math.abs(y[0])<a&&Math.abs(y[1])<a&&Math.abs(y[2])<a)return!1;const m=u[0]*h[0]+u[1]*h[1]+u[2]*h[2],f=h[0]*y[0]+h[1]*y[1]+h[2]*y[2],g=u[0]*y[0]+u[1]*y[1]+u[2]*y[2],b=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],v=(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])*b-f*f;if(Math.abs(v)<a)return!1;let _=(m*f-g*b)/v,w=(m+f*_)/b;o&&(_=t.clamp(_,0,1),w=t.clamp(w,0,1));const S=n.sv3d.get(),x=n.sv3d.get();return S[0]=l[0]+_*y[0],S[1]=l[1]+_*y[1],S[2]=l[2]+_*y[2],x[0]=p[0]+w*h[0],x[1]=p[1]+w*h[1],x[2]=p[2]+w*h[2],s.tA=_,s.tB=w,s.pA=S,s.pB=x,s.distance2=i.squaredDistance(S,x),!0}const d={tA:0,tB:0,pA:o.create(),pB:o.create(),distance2:0},u=new r.ObjectStack(()=>s());e.closestLineSegmentPoint=function(e,t,r){return!!p(e,t,!0,d)&&(i.copy(r,d.pA),!0)},e.closestRayDistance2=function(e,t){if(p(e,a(t.origin,t.direction),!1,d)){const{tA:t,pB:r,distance2:o}=d;if(t>=0&&t<=1)return o;if(t<0)return i.squaredDistance(e.origin,r);if(t>1)return i.squaredDistance(i.add(n.sv3d.get(),e.origin,e.vector),r)}return null},e.copy=function(e,t=s()){return l(e.origin,e.vector,t)},e.create=s,e.distance2=function(e,r){const o=i.subtract(n.sv3d.get(),r,e.origin),s=i.dot(e.vector,o),a=i.dot(e.vector,e.vector),l=t.clamp(s/a,0,1),c=i.subtract(n.sv3d.get(),i.scale(n.sv3d.get(),e.vector,l),o);return i.dot(c,c)},e.fromPoints=function(e,t,r=s()){return i.copy(r.origin,e),i.subtract(r.vector,t,e),r},e.fromValues=l,e.pointAt=function(e,t,r){return i.add(r,e.origin,i.scale(r,e.vector,t))},e.projectPoint=function(e,t,r){return c(e,t,0,1,r)},e.projectPointClamp=c,e.wrap=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/measurementUtils":function(){define(["exports","../../geometry/ellipsoidUtils","../../geometry/spatialReferenceEllipsoidUtils","../../geometry/support/spatialReferenceUtils"],function(e,t,r,i){"use strict";e.computeEuclideanMeasurementSR=function(e){return i.isEarth(e)?i.isWGS84(e)||i.isWebMercator(e)||i.isCGCS2000(e)||t.isSphericalECEF(e)?r.WGS84ECEFSpatialReference:e:r.getSphericalPCPF(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],function(e,t,r,i){"use strict";const o=new r(t.SphericalECEFSpatialReferenceLike),n=new r(t.SphericalPCPFMarsLike),s=new r(t.SphericalPCPFMoonLike),a=new r(t.WGS84ECEFSpatialReferenceLike),l=new Map,c=n.wkt.toUpperCase(),p=s.wkt.toUpperCase();e.SphericalECEFSpatialReference=o,e.SphericalPCPFMars=n,e.SphericalPCPFMoon=s,e.WGS84ECEFSpatialReference=a,e.cleanupSpatialReferenceEllipsoidUtils=function(){l.clear()},e.getSphericalPCPF=function(e){const t=l.get(e);if(t)return t;let r=o;if(e)if(e===n)r=n;else if(e===s)r=s;else{const t=e.wkid,o=e.latestWkid;if(null!=t||null!=o)i.isWKIDFromMars(t)||i.isWKIDFromMars(o)?r=n:(i.isWKIDFromMoon(t)||i.isWKIDFromMoon(o))&&(r=s);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===c?r=n:e===p&&(r=s)}}}return l.set(e,r),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geodesicAreaMeasurementUtils":function(){define(["require","exports","../../core/quantityUtils","../../geometry/support/geodesicUtils","./geodesicMeasurementUtils"],function(e,t,r,i,o){"use strict";function n(e){return r.createArea(Math.abs(i.geodesicAreas([e],"square-meters")[0]),"square-meters")}t.loadGeodesicAreaMeasurementUtils=async function(){return t=await new Promise((t,r)=>e(["../../geometry/geometryEngine"],t,r)),{geodesicArea(e){const{spatialReference:i}=e;return o.geodesicMeasure(i,n,e=>function(e,t){try{return r.createArea(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(e){return null}}(t,e),e)}};var t},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/automaticLengthMeasurementUtils":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","./euclideanLengthMeasurementUtils","./geodesicLengthMeasurementUtils"],function(e,t,r,i){"use strict";const o=t.create(),n=t.create();e.loadAutomaticLengthMeasurementUtils=async function(){return e=await i.loadGeodesicLengthMeasurementUtils(),{autoLength2D:t=>e.geodesicLength(t)??r.euclideanHorizontalLength(t),autoDistanceBetweenPoints2D:(t,i)=>e.geodesicDistanceBetweenPoints(t,i)??r.euclideanHorizontalDistanceBetweenPoints(t,i),autoDistance2D:(t,i,s)=>(o[0]=t[0],o[1]=t[1],o[2]=3===t.length?t[2]:0,n[0]=i[0],n[1]=i[1],n[2]=3===i.length?i[2]:0,e.geodesicDistance(o,n,s)??r.euclideanHorizontalDistance(o,n,s))};var e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/euclideanLengthMeasurementUtils":function(){define(["exports","../../core/quantityUtils","../../core/unitUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/projection/projectVectorToVector","../../geometry/support/spatialReferenceUtils","./measurementUtils"],function(e,t,r,i,o,n,s,a){"use strict";function l(e,i){const{hasZ:o,spatialReference:n}=e,s=a.computeEuclideanMeasurementSR(n);let l=0;const c=r.lengthUnitFromSpatialReference(s);if(null==c)return null;const p=0===i?d:u;for(const t of e.paths){if(t.length<2)continue;const e=t.length-1;for(let r=0;r<e;++r){const e=t[r];m[0]=e[0],m[1]=e[1],m[2]=o?e[2]:0;const i=t[r+1];f[0]=i[0],f[1]=i[1],f[2]=o?i[2]:0;const s=p(m,f,n);if(null==s)return null;l+=s.value}}return t.createLength(l,c)}function c(e,i){const o=r.verticalLengthUnitFromSpatialReference(i);return null!=o?t.createLength(e??0,o):null}function p(e,r,i){const o=y(e,r,i);return null!=o?{direct:t.createLength(o.direct,o.unit),horizontal:t.createLength(o.horizontal,o.unit),vertical:t.createLength(o.vertical,o.unit)}:null}function d(e,r,i){const o=y(e,r,i,0);return null!=o?t.createLength(o.direct,o.unit):null}function u(e,r,i){const o=y(e,r,i,1);return null!=o?t.createLength(o.horizontal,o.unit):null}function h(e,r,i){const o=y(e,r,i,2);return null!=o?t.createLength(o.verticalSigned,o.unit):null}function y(e,t,o,s){const l=a.computeEuclideanMeasurementSR(o),c=r.lengthUnitFromSpatialReference(l);if(null==c)return null;const p=t[2]-e[2];if(2===s)return{verticalSigned:p,unit:c};if(!n.projectVectorToVector(e,o,g,l)||!n.projectVectorToVector(t,o,b,l))return null;if(0===s)return{direct:i.distance(b,g),unit:c};if(i.set(v,e[0],e[1],t[2]),!n.projectVectorToVector(v,o,v,l))return null;const d=i.distance(v,b);return 1===s?{horizontal:d,unit:c}:{direct:i.distance(b,g),horizontal:d,vertical:Math.abs(p),unit:c}}const m=o.create(),f=o.create(),g=o.create(),b=o.create(),v=o.create();e.elevationFromPoint=function(e){return null!=e?c(e.hasZ?e.z:0,e.spatialReference):null},e.elevationFromZ=c,e.euclideanDirectDistance=d,e.euclideanDirectDistanceBetweenPoints=function(e,t){const{spatialReference:r}=e;return s.equals(r,t.spatialReference)?(m[0]=e.x,m[1]=e.y,m[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,d(m,f,r)):null},e.euclideanDistance=p,e.euclideanDistanceBetweenPoints=function(e,t){const{spatialReference:r}=e;return s.equals(r,t.spatialReference)?(m[0]=e.x,m[1]=e.y,m[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,p(m,f,r)):null},e.euclideanHorizontalDistance=u,e.euclideanHorizontalDistanceBetweenPoints=function(e,t){const{spatialReference:r}=e;return s.equals(r,t.spatialReference)?(m[0]=e.x,m[1]=e.y,m[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,u(m,f,r)):null},e.euclideanHorizontalLength=function(e){return l(e,1)},e.euclideanLength=function(e){return l(e,0)},e.verticalDistance=function(e,r,i){const o=y(e,r,i,2);return null!=o?t.createLength(Math.abs(o.verticalSigned),o.unit):null},e.verticalSignedDistance=h,e.verticalSignedDistanceBetweenPoints=function(e,t){const{spatialReference:r}=e;return s.equals(r,t.spatialReference)?(m[0]=e.x,m[1]=e.y,m[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,h(m,f,r)):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Sketch/support/OperationHandle":function(){define(["exports","../../../chunks/tslib.es6","../../../core/compilerUtils","../../../core/Evented","../../../core/accessorSupport/decorators/property","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s,a){"use strict";e.OperationHandle=class extends i.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:r.neverReached(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}},t.__decorate([o.property()],e.OperationHandle.prototype,"activeComponent",void 0),t.__decorate([o.property()],e.OperationHandle.prototype,"cancelled",void 0),t.__decorate([o.property()],e.OperationHandle.prototype,"history",void 0),t.__decorate([o.property()],e.OperationHandle.prototype,"tool",null),t.__decorate([o.property()],e.OperationHandle.prototype,"type",void 0),t.__decorate([o.property()],e.OperationHandle.prototype,"canUndo",null),t.__decorate([o.property()],e.OperationHandle.prototype,"canRedo",null),t.__decorate([o.property()],e.OperationHandle.prototype,"onEnd",void 0),t.__decorate([o.property()],e.OperationHandle.prototype,"undo",null),t.__decorate([o.property()],e.OperationHandle.prototype,"redo",null),t.__decorate([o.property()],e.OperationHandle.prototype,"toggleTool",void 0),t.__decorate([o.property()],e.OperationHandle.prototype,"addToSelection",void 0),t.__decorate([o.property()],e.OperationHandle.prototype,"removeFromSelection",void 0),e.OperationHandle=t.__decorate([a.subclass("esri.widgets.Sketch.support.OperationHandle")],e.OperationHandle),e.CreateOperationHandle=class extends e.OperationHandle{},t.__decorate([o.property()],e.CreateOperationHandle.prototype,"activeComponent",void 0),e.CreateOperationHandle=t.__decorate([a.subclass("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],e.CreateOperationHandle),e.UpdateOperationHandle=class extends e.OperationHandle{},t.__decorate([o.property()],e.UpdateOperationHandle.prototype,"activeComponent",void 0),e.UpdateOperationHandle=t.__decorate([a.subclass("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],e.UpdateOperationHandle),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/UpdateFeaturesWorkflow":function(){define(["../../chunks/tslib.es6","../../core/arrayUtils","../../core/Collection","../../core/Error","../../core/Logger","../../core/maybe","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/accessorSupport/decorators/subclass","../../layers/support/layerUtils","../../support/elevationInfoUtils","../BatchAttributeForm/BatchAttributeFormViewModel","./UpdateFeaturesWorkflowData","./Workflow","./workflowUtils","./support/SketchController"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f){"use strict";var g;const b=()=>o.getLogger("esri.widgets.Editor.UpdateFeaturesWorkflow");let v=g=class extends y{constructor(e){super(e),this.type="update-features",this._formViewModel=null,this._sketchController=null}async initialize(){this._initializeFormViewModel();try{await this._updatingHandles.addPromise((async()=>{const{fullFeatures:e}=await this.data.when();this._formViewModel.features=new r(e),await this._initializeVisuals(e)})())}catch(e){this.cancel({force:!0,error:new i("update-features-workflow:initialize","Failed to initialize the workflow data.",e)})}}destroy(){this._sketchController=n.destroyMaybe(this._sketchController),this._formViewModel.destroy()}get features(){return this.data.features}get formViewModel(){return this._formViewModel}get hasPendingEdits(){const{data:e}=this;return e.features.some(t=>!!e.getPendingEditsForFeature(t)?.modified)}get parent(){return this.data.parent}get parentLayer(){return this.parent?.data.editorItem.layer}get selectedFeature(){return this.data.selectedFeature}get sketchViewModel(){return this._sketchController?.viewModel}get updating(){return this._updatingHandles.updating||this._formViewModel.updating||!!this._sketchController?.updating}async commit(){const{data:e,_formViewModel:t}=this;for(const r of e.fullFeatures)S(e.getPendingEditsForFeature(r),t.getValues(r));await super.commit()}static create(e){const{applyEdits:r,applyEditsFeatureService:i,...o}=e,n=t.unique(e.features.map(e=>e.sourceLayer??e.layer)).map(t=>e.viewModel.editorItems.find(e=>e.layer===t)).filter(t.isSome),s=new g({data:new h({...o,editorItems:n}),onCommit:_(e.applyEdits)});return s._set("steps",[{id:"editing-features",async setUp(){},async tearDown(){}}]),s}async deleteAndCommit(){return this.data.stageDelete(),this.commit()}enter(){throw new Error("Method not implemented.")}exit(e){throw new Error("Method not implemented.")}async reset(){}async save(){const{formViewModel:e}=this;e.submit(),e.valid&&await super.save()}async start(){await super.start(),await s.whenOnce(()=>!this.updating)}_initializeFormViewModel(){const{data:e}=this,t=e.viewModel.view,r=e.getEditorItemForLayer(w(e)),i=new u({editType:"UPDATE",map:t?.map,readOnly:!1===r?.capabilities.update.attributes,spatialReference:t?.spatialReference,timeZone:e.timeZone});this._formViewModel=i,this.addHandles(i.on("value-change",t=>{for(const r of t.features)e.getPendingEditsForFeature(r)?.setAttribute(t.fieldName,t.value);this._sketchController?.notifyAttributesChanged(t)}))}async _initializeHighlights(e,t,r){const i=await m.whenEditorLayerView(r,t);this.addHandles(i.highlight(e))}async _initializeSketchController(e,t,r){const i=new f.SketchController({sourceLayer:t,view:r,features:e});this._sketchController=i,await s.whenOnce(()=>!i.updating);const{data:o}=this;await i.startUpdatingFeatures(e,e=>{const t=[];for(const{feature:r,geometry:i}of e)o.getPendingEditsForFeature(r)?.updateGeometry(i),t.push(r);this._formViewModel.notifyGeometriesChanged(t)},()=>{b().warnOnce("editor:batch-update-visual-variables","UpdateFeaturesWorkflow does not currently support modifying visual variables through the scale and rotate tools.")})}async _initializeVisuals(e){const{data:t}=this,{view:r}=t.viewModel;if(!r)return;const i=w(t);if(p.isTable(i))return;const o=t.getEditorItemForLayer(i);return!o?.capabilities.update.geometry||"3d"===r?.type&&d.hasEffectiveFeatureExpressionInfo(i.elevationInfo)?this._initializeHighlights(e,i,r):this._initializeSketchController(e,i,r)}};function _(e){return async t=>{const r=w(t),i=[],o=[];for(const e of t.fullFeatures){const r=t.getPendingEditsForFeature(e),n=r?.stagedForDelete;if(!r?.modified&&!n)continue;const s=e.clone();if(!r?.attributesModified||n){const t=e.sourceLayer;if(!t){b().warn("Feature has no sourceLayer. It will not be included in any applyEdits payload.");continue}const r=t.objectIdField;if(s.attributes={[r]:e.getAttribute(r)},"scene"===t.type&&null!=t.infoFor3D){const r=t.associatedLayer?.globalIdField;null!=r&&s.setAttribute(r,e.getAttribute(r))}}r?.geometryModified&&!n||(s.geometry=null),n?o.push(s):i.push(s)}if(i.length+o.length===0)return void b().warn("No edits to apply. Workflow will finish without sending an applyEdits request.");const n={updateFeatures:i.length>0?i:void 0,deleteFeatures:o.length>0?o:void 0};await e(r,n)}}function w(e){if(e.layers.length>1)throw m.makeMultipleSourceLayersError();return e.layers[0]}function S(e,t){if(!e||!e.feature)return;const{attributes:r}=e.feature;Object.keys(t).some(e=>t[e]!==r[e])&&e.updateAttributes(t)}return e.__decorate([a.property()],v.prototype,"features",null),e.__decorate([a.property()],v.prototype,"formViewModel",null),e.__decorate([a.property()],v.prototype,"hasPendingEdits",null),e.__decorate([a.property()],v.prototype,"parent",null),e.__decorate([a.property()],v.prototype,"parentLayer",null),e.__decorate([a.property()],v.prototype,"selectedFeature",null),e.__decorate([a.property()],v.prototype,"sketchViewModel",null),e.__decorate([a.property()],v.prototype,"type",void 0),e.__decorate([a.property()],v.prototype,"updating",null),e.__decorate([a.property()],v.prototype,"_formViewModel",void 0),e.__decorate([a.property()],v.prototype,"_sketchController",void 0),v=g=e.__decorate([c.subclass("esri.widgets.Editor.UpdateFeaturesWorkflow")],v),v})},"esri/widgets/Editor/UpdateFeaturesWorkflowData":function(){define(["../../chunks/tslib.es6","../../core/arrayUtils","../../core/Error","../../core/handleUtils","../../core/Promise","../../core/promiseUtils","../../core/ReactiveMap","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./Edits","./workflowUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u){"use strict";let h=class extends o.EsriPromise{constructor(e){super(e),this.editorItems=[],this.features=[],this.parent=null,this.selectedFeature=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null,this._editorItemsByLayer=new s,this._fullFeatures=new Map,this._pendingEdits=new s}initialize(){const e=new AbortController;this.addResolvingPromise(this._initializeFullFeatures(e.signal).then(t=>{n.throwIfAborted(e.signal),this._initializeEdits(t)}).catch(e=>{if(n.isAbortError(e))throw new r("update-features-workflow:full-features-aborted","Fetching of full features was aborted.");throw e})),this.addHandles(i.abortHandle(e)),this._initializeEditorItemsByLayer()}get fullFeatures(){return Array.from(this._fullFeatures.values())}get layers(){return t.unique(this.features.map(e=>e.sourceLayer).filter(t.isSome))}set timeZone(e){this._set("timeZone",e),this._pendingEdits.forEach(t=>{t.timeZone=e})}getEditorItemForLayer(e){return this._editorItemsByLayer.get(e)}getFeatureTitle(e){return this._pendingEdits.get(e)?.displayTitle}getPendingEditsForFeature(e){return this._pendingEdits.get(this._fullFeatures.get(e)??e)}isSubmittable(e){const t=this._pendingEdits.get(e);return!!t&&(t.submittable||t.isAssociation)}stageDelete(){for(const e of this._pendingEdits.values())e.stageDelete()}_initializeEditorItemsByLayer(){for(const e of this.editorItems)this._editorItemsByLayer.set(e.layer,e)}_initializeEdits(e){const{timeZone:t}=this;for(const r of e){const e=new d({feature:r,timeZone:t});e.trackChanges(),this._pendingEdits.set(r,e)}}async _initializeFullFeatures(e){const{spatialReference:t}=this.viewModel.view,i=this._fullFeatures,o=u.groupFeaturesByLayer(this.features),n=Array.from(o.entries()).map(async([o,n])=>{const s=await u.fetchFullFeatures(n,o,t,e);if(s.length!==n.length)throw new r("editor:update-features-workflow:fetch-full-features-incomplete","Failed to fetch full features for one or more of the provided features.");const a=o.objectIdField,l=(e,t)=>e.attributes[a]>t.attributes[a]?1:-1,c=n.sort(l),p=s.sort(l);for(let e=0;e<c.length;e++)i.set(c[e],p[e]);return s});return(await Promise.all(n)).flat()}};return e.__decorate([a.property({constructOnly:!0})],h.prototype,"editorItems",void 0),e.__decorate([a.property({constructOnly:!0})],h.prototype,"features",void 0),e.__decorate([a.property()],h.prototype,"fullFeatures",null),e.__decorate([a.property()],h.prototype,"layers",null),e.__decorate([a.property()],h.prototype,"parent",void 0),e.__decorate([a.property()],h.prototype,"selectedFeature",void 0),e.__decorate([a.property({constructOnly:!0})],h.prototype,"sketchOptions",void 0),e.__decorate([a.property()],h.prototype,"snappingManager",void 0),e.__decorate([a.property()],h.prototype,"timeZone",null),e.__decorate([a.property()],h.prototype,"viewModel",void 0),e.__decorate([a.property()],h.prototype,"_fullFeatures",void 0),h=e.__decorate([p.subclass("esri.widgets.Editor.UpdateFeaturesWorkflowData")],h),h})},"esri/widgets/Editor/support/SketchController":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/arrayUtils","../../../core/Error","../../../core/handleUtils","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/SetUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../../core/support/UpdatingHandles","../../../layers/GraphicsLayer","../../../views/interactive/sketch/SketchOptions","../workflowUtils","../../Sketch/SketchViewModel"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g){"use strict";const b=Symbol();function v({rotation:e,size:t},r){return{rotation:e?f.getRotationVariableAttribute(e,r.rotation):null,size:t?f.getSizeVariableAttribute(t,r.size):null}}e.SketchController=class extends r{constructor(e){super(e),this.features=[],this.sketchOptions=new m,this.snappingManager=null,this.sourceLayer=null,this.view=null,this.viewModel=null,this._sketchGraphics=new Map,this._sketchLayer=null,this._updatingHandles=new h.UpdatingHandles,this._visualVariableAttributes=new Map,this._visualVariablesForLayer=null,this._webStyleCache=new Map}async initialize(){this._visualVariablesForLayer=f.getVisualVariablesForLayer(this.sourceLayer),this._initializeSketchGraphics(),this._initializeSketchLayer(),await this._updatingHandles.addPromise(this._initializeSketchViewModel())}destroy(){const{_sketchLayer:e,view:t}=this;t?.destroyed||t?.map.remove(e),e.destroy(),this.viewModel.destroy()}get updating(){return this._updatingHandles.updating}async enter(){throw new Error("enter() not implemented")}async exit(){throw new Error("exit() not implemented")}notifyAttributesChanged({features:e,fieldName:t}){const r=this._webStyleCache,i=this.view.scale,o=this._updatingHandles;for(const n of e){const e=this._sketchGraphics.get(n),s=n.getAttribute(t);if(!e||e.getAttribute(t)===s)continue;e.setAttribute(t,s);const a=this._visualVariableAttributes.get(n);null==a?.size||a.size.isUpdatingInteractively||a.size.field!==t||a.size.setInitialValue(s),null==a?.rotation||a.rotation.isUpdatingInteractively||a.rotation.field!==t||a.rotation.setInitialValue(s),o.addPromise(f.updateGraphicSymbolWhenRequired(e,r,i))}}async startUpdatingFeatures(e,t,r){const{_sketchGraphics:o,sourceLayer:s,view:l,viewModel:c,_webStyleCache:p}=this,d=e.map(e=>o.get(e)).filter(i.isSome),u={};this.removeHandles(b),c.complete();let h=null;if(1===e.length){const t=e[0],i=this._visualVariableAttributes.get(t);(i?.rotation||i?.size)&&(await f.setVisualVariablesAndElevationInfoForUpdate({sketchViewModel:c,graphic:d[0],sourceLayer:s,visualVariables:i,webStyleCache:p}),"point"===s.geometryType&&(u.enableRotation=null!=i.rotation,u.enableScaling=null!=i.size,h=async e=>{const o=e.graphics[0];f.visualVariableInteractiveUpdate(l,o,e,i)&&(r?.([{feature:t,attributes:o.attributes}],e),this._updatingHandles.addPromise(f.updateGraphicSymbolWhenRequired(o,p,"2d"===l.type?l.scale:null)))}))}else u.tool="move";const y=()=>c.update(d,u),m=c.on("update",r=>{if("complete"===r.state){if(null===l.activeTool)return void y();const e=new AbortController,t=n.abortHandle(e);return this.addHandles(t,b),void this._updatingHandles.addPromise(a.whenOnce(()=>null===l.activeTool,e.signal).then(async()=>{e.signal.aborted||(e.abort(),await y())}))}const s=e.map(e=>{const t=o.get(e);return t?{feature:e,geometry:t.geometry}:null}).filter(i.isSome);t(s,r),h?.(r)});await y(),this.addHandles(m,b),c.addHandles(m)}_initializeSketchGraphics(){const{features:e,_sketchGraphics:t,sourceLayer:r,_visualVariableAttributes:i}=this,o=this._visualVariablesForLayer,n=o.rotation?.field,s=o.size?.field,a={rotation:n?r.getField(n):null,size:s?r.getField(s):null},l=!(!a.rotation&&!a.size);for(const r of e)t.set(r,r.clone()),l&&i.set(r,v(o,a))}_initializeSketchLayer(){const{view:e}=this,t=new y({elevationInfo:this.sourceLayer.elevationInfo,internal:!0,listMode:"hide",title:"SketchController layer"});this._sketchLayer=t,e.map.add(t),this._updatingHandles.addPromise(e.whenLayerView(t))}async _initializeSketchViewModel(){const{_sketchGraphics:e,view:t,_webStyleCache:r}=this,i=Array.from(e.entries()),o=new g({allowDeleteKey:!1,defaultUpdateOptions:{multipleSelectionEnabled:!1},layer:this._sketchLayer,sketchOptions:this.sketchOptions,snappingManager:this.snappingManager,updateOnGraphicClick:!1,view:this.view});this.viewModel=o;const n=s.debounce(e=>Promise.all(i.map(([,t])=>f.updateGraphicSymbolWhenRequired(t,r,e))));await n("2d"===t.type?t.scale:null),"2d"===t.type&&this.addHandles(a.watch(()=>t.scale,e=>n(e))),this.addHandles(await Promise.all(i.map(([e,t])=>f.swapForEditingSession(o,e,t))))}},t.__decorate([c.property()],e.SketchController.prototype,"features",void 0),t.__decorate([c.property()],e.SketchController.prototype,"sketchOptions",void 0),t.__decorate([c.property()],e.SketchController.prototype,"snappingManager",void 0),t.__decorate([c.property()],e.SketchController.prototype,"sourceLayer",void 0),t.__decorate([c.property()],e.SketchController.prototype,"updating",null),t.__decorate([c.property()],e.SketchController.prototype,"view",void 0),t.__decorate([c.property()],e.SketchController.prototype,"viewModel",void 0),t.__decorate([c.property()],e.SketchController.prototype,"_sketchGraphics",void 0),t.__decorate([c.property()],e.SketchController.prototype,"_sketchLayer",void 0),t.__decorate([c.property()],e.SketchController.prototype,"_visualVariablesForLayer",void 0),e.SketchController=t.__decorate([u.subclass("esri.widgets.Editor.support.SketchController")],e.SketchController),e.createSketchController=function({features:t,sketchOptions:r,snappingManager:i,view:n}){const s=new Set(t.map(e=>e.sourceLayer));if(1!==s.size)throw new o("editor:features-must-belong-to-same-layer","All features must belong to the same layer.");const a=l.first(s);return new e.SketchController({view:n,features:t,sketchOptions:r,snappingManager:i,sourceLayer:a})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/UpdateWorkflow":function(){define(["require","../../chunks/tslib.es6","../../Graphic","../../core/Error","../../core/handleUtils","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/Queue","../../core/reactiveUtils","../../core/SetUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/support/editableLayers","../../layers/support/layerUtils","../../rest/featureService/utils","../../views/draw/support/HighlightHelper","../../views/input/InputManager","../../views/interactive/sketch/SketchOptions","../../views/support/HighlightDefaults","./CreateFeaturesWorkflow","./UpdateFeatureWorkflow","./UpdateRecordWorkflow","./UpdateWorkflowData","./Workflow","./workflowUtils","../Feature/support/featureUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F,k,I){"use strict";var T;let L=T=class extends F{constructor(e){super(e),this._workflowStack=new l(p.last),this._sketchStack=new l(p.last),this.data=void 0,this.type="update"}destroy(){this._drainWorkflowStack(e=>e.cancel({force:!0}))}get activeEditorItem(){return this.activeWorkflow?.data.editorItem??void 0}get activeFeatureFormViewModel(){return this.activeWorkflow?.featureFormViewModel}get activeUtilityNetworkAssociationAddAssociationViewModel(){return"add-association"===this.activeWorkflow?.type?this.activeWorkflow.utilityNetworkAssociationAddAssociationViewModel:null}get activeSketchViewModel(){return this._sketchStack.peek()?.viewModel}get canDeleteAssociation(){const{activeFeatureFormViewModel:e}=this;if(!this.activeWorkflow||!this.data.viewModel.view?.map||!e)return!1;const{activeAssociation:t,feature:r}=e;return!(!t||!r?.sourceLayer||!f.isFeatureLayer(r?.sourceLayer)&&!f.isSubtypeSublayer(r?.sourceLayer))}get activeWorkflow(){return this._workflowStack.last()}get updating(){return this._updatingHandles.updating||!!this.activeWorkflow?.updating}get hasPreviousStep(){const e=this.activeWorkflow?.featureFormViewModel;return this._stepIndex>0||this.nestedWorkflowCount>1||null!=e?.relationshipId||"view"!==this.data.viewModel.attachmentsViewModel.mode||null!=e?.associationId||null!=e?.associatedLayer}get hasUpdatableCandidates(){const{candidates:e,viewModel:t}=this.data;return e.some(({layer:e})=>t.findEditorItemForLayer(e)?.supportsUpdateWorkflow)}get nestedWorkflowCount(){return this._workflowStack.length}get shouldShowAttachments(){return!!this.activeEditorItem?.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return!!this.activeEditorItem?.capabilities.update.attachments.enabled}get hasPendingEdits(){return Array.from(this._workflowStack).some(e=>e.hasPendingEdits)}get helpMessage(){return this.activeWorkflow?.helpMessage?this.activeWorkflow.helpMessage:"awaiting-feature-to-update"===this.stepId?"select":void 0}get reliesOnOwnerAdminPrivileges(){return this.activeWorkflow?.reliesOnOwnerAdminPrivileges??!1}get hasInvalidFormTemplate(){return!!this.activeEditorItem?.hasInvalidFormTemplate}async back(e=()=>Promise.resolve(!0)){const{activeWorkflow:t}=this,r=t?.featureFormViewModel;if(r?.activeRelationshipInput){const e=r.activeRelationshipInput;if(e.activeCategory)return void(e.activeCategory=null);if(null!=r.relationshipId)return void(r.relationshipId=null);if(e.showAllEnabled)return void(e.showAllEnabled=!1)}if("add-association"===t?.type){const{activeUtilityNetworkAssociationAddAssociationViewModel:e}=this;if(e?.filterOptionsVisible)return void(e.filterOptionsVisible=!1);e?.featureSpatialItems.length&&e.reset()}if(null==r?.associatedLayer)if(null==r?.associationId)if("create-features"===t?.type&&t.hasPreviousStep)await t.previous({cancelCurrentStep:!0});else if(t){if(t.hasPendingEdits&&!r?.disabled&&!await e())return;t.hasPreviousStep?await t.previous({cancelCurrentStep:!0}):await this.cancelActiveWorkflow({force:!0})}else this.hasPreviousStep?await this.previous({cancelCurrentStep:!0}):await this.cancel({force:!0});else r.associationId=null;else r.associatedLayer=null}async cancelActiveWorkflow(e){await(this.activeWorkflow?.cancel(e)),await this._popWorkflow()}async commit(){await this._drainWorkflowStack(e=>e.commit()),await super.commit()}static create(e){const{viewModel:t,snappingManager:r,startAt:i,addAttachmentsCallback:o,applyEditsCallback:n,applyEditsFeatureServiceCallback:s}=e,a=e.sketchOptions??new _,l=new T({data:new C({addAttachmentsCallback:o,applyEditsCallback:n,applyEditsFeatureServiceCallback:s,sketchOptions:a,snappingManager:r,viewModel:t}),onCommit:async()=>{}});return l._set("steps",this._createWorkflowSteps(l,i)),l}async save(){const{activeFeatureFormViewModel:e}=this;if(e){if(e.submit(),!e.submittable||e.pendingSubtypeChoice)return;const t=e.getValues();if(e.validateContingencyConstraints(t,{includeIncompleteViolations:!0}).length>0)return}this.nestedWorkflowCount>1?(await(this.activeWorkflow?.commit()),await this._popWorkflow()):await this.commit()}async startCreatingRelatedRecord(e){try{const t=this._createNestedCreateFeaturesWorkflow(e);await this._pushWorkflow(t)}catch(e){throw new i("editor:unable-to-start-creating","Could not begin updating the provided feature or table record.",{error:e})}}async startUpdating(e,t,r=!1){try{const i=await this._createNestedUpdateWorkflow(e,r,t);await this._pushWorkflow(i)}catch(e){throw new i("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:e})}}async startAddAssociation(e,t,r){try{const i=await this._createNestedAddAssociationWorkflow(e,t,r);await this._pushWorkflow(i)}catch(e){throw new i("editor:unable-to-start-updating","Could not begin updating the provided feature or table record.",{error:e})}}async deleteActiveFeature(){const{activeWorkflow:e}=this;if(!e)throw new i("editor:nothing-to-delete","There is no feature to delete");const t=k.isUpdateRecordWorkflow(e);t?(e.stageDelete(),e.data.edits.feature===this.data.rootFeature&&this._removeRootFeatureFromCandidates()):await e.cancel(),this.nestedWorkflowCount<2?t?await this.commit():await this.cancel({force:!0}):(t&&await e.commit(),await this._popWorkflow(),await this._returnToPageWithContent())}async deleteActiveAssociation(){if(!this.canDeleteAssociation)throw new i("editor:nothing-to-delete","There is no association to delete");await this._deleteActiveAssociation(),await this._popWorkflow(),await this._returnToPageWithContent()}async cancelAll(){await this._drainWorkflowStack(e=>e.cancel({force:!0}))}async _deleteActiveAssociation(){const{activeFeatureFormViewModel:e,data:t}=this,{activeAssociation:r,feature:o}=e,{applyEditsFeatureServiceCallback:n,viewModel:s}=t,{sourceLayer:a}=o,l=f.isSubtypeSublayer(a)&&a.parent?a.parent:a,c=g.createFeatureServices([l]),p=c.values().next().value?.featureService;if(!p)throw new i("editor:failed-to-delete-association","Could not retrieve feature service needed to delete association");await(p?.load());const d=s.view.map,u=I.findUtilityNetwork(d,l);await(u?.networkSystemLayers.loadAssociationsTable());const h=u?.generateDeleteAssociations([r]);if(!h)throw new i("editor:failed-to-delete-association","Could not create payload needed to delete association");const y=u?.gdbVersion??void 0;await n(p,[h],{gdbVersion:y,globalIdUsed:!0})}_removeRootFeatureFromCandidates(){const{candidates:e,rootFeature:t}=this.data;if(0===e.length||!t)return;const r=e.indexOf(t);r>-1&&e.splice(r,1)}async _returnToPageWithContent(){const{activeFeatureFormViewModel:e}=this;if(!e?.activeAssociationInput)return;const{activeAssociationInput:t,associationId:r}=e;await t.refresh(),t.associatedLayer&&!t.associatedFeatures?.length&&(e.associatedLayer=null),null==r||t.associatedFeatureInfos.size||(e.associationId=null)}_createNestedCreateFeaturesWorkflow(e){const{relatedLayer:t}=e,{addAttachmentsCallback:r,applyEditsCallback:o,applyEditsFeatureServiceCallback:n,sketchOptions:s,snappingManager:a,viewModel:l}=this.data;if(!m.isEditableLayer(t))throw new i("editor:unsupported-layer","Editing is not supported on the provided layer");const c=this._getCreationInfoForNestedCreateFeaturesWorkflow(e),p=c.template||c.initialFeature?"creating-features":"awaiting-feature-creation-info",d="create-features"!==this.activeWorkflow?.type&&"add-association"!==this.activeWorkflow?.type?this.activeWorkflow:void 0;return S.create({addAttachmentsCallback:r,applyEditsCallback:o,applyEditsFeatureServiceCallback:n,creationInfo:c,isNested:!0,parent:d,sketchOptions:s,snappingManager:a,startAt:p,viewModel:l})}_getCreationInfoForNestedCreateFeaturesWorkflow(e){const{relatedLayer:t}=e;if(!m.isEditableLayer(t)||f.isSubtypeGroupLayer(t))throw new i("editor:unsupported-layer","Editing is not supported on the provided layer");const{viewModel:o}=this.data,n={layer:t,maxFeatures:1},s=this._makeRelatedRecordAttributes(e),a=o.getTemplatesForLayer(t);return a?.length>0?(n.attributeOverrides=s,1===a.length&&(n.template=a[0])):n.initialFeature=new r({sourceLayer:t,attributes:s}),n}async _createNestedUpdateWorkflow(e,t,r){const i=f.isTable(e.sourceLayer)?M.UpdateRecordWorkflow:x.UpdateFeatureWorkflow,{applyEditsCallback:o,applyEditsFeatureServiceCallback:n,sketchOptions:s,snappingManager:a,viewModel:l}=this.data,p="create-features"!==this.activeWorkflow?.type&&"add-association"!==this.activeWorkflow?.type?this.activeWorkflow:void 0,d=await i.create({association:r,feature:e,parent:p,sketchOptions:s,snappingManager:a,viewModel:l,readOnly:t,applyEdits:o,applyEditsFeatureService:n,featureFormCallbacks:{addRelatedRecord:async e=>await this._updatingHandles.addPromise(this.startCreatingRelatedRecord(e)),editRelatedRecord:async({relatedFeature:e,readOnly:t})=>await this._updatingHandles.addPromise(this.startUpdating(e,void 0,t)),selectAssociatedFeature:async({feature:e,association:r})=>await this._updatingHandles.addPromise(this.startUpdating(e,r,t)),addAssociation:async e=>await this._updatingHandles.addPromise(this.startAddAssociation(e.feature,e.utilityNetwork,e.associationType))}});return await c.whenOnce(()=>!d.updating),d}async _createNestedAddAssociationWorkflow(t,r,i){const{AddAssociationWorkflow:o}=await new Promise((t,r)=>e(["./AddAssociationWorkflow"],t,r)),{applyEditsCallback:n,applyEditsFeatureServiceCallback:s,viewModel:a}=this.data,l="create-features"!==this.activeWorkflow?.type&&"add-association"!==this.activeWorkflow?.type?this.activeWorkflow:void 0,p=this.activeFeatureFormViewModel?.activeAssociationInput,d=await o.create({utilityNetwork:r,associationType:i,feature:t,parent:l,viewModel:a,associationInput:p,applyEdits:n,applyEditsFeatureService:s});return await c.whenOnce(()=>!d.updating),d}async _drainWorkflowStack(e){const t=this._workflowStack,r=[];for(const i of t){const t=e(i).finally(()=>i.destroy());this._updatingHandles.addPromise(t),r.push(t)}await Promise.all(r),this._workflowStack.clear(),this._sketchStack.clear()}_makeRelatedRecordAttributes(e){const{parentFeature:t,relatedLayer:r,relationshipId:i}=e;if(!I.isGraphicForRelatableFeatureSupportedLayer(t))return;const o=r.relationships?.find(e=>e.id===i);if(!o)return void this._logContinuingWithoutRelationshipWarning("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the destination layer.");if("origin"===o.role)return void this._logContinuingWithoutRelationshipWarning("unsupported-role","Creating new related records in the 'origin' table of a relationship is not yet supported");const n=t.sourceLayer;o.relatedTableId!==n.layerId&&this._logContinuingWithoutRelationshipWarning("invalid-argument-combination","The given parent feature does not belong to the relationship designated by the given relationship ID.");const s=n.relationships?.find(e=>e.id===i);if(!s)return void this._logContinuingWithoutRelationshipWarning("relationship-not-found","Could not begin creating a related record because the relationship specified could not be found on the origin layer.");const a=E(n,s),l=t.getAttribute(a);l||this._logContinuingWithoutRelationshipWarning("no-key-on-origin-feature","The given parent feature does not have a value for the relationship's origin primary key field.");const c=E(r,o);return{[c]:l}}async _popWorkflow(){this._workflowStack.pop()?.destroy(),this._sketchStack.pop();const e=await this._reconcileWorkflowStack();if(e.failureCount>0)throw new i("editor:next-workflow-failed","Popped the top workflow, but the next workflow in the stack failed to activate",e)}async _pushWorkflow(e){const t=this._workflowRequiresSketchViewModel(e);this.activeWorkflow?.exit({removeSketchHandles:t});const r=this._sketchStack,o=await(e?.start()),n=r.peek();o?(n?.exit(),r.push(o)):r.push(this._cloneSketchController(n)),this._workflowStack.push(e);const s=await this._reconcileWorkflowStack();if(s.failureCount>0)throw new i("editor:failed-to-start-updating-feature","Failed to enter the provided workflow.",s)}async _reconcileWorkflowStack(){const e=this._workflowStack,t=this._sketchStack;try{const r=e.peek();return await(r?.enter()),await(t.peek()?.enter()),{activeWorkflow:r,failureCount:0}}catch(r){e.pop().destroy(),t.pop();const{activeWorkflow:i,failureCount:o}=await this._reconcileWorkflowStack();return{activeWorkflow:i,failureCount:o+1}}}_cloneSketchController(e){return{enter:e?.enter??(async()=>{}),exit:e?.exit??(async()=>{}),viewModel:e?.viewModel}}_workflowRequiresSketchViewModel(e){const{type:t}=e;return"update-feature"===t||"create-features"===t&&!f.isTable(e.data.creationInfo?.layer)}static _createWorkflowSteps(e,t="awaiting-feature-to-update"){const{data:r}=e,n={"awaiting-feature-to-update":()=>({id:"awaiting-feature-to-update",async setUp(){const{spinnerViewModel:t}=r.viewModel,i=r.viewModel.view;i.activeTool=null;let n=null;e.addHandles(o.makeHandle(()=>{n=s.abortMaybe(n)}),this.id),r.rootFeature=null,r.candidates=[];const l=i.on("immediate-click",async o=>{const s=a.createResolver();e._updatingHandles.addPromise(s.promise);try{t.location=o.mapPoint,t.visible=!0,n?.abort();const{editorItems:s}=r.viewModel;n=new AbortController;const l=await o.defer(()=>new Promise((e,t)=>{a.onAbort(n?.signal,()=>t(a.createAbortError())),e(k.fetchCandidates(s,i,o,n?.signal))}));if(a.throwIfAborted(n),r.candidates=l.filter(e=>"fulfilled"===e.status).flatMap(e=>e.value).filter(e=>!e.isAggregate),t.visible=1===r.candidates.length,0===r.candidates.length)return;o.stopPropagation(),1===r.candidates.length?(r.rootFeature=r.candidates[0],e.go("editing-existing-feature").catch(()=>{}).then(()=>t.visible=!1)):e.next()}finally{s.resolve()}},v.ViewEventPriorities.TOOL),p=c.when(()=>null!=i.activeTool,()=>e.cancel({force:!0}),{once:!0});i.focus(),e.addHandles([l,p],this.id)},async tearDown(){0===r.candidates.length&&(r.viewModel.spinnerViewModel.visible=!1),e.removeHandles(this.id)}}),"awaiting-update-feature-candidate":()=>({id:"awaiting-update-feature-candidate",async setUp(){r.rootFeature=null;const{view:t}=r.viewModel;if(!t)return;const i=new b({view:t,highlightName:w.temporaryHighlightName});e.addHandles([c.watch(()=>r.rootFeature,(e,t)=>{i.remove(t),i.add(e)},c.sync),o.makeHandle(()=>i.removeAll())],this.id)},async tearDown(){e.removeHandles(this.id)}}),"editing-existing-feature":()=>({id:"editing-existing-feature",async setUp(){const{rootFeature:t,viewModel:r}=e.data;if(!t)throw new i("editor:no-feature-specified","Cannot setup the 'updating-existing-feature' step until the root feature is defined");await e.startUpdating(t),r.spinnerViewModel.visible=!1;const o=a.debounce(async()=>{await c.whenOnce(()=>!e.updating),e.previous()});e.addHandles([c.watch(()=>e.nestedWorkflowCount,(e,t)=>{0===e&&0!==t&&o()},c.sync)],this.id)},async tearDown(){await e.cancelAll(),e.removeHandles(this.id)}}),"adding-attachment":()=>({id:"adding-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){r.viewModel.attachmentsViewModel.mode="view"}}),"editing-attachment":()=>({id:"editing-attachment",parent:"editing-existing-feature",async setUp(){},async tearDown(){r.viewModel.attachmentsViewModel.mode="view"}})};return k.createWorkflowSteps(["awaiting-feature-to-update","awaiting-update-feature-candidate","editing-existing-feature","adding-attachment","editing-attachment"],t,n)}_logContinuingWithoutRelationshipWarning(e,t){n.getLogger(this).warn(`editor:${e}`,t,"The create operation will be allowed to proceed, but the resulting feature may not be related to the given parent feature.")}};function E(e,{keyField:t}){return e.getField(t)?.name??t}return t.__decorate([d.property()],L.prototype,"activeEditorItem",null),t.__decorate([d.property()],L.prototype,"activeFeatureFormViewModel",null),t.__decorate([d.property()],L.prototype,"activeUtilityNetworkAssociationAddAssociationViewModel",null),t.__decorate([d.property()],L.prototype,"activeSketchViewModel",null),t.__decorate([d.property()],L.prototype,"canDeleteAssociation",null),t.__decorate([d.property()],L.prototype,"activeWorkflow",null),t.__decorate([d.property()],L.prototype,"updating",null),t.__decorate([d.property()],L.prototype,"data",void 0),t.__decorate([d.property()],L.prototype,"hasPreviousStep",null),t.__decorate([d.property()],L.prototype,"hasUpdatableCandidates",null),t.__decorate([d.property()],L.prototype,"nestedWorkflowCount",null),t.__decorate([d.property()],L.prototype,"shouldShowAttachments",null),t.__decorate([d.property()],L.prototype,"shouldAllowAttachmentEditing",null),t.__decorate([d.property()],L.prototype,"hasPendingEdits",null),t.__decorate([d.property()],L.prototype,"helpMessage",null),t.__decorate([d.property()],L.prototype,"reliesOnOwnerAdminPrivileges",null),t.__decorate([d.property()],L.prototype,"hasInvalidFormTemplate",null),L=T=t.__decorate([y.subclass("esri.widgets.Editor.UpdateWorkflow")],L),L})},"esri/rest/featureService/utils":function(){define(["exports","../../layers/support/arcgisLayerUrl","./FeatureService"],function(e,t,r){"use strict";const i=(e,o)=>{for(const n of e)if("feature"===n.type||"subtype-group"===n.type){if(!n.url)continue;const e=t.parse(n.url).url.path,i=o.get(e);if(i)i.layers.push(n);else{const t=new r({url:e}),i=[n];o.set(e,{featureService:t,layers:i})}}else"group"===n.type&&i(n.layers.filter(e=>"feature"===e.type||"subtype-group"===e.type||"group"===e.type),o)};e.createFeatureServices=function(e){const t=new Map;return i(e,t),t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/UpdateFeatureWorkflow":function(){define(["exports","../../chunks/tslib.es6","../../core/Error","../../core/handleUtils","../../core/has","../../core/maybe","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/GraphicsLayer","../../support/elevationInfoUtils","../../views/support/layerViewUtils","./UpdateFeatureWorkflowData","./UpdateRecordWorkflow","./workflowUtils","../Sketch/SketchViewModel"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g){"use strict";var b;const v={...m.handleKeys,highlights:Symbol(),sketchGraphics:Symbol(),sketchViewModel:Symbol(),waitingForTool:Symbol()};e.UpdateFeatureWorkflow=b=class extends m.UpdateRecordWorkflow{constructor(e){super(e),this.type="update-feature",this._layerViewEditSession=null,this._sketchGraphicClone=null,this._sketchViewModel=null,this._webStyleCache=new Map}destroy(){this._layerViewEditSession?.rollback()}async commit(){this.removeHandles(v.sketchGraphics);try{const e=this.data.edits.stagedForDelete;await super.commit();const t=this._layerViewEditSession;e?t?.rollback():t?.commit()}catch(e){throw await this._configureSketchViewModel(),new r("editor-workflow:failed-to-commit","An error occurred when sending the updates to the service",{error:e})}}async start(){return await super.start(),await this._initializeSketchViewModel()}_initializeFeatureFormViewModel(){super._initializeFeatureFormViewModel(),this.addHandles([this._featureFormViewModel.on("value-change",e=>{this._layerViewEditSession?.setAttribute(e.fieldName,e.value)}),s.watch(()=>this._featureFormViewModel.feature?.sourceLayer,e=>this._sketchGraphicClone.sourceLayer=e)])}_configureHighlight(){const{edits:e,layerView:t}=this.data;h.highlightsSupported(t)&&this.addHandles(t.highlight(e.feature),v.highlights)}async _configureSketchViewModel(){const e=this._sketchViewModel;if(!e)return;const{data:t,_featureFormViewModel:r,_sketchGraphicClone:i}=this,{edits:o,viewModel:n}=t,s=o.feature,{view:a}=n,l=f.getVisualVariableAttributes(s),c=await f.setUpGeometryUpdate({feature:s,featureClone:i,visualVariableAttributes:l,sketchViewModel:e,view:a,onUpdate:({geometry:e,attributes:t},i)=>{if(o.updateAttributes(t),o.updateGeometry(e),r.feature&&(r.feature.geometry=e),null!=l.rotation){const{field:e}=l.rotation;r.setValue(e,t[e])}if(null!=l.size){const{field:e}=l.size;r.setValue(e,t[e])}("undo"===i.type||"redo"===i.type||"update"===i.type&&null!=i.toolEventInfo&&f.isTerminalUpdateEventType(i.toolEventInfo.type))&&r.notifyFeatureGeometryChanged()},addUpdatingPromise:e=>{this._updatingHandles.addPromise(e)},addHandle:e=>{this.addHandles(e,v.waitingForTool)},webStyleCache:this._webStyleCache});this.addHandles(c,v.sketchGraphics),e.addHandles(c)}async _initializeSketchViewModel(){const{data:e,_sketchGraphicClone:t}=this,{readOnly:r}=e,o=e.edits.feature,{capabilities:s,layer:a}=e.editorItem,{view:l}=e.viewModel;if(this.removeHandles([v.highlights,v.sketchGraphics,v.sketchViewModel,v.waitingForTool]),!s.update.geometry||r||"3d"===l?.type&&u.hasEffectiveFeatureExpressionInfo(a.elevationInfo))return{enter:async()=>{this.hasHandles(v.highlights)||this._configureHighlight()},exit:()=>this.removeHandles([v.highlights])};const c=new d({elevationInfo:a.elevationInfo,internal:!0,listMode:"hide",title:"updateFeaturesWorkflow-internal"}),p=new g({allowDeleteKey:!1,layer:c,sketchOptions:e.sketchOptions,snappingManager:e.snappingManager,updateOnGraphicClick:!1,view:l});return this._sketchViewModel=p,l?.map.add(c),await(l?.whenLayerView(c)),this.addHandles(i.makeHandle(()=>{l?.destroyed||l?.map.remove(c),c.destroyed||c.destroy(),this._sketchViewModel=n.destroyMaybe(p)}),v.sketchViewModel),await f.updateGraphicSymbolWhenRequired(t,this._webStyleCache,"2d"===l?.type?l.scale:null),this.addHandles([await f.swapForEditingSession(p,o,t)]),{enter:async()=>{this.hasHandles(v.sketchGraphics)||await this._configureSketchViewModel()},exit:()=>this.removeHandles([v.sketchGraphics]),viewModel:p}}_onFullFeatureLoaded(e){super._onFullFeatureLoaded(e);const t=this._sketchGraphicClone=f.cloneGraphicExceptMesh(e),{edits:r,layerView:i}=this.data;r.updateGeometry(e.geometry),r.trackChanges(),f.canCreateInteractiveEditSession(i)&&(this._layerViewEditSession=i.createInteractiveEditSession(t))}static async create(e){const t=new b({data:await y.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}get test(){}},t.__decorate([a.property()],e.UpdateFeatureWorkflow.prototype,"_layerViewEditSession",void 0),t.__decorate([a.property()],e.UpdateFeatureWorkflow.prototype,"_sketchGraphicClone",void 0),t.__decorate([a.property()],e.UpdateFeatureWorkflow.prototype,"_sketchViewModel",void 0),e.UpdateFeatureWorkflow=b=t.__decorate([p.subclass("esri.widgets.Editor.UpdateFeatureWorkflow")],e.UpdateFeatureWorkflow),e.handleKeys=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/UpdateFeatureWorkflowData":function(){define(["../../chunks/tslib.es6","../../core/Error","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../views/interactive/sketch/SketchOptions","./UpdateRecordWorkflowData","./workflowUtils"],function(e,t,r,i,o,n,s,a,l,c){"use strict";var p;let d=p=class extends l{constructor(e){super(e),this.sketchOptions=null,this.snappingManager=null}static async create(e){const{feature:r,snappingManager:i,viewModel:o}=e,n=e.sketchOptions??new a,{view:s}=o;if(!s)throw new t("editor:cannot-create-workflow-data","The provided EditorViewModel does not have an associated view");const l=await c.whenEditorLayerView(s,r.layer??r.sourceLayer);return new p({...p._makeConstructorProps(e),layerView:l,sketchOptions:n,snappingManager:i})}};return e.__decorate([r.property()],d.prototype,"layerView",void 0),e.__decorate([r.property({constructOnly:!0})],d.prototype,"sketchOptions",void 0),e.__decorate([r.property()],d.prototype,"snappingManager",void 0),d=p=e.__decorate([s.subclass("esri.widgets.Editor.UpdateFeatureWorkflowData")],d),d})},"esri/widgets/Editor/UpdateRecordWorkflowData":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/Error","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./Edits"],function(e,t,r,i,o,n,s,a,l){"use strict";var c;let p=c=class extends t{constructor(e){super(e),this.association=null,this.editorItem=null,this.edits=null,this.parent=null,this.featureFormCallbacks=null,this.viewModel=null,this.readOnly=!1}get attachmentsCapabilities(){const e=this.editorItem.capabilities.update.attachments.enabled;return{editing:!0,operations:{add:e,update:e,delete:e}}}get formTemplate(){return this.editorItem.formTemplate}static async create(e){const t=c._makeConstructorProps(e);return new c(t)}static _makeConstructorProps(e){const{association:t,feature:i,parent:o,featureFormCallbacks:n,viewModel:s,readOnly:a}=e,c=s.editorItems.find(e=>e.layer===i.sourceLayer);if(!c)throw new r("no-editorItem-found","The EditorViewModel provided did not have an EditorItem associated with the specified Graphic's layer");return{association:t,editorItem:c,edits:new l({feature:i}),parent:o,featureFormCallbacks:n,viewModel:s,readOnly:a}}};return e.__decorate([i.property()],p.prototype,"association",void 0),e.__decorate([i.property()],p.prototype,"attachmentsCapabilities",null),e.__decorate([i.property({constructOnly:!0})],p.prototype,"editorItem",void 0),e.__decorate([i.property()],p.prototype,"edits",void 0),e.__decorate([i.property()],p.prototype,"formTemplate",null),e.__decorate([i.property()],p.prototype,"parent",void 0),e.__decorate([i.property()],p.prototype,"featureFormCallbacks",void 0),e.__decorate([i.property()],p.prototype,"viewModel",void 0),e.__decorate([i.property()],p.prototype,"readOnly",void 0),p=c=e.__decorate([a.subclass("esri.widgets.Editor.UpdateRecordWorkflowData")],p),p})},"esri/widgets/Editor/UpdateRecordWorkflow":function(){define(["exports","../../chunks/tslib.es6","../../core/Error","../../core/handleUtils","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../views/draw/support/HighlightHelper","../../views/support/HighlightDefaults","./UpdateRecordWorkflowData","./Workflow","./workflowUtils","../FeatureForm/FeatureFormViewModel"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f){"use strict";var g;const b={exit:Symbol()};e.UpdateRecordWorkflow=class extends y{static{g=this}constructor(e){super(e),this._highlightHelper=null,this.fullFeature=null,this.type="update-table-record"}initialize(){const{data:e}=this,{edits:t}=e,{view:n}=e.viewModel,s=t.feature;n&&(this._highlightHelper=new d({view:n,highlightName:u.temporaryHighlightName}),this.addHandles(i.makeHandle(()=>this._highlightHelper?.removeAll())));const a=new AbortController;this.addHandles(i.abortHandle(a)),this._updatingHandles.addPromise(m.fetchFullFeatures([s],s.sourceLayer,e.viewModel.view.spatialReference,a.signal).then(([e])=>{o.isAborted(a)||(this._onFullFeatureLoaded(e),this._initializeFeatureFormViewModel())},e=>this.cancel({force:!0,error:new r("editor:failed-to-fetch-full-feature","Failed to retrieve all information for this feature. The update cannot proceed.",{detail:{error:e}})})))}get editorItem(){return this.data.editorItem}get featureFormViewModel(){return this._featureFormViewModel}get hasPendingEdits(){return this.data.edits.modified}get layer(){return this.data.editorItem.layer}get parent(){return this.data.parent}get parentLayer(){return this.parent?.data.editorItem.layer}get shouldShowAttachments(){return this.editorItem.capabilities.attachments.enabled}get shouldAllowAttachmentEditing(){return this.editorItem.capabilities.update.attachments.enabled}get reliesOnOwnerAdminPrivileges(){const e=this.editorItem.capabilities;return e.update.reliesOnOwnerAdminPrivileges||e.delete.reliesOnOwnerAdminPrivileges}stageDelete(){this.data.edits.stageDelete()}async enter(){this._configureAttachmentsViewModel()}exit(e){this.removeHandles(b.exit)}async start(){return await super.start(),null}_configureAttachmentsViewModel(){const{data:e,fullFeature:t}=this,{attachmentsCapabilities:r,viewModel:o}=e,{attachmentsViewModel:s}=o,a=e.readOnly?{editing:!1}:r;s.set({capabilities:a,graphic:t,filesEnabled:!1,mode:"view"}),this.addHandles([i.makeHandle(()=>s.fileInfos.removeAll()),n.watch(()=>s.mode,e=>{switch(e){case"add":this.go("adding-attachment");break;case"edit":this.go("editing-attachment")}})],b.exit)}_initializeFeatureFormViewModel(){const{association:e,edits:t,formTemplate:r,viewModel:{view:i},readOnly:o}=this.data,s=this._featureFormViewModel=new f({activeAssociation:e,editType:"UPDATE",feature:this.fullFeature,formTemplate:r,highlightHelper:this._highlightHelper,map:i?.map,spatialReference:i.spatialReference,timeZone:i?.timeZone,disabled:o});s.callbacks={...this.data.featureFormCallbacks,showAllRelatedRecords:e=>s.relationshipId=e.relationshipId,viewAssociatedLayers:e=>s.associationId=e.associationId,viewAssociatedFeatures:e=>s.associatedLayer=e.associatedLayer};const{initialFeature:a}=t;a&&s.overrideInitialFeature(a),this.addHandles([s.on("value-change",()=>{t.updateAttributes(s.getValues()),this.fullFeature.attributes=t.feature.attributes}),n.watch(()=>i?.timeZone,e=>s.timeZone=e)])}_onFullFeatureLoaded(e){this.fullFeature=e;const{edits:t}=this.data;t.updateAttributes(e.attributes),t.trackChanges()}static async create(e){const t=new g({data:await h.create(e),onCommit:this._onCommitFactory(e.applyEdits)});return t._set("steps",this._createWorkflowSteps(t)),t}static _createWorkflowSteps(e){const{attachmentsViewModel:t}=e.data.viewModel;return[{id:"editing-attributes",async setUp(){},async tearDown(){}},{id:"adding-attachment",async setUp(){},async tearDown(){t.mode="view"}},{id:"editing-attachment",async setUp(){},async tearDown(){t.mode="view"}}]}static{this._onCommitFactory=e=>async t=>{const{edits:r}=t,{feature:i}=r;if(!i)return;const o=i.sourceLayer,n=i.clone();if(!r.attributesModified||r.stagedForDelete){const e=o.objectIdField;if(n.attributes={[e]:i.getAttribute(e)},"scene"===o.type&&null!=o.infoFor3D){const e=o.associatedLayer?.globalIdField;null!=e&&n.setAttribute(e,i.getAttribute(e))}}r.geometryModified&&!r.stagedForDelete||(n.geometry=null);const s=r.stagedForDelete?"deleteFeatures":"updateFeatures";await e(o,{[s]:[n]})}}},t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"_featureFormViewModel",void 0),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"editorItem",null),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"featureFormViewModel",null),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"fullFeature",void 0),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"hasPendingEdits",null),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"layer",null),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"parent",null),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"parentLayer",null),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"shouldShowAttachments",null),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"shouldAllowAttachmentEditing",null),t.__decorate([s.property()],e.UpdateRecordWorkflow.prototype,"reliesOnOwnerAdminPrivileges",null),e.UpdateRecordWorkflow=g=t.__decorate([p.subclass("esri.widgets.Editor.UpdateRecordWorkflow")],e.UpdateRecordWorkflow),e.handleKeys=b,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/UpdateWorkflowData":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.addAttachmentsCallback=null,this.applyEditsCallback=null,this.applyEditsFeatureServiceCallback=null,this.candidates=[],this.rootFeature=null,this.sketchOptions=null,this.snappingManager=null,this.viewModel=null}};return e.__decorate([r.property()],a.prototype,"addAttachmentsCallback",void 0),e.__decorate([r.property()],a.prototype,"applyEditsCallback",void 0),e.__decorate([r.property()],a.prototype,"applyEditsFeatureServiceCallback",void 0),e.__decorate([r.property()],a.prototype,"candidates",void 0),e.__decorate([r.property()],a.prototype,"rootFeature",void 0),e.__decorate([r.property({constructOnly:!0})],a.prototype,"sketchOptions",void 0),e.__decorate([r.property()],a.prototype,"snappingManager",void 0),e.__decorate([r.property()],a.prototype,"viewModel",void 0),a=e.__decorate([s.subclass("esri.widgets.Editor.UpdateWorkflowData")],a),a})},"esri/widgets/Editor/support/EditorItem":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../layers/support/layerUtils","../../../support/elevationInfoUtils","./EditorEditingCapabilities","../../FeatureForm/featureFormUtils"],function(e,t,r,i,o,n,s,a,l,c,p){"use strict";let d=class extends t{constructor(e){super(e),this.disabled=!1,this.layer=null,this.layerInfo=null,this.layerView=null}get _suspended(){return!!this.layerView?.suspended}get capabilities(){return new c({layer:this.layer,layerInfo:this.layerInfo,layerView:this.layerView})}get editable(){const{create:e,relationship:t,update:r,delete:{enabled:i}}=this.capabilities,o=e.attachments.enabled||r.attachments.enabled;return!this.disabled&&(e.enabled||r.enabled||o||i||t.enabled)}get formTemplate(){return this.capabilities.formTemplate}get hasInvalidFormTemplate(){return p.formTemplateHasInvalidFields(this.layer,this.formTemplate)}get isTable(){return a.isTable(this.layer)}get supportsCreateFeaturesWorkflow(){if(this.disabled)return!1;if("3d"===this.layerView?.view?.type&&l.hasEffectiveFeatureExpressionInfo(this.layer.elevationInfo))return!1;const{enabled:e,geometry:t}=this.capabilities.create;return this.isTable?e:e&&t}get supportsUpdateWorkflow(){const{capabilities:e}=this;return!this.disabled&&(e.update.enabled||e.update.attachments.enabled||e.delete.enabled)}get visible(){const{layer:e}=this,t=e.parent;return!this._suspended&&e.visible&&(!t||!("visible"in t)||t.visible)}};return e.__decorate([r.property()],d.prototype,"_suspended",null),e.__decorate([r.property()],d.prototype,"capabilities",null),e.__decorate([r.property()],d.prototype,"disabled",void 0),e.__decorate([r.property()],d.prototype,"editable",null),e.__decorate([r.property()],d.prototype,"formTemplate",null),e.__decorate([r.property()],d.prototype,"hasInvalidFormTemplate",null),e.__decorate([r.property()],d.prototype,"isTable",null),e.__decorate([r.property()],d.prototype,"layer",void 0),e.__decorate([r.property()],d.prototype,"layerInfo",void 0),e.__decorate([r.property()],d.prototype,"layerView",void 0),e.__decorate([r.property()],d.prototype,"supportsCreateFeaturesWorkflow",null),e.__decorate([r.property()],d.prototype,"supportsUpdateWorkflow",null),e.__decorate([r.property()],d.prototype,"visible",null),d=e.__decorate([s.subclass("esri.widgets.Editor.support.EditorItem")],d),d})},"esri/widgets/Editor/support/EditorEditingCapabilities":function(){define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../layers/support/EditingCapabilities","../../../views/layers/support/editableLayerViews","../../Feature/support/featureUtils"],function(e,t,r,i,o,n,s,a,l){"use strict";let c=class extends s{constructor(e){super(e),this.layerInfo=null,this.layerView=null}get attachments(){const e=this.defaults.attachments.enabled,t=this.layerInfo;return{enabled:e&&!1!==t?.enabled}}get create(){const{attachments:e,defaults:t,layerInfo:r,layer:i,layerView:o}=this,n=t.create,s=!1!==r?.enabled&&!1!==r?.addEnabled,a=n.enabled&&s;return{attributes:a&&n.attributes,enabled:a,geometry:a&&n.geometry&&p(i,o),attachments:{enabled:e.enabled&&a&&!1!==r?.attachmentsOnCreateEnabled},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}get defaults(){return new s({layer:this.layer})}get delete(){const{defaults:e,layerInfo:t}=this,r=e.delete,i=!1!==t?.enabled&&!1!==t?.deleteEnabled;return{enabled:r.enabled&&i,reliesOnOwnerAdminPrivileges:r.reliesOnOwnerAdminPrivileges}}get formTemplate(){const{layer:e,layerInfo:t}=this;return t?.formTemplate?t.formTemplate:e&&"formTemplate"in e?e.formTemplate:null}get relationship(){const{layer:e}=this,t=!(!l.isRelatableFeatureSupportedLayer(e)||!e.relationships?.length),r=!!this.formTemplate?.elements?.some(e=>"relationship"===e.type);return{enabled:t&&r}}get update(){const{attachments:e,defaults:t,layerInfo:r,layer:i,layerView:o}=this,n=t.update,s=!1!==r?.enabled&&!1!==r?.updateEnabled,a=n.enabled&&s,l=a&&n.attributes&&!1!==r?.attributeUpdatesEnabled,c=a&&n.geometry&&!1!==r?.geometryUpdatesEnabled&&p(i,o),d=e.enabled&&!1!==r?.attachmentsOnUpdateEnabled;return{attributes:l,enabled:a,geometry:c,attachments:{enabled:d,create:d&&n.attachments.create,update:d&&n.attachments.update},reliesOnOwnerAdminPrivileges:n.reliesOnOwnerAdminPrivileges}}};function p(e,t){return"scene"!==e.type||null!=t&&"type"in t&&"scene-layer-3d"===t.type&&a.isGeometryEditableSceneLayer(e,t)}return e.__decorate([t.property()],c.prototype,"attachments",null),e.__decorate([t.property()],c.prototype,"create",null),e.__decorate([t.property()],c.prototype,"defaults",null),e.__decorate([t.property()],c.prototype,"delete",null),e.__decorate([t.property()],c.prototype,"formTemplate",null),e.__decorate([t.property()],c.prototype,"layerInfo",void 0),e.__decorate([t.property()],c.prototype,"layerView",void 0),e.__decorate([t.property()],c.prototype,"relationship",null),e.__decorate([t.property()],c.prototype,"update",null),c=e.__decorate([n.subclass("esri.widgets.Editor.support.EditorEditingCapabilities")],c),c})},"esri/layers/support/EditingCapabilities":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./layerUtils"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends t{constructor(e){super(e),this.layer=null}get attachments(){return{enabled:this._effectiveEnabled&&!!this._effectiveCapabilities?.data.supportsAttachment}}get create(){const{_effectiveCapabilities:e,layer:t}=this,r=this._createEnabled,i=r,o=t.capabilities?.operations.supportsAdd,n=!!e?.operations.supportsAdd;return{attachments:{enabled:r&&this.attachments.enabled},attributes:r,enabled:r,geometry:i,reliesOnOwnerAdminPrivileges:!o&&n}}get delete(){const{_effectiveCapabilities:e,layer:t}=this,r=t.capabilities?.operations.supportsDelete,i=!!e?.operations.supportsDelete;return{enabled:this._effectiveEnabled&&!!e?.operations.supportsDelete,reliesOnOwnerAdminPrivileges:!r&&i}}get reliesOnOwnerAdminPrivileges(){return this._effectiveEnabled&&!this.layer.editingEnabled||this.create.reliesOnOwnerAdminPrivileges||this.update.reliesOnOwnerAdminPrivileges||this.delete.reliesOnOwnerAdminPrivileges}get update(){const{_effectiveCapabilities:e,layer:t}=this,r=this._updateEnabled,i=!(!r||!e?.editing.supportsGeometryUpdate),o=t.capabilities?.operations.supportsUpdate,n=!!e?.operations.supportsUpdate,s=this.attachments.enabled,a=s&&this._canCreateOrUpdate;return{attachments:{enabled:s,create:a,update:a},attributes:r,enabled:r,geometry:i,reliesOnOwnerAdminPrivileges:!o&&n}}get _createEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsAdd}get _updateEnabled(){return this._effectiveEnabled&&!!this._effectiveCapabilities?.operations.supportsUpdate}get _canCreateOrUpdate(){return!(!this._createEnabled&&!this._updateEnabled)}get _effectiveEnabled(){return a.getEffectiveEditingEnabled(this.layer)}get _effectiveCapabilities(){return a.getEffectiveLayerCapabilities(this.layer)}};return e.__decorate([r.property()],l.prototype,"attachments",null),e.__decorate([r.property()],l.prototype,"create",null),e.__decorate([r.property()],l.prototype,"delete",null),e.__decorate([r.property()],l.prototype,"layer",void 0),e.__decorate([r.property()],l.prototype,"reliesOnOwnerAdminPrivileges",null),e.__decorate([r.property()],l.prototype,"update",null),e.__decorate([r.property()],l.prototype,"_createEnabled",null),e.__decorate([r.property()],l.prototype,"_updateEnabled",null),e.__decorate([r.property()],l.prototype,"_canCreateOrUpdate",null),e.__decorate([r.property()],l.prototype,"_effectiveEnabled",null),e.__decorate([r.property()],l.prototype,"_effectiveCapabilities",null),l=e.__decorate([s.subclass("esri.layers.support.EditingCapabilities")],l),l})},"esri/views/layers/support/editableLayerViews":function(){define(["exports","../../../core/Logger","../../../geometry/support/spatialReferenceUtils","../../../layers/support/infoFor3D"],function(e,t,r,i){"use strict";const o="esri.views.layers.support.editableLayerViews";e.isGeometryEditableSceneLayer=function(e,n){const{associatedLayer:s}=e,a=s?.infoFor3D;if(!a)return!1;const l=i.getGlbFormatId(a);if(null==l||!a.queryFormats.includes(l))return t.getLogger(o).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because it does not support GLB queries.`),!1;const c=e.spatialReference,p=s.spatialReference;if(!r.equals(c,p))return t.getLogger(o).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${c.wkid}) is different from its associated FeatureLayer's spatial reference (wkid:${p.wkid}).`),!1;const d=s.sourceJSON?.sourceSpatialReference;if(null!=d&&!r.equals(d,p))return t.getLogger(o).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because the spatial reference of its associated FeatureLayer's service (wkid:${p.wkid}) is different from its source spatial reference (wkid:${d.wkid}).`),!1;const{view:u}=n;if(n.destroyed||null==u)return!1;const h=u.spatialReference,{viewingMode:y}=u.state,m=r.isGeographic(c),f=1===y;return m&&!f?(t.getLogger(o).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in local viewing mode because its spatial reference (wkid:${c.wkid}) is geographic. Please consider changing the viewing mode to global.`),!1):!m&&f?(t.getLogger(o).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits in global viewing mode because its spatial reference (wkid:${c.wkid}) is projected. Please consider changing the viewing mode to local.`),!1):!!(r.equals(c,h)||f&&r.isWebMercator(h)&&r.isWGS84(c))||(t.getLogger(o).warnOnce(`SceneLayer (${e.title??"Untitled layer"}, ${e.id}) does not support geometry edits because its spatial reference (wkid:${c.wkid}) does not match the view spatial reference (wkid:${h.wkid}).`),!1)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/goToUtils":function(){define(["exports"],function(e){"use strict";e.goTo=function(e,t,r){return e.goTo(t,r)},e.makeGoToWithoutAnimation=function(){return(e,t)=>e.goTo(t.target,{...t.options,animate:!1})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SelectionList/selectionListUtils":function(){define(["exports","../../../core/arrayUtils"],function(e,t){"use strict";function r(e){return null!=e&&"object"==typeof e&&"items"in e}function i(e){return null!=e&&"object"==typeof e&&"featureItems"in e}e.computeEffectiveCount=function e(t){let o=0;for(const n of t)i(n)&&(o+=n.total),r(n)&&(o+=e(n.items));return o},e.getNestedFeatureItems=function e(o){return o.flatMap(t=>i(t)?t.featureItems:r(t)?t.items.flatMap(t=>e([t])):t).filter(t.isSome)},e.getNestedLayerItems=function(e){return e.flatMap(e=>r(e)?e.items.filter(e=>i(e)):i(e)&&e.total?e:null).filter(t.isSome)},e.isFeatureItem=function(e){return null!=e&&"object"==typeof e&&"graphic"in e},e.isGroupLayerItem=r,e.isLayerItem=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SelectionList/SelectionListViewModel":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Collection","../../../core/Logger","../../../core/maybe","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../core/support/UpdatingHandles","../../../layers/support/layerUtils","../../../views/support/selectionUtils","../goToUtils","./GroupLayerItem","./LayerItem","./selectionListUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g){"use strict";let b=class extends t{constructor(e){super(e),this._allLayerItems=null,this._groupItemCache=new Map,this._hoverHighlightHandle=null,this._layerEditAbortControllers=new Map,this._layerEditHandles=new r,this._layerItemCache=new Map,this._onChangeAbortController=null,this._updatingHandles=new d.UpdatingHandles,this.filterText=void 0,this.layer=null,this.maxVisibleFeatureCountPerLayer=500,this.selectionManager=null,this._onSelectionChangeController=async()=>{this._cancelOnSelectionChange();const e=new AbortController;this._onChangeAbortController=e,await this._updatingHandles.addPromise(n.ignoreAbortErrors(this._generateListItems(e))),this._onChangeAbortController===e&&(this._onChangeAbortController=null);const t=this.layer&&this.effectiveSelectionManager?.getSelection(this.layer);t?.length||(this.layer=null)},this._cancelOnSelectionChange=()=>this._onChangeAbortController?.abort(),this._onSelectionChangeDebounced=n.debounce(this._onSelectionChangeController,100),this._cancelOnLayerEdit=e=>this._layerEditAbortControllers.get(e)?.abort()}initialize(){this.addHandles([s.watch(()=>[this.view,this.effectiveSelectionManager,...this._sources],()=>{this._onSelectionChange(),this._refreshLayerEditHandles()}),s.on(()=>this.effectiveSelectionManager?.sources,"change",()=>{this._onSelectionChange(),this._refreshLayerEditHandles()}),s.on(()=>this.effectiveSelectionManager,"selection-change",()=>this._onSelectionChange())])}destroy(){this._cancelOnSelectionChange(),this.removeTemporaryHighlight(),this._updatingHandles.destroy(),this._layerEditHandles.drain(o.removeMaybe),this._layerEditAbortControllers.forEach(o.abortMaybe)}get _sources(){return this.effectiveSelectionManager?.sources.toArray()??[]}get activeLayerItem(){const{layer:e}=this;return e&&this.layerItems.find(t=>t.layer===e)}get allLayerItems(){return this._allLayerItems??[]}get effectiveCount(){return g.computeEffectiveCount(this.allLayerItems)}get effectiveSelectionManager(){return this.selectionManager??this.view?.selectionManager}get isUpdating(){return!(!this._onChangeAbortController&&!this._updatingHandles.updating)}get layerItems(){return g.getNestedLayerItems(this.allLayerItems)}get layerViewMap(){const e=new Map,{view:t}=this;if(!t)return e;for(const r of t.allLayerViews)if(e.set(r.layer.id,r),u.isSubtypeGroupLayer(r.layer))for(const t of r.layer.sublayers)e.set(t.id,r);return e}get maxVisibleFeatureCountExceeded(){return this.allLayerItems.some(e=>e.maxVisibleFeatureCountExceeded)}get state(){const{view:e}=this;return e?e.ready?this.effectiveSelectionManager?"ready":"error":"loading":"disabled"}get viewLayersAndTables(){const{view:e}=this;return e?.map?[...e.map.layers.toArray().reverse(),...e.map.tables.toArray().reverse()]:[]}get visibleFeatureCount(){return this.activeLayerItem?.visibleTotal??this.visibleFeatureItems.length}get visibleFeatureItems(){return this.layerItems.flatMap(e=>e.featureItems.filter(e=>e.visible))}get visibleLayerCount(){const{effectiveSelectionManager:e}=this;return e&&0!==e.count?1===e.count||this.activeLayerItem?1:this.layerItems.filter(e=>e.visible).length:0}addTemporaryHighlight({graphic:e,layerView:t}){this.removeTemporaryHighlight(),t&&e&&(this._hoverHighlightHandle=t.highlight(e,{name:"temporary"}))}clear(){this.effectiveSelectionManager?.clear()}deselectFeatureItem(e){const t=e.graphic.getObjectId();null!=t&&this.effectiveSelectionManager?.removeFromSelection(e.layer,[t])}deselectGroupItem(e){e.items.forEach(e=>{g.isLayerItem(e)?this.deselectLayerItem(e):this.deselectGroupItem(e)})}deselectLayerItem(e){this.effectiveSelectionManager?.setSelection(e.layer,[])}deselectItem(e){g.isGroupLayerItem(e)?this.deselectGroupItem(e):g.isLayerItem(e)?this.deselectLayerItem(e):this.deselectFeatureItem(e)}goToItem(e){g.isLayerItem(e)||g.isGroupLayerItem(e)?this._goTo(g.getNestedFeatureItems([e]).map(e=>e.graphic)):this._goTo(e.graphic)}layersToItems(e){const{controller:t,groupLayerItem:r,layers:i,promises:o}=e,{_groupItemCache:n,_layerItemCache:s,effectiveSelectionManager:a,viewLayersAndTables:l}=this,c=i??l;if(!a||0===a.count)return[];const p=[];for(const e of c)switch(e.type){case"subtype-group":case"group":{const r=n.get(e),i=r??new m({layer:e,viewModel:this});r||n.set(e,i),o.push(i.sync({controller:t,promises:o})),p.push(i)}break;default:if(h.isSelectableLayer(e)||u.isSubtypeSublayer(e)){const i=e,n=a.getSelection(i);if(!n?.length)continue;const l=s.get(i),c=l??new f({groupLayerItem:r,layer:i,viewModel:this});l||s.set(i,c),o.push(c.sync({controller:t,promises:o})),p.push(c)}}return p}removeFromSelection(e){this.effectiveSelectionManager?.removeFromSelection(e.layer,e.objectIds)}removeTemporaryHighlight(){this._hoverHighlightHandle=o.removeMaybe(this._hoverHighlightHandle)}selectSingleFeatureItem(e){const t=e.objectId;if(null!=t&&this.effectiveSelectionManager)for(const{layer:r}of this.effectiveSelectionManager.selections)this.setSelection({layer:r,objectIds:r===e.layer?[t]:[]})}selectSingleGroupItem(e){if(this.effectiveSelectionManager)for(const{layer:t,selection:r}of this.effectiveSelectionManager.selections)this.setSelection({layer:t,objectIds:t.parent===e.layer?r:[]})}selectSingleItem(e){g.isGroupLayerItem(e)?this.selectSingleGroupItem(e):g.isLayerItem(e)?this.selectSingleLayerItem(e):this.selectSingleFeatureItem(e)}selectSingleLayerItem(e){if(this.effectiveSelectionManager)for(const{layer:t,selection:r}of this.effectiveSelectionManager.selections)this.setSelection({layer:t,objectIds:t===e.layer?r:[]})}setSelection(e){this.effectiveSelectionManager?.setSelection(e.layer,e.objectIds)}async _goTo(e){const{view:t}=this;if(t)try{await y.goTo(t,e)}catch(e){"AbortError"!==e.name&&i.getLogger(this).warn("Failed to go to feature(s)",e)}}async _generateListItems(e){try{this.removeTemporaryHighlight();const t=[],r=this.layersToItems({controller:e,promises:t});t.length>0&&await Promise.all(t),this._onChangeAbortController===e&&(this._allLayerItems=r)}catch(e){i.getLogger(this).warn("Failed updating selection",e)}}_onSelectionChange(){n.ignoreAbortErrors(this._onSelectionChangeDebounced())}_refreshLayerEditHandles(){const{effectiveSelectionManager:e}=this;if(this._layerEditHandles.drain(o.removeMaybe),!e?.sources.length)return;const t=new Set(e.sources.map(e=>u.isSubtypeSublayer(e)?e.parent:e));for(const e of t)h.isSelectableLayer(e)&&"on"in e&&this._layerEditHandles.push(e.on("edits",t=>{this._onLayerEdit(t,e)}))}async _onLayerEdit(e,t){try{if(this.removeTemporaryHighlight(),this._cancelOnLayerEdit(t),!e.updatedFeatures.some(e=>null!=e.objectId&&!e.error))return;const r=new AbortController;this._layerEditAbortControllers.set(t,r);const i="subtype-group"===t.type?this.allLayerItems.find(e=>e.layer===t):this.layerItems.find(e=>e.layer===t);if(i?.layerView){const e=i.layerView;if(await this._onLayerViewUpdate(e),r.signal.aborted)return;i.reset(),this._onSelectionChange()}this._layerEditAbortControllers.get(t)===r&&this._layerEditAbortControllers.delete(t)}catch(e){i.getLogger(this).warn("Failed updating selected features",e)}}async _onLayerViewUpdate(e){await n.whenOrTimeout(s.whenOnce(()=>e.updating),2e3),await s.whenOnce(()=>!e.updating)}};return e.__decorate([a.property()],b.prototype,"_allLayerItems",void 0),e.__decorate([a.property()],b.prototype,"_groupItemCache",void 0),e.__decorate([a.property()],b.prototype,"_hoverHighlightHandle",void 0),e.__decorate([a.property()],b.prototype,"_layerEditAbortControllers",void 0),e.__decorate([a.property()],b.prototype,"_layerEditHandles",void 0),e.__decorate([a.property()],b.prototype,"_layerItemCache",void 0),e.__decorate([a.property()],b.prototype,"_onChangeAbortController",void 0),e.__decorate([a.property()],b.prototype,"_sources",null),e.__decorate([a.property()],b.prototype,"_updatingHandles",void 0),e.__decorate([a.property()],b.prototype,"activeLayerItem",null),e.__decorate([a.property()],b.prototype,"allLayerItems",null),e.__decorate([a.property()],b.prototype,"effectiveCount",null),e.__decorate([a.property()],b.prototype,"effectiveSelectionManager",null),e.__decorate([a.property()],b.prototype,"filterText",void 0),e.__decorate([a.property()],b.prototype,"isUpdating",null),e.__decorate([a.property()],b.prototype,"layer",void 0),e.__decorate([a.property()],b.prototype,"layerItems",null),e.__decorate([a.property()],b.prototype,"layerViewMap",null),e.__decorate([a.property()],b.prototype,"maxVisibleFeatureCountExceeded",null),e.__decorate([a.property()],b.prototype,"maxVisibleFeatureCountPerLayer",void 0),e.__decorate([a.property()],b.prototype,"selectionManager",void 0),e.__decorate([a.property()],b.prototype,"state",null),e.__decorate([a.property()],b.prototype,"view",void 0),e.__decorate([a.property()],b.prototype,"viewLayersAndTables",null),e.__decorate([a.property()],b.prototype,"visibleFeatureCount",null),e.__decorate([a.property()],b.prototype,"visibleFeatureItems",null),e.__decorate([a.property()],b.prototype,"visibleLayerCount",null),b=e.__decorate([p.subclass("esri.widgets.support.SelectionList.SelectionListViewModel")],b),b})},"esri/widgets/support/SelectionList/GroupLayerItem":function(){define(["../../../chunks/tslib.es6","../../../core/has","../../../core/accessorSupport/decorators/property","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ItemBase"],function(e,t,r,i,o,n,s){"use strict";let a=class extends s{constructor(e){super(e),this.items=[],this.layer=null}get layers(){const{layer:e}=this;return"group"===e.type?e.layers.toArray().reverse():"subtype-group"===e.type?e.sublayers.toArray().reverse():[]}get maxVisibleFeatureCountExceeded(){return this.items.some(e=>e.maxVisibleFeatureCountExceeded)}get total(){return this.items.reduce((e,t)=>e+t.total,0)}get visible(){return this.items.some(e=>e.visible)}get visibleTotal(){return this.items.reduce((e,t)=>e+t.visibleTotal,0)}reset(){this.items.forEach(e=>e.reset())}async sync({controller:e,promises:t}){const{layers:r,viewModel:i}=this;this.items=i.layersToItems({controller:e,groupLayerItem:this,layers:r,promises:t})}};return e.__decorate([r.property()],a.prototype,"items",void 0),e.__decorate([r.property()],a.prototype,"layer",void 0),e.__decorate([r.property()],a.prototype,"layers",null),e.__decorate([r.property()],a.prototype,"maxVisibleFeatureCountExceeded",null),e.__decorate([r.property()],a.prototype,"total",null),e.__decorate([r.property()],a.prototype,"visible",null),e.__decorate([r.property()],a.prototype,"visibleTotal",null),a=e.__decorate([n.subclass("esri.widgets.support.SelectionList.GroupLayerItem")],a),a})},"esri/widgets/support/SelectionList/ItemBase":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../iconUtils"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends t{constructor(e){super(e),this.layer=null,this.viewModel=null}get iconName(){return a.getIconForLayer(this.layer)}get key(){return this.layer.id}get layerView(){return this.viewModel.layerViewMap.get(this.layer.id)}get title(){return this.layer.title}get view(){return this.viewModel.view}};return e.__decorate([r.property()],l.prototype,"iconName",null),e.__decorate([r.property()],l.prototype,"key",null),e.__decorate([r.property()],l.prototype,"layer",void 0),e.__decorate([r.property()],l.prototype,"layerView",null),e.__decorate([r.property()],l.prototype,"title",null),e.__decorate([r.property()],l.prototype,"view",null),e.__decorate([r.property()],l.prototype,"viewModel",void 0),l=e.__decorate([s.subclass("esri.widgets.support.SelectionList.ItemBase")],l),l})},"esri/widgets/support/SelectionList/LayerItem":function(){define(["../../../chunks/tslib.es6","../../../core/arrayUtils","../../../core/ReactiveMap","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","./FeatureItem","./ItemBase","../Selector2D/selectorUtils"],function(e,t,r,i,o,n,s,a,l,c){"use strict";let p=class extends l{constructor(e){super(e),this._onChangeController=null,this.featureItems=[],this.featureTitleMap=new r,this.groupLayerItem=null,this.layer=null}get effectiveObjectIds(){return this.objectIds.slice(0,this.maxVisibleFeatureCountPerLayer)}get maxVisibleFeatureCountExceeded(){const{viewModel:e}=this;return this.objectIds.length>e.maxVisibleFeatureCountPerLayer&&this.visibleTotal===e.maxVisibleFeatureCountPerLayer}get maxVisibleFeatureCountPerLayer(){return this.viewModel.maxVisibleFeatureCountPerLayer}get objectIds(){return this.viewModel.effectiveSelectionManager?.getSelection(this.layer)??[]}get total(){return this.objectIds.length}get visible(){return this.featureItems.some(e=>e.visible)}get visibleTotal(){return t.countIf(this.featureItems,e=>e.visible)}cancel(){this._onChangeController?.abort()}reset(){this.featureItems.forEach(e=>e.destroy()),this.featureItems=[]}async sync({controller:e,promises:r}){this.cancel();const i=new Map(this.featureItems.map(e=>[e.objectId,e])),o=new Map,n=[],s=[];for(const e of this.effectiveObjectIds){const t=i.get(e);t?o.set(e,t):(n.push(e),o.set(e,null))}if(this._onChangeController=e,n.length>0){const r=await this._createFeatureItems(n,e);t.addMany(s,r);for(const e of s)null!=e.objectId&&o.set(e.objectId,e)}e.signal.aborted||(this.featureItems=Array.from(o.values()).filter(t.isSome),r.push(this.syncTitles(s)))}async syncTitles(e=this.featureItems){const{layer:t}=this,r=e.map(e=>e.graphic);"getFeatureTitles"in t&&t.getFeatureTitles&&(await t.getFeatureTitles(r,{fetchMissingFields:!0})).forEach((e,t)=>this.featureTitleMap.set(t,e))}async _createFeatureItems(e,t){const{layer:r,layerView:i,viewModel:o}=this,n=new Map;if(i){const r=i.createQuery();r.objectIds=e,r.outFields=["*"],r.returnGeometry=!0;const o=await i.queryFeatures(r,t);for(const e of o.features){const t=e.getObjectId();null!=t&&n.set(t,e)}}if(t.signal.aborted)return[];const s=e.filter(e=>!n.has(e));if(s.length){const{view:e}=this,i=r.createQuery();i.objectIds=s,i.outSpatialReference=e?.spatialReference,i.outFields=e?c.getSuggestedQueryOutFields(r,e,!0):["*"],i.returnGeometry=!0;const o=await r.queryFeatures(i,t);for(const e of o.features){const t=e.getObjectId();null!=t&&n.set(t,e)}}return Array.from(n.values()).map(e=>new a({graphic:e,layer:r,layerItem:this,viewModel:o}))}};return e.__decorate([i.property()],p.prototype,"_onChangeController",void 0),e.__decorate([i.property()],p.prototype,"effectiveObjectIds",null),e.__decorate([i.property()],p.prototype,"featureItems",void 0),e.__decorate([i.property()],p.prototype,"featureTitleMap",void 0),e.__decorate([i.property()],p.prototype,"groupLayerItem",void 0),e.__decorate([i.property()],p.prototype,"layer",void 0),e.__decorate([i.property()],p.prototype,"maxVisibleFeatureCountExceeded",null),e.__decorate([i.property()],p.prototype,"maxVisibleFeatureCountPerLayer",null),e.__decorate([i.property()],p.prototype,"objectIds",null),e.__decorate([i.property()],p.prototype,"total",null),e.__decorate([i.property()],p.prototype,"visible",null),e.__decorate([i.property()],p.prototype,"visibleTotal",null),p=e.__decorate([s.subclass("esri.widgets.support.SelectionList.LayerItem")],p),p})},"esri/widgets/support/SelectionList/FeatureItem":function(){define(["../../../chunks/tslib.es6","../../../core/arrayUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../symbolPreviewUtils","./ItemBase"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends a{constructor(e){super(e),this._thumbnail=null,this.graphic=null,this.layer=null,this.layerItem=null,this.thumbnailSize=24}get _filterTerms(){return[this.title,this.layerItem.title,this.layerItem.groupLayerItem?.title].filter(t.isSome)}get key(){return`${this.layer.id}:${this.objectId??this.graphic.uid}`}get objectId(){return this.graphic.getObjectId()}get title(){const{objectId:e}=this;if(null!=e)return this.layerItem.featureTitleMap.get(e)||`${e}`}get thumbnail(){return this._thumbnail??void 0}get thumbnailKey(){return`${this.key}-${this.graphic.uid}`}get visible(){const{_filterTerms:e,viewModel:{activeLayerItem:t,filterText:r}}=this;if(t&&t.layer!==this.layer)return!1;if(null==r||""===r||!e.length)return!0;const i=new RegExp(r,"iu");return e.some(e=>i.test(e))}async fetchThumbnail(e){return this._thumbnail=await s.fetchThumbnail(this.graphic,this.layer,{maxSize:this.thumbnailSize,ariaLabel:e?.ariaLabel})}};return e.__decorate([r.property()],l.prototype,"_filterTerms",null),e.__decorate([r.property()],l.prototype,"_thumbnail",void 0),e.__decorate([r.property()],l.prototype,"graphic",void 0),e.__decorate([r.property()],l.prototype,"key",null),e.__decorate([r.property()],l.prototype,"layer",void 0),e.__decorate([r.property()],l.prototype,"layerItem",void 0),e.__decorate([r.property()],l.prototype,"objectId",null),e.__decorate([r.property()],l.prototype,"title",null),e.__decorate([r.property()],l.prototype,"thumbnail",null),e.__decorate([r.property()],l.prototype,"thumbnailKey",null),e.__decorate([r.property()],l.prototype,"thumbnailSize",void 0),e.__decorate([r.property()],l.prototype,"visible",null),l=e.__decorate([n.subclass("esri.widgets.support.SelectionList.FeatureItem")],l),l})},"esri/widgets/support/Selector2D/selectorUtils":function(){define(["require","exports","../../../core/arrayUtils","../../../core/promiseUtils","../../../layers/support/fieldUtils","../../../layers/support/layerUtils","../../../renderers/support/clickToleranceUtils","../../../views/support/drapedUtils","../../../views/support/layerViewUtils"],function(e,t,r,i,o,n,s,a,l){"use strict";async function c(e){const{candidates:t,layerViews:o,returnGeometry:n,selector:s,signal:a,view:l}=e;"point"!==s.type?await i.whenOrAbort(Promise.allSettled(o.map(async e=>{const i=function(e,t,r,i=!0){const o=e.createQuery();return o.outFields=["*"],o.geometry=d(t,e.layer,r),o.returnGeometry=i,o.outSpatialReference=r.spatialReference,o}(e,s,l,n),o=await e.queryFeatures(i,{signal:a});r.addMany(t,o.features)})),a):await async function({candidates:e,layerViews:t,selector:r,view:i}){const o=i.toScreen(r);if(!o)return;const n=t.map(e=>e.layer),{results:s}=await i.hitTest(o,{include:n});s.forEach(t=>{"graphic"in t&&t.graphic&&e.push(t.graphic)})}({candidates:t,layerViews:o,selector:s,view:l})}async function p(e){const{candidates:t,layers:o,returnFeatureTitleFields:n,returnGeometry:s,selector:a,signal:l,view:c}=e;await i.whenOrAbort(Promise.allSettled(o.map(async e=>{if("isTable"in e&&e.isTable)return;const i=function(e,t,r,i=!1,o=!0){const n=e.createQuery();return n.outFields=u(e,r,i),n.geometry=d(t,e,r),n.returnGeometry=o,n.outSpatialReference=r.spatialReference,n}(e,a,c,n,s),o=await e.queryFeatures(i,{signal:l});r.addMany(t,o.features)})),l)}function d(e,t,r){return"point"===e.type?a.createQueryGeometry(e,"renderer"in t?s.calculateTolerance({renderer:t.renderer}):0,r):e}function u(e,t,r){const{fields:i,fieldsIndex:n}=e,s=new Set([e.objectIdField]);"globalIdField"in e&&null!=e.globalIdField&&n.has(e.globalIdField)&&s.add(n.get(e.globalIdField).name);const a="displayField"in e?e.displayField:null,l=o.getDisplayFieldName({displayField:a,fields:i});if(null!=l&&n.has(l)&&s.add(l),"subtypeField"in e&&null!=e.subtypeField){const r=n.get(e.subtypeField)?.name;if(null!=r&&s.add(r),"utilityNetworks"in t.map&&t.map.utilityNetworks?.length){const e=n.get("assetgroup");e?.name&&s.add(e.name);const t=n.get("assettype");t?.name&&s.add(t.name)}}return(r||t.requiredFieldsOptions.featureTitleFields)&&"featureTitleFields"in e&&e.featureTitleFields&&e.featureTitleFields.forEach(e=>s.add(e)),Array.from(s.values())}async function h(t){const{candidates:r,graphicsLayers:i,selector:o}=t,n=i.flatMap(e=>e.graphics.toArray())??[];if(!n?.length||!o)return;const s=await new Promise((t,r)=>e(["../../../geometry/operators/intersectsOperator"],t,r));s.accelerateGeometry(o),n.forEach(e=>{e.geometry&&"mesh"!==e.geometry.type&&s.execute(o,e.geometry)&&r.push(e)})}t.collectSelectionFromFeatureLayerViews=c,t.collectSelectionFromFeatureLayers=p,t.collectSelectionFromGraphicsLayers=h,t.getSelectionFromGeometry=async function(e){const{returnFeatureTitleFields:t,returnGeometry:r,selector:o,signal:s,sources:a,view:d}=e;if(!a?.length)return[];const{layers:u,layerViews:y,graphicsLayers:m}=function(e){const t=[],r=[],i=[];return e.forEach(e=>{n.isFeatureLayer(e)||n.isSubtypeGroupLayer(e)||n.isSubtypeSublayer(e)?t.push(e):(n.isKnowledgeGraphLayer(e)||n.isLinkChartLayer(e))&&e.layers?.length?t.push(...e.layers.toArray()):n.isMapNotesLayer(e)&&e.sublayers?.length?i.push(...e.sublayers.toArray()):n.isGraphicsLayer(e)?i.push(e):l.isSelectableLayerView2D(e)&&r.push(e)}),{layers:t,layerViews:r,graphicsLayers:i}}(a),f=[];return await i.ignoreAbortErrors(i.whenOrAbort(Promise.all([p({candidates:f,layers:u,returnFeatureTitleFields:t,returnGeometry:r,selector:o,signal:s,view:d}),c({candidates:f,layerViews:y,returnGeometry:r,selector:o,signal:s,view:d}),h({candidates:f,graphicsLayers:m,selector:o})]),s)),f},t.getSuggestedQueryGeometry=d,t.getSuggestedQueryOutFields=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SelectionToolbar/SelectionToolbarViewModel":function(){define(["../../../chunks/tslib.es6","../../../core/deprecate","../../../core/Evented","../../../core/handleUtils","../../../core/Logger","../../../core/maybe","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../layers/support/layerUtils","../../../views/draw/support/layerUtils","../../../views/support/layerViewUtils","../Selector2D/SelectionOperation"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y){"use strict";let m=class extends r.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.continuousSelectionEnabled=!1,this.defaultLassoToolOptions={createTool:"polygon",mode:"hybrid",toolName:"lasso"},this.defaultOperationType="add",this.defaultPointToolOptions={createTool:"point",toolName:"point"},this.defaultRectangleToolOptions={createTool:"rectangle",toolName:"rectangle"},this.layerViewPreferenceEnabled=!0,this.persistSelection=!0,this.selectionManager=null,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selectOnComplete=!0,this.sources=null,this.toolConfigs=[]}initialize(){this.addHandles([s.watch(()=>this.effectiveSources,e=>{this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this.activeOperation?.cancel(),this.activeOperation?.destroy(),this._operationHandlesGroup=n.removeMaybe(this._operationHandlesGroup)}get effectiveSelectionManager(){return this.selectionManager??this.view?.selectionManager}get effectiveSources(){const{layerViewPreferenceEnabled:e,sources:t,view:r}=this,i=t??this.effectiveSelectionManager?.sources;if(!i?.length)return[];const o=[];return i.forEach(t=>{if(h.isSelectableLayerView2D(t))o.push(t);else if(d.isKnowledgeGraphLayer(t)||d.isLinkChartLayer(t))(t.layers||[]).forEach(t=>{const i=r?u.findLayerView(r,t):void 0,n=e&&h.isSelectableLayerView2D(i)?i:t;o.push(n)});else if(e){const e=r?u.findLayerView(r,t):void 0,i=h.isSelectableLayerView2D(e)?e:t;o.push(i)}else o.push(t)}),o}get layers(){return t.deprecatedProperty(o.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){t.deprecatedProperty(o.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){return this.activeOperation?"active":this.view?.ready&&this.effectiveSources.length?"ready":"disabled"}activate(e){const{state:t}=this,r=e?.view||this.view,n=e?.sources||this.effectiveSources;if("disabled"===t||!r)return void o.getLogger(this).warn("Unable to start selection operation.");"active"===t&&this.cancel();const s=new CustomEvent("before-activate",{cancelable:!0,detail:{toolName:e?.toolName??null}});if(this.emit("before-activate",s),s.defaultPrevented)return;const a={type:this.defaultOperationType,persistSelection:this.persistSelection,returnFeatureTitleFields:this.returnFeatureTitleFields,returnGeometry:this.returnGeometry,selectOnComplete:this.selectOnComplete,selectionManager:this.effectiveSelectionManager,...e,sources:n,view:r},l=new y({...a});return this._operationHandlesGroup=i.handlesGroup([l.on("selection-change",e=>this.emit("selection-change",e)),l.once("complete",e=>this._onOperationComplete(e,a))]),this._set("activeOperation",l),l}activateTool(e){this.cancel();const t=this._getToolOptions(e);if(t)return this.activate(t);o.getLogger(this).warn("Unable to activate tool: unable to determine options.")}cancel(){this.activeOperation?.cancel(),this._set("activeOperation",null)}toggleTool(e){const{activeOperation:t}=this;if(t){const r=t.toolName;if(this.cancel(),r===e)return}return this.activateTool(e)}_onOperationComplete(e,t){this._operationHandlesGroup=n.removeMaybe(this._operationHandlesGroup),this.activeOperation?.destroy(),this._set("activeOperation",null),this.emit("complete",e),this.continuousSelectionEnabled&&!e.aborted&&this.activate(t)}_getToolOptions(e){return this.toolConfigs.find(t=>t.toolName===e)||("lasso"===e?this.defaultLassoToolOptions:"point"===e?this.defaultPointToolOptions:"rectangle"===e?this.defaultRectangleToolOptions:void 0)}};return e.__decorate([a.property({readOnly:!0})],m.prototype,"activeOperation",void 0),e.__decorate([a.property()],m.prototype,"continuousSelectionEnabled",void 0),e.__decorate([a.property()],m.prototype,"defaultLassoToolOptions",void 0),e.__decorate([a.property()],m.prototype,"defaultOperationType",void 0),e.__decorate([a.property()],m.prototype,"defaultPointToolOptions",void 0),e.__decorate([a.property()],m.prototype,"defaultRectangleToolOptions",void 0),e.__decorate([a.property()],m.prototype,"effectiveSelectionManager",null),e.__decorate([a.property()],m.prototype,"effectiveSources",null),e.__decorate([a.property()],m.prototype,"layers",null),e.__decorate([a.property()],m.prototype,"layerViewPreferenceEnabled",void 0),e.__decorate([a.property()],m.prototype,"persistSelection",void 0),e.__decorate([a.property()],m.prototype,"selectionManager",void 0),e.__decorate([a.property()],m.prototype,"returnFeatureTitleFields",void 0),e.__decorate([a.property()],m.prototype,"returnGeometry",void 0),e.__decorate([a.property()],m.prototype,"selectOnComplete",void 0),e.__decorate([a.property()],m.prototype,"sources",void 0),e.__decorate([a.property({readOnly:!0})],m.prototype,"state",null),e.__decorate([a.property()],m.prototype,"toolConfigs",void 0),e.__decorate([a.property()],m.prototype,"view",void 0),m=e.__decorate([p.subclass("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],m),m})},"esri/widgets/support/Selector2D/SelectionOperation":function(){define(["require","../../../chunks/tslib.es6","../../../core/asyncUtils","../../../core/Collection","../../../core/Evented","../../../core/handleUtils","../../../core/Logger","../../../core/maybe","../../../core/promiseUtils","../../../core/screenUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Point","../../../geometry/Polygon","../../../geometry/support/coordsUtils","../../../views/interactive/keybindings","../../../views/support/automaticLengthMeasurementUtils","./selectorUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v){"use strict";let _=class extends o.EventedAccessor{constructor(e){super(e),this._completed=!1,this._isConstraintKeyDown=!1,this._processTask=null,this.createTool="rectangle",this.mode=null,this.persistSelection=!0,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selection=new i,this.selectionManager=null,this.selectOnComplete=!0,this.sources=null,this.toolName="",this.type="add",this._process=l.debounce(async(e,t)=>{const{callback:i,selector:o,completed:n}=e,s=r.createTask(async e=>{const{effectiveSelectionManager:t,returnFeatureTitleFields:r,returnGeometry:s,selection:a,sources:l,view:c}=this;if((l?.length||t.sources.length)&&c){if(o&&null!=l){const i=await v.getSelectionFromGeometry({returnFeatureTitleFields:r,returnGeometry:s,selector:o,signal:e,sources:l,view:c});if(a.removeAll(),a.addMany(i),n&&this.persistSelection)switch(this.effectiveType){case"remove":t.updateSelection({current:[],added:[],removed:i});break;case"replace":t.clear(),t.updateSelection({current:i,added:[],removed:[]});break;default:t.updateSelection({current:i,added:[],removed:[]})}}i&&i()}else a.removeAll()});return l.onAbort(t,()=>s.abort()),this._processTask=s,s.promise},100),this._onOperationFinish=this._onOperationFinish.bind(this)}initialize(){this._setup()}get _defaultMode(){return"polygon"===this.createTool?"click":"hybrid"}get _selectionArea(){const e=this._tool.coordinates;if(0===e.length)return;const t=c.createScreenPoint(),r=this.view.spatialReference,i=e=>{t.x=e[0],t.y=e[1];const r=this.view.toMap(t);return[r?.x??0,r?.y??0]};if(1===e.length||e.every(([t,r])=>t===e[0][0]&&r===e[0][1])){const[t,o]=i(e[0]);return new y({x:t,y:o,spatialReference:r})}const o=e.map(i);return 0!==o.length?(f.isClockwise(o)||o.reverse(),new m({spatialReference:r,rings:[o]})):void 0}get completed(){return this._completed}get effectiveSelectionManager(){return this.selectionManager??this.view.selectionManager}get effectiveType(){const e=this.type??"add";if(this._isConstraintKeyDown)switch(e){case"add":return"remove";case"remove":case"replace":return"add";default:return e}return e}get processingFinalSelection(){return!(!this._processTask||!this._tool?.drawOperation?.isCompleted)}cancel(){this.selection.removeAll(),this._onOperationFinish(!0)}destroy(){this._toolImportController=a.abortMaybe(this._toolImportController)}async _setup(){const{createTool:t,view:r}=this;if(await r.whenReady(),this.destroyed||this._toolImportController)return;const i=new AbortController;this._toolImportController=i;const[o,a]=await Promise.all([new Promise((t,r)=>e(["../../../views/draw/DrawScreenTool"],t,r)),b.loadAutomaticLengthMeasurementUtils()]);if(i.signal.aborted)return;const c=Symbol();try{this._tool=new o.DrawScreenTool({view:r,mode:this.mode??this._defaultMode,geometryType:t,cursor:"point"===t?"default":"crosshair",automaticLengthMeasurementUtils:a})}finally{this._toolImportController=null}this._tool?(this.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>{this._syncConstraintKeyDown(),l.ignoreAbortErrors(this._process({selector:this._selectionArea}))}),c),this.addHandles([r.on("key-down",e=>{if(!e.repeat)switch(e.key){case g.sketchKeys.constraint:this._tool.uniformSizeToggled=!0,e.stopPropagation();break;case g.sketchKeys.center:this._tool.centeredToggled=!0,e.stopPropagation()}}),r.on("key-up",e=>{switch(e.key){case g.sketchKeys.constraint:this._tool.uniformSizeToggled=!1,e.stopPropagation();break;case g.sketchKeys.center:this._tool.centeredToggled=!1,e.stopPropagation()}}),this.selection.on("change",({added:e,removed:t})=>this.emit("selection-change",{operationType:this.effectiveType,added:e,removed:t})),this._tool.on("complete",async e=>{this._syncConstraintKeyDown(),this.removeHandles(c),e.aborted?this.cancel():(this._tool.cursor="progress",await this._process({selector:this._selectionArea,callback:this._onOperationFinish,completed:!0}))})],c),this.addHandles(n.makeHandle(()=>r.tools.remove(this._tool))),r.addAndActivateTool(this._tool)):s.getLogger(this).warn("Unable to import Draw module. SelectionOperation failed to load.")}_syncConstraintKeyDown(){const{inputManager:e}=this.view;this._isConstraintKeyDown=g.selectionKeys.invertType.some(t=>e.isModifierKeyDown(t))}_onOperationFinish(e=!1){this.removeAllHandles(),this._processTask?.abort(),this.emit("complete",{aborted:e,operationType:this.effectiveType,selection:this.selection.toArray(),toolName:this.toolName}),this._completed=!0}};return t.__decorate([p.property()],_.prototype,"_completed",void 0),t.__decorate([p.property()],_.prototype,"_defaultMode",null),t.__decorate([p.property()],_.prototype,"_isConstraintKeyDown",void 0),t.__decorate([p.property()],_.prototype,"_processTask",void 0),t.__decorate([p.property()],_.prototype,"_selectionArea",null),t.__decorate([p.property()],_.prototype,"completed",null),t.__decorate([p.property({constructOnly:!0})],_.prototype,"createTool",void 0),t.__decorate([p.property()],_.prototype,"effectiveSelectionManager",null),t.__decorate([p.property()],_.prototype,"effectiveType",null),t.__decorate([p.property({constructOnly:!0})],_.prototype,"mode",void 0),t.__decorate([p.property()],_.prototype,"persistSelection",void 0),t.__decorate([p.property()],_.prototype,"processingFinalSelection",null),t.__decorate([p.property()],_.prototype,"returnFeatureTitleFields",void 0),t.__decorate([p.property()],_.prototype,"returnGeometry",void 0),t.__decorate([p.property({readOnly:!0})],_.prototype,"selection",void 0),t.__decorate([p.property({constructOnly:!0})],_.prototype,"selectionManager",void 0),t.__decorate([p.property({constructOnly:!0})],_.prototype,"selectOnComplete",void 0),t.__decorate([p.property()],_.prototype,"sources",void 0),t.__decorate([p.property({constructOnly:!0})],_.prototype,"toolName",void 0),t.__decorate([p.property({constructOnly:!0})],_.prototype,"type",void 0),t.__decorate([p.property({constructOnly:!0})],_.prototype,"view",void 0),_=t.__decorate([h.subclass("esri.widgets.support.Selector2D.SelectionOperation")],_),_})},"esri/widgets/Editor/VisibleElements":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../support/SnappingControls/VisibleElements"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends t{constructor(e){super(e),this.batchUpdateActions=!0,this.createFeaturesSection=!0,this.directionModePicker=!1,this.editFeaturesSection=!0,this.flow=!0,this.labelsToggle=!0,this.selectionToolbar=!0,this.settingsMenu=!0,this.sketch=!0,this.snappingControls=!0,this.snappingControlsElements=new a,this.tooltipsToggle=!0,this.undoRedoButtons=!0,this.zoomToButton=!0}};return e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"batchUpdateActions",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"createFeaturesSection",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"directionModePicker",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"editFeaturesSection",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"flow",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"labelsToggle",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"selectionToolbar",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"settingsMenu",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"sketch",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"snappingControls",void 0),e.__decorate([r.property({type:a,nonNullable:!0})],l.prototype,"snappingControlsElements",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"tooltipsToggle",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"undoRedoButtons",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"zoomToButton",void 0),l=e.__decorate([s.subclass("esri.widgets.Editor.VisibleElements")],l),l})},"esri/widgets/support/SnappingControls/VisibleElements":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../GridControls/VisibleElements"],function(e,t,r,i,o,n,s,a){"use strict";let l=class extends t{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new a({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};return e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"enabledToggle",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"featureEnabledToggle",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"gridEnabledToggle",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"header",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"layerList",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"gridControls",void 0),e.__decorate([r.property({type:a,nonNullable:!0})],l.prototype,"gridControlsElements",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"layerListToggleLayersButton",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],l.prototype,"selfEnabledToggle",void 0),l=e.__decorate([s.subclass("esri.widgets.support.SnappingControls.VisibleElements")],l),l})},"esri/widgets/support/GridControls/VisibleElements":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.colorSelection=!0,this.dynamicScaleToggle=!0,this.gridEnabledToggle=!0,this.numericInputs=!0,this.gridSnapEnabledToggle=!0,this.lineIntervalInput=!0,this.outOfScaleWarning=!0,this.placementButtons=!0,this.rotateWithMapToggle=!0}};return e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"colorSelection",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"dynamicScaleToggle",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"gridEnabledToggle",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"numericInputs",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"gridSnapEnabledToggle",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"lineIntervalInput",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"outOfScaleWarning",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"placementButtons",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"rotateWithMapToggle",void 0),a=e.__decorate([s.subclass("esri.widgets.support.GridControls.VisibleElements")],a),a})},"esri/widgets/Editor/components/CreateFeaturesPanelContent":function(){define(["exports","./PanelContent","../../support/widgetUtils","../../support/jsxFactory"],function(e,t,r,i){"use strict";e.CreateFeaturesPanelContent=function({helpMessage:e,renderSketchToolbar:r}){return i.tsx(i.tsxFragment,null,r(),i.tsx(t.PanelContent,{key:"creating-features-panel-content"},i.tsx(t.PanelContentMessage,{key:"content-message"},e)))},e.loadCreateFeaturesPanelContentComponents=()=>t.loadPanelContentComponents(),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/components/PanelContent":function(){define(["require","exports","../../../chunks/componentsUtils","../../support/widgetUtils","../../support/jsxFactory"],function(e,t,r,i,o){"use strict";const n="esri-editor__panel-content",s={base:n,message:`${n}__message`,section:`${n}__section`,sectionGroup:`${n}__section__group`,scrimContainer:`${n}__scrim-container`};t.PanelContent=function(e,...t){return o.tsx("div",{class:i.classes(s.base,e?.showScrimOverlay?s.scrimContainer:void 0),key:e?.key??"panel-content"},...t,e?.showScrimOverlay?o.tsx("calcite-scrim",null):void 0)},t.PanelContentMessage=function(e,...t){return o.tsx("div",{class:s.message,"data-testid":"panel-content-message",key:e?.key??"panel-content-message"},...t)},t.PanelContentSection=function(e,...t){return o.tsx("div",{class:s.section,key:e?.key??"panel-content-section"},...t)},t.PanelContentSectionGroup=function(e,...t){return o.tsx("div",{class:s.sectionGroup,key:e?.key??"panel-content-section-group"},...t)},t.css=s,t.loadPanelContentComponents=()=>r.loadCalciteComponents({scrim:()=>new Promise((t,r)=>e(["../../../chunks/index10"],t,r))}),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/components/FeatureList":function(){define(["require","exports","../../../core/arrayUtils","../../../layers/support/fieldUtils","./PanelContent","../../../chunks/componentsUtils","../../support/ItemList","../../support/widgetUtils","../../support/jsxFactory"],function(e,t,r,i,o,n,s,a,l){"use strict";t.FeatureList=function({editorItems:e,filterText:t,id:n,messagesTemplates:a,onFilterTextChange:c,onSelectFeature:p,onZoomTo:d,workflow:u,editorMessages:h}){const y=new Map,m=u.data.candidates;let f=0;m.map(e=>{const t=function(e){const t=e.layer;if(!t)return null;const r=t.fieldsIndex.get(t.objectIdField),o=r.alias||r.name,{attributes:n}=e,s=i.getDisplayFieldName(t);return s&&n[s]&&`${n[s]}`||`${o}: ${n[r.name]}`}(e);return{label:t,id:e.attributes[e.layer.objectIdField],data:e}}).filter(({label:r,data:i})=>{const o=t.toLowerCase(),{title:n}=i.layer,s=e.find(e=>e.layer===i.sourceLayer);return s?s.supportsUpdateWorkflow&&(!o||r?.toLowerCase().includes(o)||n?.toLowerCase().includes(o)):null}).filter(r.isSome).forEach(e=>{f++;const t=e.data.layer;y.has(t)?y.get(t)?.items.push(e):y.set(t,{id:`${t.id}`,label:t.title??"",items:[e]})});const g=e.toArray().map(({layer:e})=>y.get(e)).filter(r.isSome),b=f>10||t.length>0;return l.tsx(o.PanelContent,{key:"feature-list"},l.tsx(o.PanelContentSection,null,s.ItemList({enableListScroll:!1,filterEnabled:b,filterText:t,id:n,items:g,messages:{filterPlaceholder:a.filterPlaceholder,noItems:a.noItems,noMatches:a.noMatches},onFilterChange:e=>c(e),onItemMouseEnter:e=>p(e.data),onItemMouseLeave:()=>p(null),onItemSelect:e=>p(e.data,!0),renderItemActionEnd:e=>{return t=e.data,r=d,i=h.zoomTo,l.tsx("calcite-action",{appearance:"transparent",icon:"zoom-to-object",onclick:()=>r(t),scale:"s",slot:"actions-end",text:i,title:i});var t,r,i}})))},t.loadFeatureListComponents=()=>Promise.all([o.loadPanelContentComponents(),n.loadCalciteComponents({action:()=>new Promise((t,r)=>e(["../../../chunks/index12"],t,r))})]),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/components/FooterActions":function(){define(["require","exports","../../../core/arrayUtils","../../../chunks/componentsUtils","../../support/widgetUtils","../../support/jsxFactory"],function(e,t,r,i,o,n){"use strict";const s={base:"esri-editor__actions",notice:"esri-editor__actions--notice"},a=({disabled:e,onClick:t,label:r,key:i,...o},s)=>n.tsx("calcite-dropdown-item",{disabled:e??!1,key:i??`dropdown-item-${s}`,onCalciteDropdownItemSelect:t,...o},r);t.FooterActions=function({buttons:e,key:t,notice:i}){return n.tsx("div",{class:s.base,key:t??"footer-actions",slot:"footer"},i?n.tsx("div",{class:s.notice},i.icon?n.tsx("calcite-icon",{icon:i.icon,scale:"s"}):void 0,n.tsx("span",null,i.text)):void 0,n.tsx("div",null,e.filter(r.isSome).map((e,t)=>"split-button"===e.type?(({disabled:e,onClick:t,key:i,dropdownItems:o,...s},l)=>n.tsx("calcite-split-button",{disabled:e??!1,key:i??`split-action-${l}`,width:"full",onCalciteSplitButtonPrimaryClick:t,...s},n.tsx("calcite-dropdown-group",{selectionMode:"none"},o.filter(r.isSome).map(a))))(e,t):(({disabled:e,onClick:t,label:r,key:i,...o},s)=>n.tsx("calcite-button",{disabled:e??!1,key:i??`action-${s}`,onclick:t,width:"full",...o},r))(e,t))))},t.css=s,t.loadFooterActionsComponents=()=>i.loadCalciteComponents({button:()=>new Promise((t,r)=>e(["../../../chunks/index2"],t,r)),"split-button":()=>new Promise((t,r)=>e(["../../../chunks/index56"],t,r)),"dropdown-group":()=>new Promise((t,r)=>e(["../../../chunks/index25"],t,r)),"dropdown-item":()=>new Promise((t,r)=>e(["../../../chunks/index26"],t,r)),icon:()=>new Promise((t,r)=>e(["../../../chunks/index7"],t,r))}),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/components/Notices":function(){define(["require","exports","../../../chunks/componentsUtils","../../support/iconUtils","../../support/widgetUtils","../../support/jsxFactory"],function(e,t,r,i,o,n){"use strict";const s={notice:"esri-editor__notice"};function a(e){const t=e.kind??"brand";return n.tsx("calcite-notice",{class:s.notice,icon:i.iconByKind[t],key:e.key,kind:t,open:!0,scale:"s"},e.title?n.tsx("div",{slot:"title"},e.title):null,n.tsx("div",{slot:"message"},e.message))}t.Notice=a,t.Notices=function({activeFeatureCount:e,workflow:t,messages:r}){const i=[],o="content-start";if(t?.reliesOnOwnerAdminPrivileges){const e=r.ownerAdminNotice;i.push(n.tsx(a,{key:"owner-admin-notice",message:e,slot:o}))}if(t?.hasInvalidFormTemplate){const t=e>1?r.multiFeature.formFieldUpdateError:r.singleFeature.formFieldUpdateError;i.push(n.tsx(a,{key:"form-field-error",kind:"warning",message:t,slot:o}))}if("create-features"===t?.type&&"georeferenced-reprojected"===t.data.upload?.result?.type){const e=r.helpMessages3d.meshReprojected;i.push(n.tsx(a,{key:"mesh-reprojected",kind:"warning",message:e,slot:o}))}return n.tsx(n.tsxFragment,null,i)},t.css=s,t.loadNoticesComponents=()=>r.loadCalciteComponents({notice:()=>new Promise((t,r)=>e(["../../../chunks/index6"],t,r))}),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/components/PanelToolbar":function(){define(["exports","./Settings","../../support/jsxFactory"],function(e,t,r){"use strict";const i={base:"esri-editor__panel-toolbar"};e.PanelToolbar=function({editorViewModel:e,messagesCommon:o,visibleElements:n}){return r.tsx("div",{class:i.base,key:"panel-toolbar"},r.tsx(t.Settings,{editorViewModel:e,messagesCommon:o,visibleElements:n}))},e.css=i,e.loadPanelToolbarComponents=()=>t.loadSettingsComponents(),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/components/Settings":function(){define(["require","exports","../../../chunks/componentsUtils","../../support/SketchTooltipControls","../../support/SnappingControls","../../support/widgetUtils","../../support/jsxFactory","../../support/SketchTooltipControls/VisibleElements","../../support/SnappingControls/VisibleElements"],function(e,t,r,i,o,n,s,a,l){"use strict";const c={settingsContainer:"esri-editor__settings"};t.Settings=function({editorViewModel:e,messagesCommon:t,visibleElements:r}){const{snappingOptions:n,sketchOptions:p,view:d,snappingManager:u}=e,h=[],y={directionModePicker:r.directionModePicker,labelsToggle:r.labelsToggle,tooltipsToggle:r.tooltipsToggle};return Object.values(y).includes(!0)&&h.push(s.tsx(i,{sketchOptions:p,viewType:d?.type,visibleElements:new a(y)})),r.snappingControls&&h.push(s.tsx(o,{afterCreate:e=>e.layerListOpen=!1,snappingManager:u,snappingOptions:n,view:d,visibleElements:r.snappingControlsElements??new l})),0===h.length?null:s.tsx("calcite-accordion",{appearance:"transparent",class:c.settingsContainer,key:"settings"},s.tsx("calcite-accordion-item",{"data-testid":"settings",heading:t.settings,iconStart:"gear"},h))},t.css=c,t.loadSettingsComponents=()=>r.loadCalciteComponents({accordion:()=>new Promise((t,r)=>e(["../../../chunks/index48"],t,r)),"accordion-item":()=>new Promise((t,r)=>e(["../../../chunks/index49"],t,r))}),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SketchTooltipControls":function(){define(["require","../../chunks/tslib.es6","../../core/arrayUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../views/interactive/sketch/SketchOptions","../../views/interactive/tooltip/components/directionModeIcons","../Widget","../../chunks/componentsUtils","./globalCss","./LabeledSwitch","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SketchTooltipControls/VisibleElements"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f){"use strict";const g="esri-sketch-tooltip-controls",b={base:g,block:`${g}__block`,blockContent:`${g}__block-content`,radioButtonLabelWrapper:`${g}__radio-button-label-wrapper`};let v=class extends c{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new f,this.sketchOptions=new a,this.viewType=void 0,this._onTooltipsEnabledChange=e=>{this.sketchOptions.tooltips.enabled=e},this._onLabelsEnabledChange=e=>{this.sketchOptions.labels.enabled=e},this._onDirectionModeChange=e=>{this.sketchOptions.values.directionMode=e.currentTarget.selectedItem.value}}loadDependencies(){return Promise.all([p.loadCalciteComponents({block:()=>new Promise((t,r)=>e(["../../chunks/index13"],t,r)),label:()=>new Promise((t,r)=>e(["../../chunks/index5"],t,r)),icon:()=>new Promise((t,r)=>e(["../../chunks/index7"],t,r)),"radio-button":()=>new Promise((t,r)=>e(["../../chunks/index35"],t,r)),"radio-button-group":()=>new Promise((t,r)=>e(["../../chunks/index36"],t,r))}),u.loadLabeledSwitchComponents()])}render(){const{label:e,visibleElements:t}=this,r=this._renderContent();return m.tsx("div",{"aria-label":e,class:this.classes(b.base,d.globalCss.widget)},r?m.tsx("calcite-block",{class:b.block,expanded:!0,heading:t.header?this.label:"",key:"content-block",label:this.label},m.tsx("div",{class:b.blockContent,key:"content"},r)):void 0)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}_renderContent(){const{visibleElements:e,viewType:t}=this,i=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&"2d"!==t?this._renderLabelsToggle():null,e.directionModePicker?this._renderDirectionModePicker():null].filter(r.isSome);return 0===i.length?null:i}_renderTooltipsToggle(){const{messages:e,sketchOptions:t}=this;return m.tsx(u.LabeledSwitch,{checked:t.tooltips.effectiveEnabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:e,sketchOptions:t}=this;return m.tsx(u.LabeledSwitch,{checked:t.labels.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){const{messages:e,sketchOptions:t}=this,{directionMode:r}=t.values;return m.tsx("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},e.directionModePicker,m.tsx("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:r,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",r,e.directionModeRelative),this._renderDirectionModeOption("absolute",r,e.directionModeAbsolute)))}_renderDirectionModeOption(e,t,r){return m.tsx("calcite-label",{key:e,layout:"inline",scale:"s"},m.tsx("calcite-radio-button",{checked:e===t,scale:"s",value:e}),m.tsx("div",{class:b.radioButtonLabelWrapper,key:"label-wrapper"},m.tsx("calcite-icon",{icon:l.directionModeIcons[e],scale:"s"}),r))}};return t.__decorate([i.property()],v.prototype,"label",null),t.__decorate([i.property({type:f,nonNullable:!0})],v.prototype,"visibleElements",void 0),t.__decorate([i.property(),y.messageBundle("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],v.prototype,"messages",void 0),t.__decorate([i.property({nonNullable:!0,type:a})],v.prototype,"sketchOptions",void 0),t.__decorate([i.property({type:String})],v.prototype,"viewType",void 0),v=t.__decorate([s.subclass("esri.widgets.support.SketchTooltipControls")],v),v})},"esri/views/interactive/tooltip/components/directionModeIcons":function(){define(["exports"],function(e){"use strict";e.directionModeIcons={absolute:"absolute-direction",relative:"relative-direction"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/LabeledSwitch":function(){define(["require","exports","../../chunks/componentsUtils","./widgetUtils","./jsxFactory"],function(e,t,r,i,o){"use strict";const n="esri-labeled-switch",s={label:`${n}__label`,labelContent:`${n}__label-content`,iconInfo:`${n}__icon_info`,iconWarning:`${n}__icon_warning`,tooltip:`${n}__tooltip`};t.LabeledSwitch=function({checked:e,disabled:t,hint:r,key:i,label:n,onChange:a,hintIcon:l,hintKind:c}){return o.tsx("calcite-label",{class:s.label,disabled:t,key:i,layout:"inline-space-between",scale:"s"},r?o.tsx("div",{class:s.labelContent,key:"label-content"},o.tsx("div",null,n),o.tsx("calcite-icon",{class:"warning"!==c?s.iconInfo:s.iconWarning,icon:l??"information",id:i,onclick:e=>e.stopPropagation(),onpointerdown:e=>{e.preventDefault(),e.stopPropagation();const t=e.target.nextElementSibling;t.open=!t.open},scale:"s",tabIndex:0}),o.tsx("calcite-tooltip",{class:s.tooltip,overlayPositioning:"fixed",referenceElement:i},r)):n,o.tsx("calcite-switch",{checked:e,disabled:t,scale:"s",onCalciteSwitchChange:e=>a(e.currentTarget.checked)}))},t.loadLabeledSwitchComponents=()=>r.loadCalciteComponents({icon:()=>new Promise((t,r)=>e(["../../chunks/index7"],t,r)),label:()=>new Promise((t,r)=>e(["../../chunks/index5"],t,r)),switch:()=>new Promise((t,r)=>e(["../../chunks/index33"],t,r)),tooltip:()=>new Promise((t,r)=>e(["../../chunks/index17"],t,r))}),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SketchTooltipControls/VisibleElements":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};return e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"directionModePicker",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"header",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"labelsToggle",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"tooltipsToggle",void 0),a=e.__decorate([s.subclass("esri.widgets.support.SketchTooltipControls.VisibleElements")],a),a})},"esri/widgets/support/SnappingControls":function(){define(["require","../../chunks/tslib.es6","../../core/arrayUtils","../../core/asyncUtils","../../core/maybe","../../core/reactiveUtils","../../core/uid","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../Widget","../../chunks/componentsUtils","./globalCss","./LabeledSwitch","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SnappingControls/SnappingControlsViewModel","./SnappingControls/snappingLayerListUtils","./SnappingControls/VisibleElements"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_){"use strict";const w=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),S="esri-snapping-controls",x={base:S,container:`${S}__container`,toggleBlock:`${S}__toggle-block`,layerListBlock:`${S}__layer-list-block`,layerList:`${S}__layer-list`,layerListFilter:`${S}__layer-list__filter`,layerListButton:`${S}__layer-list__button`,layerListItem:`${S}__layer-list__item`,layerListGroup:`${S}__layer-list__group`,nestedContainer:`${S}__nested-container`};let M=class extends d{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new _,this._enableSnappingSwitchChange=e=>{this.snappingOptions.enabled=e},this._featureEnabledSwitchChange=e=>{this.snappingOptions.featureEnabled=e},this._gridEnabledSwitchChange=e=>{this.snappingOptions.gridEnabled=e,e&&this._startLoadGrid()},this._selfEnabledSwitchChange=e=>{this.snappingOptions.selfEnabled=e},this._onToggleLayersButtonClick=e=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),m.setFocus(e.target)};const{snappingOptions:r,view:i,viewModel:o}=e;this.viewModel=o??(this._defaultViewModel=new b({snappingOptions:r,view:i}))}normalizeCtorArgs(e){const{snappingOptions:t,view:r,viewModel:i,...o}=e;return o}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=o.destroyMaybe(this._defaultViewModel))}loadDependencies(){return Promise.all([u.loadCalciteComponents({block:()=>new Promise((t,r)=>e(["../../chunks/index13"],t,r)),button:()=>new Promise((t,r)=>e(["../../chunks/index2"],t,r)),input:()=>new Promise((t,r)=>e(["../../chunks/index4"],t,r)),list:()=>new Promise((t,r)=>e(["../../chunks/index16"],t,r)),"list-item":()=>new Promise((t,r)=>e(["../../chunks/index20"],t,r)),checkbox:()=>new Promise((t,r)=>e(["../../chunks/index44"],t,r)),loader:()=>new Promise((t,r)=>e(["../../chunks/index32"],t,r))}),y.loadLabeledSwitchComponents()])}initialize(){this.addHandles(n.watch(()=>"2d"===this.view?.type&&!!this.view.grid,e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=o.destroyMaybe(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return g.tsx("div",{"aria-label":e,class:this.classes(x.base,h.globalCss.widget)},g.tsx("div",{class:x.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),"2d"===this.view?.type&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:t}=this,i=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&"2d"===t?.type?this._renderGridEnabledToggle():null].filter(r.isSome),o=[e.enabledToggle?this._renderEnabledToggle():null,i.length>0?g.tsx("div",{class:x.nestedContainer},i):null].filter(r.isSome);return 0===o.length?null:g.tsx("calcite-block",{class:x.toggleBlock,expanded:!0,heading:e.header?this.label:"",key:"toggle-block",label:this.label},o)}_renderEnabledToggle(){return g.tsx(y.LabeledSwitch,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return g.tsx(y.LabeledSwitch,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return g.tsx(y.LabeledSwitch,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return g.tsx(y.LabeledSwitch,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,r=t.layerListViewModel.operationalItems.length>9?g.tsx("calcite-input",{class:x.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:e}})=>{this._layerListFilter=""===e?null:new RegExp(e,"i")}}):null,i=this._secondaryElementsDisabled,o=this.layerListOpen&&!i,n=t.layerListViewModel.operationalItems?.find(e=>!!e.children.length);return g.tsx("calcite-block",{class:x.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,expanded:o,heading:e.snappingLayers,key:"list-block",onCalciteBlockToggle:e=>this.layerListOpen=e.currentTarget.expanded},r,this._renderToggleLayersButton(),g.tsx("calcite-list",{class:x.layerList,displayMode:n?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){const{view:e,visibleElements:t,snappingManager:r,snappingOptions:i,_openAndReady:o}=this,{gridEnabled:n,enabled:s}=i;(o||"2d"===e?.type&&e.grid)&&this._startLoadGrid();const a=this._gridLoadTask?.value,l=a&&"2d"===e?.type&&g.tsx(a,{snappingManager:r,snappingOptions:i,view:e,visibleElements:t.gridControlsElements});return g.tsx("calcite-block",{class:x.layerListBlock,collapsible:!0,disabled:!n||!s,expanded:o,heading:this.messages.gridOptionsHeading,key:"grid-block",onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},l??g.tsx("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}_startLoadGrid(){!this._gridLoadTask&&this.visibleElements.gridControls&&"2d"===this.view?.type&&(this._gridLoadTask=i.createTask(async()=>(await new Promise((t,r)=>e(["./GridControls"],e=>t(w(e)),r))).default))}_renderLayerListItemCollection(e){const t=this._layerListFilter;return e.map(e=>{switch(t?v.itemTitleMatchesFilter(e,t):null){case"children":{const r=e.children.filter(e=>!1!==v.itemTitleMatchesFilter(e,t));return this._renderLayerListItemGroup(e,r)}case"self":case null:return this._renderLayerListItemOrGroup(e);case!1:return"self"===v.itemTitleMatchesFilter(e.parent,t)?this._renderLayerListItemOrGroup(e):null}}).toArray().filter(r.isSome)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,r=e?t.disableAllLayers:t.enableAllLayers;return g.tsx("calcite-button",{appearance:"transparent",class:x.layerListButton,label:r,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},r)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,r=e.title||t,i=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],"enabled"!==e.enabled)};return g.tsx("calcite-list-item",{class:x.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:r,onCalciteListItemSelect:e=>{e.stopPropagation(),i()}},g.tsx("calcite-checkbox",{checked:"enabled"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:i}))}_renderLayerListItemGroup(e,t){const{messages:r}=this,{children:i,title:o}=e,n=o||r.untitledLayer,a=o&&""!==o?o:s.generateUID(),l=!!t?.length,c=t??i,p=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,"enabled"!==e.enabled)},d=c?.find(e=>!!e.children.length);return g.tsx("calcite-list-item",{class:x.layerListGroup,expanded:l,key:a,label:n,onCalciteListItemSelect:e=>{e.stopPropagation(),p()}},g.tsx("calcite-checkbox",{checked:"enabled"===e.enabled,indeterminate:"indeterminate"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:p}),g.tsx("calcite-list",{displayMode:d?"nested":"flat",label:r?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(c)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};return t.__decorate([a.property()],M.prototype,"_defaultViewModel",void 0),t.__decorate([a.property()],M.prototype,"_layerListFilter",void 0),t.__decorate([a.property()],M.prototype,"_gridLoadTask",void 0),t.__decorate([a.property()],M.prototype,"_openAndReady",null),t.__decorate([a.property()],M.prototype,"label",null),t.__decorate([a.property({type:Boolean,nonNullable:!0})],M.prototype,"layerListOpen",void 0),t.__decorate([a.property({type:Boolean,nonNullable:!0})],M.prototype,"gridOptionsOpen",void 0),t.__decorate([a.property(),f.messageBundle("esri/widgets/support/SnappingControls/t9n/SnappingControls")],M.prototype,"messages",void 0),t.__decorate([a.property(),f.messageBundle("esri/t9n/common")],M.prototype,"messagesCommon",void 0),t.__decorate([a.property()],M.prototype,"snappingOptions",null),t.__decorate([a.property()],M.prototype,"snappingManager",void 0),t.__decorate([a.property()],M.prototype,"view",null),t.__decorate([a.property()],M.prototype,"viewModel",null),t.__decorate([a.property({type:_,nonNullable:!0})],M.prototype,"visibleElements",void 0),t.__decorate([a.property()],M.prototype,"_enabledToggleDisabled",null),t.__decorate([a.property()],M.prototype,"_secondaryElementsDisabled",null),M=t.__decorate([p.subclass("esri.widgets.support.SnappingControls")],M),M})},"esri/widgets/support/SnappingControls/SnappingControlsViewModel":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../views/interactive/snapping/FeatureSnappingLayerSource","../../../views/interactive/snapping/SnappingOptions","../../LayerList/support/layerListUtils","./SnappingLayerListViewModel"],function(e,t,r,i,o,n,s,a,l,c,p,d,u){"use strict";let h=class extends t{constructor(e){super(e),this.layerListViewModel=new u.SnappingLayerListViewModel,this.snappingOptions=new p,this.view=null}initialize(){this.addHandles([i.watch(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:t})=>{e.view=t},i.initial),i.watch(()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources}),({viewModel:e,sources:t})=>{e.featureSnappingSources=t},i.initial)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>"enabled"===e.enabled)}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>!e.enabled)}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter(e=>"enabled"===e.enabled).length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach(e=>t?this.enableSnappingForLayer(e):this.disableSnappingForLayer(e))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:t})=>{const r=t?.id;e?this.enableSnappingForLayer(r):this.disableSnappingForLayer(r)})}enableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)d.canDisplayLayer(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(t=>t.layer.id===e)}_makeSnappingSourceForLayer(e){const t=this.layerListViewModel.operationalItemsFlat.find(t=>t.layer?.id===e)?.layer;if(!t)throw new r("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if("group"===t.type)return;const i=new c({layer:t});return this.snappingOptions.featureSources.add(i),i}};return e.__decorate([o.property()],h.prototype,"allLayersEnabled",null),e.__decorate([o.property()],h.prototype,"allLayersDisabled",null),e.__decorate([o.property({constructOnly:!0})],h.prototype,"layerListViewModel",void 0),e.__decorate([o.property()],h.prototype,"layersEnabledCount",null),e.__decorate([o.property({type:p,nonNullable:!0})],h.prototype,"snappingOptions",void 0),e.__decorate([o.property()],h.prototype,"state",null),e.__decorate([o.property()],h.prototype,"view",void 0),h=e.__decorate([l.subclass("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],h),h})},"esri/widgets/LayerList/support/layerListUtils":function(){define(["exports"],function(e){"use strict";function t(e){return e?.listMode??void 0}function r(e){return null!=e&&"minScale"in e&&null!=e.minScale?e.minScale:void 0}function i(e){return null!=e&&"maxScale"in e&&null!=e.maxScale?e.maxScale:void 0}function o(e){if(e&&(!("type"in e)||"wmts"!==e.type))return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function n(e,t){e?.sort((e,r)=>{const i="uid"in e?t.indexOf(e.uid):-1,o="uid"in r?t.indexOf(r.uid):-1;return i>o?-1:i<o?1:0})}function s(e){return null!=e&&"layer"in e&&null!=e.layer}function a(e){return e&&"capabilities"in e&&null!=e.capabilities&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}function l(e){return e?.["data-item"]}e.areChildrenHidden=function(e){return"hide-children"===e?.listMode},e.canDisplayLayer=function(e){return"hide"!==t(e)},e.canSortSublayers=function(e){const t=(e?.layer&&s(e.layer)?e.layer.layer:void 0)??e?.layer;return!!t&&"catalog"!==t.type&&(function(e){const t=a(e);return null!=t&&"supportsDynamicLayers"in t?t.supportsDynamicLayers:void 0}(t)??!0)},e.findLayerListMode=t,e.findLayerMaxScale=i,e.findLayerMinScale=r,e.findLayerVisibilityMode=function(e){if(!e)return"inherited";const t=function(e){const t=a(e);return null!=t&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}(s(e)?e.layer:e);return null!=t?t?"independent":"inherited":"visibilityMode"in e&&null!=e.visibilityMode?e.visibilityMode:"independent"},e.getItem=l,e.getItemLayers=function(e){const t=e?.layer;return t&&"layers"in t?t.layers:null},e.getLayerType=function(e){return e?.getAttribute("data-layer-type")},e.getNormalizedChildLayerProperty=o,e.getSingleAction=function(e){for(const t of e)for(const e of t)if("button"===e.type||"toggle"===e.type)return e},e.getStatusIcon=function({connectionStatus:e,publishing:t}){return e?"connected"===e?"beacon":"offline":t?"square":"bullet-point"},e.getVisibilityIcon=function({exclusive:e,visible:t,visibilityAppearance:r}){const i="checkbox"===r;return t?e?"circle-f":i?"check-square-f":"view-visible":e?"circle":i?"square":"view-hide"},e.isLayerOutsideScaleRange=function(e,t){if(!e||null==t||isNaN(t))return!1;const o=r(e),n=i(e),s=null!=o&&!isNaN(o)&&o>0&&t>o,a=null!=n&&!isNaN(n)&&n>0&&t<n;return s||a},e.isSublayer=s,e.listItemHasChildren=function(e){const{children:t,error:r}=e,i="incompatible"in e&&e.incompatible;return!!t?.filter(e=>!e.hidden).length&&!r&&!i},e.minDragEnabledItems=2,e.minFilterItems=10,e.removeDestroyedListItems=function(e){e?.removeMany(e.filter(e=>e?.destroyed))},e.setFilterPredicate=function(e,t){e&&(e.filterPredicate=t?e=>t(l(e)):void 0)},e.sortChildLayersToIds=function(e,t){const r=e?.layer;if(!r)return;const i=o(r);if(!i)return;let s;"layers"===i&&"layers"in r?s=r.layers:"sublayers"===i&&"sublayers"in r&&(s=r.sublayers),n(s,t)},e.sortLayersToIds=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SnappingControls/SnappingLayerListViewModel":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Collection","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../LayerList/LayerListViewModel","./snappingLayerListUtils","./SnappingListItem"],function(e,t,r,i,o,n,s,a,l,c,p){"use strict";e.SnappingLayerListViewModel=class extends l{constructor(){super(...arguments),this.featureSnappingSources=new r}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>!e.children?.length)}_compileList(){const e=this.view?.map?.layers;if(!e)return;const t=e.filter(c.isValidSnappingLayer);this._watchLayersListMode(t);const r=this._getViewableLayers(t);r?.length?(this._createNewItems(r),this._removeItems(r),this._sortItems(r)):this._removeAllItems()}_createListItem(e){return new p.SnappingListItem({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}},t.__decorate([i.property()],e.SnappingLayerListViewModel.prototype,"featureSnappingSources",void 0),t.__decorate([i.property()],e.SnappingLayerListViewModel.prototype,"operationalItems",void 0),t.__decorate([i.property()],e.SnappingLayerListViewModel.prototype,"operationalItemsFlat",null),t.__decorate([i.property()],e.SnappingLayerListViewModel.prototype,"selectableItems",null),e.SnappingLayerListViewModel=t.__decorate([a.subclass("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],e.SnappingLayerListViewModel),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/LayerList/LayerListViewModel":function(){define(["../../chunks/tslib.es6","../../core/Collection","../../core/Evented","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../linkChart/utils","./ListItem","./support/layerListUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d){"use strict";const u="view-layers",h="map-layers",y="layer-views",m="layer-list-mode",f=t.ofType(p);let g=class extends r.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new f,this.view=null}initialize(){this.addHandles([i.watch(()=>!0===this.view?.ready,()=>this._viewHandles(),i.initial),i.watch(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),i.watch(()=>c.isLinkChartView(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],"view")}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,r,i){const o=e?.layer;if(!o||"subtype-sublayer"===o.type||"sublayer"===o.type)return;const n=this.view?.map?.layers,s=t?d.getItemLayers(t):n,a=r?d.getItemLayers(r):n;if(!s||!a)return;const{operationalItems:l}=this,c=t?.children||l,p=r?.children||l,u=a.length-i;e.parent=r||null,c.remove(e),s.remove(o),p.includes(e)||p.add(e,u),a.includes(o)||a.add(o,u),this._compileList()}_createLayerViewHandles(e){this.removeHandles(y),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),y)}_createMapLayerHandles(e){this.removeHandles(h),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),h)}_createListItem(e){const{view:t,listItemCreatedFunction:r,checkPublishStatusEnabled:i,listModeDisabled:o}=this;return new p({checkPublishStatusEnabled:i,listModeDisabled:o,layer:e,listItemCreatedFunction:r,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(e=>"hide"!==d.findLayerListMode(e)):void 0}_watchLayersListMode(e){this.removeHandles(m),e&&!this.listModeDisabled&&this.addHandles(i.watch(()=>e.filter(e=>"listMode"in e).map(e=>e.listMode).toArray(),()=>this._compileList()),m)}_compileList(){const e=this.view?.map?.layers,t=c.isLinkChartView(this.view)&&!this.view.inGeographicLayout?e?.filter(({type:e})=>"link-chart"===e):e;this._watchLayersListMode(t);const r=this._getViewableLayers(t);r?.length?(this._createNewItems(r),this._removeItems(r),this._sortItems(r)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(e=>{t.some(t=>t.layer===e)||t.add(this._createListItem(e))})}_removeItems(e){const{operationalItems:t}=this,r=[];t.forEach(t=>{t&&e&&e.includes(t.layer)||r.push(t)}),t.destroyMany(r)}_sortItems(e){const{operationalItems:t}=this;t.sort((t,r)=>{const i=e.indexOf(t.layer),o=e.indexOf(r.layer);return i>o?-1:i<o?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([h,y,u]),e?.ready?this.addHandles([i.watch(()=>this.view?.map?.allLayers,e=>this._createMapLayerHandles(e),i.initial),i.watch(()=>this.view?.allLayerViews,e=>this._createLayerViewHandles(e),i.initial)],u):this._removeAllItems()}};return e.__decorate([o.property()],g.prototype,"checkPublishStatusEnabled",void 0),e.__decorate([o.property()],g.prototype,"listItemCreatedFunction",void 0),e.__decorate([o.property({nonNullable:!0})],g.prototype,"listModeDisabled",void 0),e.__decorate([o.property({type:f})],g.prototype,"operationalItems",void 0),e.__decorate([o.property({readOnly:!0})],g.prototype,"state",null),e.__decorate([o.property()],g.prototype,"totalItems",null),e.__decorate([o.property()],g.prototype,"view",void 0),g=e.__decorate([l.subclass("esri.widgets.LayerList.LayerListViewModel")],g),g})},"esri/linkChart/utils":function(){define(["exports"],function(e){"use strict";e.isLinkChartView=function(e){return null!=e&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/LayerList/ListItem":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/arrayUtils","../../core/Collection","../../core/Identifiable","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/get","../../support/actions/ActionBase","../../support/actions/ActionButton","../../support/actions/ActionToggle","./ListItemPanel","./support/layerListUtils"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m){"use strict";var f;const g=i.ofType({key:"type",defaultKeyValue:"button",base:d,typeMap:{button:u,toggle:h}}),b=i.ofType(g),v="layer",_="child-list-mode";let w=f=class extends(o.IdentifiableMixin(t)){constructor(e){super(e),this.actionsSections=new b,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(i.ofType(f)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.parent=null,this.view=null}initialize(){if(this.addHandles([n.watch(()=>[this.layer,this.layer?.listMode,this.listModeDisabled],()=>this._watchLayerProperties(this.layer),n.initial),n.watch(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),n.initial),n.watch(()=>this.view,e=>this._updateChildrenView(e),n.initial),n.watch(()=>this.panel,e=>this._setListItemOnPanel(e),n.initial)]),"function"==typeof this.listItemCreatedFunction){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.panel?.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e)||e.spatialReferenceSupported)}get layerView(){const{layer:e,view:t}=this;if(!e||!t||"sublayer"===e.type)return null;const r="subtype-sublayer"===e.type?e.parent:e;return t.allLayerViews.find(e=>e.layer===r)??null}set panel(e){const t=this._get("panel");e!==t&&e&&t?.destroy(),this._set("panel",e)}castPanel(e){return this.panel?.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new y(e):null}get sortable(){return"knowledge-graph-sublayer"!==this.layer?.type&&this._get("sortable")}set sortable(e){this._set("sortable",e)}get title(){const e=p.get(this,"layer.layer");return(!e||e&&p.get(this,"layer.layer.loaded"))&&p.get(this,"layer.title")||p.get(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){const{layer:e,checkPublishStatusEnabled:t}=this;return!!(t&&e&&"publishingInfo"in e&&"publishing"===e.publishingInfo?.status)}get updating(){const{layerView:e,connectionStatus:t,layer:r,publishing:i}=this;return!i&&!t&&(e?e.updating:"loading"===r?.loadStatus||!1)}get visible(){return!!this.layer?.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return this.layerView?.visibleAtCurrentScale??!m.isLayerOutsideScaleRange(this.layer,this.view?.scale)}get visibleAtCurrentTimeExtent(){return this.layerView?.visibleAtCurrentTimeExtent??!0}get visibilityMode(){return m.findLayerVisibilityMode(this.layer)}clone(){return new f({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){this.children?.forEach(t=>t.checkPublishStatusEnabled=e)}_updateChildrenView(e){const t=this.children;t&&t.forEach(t=>t.view=e)}_createChildren(e){const{listModeDisabled:t,children:r}=this,i=e.filter(e=>!r.some(t=>t.layer===e));r.addMany(this._createChildItems(i,t))}_destroyChildren(e){const{children:t}=this,r=t.filter(t=>!!t.layer&&!e.includes(t.layer));t.destroyMany(r)}_sortChildren(e){this.children.sort((t,r)=>e.indexOf(r.layer)-e.indexOf(t.layer))}_destroyAllChildren(){this.removeHandles(_),this.children.destroyAll()}_watchChildLayerListMode(e){this.removeHandles(_),this.listModeDisabled||this.addHandles(e.toArray().map(t=>n.watch(()=>t.listMode,()=>this._compileChildren(e))),_)}_compileChildren(e){const t=this.listModeDisabled?e:e?.filter(e=>"hide"!==m.findLayerListMode(e));e?.length?(this._createChildren(t),this._destroyChildren(t),this._sortChildren(t),this._watchChildLayerListMode(e)):this._destroyAllChildren()}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",()=>this._compileChildren(e)),v)}_initializeChildLayers(e){this._compileChildren(e),this._watchSublayerChanges(e)}_createChildItems(e,t){return e.reverse().map(e=>t||m.canDisplayLayer(e)?new f({layer:e,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(r.isSome)}_watchLayerProperties(e){if(this.removeHandles(v),this.removeHandles(_),!e)return;if("hide-children"===(!this.listModeDisabled&&m.findLayerListMode(e)))return void this.children.destroyAll();const t=m.getNormalizedChildLayerProperty(e);t&&this.addHandles(n.watch(()=>e[t],r=>{e.hasOwnProperty(t)&&this._initializeChildLayers(r)},n.initial),v)}};return e.__decorate([s.property({type:b})],w.prototype,"actionsSections",void 0),e.__decorate([s.property()],w.prototype,"actionsOpen",void 0),e.__decorate([s.property()],w.prototype,"checkPublishStatusEnabled",void 0),e.__decorate([s.property({type:i.ofType(w)})],w.prototype,"children",void 0),e.__decorate([s.property()],w.prototype,"childrenSortable",void 0),e.__decorate([s.property({readOnly:!0})],w.prototype,"connectionStatus",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"error",null),e.__decorate([s.property()],w.prototype,"hidden",void 0),e.__decorate([s.property({readOnly:!0})],w.prototype,"incompatible",null),e.__decorate([s.property()],w.prototype,"layer",void 0),e.__decorate([s.property({readOnly:!0})],w.prototype,"layerView",null),e.__decorate([s.property()],w.prototype,"listItemCreatedFunction",void 0),e.__decorate([s.property({nonNullable:!0})],w.prototype,"listModeDisabled",void 0),e.__decorate([s.property()],w.prototype,"open",void 0),e.__decorate([s.property({type:y})],w.prototype,"panel",null),e.__decorate([a.cast("panel")],w.prototype,"castPanel",null),e.__decorate([s.property()],w.prototype,"parent",void 0),e.__decorate([s.property({value:!0})],w.prototype,"sortable",null),e.__decorate([s.property()],w.prototype,"title",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"publishing",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"updating",null),e.__decorate([s.property()],w.prototype,"view",void 0),e.__decorate([s.property()],w.prototype,"visible",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"visibleAtCurrentScale",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"visibleAtCurrentTimeExtent",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"visibilityMode",null),w=f=e.__decorate([c.subclass("esri.widgets.LayerList.ListItem")],w),w})},"esri/widgets/LayerList/ListItemPanel":function(){define(["require","../../chunks/tslib.es6","../../core/Identifiable","../../core/maybe","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../Widget","./support/layerListUtils","../support/widget","../support/jsxFactory"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h){"use strict";const y=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));let m=class extends(r.IdentifiableMixin(p)){constructor(e,t){super(e,t),this._legend=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([o.watch(()=>this._canCreateLegend,()=>this._createLegend(),o.initial),o.watch(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),o.initial)])}destroy(){this._legend=i.destroyMaybe(this._legend)}get _canCreateLegend(){const{content:e,listItem:t}=this;if(!t)return!1;const r="legend";return e===r||null!=e&&!!Array.isArray(e)&&e.includes(r)}get _legendOptions(){const{listItem:e,_legendLayerInfo:t}=this,r=e?.view;return t&&r?{view:r,layerInfos:[t]}:{}}get _legendLayerInfo(){const e=this.listItem?.layer;if(!e||"subtype-sublayer"===e.type)return null;const t=d.isSublayer(e)?e:null,r=e?.parent,i=null!=r&&"type"in r&&"map-image"===r.type?t?.source:null;return i&&r?{layer:r,title:"",sublayerIds:[i.mapLayerId]}:{layer:e,title:""}}get disabled(){const{listItem:e,_legend:t,content:r}=this;return!(e&&(Array.isArray(r)&&r.length>1||!t||t.activeLayerInfos?.length&&e.visibleAtCurrentScale&&e.visible))}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,t=this._getFirstWidget();return this._get("icon")??(!e&&t?t.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){return this._get("title")||(this._getFirstWidget()?.label??"")}set title(e){this._override("title",e)}render(){return h.tsx("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:t,disabled:r,open:i}=this;return e&&!r&&i?"legend"===e&&t?h.tsx("div",{key:"legend-widget"},t.render()):"string"==typeof e?h.tsx("div",{innerHTML:e,key:e}):u.isWidget(e)?h.tsx("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?h.tsx("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:t}=this;return t?Array.isArray(e)?e.map(e=>this._renderContent(e)):this._renderContent(e):null}async _createLegend(){if(i.destroyMaybe(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:t}=await new Promise((t,r)=>e(["../Legend"],e=>t(y(e)),r)),r=new t(this._legendOptions);this._legend=r}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return"legend"===e?this._legend:u.isWidget(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map(e=>this._getWidget(e)).find(e=>e):this._getWidget(e)}};return t.__decorate([n.property()],m.prototype,"_legend",void 0),t.__decorate([n.property()],m.prototype,"_canCreateLegend",null),t.__decorate([n.property()],m.prototype,"_legendOptions",null),t.__decorate([n.property()],m.prototype,"_legendLayerInfo",null),t.__decorate([n.property()],m.prototype,"content",void 0),t.__decorate([n.property()],m.prototype,"disabled",null),t.__decorate([n.property()],m.prototype,"flowEnabled",void 0),t.__decorate([n.property()],m.prototype,"icon",null),t.__decorate([n.property()],m.prototype,"image",void 0),t.__decorate([n.property()],m.prototype,"listItem",void 0),t.__decorate([n.property()],m.prototype,"open",void 0),t.__decorate([n.property()],m.prototype,"title",null),t.__decorate([n.property()],m.prototype,"visible",void 0),m=t.__decorate([c.subclass("esri.widgets.LayerList.ListItemPanel")],m),m})},"esri/widgets/support/SnappingControls/snappingLayerListUtils":function(){define(["exports","../../LayerList/support/layerListUtils"],function(e,t){"use strict";const r=e=>i(e)||o(e),i=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},o=e=>{const i=t.getNormalizedChildLayerProperty(e);if(null!=i&&e.hasOwnProperty(i)&&null!=e[i])for(const t of e[i])if(r(t))return!0;return!1},n=(e,t)=>null!=t&&null!=e&&(t.test(e.title)?"self":!!e.children.some(e=>!1!==n(e,t))&&"children");e.isValidSnappingLayer=r,e.isValidSnappingLayerGroup=o,e.isValidSnappingLayerSource=i,e.itemTitleMatchesFilter=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SnappingControls/SnappingListItem":function(){define(["exports","../../../chunks/tslib.es6","../../../core/arrayUtils","../../../core/Collection","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../LayerList/ListItem","../../LayerList/support/layerListUtils","./snappingLayerListUtils"],function(e,t,r,i,o,n,s,a,l,c,p){"use strict";var d;e.SnappingListItem=d=class extends l{constructor(e){super(e),this.children=new i,this.parent=null}get enabled(){const{children:e}=this;if(0===e.length)return null!=this.featureSource&&this.featureSource.enabled?"enabled":"disabled";let t=!1,r=!1;for(const i of e){if("indeterminate"===i.enabled)return i.enabled;if("enabled"===i.enabled?t=!0:"disabled"===i.enabled&&(r=!0),r&&t)return"indeterminate"}return r?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(e=>[e.layer?.id,...e.childLayerIds])}get featureSource(){const{layer:e,getFeatureSnappingSources:t}=this;return t().find(t=>t.layer===e)}_initializeChildLayers(e){if(!e)return;const t=e.filter(p.isValidSnappingLayer);super._initializeChildLayers(t)}_createChildItems(e){return e.map(e=>c.canDisplayLayer(e)?new d({layer:e,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(r.isSome).reverse()}},t.__decorate([o.property()],e.SnappingListItem.prototype,"enabled",null),t.__decorate([o.property()],e.SnappingListItem.prototype,"children",void 0),t.__decorate([o.property()],e.SnappingListItem.prototype,"childLayerIds",null),t.__decorate([o.property()],e.SnappingListItem.prototype,"featureSource",null),t.__decorate([o.property({constructOnly:!0})],e.SnappingListItem.prototype,"getFeatureSnappingSources",void 0),t.__decorate([o.property()],e.SnappingListItem.prototype,"parent",void 0),e.SnappingListItem=d=t.__decorate([a.subclass("esri.widgets.support.SnappingControls.SnappingListItem")],e.SnappingListItem),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/components/UpdateFeaturePanelContent":function(){define(["exports","../../../intl/substitute","../workflowUtils","./FooterActions","./Notices","./PanelContent","./PendingFeatureList","../../support/Heading","../../support/widgetUtils","../../support/jsxFactory"],function(e,t,r,i,o,n,s,a,l,c){"use strict";e.UpdateFeaturePanelContent=function({editorViewModel:e,headingLevel:l,messages:p,messagesCommon:d,onDelete:u,onDeleteAssociation:h,onSave:y,renderAttachments:m,renderFeatureForm:f,renderBatchAttributeForm:g,renderSketchToolbar:b}){const{activeFeatureCount:v,activeLeafWorkflow:_,activeWorkflow:w,formViewModel:S,syncing:x}=e;if(!_||!w||!S)return null;const M=_.type.includes("update"),C=r.isBatchAttributeFormViewModel(S),F=v>1?p.multiFeature:p.singleFeature,k=M&&!_.hasPendingEdits||x||S.updating||S.disabled||r.isBatchAttributeFormViewModel(S)&&S.readOnly,I=t.substitute(M?F.update:F.create,{count:v}),T="create-features"!==_?.type||!!_.data.selectedPendingFeature,L="shouldShowAttachments"in _&&_.shouldShowAttachments&&!C&&!S.activeRelationshipInput&&!S.activeAssociationInput,E=C?S.activeForm.inputs:S.inputs,A=r.isCreateFeaturesWorkflow(_)&&E.every(e=>!e.visible)&&!L,V=r.isUpdateFeaturesWorkflow(_)?g:f,O=A?c.tsx(n.PanelContentSection,null,c.tsx(s,{headingLevel:l,key:"pending-feature-list",workflow:_})):c.tsx(n.PanelContentSection,{key:"panel-content-section"},c.tsx(o.Notices,{activeFeatureCount:v,messages:p,workflow:w}),c.tsx(n.PanelContentSectionGroup,null,T||"create-features"!==_.type?V():c.tsx(s,{headingLevel:l,key:"pending-feature-list",workflow:_}),L?c.tsx("div",{key:"attachments"},c.tsx(a.Heading,{level:a.incrementHeadingLevel(l)},p.attachments),m()):null)),P={appearance:"solid",onClick:y,disabled:k,label:I,type:"button"},U={appearance:"outline",onClick:u,disabled:x,kind:"danger",label:t.substitute(F.delete,{count:v}),type:"button"},R={...U,onClick:h,label:p.deleteAssociationTitle,type:"button"},D={...U,primaryLabel:d.delete,primaryText:d.delete,dropdownItems:[{onClick:h,label:p.deleteAssociationTitle}],type:"split-button"},G={appearance:"outline",onClick:()=>{const{featureFormViewModel:t}=e;null!=t?.associationId&&(t.associationId=null)},disabled:x,label:d.cancel,type:"button"},H="viewing-associated-features"===e.page||"viewing-associated-layers"===e.page?[G]:[P,e.shouldShowDeleteButton&&!e.featureFormHasAssociation?U:void 0,e.shouldShowDeleteButton&&e.featureFormHasAssociation?D:void 0,!e.shouldShowDeleteButton&&e.featureFormHasAssociation?R:void 0];return c.tsx(c.tsxFragment,null,A?b?.():void 0,c.tsx(n.PanelContent,{key:"attribute-panel-content"},O),c.tsx(i.FooterActions,{buttons:H}))},e.loadUpdateFeaturePanelContentComponents=()=>Promise.all([i.loadFooterActionsComponents(),o.loadNoticesComponents(),n.loadPanelContentComponents()]),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Editor/components/PendingFeatureList":function(){define(["require","../../../chunks/tslib.es6","../../../intl","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../Widget","../css","../../../chunks/componentsUtils","../../support/Heading","../../support/ItemList","../../support/symbolPreviewUtils","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/jsxFactory","../../../intl/substitute"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g){"use strict";let b=class extends l{constructor(){super(...arguments),this.workflow=null,this.headingLevel=4,this._iconIntersectionObserver=new IntersectionObserver((e,t)=>{e.forEach(async e=>{if(e.isIntersecting){const i=e.target;if(r=i,r?.["data-has-icon"])return void t.unobserve(i);const o=function(e){return e?.["data-item"]}(i),{graphic:n}=o,s=n.sourceLayer??this.workflow?.data.creationInfo?.layer;if(!s||!n)return;v(i,!0);const a=o.id?g.substitute(this.messagesLegend.previewTemplateAriaLabel,{label:o.id}):this.messagesCommon.preview,l=await h.fetchThumbnail(n,s,{ariaLabel:a}).catch(()=>(v(i,!1),null));if(null==l)return;i.appendChild(l)}var r})}),this.messages=null,this.messagesLegend=null,this.messagesCommon=null,this._renderActionEnd=({graphic:e})=>{const{workflow:t,messages:r}=this;if(!t)return;const i=e.geometry?f.tsx("calcite-action",{appearance:"transparent",icon:"zoom-to-object",onblur:()=>{t.data.temporaryHighlightFeature=null},onclick:()=>t.data.viewModel.zoomTo(e),onfocus:()=>{t.data.temporaryHighlightFeature=e},scale:"s",slot:"actions-end",text:this.messages.zoomTo,title:this.messages.zoomTo}):void 0,o=t.data.isSharedTemplateWorkflow?void 0:f.tsx("calcite-action",{appearance:"transparent",icon:"trash",onblur:()=>{t.data.temporaryHighlightFeature=null},onclick:()=>t.cancelFeature(e),onfocus:()=>{t.data.temporaryHighlightFeature=e},scale:"s",slot:"actions-end",text:r.createFeaturesSelectionList.discard,title:r.createFeaturesSelectionList.discard});return f.tsx(f.tsxFragment,null,i,o)},this._renderItemContentEnd=({graphic:e})=>{const{workflow:t}=this,r=t?.data.isSubmittable(e);return[r?void 0:f.tsx("calcite-icon",{class:c.css.pendingFeatureListIcon,icon:"exclamation-mark-triangle",scale:"s",slot:"content-end"})]},this._renderItemIcon=e=>{if(null!=e?.graphic?.geometry)return f.tsx("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":e,key:"icon"})},this._afterItemCreateOrUpdate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)}}loadDependencies(){return p.loadCalciteComponents({action:()=>new Promise((t,r)=>e(["../../../chunks/index12"],t,r)),icon:()=>new Promise((t,r)=>e(["../../../chunks/index7"],t,r)),list:()=>new Promise((t,r)=>e(["../../../chunks/index16"],t,r))})}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}render(){const e=this.workflow;if(!e)return f.tsx(f.tsxFragment,null,void 0);const t=this.messages,r=e.pendingFeatures.filter(t=>e.data.isDisplayable(t)).map((r,i)=>{const o=e.data.isSubmittable(r),n=o?t.createFeaturesSelectionList.featureReadyToSubmit:t.createFeaturesSelectionList.featureNotReadyToSubmit;return{disabled:!1,id:`${e.data.getFeatureTitle(r)??i}`,graphic:r,label:n,submittable:o}}).toArray();return f.tsx("div",null,f.tsx(d.Heading,{level:d.incrementHeadingLevel(this.headingLevel)},t.createFeaturesSelectionList.heading),f.tsx("calcite-list",{label:t.createFeaturesSelectionList.heading},u.ItemList({enableListScroll:!1,filterEnabled:!1,filterText:"",id:"update-features-pick-list",items:r,messages:{filterPlaceholder:"",noItems:"",noMatches:""},renderIcon:this._renderItemIcon,renderItemTitle:e=>e.label,renderItemLabel:e=>e.id,onItemMouseEnter:t=>e.data.temporaryHighlightFeature=t.graphic,onItemMouseLeave:()=>e.data.temporaryHighlightFeature=null,onItemSelect:t=>e.updatePendingFeature(t.graphic),renderItemContentEnd:this._renderItemContentEnd,renderItemActionEnd:this._renderActionEnd})))}};function v(e,t){e&&(e["data-has-icon"]=t)}return t.__decorate([i.property()],b.prototype,"workflow",void 0),t.__decorate([i.property()],b.prototype,"headingLevel",void 0),t.__decorate([i.property(),m.messageBundle("esri/widgets/Editor/t9n/Editor")],b.prototype,"messages",void 0),t.__decorate([i.property(),m.messageBundle("esri/widgets/Legend/t9n/Legend")],b.prototype,"messagesLegend",void 0),t.__decorate([i.property(),m.messageBundle("esri/t9n/common")],b.prototype,"messagesCommon",void 0),b=t.__decorate([a.subclass("esri.widgets.Editor.components.PendingFeatureList")],b),b})},"esri/widgets/Editor/components/UploadDetails":function(){define(["require","exports","../../../core/Error","../../../layers/graphics/sources/support/uploadAssetErrors","./FooterActions","./PanelContent","../../../chunks/componentsUtils","../../support/widgetUtils","../../support/jsxFactory"],function(e,t,r,i,o,n,s,a,l){"use strict";const c="esri-editor__upload-details",p={base:c,status:`${c}__status`,titleWrapper:`${c}__title-wrapper`,title:`${c}__title`,description:`${c}__description`,loader:`${c}__loader`,iconSuccess:`${c}__icon ${c}__icon--success`,iconError:`${c}__icon ${c}__icon--error`,fileList:`${c}__file-list`,file:`${c}__file`,fileIcon:`${c}__file-icon`,fileName:`${c}__file-name`};function d(e,t){if(!e)return null;const o=t.modelUploads.error.messages;switch(e.constructor){case i.NoModelError:return o.noModel;case i.MultipleModelsError:return o.multipleModels;case i.Convert3DFailedError:return o.conversionFailed;case r:switch(e.name){case"glt-loader-error":case"gltf-loader-invalid-glb":return o.loadFailed;case"gltf-loader-unsupported-feature":return o.unsupportedFeature;case"glt-loader-request-error":return o.resourceRequestFailed;default:return o.default}default:return o.default}}function u(e){const t=e.name.split(".").pop()?.toLowerCase();return(t?f[t]:null)??h}const h="file",y="file-shape",m="file-image",f={glb:y,gltf:y,jpeg:m,jpg:m,png:m,svg:m,zip:"file-zip"};t.UploadDetails=function(e){const{messages:t,key:r,upload:i}=e;return l.tsx(l.tsxFragment,null,l.tsx(n.PanelContent,{key:r??"upload-details"},l.tsx(n.PanelContentSection,null,function(e){const t=function({helpMessage:e,messages:t,upload:r}){switch(r.state){case"pending":{const{title:e,description:i}=t.modelUploads.pending;return{title:e,description:i,iconContent:l.tsx("calcite-loader",{"aria-hidden":"true",class:p.loader,label:"",scale:"s",type:"determinate",value:Math.min(Math.round(100*r.progress),1===r.progress?100:99)})}}case"success":{const{title:r}=t.modelUploads.success;return{title:r,description:e||t.helpMessages3d.mesh,iconContent:l.tsx("calcite-icon",{class:a.classes(p.iconSuccess),icon:"check",scale:"l"})}}case"error":{const{title:e}=t.modelUploads.error;return{title:e,description:d(r.error,t),iconContent:l.tsx("calcite-icon",{class:a.classes(p.iconError),icon:"exclamation-mark-circle",scale:"l"})}}default:return null}}(e);return t?l.tsx("div",{class:p.base,"data-testid":"upload-details",key:"upload-details-content"},l.tsx("div",{class:p.status,key:"status"},t.iconContent,l.tsx("div",{class:p.titleWrapper,key:"text"},l.tsx("div",{class:p.title,key:"title"},t.title),l.tsx("div",{class:p.description,key:"description"},t.description))),function(e){return l.tsx("div",{class:p.fileList,key:"file-list"},e.files.map(e=>{return l.tsx("div",{class:p.file,key:`file-${e.name}`},l.tsx("calcite-icon",{class:p.fileIcon,icon:u(e),scale:"s"}),l.tsx("span",{class:p.fileName},(t=e.name,t.split("/").pop()?.split("\\").pop()??"")));var t}))}(e.upload)):null}(e))),"error"===i.state?l.tsx(o.FooterActions,{buttons:[{onClick:()=>i.retry(),label:t.modelUploads.error.uploadNew,iconStart:"upload-to",type:"button"}],key:"upload-details-footer-actions"}):null)},t.css=p,t.loadUploadDetailsComponents=()=>Promise.all([s.loadCalciteComponents({icon:()=>new Promise((t,r)=>e(["../../../chunks/index7"],t,r)),loader:()=>new Promise((t,r)=>e(["../../../chunks/index32"],t,r))}),o.loadFooterActionsComponents(),n.loadPanelContentComponents()]),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/uploadAssetErrors":function(){define(["exports","../../../../core/Error"],function(e,t){"use strict";const r="upload-assets",i=()=>new Error;e.BadResponseError=class extends t{constructor(e,t){super(`${r}:bad-response`,`Bad response. Uploaded ${e} items and received ${t} results.`,i())}},e.Convert3DFailedError=class extends t{constructor(){super(`${r}:convert3D-failed`,"convert3D failed.")}},e.MultipleModelsError=class extends t{constructor(){super("invalid-input:multiple-models","Multiple supported models found")}},e.NoGlbSupportError=class extends t{constructor(){super(`${r}:no-glb-support`,"Layer does not support glb.",i())}},e.NoModelError=class extends t{constructor(){super("invalid-input:no-model","No supported model found")}},e.NoSupportedSourceError=class extends t{constructor(){super(`${r}:no-supported-source`,"No supported external source found",i())}},e.NotBase64Error=class extends t{constructor(){super(`${r}:not-base-64`,"Expected gltf data in base64 format after conversion.",i())}},e.UnableToPrepareOptionsError=class extends t{constructor(){super(`${r}:unable-to-prepare-options`,"Unable to prepare uploadAsset request options.",i())}},e.UnsupportedError=class extends t{constructor(){super(`${r}:unsupported`,"Layer does not support asset uploads.",i())}},e.UnsupportedFormatUploadedError=class extends t{constructor(e){super(`${r}-layer:unsupported-format`,`The service allowed us to upload an asset of FormatID ${e}, but it does not list it in its supported formats.`,i())}},e.UploadFailedError=class extends t{constructor(e,t){super(`${r}-layer:upload-failed`,`Failed to upload mesh file ${e}. Error code: ${t?.code??"-1"}. Error message: ${t?.messages??"unknown"}`,i())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Sketch/VisibleElements":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../support/SnappingControls/VisibleElements"],function(e,t,r,i,o,n,s,a,l){"use strict";e.CreateToolVisibilityMap=class extends r{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0,this.freehandPolyline=!1,this.freehandPolygon=!1}},t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"point",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"polyline",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"polygon",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"rectangle",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"circle",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"multipoint",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"mesh",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"freehandPolyline",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"freehandPolygon",void 0),e.CreateToolVisibilityMap=t.__decorate([a.subclass("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],e.CreateToolVisibilityMap),e.SelectionToolVisibilityMap=class extends r{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}},t.__decorate([i.property({nonNullable:!0})],e.SelectionToolVisibilityMap.prototype,"rectangle-selection",void 0),t.__decorate([i.property({nonNullable:!0})],e.SelectionToolVisibilityMap.prototype,"lasso-selection",void 0),t.__decorate([i.property({nonNullable:!0})],e.SelectionToolVisibilityMap.prototype,"custom-selection",void 0),e.SelectionToolVisibilityMap=t.__decorate([a.subclass("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],e.SelectionToolVisibilityMap),e.VisibleElements=class extends r{constructor(t){super(t),this.createTools=new e.CreateToolVisibilityMap,this.directionModePicker=!1,this.duplicateButton=!0,this.deleteButton=!0,this.selectionCountLabel=!0,this.labelsToggle=!0,this.selectionTools=new e.SelectionToolVisibilityMap,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new l,this.tooltipsToggle=!0,this.undoRedoMenu=!0}},t.__decorate([i.property({type:e.CreateToolVisibilityMap,nonNullable:!0})],e.VisibleElements.prototype,"createTools",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"directionModePicker",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"duplicateButton",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"deleteButton",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"selectionCountLabel",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"labelsToggle",void 0),t.__decorate([i.property({type:e.SelectionToolVisibilityMap,nonNullable:!0})],e.VisibleElements.prototype,"selectionTools",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"settingsMenu",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"snappingControls",void 0),t.__decorate([i.property({type:l,nonNullable:!0})],e.VisibleElements.prototype,"snappingControlsElements",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"tooltipsToggle",void 0),t.__decorate([i.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"undoRedoMenu",void 0),e.VisibleElements=t.__decorate([a.subclass("esri.widgets.Sketch.VisibleElements")],e.VisibleElements),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/loaderUtils":function(){define(["exports","../../core/handleUtils","../../core/has","../../core/reactiveUtils"],function(e,t,r,i){"use strict";e.connectDelayedLoading=function({getLoading:e,setEffectiveLoading:r}){let o,n;function s(){clearTimeout(n),n=void 0}function a(e){o=e?Date.now():void 0,r(e)}function l(e,t){if(e<=0)return a(t);n=setTimeout(()=>{s(),a(t)},e)}return a(e()),t.handlesGroup([i.watch(e,e=>{s(),e?l(500,!0):l(null!=o?1e3-(Date.now()-o):0,!1)},i.sync),t.makeHandle(s)])},e.minShownDuration=1e3,e.showDelay=500,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SelectionList":function(){define(["require","../../chunks/tslib.es6","../../intl","../../core/arrayUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../Widget","../../chunks/componentsUtils","./globalCss","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SelectionList/selectionListUtils","./SelectionList/SelectionListViewModel","./SelectionList/VisibleElements","../../intl/substitute","../../intl/number"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v){"use strict";const _="esri-selection-list",w=`${_}__list-item`,S={base:_,container:`${_}__container`,flowItem:`${_}__flow-item`,layerDropdown:`${_}__layer-dropdown`,listItemFeature:`${w}__feature`,listItemFeatureIcon:`${w}__feature-icon`,listItemIcon:`${w}__icon`,itemCount:`${_}__item-count`,notice:`${_}__notice`,panel:`${_}__panel`,totalCount:`${_}__total-count`};let x=class extends c{constructor(e,t){super(e,t),this._iconIntersectionObserver=new IntersectionObserver((e,t)=>{e.forEach(async e=>{if(e.isIntersecting){const r=e.target;if(this._hasIcon(r))return void t.unobserve(r);const i=this._getListItem(r);if(!i)return;this._setHasIcon(r,!0);const o=i.title?b.substitute(this.messagesLegend.previewTemplateAriaLabel,{label:i.title}):this.messagesCommon.preview,n=i.thumbnail??await i.fetchThumbnail({ariaLabel:o}).catch(()=>(this._setHasIcon(r,!1),null));if(null==n)return;r.appendChild(n)}})}),this._itemWithOpenMenu=null,this._list=null,this.displayMode="group",this.hightlightOnHoverEnabled=!1,this.itemActionConfigs=null,this.menuScale="m",this.messages=null,this.messagesCommon=null,this.messagesLegend=null,this.onListItemSelect=null,this.scale="s",this.viewModel=new f,this.visibleElements=new g,this._afterItemCreate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)},this.clear=this.clear.bind(this),this.collapseItems=this.collapseItems.bind(this),this.removeTemporaryHighlight=this.removeTemporaryHighlight.bind(this)}initialize(){this.addHandles([o.on(()=>this.effectiveSelectionManager,"selection-change",()=>this._closeItemMenu()),o.watch(()=>this.hightlightOnHoverEnabled,e=>{e||this.removeTemporaryHighlight()})])}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return p.loadCalciteComponents({action:()=>new Promise((t,r)=>e(["../../chunks/index12"],t,r)),chip:()=>new Promise((t,r)=>e(["../../chunks/index11"],t,r)),combobox:()=>new Promise((t,r)=>e(["../../chunks/index21"],t,r)),"combobox-item":()=>new Promise((t,r)=>e(["../../chunks/index22"],t,r)),dropdown:()=>new Promise((t,r)=>e(["../../chunks/index24"],t,r)),"dropdown-group":()=>new Promise((t,r)=>e(["../../chunks/index25"],t,r)),"dropdown-item":()=>new Promise((t,r)=>e(["../../chunks/index26"],t,r)),flow:()=>new Promise((t,r)=>e(["../../chunks/index14"],t,r)),"flow-item":()=>new Promise((t,r)=>e(["../../chunks/index15"],t,r)),icon:()=>new Promise((t,r)=>e(["../../chunks/index7"],t,r)),input:()=>new Promise((t,r)=>e(["../../chunks/index4"],t,r)),list:()=>new Promise((t,r)=>e(["../../chunks/index16"],t,r)),"list-item":()=>new Promise((t,r)=>e(["../../chunks/index20"],t,r)),notice:()=>new Promise((t,r)=>e(["../../chunks/index6"],t,r)),panel:()=>new Promise((t,r)=>e(["../../chunks/index51"],t,r)).then(e=>e.index)})}get _hasFilterText(){const{filterText:e}=this;return null!=e&&""!==e}get activeLayerItem(){return this.viewModel.activeLayerItem}get allLayerItems(){return this.viewModel.allLayerItems}get effectiveCount(){return this.viewModel.effectiveCount}get effectiveSelectionManager(){return this.viewModel.effectiveSelectionManager}get filterText(){return this.viewModel.filterText}set filterText(e){this.viewModel.filterText=e}get icon(){return"selection"}set icon(e){this._overrideIfSome("icon",e)}get isUpdating(){return this.viewModel.isUpdating}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get layerItems(){return this.viewModel.layerItems}get layerViewMap(){return this.viewModel.layerViewMap}get maxVisibleFeatureCountExceeded(){return this.viewModel.maxVisibleFeatureCountExceeded}get maxVisibleFeatureCountPerLayer(){return this.viewModel.maxVisibleFeatureCountPerLayer}set maxVisibleFeatureCountPerLayer(e){this.viewModel.maxVisibleFeatureCountPerLayer=e}get selectionManager(){return this.viewModel.selectionManager}set selectionManager(e){this.viewModel.selectionManager=e}get state(){return this.viewModel.state}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get viewLayersAndTables(){return this.viewModel.viewLayersAndTables}get visibleFeatureCount(){return this.viewModel.visibleFeatureCount}get visibleFeatureItems(){return this.viewModel.visibleFeatureItems}get visibleLayerCount(){return this.viewModel.visibleLayerCount}addTemporaryHighlight(e){this.viewModel.addTemporaryHighlight(e)}clear(){this.viewModel.clear()}deselectFeatureItem(e){this.viewModel.deselectFeatureItem(e)}deselectGroupItem(e){this.viewModel.deselectGroupItem(e)}deselectLayerItem(e){this.viewModel.deselectLayerItem(e)}deselectItem(e){this.viewModel.deselectItem(e)}collapseItems(){this._list?.filteredItems.forEach(e=>e.expanded=!1)}goToItem(e){this.viewModel.goToItem(e)}removeFromSelection(e){this.viewModel.removeFromSelection(e)}removeTemporaryHighlight(){this.viewModel.removeTemporaryHighlight()}selectSingleFeatureItem(e){this.viewModel.selectSingleFeatureItem(e)}selectSingleGroupItem(e){this.viewModel.selectSingleGroupItem(e)}selectSingleItem(e){this.viewModel.selectSingleItem(e)}selectSingleLayerItem(e){this.viewModel.selectSingleLayerItem(e)}setSelection(e){this.viewModel.setSelection(e)}render(){return y.tsx("div",{class:this.classes(S.base,d.globalCss.widget,d.globalCss.panel)},y.tsx("calcite-flow",null,y.tsx("calcite-flow-item",{class:S.flowItem,heading:this.visibleElements.header?this.messages.selection:void 0,loading:"loading"===this.state,overlayPositioning:"fixed",scale:this.scale,selected:!0},y.tsx("calcite-panel",{class:S.panel,overlayPositioning:"fixed",scale:this.scale},y.tsx("div",{class:S.container},this._renderActiveLayerDropdown(),this._renderFilterInput(),this._renderList(),this._renderFilterNotice())),this._renderTotalChip(),this._renderMenuActions())))}_renderTotalChip(){const{visibleElements:e}=this;if(!e.totalCount||!e.header)return;const{effectiveCount:t}=this,r=v.formatNumber(t),i=b.substitute(this.messages.selectionCount,{count:r});return y.tsx("calcite-chip",{appearance:"outline",class:S.totalCount,closable:t>0,closed:0===t,icon:this.maxVisibleFeatureCountExceeded?"exclamation-mark-triangle":void 0,label:r,scale:this.scale,slot:"header-actions-end",title:i,onCalciteChipClose:this.clear},r)}_renderMenuActions(){const{visibleElements:e}=this;if(!e.header||!e.menu)return;const{menuScale:t}=this,r=0===this.effectiveCount;return[y.tsx("calcite-action",{disabled:r,icon:"reset",key:"clear-action",onclick:this.clear,scale:t,slot:"header-menu-actions",text:this.messagesCommon.clear,textEnabled:!0}),y.tsx("calcite-action",{disabled:r,icon:"folders",key:"collapse-action",onclick:this.collapseItems,scale:t,slot:"header-menu-actions",text:this.messages.collapseAll,textEnabled:!0})]}_renderActiveLayerDropdown(){const{layerItems:e,messages:t}=this;if(!(0===this.effectiveCount||e.length<2)&&this.visibleElements.layerFilter)return y.tsx("calcite-combobox",{class:S.layerDropdown,clearDisabled:!0,label:t.filterByLayer,overlayPositioning:"fixed",placeholder:t.filterByLayer,scale:this.scale,selectionMode:"single-persist",onCalciteComboboxChange:({currentTarget:e})=>{this.filterText=void 0;const t=e.selectedItems[0]?.value??void 0;this.layer="all-layers"===t?void 0:t}},y.tsx("calcite-combobox-item",{heading:b.substitute(t.allLayersCount,{count:e.length}),icon:"layers",key:"all-layers",selected:null==this.layer,value:"all-layers"}),this.layerItems.map(e=>this._renderActiveLayerDropdownItem(e)))}_renderFilterInput(){if(this.visibleElements.filter&&0!==this.effectiveCount)return y.tsx("calcite-input",{clearable:!0,icon:"search",placeholder:this.messages.filter,scale:this.scale,value:this.filterText,onCalciteInputInput:({target:{value:e}})=>{this.filterText=e}})}_renderActiveLayerDropdownItem(e){const t=e.title||this.messages.untitledLayer;return y.tsx("calcite-combobox-item",{heading:t,icon:e.iconName,key:e.key,selected:e.layer===this.layer,value:e.layer})}_renderList(){const{messages:e}=this;if(0!==this.visibleFeatureCount)return y.tsx("calcite-list",{afterCreate:u.storeNode,bind:this,"data-node-ref":"_list",displayMode:"nested",interactionMode:"interactive",label:e.widgetLabel,loading:this.isUpdating,scale:this.scale,selectionMode:"none"},this._renderListContent(this.allLayerItems))}_renderListContent(e){return this.activeLayerItem?this._renderLayerItem(this.activeLayerItem):e.map(e=>m.isGroupLayerItem(e)?this._renderGroupItem(e):m.isLayerItem(e)?this._renderLayerItem(e):null).filter(i.isSome)}_renderFilterNotice(){const{visibleElements:e}=this;if(!("disabled"===this.state||this.visibleFeatureCount>0)&&e.filter&&e.filterNotice)return y.tsx("calcite-notice",{class:S.notice,icon:"exclamation-mark-triangle",kind:"info",open:!0,scale:this.scale,width:"full"},y.tsx("div",{slot:"message"},this.messages.noMatchingFeatures))}_renderItemCount(e){if(!this.visibleElements.itemCount)return;const{messages:t}=this,r=v.formatNumber(e.total),i=v.formatNumber(e.visibleTotal),o=b.substitute(t.selectionCount,{count:r});return!this._hasFilterText&&e.maxVisibleFeatureCountExceeded?y.tsx("span",{class:S.itemCount,slot:"content-end",title:o},y.tsx("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s",title:t.tooManyFeatures}),`${v.formatNumber(this.maxVisibleFeatureCountPerLayer)}+`):y.tsx("span",{class:S.itemCount,slot:"content-end",title:o},i)}_renderItemActions(e){if(!this.visibleElements.itemMenus)return;const{messages:t,messagesCommon:r}=this,i=this._itemWithOpenMenu===e,o=m.isFeatureItem(e),n=m.isLayerItem(e),s=m.isGroupLayerItem(e),a=o?t.deselectFeature:n?t.deselectLayer:t.deselectGroup;return[y.tsx("calcite-dropdown",{open:i,overlayPositioning:"fixed",scale:this.menuScale,slot:"actions-end",width:"m",onCalciteDropdownClose:()=>this._closeItemMenu(e),onCalciteDropdownOpen:()=>{this._itemWithOpenMenu=e}},y.tsx("calcite-action",{appearance:"transparent",icon:"ellipsis",scale:this.scale,slot:"trigger",text:r.menu,textEnabled:!1}),i?y.tsx("calcite-dropdown-group",{selectionMode:"none"},y.tsx("calcite-dropdown-item",{iconStart:"layer-zoom-to",onCalciteDropdownItemSelect:()=>this.goToItem(e)},t.zoomTo),y.tsx("calcite-dropdown-item",{iconStart:"selection-filter",onCalciteDropdownItemSelect:()=>this.selectSingleItem(e)},o?t.onlySelectFeature:t.onlySelectThis),y.tsx("calcite-dropdown-item",{iconStart:"selection-x",onCalciteDropdownItemSelect:()=>this.deselectItem(e)},a),this.itemActionConfigs?.map(t=>{if(!t.type||"feature"===t.type&&o||"layer"===t.type&&n||"group"===t.type&&s)return y.tsx("calcite-dropdown-item",{iconStart:t.icon??void 0,onCalciteDropdownItemSelect:()=>t.callback({item:e})},t.label)})):void 0)]}_renderGroupItem(e){const t=e.title||this.messages.untitledLayer;if(0===e.visibleTotal)return;const{displayMode:r}=this;if("layer"===r||"feature"===r)return this._renderListContent(e.items);const{visibleElements:i}=this;return y.tsx("calcite-list-item",{bind:this,closable:!!i.itemCloseActions,"data-type":"group",expanded:!0,iconStart:i.itemIcons?e.iconName:void 0,key:e.key,label:t,value:e.title,onCalciteListItemClose:t=>{t.stopPropagation(),this.deselectItem(e)},onCalciteListItemSelect:t=>this._onListItemSelect(e,t)},this._renderItemActions(e),this._renderListContent(e.items))}_renderLayerItem(e){if(0===e.visibleTotal||!e.visible)return;if("feature"===this.displayMode)return this._renderItems(e.featureItems);const{messages:t,visibleElements:r}=this,i=e.title||t.untitledLayer;return y.tsx("calcite-list-item",{bind:this,closable:!!r.itemCloseActions,"data-type":"layer",expanded:!0,iconStart:r.itemIcons?e.iconName:void 0,key:e.key,label:i,scale:this.scale,value:e.title,onCalciteListItemClose:t=>{t.stopPropagation(),this.deselectItem(e)},onCalciteListItemSelect:t=>this._onListItemSelect(e,t)},this._renderItemCount(e),this._renderItemActions(e),this._renderItems(e.featureItems),e.maxVisibleFeatureCountExceeded?y.tsx("calcite-notice",{class:S.notice,icon:"exclamation-mark-triangle",kind:"info",open:!0,scale:this.scale},y.tsx("div",{slot:"message"},t.tooManyFeatures)):void 0)}_renderItems(e){return e.map(e=>this._renderItem(e))}_renderItem(e){if(!e.visible)return;const{hightlightOnHoverEnabled:t,messages:r,visibleElements:i}=this,o=e.title||r.untitledFeature,n=i.itemIcons&&"feature"!==this.displayMode;return y.tsx("calcite-list-item",{bind:this,class:n?S.listItemFeatureIcon:S.listItemFeature,closable:!!i.itemCloseActions,"data-item":e,"data-type":"feature",key:e.key,label:o,name:o,onblur:t?()=>this.removeTemporaryHighlight():void 0,onfocus:t?()=>this.addTemporaryHighlight(e):void 0,onpointerenter:t?()=>this.addTemporaryHighlight(e):void 0,onpointerleave:t?()=>this.removeTemporaryHighlight():void 0,scale:this.scale,value:o,onCalciteListItemClose:t=>{t.stopPropagation(),this.deselectItem(e)},onCalciteListItemSelect:t=>this._onListItemSelect(e,t)},this._renderItemIcon(e),this._renderItemActions(e))}_renderItemIcon(e){if(this.visibleElements.itemIcons)return y.tsx("div",{class:S.listItemIcon,key:"content-start",slot:"content-start"},y.tsx("span",{afterCreate:this._afterItemCreate,afterRemoved:this._afterItemRemoved,"data-has-icon":!1,"data-item":e,key:e.thumbnailKey}))}_getListItem(e){return e?.["data-item"]}_hasIcon(e){return!!e?.["data-has-icon"]}_setHasIcon(e,t){e&&(e["data-has-icon"]=t)}_onListItemSelect(e,t){t.stopPropagation(),this._closeItemMenu(),this.onListItemSelect?.({item:e})}_closeItemMenu(e){e&&e!==this._itemWithOpenMenu||(this._itemWithOpenMenu=null)}};return t.__decorate([n.property()],x.prototype,"_hasFilterText",null),t.__decorate([n.property()],x.prototype,"_itemWithOpenMenu",void 0),t.__decorate([n.property()],x.prototype,"_list",void 0),t.__decorate([n.property()],x.prototype,"activeLayerItem",null),t.__decorate([n.property()],x.prototype,"allLayerItems",null),t.__decorate([n.property()],x.prototype,"displayMode",void 0),t.__decorate([n.property()],x.prototype,"effectiveCount",null),t.__decorate([n.property()],x.prototype,"effectiveSelectionManager",null),t.__decorate([n.property()],x.prototype,"filterText",null),t.__decorate([n.property()],x.prototype,"hightlightOnHoverEnabled",void 0),t.__decorate([n.property()],x.prototype,"icon",null),t.__decorate([n.property()],x.prototype,"itemActionConfigs",void 0),t.__decorate([n.property()],x.prototype,"isUpdating",null),t.__decorate([n.property()],x.prototype,"label",null),t.__decorate([n.property()],x.prototype,"layer",null),t.__decorate([n.property()],x.prototype,"layerItems",null),t.__decorate([n.property()],x.prototype,"layerViewMap",null),t.__decorate([n.property()],x.prototype,"maxVisibleFeatureCountExceeded",null),t.__decorate([n.property()],x.prototype,"maxVisibleFeatureCountPerLayer",null),t.__decorate([n.property()],x.prototype,"menuScale",void 0),t.__decorate([n.property(),h.messageBundle("esri/widgets/support/SelectionList/t9n/SelectionList")],x.prototype,"messages",void 0),t.__decorate([n.property(),h.messageBundle("esri/t9n/common")],x.prototype,"messagesCommon",void 0),t.__decorate([n.property(),h.messageBundle("esri/widgets/Legend/t9n/Legend")],x.prototype,"messagesLegend",void 0),t.__decorate([n.property()],x.prototype,"onListItemSelect",void 0),t.__decorate([n.property()],x.prototype,"scale",void 0),t.__decorate([n.property()],x.prototype,"selectionManager",null),t.__decorate([n.property()],x.prototype,"state",null),t.__decorate([n.property()],x.prototype,"view",null),t.__decorate([n.property()],x.prototype,"viewLayersAndTables",null),t.__decorate([n.property()],x.prototype,"viewModel",void 0),t.__decorate([n.property({type:g,nonNullable:!0})],x.prototype,"visibleElements",void 0),t.__decorate([n.property()],x.prototype,"visibleFeatureCount",null),t.__decorate([n.property()],x.prototype,"visibleFeatureItems",null),t.__decorate([n.property()],x.prototype,"visibleLayerCount",null),x=t.__decorate([l.subclass("esri.widgets.support.SelectionList")],x),x})},"esri/widgets/support/SelectionList/VisibleElements":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.filter=!0,this.filterNotice=!0,this.itemCloseActions=!0,this.itemCount=!0,this.itemIcons=!0,this.itemMenus=!0,this.header=!0,this.layerFilter=!0,this.menu=!0,this.totalCount=!0}};return e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"filter",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"filterNotice",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"itemCloseActions",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"itemCount",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"itemIcons",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"itemMenus",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"header",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"layerFilter",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"menu",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"totalCount",void 0),a=e.__decorate([s.subclass("esri.widgets.support.SelectionList.VisibleElements")],a),a})},"esri/widgets/support/SelectionToolbar":function(){define(["require","../../chunks/tslib.es6","../../intl","../../core/deprecate","../../core/handleUtils","../../core/Logger","../../core/maybe","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../Widget","../../chunks/componentsUtils","./globalCss","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SelectionToolbar/SelectionToolbarViewModel","./SelectionToolbar/VisibleElements","../../intl/number"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_){"use strict";const w="esri-selection-toolbar",S={base:w,container:`${w}__container`,toolButton:`${w}__tool-button`};let x=class extends u{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.disabled=!1,this.layout="horizontal",this.messages=null,this.scale="s",this.viewModel=new b,this.visibleElements=new v}initialize(){this._viewModelHandlesGroup=o.handlesGroup([a.on(()=>this.viewModel,"before-activate",e=>this.emit("before-activate",e)),a.on(()=>this.viewModel,"complete",e=>this.emit("complete",e)),a.on(()=>this.viewModel,"selection-change",e=>this.emit("selection-change",e))])}destroy(){this._viewModelHandlesGroup=s.removeMaybe(this._viewModelHandlesGroup)}loadDependencies(){return h.loadCalciteComponents({action:()=>new Promise((t,r)=>e(["../../chunks/index12"],t,r)),"action-bar":()=>new Promise((t,r)=>e(["../../chunks/index46"],t,r)),chip:()=>new Promise((t,r)=>e(["../../chunks/index11"],t,r))})}get _effectiveDisabled(){return this.disabled||"disabled"===this.state}get activeOperation(){return this.viewModel.activeOperation}get continuousSelectionEnabled(){return this.viewModel.continuousSelectionEnabled}set continuousSelectionEnabled(e){this.viewModel.continuousSelectionEnabled=e}get defaultLassoToolOptions(){return this.viewModel.defaultLassoToolOptions}set defaultLassoToolOptions(e){this.viewModel.defaultLassoToolOptions=e}get defaultOperationType(){return this.viewModel.defaultOperationType}set defaultOperationType(e){this.viewModel.defaultOperationType=e}get defaultPointToolOptions(){return this.viewModel.defaultPointToolOptions}set defaultPointToolOptions(e){this.viewModel.defaultPointToolOptions=e}get defaultRectangleToolOptions(){return this.viewModel.defaultRectangleToolOptions}set defaultRectangleToolOptions(e){this.viewModel.defaultRectangleToolOptions=e}get effectiveSelectionManager(){return this.viewModel.effectiveSelectionManager}get effectiveSources(){return this.viewModel.effectiveSources}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return i.deprecatedProperty(n.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){i.deprecatedProperty(n.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(e){this.viewModel.layerViewPreferenceEnabled=e}get persistSelection(){return this.viewModel.persistSelection}set persistSelection(e){this.viewModel.persistSelection=e}get returnFeatureTitleFields(){return this.viewModel.returnFeatureTitleFields}set returnFeatureTitleFields(e){this.viewModel.returnFeatureTitleFields=e}get returnGeometry(){return this.viewModel.returnGeometry}set returnGeometry(e){this.viewModel.returnGeometry=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get selectionManager(){return this.viewModel.selectionManager}set selectionManager(e){this.viewModel.selectionManager=e}get state(){return this.viewModel.state}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get toolConfigs(){return this.viewModel.toolConfigs}set toolConfigs(e){this.viewModel.toolConfigs=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visibleToolCount(){const{visibleElements:e}=this;return this.toolConfigs.length+(e.lassoTool?1:0)+(e.rectangleTool?1:0)}activate(e){if(this.cancel(),!this._effectiveDisabled)return this.viewModel.activate(e)}activateTool(e){if(!this._effectiveDisabled)return this.viewModel.activateTool(e)}cancel(){this.viewModel.cancel()}toggleTool(e){if(!this._effectiveDisabled)return this.viewModel.toggleTool(e)}render(){return g.tsx("div",{"aria-label":this.label,class:this.classes(S.base,y.globalCss.widget)},g.tsx("div",{class:S.container},g.tsx("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",scale:this.scale},this._renderDefaultTools(),this._renderCustomTools(),this._renderChip())))}_renderDefaultTools(){return[this._renderPanAction(),this._renderPointTool(),this._renderRectangleTool(),this._renderLassoTool()]}_renderPanAction(){if(!this.visibleElements.pan)return;const e=this.messages.pan,t=`${this.id}-tool-pan`;return this._renderAction({active:!this.activeOperation,disabled:this._effectiveDisabled,icon:"pan",id:t,key:t,onclick:()=>this.cancel(),text:e,title:e})}_renderChip(){if(!this.visibleElements.chip)return;const{effectiveSelectionManager:e}=this,t=e?.count??0,r=_.formatNumber(t);return g.tsx("calcite-chip",{appearance:"outline",closable:t>0,closed:0===t,disabled:this._effectiveDisabled||0===t,label:r,scale:this.scale,slot:"actions-end",title:this.messages.clearSelection,onCalciteChipClose:()=>e?.clear()},r)}_renderCustomTools(){return this.toolConfigs.map(({toolName:e,icon:t})=>this._renderToolWithTooltip(e,t))}_renderPointTool(){if(this.visibleElements.pointTool)return this._renderToolWithTooltip("point","selection-set",this.messages.selectByPoint)}_renderLassoTool(){if(this.visibleElements.lassoTool)return this._renderToolWithTooltip("lasso","lasso-select",this.messages.selectByLasso)}_renderRectangleTool(){if(this.visibleElements.rectangleTool)return this._renderToolWithTooltip("rectangle","cursor-marquee",this.messages.selectByRectangle)}_renderToolWithTooltip(e,t,r=e){const i=`${this.id}-tool-${e}`;return this._renderAction({active:this.activeOperation?.toolName===e,disabled:this._effectiveDisabled,icon:t||"selection",id:i,key:i,onclick:()=>this.toggleTool(e),text:r,title:r})}_renderAction(e){return g.tsx("calcite-action",{...e,bind:this,class:S.toolButton,scale:this.scale})}};return t.__decorate([l.property()],x.prototype,"_effectiveDisabled",null),t.__decorate([l.property()],x.prototype,"activeOperation",null),t.__decorate([l.property()],x.prototype,"continuousSelectionEnabled",null),t.__decorate([l.property()],x.prototype,"defaultLassoToolOptions",null),t.__decorate([l.property()],x.prototype,"defaultOperationType",null),t.__decorate([l.property()],x.prototype,"defaultPointToolOptions",null),t.__decorate([l.property()],x.prototype,"defaultRectangleToolOptions",null),t.__decorate([l.property()],x.prototype,"disabled",void 0),t.__decorate([l.property()],x.prototype,"effectiveSelectionManager",null),t.__decorate([l.property()],x.prototype,"effectiveSources",null),t.__decorate([l.property()],x.prototype,"label",null),t.__decorate([l.property()],x.prototype,"layers",null),t.__decorate([l.property()],x.prototype,"layerViewPreferenceEnabled",null),t.__decorate([l.property()],x.prototype,"layout",void 0),t.__decorate([l.property(),f.messageBundle("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],x.prototype,"messages",void 0),t.__decorate([l.property()],x.prototype,"persistSelection",null),t.__decorate([l.property()],x.prototype,"returnFeatureTitleFields",null),t.__decorate([l.property()],x.prototype,"returnGeometry",null),t.__decorate([l.property()],x.prototype,"selectOnComplete",null),t.__decorate([l.property()],x.prototype,"scale",void 0),t.__decorate([l.property()],x.prototype,"selectionManager",null),t.__decorate([l.property()],x.prototype,"state",null),t.__decorate([l.property()],x.prototype,"sources",null),t.__decorate([l.property()],x.prototype,"toolConfigs",null),t.__decorate([l.property()],x.prototype,"view",null),t.__decorate([l.property()],x.prototype,"viewModel",void 0),t.__decorate([l.property({type:v,nonNullable:!0})],x.prototype,"visibleElements",void 0),t.__decorate([l.property()],x.prototype,"visibleToolCount",null),x=t.__decorate([d.subclass("esri.widgets.support.SelectionToolbar")],x),x})},"esri/widgets/support/SelectionToolbar/VisibleElements":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.chip=!0,this.lassoTool=!0,this.pan=!0,this.pointTool=!0,this.rectangleTool=!0}};return e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"chip",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"lassoTool",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"pan",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"pointTool",void 0),e.__decorate([r.property({type:Boolean,nonNullable:!0})],a.prototype,"rectangleTool",void 0),a=e.__decorate([s.subclass("esri.widgets.support.SelectionToolbar.VisibleElements")],a),a})},"*noref":1}}),define(["require","../chunks/tslib.es6","../intl","../core/deprecate","../core/Logger","../core/maybe","../core/promiseUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/support/UpdatingHandles","../views/interactive/sketch/SketchValueOptions","./Attachments","./BatchAttributeForm","./FeatureForm","./FeatureTemplates","./Spinner","./Widget","./BatchAttributeForm/VisibleElements","./Editor/css","./Editor/EditorViewModel","./Editor/modelUploadUtils","./Editor/VisibleElements","./Editor/workflowUtils","./Editor/components/CreateFeaturesPanelContent","./Editor/components/FeatureList","./Editor/components/FooterActions","./Editor/components/Notices","./Editor/components/PanelContent","./Editor/components/PanelToolbar","./Editor/components/Prompt","./Editor/components/UpdateFeaturePanelContent","./Editor/components/UploadDetails","./Sketch/VisibleElements","../chunks/componentsUtils","./support/globalCss","./support/Heading","./support/ItemList","./support/loaderUtils","./support/SelectionList","./support/SelectionToolbar","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/SelectionList/VisibleElements","./support/SelectionToolbar/VisibleElements","../intl/substitute"],function(e,t,r,i,o,n,s,a,l,c,p,d,u,h,y,m,f,g,b,v,_,w,S,x,M,C,F,k,I,T,L,E,A,V,O,P,U,R,D,G,H,N,j,W,q,B,$,z,Z,K){"use strict";const J=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),Q=Symbol("sketch-setup-handles");let X=class extends v{constructor(e,t){super(e,t),this._batchAttributeForm=new m({visibleElements:new _.VisibleElements({loadingIndicator:!1})}),this._featureForm=new f,this._sketchToolbar=null,this._attachments=new y({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._associationItemList=null,this._associationSettings=null,this._featureTemplates=new g({enableListScroll:!1,renderItemContentEnd:e=>e.supportsUpload?$.tsx("calcite-icon",{class:w.css.templateItemContentEnd,icon:"upload-to",key:"upload-icon"}):null,renderItemLabel:e=>e.label,renderCustomGroupContent:e=>this._renderCustomTemplateGroupContent(e)}),this._filterText="",this._prompt=null,this._spinner=new b,this._loading=!1,this._selectionList=new N({displayMode:"layer",itemActionConfigs:this._selectionListItemActionConfigs,onListItemSelect:({item:e})=>this._onSelectionListItemSelect(e),visibleElements:new z({header:!1})}),this._selectionToolbar=new j({visibleElements:new Z({chip:!1})}),this._updatingHandles=new u.UpdatingHandles,this.headingLevel=4,this.messages=null,this.messagesBatchAttributeForm=null,this.messagesCommon=null,this.messagesTemplates=null,this.messagesFeature=null,this.supportingWidgetDefaults=null,this.viewModel=new S,this.visibleElements=new M,this._renderAttachments=()=>this._attachments.render(),this._renderFeatureForm=()=>this._featureForm.render(),this._renderBatchAttributeForm=()=>this._batchAttributeForm.render(),this._renderFeatureTemplates=()=>this._featureTemplates.render(),this._renderSelectionList=()=>this._selectionList.render(),this._renderSelectionToolbar=()=>this._selectionToolbar.render(),this._renderSketch=()=>this._sketchToolbar?$.tsx("div",{class:w.css.sketchContainer,key:"editor-sketch-container"},this._sketchToolbar?.render()):void 0,this._renderSelectIcon=()=>$.tsx("calcite-icon",{icon:"cursor",slot:"content-start"}),this.EditorPanel=({heading:e,key:t,selected:r},...i)=>{const{visibleElements:o}=this;return $.tsx("calcite-flow-item",{closable:!1,heading:e,headingLevel:this.headingLevel,key:t,loading:this._loading,selected:r,onCalciteFlowItemBack:this._onBack},o.zoomToButton&&this.viewModel.canZoomTo?$.tsx("calcite-action",{alignment:"center",appearance:"transparent",icon:"zoom-to-object",key:"zoom-to-button",onclick:()=>this.viewModel.zoomTo(),slot:"header-actions-end",text:this.messages.zoomTo,title:this.messages.zoomTo}):null,o.settingsMenu?$.tsx(E.PanelToolbar,{editorViewModel:this.viewModel,messagesCommon:this.messagesCommon,visibleElements:o}):null,...i)},this._showDiscardEditsPrompt=()=>{const{messages:e,activeWorkflow:t}=this,r={title:e.cancelEditTitle,message:e.cancelEditWarningMessage,yesLabel:e.discardEdits,noLabel:e.continueEditing};return"create-features"===t?.type&&x.isModelUpload(t.data.creationInfo)?this._showPromptAndWait("success"===t.data.upload?.state?e.modelUploads.cancelPlacementPrompt:e.modelUploads.cancelUploadPrompt):"update"===t?.type&&t.activeFeatureFormViewModel?.activeAssociation?this._showPromptAndWait({...r,message:e.cancelAssociationEditWarning}):this._showPromptAndWait(r)},this._showGenericCancelPrompt=()=>{const{messages:e,messagesCommon:t}=this;return this._showPromptAndWait({title:e.cancelRequestTitle,message:e.cancelRequestWarningMessage,yesLabel:t.form.yes,noLabel:t.form.no})},this._showPrompt=e=>{this._prompt?.cancel?.(),this._prompt=e},this._clearPrompt=()=>{this._prompt=null},this._onSave=()=>{this.viewModel.saveWorkflow()},this._onDelete=()=>{const e=this.viewModel.activeFeatureCount,t=e>1?this.messages.multiFeature:this.messages.singleFeature;this._showPrompt({title:t.deleteWarningTitle,message:t.deleteWarningMessage,context:"danger",actions:{primary:{label:K.substitute(t.delete,{count:e}),action:()=>{this.deleteFeatures(),this._clearPrompt()}},secondary:{label:t.keep,action:this._clearPrompt}}})},this._onDeleteAssociation=()=>{const{messages:e,messagesCommon:t}=this;this._showPrompt({title:e.deleteAssociationTitle,message:e.deleteAssociationMessage,context:"danger",actions:{primary:{label:t.delete,action:()=>{this.deleteAssociationFromWorkflow(),this._clearPrompt()}},secondary:{label:e.keepAssociation,action:this._clearPrompt}}})},this._onToggleUpdateWorkflow=()=>this.viewModel.toggleUpdateWorkflow(),this._onBack=e=>(e?.stopPropagation(),this.viewModel.back()),this._onAttachmentAdd=()=>{const{activeWorkflow:e}=this.viewModel;e&&("create-features"===e.type||"update"===e.type&&"create-features"===e.activeWorkflow?.type?(this._attachments.addFile(),e.back()):this._attachments.addAttachment().then(()=>e.back()))},this._onAttachmentUpdate=()=>{const{activeWorkflow:e}=this.viewModel;e&&("create-features"===e.type?(this._attachments.updateFile(),e.back()):this._attachments.updateAttachment().then(()=>e.back()))},this._onAttachmentDelete=()=>{const{messages:e,messagesCommon:t}=this;this._showPrompt({title:e.deleteAttachmentWarningTitle,message:e.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:this._onAttachmentDeleteConfirm},secondary:{label:e.keepAttachment,action:this._clearPrompt}}})},this._onAttachmentDeleteConfirm=async()=>{const e=this._attachments,{activeWorkflow:t}=this.viewModel;t&&("create-features"===t.type?e.deleteFile():(await e.deleteAttachment(e.viewModel.activeAttachmentInfo),this._clearPrompt()),await t.back(),this._clearPrompt())},this._onAttachmentsError=e=>{this._showPrompt({title:this.messages.errorWarningTitle,message:e.message,context:"warning",actions:{primary:{label:this.messagesCommon.form.ok,action:this._clearPrompt}}})}}initialize(){this._featureForm.showPrompt=this._showPrompt,this._featureForm.clearPrompt=this._clearPrompt,this.addHandles([a.watch(()=>D.incrementHeadingLevel(this.headingLevel),e=>{this._featureForm.headingLevel=e,this._featureTemplates.headingLevel=e},a.initial),a.on(()=>this.viewModel.activeWorkflow,"cancel-request",({controller:e})=>{(this.viewModel.hasPendingEdits?this._showDiscardEditsPrompt():this._showGenericCancelPrompt()).then(t=>t?e.allow():e.deny())}),a.when(()=>this.viewModel.formViewModel,e=>{C.isBatchAttributeFormViewModel(e)?this._batchAttributeForm.viewModel=e:this._featureForm.viewModel=e},a.initial),a.when(()=>this.viewModel.utilityNetworkAssociationAddAssociationViewModel,e=>{this._associationItemList?this._associationItemList.viewModel=e:this._updatingHandles.addPromise(this._initializeAssociationItemList(e))},a.initial),a.when(()=>this.viewModel.utilityNetworkAssociationAddAssociationViewModel?.association,()=>{this._setUpAssociationSettings()}),a.watch(()=>[this.viewModel,this.viewModel?.attachmentsViewModel,this.viewModel?.featureTemplatesViewModel,this.viewModel?.spinnerViewModel,this.viewModel?.selectionListViewModel,this.viewModel?.selectionToolbarViewModel],([e,t,r,i,o,n])=>{this._attachments.viewModel=t,this._featureTemplates.viewModel=r,this._spinner.viewModel=i,this._selectionList.viewModel=o,this._selectionToolbar.viewModel=n,e.showDiscardEditsPrompt=this._showDiscardEditsPrompt},a.initial),a.watch(()=>this.view,(e,t)=>{const r=`editor-${this.id}-spinner`;t?.ui.remove(this._spinner,r),e?.ui.add(this._spinner,{key:r,position:"manual"}),this._associationItemList&&(this._associationItemList.view=e)},a.initial),a.watch(()=>[this.supportingWidgetDefaults,this.viewModel.sketchViewModel],([e])=>{e&&(this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),this.viewModel.sketchViewModel?.set(e.sketch))},a.initial),a.when(()=>this._attachments?.error,e=>this._onAttachmentsError(e)),a.when(()=>this._selectionListItemActionConfigs,()=>{this._selectionList.itemActionConfigs=this._selectionListItemActionConfigs}),a.when(()=>this.viewModel?.failures,e=>{const{messages:t}=this,[{error:r,retry:i,cancel:o}]=e;this._showPrompt({title:t.errorWarningTitle,message:K.substitute(t.errorWarningMessageTemplate,{errorMessage:r.message}),context:"warning",actions:{primary:{label:t.retry,action:()=>{i(),this._clearPrompt()}},secondary:{label:t.ignore,action:()=>{o(),this._clearPrompt()}}}})}),a.watch(()=>this.viewModel?.state,e=>{switch(e){case"awaiting-feature-to-update":case"ready":case"disabled":this._filterText="",this._featureTemplates.filterText=""}}),a.watch(()=>this.viewModel.featureFormDisabled,e=>this._featureForm.disabled=e),a.watch(()=>this.visibleElements.sketch,()=>this._setupSketch(),a.initial),H.connectDelayedLoading({getLoading:()=>{const{viewModel:e}=this;return e.syncing||e.updating||this._attachments.submitting||this._updatingHandles.updating},setEffectiveLoading:e=>{this._loading=e}})])}destroy(){this._associationItemList?.destroy(),this._associationSettings?.destroy(),this._selectionList.destroy(),this._selectionToolbar.destroy(),this._attachments.destroy(),this._batchAttributeForm.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy(),this._spinner.destroy(),this._sketchToolbar=n.destroyMaybe(this._sketchToolbar),this._sketchImportAbortController=n.abortMaybe(this._sketchImportAbortController)}loadDependencies(){return Promise.all([U.loadCalciteComponents({action:()=>new Promise((t,r)=>e(["../chunks/index12"],t,r)),flow:()=>new Promise((t,r)=>e(["../chunks/index14"],t,r)),"flow-item":()=>new Promise((t,r)=>e(["../chunks/index15"],t,r)),icon:()=>new Promise((t,r)=>e(["../chunks/index7"],t,r)),list:()=>new Promise((t,r)=>e(["../chunks/index16"],t,r))}),F.loadCreateFeaturesPanelContentComponents(),k.loadFeatureListComponents(),I.loadFooterActionsComponents(),T.loadNoticesComponents(),L.loadPanelContentComponents(),E.loadPanelToolbarComponents(),A.loadPromptComponents(),V.loadUpdateFeaturePanelContentComponents(),O.loadUploadDetailsComponents()])}get _deleteButtonCommonInfo(){return{appearance:"outline",kind:"danger"}}get _selectionListItemActionConfigs(){const{messages:e}=this;return[{label:e?.batchEditing?.editThisFeature,icon:"edit-attributes",type:"feature",callback:({item:e})=>this._onSelectionListMenuItemSelect(e)},{label:e?.batchEditing?.editTheseFeatures,icon:"edit-attributes",type:"layer",callback:({item:e})=>this._onSelectionListMenuItemSelect(e)}]}get activeWorkflow(){return this.viewModel.activeWorkflow}get effectiveSelectionManager(){return this.viewModel.effectiveSelectionManager}get hideTemplatesForInactiveLayers(){return this.viewModel.hideTemplatesForInactiveLayers}set hideTemplatesForInactiveLayers(e){this.viewModel.hideTemplatesForInactiveLayers=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureCreation(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)}startCreateFeaturesWorkflowAtFeatureEdit(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureEdit(e)}startUpdateFeaturesWorkflow(e){return this.viewModel.startUpdateFeaturesWorkflow(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}async startUpdateWorkflowWithActiveSelection(){await this.viewModel.startUpdateWorkflowWithActiveSelection()}deleteFeatureFromWorkflow(){return i.deprecatedFunction(o.getLogger(this),"Editor.deleteFeatureFromWorkflow is deprecated. Use Editor.deleteFeatures instead.",{version:"4.33",replacement:"Editor.deleteFeatures",warnOnce:!0}),this.deleteFeatures()}async deleteFeatures(){await this.viewModel.deleteFeatures()}deleteAssociationFromWorkflow(){return this.viewModel.deleteAssociationFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{visibleElements:e,viewModel:t}=this,r=this.classes(w.css.base,R.globalCss.widget,R.globalCss.panel);if(!t)return $.tsx("div",{class:r,key:"empty"});const{pageStack:i}=t,o=i.length-1,n=i.map((e,t)=>this._renderPage(e,t===o));return $.tsx("div",{class:r,key:"base"},e.flow?$.tsx("calcite-flow",{inert:!!this._prompt,key:"flow"},n):n,this._prompt?$.tsx(A.Prompt,{...this._prompt,headingLevel:this.headingLevel}):void 0)}_renderPage(e,t){const r={selected:t};switch(e){case"disabled":break;case"ready":return this._renderReady(r);case"viewing-selection-list":return this._renderSelectionListPage(r);case"awaiting-feature-creation-info":return this._renderAwaitingFeatureCreationInfo(r);case"creating-features-upload-details":return this._renderUploadDetails(r);case"creating-features":return this._renderCreatingFeatures(r);case"editing-existing-feature":case"editing-features":case"editing-attributes":return this._renderUpdateFeature(r);case"awaiting-update-feature-candidate":return this._renderFeatureList(r);case"adding-attachment":return this._renderAttachmentAdding(r);case"editing-attachment":return this._renderAttachmentEditing(r);case"viewing-associated-layers":case"viewing-associated-features":return this._renderViewAssociatedLayers(r);case"add-association-select-layer":case"add-association-select-feature":return this._renderSelectFeature(r);case"add-association-create-association":return this._renderAddAssociation(r)}return $.tsx("div",{key:"empty-page"})}_renderAwaitingFeatureCreationInfo(e){const{EditorPanel:t,messages:r}=this;return $.tsx(t,{heading:r.selectTemplate,key:"templates-panel",...e},$.tsx(L.PanelContent,{key:"feature-templates"},$.tsx(L.PanelContentSection,null,this._renderFeatureTemplates())))}_renderUploadDetails(e){const{EditorPanel:t,activeWorkflow:r,messages:i}=this;if("create-features"!==r?.type)return null;const o=r.data.upload;return o?$.tsx(t,{heading:i.createFeatures,key:"upload-details-panel",...e},$.tsx(O.UploadDetails,{helpMessage:this._helpMessage,messages:i,upload:o})):null}_renderCreatingFeatures(e){const{EditorPanel:t,activeWorkflow:r,messages:i,messagesCommon:o,headingLevel:n,viewModel:s}=this;if(!r)return null;const a="create-features"===r.type&&r.numPendingFeatures>0||"update"===r.type&&"create-features"===r?.activeWorkflow?.type&&r.activeWorkflow?.numPendingFeatures>0;return $.tsx(t,{heading:i.createFeatures,key:"create-features-panel",...e},a?$.tsx(V.UpdateFeaturePanelContent,{editorViewModel:s,headingLevel:n,messages:i,messagesCommon:o,renderAttachments:this._renderAttachments,renderBatchAttributeForm:this._renderBatchAttributeForm,renderFeatureForm:this._renderFeatureForm,renderSketchToolbar:this._renderSketch,onDelete:this._onDelete,onDeleteAssociation:this._onDeleteAssociation,onSave:this._onSave}):$.tsx(F.CreateFeaturesPanelContent,{helpMessage:this._helpMessage,renderSketchToolbar:this._renderSketch}))}_renderUpdateFeature(e){const{EditorPanel:t,messages:r,messagesCommon:i,headingLevel:o,viewModel:n}=this,s=n.activeFeatureCount>1?r.multiFeature.editPanelTitle:r.singleFeature.editPanelTitle;return $.tsx(t,{heading:s,key:"update-feature-panel",...e},$.tsx(V.UpdateFeaturePanelContent,{editorViewModel:n,headingLevel:o,messages:r,messagesCommon:i,renderAttachments:this._renderAttachments,renderBatchAttributeForm:this._renderBatchAttributeForm,renderFeatureForm:this._renderFeatureForm,onDelete:this._onDelete,onDeleteAssociation:this._onDeleteAssociation,onSave:this._onSave}))}_getAssociationTypeTitle(e){const{messages:t}=this;if(!e)return t.singleFeature.editPanelTitle;if(e.title)return e.title;const{messagesFeature:r}=this;switch(e.type){case"attachment":return r.associationsAttachments;case"connectivity":return r.associationsConnectivity;case"structure":return r.associationsStructure;case"content":return r.associationsContents;case"container":return r.associationsContainer}}_getAddAssociationTypeTitle(e){const{messages:t}=this;if(!e)return t.singleFeature.editPanelTitle;const r=t.associations;switch(e.type){case"attachment":return r.addAttachment;case"connectivity":return r.addConnectivity;case"structure":return r.addStructure;case"content":return r.addContent;case"container":return r.addContainer}}async _initializeAssociationItemList(t){const r=(await new Promise((t,r)=>e(["./FeatureForm/FeatureFormUtilityNetworkAssociations/UtilityNetworkAssociationItemList"],e=>t(J(e)),r))).default;this._associationItemList=new r({view:this.view,viewModel:t})}async _initializeAssociationSettings(){const t=new(0,(await new Promise((t,r)=>e(["./FeatureForm/FeatureFormUtilityNetworkAssociations/UtilityNetworkAssociationSettings"],e=>t(J(e)),r))).default);return this._associationSettings=t,t}_renderViewAssociatedLayers(e){const{EditorPanel:t,messages:r,messagesCommon:i,headingLevel:o,viewModel:n}=this,s=n.featureFormViewModel?.activeAssociationInput?.activeAssociationType,a=this._getAssociationTypeTitle(s);return $.tsx(t,{heading:a,key:"viewing-associated-layers-panel",...e},$.tsx(V.UpdateFeaturePanelContent,{editorViewModel:n,headingLevel:o,messages:r,messagesCommon:i,renderAttachments:this._renderAttachments,renderBatchAttributeForm:this._renderBatchAttributeForm,renderFeatureForm:this._renderFeatureForm,renderSketchToolbar:this._renderSketch,onDelete:this._onDelete,onDeleteAssociation:this._onDeleteAssociation,onSave:this._onSave}))}_renderSelectFeature(e){const{_associationItemList:t,EditorPanel:r,viewModel:i,messagesCommon:o}=this,n=i.utilityNetworkAssociationAddAssociationViewModel,s=this._getAddAssociationTypeTitle(n?.associationType),a="ready"!==n?.state||this.viewModel.featureFormDisabled;return t?$.tsx(r,{heading:s,key:"add-association-select-feature",...e},$.tsx(L.PanelContent,{key:"select-feature"},$.tsx(L.PanelContentSection,null,t.render())),$.tsx(I.FooterActions,{buttons:[t.filterOptionsVisible?{appearance:"solid",label:o.apply,disabled:a,onClick:()=>t.applyFilterOptions(),type:"button"}:void 0,{appearance:"outline",label:o.cancel,disabled:a,onClick:()=>{"update"===i.activeWorkflow?.type&&(n?.reset(),i.activeWorkflow.cancelActiveWorkflow())},type:"button"}]})):$.tsx(r,{heading:s,key:"add-association-select-feature",...e})}async _setUpAssociationSettings(){const{viewModel:e}=this,t=this._associationSettings??await this._updatingHandles.addPromise(this._initializeAssociationSettings()),r=e.utilityNetworkAssociationAddAssociationViewModel,i="update"===e.activeWorkflow?.type?e.activeWorkflow:null,o=i?i.activeWorkflow:null,n="add-association"===o?.type?o.sourceFeatureItem:null,s=r?.selectedFeature,a=r?.association,l=r?.utilityNetwork;n&&s&&a&&l&&(t.sourceFeature=n,t.targetFeature=s,t.association=a,t.utilityNetwork=l)}_renderAddAssociation(e){const{_associationSettings:t,EditorPanel:r,viewModel:i,messagesCommon:o}=this;if(!t)return null;const n=i.utilityNetworkAssociationAddAssociationViewModel,s=this._getAddAssociationTypeTitle(n?.associationType),a="ready"!==n?.state;return $.tsx(r,{heading:s,key:"add-association",...e},$.tsx(L.PanelContent,{key:"add-association-content"},$.tsx(L.PanelContentSection,null,t.render())),$.tsx(I.FooterActions,{buttons:[{label:o.add,disabled:a||!n.canAddAssociation,onClick:()=>this._onSave(),type:"button"},{appearance:"outline",label:o.cancel,disabled:a,onClick:()=>{"update"===i.activeWorkflow?.type&&i.activeWorkflow.cancelActiveWorkflow()},type:"button"}]}))}_renderCustomTemplateGroupContent(e){const{messages:t,viewModel:r}=this,i=n.mappedFind(e.group.items,e=>r.itemHasInvalidFormTemplate(e)?t.formFieldCreateError:void 0);return i?$.tsx(T.Notice,{kind:"warning",message:i}):null}_renderAttachmentAdding(e){const{EditorPanel:t,_attachments:r,messages:i,messagesCommon:o}=this;return $.tsx(t,{heading:i.addAttachment,key:"attachment-adding-panel",...e},$.tsx(L.PanelContent,{key:"attachments"},this._renderAttachments()),$.tsx(I.FooterActions,{buttons:[{label:r.submitting?o.cancel:o.add,disabled:r.submitting||!r.selectedFile,onClick:this._onAttachmentAdd,type:"button"}]}))}_renderSelectionListPage(e){const{_selectionList:t,messages:r,EditorPanel:i}=this,{batchUpdateActions:o}=this.visibleElements,{effectiveCount:n,filterText:s,maxVisibleFeatureCountPerLayer:a,visibleFeatureCount:l,visibleLayerCount:c}=t,p=c>1,d=null!=s&&""!==s?l:n,u=1===c&&d>a,h=p||u||0===l;return $.tsx(i,{heading:r.widgetLabel,key:"selection-list-panel",...e},this.visibleElements.selectionToolbar&&"3d"!==this.view?.type?$.tsx("div",{class:w.css.selectionToolbarContainer},this._renderSelectionToolbar()):void 0,$.tsx(L.PanelContent,{key:"selection-list"},$.tsx(L.PanelContentSection,null,this._renderSelectionList())),$.tsx(I.FooterActions,{buttons:[o?{label:K.substitute(r.batchEditing.editCount,{count:d}),disabled:h,onClick:()=>this.startUpdateWorkflowWithActiveSelection(),type:"button"}:void 0],notice:o&&p?{text:r.batchEditing.selectOneLayer,icon:"information"}:o&&u?{text:K.substitute(this.messagesBatchAttributeForm.formFailedToLoadTooManyFeatures,{num:a}),icon:"information"}:void 0}))}_renderAttachmentEditing(e){const{EditorPanel:t,_attachments:r,activeWorkflow:i,messages:o,messagesCommon:n}=this;return i?$.tsx(t,{heading:o.editAttachment,key:"attachment-editing-panel",...e},$.tsx(L.PanelContent,{key:"attachments"},this._renderAttachments()),i.shouldAllowAttachmentEditing?$.tsx(I.FooterActions,{buttons:[{label:n.update,disabled:r.submitting||!r.selectedFile,onClick:this._onAttachmentUpdate,type:"button"},{...this._deleteButtonCommonInfo,onClick:this._onAttachmentDelete,disabled:r.submitting,label:n.delete,type:"button"}]}):void 0):null}_renderReady(e){const{EditorPanel:t,messages:r,viewModel:i,visibleElements:o}=this,n=this._helpMessage;return $.tsx(t,{heading:r.widgetLabel,key:"landing-panel",...e},$.tsx(L.PanelContent,{key:"landing-content"},i.editorItems.length?[o.editFeaturesSection?$.tsx(L.PanelContentSection,{key:"edit-actions"},this._renderUpdateActions()):null,o.createFeaturesSection&&i.canCreateVisible?$.tsx(L.PanelContentSection,{key:"create-actions"},this._renderCreateActions()):null]:$.tsx(L.PanelContentMessage,{key:"no-content"},r.noEditableLayers)),n?$.tsx("div",{class:w.css.helpMessage,key:"footer-actions",slot:"footer"},n):void 0)}get _helpMessage(){const{activeWorkflow:e,messages:t,view:r}=this,i=e?.helpMessage;return i?t["3d"===r?.type?"helpMessages3d":"helpMessages2d"]?.[i]:void 0}_renderUpdateActions(){const{messages:e,messagesCommon:t,viewModel:r}=this,i={id:"select",label:t.select};return $.tsx("div",{class:w.css.updateActions,key:"update-actions"},$.tsx(D.Heading,{level:D.incrementHeadingLevel(this.headingLevel)},e.editFeatures),this.visibleElements.selectionToolbar&&"3d"!==this.view?.type?$.tsx("div",{class:w.css.selectionToolbarContainer},this._renderSelectionToolbar()):$.tsx("calcite-list",{class:w.css.updateActionsList,label:e.editFeaturesList,selectionAppearance:"border",selectionMode:"single"},G.renderItem({disabled:!r.canUpdateVisible,grouped:!1,item:i,selectedItem:"awaiting-feature-to-update"===r.activeWorkflow?.stepId?i:void 0,renderIcon:this._renderSelectIcon,onItemSelect:this._onToggleUpdateWorkflow})))}_renderCreateActions(){return $.tsx("div",{key:"create-actions"},$.tsx(D.Heading,{level:D.incrementHeadingLevel(this.headingLevel)},this.messages.createFeatures),$.tsx("div",{class:w.css.featureTemplatesContainer,key:"templates"},this._renderFeatureTemplates()))}_renderFeatureList(e){const{EditorPanel:t,viewModel:r}=this,{activeWorkflow:i}=r;if("update"!==i?.type)return null;const o=i.data.candidates,n=K.substitute(this.messages.multipleFeaturesTemplate,{total:o.length});return $.tsx(t,{heading:n,key:"feature-list",...e},$.tsx(k.FeatureList,{editorItems:r.editorItems,editorMessages:this.messages,filterText:this._filterText,id:this.id,messagesTemplates:this.messagesTemplates,workflow:i,onFilterTextChange:e=>this._filterText=e,onSelectFeature:(e,t)=>r.selectFeature(e,t),onZoomTo:e=>r.zoomTo(e)}))}_showPromptAndWait({title:e,message:t,yesLabel:r,noLabel:i}){const o=s.createResolver(),{view:n}=this,a=n?.focused;return this._showPrompt({title:e,message:t,context:"danger",actions:{primary:{label:r,action:()=>o.resolve(!0)},secondary:{label:i,action:()=>o.resolve(!1)}}}),o.promise.finally(()=>{this._clearPrompt(),a&&n?.focus()})}async _onSelectionListItemSelect(e){await this.viewModel.onSelectionListItemSelect(e)}async _onSelectionListMenuItemSelect(e){await this.viewModel.onSelectionListMenuItemSelect(e)}async _setupSketch(){if(!this.visibleElements.sketch)return this._sketchImportAbortController=n.abortMaybe(this._sketchImportAbortController),this._sketchToolbar=n.destroyMaybe(this._sketchToolbar),void this.removeHandles(Q);if(this._sketchImportAbortController)return;const t=new AbortController;this._sketchImportAbortController=t;const r=await new Promise((t,r)=>e(["./Sketch"],e=>t(J(e)),r));if(!t.signal.aborted)try{this._sketchToolbar=new r.default({toolbarKind:"docked",contextualToolLocation:"inline-end",scale:"s",visibleElements:new P.VisibleElements({deleteButton:!1,settingsMenu:!1,directionModePicker:!1,selectionCountLabel:!1,duplicateButton:!1,createTools:new P.CreateToolVisibilityMap({freehandPolygon:!0,freehandPolyline:!0}),selectionTools:new P.SelectionToolVisibilityMap({"lasso-selection":!1,"rectangle-selection":!1})})}),this.addHandles([a.watch(()=>this.viewModel.activeLeafWorkflow?.availableCreateTools,e=>{this._sketchToolbar&&(this._sketchToolbar.availableCreateTools=e)},a.initial),a.watch(()=>this.visibleElements.undoRedoButtons,e=>{this._sketchToolbar&&(this._sketchToolbar.visibleElements.undoRedoMenu=e)},a.initial),a.when(()=>this.viewModel?.sketchViewModel,e=>{this._sketchToolbar&&(this._sketchToolbar.viewModel=e)},a.initial)],Q)}finally{this._sketchImportAbortController=null}}get test(){return{sketch:this._sketchToolbar,showPrompt:this._showPromptAndWait.bind(this)}}};return t.__decorate([l.property()],X.prototype,"_batchAttributeForm",void 0),t.__decorate([l.property()],X.prototype,"_featureForm",void 0),t.__decorate([l.property()],X.prototype,"_sketchToolbar",void 0),t.__decorate([l.property()],X.prototype,"_attachments",void 0),t.__decorate([l.property()],X.prototype,"_associationItemList",void 0),t.__decorate([l.property()],X.prototype,"_associationSettings",void 0),t.__decorate([l.property()],X.prototype,"_featureTemplates",void 0),t.__decorate([l.property()],X.prototype,"_filterText",void 0),t.__decorate([l.property()],X.prototype,"_prompt",void 0),t.__decorate([l.property()],X.prototype,"_spinner",void 0),t.__decorate([l.property()],X.prototype,"_deleteButtonCommonInfo",null),t.__decorate([l.property()],X.prototype,"_loading",void 0),t.__decorate([l.property()],X.prototype,"_selectionList",void 0),t.__decorate([l.property()],X.prototype,"_selectionListItemActionConfigs",null),t.__decorate([l.property()],X.prototype,"_selectionToolbar",void 0),t.__decorate([l.property({readOnly:!0})],X.prototype,"activeWorkflow",null),t.__decorate([l.property()],X.prototype,"effectiveSelectionManager",null),t.__decorate([l.property()],X.prototype,"headingLevel",void 0),t.__decorate([l.property()],X.prototype,"hideTemplatesForInactiveLayers",null),t.__decorate([l.property()],X.prototype,"icon",null),t.__decorate([l.property()],X.prototype,"label",null),t.__decorate([l.property()],X.prototype,"labelOptions",null),t.__decorate([l.property()],X.prototype,"layerInfos",null),t.__decorate([l.property(),q.messageBundle("esri/widgets/Editor/t9n/Editor")],X.prototype,"messages",void 0),t.__decorate([l.property(),q.messageBundle("esri/widgets/BatchAttributeForm/t9n/BatchAttributeForm")],X.prototype,"messagesBatchAttributeForm",void 0),t.__decorate([l.property(),q.messageBundle("esri/t9n/common")],X.prototype,"messagesCommon",void 0),t.__decorate([l.property(),q.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],X.prototype,"messagesTemplates",void 0),t.__decorate([l.property(),q.messageBundle("esri/widgets/Feature/t9n/Feature")],X.prototype,"messagesFeature",void 0),t.__decorate([l.property()],X.prototype,"snappingOptions",null),t.__decorate([l.property()],X.prototype,"tooltipOptions",null),t.__decorate([l.property()],X.prototype,"supportingWidgetDefaults",void 0),t.__decorate([l.property({type:h,nonNullable:!0})],X.prototype,"valueOptions",null),t.__decorate([l.property()],X.prototype,"view",null),t.__decorate([l.property(),B.vmEvent(["sketch-create","sketch-delete","sketch-update","workflow-cancel","workflow-commit"])],X.prototype,"viewModel",void 0),t.__decorate([l.property({type:M,nonNullable:!0})],X.prototype,"visibleElements",void 0),t.__decorate([l.property()],X.prototype,"_helpMessage",null),X=t.__decorate([d.subclass("esri.widgets.Editor")],X),X});