// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../chunks/tslib.es6","../../../../intl","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","./LegendElement","../../../../chunks/componentsUtils","../../../support/widgetUtils","../../../support/decorators/messageBundle","../../../support/jsxFactory","../../../../intl/substitute"],function(e,s,t,r,a,i,n,o,c,l,d,u,h,p,y,g,f){"use strict";return s.default=class extends l{constructor(e,s){super(e,s),this._hasIndicators=!1,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}loadDependencies(){return h.loadCalciteComponents({carousel:()=>new Promise((s,t)=>e(["../../../../chunks/index62"],s,t)),"carousel-item":()=>new Promise((s,t)=>e(["../../../../chunks/index63"],s,t))})}render(){this._hasIndicators="auto"===this.layout&&this.view&&this.view.container.clientWidth<=768||"stack"===this.layout;const e=this._hasIndicators?this._renderCarousel():this._renderLayers(),s={[d.css.stacked]:this._hasIndicators};return g.tsx("div",{class:this.classes(d.css.base,s)},e||g.tsx("div",{class:d.css.message},this.messages.noLegend))}_renderCarousel(){const e=[],s=this.activeLayerInfos;if(s)for(const t of s)this._renderSections(t,e);return e?.length?g.tsx("calcite-carousel",{class:d.css.carousel,label:this.messages.carousel},e.map((s,t)=>g.tsx("calcite-carousel-item",{class:d.css.carouselItem,key:t,label:f.substitute(this.messagesCommon.pagination.pageText,{index:t+1,total:e.length})},s))):null}_renderLayers(){const e=this.activeLayerInfos,s=e?.toArray()?.map(e=>this._renderLegendForLayer(e)).filter(Boolean);return s?.length?s:null}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const s=e.children.toArray().map(this._renderLegendForLayer,this);return g.tsx("section",{class:this.classes(d.css.service,d.css.groupLayer),key:e.layer.uid},g.tsx("div",{class:d.css.serviceCaptionContainer},e.title),s)}return this._renderLegendElementsForLayer(e)}_renderLegendElementsForLayer(e){const s=e.legendElements?.filter(Boolean);if(!s?.length)return null;const t=s.map(s=>g.tsx(u,{activeLayerInfo:e,effectList:e.effectList,hasIndicators:this._hasIndicators,headingLevel:this.headingLevel,isChild:!1,key:`${e.layer.uid}-${s.type}`,layer:e.layer,legendElement:s,messages:this.messages})),r={[d.css.groupLayerChild]:!!e.parent};return g.tsx("section",{class:this.classes(d.css.service,r),key:e.layer.uid},g.tsx("div",{class:d.css.serviceCaptionContainer},g.tsx("div",{class:d.css.serviceCaptionText},e.title)),g.tsx("div",{class:d.css.serviceContent},t))}_renderSections(e,s){if(!e.ready)return;if(e.children.length)for(const t of e.children)this._renderSections(t,s);const t=e.legendElements;if(t?.length)for(const r of t){const t=g.tsx(u,{activeLayerInfo:e,effectList:e.effectList,hasIndicators:this._hasIndicators,headingLevel:this.headingLevel,isChild:!1,key:`${e.layer.uid}-${r.type}`,layer:e.layer,legendElement:r,messages:this.messages});t&&s.push(t)}}},t.__decorate([a.property()],s.default.prototype,"activeLayerInfos",void 0),t.__decorate([a.property()],s.default.prototype,"headingLevel",void 0),t.__decorate([a.property()],s.default.prototype,"layout",void 0),t.__decorate([a.property(),y.messageBundle("esri/widgets/Legend/t9n/Legend")],s.default.prototype,"messages",void 0),t.__decorate([a.property(),y.messageBundle("esri/t9n/common")],s.default.prototype,"messagesCommon",void 0),t.__decorate([a.property({readOnly:!0})],s.default.prototype,"type",void 0),t.__decorate([a.property()],s.default.prototype,"view",void 0),s.default=t.__decorate([c.subclass("esri.widgets.Legend.styles.card.CardView")],s.default),s.default});