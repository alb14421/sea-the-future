// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../Color","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../symbols/support/utils","../../../Widget","./ColorRamp","./css","./SizeRamp","./UnivariateAboveAndBelowRamp","./UnivariateColorSizeRamp","../support/relationshipUtils","../support/utils","../../support/styleUtils","../../../support/Heading","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,s,t,i,a,r,l,o,n,c,d,p,h,y,m,g,u,f,v,b,L){"use strict";var x;return e.default=x=class extends c{constructor(e,s){super(e,s),this.effectList=null,this.hasIndicators=!1,this.headingLevel=3,this.isChild=!1,this.legendElement=null}render(){const e=this._renderLegendElement(),s=u.getLegendElementTitle(this.legendElement,this.messages),t=this.hasIndicators&&!this.isChild?L.tsx("div",null,L.tsx(v.Heading,{class:p.css.carouselTitle,level:this.headingLevel},this.activeLayerInfo.title),L.tsx(v.Heading,{class:p.css.layerCaption,level:v.incrementHeadingLevel(this.headingLevel)},s)):s?L.tsx(v.Heading,{class:p.css.layerCaption,level:this.headingLevel},s):null;return L.tsx("section",{"aria-labelledby":this.key,class:p.css.section,id:`${this.key}-panel`,key:this.key,role:"tabpanel",tabIndex:0},t,e)}_renderLegendElement(){switch(this.legendElement.type){case"symbol-table":return this._renderSymbolTable(this.legendElement);case"size-ramp":return L.tsx(h,{hasIndicators:this.hasIndicators,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":return L.tsx(d,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"relationship-ramp":return g.renderRelationshipRamp(this.legendElement,this.id,{opacity:this.layer.opacity,effectList:this.effectList,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:this.key});case"pie-chart-ramp":return L.tsx("div",{afterCreate:f.attachToNode,bind:this.legendElement.preview,class:p.css.pieChartRampPreview,key:`${this.key}-preview`});case"univariate-above-and-below-ramp":return L.tsx(y,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"univariate-color-size-ramp":return L.tsx(m,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});default:return null}}_renderSymbolTable(e){const s=e.infos.map(s=>this._renderElementInfo(s,e.legendType)).filter(Boolean);if(!s.length)return null;const t=this.activeLayerInfo.legendElements.some(({type:e})=>"relationship-ramp"===e),i=s[0]?.properties?.classes?.[p.css.symbolRow],a={[p.css.labelContainer]:!i&&!t,[p.css.relationshipLabelContainer]:t};return L.tsx("div",{class:this.classes(a)},s)}_renderElementInfo(e,s){const{layer:t}=this,i="label"in e?e.label:null,a=`${this.key}-${i}`;if("type"in e&&e.type)return L.tsx(x,{activeLayerInfo:this.activeLayerInfo,effectList:this.effectList,hasIndicators:this.hasIndicators,headingLevel:this.headingLevel,isChild:!0,key:a,layer:t,legendElement:e,messages:this.messages});if(!("preview"in e&&e.preview||"src"in e&&e.src))return null;const r=f.isImageryStretchedLegend(t,s),l=f.getTitle(this.messages,i,!1)||"";if("src"in e&&e.src)return L.tsx("div",{class:p.css.layerRow,key:`${a}-row`},this._renderImage(e,t,r),L.tsx("div",{class:p.css.imageLabel},l));if("symbol"in e&&e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return L.tsx("div",{afterCreate:f.attachToNode,bind:e.preview,key:`${a}-row`});const s={[p.css.symbolCell]:this.hasIndicators};return L.tsx("div",{class:this.classes(p.css.layerRow,{[p.css.symbolRow]:this.hasIndicators}),key:`${a}-row`},L.tsx("div",{afterCreate:f.attachToNode,bind:e.preview,class:this.classes(s)}),L.tsx("div",{class:this.classes(p.css.imageLabel,{[p.css.labelCell]:this.hasIndicators})},l))}return L.tsx("div",{class:p.css.layerRow,key:`${a}-row`},L.tsx("div",{class:p.css.labelElement,styles:this._getBackgroundStyles(e)},l))}return null}_getBackgroundStyles(e){const s=e.symbol,i=s.color,a=!!i?.a,r="outline"in s?s.outline:null,l=!!r?.color?.a,o=new t(a&&i?[i.r,i.g,i.b,i.a*this.layer.opacity]:[255,255,255,0]),c=l&&r.color?new t([r.color.r,r.color.g,r.color.b,r.color.a*this.layer.opacity]):new t([255,255,255,0]),d=e.symbol.color?.isBright??!0,p=d?"black":"white",h=d?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return{background:a?o.toCss(!0):"none",color:p,textShadow:`-1px -1px 0 ${h},\n                  1px -1px 0 ${h},\n                  -1px 1px 0 ${h},\n                  1px 1px 0 ${h}`,border:l?`1px solid ${c.toCss(!0)}`:"none",filter:n.getCSSFilterFromEffectList(this.effectList)??void 0}}_renderImage(e,s,t){const{label:i,src:a,opacity:r}=e,l={[p.css.imageryLayerStretchedImage]:t,[p.css.symbol]:!t},o={opacity:`${r??s.opacity}`},n=f.getTitle(this.messages,i,!1);return L.tsx("img",{alt:n,"aria-label":n,border:0,class:this.classes(l),height:e.height,src:a,styles:o,width:e.width})}},s.__decorate([i.property()],e.default.prototype,"activeLayerInfo",void 0),s.__decorate([i.property()],e.default.prototype,"effectList",void 0),s.__decorate([i.property()],e.default.prototype,"hasIndicators",void 0),s.__decorate([i.property()],e.default.prototype,"headingLevel",void 0),s.__decorate([i.property()],e.default.prototype,"isChild",void 0),s.__decorate([i.property()],e.default.prototype,"layer",void 0),s.__decorate([i.property()],e.default.prototype,"legendElement",void 0),s.__decorate([i.property()],e.default.prototype,"messages",void 0),e.default=x=s.__decorate([o.subclass("esri.widgets.Legend.styles.card.LegendElement")],e.default),e.default});