// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../Widget","../../chunks/componentsUtils","./widgetUtils","./decorators/messageBundle","./jsxFactory","./FilterCondition/FilterConditionViewModel"],function(e,t,r,l,i,o,a,s,d,n,u,p,c,h){"use strict";const _={},v="esri-filter-condition",f={base:v,valueInputContainer:`${v}__value-input-container`};return t.default=class extends d{constructor(e,t){super(e,t),this.messages=null,this.messagesCommon=null,this.viewModel=new h,this.visibleElements={..._}}loadDependencies(){return n.loadCalciteComponents({input:()=>new Promise((t,r)=>e(["../../chunks/index4"],t,r)),option:()=>new Promise((t,r)=>e(["../../chunks/index8"],t,r)),select:()=>new Promise((t,r)=>e(["../../chunks/index9"],t,r))})}get _defaultFieldName(){const{fields:e,fieldName:t}=this;return t||(e?.length?e[0].name:void 0)}get _valueInputType(){const{viewModel:e}=this;return e.isNumericField||e.isObjectIDField?"number":"text"}get _visibleOperators(){const{field:e,operators:t,viewModel:r}=this;return e?r.isStringField||r.isGlobalIDField?t.string:r.isNumericField?t.number:r.isObjectIDField?t.id:[]:[]}get _isValueInputHidden(){const{operator:e}=this;return!!e&&["isBlank","isNotBlank","isEmpty","isNotEmpty"].includes(e)}get domain(){return this.viewModel.domain}get field(){return this.viewModel.field}get fields(){return this.viewModel.fields}get fieldLabel(){return this.viewModel.fieldLabel}get fieldName(){return this.viewModel.fieldName}set fieldName(e){this.viewModel.fieldName=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get normalizedFieldName(){return this.viewModel.normalizedFieldName}get operator(){return this.viewModel.operator}set operator(e){this.viewModel.operator=e}get operators(){return this.viewModel.operators}set operators(e){this.viewModel.operators=e}get state(){return this.viewModel.state}get value(){return this.viewModel.value}set value(e){this.viewModel.value=e}get valueAsString(){return this.viewModel.valueAsString}castVisibleElements(e){return{..._,...e}}get whereClause(){return this.viewModel.whereClause}render(){return c.tsx("div",{class:f.base},this._renderFieldSelection(),this._renderOperatorSelection(),this._renderValueInput())}_renderFieldSelection(){const e=this.normalizedFieldName;return c.tsx("div",null,c.tsx("calcite-select",{afterCreate:()=>{this.fieldName||(this.fieldName=this._defaultFieldName)},bind:this,label:this.messages.chooseField,width:"full",onCalciteSelectChange:({currentTarget:e})=>{this.value=null,this.fieldName=e.value}},this.fields.map(t=>this._renderOption(t.name,t.alias,e))))}_renderOperatorSelection(){const{_visibleOperators:e,messages:t,operator:r}=this;if(e.length)return c.tsx("div",null,c.tsx("calcite-select",{afterUpdate:e=>{const t=e.value;this._visibleOperators.includes(t)||(this.operator=this._visibleOperators[0])},bind:this,label:t.operator,required:!0,width:"full",onCalciteSelectChange:e=>{this.operator=e.currentTarget.value}},e.map(e=>this._renderOption(e,t.operators[e],r))))}_renderOption(e,t,r){return c.tsx("calcite-option",{key:e,label:t??e,selected:e===r,value:e})}_renderValueInput(){const{valueAsString:e,domain:t,messages:r,operator:l}=this;if(!this._isValueInputHidden){if("coded-value"===t?.type&&t.codedValues.length&&("is"===l||"isNot"===l)){const l=t.codedValues[0].code;return c.tsx("div",{key:"value-select"},c.tsx("calcite-select",{afterCreate:()=>this._afterSelectCreateOrUpdate(l),afterUpdate:()=>this._afterSelectCreateOrUpdate(l),bind:this,label:r.value,required:!0,width:"full",onCalciteSelectChange:({currentTarget:e})=>{this._onValueChange(e.value)}},t.codedValues.map(({code:t,name:r})=>this._renderOption(`${t}`,r,e))))}return c.tsx("div",{class:f.valueInputContainer,key:"value-input"},c.tsx("calcite-input",{label:r.value,type:this._valueInputType,value:e,onCalciteInputInput:({currentTarget:e})=>{this._onValueChange(e.value)}}))}}_afterSelectCreateOrUpdate(e){null==this.value&&(this.value=e)}_onValueChange(e){const{viewModel:t}=this;e&&""!==e?t.isStringField||t.isGlobalIDField?this.value=e.toString():(t.isNumericField||t.isObjectIDField)&&(this.value=parseFloat(e)):this.value=null}},r.__decorate([l.property()],t.default.prototype,"_defaultFieldName",null),r.__decorate([l.property()],t.default.prototype,"_valueInputType",null),r.__decorate([l.property()],t.default.prototype,"_visibleOperators",null),r.__decorate([l.property()],t.default.prototype,"_isValueInputHidden",null),r.__decorate([l.property()],t.default.prototype,"domain",null),r.__decorate([l.property()],t.default.prototype,"field",null),r.__decorate([l.property()],t.default.prototype,"fields",null),r.__decorate([l.property()],t.default.prototype,"fieldLabel",null),r.__decorate([l.property()],t.default.prototype,"fieldName",null),r.__decorate([l.property()],t.default.prototype,"layer",null),r.__decorate([l.property(),p.messageBundle("esri/widgets/support/FilterCondition/t9n/FilterCondition")],t.default.prototype,"messages",void 0),r.__decorate([l.property(),p.messageBundle("esri/t9n/common")],t.default.prototype,"messagesCommon",void 0),r.__decorate([l.property()],t.default.prototype,"normalizedFieldName",null),r.__decorate([l.property()],t.default.prototype,"operator",null),r.__decorate([l.property()],t.default.prototype,"operators",null),r.__decorate([l.property()],t.default.prototype,"state",null),r.__decorate([l.property()],t.default.prototype,"value",null),r.__decorate([l.property()],t.default.prototype,"valueAsString",null),r.__decorate([l.property()],t.default.prototype,"viewModel",void 0),r.__decorate([l.property()],t.default.prototype,"visibleElements",void 0),r.__decorate([i.cast("visibleElements")],t.default.prototype,"castVisibleElements",null),r.__decorate([l.property()],t.default.prototype,"whereClause",null),t.default=r.__decorate([s.subclass("esri.widgets.support.FilterCondition")],t.default),t.default});