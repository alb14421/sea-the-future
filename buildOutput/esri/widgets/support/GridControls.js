// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../../chunks/tslib.es6","../../Color","../../intl","../../core/deprecate","../../core/Logger","../../core/reactiveUtils","../../core/unitFormatUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../Widget","../../chunks/componentsUtils","./globalCss","./LabeledSwitch","./widgetUtils","./decorators/messageBundle","./jsxFactory","./GridControls/GridControlsViewModel","./GridControls/gridUtils","./GridControls/VisibleElements","../../intl/substitute"],function(e,t,i,n,s,l,a,r,o,c,d,p,g,u,h,m,b,v,_,w,x,C,y){"use strict";const M="esri-grid-controls",S={base:M,borderedSwitch:`${M}__switch--bordered`,container:`${M}__container`,numericInputsContainer:`${M}__numeric-inputs__container`,tilegroup:`${M}__tilegroup`,tile:`${M}__tile`,tileDisabled:`${M}__tile--disabled`,tileContent:`${M}__tile__content`,suffixedInputContainer:`${M}__input-with-suffix__container`,inlineIcon:`${M}__inline-icon`},f={widgetIcon:"grid-unit",gridTheme:{light:"circle",dark:"circle-area",custom:"palette"},placementState:{interactive:"maximum-territory-distance",place:"move",rotate:"rotate"},warning:"exclamation-mark-triangle"},T=i.fromArray([115,115,115]),I=i.fromArray([200,200,200]),k=["interactive","place","rotate"];let L=class extends g{constructor(e,t){super(e,t),this.customColor=null,this.messages=null,this.messagesUnits=null,this.viewModel=new w,this.visibleElements=new C,s.deprecateWidget(l.getLogger(this),"Grid Controls","arcgis-grid-controls",{version:"4.33"})}initialize(){this.addHandles([a.watch(()=>this.viewModel.gridColor,e=>{!e||T.equals(e)||I.equals(e)||(this.customColor=e)},a.initial)])}loadDependencies(){return Promise.all([u.loadCalciteComponents({action:()=>new Promise((t,i)=>e(["../../chunks/index12"],t,i)),"action-bar":()=>new Promise((t,i)=>e(["../../chunks/index46"],t,i)),label:()=>new Promise((t,i)=>e(["../../chunks/index5"],t,i)),icon:()=>new Promise((t,i)=>e(["../../chunks/index7"],t,i)),popover:()=>new Promise((t,i)=>e(["../../chunks/index57"],t,i)).then(e=>e.index),tooltip:()=>new Promise((t,i)=>e(["../../chunks/index17"],t,i)),"color-picker":()=>new Promise((t,i)=>e(["../../chunks/index67"],t,i)),"input-number":()=>new Promise((t,i)=>e(["../../chunks/index28"],t,i))}),m.loadLabeledSwitchComponents()])}get icon(){return f.widgetIcon}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages.widgetLabel}set label(e){this._overrideIfSome("label",e)}get snappingManager(){return this.viewModel.snappingManager}set snappingManager(e){this.viewModel.snappingManager=e}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get theme(){const e=this.viewModel.gridColor;return e?T.equals(e)?"dark":I.equals(e)?"light":"custom":null}set theme(e){const{viewModel:t,customColor:i,view:n}=this;switch(e){case"light":t.gridColor=I;break;case"dark":t.gridColor=T;break;case"custom":t.gridColor=i??n?.effectiveTheme.accentColor??T}}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return _.tsx("div",{"aria-label":this.label,class:this.classes(S.base,h.globalCss.widget,h.globalCss.panel)},_.tsx("div",{class:S.container},this._renderContent()))}_renderContent(){const{visibleElements:e}=this;return[e.gridEnabledToggle?this._renderEnabledToggle():null,e.placementButtons?this._renderGridPlacementButtons():null,e.numericInputs?this._renderNumericInputs():null,e.lineIntervalInput?this._renderIntervalInput():null,e.gridSnapEnabledToggle&&this.viewModel.snappingOptions?this._renderSnappingToggle():null,e.dynamicScaleToggle?this._renderDynamicScaleToggle():null,e.rotateWithMapToggle?this._renderRotateToggle():null,e.colorSelection?this._renderColorSelection():null]}_renderGridPlacementButtons(){const{interactivePlacementState:e,placementDisabled:t,gridControlsEnabled:i}=this.viewModel,n=t||!i;return _.tsx("calcite-label",{key:"grid-placement-buttons",scale:"s"},this.messages.placementOptions,_.tsx("calcite-action-bar",{expandDisabled:!0,layout:"horizontal"},k.map(t=>this._renderPlacementModeButton(t,n,e))))}_renderPlacementModeButton(e,t,i){const n=this.messages.placementState[e],s=`__placement-action-${e}`;return _.tsx("div",null,_.tsx("calcite-action",{active:i===e,alignment:"center",disabled:t,icon:f.placementState[e],id:s,onclick:()=>this.viewModel.togglePlacementState(e),text:n}),_.tsx("calcite-tooltip",{overlayPositioning:"fixed",placement:"top",referenceElement:s},n))}_renderNumericInputs(){const{rotation:e,spacing:t,effectiveSpacingAfterDynamicScaling:i,numericSpacingInputShouldBeVisible:n,unit:s="meters"}=this.viewModel,l=this.messagesUnits.units[s].abbr,a=this.viewModel.gridControlsEnabled,o=null!=i&&i!==this.viewModel.spacing,c=`__spacing_input_scaled-${this.id}`;return _.tsx("div",{class:this.classes(S.numericInputsContainer)},[n?_.tsx("calcite-label",{key:"spacing-label",scale:"s"},_.tsx("span",null,this.messages.inputLabel.spacing,o?_.tsx("calcite-icon",{class:this.classes(S.inlineIcon),icon:f.warning,id:c,scale:"s",tabIndex:0}):void 0),_.tsx("div",{class:S.suffixedInputContainer},_.tsx("calcite-input-number",{disabled:!a,numberButtonType:"none",suffixText:l,value:`${t?.toFixed(2)}`,onCalciteInputNumberChange:({currentTarget:e})=>{const t=parseFloat(e.value);this.viewModel.spacing=t,t!==this.viewModel.spacing&&(e.value=`${this.viewModel.spacing}`)}}),o?_.tsx("calcite-tooltip",{overlayPositioning:"fixed",placement:"leading",referenceElement:c},y.substitute(this.messages.warnings.dynamicSpacing,{actualSpacingIncludingUnit:r.formatDecimal(this.messagesUnits,i,s,2,"plural")})):void 0)):void 0,_.tsx("calcite-label",{key:"angle-label",scale:"s"},this.messages.inputLabel.angle,_.tsx("calcite-input-number",{disabled:!a,integer:!0,numberButtonType:"none",suffixText:this.messagesUnits.units.degrees.abbr,value:`${x.gridRotationToDegrees(e)}`,onCalciteInputNumberChange:({currentTarget:e})=>this.viewModel.rotation=x.userInputToGridRotation(e.value)}))])}_renderIntervalInput(){const{majorLineInterval:e,gridControlsEnabled:t}=this.viewModel;return _.tsx("div",{class:this.classes(S.numericInputsContainer)},_.tsx("calcite-label",{scale:"s"},this.messages.inputLabel.interval,_.tsx("calcite-input-number",{disabled:!t,integer:!0,max:15,min:1,numberButtonType:"vertical",value:`${e}`,onCalciteInputNumberChange:({currentTarget:e})=>{const t=Number.parseInt(e.value,10);this.viewModel.majorLineInterval=t,t!==this.viewModel.majorLineInterval&&(e.value=`${this.viewModel.majorLineInterval}`)}})))}_renderSnappingToggle(){const{snappingOptions:e,gridControlsEnabled:t}=this.viewModel,i=e?.gridEnabled??!1,n=t&&!!e;return _.tsx(m.LabeledSwitch,{checked:!!i,disabled:!n,key:"grid-snap-enabled-toggle",label:this.messages.switchLabel.snap,onChange:e=>this.viewModel.snappingOptions?.set("gridEnabled",e)})}_renderDynamicScaleToggle(){const{viewModel:e,messages:t}=this,i=this.visibleElements.outOfScaleWarning&&e.gridOutOfScale;return _.tsx(m.LabeledSwitch,{checked:e.dynamicScaling,disabled:!e.gridControlsEnabled,hint:i?t.warnings.outOfScale:void 0,hintIcon:f.warning,hintKind:"warning",key:`grid-dynamic-scale-toggle-${this.id}`,label:t.switchLabel.scaling,onChange:t=>e.dynamicScaling=t})}_renderRotateToggle(){const{gridControlsEnabled:e,rotateWithMap:t}=this.viewModel;return _.tsx(m.LabeledSwitch,{checked:t,disabled:!e,key:"grid-rotate-map-toggle",label:this.messages.switchLabel.rotateWithMap,onChange:e=>this.viewModel.rotateWithMap=e})}_renderEnabledToggle(){return _.tsx("div",{class:S.borderedSwitch},_.tsx(m.LabeledSwitch,{checked:this.viewModel.displayEnabled,disabled:!!this.viewModel.interactivePlacementState,key:"grid-enabled-toggle",label:this.messages.switchLabel.display,onChange:e=>this.viewModel.trySetDisplayEnabled(e)}))}_renderColorSelection(){const{customColor:e}=this,t=`${this.id}--custom-grid-color-button`;return _.tsx("calcite-label",{scale:"s"},this.messages.inputLabel.theme,_.tsx("div",{class:S.tilegroup},[this._renderThemeTile({value:"dark"}),this._renderThemeTile({value:"light"}),this._renderThemeTile({value:"custom",id:t}),_.tsx("calcite-popover",{autoClose:!0,label:this.messages.gridLineColorPopoverLabel,overlayPositioning:"fixed",referenceElement:t},_.tsx("calcite-color-picker",{alphaChannel:!0,savedDisabled:!0,value:e?.toHex({digits:8})??"#000000ff",onCalciteColorPickerChange:e=>{const t=i.fromHex(e.currentTarget.value);t&&(this.customColor=t,this.theme="custom")}}))]))}_renderThemeTile(e){const{theme:t}=this,{value:i}=e,n=this.messages.gridTheme[i],s=`${this.id}--theme_tile_${i}`,l=`${s}__label`,a=f.gridTheme[i],r=this.viewModel.gridControlsEnabled;return _.tsx("div",{class:b.classes({[S.tile]:!0,[S.tileDisabled]:!r}),id:e.id,role:"button"},_.tsx("input",{"aria-labelledby":l,checked:t===i,disabled:!r,id:s,name:`${this.id}--theme`,onchange:e=>{this.theme=i,e.target?.focus()},tabIndex:0,type:"radio"}),_.tsx("div",{class:S.tileContent},_.tsx("calcite-icon",{icon:a,scale:"l"}),_.tsx("calcite-label",{for:s,id:l},n)))}};return t.__decorate([o.property({type:i})],L.prototype,"customColor",void 0),t.__decorate([o.property()],L.prototype,"icon",null),t.__decorate([o.property()],L.prototype,"label",null),t.__decorate([o.property(),v.messageBundle("esri/widgets/support/GridControls/t9n/GridControls")],L.prototype,"messages",void 0),t.__decorate([o.property(),v.messageBundle("esri/core/t9n/Units")],L.prototype,"messagesUnits",void 0),t.__decorate([o.property()],L.prototype,"snappingManager",null),t.__decorate([o.property()],L.prototype,"snappingOptions",null),t.__decorate([o.property()],L.prototype,"theme",null),t.__decorate([o.property()],L.prototype,"view",null),t.__decorate([o.property({type:w})],L.prototype,"viewModel",void 0),t.__decorate([o.property({type:C,nonNullable:!0})],L.prototype,"visibleElements",void 0),L=t.__decorate([p.subclass("esri.widgets.support.GridControls")],L),L});