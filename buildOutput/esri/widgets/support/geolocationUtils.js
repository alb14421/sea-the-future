// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../config","../../core/Error","../../core/has","../../core/Logger","../../geometry/Point","../../geometry/support/webMercatorUtils","../../portal/Portal","../../rest/geometryService/project","../../rest/support/ProjectParameters"],function(e,t,o,r,i,n,c,s,u,a){"use strict";const l=()=>i.getLogger("esri.widgets.support.geolocationUtils"),g={maximumAge:0,timeout:15e3,enableHighAccuracy:!0};let d;e.getCurrentPosition=function(e){return e??=g,new Promise((t,r)=>{setTimeout(()=>r(new o("geolocation:timeout","getting the current geolocation position timed out")),15e3),navigator.geolocation.getCurrentPosition(t,r,e??void 0)})},e.overridePositionToPoint=function(e){d=e},e.positionToPoint=function(e,r){if(d)return d(e,r);const{position:i,view:l}=e,g=function(e){const t=e&&e.coords||{},o={accuracy:t.accuracy,altitude:t.altitude,altitudeAccuracy:t.altitudeAccuracy,heading:t.heading,latitude:t.latitude,longitude:t.longitude,speed:t.speed,toJSON:()=>({})};return e?{coords:o,timestamp:e.timestamp,toJSON:()=>({})}:e}(i),m=g?.coords;if(!m)throw new o("geometry-service:no-coords","Geolocation has no coordinates");return function(e,r,i){if(!r)return Promise.resolve(e);const n=r.spatialReference;return n.isWGS84?Promise.resolve(e):n.isWebMercator?Promise.resolve(c.geographicToWebMercator(e)):function(e){if(t.geometryServiceUrl)return Promise.resolve(t.geometryServiceUrl);const o=s.getDefault();return o.load(e).catch(()=>{}).then(()=>o.helperServices?.geometry?.url)}(i).then(t=>{if(!t)throw new o("geometry-service:missing-url","Geometry service URL is missing");const r=new a({geometries:[e],outSpatialReference:n});return u.project(t,r,i).then(e=>e[0])})}(function({longitude:e,latitude:t,altitude:o}){return new n({longitude:e,latitude:t,z:o||void 0,spatialReference:{wkid:4326}})}(m),l,r)},e.supported=function(){return function(){const e=!!r("esri-geolocation");return e||l().warn("geolocation-unsupported","Geolocation unsupported."),e}()&&function(){const e=window.isSecureContext;return e||l().warnOnce("insecure-context","Geolocation requires a secure origin."),e}()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});