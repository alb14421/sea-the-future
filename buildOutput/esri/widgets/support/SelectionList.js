// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../../chunks/tslib.es6","../../intl","../../core/arrayUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../Widget","../../chunks/componentsUtils","./globalCss","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SelectionList/selectionListUtils","./SelectionList/SelectionListViewModel","./SelectionList/VisibleElements","../../intl/substitute","../../intl/number"],function(e,t,i,s,o,r,l,n,a,c,d,m,h,u,p,y,v,_,g,I){"use strict";const b="esri-selection-list",w=`${b}__list-item`,f={base:b,container:`${b}__container`,flowItem:`${b}__flow-item`,layerDropdown:`${b}__layer-dropdown`,listItemFeature:`${w}__feature`,listItemFeatureIcon:`${w}__feature-icon`,listItemIcon:`${w}__icon`,itemCount:`${b}__item-count`,notice:`${b}__notice`,panel:`${b}__panel`,totalCount:`${b}__total-count`};let x=class extends c{constructor(e,t){super(e,t),this._iconIntersectionObserver=new IntersectionObserver((e,t)=>{e.forEach(async e=>{if(e.isIntersecting){const i=e.target;if(this._hasIcon(i))return void t.unobserve(i);const s=this._getListItem(i);if(!s)return;this._setHasIcon(i,!0);const o=s.title?g.substitute(this.messagesLegend.previewTemplateAriaLabel,{label:s.title}):this.messagesCommon.preview,r=s.thumbnail??await s.fetchThumbnail({ariaLabel:o}).catch(()=>(this._setHasIcon(i,!1),null));if(null==r)return;i.appendChild(r)}})}),this._itemWithOpenMenu=null,this._list=null,this.displayMode="group",this.hightlightOnHoverEnabled=!1,this.itemActionConfigs=null,this.menuScale="m",this.messages=null,this.messagesCommon=null,this.messagesLegend=null,this.onListItemSelect=null,this.scale="s",this.viewModel=new v,this.visibleElements=new _,this._afterItemCreate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)},this.clear=this.clear.bind(this),this.collapseItems=this.collapseItems.bind(this),this.removeTemporaryHighlight=this.removeTemporaryHighlight.bind(this)}initialize(){this.addHandles([o.on(()=>this.effectiveSelectionManager,"selection-change",()=>this._closeItemMenu()),o.watch(()=>this.hightlightOnHoverEnabled,e=>{e||this.removeTemporaryHighlight()})])}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return d.loadCalciteComponents({action:()=>new Promise((t,i)=>e(["../../chunks/index12"],t,i)),chip:()=>new Promise((t,i)=>e(["../../chunks/index11"],t,i)),combobox:()=>new Promise((t,i)=>e(["../../chunks/index21"],t,i)),"combobox-item":()=>new Promise((t,i)=>e(["../../chunks/index22"],t,i)),dropdown:()=>new Promise((t,i)=>e(["../../chunks/index24"],t,i)),"dropdown-group":()=>new Promise((t,i)=>e(["../../chunks/index25"],t,i)),"dropdown-item":()=>new Promise((t,i)=>e(["../../chunks/index26"],t,i)),flow:()=>new Promise((t,i)=>e(["../../chunks/index14"],t,i)),"flow-item":()=>new Promise((t,i)=>e(["../../chunks/index15"],t,i)),icon:()=>new Promise((t,i)=>e(["../../chunks/index7"],t,i)),input:()=>new Promise((t,i)=>e(["../../chunks/index4"],t,i)),list:()=>new Promise((t,i)=>e(["../../chunks/index16"],t,i)),"list-item":()=>new Promise((t,i)=>e(["../../chunks/index20"],t,i)),notice:()=>new Promise((t,i)=>e(["../../chunks/index6"],t,i)),panel:()=>new Promise((t,i)=>e(["../../chunks/index51"],t,i)).then(e=>e.index)})}get _hasFilterText(){const{filterText:e}=this;return null!=e&&""!==e}get activeLayerItem(){return this.viewModel.activeLayerItem}get allLayerItems(){return this.viewModel.allLayerItems}get effectiveCount(){return this.viewModel.effectiveCount}get effectiveSelectionManager(){return this.viewModel.effectiveSelectionManager}get filterText(){return this.viewModel.filterText}set filterText(e){this.viewModel.filterText=e}get icon(){return"selection"}set icon(e){this._overrideIfSome("icon",e)}get isUpdating(){return this.viewModel.isUpdating}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get layerItems(){return this.viewModel.layerItems}get layerViewMap(){return this.viewModel.layerViewMap}get maxVisibleFeatureCountExceeded(){return this.viewModel.maxVisibleFeatureCountExceeded}get maxVisibleFeatureCountPerLayer(){return this.viewModel.maxVisibleFeatureCountPerLayer}set maxVisibleFeatureCountPerLayer(e){this.viewModel.maxVisibleFeatureCountPerLayer=e}get selectionManager(){return this.viewModel.selectionManager}set selectionManager(e){this.viewModel.selectionManager=e}get state(){return this.viewModel.state}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get viewLayersAndTables(){return this.viewModel.viewLayersAndTables}get visibleFeatureCount(){return this.viewModel.visibleFeatureCount}get visibleFeatureItems(){return this.viewModel.visibleFeatureItems}get visibleLayerCount(){return this.viewModel.visibleLayerCount}addTemporaryHighlight(e){this.viewModel.addTemporaryHighlight(e)}clear(){this.viewModel.clear()}deselectFeatureItem(e){this.viewModel.deselectFeatureItem(e)}deselectGroupItem(e){this.viewModel.deselectGroupItem(e)}deselectLayerItem(e){this.viewModel.deselectLayerItem(e)}deselectItem(e){this.viewModel.deselectItem(e)}collapseItems(){this._list?.filteredItems.forEach(e=>e.expanded=!1)}goToItem(e){this.viewModel.goToItem(e)}removeFromSelection(e){this.viewModel.removeFromSelection(e)}removeTemporaryHighlight(){this.viewModel.removeTemporaryHighlight()}selectSingleFeatureItem(e){this.viewModel.selectSingleFeatureItem(e)}selectSingleGroupItem(e){this.viewModel.selectSingleGroupItem(e)}selectSingleItem(e){this.viewModel.selectSingleItem(e)}selectSingleLayerItem(e){this.viewModel.selectSingleLayerItem(e)}setSelection(e){this.viewModel.setSelection(e)}render(){return p.tsx("div",{class:this.classes(f.base,m.globalCss.widget,m.globalCss.panel)},p.tsx("calcite-flow",null,p.tsx("calcite-flow-item",{class:f.flowItem,heading:this.visibleElements.header?this.messages.selection:void 0,loading:"loading"===this.state,overlayPositioning:"fixed",scale:this.scale,selected:!0},p.tsx("calcite-panel",{class:f.panel,overlayPositioning:"fixed",scale:this.scale},p.tsx("div",{class:f.container},this._renderActiveLayerDropdown(),this._renderFilterInput(),this._renderList(),this._renderFilterNotice())),this._renderTotalChip(),this._renderMenuActions())))}_renderTotalChip(){const{visibleElements:e}=this;if(!e.totalCount||!e.header)return;const{effectiveCount:t}=this,i=I.formatNumber(t),s=g.substitute(this.messages.selectionCount,{count:i});return p.tsx("calcite-chip",{appearance:"outline",class:f.totalCount,closable:t>0,closed:0===t,icon:this.maxVisibleFeatureCountExceeded?"exclamation-mark-triangle":void 0,label:i,scale:this.scale,slot:"header-actions-end",title:s,onCalciteChipClose:this.clear},i)}_renderMenuActions(){const{visibleElements:e}=this;if(!e.header||!e.menu)return;const{menuScale:t}=this,i=0===this.effectiveCount;return[p.tsx("calcite-action",{disabled:i,icon:"reset",key:"clear-action",onclick:this.clear,scale:t,slot:"header-menu-actions",text:this.messagesCommon.clear,textEnabled:!0}),p.tsx("calcite-action",{disabled:i,icon:"folders",key:"collapse-action",onclick:this.collapseItems,scale:t,slot:"header-menu-actions",text:this.messages.collapseAll,textEnabled:!0})]}_renderActiveLayerDropdown(){const{layerItems:e,messages:t}=this;if(!(0===this.effectiveCount||e.length<2)&&this.visibleElements.layerFilter)return p.tsx("calcite-combobox",{class:f.layerDropdown,clearDisabled:!0,label:t.filterByLayer,overlayPositioning:"fixed",placeholder:t.filterByLayer,scale:this.scale,selectionMode:"single-persist",onCalciteComboboxChange:({currentTarget:e})=>{this.filterText=void 0;const t=e.selectedItems[0]?.value??void 0;this.layer="all-layers"===t?void 0:t}},p.tsx("calcite-combobox-item",{heading:g.substitute(t.allLayersCount,{count:e.length}),icon:"layers",key:"all-layers",selected:null==this.layer,value:"all-layers"}),this.layerItems.map(e=>this._renderActiveLayerDropdownItem(e)))}_renderFilterInput(){if(this.visibleElements.filter&&0!==this.effectiveCount)return p.tsx("calcite-input",{clearable:!0,icon:"search",placeholder:this.messages.filter,scale:this.scale,value:this.filterText,onCalciteInputInput:({target:{value:e}})=>{this.filterText=e}})}_renderActiveLayerDropdownItem(e){const t=e.title||this.messages.untitledLayer;return p.tsx("calcite-combobox-item",{heading:t,icon:e.iconName,key:e.key,selected:e.layer===this.layer,value:e.layer})}_renderList(){const{messages:e}=this;if(0!==this.visibleFeatureCount)return p.tsx("calcite-list",{afterCreate:h.storeNode,bind:this,"data-node-ref":"_list",displayMode:"nested",interactionMode:"interactive",label:e.widgetLabel,loading:this.isUpdating,scale:this.scale,selectionMode:"none"},this._renderListContent(this.allLayerItems))}_renderListContent(e){return this.activeLayerItem?this._renderLayerItem(this.activeLayerItem):e.map(e=>y.isGroupLayerItem(e)?this._renderGroupItem(e):y.isLayerItem(e)?this._renderLayerItem(e):null).filter(s.isSome)}_renderFilterNotice(){const{visibleElements:e}=this;if(!("disabled"===this.state||this.visibleFeatureCount>0)&&e.filter&&e.filterNotice)return p.tsx("calcite-notice",{class:f.notice,icon:"exclamation-mark-triangle",kind:"info",open:!0,scale:this.scale,width:"full"},p.tsx("div",{slot:"message"},this.messages.noMatchingFeatures))}_renderItemCount(e){if(!this.visibleElements.itemCount)return;const{messages:t}=this,i=I.formatNumber(e.total),s=I.formatNumber(e.visibleTotal),o=g.substitute(t.selectionCount,{count:i});return!this._hasFilterText&&e.maxVisibleFeatureCountExceeded?p.tsx("span",{class:f.itemCount,slot:"content-end",title:o},p.tsx("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s",title:t.tooManyFeatures}),`${I.formatNumber(this.maxVisibleFeatureCountPerLayer)}+`):p.tsx("span",{class:f.itemCount,slot:"content-end",title:o},s)}_renderItemActions(e){if(!this.visibleElements.itemMenus)return;const{messages:t,messagesCommon:i}=this,s=this._itemWithOpenMenu===e,o=y.isFeatureItem(e),r=y.isLayerItem(e),l=y.isGroupLayerItem(e),n=o?t.deselectFeature:r?t.deselectLayer:t.deselectGroup;return[p.tsx("calcite-dropdown",{open:s,overlayPositioning:"fixed",scale:this.menuScale,slot:"actions-end",width:"m",onCalciteDropdownClose:()=>this._closeItemMenu(e),onCalciteDropdownOpen:()=>{this._itemWithOpenMenu=e}},p.tsx("calcite-action",{appearance:"transparent",icon:"ellipsis",scale:this.scale,slot:"trigger",text:i.menu,textEnabled:!1}),s?p.tsx("calcite-dropdown-group",{selectionMode:"none"},p.tsx("calcite-dropdown-item",{iconStart:"layer-zoom-to",onCalciteDropdownItemSelect:()=>this.goToItem(e)},t.zoomTo),p.tsx("calcite-dropdown-item",{iconStart:"selection-filter",onCalciteDropdownItemSelect:()=>this.selectSingleItem(e)},o?t.onlySelectFeature:t.onlySelectThis),p.tsx("calcite-dropdown-item",{iconStart:"selection-x",onCalciteDropdownItemSelect:()=>this.deselectItem(e)},n),this.itemActionConfigs?.map(t=>{if(!t.type||"feature"===t.type&&o||"layer"===t.type&&r||"group"===t.type&&l)return p.tsx("calcite-dropdown-item",{iconStart:t.icon??void 0,onCalciteDropdownItemSelect:()=>t.callback({item:e})},t.label)})):void 0)]}_renderGroupItem(e){const t=e.title||this.messages.untitledLayer;if(0===e.visibleTotal)return;const{displayMode:i}=this;if("layer"===i||"feature"===i)return this._renderListContent(e.items);const{visibleElements:s}=this;return p.tsx("calcite-list-item",{bind:this,closable:!!s.itemCloseActions,"data-type":"group",expanded:!0,iconStart:s.itemIcons?e.iconName:void 0,key:e.key,label:t,value:e.title,onCalciteListItemClose:t=>{t.stopPropagation(),this.deselectItem(e)},onCalciteListItemSelect:t=>this._onListItemSelect(e,t)},this._renderItemActions(e),this._renderListContent(e.items))}_renderLayerItem(e){if(0===e.visibleTotal||!e.visible)return;if("feature"===this.displayMode)return this._renderItems(e.featureItems);const{messages:t,visibleElements:i}=this,s=e.title||t.untitledLayer;return p.tsx("calcite-list-item",{bind:this,closable:!!i.itemCloseActions,"data-type":"layer",expanded:!0,iconStart:i.itemIcons?e.iconName:void 0,key:e.key,label:s,scale:this.scale,value:e.title,onCalciteListItemClose:t=>{t.stopPropagation(),this.deselectItem(e)},onCalciteListItemSelect:t=>this._onListItemSelect(e,t)},this._renderItemCount(e),this._renderItemActions(e),this._renderItems(e.featureItems),e.maxVisibleFeatureCountExceeded?p.tsx("calcite-notice",{class:f.notice,icon:"exclamation-mark-triangle",kind:"info",open:!0,scale:this.scale},p.tsx("div",{slot:"message"},t.tooManyFeatures)):void 0)}_renderItems(e){return e.map(e=>this._renderItem(e))}_renderItem(e){if(!e.visible)return;const{hightlightOnHoverEnabled:t,messages:i,visibleElements:s}=this,o=e.title||i.untitledFeature,r=s.itemIcons&&"feature"!==this.displayMode;return p.tsx("calcite-list-item",{bind:this,class:r?f.listItemFeatureIcon:f.listItemFeature,closable:!!s.itemCloseActions,"data-item":e,"data-type":"feature",key:e.key,label:o,name:o,onblur:t?()=>this.removeTemporaryHighlight():void 0,onfocus:t?()=>this.addTemporaryHighlight(e):void 0,onpointerenter:t?()=>this.addTemporaryHighlight(e):void 0,onpointerleave:t?()=>this.removeTemporaryHighlight():void 0,scale:this.scale,value:o,onCalciteListItemClose:t=>{t.stopPropagation(),this.deselectItem(e)},onCalciteListItemSelect:t=>this._onListItemSelect(e,t)},this._renderItemIcon(e),this._renderItemActions(e))}_renderItemIcon(e){if(this.visibleElements.itemIcons)return p.tsx("div",{class:f.listItemIcon,key:"content-start",slot:"content-start"},p.tsx("span",{afterCreate:this._afterItemCreate,afterRemoved:this._afterItemRemoved,"data-has-icon":!1,"data-item":e,key:e.thumbnailKey}))}_getListItem(e){return e?.["data-item"]}_hasIcon(e){return!!e?.["data-has-icon"]}_setHasIcon(e,t){e&&(e["data-has-icon"]=t)}_onListItemSelect(e,t){t.stopPropagation(),this._closeItemMenu(),this.onListItemSelect?.({item:e})}_closeItemMenu(e){e&&e!==this._itemWithOpenMenu||(this._itemWithOpenMenu=null)}};return t.__decorate([r.property()],x.prototype,"_hasFilterText",null),t.__decorate([r.property()],x.prototype,"_itemWithOpenMenu",void 0),t.__decorate([r.property()],x.prototype,"_list",void 0),t.__decorate([r.property()],x.prototype,"activeLayerItem",null),t.__decorate([r.property()],x.prototype,"allLayerItems",null),t.__decorate([r.property()],x.prototype,"displayMode",void 0),t.__decorate([r.property()],x.prototype,"effectiveCount",null),t.__decorate([r.property()],x.prototype,"effectiveSelectionManager",null),t.__decorate([r.property()],x.prototype,"filterText",null),t.__decorate([r.property()],x.prototype,"hightlightOnHoverEnabled",void 0),t.__decorate([r.property()],x.prototype,"icon",null),t.__decorate([r.property()],x.prototype,"itemActionConfigs",void 0),t.__decorate([r.property()],x.prototype,"isUpdating",null),t.__decorate([r.property()],x.prototype,"label",null),t.__decorate([r.property()],x.prototype,"layer",null),t.__decorate([r.property()],x.prototype,"layerItems",null),t.__decorate([r.property()],x.prototype,"layerViewMap",null),t.__decorate([r.property()],x.prototype,"maxVisibleFeatureCountExceeded",null),t.__decorate([r.property()],x.prototype,"maxVisibleFeatureCountPerLayer",null),t.__decorate([r.property()],x.prototype,"menuScale",void 0),t.__decorate([r.property(),u.messageBundle("esri/widgets/support/SelectionList/t9n/SelectionList")],x.prototype,"messages",void 0),t.__decorate([r.property(),u.messageBundle("esri/t9n/common")],x.prototype,"messagesCommon",void 0),t.__decorate([r.property(),u.messageBundle("esri/widgets/Legend/t9n/Legend")],x.prototype,"messagesLegend",void 0),t.__decorate([r.property()],x.prototype,"onListItemSelect",void 0),t.__decorate([r.property()],x.prototype,"scale",void 0),t.__decorate([r.property()],x.prototype,"selectionManager",null),t.__decorate([r.property()],x.prototype,"state",null),t.__decorate([r.property()],x.prototype,"view",null),t.__decorate([r.property()],x.prototype,"viewLayersAndTables",null),t.__decorate([r.property()],x.prototype,"viewModel",void 0),t.__decorate([r.property({type:_,nonNullable:!0})],x.prototype,"visibleElements",void 0),t.__decorate([r.property()],x.prototype,"visibleFeatureCount",null),t.__decorate([r.property()],x.prototype,"visibleFeatureItems",null),t.__decorate([r.property()],x.prototype,"visibleLayerCount",null),x=t.__decorate([a.subclass("esri.widgets.support.SelectionList")],x),x});