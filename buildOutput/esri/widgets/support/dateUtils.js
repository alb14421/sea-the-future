// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../intl","../../core/has","../../core/Error","../../core/mathUtils","../../intl/date","../../support/dateUtils","../../support/guards","../../time/constants","../../chunks/datetime","../../intl/locale"],function(e,t,n,a,o,i,l,r,m,u,s){"use strict";const c=m.utc,f={date:null,time:null,timeZoneOffset:null},d=new Map([["hours",3600],["minutes",60],["seconds",1],["deciseconds",.1],["centiseconds",.01],["milliseconds",.001]]),p="latn",T=new Set(["date-only","time-only","timestamp-offset"]),D=e=>"valueAsDate"in e;function y(e){return{locale:s.getLocale(),numberingSystem:p,zone:e??c}}function O(e,t){return null==e?null:u.DateTime.fromMillis(e,y(t))}function h(e,t){if(null==e||!r.isString(e)||""===e){if(t){const e=u.DateTime.local({zone:t});return{date:null,time:null,timeZoneOffset:e.isValid?e.offset.toString():null}}return f}const n=u.DateTime.fromISO(e,{setZone:!0});return{date:n.toFormat(l.defaultDatePattern,y()),time:n.toFormat(l.TimeStampOffsetPattern.HMS_MS,y()),timeZoneOffset:n.offset.toString()}}function v(e,t){if(null==e?.value||Array.isArray(e.value))return null;let n=null;return n=D(e)?u.DateTime.fromFormat(e.value,l.defaultDatePattern,y(t)):l.timeOnlyToDateTime(e.value),n?.isValid?n:null}function F(e){const{max:t,min:n,value:a}=e;return!(isNaN(a)||null!=t&&a>t||null!=n&&a<n)}function g(e){const{max:t,min:n,value:a}=e;return null!=t&&null!=n?o.clamp(a,n,t):null!=t&&a>t?t:null!=n&&a<n?n:a}function S(e){if(!e)return"";const t=e.split(".").at(0);if(!t||t.length<1)throw new a("invalid time-only field",`Cannot parse valid time-only field value from ${e}`);const n=t.split(":"),o=new Array(3);for(let e=0;e<3;e++){const t=n.at(e)??"";o[e]=t.padStart(2,"0")}return o.join(":")}e.arcadeDateToFieldValue=function(e,t){switch(t){case"date":return e.getTime();case"date-only":return e.toISODate();case"time-only":return S(e.toISOTime(!0,!1));case"timestamp-offset":return e.toISOString(!1);default:return null}},e.clampValueToRange=g,e.createDateTimeFromFieldValue=O,e.dateFieldsWithStringFieldValue=T,e.dateTimeIsInRange=function(e){const{type:t,range:n,value:a}=e;if(null==a||!n||a===n.min||a===n.max)return!0;if("date"===t)return F({value:a,min:n.min,max:n.max});const{rawMax:o,rawMin:i}=n;let r=null,m=null,u=null;switch(t){case"date-only":r=l.dateOnlyToDateTime(o),m=l.dateOnlyToDateTime(i),u=l.dateOnlyToDateTime(a);break;case"time-only":r=l.timeOnlyToDateTime(o),m=l.timeOnlyToDateTime(i),u=l.timeOnlyToDateTime(a);break;case"timestamp-offset":r=l.timestampOffsetToDateTime(o),m=l.timestampOffsetToDateTime(i),u=l.timestampOffsetToDateTime(a)}return!u||F({value:u.valueOf(),min:m?.valueOf(),max:r?.valueOf()})},e.dateTimeToFieldValue=function(e){return e?.isValid?e.toMillis():null},e.getDefaultLocaleOptions=y,e.getISOFieldValueFromDateComponents=function(e){const{dateComponent:t,defaultTimeZone:n,timeComponent:a,timeZoneComponent:o,oldValue:i}=e;if(!t?.value)return null;const{year:r,month:s,day:c}=u.DateTime.fromFormat(t.value,l.defaultDatePattern),{hour:f,minute:d,second:p,millisecond:T}=v(a,m.utc)??u.DateTime.now(),D=h(i,n),y=""===o?.value?null:o?.value,O=y?parseInt(y,10):null!=D.timeZoneOffset?parseInt(D.timeZoneOffset,10):(new Date).getTimezoneOffset(),F=u.FixedOffsetZone.instance(O),g=u.DateTime.fromObject({year:r,month:s,day:c,hour:f,minute:d,second:p,millisecond:T},{zone:F});return g.isValid?g.toISO({includeOffset:!0}):null},e.getIntlOptionsForField=function(e){switch(e.type){case"date":default:return i.convertDateFormatToIntlOptions("short-date-short-time");case"date-only":return i.convertDateFormatToIntlOptions("short-date");case"time-only":return i.convertDateFormatToIntlOptions("short-time");case"timestamp-offset":return{...i.convertDateFormatToIntlOptions("short-date-short-time"),timeZone:void 0,timeZoneName:"short"}}},e.getLabelForDateFieldValue=function(e,t,n){if(!e||null==t)return null;switch(e.type){case"date":return i.formatDate(t,n);case"date-only":return i.formatDateOnly(t,n);case"time-only":return i.formatTimeOnly(t,n);case"timestamp-offset":return i.formatTimestamp(t,n);default:return null}},e.getLocalDateTimeFromComponent=v,e.getUnixFieldValueFromDateComponents=function(e){const{dateComponent:t,timeComponent:n,timeZone:a,max:o,min:i,oldValue:l}=e,r=v(t,a);let m=!!e.applyRange;if(!r)return null;let s=null;if(null!=n?.value){const e=v(n,a),t=Date.now(),i=null!=o&&o<t?o:t,l=u.DateTime.fromMillis(i,y(a)),m=r||l,{year:c,month:f,day:d}=m,{hour:p,minute:T,second:D,millisecond:O}=e||l;s=m.set({year:c,month:f,day:d,hour:p,minute:T,second:D,millisecond:O})}else{const e=O(g({value:l??Date.now(),max:o,min:i}),a),{year:t,month:n,day:u}=r,{hour:c,minute:f,second:d,millisecond:p}=e;m=!0,s=r.set({year:t,month:n,day:u,hour:c,minute:f,second:d,millisecond:p})}if(!s.isValid)return null;const c=s.toMillis();return m?g({value:c,max:o,min:i}):c},e.isArcadeDate=function(e){return!!e&&"object"==typeof e&&"getTime"in e&&"toISOString"in e&&"timeZone"in e},e.isCalciteDateComponent=D,e.isInDST=function(e,t="system"){return u.DateTime.fromJSDate(e,{zone:t}).isInDST},e.normalizeTimeOnlyString=S,e.numberingSystem=p,e.prepareISOFieldValueForDateComponents=h,e.prepareUnixFieldValueForDateComponents=function(e,t){if(null==e||!r.isNumber(e)||isNaN(e))return f;const n=O(e,t);return n?{date:n.toFormat(l.defaultDatePattern,y(t)),time:n.toFormat(l.defaultTimePattern,y(t))}:f},e.timeResolutionToStepMap=d,e.valueIsInRange=F,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});