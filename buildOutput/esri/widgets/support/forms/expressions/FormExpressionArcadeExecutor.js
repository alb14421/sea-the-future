// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../arcade","../../../../core/Accessor","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/support/UpdatingHandles","../../../../layers/support/fieldUtils"],function(e,t,r,o,s,a,i,c,n,l,u,p){"use strict";var d;const x=Symbol("FormExpressionArcadeExecutor");e.FormExpressionArcadeExecutor=class extends o{static{d=x}constructor(e){super(e),this[d]=!0,this._lastEvaluatedValue=null,this._abortController=new AbortController,this._initialExecutionComplete=!1,this._stale=!1,this._updatingTracking=new u.UpdatingHandles,this._executeAsyncDebounced=s.debounce(async(e,t,r)=>{const o=await this.executor.executeAsync(e,{...t,abortSignal:r});return r.aborted?this._lastEvaluatedValue:(this._lastEvaluatedValue=o,this._stale=!1,o)})}get initialExecutionComplete(){return this._initialExecutionComplete}get isAsync(){return this.executor.isAsync}get fieldsUsed(){return this.executor.fieldsUsed}get syntaxTree(){return this.executor.syntaxTree}get updating(){return this._updatingTracking.updating}get stale(){return this._stale}get geometryUsed(){return this.executor.geometryUsed}get variablesUsed(){return this.executor.variablesUsed}get lastEvaluatedValue(){return this._lastEvaluatedValue}abort(){this._abortController.abort()}execute(e,t){this._abortController=new AbortController;const r=this.executor.execute(e,{...t,abortSignal:this._abortController.signal});return this._lastEvaluatedValue=r,this._initialExecutionComplete=!0,r}async executeAsync(e,t){return this._abortController=new AbortController,this._updatingTracking.addPromise(this._executeAsyncDebounced(e,t??{},this._abortController.signal).then(()=>{this._initialExecutionComplete=!0}))}markStale(){this._stale=!0}reset(){this.abort(),this._lastEvaluatedValue=null,this._stale=!1}},t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"_lastEvaluatedValue",void 0),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"_initialExecutionComplete",void 0),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"_stale",void 0),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"_updatingTracking",void 0),t.__decorate([a.property({constructOnly:!0})],e.FormExpressionArcadeExecutor.prototype,"executor",void 0),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"initialExecutionComplete",null),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"isAsync",null),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"fieldsUsed",null),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"syntaxTree",null),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"updating",null),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"stale",null),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"geometryUsed",null),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"variablesUsed",null),t.__decorate([a.property()],e.FormExpressionArcadeExecutor.prototype,"lastEvaluatedValue",null),e.FormExpressionArcadeExecutor=t.__decorate([l.subclass("esri.widgets.support.forms.expressions.FormExpressionArcadeExecutor")],e.FormExpressionArcadeExecutor),e.createFormExpressionArcadeExecutor=async(t,o)=>{const s=r.createArcadeProfile("form-calculation"),a=await r.createArcadeExecutor(t,s,{});return o?.fieldsIndex&&(a.fieldsUsed=p.fixFields(o.fieldsIndex,a.fieldsUsed)),new e.FormExpressionArcadeExecutor({executor:a})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});