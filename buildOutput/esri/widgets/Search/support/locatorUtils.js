// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../Graphic","../../../geometry/Polygon","../../../geometry/support/geometryUtils","../../../rest/locator/addressToLocations","../../../rest/locator/locationToAddress","../../../rest/locator/suggestLocations","../../../rest/support/AddressToLocationsParameters","../../../rest/support/LocationToAddressParameters","../../../rest/support/SuggestLocationsParameters"],function(e,t,o,r,n,s,c,a,i,u){"use strict";function l(e,t){if(t.localSearchDisabled)return null;const o=e?.scale;return"number"==typeof o&&o<=3e5?e?.extent?.center:null}function d(e,t){const{filter:o,withinViewEnabled:n}=e,s=t?.scale,c=t?.extent,a=o?.geometry;return(a?r.createExtentFromGeometry(a,t??void 0,s):void 0)||(n&&c?c:void 0)}function g(e,n){return e.filter(Boolean).map(e=>function(e,n){const{key:s,scale:c,sourceIndex:a,view:i,zoomScale:u,defaultZoomScale:l}=n,{attributes:d,extent:g,location:f,address:m}=e,y=new t({geometry:f,attributes:d}),p=g||f,x=p?r.createExtentFromGeometry(p,i??void 0,c??void 0):void 0,S=x?"number"==typeof u?r.scaleExtent(x,i??void 0,u):"number"==typeof l&&"point"===p?.type?r.scaleExtent(x,i??void 0,l):x:null,v=f?`${f.x},${f.y}`:"",w=m||v,I=y.clone();return null!=S&&(I.geometry=o.fromExtent(S)),{extent:S,feature:y,target:I,key:s,name:w,sourceIndex:a}}(e,n))}e.getLocation=l,e.getResults=function(e,t){return e.location?async function(e,t){const{location:o,source:r,sourceIndex:n,spatialReference:c,view:a}=e,{apiKey:u,defaultZoomScale:l,language:d,url:f,zoomScale:m}=r;if(null==f)return[];const y=a?.scale,p=t?.signal,x=new i({language:d,location:o,apiKey:u,outSpatialReference:c});try{return g([await s.locationToAddress(f,x,{signal:p})],{defaultZoomScale:l,scale:y,sourceIndex:n,view:a,zoomScale:m})}catch{return[]}}(e,t):async function(e,t){const{source:o,suggestResult:r,spatialReference:s,view:c,maxResults:i,sourceIndex:u}=e,f=o?.zoomScale,m=o?.defaultZoomScale,y=r.text?.trim();if(!y)return null;const p=!r.key&&o.prefix?o.prefix:"",x=!r.key&&o.suffix?o.suffix:"",S=`${p}${r.text}${x}`,v=new a,{apiKey:w,url:I}=o,L=c?.scale,G=d(o,c),T=t?.signal;if(w&&(v.apiKey=w),!I)return null;o.categories&&(v.categories=o.categories),o.locationType&&(v.locationType=o.locationType),s&&(v.outSpatialReference=s);const b=l(c,o);b&&(v.location=b),v.maxLocations=i,G&&(v.searchExtent=G),o.countryCode&&(v.countryCode=o.countryCode);const{key:h}=r,R=`${h}`;return h&&(v.magicKey=R),v.address={},v.address[o.singleLineFieldName||"Single Line Input"]=S,o.outFields&&(v.outFields=o.outFields),n.addressToLocations(I,v,{signal:T}).then(e=>g(e,{key:R,scale:L,sourceIndex:u,view:c,zoomScale:f,defaultZoomScale:m}))}(e,t)},e.getSuggestions=async function(e,t){const{source:o,spatialReference:r,view:n,suggestTerm:s,maxSuggestions:a,sourceIndex:i}=e,g=new u,{apiKey:f,url:m}=o,y=d(o,n),p=t?.signal;if(!m)return null;f&&(g.apiKey=f),o.categories&&(g.categories=o.categories),r&&(g.outSpatialReference=r);const x=l(n,o);if(x&&(g.location=x),!s.trim())return null;const{prefix:S="",suffix:v=""}=o,w=`${S}${s}${v}`;return g.text=w,y&&(g.searchExtent=y),g.maxSuggestions=a,o.countryCode&&(g.countryCode=o.countryCode),c.suggestLocations(m,g,{signal:p}).then(e=>function(e,t){return e.map(e=>function(e,t){return{text:e.text,key:e.magicKey,sourceIndex:t}}(e,t))}(e,i))},e.isArcGISWorldGeocoder=function(e){return!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)},e.isMeteredArcGISWorldGeocoder=function(e){return!!e&&/(?:geocode-api\.arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/i.test(e)},e.isProxiedArcGISWorldGeocoder=function(e){return!!e&&/(?:\/servers\/[\da-z.-]+\/rest\/services\/world\/geocodeserver).*/i.test(e)},e.meteredArcGISLocatorUrl="https://geocode-api.arcgis.com/arcgis/rest/services/World/GeocodeServer",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});