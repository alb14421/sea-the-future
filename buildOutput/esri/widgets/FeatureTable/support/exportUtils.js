// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Error","../../../core/sanitizerUtils","../../../core/urlUtils","../../../exports/csv"],function(e,t,o,r,i){"use strict";function n(){return"showSaveFilePicker"in window&&(()=>{try{return window.self===window.top}catch{return!1}})()}e.downloadAttachmentInfo=async function(e){if(!e?.url)return;const t=await r.blobUrlToBlob(`${e.url}`);r.downloadBlobAsFile(t,e.name)},e.exportToCSV=async function(e){const{layer:s,includeGeometry:a,objectIds:c,outFields:l}=e,u=l??s.outFields??["*"],d=s.createQuery();d.objectIds=c,d.outFields=u;const w=await s.queryFeatures(d),y=await i.convertFeaturesToCSV(w,{includeGeometry:!s.isTable&&(a||"point"===w.geometryType),outFields:u});if(!y)throw new t("export-csv:no-output","Unable to generate a valid export string");const p=new Blob([y],{type:"text/csv"}),b=o.renderingSanitizer.sanitize(s.title);if(n())try{const e=await showSaveFilePicker({suggestedName:b,types:[{accept:{"text/csv":[".csv"]}}]}),t=await e.createWritable();await t.write(p),await t.close()}catch(e){if(e instanceof t&&"AbortError"!==e.name)throw e}else r.downloadBlobAsFile(p,`${b}.csv`)},e.supportsFileSystemAccess=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});