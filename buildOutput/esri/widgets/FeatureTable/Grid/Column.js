// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/reactiveUtils","../../../core/sanitizerUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ColumnCSS","../support/tableUtils","../../support/uriUtils","../../support/widgetUtils"],function(e,t,o,i,n,r,s,l,a,c,d,p,u){"use strict";let h=class extends t{constructor(e){super(e),this._menuIsOpen=!1,this.autoWidth=!1,this.cellValueFormatFunction=({root:e,rowData:t,value:o})=>{const{formatFunction:n}=this,r=i.renderingSanitizer.sanitize(o);if(n&&t){const{index:o,item:{attachments:i,feature:s,relatedRecords:l}}=t;return n({attachments:i,column:this,feature:s,index:o,relatedRecords:l,value:r,virtualIndex:this.getVirtualRowIndex(e),field:void 0})}return r},this.description=null,this.direction=null,this.fieldName=null,this.flexGrow=1,this.footerRenderFunction=null,this.formatFunction=null,this.frozen=!1,this.frozenToEnd=!1,this.grid=null,this.headerRenderFunction=e=>{const{root:t}=e,o=this.createHeaderContent();this.removeCellContent(t),t.appendChild(o)},this.hidden=!1,this.icon=null,this.iconText=null,this.initialSortPriority=null,this.label=null,this.labelTooltipText=null,this.menuConfig=null,this.messages=null,this.messagesCommon=null,this.messagesURIUtils=null,this.renderFunction=({root:e,rowData:t})=>{const o=this.getCellValue(t),i=this.cellValueFormatFunction({root:e,rowData:t,value:o});let n=null;if(n=i instanceof HTMLElement?i:p.autoLink(this.messagesURIUtils,i),this.removeCellContent(e),n instanceof HTMLElement)e.removeAttribute("title"),e.appendChild(n);else if(null!=n){const t=n.toString();e.innerHTML=t,e.title=t}},this.resizable=!0,this.sortable=!1,this.store=null,this.tableTimeZone=null,this.textAlign="start",this.textWrap=!1,this.timeZone=null,this.visibleElements=null,this.width=200}initialize(){const{fieldName:e}=this;this._set("sortElement",this.createSortElement()),this.sortElement.setAttribute("path",e),this.addHandles([o.watch(()=>this.direction,e=>{const{sortElement:t}=this;this.sortable&&t&&(e?this.sortElement.direction!==e&&t.setAttribute("direction",e):t.removeAttribute("direction"))}),o.when(()=>this.grid?.isReady&&this.sortElement,()=>{const{direction:e,grid:t,hidden:o,sortElement:i}=this;o&&e&&i&&t&&!t.hasSorter(i)&&t.addSorter(i)},o.initial),o.watch(()=>[this.timeZone,this.icon,this.iconText,this.labelTooltipText],()=>this.grid?.requestContentUpdate()),o.watch(()=>this.hidden,()=>this.closeMenu()),o.watch(()=>this.fieldName,e=>{const{sortElement:t}=this;t&&t.path!==e&&t.setAttribute("path",e)}),o.watch(()=>[this.effectiveLabel,this.labelTooltipText],([e,t])=>{const{sortElement:o}=this;o&&(o.setAttribute("title",t||e),o.textContent=e)})])}get _headerRequiresTextContainer(){return!(!this.sortable&&""===this.effectiveLabel&&null==this.effectiveDescription)}get customMenuItems(){return this.menuConfig?.items?.map(({disabled:e,hidden:t,icon:o,iconClass:i,label:n,selected:r,clickFunction:s})=>this.createCalciteDropdownItem({disabled:e,hidden:t,iconClass:i,iconStart:o,selected:r,textContent:n,onclick:e=>s(e)}))??[]}get defaultMenuItems(){if(!this.sortable)return[];const e=this.messages,t=[],o=this.visibleElements?.columnMenuItems;if(!1!==o?.sortAscending){const o=this.createCalciteDropdownItem({iconStart:"sort-ascending-arrow",textContent:e?.sortAsc,onclick:()=>this.direction="asc"});t.push(o)}if(!1!==o?.sortDescending){const o=this.createCalciteDropdownItem({iconStart:"sort-descending-arrow",textContent:e?.sortDesc,onclick:()=>this.direction="desc"});t.push(o)}return t}get effectiveDescription(){const{description:e}=this;return d.isEmptyStringOrWhitespace(e)?null:i.renderingSanitizer.sanitize(e)}get effectiveLabel(){return i.renderingSanitizer.sanitize(this.label||this.fieldName)}get iconNode(){const{icon:e,iconText:t}=this,o=t?i.renderingSanitizer.sanitize(t):void 0;return e?this.createCalciteIcon({icon:e,textLabel:o}):null}set invalid(e){this._set("invalid",e),this.grid?.generateCellPartNames()}get invalid(){return this._get("invalid")??!1}get menu(){const{customMenuItems:e,defaultMenuItems:t,menuConfig:o}=this,i=!!o?.open,n=this.createCalciteAction({icon:o?.icon??"ellipsis",text:this.messages?.menu??"",slot:"trigger"}),r=document.createElement("calcite-dropdown");if(r.maxItems=o?.maxItems??4,r.placement="top-end",r.overlayPositioning="fixed",r.scale=o?.scale??"m",i&&(r.open=i,this._menuIsOpen=!0),r.appendChild(n),r.addEventListener("calciteDropdownOpen",()=>this._menuIsOpen=!0),r.addEventListener("calciteDropdownClose",()=>this._menuIsOpen=!1),r.onkeydown=this._stopPropagationOnSelect,r.addEventListener("mousewheel",e=>{e.stopPropagation()}),t.length){const e=r.appendChild(document.createElement("calcite-dropdown-group"));e.selectionMode="none",e.append(...t)}if(e.length){const t=r.appendChild(document.createElement("calcite-dropdown-group"));t.selectionMode=o?.selectionMode??"none",t.append(...e)}return r}get menuItems(){return[...this.defaultMenuItems,...this.customMenuItems]}get menuIsOpen(){return this._menuIsOpen}get menuIsVisible(){return!(!1===this.visibleElements?.columnMenus||!this.menuItems.length)}closeMenu(){this.menu.open=!1}createSortElement(){const{effectiveLabel:e,direction:t,fieldName:o,initialSortPriority:i}=this,n=document.createElement("vaadin-grid-sorter");return n.classList.add(c.css.sorter),n.setAttribute("path",o),n.setAttribute("title",this.labelTooltipText||e),n.textContent=e,t&&n.setAttribute("direction",t),null!=i&&(n._initialOrder=i),n.addEventListener("direction-changed",()=>{this.direction!==n.direction&&this._set("direction",n.direction)}),n}createCalciteAction(e){const t=document.createElement("calcite-action"),{alignment:o,appearance:i,className:n,disabled:r,icon:s,label:l,scale:a,slot:c,text:d,textEnabled:p,onclick:u}=e;return t.alignment=o??"center",t.appearance=i??"transparent",t.className=n??"",t.disabled=!!r,t.icon=s??"",t.label=l??"",t.scale=a??"s",t.slot=c??"",t.text=t.title=d??"",t.textEnabled=!!p,t.onclick=u??null,t}createCalciteButton(e){const t=document.createElement("calcite-button"),{alignment:o,appearance:i,className:n,disabled:r,iconEnd:s,iconFlipRtl:l,kind:a,loading:c,onclick:d,scale:p,textContent:u,title:h,width:m}=e;return t.alignment=o??"center",t.className=n??"",t.scale=p??"s",t.appearance=i??"transparent",t.disabled=!!r,t.iconEnd=s??"",l&&(t.iconFlipRtl=l),t.kind=a??"brand",t.loading=!!c,t.textContent=u??"",h&&(t.title=h),t.width=m??"auto",t.onclick=d??null,t}createCalciteDropdownItem(e){const t=document.createElement("calcite-dropdown-item"),{disabled:o,hidden:i,iconClass:n,iconStart:r,textContent:s,onclick:l,selected:a}=e,d=s??"";if(n&&!r){const e=document.createElement("span"),o=document.createElement("span");o.classList.add(c.css.headerMenuIcon,n),e.textContent=e.title=d,e.insertBefore(o,e.firstChild),t.appendChild(e)}else t.iconStart=r??"",t.textContent=t.title=d;return t.disabled=!!o,t.hidden="function"==typeof i?i():!!i,t.selected=!!a,l&&(t.addEventListener("calciteDropdownItemSelect",l),t.onkeydown=this._stopPropagationOnSelect),t}createCalciteIcon(e){const{effectiveLabel:t}=this,{icon:o,scale:i,textLabel:n}=e,r=document.createElement("calcite-icon"),s=n??t;return r.icon=o,r.scale=i??"s",r.textLabel=s,r.title=s,r}createHeaderContent(){const{effectiveDescription:e,effectiveLabel:t,iconNode:o}=this,i=document.createElement("div");if(i.classList.add(c.css.headerContent),o&&i.appendChild(o),!this._headerRequiresTextContainer)return i;const n=i.appendChild(document.createElement("div"));return this.sortable?n.appendChild(this.sortElement):""!==t&&n.appendChild(this._createHeaderTextElement({label:t,cssClass:c.css.headerLabel,title:this.labelTooltipText})),null!=e&&!1!==this.visibleElements?.columnDescriptions&&n.appendChild(this._createHeaderTextElement({label:e,cssClass:c.css.headerDescription})),this.menuIsVisible&&i.appendChild(this.menu),i}getCellValue(e){return e?.item.feature.attributes?.[this.fieldName]}getVirtualRowIndex(e){const t=this.grid?.getRowContainingNode(e);return t?.parentElement?[...t.parentElement.children].indexOf(t):-1}removeCellContent(e){if(e&&e.firstChild)try{for(;e?.firstChild;)e?.removeChild(e.firstChild)}catch(e){}}openMenu(){this.menuIsVisible&&(this.menu.open=!0,u.setFocus(this.menuItems[0]))}sort(){this.sortable&&this.sortElement?.click()}_stopPropagationOnSelect(e){"Enter"!==e.key&&" "!==e.key||e.stopPropagation()}_createHeaderTextElement({cssClass:e,label:t,title:o}){const i=document.createElement("span");i.classList.add(e);const n=i.appendChild(document.createElement("span"));return n.textContent=t,n.setAttribute("title",o||t),i}};return e.__decorate([n.property()],h.prototype,"_headerRequiresTextContainer",null),e.__decorate([n.property()],h.prototype,"_menuIsOpen",void 0),e.__decorate([n.property()],h.prototype,"autoWidth",void 0),e.__decorate([n.property()],h.prototype,"cellValueFormatFunction",void 0),e.__decorate([n.property()],h.prototype,"customMenuItems",null),e.__decorate([n.property()],h.prototype,"defaultMenuItems",null),e.__decorate([n.property()],h.prototype,"description",void 0),e.__decorate([n.property()],h.prototype,"direction",void 0),e.__decorate([n.property()],h.prototype,"effectiveDescription",null),e.__decorate([n.property()],h.prototype,"effectiveLabel",null),e.__decorate([n.property({constructOnly:!0})],h.prototype,"fieldName",void 0),e.__decorate([n.property()],h.prototype,"flexGrow",void 0),e.__decorate([n.property()],h.prototype,"footerRenderFunction",void 0),e.__decorate([n.property()],h.prototype,"formatFunction",void 0),e.__decorate([n.property()],h.prototype,"frozen",void 0),e.__decorate([n.property()],h.prototype,"frozenToEnd",void 0),e.__decorate([n.property()],h.prototype,"grid",void 0),e.__decorate([n.property()],h.prototype,"iconNode",null),e.__decorate([n.property()],h.prototype,"invalid",null),e.__decorate([n.property()],h.prototype,"headerRenderFunction",void 0),e.__decorate([n.property()],h.prototype,"hidden",void 0),e.__decorate([n.property()],h.prototype,"icon",void 0),e.__decorate([n.property()],h.prototype,"iconText",void 0),e.__decorate([n.property({constructOnly:!0})],h.prototype,"initialSortPriority",void 0),e.__decorate([n.property()],h.prototype,"label",void 0),e.__decorate([n.property()],h.prototype,"labelTooltipText",void 0),e.__decorate([n.property()],h.prototype,"menu",null),e.__decorate([n.property()],h.prototype,"menuItems",null),e.__decorate([n.property()],h.prototype,"menuConfig",void 0),e.__decorate([n.property()],h.prototype,"menuIsOpen",null),e.__decorate([n.property()],h.prototype,"menuIsVisible",null),e.__decorate([n.property()],h.prototype,"messages",void 0),e.__decorate([n.property()],h.prototype,"messagesCommon",void 0),e.__decorate([n.property()],h.prototype,"messagesURIUtils",void 0),e.__decorate([n.property()],h.prototype,"renderFunction",void 0),e.__decorate([n.property()],h.prototype,"resizable",void 0),e.__decorate([n.property()],h.prototype,"sortable",void 0),e.__decorate([n.property({readOnly:!0})],h.prototype,"sortElement",void 0),e.__decorate([n.property()],h.prototype,"store",void 0),e.__decorate([n.property()],h.prototype,"tableTimeZone",void 0),e.__decorate([n.property()],h.prototype,"textAlign",void 0),e.__decorate([n.property()],h.prototype,"textWrap",void 0),e.__decorate([n.property()],h.prototype,"timeZone",void 0),e.__decorate([n.property()],h.prototype,"visibleElements",void 0),e.__decorate([n.property()],h.prototype,"width",void 0),h=e.__decorate([a.subclass("esri.widgets.FeatureTable.Grid.Column")],h),h});