// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../chunks/tslib.es6","../core/arrayUtils","../core/compilerUtils","../core/reactiveUtils","../core/timeUtils","../core/accessorSupport/decorators/property","../core/Logger","../core/accessorSupport/decorators/subclass","../intl/date","../time/constants","../chunks/TimeInterval","./Slider","./Widget","../chunks/componentsUtils","./support/globalCss","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","../support/modeUtils","./TimeSlider/css","./TimeSlider/TimeSliderViewModel"],function(e,t,i,s,a,r,n,o,l,c,m,u,d,p,h,v,y,x,f,_,g,b,w){"use strict";const k=[{minor:{value:100,unit:"milliseconds"},major:{value:1,unit:"seconds"},format:{second:"numeric"}},{minor:{value:500,unit:"milliseconds"},major:{value:5,unit:"seconds"},format:{second:"numeric"}},{minor:{value:1,unit:"seconds"},major:{value:20,unit:"seconds"},format:{minute:"numeric",second:"numeric"}},{minor:{value:2,unit:"seconds"},major:{value:30,unit:"seconds"},format:{minute:"numeric",second:"numeric"}},{minor:{value:10,unit:"seconds"},major:{value:1,unit:"minutes"},format:{minute:"numeric"}},{minor:{value:15,unit:"seconds"},major:{value:5,unit:"minutes"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:1,unit:"minutes"},major:{value:20,unit:"minutes"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:5,unit:"minutes"},major:{value:2,unit:"hours"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:15,unit:"minutes"},major:{value:6,unit:"hours"},format:{hour:"numeric",minute:"numeric"}},{minor:{value:1,unit:"hours"},major:{value:1,unit:"days"},format:{day:"numeric",month:"short"}},{minor:{value:6,unit:"hours"},major:{value:1,unit:"weeks"},format:{day:"numeric",month:"short"}},{minor:{value:1,unit:"days"},major:{value:1,unit:"months"},format:{month:"long"}},{minor:{value:2,unit:"days"},major:{value:1,unit:"months"},format:{month:"short"}},{minor:{value:3,unit:"days"},major:{value:1,unit:"months"},format:{month:"short"}},{minor:{value:4,unit:"days"},major:{value:3,unit:"months"},format:{month:"short",year:"numeric"}},{minor:{value:1,unit:"weeks"},major:{value:1,unit:"years"},format:{year:"numeric"}},{minor:{value:1,unit:"months"},major:{value:1,unit:"years"},format:{year:"numeric"}},{minor:{value:2,unit:"months"},major:{value:2,unit:"years"},format:{year:"numeric"}},{minor:{value:1,unit:"years"},major:{value:1,unit:"decades"},format:{year:"numeric"}},{minor:{value:2,unit:"years"},major:{value:5,unit:"decades"},format:{year:"numeric"}},{minor:{value:5,unit:"decades"},major:{value:10,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:1,unit:"centuries"},major:{value:10,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:2,unit:"centuries"},major:{value:20,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:5,unit:"centuries"},major:{value:50,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:10,unit:"centuries"},major:{value:100,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:20,unit:"centuries"},major:{value:200,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:50,unit:"centuries"},major:{value:500,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:100,unit:"centuries"},major:{value:1e3,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:200,unit:"centuries"},major:{value:1e3,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:500,unit:"centuries"},major:{value:5e3,unit:"centuries"},format:{era:"short",year:"numeric"}},{minor:{value:1e3,unit:"centuries"},major:{value:1e4,unit:"centuries"},format:{era:"short",year:"numeric"}}];function E(e){return _.tsx("div",{class:b.css.warning},_.tsx("calcite-icon",{class:b.css.warningIcon,icon:"exclamation-mark-triangle"}),_.tsx("calcite-label",{alignment:"center",class:b.css.warningLabel,scale:"s"},e))}let T=class extends p{constructor(e,t){super(e,t),this._allLayouts=["auto","compact","wide"],this._ignoreNextSliderUpdate=!1,this._slider=new d({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1,thumbsConstrained:!1}),this._tickFormat=null,this.disabled=!1,this.labelFormatFunction=null,this.messages=null,this.tickConfigs=null,this.timeVisible=!1,this.viewModel=new w}initialize(){this.addHandles([a.watch(()=>this._slider.values,e=>{if(this._ignoreNextSliderUpdate)return void(this._ignoreNextSliderUpdate=!1);const t=this.viewModel.valuesToTimeExtent(e);this.timeExtent?t?this.timeExtent.equals(t)||(this.timeExtent=t):this.timeExtent=null:t&&(this.timeExtent=t)}),a.watch(()=>this.effectiveStops,()=>this._updateSliderSteps(),a.initial)])}loadDependencies(){return h.loadCalciteComponents({action:()=>new Promise((t,i)=>e(["../chunks/index12"],t,i)),"action-menu":()=>new Promise((t,i)=>e(["../chunks/index19"],t,i)).then(e=>e.index),button:()=>new Promise((t,i)=>e(["../chunks/index2"],t,i)),icon:()=>new Promise((t,i)=>e(["../chunks/index7"],t,i)),label:()=>new Promise((t,i)=>e(["../chunks/index5"],t,i))})}destroy(){this._slider.destroy(),this._tickFormat=null}get _dateFormat(){return this._getIntlOptions("short-date")}get _timeFormat(){return this._getIntlOptions("long-time")}get actions(){return this.viewModel.actions}set actions(e){this.viewModel.actions=e}get effectiveStops(){return this.viewModel.effectiveStops}get fullTimeExtent(){return this.viewModel.fullTimeExtent}set fullTimeExtent(e){this.viewModel.fullTimeExtent=e}get icon(){return"clock"}set icon(e){this._overrideIfSome("icon",e)}get interactive(){return!(this.disabled||"disabled"===this.viewModel.state||this.timeZone===m.unknown)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}set layout(e){this._set("layout",this._allLayouts.includes(e)?e:"auto")}get loop(){return this.viewModel.loop}set loop(e){this.viewModel.loop=e}get mode(){return this.viewModel.mode}set mode(e){this.viewModel.mode=e}get playRate(){return this.viewModel.playRate}set playRate(e){this.viewModel.playRate=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}get tickFormats(){const{timeZone:e}=this;return k.map(({minor:t,major:i,format:s})=>({minor:new u.TimeInterval(t),major:new u.TimeInterval(i),format:{...s,timeZone:e}}))}get timeExtent(){return this.viewModel.timeExtent}set timeExtent(e){this.viewModel.timeExtent=e}get timeZone(){return this.viewModel.view?.timeZone??m.system}set timeZone(e){this._overrideIfSome("timeZone",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}next(){return this.viewModel.next()}play(){return this.viewModel.play()}previous(){return this.viewModel.previous()}stop(){return this.viewModel.stop()}render(){const{_slider:e,actions:t,domNode:s,effectiveStops:a,fullTimeExtent:r,interactive:n,messages:o,mode:l,tickConfigs:m,timeExtent:u,timeVisible:d,viewModel:{state:p,timeExtentValues:h}}=this;if(r){const{start:t,end:i}=r;if(t&&i){const s=t.getTime(),a=i.getTime(),r=e.min!==s||e.max!==a;if(r&&(e.min=s,e.max=a),m)e.tickConfigs!==m&&(e.tickConfigs=m);else{const t=(a-s)/(e.trackElement?.offsetWidth||400),i=this.tickFormats.find(({minor:e})=>e.toMilliseconds()>3*t)??this.tickFormats.at(-1),n=i&&this._tickFormat!==i;if(n&&(this._tickFormat=i),r||n){const t={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t?.classList.add(b.css.sliderMinorTick)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t?.classList.add(b.css.sliderMajorTick)},labelFormatFunction:e=>c.formatDate(e,i.format)};e.tickConfigs=[t,s]}}}}const x=!this.fullTimeExtent?.start||!this.fullTimeExtent.end||!this.timeExtent||this.timeExtent.isAllTime||this.timeExtent.isEmpty||this.timeExtent.start&&(this.timeExtent.start<this.fullTimeExtent.start||this.timeExtent.start>this.fullTimeExtent.end)||this.timeExtent.end&&(this.timeExtent.end>this.fullTimeExtent.end||this.timeExtent.end<this.fullTimeExtent.start);if(x)switch(this._ignoreNextSliderUpdate=!0,l){case"time-window":e.values=[e.min,e.max];break;case"instant":case"cumulative-from-end":e.values=[e.min];break;case"cumulative-from-start":e.values=[e.max]}else h?i.equals(e.values,h)||(e.values=h):e.values=null;e.disabled=!n;const f=x||!n||!a?.length,w="auto"===this.layout?s.clientWidth<858?"compact":"wide":this.layout,k=_.tsx("calcite-button",{appearance:"transparent",bind:this,class:b.css.play,disabled:f,iconStart:"playing"===p?"pause":"play",kind:"neutral",label:"playing"===p?o.control.stop:o.control.play,onclick:this._playOrStopClick,scale:"wide"===w?"l":"m",width:"full"}),T=this.labelFormatFunction?_.tsx("div",{afterCreate:this._createLabel,afterUpdate:this._createLabel,bind:this,class:b.css.timeExtentStartDate,"data-date":u?[u.start,u.end]:null,"data-layout":w,"data-type":"extent",key:b.css.timeExtentStartDate}):!u||u.isAllTime?E(o.noTimeExtent):u.isEmpty?E(o.emptyTimeExtent):[u?.start&&_.tsx("div",{class:b.css.timeExtentStartGroup,key:b.css.timeExtentStartGroup},_.tsx("calcite-label",{alignment:"center",class:b.css.timeExtentStartDate,key:b.css.timeExtentStartDate,scale:"s"},this._formatDate(u.start)),d?_.tsx("calcite-label",{alignment:"center",class:b.css.timeExtentStartTime,key:b.css.timeExtentStartTime,scale:"s"},this._formatTime(u.start)):null),u.start&&u.end&&u.start.getTime()!==u.end.getTime()&&_.tsx("div",{class:b.css.timeExtentSeparator,key:b.css.timeExtentSeparator}),u?.end&&(!u.start||u.start.getTime()!==u.end.getTime())&&_.tsx("div",{class:b.css.timeExtentEndGroup,key:b.css.timeExtentEndGroup},_.tsx("calcite-label",{alignment:"center",class:b.css.timeExtentEndDate,key:b.css.timeExtentEndDate,scale:"s"},this._formatDate(u.end)),d?_.tsx("calcite-label",{alignment:"center",class:b.css.timeExtentEndTime,key:b.css.timeExtentEndTime,scale:"s"},this._formatTime(u.end)):null)],S=_.tsx("div",{class:b.css.timeExtent},T),M=this.labelFormatFunction?_.tsx("div",{afterCreate:this._createLabel,afterUpdate:this._createLabel,bind:this,class:b.css.minDate,"data-date":r?.start,"data-layout":w,"data-type":"min",key:b.css.minDate}):r?.start&&[_.tsx("calcite-label",{class:b.css.minDate,key:b.css.minDate,scale:"s"},this._formatDate(r.start)),d&&_.tsx("calcite-label",{class:b.css.minTime,key:b.css.minTime,scale:"s"},this._formatTime(r.start))],j=_.tsx("div",{class:b.css.min},M),F=_.tsx("div",{class:b.css.slider},e.render()),D=this.labelFormatFunction?_.tsx("div",{afterCreate:this._createLabel,afterUpdate:this._createLabel,bind:this,class:b.css.maxDate,"data-date":r?.end,"data-layout":w,"data-type":"max",key:b.css.maxDate}):r?.end&&[_.tsx("calcite-label",{class:b.css.maxDate,key:b.css.maxDate,scale:"s"},this._formatDate(r.end)),d&&_.tsx("calcite-label",{class:b.css.maxTime,key:b.css.maxTime,scale:"s"},this._formatTime(r.end))],C=_.tsx("div",{class:b.css.max},D),L=_.tsx("calcite-button",{appearance:"transparent",bind:this,class:b.css.previous,disabled:f||"playing"===p,iconStart:"reverse",kind:"neutral",label:o.pagination.previous,onclick:this._previousClick,scale:"wide"===w?"l":"m",width:"full"}),U=_.tsx("calcite-button",{appearance:"transparent",bind:this,class:b.css.next,disabled:f||"playing"===p,iconStart:"forward",kind:"neutral",label:o.pagination.next,onclick:this._nextClick,scale:"wide"===w?"l":"m",width:"full"}),I=t?.length>0,R=I&&_.tsx("calcite-action-menu",{class:b.css.actions,label:o.options},t.toArray().map(e=>_.tsx("calcite-action",{bind:this,icon:e.icon,id:e.id,onclick:()=>this.viewModel.triggerAction(e),text:e.title,textEnabled:!0})));return _.tsx("div",{afterCreate:e=>{this.addHandles(y.onResize(e,()=>this.scheduleRender()))},"aria-label":o.widgetLabel,class:this.classes(b.css.timeSlider,v.globalCss.widget,`${b.css.timeSliderMode}${l}`,`${b.css.timeSliderLayout}${w}`,!n&&b.css.timeSliderDisabled,x&&b.css.timeSliderOutOfBounds,I&&b.css.hasActions,g.getCalciteModeClass())},"wide"===w&&_.tsx("div",{class:b.css.timeSliderRow},_.tsx("div",{class:b.css.playbackControls},[k,S,j,F,C,L,U]),R),"compact"===w&&[_.tsx("div",{class:b.css.timeSliderRow,key:"time-slider-row-1"},[S,R]),_.tsx("div",{class:b.css.timeSliderRow,key:"time-slider-row-2"},[F]),_.tsx("div",{class:b.css.timeSliderRow,key:"time-slider-row-3"},[j,L,k,U,C])])}updateWebDocument(e){this.viewModel?.updateWebDocument(e)}_createLabel(e){if(!this.labelFormatFunction)return;const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),s=e["data-date"];this.labelFormatFunction(s,t,e,i)}_formatDate(e){return c.formatDate(e,this._dateFormat)}_formatTime(e){return c.formatDate(e,this._timeFormat)}_getIntlOptions(e){const{timeZone:t}=this;return{...c.convertDateFormatToIntlOptions(e),timeZone:t}}_getTickPositions(e){const{fullTimeExtent:t}=this;if(!t?.start||!t.end)return[];const{start:i,end:s}=t,a=[],{value:n,unit:o}=e;let l=r.truncateDate(i,o,this.timeZone);for(;l.getTime()<=s.getTime();)l.getTime()>=i.getTime()&&a.push(l.getTime()),l=r.offsetDate(l,n,o,this.timeZone);return a}_updateSliderSteps(){this._slider.steps=this.effectiveStops&&this.effectiveStops.length>0?this.effectiveStops.map(e=>e.getTime()):null}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:s.neverReached(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};return t.__decorate([n.property()],T.prototype,"_dateFormat",null),t.__decorate([n.property()],T.prototype,"_timeFormat",null),t.__decorate([n.property()],T.prototype,"actions",null),t.__decorate([n.property()],T.prototype,"disabled",void 0),t.__decorate([n.property()],T.prototype,"effectiveStops",null),t.__decorate([n.property()],T.prototype,"fullTimeExtent",null),t.__decorate([n.property()],T.prototype,"icon",null),t.__decorate([n.property({readOnly:!0})],T.prototype,"interactive",null),t.__decorate([n.property()],T.prototype,"label",null),t.__decorate([n.property()],T.prototype,"labelFormatFunction",void 0),t.__decorate([n.property({value:"auto"})],T.prototype,"layout",null),t.__decorate([n.property()],T.prototype,"loop",null),t.__decorate([n.property(),x.messageBundle("esri/widgets/TimeSlider/t9n/TimeSlider")],T.prototype,"messages",void 0),t.__decorate([n.property()],T.prototype,"mode",null),t.__decorate([n.property()],T.prototype,"playRate",null),t.__decorate([n.property()],T.prototype,"stops",null),t.__decorate([n.property()],T.prototype,"tickConfigs",void 0),t.__decorate([n.property()],T.prototype,"tickFormats",null),t.__decorate([n.property()],T.prototype,"timeExtent",null),t.__decorate([n.property({nonNullable:!0})],T.prototype,"timeVisible",void 0),t.__decorate([n.property()],T.prototype,"timeZone",null),t.__decorate([n.property()],T.prototype,"view",null),t.__decorate([n.property({type:w}),f.vmEvent("trigger-action")],T.prototype,"viewModel",void 0),T=t.__decorate([l.subclass("esri.widgets.TimeSlider")],T),T});