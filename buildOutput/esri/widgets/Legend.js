// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend/LegendViewModel":function(){define(["exports","../../chunks/tslib.es6","../../intl","../../core/Accessor","../../core/Collection","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/get","../../views/2d/layers/features/layerAdapters/featureReductionUtils","./support/ActiveLayerInfo","../../intl/locale"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d){"use strict";const m="state",y="all-layer-views",g="legend-properties",_=r.ofType(f),b=new Set(["esri.layers.BuildingSceneLayer","esri.layers.CatalogLayer","esri.layers.CSVLayer","esri.layers.FeatureLayer","esri.layers.GeoJSONLayer","esri.layers.GeoRSSLayer","esri.layers.GroupLayer","esri.layers.HeatmapLayer","esri.layers.ImageryLayer","esri.layers.ImageryTileLayer","esri.layers.MapImageLayer","esri.layers.OGCFeatureLayer","esri.layers.OrientedImageryLayer","esri.layers.ParquetLayer","esri.layers.PointCloudLayer","esri.layers.StreamLayer","esri.layers.SceneLayer","esri.layers.SubtypeGroupLayer","esri.layers.TileLayer","esri.layers.VoxelLayer","esri.layers.WFSLayer","esri.layers.WMSLayer","esri.layers.WMTSLayer","esri.layers.WCSLayer","esri.layers.LinkChartLayer","esri.layers.catalog.CatalogFootprintLayer","esri.layers.catalog.CatalogDynamicGroupLayer","esri.layers.knowledgeGraph.KnowledgeGraphSublayer","esri.layers.KnowledgeGraphLayer"]),x="view.basemapView.baseLayerViews",S="view.groundView.layerViews",v="view.basemapView.referenceLayerViews",w=[x,S,"view.layerViews",v];return e.default=class extends i{constructor(e){super(e),this._layerViewByLayerId={},this._layerInfosByLayerViewId={},this._activeLayerInfosByLayerViewId={},this._activeLayerInfosWithNoParent=new r,this.activeLayerInfos=new _,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.layerInfos=[],this.view=null}initialize(){this.addHandles(n.watch(()=>this.view,()=>this._viewHandles(),n.initial),"view"),this.addHandles(d.onLocaleChange(()=>this._refresh()))}destroy(){this._destroyViewActiveLayerInfos(),this.view=null}get state(){return this.view?.ready?"ready":"disabled"}_viewHandles(){this.removeHandles(m),this.view&&this.addHandles(n.watch(()=>this.state,()=>this._stateHandles(),n.initial),m)}_stateHandles(){this._resetAll(),"ready"===this.state&&this._watchPropertiesAndAllLayerViews()}_resetAll(){this.removeHandles([y,g]),this._destroyViewActiveLayerInfos(),this.activeLayerInfos.removeAll()}_destroyViewActiveLayerInfos(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)}_destroyViewActiveLayerInfo(e){this.removeHandles(e);const t=this._activeLayerInfosByLayerViewId[e];delete this._activeLayerInfosByLayerViewId[e],t?.parent&&t.parent.children.remove(t)}_watchPropertiesAndAllLayerViews(){const{view:e}=this;if(!e)return;const{allLayerViews:t}=e;t.length&&this._refresh(),this.addHandles(t.on("change",e=>this._allLayerViewsChangeHandle(e)),y),this.addHandles(n.watch(()=>[this.layerInfos,this.basemapLegendVisible,this.groundLegendVisible],()=>this._propertiesChangeHandle()),g)}_allLayerViewsChangeHandle(e){e.moved.length?this._propertiesChangeHandle():(e.removed.forEach(e=>this._destroyViewActiveLayerInfo(e.uid)),this._refresh())}_propertiesChangeHandle(){this._destroyViewActiveLayerInfos(),this._refresh()}_refresh(){this._layerInfosByLayerViewId={},this.activeLayerInfos.removeAll(),this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this),this._sortActiveLayerInfos(this.activeLayerInfos)}_sortActiveLayerInfos(e){const t=this.view;if(e.length<2||!t)return;const s=[];e.forEach(t=>{if(!t.parent){const i=t.layer.parent,r=i&&"uid"in i&&this._layerViewByLayerId[i.uid],n=r&&this._activeLayerInfosByLayerViewId[r.uid];n&&e.includes(n)&&(s.push(t),t.parent=n,n.children.add(t),this._sortActiveLayerInfos(n.children))}}),e.removeMany(s);const i={};t.allLayerViews.forEach((e,t)=>i[e.layer.uid]=t),e.sort((e,t)=>{const s=i[e.layer.uid]||0;return(i[t.layer.uid]||0)-s})}_generateLayerViews(){const e=[];return w.filter(this._filterLayerViews,this).map(e=>u.get(this,e)).filter(e=>null!=e).forEach(this._collectLayerViews("layerViews",e)),e}_filterLayerViews(e){const t=!this.basemapLegendVisible&&(e===x||e===v),s=!this.groundLegendVisible&&e===S;return!t&&!s}_collectLayerViews(e,t){const s=i=>(i&&i.forEach(i=>{t.push(i),s(i[e])}),t);return s}_filterLayerViewsByLayerInfos(e){const t=this.layerInfos;return!t||!t.length||t.some(t=>this._hasLayerInfo(t,e))}_hasLayerInfo(e,t){const s=this._isLayerUIDMatching(e.layer,t.layer.uid);return s&&(this._layerInfosByLayerViewId[t.uid]=e),s}_isLayerUIDMatching(e,t){return e&&(e.uid===t||this._hasLayerUID(e.layers,t))}_hasLayerUID(e,t){return e&&e.some(e=>this._isLayerUIDMatching(e,t))}_isLayerViewSupported(e){return!!b.has(e.layer.declaredClass)&&(this._layerViewByLayerId[e.layer.uid]=e,!0)}_generateActiveLayerInfo(e){this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this.removeHandles(e.uid),this.addHandles(n.watch(()=>[e.legendEnabled,e.layer?.legendEnabled],()=>this._layerActiveHandle(e)),e.uid))}_layerActiveHandle(e){this._isLayerActive(e)&&(this.removeHandles(e.uid),this._buildActiveLayerInfo(e))}_isLayerActive(e){return!this.respectLayerVisibility||e.legendEnabled&&e.layer?.legendEnabled}_buildActiveLayerInfo(e){const t=e.layer,s=e.uid,i=this._layerInfosByLayerViewId[s];let r=this._activeLayerInfosByLayerViewId[s];if(!r){const n=void 0!==i?.title&&i.layer.uid===t.uid;r=new f({layer:t,layerView:e,title:n?i.title:t.title,view:this.view??void 0,respectLayerDefinitionExpression:this.respectLayerDefinitionExpression,respectLayerVisibility:this.respectLayerVisibility,hideLayersNotInCurrentView:this.hideLayersNotInCurrentView,keepCacheOnDestroy:this.keepCacheOnDestroy,sublayerIds:i?.sublayerIds||[]}),this._activeLayerInfosByLayerViewId[s]=r}const o=t.parent&&"uid"in t.parent?this._layerViewByLayerId[t.parent?.uid]:null;if(r.parent=this._activeLayerInfosByLayerViewId[o?.uid],!this.hasHandles(s)){const i=[n.watch(()=>t.title,e=>this._titleHandle(e,r)),n.watch(()=>[t.opacity,"renderer"in t&&t.renderer,"pointSymbol"in t&&t.pointSymbol,"lineSymbol"in t&&t.lineSymbol,"polygonSymbol"in t&&t.polygonSymbol],()=>this._constructLegendElements(r)),n.when(()=>!0===this.view?.stationary,()=>this._scaleHandle(r),n.initial),n.watch(()=>e.layer?p.getEffectiveFeatureReduction(e.layer,e.view):null,()=>this._constructLegendElements(r)),n.watch(()=>e.updating,()=>{null!=e.layer&&null!=p.getEffectiveFeatureReduction(e.layer,e.view)&&this._constructLegendElements(r)}),n.watch(()=>"effect"in t&&t.effect,()=>this._constructLegendElements(r)),n.when(()=>this.view?.timeZone,()=>this._constructLegendElements(r),n.initial)];if(this.respectLayerVisibility){const s=n.watch(()=>e.legendEnabled,e=>this._legendEnabledHandle(e,r)),o=n.watch(()=>t.legendEnabled,e=>this._legendEnabledHandle(e,r));i.push(s,o)}if(this.respectLayerDefinitionExpression&&"definitionExpression"in t){const e=n.watch(()=>[t.definitionExpression,this.respectLayerDefinitionExpression],()=>{r.respectLayerDefinitionExpression=this.respectLayerDefinitionExpression,this._constructLegendElements(r)});i.push(e)}this.addHandles(i,s)}r.isScaleDriven||this._constructLegendElements(r),this._addActiveLayerInfo(r)}_titleHandle(e,t){t.title=e,this._constructLegendElements(t)}_legendEnabledHandle(e,t){e?this._addActiveLayerInfo(t):this._removeActiveLayerInfo(t)}_scaleHandle(e){(e.isScaleDriven||e.hideLayersNotInCurrentView)&&this._constructLegendElements(e)}_addActiveLayerInfo(e){const{layerView:t,layer:s}=e;if(this._isLayerActive(t)&&!this.activeLayerInfos.includes(e)){const t=e.parent;if(t)t.children.includes(e)||t.children.push(e),this._sortActiveLayerInfos(t.children);else{const t=this.layerInfos?.some(e=>e.layer.uid===s.uid),i=s.parent;i&&"uid"in i&&this._layerViewByLayerId[i.uid]&&!t?this._activeLayerInfosWithNoParent.add(e):(this.activeLayerInfos.add(e),this._sortActiveLayerInfos(this.activeLayerInfos))}if(this._activeLayerInfosWithNoParent.length){const e=[];this._activeLayerInfosWithNoParent.forEach(t=>{const s=t.layer.parent,i=s&&"uid"in s?this._layerViewByLayerId[s?.uid]:null,r=this._activeLayerInfosByLayerViewId[i?.uid];r&&(e.push(t),t.parent=r)}),e.length&&(this._activeLayerInfosWithNoParent.removeMany(e),e.forEach(e=>this._addActiveLayerInfo(e)))}}}_removeActiveLayerInfo(e){const t=e.parent;t?t.children.remove(e):this.activeLayerInfos.remove(e)}_constructLegendElements(e){const t=e.layer;"featureCollections"in t&&t.featureCollections?e.buildLegendElementsForFeatureCollections(t.featureCollections):"featureReduction"in t&&t.featureReduction&&"renderer"in t.featureReduction&&("binning"===t.featureReduction.type||"cluster"===t.featureReduction.type)&&(!this.view||t.featureReduction.maxScale<=this.view.scale)?e.buildLegendElementsForFeatureReduction(t.featureReduction):"renderer"in t&&t.renderer&&!("sublayers"in t)?e.buildLegendElementsForRenderer(t.renderer):"url"in t&&t.url&&"catalog"!==t.type&&"knowledge-graph"!==t.type?e.buildLegendElementsForTools():e.children.forEach(e=>this._constructLegendElements(e))}},t.__decorate([o.property({type:_})],e.default.prototype,"activeLayerInfos",void 0),t.__decorate([o.property()],e.default.prototype,"basemapLegendVisible",void 0),t.__decorate([o.property()],e.default.prototype,"groundLegendVisible",void 0),t.__decorate([o.property()],e.default.prototype,"hideLayersNotInCurrentView",void 0),t.__decorate([o.property()],e.default.prototype,"keepCacheOnDestroy",void 0),t.__decorate([o.property()],e.default.prototype,"respectLayerDefinitionExpression",void 0),t.__decorate([o.property()],e.default.prototype,"respectLayerVisibility",void 0),t.__decorate([o.property()],e.default.prototype,"layerInfos",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"state",null),t.__decorate([o.property()],e.default.prototype,"view",void 0),e.default=t.__decorate([h.subclass("esri.widgets.Legend.LegendViewModel")],e.default),e.default})},"esri/views/2d/layers/features/layerAdapters/featureReductionUtils":function(){define(["exports"],function(e){"use strict";e.getEffectiveFeatureReduction=function(e,t){const s=e.featureReduction;return s&&"selection"!==s.type&&(!("maxScale"in s)||!s.maxScale||s.maxScale<t.scale)?s:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/ActiveLayerInfo":function(){define(["require","exports","../../../chunks/tslib.es6","../../../Color","../../../intl","../../../kernel","../../../request","../../../core/Accessor","../../../core/arrayUtils","../../../core/Collection","../../../core/has","../../../core/jsonMap","../../../core/Logger","../../../core/mathUtils","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/screenUtils","../../../core/sql","../../../core/urlUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../layers/effects/EffectView","../../../layers/effects/jsonUtils","../../../layers/support/displayFilterUtils","../../../layers/support/ExportImageParameters","../../../layers/support/fieldUtils","../../../layers/support/layerUtils","../../../layers/support/rasterFormats/pixelRangeUtils","../../../renderers/support/jsonUtils","../../../renderers/support/rendererConversion","../../../renderers/visualVariables/SizeVariable","../../../renderers/visualVariables/support/SizeVariableLegendOptions","../../../smartMapping/renderers/support/referenceSizeUtils","../../../symbols/SimpleFillSymbol","../../../symbols/SimpleMarkerSymbol","../../../symbols/support/cimSymbolUtils","../../../symbols/support/renderUtils","../../../symbols/support/symbolUtils","../../../symbols/support/utils","./clusterUtils","./colorRampUtils","./heatmapRampUtils","./relationshipRampUtils","./sizeRampUtils","./utils","../../smartMapping/support/utils","../../../intl/messages","../../../intl/substitute"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d,m,y,g,_,b,x,S,v,w,C,M,P,L,I,k,T,E,z,R,A,F,O,V,D,N,U,G,B,$,H,j,q,W){"use strict";const X=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Y=new u.JSONMap({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),Z=new A({size:6,outline:{color:[128,128,128,.5],width:.5}}),J=new R({style:"solid"});function Q(e){return"flow"===e.type}function K(e){return"vector-field"===e.type}function ee(e){return"raster-colormap"===e.type}function te(e){return"raster-stretch"===e.type}function se(e){return"raster-shaded-relief"===e.type}function ie(e){return"esri.renderers.SimpleRenderer"===e.declaredClass}function re(e){return"esri.renderers.ClassBreaksRenderer"===e.declaredClass}function ne(e){return"esri.renderers.UniqueValueRenderer"===e.declaredClass}function oe(e){return"esri.renderers.HeatmapRenderer"===e.declaredClass}function ae(e){return"esri.renderers.PointCloudClassBreaksRenderer"===e.declaredClass}function le(e){return"esri.renderers.PointCloudStretchRenderer"===e.declaredClass}function ce(e){return"esri.renderers.PointCloudUniqueValueRenderer"===e.declaredClass}function he(e){return"esri.renderers.DotDensityRenderer"===e.declaredClass}function ue(e){return"esri.renderers.PieChartRenderer"===e.declaredClass}function pe(e){return"esri.layers.SubtypeGroupLayer"===e.declaredClass}function fe(e){return"esri.layers.MapImageLayer"===e.declaredClass}function de(e){return"esri.layers.TileLayer"===e.declaredClass}function me(e){return"esri.layers.ImageryLayer"===e.declaredClass}function ye(e){return"esri.layers.ImageryTileLayer"===e.declaredClass}function ge(e){return"sublayers"in e}function _e(e){return e&&"symbol"in e}async function be(e,t){const s=await q.fetchMessageBundle("esri/widgets/Legend/t9n/Legend");return"previewTemplateAriaLabel"!==e||t||(e="previewAriaLabel"),W.substitute(s[e],{label:t})}const xe=new A({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let Se={};return t.default=class extends a{constructor(e){super(e),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._webStyleSymbolCache=new Map,this._dotDensityUrlCache=new Map,this._scaleDrivenSizeVariable=null,this._hasClusterSizeVariable=!1,this._layerDefinitionExpression=null,this._layerDefinitionExpressionClause=null,this._layerDisplayFilterId=null,this._layerDisplayFilterClause=null,this.children=new c,this.layerView=null,this.layer=null,this.legendElements=[],this.parent=null,this.hideLayersNotInCurrentView=!1,this.keepCacheOnDestroy=!1,this.respectLayerDefinitionExpression=!1,this.respectLayerVisibility=!0,this.sublayerIds=[],this.title=null,this.view=null}initialize(){const e=()=>this.notifyChange("ready");this.addHandles([m.on(()=>this.children,"change",t=>{const{added:s,removed:i}=t;s.forEach(t=>{const s=`activeLayerInfo-ready-watcher-${t.layer.uid}`;this.addHandles(m.watch(()=>t.ready,e,m.initial),s)}),i.forEach(e=>this.removeHandles(e.layer.uid)),e()})]),this.keepCacheOnDestroy||(Se={})}destroy(){this._webStyleSymbolCache=null,this._dotDensityUrlCache=null,this._scaleDrivenSizeVariable=null,this.keepCacheOnDestroy||(Se=null),this._layerDefinitionExpressionClause=null}get effectList(){const e=this.layer;let t=null;return"effect"in e&&e.effect&&(t=new S.EffectView,t.effect=e.effect,t.endTransition(),t.scale=this.scale),t}get opacity(){const e=this.layer.opacity,t=this.parent?.opacity,s=this.layer.parent,i=s&&"uid"in s?this._getParentLayerOpacity(s):null;return null!=t?t*e:null!=i?i*e:e}get ready(){return null===this.layer||(this.children.length>0?this._isGroupActive():this.legendElements.length>0)}get scale(){return this.view?.scale??0}get isScaleDriven(){const e=this.layer;if(null===e)return!1;if("effect"in e&&e.effect&&Array.isArray(e.effect))return!0;if("featureReduction"in e&&e.featureReduction){if("cluster"===e.featureReduction.type)return!0;if("binning"===e.featureReduction.type&&"renderer"in e.featureReduction&&e.featureReduction.renderer)return this._isRendererScaleDriven(e.featureReduction.renderer)}return"renderer"in e&&e.renderer?!!("displayFilterInfo"in e&&e.displayFilterInfo&&ne(e.renderer))||this._isRendererScaleDriven(e.renderer):this._isLayerScaleDriven(this.layer)}get version(){return this._get("version")+1}async buildLegendElementsForFeatureCollections(e){if(this.hideLayersNotInCurrentView&&!await this._isLayerInCurrentView())return this.legendElements=[],void this.notifyChange("ready");const t=Array.from(e,e=>{if(P.isFeatureLayer(e))return this._getRendererLegendElements(e.renderer,{title:e.title});if(e.featureSet?.features.length){const t=e.layerDefinition,s=t?.drawingInfo,i=s&&I.fromJSON(s.renderer),r=Y.read(t.geometryType);return i?this._getRendererLegendElements(i,{title:e.name,geometryType:r}):(p.getLogger(this).warn("drawingInfo not available!"),null)}return null});try{const e=[],s=await Promise.allSettled(t);for(const t of s)if("fulfilled"===t.status)for(const s of t.value??[])e.push(s);this.legendElements=e,this.notifyChange("ready")}catch(e){p.getLogger(this).warn("error while building legend for layer!",e)}}async buildLegendElementsForRenderer(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getRendererLegendElements(e):[],this.notifyChange("ready")}catch(e){p.getLogger(this).warn("error while building legend for layer!",e)}}async buildLegendElementsForFeatureReduction(e){try{const t=!this.hideLayersNotInCurrentView||await this._isLayerInCurrentView();this.legendElements=t?await this._getLegendElementsForFeatureReduction(e):[],this.notifyChange("ready")}catch(e){p.getLogger(this).warn("error while building legend for layer!",e)}}async buildLegendElementsForTools(){const e=this.layer;if(function(e){return"esri.layers.VoxelLayer"===e.declaredClass}(e))await this._constructLegendElementsForVoxelLayer();else if(function(e){return"esri.layers.WMTSLayer"===e.declaredClass}(e))this._constructLegendElementsForWMTSlayer();else if(function(e){return"esri.layers.WMSLayer"===e.declaredClass}(e))await this._constructLegendElementsForWMSSublayers();else if(function(e){return"esri.layers.BuildingSceneLayer"===e.declaredClass}(e))await this._constructLegendElementsForBuildingSceneLayer();else if(fe(e)||de(e)||pe(e))await this._constructLegendElementsForSublayers();else{this.removeHandles("imageryLayers-watcher");let t="default";if(me(e)){const s=e;t=(s?.rasterFunction?.functionName||"default")+"_"+(e.bandIds?.length?e.bandIds.join(""):"###")}if(ye(e)||"link-chart"===e.type)return;await this._getLegendLayers(`${e.uid}-${t}`).then(async t=>{this.legendElements=[],this.notifyChange("ready");const s=t.map(async t=>{if(me(e)){const t=m.watch(()=>[e.rasterFunction,e.bandIds],()=>d.debounce(async()=>{Se.default=null,e.renderer?await this.buildLegendElementsForRenderer(e.renderer):await this.buildLegendElementsForTools()})());this.addHandles(t,"imageryLayers-watcher")}const s=this._generateSymbolTableElementForLegendLayer(t);s?.infos.length&&(me(e)&&(s.title=e.title),this.legendElements.push(s)),this.notifyChange("ready")});await Promise.allSettled(s)}).catch(e=>{p.getLogger(this).warn("Request to server for legend has failed!",e)})}}async _isLayerInCurrentView(){const e=this.layer,t=this.layerView,s=t&&"createQuery"in t&&"queryFeatureCount"in t;if(!(s||t&&"createQuery"in e&&"queryFeatureCount"in e))return!0;await m.whenOnce(()=>!t.updating);const i=s?"createQuery"in t&&t.createQuery():"createQuery"in e&&e.createQuery();return!i||(i.geometry=this.view.extent,0!==(s?"queryFeatureCount"in t&&await t.queryFeatureCount(i):"queryFeatureCount"in e&&await e.queryFeatureCount(i)))}_getParentLayerOpacity(e){let t=1;const s=e.parent;return s&&"uid"in s&&(t=this._getParentLayerOpacity(s)),e.opacity*t}_isGroupActive(){return this.children.some(e=>e.ready)}_isRendererScaleDriven(e){if("dot-density"===e.type)return!0;const t="valueExpression"in e?e.valueExpression:null;if(X.test(t))return!0;const s="visualVariables"in e?e.visualVariables:null;return!!s?.some(e=>this._isScaleDrivenSizeVariable(e))||this._hasScaleDrivenSymbols(e)}_hasScaleDrivenSymbols(e){switch(e.type){case"simple":return this._isScaleDrivenSymbol(e.symbol);case"class-breaks":return this._isScaleDrivenSymbol(e.defaultSymbol)||e.classBreakInfos.some(e=>this._isScaleDrivenSymbol(e.symbol));case"unique-value":return this._isScaleDrivenSymbol(e.defaultSymbol)||!!e.uniqueValueInfos?.some(e=>this._isScaleDrivenSymbol(e.symbol))}return!1}_isScaleDrivenSymbol(e){if("cim"===e?.type){const{primitiveOverrides:t,minScale:s,maxScale:i}=e.data,r=t?.some(e=>(e.valueExpressionInfo?.expression||"").includes("$view.scale"))??!1;return null!=s||null!=i||r}return!1}_isScaleDrivenSizeVariable(e){if(e&&"size"!==e.type)return!1;const t=e,s=t.minSize,i=t.maxSize;return!("object"!=typeof s||!s||!this._isScaleDrivenSizeVariable(s))||!("object"!=typeof i||!i||!this._isScaleDrivenSizeVariable(i))||X.test(t.valueExpression)}_isLayerScaleDriven(e){if("minScale"in e&&e.minScale>0||"maxScale"in e&&e.maxScale>0)return!0;if("sublayers"in e&&e.sublayers)return e.sublayers.some(e=>this._isLayerScaleDriven(e));const t=e.parent;if(!1===e.loaded&&t&&fe(t)&&"source"in e&&e.source&&"map-layer"===e.source.type)for(const s of t.sourceJSON.layers??[])if(s.id===e.source.mapLayerId&&(s.minScale>0||s.maxScale>0))return!0;return!1}async _constructLegendElementsForVoxelLayer(){this.legendElements=[],this.removeHandles("voxel-style-watcher"),this.removeHandles("voxel-current-variable");const e=this.layer;this.addHandles(m.watch(()=>e.currentVariableId,()=>this._constructLegendElementsForVoxelLayer()),"voxel-current-variable"),this.addHandles(m.watch(()=>e.getVariableStyles(),()=>this._constructLegendElementsForVoxelLayer()),"voxel-style-watcher");const t=e.getVariableStyle(null),s=[];if(t)if(t.uniqueValues?.length){const e=[];t.uniqueValues.forEach(t=>{t.enabled&&e.push({label:t.label||`${t.value}`,value:t.value,symbol:new R({color:t.color,outline:null})})}),e.length&&s.push({type:"symbol-table",title:t.label,infos:e})}else if(t.transferFunction){const{colorStops:e,stretchRange:i}=t.transferFunction,r=e.toArray().reverse(),n=i.map((e,t)=>`${0===t?H.specialCharsLessThan:H.specialCharsGreaterThan} ${j.formatNumberLabel(e)}`).reverse(),o=r.map(e=>({color:e.color,value:null,label:null}));o[0].label=n[0],o[o.length-1].label=n[1],s.push({type:"color-ramp",title:t.label,infos:o,preview:V.renderColorRampPreviewHTML(r.map(e=>e.color),{ariaLabel:await be("previewColorRampAriaLabel")})})}await this._generatePreviewsForLegendElements(s,{opacity:e.opacity}),this.legendElements=s,this.notifyChange("ready")}_constructLegendElementsForWMTSlayer(){this.legendElements=[],this.removeHandles("wmts-activeLayer-watcher");const e=this.layer.activeLayer;this.addHandles(m.watch(()=>{const{layer:e}=this;return e&&"activeLayer"in e&&e.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher");const t=e.styleId?e.styles?.find(({id:t})=>t===e.styleId)?.legendUrl:void 0;t&&(this.legendElements=[{type:"symbol-table",title:e.title,infos:[{src:t,opacity:this.opacity}]}]),this.notifyChange("ready")}async _constructLegendElementsForWMSSublayers(){this.legendElements=[],this.removeHandles("wms-sublayers-watcher");const e=this.layer;let t=null;(e.customParameters||e.customLayerParameters)&&(t={...e.customParameters,...e.customLayerParameters}),this.addHandles(m.watch(()=>{const{layer:e}=this;return e&&"sublayers"in e&&e.sublayers},()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher"),this.legendElements=await this._generateLegendElementsForWMSSublayers(e.sublayers,t),this.notifyChange("ready")}async _generateLegendElementsForWMSSublayers(e,t){const s=this.layer,i=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");const r=this.sublayerIds?.map(e=>s.findSublayerById(e))?.filter(l.isSome)??[],n=r.length?r:e.toArray();for(const e of n){const s=m.watch(()=>[e.title,e.visible,e.legendEnabled],()=>this._constructLegendElementsForWMSSublayers());if(this.addHandles(s,"wms-sublayers-watcher"),!this.respectLayerVisibility||e.visible&&e.legendEnabled){const s=await this._generateSymbolTableElementForWMSSublayer(e,t);s?.infos.length&&i.unshift(s)}}return i}async _generateSymbolTableElementForWMSSublayer(e,t){if(!e.legendUrl&&e.sublayers){const s=(await this._generateLegendElementsForWMSSublayers(e.sublayers,t)).filter(e=>e);return{type:"symbol-table",title:e.title,infos:s}}return this._generateSymbolTableElementForLegendUrl(e,t)}async _generateSymbolTableElementForLegendUrl(e,t){let s=e.legendUrl;if(!s)return;const i={type:"symbol-table",title:e.title||e.name||String(e.id??""),infos:[]};t&&(s=_.addQueryParameters(s,t));let r=null;const n=e.layer?.opacity;try{r=(await o(s,{responseType:"image"})).data,r&&(r.style.opacity=n)}catch{}return i.infos.push({src:s,preview:r,opacity:n}),i}_getLegendLayers(e,t){const s=Se&&Se[e];return s?Promise.resolve(s):this._legendRequest(t).then(t=>{const s=t.layers;return Se[e]=s,s})}_legendRequest(e){const t=this.layer;let s={f:"json",dynamicLayers:e};if(me(t)){const e=t.exportImageServiceParameters.rasterFunction;if(e&&(s.renderingRule=JSON.stringify(e.functionDefinition?.toJSON()||e.toJSON())),t.bandIds&&(s.bandIds=t.bandIds.join()),t.raster||t.viewId||t.customParameters){const{raster:e,viewId:i,customParameters:r}=t;s={raster:e,viewId:i,...s,...r}}}let i=t.url.replace(/(\/)+$/,"");if("version"in t&&+t.version>=10.01){const e=i.indexOf("?");e>-1?i=i.slice(0,e)+"/legend"+i.slice(e):i+="/legend"}else{const e=i.toLowerCase().indexOf("/rest/"),t=-1===e?i:i.slice(0,e)+i.slice(e+5);i="https://utility.arcgis.com/sharing/tools/legend?soapUrl="+encodeURI(t)+"&returnbytes=true"}return o(i,{query:s}).then(e=>e.data)}async _constructLegendElementsForBuildingSceneLayer(){this.legendElements=[],this.removeHandles("sublayers-watcher");const e=this.layer;this.addHandles(m.watch(()=>e.sublayers,()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForBuildingSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(e){p.getLogger(this).warn("Request to server for legend has failed!",e)}}async _generateLegendElementsForBuildingSublayers(e,t){let s=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");const i=e.toArray();for(const e of i){const i=m.watch(()=>["renderer"in e&&e.renderer,e.opacity,e.title,e.visible],()=>this._constructLegendElementsForBuildingSceneLayer());if(this.addHandles(i,"sublayers-watcher"),!this.respectLayerVisibility||e.visible){const i=null!=e?.opacity?e.opacity:null,r=null!=i?i*t:t;if("building-group"===e.type){const t={type:"symbol-table",title:e.title,infos:[]},i=await this._generateLegendElementsForBuildingSublayers(e.sublayers,r);t.infos.push(...i),s=[t,...s]}else e.renderer&&(s=[...await this._getRendererLegendElements(e.renderer,{title:e.title,opacity:r,sublayer:e}),...s])}}return s.filter(e=>!!e&&(!("infos"in e)||!e.infos||e.infos.length>0))}async _constructLegendElementsForSublayers(){this.legendElements=[],this.removeHandles("sublayers-watcher");const e=this.layer;if(fe(e)||de(e)||pe(e)){this.addHandles(m.watch(()=>e.sublayers,()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=await this._generateLegendElementsForSublayers(e.sublayers,this.opacity),this.notifyChange("ready")}catch(e){p.getLogger(this).warn("Request to server for legend has failed!",e)}}}async _generateLegendElementsForSublayers(e,t,s){const i=this.layer;let r=[];this.addHandles(e.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");let n=e.toArray();!s&&this.sublayerIds&&this.sublayerIds.length&&(n=pe(i)?this.sublayerIds.map(e=>i.findSublayerForSubtypeCode(e)).filter(l.isSome):this.sublayerIds.map(e=>i.findSublayerById(e)).filter(l.isSome));for(const e of n){const i=m.watch(()=>[e.renderer,e.opacity,e.title,e.visible,e.legendEnabled],()=>this._constructLegendElementsForSublayers());if(this.addHandles(i,"sublayers-watcher"),!this.respectLayerVisibility||e.visible&&e.legendEnabled&&this._isSublayerInScale(e)){const i=null!=e?.opacity?e.opacity:null,n=null!=i?i*t:t,o=!ge(e)||e.originIdOf("renderer")>2&&!e.sublayers;if(e.renderer&&o)await e.load(),r=[...await this._getRendererLegendElements(e.renderer,{title:e.title,opacity:n,sublayer:e}),...r];else if(ge(e)){const t=await this._generateSymbolTableElementForSublayer(e,n,s);t&&r.unshift(t)}}}return r.filter(e=>!!e&&(!("infos"in e)||!e.infos||e.infos.length>0))}async _generateSymbolTableElementForSublayer(e,t,s){if(!s){s=new Map;const t=this.layer,i=e.source;let r=null;if(i&&("map-layer"!==i.type||i.mapLayerId!==e.id||i.gdbVersion&&i.gdbVersion!==("gdbVersion"in t&&t.gdbVersion))||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("labelsVisible")>2){const e=new C.ExportImageParameters({layer:this.layer});r=e.hasDynamicLayers?e.dynamicLayers:null,e.destroy()}const n=r||`${t.uid}-default`;(await this._getLegendLayers(n,r)).forEach(e=>s.set(e.layerId,e))}const i=s.get(e.id);if((!i||i?.subLayerIds&&i.defaultVisibility)&&e.sublayers){const i=await this._generateLegendElementsForSublayers(e.sublayers,t,s);return{type:"symbol-table",title:e.title,infos:i}}return this._generateSymbolTableElementForLegendLayer(i,e,t)}_generateSymbolTableElementForLegendLayer(e,t,s){if(!e?.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(e,t))return null;const i=t?.renderer;let r=t?.title||e.layerName;if(i&&(!t||t?.originIdOf("renderer")>2)){const e=t?.title||this._getRendererTitle(i,t);e&&(r&&"string"!=typeof e&&"title"in e&&(e.title=r),r=e)}const n={type:"symbol-table",title:r,legendType:e.legendType||null,infos:[]},o=t?this._sanitizeLegendForSublayer(e.legend.slice(),t):e.legend;return e.legendGroups&&e.legendGroups.length>0?e.legendGroups.forEach(t=>{const i={type:"symbol-table",title:t.heading,legendType:e.legendType||null,infos:this._generateSymbolTableElementInfosForLegendLayer(o.filter(e=>e.groupId===t.id),e.layerId,s)};i.infos?.length>0&&n.infos.push(i)}):n.infos=this._generateSymbolTableElementInfosForLegendLayer(o,e.layerId,s),n.infos.length>0?n:null}_generateSymbolTableElementInfosForLegendLayer(e,t,s){return e.map(e=>{let i=e.url;if(e.imageData&&e.imageData.length>0)i=`data:image/png;base64,${e.imageData}`;else{if(i.startsWith("http"))return null;i=n.addTokenParameter(`${this.layer.url}/${t}/images/${i}`)}return{label:e.label,src:i,opacity:s??this.opacity,width:e.width,height:e.height}}).filter(l.isSome)}_isSublayerInScale(e){const t=e.minScale||0,s=e.maxScale||0;return!(t>0&&t<this.scale||s>this.scale)}_isLegendLayerInScale(e,t){const s=t||this.layer;let i=null,r=null,n=!0;return!s.minScale&&0!==s.minScale||!s.maxScale&&0!==s.maxScale?(0===e.minScale&&s.tileInfo&&(i=s.tileInfo.lods[0].scale),0===e.maxScale&&s.tileInfo&&(r=s.tileInfo.lods[s.tileInfo.lods.length-1].scale)):(i=Math.min(s.minScale,e.minScale)||s.minScale||e.minScale,r=Math.max(s.maxScale,e.maxScale)),(i>0&&i<this.scale||r>this.scale)&&(n=!1),n}_sanitizeLegendForSublayer(e,t){if("version"in this.layer&&+this.layer.version<10.1||0===e.length)return e;const s=t.renderer,i=e.some(e=>e.values);let r=0,n=null;return i&&e.some((e,t)=>(e.values||(r=t,n=e,n.label||(n.label="others")),null!=n)),s?"unique-value"===s.type?n&&(e.splice(r,1),e.push(n)):"class-breaks"===s.type&&(n&&e.splice(r,1),s.legendOptions?.order||e.reverse(),n&&e.push(n)):n&&(e.splice(r,1),e.push(n)),e}async _getRendererLegendElements(e,t={}){if(!function(e,t){return ie(e)||re(e)||ne(e)||oe(e)||he(e)||ue(e)?"2d"===t.type||k.isSupportedRenderer3D(e):te(e)||ee(e)||se(e)||ae(e)||le(e)||ce(e)||K(e)||Q(e)}(e,this.view))return p.getLogger(this).warn(`Renderer of type '${e.type}' not supported!`),[];if(function(e){return ae(e)||le(e)||ce(e)||function(e){return"esri.renderers.PointCloudRGBRenderer"===e.declaredClass}(e)}(e))return this._constructPointCloudRendererLegendElements(e,t);if(he(e))return this._constructDotDensityRendererLegendElements(e);const s=await this._loadRenderer(e);return ue(s)?this._constructPieChartRendererLegendElements(s):this._constructRendererLegendElements(s,t)}async _getLegendElementsForFeatureReduction(e){let t=null;return"binning"===e.type?t=e.renderer:"cluster"===e.type&&(t=this._getClusterRenderer(e)),t?this._getRendererLegendElements(t):[]}_getPointCloudRendererTitle(e){return(e.legendOptions?.title||e.field)??""}async _constructPointCloudRendererLegendElements(e,t={}){const s=t.title,i=[];let r=null,n=null;if(ae(e))r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorClassBreakInfos.forEach(e=>{r.infos.unshift({label:e.label||e.minValue+" - "+e.maxValue,value:[e.minValue,e.maxValue],symbol:this._getAppliedCloneSymbol(Z,e.color)})});else if(le(e)){const t=e.stops;let i=null;if(t?.length&&(1===t.length&&(i=t[0].color),!i)){const e=t[0].value,s=t[t.length-1].value;if(null!=e&&null!=s){const r=e+(s-e)/2;i=U.getColorFromPointCloudStops(r,t)}}r={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Z,i||Z.color)}]};const o=U.getRampStopsForPointCloud(e.stops??[])??[];n={type:"color-ramp",title:s||this._getPointCloudRendererTitle(e),infos:o,preview:V.renderColorRampPreviewHTML(o.map(e=>e.color),{ariaLabel:await be("previewColorRampAriaLabel")})}}else ce(e)&&(r={type:"symbol-table",title:s||this._getPointCloudRendererTitle(e),infos:[]},e.colorUniqueValueInfos?.forEach(e=>{r.infos.push({label:e.label||e.values.join(", "),value:e.values.join(", "),symbol:this._getAppliedCloneSymbol(Z,e.color)})}));return r?.infos.length&&i.push(r),n?.infos.length&&i.push(n),await this._generatePreviewsForLegendElements(i,{opacity:this.opacity,symbolConfig:{applyColorModulation:!!e.colorModulation}}),i}async _getElementInfoForDotDensity(e,t){const{color:s,label:i,valueExpressionTitle:r}=t,{backgroundColor:n,outline:o,dotSize:a}=e,l=this.effectList,c=l?.effects.map(e=>e.toJSON()),h=v.effectFunctionsFromJSON(c),u=await be("previewTemplateAriaLabel",i||r),p=a+"-"+s+"-"+n+"-"+(o&&JSON.stringify(o.toJSON()))+"-"+h,f=this._dotDensityUrlCache,d=f.has(p)?f.get(p):V.renderDotDensityPreviewHTML(e,s,{ariaLabel:u});f.set(p,d);const m={shape:{type:"image",x:0,y:0,width:d.width,height:d.height,src:d.src},fill:null,stroke:null,offset:[0,0]},y=O.renderSymbol([[m]],[d.width,d.height],{effectView:this.effectList,ariaLabel:u});return{opacity:1,src:d.src,preview:y,width:d.width,height:d.height}}async _constructDotDensityRendererLegendElements(e){const t=e.calculateDotValue(this.view.scale),s=e.legendOptions?.unit,i={type:"symbol-table",title:{value:t&&Math.round(t),unit:s||""},infos:[]};for(const t of e.attributes){const s=await this._getElementInfoForDotDensity(e,t);s.label=t.label||t.valueExpressionTitle||t.field,i.infos.push(s)}return[i]}async _constructPieChartRendererLegendElements(e){const t=[];let s=null;const i=e.outline;e.attributes.forEach(e=>{const s=new A({color:e.color,outline:i}),r=e.label||e.valueExpressionTitle||e.field;t.push({label:r,symbol:s})});const r=t.length?[...t]:[];if(e.othersCategory?.color&&0!==e.othersCategory?.threshold){const r=new A({color:e.othersCategory.color,outline:i});s=e.othersCategory.label||"Other",t.push({label:s,symbol:r})}if(e.defaultColor?.a){const s=new A({color:e.defaultColor,outline:i});t.push({label:e.defaultLabel,symbol:s})}const n=await this._getVisualVariableLegendElements(e,this.layer)||[];if(t.length){n.unshift({type:"symbol-table",title:null,infos:t});const o=r.filter(e=>e.label!==s).map(e=>e.symbol.color).filter(Boolean),a=V.renderPieChartPreviewHTML(o,{holePercentage:e.holePercentage,backgroundColor:e.backgroundFillSymbol?.color,effectList:this.effectList,outline:i,ariaLabel:await be("previewPieChartAriaLabel")});n.unshift({type:"pie-chart-ramp",title:this._getRendererTitle(e,this.layer),infos:t,preview:a})}return await this._generatePreviewsForLegendElements(n,{opacity:this.layer.opacity,effectView:this.effectList}),n}async _getWhereClause(e,t,s){const i=await g.parseWhereClause(e,s),r=new Set,{field:n,field2:o,field3:a}=t;M.collectFields(r,s,[n,o,a]),await M.collectArcadeFieldNames(r,s,t.valueExpression);const l=new Set(Array.from(r,e=>e.toLowerCase())),c=i?.fieldNames.map(e=>e.toLowerCase());return c?.some(e=>!l.has(e))?null:i}async _processDefinitionExpression(e,t){if(!("definitionExpression"in e))return;const s=e.definitionExpression;s&&this.respectLayerDefinitionExpression?this._layerDefinitionExpression!==s&&(this._layerDefinitionExpressionClause=await this._getWhereClause(s,t,e.fieldsIndex)):this._layerDefinitionExpressionClause=null,this._layerDefinitionExpression=s}async _processDisplayFilter(e,t){if(!("displayFilterInfo"in e))return;const s=e.displayFilterInfo?w.getEffectiveDisplayFilter(e.displayFilterInfo,this.view):null;return s?.where?this._layerDisplayFilterId!==s?.id&&(this._layerDisplayFilterClause=await this._getWhereClause(s.where,t,e.fieldsIndex)):this._layerDisplayFilterClause=null,this._layerDisplayFilterId=s?.id,s}async _constructRendererLegendElements(e,t={}){const{title:s,sublayer:i}=t,r=i||this.layer,n=H.getAuthoringInfoVisualVariableByTheme(e,"reference-size"),o=H.getAuthoringInfoVisualVariableByTheme(e,"spike");let a=null;ne(e)&&(await this._processDefinitionExpression(r,e),a=await this._processDisplayFilter(r,e)),this._hasColorRamp=!1,this._hasOpacityRamp=!1,this._hasSizeRamp=!1,this._scaleDrivenSizeVariable=null;const l=await this._getVisualVariableLegendElements(e,r)||[],c={type:"symbol-table",title:s||this._getRendererTitle(e,r),infos:[]};let h=null,u=!1;const p=new Set;if(Q(e)&&!this._hasSizeRamp){const t=await H.getSymbolForFlowRenderer(e);c.infos.push({label:null,symbol:t})}else if(function(e){const t="authoringInfo"in e?e?.authoringInfo:null;return"univariate-color-size"===t?.type}(e)){let t=s;const i=function(e){const t="authoringInfo"in e?e?.authoringInfo:null;return"univariate-color-size"===t?.type&&"above-and-below"===t?.univariateTheme}(e)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",r=l.findIndex(e=>"color-ramp"===e.type),n=-1!==r?l.splice(r,1)[0]:null,o=l.findIndex(e=>"size-ramp"===e.type),a=-1!==o?l.splice(o,1)[0]:null,c=[];n&&(t=n.title,c.push(n)),a&&(t=a.title,c.push(a)),c.length>0&&l.push({type:i,title:t,infos:c})}else if(oe(e)){const t=G.getHeatmapRampStops(e);l.push({type:"heatmap-ramp",title:s||this._getRendererTitle(e,r),infos:t,preview:V.renderColorRampPreviewHTML(t.map(e=>e.color),{effectList:this.effectList,ariaLabel:await be("previewColorRampAriaLabel")})})}else if(ne(e)){const t=e.authoringInfo;if(t&&"relationship"===t.type){const{numClasses:s,field1:i,field2:n}=t,o=t.focus;if(s&&i&&n){const t=[i,n];let a=B.getRotationAngleForFocus(o)||0;for(const e of t){const{field:t,normalizationField:s,label:i}=e,n=i||{field:this._getFieldAlias(t,r),normField:s&&this._getFieldAlias(s,r)},o=xe.clone();o.angle=a,c.infos.push({label:n,symbol:o}),p.add(o),a+=90}const h=B.getRelationshipRampElement({focus:o,numClasses:s,infos:e.uniqueValueInfos??[]});l.unshift(h)}}else if(me(this.layer)||ye(this.layer))e.uniqueValueInfos?.forEach(t=>{t.symbol&&this._checkClausesForUVR(e,t.value)&&c.infos.push({label:t.label||t.value,value:t.value,symbol:t.symbol})});else{const{field:t,field2:i,field3:o,fieldDelimiter:l,valueExpression:h,defaultSymbol:p}=e,f=!(!t&&!h||!i&&!o),d=this._layerDisplayFilterClause?a?.title:null,m=[];if(e.uniqueValueGroups?.forEach(s=>{const a={type:"symbol-table",title:d||s.heading,infos:[]};s.classes?.forEach(s=>{const{symbol:c,values:u}=s;if(c){const p=[],d=[];for(const e of u??[]){const{value:s,value2:n,value3:a}=e,c=[],u=[];(t||h)&&(c.push(s),u.push(this._getDomainName(t,s,r))),i&&(c.push(n),u.push(this._getDomainName(i,n,r))),o&&(c.push(a),u.push(this._getDomainName(o,a,r))),p.push(f?c.join(l||""):c[0]),d.push(u.join(" - "))}const m=p.join(", ");let y=s.label;if(!y){const e=d.filter(Boolean);y=e.length?e.join(", "):m}const g=c.clone();"cim"===g.type&&n&&z.updateReferenceSizeSymbol(g,{innerDotSize:8,outerRingSize:16}),p.some(t=>this._checkClausesForUVR(e,t))&&a.infos.push({label:y,value:m,symbol:g})}}),a.infos.length&&m.push(a)}),m.length){const t=m[0];if(1===m.length&&"title"in t&&!t.title){const e=t.infos?.filter(_e)??[];c.infos.push(...e)}else p&&(m.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:p}]}),u=!0),c.infos.push(...m);s||e.legendOptions?.title||e.valueExpressionTitle||(c.title=null)}}e.defaultSymbol&&!u&&(c.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),u=!0)}else if(re(e)){if(!n&&!o){if(h=this._isUnclassedRenderer(e),!h||!this._hasSizeRamp){const t=e.classBreakInfos.filter(({symbol:e})=>e),s="ascending-values"===e.legendOptions?.order;for(const{label:e,minValue:i,maxValue:r,symbol:n}of t){const t={label:e||(h?null:`${i} - ${r}`),value:[i,r],symbol:n};s?c.infos.push(t):c.infos.unshift(t)}h&&(c.title=null),this._updateInfosForClassedSizeRenderer(e,c.infos)}e.defaultSymbol&&!h&&(c.infos.push({label:e.defaultLabel||"others",symbol:e.defaultSymbol}),u=!0)}}else if(te(e))if(ye(this.layer)||function(e){return"esri.layers.WCSLayer"===e.declaredClass}(this.layer)){const t=await this._constructTileImageryStretchRendererElements(e);"stretch-ramp"===t.type?l.push(t):c.infos=t}else{const t=this.layer;let s,i;e.customStatistics?.length&&({min:s,max:i}=e.customStatistics[0]);let r=[],n=t.serviceRasterInfo;if(t.rasterFunction)try{n=await t.generateRasterInfo(t.rasterFunction)}catch{}const o=L.getPixelValueRange(n.pixelType);if(1===n.bandCount){const r=t.bandIds?.[0]||0;s=null!=s?s:n.statistics?n.statistics[r].min:o[0],i=null!=i?i:n.statistics?n.statistics[r].max:o[1],s||i?l.push(await this._getStretchLegendElements(e,{min:s,max:i})):this._getServerSideLegend()}else if(t.bandIds&&1===t.bandIds.length)s=null!=s?s:n.statistics?n.statistics[t.bandIds[0]].min:o[0],i=null!=i?i:n.statistics?n.statistics[t.bandIds[0]].max:o[1],s||i?l.push(await this._getStretchLegendElements(e,{min:s,max:i})):this._getServerSideLegend();else if(n.bandCount>=3){const{bandInfos:e}=n,{bandIds:s}=t;e.length>=n.bandCount?3===s?.length?(r=s.map(t=>e[t].name),c.infos=this._createSymbolTableElementMultiBand(r)):"lerc"===t.format?(r=[0,1,2].map(t=>e[t].name),c.infos=this._createSymbolTableElementMultiBand(r)):this._getServerSideLegend():"lerc"===t.format?(r=["band1","band2","band3"],c.infos=this._createSymbolTableElementMultiBand(r)):this._getServerSideLegend()}else this._getServerSideLegend()}else if(ee(e))e.colormapInfos.forEach(e=>{c.infos.push({label:e.label,value:e.value,symbol:this._getAppliedCloneSymbol(J,e.color)})});else if(ie(e)){let s=e.symbol;switch(t.geometryType){case"point":s="pointSymbol"in r?r.pointSymbol:null;break;case"polyline":s="lineSymbol"in r?r.lineSymbol:null;break;case"polygon":s="polygonSymbol"in r?r.polygonSymbol:null}const i=this._hasClusterSizeVariable&&this._getClusterSymbol()||!this._hasSizeRamp;e.symbol&&i&&c.infos.push({label:e.label,symbol:s})}else if(K(e)){e.outputUnit&&(this.title="("+e.toJSON().outputUnit+")"),c.title=e.attributeField;const t=e.getClassBreakInfos();t?.length?t.forEach(e=>{c.infos.push({label:e.minValue+" - "+e.maxValue,symbol:e.symbol})}):c.infos.push({label:e.attributeField,symbol:e.getDefaultSymbol()})}else se(e)&&l.push(await this._getStretchLegendElements(e,{min:0,max:255}));const f=e.defaultSymbol;!f||u||ie(e)||h&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||l.push({type:"symbol-table",infos:[{label:e.defaultLabel||"others",symbol:f}]}),c.infos.length&&l.unshift(c);const d=null==t.opacity?this.opacity:t.opacity,m=this._isTallSymbol("visualVariables"in e?e.visualVariables:null),y=me(this.layer)||ye(this.layer);return await this._generatePreviewsForLegendElements(l,{opacity:d,symbolConfig:{isTall:m,isSquareFill:y},effectView:this.effectList},{defaultSymbol:f,arrowMarkerSymbols:p}),e=null,l}_checkClausesForUVR(e,t){const s=function(e,t){const{field:s,field2:i,field3:r,fieldDelimiter:n,valueExpression:o}=e;if(!s)return null;const a=(s||o)&&(i||r)?t?.toString().split(n||""):[t],l=s?{[s]:a?.[0]}:null;return l&&(i&&(l[i]=a?.[1]),r&&(l[r]=a?.[2])),l}(e,t);return!s||(!this._layerDefinitionExpressionClause||this._layerDefinitionExpressionClause.testFeature(s))&&(!this._layerDisplayFilterClause||this._layerDisplayFilterClause.testFeature(s))}_getServerSideLegend(){setTimeout(()=>this.buildLegendElementsForTools(),0)}_getAllInfos(e){const t=e?.infos;return t?t.reduce((e,t)=>e.concat(this._getAllInfos(t)),[]):[e]}async _constructTileImageryStretchRendererElements(e){const t=this.layer,s=t.symbolizer.rasterInfo??t.raster.rasterInfo;let i,r;const n=e?.customStatistics?.length?e.customStatistics:s?.statistics;if(n)({min:i,max:r}=n[0]);else{const e=L.getPixelValueRange(s.pixelType);i=e[0],r=e[1]}if(t.hasStandardTime()&&(i=t.getStandardTimeValue(i),r=t.getStandardTimeValue(r)),1===s.bandCount||1===t.bandIds?.length)return this._getStretchLegendElements(e,{min:i,max:r});const o=(t?.bandIds?.length?t.bandIds:Array.from(Array(Math.min(s.bandCount,3)).keys())).map(e=>s.bandInfos[e].name);return o.length<3?o.push(o[1]):o.length>3&&o.splice(3),this._createSymbolTableElementMultiBand(o)}async _getStretchLegendElements(e,t){const s=e.colorRamp,i=U.getStretchRampStops(s,t);return{type:"stretch-ramp",title:"",infos:i,preview:V.renderColorRampPreviewHTML(i.map(e=>e.color),{ariaLabel:await be("previewColorRampAriaLabel")})}}_getClusterSymbol(){const e=this.layer,t="featureReduction"in e&&e.featureReduction,s=t&&"symbol"in t&&t.renderer;return s&&!0!==s?.authoringInfo?.isAutoGenerated?null:t&&"symbol"in t?t.symbol:null}async _getSizeLegendElement(e,t,s,i){return{type:"size-ramp",title:this._hasClusterSizeVariable?this._getClusterTitle(t):e,infos:await $.getRampStops(s,t,await H.getMedianColor(s),this.scale,this.view,i,this._hasClusterSizeVariable?this._getClusterSymbol():null)}}_createSymbolTableElementMultiBand(e){const t=[],s=["red","green","blue"];return e.forEach((e,i)=>{t.push({label:{colorName:s[i],bandName:e},src:H.rgbImgSource[i],opacity:this.opacity??1})}),t}_updateInfosForClassedSizeRenderer(e,t){const s=e.authoringInfo&&"class-breaks-size"===e.authoringInfo.type,i=e.classBreakInfos.some(e=>D.isVolumetricSymbol(e.symbol));if(s&&i){const s=$.realWorldMaxSize,i=$.realWorldMinSize,r=e.classBreakInfos.length,n=(s-i)/(r>1?r-1:r);t.forEach((e,t)=>{e.size=s-n*t})}}_isTallSymbol(e){let t=!1,s=!1;if(e)for(let i=0;i<e.length&&(!t||!s);i++){const r=e[i];"size"===r.type&&("height"===r.axis&&(t=!0),"width-and-depth"===r.axis&&(s=!0))}return t&&s}async _generatePreviewsForLegendElements(e,t,s){const i=[];for(const r of e)for(const e of r.infos??[])if("infos"in e&&e.infos&&i.push(this._generatePreviewsForLegendElements([e],t,s)),_e(e)&&e.symbol&&!e.preview){let n=!0;if("cim"===e.symbol.type){const{minScale:t,maxScale:s}=e.symbol.data;(t&&t<this.scale||s&&s>this.scale)&&(n=!1)}n&&i.push(this._generateSymbolPreviewForInfo(e,{...t,clipBloomEffect:"theme"in r&&"spike"===r.theme,effectView:s?.arrowMarkerSymbols?.has(e.symbol)?null:t.effectView},s?{isDefault:e.symbol===s.defaultSymbol,applyScaleDrivenSize:!s.arrowMarkerSymbols?.has(e.symbol)}:void 0))}await Promise.all(i)}async _generateSymbolPreviewForInfo(t,s,i){try{let r=!i?.isDefault&&null==t.size&&this._hasSizeRamp?y.px2pt(22):t.size;if(this._scaleDrivenSizeVariable&&i?.applyScaleDrivenSize){const{getSize:s}=await new Promise((t,s)=>e(["../../../renderers/visualVariables/support/visualVariableUtils"],t,s));r=s(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===t.symbol.type?t.symbol.style:null})}const n="cim"===t.symbol.type?{style:"legend",cimOptions:{allowScalingUp:!i?.isDefault&&this._hasSizeRamp||!(!this._scaleDrivenSizeVariable||!i?.applyScaleDrivenSize),viewParams:this.isScaleDriven?{viewingMode:"2d"===this.view?.type?"map":this.view?.viewingMode,scale:this.view?.scale}:null}}:{},o=t.label&&"string"!=typeof t.label?null:await be("previewTemplateAriaLabel",t.label);t.preview=await V.renderPreviewHTML(t.symbol,{size:r,scale:!1,ariaLabel:o,...s,...n})}catch{t.preview=null,p.getLogger(this).warn(`Generating symbol preview failed for symbol type: ${t.symbol?.type}`)}}_getClusterRenderer(e){this._hasClusterSizeVariable=!1;const t="renderer"in this.layer?this.layer.renderer:null,s=e.renderer?.clone()||t?.clone(),i=N.getEffectiveClusterSizeVariable(e,this.layerView,this.view);if(i&&null!=s&&"visualVariables"in s){const t=s.visualVariables?.some(e=>"size"===e.type&&"outline"!==e.target&&!X.test(e.valueExpression));if(!t){if("clusterMinSize"in e&&"clusterMaxSize"in e){const{clusterMinSize:t,clusterMaxSize:s}=e;i.legendOptions=new E({showLegend:t!==s})}const t=s.visualVariables||[];s.visualVariables=t.concat([i]),this._hasClusterSizeVariable=!0}}return s}async _loadRenderer(e){const t=[],s=e.clone(),i=await H.getMedianColor(s);if(re(s)||ne(s)){const e=(s.classBreakInfos||s.uniqueValueInfos).map(e=>this._fetchSymbol(e.symbol,i).then(t=>{e.symbol=t}).catch(()=>{e.symbol=null}));Array.prototype.push.apply(t,e)}return t.push(this._fetchSymbol(s.symbol||s.defaultSymbol,s.defaultSymbol?null:i).then(e=>{this._applySymbolToRenderer(s,e,ie(s))}).catch(()=>{this._applySymbolToRenderer(s,null,ie(s))})),await Promise.allSettled(t),s}_applySymbolToRenderer(e,t,s){s?e.symbol=t:e.defaultSymbol=t}async _fetchSymbol(e,t){if(!e)throw new Error;if("web-style"===e.type){const s=this._webStyleSymbolCache;try{const i=await e.fetchSymbol({cache:s});return this._getAppliedCloneSymbol(i,t)}catch{throw p.getLogger(this).warn("Fetching web-style failed!"),new Error}}return this._getAppliedCloneSymbol(e,t)}_getAppliedCloneSymbol(e,t){if(!e||!t)return e;const s=e.clone(),r=t&&t.toRgba();return s.type.includes("3d")?this._applyColorTo3dSymbol(s,r):"cim"===s.type?F.applyCIMSymbolColor(s,t):s.color&&(s.color=new i(r||s.color)),s}_applyColorTo3dSymbol(e,t){t&&e.symbolLayers.forEach(e=>{e&&(e.material||(e.material={}),e.material.color=new i(t))})}async _getVisualVariableLegendElements(e,t){if(!("visualVariables"in e)||"vector-field"===e.type)return null;const s=e.visualVariables??[],i=[],r=[],n=[],o=H.getAuthoringInfoVisualVariableByTheme(e,"reference-size")??H.getAuthoringInfoVisualVariableByTheme(e,"spike");let a;if(2===o?.sizeStops?.length&&(re(e)||ne(e))){const[e,t]=o.sizeStops;a=new T({field:o.field??void 0,normalizationField:o.normalizationField,minSize:f.clamp(e.size,10,100),maxSize:f.clamp(t.size,50,150),minDataValue:e.value,maxDataValue:t.value}),r.push(a)}for(const e of s)"color"===e.type?i.push(e):"size"===e.type?r.push(e):"opacity"===e.type&&n.push(e);const c=[...i,...r,...n];let h,u;if(0===i.length&&re(e)&&e.classBreakInfos&&1===e.classBreakInfos.length){const t=e.classBreakInfos[0];h=t&&t.symbol}if(0===i.length&&ie(e)&&(h=e.symbol),h)if(h.type.includes("3d")){const e=h.symbolLayers.at(0);"water"===e.type?null!=e.color&&(u=e.color):null!=e.material?.color&&(u=e.material.color)}else h.url||(u=h.color);const p=this.effectList;return(await Promise.all(c.map(async s=>{if(!s.legendOptions||!1!==s.legendOptions.showLegend){const i=Q(e)?s.field:this._getRampTitle(s,t);let r=null;const n=H.getDateFormatOptions(t,s,this.view.timeZone);if("color"===s.type){const e=await U.getRampStops(s,null,n)??[];r={type:"color-ramp",title:i,infos:e,preview:V.renderColorRampPreviewHTML(e.map(e=>e.color),{effectList:p,ariaLabel:await be("previewColorRampAriaLabel")})},this._hasColorRamp||(this._hasColorRamp=e.length>0)}else if("size"===s.type&&"outline"!==s.target)X.test(s.valueExpression)?this._hasClusterSizeVariable||(this._scaleDrivenSizeVariable=s):(r=await this._getSizeLegendElement(i,s,e,n),a===s&&"spike"===o?.theme&&(r.theme=o.theme),this._hasSizeRamp||(this._hasSizeRamp=!(null==r.infos||!r.infos.length)));else if("opacity"===s.type){const e=await U.getRampStops(s,u,n)??[];r={type:"opacity-ramp",title:i,infos:e,preview:V.renderColorRampPreviewHTML(e.map(e=>e.color),{effectList:p,ariaLabel:await be("previewColorRampAriaLabel")})},this._hasOpacityRamp||(this._hasOpacityRamp=e.length>0)}return r?.infos?r:null}}))).filter(l.isSome)}_getDomainName(e,t,s){if(e&&"function"!=typeof e){const i="getField"in s&&s.getField?.(e),r=i&&"getFieldDomain"in s&&s.getFieldDomain?s.getFieldDomain(i.name,{excludeImpliedDomains:h("esri-widget-legacy-field-domain-calculation")}):null;return"coded-value"===r?.type?r.getName(t):null}return null}_getClusterTitle(e){const t=this.layer,s=e.field;if("featureReduction"in t&&t.featureReduction&&"cluster"===t.featureReduction.type){const e=t.featureReduction,i="popupTemplate"in e&&e.popupTemplate,r=i&&i.fieldInfos;if(r)for(const e of r)if(e.fieldName===s)return"cluster_count"===s?e.label||{showCount:!0}:e.label}return{showCount:!0}}_getRampTitle(e,t){let s=e.field,i=e.normalizationField,r=!1,n=!1,o=!1,a=null;s="function"==typeof s?null:s,i="function"==typeof i?null:i;const l=e.legendOptions?.title;if(null!=l)a=l;else if(e.valueExpressionTitle)a=e.valueExpressionTitle;else{if("renderer"in t&&t.renderer&&"authoringInfo"in t.renderer&&t.renderer.authoringInfo?.visualVariables){const e=t.renderer.authoringInfo.visualVariables;for(let t=0;t<e.length;t++){const s=e[t];if("color"===s.type){if("ratio"===s.style){r=!0;break}if("percent"===s.style){n=!0;break}if("percent-of-total"===s.style){o=!0;break}}}}a={field:s&&this._getFieldAlias(s,t),normField:i&&this._getFieldAlias(i,t),ratio:r,ratioPercent:n,ratioPercentTotal:o}}return a}_getRendererTitle(e,t){const s=e;if(s.legendOptions?.title)return s.legendOptions.title;if(s.valueExpressionTitle)return s.valueExpressionTitle;let i=s.field,r=null,n=null;if(re(s)&&(r=s.normalizationField,n="percent-of-total"===s.normalizationType),i="function"==typeof i?null:i,r="function"==typeof r?null:r,ne(s)){const{field2:e,field3:r,fieldDelimiter:n}=s;let o=i&&this._getFieldAlias(i,t);return e&&(o=`<${o}>${n}<${this._getFieldAlias(e,t)}>`,r&&(o=`${o}${n}<${this._getFieldAlias(r,t)}>`)),o}let o=null;return(i||r)&&(o={field:i&&this._getFieldAlias(i,t),normField:r&&this._getFieldAlias(r,t),normByPct:n}),o}_getFieldAlias(e,t){const s="popupTemplate"in t?t.popupTemplate:null,i=s?.fieldInfos;let r=i?.find(t=>e===t.fieldName),n=null;"getField"in t&&t.getField?n=t.getField(e):"fieldsIndex"in t&&t.fieldsIndex&&(n=t.fieldsIndex.get(e));let o=null;const a="featureReduction"in t&&t.featureReduction;a&&(r??="popupTemplate"in a?a.popupTemplate?.fieldInfos?.find(t=>e?.toLowerCase()===t.fieldName?.toLowerCase()):void 0,"fields"in a&&a.fields&&(o=a.fields.find(t=>t.name?.toLowerCase()===e?.toLowerCase())));const l=r||n||o;let c=null;return l&&(c=r?.label||n?.alias||o?.alias||"name"in l&&l.name||"fieldName"in l&&l.fieldName||null),c}_isUnclassedRenderer(e){const t=e.visualVariables;let s=!1;return re(e)&&e.classBreakInfos&&1===e.classBreakInfos.length&&t&&(s=e.field?t.some(t=>!(!t||e.field!==t.field||(e.normalizationField||t.normalizationField)&&e.normalizationField!==t.normalizationField)):!!t.length),s}},s.__decorate([b.property()],t.default.prototype,"children",void 0),s.__decorate([b.property({readOnly:!0})],t.default.prototype,"effectList",null),s.__decorate([b.property()],t.default.prototype,"layerView",void 0),s.__decorate([b.property()],t.default.prototype,"layer",void 0),s.__decorate([b.property()],t.default.prototype,"legendElements",void 0),s.__decorate([b.property({readOnly:!0})],t.default.prototype,"opacity",null),s.__decorate([b.property()],t.default.prototype,"parent",void 0),s.__decorate([b.property({readOnly:!0,dependsOn:[]})],t.default.prototype,"ready",null),s.__decorate([b.property()],t.default.prototype,"hideLayersNotInCurrentView",void 0),s.__decorate([b.property()],t.default.prototype,"keepCacheOnDestroy",void 0),s.__decorate([b.property()],t.default.prototype,"respectLayerDefinitionExpression",void 0),s.__decorate([b.property()],t.default.prototype,"respectLayerVisibility",void 0),s.__decorate([b.property({readOnly:!0})],t.default.prototype,"scale",null),s.__decorate([b.property()],t.default.prototype,"sublayerIds",void 0),s.__decorate([b.property({readOnly:!0})],t.default.prototype,"isScaleDriven",null),s.__decorate([b.property()],t.default.prototype,"title",void 0),s.__decorate([b.property({readOnly:!0,dependsOn:["ready"],value:0})],t.default.prototype,"version",null),s.__decorate([b.property()],t.default.prototype,"view",void 0),t.default=s.__decorate([x.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],t.default),t.default})},"esri/layers/effects/EffectView":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/has","../../core/lang","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","./parser","./utils"],function(e,t,s,i,r,n,o,a,l,c){"use strict";function h(e){const t=l.parse(e)||[];return function(e){const t=e[0];return!!t&&"type"in t}(t)?[{scale:-1,effects:t}]:t}function u(e,t,s){return!e[0]?.effects||!t[0]?.effects||!((-1===e[0]?.scale||-1===t[0]?.scale)&&(e.length>1||t.length>1)&&s<=0)&&c.canInterpolateEffects(e[0].effects,t[0].effects)}function p(e,t,s){const i=e.length>t.length?e:t,r=e.length>t.length?t:e,n=r[r.length-1],o=n?.scale??s,a=n?.effects??[];for(let e=r.length;e<i.length;e++)r.push({scale:o,effects:[...a]});for(let e=0;e<i.length;e++)r[e].scale=-1===r[e].scale?s:r[e].scale,i[e].scale=-1===i[e].scale?s:i[e].scale,c.normalizeEffects(r[e].effects,i[e].effects)}function f(e,t,s){return e+(t-e)*s}e.EffectView=class extends s{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=i("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(h(e))}catch(t){this._transitionTo([]),n.getLogger(this).warn("Invalid Effect",{effect:e,error:t})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return null!==this._to}canTransitionTo(e){try{return this.scale>0&&u(this._current,h(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&u(this._current,e,this.scale)?(this._final=e,this._to=r.clone(e),p(this._current,this._to,this.scale),this._from=r.clone(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?r.clone(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let e=0;e<this._current.length;e++){const s=this._current[e],i=this._from[e],r=this._to[e];s.scale=f(i.scale,r.scale,t);for(let e=0;e<s.effects.length;e++){const n=s.effects[e],o=i.effects[e],a=r.effects[e];n.interpolate(o,a,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?r.clone(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),0===this._current.length)return;const t=this._current,s=this._current.length-1;let i,r,n=1;if(1===t.length||e>=t[0].scale)r=i=t[0].effects;else if(e<=t[s].scale)r=i=t[s].effects;else for(let o=0;o<s;o++){const s=t[o],a=t[o+1];if(s.scale>=e&&a.scale<=e){n=(e-s.scale)/(a.scale-s.scale),i=s.effects,r=a.effects;break}}for(let e=0;e<this.effects.length;e++)this.effects[e].interpolate(i[e],r[e],n)}},t.__decorate([o.property()],e.EffectView.prototype,"_to",void 0),t.__decorate([o.property()],e.EffectView.prototype,"duration",void 0),t.__decorate([o.property({value:""})],e.EffectView.prototype,"effect",null),t.__decorate([o.property({readOnly:!0})],e.EffectView.prototype,"effects",void 0),t.__decorate([o.property({readOnly:!0})],e.EffectView.prototype,"final",null),t.__decorate([o.property({readOnly:!0})],e.EffectView.prototype,"hasEffects",null),t.__decorate([o.property({value:0})],e.EffectView.prototype,"scale",null),t.__decorate([o.property({readOnly:!0})],e.EffectView.prototype,"transitioning",null),e.EffectView=t.__decorate([a.subclass("esri.layers.effects.EffectView")],e.EffectView),e.canInterpolateEffectStops=u,e.convertEffectToStops=h,e.normalizeEffectStops=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ExportImageParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/sql","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/support/scaleUtils","./floorFilterUtils","./sublayerUtils"],function(e,t,s,i,r,n,o,a,l,c,h,u){"use strict";const p={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};e.ExportImageParameters=class extends s{constructor(e){super(e),this.floors=null,this.scale=0}destroy(){this.layer=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map(e=>{const t=h.getLayerFloorFilterClause(this.floors,e);return e.toExportImageJSON(t)});return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&u.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}set layer(e){this._get("layer")!==e&&(this._set("layer",e),this.removeHandles("layer"),e&&this.addHandles([e.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),e.on("sublayer-update",e=>this.notifyChange(p[e.propertyName]))],"layer"))}get layers(){const e=this.visibleSublayers;return e?e.length?"show:"+e.map(e=>e.id).join(","):"show:-1":null}get layerDefs(){const e=!!this.floors?.length,t=this.visibleSublayers.filter(t=>null!=t.definitionExpression||e&&null!=t.floorInfo);return t.length?JSON.stringify(t.reduce((e,t)=>{const s=h.getLayerFloorFilterClause(this.floors,t),r=i.sqlAnd(s,t.definitionExpression);return null!=r&&(e[t.id]=r),e},{})):null}get version(){this.commitProperty("layers"),this.commitProperty("layerDefs"),this.commitProperty("dynamicLayers");const e=this.layer;return e&&(e.commitProperty("dpi"),e.commitProperty("imageFormat"),e.commitProperty("imageTransparency"),e.commitProperty("gdbVersion")),(this._get("version")||0)+1}get visibleSublayers(){const e=[];if(!this.layer)return e;const t=this.layer.sublayers,s=this.scale,i=t=>{t.visible&&(0===s||c.isInScaleRange(s,t.minScale,t.maxScale))&&(t.sublayers?t.sublayers.forEach(i):e.unshift(t))};t&&t.forEach(i);const r=this._get("visibleSublayers");return!r||r.length!==e.length||r.some((t,s)=>e[s]!==t)?e:r}toJSON(){const e=this.layer;let t={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?t.dynamicLayers=this.dynamicLayers:t={...t,layers:this.layers,layerDefs:this.layerDefs},t}},t.__decorate([r.property({readOnly:!0})],e.ExportImageParameters.prototype,"dynamicLayers",null),t.__decorate([r.property()],e.ExportImageParameters.prototype,"floors",void 0),t.__decorate([r.property({readOnly:!0})],e.ExportImageParameters.prototype,"hasDynamicLayers",null),t.__decorate([r.property()],e.ExportImageParameters.prototype,"layer",null),t.__decorate([r.property({readOnly:!0})],e.ExportImageParameters.prototype,"layers",null),t.__decorate([r.property({readOnly:!0})],e.ExportImageParameters.prototype,"layerDefs",null),t.__decorate([r.property({type:Number})],e.ExportImageParameters.prototype,"scale",void 0),t.__decorate([r.property({readOnly:!0})],e.ExportImageParameters.prototype,"version",null),t.__decorate([r.property({readOnly:!0})],e.ExportImageParameters.prototype,"visibleSublayers",null),e.ExportImageParameters=t.__decorate([l.subclass("esri.layers.support.ExportImageParameters")],e.ExportImageParameters),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(e){"use strict";function t(e,t){if(!e?.length)return null;const s=e.filter(e=>""!==e).map(e=>`'${e}'`);return s.push("''"),`${t} IN (${s.join(",")}) OR ${t} IS NULL`}e.getFloorFilterClause=function(e){const s=e.layer;return"floorInfo"in s&&s.floorInfo?.floorField&&"floors"in e.view?t(e.view.floors,s.floorInfo.floorField):null},e.getLayerFloorFilterClause=function(e,s){return"floorInfo"in s&&s.floorInfo?.floorField?t(e,s.floorInfo.floorField):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/sublayerUtils":function(){define(["exports"],function(e){"use strict";function t(e,t){if(!e?.length||null==t)return!0;const s=t.slice().reverse().flatten(({sublayers:e})=>e&&e.toArray().reverse()).map(e=>e.id).toArray();if(e.length>s.length)return!1;let i=0;const r=s.length;for(const{id:t}of e){for(;i<r&&s[i]!==t;)i++;if(i>=r)return!1}return!0}e.isExportDynamic=function(e,s,i){return!!e.some(e=>{const t=e.source,s=!t||"map-layer"===t.type&&t.mapLayerId===e.id&&(null==t.gdbVersion||t.gdbVersion===i);e.commitProperty("renderer"),e.commitProperty("labelingInfo"),e.commitProperty("opacity"),e.commitProperty("labelsVisible"),e.commitProperty("orderBy");const r=e.layer?.capabilities?.exportMap?.supportsSublayerOrderBy??!1;return!s||e.originIdOf("renderer")>2||e.originIdOf("labelingInfo")>2||e.originIdOf("opacity")>2||e.originIdOf("labelsVisible")>2||r&&e.originIdOf("orderBy")>2})||!t(e,s)},e.isSublayerOverhaul=function(e){return!!e&&e.some(e=>null!=e.minScale||null!=e.layerDefinition?.minScale)},e.shouldWriteSublayerStructure=function(e,s,i){return s.flatten(({sublayers:e})=>e).length!==e.length||!!e.some(e=>e.originIdOf("minScale")>i||e.originIdOf("maxScale")>i||e.originIdOf("renderer")>i||e.originIdOf("labelingInfo")>i||e.originIdOf("opacity")>i||e.originIdOf("labelsVisible")>i||e.originIdOf("source")>i)||!t(e,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],function(e){"use strict";const t={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-34028234663852886e22,34028234663852886e22],f64:[-Number.MAX_VALUE,Number.MAX_VALUE],unknown:void 0,c64:void 0,c128:void 0};function s(e){return t[e]??[-34028234663852886e22,34028234663852886e22]}const i={u1:1,u2:1,u4:1,u8:1,s8:1,u16:2,s16:2,u32:4,s32:4,f32:4,f64:8,unknown:4,c64:16,c128:32};function r(e){return i[e]}function n(e){return(e?.startsWith("s")||e?.startsWith("u"))??!1}e.clipBandToPixelTypeRange=function(e,t,i,r){let[o,a]=s(i);const l=n(i);return l&&(o-=1e-5,a+=1e-5),l?i.startsWith("u")?function(e,t,s,i){const[r,n]=i;for(let i=0;i<t.length;i++)if(t[i]){const o=e[i];o<r||o>n?t[i]=0:s[i]=o+.5|0}}(e,t,r,[o,a]):function(e,t,s,i){const[r,n]=i;for(let i=0;i<t.length;i++)if(t[i]){const o=e[i];o<r||o>n?t[i]=0:s[i]=o+(o>0?.5:-.5)|0}}(e,t,r,[o,a]):function(e,t,s,i){const[r,n]=i;for(let i=0;i<t.length;i++)if(t[i]){const o=e[i];o<r||o>n?t[i]=0:s[i]=o}}(e,t,r,[o,a])},e.convertNoDataToMask=function(e,t,i){if(e.depthCount&&e.depthCount>1)return;const{pixels:r,statistics:n,pixelType:o}=e,a=r[0].length,l=e.bandMasks??[],c=e.mask??new Uint8Array(a).fill(255),h="f32"===o||"f64"===o,u=s(o);let p=!1;for(let e=0;e<r.length;e++){const s="number"==typeof t?t:t[e];if(null==s)continue;const a=n?.[e]?.minValue??u[0],f=n?.[e]?.maxValue??u[1];if(a>s+Number.EPSILON||f<s-Number.EPSILON)continue;const d=l[e]||c.slice(),m=r[e],y=i?.customFloatTolerance;if(h&&0!==y){let e=y;e||(e=Math.abs(s)>=9999999e31?2e-7*Math.abs(s):"f32"===o?2**-23:Number.EPSILON);for(let t=0;t<m.length;t++)d[t]&&Math.abs(m[t]-s)<e&&(m[t]=0,d[t]=0,c[t]=0,p=!0)}else for(let e=0;e<m.length;e++)d[e]&&m[e]===s&&(m[e]=0,d[e]=0,c[e]=0,p=!0);l[e]=d}if(p){const t=e.bandMasks||e.pixels.length>1?l:null;i?.matchAllNoData?e.mask=t&&t.length>1?function(e){if(e.length<2)return e[0];const t=e[0].length,s=new Uint8Array(t).fill(0);for(let i=0;i<e.length;i++){const r=e[i];for(let e=0;e<t;e++)r[e]&&(s[e]=255)}return s}(t):c:(e.bandMasks=t,e.mask=c)}p&&"updateStatistics"in e&&e.updateStatistics()},e.fixNaN=function(e,t){for(let s=0;s<t.length;s++)t[s]&&isNaN(e[s])&&(t[s]=0,e[s]=0)},e.getByteCount=r,e.getBytesPerPixel=function(e){return r(e.pixelType)*e.bandCount},e.getIntegerPixelType=function(e,t){return null==e||null==t?"s32":e<0?e>=-128&&t<128?"s8":e>=-32768&&t<32768?"s16":"s32":t<256?"u8":t<65536?"u16":"u32"},e.getPixelValueRange=s,e.isIntegerPixelType=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/arrayUtils","../../core/has","../../core/Error","../../symbols/support/symbolConversion"],function(e,t,s,i,r){"use strict";function n(e){return null==e||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function o(e,t){if(!t)return null;if(Array.isArray(t)||(t=[t]),t.length>0){const s=t.map(e=>e.details.symbol.type||e.details.symbol.declaredClass).filter(e=>!!e);s.sort();const r=new Array;return s.forEach((e,t)=>{0!==t&&e===s[t-1]||r.push(e)}),new i("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${r.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:t})}return null}e.isSupportedRenderer3D=n,e.validateTo3D=function(e,s){if(null==e)return null;if(!n(e))return new i("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type}'`,{renderer:e});switch(e.type){case"simple":return function(e,t){const s={...r.defaultTo3DOptions,...t,cimFallbackEnabled:!0};return o(e,r.to3D(e.symbol,s).error)}(e,s);case"unique-value":return function(e,s){const i={...r.defaultTo3DOptions,...s,cimFallbackEnabled:!0},n=e.uniqueValueInfos?.map(e=>r.to3D(e.symbol,i).error).filter(t.isSome),a=r.to3D(e.defaultSymbol,i);return a.error&&n?.unshift(a.error),o(e,n)}(e,s);case"class-breaks":return function(e,s){const i={...r.defaultTo3DOptions,...s,cimFallbackEnabled:!0},n=e.classBreakInfos.map(e=>r.to3D(e.symbol,i).error).filter(t.isSome),a=r.to3D(e.defaultSymbol,i);return a.error&&n.unshift(a.error),o(e,n)}(e,s);case"dictionary":case"heatmap":return null}return null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/renderers/support/referenceSizeUtils":function(){define(["exports","../../../core/lang","../../../symbols/CIMSymbol"],function(e,t,s){"use strict";function i(e){switch(e){case"circle":return{rings:[[[8.5,.2],[7.06,.33],[5.66,.7],[4.35,1.31],[3.16,2.14],[2.14,3.16],[1.31,4.35],[.7,5.66],[.33,7.06],[.2,8.5],[.33,9.94],[.7,11.34],[1.31,12.65],[2.14,13.84],[3.16,14.86],[4.35,15.69],[5.66,16.3],[7.06,16.67],[8.5,16.8],[9.94,16.67],[11.34,16.3],[12.65,15.69],[13.84,14.86],[14.86,13.84],[15.69,12.65],[16.3,11.34],[16.67,9.94],[16.8,8.5],[16.67,7.06],[16.3,5.66],[15.69,4.35],[14.86,3.16],[13.84,2.14],[12.65,1.31],[11.34,.7],[9.94,.33],[8.5,.2]]]};case"square":return{rings:[[[.5,.5],[.5,16.5],[16.5,16.5],[16.5,.5],[.5,.5]]]};case"diamond":return{rings:[[[8.5,.5],[.2,8.5],[8.5,16.5],[16.5,8.5],[8.5,.5]]]};case"hexagon-pointy":return{rings:[[[15.86,12.75],[15.86,4.25],[8.5,0],[1.14,4.25],[1.14,12.75],[8.5,17],[15.86,12.75]]]};case"hexagon-flat":return{rings:[[[12.75,15.86],[17,8.5],[12.75,1.14],[4.25,1.14],[0,8.5],[4.25,15.86],[12.75,15.86]]]}}}function r(e){const{type:t,color:s,colorLocked:r}=e;return{type:"CIMVectorMarker",enable:!0,colorLocked:!1,anchorPoint:{x:0,y:0},anchorPointUnits:"Relative",primitiveName:"reference-size-outer-ring",frame:{xmin:0,ymin:0,xmax:17,ymax:17},markerGraphics:[{type:"CIMMarkerGraphic",geometry:i(t),symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:s.toArray(),colorLocked:!!r,effects:[{type:"CIMGeometricEffectDonut",width:.75}]}]}}],scaleSymbolsProportionally:!1,respectFrame:!0,markerPlacement:{type:"CIMMarkerPlacementPolygonCenter",placePerPart:!1,method:"OnPolygon",offsetX:0,offsetY:0,clipAtBoundary:!1},size:20}}function n(e){const{type:t,color:s}=e;return{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:0},anchorPointUnits:"Relative",primitiveName:"reference-size-inner-dot",frame:{xmin:0,ymin:0,xmax:17,ymax:17},markerGraphics:[{type:"CIMMarkerGraphic",geometry:i(t),symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:s.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,markerPlacement:{type:"CIMMarkerPlacementPolygonCenter",placePerPart:!1,method:"OnPolygon",offsetX:0,offsetY:0,clipAtBoundary:!1},size:10}}function o(e){return"CIMVectorMarker"===e?.type?e.markerGraphics?.[0]:void 0}function a(e){return"CIMPolygonSymbol"===e?.symbol?.type?e.symbol.symbolLayers?.[0]:void 0}function l(e,t){"CIMVectorMarker"===e?.type&&null!=t&&(e.size=t)}function c(e,t){const s=o(e);s&&null!=t&&(s.geometry=i(t))}function h(e,t){const s=a(o(e));s&&null!=t&&(s.color=t.toArray())}function u(e,t,s){const i=a(o(e));i&&null!=t&&s&&(i.colorLocked=t)}e.createPrimitiveOverrides=function(e){const{view:t,field:s,normalizationField:i,sizeStops:r,sizeByScaleEnabled:n}=e,{value:o,size:a}=r[0],{value:l,size:c}=r[1];let h,u=0;return s&&(u=`$feature["${s}"]`,h=`\n      if(!HasValue($feature, "${s}")){\n        return 0;\n      }\n      $feature["${s}"];\n    `),i&&(u=`$feature["${s}"] / $feature["${i}"]`,h=`if(!HasValue($feature, "${s}") || !HasValue($feature, "${i}") || $feature["${i}"] <= 0){\n        return 0;\n      }\n      $feature["${s}"];\n      $feature["${i}"];`),[{type:"CIMPrimitiveOverride",primitiveName:"reference-size-outer-ring",propertyName:"Size",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Size in pixels of outer ring",expression:n?`\n      ${h}\n      var maxSize = ${c};\n      var referenceScale = ${t.scale};\n      return (maxSize * (referenceScale / $view.scale));\n    `:`${h}\n      return ${c}`,returnType:"Default"}},{type:"CIMPrimitiveOverride",primitiveName:"reference-size-inner-dot",propertyName:"Size",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Size in pixels of inner ring",expression:`\n        ${h}\n        var value = ${u};\n\n        var referenceScale = ${t.scale};\n        var referenceScaleRatio = ${n?"(referenceScale / $view.scale)":1};\n        var maxSize = ${c} * referenceScaleRatio;\n        var minSize = ${a} * referenceScaleRatio;\n\n        var minDataValue = ${o};\n        var maxDataValue = ${l};\n\n        var ratio = Constrain(( value - minDataValue ) / ( maxDataValue - minDataValue ), 0, 1);\n\n        var innerDotSize = Constrain(maxSize * ratio, minSize, maxSize);\n        return innerDotSize;\n      `,returnType:"Default"}}]},e.createReferenceSizeSymbol=function(e){const{primitiveOverrides:t}=e;return new s({data:{type:"CIMSymbolReference",symbol:{type:"CIMPolygonSymbol",symbolLayers:[r(e),n(e)]},primitiveOverrides:t}})},e.updateReferenceSizeSymbol=function(e,s){const{outerRingSize:i,innerDotSize:r,type:n,color:o,colorLocked:a,primitiveOverrides:p}=s,f="CIMPolygonSymbol"===e.data.symbol?.type?e.data.symbol.symbolLayers:null;if(2===f?.length)for(const e of f){const t="reference-size-outer-ring"===e.primitiveName;l(e,t?i:r),c(e,n),h(e,o),u(e,a,t)}return null!=i&&null!=r&&(e.data.primitiveOverrides=null),void 0!==p&&(e.data.primitiveOverrides=t.clone(p)),e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(e,t,s){"use strict";function i(e){const t=s.toCIMSymbolJSON(e);if("CIMTextSymbol"===t?.type)return t.height??0;let i=0;if(t?.symbolLayers)for(const e of t.symbolLayers)s.isCIMMarker(e)&&null!=e.size&&e.size>i?i=e.size:s.isCIMStroke(e)&&null!=e.width&&e.width>i?i=e.width:s.isCIMFill(e);return i}function r(e,t,s,i){if(e)if("CIMTextSymbol"!==e.type){if(s&&e.effects)for(const s of e.effects)o(s,t);if(e.symbolLayers)for(const s of e.symbolLayers){switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":n(s,t,i);break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":!i?.preserveOutlineWidth&&s.width&&(s.width*=t);break;case"CIMPictureFill":s.height&&(s.height*=t),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t);break;case"CIMHatchFill":r(s.lineSymbol,t,!0,{...i,preserveOutlineWidth:!1}),s.offsetX&&(s.offsetX*=t),s.offsetY&&(s.offsetY*=t),s.separation&&(s.separation*=t)}if(s.effects)for(const e of s.effects)o(e,t)}}else null!=e.height&&(e.height*=t)}function n(e,t,i){if(e&&(e.markerPlacement&&function(e,t){switch(s.isCIMMarkerStrokePlacement(e)&&e.offset&&(e.offset*=t),e.type){case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineSameSize":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.placementTemplate&&e.placementTemplate.length){const s=e.placementTemplate.map(e=>e*t);e.placementTemplate=s}break;case"CIMMarkerPlacementAlongLineVariableSize":if(e.maxRandomOffset&&(e.maxRandomOffset*=t),e.placementTemplate&&e.placementTemplate.length){const s=e.placementTemplate.map(e=>e*t);e.placementTemplate=s}break;case"CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=t);break;case"CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=t);break;case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementOnVertices":break;case"CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=t),e.endPosition&&(e.endPosition*=t);break;case"CIMMarkerPlacementPolygonCenter":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.stepX&&(e.stepX*=t),e.stepY&&(e.stepY*=t)}}(e.markerPlacement,t),e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t),e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*t,y:e.anchorPoint.y*t}),e.size=null!=e.size?e.size*t:0,"CIMVectorMarker"===e.type&&e.markerGraphics))for(const s of e.markerGraphics)e.scaleSymbolsProportionally||r(s.symbol,t,!0,i)}function o(e,t){switch(e.type){case"CIMGeometricEffectArrow":case"CIMGeometricEffectDonut":e.width&&(e.width*=t);break;case"CIMGeometricEffectBuffer":e.size&&(e.size*=t);break;case"CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=t),e.endCut&&(e.endCut*=t),e.middleCut&&(e.middleCut*=t);break;case"CIMGeometricEffectDashes":if(e.customEndingOffset&&(e.customEndingOffset*=t),e.offsetAlongLine&&(e.offsetAlongLine*=t),e.dashTemplate&&e.dashTemplate.length){const s=e.dashTemplate.map(e=>e*t);e.dashTemplate=s}break;case"CIMGeometricEffectExtension":case"CIMGeometricEffectJog":case"CIMGeometricEffectRadial":e.length&&(e.length*=t);break;case"CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=t),e.offsetY&&(e.offsetY*=t);break;case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=t);break;case"CIMGeometricEffectRegularPolygon":e.radius&&(e.radius*=t);break;case"CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=t),e.length&&(e.length*=t),e.toWidth&&(e.toWidth*=t);break;case"CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=t),e.period&&(e.period*=t)}}function a(e,t){if(!e)return;let i;i="CIMTextSymbol"===e.type?e.symbol:e;const r="CIMPolygonSymbol"===e.type;if(i?.symbolLayers)for(const e of i.symbolLayers)if(!(e.colorLocked||r&&(s.isCIMStroke(e)||s.isCIMMarker(e)&&e.markerPlacement&&s.isCIMMarkerStrokePlacement(e.markerPlacement))))switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor&&l(t,e.tintColor);break;case"CIMVectorMarker":e.markerGraphics?.forEach(e=>{a(e.symbol,t)});break;case"CIMSolidStroke":case"CIMSolidFill":l(t,e.color);break;case"CIMGradientFill":c(t,e);break;case"CIMHatchFill":a(e.lineSymbol,t)}}function l(e,t){for(const s of e)if(s.join(".")===t.join("."))return;e.push(t)}function c(e,t){const s=t.colorRamp?.type;switch(s){case"CIMMultipartColorRamp":t.colorRamp.colorRamps?.forEach(t=>{"CIMLinearContinuousColorRamp"===t.type&&h(e,t)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":h(e,t.colorRamp)}}function h(e,t){t&&(t.fromColor&&l(e,t.fromColor),t.toColor&&l(e,t.toColor))}function u(e,t,i){if(!e)return;let r;r="CIMTextSymbol"===e.type?e.symbol:e;const n="CIMPolygonSymbol"===r?.type;if(r?.symbolLayers)for(const e of r.symbolLayers){if(e.colorLocked)continue;if(n)if(i){const{layersToColor:t}=i;if((s.isCIMStroke(e)||s.isCIMMarker(e)&&e.markerPlacement&&s.isCIMMarkerStrokePlacement(e.markerPlacement))&&"fill"===t||s.isCIMFill(e)&&"outline"===t)continue}else if(s.isCIMStroke(e)||s.isCIMMarker(e)&&e.markerPlacement&&s.isCIMMarkerStrokePlacement(e.markerPlacement))continue;const r=t.toArray();switch(e.type){case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":e.tintColor=r;break;case"CIMVectorMarker":e.markerGraphics?.forEach(e=>{u(e.symbol,t,i)});break;case"CIMSolidStroke":case"CIMSolidFill":e.color=r;break;case"CIMGradientFill":p(e,t);break;case"CIMHatchFill":u(e.lineSymbol,t,i)}}}function p(e,t){const s=e.colorRamp?.type;switch(s){case"CIMMultipartColorRamp":e.colorRamp.colorRamps?.forEach(e=>{"CIMLinearContinuousColorRamp"===e.type&&f(e,t)});break;case"CIMLinearContinuousColorRamp":case"CIMPolarContinuousColorRamp":f(e.colorRamp,t)}}function f(e,t){if(e&&(e.fromColor&&(e.fromColor=t.toArray()),e.toColor)){const s=t.clone();s.a=0,e.toColor=s.toArray()}}e.applyCIMSymbolColor=function(e,i,r){i instanceof t||(i=new t(i));const n=s.toCIMSymbolJSON(e);n&&u(n,i,r)},e.applyCIMSymbolRotation=function(e,t,i=!1){const r=s.toCIMSymbolJSON(e);if(i&&(t=360-t),"CIMTextSymbol"!==r?.type){if("CIMPointSymbol"===r?.type&&r.symbolLayers){const e=t-(r.angle||0);for(const t of r.symbolLayers)if(s.isCIMMarker(t)){let s=t.rotation||0;t.rotateClockwise?s-=e:s+=e,t.rotation=s}r.angle=t}}else r.angle=t},e.getCIMSymbolColor=function(e){const i=[];return a(s.toCIMSymbolJSON(e),i),i.length?new t(s.normalizeAlpha(i[0])):null},e.getCIMSymbolRotation=function(e,t=!1){const i=s.toCIMSymbolJSON(e);if("CIMTextSymbol"===i?.type||"CIMPointSymbol"===i?.type){const e=i.angle;return null!=e&&t?360-e:e??0}return 0},e.getCIMSymbolSize=i,e.getCIMSymbolType=function(e){const t=s.toCIMSymbolJSON(e);if(!t)return null;switch(t.type){case"CIMPointSymbol":return"CIMPointSymbol";case"CIMLineSymbol":return"CIMLineSymbol";case"CIMPolygonSymbol":return"CIMPolygonSymbol";case"CIMTextSymbol":return"CIMTextSymbol";case"CIMMeshSymbol":return"CIMMeshSymbol";default:return null}},e.scaleCIMMarker=n,e.scaleCIMSymbol=r,e.scaleCIMSymbolTo=function(e,t,n){if(!e)return;const o=s.toCIMSymbolJSON(e),a=i(e);0!==a?r(o,t/a,!1,n):function(e,t){if(e)if("CIMTextSymbol"!==e.type){if(e.symbolLayers)for(const s of e.symbolLayers)switch(s.type){case"CIMPictureMarker":case"CIMVectorMarker":s.size=t;break;case"CIMPictureStroke":case"CIMSolidStroke":case"CIMGradientStroke":s.width=t}}else e.height=t}(o,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/renderUtils":function(){define(["exports","../../kernel","../../request","../../core/colorUtils","../../core/Error","../../core/has","../../libs/maquette/projection","../../libs/maquette/projector","./svgUtils","./utils"],function(e,t,s,i,r,n,o,a,l,c){"use strict";const h=a.createProjector();function u(e,t){h.append(e,t),h.detach(t)}function p(e,t,s,r,n){switch(n){case"multiply":e[t]*=s[0],e[t+1]*=s[1],e[t+2]*=s[2],e[t+3]*=s[3];break;default:{const n=i.toHSV({r:e[t],g:e[t+1],b:e[t+2]});n.h=r.h,n.s=r.s,n.v=n.v/100*r.v;const o=i.toRGB(n);e[t]=o.r,e[t+1]=o.g,e[t+2]=o.b,e[t+3]*=s[3];break}}}e.renderOnce=u,e.renderSymbol=function(e,t,s){const i=Math.ceil(t[0]),r=Math.ceil(t[1]);if(!e.some(e=>!!e.length))return null;const n=s?.node||document.createElement("div");return null!=s.opacity&&(n.style.opacity=s.opacity.toString()),null!=s.effectView&&(n.style.filter=c.getCSSFilterFromEffectList(s.effectView)),u(n,()=>l.renderSVG(e,i,r,s)),n},e.tintImageWithColor=function(e,o,a,l,c){return function(e,t,i){return e?s(e,{responseType:"image"}).then(e=>{const s=e.data,r=s.width,n=s.height,o=r/n;let a=t;if(i){const e=Math.max(r,n);a=Math.min(a,e)}return{image:s,width:o<=1?Math.ceil(a*o):a,height:o<=1?a:Math.ceil(a/o)}}):Promise.reject(new r("renderUtils: imageDataSize","href not provided."))}(e,o,c).then(s=>{const r=s.width??o,c=s.height??o;if(s.image&&function(e,t){return!(!e||"ignore"===t||"multiply"===t&&255===e.r&&255===e.g&&255===e.b&&1===e.a)}(a,l)){let t=s.image.width,o=s.image.height;n("edge")&&/\.svg$/i.test(e)&&(t-=1,o-=1);const h=function(e,t){e=Math.ceil(e),t=Math.ceil(t);const s=document.createElement("canvas");s.width=e,s.height=t,s.style.width=e+"px",s.style.height=t+"px";const i=s.getContext("2d");return i.clearRect(0,0,e,t),i}(r,c);h.drawImage(s.image,0,0,t,o,0,0,r,c);const u=h.getImageData(0,0,r,c),f=[a.r/255,a.g/255,a.b/255,a.a],d=i.toHSV(a);for(let e=0;e<u.data.length;e+=4)p(u.data,e,f,d,l);h.putImageData(u,0,0),e=h.canvas.toDataURL("image/png")}else{const s=t.id?.findCredential(e);if(s?.token){const t=e.includes("?")?"&":"?";e=`${e}${t}token=${s.token}`}}return{url:e,width:r,height:c}}).catch(()=>({url:e,width:o,height:o}))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define(["exports","../Color","./arrayUtils","./lang","./mathUtils","../chunks/vec42","./libs/gl-matrix-2/factories/vec4f64"],function(e,t,s,i,r,n,o){"use strict";function a(e){return"r"in e&&"g"in e&&"b"in e}function l(e){return"h"in e&&"s"in e&&"v"in e}function c(e){return"l"in e&&"a"in e&&"b"in e}function h(e){return"l"in e&&"c"in e&&"h"in e}const u=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],p=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function f(e,t){const s=[];let i,r;if(e[0].length!==t.length)throw new Error("dimensions do not match");const n=e.length,o=e[0].length;let a=0;for(i=0;i<n;i++){for(a=0,r=0;r<o;r++)a+=e[i][r]*t[r];s.push(a)}return s}function d(e){const t=[e.r/255,e.g/255,e.b/255].map(e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4),s=f(u,t);return{x:100*s[0],y:100*s[1],z:100*s[2]}}function m(e){const t=f(p,[e.x/100,e.y/100,e.z/100]).map(e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function y(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function g(e){const t=e.l,s=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(e=>e>6/29?e**3:3*(6/29)**2*(e-4/29));return{x:95.047*s[0],y:100*s[1],z:108.883*s[2]}}function _(e){return a(e)?e:h(e)?function(e){return m(g(function(e){const t=e.l,s=e.c,i=e.h;return{l:t,a:s*Math.cos(i),b:s*Math.sin(i)}}(e)))}(e):c(e)?function(e){return m(g(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?m(e):l(e)?function(e){const t=(e.h+360)%360/60,s=e.s/100,i=e.v/100*255,r=i*s,n=r*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r,g:n,b:0};break;case 1:o={r:n,g:r,b:0};break;case 2:o={r:0,g:r,b:n};break;case 3:o={r:0,g:n,b:r};break;case 4:o={r:n,g:0,b:r};break;case 5:case 6:o={r,g:0,b:n};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+i-r),o.g=Math.round(o.g+i-r),o.b=Math.round(o.b+i-r),o}(e):e}function b(e){return l(e)?e:function(e){const t=e.r,s=e.g,i=e.b,r=Math.max(t,s,i),n=r-Math.min(t,s,i);let o=r,a=0===n?0:r===t?(s-i)/n%6:r===s?(i-t)/n+2:(t-s)/n+4,l=0===n?0:n/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(_(e))}function x(e){return c(e)?e:function(e){return y(d(e))}(_(e))}function S(e){let{r:s,g:i,b:r,a:n}=e;return n<1&&(s=Math.round(n*s+255*(1-n)),i=Math.round(n*i+255*(1-n)),r=Math.round(n*r+255*(1-n))),new t({r:s,g:i,b:r})}function v(e,t){const{r:s,g:i,b:r}=t?.ignoreAlpha?e:S(e);return.2126*s+.7152*i+.0722*r}function w(e){return e[0]??=0,e[1]??=0,e[2]??=0,e}const C=(e,t)=>{const s=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+s))};function M(e,i,r,n={}){const o=e.r,a=e.g,l=e.b,c=i.r,h=i.g,u=i.b,p=Math.round(o+(c-o)*r),f=Math.round(a+(h-a)*r),d=Math.round(l+(u-l)*r);if(!n.offset)return new t([p,f,d]);const m=s.getRandomNumberGenerator(n.seed);return new t([C(p,m),C(f,m),C(d,m)])}e.colorEquals=function(e,t){return e===t||null!=e&&e.equals(t)},e.colorVectorEquals=function(e,t){return e===t||null!=e&&null!=t&&n.equals(e,t)},e.colorVectorToColorAndOpacity=function(e){return o.fromValues(e[0],e[1],e[2],e.length>3?e[3]:1)},e.createUniqueColors=function(e,r,n={}){if(0===e.length||r<=0)return[];if(1===(e=e.map(e=>"string"==typeof e?new t(e):e)).length||1===r){const t=[],s=e[0];for(let e=0;e<r;e++)t.push(s.clone());return t}if(n.shuffle&&(e=s.shuffle(i.clone(e),n.seed)),e.length>=r){const t=[],s=(e.length-1)/(r-1);for(let i=0;i<r;i++){const r=Math.round(i*s);t.push(e[r].clone())}return t}return function(e,t,i={}){const r=[],n=e.length-1,o=Math.ceil((t-e.length)/n);e:for(let s=0;s<n;s++){const n=e[s],a=e[s+1];for(let s=1;s<=o;s++){const l=s/(o+1);if(r.push(M(n,a,l,i)),r.length+e.length===t)break e}}return[...e.map(e=>e.clone()),...s.shuffle(r,i.seed??1)]}(e,r,n)},e.darken=function(e,t){const s=x(e);s.l*=1-t;const i=_(s),r=e.clone();return r.setColor(i),r.a=e.a,r},e.desaturate=function(e,t){const s=b(e);s.s*=t;const i=_(s),r=e.clone();return r.setColor(i),r.a=e.a,r},e.getColorLuminance=v,e.getColorTheme=function(e){return S(e).isBright?"light":"dark"},e.getContrast=function(e,s=225){return v(e,{ignoreAlpha:!0})>s?new t([0,0,0,e.a]):new t([255,255,255,e.a])},e.isRGB=a,e.multiplyOpacity=function(e,t){const s=e.clone();return s.a*=t,s},e.multiplyOpacityToUnitRGBA=function(e,s){const i=t.toUnitRGBA(e);return i[3]*=s,i},e.toHSV=b,e.toLAB=x,e.toLCH=function(e){return h(e)?e:function(e){return function(e){const t=e.l,s=e.a,i=e.b,r=Math.sqrt(s*s+i*i);let n=Math.atan2(i,s);return n=n>0?n:n+2*Math.PI,{l:t,c:r,h:n}}(y(d(e)))}(_(e))},e.toRGB=_,e.unitRGBAFromColor=function(e){return t.toUnitRGBA(e)},e.validateColor=w,e.validateColorAndOpacity=function(e){return e.length=4,w(e),e[3]??=1,r.clamp(e[3],0,1),e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/svgUtils":function(){define(["exports","../../Color","../../core/has","../../core/maybe","../../core/libs/gl-matrix-2/factories/mat2df32","../../core/libs/gl-matrix-2/math/mat2d","./gfxUtils","./svgGlobalState","../../widgets/support/widgetUtils","../../widgets/support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c){"use strict";const h=s("android"),u=s("chrome")||h&&h>=4?"auto":"optimizeLegibility",p={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},f=/([A-DF-Za-df-z])|([-+]?\d*\.?\d+(?:[eE][-+]?\d+)?)/g;let d={},m={};const y=Math.PI;function g(e,t){const s=e*(y/180);return Math.abs(t*Math.sin(s))+Math.abs(t*Math.cos(s))}function _(e){return e.map(e=>`${e.command} ${e.values.join(" ")}`).join(" ").trim()}function b(e,t,s,r,n){if(e){if("circle"===e.type)return c.tsx("circle",{cx:e.cx,cy:e.cy,fill:t,"fill-rule":"evenodd",r:e.r,stroke:s.color,"stroke-dasharray":s.dashArray,"stroke-dashoffset":s.dashOffset,"stroke-linecap":s.cap,"stroke-linejoin":s.join,"stroke-miterlimit":"4","stroke-width":s.width});if("ellipse"===e.type)return c.tsx("ellipse",{cx:e.cx,cy:e.cy,fill:t,"fill-rule":"evenodd",rx:e.rx,ry:e.ry,stroke:s.color,"stroke-dasharray":s.dashArray,"stroke-linecap":s.cap,"stroke-linejoin":s.join,"stroke-miterlimit":"4","stroke-width":s.width});if("rect"===e.type)return c.tsx("rect",{fill:t,"fill-rule":"evenodd",height:e.height,stroke:s.color,"stroke-dasharray":s.dashArray,"stroke-linecap":s.cap,"stroke-linejoin":s.join,"stroke-miterlimit":"4","stroke-width":s.width,width:e.width,x:e.x,y:e.y});if("image"===e.type)return c.tsx("image",{alt:n||"image",height:e.height,href:e.src,preserveAspectRatio:"none",width:e.width,x:e.x,y:e.y});if("path"===e.type){const i="string"!=typeof e.path?_(e.path):e.path;return c.tsx("path",{d:i,fill:t,"fill-rule":"evenodd",stroke:s.color,"stroke-dasharray":s.dashArray,"stroke-linecap":s.cap,"stroke-linejoin":s.join,"stroke-miterlimit":"4","stroke-width":s.width})}if("text"===e.type)return i.assertIsSome(r),c.tsx("text",{"dominant-baseline":r.dominantBaseline,fill:t,"fill-rule":"evenodd","font-family":r.font.family,"font-size":r.font.size,"font-style":r.font.style,"font-variant":r.font.variant,"font-weight":r.font.weight,kerning:r.kerning,rotate:r.rotate,stroke:s.color,"stroke-dasharray":s.dashArray,"stroke-linecap":s.cap,"stroke-linejoin":s.join,"stroke-miterlimit":"4","stroke-width":s.width,"text-anchor":r.align,"text-decoration":r.decoration,"text-rendering":u,x:e.x,y:e.y},e.text)}return null}function x(e){if(!e)return{fill:"none",pattern:null,linearGradient:null};if(!("type"in e))return{fill:new t(e).toString(),pattern:null,linearGradient:null};if("pattern"===e.type){const t=`patternId-${a.nextPatternId()}`;return{fill:`url(#${t})`,pattern:{id:t,x:e.x,y:e.y,width:e.width,height:e.height,image:{x:0,y:0,width:e.width,height:e.height,href:e.src}},linearGradient:null}}const s=`linearGradientId-${a.nextLinearGradientId()}`;return{fill:`url(#${s})`,pattern:null,linearGradient:{id:s,x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,stops:e.colors.map(e=>({offset:e.offset,color:e.color&&new t(e.color).toString()}))}}}function S(e){const s={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};return e&&(null!=e.width&&(s.width=e.width),e.cap&&(s.cap=e.cap),e.join&&(s.join=e.join.toString()),e.color&&(s.color=new t(e.color).toString()),e.dashArray&&(s.dashArray=e.dashArray),e.dashoffset&&(s.dashOffset=e.dashoffset),e.style&&!e.dashArray&&(s.dashArray=o.getDashArray(e).join(",")||"none")),s}function v(e,t){const s={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(e){const r=e.alignBaseline,n="baseline"===r?"auto":"top"===r?"text-top":"bottom"===r?"hanging":r;s.align=e.align,s.dominantBaseline=n,s.decoration=e.decoration,s.kerning=e.kerning?"auto":"0",s.rotate=e.rotated?"90":"0",i.assertIsSome(t),s.font.style=t.style||"normal",s.font.variant=t.variant||"normal",s.font.weight=t.weight||"normal",s.font.size=t.size&&t.size.toString()||"10pt",s.font.family=t.family||"serif"}return s}function w(e){const{pattern:t,linearGradient:s}=e;if(t)return c.tsx("pattern",{height:t.height,id:t.id,patternUnits:"userSpaceOnUse",width:t.width,x:t.x,y:t.y},c.tsx("image",{height:t.image.height,href:t.image.href,width:t.image.width,x:t.image.x,y:t.image.y}));if(s){const e=s.stops.map((e,t)=>c.tsx("stop",{key:`${t}-stop`,offset:e.offset,"stop-color":e.color}));return c.tsx("linearGradient",{gradientUnits:"userSpaceOnUse",id:s.id,x1:s.x1,x2:s.x2,y1:s.y1,y2:s.y2},e)}return null}function C(e,t){if(!e||0===e.length)return null;const s=[];for(const t of e){const{shape:e,fill:i,stroke:r,font:n}=t,o=x(i),a=S(r),l="text"===e.type?v(e,n):null,c=b(e,o.fill,a,l);c&&s.push(c)}return c.tsx("mask",{id:t,maskUnits:"userSpaceOnUse"},c.tsx("g",null,s))}function M(e,t,s){return n.translate(e,n.identity(e),[t,s])}function P(e,t,s,i,r){return n.scale(e,n.identity(e),[t,s]),e[4]=e[4]*t-i*t+i,e[5]=e[5]*s-r*s+r,e}function L(e,t){d&&"left"in d?(null!=d.left&&d.left>e&&(d.left=e),(null==d.right||d.right<e)&&(d.right=e),(null==d.top||d.top>t)&&(d.top=t),(null==d.bottom||d.bottom<t)&&(d.bottom=t)):d={left:e,bottom:t,right:e,top:t}}function I(e){const t=e.args,s=t.length;let i;switch(e.action){case"M":case"L":case"C":case"S":case"Q":case"T":for(i=0;i<s;i+=2)L(t[i],t[i+1]);m.x=t[s-2],m.y=t[s-1];break;case"H":for(i=0;i<s;++i)L(t[i],m.y);m.x=t[s-1];break;case"V":for(i=0;i<s;++i)L(m.x,t[i]);m.y=t[s-1];break;case"m":{let e=0;"x"in m||(L(m.x=t[0],m.y=t[1]),e=2);for(i=e;i<s;i+=2)L(m.x+=t[i],m.y+=t[i+1]);break}case"l":case"t":for(i=0;i<s;i+=2)L(m.x+=t[i],m.y+=t[i+1]);break;case"h":for(i=0;i<s;++i)L(m.x+=t[i],m.y);break;case"v":for(i=0;i<s;++i)L(m.x,m.y+=t[i]);break;case"c":for(i=0;i<s;i+=6)L(m.x+t[i],m.y+t[i+1]),L(m.x+t[i+2],m.y+t[i+3]),L(m.x+=t[i+4],m.y+=t[i+5]);break;case"s":case"q":for(i=0;i<s;i+=4)L(m.x+t[i],m.y+t[i+1]),L(m.x+=t[i+2],m.y+=t[i+3]);break;case"A":for(i=0;i<s;i+=7)L(t[i+5],t[i+6]);m.x=t[s-2],m.y=t[s-1];break;case"a":for(i=0;i<s;i+=7)L(m.x+=t[i+5],m.y+=t[i+6])}}function k(e,t,s){const i=p[e.toLowerCase()];let r;"number"==typeof i&&(i?t.length>=i&&(r={action:e,args:t.slice(0,t.length-t.length%i)},s.push(r),I(r)):(r={action:e,args:[]},s.push(r),I(r)))}function T(e){const t={x:0,y:0,width:0,height:0};if("circle"===e.type)t.x=e.cx-e.r,t.y=e.cy-e.r,t.width=2*e.r,t.height=2*e.r;else if("ellipse"===e.type)t.x=e.cx-e.rx,t.y=e.cy-e.ry,t.width=2*e.rx,t.height=2*e.ry;else if("image"===e.type||"rect"===e.type)t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height;else if("path"===e.type){const s=function(e){const t=("string"!=typeof e.path?_(e.path):e.path).match(f),s=[];if(d={},m={},!t)return null;let i="",r=[];const n=t.length;for(let e=0;e<n;++e){const n=t[e],o=parseFloat(n);isNaN(o)?(i&&k(i,r,s),r=[],i=n):r.push(o)}k(i,r,s);const o={x:0,y:0,width:0,height:0};return d&&"left"in d&&(o.x=d.left,o.y=d.top,o.width=d.right-d.left,o.height=d.bottom-d.top),o}(e);t.x=s.x,t.y=s.y,t.width=s.width,t.height=s.height}return t}function E(e){const t={x:0,y:0,width:0,height:0};let s=null,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;for(const n of e)s?(s.x=Math.min(s.x,n.x),s.y=Math.min(s.y,n.y),i=Math.max(i,n.x+n.width),r=Math.max(r,n.y+n.height)):(s=t,s.x=n.x,s.y=n.y,i=n.x+n.width,r=n.y+n.height);return s&&(s.width=i-s.x,s.height=r-s.y),s}function z(e,t,s,i,o,a,l,c,h){let u=(l&&a?g(a,t):t)/2,p=(l&&a?g(a,s):s)/2;if(h){const e=h[0],t=h[1];u=(l&&a?g(a,e):e)/2,p=(l&&a?g(a,t):t)/2}const f=e.width+i,d=e.height+i,m=r.create(),y=r.create();let _=!1;if(o&&0!==f&&0!==d){const e=t!==s?t/s:f/d,i=t>s?t:s;let r=1,o=1;isNaN(i)||(e>1?(r=i/f,o=i/e/d):(o=i/d,r=i*e/f)),n.multiply(y,y,P(m,r,o,u,p)),_=!0}const b=e.x+(f-i)/2,x=e.y+(d-i)/2,S=u-b,v=p-x;if(n.multiply(y,y,M(m,S,v)),!_&&(f>t||d>s)){const e=f/t>d/s,i=(e?t:s)/(e?f:d);n.multiply(y,y,P(m,i,i,b,x))}return c&&n.multiply(y,y,M(m,c[0],c[1])),a&&n.multiply(y,y,function(e,t,s,i){const r=t%360*Math.PI/180;n.rotate(e,n.identity(e),r);const o=Math.cos(r),a=Math.sin(r),l=e[4],c=e[5];return e[4]=l*o-c*a+i*a-s*o+s,e[5]=c*o+l*a-s*a-i*o+i,e}(m,a,b,x)),`matrix(${y[0]},${y[1]},${y[2]},${y[3]},${y[4]},${y[5]})`}e.computeBBox=E,e.generateFillAttributes=x,e.generateStrokeAttributes=S,e.generateTextAttributes=v,e.getBoundingBox=T,e.getTransformMatrix=z,e.renderDef=w,e.renderSVG=function(e,t,s,r={}){const n=[],o=[],l=a.nextBloomId(),h=function(e,t,s){const i=e?.effects.find(e=>"bloom"===e.type);if(!i)return null;const{strength:r,radius:n}=i,o=r>0?n:0,a=(r+.5*o)*(5**(t/100)*(.4+t/100)),l=(r+o)*t,h=4*r+1;return c.tsx("filter",{filterUnits:"userSpaceOnUse",height:"300%",id:`bloom${s}`,width:"300%",x:"-100%",y:"-100%"},c.tsx("feMorphology",{in:"SourceGraphic",operator:"dilate",radius:a,result:"dilate"}),c.tsx("feGaussianBlur",{in:"dilate",result:"blur",stdDeviation:l/25}),c.tsx("feGaussianBlur",{in:"blur",result:"intensityBlur",stdDeviation:l/50}),c.tsx("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},c.tsx("feFuncR",{slope:h,type:"linear"}),c.tsx("feFuncG",{slope:h,type:"linear"}),c.tsx("feFuncB",{slope:h,type:"linear"})),c.tsx("feMerge",null,c.tsx("feMergeNode",{in:"intensityBlur"}),c.tsx("feMergeNode",{in:"intensityBrightness"}),c.tsx("feGaussianBlur",{stdDeviation:r/10})))}(r.effectView,t,l);let u=null;if(h){const e=r.effectView?.effects.find(e=>"bloom"===e.type),i=r.clipBloomEffect||!e.strength?0:(e.strength+e.radius/2)/3,n=t+t*i,o=s+s*i;u=[Math.max(n,10),Math.max(o,10)]}let p=t,f=s;if(r.useRotationSize)for(let i=0;i<e.length;i++){const e=r.rotations?.[i]??0;p=Math.max(g(e,t),p),f=Math.max(g(e,s),f)}for(let i=0;i<e.length;i++){const a=e[i],l=[],h=[];let d=0,m=0,y=0;for(const e of a){const{shape:t,fill:s,stroke:i,font:o,offset:a}=e;r.ignoreStrokeWidth||"text"===t.type||(d+=i?.width||0);const c=x(s),u=S(i),p="text"===t.type?v(t,o):null;n.push(w(c)),l.push(b(t,c.fill,u,p,r.ariaLabel)),h.push(T(t)),a&&(m+=a[0],y+=a[1])}const _=r.rotations?.[i]??0;r.useRotationSize&&(m+=(p-g(_,t))/2,y+=(f-g(_,s))/2);const M=z(E(h),t,s,d,r.scale??!1,_,r.useRotationSize??!1,[m,y],u);let P=null;if(r.masking){const e=`mask-${i}`,t=r.masking[i];n.push(C(t,e)),P=`url(#${e})`}o.push(P?c.tsx("g",{mask:P},c.tsx("g",{transform:M},l)):c.tsx("g",{transform:M},l))}return h&&(i.assertIsSome(u),p=u[0],f=u[1]),c.tsx("svg",{"aria-label":r.ariaLabel,focusable:!1,height:f,role:"img",style:"display: block;",width:p,xmlns:"http://www.w3.org/2000/svg"},h,c.tsx("defs",null,n),h?c.tsx("g",{filter:`url(#bloom${l})`},o):o)},e.renderShape=b,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["exports"],function(e){"use strict";function t(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function s(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function i(e,t,s,i,r,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=s,o[3]=i,o[4]=r,o[5]=n,o}function r(e,t,s,i){const r=t[i],n=t[i+1];e[i]=s[0]*r+s[2]*n+s[4],e[i+1]=s[1]*r+s[3]*n+s[5]}function n(e,t,s,i=0,n=0,o=2){const a=n||t.length/o;for(let n=i;n<a;n++)r(e,t,s,n*o)}const o=Object.freeze(Object.defineProperty({__proto__:null,clone:s,create:t,fromValues:i,transform:r,transformMany:n},Symbol.toStringTag,{value:"Module"}));e.clone=s,e.create=t,e.fromValues=i,e.mat2df32=o,e.transform=r,e.transformMany=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["exports","./common"],function(e,t){"use strict";function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function i(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function r(e,t,s,i,r,n,o){return e[0]=t,e[1]=s,e[2]=i,e[3]=r,e[4]=n,e[5]=o,e}function n(e,t){const s=t[0],i=t[1],r=t[2],n=t[3],o=t[4],a=t[5];let l=s*n-i*r;return l?(l=1/l,e[0]=n*l,e[1]=-i*l,e[2]=-r*l,e[3]=s*l,e[4]=(r*a-n*o)*l,e[5]=(i*o-s*a)*l,e):null}function o(e){return e[0]*e[3]-e[1]*e[2]}function a(e,t,s){const i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=s[0],h=s[1],u=s[2],p=s[3],f=s[4],d=s[5];return e[0]=i*c+n*h,e[1]=r*c+o*h,e[2]=i*u+n*p,e[3]=r*u+o*p,e[4]=i*f+n*d+a,e[5]=r*f+o*d+l,e}function l(e,t,s){const i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(s),h=Math.cos(s);return e[0]=i*h+n*c,e[1]=r*h+o*c,e[2]=i*-c+n*h,e[3]=r*-c+o*h,e[4]=a,e[5]=l,e}function c(e,t,s){const i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=s[0],h=s[1];return e[0]=i*c,e[1]=r*c,e[2]=n*h,e[3]=o*h,e[4]=a,e[5]=l,e}function h(e,t,s){const i=t[0],r=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=s[0],h=s[1];return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=i*c+n*h+a,e[5]=r*c+o*h+l,e}function u(e,t){const s=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=s,e[2]=-s,e[3]=i,e[4]=0,e[5]=0,e}function p(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function f(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function d(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function m(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function y(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e[2]=t[2]+s[2],e[3]=t[3]+s[3],e[4]=t[4]+s[4],e[5]=t[5]+s[5],e}function g(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e[2]=t[2]-s[2],e[3]=t[3]-s[3],e[4]=t[4]-s[4],e[5]=t[5]-s[5],e}function _(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*s,e[5]=t[5]*s,e}function b(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e[2]=t[2]+s[2]*i,e[3]=t[3]+s[3]*i,e[4]=t[4]+s[4]*i,e[5]=t[5]+s[5]*i,e}function x(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function S(e,s){const i=e[0],r=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=s[0],h=s[1],u=s[2],p=s[3],f=s[4],d=s[5],m=t.getEpsilon();return Math.abs(i-c)<=m*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-h)<=m*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-u)<=m*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(o-p)<=m*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(a-f)<=m*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-d)<=m*Math.max(1,Math.abs(l),Math.abs(d))}const v=a,w=g,C=Object.freeze(Object.defineProperty({__proto__:null,add:y,copy:s,determinant:o,equals:S,exactEquals:x,frob:m,fromRotation:u,fromScaling:p,fromTranslation:f,identity:i,invert:n,mul:v,multiply:a,multiplyScalar:_,multiplyScalarAndAdd:b,rotate:l,scale:c,set:r,str:d,sub:w,subtract:g,translate:h},Symbol.toStringTag,{value:"Module"}));e.add=y,e.copy=s,e.determinant=o,e.equals=S,e.exactEquals=x,e.frob=m,e.fromRotation=u,e.fromScaling=p,e.fromTranslation=f,e.identity=i,e.invert=n,e.mat2d=C,e.mul=v,e.multiply=a,e.multiplyScalar=_,e.multiplyScalarAndAdd=b,e.rotate=l,e.scale=c,e.set=r,e.str=d,e.sub=w,e.subtract=g,e.translate=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define(["exports","../../assets","../../Color","../../request","../../core/LRUCache","../../core/screenUtils","./cimSymbolUtils"],function(e,t,s,i,r,n,o){"use strict";const a="picture-fill",l="simple-fill",c="simple-marker",h=new Map([["dash",[4,3]],["dashdot",[4,3,1,3]],["dot",[1,3]],["longdash",[8,3]],["longdashdot",[8,3,1,3]],["longdashdotdot",[8,3,1,3,1,3]],["shortdash",[4,1]],["shortdashdot",[4,1,1,1]],["shortdashdotdot",[4,1,1,1,1,1]],["shortdot",[1,1]],["solid",[]]]),u=new r.LRUCache(1e3);function p(e){if(!e?.style)return[];const{dashArray:t,style:s,width:i}=e;if("string"==typeof t&&"none"!==t)return t.split(",").map(e=>Number(e));const r=i??0,n=h.has(s)?h.get(s).map(e=>e*r):[];if("butt"!==e.cap)for(const[e,t]of n.entries())n[e]=e%2==1?t+r:Math.max(t-r,1);return n}const f=(()=>{const e={};return t=>{if(e[t])return e[t];const s=t.replaceAll("-","");return e[t]=s,s}})(),d=new s([128,128,128]);e.defaultThematicColor=d,e.dekebabifyLineStyle=f,e.getDashArray=p,e.getFill=function(e){const s=e.style;let i=null;if(e)switch(e.type){case c:"cross"!==s&&"x"!==s&&(i=e.color);break;case l:s&&"solid"!==s?"none"!==s&&(i={type:"pattern",x:0,y:0,src:t.getAssetUrl(`esri/symbols/patterns/${s}.png`),width:5,height:5}):i=e.color;break;case a:i={type:"pattern",src:e.url,width:n.pt2px(e.width)*e.xscale,height:n.pt2px(e.height)*e.yscale,x:n.pt2px(e.xoffset),y:n.pt2px(e.yoffset)};break;case"text":i=e.color;break;case"cim":i=o.getCIMSymbolColor(e)}return i},e.getPatternUrlWithColor=function(e,t){const s=e+"-"+t,r=u.get(s);return null!=r?Promise.resolve(r):i(e,{responseType:"image"}).then(e=>{const i=e.data,r=i.naturalWidth,n=i.naturalHeight,o=document.createElement("canvas");o.width=r,o.height=n;const a=o.getContext("2d");a.fillStyle=t,a.fillRect(0,0,r,n),a.globalCompositeOperation="destination-in",a.drawImage(i,0,0);const l=o.toDataURL();return u.put(s,l),l})},e.getStroke=function e(t){if(!t)return null;let s=null;switch(t.type){case l:case a:case c:s=e(t.outline);break;case"simple-line":{const e=n.pt2px(t.width);null!=t.style&&"none"!==t.style&&0!==e&&(s={color:t.color,style:f(t.style),width:e,cap:t.cap,join:"miter"===t.join?n.pt2px(t.miterLimit):t.join},s.dashArray=p(s).join(",")||"none");break}default:s=null}return s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/svgGlobalState":function(){define(["exports"],function(e){"use strict";let t=0;function s(e=0){t=e}let i=0;function r(e=0){i=e}let n=0;function o(e=0){n=e}e.nextBloomId=function(){return n++},e.nextLinearGradientId=function(){return i++},e.nextPatternId=function(){return t++},e.resetBloomId=o,e.resetLinearGradientId=r,e.resetPatternId=s,e.resetSVGGlobalState=function(){s(),r(),o()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define(["require","exports","../../Color","../../core/asyncUtils","../../core/has","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/vec3f64","../../layers/effects/jsonUtils","./cimSymbolUtils","./gfxUtils","./Symbol3DMaterial","./typeUtils"],function(e,t,s,i,r,n,o,a,l,c,h,u){"use strict";function p(e,t){if(null==t||null==e)return e;const i=e.toRgba();return i[3]=i[3]*t,new s(i)}function f(e){for(const t of e)if("number"==typeof t)return t;return null}function d(e,t,s){for(let i=0;i<3;i++){const r=e[i];switch(r){case"symbol-value":{const e=s[i];return null!=e?e/t[i]:1}case"proportional":break;default:if(r&&t[i])return r/t[i]}}return null}function m(e,t,s,i){switch(e){case"proportional":return s*i;case"symbol-value":return null!=t?t:s;default:return e}}t.applyColorToSymbol=function(e,t,i){e&&(t||null!=i)&&(t&&(t=new s(t)),u.isSymbol3D(e)?function(e,t,i){const r=e.symbolLayers;if(!r)return;const n=(e,r=!1)=>{let n=t??e??null;return null!=i?.override&&(!n&&r&&(n=new s([255,255,255])),n&&(n.a=i.override)),p(n,i?.add)};r.forEach(e=>{if("water"===e.type)return void(e.color=p(e.color,i?.add));const t=null!=e.material?e.material.color:null,s=n(t,"icon"===e.type&&null!=e.resource?.href);null==e.material?e.material=new h.Symbol3DMaterial({color:s}):e.material.color=s,"outline"in e&&e.outline?.color&&null!=i?.add&&(e.outline.color=p(e.outline.color,i.add)),"marker"in e&&null!=e.marker&&(e.marker.color=n(e.marker.color))})}(e,t,i):u.isSymbol2D(e)&&function(e,t,s){t=t??e.color,null!=s?.override&&t&&(t.a=s.override),t&&(e.color=p(t,s?.add)),"outline"in e&&e.outline?.color&&(e.outline.color=p(e.outline.color,s?.add))}(e,t,i))},t.applyOpacityToColor=p,t.applyRotationToSymbol=function(e,t,s){if(e&&null!=t)if(u.isSymbol3D(e)){const i=e.symbolLayers;i&&i.forEach(e=>{if("object"===e.type)switch(s){case"tilt":e.tilt=(e.tilt??0)+t;break;case"roll":e.roll=(e.roll??0)+t;break;default:e.heading=(e.heading??0)+t}"icon"===e.type&&(e.angle+=t)})}else u.isSymbol2D(e)&&("simple-marker"!==e.type&&"picture-marker"!==e.type&&"text"!==e.type||(e.angle+=t))},t.applySizesToSymbol=async function(t,s){if(t&&s)return u.isSymbol3D(t)?async function(t,s){const r=t.symbolLayers;r&&await i.forEach(r,async t=>async function(t,s){switch(t.type){case"extrude":!function(e,t){const s=t[2];"number"==typeof s&&(e.size=s)}(t,s);break;case"icon":case"line":case"text":!function(e,t){const s=f(t);null!=s&&(e.size=s)}(t,s);break;case"path":!function(e,t){const s=d(t,o.ONES,[e.width,void 0,e.height]);null!=s&&(e.width=m(t[0],e.width,1,s),e.height=m(t[2],e.height,1,s))}(t,s);break;case"object":await async function(t,s){const{resourceSize:i,symbolSize:r}=await async function(t){const{computeObjectLayerResourceSize:s}=await new Promise((t,s)=>e(["./symbolLayerUtils"],t,s)),i=await s(t,10),{width:r,height:n,depth:o}=t,a=[r,o,n];let l=1;for(let e=0;e<3;e++){const t=a[e];if(null!=t){l=t/i[e];break}}for(let e=0;e<3;e++)null==a[e]&&(a[e]=i[e]*l);return{resourceSize:i,symbolSize:a}}(t),n=d(s,i,r);null!=n&&(t.width=m(s[0],r[0],i[0],n),t.depth=m(s[1],r[1],i[1],n),t.height=m(s[2],r[2],i[2],n))}(t,s)}}(t,s))}(t,s):void(u.isSymbol2D(t)&&function(e,t){const s=f(t);if(null!=s)switch(e.type){case"simple-marker":e.size=s;break;case"picture-marker":{const t=e.width/e.height;t>1?(e.width=s,e.height=s*t):(e.width=s*t,e.height=s);break}case"simple-line":e.width=s;break;case"text":e.font.size=s}}(t,s))},t.getCSSFilterFromEffectList=function(e){if(!e)return null;const t=e.effects.filter(e=>"bloom"!==e.type).map(e=>e.toJSON());return a.effectFunctionsFromJSON(t)},t.getColorFromSymbol=function(e,t){if(!e)return null;let i=null;return u.isSymbol3D(e)?i=function(e){const t=e.symbolLayers;if(!t)return null;let i=null;return t.forEach(e=>{"object"===e.type&&e.resource?.href||(i="water"===e.type?e.color:e.material?e.material.color:null)}),i?new s(i):null}(e):u.isSymbol2D(e)&&(i="cim"===e.type?l.getCIMSymbolColor(e):e.color?new s(e.color):null),i?p(i,t):null},t.getIconHref=function(e){return e.resource?.href??""},t.getSymbolOutlineColor=function(e){if(!e)return null;if(u.isSymbol3D(e))return function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.color}(e);const t=c.getStroke(e)?.color;return t?new s(t):null},t.getSymbolOutlineSize=function(e){if(!e)return 0;if(u.isSymbol3D(e)){const t=function(e){const t=e.symbolLayers?.at(-1);if(t&&"outline"in t)return t?.outline?.size}(e);return null!=t?t:0}return n.px2pt(c.getStroke(e)?.width)},t.isVolumetricSymbol=function(e){if(null==e||!("symbolLayers"in e)||null==e.symbolLayers)return!1;switch(e.type){case"point-3d":return e.symbolLayers.some(e=>"object"===e.type);case"line-3d":return e.symbolLayers.some(e=>"path"===e.type);case"polygon-3d":return e.symbolLayers.some(e=>"object"===e.type||"extrude"===e.type);default:return!1}},t.symbolHasExtrudeSymbolLayer=function(e){return null!=e&&"polygon-3d"===e.type&&e.symbolLayers.some(e=>"extrude"===e.type)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/has","../../core/screenUtils","../../layers/support/layerUtils","../../support/loadArcade","./gfxUtils","./renderUtils","./typeUtils","./utils","../../widgets/Legend/styles/support/relationshipUtils","../../widgets/Legend/support/relationshipRampUtils"],function(e,t,s,i,r,n,o,a,l,c,h,u){"use strict";let p=null;const f=[255,255,255];function d(e,t){return Math.floor(Math.random()*(t-e+1)+e)}async function m(t,s){switch(t.type){case"web-style":{const{previewWebStyleSymbol:i}=await new Promise((t,s)=>e(["./previewWebStyleSymbol"],t,s));return i(t,m,s)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:i}=await new Promise((t,s)=>e(["./previewSymbol3D"],t,s));return i(t,s)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:i}=await new Promise((t,s)=>e(["./previewSymbol2D"],t,s));return i(t,s)}case"cim":{const{previewCIMSymbol:i}=await new Promise((t,s)=>e(["./previewCIMSymbol"],t,s));return i(t,s)}default:return}}function y(e){return e&&"opacity"in e?e.opacity*y(e.parent):1}async function g(t,s){if(!t)return;const i=t.sourceLayer,r=(null!=s&&s.useSourceLayer?i:t.layer)??i,o=s?.ignoreOpacity?1:y(r);if(null!=t.symbol&&(null==s||!0!==s.ignoreGraphicSymbol)){const e="web-style"===t.symbol.type?await t.symbol.fetchSymbol({...s,acceptedFormats:s?.webStyleAcceptedFormats,cache:s?.webStyleCache}):t.symbol.clone();return c.applyColorToSymbol(e,null,{add:o}),e}const a=s?.renderer??b(r);let l=a&&"getSymbolAsync"in a?await a.getSymbolAsync(t,s):null;if(!l)return;if(l="web-style"===l.type?await l.fetchSymbol({...s,acceptedFormats:s?.webStyleAcceptedFormats,cache:s?.webStyleCache}):l.clone(),!(a&&"visualVariables"in a&&a.visualVariables?.length&&_(l)))return c.applyColorToSymbol(l,null,{add:o}),l;if("arcadeRequiredForVisualVariables"in a&&a.arcadeRequiredForVisualVariables&&null==s?.arcade){const e={...s};e.arcade=await n.loadArcade(),s=e}const{getColor:h,getOpacity:u,getAllSizes:p,getRotationAngle:f}=await new Promise((t,s)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],t,s)),d=[],m=[],g=[],x=[];for(const e of a.visualVariables)switch(e.type){case"color":d.push(e);break;case"opacity":m.push(e);break;case"rotation":x.push(e);break;case"size":e.target||g.push(e)}const S=!!d.length&&d[d.length-1],v=S?h(S,t,s):null,w=!!s?.ignoreOpacity,C=!!m.length&&m[m.length-1],M=C?u(C,t,s):null;if(c.applyColorToSymbol(l,v,w?void 0:{override:M,add:o}),g.length&&!0!==s?.ignoreSizeVariables){const e=p(g,t,s);await c.applySizesToSymbol(l,e)}if(!0!==s?.ignoreRotationVariables)for(const e of x)c.applyRotationToSymbol(l,f(e,t,s),e.axis);return l}function _(e){return!l.isSymbol3D(e)||"water"!==e.symbolLayers.at(0)?.type}function b(e){if(e)return"renderer"in e?e.renderer:void 0}t.getDisplayedColor=async function(t,s){if(!t)return;const{layer:i,sourceLayer:r}=t,o=y(i??r);if(null!=t.symbol&&(null==s||!0!==s.ignoreGraphicSymbol)){const e="web-style"===t.symbol.type?await t.symbol.fetchSymbol({...s,acceptedFormats:s?.webStyleAcceptedFormats}):t.symbol.clone();return c.getColorFromSymbol(e,o)}const a=s?.renderer??b(i)??b(r);let l=a&&"getSymbolAsync"in a?await a.getSymbolAsync(t,s):void 0;if(!l)return;l="web-style"===l.type?await l.fetchSymbol({...s,acceptedFormats:s?.webStyleAcceptedFormats}):l.clone();const h=c.getColorFromSymbol(l,void 0);if(!a||!("visualVariables"in a)||"visualVariables"in a&&!a.visualVariables||"visualVariables"in a&&!a.visualVariables?.length||!_(l))return h?c.applyOpacityToColor(h,o):void 0;if("arcadeRequiredForVisualVariables"in a&&a.arcadeRequiredForVisualVariables&&null==s?.arcade){const e={...s};e.arcade=await n.loadArcade(),s=e}const{getColor:u,getOpacity:p}=await new Promise((t,s)=>e(["../../renderers/visualVariables/support/visualVariableUtils"],t,s)),f=[],d=[];if(a.visualVariables)for(const e of a.visualVariables)switch(e.type){case"color":f.push(e);break;case"opacity":d.push(e)}const m=f.length>0?f[f.length-1]:null,g=(m?u(m,t,s):void 0)??h,x=d.length>0?d[d.length-1]:null,S=x?p(x,t,s):null;return null!=g&&null!=S&&(g.a=S),g?c.applyOpacityToColor(g,o):null},t.getDisplayedSymbol=g,t.getLegendLabel=async function(t,s,i){if(!t)return;const{layer:r,sourceLayer:n}=t,o=i?.renderer??b(r)??b(n);if(!o)return null;if("visualVariables"in o&&o.visualVariables?.length){const{getRampStops:n}=await new Promise((t,s)=>e(["../../widgets/Legend/support/colorRampUtils"],t,s)),{getRampStops:a}=await new Promise((t,s)=>e(["../../widgets/Legend/support/sizeRampUtils"],t,s)),{getDateFormatOptions:l}=await new Promise((t,s)=>e(["../../widgets/Legend/support/utils"],t,s));let c=null;for(const e of o.visualVariables){const h=s?l(r,e,s.timeZone):null;let u=null;switch(e.type){case"color":u=await n(e,null,h);break;case"opacity":u=await n(e);break;case"size":e.target||(u=await a(o,e,null,i?.scale||s?.scale,s,h))}if(u?.length){const s=u.find((s,i)=>{const r=t.attributes[e.field];return 0===i?r>=s.value:i===u?.length-1?r<=s.value:s.value===r});if(s){c=s.label;break}}}if(c)return c}switch(o.type){case"class-breaks":{const e="getClassBreakInfo"in o?await o.getClassBreakInfo(t,i):null;return e?.label??(e&&o.classBreakInfos?.length>1)?`${e.minValue} - ${e.maxValue}`:null}case"unique-value":{const e="getUniqueValueInfo"in o?await o.getUniqueValueInfo(t,i):null;return e?.label}}return null},t.previewGraphic=async function(e,t){e?.layer&&r.isSubtypeGroupLayer(e.layer)&&((e=e.cloneShallow()).layer=e.layer.findSublayerForFeature(e)??null);const s=null===e?t?.fallbackSymbol??null:await g(e,{ignoreGraphicSymbol:!!e.layer,ignoreOpacity:t?.ignoreOpacity??!0,ignoreRotationVariables:t?.ignoreRotationVariables??!0,ignoreSizeVariables:t?.ignoreSizeVariables??!0})??t?.fallbackSymbol??null;if(!s)return null;const n=await m(s,{geometry:t.useGeometryForShape?e?.geometry??null:null,useMarkerSymbolSize:!1!==t.useMarkerSymbolSize,size:{width:i.px2pt(t.widthInPixels??16),height:i.px2pt(t.heightInPixels??16)},..."cim"===s?.type?{cimOptions:{feature:{attributes:e?.attributes??{}}}}:{}});return n?"element"===(t?.format??"element")?n:n.outerHTML:null},t.renderColorRampPreviewHTML=function(e,t={}){const s="horizontal"===t.align,i=s?75:24,r=s?24:75,n=t.width??i,o=t.height??r,a=t.gradient??!0,l=window.devicePixelRatio,h=n*l,u=o*l,p=document.createElement("canvas");p.width=h,p.height=u,p.ariaLabel=t.ariaLabel??null,p.style.width=`${n}px`,p.style.height=`${o}px`;const f=p.getContext("2d"),d=s?h:0,m=s?0:u;if(a){const t=f.createLinearGradient(0,0,d,m),s=e.length,i=1===s?0:1/(s-1);e.forEach((e,s)=>t.addColorStop(s*i,e.toString())),f.fillStyle=t,f.fillRect(0,0,h,u)}else{const t=s?h/e.length:h,i=s?u:u/e.length;let r=0,n=0;for(const o of e)f.fillStyle=o.toString(),f.fillRect(r,n,t,i),r=s?r+t:0,n=s?0:n+i}const y=document.createElement("div");return y.style.width=`${n}px`,y.style.height=`${o}px`,function(e,t){if(!t)return;e.style.filter=c.getCSSFilterFromEffectList(t);const s=t.effects;if(s)for(const t of s)if("drop-shadow"===t?.type){t.offsetX<0?e.style.marginLeft=`${Math.abs(t.offsetX)}px`:e.style.marginRight=`${t.offsetX}px`;break}}(y,t?.effectList),y.appendChild(p),y},t.renderDotDensityPreviewHTML=function(e,t,s){const{backgroundColor:i,outline:r,dotSize:n}=e,o=s?.swatchSize||22,a=Math.round(o*o/Math.max(n,.5)**2*.8),l=window.devicePixelRatio,c=document.createElement("canvas"),h=o*l;c.width=h,c.height=h,c.style.width=c.width/l+"px",c.style.height=c.height/l+"px";const u=c.getContext("2d");if(i&&(u.fillStyle=i.toCss(!0),u.fillRect(0,0,h,h),u.fill()),u.fillStyle=t?.toCss(!0)??"",p&&p.length/2===a)for(let e=0;e<2*a;e+=2){const t=p[e],s=p[e+1];u.fillRect(t,s,n*l,n*l),u.fill()}else{p=[];for(let e=0;e<2*a;e+=2){const e=d(0,h),t=d(0,h);p.push(e,t),u.fillRect(e,t,n*l,n*l),u.fill()}}r&&(r.color&&(u.strokeStyle=r.color.toCss(!0)),u.lineWidth=r.width,u.strokeRect(0,0,h,h));const f=new Image(o,o);return f.src=c.toDataURL(),f.ariaLabel=s?.ariaLabel??null,f.alt=s?.ariaLabel??"",f},t.renderPieChartPreviewHTML=function(e,t={}){const s=t.radius||40,i=2*Math.PI*s,r=e.length,n=i/r,l=[],c=o.getStroke(t.outline);null!=c?.width&&(c.width*=2),(c||t.backgroundColor)&&l.push({shape:{type:"circle",cx:s,cy:s,r:s},fill:t.backgroundColor,stroke:c,offset:[0,0]});const h=t.values,u=h&&h.length===r&&100===h.reduce((e,t)=>e+t,0),p=[0];for(let t=0;t<r;t++){let r=null;u&&(r=h[t]*i/100,p.push(r+p[t])),l.push({shape:{type:"circle",cx:s,cy:s,r:s/2},fill:[0,0,0,0],stroke:{width:s,dashArray:`${(r??n)/2} ${i}`,dashoffset:"-"+(u?p[t]/2:t*(n/2)),color:e[t]},offset:[0,0]})}let d=null;const m=2*s+(c?.width||0),y=t.holePercentage;if(y){c&&l.push({shape:{type:"circle",cx:s,cy:s,r:s*y},fill:null,stroke:c,offset:[0,0]});const e=m/2;d=[[{shape:{type:"circle",cx:e,cy:e,r:e},fill:f,stroke:c?{...c,color:f}:null,offset:[0,0]},{shape:{type:"circle",cx:e,cy:e,r:s*y},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return a.renderSymbol([l],[m,m],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:d,rotations:[-90],ariaLabel:t.ariaLabel})},t.renderPreviewHTML=m,t.renderRelationshipRampPreviewHTML=function(e,t={}){const s=e?.authoringInfo;if("relationship"!==s?.type||!s?.numClasses||!e.uniqueValueInfos)return null;const{focus:i,numClasses:r}=s,n=u.getRelationshipRampElement({focus:i,numClasses:r,infos:e.uniqueValueInfos}),o=t?.node||document.createElement("div");return a.renderOnce(o,()=>h.renderRelationshipRamp(n,t.id||"relationship",{opacity:t.opacity||1,effectList:t.effectList,ariaLabel:t.ariaLabel})),o},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/styles/support/relationshipUtils":function(){define(["exports","../../../../symbols/support/svgUtils","../../../../symbols/support/utils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r){"use strict";const n="esri-relationship-ramp",o=`${n}--diamond`,a=`${n}--square`,l={diamondContainer:`${o}__container`,diamondLeftCol:`${o}__left-column`,diamondRightCol:`${o}__right-column`,diamondMidCol:`${o}__middle-column`,diamondMidColLabel:`${o}__middle-column--label`,diamondMidColRamp:`${o}__middle-column--ramp`,squareTable:`${a}__table`,squareTableRow:`${a}__table-row`,squareTableCell:`${a}__table-cell`,squareTableLabel:`${a}__table-label`,squareTableLabelLeftBottom:`${a}__table-label--left-bottom`,squareTableLabelRightBottom:`${a}__table-label--right-bottom`,squareTableLabelLeftTop:`${a}__table-label--left-top`,squareTableLabelRightTop:`${a}__table-label--right-top`};function c(e,t,s){const i=`${s}_arrowStart`,r=`${s}_arrowEnd`,n="left"===e,o={markerStart:null,markerEnd:null};switch(t){case"HL":n?o.markerStart=`url(#${r})`:o.markerEnd=`url(#${i})`;break;case"LL":o.markerStart=`url(#${r})`;break;case"LH":n?o.markerEnd=`url(#${i})`:o.markerStart=`url(#${r})`;break;default:o.markerEnd=`url(#${i})`}return o}e.renderRelationshipRamp=function(e,n,o={}){const{focus:a,labels:h}=e,u=!!a,p=function(e,i,n={}){const{focus:o,numClasses:a,colors:h,rotation:u}=e,{opacity:p,effectList:f,ariaLabel:d}=n,m=n.size??60,y=!!o,g=Math.sqrt(m**2+m**2)+(y?0:5),_=[],b=[],x=[],S=(m||75)/a;for(let e=0;e<a;e++){const s=e*S;for(let i=0;i<a;i++){const r=i*S,n=t.generateFillAttributes(h[e][i]),o=t.generateStrokeAttributes(null),a={type:"rect",x:r,y:s,width:S,height:S},l=t.renderDef(n);l&&_.push(l);const c=t.renderShape(a,n.fill,o,null);c&&b.push(c),x.push(t.getBoundingBox(a))}}let v=null;y||(v="margin: -15px -15px -18px -15px");const w=c("left",o,i),C=c("right",o,i),M=t.computeBBox(x),P=t.getTransformMatrix(M,g,g,0,!1,u,!1),L=t.getTransformMatrix(M,g,g,0,!1,y?-45:null,!1),I={filter:s.getCSSFilterFromEffectList(f)??void 0,opacity:null==p?"":`${p}`};return r.tsx("div",{class:y?l.diamondMidColRamp:l.squareTableCell,styles:I},r.tsx("svg",{"aria-label":d,focusable:!1,height:g,role:"image",style:v,width:g,xmlns:"http://www.w3.org/2000/svg"},r.tsx("defs",null,r.tsx("marker",{id:`${i}_arrowStart`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"5",refY:"5"},r.tsx("polyline",{fill:"none",points:"0,0 5,5 0,10",stroke:"#555555","stroke-width":"1"})),r.tsx("marker",{id:`${i}_arrowEnd`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"0",refY:"5"},r.tsx("polyline",{fill:"none",points:"5,0 0,5 5,10",stroke:"#555555","stroke-width":"1"})),_),r.tsx("g",{transform:P},b),r.tsx("g",{transform:L},r.tsx("line",{fill:"none","marker-end":w.markerEnd,"marker-start":w.markerStart,stroke:"#555555","stroke-width":"1",x1:-10,x2:-10,y1:m-15,y2:15}),r.tsx("line",{fill:"none","marker-end":C.markerEnd,"marker-start":C.markerStart,stroke:"#555555","stroke-width":"1",x1:15,x2:m-15,y1:m+10,y2:m+10}))))}(e,n,o),f=i.isRTL(),d=o.key??n;return u?r.tsx("div",{class:l.diamondContainer,key:`${d}-container`,styles:{justifyContent:"center"}},r.tsx("div",{class:l.diamondLeftCol},f?h.right:h.left),r.tsx("div",{class:l.diamondMidCol},r.tsx("div",{class:l.diamondMidColLabel},h.top),p,r.tsx("div",{class:l.diamondMidColLabel},h.bottom)),r.tsx("div",{class:l.diamondRightCol},f?h.left:h.right)):r.tsx("div",{class:l.squareTable,key:`${d}-container`},r.tsx("div",{class:l.squareTableRow},r.tsx("div",{class:i.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelRightBottom)},f?h.top:h.left),r.tsx("div",{class:l.squareTableCell}),r.tsx("div",{class:i.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelLeftBottom)},f?h.left:h.top)),r.tsx("div",{class:l.squareTableRow},r.tsx("div",{class:l.squareTableCell}),p,r.tsx("div",{class:l.squareTableCell})),r.tsx("div",{class:l.squareTableRow},r.tsx("div",{class:i.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelRightTop)},f?h.right:h.bottom),r.tsx("div",{class:l.squareTableCell}),r.tsx("div",{class:i.classes(l.squareTableCell,l.squareTableLabel,l.squareTableLabelLeftTop)},f?h.bottom:h.right)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define(["exports","../../../core/lang","../../../symbols/support/gfxUtils","../../../symbols/support/previewSymbol3D"],function(e,t,s,i){"use strict";const r={HH:315,HL:45,LL:135,LH:225},n={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function o(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return i.getSymbolLayerFill(e.symbolLayers.at(0));if("simple-line"===t){const t=s.getStroke(e);return t&&t.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){const t=s.getStroke(e);return t&&t.color}return s.getFill(e)}function a(e){let t=r[e];return e&&null==t&&(t=r.HH),t||0}e.getRelationshipRampColors2D=function(e,s){const i=[],r=e.length**.5,n=t.clone(e),o=(s||"HH").split(""),a=o[0],l="H"===o[1];for(;n.length;){const e=[];for(;e.length<r;)e.push(n.shift());l&&e.reverse(),i.push(e)}return"L"===a&&i.reverse(),i},e.getRelationshipRampElement=function(e){const{focus:t,infos:s,numClasses:i}=e,r=n[i],l={};s.forEach(e=>{l[e.value]={label:e.label,fill:o(e.symbol)}});const c=[];for(let e=0;e<i;e++){const t=[];for(let s=0;s<i;s++){const i=l[r[e][s]];t.push(i.fill)}c.push(t)}const h=function(e,t){const s=t.HH.label,i=t.LL.label,r=t.HL.label,n=t.LH.label;switch(e){case"HH":default:return{top:s,bottom:i,left:r,right:n};case"HL":return{top:r,bottom:n,left:i,right:s};case"LL":return{top:i,bottom:s,left:n,right:r};case"LH":return{top:n,bottom:r,left:s,right:i}}}(t,l);return{type:"relationship-ramp",numClasses:i,focus:t,colors:c,labels:h,rotation:a(t)}},e.getRotationAngleForFocus=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/previewSymbol3D":function(){define(["exports","../../assets","../../core/colorUtils","../../core/has","../../core/Error","../../core/Logger","../../core/screenUtils","./gfxUtils","./IconSymbol3DLayerResource","./ObjectSymbol3DLayerResource","./previewUtils","./renderUtils","./utils","./webStyleSymbolUtils"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f){"use strict";const d=22,m=120;function y(e){const t=e.outline,s=null!=e.material?e.material.color:null,i=null!=s?s.toHex():null;if(null==t||"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type&&"none"===t.pattern.style)return"fill"===e.type&&"#ffffff"===i?{color:"#bdc3c7",width:.75}:null;const r=o.pt2px(t.size)||0;return{color:"rgba("+(null!=t.color?t.color.toRgba():"255,255,255,1")+")",width:Math.min(r,80),style:"pattern"in t&&null!=t.pattern&&"style"===t.pattern.type?a.dekebabifyLineStyle(t.pattern.style):null,join:"butt",cap:"patternCap"in t?t.patternCap:"butt"}}function g(e,t=1){const i=e.a,r=s.toHSV(e),n=r.h,o=r.s/t,a=100-(100-r.v)/t,{r:l,g:c,b:h}=s.toRGB({h:n,s:o,v:a});return[l,c,h,i]}function _(e){return"water"===e.type?null==e.color?null:e.color:null==e.material?.color?null:e.material.color}function b(e,t=0){const s=_(e);if(!s){if("fill"===e.type)return null;const s=a.defaultThematicColor.r,i=h.adjustColorComponentBrightness(s,t);return[i,i,i,100]}const i=s.toRgba();for(let e=0;e<3;e++)i[e]=h.adjustColorComponentBrightness(i[e],t);return i}async function x(e,s){const i=e.style;return"none"===i?null:{type:"pattern",x:0,y:0,src:await a.getPatternUrlWithColor(t.getAssetUrl(`esri/symbols/patterns/${i}.png`),s.toCss(!0)),width:5,height:5}}function S(e){return e.outline?y(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function v(e,t){const s=_(e);if(!s)return null;let i="rgba(";return i+=h.adjustColorComponentBrightness(s.r,t)+",",i+=h.adjustColorComponentBrightness(s.g,t)+",",i+=h.adjustColorComponentBrightness(s.b,t)+",",i+s.a+");"}function w(e,t){const s=e.edges;return s&&s.color&&s.size?{color:s.color.toCss(!0),width:Math.min(o.pt2px(s.size),t,80),join:"round"}:null}function C(e,t){const s=v(e,t);if(!s)return null;if("pattern"in e&&null!=e.pattern&&"style"===e.pattern.type&&"none"===e.pattern.style)return null;const i={color:s,width:Math.min(e.size?o.pt2px(e.size):.75,80)};return"pattern"in e&&"style"===e.pattern?.type&&(i.style=a.dekebabifyLineStyle(e.pattern.style)),"cap"in e&&e.cap&&(i.cap=e.cap),"join"in e&&e.join&&(i.join="miter"===e.join?o.pt2px(2):e.join),i}function M(e,t,s){const i=null!=s?.75*s:0;return{type:"linear",x1:i?.25*i:0,y1:i?.5*i:0,x2:i||4,y2:i?.5*i:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function P(e){const t="number"==typeof e?.size?e?.size:null;return t?o.pt2px(t):null}e.getPatternDescriptor=x,e.getSizeFromOptions=P,e.getSymbolLayerFill=b,e.previewSymbol3D=function(e,s){if(0===e.symbolLayers.length)return Promise.reject(new r("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(e.type){case"point-3d":return async function(e,s){const i=P(s),r=s?.maxSize?o.pt2px(s.maxSize):null,a=s?.disableUpsampling??!1,g=e.symbolLayers,_=[],x=[];let v=!1,w=0,C=0,L=0;g.forEach(n=>{if("icon"!==n.type&&"object"!==n.type)return;n&&"icon"===n.type&&(L=Math.max(n.size&&o.pt2px(n.size),L));const g="icon"===n.type?n.size&&o.pt2px(n.size):0,P=i||g?Math.ceil(Math.min(i||g,r||m)):d;let I="icon"===n.type?n.angle:null;if(null!=s?.rotation&&(I=(I??0)+s.rotation),x.push(I),n?.resource?.href){const s=async function(e,s){if(e.thumbnail?.url)return e.thumbnail.url;if("icon"===s.type){const e=s?.resource?.href;if(e)return p.getIconHref(s)}const i=t.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const t=await f.resolveWebStyleSymbol(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(t&&"thumbnail"in t&&t.thumbnail?.url)return t.thumbnail.url}return i}(e,n).then(e=>{const t=n?.material?.color,s=function(e){return"icon"===e.type?"multiply":"tint"}(n);return u.tintImageWithColor(e,P,t,s,a)}).then(e=>{const t=e.width,s=e.height;return w=Math.max(w,t),C=Math.max(C,s),I&&(v=!0),[{shape:{type:"image",x:0,y:0,width:t,height:s,src:e.url},fill:null,stroke:null}]});_.push(s)}else{let e=P;"icon"===n.type&&i&&(e=P*(g/L));const t="tall"===s?.symbolConfig||s?.symbolConfig?.isTall||"object"===n.type&&function(e){const t=e.depth,s=e.height,i=e.width;return 0!==i&&0!==t&&0!==s&&i===t&&null!=i&&null!=s&&i<s}(n);w=Math.max(w,t?20:e),C=Math.max(C,e),I&&n.resource?.primitive&&["square","triangle","x"].includes(n.resource?.primitive)&&(v=!0),_.push(Promise.resolve(function(e,t,s){const i=[];if(!e)return i;switch(e.type){case"icon":{const s=0,r=0,n=t,o=t;switch(e.resource?.primitive??l.defaultPrimitive){case"circle":i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:b(e,0),stroke:y(e)});break;case"square":i.push({shape:{type:"path",path:[{command:"M",values:[s,o]},{command:"L",values:[s,r]},{command:"L",values:[n,r]},{command:"L",values:[n,o]},{command:"Z",values:[]}]},fill:b(e,0),stroke:y(e)});break;case"triangle":i.push({shape:{type:"path",path:[{command:"M",values:[s,o]},{command:"L",values:[.5*n,r]},{command:"L",values:[n,o]},{command:"Z",values:[]}]},fill:b(e,0),stroke:y(e)});break;case"cross":i.push({shape:{type:"path",path:[{command:"M",values:[.5*n,r]},{command:"L",values:[.5*n,o]},{command:"M",values:[s,.5*o]},{command:"L",values:[n,.5*o]}]},stroke:S(e)});break;case"x":i.push({shape:{type:"path",path:[{command:"M",values:[s,r]},{command:"L",values:[n,o]},{command:"M",values:[n,r]},{command:"L",values:[s,o]}]},stroke:S(e)});break;case"kite":i.push({shape:{type:"path",path:[{command:"M",values:[s,.5*o]},{command:"L",values:[.5*n,r]},{command:"L",values:[n,.5*o]},{command:"L",values:[.5*n,o]},{command:"Z",values:[]}]},fill:b(e,0),stroke:y(e)})}break}case"object":switch(e.resource?.primitive??c.defaultPrimitive){case"cone":{const r=M(b(e,0),b(e,-.6),s?20:t),n=h.getConeShapes(t,s);i.push({shape:n[0],fill:r},{shape:n[1],fill:r});break}case"inverted-cone":{const s=b(e,0),r=M(s,b(e,-.6),t),n=h.getInvertedConeShapes(t);i.push({shape:n[0],fill:r},{shape:n[1],fill:s});break}case"cube":{const r=h.getCubeShapes(t,s);i.push({shape:r[0],fill:b(e,0)},{shape:r[1],fill:b(e,-.3)},{shape:r[2],fill:b(e,-.5)});break}case"cylinder":{const r=M(b(e,0),b(e,-.6),s?20:t),n=h.getCylinderShapes(t,s);i.push({shape:n[0],fill:r},{shape:n[1],fill:r},{shape:n[2],fill:b(e,0)});break}case"diamond":{const s=h.getDiamondShapes(t);i.push({shape:s[0],fill:b(e,-.3)},{shape:s[1],fill:b(e,0)},{shape:s[2],fill:b(e,-.3)},{shape:s[3],fill:b(e,-.7)});break}case"sphere":{const s=M(b(e,0),b(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,i.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=h.getTetrahedronShapes(t);i.push({shape:s[0],fill:b(e,-.3)},{shape:s[1],fill:b(e,0)},{shape:s[2],fill:b(e,-.6)});break}}}return i}(n,e,t)))}});const I=await Promise.allSettled(_),k=[];return I.forEach(e=>{"fulfilled"===e.status?k.push(e.value):e.reason&&n.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",e.reason)}),u.renderSymbol(k,[w,C],{node:s?.node,scale:!1,opacity:s?.opacity,ariaLabel:s?.ariaLabel,rotations:x,useRotationSize:v})}(e,s);case"line-3d":return function(e,t){const s=e.symbolLayers,i=[],r=p.isVolumetricSymbol(e),n=P(t),a=(t?.maxSize?o.pt2px(t.maxSize):null)||80;let l,c=0,f=0;return s.forEach((e,t)=>{if(!e)return;if("line"!==e.type&&"path"!==e.type)return;const s=[];switch(e.type){case"line":{const i=C(e,0);if(null==i)break;const r=i?.width||0;0===t&&(l=r);const o=Math.min(n||r,a),h=0===t?o:n?o*(r/l):o,u=h>25?2*h:50;f=Math.max(f,h),c=Math.max(c,u),i.width=h,s.push({shape:{type:"path",path:[{command:"M",values:[0,.5*f]},{command:"L",values:[c,.5*f]}]},stroke:i});break}case"path":{const t=Math.min(n||d,a),i=b(e,0),r=b(e,-.2),o=v(e,-.4),l=o?{color:o,width:1}:{};if("quad"===e.profile){const t=e.width,n=e.height,o=t&&n?t/n:1,a=h.getPathSymbolShapes(o,0===n,0===t),c={...l,join:"bevel"};s.push({shape:a[0],fill:r,stroke:c},{shape:a[1],fill:r,stroke:c},{shape:a[2],fill:i,stroke:c})}else s.push({shape:h.shapes.pathSymbol3DLayer[0],fill:r,stroke:l},{shape:h.shapes.pathSymbol3DLayer[1],fill:i,stroke:l});f=Math.max(f,t),c=f}}i.push(s)}),Promise.resolve(u.renderSymbol(i,[c,f],{node:t?.node,scale:r,opacity:t?.opacity,ariaLabel:t?.ariaLabel}))}(e,s);case"polygon-3d":case"mesh-3d":return async function(e,t){const s="mesh-3d"===e.type,i=e.symbolLayers,r=P(t),n=t?.maxSize?o.pt2px(t.maxSize):null,a=r||d,l=[];let c=0,p=0,f=!1;for(let e=0;e<i.length;e++){const t=i.at(e),r=[];if(!s||"fill"===t.type){switch(t.type){case"fill":{const e=Math.min(a,n||m);if(c=Math.max(c,e),p=Math.max(p,e),f=!0,s){const s=h.shapes.meshSymbol3DFill,i=v(t,-.4),n=w(t,.05*e)??(i?{join:"round",color:i,width:1}:null);r.push({shape:s[0],fill:b(t,0),stroke:n},{shape:s[1],fill:b(t,-.2),stroke:n},{shape:s[2],fill:b(t,-.6),stroke:n})}else{let e=b(t,0);const s="pattern"in t?t.pattern:null,i=y(t),n=_(t);null!=s&&"style"===s.type&&"solid"!==s.style&&n&&(e=await x(s,n)),r.push({shape:h.shapes.fill[0],fill:e,stroke:i})}break}case"line":{const e=C(t,0);if(null==e)break;const s={stroke:e,shape:h.shapes.fill[0]};c=Math.max(c,d),p=Math.max(p,d),r.push(s);break}case"extrude":{const e=b(t,0),s=b(t,-.2),i=Math.min(a,n||m),o=h.getExtrudeSymbolShapes(i),l=d,u=15.399999999999999+.5*i,f=w(t,.1*Math.min(l,u))??{join:"round",...C(t,-.4),width:1};r.push({shape:o[0],fill:s,stroke:f},{shape:o[1],fill:s,stroke:f},{shape:o[2],fill:e,stroke:f}),c=Math.max(c,l),p=Math.max(p,u);break}case"water":{const e=_(t),s=g(e),i=g(e,2),o=g(e,3),l=h.getWaterSymbolShapes();f=!0,r.push({shape:l[0],fill:s},{shape:l[1],fill:i},{shape:l[2],fill:o});const u=Math.min(a,n||m);c=Math.max(c,u),p=Math.max(p,u);break}}l.push(r)}}return u.renderSymbol(l,[c,p],{node:t?.node,scale:f,opacity:t?.opacity,ariaLabel:t?.ariaLabel})}(e,s)}return Promise.reject(new r("symbolPreview: swatchInfo3D","symbol not supported."))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/previewUtils":function(){define(["exports","../../Color"],function(e,t){"use strict";function s(e,t){return Math.round(Math.min(Math.max(e+255*t*.75,0),255))}e.adjustColorBrightness=function(e,i){if(null==e)return new t;if("type"in e&&("linear"===e.type||"pattern"===e.type))return e;const r=new t(e);return new t([s(r.r,i),s(r.g,i),s(r.b,i),r.a])},e.adjustColorComponentBrightness=s,e.getConeShapes=function(e,t){let s=t?20:e;const i=t?4:6;s-=s<=22?.5*i:i;const r=.15*s,n=e-r;return[{type:"ellipse",cx:.5*s,cy:n,rx:.5*s,ry:r},{type:"path",path:[{command:"M",values:[.5*s,0]},{command:"L",values:[s,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]}]},e.getCubeShapes=function(e,t){let s=t?20:e;const i=t?4:6;s-=s<=22?.5*i:i;const r=t?.35*s:.5*s;return[{type:"path",path:[{command:"M",values:[.5*s,0]},{command:"L",values:[s,.5*r]},{command:"L",values:[.5*s,r]},{command:"L",values:[0,.5*r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*r]},{command:"L",values:[.5*s,r]},{command:"L",values:[.5*s,e]},{command:"L",values:[0,e-.5*r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*s,r]},{command:"L",values:[.5*s,e]},{command:"L",values:[s,e-.5*r]},{command:"L",values:[s,.5*r]},{command:"Z",values:[]}]}]},e.getCylinderShapes=function(e,t){let s=t?20:e;const i=t?4:6;s-=s<=22?.5*i:i;const r=.5*s,n=.15*s,o=e-n;return[{type:"ellipse",cx:.5*s,cy:o,rx:r,ry:n},{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[0,o]},{command:"L",values:[s,o]},{command:"L",values:[s,n]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*s,cy:n,rx:r,ry:n}]},e.getDiamondShapes=function(e){let t=e;const s=e;t-=t<22?2:4;const i=t,r=s,n=Math.floor(e/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*i,0]},{command:"L",values:[i,.5*r-n]},{command:"L",values:[.45*i-n,.5*r+n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*i,0]},{command:"L",values:[.45*i-n,.5*r+n]},{command:"L",values:[0,.5*r-n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*r-n]},{command:"L",values:[.45*i-n,.5*r+n]},{command:"L",values:[.45*i,s]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*i,s]},{command:"L",values:[i,.5*r-n]},{command:"L",values:[.45*i-n,.5*r+n]},{command:"Z",values:[]}]}]},e.getExtrudeSymbolShapes=function(e){const t=.5*e,s=22;return[{type:"path",path:[{command:"M",values:[0,.7*s*.5]},{command:"L",values:[6.6,.7*s]},{command:"L",values:[6.6,.7*s+t]},{command:"L",values:[0,.7*s+t-.7*s*.5]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,.7*s]},{command:"L",values:[6.6,.7*s+t]},{command:"L",values:[22,t]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,.7*s]},{command:"L",values:[0,.7*s*.5]},{command:"Z",values:[]}]}]},e.getInvertedConeShapes=function(e){let t=e;t-=t<22?3:6;const s=.15*t;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[t,0]},{command:"L",values:[.5*t,e-s]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*t,cy:0,rx:.5*t,ry:s}]},e.getPathSymbolShapes=function(e,t,s){let i=22,r=22;e<1?i*=.75:e>1&&(r*=1.25);let n=22,o=22;return t&&s&&(i=r=n=o=0),[{type:"path",path:[{command:"M",values:[n,0]},{command:"L",values:[s?n:.875*n,0]},{command:"L",values:[s?i-.5*n:0,r-.5*o]},{command:"L",values:[i-.5*n,r-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,0]},{command:"L",values:[n,t?0:.125*o]},{command:"L",values:[i-.5*n,t?r-.5*o:o]},{command:"L",values:[i-.5*n,r-.5*o]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[i-.5*n,r-.5*o]},{command:"L",values:[s?i-.5*n:0,r-.5*o]},{command:"L",values:[s?i-.5*n:0,t?r-.5*o:o]},{command:"L",values:[i-.5*n,t?r-.5*o:o]},{command:"Z",values:[]}]}]},e.getTetrahedronShapes=function(e){let t=e;return t-=t<22?1:2,[{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[e,t]},{command:"L",values:[.45*e,.6*t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*e,0]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[0,t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,t]},{command:"L",values:[.45*e,.6*t]},{command:"L",values:[e,t]},{command:"Z",values:[]}]}]},e.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]},e.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],meshSymbol3DFill:[{type:"path",path:"M -10,-8 L 6,0 L 6,6 L -10,6 L -10,-8 Z"},{type:"path",path:"M -10,-8 L -7,-10 L 9,-2 L 6,0 L -10,-8 Z"},{type:"path",path:"M 6,0 L 9,-2 L 9,4 L 6,6 L 6,0 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define(["exports","../../core/devEnvironmentUtils","../../core/Error","../../core/urlUtils","../../portal/Portal","../../chunks/persistableUrlUtils","./jsonUtils","./StyleOrigin","./styleUtils","./Thumbnail","./typeUtils","./webStyleAcceptedFormats"],function(e,t,s,i,r,n,o,a,l,c,h,u){"use strict";function p(e,t){return t.items.find(t=>t.name===e)}async function f(e,f,d,m,y){const g=null!=d?.portal?d.portal:r.getDefault(),_={portal:g,url:i.urlToObject(e.baseUrl)},b=p(f,e.data);if(!b)throw new s("symbolstyleutils:symbol-name-not-found",`The symbol name '${f}' could not be found`,{symbolName:f});const x=y?.acceptedFormats??u.defaultAcceptedFormats,S=m(b,x);if(!S)throw new s("symbolstyleutils:symbol-reference-no-accepted-format",`The symbol name '${f}' does not have an accepted format (one of ${x})`,{symbolName:f});const{url:v,format:w}=S;let C=n.fromJSON(v,_),M=b.thumbnail?.href??null;const P=b.thumbnail?.imageData;t.isDevEnvironment()&&(C=t.adjustStaticAGOUrl(C)??"",M=t.adjustStaticAGOUrl(M));const L={portal:g,url:i.urlToObject(i.removeFile(C)),origin:"portal-item"};return l.requestJSON(C,y).then(t=>{const s="cim"===w?l.makeCIMSymbolRef(t.data):t.data,i=o.fromJSON(s,L);if(i&&h.isSymbol3D(i)){if(M){const e=n.fromJSON(M,_);i.thumbnail=new c.Thumbnail({url:e})}else P&&(i.thumbnail=new c.Thumbnail({url:`data:image/png;base64,${P}`}));e.styleUrl?i.styleOrigin=new a({portal:d.portal,styleUrl:e.styleUrl,name:f}):e.styleName&&(i.styleOrigin=new a({portal:d.portal,styleName:e.styleName,name:f}))}return i})}e.fetchSymbolFromStyle=f,e.getStyleItemFromStyle=p,e.resolveWebStyleSymbol=function(e,t,n){const a=e.name;return null==a?Promise.reject(new s("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):"Esri2DPointSymbolsStyle"===e.styleName?function(e,t,s){const n=l.Style2DUrlTemplate.replaceAll(/\{SymbolName\}/gi,e),a=null!=t.portal?t.portal:r.getDefault();return l.requestJSON(n,s).then(e=>{const t=l.makeCIMSymbolRef(e.data);return o.fromJSON(t,{portal:a,url:i.urlToObject(i.removeFile(n)),origin:"portal-item"})})}(a,t,n):l.fetchStyle(e,t,n).then(e=>f(e,a,t,l.symbolUrlFromStyleItem,n))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(e){"use strict";const t=/^devext\.arcgis\.com$/,s=/^qaext\.arcgis\.com$/,i=/^[\w-]*\.mapsdevext\.arcgis\.com$/,r=/^[\w-]*\.mapsqa\.arcgis\.com$/,n=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local\.esri\.com$/,t,s,/^jsapps\.esri\.com$/,i,r];e.adjustStaticAGOUrl=function(e,n){return e?(n=n||globalThis.location.hostname)?null!=n.match(t)||null!=n.match(i)?e.replace("static.arcgis.com","staticdev.arcgis.com"):null!=n.match(s)||null!=n.match(r)?e.replace("static.arcgis.com","staticqa.arcgis.com"):e:e:null},e.devHostnames=n,e.isDevEnvironment=function(e){return e=e||globalThis.location.hostname,n.some(t=>null!=e?.match(t))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleAcceptedFormats":function(){define(["exports"],function(e){"use strict";e.defaultAcceptedFormats=["web-gltf","web","cim"],Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/clusterUtils":function(){define(["exports","../../../renderers/visualVariables/SizeVariable"],function(e,t){"use strict";e.getEffectiveClusterSizeVariable=function(e,s,i){const r=e.effectiveClusterRenderer;if(!r||!("visualVariables"in r)||!r.visualVariables)return null;const n=r.visualVariables.find(e=>"size"===e.type);if(!("stops"in n)||!n.stops)return null;const o=n.stops.find(e=>e.useMinValue),a=n.stops.find(e=>e.useMaxValue);if(null==o||null==a)return null;const l=i.featuresTilingScheme.getClosestInfoForScale(i.scale).level,c=n.field,h=s.getDisplayStatistics(l,c);return h?new t({field:n.field,minSize:e.clusterMinSize,minDataValue:h.minValue,maxSize:e.clusterMaxSize,maxDataValue:h.maxValue}):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/colorRampUtils":function(){define(["require","exports","../../../Color","../../../core/arrayUtils","./utils"],function(e,t,s,i,r){"use strict";const n=new s([64,64,64]);function o(e,t){const s=[],i=e.length-1;return 5===e.length?s.push(0,2,4):s.push(0,i),e.map((e,n)=>s.includes(n)?r.createStopLabel(e,n,i,t):null)}function a(e,t){const{startIndex:i,endIndex:r,weight:n}=function(e,t){let s=0,i=t.length-1;return t.some((t,r)=>e<t.value?(i=r,!0):(s=r,!1)),{startIndex:s,endIndex:i,weight:(e-t[s].value)/(t[i].value-t[s].value)}}(e,t);if(i===r)return t[i].color;const o=s.blendColors(t[i].color,t[r].color,n);return new s(o)}t.getColorFromPointCloudStops=a,t.getRampStops=async function(t,r,a){let l=!1,c=[],h=[];if(t.stops){const e=t.stops;c=e.map(e=>e.value),l=e.some(e=>!!e.label),l&&(h=e.map(e=>e.label))}const u=c[0],p=c[c.length-1];if(null==u&&null==p)return null;const f=l?null:o(c,a);return(await Promise.all(c.map(async(i,o)=>{const a="opacity"===t.type?await async function(t,i,r){const o=new s(r??n),a=(await new Promise((t,s)=>e(["../../../renderers/visualVariables/support/visualVariableUtils"],t,s))).getOpacity(i,t);return null!=a&&(o.a=a),o}(i,t,r):(await new Promise((t,s)=>e(["../../../renderers/visualVariables/support/visualVariableUtils"],t,s))).getColor(t,i),c=l?h[o]:f?.[o]??"";return null==a?null:{value:i,color:a,label:c}}))).filter(i.isSome).reverse()},t.getRampStopsForPointCloud=function(e){let t=!1,s=[],i=[];s=e.map(e=>e.value),t=e.some(e=>!!e.label),t&&(i=e.map(e=>e.label??""));const r=s[0],n=s[s.length-1];if(null==r&&null==n)return null;const l=t?null:o(s);return s.map((s,r)=>({value:s,color:a(s,e),label:t?i[r]:l?.[r]??""})).reverse()},t.getStretchRampStops=function(e,t){let i=[];if(e&&"multipart"===e.type)e.colorRamps.reverse().forEach((r,n)=>{0===n?i.push({value:t.max,color:new s(r.toColor),label:"high"}):i.push({value:null,color:new s(r.toColor),label:""}),n===e.colorRamps.length-1?i.push({value:t.min,color:new s(r.fromColor),label:"low"}):i.push({value:null,color:new s(r.fromColor),label:""})});else{let r,n;e&&"algorithmic"===e.type?(r=e.fromColor,n=e.toColor):(r=[0,0,0,1],n=[255,255,255,1]),i=[{value:t.max,color:new s(n),label:"high"},{value:t.min,color:new s(r),label:"low"}]}return i},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/utils":function(){define(["require","exports","../../../core/timeUtils","../../../layers/support/fieldUtils","../../../renderers/support/numberUtils","../../../smartMapping/support/utils","../../../symbols/SimpleLineSymbol"],function(e,t,s,i,r,n,o){"use strict";async function a(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const s=t.visualVariables.find(e=>"color"===e.type);if(!s)return null;let i=null,r=null;if(s.stops){if(1===s.stops.length)return s.stops[0].color;i=s.stops[0].value,r=s.stops[s.stops.length-1].value}const n=null!=i&&null!=r?i+(r-i)/2:0,{getColor:o}=await new Promise((t,s)=>e(["../../../renderers/visualVariables/support/visualVariableUtils"],t,s));return o(s,n)??null}t.createStopLabel=function(e,t,s,i){let o="";return 0===t?o="< ":t===s&&(o="> "),o+(i?n.formatAnyDate(e,i):r.format(e))},t.getAuthoringInfoVisualVariableByTheme=function(e,t){if("authoringInfo"in e)return e.authoringInfo?.visualVariables?.find(({theme:e})=>e===t)},t.getDateFormatOptions=function(e,t,r){const o=function(e,t){if(!t.field)return null;if("featureReduction"in e)switch(e.featureReduction?.type){case"cluster":case"binning":{const s=e.featureReduction.fields.find(({name:e})=>e.toLowerCase()===t.field.toLowerCase());return s&&"getField"in e?e.getField(s.onStatisticField):null}}return"getField"in e?e.getField?.(t.field):null}(e,t);if(!o||!n.isAnyDateField(o)&&!i.isTimeOnlyField(o))return null;let a=function(e,t){const s="popupTemplate"in e?e.popupTemplate?.fieldInfos:null;if(s?.length&&t)return s.find(e=>e.fieldName?.toLowerCase()===t.toLowerCase())?.format?.dateFormat}(e,o.name);if(!a&&"date"===o.type){let e=0,i=0;t.stops?(e=t.stops?.at(0)?.value??e,i=t.stops?.at(-1)?.value??i):"minDataValue"in t&&"maxDataValue"in t&&(e=t.minDataValue??e,i=t.maxDataValue??i),a=i-e>2*s.millisecondsPerTimeUnit.days?"short-date":"short-date-short-time"}return{fieldType:o.type,format:a,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in e?e.preferredTimeZone:null,viewTimeZone:r,datesInUnknownTimezone:"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone}}},t.getMedianColor=a,t.getSymbolForFlowRenderer=async function(e,t){const s=e.trailCap,i=e.trailWidth||1,r=t||await a(e)||e.color;return new o({cap:s,color:r,width:i})},t.rgbImgSource=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="],t.specialCharsGreaterThan=">",t.specialCharsLessThan="<",Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/numberUtils":function(){define(["exports","../../intl","../../intl/number"],function(e,t,s){"use strict";const i=/^-?(\d+)(\.(\d+))?$/i;function r(e,t){return e-t}function n(e,t){let s,i;return s=Number(e.toFixed(t)),s<e?i=s+1/10**t:(i=s,s-=1/10**t),s=Number(s.toFixed(t)),i=Number(i.toFixed(t)),[s,i]}function o(e,t,s,i,r){const n=l(e,t,s,i),o=null==n.previous||n.previous<=r,a=null==n.next||n.next<=r;return o&&a||n.previous+n.next<=2*r}function a(e){const t=String(e),s=t.match(i);if(s?.[1])return{integer:s[1].split("").length,fractional:s[3]?s[3].split("").length:0};if(t.toLowerCase().includes("e")){const e=t.split("e"),s=e[0],i=e[1];if(s&&i){const e=Number(s);let t=Number(i);const r=t>0;r||(t=Math.abs(t));const n=a(e);return r?(n.integer+=t,t>n.fractional?n.fractional=0:n.fractional-=t):(n.fractional+=t,t>n.integer?n.integer=1:n.integer-=t),n}}return{integer:0,fractional:0}}function l(e,t,s,i){const r={previous:null,next:null};if(null!=s){const i=e-s,n=t-s-i;r.previous=Math.floor(Math.abs(100*n/i))}if(null!=i){const s=i-e,n=i-t-s;r.next=Math.floor(Math.abs(100*n/s))}return r}const c={maximumFractionDigits:20};e.format=function(e){return s.formatNumber(e,c)},e.numDigits=a,e.percentChange=l,e.round=function(e,t={}){const s=e.slice(),{tolerance:i=2,strictBounds:l=!1,indexes:c=s.map((e,t)=>t)}=t;c.sort(r);for(let e=0;e<c.length;e++){const t=c[e],r=s[t],h=0===t?null:s[t-1],u=t===s.length-1?null:s[t+1],p=a(r).fractional;if(p){let a,c=0,f=!1;for(;c<=p&&!f;){const t=n(r,c);a=l&&0===e?t[1]:t[0],f=o(r,a,h,u,i),c++}f&&(s[t]=a)}}return s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define(["exports","../../intl/date","../../layers/support/fieldUtils","../../support/basemapUtils","../../support/loadArcade","../../time/constants","../../time/timeZoneUtils"],function(e,t,s,i,r,n,o){"use strict";const a={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},c=new Set(["integer","small-integer"]);let h=null;function u(e){return String(e).padStart(2,"0")}function p(e,t,s){let i;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),i=`TIMESTAMP'${s?e.getFullYear():e.getUTCFullYear()}-${u((s?e.getMonth():e.getUTCMonth())+1)}-${u(s?e.getDate():e.getUTCDate())} ${u(s?e.getHours():e.getUTCHours())}:${u(s?e.getMinutes():e.getUTCMinutes())}:${u(s?e.getSeconds():e.getUTCSeconds())}'`):i=e,i}function f(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const i=e.getField(t);if("<now>"===t.toLowerCase())return;if(s.isDateField(i))return"field"}}e.castIntegerFieldToFloat=function(e){return`cast(${e} as float)`},e.dateTypes=["date","date-only","timestamp-offset"],e.defaultBasemapGroups=a,e.defaultStatisticTypes={exclude:["median"]},e.fieldDelimiter=",",e.formatAnyDate=function(e,s){const{format:i,timeZoneOptions:r,fieldType:a}=s??{};let l,c;if(r&&({timeZone:l,timeZoneName:c}=o.getTimeZoneFormattingOptions(r.layerTimeZone,r.datesInUnknownTimezone,r.viewTimeZone,t.convertDateFormatToIntlOptions(i||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const s=t.convertDateFormatToIntlOptions(i||"short-date");return"string"==typeof e?t.formatDateOnly(e,{...s}):t.formatDate(e,{...s,timeZone:n.utc})}case"time-only":{const s=t.convertDateFormatToIntlOptions(i||"short-time");return"string"==typeof e?t.formatTimeOnly(e,s):t.formatDate(e,{...s,timeZone:n.utc})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const s=i||r?t.convertDateFormatToIntlOptions(i||"short-date-short-time"):void 0,n=s?{...s,timeZone:l,timeZoneName:c}:void 0;return"string"==typeof e?t.formatTimestamp(e,n):t.formatDate(e,n)}default:{const s=i||r?t.convertDateFormatToIntlOptions(i||"short-date-short-time"):void 0;return t.formatDate("string"==typeof e?new Date(e):e,s?{...s,timeZone:l,timeZoneName:c}:void 0)}}},e.getBasemapGroup=function(e,t=a){for(const s in t)if(t[s].includes(e))return s},e.getBasemapId=function(e,t,s=!0){let r=null;return e&&("string"==typeof e?t.includes(e)&&(r=e):r=i.getWellKnownBasemapId(e)),s?r||"gray":r},e.getDateDiffSQL=function(e,t,s,i){const{hasQueryEngine:r}=e,n=`(${p(s,f(e,s),r)} - ${p(t,f(e,t),r)})`;let o=l[i],a="/";return o<1&&(o=1/o,a="*"),{sqlExpression:1===o?n:`(${n} ${a} ${o})`,sqlWhere:null}},e.getDateType=f,e.getFieldsList=async function(e){const{field:t,field2:s,field3:i,normalizationField:n,valueExpression:o}=e;let a=[];if(o){if(!h){const{arcadeUtils:e}=await r.loadArcade();h=e}a=h.extractFieldNames(o)}return t&&a.push(t),s&&a.push(s),i&&a.push(i),n&&a.push(n),a},e.getNormalizationType=function(e){let t=e.normalizationType;return t||(e.normalizationField?t="field":null!=e.normalizationTotal&&(t="percent-of-total")),t??void 0},e.isAnyDateField=function(e){return s.isDateField(e)||s.isDateOnlyField(e)||s.isTimestampOffsetField(e)},e.isIntegerField=function(e,t){const s=t&&e.getField(t);return!!s&&c.has(s.type)},e.unitValueInDays=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["exports","../../../renderers/support/HeatmapColorStop"],function(e,t){"use strict";e.getHeatmapRampStops=function(e){if(!e.colorStops)return[];const s=[...e.colorStops].filter(e=>e.color?.a>0);let i=s.length-1;if(s&&s[0]){const e=s[i];e&&1!==e.ratio&&(s.push(new t({ratio:1,color:e.color})),i++)}return s.map((t,s)=>{let r="";return 0===s?r=e.legendOptions?.minLabel||"low":s===i&&(r=e.legendOptions?.maxLabel||"high"),{color:t.color,label:r,ratio:t.ratio}}).reverse()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/sizeRampUtils":function(){define(["require","exports","../../../Color","../../../core/colorUtils","../../../renderers/support/numberUtils","../../../smartMapping/renderers/support/referenceSizeUtils","../../../smartMapping/renderers/support/spikeUtils","../../../symbols/SimpleLineSymbol","../../../symbols/SimpleMarkerSymbol","../../../symbols/support/cimSymbolUtils","../../../symbols/support/previewCIMSymbol","../../../symbols/support/typeUtils","../../../symbols/support/utils","./utils","../../support/widgetUtils","../../../support/modeUtils"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d,m){"use strict";const y=[255,255,255],g=[200,200,200],_=[128,128,128];function b(e){"line-3d"===e.type?e.symbolLayers.forEach(e=>{e.material={color:_}}):e.symbolLayers.forEach(e=>{"icon"!==e.type||e.resource?.href?e.material={color:g}:(e.material={color:y},e.outline={color:_,size:1.5})})}function x(e){const t=m.isDarkMode();if("cim"===e.type)c.applyCIMSymbolColor(e,new s(g));else if(e.type.includes("line"))e.color=_;else if(e.color=t?_:y,"simple-marker"===e.type)if(e.outline){const t=e.outline?.color?.toHex();"#ffffff"===t&&(e.outline.color=_)}else e.outline={color:_,width:1.5}}function S(e){const t=e.minSize,s=(e.maxSize-t)/4,i=[];for(let e=0;e<5;e++)i.push(t+s*e);return i}async function v(e,t,s,i,n,o){const a=await w(e,t,s,n,o),l=await w(e,t,i,n,o),c=r.numDigits(s),h=c.fractional;let u=c.integer,p=null,f=null;s>0&&s<1&&(p=10**h,s*=p,u=r.numDigits(s).integer);for(let i=u-1;i>=0;i--){const c=10**i;let h=Math.floor(s/c)*c,u=Math.ceil(s/c)*c;null!=p&&(h/=p,u/=p);let d=(h+u)/2;[,d]=r.round([h,d,u],{indexes:[1]});const m=await w(e,t,h,n,o),y=await w(e,t,u,n,o),g=await w(e,t,d,n,o),_=r.percentChange(a,m,l,null),b=r.percentChange(a,y,l,null),x=r.percentChange(a,g,l,null);let S=_.previous<=20,v=b.previous<=20;if(S&&v&&(_.previous<=b.previous?(S=!0,v=!1):(v=!0,S=!1)),S?f=[h,m]:v?f=[u,y]:x.previous<=20&&(f=[d,g]),f)break}return f}async function w(t,s,i,r,n){const{getSize:o}=await new Promise((t,s)=>e(["../../../renderers/visualVariables/support/visualVariableUtils"],t,s));return o(t,i,{scale:r,view:n,shape:"simple-marker"===s.type?s.style:null})}t.getRampStops=async function(t,c,d,y,C,M,P){const L=c.legendOptions,I=L?.customValues,k=P||await async function(e,t){if("flow"===e.type)return f.getSymbolForFlowRenderer(e,t);if("pie-chart"===e.type)return new l({color:null,outline:e.outline?.width?e.outline:new a});let r=null,c=null;if("simple"===e.type)r=e.symbol;else if("class-breaks"===e.type){const t=e.classBreakInfos;r=t&&t[0]&&t[0].symbol,c=t.length>1}else if("unique-value"===e.type){const t=e.uniqueValueInfos;r=t?.[0]?.symbol,c=null!=t&&t.length>1}if(!r||function(e){return u.isSymbol3D(e)?e.symbolLayers?.some(e=>"fill"===e?.type)??!1:e?.type.includes("fill")??!1}(r))return null;if(r=r.clone(),t||c)if(r.type.includes("3d"))b(r);else if(f.getAuthoringInfoVisualVariableByTheme(e,"reference-size")&&"cim"===r.type)n.updateReferenceSizeSymbol(r,{color:t??("class-breaks"!==e.type?new s(g):null)});else if(f.getAuthoringInfoVisualVariableByTheme(e,"spike")&&"cim"===r.type){const e=new s(g),n=new s(_),a="CIMPointSymbol"===r.data.symbol?.type?r.data.symbol:null,l=!!a?.symbolLayers?.find(({type:e})=>"CIMSolidStroke"===e)?.colorLocked;let c,h=t??void 0;if(h){const t=i.getColorLuminance(h),s=m.isDarkMode();(!s&&t>225||s&&t<25)&&(h=e,c=l?n:e)}else h=e,c=l?n:e;o.updateSpikeSymbol(r,{color:h,strokeColor:c})}else x(r);return r}(t,d),T=c.stops,E=!!k,z=!!I,R=null!=c.minSize&&null!=c.maxSize,A=T&&T.length>1,F=!!c.target;if(!E||!z&&!(R||A&&!F))return;const O=p.isVolumetricSymbol(k);let V=!1,D=null,N=null;D=O&&!A?r.round([c.minDataValue,c.maxDataValue]):I??await async function(t,s,i,n){const o=(await new Promise((t,s)=>e(["../../../renderers/visualVariables/support/visualVariableUtils"],t,s))).getSizeRangeAtScale(t,i,n),a=o&&S(o);if(!o||!a)return;let l=a.map(e=>function(e,t,s){const i=s.minSize,r=s.maxSize,n=t.minDataValue,o=t.maxDataValue;let a;return a=e<=i?n:e>=r?o:(e-i)/(r-i)*(o-n)+n,a}(e,t,o));l=r.round(l);for(let e=1;e<l.length-1;e++){const r=await v(t,s,l[e],l[e-1],i,n);r&&(l[e]=r[0],a[e]=r[1])}return l}(c,k,y,C?.type);const U=t?.authoringInfo,G="univariate-color-size"===U?.type,B=G&&"above-and-below"===U?.univariateTheme,$=!!f.getAuthoringInfoVisualVariableByTheme(t,"reference-size"),H=!!f.getAuthoringInfoVisualVariableByTheme(t,"spike");if(!D&&A&&(D=T.map(e=>e.value),V=T.some(e=>!!e.label),"flow"===t.type&&(D=r.round(D)),V&&(N=T.map(e=>e.label))),O&&null!=D&&D?.length>2&&!B&&(D=[D[0],D[D.length-1]]),!D)return null;G&&5!==D?.length&&(D=S({minSize:D[0],maxSize:D[D.length-1]}));const j=O?function(e,t){const s=e?.authoringInfo,i="univariate-color-size"===s?.type;let r=[12,30];if(i){const e=t[0],s=t[t.length-1],i=12,n=30;r=t.map(t=>i+(t-e)/(s-e)*(n-i))}return i&&"below"===s?.univariateTheme&&r.reverse(),r}(t,D):null,q=p.getSymbolOutlineSize(k),W=V?null:function(e,t){const s=e.length-1;return e.map((e,i)=>f.createStopLabel(e,i,s,t))}(D,M);return(await Promise.all(D.map(async(e,s)=>{let i=O?j[s]:await w(c,k,e,y,C?.type),r=i;$&&(i*=24/c.maxSize||1,r=24);const a=function(e,t,s,i){"univariate-color-size"===s?.authoringInfo?.type&&"above-and-below"===s?.authoringInfo?.univariateTheme&&"class-breaks"===s.type&&(e=function(e,t){const s=e.classBreakInfos,i=s.length,r=i<2||!(t>=2)?s[0].symbol.clone():s[i-1].symbol.clone(),n=e.visualVariables?.some(e=>"color"===e.type);return n&&(r.type.includes("3d")?b(r):x(r)),r}(s,i));const r=e.clone();if(u.isSymbol3D(r))p.isVolumetricSymbol(r)||r.symbolLayers.forEach(e=>{"fill"!==e.type&&(e.size=t)});else if("esri.symbols.SimpleMarkerSymbol"===r.declaredClass)r.size=t;else if("esri.symbols.PictureMarkerSymbol"===r.declaredClass){const e=r.width,s=r.height;r.height=t,r.width=t*(e/s)}else"esri.symbols.SimpleLineSymbol"!==r.declaredClass?function(e){return"esri.symbols.TextSymbol"===e.declaredClass}(r)?r.font&&(r.font.size=t):"cim"===r.type&&f.getAuthoringInfoVisualVariableByTheme(s,"reference-size")?n.updateReferenceSizeSymbol(r,{innerDotSize:t,outerRingSize:24}):"cim"===r.type&&f.getAuthoringInfoVisualVariableByTheme(s,"spike")&&o.updateSpikeSymbol(r,{defaultHeight:t,primitiveOverrides:null}):r.width=t;return r}(k,i,t,s);return H&&"cim"===a.type&&(r=await h.getCIMSymbolPreviewSize(a)),{value:e,symbol:a,label:V?N[s]:W[s],size:r,outlineSize:q}}))).reverse()},t.getReferenceSizeSymbol=function(e,t,i,r){const o="class-breaks"===e.type,a=o?e.classBreakInfos?.[0]?.symbol?.clone():e.uniqueValueInfos?.[0]?.symbol?.clone();return a&&"type"in a&&"cim"===a.type?(n.updateReferenceSizeSymbol(a,{color:r??(o?null:new s(g)),innerDotSize:t*(24/i)||1,outerRingSize:24}),a):null},t.realWorldMaxSize=30,t.realWorldMinSize=12,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/renderers/support/spikeUtils":function(){define(["exports","../../../Color","../../../core/lang","../../../core/screenUtils","../../../symbols/CIMSymbol"],function(e,t,s,i,r){"use strict";const n="spike-height-override",o=i.px2pt(8),a=i.px2pt(20);function l(e){const{strokeColor:t,strokeWidth:s,symbolStyle:r}=e,n=r?.includes("solid-fill")||r?.includes("gradient-fill");let o=t?.toArray(),a=!1;return r?.includes("outline")&&n?a=!0:o=e.color?.toArray(),{type:"CIMSolidStroke",effects:c(r),enable:!0,colorLocked:a,capStyle:"Round",joinStyle:"Round",lineStyle3D:"Strip",miterLimit:4,width:s??i.px2pt(1),color:o}}function c(e){if(!e?.includes("closed"))return[{type:"CIMGeometricEffectAddControlPoints",angleTolerance:90,primitiveName:"spike-control-points"},{type:"CIMGeometricEffectSuppress",suppress:!0,invert:!0,primitiveName:"spike-stroke-suppress"}]}function h(e){const{color:t,symbolStyle:s}=e,i=s?.includes("solid-fill"),r=s?.includes("gradient-fill");if(!i&&!r||!t)return;if(i)return{type:"CIMSolidFill",enable:!0,colorLocked:!1,color:t?.toArray()};const n=t.clone();return n.a=0,{type:"CIMGradientFill",enable:!0,angle:90,colorRamp:{type:"CIMMultipartColorRamp",colorRamps:[{type:"CIMLinearContinuousColorRamp",fromColor:t.toArray(),toColor:n.toArray()}],weights:[1]},gradientMethod:"Linear",gradientSize:70,gradientSizeUnits:"Relative",gradientType:"Continuous"}}function u(e,t){if(!t)return;const s=e.indexOf(t);-1!==s&&e.splice(s,1)}e.createPrimitiveOverrides=function(e){const{field:t,normalizationField:s,sizeStops:i}=e,{value:r,size:o}=i[0],{value:a,size:l}=i[1];let c,h=0;return t&&(h=`$feature["${t}"]`,c=`\n      if(!HasValue($feature, "${t}")){\n        return 0;\n      }\n      $feature["${t}"];\n    `),s&&(h=`$feature["${t}"] / $feature["${s}"]`,c=`if(!HasValue($feature, "${t}") || !HasValue($feature, "${s}") || $feature["${s}"] <= 0){\n        return 0;\n      }\n      $feature["${t}"];\n      $feature["${s}"];`),[{type:"CIMPrimitiveOverride",primitiveName:n,propertyName:"Length",valueExpressionInfo:{type:"CIMExpressionInfo",title:"Custom",expression:`\n        ${c}\n        var value = ${h};\n\n        var maxSize = ${l};\n        var minSize = ${o};\n\n        var minDataValue = ${r};\n        var maxDataValue = ${a};\n\n        var ratio = Constrain(( value - minDataValue ) / ( maxDataValue - minDataValue ), 0, 1);\n\n        var size = Constrain(maxSize * ratio, minSize, maxSize);\n        return size;\n      `,returnType:"Default"}}]},e.createSpikeSymbol=function(e){const{primitiveOverrides:t,baseWidth:s,defaultHeight:i}=e,c=function(e){const t=[l(e)],s=h(e);return s&&t.push(s),t}(e);return new r({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",effects:[{type:"CIMGeometricEffectRadial",primitiveName:n,angle:90,length:i??a},{type:"CIMGeometricEffectTaperedPolygon",fromWidth:s??o,toWidth:1,length:5}],symbolLayers:c,haloSize:1,scaleX:1,angleAlignment:"Display"},primitiveOverrides:t}})},e.defaultSpikeSymbolStyle="triangle-solid-fill-open-outline",e.updateSpikeSymbol=function(e,i){const{defaultHeight:r,baseWidth:o,color:a,strokeColor:c,primitiveOverrides:p,symbolStyle:f,strokeWidth:d}=i,m="CIMPointSymbol"===e.data.symbol?.type?e.data.symbol:null,y=m?.symbolLayers;if(!y)return e;const g=m.effects,_=g?.find(e=>"CIMGeometricEffectTaperedPolygon"===e.type),b=g?.find(e=>"CIMGeometricEffectRadial"===e.type&&e.primitiveName===n);null!=o&&_&&(_.fromWidth=o),null!=r&&b&&(b.length=r);const x=y?.find(e=>"CIMSolidStroke"===e.type),S=y?.find(e=>"CIMSolidFill"===e.type),v=y?.find(e=>"CIMGradientFill"===e.type),w="CIMMultipartColorRamp"===v?.colorRamp?.type&&"CIMLinearContinuousColorRamp"===v.colorRamp.colorRamps[0]?.type?v.colorRamp.colorRamps[0]:null;if(f){const e=S?.color??w?.fromColor??x?.color,s=a??(e?new t(e):void 0),r=x?.color??e,n=c??(r?new t(r):void 0),o=f.includes("solid-fill"),p=f.includes("gradient-fill");if(o||p||u(y,S??v),s)if(o)u(y,v),S?S.color=s?.toArray():y.push(h({...i,color:s}));else if(p)if(u(y,S),v){if(w&&a){const e=s.clone();e.a=0,w.fromColor=s.toArray(),w.toColor=e.toArray()}}else y.push(h({...i,color:s}));if(x){const e=l({...i,strokeColor:n,color:s});x.effects=e.effects,x.color=e.color,x.width=e.width,x.colorLocked=e.colorLocked}}else if(x&&(c&&(x.color=c.toArray()),null!=d&&(x.width=d)),S&&a&&(S.color=a.toArray()),w&&a){const e=a.clone();e.a=0,w.fromColor=a.toArray(),w.toColor=e.toArray()}return void 0!==p&&(e.data.primitiveOverrides=s.clone(p)),e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/previewCIMSymbol":function(){define(["exports","../../core/screenUtils","../cim/CIMSymbolHelper","../cim/CIMSymbolRasterizer","../cim/OverrideHelper","../cim/utils","./renderUtils"],function(e,t,s,i,r,n,o){"use strict";const a=new i.CIMSymbolRasterizer(null),l=t.px2pt(22),c=t.px2pt(120),h=t.px2pt(50);async function u(e,t={},i){const o=t.cimOptions||t;i??=o.geometryType||n.mapCIMSymbolToGeometryType(e?.data?.symbol);const{feature:l,fieldMap:c,viewParams:h}=o,u=await r.OverrideHelper.resolveSymbolOverrides(e.data,l,null,c,i,null,h);if(!u)return null;(e=e.clone()).data={type:"CIMSymbolReference",symbol:u},e.data.primitiveOverrides=void 0;const p=[];return s.CIMSymbolHelper.fetchResources(u,a.resourceManager,p),s.CIMSymbolHelper.fetchFonts(u,a.resourceManager,p),p.length>0&&await Promise.all(p),s.CIMSymbolHelper.getEnvelope(u,null,a.resourceManager)}e.getCIMSymbolPreviewSize=u,e.previewCIMSymbol=async function(e,s={}){const{node:i,opacity:r,symbolConfig:p}=s,f=null!=p&&"object"==typeof p&&"isSquareFill"in p&&p.isSquareFill,d=s.cimOptions||s,m=d.geometryType||n.mapCIMSymbolToGeometryType(e?.data?.symbol),y=await async function(e,t,s){const i=t?.size;let r=null!=i&&"object"==typeof i&&"width"in i?i.width:i,n=null!=i&&"object"==typeof i&&"height"in i?i.height:i;if(!r||!n)if("esriGeometryPolygon"===s)r=n=t.maxSize?Math.min(t.maxSize,l):l;else{const i=await u(e,t,s);i&&(r=i.width,n=i.height),"esriGeometryPolyline"===s&&(r=t.maxSize?Math.min(t.maxSize,h):h),r=null!=r&&isFinite(r)?Math.min(r,c):l,n=null!=n&&isFinite(n)?Math.max(Math.min(n,c),1):l}return"legend"===t.style&&"esriGeometryPolyline"===s&&(r=h),{width:r,height:n}}(e,s,m),{feature:g,fieldMap:_}=d,b=s?.geometry||f||"esriGeometryPolygon"!==m?"preview":"legend";let x=y;const S=y;if(s?.geometry&&("esriGeometryPolygon"===m||"esriGeometryPolyline"===m)){const e=200;if(t.pt2px(y.width)<e||t.pt2px(y.height)<e){const s=y.width>y.height?t.px2pt(e)*y.height/y.width:t.px2pt(e);x={width:y.width>y.height?t.px2pt(e):t.px2pt(e)*y.width/y.height,height:s}}}const v=await a.rasterizeCIMSymbolAsync(e,g,x,b,_,m,null,d.viewParams,d.allowScalingUp,s?.geometry?.toJSON());if(!v)return null;const{width:w,height:C}=v,M=document.createElement("canvas");M.width=w,M.height=C,M.getContext("2d").putImageData(v,0,0);const P=t.pt2px(S.width),L=t.pt2px(S.height),I=new Image(P,L);I.src=M.toDataURL(),I.ariaLabel=s.ariaLabel??null,I.alt=s.ariaLabel??"",null!=r&&(I.style.opacity=`${r}`);let k=I;if(null!=s.effectView){const e={shape:{type:"image",x:0,y:0,width:P,height:L,src:I.src},fill:null,stroke:null,offset:[0,0]};k=o.renderSymbol([[e]],[P,L],s)}return i&&k&&i.appendChild(k),k},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolHelper":function(){define(["exports","../../core/BidiText","../../core/has","../../core/lang","../../core/Logger","../../core/RandomLCG","../../core/screenUtils","../../geometry/support/aaBoundingRect","../../geometry/support/boundsUtils","../Font","./CIMEffects","./CIMPlacements","./CIMSymbolDrawHelper","./defaultCIMValues","./utils","../support/defaults","../../views/2d/engine/vectorTiles/GeometryUtils","../../views/2d/engine/webgl/definitions","../../views/2d/engine/webgl/mesh/templates/shapingUtils","../../views/2d/layers/graphics/graphicsUtils"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d,m,y,g,_,b){"use strict";const x=Math.PI,S=x/2,v=Math.PI/180,w=96/72,C=()=>r.getLogger("esri.symbols.cim.CIMSymbolHelper");function M(e,t,s){switch(t.type){case"CIMSymbolReference":return M(e,t.symbol,s);case"CIMPointSymbol":null==s&&(s={x:0,y:0}),e.drawSymbol(t,s);break;case"CIMLineSymbol":null==s&&(s={paths:[[[0,0],[10,0]]]}),e.drawSymbol(t,s);break;case"CIMPolygonSymbol":null==s&&(s={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),e.drawSymbol(t,s);break;case"CIMTextSymbol":{const s={x:0,y:0};e.drawSymbol(t,s);break}case"CIMVectorMarker":{const s=new u.Placement;e.drawMarker(t,s);break}}return e.envelope()}function P(e){if(!e)return 0;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(e.offset);default:return 0}}function L(e){if(!e)return 0;switch(e.type){case"CIMGeometricEffectArrow":return Math.abs(.5*e.width);case"CIMGeometricEffectBuffer":return Math.abs(e.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(e.length);case"CIMGeometricEffectJog":return Math.abs(.5*e.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(d.getNumericValue(e.offsetX)),Math.abs(d.getNumericValue(e.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(e.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(e.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(e.fromWidth),Math.abs(e.toWidth));case"CIMGeometricEffectWave":return Math.abs(e.amplitude);case"CIMGeometricEffectDonut":return Math.abs(e.width)}}function I(e){if(!e)return 0;let t=0;for(const s of e)t+=L(s);return t}class k{static getEnvelope(e,t,s){if(!e)return null;const i=new p.EnvDrawHelper(s);if(Array.isArray(e)){let s;for(const r of e)s?s.union(M(i,r,t)):s=M(i,r,t);return s}return M(i,e,t)}static getTextureInfo(e,t,s,i,r){const n=i??this.getEnvelope(e,null,t);if(!n)return[0,0,0,0,1];const o=Math.max(n.width,n.height)*w;let a=null!=r?Math.max(r/o,1):1;a*=w,n.x*=a,n.y*=a,n.width*=a,n.height*=a,n.width=Math.max(Math.ceil(n.x+n.width)-Math.floor(n.x),1)-1,n.height=Math.max(Math.ceil(n.y+n.height)-Math.floor(n.y),1)-1;let l=n.x+.5*n.width,c=n.y+.5*n.height;return l+=n.x-Math.floor(n.x),c+=n.y-Math.floor(n.y),i||(n.width+=s,n.height+=s,l+=s/2,c+=s/2),[n.width,n.height,l,c,a]}static getTextureAnchor(e,t,s){const[i,r,n,o,a]=this.getTextureInfo(e,t,2,null,s);return[-n/i,-o/r,r/a*w]}static rasterize(e,t,s,i,r=!0,n){const[o,a,l,c,h]=this.getTextureInfo(t,i,2,s,n);e.width=o,e.height=a;const f=e.getContext("2d",{willReadFrequently:!0}),d=p.Transformation.createScale(h,-h);d.translate(.5*o-l,.5*a+c);const m=new p.CanvasDrawHelper(f,i,d);switch(t.type){case"CIMPointSymbol":{const e={type:"point",x:0,y:0};m.drawSymbol(t,e);break}case"CIMVectorMarker":{const e=new u.Placement;m.drawMarker(t,e);break}}const y=f.getImageData(0,0,e.width,e.height),g=new Uint8Array(y.data);if(r){let e;for(let t=0;t<g.length;t+=4)e=g[t+3]/255,g[t]=g[t]*e,g[t+1]=g[t+1]*e,g[t+2]=g[t+2]*e}return[g,e.width,e.height,-l/o,-c/a]}static fromTextSymbol(e){const{text:t}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:k.createCIMTextSymbolfromTextSymbol(e),textString:t}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:t,outline:s,width:i,xoffset:r,xscale:n,yoffset:o,yscale:a}=e,l=[],c={type:"CIMPolygonSymbol",symbolLayers:l};if(s){const e=B(s);e&&l.push(e)}let h=e.url;"esriPFS"===e.type&&e.imageData&&(h=e.imageData);const u="angle"in e?e.angle??0:0,p=(i??0)*(n||1),f=(t??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture",tintColor:null,url:h,height:f,width:p,offsetX:d.getNumericValue(r),offsetY:d.getNumericValue(o),rotation:d.getNumericValue(-u),colorSubstitutions:null}),c}static fromSimpleFillSymbol(e){const{color:t,style:s,outline:r}=e,n=[],a={type:"CIMPolygonSymbol",symbolLayers:n};if(r){const e=B(r);e&&n.push(e)}if(s&&"solid"!==s&&"none"!==s&&"esriSFSSolid"!==s&&"esriSFSNull"!==s){const e={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:F(t),capStyle:"Butt",joinStyle:"Miter",width:.75}]};let r=0;const a=o.px2pt(G(s)?8:10);switch(s){case"vertical":case"esriSFSVertical":r=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":r=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":r=45;break;case"cross":case"esriSFSCross":r=0}n.push({type:"CIMHatchFill",lineSymbol:e,offsetX:0,offsetY:0,rotation:r,separation:a}),"cross"===s||"esriSFSCross"===s?n.push({type:"CIMHatchFill",lineSymbol:i.clone(e),offsetX:0,offsetY:0,rotation:90,separation:a}):"diagonal-cross"!==s&&"esriSFSDiagonalCross"!==s||n.push({type:"CIMHatchFill",lineSymbol:i.clone(e),offsetX:0,offsetY:0,rotation:45,separation:a})}else!s||"solid"!==s&&"esriSFSSolid"!==s||n.push({type:"CIMSolidFill",enable:!0,color:F(t)});return a}static fromSimpleLineSymbol(e){const{cap:t,color:s,join:i,marker:r,miterLimit:n,style:o,width:a}=e;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:N(o,t),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const c=[];if(r){let e;switch(r.placement){case"begin-end":e="Both";break;case"begin":e="JustBegin";break;case"end":e="JustEnd";break;default:e="None"}const t=k.fromSimpleMarker(r,a,s).symbolLayers[0];t.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:e,offsetAlongLine:0},c.push(t)}return c.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?F(s):[0,0,0,0],capStyle:E(t),joinStyle:z(i),miterLimit:n,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:c}}static fromPictureMarker(e){const{angle:t,height:s,width:i,xoffset:r,yoffset:n}=e;let o=e.url;return"esriPMS"===e.type&&e.imageData&&(o=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture",tintColor:null,url:o,size:s,width:i,offsetX:d.getNumericValue(r),offsetY:d.getNumericValue(n),rotation:d.getNumericValue(-t)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:s,color:i,font:r,haloColor:n,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:h,verticalAlignment:u,xoffset:p,yoffset:f,backgroundColor:m,borderLineColor:y,borderLineSize:g}=e;let _,b,x,S,v,w;r&&(_=r.family,b=r.style,x=r.weight,S=r.size,v=r.decoration);let C=!1;return h&&(C=t.bidiText(h)[1]),(m||g)&&(w={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:F(m)},{type:"CIMSolidStroke",color:F(y),width:g}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:s,blockProgression:2,depth3D:1,extrapolateBaselines:!0,fontEffects:0,fontEncoding:1,fontFamilyName:_||"Arial",fontStyleName:O(b,x),fontType:0,haloSize:o,height:S,hinting:1,horizontalAlignment:R(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:d.getNumericValue(p),offsetY:d.getNumericValue(f),strikethrough:"line-through"===v,underline:"underline"===v,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:F(i)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:F(n)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:C?1:0,verticalAlignment:A(u??"baseline"),verticalGlyphOrientation:0,wordSpacing:100,billboardMode3D:2,callout:w}}static createPictureMarkerRasterizationParam(e){const{angle:t,height:s,width:i,xoffset:r,yoffset:n}=e,o=e.url??e.source?.url??e.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture",tintColor:null,url:o,size:s,width:i,offsetX:d.getNumericValue(r),offsetY:d.getNumericValue(n),rotation:d.getNumericValue(-t)}}:null}static createPictureFillRasterizationParam(e){const{width:t,height:s,xoffset:i,yoffset:r,url:n}=e;return n?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:"Picture",tintColor:null,url:n,width:t,height:s,offsetX:d.getNumericValue(i),offsetY:d.getNumericValue(r),rotation:0}}:null}static fromSimpleMarker(e,t,s){const{style:i}=e,r=e.color??s;if("path"===i||"esriSMSPath"===i){const t=[];if("outline"in e&&e.outline){const s=e.outline;t.push({type:"CIMSolidStroke",enable:!0,width:s.width,color:F(s.color),path:e.path})}t.push({type:"CIMSolidFill",enable:!0,color:F(r),path:e.path});const[s,i]=U("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-d.getNumericValue(e.angle),size:d.getNumericValue(e.size||6),offsetX:d.getNumericValue(e.xoffset),offsetY:d.getNumericValue(e.yoffset),scaleSymbolsProportionally:!1,frame:s,markerGraphics:[{type:"CIMMarkerGraphic",geometry:i,symbol:{type:"CIMPolygonSymbol",symbolLayers:t}}]}]}}const n=[];let o,a,l=e.size;if("outline"in e&&e.outline&&"none"!==e.outline.style&&"esriSLSNull"!==e.outline.style){const t=e.outline,s="solid"!==t.style&&"esriSLSSolid"!==t.style;[o,a]=s?U(i,e.size):U(i);const r=t.width??m.defaultPolylineSymbol2D.width;if(s){const t=r/e.size,s=(o.xmax-o.xmin)*t/2,i=(o.ymax-o.ymin)*t/2;o.xmin-=s,o.xmax+=s,o.ymin-=i,o.ymax+=i,l&&(l+=r)}const c="cross"!==e.style&&"x"!==e.style||"dot"===e?.outline.style||"short-dot"===e?.outline.style?"HalfGap":"FullPattern",h=s?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:N(t.style,null).map(e=>t.width&&t.width>0?e*t.width:e),lineDashEnding:c,controlPointEnding:"FullPattern"}]:void 0;n.push({type:"CIMSolidStroke",capStyle:s?"Round":"Butt",enable:!0,width:r,color:F(t.color),effects:h})}else!t||"line-marker"!==e.type||"cross"!==e.style&&"x"!==e.style?[o,a]=U(i):([o,a]=U(i),n.push({type:"CIMSolidStroke",enable:!0,width:t,color:F(r)}));n.push({type:"CIMSolidFill",enable:!0,color:F(r)});const c={type:"CIMPolygonSymbol",symbolLayers:n};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:d.getNumericValue(-e.angle),size:d.getNumericValue(l||6*t),offsetX:d.getNumericValue(e.xoffset),offsetY:d.getNumericValue(e.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:c}]}]}}static fromCIMHatchFill(e,t){const s=t*(e.separation??f.defaultCIMValues.CIMHatchFill.separation),r=s/2,n=i.clone(e.lineSymbol);n.symbolLayers?.forEach(e=>{switch(e.type){case"CIMSolidStroke":null!=e.width&&(e.width*=t),e.effects?.forEach(e=>{if("CIMGeometricEffectDashes"===e.type){const s=e.dashTemplate;e.dashTemplate=s?.map(e=>e*t)}});break;case"CIMVectorMarker":{null!=e.size&&(e.size*=t);const s=e.markerPlacement;null!=s&&"placementTemplate"in s&&(s.placementTemplate=s.placementTemplate.map(e=>e*t));break}}});let o=this._getLineSymbolPeriod(n)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-r,ymax:r},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:s}}static fetchResources(e,t,s,i=null){if(!e||!t)return s;switch(e.type){case"CIMMeshSymbol":case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":for(const t of e.effects||[])s.push(h.loadGeometryOperatorsForEffect(t))}return T(e,e=>{for(const t of e.effects||[])s.push(h.loadGeometryOperatorsForEffect(t));"url"in e&&e.url&&s.push(t.fetchResource(e.url,{signal:i}))}),s}static fetchFonts(e,t,s){if(e&&t)if("symbolLayers"in e&&e.symbolLayers){for(const i of e.symbolLayers)if("CIMVectorMarker"===i.type&&i.markerGraphics)for(const e of i.markerGraphics)e?.symbol&&k.fetchFonts(e.symbol,t,s)}else if("CIMTextSymbol"===e.type){const{fontFamilyName:i,fontStyleName:r}=e;if(!i||"calcitewebcoreicons"===i.toLowerCase())return;const{style:n,weight:o}=d.fromCIMFontStyle(r),a=d.fromCIMFontDecoration(e),l=new c({family:i,style:n,weight:o,decoration:a});s.push(t.loadFont(l).catch(()=>{C().error(`Unsupported font ${i} in CIM symbol`)}))}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const t of e.symbolLayers)if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=this._getPlacementRepeat(t.markerPlacement);if(e)return e}}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const s of e)t+=s;return 1&e.length&&(t*=2),t}break}case"CIMGeometricEffectWave":return t.period;default:C().error(`unsupported geometric effect type ${t.type}`)}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const s of t)e+=+s;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,s={...e};s.markerPlacement=null,s.anchorPoint=null;const i=Math.abs(t.stepX),r=Math.abs(t.stepY),a=(t.randomness??100)/100;let l,c,h,u;if("Random"===t.gridType){const e=o.px2pt(g.randomInsidePolygonTextureSize),s=Math.max(Math.floor(e/i),1),p=Math.max(Math.floor(e/r),1);l=s*i/2,c=p*r/2,h=2*c;const f=new n(t.seed),d=a*i/1.5,m=a*r/1.5;u=[];for(let e=0;e<s;e++)for(let t=0;t<p;t++){const s=e*i-l+d*(.5-f.getFloat()),n=t*r-c+m*(.5-f.getFloat());u.push({x:s,y:n}),0===e&&u.push({x:s+2*l,y:n}),0===t&&u.push({x:s,y:n+2*c})}}else!0===t.shiftOddRows?(l=i/2,c=r,h=2*r,u=[{x:-l,y:0},{x:l,y:0},{x:0,y:c},{x:0,y:-c}]):(l=i/2,c=r/2,h=r,u=[{x:-i,y:0},{x:0,y:-r},{x:-i,y:-r},{x:0,y:0},{x:i,y:0},{x:0,y:r},{x:i,y:r},{x:-i,y:r},{x:i,y:-r}]);return{type:"CIMVectorMarker",frame:{xmin:-l,xmax:l,ymin:-c,ymax:c},markerGraphics:u.map(e=>({type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[s]}})),size:h}}}function T(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const s=e.symbolLayers;if(!s)return;for(const e of s)if(t(e),"CIMVectorMarker"===e.type){const s=e.markerGraphics;if(!s)continue;for(const e of s)if(e){const s=e.symbol;s&&T(s,t)}}break}}}const E=e=>{if(!e)return"Butt";switch(e){case"butt":return"Butt";case"square":return"Square";case"round":return"Round"}},z=e=>{if(!e)return"Miter";switch(e){case"miter":return"Miter";case"round":return"Round";case"bevel":return"Bevel"}},R=e=>{if(null==e)return"Center";switch(e){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},A=e=>{if(null==e)return"Center";switch(e){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},F=e=>{if(!e)return[0,0,0,0];const{r:t,g:s,b:i,a:r}=e;return[t,s,i,255*r]},O=(e,t)=>{const s=V(t),i=D(e);return s&&i?`${s}-${i}`:`${s}${i}`},V=e=>{if(!e)return"";switch(e.toLowerCase()){case"bold":case"bolder":return"bold"}return""},D=e=>{if(!e)return"";switch(e.toLowerCase()){case"italic":case"oblique":return"italic"}return""},N=(e,t)=>{const i=s("safari")?.001:0,r="butt"===t;switch(e){case"dash":case"esriSLSDash":return r?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return r?[4,3,1,3]:[3,4,i,4];case"dot":case"esriSLSDot":return r?[1,3]:[i,4];case"long-dash":case"esriSLSLongDash":return r?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return r?[8,3,1,3]:[7,4,i,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return r?[8,3,1,3,1,3]:[7,4,i,4,i,4];case"short-dash":case"esriSLSShortDash":return r?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return r?[4,1,1,1]:[3,2,i,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return r?[4,1,1,1,1,1]:[3,2,i,2,i,2];case"short-dot":case"esriSLSShortDot":return r?[1,1]:[i,2];case"solid":case"esriSLSSolid":case"none":return C().error("Unexpected: style does not require rasterization"),[0,0];default:return C().error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),[0,0]}},U=(e,t=100)=>{const s=t/2;let i,r;const n=e;if("circle"===n||"esriSMSCircle"===n){const e=.25;let t=Math.acos(1-e/s),n=Math.ceil(x/t/4);0===n&&(n=1),t=S/n,n*=4;const o=[];o.push([s,0]);for(let e=1;e<n;e++)o.push([s*Math.cos(e*t),-s*Math.sin(e*t)]);o.push([s,0]),i={rings:[o]},r={xmin:-s,ymin:-s,xmax:s,ymax:s}}else if("cross"===n||"esriSMSCross"===n){const e=0;i={paths:[[[e,s],[e,-s]],[[s,e],[-s,e]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s}}else if("diamond"===n||"esriSMSDiamond"===n)i={rings:[[[-s,0],[0,s],[s,0],[0,-s],[-s,0]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s};else if("square"===n||"esriSMSSquare"===n)i={rings:[[[-s,-s],[-s,s],[s,s],[s,-s],[-s,-s]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s};else if("x"===n||"esriSMSX"===n)i={paths:[[[s,s],[-s,-s]],[[s,-s],[-s,s]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s};else if("triangle"===n||"esriSMSTriangle"===n){const e=.5773502691896257*t,s=-e,n=2/3*t,o=n-t;i={rings:[[[s,o],[0,n],[e,o],[s,o]]]},r={xmin:s,ymin:o,xmax:e,ymax:n}}else"arrow"===n&&(i={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},r={xmin:-s,ymin:-s,xmax:s,ymax:s});return[r,i]},G=e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e;function B(e){if(!e)return null;let t=null;const{cap:s,color:i,join:r,miterLimit:n,style:o,width:a}=e;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(t=[{type:"CIMGeometricEffectDashes",dashTemplate:N(o,s),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?F(i):[0,0,0,0],capStyle:E(s),joinStyle:z(r),miterLimit:n,width:a,effects:t}}e.CIMSymbolHelper=k,e.CIMSymbolInflatedSizeHelper=class{static getSymbolInflateSize(e,t,s,i,r){return e||(e=[0,0,0,0]),t?this._getInflateSize(e,t,s,i,r):e}static safeSize(e){const t=Math.max(Math.abs(e[0]),Math.abs(e[2])),s=Math.max(Math.abs(e[1]),Math.abs(e[3]));return Math.sqrt(t*t+s*s)}static _vectorMarkerBounds(e,t,s,i){let r=!0;const n=a.create();if(t?.markerGraphics)for(const o of t.markerGraphics){const t=[0,0,0,0];o.geometry&&(l.getBoundsXY(n,o.geometry),t[0]=0,t[1]=0,t[2]=0,t[3]=0,this.getSymbolInflateSize(t,o.symbol,s,0,i),n[0]+=t[0],n[1]+=t[1],n[2]+=t[2],n[3]+=t[3],r?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],r=!1):(e[0]=Math.min(e[0],n[0]),e[1]=Math.min(e[1],n[1]),e[2]=Math.max(e[2],n[2]),e[3]=Math.max(e[3],n[3])))}return e}static _getInflateSize(e,t,s,i,r){if(void 0!==t.symbolLayers){const n=this._getLayersInflateSize(e,t.symbolLayers,s,i,r),o=I(t.effects);return o>0&&(n[0]-=o,n[1]-=o,n[2]+=o,n[3]+=o),n}return this._getTextInflatedSize(e,t,r)}static _getLayersInflateSize(e,t,s,i,r){let n=!0;if(!t)return e;for(const o of t){if(!o)continue;let t=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=o;let s=e.width;null!=s&&("Square"===e.capStyle||"Miter"===e.joinStyle?s/=1.4142135623730951:s/=2,t[0]=-s,t[1]=-s,t[2]=s,t[3]=s);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const e=o;if("CIMVectorMarker"===o.type){const e=o;if(t=this._vectorMarkerBounds(t,e,s,r),e.frame){const s=(e.frame.xmin+e.frame.xmax)/2,i=(e.frame.ymin+e.frame.ymax)/2;if(t[0]-=s,t[1]-=i,t[2]-=s,t[3]-=i,null!=e.size){const s=e.size/(e.frame.ymax-e.frame.ymin);t[0]*=s,t[1]*=s,t[2]*=s,t[3]*=s}}}else if("CIMPictureMarker"===o.type){const i=o,r=s.getResource(i.url);let n=1;if(null!=r&&r.height&&(n=r.width/r.height),null!=e.size){const s=e.size/2,r=e.size*n*i.scaleX/2;t=[-r,-s,r,s]}}else if(null!=e.size){const s=e.size/2;t=[-s,-s,s,s]}if(e.anchorPoint){let s,i;"Absolute"===e.anchorPointUnits?(s=e.anchorPoint.x,i=e.anchorPoint.y):(s=e.anchorPoint.x*(t[2]-t[0]),i=e.anchorPoint.y*(t[3]-t[1]));const r=1.25*Math.sqrt(s*s+i*i);t[0]-=r,t[1]-=r,t[2]+=r,t[3]+=r}let n=d.getNumericValue(e.rotation);if(e.rotateClockwise&&(n=-n),i&&(n-=i),n){const e=v*n,s=Math.cos(e),i=Math.sin(e),r=a.create([y.cInfinity,y.cInfinity,-y.cInfinity,-y.cInfinity]);a.expandPointInPlace(r,[t[0]*s-t[1]*i,t[0]*i+t[1]*s]),a.expandPointInPlace(r,[t[0]*s-t[3]*i,t[0]*i+t[3]*s]),a.expandPointInPlace(r,[t[2]*s-t[1]*i,t[2]*i+t[1]*s]),a.expandPointInPlace(r,[t[2]*s-t[3]*i,t[2]*i+t[3]*s]),t=r}let l=d.getNumericValue(e.offsetX),c=d.getNumericValue(e.offsetY);if(i){const e=v*i,t=Math.cos(e),s=Math.sin(e),r=l*s+c*t;l=l*t-c*s,c=r}t[0]+=l,t[1]+=c,t[2]+=l,t[3]+=c;const h=P(e.markerPlacement);h>0&&(t[0]-=h,t[1]-=h,t[2]+=h,t[3]+=h);break}}const l=I(o.effects);l>0&&(t[0]-=l,t[1]-=l,t[2]+=l,t[3]+=l),n?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],n=!1):(e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[2]),e[3]=Math.max(e[3],t[3]))}return e}static _getTextInflatedSize(e,t,s){const i=b.roundPtToWholePixel(t.height??f.defaultCIMValues.CIMTextSymbol.height);if(e[0]=-i/2,e[1]=-i/2,e[2]=i/2,e[3]=i/2,!s)return e;const r=s.get(t);if(!r)return e;if(!r.glyphMosaicItems.glyphs.length)return e;const{lineGapType:n,lineGap:o}=t,a=n?p.lineGapType2LineHeight(n,o??0,i):0,l="CIMBackgroundCallout"===t.callout?.type,c=_.shapeGlyphs(r.glyphMosaicItems,{scale:i/g.glyphSize,angle:d.getNumericValue(t.angle),xOffset:d.getNumericValue(t.offsetX),yOffset:d.getNumericValue(t.offsetY),horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:b.getLineWidth(t.lineWidth),lineHeight:g.magicLabelLineHeight*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,h=Math.sqrt(c.width*c.width+c.height*c.height);return e[0]-=c.x+h,e[1]-=c.y-h,e[2]+=c.x+h,e[3]+=-c.y+h,e}},e.capTypeToEnum=E,e.getEffectsInflateSize=I,e.slsDashToTemplateArray=N,e.symbolToCIM=function(e){let t;switch(e.type){case"cim":return e.data;case"web-style":return e;case"simple-marker":{const s=k.fromSimpleMarker(e);if(!s)throw new Error("InternalError: Cannot convert symbol to CIM");t=s;break}case"picture-marker":t=k.fromPictureMarker(e);break;case"simple-line":t=k.fromSimpleLineSymbol(e);break;case"simple-fill":t=k.fromSimpleFillSymbol(e);break;case"picture-fill":t=k.fromPictureFillSymbol(e);break;case"text":t=k.fromTextSymbol(e)}return{type:"CIMSymbolReference",symbol:t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports","./BidiEngine"],function(e,t){"use strict";const s=new t;e.bidiText=function(e){if(null==e)return["",!1];if(!s.hasBidiChar(e))return[e,!1];let t;return t="rtl"===s.checkContextual(e)?"IDNNN":"ICNNN",[s.bidiTransform(e,t,"VLYSN"),!0]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiEngine":function(){define(["./bidiEngineTables"],function(e){"use strict";function t(e,r,n,a,l){const c=function(e,t,i){if(void 0===t.inFormat&&(t.inFormat=i.defInFormat),void 0===t.outFormat&&(t.outFormat=i.defOutFormat),void 0===t.swap&&(t.swap=i.defSwap),t.inFormat===t.outFormat)return t;const r=t.inFormat.slice(0,1),n=t.outFormat.slice(0,1);let o,a=t.inFormat.slice(1,4),l=t.outFormat.slice(1,4);return a.startsWith("C")&&(o=s(e),a="ltr"===o||"rtl"===o?o.toUpperCase():"L"===t.inFormat.charAt(2)?"LTR":"RTL",t.inFormat=r+a),l.startsWith("C")&&(o=s(e),"rtl"===o?l="RTL":"ltr"===o?(o=function(e){const t=e.split("");return t.reverse(),s(t.join(""))}(e),l=o.toUpperCase()):l="L"===t.outFormat.charAt(2)?"LTR":"RTL",t.outFormat=n+l),t}(e,{inFormat:r,outFormat:n,swap:a},l);if(c.inFormat===c.outFormat)return e;r=c.inFormat,n=c.outFormat,a=c.swap;const h=r.slice(0,1),u=r.slice(1,4),p=n.slice(0,1),f=n.slice(1,4);if(l.inFormat=r,l.outFormat=n,l.swap=a,"L"===h&&"VLTR"===n){if("LTR"===u)return l.dir=I,i(e,l);if("RTL"===u)return l.dir=k,i(e,l)}if("V"===h&&"V"===p)return l.dir="RTL"===u?k:I,o(e,l);if("L"===h&&"VRTL"===n)return"LTR"===u?(l.dir=I,e=i(e,l)):(l.dir=k,e=i(e,l)),o(e);if("VLTR"===r&&"LLTR"===n)return l.dir=I,i(e,l);if("V"===h&&"L"===p&&u!==f)return e=o(e),"RTL"===u?t(e,"LLTR","VLTR",a,l):t(e,"LRTL","VRTL",a,l);if("VRTL"===r&&"LRTL"===n)return t(e,"LRTL","VRTL",a,l);if("L"===h&&"L"===p){const s=l.swap;return l.swap=s.slice(0,1)+"N","RTL"===u?(l.dir=k,e=i(e,l),l.swap="N"+s.slice(1,3),l.dir=I,e=i(e,l)):(l.dir=I,e=i(e,l),l.swap="N"+s.slice(1,3),e=t(e,"VLTR","LRTL",l.swap,l)),e}return e}function s(e){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":""}function i(e,t){const s=e.split(""),i=[];return r(s,i,t),function(e,t,s){if(0!==s.hiLevel&&s.swap[0]!==s.swap[1])for(let s=0;s<e.length;s++)1===t[s]&&(e[s]=f(e[s]))}(s,i,t),u(2,s,i,t),u(1,s,i,t),C=i,s.join("")}function r(t,s,i){const r=t.length,o=i.dir?e.impTabRtl:e.impTabLtr;let a=0,l=-1;const c=[],h=[];i.hiLevel=i.dir,i.lastArabic=!1,i.hasUbatAl=!1,i.hasUbatB=!1,i.hasUbatS=!1;for(let e=0;e<r;e++)c[e]=n(t[e]);for(let n=0;n<r;n++){const r=a,u=p(t,c,h,n,i);h[n]=u,a=o[r][u];const f=240&a;a&=15;const d=o[a][P];if(s[n]=d,f>0)if(16===f){for(let e=l;e<n;e++)s[e]=1;l=-1}else l=-1;if(o[a][L])-1===l&&(l=n);else if(l>-1){for(let e=l;e<n;e++)s[e]=d;l=-1}c[n]===e.ubatB&&(s[n]=0),i.hiLevel|=d}i.hasUbatS&&function(t,s,i,r){for(let n=0;n<i;n++)if(t[n]===e.ubatS){s[n]=r.dir;for(let i=n-1;i>=0&&t[i]===e.ubatWs;i--)s[i]=r.dir}}(c,s,r,i)}function n(t){const s=t.charCodeAt(0),i=e.primaryTable[s>>8];return i<e.tbbase?i:e.unicodeTable[i-e.tbbase][255&s]}function o(e,t){const s=e.split("");if(t){const e=[];r(s,e,t),C=e}return s.reverse(),v.reverse(),s.join("")}function a(e,t,s){for(let i=0;i<t;i++)if(e[i]===s)return i;return-1}function l(t){for(let s=0;s<e.arabicAlefBetIntervalsBegine.length;s++)if(t>=e.arabicAlefBetIntervalsBegine[s]&&t<=e.arabicAlefBetIntervalsEnd[s])return!0;return!1}function c(e,t,s,i){for(;t*s<i&&g(e[t]);)t+=s;return!!(t*s<i&&l(e[t]))}function h(t,s,i,r){for(;s*i<r&&g(t[s]);)s+=i;let n=" ";if(!(s*i<r))return!1;n=t[s];for(let t=0;t<e.aLefTable.length;t++)if(e.aLefTable[t]===n)return!0;return!1}function u(e,t,s,i){if(i.hiLevel<e)return;if(1===e&&i.dir===k&&!i.hasUbatB)return t.reverse(),void v.reverse();const r=t.length;let n,o,a,l,c,h=0;for(;h<r;){if(s[h]>=e){for(n=h+1;n<r&&s[n]>=e;)n++;for(o=h,a=n-1;o<a;o++,a--)l=t[o],t[o]=t[a],t[a]=l,c=v[o],v[o]=v[a],v[a]=c;h=n}h++}}function p(t,s,i,r,n){const o=s[r];return{UBAT_L:()=>(n.lastArabic=!1,e.ubatL),UBAT_R:()=>(n.lastArabic=!1,e.ubatR),UBAT_ON:()=>e.ubatOn,UBAT_AN:()=>e.ubatAn,UBAT_EN:()=>n.lastArabic?e.ubatAn:e.ubatEn,UBAT_AL:()=>(n.lastArabic=!0,n.hasUbatAl=!0,e.ubatR),UBAT_WS:()=>e.ubatOn,UBAT_CS:()=>{let t,o;return r<1||r+1>=s.length||(t=i[r-1])!==e.ubatEn&&t!==e.ubatAn||(o=s[r+1])!==e.ubatEn&&o!==e.ubatAn?e.ubatOn:(n.lastArabic&&(o=e.ubatAn),o===t?o:e.ubatOn)},UBAT_ES:()=>(r>0?i[r-1]:e.ubatB)===e.ubatEn&&r+1<s.length&&s[r+1]===e.ubatEn?e.ubatEn:e.ubatOn,UBAT_ET:()=>{if(r>0&&i[r-1]===e.ubatEn)return e.ubatEn;if(n.lastArabic)return e.ubatOn;let t=r+1;const o=s.length;for(;t<o&&s[t]===e.ubatEt;)t++;return t<o&&s[t]===e.ubatEn?e.ubatEn:e.ubatOn},UBAT_NSM:()=>{if("VLTR"===n.inFormat){const i=s.length;let n=r+1;for(;n<i&&s[n]===e.ubatNsm;)n++;if(n<i){const i=t[r].charCodeAt(0),o=i>=1425&&i<=2303||64286===i,a=s[n];if(o&&(a===e.ubatR||a===e.ubatAl))return e.ubatR}}return r<1||s[r-1]===e.ubatB?e.ubatOn:i[r-1]},UBAT_B:()=>(n.lastArabic=!0,n.hasUbatB=!0,n.dir),UBAT_S:()=>(n.hasUbatS=!0,e.ubatOn),UBAT_LRE:()=>(n.lastArabic=!1,e.ubatOn),UBAT_RLE:()=>(n.lastArabic=!1,e.ubatOn),UBAT_LRO:()=>(n.lastArabic=!1,e.ubatOn),UBAT_RLO:()=>(n.lastArabic=!1,e.ubatOn),UBAT_PDF:()=>(n.lastArabic=!1,e.ubatOn),UBAT_BN:()=>e.ubatOn}[e.typesNames[o]]()}function f(t){let s,i=0,r=e.swapTable.length-1;for(;i<=r;)if(s=Math.floor((i+r)/2),t<e.swapTable[s][0])r=s-1;else{if(!(t>e.swapTable[s][0]))return e.swapTable[s][1];i=s+1}return t}function d(t){for(let s=0;s<e.standAlonForm.length;s++)if(e.standAlonForm[s]===t)return!0;return!1}function m(t){for(let s=0;s<e.baseForm.length;s++)if(t===e.baseForm[s])return e.medialForm[s];return t}function y(t,s){for(let i=0;i<e.baseForm.length;i++)if(t===e.baseForm[i])return s[i];return t}function g(e){return e>=""&&e<=""}function _(e){return"L"===e?"LTR":"R"===e?"RTL":"C"===e?"CLR":"D"===e?"CRL":""}function b(e,t,s,i){for(;t*s<i&&g(e[t]);)t+=s;return t*s<i&&(e[t]=" ",!0)}function x(t,s){for(let i=0;i<e.aLefTable.length;i++)if(t===e.aLefTable[i])return s[i];return t}function S(e,t,s,i){for(let r=0;r<e.length;r++)(e[r]>t||!s&&e[r]===t)&&(e[r]+=i)}let v=[],w=[],C=[];const M={dir:0,defInFormat:"LLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,defOutFormat:""},P=5,L=6,I=0,k=1,T=/^[(I|V)][(L|RCD)][(Y|N)][(S|N)]N$/,E=/[\u0591-\u06ff\ufb1d-\ufefc]/;return class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(s,i,r){if(this.sourceToTarget=[],this.targetToSource=[],!s)return"";if(function(e,t,s){v=[],C=[];for(let i=0;i<s;i++)e[i]=i,t[i]=i,v[i]=i}(this.sourceToTarget,this.targetToSource,s.length),!this.checkParameters(i,r))return s;i=this.inputFormat,r=this.outputFormat;let n=s;const o=M,u=_(i.charAt(1)),p=_(r.charAt(1)),f=(i.startsWith("I")?"L":i.charAt(0))+u,P=(r.startsWith("I")?"L":r.charAt(0))+p,L=i.charAt(2)+r.charAt(2);o.defInFormat=f,o.defOutFormat=P,o.defSwap=L;const I=t(s,f,P,L,o);let k=!1;return"R"===r.charAt(1)?k=!0:"C"!==r.charAt(1)&&"D"!==r.charAt(1)||(k="rtl"===this.checkContextual(I)),this.sourceToTarget=v,this.targetToSource=function(e){const t=new Array(e.length);for(let s=0;s<e.length;s++)t[e[s]]=s;return t}(this.sourceToTarget),w=this.targetToSource,n=i.charAt(3)===r.charAt(3)?I:"S"===r.charAt(3)?function(t,s){if(0===s.length)return"";void 0===t&&(t=!0);const i=(s=String(s)).split("");let r=0,n=1,o=i.length;t||(r=i.length-1,n=-1,o=1);const u=function(t,s,i,r){let n=0;const o=[];let a=0;for(let u=s;u*i<r;u+=i)if(l(t[u])||g(t[u])){if(""===t[u]&&h(t,u+i,i,r)){t[u]=x(t[u+i],0===n?e.lamAlefInialTableFE:e.lamAlefMedialTableFE),u+=i,b(t,u,i,r),o[a]=u,a++,n=0;continue}const s=t[u];1===n?t[u]=c(t,u+i,i,r)?m(t[u]):y(t[u],e.finalForm):!0===c(t,u+i,i,r)?t[u]=y(t[u],e.initialForm):t[u]=y(t[u],e.isolatedForm),g(s)||(n=1),!0===d(s)&&(n=0)}else n=0;return o}(i,r,n,o);let p="";for(let e=0;e<i.length;e++)a(u,u.length,e)>-1?(S(w,e,!t,-1),v.splice(e,1)):p+=i[e];return p}(k,I):function(t,s){if(0===t.length)return"";void 0===s&&(s=!0);let i="";const r=(t=String(t)).split("");for(let n=0;n<t.length;n++){let o=!1;if(r[n]>=""&&r[n]<"\ufeff"){const a=t.charCodeAt(n);r[n]>=""&&r[n]<=""?(s?(n>0&&" "===r[n-1]?i=i.slice(0,-1)+"":(i+="",o=!0),i+=e.aLefTable[(a-65269)/2]):(i+=e.aLefTable[(a-65269)/2],i+="",n+1<t.length&&" "===r[n+1]?n++:o=!0),o&&(S(w,n,!0,1),v.splice(n,0,v[n]))):i+=e.feTo06Table[a-65136]}else i+=r[n]}return i}(I,k),this.sourceToTarget=v,this.targetToSource=w,this.levels=C,n}_inputFormatSetter(e){if(!T.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!T.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,t){return e?this._inputFormatSetter(e):e=this.inputFormat,t?this._outputFormatSetter(t):t=this.outputFormat,e!==t}checkContextual(e){let t=s(e);if("ltr"!==t&&"rtl"!==t){try{t=document.dir.toLowerCase()}catch(e){}"ltr"!==t&&"rtl"!==t&&(t="ltr")}return t}hasBidiChar(e){return E.test(e)}}})},"esri/core/bidiEngineTables":function(){define(["exports"],function(e){"use strict";const t=10,s=11,i=12,r=18,n=[[r,r,r,r,r,r,r,r,r,6,5,6,8,5,r,r,r,r,r,r,r,r,r,r,r,r,r,r,5,5,5,6,8,4,4,s,s,s,4,4,4,4,4,t,9,t,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,r,r,r,r,r,r,5,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,9,4,s,s,s,s,4,4,4,4,0,4,4,r,4,4,s,s,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,1,i,1,i,i,1,i,i,1,i,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,s,s,7,9,7,4,4,i,i,i,i,i,i,i,i,i,i,i,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,3,3,3,3,3,3,3,3,3,3,s,3,3,7,7,7,i,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,i,i,i,i,i,i,i,3,4,i,i,i,i,i,i,7,7,i,i,4,i,i,i,i,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,i,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,i,i,i,i,i,i,i,i,i,i,i,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,i,i,i,i,i,i,i,i,i,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,r,r,r,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,s,s,s,s,s,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,r,r,r,r,r,4,4,4,4,4,r,r,r,r,r,r,2,0,4,4,2,2,2,2,2,2,t,t,4,4,4,0,2,2,2,2,2,2,2,2,2,2,t,t,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,s,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,i,1,1,1,1,1,1,1,1,1,1,t,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,i,i,i,i,i,i,i,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,s,4,4,t,t,4,4,4,4,4,s,s,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,r],[4,4,4,s,s,s,4,4,4,4,4,t,9,t,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,s,s,4,4,4,s,s,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];e.aLefTable=["","","",""],e.arabicAlefBetIntervalsBegine=["",""],e.arabicAlefBetIntervalsEnd=["",""],e.baseForm=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],e.feTo06Table=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],e.finalForm=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],e.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],e.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],e.initialForm=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],e.isolatedForm=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],e.lamAlefInialTableFE=["","","",""],e.lamAlefMedialTableFE=["","","",""],e.medialForm=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],e.primaryTable=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],e.standAlonForm=["","","","","","","","","","","","",""],e.swapTable=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""]],e.tbbase=100,e.typesNames=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],e.ubatAl=7,e.ubatAn=3,e.ubatB=5,e.ubatBn=18,e.ubatCs=9,e.ubatEn=2,e.ubatEs=10,e.ubatEt=11,e.ubatL=0,e.ubatLre=13,e.ubatLro=16,e.ubatNsm=12,e.ubatOn=4,e.ubatPdf=15,e.ubatR=1,e.ubatRle=14,e.ubatRlo=17,e.ubatS=6,e.ubatWs=8,e.unicodeTable=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["require","exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper","./utils"],function(e,t,s,i,r){"use strict";const n=r.importLazily(()=>new Promise((t,s)=>e(["../../geometry/operators/json/bufferOperator"],t,s))),o=r.importLazily(()=>new Promise((t,s)=>e(["../../geometry/operators/json/convexHullOperator"],t,s))),a=r.importLazily(()=>new Promise((t,s)=>e(["../../geometry/operators/json/lengthOperator"],t,s))),l=r.importLazily(()=>new Promise((t,s)=>e(["../../geometry/operators/json/generalizeOperator"],t,s))),c=r.importLazily(()=>new Promise((t,s)=>e(["../../geometry/operators/json/offsetOperator"],t,s))),h=r.importLazily(()=>new Promise((t,s)=>e(["../../geometry/operators/json/simplifyOperator"],t,s)));let u;t.SimpleEffectCursor=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}},t.clipCursorToTileExtent=function(e,t,r){if(!e)return null;u||(u=new i.TileClipper(0,0,0,1));const n=r?-1:1,o="esriGeometryPolygon"===e.geometryType,a=o?3:2,l=o?3:2;let c,h;for(u.reset(a),u.setPixelMargin(t+1),u.setExtent(512);e.nextPath();)if(!(e.pathSize<l)){for(e.nextPoint(),c=e.x,h=n*e.y,u.moveTo(c,h);e.nextPoint();)c=e.x,h=n*e.y,u.lineTo(c,h);o&&u.close()}const p=u.result(!1);if(p){const t=s.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);for(const e of p){t.startPath();for(const s of e)t.pushXY(s.x,n*s.y)}return t.reset(),t}return null},t.lazyBufferOperator=n,t.lazyConvexHullOperator=o,t.lazyGeneralizeOperator=l,t.lazyLengthOperator=a,t.lazyOffsetOperator=c,t.lazySimplifyOperator=h,t.loadGeometryOperatorsForEffect=function(e){switch(e.type){case"CIMGeometricEffectDonut":case"CIMGeometricEffectBuffer":return n.getImportPromise();case"CIMGeometricEffectEnclosingPolygon":return o.getImportPromise();case"CIMGeometricEffectOffset":return c.getImportPromise();case"CIMGeometricEffectTaperedPolygon":return Promise.all([h.getImportPromise(),a.getImportPromise(),l.getImportPromise()]);default:return Promise.resolve()}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(e,t,s,i,r){"use strict";class n{static fromOptimized(e,t,s=!1,i=!1,r=1){return(new o).initialize(e,t,s,i,r)}static fromJSON(e,t=!1,s=!1){const[i,r]=l(e);return(new c).initialize(i,r,t,s,1)}static fromOptimizedCIM(e,t,s=!1,i=!1,r=1){return(new h).initialize(e,t,s,i,r)}static fromJSONCIM(e,t=!1,s=!1,i=1){const[r,n]=l(e);return(new u).initialize(r,n,t,s,i)}static fromFeatureSetReader(e){const t=e.readGeometryForDisplay(),s=e.geometryType;return t&&s?this.fromOptimized(t,s):null}static fromFeatureSetReaderCIM(e){const t=e.readGeometryForDisplay(),s=e.geometryType;return t&&s?this.fromOptimizedCIM(t,s):null}static createEmptyOptimized(e,t=!1,s=!1,i=1){return(new o).initialize(new r,e,t,s,i)}static createEmptyJSON(e,t=!1,s=!1){return(new c).initialize([],e,t,s,1)}static createEmptyOptimizedCIM(e,t=!1,s=!1,i=1){return(new h).initialize(new r,e,t,s,i)}static createEmptyJSONCIM(e,t=!1,s=!1,i=1){return(new u).initialize([],e,t,s,i)}asJSON(){const e=s.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:e.flat()}:"esriGeometryPoint"===this.geometryType?{x:e[0][0][0],y:e[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,t,s=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,t=this.y;const i=e,r=t;for(;this.nextPoint();)s+=(e-this.x)*(t+this.y),e=this.x,t=this.y;return s+=(e-i)*(t+r),-.5*s}invertY(){this.yFactor*=-1}}class o extends n{constructor(){super(...arguments),this._end=-1}initialize(e,t,s,i,r){return this.hasZ=s,this.hasM=i,this.geometryType=t,this._stride=2+Number(s)+Number(i),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=r,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const t=this._pathOffset+e*this._stride;return t>=0&&t<this._end&&(this._pointOffset=t,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}getCurrentPath(){const e=this._end,t=this._geometry.coords,s=this._pathOffset;return(new o).initialize(new r([this.pathSize],t.slice(s,e)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const e=this._end,t=this._stride,s=this._geometry.coords;let i=0;for(let r=this._pathOffset+t;r<e;r+=t){const e=s[r-t],n=s[r-t+1],o=s[r]-e,a=s[r+1]-n;i+=Math.sqrt(o*o+a*a)}return i}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,t){this._geometry.coords.push(e,t),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const t of e)for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const t=e.asOptimized();this._geometry.coords.push(...t.coords),this._geometry.lengths.push(...t.lengths)}asOptimized(){const e=this._geometry.clone();if(1!==this.yFactor)for(let t=1;t<e.coords.length;t+=this._stride)e.coords[t]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,t=this._pathOffset,s=this._end-this._stride;for(let i=0;i<this._stride;i++)if(e[t+i]!==e[s+i])return!1;return!0}clone(){return(new o).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,t)=>e+t)}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function a(e){const t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t}function l(e){return i.isPolygon(e)?[e.rings,"esriGeometryPolygon"]:i.isPolyline(e)?[e.paths,"esriGeometryPolyline"]:i.isMultipoint(e)?[[e.points],"esriGeometryMultipoint"]:i.isExtent(e)?[[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],"esriGeometryEnvelope"]:i.isPoint(e)?[[[a(e)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class c extends n{initialize(e,t,s,i,r){return this._paths=e,this.geometryType=t,this.hasZ=s,this.hasM=i,this._pathIndex=this._pointIndex=-1,this.yFactor=r,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,t=this._currentPath;let s=0;for(let i=1;i<e;i++){const e=t[i-1],r=t[i],n=e[0],o=e[1],a=r[0]-n,l=r[1]-o;s+=Math.sqrt(a*a+l*l)}return s}startPath(){this._paths.push([])}getCurrentPath(){return(new c).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,t){this._paths[this.totalSize-1].push([e,t])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const t=s.collectMultipath(e);for(const e of t)this.pushPath(e)}asOptimized(){const e=new r;if("esriGeometryPoint"===this.geometryType)e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const t of this._paths){for(const s of t)e.coords.push(s[0]),e.coords.push(s[1]*this.yFactor),this.hasZ&&e.coords.push(s[2]),this.hasM&&e.coords.push(s[this._mIndex]);e.lengths.push(t.length)}return e}isClosed(){const e=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let s=0;s<e.length;s++)if(e[s]!==t[s])return!1;return!0}clone(){return(new c).initialize(t.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,t)=>e+t)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}}class h extends o{initialize(e,t,s,i,r){return super.initialize(e,t,s,i,r),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(e=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=(new h).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}}class u extends c{initialize(e,t,s,i,r){return super.initialize(e,t,s,i,r)}clone(){return(new u).initialize(t.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(e){this._paths[this.pathIndex][e][4]=1}getControlPointAt(e){return 1===this._paths[this.pathIndex][e][4]}}e.GeometryCursor=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(e){"use strict";class t{constructor(e,t){this.x=e,this.y=t}static fromArray(e){return new t(e[0],e[1])}clone(){return new t(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){return this.x=e,this.y=t,this}normalize(){const e=this.x,t=this.y,s=Math.sqrt(e*e+t*t);return this.x/=s,this.y/=s,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,t){return this.x+=e,this.y+=t,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}assignSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}rotate(e,t){const s=this.x,i=this.y;return this.x=s*e-i*t,this.y=s*t+i*e,this}rotateReverse(e,t){const s=this.x,i=this.y;return this.x=s*e+i*t,this.y=-s*t+i*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,t){const s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)}static add(e,s){return new t(e.x+s.x,e.y+s.y)}static sub(e,s){return new t(e.x-s.x,e.y-s.y)}}class s{constructor(e,t,s){this.ratio=e,this.x=t,this.y=s}}class i{static simplify(e,t,s){if(!s)return;const r=-t,n=e+t,o=-t,a=e+t,l=[],c=[],h=s.length;for(let e=0;e<h;++e){const t=s[e];if(!t||t.length<2)continue;let i,h=t[0];const u=t.length;for(let s=1;s<u;++s)i=t[s],h.x===i.x&&(h.x<=r&&(h.y>i.y?(l.push(e),l.push(s),l.push(0),l.push(-1)):(c.push(e),c.push(s),c.push(0),c.push(-1))),h.x>=n&&(h.y<i.y?(l.push(e),l.push(s),l.push(1),l.push(-1)):(c.push(e),c.push(s),c.push(1),c.push(-1)))),h.y===i.y&&(h.y<=o&&(h.x<i.x?(l.push(e),l.push(s),l.push(2),l.push(-1)):(c.push(e),c.push(s),c.push(2),c.push(-1))),h.y>=a&&(h.x>i.x?(l.push(e),l.push(s),l.push(3),l.push(-1)):(c.push(e),c.push(s),c.push(3),c.push(-1)))),h=i}if(0===l.length||0===c.length)return;i.fillParent(s,c,l),i.fillParent(s,l,c);const u=[];i.calcDeltas(u,c,l),i.calcDeltas(u,l,c),i.addDeltas(u,s)}static fillParent(e,t,s){const i=s.length,n=t.length;for(let o=0;o<n;o+=4){const n=t[o],a=t[o+1],l=t[o+2],c=e[n][a-1],h=e[n][a];let u=8092,p=-1;for(let t=0;t<i;t+=4){if(s[t+2]!==l)continue;const i=s[t],n=s[t+1],o=e[i][n-1],a=e[i][n];switch(l){case 0:case 1:if(r(c.y,o.y,a.y)&&r(h.y,o.y,a.y)){const e=Math.abs(a.y-o.y);e<u&&(u=e,p=t)}break;case 2:case 3:if(r(c.x,o.x,a.x)&&r(h.x,o.x,a.x)){const e=Math.abs(a.x-o.x);e<u&&(u=e,p=t)}}}t[o+3]=p}}static calcDeltas(e,t,s){const r=t.length;for(let n=0;n<r;n+=4){const r=[],o=i.calcDelta(n,t,s,r);e.push(t[n]),e.push(t[n+1]),e.push(t[n+2]),e.push(o)}}static calcDelta(e,t,s,r){const n=t[e+3];if(-1===n)return 0;const o=r.length;return o>1&&r[o-2]===n?0:(r.push(n),i.calcDelta(n,s,t,r)+1)}static addDeltas(e,t){const s=e.length;let i=0;for(let t=0;t<s;t+=4){const s=e[t+3];s>i&&(i=s)}for(let r=0;r<s;r+=4){const s=t[e[r]],n=e[r+1],o=i-e[r+3];switch(e[r+2]){case 0:s[n-1].x-=o,s[n].x-=o,1===n&&(s[s.length-1].x-=o),n===s.length-1&&(s[0].x-=o);break;case 1:s[n-1].x+=o,s[n].x+=o,1===n&&(s[s.length-1].x+=o),n===s.length-1&&(s[0].x+=o);break;case 2:s[n-1].y-=o,s[n].y-=o,1===n&&(s[s.length-1].y-=o),n===s.length-1&&(s[0].y-=o);break;case 3:s[n-1].y+=o,s[n].y+=o,1===n&&(s[s.length-1].y+=o),n===s.length-1&&(s[0].y+=o)}}}}const r=(e,t,s)=>e>=t&&e<=s||e>=s&&e<=t;e.Point=t,e.SimpleBuilder=class{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,s){this._line&&this._lines.push(this._line),this._line=[];const i=this._ratio;this._line.push(new t(e*i,s*i))}lineTo(e,s){const i=this._ratio;this._line.push(new t(e*i,s*i))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}},e.TileClipper=class{constructor(e,t,s,i=8,r=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=i,this._pixelMargin=r,this._tileSize=512*i,this._dz=e,this._yPos=t,this._xPos=s}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;const s=e>>this._dz;t>s&&(t=s),this._margin=t,this._xmin=s*this._xPos-t,this._ymin=s*this._yPos-t,this._xmax=this._xmin+s+2*t,this._ymax=this._ymin+s+2*t}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,s){this._pushLine(),this._prevIsIn=this._isIn(e,s),this._moveTo(e,s,this._prevIsIn),this._prevPt=new t(e,s),this._firstPt=new t(e,s),this._dist=0}lineTo(e,i){const r=this._isIn(e,i),n=new t(e,i),o=t.distance(this._prevPt,n);let a,l,c,h,u,p,f,d;if(r)this._prevIsIn?this._lineTo(e,i,!0):(a=this._prevPt,l=n,c=this._intersect(l,a),this._start=this._dist+o*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,a=n,c=this._intersect(l,a),this._lineTo(c.x,c.y,!0),this._lineTo(a.x,a.y,!1);else{const e=this._prevPt,t=n;if(e.x<=this._xmin&&t.x<=this._xmin||e.x>=this._xmax&&t.x>=this._xmax||e.y<=this._ymin&&t.y<=this._ymin||e.y>=this._ymax&&t.y>=this._ymax)this._lineTo(t.x,t.y,!1);else{const i=[];if((e.x<this._xmin&&t.x>this._xmin||e.x>this._xmin&&t.x<this._xmin)&&(h=(this._xmin-e.x)/(t.x-e.x),d=e.y+h*(t.y-e.y),d<=this._ymin?p=!1:d>=this._ymax?p=!0:i.push(new s(h,this._xmin,d))),(e.x<this._xmax&&t.x>this._xmax||e.x>this._xmax&&t.x<this._xmax)&&(h=(this._xmax-e.x)/(t.x-e.x),d=e.y+h*(t.y-e.y),d<=this._ymin?p=!1:d>=this._ymax?p=!0:i.push(new s(h,this._xmax,d))),(e.y<this._ymin&&t.y>this._ymin||e.y>this._ymin&&t.y<this._ymin)&&(h=(this._ymin-e.y)/(t.y-e.y),f=e.x+h*(t.x-e.x),f<=this._xmin?u=!1:f>=this._xmax?u=!0:i.push(new s(h,f,this._ymin))),(e.y<this._ymax&&t.y>this._ymax||e.y>this._ymax&&t.y<this._ymax)&&(h=(this._ymax-e.y)/(t.y-e.y),f=e.x+h*(t.x-e.x),f<=this._xmin?u=!1:f>=this._xmax?u=!0:i.push(new s(h,f,this._ymax))),0===i.length)u?p?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):p?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(i.length>1&&i[0].ratio>i[1].ratio)this._start=this._dist+o*i[1].ratio,this._lineTo(i[1].x,i[1].y,!0),this._lineTo(i[0].x,i[0].y,!0);else{this._start=this._dist+o*i[0].ratio;for(let e=0;e<i.length;e++)this._lineTo(i[e].x,i[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=o,this._prevIsIn=r,this._prevPt=n}close(){if(this._line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const s=this._line;let i=s.length;for(;i>=4&&(s[0].x===s[1].x&&s[0].x===s[i-2].x||s[0].y===s[1].y&&s[0].y===s[i-2].y);)s.pop(),s[0].x=s[i-2].x,s[0].y=s[i-2].y,--i}}result(e=!0){return this._pushLine(),0===this._lines.length?null:(3===this._type&&e&&i.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(2!==this._type)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,t=e.length;if(0===t)return null;const s=[];for(let i=0;i<t;i++)s.push({line:e[i],start:this._starts[i]||0});return s}_isIn(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_intersect(e,s){let i,r,n;if(s.x>=this._xmin&&s.x<=this._xmax)r=s.y<=this._ymin?this._ymin:this._ymax,n=(r-e.y)/(s.y-e.y),i=e.x+n*(s.x-e.x);else if(s.y>=this._ymin&&s.y<=this._ymax)i=s.x<=this._xmin?this._xmin:this._xmax,n=(i-e.x)/(s.x-e.x),r=e.y+n*(s.y-e.y);else{r=s.y<=this._ymin?this._ymin:this._ymax,i=s.x<=this._xmin?this._xmin:this._xmax;const t=(i-e.x)/(s.x-e.x),o=(r-e.y)/(s.y-e.y);t<o?(n=t,r=e.y+t*(s.y-e.y)):(n=o,i=e.x+o*(s.x-e.x))}return this._r=n,new t(i,r)}_pushLine(){this._line&&(1===this._type?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):2===this._type?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):3===this._type&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,s,i){3!==this._type?i&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new t(e,s))):(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.push(new t(e,s)),this._isH=!1,this._isV=!1)}_lineTo(e,s,i){let r,n;if(3!==this._type)if(i){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(r=this._line[this._line.length-1],r.equals(e,s)))return;this._line.push(new t(e,s))}else this._line&&this._line.length>0&&this._pushLine();else if(i||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),s<this._ymin&&(s=this._ymin),s>this._ymax&&(s=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),s=Math.round((s-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){r=this._line[this._line.length-1];const i=r.x===e,o=r.y===s;if(i&&o)return;this._isH&&i||this._isV&&o?(r.x=e,r.y=s,n=this._line[this._line.length-2],n.x===e&&n.y===s?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(n=this._line[this._line.length-2],this._isH=n.x===e,this._isV=n.y===s)):(this._isH=n.x===e,this._isV=n.y===s)):(this._line.push(new t(e,s)),this._isH=i,this._isV=o)}else this._line.push(new t(e,s))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],function(e){"use strict";e.Placement=class{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rzCos=e,this.rzSin=t}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define(["exports","../../core/fontUtils","../../core/has","../../core/lang","../../core/Logger","../../core/mathUtils","../../core/ObjectPool","../../core/screenUtils","../../geometry/GeometryCursor","../../geometry/support/aaBoundingRect","../../geometry/support/boundsUtils","../../geometry/support/centroid","../../geometry/support/jsonUtils","./CIMEffects","./CIMImageColorSubstitutionHelper","./CIMOperators","./CIMPlacements","./defaultCIMValues","./imageUtils","./mathUtils","./rasterizingUtils","./Rect","./TextRasterizer","./utils","../../views/2d/engine/svgUtils","../../views/2d/engine/webgl/definitions","../../views/2d/engine/webgl/mesh/templates/shapingUtils","../../views/2d/layers/graphics/graphicsUtils"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d,m,y,g,_,b,x,S,v,w,C,M,P,L){"use strict";const I=Math.PI/180,k=()=>r.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");class T{constructor(e){this._t=e}static createIdentity(){return new T([1,0,0,0,1,0])}clone(){const e=this._t;return new T(e.slice())}transform(e){const t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(e,t){return new T([e,0,0,0,t,0])}scale(e,t){const s=this._t;return s[0]*=e,s[1]*=e,s[2]*=e,s[3]*=t,s[4]*=t,s[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,t){return new T([0,0,e,0,0,t])}translate(e,t){const s=this._t;return s[2]+=e,s[5]+=t,this}static createRotate(e){const t=Math.cos(e),s=Math.sin(e);return new T([t,-s,0,s,t,0])}rotate(e){return T.multiply(this,T.createRotate(e),this)}angle(){const e=this._t[0],t=this._t[3],s=Math.sqrt(e*e+t*t);return[e/s,t/s]}static multiply(e,t,s){const i=e._t,r=t._t,n=i[0]*r[0]+i[3]*r[1],o=i[1]*r[0]+i[4]*r[1],a=i[2]*r[0]+i[5]*r[1]+r[2],l=i[0]*r[3]+i[3]*r[4],c=i[1]*r[3]+i[4]*r[4],h=i[2]*r[3]+i[5]*r[4]+r[5],u=s._t;return u[0]=n,u[1]=o,u[2]=a,u[3]=l,u[4]=c,u[5]=h,s}invert(){const e=this._t;let t=e[0]*e[4]-e[1]*e[3];if(0===t)return new T([0,0,0,0,0,0]);t=1/t;const s=(e[1]*e[5]-e[2]*e[4])*t,i=(e[2]*e[3]-e[0]*e[5])*t,r=e[4]*t,n=-e[1]*t,o=-e[3]*t,a=e[0]*t;return new T([r,n,s,o,a,i])}}class E{constructor(e,t){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new o(y.Placement,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(t||T.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}setTransform(e,t){this._transfos=[e||T.createIdentity()],this._sizeTransfos=[t||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,t){const s=t?e.scaleRatio():1;T.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*s)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t,s){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t);break;case"CIMTextSymbol":this.drawTextSymbol(e,t,s)}}drawMultiLayerSymbol(e,t){if(!e||!t)return;const s=e.symbolLayers;if(!s)return;const i=e.effects;if(i&&i.length>0){const e=this.executeEffects(i,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayers(s,t.asJSON()),t=e.next()}}else this.drawSymbolLayers(s,t)}executeEffects(e,t){let s=new f.SimpleEffectCursor(l.GeometryCursor.fromJSONCIM(t));for(const t of e){const e=m.getEffectOperator(t);e&&(s=e.execute(s,t,this.geomUnitsPerPoint(),null))}return s}drawSymbolLayers(e,t){let s=e.length;for(;s--;){const i=e[s];if(!i||!1===i.enable)continue;const r=i.effects;if(r&&r.length>0){const e=this.executeEffects(r,t);if(e){let t=null;for(;(t=e.next())&&(this.drawSymbolLayer(i,t.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(i,t);if(this._earlyReturn)return}}drawSymbolLayer(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color,e.path);break;case"CIMHatchFill":this.drawHatchFill(t,e);break;case"CIMPictureFill":this.drawPictureFill(t,e);break;case"CIMGradientFill":this.drawGradientFill(t,e);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit,e.path);break;case"CIMPictureStroke":this.drawPictureStroke(t,e);break;case"CIMGradientStroke":this.drawGradientStroke(t,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){const s=function(e,t,s){let i=w.getNumericValue(e.separation,g.defaultCIMValues.CIMHatchFill.separation)*s,r=w.getNumericValue(e.rotation);if(0===i)return null;i<0&&(i=-i);let n=0;const o=.5*i;for(;n>o;)n-=i;for(;n<-o;)n+=i;const a=c.create();h.getBoundsXY(a,t),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;r>180;)r-=180;for(;r<0;)r+=180;const u=Math.cos(r*I),p=Math.sin(r*I),f=-i*p,d=i*u;let m,y,_,b;n=w.getNumericValue(e.offsetX)*s*p-w.getNumericValue(e.offsetY)*s*u,m=_=Number.MAX_VALUE,y=b=-Number.MAX_VALUE;for(const e of l){const t=e[0],s=e[1],i=u*t+p*s,r=-p*t+u*s;m=Math.min(m,i),_=Math.min(_,r),y=Math.max(y,i),b=Math.max(b,r)}_=Math.floor(_/i)*i;let x=u*m-p*_-f*n/i,S=p*m+u*_-d*n/i,v=u*y-p*_-f*n/i,C=p*y+u*_-d*n/i;const M=1+Math.round((b-_)/i),P=[];for(let e=0;e<M;e++)x+=f,S+=d,v+=f,C+=d,P.push([[x,S],[v,C]]);return{paths:P}}(t,e,this.geomUnitsPerPoint());s&&(this.pushClipPath(e),this.drawMultiLayerSymbol(t.lineSymbol,s),this.popClipPath())}drawPictureFill(e,t){}drawGradientFill(e,t){}drawPictureStroke(e,t){}drawGradientStroke(e,t){}drawMarkerLayer(e,t){const s=e.markerPlacement;if(s){const i=m.getPlacementOperator(s);if(i){const r="CIMMarkerPlacementInsidePolygon"===s.type||"CIMMarkerPlacementPolygonCenter"===s.type&&s.clipAtBoundary;r&&this.pushClipPath(t);const n=i.execute(l.GeometryCursor.fromJSONCIM(t),s,this.geomUnitsPerPoint(),null);if(n){let t=null;for(;(t=n.next())&&(this.drawMarker(e,t),!this._earlyReturn););}r&&this.popClipPath()}}else{const s=this._placementPool.acquire();if(p.isPoint(t))s.tx=t.x,s.ty=t.y,this.drawMarker(e,s);else if(p.isPolygon(t)){const i=u.polygonCentroid(t);i&&([s.tx,s.ty]=i,this.drawMarker(e,s))}else if(p.isPolyline(t)){for(const i of t.paths)for(const t of i)if(s.tx=t[0],s.ty=t[1],this.drawMarker(e,s),this._earlyReturn)break}else for(const i of t.points)if(s.tx=i[0],s.ty=i[1],this.drawMarker(e,s),this._earlyReturn)break;this._placementPool.release(s)}}drawMarker(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){if(!e)return;const s=this._resourceManager.getResource(e.url),i=w.getNumericValue(e.size,g.defaultCIMValues.CIMPictureMarker.size);if(null==s||i<=0)return;const r=s.width,n=s.height;if(!r||!n)return;const o=r/n,a=w.getNumericValue(e.scaleX,1),l=T.createIdentity(),c=e.anchorPoint;if(c){let t=c.x,s=c.y;"Absolute"!==e.anchorPointUnits&&(t*=i*o*a,s*=i),l.translate(-t,-s)}let h=w.getNumericValue(e.rotation);e.rotateClockwise&&(h=-h),this._mapRotation&&(h+=this._mapRotation),h&&l.rotate(h*I);let u=w.getNumericValue(e.offsetX),p=w.getNumericValue(e.offsetY);if(u||p){if(this._mapRotation){const e=I*this._mapRotation,t=Math.cos(e),s=Math.sin(e),i=u*s+p*t;u=u*t-p*s,p=i}l.translate(u,p)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const d=t.getAngle();d&&l.rotate(d),l.translate(t.tx,t.ty),this.push(l,!1),this.drawImage(e,i),this.pop()}drawVectorMarker(e,t){if(!e)return;const s=e.markerGraphics;if(!s)return;const i=w.getNumericValue(e.size,g.defaultCIMValues.CIMVectorMarker.size),r=e.frame,n=r?r.ymax-r.ymin:0,o=i&&n?i/n:1,a=T.createIdentity();r&&a.translate(.5*-(r.xmax+r.xmin),.5*-(r.ymax+r.ymin));const l=e.anchorPoint;if(l){let t=l.x,s=l.y;"Absolute"!==e.anchorPointUnits?r&&(t*=r.xmax-r.xmin,s*=r.ymax-r.ymin):(t/=o,s/=o),a.translate(-t,-s)}1!==o&&a.scale(o,o);let c=w.getNumericValue(e.rotation);e.rotateClockwise&&(c=-c),this._mapRotation&&(c+=this._mapRotation),c&&a.rotate(c*I);let h=w.getNumericValue(e.offsetX),u=w.getNumericValue(e.offsetY);if(h||u){if(this._mapRotation){const e=I*this._mapRotation,t=Math.cos(e),s=Math.sin(e),i=h*s+u*t;h=h*t-u*s,u=i}a.translate(h,u)}const p=this.geomUnitsPerPoint();1!==p&&a.scale(p,p);const f=t.getAngle();f&&a.rotate(f),a.translate(t.tx,t.ty),this.push(a,e.scaleSymbolsProportionally);for(const e of s){e?.symbol&&e.geometry||k().error("Invalid marker graphic",e);let t=e.textString;if("number"==typeof t&&(t=t.toString()),this.drawSymbol(e.symbol,e.geometry,t),this._earlyReturn)break}this.pop()}drawTextSymbol(e,t,s){if(!e)return;if(!p.isPoint(t))return;if(w.getNumericValue(e.height,g.defaultCIMValues.CIMTextSymbol.height)<=0)return;const i=T.createIdentity();let r=w.getNumericValue(e.angle);r=-r,r&&i.rotate(r*I);const n=w.getNumericValue(e.offsetX),o=w.getNumericValue(e.offsetY);(n||o)&&i.translate(n,o);const a=this.geomUnitsPerPoint();1!==a&&i.scale(a,a),i.translate(t.x,t.y),this.push(i,!1),this.drawText(e,s),this.pop()}}function z(e,t,s){for(const i of t){const t=i.length;for(let r=1;r<t;r++){const t=i[r-1],n=i[r];let o=(n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1]);if(0===o)continue;o=Math.sqrt(o);const a=((n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0]))/o;if(Math.abs(a)<s){const i=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/o;if(i>-s&&i<o+s)return!0}}}return!1}function R(e,t){const s=t[0]-e[0],i=t[1]-e[1];return 180/Math.PI*Math.atan2(i,s)}const A=e=>e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null,F=(e,t,s)=>{switch(e){case"ExtraLeading":return 1+t/s;case"Multiple":return t;case"Exact":return t/s}};function O(e,s=1){const i=w.fromCIMFontDecoration(e),r=w.fromCIMFontStyle(e.fontStyleName),n=e.fontFamilyName??t.defaultFontFamily,{weight:o,style:a}=r,l=s*(e.height||5),c=w.fromCIMHorizontalAlignment(e.horizontalAlignment),h=w.fromCIMVerticalAlignment(e.verticalAlignment),u=w.getFillColor(e),p=w.getFillColor(e.haloSymbol),f=null!=p?s*(e.haloSize??0):0,d=w.getStrokeColor(e.symbol),m=s*(w.getStrokeWidth(e.symbol)||0),y="CIMBackgroundCallout"===e.callout?.type?e.callout.backgroundSymbol:null,g=w.getFillColor(y),_=w.getStrokeWidth(y),b=w.getStrokeColor(y);return{color:u,size:l,horizontalAlignment:c,verticalAlignment:h,font:{family:n,style:w.getFontStyle(a),weight:w.getFontWeight(o),decoration:i},outline:{size:m||0,color:d},halo:{size:f||0,color:p,style:a},backgroundColor:g,borderLine:null!=_&&null!=b?{size:_,color:b}:null,pixelRatio:1,premultiplyColors:!0}}function V(e){let t,s,i,r,n,o=e[0],a=1;for(;a<e.length;)t=e[a][0]-o[0],s=e[a][1]-o[1],r=0!==t?s/t:Math.PI/2,void 0!==i&&Math.abs(r-i)<=1e-4?(e.splice(a-1,1),o=n):(n=o,o=e[a],a++),i=r}e.CIMSymbolDrawHelper=E,e.CanvasDrawHelper=class extends E{constructor(e,t,s,i){super(t,s),this._applyAdditionalRenderProps=i,this._colorSubstitutionHelper=new d,this._ctx=e}drawSolidFill(e,t){if(!e)return;if(p.isPolygon(e))this._buildPath(e.rings,!0);else if(p.isPolyline(e))this._buildPath(e.paths,!0);else if(p.isExtent(e))this._buildPath(A(e).rings,!0);else{if(!p.isMultipoint(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const s=this._ctx;s.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",s.fill("evenodd")}drawSolidStroke(e,t,s,i,r,n){if(!e||!t||0===s)return;if(p.isPolygon(e))this._buildPath(e.rings,!0);else if(p.isPolyline(e))this._buildPath(e.paths,!1);else{if(!p.isExtent(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(A(e).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(s),.5),this._setCapStyle(i),this._setJoinStyle(r),o.miterLimit=n,o.stroke()}pushClipPath(e){if(this._ctx.save(),p.isPolygon(e))this._buildPath(e.rings,!0);else if(p.isPolyline(e))this._buildPath(e.paths,!0);else{if(!p.isExtent(e))return;this._buildPath(A(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,t){const{colorSubstitutions:s,url:i,tintColor:r}=e,n=w.getNumericValue(e.scaleX,1),o=this._resourceManager.getResource(i);if(null==o)return;let a=t*(o.width/o.height),l=t;t||(a=o.width,l=o.height);const c=w.isSVGImage(i)||"src"in o&&w.isSVGImage(o.src);let h="getFrame"in o?_.getFirstFrame(o):o;s&&(h=this._colorSubstitutionHelper.applyColorSubstitution(h,s)),this._applyAdditionalRenderProps&&!c&&r&&(h=this._colorSubstitutionHelper.tintImageData(h,r));const u=this.transformPt([0,0]),[p,f]=this.getTransformAngle(),d=this.transformSize(1),m=this._ctx;m.save(),m.setTransform({m11:n*d*p,m12:n*d*f,m21:-d*f,m22:d*p,m41:u[0],m42:u[1]}),m.drawImage(h,-a/2,-l/2,a,l),m.restore()}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new v);const s=O(e,this.transformSize(a.px2pt(1))),i=this._textRasterizer.rasterizeText(t,s);if(!i)return;const{size:r,anchorX:n,anchorY:o,canvas:l}=i,c=r[0]*(n+.5),h=r[1]*(o-.5),u=this._ctx,p=this.transformPt([0,0]),[f,d]=this.getTransformAngle();u.save(),u.setTransform({m11:1*f,m12:1*d,m21:-1*d,m22:1*f,m41:p[0]-1*c,m42:p[1]+1*h}),u.drawImage(l,0,0),u.restore()}drawPictureFill(e,t){if(!e)return;let{colorSubstitutions:s,height:i,offsetX:r,offsetY:n,rotation:o,scaleX:a,tintColor:l,url:c}=t;const h=this._resourceManager.getResource(c);if(null==h)return;if(p.isPolygon(e))this._buildPath(e.rings,!0);else if(p.isPolyline(e))this._buildPath(e.paths,!0);else if(p.isExtent(e))this._buildPath(A(e).rings,!0);else{if(!p.isMultipoint(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const u=this._ctx,f=w.isSVGImage(c)||"src"in h&&w.isSVGImage(h.src);let d,m="getFrame"in h?_.getFirstFrame(h):h;if(s&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,s)),this._applyAdditionalRenderProps){f||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)),d=u.createPattern(m,"repeat");const e=this.transformSize(1);o||(o=0),r?r*=e:r=0,n?n*=e:n=0,i&&(i*=e);const t=i?i/h.height:1,s=a&&i?a*i/h.width:1;if(0!==o||1!==t||1!==s||0!==r||0!==n){const e=new DOMMatrix;e.rotateSelf(0,0,-o).translateSelf(r,n).scaleSelf(s,t,1),d.setTransform(e)}}else d=u.createPattern(m,"repeat");u.save(),u.fillStyle=d,u.fill("evenodd"),u.restore()}drawPictureStroke(e,t){if(!e)return;let{colorSubstitutions:s,capStyle:r,joinStyle:n,miterLimit:o,tintColor:l,url:c,width:h}=t;const u=this._resourceManager.getResource(c);if(null==u)return;let f;if(p.isPolygon(e))f=e.rings;else if(p.isPolyline(e))f=e.paths;else{if(!p.isExtent(e))return p.isMultipoint(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;f=A(e).rings}h||(h=u.width);const d=w.isSVGImage(c)||"src"in u&&w.isSVGImage(u.src);let m="getFrame"in u?_.getFirstFrame(u):u;s&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,s)),this._applyAdditionalRenderProps&&(d||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)));const y=Math.max(this.transformSize(a.pt2px(h)),.5),g=y/m.width,b=this._ctx,x=b.createPattern(m,"repeat-y");let S,v;b.save(),this._setCapStyle(r),this._setJoinStyle(n),void 0!==o&&(b.miterLimit=o),b.lineWidth=y;for(let e of f)if(e=i.clone(e),V(e),e&&!(e.length<=1)){S=this.transformPt(e[0]);for(let t=1;t<e.length;t++){v=this.transformPt(e[t]);const s=R(S,v),i=new DOMMatrix;i.translateSelf(0,S[1]-y/2).scaleSelf(g,g,1).rotateSelf(0,0,90-s),x.setTransform(i),b.strokeStyle=x,b.beginPath(),b.moveTo(S[0],S[1]),b.lineTo(v[0],v[1]),b.stroke(),S=v}}b.restore()}drawGradientFill(e,t){if(!e)return;let s;if(p.isPolygon(e))s=e.rings;else if(p.isPolyline(e))s=e.paths;else{if(!p.isExtent(e))return void k().error("Unable to draw gradient fill");s=A(e).rings}this._buildPath(s,!0);const{angle:i,gradientMethod:r,gradientSize:o,gradientSizeUnits:l}=t,h=g.defaultCIMValues.CIMGradientFill,u=t.gradientType??h.gradientType,f=-n.deg2rad(i??0),d=c.empty();for(const e of s){const t=e?e.length:0;if(t>1)for(let s=0;s<t;s++){let t=this.transformPt(e[s]);"Linear"!==r&&"Rectangular"!==r||(t=b.rotate(t,-f)),c.expandPointInPlace(d,t)}}const[m,y,_,S]=d,v=this._ctx;switch(v.save(),r){case"Buffered":k().error(`Gradient method "${r}" currently unsupported.`);break;case"Linear":{const e=(y+S)/2,s="Absolute"===l?this.transformSize(a.pt2px(o)):w.getRelativeGradientSize(o,h.gradientSize)*(_-m),[i,r]="Discrete"===u?[_,_-s]:[m+s,m],n=b.rotate([i,e],f),c=b.rotate([r,e],f),p=v.createLinearGradient(n[0],n[1],c[0],c[1]);x.addColorStops(p,t),v.fillStyle=p,v.fill("evenodd");break}case"Circular":{const e=c.center(d),s=c.diagonal(d)/2,i="Absolute"===l?this.transformSize(a.pt2px(o)):w.getRelativeGradientSize(o,h.gradientSize)*s,[r,n]="Discrete"===u?[s,s-i]:[i,0],p=v.createRadialGradient(e[0],e[1],r,e[0],e[1],n);x.addColorStops(p,t),v.fillStyle=p,v.fill("evenodd");break}case"Rectangular":{const s=c.center(d),i=s[0],r=s[1],n=b.rotate(s,f),p=(s,i,r,o,a,l,c,h)=>{v.save(),this.pushClipPath(e);const u=b.rotate([a,l],f),p=b.rotate([c,h],f);v.beginPath(),v.moveTo(n[0],n[1]),v.lineTo(u[0],u[1]),v.lineTo(p[0],p[1]),v.lineTo(n[0],n[1]),v.clip();const d=b.rotate([s,i],f),m=b.rotate([r,o],f),y=v.createLinearGradient(d[0],d[1],m[0],m[1]);x.addColorStops(y,t),v.fillStyle=y,v.fill("evenodd"),v.restore()};let g="Absolute"===l?this.transformSize(a.pt2px(o)):w.getRelativeGradientSize(o,h.gradientSize)*(c.width(d)/2),[C,M]="Discrete"===u?[_,_-g]:[i+g,i];p(C,r,M,r,_,y,_,S),[C,M]="Discrete"===u?[m,m+g]:[i-g,i],p(C,r,M,r,m,S,m,y),g="Absolute"===l?this.transformSize(a.pt2px(o)):w.getRelativeGradientSize(o,h.gradientSize)*(c.height(d)/2);let[P,L]="Discrete"===u?[S,S-g]:[r+g,r];p(i,P,i,L,_,S,m,S),[P,L]="Discrete"===u?[y,y+g]:[r-g,r],p(i,P,i,L,m,y,_,y);break}}v.restore()}drawGradientStroke(e,t){const{capStyle:s,gradientMethod:r,gradientSize:n,gradientSizeUnits:o,joinStyle:l,miterLimit:c,width:h}=t;if(!e||0===h)return;let u;if(p.isPolygon(e))u=e.rings;else if(p.isPolyline(e))u=e.paths;else{if(!p.isExtent(e))return void k().error("Unable to draw gradient stroke");u=A(e).rings}const f=t.gradientType??g.defaultCIMValues.CIMGradientStroke.gradientType,d=Math.max(this.transformSize(a.pt2px(h)),.5),m=this._ctx;let y,_;m.save(),this._setCapStyle(s),this._setJoinStyle(l),void 0!==c&&(m.miterLimit=c),m.lineWidth=d;for(let e of u){if(e=i.clone(e),V(e),!e||e.length<=1)continue;let s=0;y=this.transformPt(e[0]);for(let t=1;t<e.length;t++){_=this.transformPt(e[t]);const i=_[0]-y[0],r=_[1]-y[1];s+=Math.sqrt(i*i+r*r),y=_}const l="Absolute"===o?this.transformSize(a.pt2px(n)):w.getRelativeGradientSize(n,g.defaultCIMValues.CIMGradientStroke.gradientSize)*("AcrossLine"===r?d:s);let c=0;y=this.transformPt(e[0]);for(let i=1;i<e.length;i++){_=this.transformPt(e[i]);const n=_[0]-y[0],o=_[1]-y[1],a=Math.sqrt(n*n+o*o);let h,u,p,g;switch(r){case"AcrossLine":{const[e,t]=b.rotate([n/a,o/a],-Math.PI/2),s=d/2,i="Discrete"===f?s:l-s;h=(y[0]+_[0])/2+e*i,u=(y[1]+_[1])/2+t*i,p=h-e*l,g=u-t*l;break}case"AlongLine":{const e=n/a,t=o/a;"Discrete"===f?(h=y[0]-e*c,u=y[1]-t*c,p=h+e*l,g=u+t*l):(p=y[0]+e*(s-c),g=y[1]+t*(s-c),h=p-e*l,u=g-t*l);break}default:return k().error("Unrecognized gradient method:",r),void m.restore()}const S=m.createLinearGradient(h,u,p,g);x.addColorStops(S,t),m.strokeStyle=S,m.beginPath(),m.moveTo(y[0],y[1]),m.lineTo(_[0],_[1]),m.stroke(),c+=a,y=_}}m.restore()}_buildPath(e,t){const s=this._ctx;if(s.beginPath(),e)for(const i of e){const e=i?i.length:0;if(e>1){let r=this.transformPt(i[0]);s.moveTo(r[0],r[1]);for(let t=1;t<e;t++)r=this.transformPt(i[t]),s.lineTo(r[0],r[1]);t&&s.closePath()}}}_setCapStyle(e){switch(e){case"Butt":this._ctx.lineCap="butt";break;case"Round":this._ctx.lineCap="round";break;case"Square":this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case"Bevel":this._ctx.lineJoin="bevel";break;case"Round":this._ctx.lineJoin="round";break;case"Miter":this._ctx.lineJoin="miter"}}},e.EnvDrawHelper=class extends E{constructor(e,t){super(e,t),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new S(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return c.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(p.isPolygon(e))this._processPath(e.rings,0);else if(p.isPolyline(e))this._processPath(e.paths,0);else if(p.isExtent(e)){const t=A(e);t&&this._processPath(t.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,t,s){if(!e||this._clipCount>0||null==s||s<=0)return;const i=Math.max(.5*this.transformSize(w.getNumericValue(s,g.defaultCIMValues.CIMSolidStroke.width)),.25);if(p.isPolygon(e))this._processPath(e.rings,i);else if(p.isPolyline(e))this._processPath(e.paths,i);else if(p.isExtent(e)){const t=A(e);t&&this._processPath(t.rings,i)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,t){p.isPolygon(t)&&e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._processPath(t.rings,0):super.drawMarkerLayer(e,t)}drawHatchFill(e,t){this.drawSolidFill(e)}drawPictureFill(e,t){this.drawSolidFill(e)}drawGradientFill(e,t){this.drawSolidFill(e)}drawPictureStroke(e,t){this.drawSolidStroke(e,null,t.width)}drawGradientStroke(e,t){this.drawSolidStroke(e,null,t.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,t){const{url:s}=e,i=w.getNumericValue(e.scaleX,1);let r=i*t,n=t;const o=this._resourceManager.getResource(s);if(null!=o){const e=o.height/o.width;r=i*(t?e>1?t:t/e:o.width),n=t?e>1?t*e:t:o.height}this._merge(this.transformPt([-r/2,-n/2]),0),this._merge(this.transformPt([-r/2,n/2]),0),this._merge(this.transformPt([r/2,-n/2]),0),this._merge(this.transformPt([r/2,n/2]),0)}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new v);const s=O(e);let[i,r]=this._textRasterizer.computeTextSize(t,s);i=a.px2pt(i),r=a.px2pt(r);const n=this.transformSize(1)*this.reverseTransformScalar(1);i*=n,r*=n;let o=0;switch(e.horizontalAlignment){case"Left":o=i/2;break;case"Right":o=-i/2}let l=0;switch(e.verticalAlignment){case"Bottom":l=r/2;break;case"Top":l=-r/2;break;case"Baseline":l=r/6}this._merge(this.transformPt([-i/2+o,-r/2+l]),0),this._merge(this.transformPt([-i/2+o,r/2+l]),0),this._merge(this.transformPt([i/2+o,-r/2+l]),0),this._merge(this.transformPt([i/2+o,r/2+l]),0)}_processPath(e,t){if(e)for(const s of e){const e=s?s.length:0;if(e>1){this._merge(this.transformPt(s[0]),t);for(let i=1;i<e;i++)this._merge(this.transformPt(s[i]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}},e.HittestDrawHelper=class extends E{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=C.destroyHiddenSvg(this._svg),this._path=null,this._canvas=null}hitTest(e,t,i,r,n,o){const l=o*a.pt2px(1);this.setTransform(),this.setGeomUnitsPerPoint(l),this._searchPoint=[(e[0]+e[2])/2,(e[1]+e[3])/2],this._searchDistPoint=(e[2]-e[0])/2/l,this._textInfo=r;const c=t&&("CIMPointSymbol"===t.type&&"Map"!==t.angleAlignment||"CIMTextSymbol"===t.type);if(this._mapRotation=c?n:0,!s("esri-mobile")){const e=a.px2pt(M.hittestToleranceSmallSymbol*window.devicePixelRatio),s=a.px2pt(M.hittestSmallSymbolThreshold);("CIMLineSymbol"!==t?.type&&"CIMPolygonSymbol"!==t?.type||!t.symbolLayers?.some(w.isCIMFill))&&"CIMMeshSymbol"!==t?.type&&(w.getSize(t)??0)<s&&(this._searchDistPoint=e)}return this._earlyReturn=!1,this.drawSymbol(t,i),this._earlyReturn}executeEffects(e,t){return"CIMGeometricEffectDashes"===e.at(-1)?.type&&(e=e.slice(0,-1)),super.executeEffects(e,t)}drawSolidFill(e,t,s){null!=s?this._hittestSvgPath(e,s,!0):this._hitTestFill(e)}drawHatchFill(e,t){this._hitTestFill(e)}drawPictureFill(e,t){this._hitTestFill(e)}drawGradientFill(e,t){this._hitTestFill(e)}drawSolidStroke(e,t,s,i,r,n,o){null!=o?this._hittestSvgPath(e,o,!1,s):this._hitTestStroke(e,s)}drawPictureStroke(e,t){this._hitTestStroke(e,t.width)}drawGradientStroke(e,t){this._hitTestStroke(e,t.width)}drawMarkerLayer(e,t){e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._hitTestFill(t):super.drawMarkerLayer(e,t)}pushClipPath(e){}popClipPath(){}drawImage(e,t){const{url:s}=e,i=w.getNumericValue(e.scaleX,1),r=this._resourceManager.getResource(s);if(null==r||0===r.height||0===t)return;const n=t*this.geomUnitsPerPoint(),o=n*i*(r.width/r.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<n/2+l&&(this._earlyReturn=!0)}drawText(e,t){const s=this._textInfo;if(!s)return;const i=s.get(e);if(!i)return;if(!i.glyphMosaicItems.glyphs.length)return;const r=L.roundPtToWholePixel(w.getNumericValue(e.height,g.defaultCIMValues.CIMTextSymbol.height)),{lineGapType:n,lineGap:o}=e,a=n?F(n,w.getNumericValue(o),r):0,l="CIMBackgroundCallout"===e.callout?.type,c=P.shapeGlyphs(i.glyphMosaicItems,{scale:r/M.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:L.getLineWidth(e.lineWidth),lineHeight:M.magicLabelLineHeight*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),h=this.reverseTransformPt(this._searchPoint),u=h[0],p=h[1];for(const e of c.glyphs)if(u>e.xTopLeft&&u<e.xBottomRight&&p>-e.yBottomRight&&p<-e.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(e){let t=null;if(p.isExtent(e)){const s=e;t=[[[s.xmin,s.ymin],[s.xmin,s.ymax],[s.xmax,s.ymax],[s.xmax,s.ymin],[s.xmin,s.ymin]]]}else if(p.isPolygon(e))t=e.rings;else{if(!p.isPolyline(e))return;t=e.paths}const s=this.reverseTransformPt(this._searchPoint);(function(e,t){let s=0;for(const i of t){const t=i.length;for(let r=1;r<t;r++){const t=i[r-1],n=i[r];t[1]>e[1]!=n[1]>e[1]&&((n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0])>0?s++:s--)}}return 0!==s})(s,t)&&(this._earlyReturn=!0),this._earlyReturn||z(s,t,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return null!=this._svg&&null!=this._path||(this._svg??=C.createHiddenSvg(),this._path??=C.createSvgElement("path"),this._svg.appendChild(this._path)),this._path}_getCanvasContext(e,t){return this._canvas??=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t,this._canvas.getContext("2d",{willReadFrequently:!0})}_hittestSvgPath(e,t,s,i=0){const r=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),n=this.reverseTransformPt(this._searchPoint),o=c.create();h.getBoundsXY(o,e);const a=o[0],l=o[1],u=o[2]-o[0],p=o[3]-o[1],f=this._getSvgPath();f.setAttribute("d",t);const d=f.getBBox();let m=Math.max(d.width/u,d.height/p),y=1;const g=2*r*m;g<1&&(y=2/g,m*=y,d.x*=y,d.y*=y,d.width*=y,d.height*=y);const _=1+i*m/2,b=this._getCanvasContext(d.width+2*_,d.height+2*_);b.setTransform(y,0,0,y,-d.x+_,-d.y+_);const x=new Path2D(t);s?b.fill(x):(b.lineWidth=i*(m/y),b.stroke(x));const S=(u*m-d.width)/2,v=(p*m-d.height)/2,w=Math.floor((n[0]-a-r)*m-S+_),C=Math.floor((p-(n[1]-l)-r)*m+v+_),M=Math.ceil(2*r*m),P=Math.ceil(2*r*m),L=b.getImageData(w,C,M,P).data;for(let e=3;e<L.length;e+=4)if(L[e]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(e,t){let s=null;if(p.isExtent(e)){const t=e;s=[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}else if(p.isPolygon(e))s=e.rings;else{if(!p.isPolyline(e))return;s=e.paths}z(this.reverseTransformPt(this._searchPoint),s,w.getNumericValue(t,g.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}},e.Transformation=T,e.cDegToRad=I,e.lineGapType2LineHeight=F,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(e,t){"use strict";const s="arial-unicode-ms",i="woff2",r=new Map,n=new Set;class o{constructor(e,t){this.fontFace=e,this.promise=t}}function a(e){if(!e)return s;const t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}function l(e){const t=c(e)+h(e);return a(e.family)+(t.length>0?t:"-regular")}function c(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function h(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}e.clearFonts=function(){const e=document.fonts;r.forEach(t=>{e.delete(t.fontFace)}),r.clear(),n.clear()},e.defaultFontFamily=s,e.getFontFamily=a,e.getFullyQualifiedFontName=l,e.isCachedFontFace=function(e){return n.has(e)},e.loadFont=async function(e){const a=function(e){const t=c(e)+h(e);return(e.family||s)+(t.length>0?t:"-regular")}(e),u=l(e),p=r.get(a);if(p)return p.promise;const f=new FontFace(e.family,`url('${t.fontsUrl}/woff2/${u}.${i}') format('${i}')`,{style:e.style,weight:e.weight}),d=document.fonts;if(d.has(f)&&"loading"===f.status)return f.loaded;const m=f.load().then(()=>(d.add(f),f));return r.set(a,new o(f,m)),n.add(f),m},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){"use strict";return class{applyColorSubstitution(e,t){if(!t)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:s,height:i}=e,r=this._rasterizationCanvas,n=r.getContext("2d",{willReadFrequently:!0});e!==r&&(r.width=s,r.height=i,n.drawImage(e,0,0,s,i));const o=n.getImageData(0,0,s,i).data;if(t)for(const e of t)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[t,s,i,r]=e.oldColor,[n,a,l,c]=e.newColor;if(t===n&&s===a&&i===l&&r===c)continue;for(let e=0;e<o.length;e+=4)t===o[e]&&s===o[e+1]&&i===o[e+2]&&r===o[e+3]&&(o[e]=n,o[e+1]=a,o[e+2]=l,o[e+3]=c)}const a=new ImageData(o,s,i);return n.putImageData(a,0,0),r}tintImageData(e,t){if(!t||t.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:s,height:i}=e,r=this._rasterizationCanvas,n=r.getContext("2d",{willReadFrequently:!0});e!==r&&(r.width=s,r.height=i,n.drawImage(e,0,0,s,i));const o=n.getImageData(0,0,s,i),a=new Uint8Array(o.data),l=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];for(let e=0;e<a.length;e+=4)a[e]*=l[0],a[e+1]*=l[1],a[e+2]*=l[2],a[e+3]*=l[3];const c=new ImageData(new Uint8ClampedArray(a.buffer),s,i);return n.putImageData(c,0,0),r}}})},"esri/symbols/cim/CIMOperators":function(){define(["exports","./effects/EffectAddControlPoints","./effects/EffectArrow","./effects/EffectBuffer","./effects/EffectControlMeasureLine","./effects/EffectCut","./effects/EffectDashes","./effects/EffectDonut","./effects/EffectEnclosingPolygon","./effects/EffectJog","./effects/EffectMove","./effects/EffectOffset","./effects/EffectRadial","./effects/EffectReverse","./effects/EffectRotate","./effects/EffectScale","./effects/EffectSuppress","./effects/EffectTaperedPolygon","./effects/EffectWave","./placements/PlacementAlongLineSameSize","./placements/PlacementAtExtremities","./placements/PlacementAtRatioPositions","./placements/PlacementInsidePolygon","./placements/PlacementOnLine","./placements/PlacementOnVertices","./placements/PlacementPolygonCenter"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d,m,y,g,_,b,x,S,v,w,C,M){"use strict";e.getEffectOperator=function(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return t.EffectAddControlPoints.local();case"CIMGeometricEffectArrow":return s.EffectArrow.local();case"CIMGeometricEffectBuffer":return i.EffectBuffer.local();case"CIMGeometricEffectControlMeasureLine":return r.EffectControlMeasureLine.local();case"CIMGeometricEffectCut":return n.EffectCut.local();case"CIMGeometricEffectDashes":return o.EffectDashes.local();case"CIMGeometricEffectDonut":return a.EffectDonut.local();case"CIMGeometricEffectJog":return c.EffectJog.local();case"CIMGeometricEffectMove":return h.EffectMove.local();case"CIMGeometricEffectOffset":return u.EffectOffset.local();case"CIMGeometricEffectRadial":return p.EffectRadial.local();case"CIMGeometricEffectReverse":return f.EffectReverse.local();case"CIMGeometricEffectRotate":return d.EffectRotate.local();case"CIMGeometricEffectScale":return m.EffectScale.local();case"CIMGeometricEffectSuppress":return y.EffectSuppress.local();case"CIMGeometricEffectTaperedPolygon":return g.EffectTaperedPolygon.local();case"CIMGeometricEffectWave":return _.EffectWave.local();case"CIMGeometricEffectEnclosingPolygon":return l.EffectEnclosingPolygon.local()}return null},e.getPlacementOperator=function(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return b.PlacementAlongLineSameSize.local();case"CIMMarkerPlacementAtExtremities":return x.PlacementAtExtremities.local();case"CIMMarkerPlacementAtRatioPositions":return S.PlacementAtRatioPositions.local();case"CIMMarkerPlacementInsidePolygon":return v.PlacementInsidePolygon.local();case"CIMMarkerPlacementOnLine":return w.PlacementOnLine.local();case"CIMMarkerPlacementOnVertices":return C.PlacementOnVertices.local();case"CIMMarkerPlacementPolygonCenter":return M.PlacementPolygonCenter.local()}return null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(e){"use strict";class t{static{this.instance=null}static local(){return null===t.instance&&(t.instance=new t),t.instance}execute(e,t){return new s(e,t)}}class s{constructor(e,t){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();if(!e)return null;for(;e;){if("esriGeometryPolygon"===e.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===e.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==e.geometryType){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const t=e.x,s=e.y;let i=t,r=s,n=e.pathSize,o=0,a=0,l=0,c=0,h=0,u=0;this._isClosed&&++n;for(let p=1;e.nextPoint()||p<n;++p){let f,d;this._isClosed&&p===n-1?(f=t,d=s):(f=e.x,d=e.y);const m=f-i,y=d-r,g=Math.sqrt(m*m+y*y);p>1&&g>0&&l>0&&(o*m+a*y)/g/l<=this._maxCosAngle&&e.setControlPointAt(p-1),1===p&&(c=m,h=y,u=g),g>0&&(i=f,r=d,o=m,a=y,l=g)}this._isClosed&&l>0&&u>0&&(o*c+a*h)/u/l<=this._maxCosAngle&&e.setControlPointAt(0)}}}e.EffectAddControlPoints=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectArrow":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../CurveHelper"],function(e,t,s,i,r){"use strict";const n=1.7320508075688772;class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,s){return new a(e,t,s)}}class a extends i.PathEffectCursor{constructor(e,t,s){super(e,!1,!0),this._curveHelper=new r.CurveHelper,this._width=(void 0!==t.width?t.width:5)*s,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:void 0!==t.arrowType?t.arrowType:"OpenEnded",this._offsetFlattenError=r.pixelTolerance*s}processPath(e){const s=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case"OpenEnded":default:this._constructSimpleArrow(s,e,!0);break;case"Block":this._constructSimpleArrow(s,e,!1);break;case"Crossed":this._constructCrossedArrow(s,e)}return s}_constructSimpleArrow(e,t,i){const r=t.pathLength();let n=this._width;r<2*n&&(n=r/2);const o=this._curveHelper.getSubCurve(t,0,r-n);if(!o||!o.nextPath())return;o.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=s.collectPath(o),c=this._constructOffset(l,-a);if(!c)return;const h=this._constructOffset(l,a);if(!h)return;const u=this._constructArrowBasePoint(c,-a/2);if(!u)return;const p=this._constructArrowBasePoint(h,a/2);if(!p)return;t.seekInPath(t.pathSize-1);const f=[t.x,t.y];e.pushPath(h),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(u),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),i||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(h[0])),e.reset()}_constructCrossedArrow(e,t){const i=t.pathLength();let r=this._width;i<r*(1+n+1)&&(r=i/(1+n+1)),t.seekPathStart();const o=this._curveHelper.getSubCurve(t,0,i-r*(1+n));if(!o)return;o.nextPath();const a=r/2;if(this._curveHelper.isEmpty(o))return;const l=s.collectPath(o),c=this._constructOffset(l,a);if(!c)return;const h=this._constructOffset(l,-a);if(!h)return;const u=this._curveHelper.getSubCurve(t,0,i-r);if(!u)return;if(u.nextPath(),this._curveHelper.isEmpty(u))return;const p=s.collectPath(u),f=this._constructOffset(p,a);if(!f)return;const d=this._constructOffset(p,-a);if(!d)return;const m=f[f.length-1],y=this._constructArrowBasePoint(f,a/2);if(!y)return;const g=d[d.length-1],_=this._constructArrowBasePoint(d,-a/2);if(!_)return;t.seekInPath(t.pathSize-1);const b=[t.x,t.y];e.pushPath(c),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoints(h.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,t){return this._curveHelper.offset(e,t,"Rounded",4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;const s=e[e.length-2],i=e[e.length-1],r=[i[0]-s[0],i[1]-s[1]];return this._curveHelper.normalize(r),[i[0]+r[1]*t,i[1]-r[0]*t]}}e.EffectArrow=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(e,t){"use strict";e.PathEffectCursor=class{constructor(e,t,s,i=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=s,this.geomUnitsPerPoint=i,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===e.geometryType||"esriGeometryEnvelope"===e.geometryType,this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}},e.PathTransformationCursor=class{constructor(e,s=!0,i=!0,r=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!s&&"esriGeometryPolygon"===e.geometryType||!i&&"esriGeometryPolyline"===e.geometryType?null:e,this.geomUnitsPerPoint=r,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new t.Placement}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const t=this.processPath(e);if(t)return t}return this.iterateMultiPath=!1,null}},e.setId=function(e,t){e[4]=t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor"],function(e,t){"use strict";e.CurveHelper=class{constructor(e=0,t=!1){}isEmpty(e){if(!e.nextPoint())return!0;let t,s,i,r;for(t=e.x,s=e.y;e.nextPoint();t=s,s=r)if(i=e.x,r=e.y,i!==t||r!==s)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);0!==t&&(e[0]/=t,e[1]/=t)}getLength(e,t,s,i){const r=s-e,n=i-t;return Math.sqrt(r*r+n*n)}getSegLength(e){const[[t,s],[i,r]]=e;return this.getLength(t,s,i,r)}getCoord2D(e,t,s,i,r){return[e+(s-e)*r,t+(i-t)*r]}getSegCoord2D(e,t){const[[s,i],[r,n]]=e;return this.getCoord2D(s,i,r,n,t)}getAngle(e,t,s,i,r){const n=s-e,o=i-t;return Math.atan2(o,n)}getAngleCS(e,t,s,i,r,n){null==e&&(e=[0,0]);const o=i-t,a=r-s,l=Math.sqrt(o*o+a*a);return 0!==l?(e[0]=o/l,e[1]=a/l,e):(e[0]=1,e[1]=0,e)}getSegAngleCS(e,t,s){const[[i,r],[n,o]]=t;return this.getAngleCS(e,i,r,n,o,s)}cut(e,t,s,i,r,n){return[r<=0?[e,t]:this.getCoord2D(e,t,s,i,r),n>=1?[s,i]:this.getCoord2D(e,t,s,i,n)]}getSubCurve(e,s,i){const r=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(r,e,s,i)?r:null}appendSubCurve(e,t,s,i){e.startPath(),t.seekPathStart();let r=0,n=!0;if(!t.nextPoint())return!1;let o=t.x,a=t.y;for(;t.nextPoint();){const l=this.getLength(o,a,t.x,t.y);if(0!==l){if(n){if(r+l>s){const c=(s-r)/l;let h=1,u=!1;r+l>=i&&(h=(i-r)/l,u=!0);const p=this.cut(o,a,t.x,t.y,c,h);if(p&&e.pushPoints(p),u)break;n=!1}}else{if(r+l>i){const s=this.cut(o,a,t.x,t.y,0,(i-r)/l);s&&e.pushPoint(s[1]);break}e.pushXY(t.x,t.y)}r+=l,o=t.x,a=t.y}else o=t.x,a=t.y}return!0}getCIMPointAlong(e,t){if(!e.nextPoint())return null;let s,i,r,n,o=0;for(s=e.x,i=e.y;e.nextPoint();s=r,i=n){r=e.x,n=e.y;const a=this.getLength(s,i,r,n);if(0!==a){if(o+a>t){const e=(t-o)/a;return this.getCoord2D(s,i,r,n,e)}o+=a}}return null}offset(e,t,s,i,r){if(!e||e.length<2)return null;let n=0,o=e[n++],a=n;for(;n<e.length;){const t=e[n];t[0]===o[0]&&t[1]===o[1]||(n!==a&&(e[a]=e[n]),o=e[a++]),n++}const l=e[0][0]===e[a-1][0]&&e[0][1]===e[a-1][1];if(l&&--a,a<(l?3:2))return null;const c=[];o=l?e[a-1]:null;let h=e[0];for(let r=0;r<a;r++){const n=r===a-1?l?e[0]:null:e[r+1];if(o)if(n){const e=[n[0]-h[0],n[1]-h[1]];this.normalize(e);const r=[h[0]-o[0],h[1]-o[1]];this.normalize(r);const a=r[0]*e[1]-r[1]*e[0],l=r[0]*e[0]+r[1]*e[1];if(0===a&&1===l){h=n;continue}if(a>=0==t<=0){if(l<1){const s=[e[0]-r[0],e[1]-r[1]];this.normalize(s);const n=Math.sqrt((1+l)/2);if(n>1/i){const e=-Math.abs(t)/n;c.push([h[0]-s[0]*e,h[1]-s[1]*e])}}}else switch(s){case"Mitered":{const s=Math.sqrt((1+l)/2);if(s>0&&1/s<i){const i=[e[0]-r[0],e[1]-r[1]];this.normalize(i);const n=Math.abs(t)/s;c.push([h[0]-i[0]*n,h[1]-i[1]*n]);break}}case"Bevelled":c.push([h[0]+r[1]*t,h[1]-r[0]*t]),c.push([h[0]+e[1]*t,h[1]-e[0]*t]);break;case"Rounded":if(l<1){c.push([h[0]+r[1]*t,h[1]-r[0]*t]);const s=Math.floor(2.5*(1-l));if(s>0){const i=1/s;let n=i;for(let o=1;o<s;o++,n+=i){const s=[r[1]*(1-n)+e[1]*n,-r[0]*(1-n)-e[0]*n];this.normalize(s),c.push([h[0]+s[0]*t,h[1]+s[1]*t])}}c.push([h[0]+e[1]*t,h[1]-e[0]*t])}break;default:if(a<0)c.push([h[0]+(r[1]+r[0])*t,h[1]+(r[1]-r[0])*t]),c.push([h[0]+(e[1]-e[0])*t,h[1]-(e[0]+e[1])*t]);else{const s=Math.sqrt((1+Math.abs(l))/2),i=[e[0]-r[0],e[1]-r[1]];this.normalize(i);const n=t/s;c.push([h[0]-i[0]*n,h[1]-i[1]*n])}}}else{const e=[h[0]-o[0],h[1]-o[1]];this.normalize(e),c.push([h[0]+e[1]*t,h[1]-e[0]*t])}else{const e=[n[0]-h[0],n[1]-h[1]];this.normalize(e),c.push([h[0]+e[1]*t,h[1]-e[0]*t])}o=h,h=n}return c.length<(l?3:2)?null:(l&&c.push([c[0][0],c[0][1]]),c)}},e.pixelTolerance=.03,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/SpatialReference","../CIMEffects","../CurveHelper"],function(e,t,s,i,r,n){"use strict";class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,s,i,r,n){return new a(e,t,s,i,r,n)}}class a{constructor(e,t,s,i,r,o){this._preventClipping=o,this._inputGeometries=e,this._tileKey=i,this._curveHelper=new n.CurveHelper,this._size=(void 0!==t.size?t.size:1)*s,this._maxInflateSize=r*s,this._offsetFlattenError=n.pixelTolerance*s}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===e.geometryType)if(this._size>0){const i=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType),r=s.collectMultipath(e)[0],n=this._curveHelper.offset(r,this._size,"Rounded",4,this._offsetFlattenError);if(n)return i.pushPath(n),i}else if(this._size<0){const s=e.asJSON();if(Math.min(s.xmax-s.xmin,s.ymax-s.ymin)+2*this._size>0)return t.GeometryCursor.fromJSONCIM({xmin:s.xmin-this._size,xmax:s.xmax+this._size,ymin:s.ymin-this._size,ymax:s.ymax+this._size})}const n=!this._preventClipping&&this._tileKey?r.clipCursorToTileExtent(e,this._maxInflateSize,!0):e;if(!n)continue;const o=r.lazyBufferOperator.module,a={...n.asJSON(),spatialReference:{wkid:i.WebMercator.wkid}},l=o.execute(a,this._size);return l?t.GeometryCursor.fromJSONCIM(l):null}return null}}e.EffectBuffer=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/support/coordsUtils","../CIMCursor"],function(e,t,s,i,r){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,s){return new o(e,t,s)}}class o{constructor(e,t,s){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=s,this._rule=t.rule??"FullGeometry",this._defaultSize=this._defaultPointSize*s}next(){let e;for(;e=this._inputGeometries.next();){const i=this._processGeom(s.collectMultipath(e));if(i?.length)return t.GeometryCursor.fromJSONCIM({paths:i})}return null}_clone(e){return[e[0],e[1]]}_mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}_mix(e,t,s,i){return[e[0]*t+s[0]*i,e[1]*t+s[1]*i]}_add(e,t){return[e[0]+t[0],e[1]+t[1]]}_add2(e,t,s){return[e[0]+t,e[1]+s]}_sub(e,t){return[e[0]-t[0],e[1]-t[1]]}_dist(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,t=1){const s=t/this._norm(e);e[0]*=s,e[1]*=s}_leftPerpendicular(e){const t=-e[1],s=e[0];e[0]=t,e[1]=s}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const t=e[1],s=-e[0];e[0]=t,e[1]=s}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,t){return e[0]*t[0]+e[1]*t[1]}_crossProduct(e,t){return e[0]*t[1]-e[1]*t[0]}_rotateDirect(e,t,s){const i=e[0]*t-e[1]*s,r=e[0]*s+e[1]*t;e[0]=i,e[1]=r}_makeCtrlPt(e){const t=[e[0],e[1]];return r.setId(t,1),t}_addAngledTicks(e,t,s,i){const r=this._sub(s,t);this._normalize(r);const n=this._crossProduct(r,this._sub(i,t));let o;o=n>0?this._rightPerp(r):this._leftPerp(r);const a=Math.abs(n)/2,l=[];l.push([t[0]+(o[0]-r[0])*a,t[1]+(o[1]-r[1])*a]),l.push(t),l.push(s),l.push([s[0]+(o[0]+r[0])*a,s[1]+(o[1]+r[1])*a]),e.push(l)}_addBezier2(e,t,s,i,r){if(0===r--)return void e.push(i);const n=this._mid(t,s),o=this._mid(s,i),a=this._mid(n,o);this._addBezier2(e,t,n,a,r),this._addBezier2(e,a,o,i,r)}_addBezier3(e,t,s,i,r,n){if(0===n--)return void e.push(r);const o=this._mid(t,s),a=this._mid(s,i),l=this._mid(i,r),c=this._mid(o,a),h=this._mid(a,l),u=this._mid(c,h);this._addBezier3(e,t,o,c,u,n),this._addBezier3(e,u,h,l,r,n)}_add90DegArc(e,t,s,i,r){const n=r??this._crossProduct(this._sub(s,t),this._sub(i,t))>0,o=this._mid(t,s),a=this._sub(o,t);n?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(e,t,this._mix(t,.33333,o,.66667),this._mix(s,.33333,o,.66667),s,4)}_addArrow(e,t,s){const i=t[0],r=t[1],n=t[t.length-1],o=this._sub(i,r),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(n,r)));let c=this._dotProduct(o,this._sub(n,r));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const h=.5*l,u=this._leftPerp(o),p=[r[0]+o[0]*c,r[1]+o[1]*c],f=t.length-1,d=[];d.push(s?[-u[0],-u[1]]:u);let m=[-o[0],-o[1]];for(let e=1;e<f-1;e++){const s=this._sub(t[e+1],t[e]);this._normalize(s);const i=this._dotProduct(s,m),r=this._crossProduct(s,m),n=Math.sqrt((1+i)/2),o=this._sub(s,m);this._normalize(o),o[0]/=n,o[1]/=n,d.push(r<0?[-o[0],-o[1]]:o),m=s}d.push(this._rightPerp(m));for(let s=d.length-1;s>0;s--)e.push([t[s][0]+d[s][0]*h,t[s][1]+d[s][1]*h]);e.push([p[0]+d[0][0]*h,p[1]+d[0][1]*h]),e.push([p[0]+d[0][0]*l,p[1]+d[0][1]*l]),e.push(i),e.push([p[0]-d[0][0]*l,p[1]-d[0][1]*l]),e.push([p[0]-d[0][0]*h,p[1]-d[0][1]*h]);for(let s=1;s<d.length;s++)e.push([t[s][0]-d[s][0]*h,t[s][1]-d[s][1]*h])}_addDash(e,t,s){const i=this._norm(s)/7;this._normalize(s);let r=[];for(let n=0;n<=7;n++)r.push([t[0]+s[0]*n*i,t[1]+s[1]*n*i]),1&n&&(e.push(r),r=[])}_cp2(e,t,s){return e.length>=2?e[1]:this._add2(e[0],t*this._defaultSize,s*this._defaultSize)}_cp3(e,t,s,i){if(e.length>=3)return e[2];const r=this._mix(e[0],1-s,t,s),n=this._sub(t,e[0]);return this._normalize(n),this._rightPerpendicular(n),[r[0]+n[0]*i*this._defaultSize,r[1]+n[1]*i*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const t=e[0],s=this._cp2(e,-4,0),i=this._sub(t,s);this._normalize(i);const r=this._rightPerp(i);return[t,s,[t[0]+(r[0]-i[0])*this._defaultSize,t[1]+(r[1]-i[1])*this._defaultSize]]}_arrowLastSeg(e){const t=e[0],s=this._cp2(e,-4,0);let i;if(e.length>=3)i=e[e.length-1];else{const e=this._sub(t,s);this._normalize(e);const r=this._rightPerp(e);i=[t[0]+(r[0]-e[0])*this._defaultSize,t[1]+(r[1]-e[1])*this._defaultSize]}return[s,i]}_processGeom(e){if(!e)return null;const t=[];for(const s of e){const e=s.length>1&&i.getPathLength(s)<this._defaultSize;if(!s||0===s.length||e)continue;const n=s.length;let o=s[0];switch(this._rule){case"PerpendicularFromFirstSegment":{const e=this._cp2(s,0,-1),i=this._cp3(s,e,.5,4),r=[];r.push(i),r.push(this._mid(o,e)),t.push(r);break}case"ReversedFirstSegment":{const e=this._cp2(s,0,-1);t.push([e,o]);break}case"PerpendicularToSecondSegment":{if(s.length<3)return[];const e=this._cp2(s,-4,1),i=this._cp3(s,e,.882353,-1.94),r=[];r.push(this._mid(e,i)),r.push(o),t.push(r);break}case"SecondSegmentWithTicks":{if(s.length<3)return[];const e=this._cp2(s,-4,1),i=this._cp3(s,e,.882353,-1.94),r=this._sub(i,e);let n;n=this._crossProduct(r,this._sub(o,e))>0?this._rightPerp(r):this._leftPerp(r);const a=[];a.push([e[0]+(n[0]-r[0])/3,e[1]+(n[1]-r[1])/3]),a.push(e),a.push(i),a.push([i[0]+(n[0]+r[0])/3,i[1]+(n[1]+r[1])/3]),t.push(a);break}case"DoublePerpendicular":{const e=this._cp2(s,0,-1),i=this._cp3(s,e,.5,3),r=this._mid(o,e),n=this._sub(r,i);this._normalize(n);const a=this._crossProduct(n,this._sub(o,i));this._leftPerpendicular(n);const l=[];l.push(o),l.push([i[0]+n[0]*a,i[1]+n[1]*a]),t.push(l);const c=[];c.push([i[0]-n[0]*a,i[1]-n[1]*a]),c.push(e),t.push(c);break}case"OppositeToFirstSegment":{const e=this._cp2(s,0,-1),i=this._cp3(s,e,.5,3),r=this._mid(o,e),n=this._sub(r,i);this._normalize(n);const a=this._crossProduct(n,this._sub(o,i));this._leftPerpendicular(n);const l=[];l.push([i[0]+n[0]*a,i[1]+n[1]*a]),l.push([i[0]-n[0]*a,i[1]-n[1]*a]),t.push(l);break}case"TriplePerpendicular":{const e=this._cp2(s,0,-1),i=this._cp3(s,e,.5,4),r=this._mid(o,e),n=this._sub(r,i);this._normalize(n);const a=this._crossProduct(n,this._sub(o,i));this._leftPerpendicular(n);const l=[];l.push([i[0]+n[0]*a*.8,i[1]+n[1]*a*.8]),l.push([r[0]+.8*(o[0]-r[0]),r[1]+.8*(o[1]-r[1])]),t.push(l),t.push([i,r]);const c=[];c.push([i[0]-n[0]*a*.8,i[1]-n[1]*a*.8]),c.push([r[0]+.8*(e[0]-r[0]),r[1]+.8*(e[1]-r[1])]),t.push(c);break}case"HalfCircleFirstSegment":{const e=this._cp2(s,0,-1),i=this._cp3(s,e,.5,4),r=this._mid(o,e);let n=this._sub(e,o);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),c=Math.sqrt((1+a)/2),h=Math.sqrt((1-a)/2),u=[];let p;this._crossProduct(n,this._sub(i,o))>0?(u.push(o),n=this._sub(o,r),p=e):(u.push(e),n=this._sub(e,r),p=o),this._rotateDirect(n,c,h),n[0]/=c,n[1]/=c;for(let e=1;e<=18;e++)u.push(this._add(r,n)),this._rotateDirect(n,a,l);u.push(p),t.push(u);break}case"HalfCircleSecondSegment":{const e=this._cp2(s,0,-1),i=this._cp3(s,e,1,-1);let r=this._sub(o,e);this._normalize(r);const n=this._crossProduct(r,this._sub(i,e))/2;this._leftPerpendicular(r);const a=[e[0]+r[0]*n,e[1]+r[1]*n];r=this._sub(e,a);const l=Math.cos(Math.PI/18);let c=Math.sin(Math.PI/18);n>0&&(c=-c);const h=[e];for(let e=1;e<=18;e++)this._rotateDirect(r,l,c),h.push(this._add(a,r));t.push(h);break}case"HalfCircleExtended":{const e=this._cp2(s,0,-2),i=this._cp3(s,e,1,-1);let r;if(n>=4)r=s[3];else{const t=this._sub(o,e);r=this._add(i,t)}const a=this._dist(e,i)/2/.75,l=this._sub(e,o);this._normalize(l,a);const c=this._sub(i,r);this._normalize(c,a);const h=[r,i];t.push(h);const u=[this._clone(i)];this._addBezier3(u,i,this._add(i,c),this._add(e,l),e,4),u.push(o),t.push(u);break}case"OpenCircle":{const e=this._cp2(s,-2,0),i=this._sub(e,o),r=Math.cos(Math.PI/18),n=-Math.sin(Math.PI/18),a=[e];for(let e=1;e<=33;e++)this._rotateDirect(i,r,n),a.push(this._add(o,i));t.push(a);break}case"CoverageEdgesWithTicks":{const e=this._cp2(s,0,-1);let i,r;if(n>=3)i=s[2];else{const t=this._sub(e,o),s=this._leftPerp(t);i=[o[0]+s[0]-.25*t[0],o[1]+s[1]-.25*t[1]]}if(n>=4)r=s[3];else{const t=this._mid(o,e),s=this._sub(o,e);this._normalize(s),this._leftPerpendicular(s);const n=this._crossProduct(s,this._sub(i,t));this._rightPerpendicular(s),r=[i[0]+s[0]*n*2,i[1]+s[1]*n*2]}const a=this._sub(e,o);let l,c;l=this._crossProduct(a,this._sub(i,o))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push(i),c.push(o),c.push([o[0]+(l[0]-a[0])/3,o[1]+(l[1]-a[1])/3]),t.push(c),l=this._crossProduct(a,this._sub(r,e))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push([e[0]+(l[0]+a[0])/3,e[1]+(l[1]+a[1])/3]),c.push(e),c.push(r),t.push(c);break}case"GapExtentWithDoubleTicks":{const e=this._cp2(s,0,2),i=this._cp3(s,e,0,1);let r;if(n>=4)r=s[3];else{const t=this._sub(e,o);r=this._add(i,t)}this._addAngledTicks(t,o,e,this._mid(i,r)),this._addAngledTicks(t,i,r,this._mid(o,e));break}case"GapExtentMidline":{const e=this._cp2(s,2,0),i=this._cp3(s,e,0,1);let r;if(n>=4)r=s[3];else{const t=this._sub(e,o);r=this._add(i,t)}const a=[];a.push(this._mid(o,i)),a.push(this._mid(e,r)),t.push(a);break}case"Chevron":{const e=this._cp2(s,-1,-1);let i;if(n>=3)i=s[2];else{const t=this._sub(e,o);this._leftPerpendicular(t),i=this._add(o,t)}t.push([e,this._makeCtrlPt(o),i]);break}case"PerpendicularWithArc":{const e=this._cp2(s,0,-2),i=this._cp3(s,e,.5,-1),r=this._sub(e,o),a=this._norm(r);r[0]/=a,r[1]/=a;const l=this._crossProduct(r,this._sub(i,o));let c=this._dotProduct(r,this._sub(i,o));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const h=[o[0]+r[0]*c,o[1]+r[1]*c];let u=this._leftPerp(r),p=[];if(p.push([h[0]-u[0]*l,h[1]-u[1]*l]),p.push([h[0]+u[0]*l,h[1]+u[1]*l]),t.push(p),n>=4){const e=s[3];let i=this._dotProduct(r,this._sub(e,o));i<.1*a?i=.1*a:i>.9*a&&(i=.9*a);const n=[o[0]+r[0]*i,o[1]+r[1]*i],l=this._crossProduct(r,this._sub(e,o)),c=[];c.push([n[0]-u[0]*l,n[1]-u[1]*l]),c.push([n[0]+u[0]*l,n[1]+u[1]*l]),t.push(c)}const f=[e[0]+u[0]*l,e[1]+u[1]*l];u=this._sub(e,f);const d=Math.cos(Math.PI/18);let m=Math.sin(Math.PI/18);l<0&&(m=-m),p=[o,e];for(let e=1;e<=9;e++)this._rotateDirect(u,d,m),p.push(this._add(f,u));t.push(p);break}case"ClosedHalfCircle":{const e=this._cp2(s,2,0),i=this._mid(o,e),r=this._sub(e,i),n=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[o,e];for(let e=1;e<=18;e++)this._rotateDirect(r,n,a),l.push(this._add(i,r));t.push(l);break}case"TripleParallelExtended":{const e=this._cp2(s,0,-2),i=this._cp3(s,e,1,-2),n=this._mid(o,e),a=this._sub(i,e);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(n,e)))/2,c=this._dist(e,i),h=[e,o];h.push([o[0]+a[0]*c*.5,o[1]+a[1]*c*.5]),t.push(h);const u=[];u.push([n[0]-a[0]*l,n[1]-a[1]*l]),u.push([n[0]+a[0]*c*.375,n[1]+a[1]*c*.375]),r.setId(u[u.length-1],1),u.push([n[0]+a[0]*c*.75,n[1]+a[1]*c*.75]),t.push(u);const p=[e,i];t.push(p);break}case"ParallelWithTicks":{const e=this._cp2(s,3,0),i=this._cp3(s,e,.5,-1),r=this._sub(i,e);this._normalize(r);const n=this._crossProduct(r,this._sub(i,o));this._leftPerpendicular(r),this._addAngledTicks(t,o,e,i),this._addAngledTicks(t,this._mix(o,1,r,n),this._mix(e,1,r,n),this._mid(o,e));break}case"Parallel":{const e=this._cp2(s,3,0),i=this._cp3(s,e,.5,-1),r=this._sub(e,o);this._normalize(r);const n=this._leftPerp(r),a=this._crossProduct(r,this._sub(i,o));let l=[o,e];t.push(l),l=[],l.push([o[0]+n[0]*a,o[1]+n[1]*a]),l.push([e[0]+n[0]*a,e[1]+n[1]*a]),t.push(l);break}case"PerpendicularToFirstSegment":{const e=this._cp2(s,3,0),i=this._cp3(s,e,.5,-1),r=this._mid(o,e),n=this._sub(e,o);this._normalize(n);const a=this._crossProduct(n,this._sub(i,o));this._leftPerpendicular(n);const l=[];l.push([r[0]-n[0]*a*.25,r[1]-n[1]*a*.25]),l.push([r[0]+n[0]*a*1.25,r[1]+n[1]*a*1.25]),t.push(l);break}case"ParallelOffset":{const e=this._cp2(s,3,0),i=this._cp3(s,e,.5,-1),r=this._sub(e,o);this._normalize(r);const n=this._crossProduct(r,this._sub(i,o));this._leftPerpendicular(r);const a=[];a.push([o[0]-r[0]*n,o[1]-r[1]*n]),a.push([e[0]-r[0]*n,e[1]-r[1]*n]),t.push(a);const l=[];l.push([o[0]+r[0]*n,o[1]+r[1]*n]),l.push([e[0]+r[0]*n,e[1]+r[1]*n]),t.push(l);break}case"OffsetOpposite":{const e=this._cp2(s,3,0),i=this._cp3(s,e,.5,-1),r=this._sub(e,o);this._normalize(r);const n=this._crossProduct(r,this._sub(i,o));this._leftPerpendicular(r);const a=[];a.push([o[0]-r[0]*n,o[1]-r[1]*n]),a.push([e[0]-r[0]*n,e[1]-r[1]*n]),t.push(a);break}case"OffsetSame":{const e=this._cp2(s,3,0),i=this._cp3(s,e,.5,-1),r=this._sub(e,o);this._normalize(r);const n=this._crossProduct(r,this._sub(i,o));this._leftPerpendicular(r);const a=[];a.push([o[0]+r[0]*n,o[1]+r[1]*n]),a.push([e[0]+r[0]*n,e[1]+r[1]*n]),t.push(a);break}case"CircleWithArc":{let e=this._cp2(s,3,0);const i=this._cp3(s,e,.5,-1);let a,l;if(n>=4)a=s[3],l=this._crossProduct(this._sub(a,e),this._sub(i,e))>0;else{a=e,l=this._crossProduct(this._sub(a,o),this._sub(i,o))>0;const t=24*this._geomUnitsPerPoint,s=this._sub(a,o);this._normalize(s,t);const r=Math.sqrt(2)/2;this._rotateDirect(s,r,l?r:-r),e=this._add(o,s)}const c=this._sub(e,o),h=Math.cos(Math.PI/18),u=Math.sin(Math.PI/18),p=[e];for(let e=1;e<=36;e++)this._rotateDirect(c,h,u),p.push(this._add(o,c));this._add90DegArc(p,e,a,i,l),r.setId(p[p.length-8],1),t.push(p);break}case"DoubleJog":{let e,i=this._cp2(s,-3,1),r=this._cp3(s,i,-1,-.5);if(n>=4)e=s[3];else{const t=o;o=i,e=r;const s=this._dist(o,t),n=this._dist(e,t);let a=30*this._geomUnitsPerPoint;.5*s<a&&(a=.5*s),.5*n<a&&(a=.5*n),i=this._mix(o,a/s,t,(s-a)/s),r=this._mix(e,a/n,t,(n-a)/n)}const a=this._mid(o,i),l=this._mid(e,r),c=this._dist(o,i),h=this._dist(r,e);let u=Math.min(c,h)/8;u=Math.min(u,24*this._geomUnitsPerPoint);const p=Math.cos(Math.PI/4);let f=this._sub(o,i);this._normalize(f,u),this._crossProduct(f,this._sub(e,i))>0?this._rotateDirect(f,p,-p):this._rotateDirect(f,p,p);let d=[];d.push(i),d.push(this._add(a,f)),d.push(this._sub(a,f)),d.push(o),t.push(d),f=this._sub(e,r),this._normalize(f,u),this._crossProduct(f,this._sub(o,r))<0?this._rotateDirect(f,p,p):this._rotateDirect(f,p,-p),d=[],d.push(r),d.push(this._add(l,f)),d.push(this._sub(l,f)),d.push(e),t.push(d);break}case"PerpendicularOffset":{const e=this._cp2(s,-4,1),i=this._cp3(s,e,.882353,-1.94),r=this._sub(i,e);this._crossProduct(r,this._sub(o,e))>0?this._rightPerpendicular(r):this._leftPerpendicular(r);const n=[r[0]/8,r[1]/8],a=this._sub(this._mid(e,i),n);t.push([a,o]);break}case"LineExcludingLastSegment":{const e=this._arrowPath(s),i=[];let r=e.length-2;for(;r--;)i.push(e[r]);t.push(i);break}case"MultivertexArrow":{const e=this._arrowPath(s),i=[];this._addArrow(i,e,!1),t.push(i);break}case"CrossedArrow":{const e=this._arrowPath(s),i=[];this._addArrow(i,e,!0),t.push(i);break}case"ChevronArrow":{const[e,i]=this._arrowLastSeg(s),r=10*this._geomUnitsPerPoint,n=this._sub(o,e),a=this._norm(n);this._normalize(n);const l=this._crossProduct(n,this._sub(i,e));let c=this._dotProduct(n,this._sub(i,e));c<.05*a?c=.05*a:c>.95*a-r&&(c=.95*a-r);const h=[e[0]+n[0]*c,e[1]+n[1]*c],u=this._leftPerp(n),p=[];p.push([h[0]+u[0]*l+n[0]*r,h[1]+u[1]*l+n[1]*r]),p.push(o),p.push([h[0]-u[0]*l+n[0]*r,h[1]-u[1]*l+n[1]*r]),t.push(p);break}case"ChevronArrowOffset":{const[e,i]=this._arrowLastSeg(s),r=this._sub(o,e),n=this._norm(r);this._normalize(r);const a=this._crossProduct(r,this._sub(i,e));let l=this._dotProduct(r,this._sub(i,e));l<.05*n?l=.05*n:l>.95*n&&(l=.95*n);const c=[e[0]+r[0]*l,e[1]+r[1]*l];this._leftPerpendicular(r);const h=[];h.push([c[0]+r[0]*a*.5,c[1]+r[1]*a*.5]),h.push(this._mid(c,o)),h.push([c[0]-r[0]*a*.5,c[1]-r[1]*a*.5]),t.push(h);break}case"PartialFirstSegment":{const[e,i]=this._arrowLastSeg(s),r=this._sub(o,e),n=this._norm(r);this._normalize(r);let a=this._dotProduct(r,this._sub(i,e));a<.05*n?a=.05*n:a>.95*n&&(a=.95*n);const l=[e[0]+r[0]*a,e[1]+r[1]*a];t.push([e,l]);break}case"Arch":{const e=this._cp2(s,0,-1),i=this._cp3(s,e,.5,1),r=this._sub(o,e),n=this._mix(i,1,r,.55),a=this._mix(i,1,r,-.55),l=[o];this._addBezier2(l,o,n,i,4),this._addBezier2(l,i,a,e,4),t.push(l);break}case"CurvedParallelTicks":{const e=this._cp2(s,-4,1),i=this._cp3(s,e,.882353,-1.94),r=this._sub(i,e);this._crossProduct(r,this._sub(o,e))>0?this._rightPerpendicular(r):this._leftPerpendicular(r);const n=[r[0]/8,r[1]/8],a=this._sub(this._mid(e,i),n),l=this._sub(this._mix(e,.75,i,.25),n),c=this._sub(this._mix(e,.25,i,.75),n),h=[e];this._addBezier2(h,e,l,a,3),this._addBezier2(h,a,c,i,3),t.push(h);for(let e=0;e<8;e++){const s=h[2*e+1],i=[this._clone(s)];i.push(this._add(s,[r[0]/4,r[1]/4])),t.push(i)}break}case"Arc90Degrees":{const e=this._cp2(s,0,-1),i=this._cp3(s,e,.5,1),r=[e];this._add90DegArc(r,e,o,i),t.push(r);break}case"TipWithPerpendicularAndTicks":{const[e,i]=this._arrowLastSeg(s),r=10*this._geomUnitsPerPoint,n=this._sub(o,e),a=this._norm(n);this._normalize(n);let l=this._crossProduct(n,this._sub(i,e)),c=this._dotProduct(n,this._sub(i,e));c<.05*a?c=.05*a:c>.95*a-r&&(c=.95*a-r);const h=this._leftPerp(n),u=[o[0]-n[0]*r,o[1]-n[1]*r],p=.5*Math.max(a-c-r,r);l=Math.abs(l);const f=[];f.push([u[0]+h[0]*(l+p)-n[0]*p,u[1]+h[1]*(l+p)-n[1]*p]),f.push([u[0]+h[0]*l,u[1]+h[1]*l]),f.push([u[0]-h[0]*l,u[1]-h[1]*l]),f.push([u[0]-h[0]*(l+p)-n[0]*p,u[1]-h[1]*(l+p)-n[1]*p]),t.push(f),t.push([u,o]);break}case"ConcentricCircles":{const e=this._cp2(s,1,0),i=this._cp3(s,e,2,0),a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);let c=this._dist(e,o),h=[c,0],u=[];for(let e=0;e<=36;e++)u.push(this._add(o,h)),this._rotateDirect(h,a,l);if(t.push(u),n>=4){u=[];const e=s[3];c=this._dist(e,o),h=[c,0];for(let e=0;e<=36;e++)u.push(this._add(o,h)),0===e&&(u.push(this._add(o,h)),r.setId(u[1],1)),this._rotateDirect(h,a,l);t.push(u)}u=[],c=this._dist(i,o),h=[c,0];for(let e=0;e<=36;e++)u.push(this._add(o,h)),this._rotateDirect(h,a,l);t.push(u);break}case"DoubleJogArrow":{o=this._arrowPath(s)[0];const[e,i]=this._arrowLastSeg(s),r=this._sub(o,e),n=this._norm(r);this._normalize(r);const a=Math.abs(this._crossProduct(r,this._sub(i,o)));let l=Math.abs(this._dotProduct(r,this._sub(i,o)));l<.05*n?l=.05*n:l>.95*n&&(l=.95*n);const c=Math.max(a,l),h=this._leftPerp(r);let u=[];const p=[o[0]-r[0]*l*.5+h[0]*a*.5,o[1]-r[1]*l*.5+h[1]*a*.5];u.push([p[0],p[1]]),p[0]+=r[0]*c*.5+h[0]*c*.4,p[1]+=r[1]*c*.5+h[1]*c*.4,u.push([p[0],p[1]]),p[0]-=h[0]*c*.25,p[1]-=h[1]*c*.25,u.push([p[0],p[1]]),p[0]+=r[0]*c*.5+h[0]*c*.4,p[1]+=r[1]*c*.5+h[1]*c*.4,u.push([p[0],p[1]]),t.push(u),u=[],p[0]=o[0]-r[0]*l*.5-h[0]*a*.5,p[1]=o[1]-r[1]*l*.5-h[1]*a*.5,u.push([p[0],p[1]]),p[0]+=r[0]*c*.5-h[0]*c*.4,p[1]+=r[1]*c*.5-h[1]*c*.4,u.push([p[0],p[1]]),p[0]+=h[0]*c*.25,p[1]+=h[1]*c*.25,u.push([p[0],p[1]]),p[0]+=r[0]*c*.5-h[0]*c*.4,p[1]+=r[1]*c*.5-h[1]*c*.4,u.push([p[0],p[1]]),t.push(u);break}case"LinkedChevrons":{const e=this._cp2(s,-5,0),i=this._cp3(s,e,-.2,1),r=this._sub(o,e);this._normalize(r);const n=this._leftPerp(r),a=Math.abs(this._crossProduct(r,this._sub(i,e)));t.push([e,o]);const l=[];l.push([o[0]-r[0]*a+n[0]*a,o[1]-r[1]*a+n[1]*a]),l.push(o),l.push([o[0]-r[0]*a-n[0]*a,o[1]-r[1]*a-n[1]*a]),t.push(l),this._addDash(t,e,[-r[0]*a+n[0]*a,-r[1]*a+n[1]*a]),this._addDash(t,e,[-r[0]*a-n[0]*a,-r[1]*a-n[1]*a]);break}case"SegmentThenHalfCircle":{const e=this._cp2(s,2,0),i=this._cp3(s,e,1.5,0);let r;r=n>=4?s[3]:this._cp3(s,e,1.25,-.5);const a=this._sub(e,o);this._normalize(a);const l=.5*this._dist(e,i),c=this._crossProduct(a,this._sub(r,o))>0,h=Math.cos(Math.PI/18);let u=Math.sin(Math.PI/18);c&&(u=-u);const p=[o,e];a[0]*=l,a[1]*=l;const f=this._add(e,a);a[0]=-a[0],a[1]=-a[1];for(let e=1;e<=18;e++)this._rotateDirect(a,h,u),p.push(this._add(f,a));t.push(p);break}case"LineWithStraightTicks":{const e=this._cp2(s,-2,1),i=this._cp3(s,e,-1,-.5),r=this._sub(i,e);this._normalize(r);const n=this._dotProduct(r,this._sub(e,o)),a=this._dotProduct(r,this._sub(i,o));let l=[o];l.push([o[0]+r[0]*n,o[1]+r[1]*n]),l.push(e),t.push(l),l=[o],l.push([o[0]+r[0]*a,o[1]+r[1]*a]),l.push(i),t.push(l);break}case"DoubleCurve":{const e=this._cp2(s,-5,-1),i=this._cp3(s,e,2,0),n=Math.atan2(1,5),a=Math.cos(n),l=Math.sin(n),c=this._sub(e,o),h=this._dist(o,e);this._normalize(c),this._rotateDirect(c,a,-l);const u=[o];u.push([o[0]+c[0]*h*.5,o[1]+c[1]*h*.5]),r.setId(u[1],1),u.push([o[0]+c[0]*h*.8,o[1]+c[1]*h*.8]),this._addBezier2(u,u[2],[o[0]+c[0]*h,o[1]+c[1]*h],e,3);const p=this._sub(i,e),f=this._dist(e,i);this._normalize(p),this._rotateDirect(p,a,-l),this._addBezier2(u,e,[i[0]-p[0]*f,i[1]-p[1]*f],[i[0]-p[0]*f*.8,i[1]-p[1]*f*.8],3),u.push(i),t.push(u);break}case"ParallelWithTicksByWidth":{const e=this._cp2(s,0,-1),i=this._cp3(s,e,.5,3),r=this._sub(e,o);this._normalize(r);const n=this._crossProduct(r,this._sub(i,o));this._leftPerpendicular(r),n>0?(this._addAngledTicks(t,o,[o[0]+r[0]*n,o[1]+r[1]*n],e),this._addAngledTicks(t,e,[e[0]+r[0]*n,e[1]+r[1]*n],o)):(this._addAngledTicks(t,[o[0]+r[0]*n,o[1]+r[1]*n],o,e),this._addAngledTicks(t,[e[0]+r[0]*n,e[1]+r[1]*n],o,e));break}case"EnclosingRoundedRectangle":{const e=this._cp2(s,3,-2),t=[Math.min(o[0],e[0]),Math.max(o[1],e[1])],i=[Math.max(o[0],e[0]),Math.min(o[1],e[1])],r=i[0]-t[0],n=t[1]-i[1],a=Math.min(r,n)/10,l=[];l.push([t[0]+a+.75*(r-2*a),t[1]]),l.push([i[0]-a,t[1]]),this._add90DegArc(l,[i[0]-a,t[1]],[i[0],t[1]-a],[i[0],t[1]]),l.push([i[0],i[1]+a]),this._add90DegArc(l,[i[0],i[1]+a],[i[0]-a,i[1]],i),l.push([t[0]+a,i[1]]),this._add90DegArc(l,[t[0]+a,i[1]],[t[0],i[1]+a],[t[0],i[1]]),l.push([t[0],t[1]-a]),this._add90DegArc(l,[t[0],t[1]-a],[t[0]+a,t[1]],t),l.push([t[0]+a+.75*(r-2*a),t[1]]);break}default:t.push(s)}}return t}}e.EffectControlMeasureLine=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(e,t,s,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,s){return new n(e,t,s)}}class n extends s.PathEffectCursor{constructor(e,t,s){super(e,!0,!0),this._curveHelper=new i.CurveHelper,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*s,this._endCut=(void 0!==t.endCut?t.endCut:1)*s,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*s,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:s,_endCut:i,_middleCut:r}=this,n=e.pathLength(),o=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==s||0!==i||0!==r)if(s+i+r>=n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,s),this._curveHelper.appendSubCurve(o,e,.5*(n-r),.5*(n+r)),this._curveHelper.appendSubCurve(o,e,n-i,i)}else if(0===s&&0===i&&0===r)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else s+i+r<n&&(0===r?this._curveHelper.appendSubCurve(o,e,s,n-i):(this._curveHelper.appendSubCurve(o,e,s,.5*(n-r)),this._curveHelper.appendSubCurve(o,e,.5*(n+r),n-i)));return 0===o.totalSize?null:o}}e.EffectCut=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../GeometryWalker","../utils"],function(e,t,s,i,r,n){"use strict";class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,s){return new a(e,t,s)}}class a extends i.PathEffectCursor{constructor(e,t,s){super(e,!0,!0),this._firstCurve=null,this._walker=new r.GeometryWalker,this._walker.updateTolerance(s),this._endings=t.lineDashEnding,this._customDashPos=-(t.offsetAlongLine??0)*s,this._offsetAtEnd=(t.customEndingOffset??0)*s;let i=n.normalizeDashEffectTemplate(t).dashTemplate;null==i&&(i=[]),i.length%2&&(i=[...i,...i]),this._pattern=new r.DashPattern,this._pattern.init(i,!0),this._pattern.scale(s)}processPath(e){if(0===this._pattern.length()){this.iteratePath=!1;const i=s.collectPath(e);return t.GeometryCursor.fromJSONCIM({paths:[i]})}if(!this.iteratePath){let i=!0;switch(this._endings){case"HalfPattern":case"HalfGap":default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(i=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const r=e.pathLength();if(this._pattern.isEmpty()||r<.1*this._pattern.length()){const i=s.collectPath(e);return t.GeometryCursor.fromJSONCIM({paths:[i]})}if(!this._walker.init(e,this._pattern,i)){const i=s.collectPath(e);return t.GeometryCursor.fromJSONCIM({paths:[i]})}}let i;if(this.iteratePath)i=this._pattern.nextValue();else{let e;switch(this._endings){case"HalfPattern":default:e=.5*this._pattern.firstValue();break;case"HalfGap":e=.5*-this._pattern.lastValue();break;case"FullGap":e=-this._pattern.lastValue();break;case"FullPattern":e=0;break;case"NoConstraint":case"Custom":e=-this._customDashPos}let t=e/this._pattern.length();t-=Math.floor(t),e=t*this._pattern.length(),this._pattern.reset(),i=this._pattern.nextValue();let s=!1;for(;e>=i;)e-=i,i=this._pattern.nextValue(),s=!s;i-=e,s?(this._walker.nextPosition(i),i=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(i),i=this._pattern.nextValue(),this._walker.nextPosition(i),i=this._pattern.nextValue())}let r=this._walker.nextCurve(i);if(r)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)r.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else i=this._pattern.nextValue(),!this._walker.nextPosition(i)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(r.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,r=this._firstCurve,this._firstCurve=null;return r?.reset(),r}}e.EffectDashes=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor","./CurveHelper"],function(e,t,s){"use strict";class i{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class r extends s.CurveHelper{constructor(e=0,t=!1){super(e,t),this._tempPos=new i,this._tempPt=[0,0],this._tolerance=s.pixelTolerance,this._currentPosition=new i}updateTolerance(e){this._tolerance=s.pixelTolerance*e}init(e,t,s=!0){return s?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=0){const s=new i;return!!this._nextPosition(e,s,null,t)&&(s.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[t,s]=this._getAngleCS(this._tempPt,this._currentPosition);e.ca=t,e.sa=s}nextPointAndAngle(e,t,s=0){const i=this._tempPos;if(!this._nextPosition(e,i,null,s))return!1;i.copyTo(this._currentPosition),t.pt=this._getPoint(i);const[r,n]=this._getAngleCS(this._tempPt,i);return t.ca=r,t.sa=n,!0}nextCurve(e){if(0===e)return null;const s=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");s.startPath(),s.nextPath();const r=new i;return this._nextPosition(e,r,s,1)?(r.copyTo(this._currentPosition),s):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,t,s,i){if(this._currentPosition.isPathEnd)return!1;let r=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(r/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(s){if(0===s.pathSize)if(0===r){const e=t.segment[0];s.pushXY(e[0],e[1])}else s.pushPoint(this.getSegCoord2D(t.segment,r));const e=t.segment[1];s.pushXY(e[0],e[1])}if(r=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.getSegLength(t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return 0!==i&&(t.segmentLength=this.getSegLength(t.segment),t.isPartEnd=!0,1===i?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,s){0===s.pathSize&&(0===r?s.pushPoint(t.segment[0]):s.pushPoint(this.getSegCoord2D(t.segment,r)));const e=t.abscissa/t.segmentLength;1===e?s.pushPoint(t.segment[1]):s.pushPoint(this.getSegCoord2D(t.segment,e))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,t)}_getAngleCS(e,t){const s=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(e,this._currentPosition.segment,s)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const t=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(t);let s=t+this._partSegCount+1;if(s>=this._pathCursor.pathSize&&(s=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(s),this._patternLength>0){const e=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,t=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let s=Math.round((this._partLength-(e+t))/this._patternLength);s<=0&&(s=e+t>0?0:1),this._partLengthRatio=this._partLength/(e+t+s*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}e.DashPattern=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t,s=!0){if(this._setEmpty(),!e||0===e.length)return!1;for(let t=0;t<e.length;t++){let i=Math.abs(e[t]);s&&i<1e-7&&(i=1e-7),this._values.push(i),this._length+=i}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const t=this._values?this._values.length:0;for(let s=0;s<t;++s)this._values[s]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},e.GeometryWalker=r,e.Pos=class{constructor(){this.pt=null,this.ca=0,this.sa=0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../CIMEffects"],function(e,t,s,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,s,i,r,o){return new n(e,t,s,i,r,o)}}class n{constructor(e,t,s,i,r,n){this._preventClipping=n,this._inputGeometries=e,this._tileKey=i,this._maxInflateSize=r*s,this._width=(void 0!==t.width?t.width:2)*s,t.method,this._option=t.option}next(){let e;for(;e=this._inputGeometries.next();){if("esriGeometryEnvelope"===e.geometryType&&this._width>0){const s=e.asJSON();return Math.min(s.xmax-s.xmin,s.ymax-s.ymin)-2*this._width<0?e:t.GeometryCursor.fromJSONCIM({paths:[[[s.xmin+this._width,s.ymin+this._width],[s.xmax-this._width,s.ymin+this._width],[s.xmax-this._width,s.ymax-this._width],[s.xmin+this._width,s.ymax-this._width],[s.xmin+this._width,s.ymin+this._width]],[[s.xmin,s.ymin],[s.xmin,s.ymax],[s.xmax,s.ymax],[s.xmax,s.ymin],[s.xmin,s.ymin]]]})}if("esriGeometryPolygon"===e.geometryType){if(0===this._width)return e.clone();const t=i.lazyBufferOperator.module,r=!this._preventClipping&&this._tileKey?i.clipCursorToTileExtent(e,this._maxInflateSize,!0):e.clone();if(!r)continue;const n={...r.asJSON(),spatialReference:{wkid:s.WebMercator.wkid}},o=t.execute(n,-this._width);if(o)for(const e of o.rings)if(e){r.startPath();for(const t of e.reverse())r.pushXY(t[0],r.yFactor*t[1])}return r}}return null}}e.EffectDonut=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectEnclosingPolygon":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../../../geometry/support/boundsUtils","../CIMEffects"],function(e,t,s,i,r){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t){return new o(e,t)}}class o{constructor(e,t){this._inputGeometries=e,this._medhod=t.method}next(){let e=this._inputGeometries.next();const t=this._medhod;for(;null!=e;){if(e.totalSize>0)switch(t){case"RectangularBox":return a(e);case"ConvexHull":return this._constructConvexHull(e);default:return l(e)}e=this._inputGeometries.next()}return null}_constructConvexHull(e){switch(e.geometryType){case"esriGeometryPolyline":case"esriGeometryPolygon":{const i=r.lazyConvexHullOperator.module,n={...e.asJSON(),spatialReference:{wkid:s.WebMercator.wkid}},o=i.execute(n);return o?t.GeometryCursor.fromJSONCIM(o):null}case"esriGeometryEnvelope":return e;default:return null}}}function a(e){const s=i.getCursorBoundsXY(e),r={xmin:s[0],ymin:s[1],xmax:s[2],ymax:s[3]};return t.GeometryCursor.fromJSONCIM(r)}function l(e){switch(e.geometryType){case"esriGeometryPolyline":{const s=[];for(;e.nextPath();)c(e,s);return t.GeometryCursor.fromJSONCIM({rings:s})}case"esriGeometryPolygon":case"esriGeometryEnvelope":return e;default:return null}}function c(e,t){if(e.seekPathStart(),!e.nextPoint())return;const s=e.x,i=e.y,r=[[s,i]];for(t.push(r);e.nextPoint();)r.push([e.x,e.y]);r.push([s,i])}e.EffectEnclosingPolygon=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(e,t,s,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,s){return new n(e,t,s)}}class n extends s.PathEffectCursor{constructor(e,t,s){super(e,!1,!0),this._curveHelper=new i.CurveHelper,this._length=(void 0!==t.length?t.length:20)*s,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const s=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const i=e.x,r=e.y;e.seekInPath(e.pathSize-1);const n=e.x,o=e.y,a=[n-i,o-r];this._curveHelper.normalize(a);const l=i+(n-i)*this._position/100,c=r+(o-r)*this._position/100,h=Math.cos((90-this._angle)/180*Math.PI);let u=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(u=-u),this._mirror=!this._mirror;const p=[l-this._length/2*h,c-this._length/2*u],f=[l+this._length/2*h,c+this._length/2*u];return s.pushPath([[i,r],p,f,[n,o]]),s}}e.EffectJog=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(e){"use strict";class t{static{this.instance=null}static local(){return null===t.instance&&(t.instance=new t),t.instance}execute(e,t,i){return new s(e,t,i)}}class s{constructor(e,t,s){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*s:0,this._offsetY=void 0!==t.offsetY?t.offsetY*s:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,t,s){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+t,e.y=e.y+s;return e.reset(),e}}e.EffectMove=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/SpatialReference","../../../geometry/support/jsonUtils","../CIMEffects","../CurveHelper"],function(e,t,s,i,r,n,o){"use strict";class a{static{this.instance=null}static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(e,t,s,i,r,n){return new l(e,t,s,i,r,n)}}class l{constructor(e,t,s,i,r,n){this._preventClipping=n,this._inputGeometries=e,this._tileKey=i,this._curveHelper=new o.CurveHelper,this._offset=(t.offset??1)*s,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(r*s),10),this._option=t.option,this._offsetFlattenError=o.pixelTolerance*s}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if("Rounded"===this._method&&this._offset>0){const i=s.collectPath(e),r=this._curveHelper.offset(i,-this._offset,this._method,4,this._offsetFlattenError);if(r){const s=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);return s.pushPath(r),s}return null}const i=e.asJSON();if(r.isExtent(i)&&Math.min(i.xmax-i.xmin,i.ymax-i.ymin)+2*this._offset>0)return t.GeometryCursor.fromJSONCIM({xmin:i.xmin-this._offset,xmax:i.xmax+this._offset,ymin:i.ymin-this._offset,ymax:i.ymax+this._offset})}const o=!this._preventClipping&&this._tileKey?n.clipCursorToTileExtent(e,this._maxInflateSize,!0):e.clone();if(!o)continue;const a=n.lazyOffsetOperator.module,l={...o.asJSON(),spatialReference:{wkid:i.WebMercator.wkid}},h=a.execute(l,-this._offset,{joins:c(this._method),flattenError:this._offsetFlattenError,miterLimit:4});return h?t.GeometryCursor.fromJSONCIM(h):null}return null}}function c(e){switch(e){case"Rounded":return"round";case"Bevelled":return"bevel";case"Mitered":return"miter";case"Square":return"square"}}e.EffectOffset=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRadial":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/support/centroid","../defaultCIMValues"],function(e,t,s,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,s){return new n(e,t,s)}}class n{constructor(e,t,s){this._inputGeometries=e,this._length=(void 0!==t.length?t.length:i.defaultCIMValues.CIMGeometricEffectRadial.length)*s,this._angle=void 0!==t.angle?t.angle*Math.PI/180:i.defaultCIMValues.CIMGeometricEffectRadial.angle,this._lx=Math.cos(this._angle)*this._length,this._ly=Math.sin(this._angle)*this._length}next(){let e=this._inputGeometries.next();for(;e;){if("esriGeometryPoint"===e.geometryType||"esriGeometryMultipoint"===e.geometryType){const s=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return e.nextPath()&&e.nextPoint()&&s.pushPath([[e.x,e.y],[e.x+this._lx,e.y+this._ly]]),s}if("esriGeometryPolygon"===e.geometryType){const i=s.ringsCentroidCursor(e);if(!i)return null;const r=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return r.pushPath([[i[0],i[1]],[i[0]+this._lx,i[1]+this._ly]]),r}e=this._inputGeometries.next()}return null}}e.EffectRadial=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(e){"use strict";class t{static{this.instance=null}static local(){return null===t.instance&&(t.instance=new t),t.instance}execute(e,t,i){return new s(e,t,i)}}class s{constructor(e,t,s){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if("esriGeometryPolyline"===e.geometryType)return i(e.clone());e=this._inputGeometries.next()}return null}}function i(e){for(;e.nextPath();)for(let t=0;t<e.pathSize/2;t++){e.seekInPath(t);const s=e.x,i=e.y;e.seekInPath(e.pathSize-t-1);const r=e.x,n=e.y;e.x=s,e.y=i,e.seekInPath(t),e.x=r,e.y=n}return e.reset(),e}e.EffectReverse=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(e,t){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,s){return new i(e,t,s)}}class i{constructor(e,t,s){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?t.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._rotateAngle||"esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const s=t.getCursorBoundsXY(e),i=(s[2]+s[0])/2,r=(s[3]+s[1])/2;return e.reset(),this._rotate(e.clone(),i,r)}e=this._inputGeometries.next()}return null}_rotate(e,t,s){const i=Math.cos(this._rotateAngle),r=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const n=e.x-t,o=e.y-s;e.x=t+n*i-o*r,e.y=s+n*r+o*i}return e.reset(),e}}e.EffectRotate=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../geometry/support/boundsUtils"],function(e,t){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,s){return new i(e,t,s)}}class i{constructor(e,t,s){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(1===this._xFactor&&1===this._yFactor)return e;if("esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const s=t.getCursorBoundsXY(e),i=(s[2]+s[0])/2,r=(s[3]+s[1])/2;return e.reset(),this._scaleCursor(e.clone(),i,r)}}return null}_scaleCursor(e,t,s){for(;e.nextPath();)for(;e.nextPoint();)e.x=t+(e.x-t)*this._xFactor,e.y=s+(e.y-s)*this._yFactor;return e.reset(),e}}e.EffectScale=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectSuppress":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/support/PolylineBuilder","../CIMCursor"],function(e,t,s,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,s){return new n(e,t,s)}}class n extends i.PathEffectCursor{constructor(e,t,s){super(e,!1,!0),this._suppress=void 0!==t.suppress&&t.suppress,this._invert=void 0!==t.invert&&t.invert}processPath(e){if(e.totalSize<=0)return null;if(!this._suppress){const s=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolygon",!1,!1,e.yFactor);for(e.seekPathEnd();e.nextPoint();)s.pushXY(e.x,e.y);return s}const i=[],r=new Array(e.pathSize);let n=0;for(e.seekPathStart();e.nextPoint();)r[n++]=e.getControlPoint(),i.push([e.x,e.y]);let o=!0,a=!0,l=!1,c=!this._invert;n=0;const h=new s;let u=i[0];for(;n<i.length;){const e=i[n+1],t=r[n],s=r[n+1];n++,a&&(c=t||s?this._invert:!this._invert,a=!1),c?(h.addSegment(u,e,o),o=!1):l=!0,u=e,s&&(c?(c=!1,o=!0):c=!0)}const p=h.getGeometry();if(0===p.length)return null;if(!l&&i[0][0]===i[i.length-1][0]&&i[0][1]===i[i.length-1][1]){const e=p[p.length-1];return e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]),t.GeometryCursor.fromJSONCIM({paths:p})}const f=p[p.length-1];return h.getPointCount()>1&&"esriGeometryPolygon"===e.geometryType&&f[0][0]===f[f.length-1][0]&&f[0][1]===f[f.length-1][1]&&p.length>1&&(p[p.length-1].push(...p[0]),p.splice(0,1)),t.GeometryCursor.fromJSONCIM({paths:p})}}e.EffectSuppress=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/PolylineBuilder":function(){define(function(){"use strict";return class{constructor(){this._polyline=[]}beginPath(e){this._polyline.push([e])}lineTo(e){if(0===this._polyline.length)throw new Error("No path started. Call beginPath first.");this._polyline[this._polyline.length-1].push(e)}getPointCount(){return this._polyline.reduce((e,t)=>e+t.length,0)}addSegment(e,t,s){s&&this.beginPath(e),this.lineTo(t)}getXY(e){let t=0;for(const s of this._polyline){if(e<t+s.length)return s[e-t];t+=s.length}return null}getGeometry(){return this._polyline}}})},"esri/symbols/cim/effects/EffectTaperedPolygon":function(){define(["exports","../../../core/Error","../../../core/Logger","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../../../geometry/support/jsonUtils","../../../geometry/support/PolylineBuilder","../../../geometry/support/TileClipper","../CIMCursor","../CIMEffects"],function(e,t,s,i,r,n,o,a,l,c){"use strict";const h=()=>s.getLogger("esri.symbols.cim.effects.EffectTaperedPolygon");class u{static{this.instance=null}static local(){return null===u.instance&&(u.instance=new u),u.instance}execute(e,t,s){return new p(e,t,s)}}class p extends l.PathEffectCursor{constructor(e,t,s){super(e,!1,!0),this._slopeS=0,this._slopeC=1,this._lastTangent1=new a.Point(NaN,NaN),this._lastWidth=0,this._geomUnitsPerPoint=s,this._halfFromWidth=Math.abs(void 0!==t.fromWidth?t.fromWidth:0)*s*.5,this._halfToWidth=Math.abs(void 0!==t.toWidth?t.toWidth:1)*s*.5,this._originalLength=(void 0!==t.length?t.length:0)*s,this._length=0}processPath(e){if(e.totalSize<=0)return null;if(this._halfFromWidth<=0&&this._halfToWidth<=0){const t=i.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolygon",!1,!1,e.yFactor);for(e.seekPathEnd();e.prevPoint();)t.pushXY(e.x,e.y);for(e.seekPathStart();e.nextPoint();)t.pushXY(e.x,e.y);return t}const s=e.asJSON();e.seekPath(e.totalSize-1);const a=c.lazyGeneralizeOperator.module.execute(s,.25*this._geomUnitsPerPoint,{removeDegenerateParts:!0}),l=null==a?null:n.isPolygon(a)?a.rings:n.isPolyline(a)?a.paths:null;if(!l)return h().error(new t("mapview-bad-resource","Unable to process geometry")),null;const u=c.lazyLengthOperator.module.execute(a);if((0===this._originalLength||this._originalLength>u)&&u>0){this._length=u;const e=(this._halfToWidth-this._halfFromWidth)/this._length;if(Math.abs(e)<1){const t=e*e;this._slopeC=Math.sqrt(1/(1+t)),this._slopeS=Math.sqrt(t/(1+t)),e<0&&(this._slopeS=-this._slopeS)}else this._slopeC=this._slopeS=.7071}else this._length=this._originalLength,this._slopeC=1,this._slopeS=0;const p=[];for(const e of l){const t=new o,s=new o;let i=0;this._setFromOffset(e.slice(0,2),t,s);for(let r=0,n=3;n<=e.length;++r,++n)i=this._setOffset(e.slice(r,n),i,t,s);this._setToOffset(e.slice(-2),i,t,s);const[r]=t.getGeometry(),[n]=s.getGeometry();p.push([...r,...n.reverse()])}const f={rings:p,spatialReference:{wkid:r.WebMercator.wkid}},d=c.lazySimplifyOperator.module.execute(f);return i.GeometryCursor.fromJSONCIM(d)}_setFromOffset([[e,t],[s,i]],r,n){const o=this._halfFromWidth,l=new a.Point(s-e,i-t).normalize().scale(o);r.beginPath([e-l.y,t+l.x]),n.beginPath([e+l.y,t-l.x])}_setToOffset([[e,t],[s,i]],r,n,o){let l;l=(r+=Math.sqrt((s-e)**2+(i-t)**2))>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*r/this._length;const c=new a.Point(s-e,i-t).normalize().scale(l);n.lineTo([s-c.y,i+c.x]),o.lineTo([s+c.y,i-c.x])}_setOffset([[e,s],[i,r],[n,o]],l,c,u){const p=Math.sqrt((i-e)**2+(r-s)**2);let f;f=l+p>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*(l+p)/this._length,l+=p;const d=new a.Point(i,r),m=new a.Point(i-e,r-s).normalize(),y=new a.Point(n-i,o-r).normalize(),g=a.Point.sub(y,m),_=c.getPointCount(),b=u.getPointCount();m.leftPerpendicular(),y.leftPerpendicular();const x=m.x*y.x+m.y*y.y;if(x>.99){const e=a.Point.add(m,y).scale(f/2),t=e.clone().rotate(this._slopeC,this._slopeS);c.lineTo([d.x+t.x,d.y+t.y]);const s=e.rotateReverse(this._slopeC,this._slopeS);u.lineTo([d.x-s.x,d.y-s.y])}else{const i=m.x*y.y-m.y*y.x;if(g.scale(1/i),i<0){g.scale(-f).rotateReverse(this._slopeC,this._slopeS);const e=u.getXY(b-1);e||h().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const s=a.Point.add(d,g).sub(a.Point.fromArray(e));if(m.x*s.y-m.y*s.x>0){const e=m.clone().scale(-f).rotateReverse(this._slopeC,this._slopeS),t=y.clone().scale(-f).rotateReverse(this._slopeC,this._slopeS);u.lineTo([d.x+e.x,d.y+e.y]),u.lineTo([d.x,d.y]),u.lineTo([d.x+t.x,d.y+t.y])}else u.lineTo([d.x+g.x,d.y+g.y])}else{g.scale(f).rotate(this._slopeC,this._slopeS);const e=c.getXY(_-1);e||h().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const s=a.Point.add(d,g).sub(a.Point.fromArray(e));if(m.x*s.y-m.y*s.x>0){const e=m.clone().scale(f).rotate(this._slopeC,this._slopeS),t=y.clone().scale(f).rotate(this._slopeC,this._slopeS);c.lineTo([d.x+e.x,d.y+e.y]),c.lineTo([d.x,d.y]),c.lineTo([d.x+t.x,d.y+t.y])}else c.lineTo([d.x+g.x,d.y+g.y])}const r=Math.acos(x);let n=1;if(f>.25){const e=2*Math.acos(1-.25/f);e<r&&(n=Math.round(r/e))}const o=Math.cos(r/n),l=Math.sin(r/n),p=m.clone();if(i<0){p.rotate(this._slopeC,this._slopeS);const i=c.getXY(_-1);i||h().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const r=a.Point.add(d,p.clone().scale(this._lastWidth)),n=a.Point.sub(r,a.Point.fromArray(i)),o=m.x*n.y-m.y*n.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&o>0){const t=new a.Point(e,s),i=this._lastTangent1.clone().scale(this._lastWidth);i.rotate(this._slopeC,this._slopeS);const r=m.clone().scale(this._lastWidth);r.rotate(this._slopeC,this._slopeS),c.lineTo([t.x+i.x,t.y+i.y]),c.lineTo([t.x,t.y]),c.lineTo([t.x+r.x,t.y+r.y])}}else{p.scale(-1).rotateReverse(this._slopeC,this._slopeS);const i=u.getXY(b-1);i||h().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const r=a.Point.add(d,p.clone().scale(this._lastWidth)),n=a.Point.sub(r,a.Point.fromArray(i)),o=m.x*n.y-m.y*n.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&o>0){const t=new a.Point(e,s),i=this._lastTangent1.clone().scale(-this._lastWidth);i.rotateReverse(this._slopeC,this._slopeS);const r=m.clone().scale(-this._lastWidth);r.rotateReverse(this._slopeC,this._slopeS),u.lineTo([t.x+i.x,t.y+i.y]),u.lineTo([t.x,t.y]),u.lineTo([t.x+r.x,t.y+r.y])}}p.scale(f);for(let e=0;e<=n;e++)i<0?(c.lineTo([d.x+p.x,d.y+p.y]),p.rotateReverse(o,l)):(u.lineTo([d.x+p.x,d.y+p.y]),p.rotate(o,l))}return this._lastTangent1.setCoords(m.x,m.y),this._lastWidth=f,l}}e.EffectTaperedPolygon=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports","../../../geometry/GeometryCursor","../GeometryWalker"],function(e,t,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,s){return new r(e,t,s)}}class r{constructor(e,t,i){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*i,this._period=(void 0!==t.period?t.period:3)*i,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new s.DashPattern,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new s.GeometryWalker,this._walker.updateTolerance(i)}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._height||0===this._period)return e;const t=this._processGeom(e);if(t)return t;e=this._inputGeometries.next()}return null}_processGeom(e){const s=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){s.startPath();const t=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case"Sinus":default:this._constructCurve(s,t,!1);break;case"Square":this._constructSquare(s,t);break;case"Triangle":this._constructTriangle(s,t);break;case"Random":this._constructCurve(s,t,!0)}else for(;e.nextPoint();)s.pushXY(e.x,e.y)}return s}_constructCurve(e,t,i){let r=Math.round(t/this._period);0===r&&(r=1);const n=16*r+1,o=t/r,a=this._period/16,l=1/n,c=2*Math.PI*t/o,h=2*Math.PI*Math.random(),u=2*Math.PI*Math.random(),p=2*Math.PI*Math.random(),f=.75-Math.random()/2,d=.75-Math.random()/2,m=new s.Pos;this._walker.curPointAndAngle(m),e.pushPoint(m.pt);let y=0;for(;;){if(!this._walker.nextPointAndAngle(a,m)){e.pushPoint(this._walker.getPathEnd());break}{const t=y;let s;if(y+=l,i){const e=this._height/2*(1+.3*Math.sin(f*c*t+h));s=e*Math.sin(c*t+u),s+=e*Math.sin(d*c*t+p),s/=2}else s=.5*this._height*Math.sin(.5*c*t);e.pushXY(m.pt[0]-s*m.sa,m.pt[1]+s*m.ca)}}}_constructSquare(e,t){Math.round(t/this._period);let i=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const r=new s.Pos;this._walker.curPointAndAngle(r);const n=new s.Pos;if(this._walker.nextPointAndAngle(this._period,n)){const o=new s.Pos;this._walker.nextPointAndAngle(this._period,o)&&(i?(e.pushPoint(r.pt),i=!1):e.pushPoint(r.pt),e.pushXY(r.pt[0]-this._height/2*r.sa,r.pt[1]+this._height/2*r.ca),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(n.pt[0]+this._height/2*n.sa,n.pt[1]-this._height/2*n.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,t){Math.round(t/this._period);let i=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const r=new s.Pos;this._walker.curPointAndAngle(r);const n=new s.Pos;if(this._walker.nextPointAndAngle(this._period/2,n)){const o=new s.Pos;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(i?(e.pushPoint(r.pt),i=!1):e.pushPoint(r.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}}e.EffectWave=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(e,t,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,s){return new r(e,t,s)}}class r extends t.PathTransformationCursor{constructor(e,t,i){super(e),this._geometryWalker=new s.GeometryWalker,this._geometryWalker.updateTolerance(i),this._angleToLine=t.angleToLine??!0,this._offset=(t.offset?t.offset:0)*i,this._originalEndings=t.endings,this._offsetAtEnd=(t.customEndingOffset?t.customEndingOffset:0)*i,this._position=-(t.offsetAlongLine?t.offsetAlongLine:0)*i,this._pattern=new s.DashPattern,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(i),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{"WithFullGap"===this._originalEndings&&this.isClosed?this._endings="WithMarkers":this._endings=this._originalEndings,this._pattern.extPtGap=0;let s,i=!0;switch(this._endings){case"NoConstraint":s=-this._position,s=this._adjustPosition(s),i=!1;break;case"WithHalfGap":default:s=-this._pattern.lastValue()/2;break;case"WithFullGap":s=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case"WithMarkers":s=0;break;case"Custom":s=-this._position,s=this._adjustPosition(s),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,i))return null;this._pattern.reset();let r=0;for(;s>r;)s-=r,r=this._pattern.nextValue();r-=s,t=r,this.iteratePath=!0}const i=new s.Pos;return this._geometryWalker.nextPointAndAngle(t,i)?"WithFullGap"===this._endings&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):"WithMarkers"===this._endings&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca),this._angleToLine&&this.internalPlacement.setRotateCS(i.ca,i.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}}e.PlacementAlongLineSameSize=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,t,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,s){return new r(e,t,s)}}class r extends t.PathTransformationCursor{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new s.CurveHelper,this._placePerPart=t.placePerPart??!1,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*i:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let t;switch(this._type){case"Both":default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case"JustBegin":t=this._atExtremities(e,this._position,!0);break;case"JustEnd":t=this._atExtremities(e,this._position,!1);case"None":}return t}_atExtremities(e,t,s){if(this._placePerPart||(s?e.seekPath(0):e.seekPath(e.totalSize-1)),s||e.seekPathEnd(),s?e.nextPoint():e.prevPoint()){let i=0,[r,n]=[0,0],[o,a]=[e.x,e.y];const l=[0,0];for(;s?e.nextPoint():e.prevPoint();){r=o,n=a,o=e.x,a=e.y;const s=this._curveHelper.getLength(r,n,o,a);if(i+s>t){const e=(t-i)/s,[c,h]=this._curveHelper.getAngleCS(l,r,n,o,a,e),u=this._curveHelper.getCoord2D(r,n,o,a,e);return this.internalPlacement.setTranslate(u[0]-this._offset*h,u[1]+this._offset*c),this._angleToLine&&this.internalPlacement.setRotateCS(-c,-h),this.internalPlacement}i+=s}}return null}}e.PlacementAtExtremities=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(e,t,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,s){return new r(e,t,s)}}class r extends t.PathTransformationCursor{constructor(e,t,i){super(e),this._walker=new s.GeometryWalker,this._walker.updateTolerance(i),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*i:0,this._endGap=void 0!==t.endPosition?t.endPosition*i:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new s.DashPattern,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){const e=this._pattern.nextValue()*this._subPathLen,s=this._beginGap+e;t=s-this._prevPos,this._prevPos=s}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const s=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+s;t=i-this._prevPos,this._prevPos=i,this.iteratePath=!0}const i=new s.Pos;if(!this._walker.nextPointAndAngle(t,i,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(i.pt[0]-this._offset*i.sa,i.pt[1]+this._offset*i.ca);const r=this._isFirst&&this._flipFirst;let n,o;return this._angleToLine?(n=i.ca,o=i.sa):(n=1,o=0),r&&(n=-n,o=-o),this.internalPlacement.setRotateCS(n,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}e.PlacementAtRatioPositions=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports","../../../core/RandomLCG","../CIMPlacements"],function(e,t,s){"use strict";const i=512,r=24,n=1e-6;class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,s,i){return new a(e,t,s,i)}}class a{constructor(e,r,n,o){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(r.stepX??16)*n,this._stepY=Math.abs(r.stepY??16)*n,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=r.gridType??"Fixed","Random"===this._gridType){const e=r.seed??13,s=1;this._randomLCG=new t(e*s),this._randomness=(r.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=r.gridAngle??0,this._shiftOddRows=r.shiftOddRows??!1,this._offsetX=(r.offsetX??0)*n,this._offsetY=(r.offsetY??0)*n,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=o){const[e,t,s,r]=o.split("/"),n=parseFloat(e),a=parseFloat(t),l=parseFloat(s),c=parseFloat(r);this._graphicOriginX=-(c*2**n+l)*i,this._graphicOriginY=a*i,this._testInsidePolygon=!0}this._internalPlacement=new s.Placement,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!a._randValues){a._randValues=[];for(let e=0;e<r;e++)for(let e=0;e<r;e++)a._randValues.push(this._randomLCG.getFloat()),a._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let t,s,r,n,o,a,l,c,h,u,p,f,d,m;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=d=p=Number.MAX_VALUE,h=u=m=f=-Number.MAX_VALUE;const y=1!==this._cosAngle;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,t=a-this._graphicOriginX-this._offsetX,s=o-this._graphicOriginY-this._offsetY,y?(r=this._cosAngle*t-this._sinAngle*s,n=this._sinAngle*t+this._cosAngle*s):(r=t,n=s),l=Math.min(l,r),h=Math.max(h,r),c=Math.min(c,n),u=Math.max(u,n),p=Math.min(p,o),f=Math.max(f,o),d=Math.min(d,a),m=Math.max(m,a);p=p!==Number.MAX_VALUE?p:-512-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,d=d!==Number.MAX_VALUE?d:-this._stepX,m=m!==-Number.MAX_VALUE?m:i+this._stepX;const g=f-p,_=m-d;if(this._verticalSubdivision=g>=_,this._polygonMin=this._verticalSubdivision?p:d,this._testInsidePolygon){let e=0-this._graphicOriginX-this._offsetX-this._stepX,t=i-this._graphicOriginX-this._offsetX+this._stepX,s=-512-this._graphicOriginY-this._offsetY-this._stepY,r=0-this._graphicOriginY-this._offsetY+this._stepY;if(y){const i=[[e,s],[e,r],[t,s],[t,r]];e=s=Number.MAX_VALUE,t=r=-Number.MAX_VALUE;for(const n of i){const i=this._cosAngle*n[0]-this._sinAngle*n[1],o=this._sinAngle*n[0]+this._cosAngle*n[1];e=Math.min(e,i),t=Math.max(t,i),s=Math.min(s,o),r=Math.max(r,o)}}l=l!==Number.MAX_VALUE?Math.max(l,e):e,c=c!==Number.MAX_VALUE?Math.max(c,s):s,h=h!==-Number.MAX_VALUE?Math.min(h,t):t,u=u!==-Number.MAX_VALUE?Math.min(u,r):r}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(h/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(u/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,d,m,p,f)}_buildAccelerationMap(e,t,s,r,n){e.reset();const o=new Map,a=this._verticalSubdivision,c=a?n-r:s-t;let h=Math.ceil(c/10);if(h<=1)return;const u=Math.floor(c/h);let p,f,d,m,y,g,_,b,x,S,v;for(h++,this._delta=u,a?(x=-512-2*this._stepY,S=2*this._stepY,v=r):(x=-2*this._stepX,S=i+2*this._stepX,v=t);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(p=e.x,f=e.y;e.nextPoint();p=d,f=m){if(d=e.x,m=e.y,a){if(f===m||f<x&&m<x||f>S&&m>S)continue;y=Math.min(f,m),g=Math.max(f,m)}else{if(p===d||p<x&&d<x||p>S&&d>S)continue;y=Math.min(p,d),g=Math.max(p,d)}for(;y<g;)_=Math.floor((y-v)/u),l(_,p,f,d,m,o),y+=u;b=Math.floor((g-v)/u),b>_&&l(b,p,f,d,m,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const t=this._currentY*this._stepY+this._offsetY;let s,i;if(this._currentX++,"Random"===this._gridType){const n=(this._currentX%r+r)%r,o=(this._currentY%r+r)%r;s=this._graphicOriginX+e+this._stepX*this._randomness*(.5-a._randValues[o*r+n])*2/3,i=this._graphicOriginY+t+this._stepY*this._randomness*(.5-a._randValues[o*r+n+1])*2/3}else s=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,i=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t;if(!this._testInsidePolygon||this._isInsidePolygon(s,i,this._geometryCursor))return this._internalPlacement.setTranslate(s,i),this._internalPlacement}}_isInsidePolygon(e,t,s){if(null==this._accelerationMap)return function(e,t,s){let i,r,o,a,l=0;for(e+=n,t+=n,s.reset();s.nextPath();)if(s.nextPoint())for(i=s.x,r=s.y;s.nextPoint();i=o,r=a)o=s.x,a=s.y,r>t!=a>t&&((o-i)*(t-r)-(a-r)*(e-i)>0?l++:l--);return 0!==l}(e,t,s);e+=n,t+=n;const i=this._verticalSubdivision,r=i?t:e,o=Math.floor((r-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,h,u=0;for(const s of a){if(l=s[0],c=s[1],i){if(l[1]>t==c[1]>t)continue;h=(c[0]-l[0])*(t-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;h=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(t-l[1])}h>0?u++:u--}return 0!==u}}function l(e,t,s,i,r,n){let o=n.get(e);o||(o=[],n.set(e,o)),o.push([[t,s],[i,r]])}e.PlacementInsidePolygon=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,t,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,s){return new r(e,t,s)}}class r extends t.PathTransformationCursor{constructor(e,t,i){super(e),this._curveHelper=new s.CurveHelper,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*i:0,this._epsilon=.001*i}processPath(e){const t=this._position;if("SegmentMidpoint"===this._relativeTo){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[t,s]=[e.x,e.y],[i,r]=[0,0];const n=[0,0];for(;e.nextPoint();){i=e.x,r=e.y;const o=this._curveHelper.getLength(t,s,i,r);if(o<this._epsilon){t=i,s=r;continue}const a=.5+this._position/o,[l,c]=this._curveHelper.getAngleCS(n,t,s,i,r,a),h=this._curveHelper.getCoord2D(t,s,i,r,a);return this.internalPlacement.setTranslate(h[0]-this._offset*c,h[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(l,c),this.internalPlacement}}return this.iteratePath=!1,null}const s="LineEnd"===this._relativeTo;return this.onLine(e,t,s)}onLine(e,t,s){let i,r=!1;switch(this._relativeTo){case"LineMiddle":default:e.seekPathStart(),i=e.pathLength()/2+t;break;case"LineBeginning":i=t;break;case"LineEnd":i=t,r=!0}s?e.seekPathEnd():e.seekPathStart();let n=0;if(s?e.prevPoint():e.nextPoint()){let[t,o]=[e.x,e.y],[a,l]=[0,0];const c=[0,0];for(;s?e.prevPoint():e.nextPoint();){a=e.x,l=e.y;const s=this._curveHelper.getLength(t,o,a,l);if(n+s>i){const e=(i-n)/s,[h,u]=this._curveHelper.getAngleCS(c,t,o,a,l,e),p=this._curveHelper.getCoord2D(t,o,a,l,e),f=r?-this._offset:this._offset;return this.internalPlacement.setTranslate(p[0]-f*u,p[1]+f*h),this._angleToLine&&(r?this.internalPlacement.setRotateCS(-h,-u):this.internalPlacement.setRotateCS(h,u)),this.internalPlacement}t=a,o=l,n+=s}}return null}}e.PlacementOnLine=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,t,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,s){return new r(e,t,s)}}class r extends t.PathTransformationCursor{constructor(e,t,i){super(e),this._curveHelper=new s.CurveHelper,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*i:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let s=t[0],i=t[1];if(0!==this._offset){const e=Math.cos(t[2]),r=Math.sin(t[2]);s-=this._offset*r,i+=this._offset*e}return this.internalPlacement.setTranslate(s,i),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const t=e.isClosed();let s=0,i=!1,r=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),h=!0,u=e.nextPoint();for(;u;){const p=e.x,f=e.y,d=e.getControlPoint();(this._angleToLine||0!==this._offset)&&(r=this._curveHelper.getAngle(a,l,p,f,0)),h?(h=!1,t?(s=r,i=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,r])):c?this._controlPoints&&this._tags.push([a,l,n(o,r)]):this._regularVertices&&this._tags.push([a,l,n(o,r)]),(this._angleToLine||0!==this._offset)&&(o=this._curveHelper.getAngle(a,l,p,f,1)),u=e.nextPoint(),u||(t?d||i?this._controlPoints&&this._tags.push([p,f,n(o,s)]):this._regularVertices&&this._tags.push([p,f,n(o,s)]):(this._endPoints||this._controlPoints&&d)&&this._tags.push([p,f,o])),a=p,l=f,c=d}}this._tagIterator=0}}function n(e,t){const s=Math.PI;for(;Math.abs(t-e)>s+2e-15;)t-e>s?t-=2*s:t+=2*s;return(e+t)/2}e.PlacementOnVertices=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define(["exports","../../../geometry/support/boundsUtils","../../../geometry/support/centroid","../../../geometry/support/labelPoint","../CIMPlacements"],function(e,t,s,i,r){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,s){return new o(e,t,s)}}class o{constructor(e,t,s){this._geometryCursor=e,this._offsetX=void 0!==t.offsetX?t.offsetX*s:0,this._offsetY=void 0!==t.offsetY?t.offsetY*s:0,this._method=void 0!==t.method?t.method:"OnPolygon",this._placementPerPart=void 0!==t.placePerPart&&t.placePerPart,this._internalPlacement=new r.Placement}next(){const e=this._geometryCursor;if(!e)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(e);for(;e.nextPath();)if(!(e.getCurrentRingArea()<0))return this._polygonCenter(e.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(e){let r=!1;switch(this._method){case"CenterOfMass":{const t=s.weightedAreaCentroid(e);t&&(this._internalPlacement.setTranslate(t[0]+this._offsetX,t[1]+this._offsetY),r=!0)}break;case"BoundingBoxCenter":{const s=t.getCursorBoundsXY(e);s&&(this._internalPlacement.setTranslate((s[2]+s[0])/2+this._offsetX,(s[3]+s[1])/2+this._offsetY),r=!0)}break;default:{const t=i.getLabelPoint(e);null!==t&&(this._internalPlacement.setTranslate(t[0]+this._offsetX,t[1]+this._offsetY),r=!0)}}return r?this._internalPlacement:null}}e.PlacementPolygonCenter=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define(["exports","../../core/PriorityQueue","./aaBoundingRect","./boundsUtils","./centroid","./coordsUtils","./intersectsBase"],function(e,t,s,i,r,n,o){"use strict";function a(e,t){let s,i,r,n,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(s=t.x,i=t.y;t.nextPoint();s=r,i=n)r=t.x,n=t.y,i>e[1]!=n>e[1]&&((r-s)*(e[1]-i)-(n-i)*(e[0]-s)>0?o++:o--);return 0!==o}function l(e,t,s){if(s&&a(e,t))return{coord:e,distance:0};let i=1/0,r=0,o=0,l=[0,0],c=[0,0];const h=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(l[0]=t.x,l[1]=t.y;t.nextPoint();l=c){c=[t.x,t.y],n.projectPointOnLineSeg(h,e,l,c);const s=_(e,h);s<i&&(i=s,r=h[0],o=h[1])}return{coord:[r,o],distance:Math.sqrt(i)}}function c(e,t,i,r){const n=[t,0];let a=1/0,l=1/0,c=!1,u=!1;const p=[[t,r[1]-1],[t,r[3]+1]],f=[0,0],d=[0,0],y=[0,0],g=[[0,0],[0,0]],_=s.create();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(g[0][0]=e.x,g[0][1]=e.y;e.nextPoint();g[0][0]=g[1][0],g[0][1]=g[1][1]){if(g[1][0]=e.x,g[1][1]=e.y,null===h(_,g))continue;if(d[0]=p[0][0],d[1]=p[0][1],y[0]=p[1][0],y[1]=p[1][1],0===m(_,d,y))continue;if(!o.segmentIntersects(p[0],p[1],g[0],g[1],f))continue;const t=f[1];a>l?t<a&&(a=t,c=!0):t<l&&(l=t,u=!0)}return c&&u?n[1]=(a+l)/2:n[0]=n[1]=NaN,n}function h(e,t){if(t.length<2)return null;e||(e=s.create());const[i,r]=t[0],[n,o]=t[1];return e[0]=Math.min(i,n),e[1]=Math.min(r,o),e[2]=Math.max(i,n),e[3]=Math.max(r,o),e}const u=1,p=4,f=3,d=12;function m(e,t,s){let i=y(t,e),r=y(s,e);const n=e[0],o=e[1],a=e[2],l=e[3];if(i&r)return 0;if(!(i|r))return 4;const c=(i?1:0)|(r?2:0);do{const c=s[0]-t[0],h=s[1]-t[1];if(c>h)i&f?(i&u?(t[1]+=h*(n-t[0])/c,t[0]=n):(t[1]+=h*(a-t[0])/c,t[0]=a),i=y(t,e)):r&f?(r&u?(s[1]+=h*(n-s[0])/c,s[0]=n):(s[1]+=h*(a-s[0])/c,s[0]=a),r=y(s,e)):i?(i&p?(t[0]+=c*(o-t[1])/h,t[1]=o):(t[0]+=c*(l-t[1])/h,t[1]=l),i=y(t,e)):(r&p?(s[0]+=c*(o-s[1])/h,s[1]=o):(s[0]+=c*(l-s[1])/h,s[1]=l),r=y(s,e));else if(i&d?(i&p?(t[0]+=c*(o-t[1])/h,t[1]=o):(t[0]+=c*(l-t[1])/h,t[1]=l),i=y(t,e)):r&d?(r&p?(s[0]+=c*(o-s[1])/h,s[1]=o):(s[0]+=c*(l-s[1])/h,s[1]=l),r=y(s,e)):i?(i&u?(t[1]+=h*(n-t[0])/c,t[0]=n):(t[1]+=h*(a-t[0])/c,t[0]=a),i=y(t,e)):(r&u?(s[1]+=h*(n-s[0])/c,s[0]=n):(s[1]+=h*(a-s[0])/c,s[0]=a),r=y(s,e)),i&r)return 0}while(i|r);return c}function y(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function g(e,t,s){return e+(t-e)*s}function _(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function b(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;const s=isNaN(e),i=isNaN(t);return s<i?-1:s>i?1:0}class x{constructor(e,t,s,i){this.x=e,this.y=t,this.cellSize=s,this.distancefromCellCenter=n.distanceFromPointToPolygon(e,t,i),this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}}e.getLabelPoint=function(e){if(0===e.totalSize)return null;const t=i.getCursorBoundsXY(e);if(!t)return null;const n=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*222045e-19;let o=0,h=0;e.reset();for(let t=0;e.nextPath();t++){const s=e.getCurrentRingArea();s>h&&(h=s,o=t)}if(e.seekPath(o),0===e.pathSize)return null;e.seekPathStart();const u=i.getCursorPathBounds(e);if(Math.abs(h)<=2*n*n)return[(u[0]+u[2])/2,(u[1]+u[3])/2];e.seekPathStart();const p=r.ringCentroidCursorXY(e,s.create());if(null===p)return null;if(e.totalPoints<4)return p;const f=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],d=[NaN,NaN,NaN,NaN],m=[NaN,NaN,NaN,NaN];let y=!1,x=l(p,e,!0);0===x.distance&&(y=!0,f[0][0]=p[0],f[0][1]=p[1],x=l(p,e,!1)),d[0]=x.distance,m[0]=0;const S=[NaN,NaN];let v=!1,w=.25,C=-1,M=NaN;do{if(M=NaN,f[1]=c(e,g(u[0],u[2],w),0,t),isNaN(f[1][0])||isNaN(f[1][1])||(x=l(f[1],e,!1),M=x.distance),!isNaN(M)&&M>n&&a(f[1],e))v=!0,d[1]=M,m[1]=_(f[1],p);else if(!isNaN(M)&&M>C&&(C=M,S[0]=f[1][0],S[1]=f[1][1]),w-=.01,w<.1){if(!(C>=0))break;v=!0,d[1]=C,f[1][0]=S[0],f[1][1]=S[1],m[1]=_(f[1],p)}}while(!v);v=!1,w=.5,C=-1;let P=.01,L=1;do{if(M=NaN,f[2]=c(e,g(u[0],u[2],w),0,t),isNaN(f[2][0])||isNaN(f[2][1])||(x=l(f[2],e,!1),M=x.distance),!isNaN(M)&&M>n&&a(f[2],e))v=!0,d[2]=M,m[2]=_(f[2],p);else if(!isNaN(M)&&M>C)C=M,S[0]=f[2][0],S[1]=f[2][1];else if(M>C&&(C=M,S[0]=f[2][0],S[1]=f[2][1]),w=.5+P*L,P+=.01,L*=-1,w<.3||w>.7){if(!(C>=0))break;v=!0,d[2]=C,f[2][0]=S[0],f[2][1]=S[1],m[2]=_(f[2],p)}}while(!v);v=!1,w=.75,C=-1;do{if(M=NaN,f[3]=c(e,g(u[0],u[2],w),0,t),isNaN(f[3][0])||isNaN(f[3][1])||(x=l(f[3],e,!1),M=x.distance),!isNaN(M)&&M>n&&a(f[3],e))v=!0,d[3]=M,m[3]=_(f[3],p);else if(M>C&&(C=M,S[0]=f[3][0],S[1]=f[3][1]),w+=.01,w>.9){if(!(C>=0))break;v=!0,d[3]=C,f[3][0]=S[0],f[3][1]=S[1],m[3]=_(f[3],p)}}while(!v);const I=[0,1,2,3],k=y?0:1;let T;for(let e=k;e<4;e++)for(let e=k;e<3;e++){const t=m[e],s=m[e+1];b(t,s)>0&&(T=I[e],I[e]=I[e+1],I[e+1]=T,m[e]=s,m[e+1]=t)}let E=k,z=0,R=0;for(let e=k;e<4;e++){switch(e){case 0:R=2*d[I[e]];break;case 1:R=1.66666666*d[I[e]];break;case 2:R=1.33333333*d[I[e]];break;case 3:R=d[I[e]]}R>z&&(z=R,E=I[e])}return f[E]},e.getPolylabelPoint=function(e){if(!e.nextPath()||!e.pathSize)return null;const s=i.getCursorPathBounds(e),n=s[2]-s[0],o=s[3]-s[1];if(0===n||0===o)return[s[0]+n/2,s[1]+o/2];const a=Math.max(Math.min(n,o)/100,1),l=new t((e,t)=>t.maxDistanceToPolygon-e.maxDistanceToPolygon),c=Math.min(n,o);let h=c/2,u=0,p=0;for(u=s[0];u<s[2];u+=c)for(p=s[1];p<s[3];p+=c)l.enqueue(new x(u+h,p+h,h,e));e.reset(),e.nextPath();const f=r.ringsCentroidCursor(e);if(null===f)return null;let d,m=new x(f[0],f[1],0,e);for(;l.size>0;)d=l.dequeue(),d.distancefromCellCenter>m.distancefromCellCenter&&(m=d),d.maxDistanceToPolygon-m.distancefromCellCenter<=a||(h=d.cellSize/2,l.enqueue(new x(d.x-h,d.y-h,h,e)),l.enqueue(new x(d.x+h,d.y-h,h,e)),l.enqueue(new x(d.x-h,d.y+h,h,e)),l.enqueue(new x(d.x+h,d.y+h,h,e)));return[m.x,m.y]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){"use strict";const e=(e,t)=>e<t?-1:e>t?1:0;return class{constructor(t=e){this._data=[],this._compare=t}get size(){return this._data.length}enqueue(e){if(null==e)return;const{_data:t,_compare:s}=this;t.push(e);let i=t.length-1>>>0;const r=t[i];for(;i>0;){const e=i-1>>1,n=t[e];if(!(s(n,r)<=0))break;t[e]=r,t[i]=n,i=e}}dequeue(){const{_data:e,_compare:t}=this,s=e[0],i=e.pop();if(0===e.length)return s;e[0]=i;let r=0;const n=e.length,o=e[0];let a,l,c=null;for(;;){const s=2*r+1,i=2*r+2;if(c=null,s<n&&(a=e[s],t(a,o)>0&&(c=s)),i<n&&(l=e[i],(null===c&&t(l,o)<=0||null!==c&&t(l,a)<=0)&&(c=i)),null===c)break;e[r]=e[c],e[c]=o,r=c}return s}}})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(e){"use strict";e.getFirstFrame=function(e){const t=e.getFrame(0);if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)return t;const s=document.createElement("canvas");s.width=e.width,s.height=e.height;const i=s.getContext("2d");return t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0),s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/mathUtils":function(){define(["exports"],function(e){"use strict";e.rotate=function(e,t=0){if(0===t)return e;const s=Math.cos(t),i=Math.sin(t),[r,n]=e;return[r*s+n*-i,r*i+n*s]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports","../../core/floatRGBA","../../core/Logger","../../core/mathUtils","./constants","./defaultCIMValues","../../views/2d/engine/webgl/definitions"],function(e,t,s,i,r,n,o){"use strict";const a=()=>s.getLogger("esri.symbols.cim.rasterizingUtils");let l;function c(e){const t=[];switch(e.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{"CIMPolarContinuousColorRamp"===e.type&&a().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const s=e;t.push({offset:0,color:[s.fromColor[0],s.fromColor[1],s.fromColor[2],s.fromColor[3]/255]}),t.push({offset:1,color:[s.toColor[0],s.toColor[1],s.toColor[2],s.toColor[3]/255]});break}case"CIMFixedColorRamp":{const s=e,i=1/(s.colors.length-1);let r=0;for(const e of s.colors)t.push({offset:r,color:[e[0],e[1],e[2],e[3]/255]}),r+=i;break}case"CIMMultipartColorRamp":{const s=e,i=s.weights.reduce((e,t)=>e+t,0);let r=0;for(let e=0;e<s.colorRamps.length;e++){const n=s.colorRamps[e],o=s.weights[e],a=c(n);for(const e of a)t.push({offset:(r+e.offset*o)/i,color:e.color});r+=o}break}default:a().error(`Color ramp "${e.type}" currently unsupported.`)}return t}function h(e,t){const s=[],i=(e.length-1)/(t-1);for(let r=0;r<t;r++){const n=e[Math.round(r*i)].color;s.push({offset:r/t,color:n}),s.push({offset:(r+1)/t,color:n})}return s}function u(e,t,s=0){for(const{offset:i,color:r}of t)e.addColorStop(Math.min(Math.max(i,s),1-s),`rgba(${r[0]}, ${r[1]}, ${r[2]}, ${r[3]})`)}function p(e,t,s,i,r){const n=s+2*r;e.width=n,e.height=i;const o=(r+1)/n,a=e.getContext("2d",{willReadFrequently:!0});if(t.length>0){const e=a.createLinearGradient(0,0,n,i);u(e,t,o),a.fillStyle=e}else a.fillStyle="rgba(128, 128, 128, 1)";a.fillRect(0,0,n,i)}function f(e){const{width:t,height:s}=e,i=e.getContext("2d").getImageData(0,0,t,s),r=new Uint8Array(i.data);for(let e=0;e<r.length;e+=4){const t=r[e+3]/255;r[e]*=t,r[e+1]*=t,r[e+2]*=t}return[r,t,s]}e.addColorStops=function(e,t){const{colorRamp:s,gradientType:i}=t,r=c(s),o="CIMFixedColorRamp"===s.type;if("Continuous"===i&&!o)return u(e,r);const a=t.interval??n.defaultCIMValues.CIMGradientFill.interval;if(o)return u(e,h(r,a));const f=[];l??=document.createElement("canvas"),p(l,r,a,1,0);const d=l.getContext("2d").getImageData(0,0,a,1).data;for(let e=0,t=0;e<a;e++,t=4*e){const s=[d[t+0],d[t+1],d[t+2],d[t+3]];f.push({offset:e/a,color:s}),f.push({offset:(e+1)/a,color:s})}return u(e,f)},e.rasterizeDash=function(e,s){null==e&&(e=[]);const i="Butt"===s,n="Square"===s,o=!i&&!n;e.length%2==1&&(e=[...e,...e]);const a=r.dashRadius,l=2*a;let c=0;for(const t of e)c+=t;const h=Math.round(c*a),u=new Float32Array(h*l),p=.5*a;let f=0,d=0,m=.5,y=!0;for(const t of e){for(f=d,d+=t*a;m<=d;){let e=.5;for(;e<l;){const t=(e-.5)*h+m-.5,s=o?(e-a)*(e-a):Math.abs(e-a);u[t]=y?i?Math.max(Math.max(f+p-m,s),Math.max(m-d+p,s)):s:o?Math.min((m-f)*(m-f)+s,(m-d)*(m-d)+s):n?Math.min(Math.max(m-f,s),Math.max(d-m,s)):Math.min(Math.max(m-f+p,s),Math.max(d+p-m,s)),e++}m++}y=!y}const g=u.length,_=new Uint8Array(4*g);for(let e=0;e<g;++e){const s=(o?Math.sqrt(u[e]):u[e])/a;t.packFloatRGBA(s,_,4*e)}return[_,h,l]},e.rasterizeDash1D=function(e){e.length%2==1&&(e=[...e,...e]);const s=e.reduce((e,t)=>e+t,0),i=Math.round(s*r.dashSdfRasterizationScale),n=new Float32Array(1*i);let o=0,a=0,l=.5,c=!0;for(const t of e){for(o=a,a+=t*r.dashSdfRasterizationScale;l<=a;){const e=l-.5,t=Math.min(Math.abs(l-o),Math.abs(l-a));n[e]=c?-t:t,l++}c=!c}const h=n.length,u=new Uint8Array(4*h);for(let e=0;e<h;++e){const s=n[e]/r.dashSdfRasterizationScale/r.dashSdfDistanceNormalization*.5+.5;t.packFloatRGBA(s,u,4*e)}return[u,i,1]},e.rasterizeFillStyle=function(e,t,s){const r=t.style,n=i.nextPowerOfTwo(Math.ceil(s)),o=(e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e)(r)?8*n:16*n,a=2*n;e.width=o,e.height=o;const l=e.getContext("2d");l.strokeStyle="#ffffff",l.lineWidth=n,l.beginPath(),"vertical"!==r&&"cross"!==r&&"esriSFSCross"!==r&&"esriSFSVertical"!==r||(l.moveTo(o/2,-a),l.lineTo(o/2,o+a)),"horizontal"!==r&&"cross"!==r&&"esriSFSCross"!==r&&"esriSFSHorizontal"!==r||(l.moveTo(-a,o/2),l.lineTo(o+a,o/2)),"backward-diagonal"!==r&&"diagonal-cross"!==r&&"esriSFSDiagonalCross"!==r&&"esriSFSBackwardDiagonal"!==r||(l.moveTo(-a,-a),l.lineTo(o+a,o+a),l.moveTo(o-a,-a),l.lineTo(o+a,a),l.moveTo(-a,o-a),l.lineTo(a,o+a)),"forward-diagonal"!==r&&"diagonal-cross"!==r&&"esriSFSForwardDiagonal"!==r&&"esriSFSDiagonalCross"!==r||(l.moveTo(o+a,-a),l.lineTo(-a,o+a),l.moveTo(a,-a),l.lineTo(-a,a),l.moveTo(o+a,o-a),l.lineTo(o-a,o+a)),l.stroke();const c=l.getImageData(0,0,e.width,e.height),h=new Uint8Array(c.data);let u;for(let e=0;e<h.length;e+=4)u=h[e+3]/255,h[e]=h[e]*u,h[e+1]=h[e+1]*u,h[e+2]=h[e+2]*u;return[h,e.width,e.height,n]},e.rasterizeGradient=function(e,t){const{colorRamp:s,gradientType:i}=t,r="CIMFixedColorRamp"===s.type,a=t.interval||n.defaultCIMValues.CIMGradientFill.interval;let l=c(s);return r&&(l=h(l,a)),"Discrete"===i||r?function(e,t,s){return p(e,t,s,1,o.gradientTextureExternalPadding),f(e)}(e,l,a):function(e,t){return p(e,t,32,1,o.gradientTextureExternalPadding),f(e)}(e,l)},e.scale=function(e,t){const s=function(e){const t=e[0]?.[0]?.[0]??0,s=e[0]?.[0]?.[1]??0,i={ymin:s,xmin:t,ymax:s,xmax:t,width:0,height:0};for(let t=0;t<e.length;t++){const s=e[t];for(let e=0;e<s.length;e++){const t=s[e][0],r=s[e][1];t<i.xmin&&(i.xmin=t),t>i.xmax&&(i.xmax=t),r<i.ymin&&(i.ymin=r),r>i.ymax&&(i.ymax=r)}}return i.width=Math.abs(i.xmax-i.xmin),i.height=Math.abs(i.ymax-i.ymin),i}(e),i=0===s.width?1:s.width,r=0===s.height?1:s.height,n=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];for(let e=0;e<a.length;e++){let n=Math.round(a[e][0]-s.xmin),o=Math.round(a[e][1]-s.ymin);if(n=t.xmin+n*t.width/i,o=t.ymin+o*t.height/r,isNaN(n)||isNaN(o))throw new Error("Scaled shape has NaN values");l.push([n,o])}n.push(l)}return n},e.translate=function(e,t,s){const i=[];for(let r=0;r<e.length;r++){const n=e[r],o=[];for(let e=0;e<n.length;e++){const i=n[e][0]+t,r=n[e][1]+s;if(isNaN(i)||isNaN(r))throw new Error("Scaled shape has NaN values");o.push([i,r])}i.push(o)}return i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(e,t){"use strict";function s(e,t=0){let s=0;for(let i=0;i<4;i++)s+=e[t+i]*r[i];return s}const i=[1,256,65536,16777216],r=[1/256,1/65536,1/16777216,1/4294967296],n=s(new Uint8ClampedArray([255,255,255,255])),o=s(new Uint8ClampedArray([255,255,255,0]));function a(e){return e-Math.floor(e)}e.maxRgbFloat=o,e.maxRgbaFloat=n,e.packFloatRGB=function(e,s,r=0){const n=t.clamp(e,0,o);for(let e=0;e<3;e++)s[r+e]=Math.floor(256*a(n*i[e]))},e.packFloatRGBA=function(e,s,r=0){const o=t.clamp(e,0,n);for(let e=0;e<4;e++)s[r+e]=Math.floor(256*a(o*i[e]))},e.unpackFloatRGBA=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports","./defaultCIMValues"],function(e,t){"use strict";const s={outlineWidth:.75,referenceWidth:.75,cap:t.defaultCIMValues.CIMSolidStroke.capstyle,join:t.defaultCIMValues.CIMSolidStroke.joinstyle,miterLimit:t.defaultCIMValues.CIMSolidStroke.miterlimit};e.antialiasingOutlineFillSettings=s,e.dashRadius=15.5,e.dashSdfDistanceNormalization=64,e.dashSdfRasterizationScale=4,e.maxTileCoordValue=1024,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/definitions":function(){define(["exports"],function(e){"use strict";e.MAX_TILE_RESHUFFLES_PER_FRAME=1,e.RESHUFFLING_EXEMPT_DRAW_CALLS=10,e.RESHUFFLING_EXEMPT_MEMORY_BYTES=1<<20,e.RESHUFFLING_TARGET_DRAW_EFFICIENCY=.75,e.RESHUFFLING_TARGET_MEMORY_EFFICIENCY=.75,e.angleFactor256=256/360,e.animationUnit=2,e.attributeStoreInitialSize=256,e.attributeStoreTextureSize=1024,e.averageGlyphMosaicItem={metrics:{width:15,height:17,left:0,top:-7,advance:14}},e.backbufferStencilClipped=1,e.backbufferStencilVisible=0,e.bitsetFillHasPatternHeightPrecisionFactor=32,e.bitsetFillHasPatternWidthPrecisionFactor=64,e.bitsetFillHasUnresolvedReplacementColor=8,e.bitsetFillRandomPatternOffset=4,e.bitsetGenericConsiderAlphaOnly=16,e.bitsetGenericLockColor=2,e.bitsetLineScaleDash=4,e.bitsetMarkerAlignmentMap=1,e.bitsetMarkerAlignmentScreen=0,e.bitsetMarkerOutlineAllowColorOverride=4,e.bitsetMarkerScaleSymbolsProportionally=8,e.bitsetTypeFillOutline=1,e.bufferDataMinimumSize=128,e.bufferDataPoolSize=4,e.chartMaxFields=10,e.collisionBoxPadding=16,e.collisionBucketSize=128,e.collisionEarlyRejectBucketSize=16,e.collisionMaxZoomDelta=1,e.collisionPlacementPadding=8,e.collisionTileBoxSize=4,e.compressionFactorForU16=128,e.dataDrivenUnit0=4,e.dataDrivenUnit1=5,e.dataDrivenUnit2=6,e.debugLabels=!1,e.defaultSdfTextureSize=128,e.displayRecordIntPerElement=8,e.dotDensityMaxFields=8,e.effectFlag0=128,e.enableEarlyLabelDiscard=!1,e.extrudeScale=64,e.filterFlag0=64,e.filterFlagsUnit=1,e.glyphSize=24,e.gpgpuUnit=12,e.gradientTextureExternalPadding=1,e.heuristicGlyphsPerFeature=10,e.heuristicGlyphsPerLine=50,e.hittestSmallSymbolThreshold=3,e.hittestToleranceDesktop=1,e.hittestToleranceMobile=3,e.hittestToleranceSmallSymbol=3,e.labelPlacementOffsetPadding=4,e.localTimeOriginUnit=13,e.magicLabelLineHeight=29,e.maxGeohashLevel=12,e.maxGpuUploadsPerFrame=2,e.maxHighlightReasons=6,e.maxRepresentableInt=16777216,e.maxTextLineWidth=512,e.minMaxZoomPrecisionFactor=10,e.minTextLineWidth=32,e.nanMagicNumber=1e-30,e.patchPixelBufferAllocSize=500,e.patternFillRasterizationScale=2,e.pictureFillColor=4294967295,e.randomInsidePolygonTextureSize=1024,e.rasterTileSize=256,e.rasterizedVectorMarkerMinSize=128,e.spritePadding=4,e.svgSdfTextureInnerSize=248,e.svgSdfTextureSize=256,e.textureBindingBitmap=0,e.textureBindingGlyphAtlas=0,e.textureBindingHighlight0=5,e.textureBindingHighlight1=6,e.textureBindingRenderer0=5,e.textureBindingRenderer1=6,e.textureBindingSpriteAtlas=0,e.textureUploadManagerBudget=4,e.textureUploadManagerChunkSize=128,e.thinLineHalfWidthThreshold=1.05,e.tileSize=512,e.visualVariableUnit=3,e.vtlHighResCutoff=1.15,e.vtlTextureBindingUnitGlyphs=6,e.vtlTextureBindingUnitSprites=5,e.webglMaxInnerStops=6,e.webglMaxStops=8,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){"use strict";class e{constructor(e=0,t=0,s=0,i=0){this.x=e,this.y=t,this.width=s,this.height=i}static fromExtent(t){return new e(t.xmin,-t.ymax,t.xmax-t.xmin,t.ymax-t.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}return e})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(e,t){"use strict";function s(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}function i(t,s){const i=Math.max(s.size,.5),r=s.font,n=`${r.style} ${r.weight} ${e.pt2px(i).toFixed(1)}px ${r.family}, sans-serif`;let o;switch(t.font=n,t.textBaseline="top",s.horizontalAlignment){case"left":default:o="left";break;case"right":o="right";break;case"center":o="center"}t.textAlign=o}return class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,r){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const n=this._textRasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});i(o,r),this._parameters=r,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:a,weight:l}=r.font;this._lineThroughWidthOffset=a&&"line-through"===a?.1*this._lineHeight:0;const c=null!=r.backgroundColor||null!=r.borderLine,h=c?t.backgroundPadding:0,u=this._computeTextWidth(o,r)+2*h,p=this._lineHeight*this._textLines.length+2*h;if(n.width=u+2*this._lineThroughWidthOffset,n.height=p,0===n.width||0===n.height)return n.width=n.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:n};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(r.outline.size||0)*r.pixelRatio,this._renderedHaloSize=(r.halo.size||0)*r.pixelRatio,this._renderedWidth=u,this._renderedHeight=p,this._lineThroughWidthOffset*=r.pixelRatio;const f=(r.outline&&r.outline.color)??[0,0,0,0],d=r.color??[0,0,0,0],m=r.halo&&r.halo.color?r.halo.color:[0,0,0,0];this._fillStyle=s(d),this._outlineStyle=s(f),this._haloStyle=`rgb(${m.slice(0,3).toString()})`;const y=this._renderedLineHeight,g=this._renderedOutlineSize,_=this._renderedHaloSize;o.save(),o.clearRect(0,0,n.width,n.height),i(o,r);const b=h*r.pixelRatio,x=function(e,t,s){return"center"===e?.5*t:"right"===e?t-s:s}(o.textAlign,this._renderedWidth-2*b,this._renderedHaloSize+this._renderedOutlineSize)+b,S=_+g+b,v=_>0;let w=this._lineThroughWidthOffset,C=0;if(c){o.save();const e=r.backgroundColor??[0,0,0,0],t=r.borderLine?.color??[0,0,0,0],i=2*(r.borderLine?.size??0);o.fillStyle=s(e),o.strokeStyle=s(t),o.lineWidth=i,o.fillRect(0,0,n.width,n.height),o.strokeRect(0,0,n.width,n.height),o.restore()}v&&this._renderHalo(o,x,S,w,C,r),g>0&&this._renderOutline(o,x,S,w,C,r),C+=S,w+=x;for(const e of this._textLines)v?(o.globalCompositeOperation="destination-out",o.fillStyle="rgb(0, 0, 0)",o.fillText(e,w,C),o.globalCompositeOperation="source-over",o.fillStyle=this._fillStyle,o.fillText(e,w,C)):(o.fillStyle=this._fillStyle,o.fillText(e,w,C)),a&&"none"!==a&&this._renderDecoration(o,w,C,a,l),C+=y;o.restore();const M=this._renderedWidth+2*this._lineThroughWidthOffset,P=this._renderedHeight,L=o.getImageData(0,0,M,P),I=new Uint8Array(L.data);if(r.premultiplyColors){let e;for(let t=0;t<I.length;t+=4)e=I[t+3]/255,I[t]=I[t]*e,I[t+1]=I[t+1]*e,I[t+2]=I[t+2]*e}let k,T;switch(r.horizontalAlignment){case"left":k=-.5;break;case"right":k=.5;break;default:k=0}switch(r.verticalAlignment){case"bottom":T=-.5;break;case"top":T=.5;break;case"baseline":T=-1/6;break;default:T=0}return{size:[M,P],image:new Uint32Array(I.buffer),sdf:!1,simplePattern:!1,anchorX:k,anchorY:T,canvas:n}}_renderHalo(e,t,s,r,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=a,this._outlineRasterizationCanvas.height=l;const c=this._outlineRasterizationCanvas,h=c.getContext("2d");h.clearRect(0,0,a,l),i(h,o);const{decoration:u,weight:p}=o.font;h.fillStyle=this._haloStyle,h.strokeStyle=this._haloStyle,h.lineJoin="round",this._renderOutlineNative(h,t,s,u,p,this._renderedHaloSize+this._renderedOutlineSize),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,r,n,a,l),e.globalAlpha=1}_renderOutline(e,t,s,r,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=a,this._outlineRasterizationCanvas.height=l;const c=this._outlineRasterizationCanvas,h=c.getContext("2d");h.clearRect(0,0,a,l),i(h,o);const{decoration:u,weight:p}=o.font;h.fillStyle=this._outlineStyle,h.strokeStyle=this._outlineStyle,h.lineJoin="round",this._renderOutlineNative(h,t,s,u,p,this._renderedOutlineSize),e.globalAlpha=this._parameters.outline.color[3],e.drawImage(c,0,0,a,l,r,n,a,l),e.globalAlpha=1}_renderOutlineNative(e,t,s,i,r,n){const o=this._renderedLineHeight;for(const a of this._textLines){const l=2*n,c=5,h=.1;for(let n=0;n<c;n++){const o=(1-(c-1)*h+n*h)*l;e.lineWidth=o,e.strokeText(a,t,s),i&&"none"!==i&&this._renderDecoration(e,t,s,i,r,o)}s+=o}}computeTextSize(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const s=this._textRasterizationCanvas,r=s.getContext("2d");i(r,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(r,t),o=this._lineHeight*this._textLines.length;return s.width=n,s.height=o,[n*t.pixelRatio,o*t.pixelRatio]}_computeTextWidth(t,s){let i=0;for(const e of this._textLines)i=Math.max(i,t.measureText(e).width);const r=s.font;return("italic"===r.style||"oblique"===r.style||"string"==typeof r.weight&&("bold"===r.weight||"bolder"===r.weight)||"number"==typeof r.weight&&r.weight>600)&&(i+=.3*t.measureText("w").width),i+=2*e.pt2px(this._parameters.halo.size),Math.round(i)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let t=this._computeLineHeightBase();const s=this._parameters.font.decoration;return s&&"underline"===s&&(t*=1.3),Math.round(t+2*e.pt2px(this._parameters.halo.size))}_renderDecoration(e,t,s,i,r,n){let o=.9*this._lineHeight;const a="bold"===r?.06:"bolder"===r?.09:.04;switch(e.textAlign){case"center":t-=this._renderedWidth/2;break;case"right":t-=this._renderedWidth}const l=e.textBaseline;if("underline"===i)switch(o=.9*this._computeLineHeightBase(),l){case"top":s+=o;break;case"middle":s+=o/2}else if("line-through"===i)switch(l){case"top":s+=o/1.5;break;case"middle":s+=o/3}const c=n?1.5*n:Math.ceil(o*a);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=c,e.moveTo(t-this._lineThroughWidthOffset,s),e.lineTo(t+this._renderedWidth+2*this._lineThroughWidthOffset,s),e.stroke(),e.restore()}}})},"esri/views/2d/engine/svgUtils":function(){define(["exports"],function(e){"use strict";function t(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}e.createHiddenSvg=function(){const e=t("svg");return e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),e},e.createSvgElement=t,e.destroyHiddenSvg=function(e){return null!=e&&document.body.removeChild(e),null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat2d","../../../../../../core/libs/gl-matrix-2/factories/mat2df32","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../core/libs/gl-matrix-2/factories/vec2f32","../../alignmentUtils","../../Rect","../../collisions/BoundingBox"],function(e,t,s,i,r,n,o,a){"use strict";const l=Math.PI/180;class c{constructor(e,t,i,r){this._rotationT=s.create(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const n=i.rect,o=new Float32Array(8);e*=r,t*=r;const a=i.code?n.width*r:i.metrics.width,l=i.code?n.height*r:i.metrics.height;this.width=a,this.height=l,o[0]=e,o[1]=t,o[2]=e+a,o[3]=t,o[4]=e,o[5]=t+l,o[6]=e+a,o[7]=t+l,this._data=o,this._setTextureCoords(n),this._scale=r,this._mosaic=i,this.x=e,this.y=t,this.maxOffset=Math.max(e+a,t+l)}get mosaic(){return this._mosaic}set angle(e){this._angle=e,t.fromRotation(this._rotationT,-e),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:e,width:i}=this._mosaic.metrics,r=i*this._scale,n=Math.abs(e)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+r,o[3]=this.y,o[4]=this.x,o[5]=this.y+n,o[6]=this.x+r,o[7]=this.y+n;const l=t.multiply(s.create(),this._rotationT,this._transform);s.transformMany(o,o,l);let c=1/0,h=1/0,u=-1/0,p=-1/0;for(let e=0;e<4;e++){const t=o[2*e],s=o[2*e+1];c=Math.min(c,t),h=Math.min(h,s),u=Math.max(u,t),p=Math.max(p,s)}const f=u-c,d=p-h,m=c+f/2,y=h+d/2;this._bounds=new a(m,y,f,d)}return this._bounds}setTransform(e){this._transform=e,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const e=t.multiply(s.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],i.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,e),i.transformMat2d(this._offsets.topRight,this._offsets.topRight,e),i.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,e),i.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,e)}_setTextureCoords({x:e,y:t,width:s,height:i}){this._texcoords={topLeft:[e,t],topRight:[e+s,t],bottomLeft:[e,t+i],bottomRight:[e+s,t+i]}}}const h=(e,t)=>({code:0,page:0,sdf:!0,rect:new o(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});function u(e,t){return e.forEach(e=>i.transformMat2d(e,e,t)),{topLeft:e[0],topRight:e[1],bottomLeft:e[2],bottomRight:e[3]}}class p{constructor(e,t,s){this._rotation=0,this._decorate(e,t,s),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=0!==s.angle,this._transform=this._createGlyphTransform(this.bounds,s),this._borderLineSizePx=s.borderLineSizePx,(s.borderLineSizePx||s.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const t of e)t.setTransform(this._transform)}setRotation(e){if(0===e&&0===this._rotation)return;this._rotation=e;const i=this._transform,r=t.fromRotation(s.create(),e);t.multiply(i,r,i);for(const e of this.glyphs)e.setTransform(this._transform)}_decorate(e,t,s){if(!s.decoration||"none"===s.decoration||!e.length)return;const i=s.scale,r="underline"===s.decoration?26:16,n=e[0].textureBinding;for(const s of t){const t=s.startX*i,o=s.startY*i,a=(s.width+s.glyphWidthEnd)*i;e.push(new c(t,o+r*i,h(a,n),1))}}shapeBackground(e){const t=(1.5+(this._borderLineSizePx||0))/2,s=this._borderLineSizePx?t:0,{xmin:i,ymin:r,xmax:n,ymax:o,x:l,y:c,width:h,height:p}=this.bounds,f=[i-8,r-8],d=[n+8,r-8],m=[i-8,o+8],y=[n+8,o+8],g=u([[f[0]-t,f[1]-t],[d[0]+t,d[1]-t],[f[0]+s,f[1]+s],[d[0]-s,d[1]+s]],e),_=u([[m[0]+s,m[1]-s],[y[0]-s,y[1]-s],[m[0]-t,m[1]+t],[y[0]+t,y[1]+t]],e),b=u([[f[0]-t,f[1]-t],[f[0]+s,f[1]+s],[m[0]-t,m[1]+t],[m[0]+s,m[1]-s]],e),x=u([[d[0]-s,d[1]+s],[d[0]+t,d[1]-t],[y[0]-s,y[1]-s],[y[0]+t,y[1]+t]],e),S={main:u([f,d,m,y],e),top:g,bot:_,left:b,right:x};return[new a(l,c,h+2*t,p+2*t),S]}get boundsT(){const e=this.bounds,t=i.set(r.create(),e.x,e.y);if(i.transformMat2d(t,t,this._transform),this._hasRotation){const s=Math.max(e.width,e.height);return new a(t[0],t[1],s,s)}return new a(t[0],t[1],e.width,e.height)}_createBounds(e){let t=1/0,s=1/0,i=0,r=0;for(const n of e)t=Math.min(t,n.xTopLeft),s=Math.min(s,n.yTopLeft),i=Math.max(i,n.xBottomRight),r=Math.max(r,n.yBottomRight);const n=i-t,o=r-s;return new a(t+n/2,s+o/2,n,o)}_createGlyphTransform(e,n){const o=l*n.angle,a=s.create(),c=r.create();return t.translate(a,a,i.set(c,n.xOffset,-n.yOffset)),n.useCIMAngleBehavior?t.rotate(a,a,o):(t.translate(a,a,i.set(c,e.x,e.y)),t.rotate(a,a,o),t.translate(a,a,i.set(c,-e.x,-e.y))),a}}class f{constructor(e,t,s,i,r,n){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,s)),this.end=Math.max(0,Math.max(t,s)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=i,this.yMin=r,this.yMax=n}}const d=e=>10===e,m=e=>32===e;e.ShapedGlyph=c,e.ShapingInfo=p,e.shapeGlyphs=function(e,t){const s=t.scale,i=new Array,{glyphs:r,isRightToLeft:o}=e,a=function(e,t,s){const i=new Array,r=1/s.scale,n=s.maxLineWidth*r,o=t?e.length-1:0,a=t?-1:e.length,l=t?-1:1;let c=o,h=0,u=0,p=c,y=p,g=0,_=1/0,b=0;for(;c!==a;){const{code:t,metrics:s}=e[c],r=Math.abs(s.top);if(d(t)||m(t)||(_=Math.min(_,r),b=Math.max(b,r+s.height)),d(t))c!==o&&(i.push(new f(e,p,c-l,h,_===1/0?0:_,b)),_=1/0,b=0),h=0,p=c+l,y=c+l,u=0;else if(m(t))y=c+l,u=0,g=s.advance,h+=s.advance;else if(h>n){if(y!==p){const t=y-2*l;h-=g,i.push(new f(e,p,t,h-u,_,b)),_=1/0,b=0,p=y,h=u}else i.push(new f(e,p,c-l,h,_,b)),_=1/0,b=0,p=c,y=c,h=0;h+=s.advance,u+=s.advance}else h+=s.advance,u+=s.advance;c+=l}const x=new f(e,p,c-l,h,_,b);return x.start>=0&&x.end<e.length&&i.push(x),i}(r,o,t),l=a.length?function(e,t){let s=0;for(let t=0;t<e.length;t++){const{width:i}=e[t];s=Math.max(i,s)}const i="underline"===t.decoration?4:0,r=e[0].yMin;return{x:0,y:r,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+i-r,width:s}}(a,t):{y:0,height:0},h=n.getXAnchorDirection(t.horizontalAlignment),u=n.getYAnchorDirection(t.verticalAlignment),y=2===u?1:0,g=y?0:u-1,_=(1-y)*-l.y+g*(l.height/2)+-22*(y?1:0);for(let n=0;n<a.length;n++){const{start:o,end:l,width:u}=a[n];let p=-1*(h+1)*(u/2)-3;const f=(e.isRightToLeft?a.length-1-n:n)*t.lineHeight+_-3;a[n].startX=p,a[n].startY=f;for(let e=o;e<=l;e++){const t=r[e];if(d(t.code))continue;const n=new c(p+t.metrics.left,f-t.metrics.top,t,s);p+=t.metrics.advance,i.push(n)}}return new p(i,a,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(e,t){"use strict";function s(e,t){return e[0]=t[0],e[1]=t[1],e}function i(e,t,s){return e[0]=t,e[1]=s,e}function r(e,t,s){return e[0]=t[0]+s[0],e[1]=t[1]+s[1],e}function n(e,t,s){return e[0]=t[0]-s[0],e[1]=t[1]-s[1],e}function o(e,t,s){return e[0]=t[0]*s[0],e[1]=t[1]*s[1],e}function a(e,t,s){return e[0]=t[0]/s[0],e[1]=t[1]/s[1],e}function l(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function c(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function h(e,t,s){return e[0]=Math.min(t[0],s[0]),e[1]=Math.min(t[1],s[1]),e}function u(e,t,s){return e[0]=Math.max(t[0],s[0]),e[1]=Math.max(t[1],s[1]),e}function p(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function f(e,t,s){return e[0]=t[0]*s,e[1]=t[1]*s,e}function d(e,t,s,i){return e[0]=t[0]+s[0]*i,e[1]=t[1]+s[1]*i,e}function m(e,t){const s=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(s*s+i*i)}function y(e,t){const s=t[0]-e[0],i=t[1]-e[1];return s*s+i*i}function g(e){const t=e[0],s=e[1];return Math.sqrt(t*t+s*s)}function _(e){const t=e[0],s=e[1];return t*t+s*s}function b(e,t){return e[0]=-t[0],e[1]=-t[1],e}function x(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function S(e,t){const s=t[0],i=t[1];let r=s*s+i*i;return r>0&&(r=1/Math.sqrt(r),e[0]=t[0]*r,e[1]=t[1]*r),e}function v(e,t){return e[0]*t[0]+e[1]*t[1]}function w(e,t,s){const i=t[0]*s[1]-t[1]*s[0];return e[0]=e[1]=0,e[2]=i,e}function C(e,t,s,i){const r=t[0],n=t[1];return e[0]=r+i*(s[0]-r),e[1]=n+i*(s[1]-n),e}function M(e,s=1){const i=2*t.RANDOM()*Math.PI;return e[0]=Math.cos(i)*s,e[1]=Math.sin(i)*s,e}function P(e,t,s){const i=t[0],r=t[1];return e[0]=s[0]*i+s[2]*r,e[1]=s[1]*i+s[3]*r,e}function L(e,t,s){const i=t[0],r=t[1];return e[0]=s[0]*i+s[2]*r+s[4],e[1]=s[1]*i+s[3]*r+s[5],e}function I(e,t,s){const i=t[0],r=t[1];return e[0]=s[0]*i+s[3]*r+s[6],e[1]=s[1]*i+s[4]*r+s[7],e}function k(e,t,s){const i=t[0],r=t[1];return e[0]=s[0]*i+s[4]*r+s[12],e[1]=s[1]*i+s[5]*r+s[13],e}function T(e,t,s,i){const r=t[0]-s[0],n=t[1]-s[1],o=Math.sin(i),a=Math.cos(i);return e[0]=r*a-n*o+s[0],e[1]=r*o+n*a+s[1],e}function E(e,t){const s=e[0],i=e[1],r=t[0],n=t[1];let o=s*s+i*i;o>0&&(o=1/Math.sqrt(o));let a=r*r+n*n;a>0&&(a=1/Math.sqrt(a));const l=(s*r+i*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function z(e){return"vec2("+e[0]+", "+e[1]+")"}function R(e,t){return e[0]===t[0]&&e[1]===t[1]}function A(e,s){const i=e[0],r=e[1],n=s[0],o=s[1],a=t.getEpsilon();return Math.abs(i-n)<=a*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-o)<=a*Math.max(1,Math.abs(r),Math.abs(o))}function F(e,t,s,i,r){let n=t[0]-s[0],o=t[1]-s[1];const a=(i[0]*n+i[1]*o)*(r-1);return n=i[0]*a,o=i[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const O=g,V=n,D=o,N=a,U=m,G=y,B=_,$=Object.freeze(Object.defineProperty({__proto__:null,add:r,angle:E,ceil:l,copy:s,cross:w,dist:U,distance:m,div:N,divide:a,dot:v,equals:A,exactEquals:R,floor:c,inverse:x,len:O,length:g,lerp:C,max:u,min:h,mul:D,multiply:o,negate:b,normalize:S,projectAndScale:F,random:M,rotate:T,round:p,scale:f,scaleAndAdd:d,set:i,sqrDist:G,sqrLen:B,squaredDistance:y,squaredLength:_,str:z,sub:V,subtract:n,transformMat2:P,transformMat2d:L,transformMat3:I,transformMat4:k},Symbol.toStringTag,{value:"Module"}));e.add=r,e.angle=E,e.ceil=l,e.copy=s,e.cross=w,e.dist=U,e.distance=m,e.div=N,e.divide=a,e.dot=v,e.equals=A,e.exactEquals=R,e.floor=c,e.inverse=x,e.len=O,e.length=g,e.lerp=C,e.max=u,e.min=h,e.mul=D,e.multiply=o,e.negate=b,e.normalize=S,e.projectAndScale=F,e.random=M,e.rotate=T,e.round=p,e.scale=f,e.scaleAndAdd=d,e.set=i,e.sqrDist=G,e.sqrLen=B,e.squaredDistance=y,e.squaredLength=_,e.str=z,e.sub=V,e.subtract=n,e.transformMat2=P,e.transformMat2d=L,e.transformMat3=I,e.transformMat4=k,e.vec2=$,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["exports"],function(e){"use strict";function t(){return new Float32Array(2)}function s(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function i(e,t){const s=new Float32Array(2);return s[0]=e,s[1]=t,s}function r(){return t()}function n(){return i(1,1)}function o(){return i(1,0)}function a(){return i(0,1)}const l=r(),c=n(),h=o(),u=a(),p=Object.freeze(Object.defineProperty({__proto__:null,ONES:c,UNIT_X:h,UNIT_Y:u,ZEROS:l,clone:s,create:t,fromValues:i,ones:n,unitX:o,unitY:a,zeros:r},Symbol.toStringTag,{value:"Module"}));e.ONES=c,e.UNIT_X=h,e.UNIT_Y=u,e.ZEROS=l,e.clone=s,e.create=t,e.fromValues=i,e.ones=n,e.unitX=o,e.unitY=a,e.vec2f32=p,e.zeros=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports","../../../../core/Logger"],function(e,t){"use strict";e.getAlignmentFromPlacement=function(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${e}`),["center","middle"]}},e.getXAnchorDirection=function(e){if(!e)return 0;switch(e){case"Left":case"left":return-1;case"Right":case"right":return 1;case"Justify":return t.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),0;case"Center":case"center":return 0}},e.getXDirection=function(e){switch(e){case 1:case"right":return-1;case 0:case"center":return 0;case-1:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}},e.getYAnchorDirection=function(e){if(!e)return 0;switch(e){case"Top":case"top":return 1;case"Center":case"middle":return 0;case"Baseline":case"baseline":return 2;case"Bottom":case"bottom":return-1}},e.getYDirection=function(e){switch(e){case 1:case"top":return 1;case 0:case"middle":return 0;case-1:case 2:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Rect":function(){define(function(){"use strict";return class{constructor(e=0,t=0,s=0,i=0){this.x=e,this.y=t,this.width=s,this.height=i}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],function(e){"use strict";class t{constructor(t,s,i,r){this.transformedX=0,this.transformedY=0,this.center=e.fromValues(t,s),this.centerT=e.create(),this.halfWidth=i/2,this.halfHeight=r/2,this.width=i,this.height=r}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new t(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){const s=Math.abs(e.centerT[0]-this.centerT[0]),i=Math.abs(e.centerT[1]-this.centerT[1]),r=(e.halfWidth+this.halfWidth+t)/s,n=(e.halfHeight+this.halfHeight+t)/i,o=Math.min(r,n);return Math.log2(o)}extend(e){const t=Math.min(this.xmin,e.xmin),s=Math.min(this.ymin,e.ymin),i=Math.max(this.xmax,e.xmax)-t,r=Math.max(this.ymax,e.ymax)-s,n=t+i/2,o=s+r/2;this.width=i,this.height=r,this.halfWidth=i/2,this.halfHeight=r/2,this.x=n,this.y=o}static deserialize(e){const s=e.readF32(),i=e.readF32(),r=e.readInt32(),n=e.readInt32();return new t(s,i,r,n)}}return t})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define(["exports","../../../../core/screenUtils","../../../../geometry/Polygon","../../engine/webgl/definitions"],function(e,t,s,i){"use strict";e.getLineWidth=function(e){const s=t.px2pt(i.minTextLineWidth),r=t.px2pt(i.maxTextLineWidth);return Math.max(s,Math.min(e||r,r))},e.pixelBuffer=50,e.polygonFromExtent=function(e){if(!e)return null;const{xmin:t,ymin:i,xmax:r,ymax:n,spatialReference:o}=e;return new s({rings:[[[t,i],[t,n],[r,n],[r,i],[t,i]]],spatialReference:o})},e.roundPtToWholePixel=function(e){return t.px2pt(Math.round(t.pt2px(e)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports","../../../../geometry/support/coordsUtils","../../../../geometry/support/TileClipper"],function(e,t,s){"use strict";const i=Number.POSITIVE_INFINITY,r=Math.PI,n=2*r,o=128/r,a=256/360,l=r/180,c=1/Math.LN2;function h(e,t){return(e%=t)>=0?e:e+t}e.between=function(e,t,s){return e>=t&&e<=s||e>=s&&e<=t},e.c2pi=n,e.cDegTo256=a,e.cDegToRad=l,e.cInfinity=i,e.cPi=r,e.cRadTo256=o,e.degToByte=function(e){return h(e*a,256)},e.distanceFromToPolylineWithinThreshold=function(e,s,i,r){let n,o,a,l;const c=r*r;for(const r of i){const i=r.length;if(!(i<2)){n=r[0].x,o=r[0].y;for(let h=1;h<i;++h){if(a=r[h].x,l=r[h].y,t.distanceToSegmentSquared(e,s,n,o,a,l)<c)return!0;n=a,o=l}}}return!1},e.getTileMargins=function(e){return 8+Math.max(16*(e-14),0)},e.interpolate=function(e,t,s){return e*(1-s)+t*s},e.isCircleOverlapingRect=function(e,t,s,i,r,n,o){const a=Math.max(i,Math.min(t,n))-t,l=Math.max(r,Math.min(s,o))-s;return a*a+l*l<=e*e},e.log2=function(e){return Math.log(e)*c},e.offsetLine=function(e,t){if(0===t||Number.isNaN(t))return e;const i=[],r=new s.Point(0,0),n=new s.Point(0,0),o=new s.Point(0,0);for(let a=0;a<e.length;a++){const l=e[a],c=[];for(let e=0;e<l.length;e++){const i=l[e-1],a=l[e],h=l[e+1];0===e?r.setCoords(0,0):r.assignSub(a,i).normalize().rightPerpendicular(),e===l.length-1?n.setCoords(0,0):n.assignSub(h,a).normalize().rightPerpendicular(),o.assignAdd(r,n).normalize();const u=o.x*n.x+o.y*n.y;0!==u&&o.scale(1/u),c.push(s.Point.add(a,o.scale(t)))}i.push(c)}return i},e.pointInPolygon=function(e,t,s){let i,r,n,o=0;for(const a of s){i=a.length;for(let s=1;s<i;++s)r=a[s-1],n=a[s],r.y>t!=n.y>t&&((n.x-r.x)*(t-r.y)-(n.y-r.y)*(e-r.x)>0?o++:o--)}return 0!==o},e.positiveMod=h,e.radToByte=function(e){return h(e*o,256)},e.sqr=function(e){return e*e},e.translateAnchor=function(e,t,i,r){const n=new s.Point(e[0],e[1]);if(n.scale(r),"viewport"===t){const e=-i*(Math.PI/180),t=Math.cos(e),s=Math.sin(e);n.rotate(t,s)}return n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolRasterizer":function(){define(["exports","../../geometry/support/jsonUtils","./CIMResourceManager","./CIMSymbolDrawHelper","./CIMSymbolHelper","./OverrideHelper","./rasterizingUtils","./utils"],function(e,t,s,i,r,n,o,a){"use strict";const l=96/72;function c(e,t,s,i,r){const n=-t/2+1,a=t/2-1,l=s/2-1,c=-s/2+1;if(r&&("esriGeometryPolygon"===e||"esriGeometryPolyline"===e)){const i=function(e,t,s,i){return"esriGeometryPolygon"===t?{rings:o.translate(o.scale(e.rings,{xmin:0,ymin:0,width:s,height:i}),-1*s/2,-1*i/2)}:"esriGeometryPolyline"===t?{paths:o.translate(o.scale(e.paths,{xmin:0,ymin:0,width:s,height:i}),-1*s/2,-1*i/2)}:null}(r,e,t,s);if(i)return i}switch(e){case"esriGeometryPoint":return{x:0,y:0};case"esriGeometryPolyline":return{paths:[[[n,0],[0,0],[a,0]]]};default:return"legend"===i?{rings:[[[n,l],[a,0],[a,c],[n,c],[n,l]]]}:{rings:[[[n,l],[a,l],[a,c],[n,c],[n,l]]]}}}e.CIMSymbolRasterizer=class{constructor(e){this._spatialReference=e,this._imageDataCanvas=null,this._cimResourceManager=new s}get _canvas(){return this._imageDataCanvas||(this._imageDataCanvas=document.createElement("canvas")),this._imageDataCanvas}get resourceManager(){return this._cimResourceManager}async rasterizeCIMSymbolAsync(e,s,i,l,h,u,p,f,d,m){if(!e)return null;const{data:y}=e;if(!y||"CIMSymbolReference"!==y.type||!y.symbol)return null;const{symbol:g}=y;u||(u=a.mapCIMSymbolToGeometryType(g));const _=await n.OverrideHelper.resolveSymbolOverrides(y,s,this._spatialReference,h,u,p,f),b=this._cimResourceManager,x=[];r.CIMSymbolHelper.fetchResources(_,b,x),r.CIMSymbolHelper.fetchFonts(_,b,x),x.length>0&&await Promise.all(x);const{width:S,height:v}=i;let w=c(u,S,v,l,m);const C=r.CIMSymbolHelper.getEnvelope(_,w,b);if(!C)return null;C.x===1/0&&(C.x=S+2),C.y===1/0&&(C.y=-v/2),C.width===-1/0&&(C.width=S),C.height===-1/0&&(C.height=v);let M=1,P=0,L=0;switch(g.type){case"CIMPointSymbol":case"CIMTextSymbol":{let e=1;C.width>S&&(e=S/C.width);let t=1;C.height>v&&(t=v/C.height),"preview"===l&&(C.width<S&&(e=S/C.width),C.height<v&&(t=v/C.height)),M=Math.min(e,t),P=C.x+C.width/2,L=C.y+C.height/2}break;case"CIMLineSymbol":if(m){L=C.y+C.height/2,P=C.x+C.width/2;const e=C.width-S,t=C.height-v;w={paths:o.scale(w.paths,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{(d||C.height>v)&&(M=v/C.height),L=C.y+C.height/2;const e=C.x*M+S/2,s=(C.x+C.width)*M+S/2,i=t.isPolyline(w)?w.paths:t.isPolygon(w)?w.rings:null;if(null===i)throw new Error("Bad geometry, can't rasterise symbol!");i[0][0][0]-=e/M,i[0][2][0]-=(s-S)/M}break;case"CIMPolygonSymbol":if(m){L=C.y+C.height/2,P=C.x+C.width/2;const e=C.width-S,t=C.height-v;w={paths:o.scale(w.rings,{xmin:-1*C.width/2+e,xmax:C.width/2-e,ymin:-1*C.height/2+t,ymax:C.height/2-t,width:C.width-2*e,height:C.height-2*t})}}else{P=C.x+C.width/2,L=C.y+C.height/2;const e=C.x*M+S/2,t=(C.x+C.width)*M+S/2,s=C.y*M+v/2,i=(C.y+C.height)*M+v/2,{rings:r}=w;e<0&&(r[0][0][0]-=e,r[0][3][0]-=e,r[0][4][0]-=e),s<0&&(r[0][0][1]+=s,r[0][1][1]+=s,r[0][4][1]+=s),t>S&&(r[0][1][0]-=t-S,r[0][2][0]-=t-S),i>v&&(r[0][2][1]+=i-v,r[0][3][1]+=i-v)}}const I={type:"cim",data:{type:"CIMSymbolReference",symbol:_}};return this.rasterize(I,S,v,P,L,M,u,1,w)}rasterize(e,t,s,r,n,o,h,u=0,p=null,f=window.devicePixelRatio||1){const{data:d}=e;if(!d||"CIMSymbolReference"!==d.type||!d.symbol)return null;const{symbol:m}=d,y=this._canvas,g=f*l;y.width=t*g,y.height=s*g,h||(h=a.mapCIMSymbolToGeometryType(m)),p||(p=c(h,t,s,"legend")),y.width+=2*u,y.height+=2*u;const _=y.getContext("2d",{willReadFrequently:!0}),b=i.Transformation.createIdentity();return b.translate(-r,-n),b.scale(o*g,-o*g),b.translate(t*g/2+u,s*g/2+u),_.clearRect(0,0,y.width,y.height),new i.CanvasDrawHelper(_,this._cimResourceManager,b,!0).drawSymbol(m,p),_.getImageData(0,0,y.width,y.height)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMResourceManager":function(){define(["../../core/fontUtils","../../core/imageUtils"],function(e,t){"use strict";return class{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,s){const i=this._resourceMap.get(e);if(i)return{width:i.width,height:i.height};let r=this._inFlightResourceMap.get(e);return r?r.then(e=>({width:e.width,height:e.height})):(r=t.getImageData(e,s),this._inFlightResourceMap.set(e,r),r.then(t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height}),()=>({width:0,height:0})))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(t){return e.loadFont(t)}}})},"esri/core/imageUtils":function(){define(["require","exports","../request","./Error","./promiseUtils","./urlUtils","../support/base64Utils"],function(e,t,s,i,r,n,o){"use strict";let a=null,l=!0;function c(e,t,s){return s||(a||(a=document.createElement("canvas"),a.width=1,a.height=1),s=a),s.getContext("2d").createImageData(e,t)}t.createEmptyImageData=function(e,t,s){if(!e||!t)throw new Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(e,t)}catch(e){l=!1}return c(e,t,s)},t.getImageData=async function(t,a){const{arrayBuffer:l,mediaType:c}=await async function(e,t){const i=n.dataComponents(e);if(i?.isBase64)return{arrayBuffer:o.base64ToArrayBuffer(i.data),mediaType:i.mediaType};const r=await s(e,{responseType:"array-buffer",...t});return{arrayBuffer:r.data,mediaType:r.getHeader?.("Content-Type")??""}}(t,a),h="image/png"===c;if("image/gif"===c){const{isAnimatedGIF:t,parseGif:s}=await new Promise((t,s)=>e(["./image/gif"],t,s));if(t(l))return s(l,a)}if(h){const{isAnimatedPNG:t,parseApng:s}=await new Promise((t,s)=>e(["./image/apng"],t,s));if(t(l))return s(l,a)}return async function(e,t){const n=window.URL.createObjectURL(e);try{const{data:e}=await s(n,{...t,responseType:"image"});return e}catch(e){if(!r.isAbortError(e))throw new i("invalid-image",`Could not fetch requested image at ${n}`);throw e}finally{window.URL.revokeObjectURL(n)}}(new Blob([l],{type:c}),a)},t.wrapImageData=function(e,t,s,i){if(!t||!s)throw new Error("Cannot construct image data without dimensions");if(l)try{return new ImageData(e,t,s)}catch(e){l=!1}const r=c(t,s,i);return r.data.set(e,0),r},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/OverrideHelper":function(){define(["exports","../../Color","../../core/colorUtils","../../core/lang","../../layers/support/FieldsIndex","../../support/ArcadeExpression","./utils","../../views/2d/arcade/callExpressionWithFeature"],function(e,t,s,i,r,n,o,a){"use strict";const l=e=>{if(!e)return[0,0,0,0];const{r:t,g:s,b:i,a:r}=e;return[t,s,i,255*r]};class c{static findApplicableOverrides(e,t,s){if(e&&t){if(e.primitiveName){let i=!1;for(const t of s)if(t.primitiveName===e.primitiveName){i=!0;break}if(!i)for(const i of t)i.primitiveName===e.primitiveName&&s.push(i)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const i of e.effects)c.findApplicableOverrides(i,t,s);if(e.symbolLayers)for(const i of e.symbolLayers)c.findApplicableOverrides(i,t,s);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const i of e.effects)c.findApplicableOverrides(i,t,s);if(e.markerPlacement&&c.findApplicableOverrides(e.markerPlacement,t,s),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const i of e.markerGraphics)c.findApplicableOverrides(i,t,s),c.findApplicableOverrides(i.symbol,t,s)}else"CIMCharacterMarker"===e.type?c.findApplicableOverrides(e.symbol,t,s):"CIMHatchFill"===e.type?c.findApplicableOverrides(e.lineSymbol,t,s):"CIMPictureMarker"===e.type&&c.findApplicableOverrides(e.animatedSymbolProperties,t,s)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&o.normalizeDashEffectTemplate(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const s=o.toLowerCaseProps(e),i=e.primitiveName,r=[];for(const e of t)e.primitiveName===i&&r.push(o.toLowerCaseProps(e));return{type:"cim-effect-param",effect:s,overrides:o.normalizePrimitiveOverrideProps(r)}}static async resolveSymbolOverrides(e,t,s,n,a,l,h){if(!e?.symbol)return null;let{symbol:u,primitiveOverrides:p}=e;const f=!!p;if(!f&&!n)return u;u=i.clone(u),p=i.clone(p);let d=!0;if(t||(t={attributes:{}},d=!1),f){if(d||(p=p.filter(e=>!e.valueExpressionInfo?.expression.includes("$feature"))),h||(p=p.filter(e=>!e.valueExpressionInfo?.expression.includes("$view"))),p.length>0){const e=o.attributesToFields(t.attributes),i={spatialReference:s,fields:e,geometryType:a};await c.createRenderExpressions(p,i),c.evaluateOverrides(p,t,a??"esriGeometryPoint",l,h,new r(e))}c.applyOverrides(u,p)}return n&&c.applyDictionaryTextOverrides(u,t,n,null),u}static{this._expressionToRenderExpression=new Map}static async createRenderExpressions(e,t){const s=[];for(const i of e){const e=i.valueExpressionInfo;if(!e||c._expressionToRenderExpression.has(e.expression))continue;const r=n.createRendererExpression(e.expression,t.spatialReference);s.push(r),r.then(t=>c._expressionToRenderExpression.set(e.expression,t))}s.length>0&&await Promise.all(s)}static evaluateOverrides(e,t,i,r,n,o){const h={$view:{scale:n?.scale}};for(const n of e){n.value&&"object"==typeof n.value&&s.isRGB(n.value)&&("Color"===n.propertyName||"StrokeColor"===n.propertyName)&&(n.value=l(n.value));const e=n.valueExpressionInfo;if(!e)continue;const u=c._expressionToRenderExpression.get(e.expression);u&&(n.value=a(u,t,h,i,o,r))}}static applyDictionaryTextOverrides(e,t,s,i,r="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const n=e.symbolLayers;if(!n)return;for(const o of n)o&&"CIMVectorMarker"===o.type&&c.applyDictionaryTextOverrides(o,t,s,i,"CIMTextSymbol"===e.type?e.textCase:r)}break;case"CIMVectorMarker":{const r=e.markerGraphics;if(!r)return;for(const e of r)e&&c.applyDictionaryTextOverrides(e,t,s,i)}break;case"CIMMarkerGraphic":{const n=e.textString;if(n&&n.includes("[")){const a=o.analyzeTextParts(n,s);e.textString=o.assignTextValuesFromFeature(t,a,i,r)}}}}static applyOverrides(e,t,s,i){if(e.primitiveName)for(const r of t)if(r.primitiveName===e.primitiveName){const t=o.uncapitalize(r.propertyName);if(i&&i.push({cim:e,nocapPropertyName:t,value:e[t]}),s){let t=!1;for(const i of s)i.primitiveName===e.primitiveName&&(t=!0);t||s.push(r)}null!=r.value&&(e[t]=r.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const r of e.effects)c.applyOverrides(r,t,s,i);if(e.symbolLayers)for(const r of e.symbolLayers)c.applyOverrides(r,t,s,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const r of e.effects)c.applyOverrides(r,t,s,i);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const r of e.markerGraphics)c.applyOverrides(r,t,s,i),c.applyOverrides(r.symbol,t,s,i)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const s of e)void 0!==s.value&&(t+=`${s.primitiveName}${s.propertyName}${JSON.stringify(s.value)}`);return t}static toValue(e,s){if("DashTemplate"===e)return s.split(" ").map(e=>Number(e));if("Color"===e){const e=new t(s).toRgba();return e[3]*=255,e}return s}}e.OverrideHelper=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(e,t,s){"use strict";const i=new Map;return function(r,n,o,a,l,c){if(null==r)return null;const h=r.references("geometry")&&c?function(r,n,o){const{transform:a,hasZ:l,hasM:c}=o;i.has(n)||i.set(n,function(i){const r={};switch(i){case"esriGeometryPoint":return(e,t,i,n)=>s.unquantizePoint(t,r,e,i,n);case"esriGeometryPolygon":return(e,t,i,n)=>s.unquantizePolygon(t,r,e,i,n);case"esriGeometryPolyline":return(e,t,i,n)=>s.unquantizePolyline(t,r,e,i,n);case"esriGeometryMultipoint":return(e,t,i,n)=>s.unquantizeMultipoint(t,r,e,i,n);default:return t.getLogger("esri.views.2d.support.arcadeOnDemand").error(new e("mapview-arcade",`Unable to handle geometryType: ${i}`)),e=>e}}(n));const h=i.get(n)(r.geometry,a,l,c);return{...r,geometry:h}}(n,a,c):n,u=r.repurposeFeature(h,l);try{return r.evaluate(u,o)}catch(e){return t.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(e,t){"use strict";function s(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:s,translate:i}=e,r=s[0]??1,n=s[1]??1;return{originPosition:"lowerLeft",scale:[r,"lowerLeft"===t?n:-n,s[2]??1,s[3]??1],translate:[i[0]??0,i[1]??0,i[2]??0,i[3]??0]}}function i({scale:e,translate:t},s){return Math.round((s-t[0])/e[0])}function r({scale:e,translate:t},s){return Math.round((s-t[1])/e[1])}function n({scale:e,translate:t},s){return Math.round(((s??0)-t[2])/e[2])}function o({scale:e,translate:t},s){return s?Math.round((s-t[3])/e[3]):0}function a(e,t){return e&&t?u:e&&!t?c:!e&&t?h:l}const l=(e,t)=>{const s=[];if(!t.length)return null;const n=t[0];let o=i(e,n[0]),a=r(e,n[1]);s.push([o,a]);for(let n=1;n<t.length;n++){const[l,c]=t[n],h=i(e,l),u=r(e,c);h===o&&u===a||s.push([h-o,u-a]),o=h,a=u}return s},c=(e,t)=>{const s=[];if(!t.length)return null;const o=t[0];let a=i(e,o[0]),l=r(e,o[1]),c=n(e,o[2]);s.push([a,l,c]);for(let o=1;o<t.length;o++){const[h,u,p]=t[o],f=i(e,h),d=r(e,u),m=n(e,p);f===a&&d===l&&m===c||s.push([f-a,d-l,m]),a=f,l=d,c=m}return s},h=(e,t)=>{const s=[];if(!t.length)return null;const n=t[0];let a=i(e,n[0]),l=r(e,n[1]),c=o(e,n[2]);s.push([a,l,c]);for(let n=1;n<t.length;n++){const[h,u,p]=t[n],f=i(e,h),d=r(e,u),m=o(e,p);f===a&&d===l&&m===c||s.push([f-a,d-l,m]),a=f,l=d,c=m}return s},u=(e,t)=>{const s=[];if(!t.length)return null;const a=t[0];let l=i(e,a[0]),c=r(e,a[1]),h=n(e,a[2]),u=o(e,a[3]);s.push([l,c,h,u]);for(let a=1;a<t.length;a++){const[p,f,d,m]=t[a],y=i(e,p),g=r(e,f),_=n(e,d),b=o(e,m);y===l&&g===c&&_===h&&b===u||s.push([y-l,g-c,_,b]),l=y,c=g,h=_,u=b}return s};function p({scale:e,translate:t},s){return s*e[0]+t[0]}function f({scale:e,translate:t},s){return s*e[1]+t[1]}function d({scale:e,translate:t},s){return(s??0)*e[2]+t[2]}function m({scale:e,translate:t},s){return s?s*e[3]+t[3]:0}function y(e,t){return e&&t?x:e&&!t?_:!e&&t?b:g}const g=(e,t)=>{const s=new Array(t.length);if(!t.length)return s;const i=t[0];let r=p(e,i[0]),n=f(e,i[1]);s[0]=[r,n];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let e=1;e<t.length;e++){const[i,o]=t[e];r+=l*i,n+=c*o,s[e]=[r,n]}return s},_=(e,t)=>{const s=new Array(t.length);if(!t.length)return s;const i=t[0];let r=p(e,i[0]),n=f(e,i[1]);s[0]=[r,n,d(e,i[2])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let i=1;i<t.length;i++){const[o,a,h]=t[i];r+=l*o,n+=c*a,s[i]=[r,n,d(e,h)]}return s},b=(e,t)=>{const s=new Array(t.length);if(!t.length)return s;const i=t[0];let r=p(e,i[0]),n=f(e,i[1]);s[0]=[r,n,m(e,i[2])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let i=1;i<t.length;i++){const[o,a,h]=t[i];r+=l*o,n+=c*a,s[i]=[r,n,m(e,h)]}return s},x=(e,t)=>{const s=new Array(t.length);if(!t.length)return s;const i=t[0];let r=p(e,i[0]),n=f(e,i[1]);s[0]=[r,n,d(e,i[2]),m(e,i[3])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let i=1;i<t.length;i++){const[o,a,h,u]=t[i];r+=l*o,n+=c*a,s[i]=[r,n,d(e,h),m(e,u)]}return s};function S(e,t,s){const i=new Array(s.length);for(let r=0;r<s.length;r++)i[r]=t(e,s[r]);return i}function v(e,t,s){let[i,r]=s[0],n=Math.min(i,t[0]),o=Math.min(r,t[1]),a=Math.max(i,t[2]),l=Math.max(r,t[3]);for(let e=1;e<s.length;e++){const[t,c]=s[e];i+=t,r+=c,t<0&&(n=Math.min(n,i)),t>0&&(a=Math.max(a,i)),c<0?o=Math.min(o,r):c>0&&(l=Math.max(l,r))}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function w(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(let s=0;s<t.length;s++)v(e,e,t[s]);return e}function C(e,t,a){const l=s(e);return t.xmin=i(l,a.xmin),t.ymin=r(l,a.ymin),t.xmax=i(l,a.xmax),t.ymax=r(l,a.ymax),a.hasZ&&(t.zmin=n(l,a.zmin),t.zmax=n(l,a.zmax)),a.hasM&&(t.mmin=o(l,a.mmin),t.mmax=o(l,a.mmax)),t.hasZ=a.hasZ??!1,t.hasM=a.hasM??!1,t}function M(e,t,i){const r=s(e);return t.points=a(i.hasZ,i.hasM)(r,i.points)??[],t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t}function P(e,t,a){const l=s(e);return t.x=i(l,a.x),t.y=r(l,a.y),null!=a.z&&(t.z=n(l,a.z)),null!=a.m&&(t.m=o(l,a.m)),t}function L(e,t,i){const r=function(e,t,s,i){const r=[],n=a(s,i);for(let s=0;s<t.length;s++){const i=n(e,t[s]);i&&i.length>=3&&r.push(i)}return r.length?r:null}(s(e),i.rings,i.hasZ,i.hasM);return r?(t.rings=r,t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t):null}function I(e,t,i){const r=function(e,t,s,i){const r=[],n=a(s,i);for(let s=0;s<t.length;s++){const i=n(e,t[s]);i&&i.length>=2&&r.push(i)}return r.length?r:null}(s(e),i.paths,i.hasZ,i.hasM);return r?(t.paths=r,t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t):null}e.getQuantizedBoundsCoordsArray=v,e.getQuantizedBoundsCoordsArrayArray=w,e.getQuantizedBoundsPaths=function(e){return w([0,0,0,0],e)},e.getQuantizedBoundsPoints=function(e){const t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return v(t,t,e)},e.getQuantizedBoundsRings=function(e){return w([0,0,0,0],e)},e.normalizeTransform=s,e.quantizeBounds=function(e,t,n){const o=s(e);return t[0]=i(o,n[0]),t[3]=r(o,n[1]),t[2]=i(o,n[2]),t[1]=r(o,n[3]),t},e.quantizeCoordsArrayXY=l,e.quantizeCoordsArrayXYM=h,e.quantizeCoordsArrayXYZ=c,e.quantizeCoordsArrayXYZM=u,e.quantizeExtent=C,e.quantizeGeometry=function(e,s){return e&&s?t.isPoint(s)?P(e,{},s):t.isPolyline(s)?I(e,{},s):t.isPolygon(s)?L(e,{},s):t.isMultipoint(s)?M(e,{},s):t.isExtent(s)?C(e,{},s):null:null},e.quantizeM=o,e.quantizeMultipoint=M,e.quantizePoint=P,e.quantizePolygon=L,e.quantizePolyline=I,e.quantizeX=i,e.quantizeY=r,e.quantizeZ=n,e.toQuantizationTransform=function(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null},e.unquantizeBounds=function(e,t,i){const r=s(e);return i?(t[0]=p(r,i[0]),t[1]=f(r,i[3]),t[2]=p(r,i[2]),t[3]=f(r,i[1]),t):[p(r,t[0]),f(r,t[3]),p(r,t[2]),f(r,t[1])]},e.unquantizeCoordsArrayArray=S,e.unquantizeCoordsArrayXY=g,e.unquantizeCoordsArrayXYM=b,e.unquantizeCoordsArrayXYZ=_,e.unquantizeCoordsArrayXYZM=x,e.unquantizeExtent=function(e,t,i,r=i.hasZ??!1,n=i.hasM??!1){const o=s(e);return t.xmin=p(o,i.xmin),t.xmax=p(o,i.xmax),t.ymin=f(o,i.ymin),t.ymax=f(o,i.ymax),r&&(t.zmin=d(o,i.zmin),t.zmax=d(o,i.zmax)),n&&(t.mmin=m(o,i.mmin),t.mmax=m(o,i.mmax)),t.hasZ=r,t.hasM=n,t},e.unquantizeM=m,e.unquantizeMultipoint=function(e,t,i,r=i?.hasZ??!1,n=i?.hasM??!1){if(null!=i){const o=s(e);t.points=y(r,n)(o,i.points),t.hasZ=r,t.hasM=n}return t},e.unquantizePoint=function(e,t,i,r=null!=i?.z,n=null!=i?.m){if(null==i)return t;const o=s(e);return t.x=p(o,i.x),t.y=f(o,i.y),r&&(t.z=d(o,i.z)),n&&(t.m=m(o,i.m)),t},e.unquantizePolygon=function(e,t,i,r=i?.hasZ??!1,n=i?.hasM??!1){if(null!=i){const o=s(e);t.rings=S(o,y(r,n),i.rings),t.hasZ=r,t.hasM=n}return t},e.unquantizePolyline=function(e,t,i,r=i?.hasZ??!1,n=i?.hasM??!1){if(null!=i){const o=s(e);t.paths=S(o,y(r,n),i.paths),t.hasZ=r,t.hasM=n}return t},e.unquantizeX=p,e.unquantizeY=f,e.unquantizeZ=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/smartMapping/support/utils":function(){define(["exports","../../../Color","../../../intl/date","../../../intl/number","../../../renderers/support/utils","../../../renderers/visualVariables/SizeVariable"],function(e,t,s,i,r,n){"use strict";e.formatDateLabel=function(e){return s.formatDate(new Date(e),r.timelineDateFormatOptions)},e.formatNumberLabel=function(e){const t=Math.floor(Math.log10(Math.abs(e)))+1,s=t<4||t>6?4:t,r=Math.abs(e)>=1e6?"compact":"standard";return i.formatNumber(e,{notation:r,minimumSignificantDigits:2,maximumSignificantDigits:s})},e.getDeviationValues=function(e,t,s){if(null==t||null==e)return[];const i=[];for(let r=-1*s;r<=s;r++)0!==r&&i.push(t+r*e);return i},e.getDynamicPathForSizeStops=function(e){const{max:t,min:s,padding:i,pathHeight:r,pathWidth:n,stops:o}=e,a=t-s;let l,c=`M0 0 L${n} 0 `;const h=3===o.length?[o[0],o[1],o[2]]:[o[0],o[2],o[4]],u=Math.min.apply(Math,h.map(e=>e.size)),p=Math.max(Math.abs(h[0].size-h[1].size),Math.abs(h[2].size-h[1].size));return h.reverse(),h.forEach(({size:e,value:t},o)=>{const h=Math.round((e-u)/p*100)/100,f=Math.round(r-(t-s)/a*r);l=h*n,0===l&&(l=i*n),0===o&&(c+=`L${l} 0 `),c+=`L${l} ${f} `}),c+=`L${l} ${r} L0 ${r} L0 0 Z`,c},e.getFillFromColor=function(e){return e instanceof t?e.toCss(!0):t.fromString(e??"").toCss(!0)},e.getPathForSizeStops=function(e){const{bottomValue:t,bottomWidth:s,max:i,min:r,pathHeight:n,pathWidth:o,topValue:a,topWidth:l}=e,c=l*o,h=s*o,u=i-r,p=Math.round(n-(t-r)/u*n);return`M${c} 0 L${c} ${Math.round(n-(a-r)/u*n)} L${h} ${p} L${h} ${n} L0 ${n} L0 0 Z`},e.getSizesFromVariable=function(e){let t=e.maxSize,s=e.minSize;return t instanceof n&&(t=t.stops[0].size),s instanceof n&&(s=s.stops[0].size),[t,s]},e.getStopChanges=function(e,t,s){const i=s.length-1;if(i<0)return[];const r=s[0],n=s[i]-r,o=t-e,a=[];for(let t=1;t<i;t++){const i=(s[t]-r)/n*o+e;a.push({index:t,value:i})}return a.unshift({index:0,value:e}),a.push({index:i,value:t}),a},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/utils":function(){define(["exports","../../core/arrayUtils","../../core/Logger","../../core/MapUtils","../../intl/date","../../layers/support/fieldUtils","./numberUtils","../visualVariables/support/ColorStop","../../smartMapping/support/utils","../../symbols/support/utils","../../widgets/Legend/support/colorRampUtils","../../widgets/Legend/support/heatmapRampUtils"],function(e,t,s,i,r,n,o,a,l,c,h,u){"use strict";const p={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},f=r.convertDateFormatToIntlOptions("short-date");async function d(e,t,s){i.getOrCreateMapValue(e,t,()=>[]).push(...s)}async function m(e,t,s){const r=i.getOrCreateMapValue(e,t,()=>new Map);for(const e of s)r.set(e.value,e.color)}function y(e){let t=e.minValue,s=e.maxValue;const i=e.isFirstBreak?"":"> ",r="percent-of-total"===e.normalizationType?"%":"";return t=null==t?"":o.format(t),s=null==s?"":o.format(s),i+t+r+"  "+s+r}function g(e,t){return"normalizationField"in e&&e.normalizationField?{type:"normalized-field",field:e.field,normalizationField:e.normalizationField}:"field"in e&&e.field?_(e.field):"valueExpression"in e&&e.valueExpression?{type:"expression",expression:e.valueExpression,title:e.valueExpressionTitle,returnType:t}:null}function _(e){return{type:"field",field:e}}function b(e){return"color"===e.type}e.calculateDateFormatInterval=function(e){const t=e.map(e=>new Date(e)),s=t.length;let i=1/0,r=null;for(let e=0;e<s-1;e++){const n=t[e];let o=1/0,a=null;for(let i=e+1;i<s;i++){const e=t[i],s=(n.getFullYear()!==e.getFullYear()?"year":n.getMonth()!==e.getMonth()&&"month")||n.getDate()!==e.getDate()&&"day"||n.getHours()!==e.getHours()&&"hour"||n.getMinutes()!==e.getMinutes()&&"minute"||n.getSeconds()!==e.getSeconds()&&"second"||"millisecond",r=p[s];r<o&&(o=r,a=s)}o<i&&(i=o,r=a)}return r},e.createClassBreakLabel=y,e.createColorStops=function(e){const{values:t,colors:s,labelIndexes:i,isDate:n}=e;return t.map((e,l)=>{let c=null;if(!i||i.includes(l)){const s=n?r.formatDate(e):o.format(e);s&&(c=function(e,t,s){let i="";return 0===t?i="< ":t===s&&(i="> "),i+e}(s,l,t.length-1))}return new a({value:e,color:s[l],label:c})})},e.createUniqueValueLabel=function(e){const{value:t,domain:s,fieldInfo:i,dateFormatOptions:r}=e;let a=String(t);const c=s&&"codedValues"in s&&s.codedValues?s.getName(t):null;return c?a=c:null!=t&&i&&(l.isAnyDateField(i)||n.isTimeOnlyField(i))?a=l.formatAnyDate(t,r??{fieldType:i.type}):"number"==typeof t&&(a=o.format(t)),a},e.dateFormatIntervalOptions={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",year:"year"},e.getAttribute=g,e.getAttributes=function(e,s){const i=[];if("class-breaks"===e.type||"heatmap"===e.type)i.push(g(e,"number"));else if("unique-value"===e.type){const t=e.authoringInfo;if(t&&"relationship"===t.type){if(t.field1&&t.field2){const e=t.field1.field,s=t.field2.field,r=t.field1.normalizationField,n=t.field2.normalizationField;i.push(g({field:e,normalizationField:r})),i.push(g({field:s,normalizationField:n}))}}else{const t=e.uniqueValueInfos?.[0];let s=null;if(t?.value){const e=typeof t.value;"string"!==e&&"number"!==e||(s=e)}i.push(g(e,s)),[e.field2,e.field3].forEach(e=>e&&i.push(_(e)))}}else"attributes"in e&&e.attributes?.forEach(e=>i.push(g(e,"number")));const r=s?s(e):"visualVariables"in e?e.visualVariables:null;return r&&r.forEach(e=>i.push(g(e,"number"))),t.unique(i.filter(t.isSome),(e,t)=>"field"===e.type&&"field"===t.type?e.field===t.field:"normalized-field"===e.type&&"normalized-field"===t.type?e.field===t.field&&e.normalizationField===t.normalizationField:"expression"===e.type&&"expression"===t.type&&e.expression===t.expression)},e.getColorsForRendererValues=async function(e){const t=new Map;if(!e)return t;if("unique-value"!==e.type||e.authoringInfo?.type)if("class-breaks"===e.type){const s=e.classBreakInfos.map(e=>({value:e.minValue,color:c.getColorFromSymbol(e.symbol,null)})).reverse(),{field:i,valueExpression:r}=e;await m(t,i??r,s)}else"simple"===e.type&&await m(t,"default",[{value:"default",color:c.getColorFromSymbol(e.symbol,null)}]);else{const s=(e.uniqueValueInfos??[]).map(e=>({value:e.value,color:c.getColorFromSymbol(e.symbol,null)})),{field:i,field2:r,field3:n,valueExpression:o,fieldDelimiter:a}=e,l=[i,r,n].filter(Boolean).join(a||"");(l||o)&&await m(t,l||o,s)}if("defaultSymbol"in e&&e.defaultSymbol&&await m(t,"default",[{value:"default",color:c.getColorFromSymbol(e.defaultSymbol,null)}]),"visualVariables"in e&&e.visualVariables){const s=e.visualVariables.filter(e=>"color"===e.type);for(const e of s){const s=await h.getRampStops(e)??[];await m(t,e.field||e.valueExpression,s)}}return t},e.getColorsFromRenderer=async function(e){const s=new Map;if(!e)return s;if("visualVariables"in e&&e.visualVariables)for(const t of e.visualVariables)if(b(t)){const e=(await h.getRampStops(t)??[]).map(e=>e.color);await d(s,t.field||t.valueExpression,e)}if("heatmap"===e.type){const t=u.getHeatmapRampStops(e).map(e=>e.color);await d(s,e.field||e.valueExpression,t)}else if("pie-chart"===e.type){for(const t of e.attributes)await d(s,t.field||t.valueExpression,[t.color]);await d(s,"default",[e?.othersCategory?.color,c.getColorFromSymbol(e.backgroundFillSymbol,null)])}else if("dot-density"===e.type){for(const t of e.attributes)await d(s,t.field||t.valueExpression,[t.color]);await d(s,"default",[e.backgroundColor])}else if("unique-value"===e.type)if("predominance"===e.authoringInfo?.type)for(const t of e.uniqueValueInfos??[])await d(s,t.value.toString(),[c.getColorFromSymbol(t.symbol,null)]);else{const t=(e.uniqueValueInfos??[]).map(e=>c.getColorFromSymbol(e.symbol,null)),{field:i,field2:r,field3:n,valueExpression:o}=e;(i||o)&&await d(s,i||o,t),r&&await d(s,r,t),n&&await d(s,n,t)}else if("class-breaks"===e.type){const t=e.classBreakInfos.map(e=>c.getColorFromSymbol(e.symbol,null)),{field:i,valueExpression:r}=e;await d(s,i??r,t)}else"simple"===e.type&&await d(s,"default",[c.getColorFromSymbol(e.symbol,null)]);return"defaultSymbol"in e&&e.defaultSymbol&&await d(s,"default",[c.getColorFromSymbol(e.defaultSymbol,null)]),s.forEach((e,i)=>{const r=t.unique(e.filter(Boolean),(e,t)=>JSON.stringify(e)===JSON.stringify(t));s.set(i,r)}),s},e.setLabelsForClassBreaks=function(e){const t=e.classBreakInfos,i=e.normalizationType;let r=[];if(t?.length)if("standard-deviation"!==e.classificationMethod)if(e.round){r.push(t[0].minValue);for(const e of t)r.push(e.maxValue);r=o.round(r),t.forEach((e,t)=>{e.label=y({minValue:0===t?r[0]:r[t],maxValue:r[t+1],isFirstBreak:0===t,normalizationType:i})})}else t.forEach((e,t)=>{e.label=y({minValue:e.minValue,maxValue:e.maxValue,isFirstBreak:0===t,normalizationType:i})});else s.getLogger("esri.renderers.support.utils").warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.")},e.timelineDateFormatOptions=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/styles/card/CardView":function(){define(["require","exports","../../../../chunks/tslib.es6","../../../../intl","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","./LegendElement","../../../../chunks/componentsUtils","../../../support/widgetUtils","../../../support/decorators/messageBundle","../../../support/jsxFactory","../../../../intl/substitute"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d,m,y){"use strict";return t.default=class extends c{constructor(e,t){super(e,t),this._hasIndicators=!1,this.activeLayerInfos=null,this.headingLevel=3,this.layout="stack",this.messages=null,this.messagesCommon=null,this.type="card",this.view=null}loadDependencies(){return p.loadCalciteComponents({carousel:()=>new Promise((t,s)=>e(["../../../../chunks/index62"],t,s)),"carousel-item":()=>new Promise((t,s)=>e(["../../../../chunks/index63"],t,s))})}render(){this._hasIndicators="auto"===this.layout&&this.view&&this.view.container.clientWidth<=768||"stack"===this.layout;const e=this._hasIndicators?this._renderCarousel():this._renderLayers(),t={[h.css.stacked]:this._hasIndicators};return m.tsx("div",{class:this.classes(h.css.base,t)},e||m.tsx("div",{class:h.css.message},this.messages.noLegend))}_renderCarousel(){const e=[],t=this.activeLayerInfos;if(t)for(const s of t)this._renderSections(s,e);return e?.length?m.tsx("calcite-carousel",{class:h.css.carousel,label:this.messages.carousel},e.map((t,s)=>m.tsx("calcite-carousel-item",{class:h.css.carouselItem,key:s,label:y.substitute(this.messagesCommon.pagination.pageText,{index:s+1,total:e.length})},t))):null}_renderLayers(){const e=this.activeLayerInfos,t=e?.toArray()?.map(e=>this._renderLegendForLayer(e)).filter(Boolean);return t?.length?t:null}_renderLegendForLayer(e){if(!e.ready)return null;if(e.children.length){const t=e.children.toArray().map(this._renderLegendForLayer,this);return m.tsx("section",{class:this.classes(h.css.service,h.css.groupLayer),key:e.layer.uid},m.tsx("div",{class:h.css.serviceCaptionContainer},e.title),t)}return this._renderLegendElementsForLayer(e)}_renderLegendElementsForLayer(e){const t=e.legendElements?.filter(Boolean);if(!t?.length)return null;const s=t.map(t=>m.tsx(u,{activeLayerInfo:e,effectList:e.effectList,hasIndicators:this._hasIndicators,headingLevel:this.headingLevel,isChild:!1,key:`${e.layer.uid}-${t.type}`,layer:e.layer,legendElement:t,messages:this.messages})),i={[h.css.groupLayerChild]:!!e.parent};return m.tsx("section",{class:this.classes(h.css.service,i),key:e.layer.uid},m.tsx("div",{class:h.css.serviceCaptionContainer},m.tsx("div",{class:h.css.serviceCaptionText},e.title)),m.tsx("div",{class:h.css.serviceContent},s))}_renderSections(e,t){if(!e.ready)return;if(e.children.length)for(const s of e.children)this._renderSections(s,t);const s=e.legendElements;if(s?.length)for(const i of s){const s=m.tsx(u,{activeLayerInfo:e,effectList:e.effectList,hasIndicators:this._hasIndicators,headingLevel:this.headingLevel,isChild:!1,key:`${e.layer.uid}-${i.type}`,layer:e.layer,legendElement:i,messages:this.messages});s&&t.push(s)}}},s.__decorate([r.property()],t.default.prototype,"activeLayerInfos",void 0),s.__decorate([r.property()],t.default.prototype,"headingLevel",void 0),s.__decorate([r.property()],t.default.prototype,"layout",void 0),s.__decorate([r.property(),d.messageBundle("esri/widgets/Legend/t9n/Legend")],t.default.prototype,"messages",void 0),s.__decorate([r.property(),d.messageBundle("esri/t9n/common")],t.default.prototype,"messagesCommon",void 0),s.__decorate([r.property({readOnly:!0})],t.default.prototype,"type",void 0),s.__decorate([r.property()],t.default.prototype,"view",void 0),t.default=s.__decorate([l.subclass("esri.widgets.Legend.styles.card.CardView")],t.default),t.default})},"esri/widgets/Legend/styles/card/css":function(){define(["exports"],function(e){"use strict";const t="esri-legend--card",s="esri-legend",i={activated:`${t}__carousel-indicator--activated`,base:t,stacked:`${s}--stacked`,carouselTitle:`${t}__carousel-title`,indicator:`${t}__carousel-indicator`,intervalSeparator:`${t}__interval-separator`,imageryLayerStretchedImage:`${t}__imagery-layer-image--stretched`,imageLabel:`${t}__image-label`,layerCaption:`${t}__layer-caption`,labelElement:`${t}__label-element`,layerRow:`${t}__layer-row`,labelCell:`${t}__label-cell`,message:`${t}__message`,rampLabel:`${t}__ramp-label`,section:`${t}__section`,relationshipSection:`${t}__relationship-section`,serviceCaptionText:`${t}__service-caption-text`,serviceContent:`${t}__service-content`,service:`${t}__service`,groupLayer:`${t}__group-layer`,groupLayerChild:`${t}__group-layer-child`,symbol:`${t}__symbol`,sizeRampRow:`${t}__size-ramp-row`,symbolRow:`${t}__symbol-row`,symbolCell:`${t}__symbol-cell`,carousel:`${t}__carousel`,carouselItem:`${t}__carousel-item`,indicatorContainer:`${t}__carousel-indicator-container`,intervalSeparatorsContainer:`${t}__interval-separators-container`,relationshipLabelContainer:`${t}__relationship-label-container`,labelContainer:`${t}__label-container`,serviceCaptionContainer:`${t}__service-caption-container`,symbolContainer:`${t}__symbol-container`,colorRampContainer:`${t}__color-ramp-container`,sizeRampContainer:`${t}__size-ramp-container`,sizeRampPreview:`${t}__size-ramp-preview`,pieChartRampPreview:`${t}__pie-chart-ramp-preview`,rampContainer:`${s}__ramps`,sizeRampHorizontal:`${s}__size-ramp--horizontal`,rampLabelsContainer:`${s}__ramp-labels`,layerInfo:`${s}__layer-cell ${s}__layer-cell--info`,univariateAboveAndBelowColorRamp:"esri-univariate-above-and-below-ramp__color--card"};e.css=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/styles/card/LegendElement":function(){define(["exports","../../../../chunks/tslib.es6","../../../../Color","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../symbols/support/utils","../../../Widget","./ColorRamp","./css","./SizeRamp","./UnivariateAboveAndBelowRamp","./UnivariateColorSizeRamp","../support/relationshipUtils","../support/utils","../../support/styleUtils","../../../support/Heading","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d,m,y,g,_,b,x){"use strict";var S;return e.default=S=class extends c{constructor(e,t){super(e,t),this.effectList=null,this.hasIndicators=!1,this.headingLevel=3,this.isChild=!1,this.legendElement=null}render(){const e=this._renderLegendElement(),t=y.getLegendElementTitle(this.legendElement,this.messages),s=this.hasIndicators&&!this.isChild?x.tsx("div",null,x.tsx(_.Heading,{class:u.css.carouselTitle,level:this.headingLevel},this.activeLayerInfo.title),x.tsx(_.Heading,{class:u.css.layerCaption,level:_.incrementHeadingLevel(this.headingLevel)},t)):t?x.tsx(_.Heading,{class:u.css.layerCaption,level:this.headingLevel},t):null;return x.tsx("section",{"aria-labelledby":this.key,class:u.css.section,id:`${this.key}-panel`,key:this.key,role:"tabpanel",tabIndex:0},s,e)}_renderLegendElement(){switch(this.legendElement.type){case"symbol-table":return this._renderSymbolTable(this.legendElement);case"size-ramp":return x.tsx(p,{hasIndicators:this.hasIndicators,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":return x.tsx(h,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"relationship-ramp":return m.renderRelationshipRamp(this.legendElement,this.id,{opacity:this.layer.opacity,effectList:this.effectList,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:this.key});case"pie-chart-ramp":return x.tsx("div",{afterCreate:g.attachToNode,bind:this.legendElement.preview,class:u.css.pieChartRampPreview,key:`${this.key}-preview`});case"univariate-above-and-below-ramp":return x.tsx(f,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"univariate-color-size-ramp":return x.tsx(d,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});default:return null}}_renderSymbolTable(e){const t=e.infos.map(t=>this._renderElementInfo(t,e.legendType)).filter(Boolean);if(!t.length)return null;const s=this.activeLayerInfo.legendElements.some(({type:e})=>"relationship-ramp"===e),i=t[0]?.properties?.classes?.[u.css.symbolRow],r={[u.css.labelContainer]:!i&&!s,[u.css.relationshipLabelContainer]:s};return x.tsx("div",{class:this.classes(r)},t)}_renderElementInfo(e,t){const{layer:s}=this,i="label"in e?e.label:null,r=`${this.key}-${i}`;if("type"in e&&e.type)return x.tsx(S,{activeLayerInfo:this.activeLayerInfo,effectList:this.effectList,hasIndicators:this.hasIndicators,headingLevel:this.headingLevel,isChild:!0,key:r,layer:s,legendElement:e,messages:this.messages});if(!("preview"in e&&e.preview||"src"in e&&e.src))return null;const n=g.isImageryStretchedLegend(s,t),o=g.getTitle(this.messages,i,!1)||"";if("src"in e&&e.src)return x.tsx("div",{class:u.css.layerRow,key:`${r}-row`},this._renderImage(e,s,n),x.tsx("div",{class:u.css.imageLabel},o));if("symbol"in e&&e.preview){if(!e.symbol?.type.includes("simple-fill")){if(!e.label)return x.tsx("div",{afterCreate:g.attachToNode,bind:e.preview,key:`${r}-row`});const t={[u.css.symbolCell]:this.hasIndicators};return x.tsx("div",{class:this.classes(u.css.layerRow,{[u.css.symbolRow]:this.hasIndicators}),key:`${r}-row`},x.tsx("div",{afterCreate:g.attachToNode,bind:e.preview,class:this.classes(t)}),x.tsx("div",{class:this.classes(u.css.imageLabel,{[u.css.labelCell]:this.hasIndicators})},o))}return x.tsx("div",{class:u.css.layerRow,key:`${r}-row`},x.tsx("div",{class:u.css.labelElement,styles:this._getBackgroundStyles(e)},o))}return null}_getBackgroundStyles(e){const t=e.symbol,i=t.color,r=!!i?.a,n="outline"in t?t.outline:null,o=!!n?.color?.a,a=new s(r&&i?[i.r,i.g,i.b,i.a*this.layer.opacity]:[255,255,255,0]),c=o&&n.color?new s([n.color.r,n.color.g,n.color.b,n.color.a*this.layer.opacity]):new s([255,255,255,0]),h=e.symbol.color?.isBright??!0,u=h?"black":"white",p=h?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return{background:r?a.toCss(!0):"none",color:u,textShadow:`-1px -1px 0 ${p},\n                  1px -1px 0 ${p},\n                  -1px 1px 0 ${p},\n                  1px 1px 0 ${p}`,border:o?`1px solid ${c.toCss(!0)}`:"none",filter:l.getCSSFilterFromEffectList(this.effectList)??void 0}}_renderImage(e,t,s){const{label:i,src:r,opacity:n}=e,o={[u.css.imageryLayerStretchedImage]:s,[u.css.symbol]:!s},a={opacity:`${n??t.opacity}`},l=g.getTitle(this.messages,i,!1);return x.tsx("img",{alt:l,"aria-label":l,border:0,class:this.classes(o),height:e.height,src:r,styles:a,width:e.width})}},t.__decorate([i.property()],e.default.prototype,"activeLayerInfo",void 0),t.__decorate([i.property()],e.default.prototype,"effectList",void 0),t.__decorate([i.property()],e.default.prototype,"hasIndicators",void 0),t.__decorate([i.property()],e.default.prototype,"headingLevel",void 0),t.__decorate([i.property()],e.default.prototype,"isChild",void 0),t.__decorate([i.property()],e.default.prototype,"layer",void 0),t.__decorate([i.property()],e.default.prototype,"legendElement",void 0),t.__decorate([i.property()],e.default.prototype,"messages",void 0),e.default=S=t.__decorate([a.subclass("esri.widgets.Legend.styles.card.LegendElement")],e.default),e.default})},"esri/widgets/Legend/styles/card/ColorRamp":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../symbols/support/svgUtils","../../../../symbols/support/utils","../../../Widget","./css","../support/utils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f){"use strict";return e.default=class extends c{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const e=this.legendElement.infos.slice().reverse();return f.tsx("div",{class:this.classes(h.css.layerRow,h.css.colorRampContainer)},this._renderRampLabel(e[0]),f.tsx("div",{class:h.css.symbolContainer},this._renderPreview(e),this._renderMiddleStopRampLabel(e)),this._renderRampLabel(e.at(-1)))}_renderPreview(e){const{opacity:t}=this,s="heatmap-ramp"===this.legendElement.type,i=e.length-1,r=i>2&&!s?25*i:100,n=r+20,o=[[{shape:{type:"path",path:"M0 12.5 L10 0 L10 25 Z"},fill:e[0].color,stroke:{width:0}},{shape:{type:"rect",x:10,y:0,width:r,height:25},fill:{type:"linear",x1:10,y1:0,x2:r+10,y2:0,colors:e.map((e,t)=>({color:e.color,offset:s&&"ratio"in e?e.ratio:t/i}))},stroke:{width:0}},{shape:{type:"path",path:`M${r+10} 0 L${n} 12.5 L${r+10} 25 Z`},fill:e[e.length-1].color,stroke:{width:0}}]],c=a.renderSVG(o,n,25),h={filter:l.getCSSFilterFromEffectList(this.effectList)??void 0,opacity:null==t?void 0:`${t}`};return f.tsx("div",{styles:h},c)}_renderMiddleStopRampLabel(e){const t=e.length%2!=0?e[e.length/2|0]:null;return t?f.tsx("div",{class:h.css.intervalSeparatorsContainer},f.tsx("div",{class:h.css.intervalSeparator},"|"),this._renderRampLabel(t)):null}_renderRampLabel(e){return f.tsx("div",{class:h.css.rampLabel},u.getRampStopLabel(e,this.legendElement.type,this.messages))}},t.__decorate([s.property()],e.default.prototype,"effectList",void 0),t.__decorate([s.property()],e.default.prototype,"legendElement",void 0),t.__decorate([s.property()],e.default.prototype,"messages",void 0),t.__decorate([s.property()],e.default.prototype,"opacity",void 0),e.default=t.__decorate([o.subclass("esri.widgets.Legend.styles.card.ColorRamp")],e.default),e.default})},"esri/widgets/Legend/styles/support/utils":function(){define(["exports","../../support/styleUtils"],function(e,t){"use strict";e.getLegendElementTitle=function(e,s){if(!e.title||"string"==typeof e.title)return e.title;const i="color-ramp"===e.type||"opacity-ramp"===e.type,r=e.title,n=t.getTitle(s,r,i);return t.isRendererTitle(r,i)&&r.title?`${r.title} (${n})`:n},e.getRampStopLabel=function(e,s,i){switch(s){case"heatmap-ramp":return i[e.label]||e.label;case"stretch-ramp":return t.getStretchStopLabel(e,i);default:return e.label}},e.isWidthAndHeight=function(e){return!(!e||"object"!=typeof e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/styleUtils":function(){define(["exports","../../../intl","../../../core/string","../../../intl/substitute","../../../intl/number"],function(e,t,s,i,r){"use strict";function n(e,t){return!t}e.attachToNode=function(e){e.appendChild(this)},e.getStretchStopLabel=function(e,t){return e.label?t[e.label]+": "+("string"==typeof e.value?e.value:r.formatNumber(e.value??0,{style:"decimal",notation:e.value?.toString().toLowerCase().includes("e")?"scientific":"standard"})):""},e.getTitle=function(e,t,r){if(!t)return;if("number"==typeof t)return t;if("string"==typeof t)return s.stripHTML(t);if("value"in t||"unit"in t)return i.substitute(e.dotValue,t);if("colorName"in t&&"bandName"in t)return e[t.colorName]+": "+(e[t.bandName]||t.bandName);if("showCount"in t)return t.showCount?e.clusterCountTitle:void 0;let o=null;return function(e,t){return t}(0,r)?o=t.ratioPercentTotal?"showRatioPercentTotal":t.ratioPercent?"showRatioPercent":t.ratio?"showRatio":t.normField?"showNormField":t.field?"showField":null:n(0,r)&&(o=t.normField?"showNormField":t.normByPct?"showNormPct":t.field?"showField":null),o?i.substitute("showField"===o?"{field}":e[o],{field:t.field,normField:t.normField}):void 0},e.isImageryStretchedLegend=function(e,t){return!!(t&&"Stretched"===t&&"version"in e&&"number"==typeof e.version&&e.version>=10.3&&"esri.layers.ImageryLayer"===e.declaredClass)},e.isRendererTitle=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/styles/card/SizeRamp":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/screenUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","../support/sizeRampUtils","../../support/styleUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f){"use strict";const d=window.devicePixelRatio;return e.default=class extends l{constructor(e,t){super(e,t),this.hasIndicators=!1,this.legendElement=null,this.opacity=1}render(){if("spike"===this.legendElement.theme)return f.tsx("div",{styles:{display:"flex",flex:"1",justifyContent:"center"}},h.renderSpikeRamp(this.legendElement));const{legendElement:e,hasIndicators:t,opacity:s}=this,i=e.infos,r=i.at(0),n=i.at(-1);if(!r||!n)return null;const{label:o,...a}=r,{label:l,...p}=n;let d=a.preview,m=p.preview;const y={"flex-direction":t?"column":"row-reverse"};if(!d||!m)return null;d=d.cloneNode(!0),d.style.display="flex",m=m.cloneNode(!0),m.style.display="flex";const g={opacity:`${s??""}`};return f.tsx("div",{class:this.classes(c.css.layerRow,{[c.css.sizeRampRow]:t})},f.tsx("div",{class:c.css.rampLabel},t?o:l),f.tsx("div",{class:c.css.sizeRampContainer,styles:y},f.tsx("div",{afterCreate:u.attachToNode,bind:d,class:c.css.sizeRampPreview,styles:g}),this._renderSizeRampLines(e),f.tsx("div",{afterCreate:u.attachToNode,bind:m,class:c.css.sizeRampPreview,styles:g})),f.tsx("div",{class:c.css.rampLabel},t?l:o))}_renderSizeRampLines(e){const t=e.infos,i=t.at(0),r=t.at(-1);if(!i||!r)return null;const n=i.symbol,o=this.hasIndicators,a=i.size&&"number"==typeof i.size?i.size:0,l=r.size&&"number"==typeof r.size?r.size:0,c=i.outlineSize||0,h=r.outlineSize||0,p=s.pt2px(a+c)*d,m=s.pt2px(l+h)*d,y=o?p:p+50*d,g=o?p/2+50*d:p,_=function(e){if(e){if(e.type.includes("3d")){if(!e.symbolLayers?.length)return;const t=e.symbolLayers.at(-1),s=t?.resource?.primitive;return"triangle"===s||"cone"===s||"tetrahedron"===s}return"triangle"===e.style}}(n),b=function(e){if(!e)return;if(e.type.includes("3d")){if(!e.symbolLayers?.length)return;const t=e.symbolLayers.at(-1),s=t.resource?.primitive;return"circle"===s||"cross"===s||"kite"===s||"sphere"===s||"cube"===s||"diamond"===s}const t=e.style;return"circle"===t||"diamond"===t||"cross"===t}(n),x=document.createElement("canvas");x.width=y,x.height=g,x.style.width=x.width/d+"px",x.style.height=x.height/d+"px";const S=x.getContext("2d");if(o){S.beginPath();const e=0,t=0,s=y/2-m/2,i=g;S.moveTo(e,t),S.lineTo(s,i);const r=y,n=0,o=y/2+m/2,a=g;S.moveTo(r,n),S.lineTo(o,a)}else{S.beginPath();const e=0,t=g/2-m/2,s=y,i=0;S.moveTo(e,t),S.lineTo(s,i);const r=0,n=g/2+m/2,o=y,a=g;S.moveTo(r,n),S.lineTo(o,a)}return S.strokeStyle="#ddd",S.stroke(),f.tsx("div",{afterCreate:u.attachToNode,bind:x,styles:o?{display:"flex",marginTop:`-${_?0:b?p/2:0}px`,marginBottom:`-${_?m:b?m/2:0}px`}:{display:"flex",marginRight:`-${_?0:b?p/2:0}px`,marginLeft:`-${_?0:b?m/2:0}px`}})}},t.__decorate([i.property()],e.default.prototype,"hasIndicators",void 0),t.__decorate([i.property()],e.default.prototype,"legendElement",void 0),t.__decorate([i.property()],e.default.prototype,"messages",void 0),t.__decorate([i.property()],e.default.prototype,"opacity",void 0),e.default=t.__decorate([a.subclass("esri.widgets.Legend.styles.card.SizeRamp")],e.default),e.default})},"esri/widgets/Legend/styles/support/sizeRampUtils":function(){define(["exports","../../../../core/screenUtils","./utils","../../support/styleUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n){"use strict";const o=window.devicePixelRatio,a="esri-spike-ramp",l={spikeRampContainer:`${a}__container`,spikeRampPreviewContainer:`${a}__preview-container`,spikeRampPreview:`${a}__preview`,spikeRampSymbolPreview:`${a}__symbol-preview`,spikeRampLines:`${a}__lines`,spikeRampLabelsContainer:`${a}__labels-container`,spikeRampLabel:`${a}__label`};function c(e){return e.infos.filter((e,t)=>t%2==0)}e.renderSpikeRamp=function(e){return 5!==e.infos.length?null:n.tsx("div",{class:l.spikeRampContainer},n.tsx("div",{class:l.spikeRampPreviewContainer},function(e){const[t,s,r]=c(e).map(({preview:e})=>{if(!e)return null;const t=e.cloneNode(!0);return t.classList.add(l.spikeRampSymbolPreview),t});return t&&s&&r?n.tsx("div",{class:l.spikeRampPreview},n.tsx("div",{afterCreate:i.attachToNode,bind:r}),n.tsx("div",{afterCreate:i.attachToNode,bind:s}),n.tsx("div",{afterCreate:i.attachToNode,bind:t})):null}(e),function(e){const[{width:r,height:a},{width:h},{width:u,height:p}]=c(e).map(({size:e})=>s.isWidthAndHeight(e)?{width:t.pt2px(e.width),height:t.pt2px(e.height)}:{width:0,height:0}),f=r+h+u+30,d=a,m=document.createElement("canvas");m.width=(f+10)*o,m.height=d*o,m.style.width=m.width/o+"px",m.style.height=m.height/o+"px";const y=m.getContext("2d");y.beginPath();const g=f-(r/2+10),_=f+8;y.moveTo(g*o,0*o),y.lineTo(_*o,0*o);const b=(f-8)/2,x=(a-p)/2,S=f+8,v=(a-p)/2;y.moveTo(b*o,x*o),y.lineTo(S*o,v*o);const w=u/2,C=d-p,M=f+8,P=d-p;return y.moveTo(w*o,C*o),y.lineTo(M*o,P*o),y.strokeStyle="#ddd",y.lineWidth=.5*o,y.stroke(),n.tsx("div",{afterCreate:i.attachToNode,bind:m,class:l.spikeRampLines})}(e)),function(e){const[{label:i,height:r},{label:o},{label:a,height:h}]=c(e).map(({label:e,size:i})=>({label:e,height:s.isWidthAndHeight(i)?t.pt2px(i.height):0})),u=r-h,p={position:"absolute",top:u/2+"px"},f={position:"absolute",top:`${u}px`};return n.tsx("div",{class:l.spikeRampLabelsContainer},n.tsx("div",{class:l.spikeRampLabel,styles:{position:"absolute",top:"0"}},i),n.tsx("div",{class:l.spikeRampLabel,styles:p},o),n.tsx("div",{class:l.spikeRampLabel,styles:f},a))}(e))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/styles/card/UnivariateAboveAndBelowRamp":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","../support/univariateUtils","../../support/styleUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p){"use strict";return e.default=class extends a{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:t,effectList:s,key:i}=this,{sizeRampElement:r,colorRampElement:n}=c.getUnivariateAboveAndBelowRampElements(e,t,"horizontal");if(!r)return null;const o=c.getUnivariateSizeRampSize(r,"full",!0,"horizontal"),a=c.getUnivariateColorRampSize(r,"above",!0,"horizontal"),f=c.getUnivariateColorRampSize(r,"below",!0,"horizontal"),d=this.messages?.previewColorRampAriaLabel,m=c.getUnivariateColorRampPreview(n,{width:a,height:12,rampAlignment:"horizontal",opacity:t,type:"above",effectList:s,ariaLabel:d}),y=c.getUnivariateColorRampPreview(n,{width:f,height:12,rampAlignment:"horizontal",opacity:t,type:"below",effectList:s,ariaLabel:d}),g=c.getUnivariateColorRampMargin(r,"card"),_=r.infos.map(e=>e.label),b=_.length-1,x=_.map((e,t)=>0===t||t===b?p.tsx("div",{key:t},e):null),S={marginTop:"3px",display:"flex"};u.isRTL(this.container)?S.marginRight=`${g}px`:S.marginLeft=`${g}px`;const v={width:`${o}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return p.tsx("div",{class:l.css.layerRow,key:`${i}-container`,styles:{display:"flex",flexDirection:"column"}},p.tsx("div",{class:this.classes(l.css.symbolContainer,l.css.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},r.infos.map((e,t)=>p.tsx("div",{afterCreate:h.attachToNode,bind:e.preview,class:l.css.symbol,key:t}))),m?p.tsx("div",{class:l.css.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:S},p.tsx("div",{afterCreate:h.attachToNode,bind:m}),p.tsx("div",{afterCreate:h.attachToNode,bind:y})):null,p.tsx("div",{class:l.css.layerInfo},p.tsx("div",{class:l.css.rampLabelsContainer,styles:v},x)))}},t.__decorate([s.property()],e.default.prototype,"effectList",void 0),t.__decorate([s.property()],e.default.prototype,"legendElement",void 0),t.__decorate([s.property()],e.default.prototype,"messages",void 0),t.__decorate([s.property()],e.default.prototype,"opacity",void 0),e.default=t.__decorate([o.subclass("esri.widgets.Legend.styles.card.UnivariateAboveAndBelowRamp")],e.default),e.default})},"esri/widgets/Legend/styles/support/univariateUtils":function(){define(["exports","../../../../core/screenUtils","../../../../libs/maquette/projection","../../../../libs/maquette/projector","../../../../support/guards","../../../../symbols/support/symbolUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a){"use strict";const l=i.createProjector(),c="esri-univariate-above-and-below-ramp__symbol";function h(e="vertical"){const t="stroke:rgb(200, 200, 200);stroke-width:1";return"vertical"===e?a.tsx("svg",{height:"4",width:"10"},a.tsx("line",{style:t,x1:"0",x2:"10",y1:"2",y2:"2"})):a.tsx("svg",{height:"10",width:"10"},a.tsx("line",{style:t,x1:"5",x2:"5",y1:"0",y2:"10"}))}function u(e,t="vertical"){const s=document.createElement("div");return s.style.height="20px",s.className=c,null!=e&&(s.style.opacity=e.toString()),l.append(s,h.bind(null,t)),s}function p(e,s,i="vertical",n){e.infos.forEach((e,o)=>{if(n&&2===o)e.preview=u(s,i);else{const s=(r.isNumber(e.size)?t.pt2px(e.size):0)+("horizontal"===i?20:10),n=e.preview,o="div"===n?.tagName.toLowerCase(),a=o?n:document.createElement("div");a.className=c,"horizontal"===i?a.style.width=`${s}px`:a.style.height=`${s}px`,!o&&n&&a.appendChild(n),e.preview=a}})}function f(e,s,i,n="vertical"){let o=0;const a=e.infos,l=Math.floor(a.length/2),c="full"===s||"above"===s?0:l,h="full"===s||"below"===s?a.length-1:l;for(let e=c;e<=h;e++)if(i&&e===l)o+="horizontal"===n?10:20;else{const s=a[e].size;o+=(r.isNumber(s)?t.pt2px(s):0)+("horizontal"===n?20:10)}return Math.round(o)}e.getUnivariateAboveAndBelowRampElements=function(e,t,s="vertical"){const i=e.infos;let r=i.find(({type:e})=>"size-ramp"===e),n=i.find(({type:e})=>"color-ramp"===e);return r&&(r={...r},r.infos=[...r.infos],p(r,t,s,!0)),n&&(n={...n},n.infos=[...n.infos]),"horizontal"===s&&(r?.infos.reverse(),n?.infos.reverse()),{sizeRampElement:r,colorRampElement:n}},e.getUnivariateColorRampMargin=function(e,s="classic"){const i=e.infos,n=i.at(0),o=i.at(-1),a=r.isNumber(n.size)?t.pt2px(n.size):0,l=r.isNumber(o.size)?t.pt2px(o.size):0;return"classic"===s?(a+10)/2:(a-l)/2},e.getUnivariateColorRampPreview=function(e,t){if(!e)return null;const s=e.infos.map(e=>e.color),i=n.renderColorRampPreviewHTML("full"===t.type?s:"above"===t.type?s.slice(0,3):s.slice(2,5),{width:t.width,height:t.height,align:t.rampAlignment,effectList:t.effectList,ariaLabel:t.ariaLabel});return i.className="esri-legend__color-ramp",null!=t.opacity&&(i.style.opacity=t.opacity.toString()),i},e.getUnivariateColorRampSize=function(e,s,i,n="vertical"){const o=f(e,s,i,n),a=e.infos,l=Math.floor(a.length/2),c="full"===s||"above"===s?0:l,h="full"===s||"below"===s?a.length-1:l,u=r.isNumber(a[c].size)?a[c].size:0,p=r.isNumber(a[h].size)?a[h].size:0,d="full"===s?u+p:"above"===s?u:p,m=i?"vertical"===n?20:10:0,y="vertical"===n?10*("full"===s?2:1):20*("full"===s?2:1);return Math.round(o-(t.pt2px(d)/2+m/2+y/2))},e.getUnivariateColorSizeRampElements=function(e,t="vertical"){const s=e.infos;let i=s.find(({type:e})=>"size-ramp"===e),r=s.find(({type:e})=>"color-ramp"===e);return i&&(i={...i},i.infos=[...i.infos],p(i,null,t,!1)),r&&(r={...r},r.infos=[...r.infos]),"horizontal"===t&&(i?.infos.reverse(),r?.infos.reverse()),{sizeRampElement:i,colorRampElement:r}},e.getUnivariateSizeRampSize=f,e.univariateColorRampContainerStyles={marginLeft:"3px"},e.univariateColorRampStyles={display:"table-cell",verticalAlign:"middle"},e.univariateRampContainerStyles={display:"flex",alignItems:"flex-start"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/styles/card/UnivariateColorSizeRamp":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","../support/univariateUtils","../../support/styleUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p){"use strict";return e.default=class extends a{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:t,effectList:s,key:i}=this,{sizeRampElement:r,colorRampElement:n}=c.getUnivariateColorSizeRampElements(e,"horizontal");if(!r)return null;const o=c.getUnivariateSizeRampSize(r,"full",!1,"horizontal"),a=c.getUnivariateColorRampSize(r,"full",!1,"horizontal"),f=c.getUnivariateColorRampPreview(n,{width:a,height:12,rampAlignment:"horizontal",opacity:t,type:"full",effectList:s,ariaLabel:this.messages?.previewColorRampAriaLabel}),d=c.getUnivariateColorRampMargin(r,"card"),m=r.infos.length-1,y=r.infos.map((e,t)=>0===t||t===m?p.tsx("div",{key:t},e.label):null),g={marginTop:"3px",display:"flex"};u.isRTL(this.container)?g.marginRight=`${d}px`:g.marginLeft=`${d}px`;const _={width:`${o}px`,display:"flex",flexDirection:"row",justifyContent:"space-between"};return p.tsx("div",{class:l.css.layerRow,key:`${i}-container`,styles:{display:"flex",flexDirection:"column"}},p.tsx("div",{class:this.classes(l.css.symbolContainer,l.css.sizeRampHorizontal),styles:{display:"flex",flexDirection:"row"}},r.infos.map((e,t)=>p.tsx("div",{afterCreate:h.attachToNode,bind:e.preview,class:l.css.symbol,key:t}))),p.tsx("div",{class:l.css.univariateAboveAndBelowColorRamp,key:"color-ramp-preview",styles:g},p.tsx("div",{afterCreate:h.attachToNode,bind:f})),p.tsx("div",{class:l.css.layerInfo},p.tsx("div",{class:l.css.rampLabelsContainer,styles:_},y)))}},t.__decorate([s.property()],e.default.prototype,"effectList",void 0),t.__decorate([s.property()],e.default.prototype,"legendElement",void 0),t.__decorate([s.property()],e.default.prototype,"messages",void 0),t.__decorate([s.property()],e.default.prototype,"opacity",void 0),e.default=t.__decorate([o.subclass("esri.widgets.Legend.styles.card.UnivariateColorSizeRamp")],e.default),e.default})},"esri/widgets/support/Heading":function(){define(["exports","../../core/mathUtils","./globalCss","./widgetUtils","./jsxFactory"],function(e,t,s,i,r){"use strict";function n(e){return t.clamp(Math.ceil(e),1,6)}e.Heading=function({level:e,class:t,...o},a){const l=n(e),c=`h${l}`;return r.tsx(c,{...o,"aria-level":String(l),class:i.classes(s.globalCss.heading,t),role:"heading"},a)},e.incrementHeadingLevel=function(e,t=1){return n(e+t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/globalCss":function(){define(["exports"],function(e){"use strict";e.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",primaryTickLabelKeepAll:"primary-tick__label--keep-all",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/styles/classic/ClassicView":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","./LegendElement","../../../support/globalCss","../../../support/Heading","../../../support/widgetUtils","../../../support/decorators/messageBundle","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d){"use strict";const m=`${l.legend}__`;return e.default=class extends a{constructor(e,t){super(e,t),this.activeLayerInfos=null,this.headingLevel=3,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,t=e?.toArray().map(e=>this._renderLegendForLayer(e)).filter(Boolean);return t?.length?d.tsx("section",null,t):d.tsx("div",{class:l.css.message,key:"no-legend"},this.messages.noLegend)}_renderLegendForLayer(e,t){if(!e.ready)return null;const s=`${e.layer.uid}-version-${e.version}`,i=`${m}${t?`${t}-`:""}${s}`,r=e.title?u.Heading({level:this.headingLevel,class:this.classes(h.globalCss.heading,l.css.label)},e.title):null;if(e.children.length){const t=e.children.toArray().map(e=>this._renderLegendForLayer(e,s));return d.tsx("section",{class:this.classes(l.css.service,l.css.groupLayer),key:i},r,t)}return this._renderLegendElementsForLayer(e,r,i)}_renderLegendElementsForLayer(e,t,s){const i=e.legendElements?.filter(Boolean);if(!i?.length)return null;const r=i.map(t=>d.tsx(c,{effectList:e.effectList,isChild:!1,key:`${s}-${t.type}`,layer:e.layer,legendElement:t,messages:this.messages})),n={[l.css.groupLayerChild]:!!e.parent};return d.tsx("section",{class:this.classes(l.css.service,n),key:s},t,d.tsx("div",{class:l.css.layer},r))}},t.__decorate([s.property()],e.default.prototype,"activeLayerInfos",void 0),t.__decorate([s.property()],e.default.prototype,"headingLevel",void 0),t.__decorate([s.property(),f.messageBundle("esri/widgets/Legend/t9n/Legend")],e.default.prototype,"messages",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([o.subclass("esri.widgets.Legend.styles.classic.ClassicView")],e.default),e.default})},"esri/widgets/Legend/styles/classic/css":function(){define(["exports"],function(e){"use strict";const t="esri-legend",s={service:`${t}__service`,label:`${t}__service-label`,layer:`${t}__layer`,groupLayer:`${t}__group-layer`,groupLayerChild:`${t}__group-layer-child`,layerTable:`${t}__layer-table`,layerTableSizeRamp:`${t}__layer-table--size-ramp`,layerChildTable:`${t}__layer-child-table`,layerCaption:`${t}__layer-caption`,layerBody:`${t}__layer-body`,layerRow:`${t}__layer-row`,layerCell:`${t}__layer-cell`,layerInfo:`${t}__layer-cell ${t}__layer-cell--info`,imageryLayerStretchedImage:`${t}__imagery-layer-image--stretched`,imageryLayerCellStretched:`${t}__imagery-layer-cell--stretched`,imageryLayerInfoStretched:`${t}__imagery-layer-info--stretched`,symbolContainer:`${t}__layer-cell ${t}__layer-cell--symbols`,symbol:`${t}__symbol`,rampContainer:`${t}__ramps`,sizeRamp:`${t}__size-ramp`,colorRamp:`${t}__color-ramp`,opacityRamp:`${t}__opacity-ramp`,borderlessRamp:`${t}__borderless-ramp`,rampTick:`${t}__ramp-tick`,rampFirstTick:`${t}__ramp-tick-first`,rampLastTick:`${t}__ramp-tick-last`,rampLabelsContainer:`${t}__ramp-labels`,rampLabel:`${t}__ramp-label`,message:`${t}__message`,univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label"};e.css=s,e.legend=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/styles/classic/LegendElement":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./ColorRamp","./css","./SizeRamp","./UnivariateAboveAndBelowRamp","./UnivariateColorSizeRamp","../support/relationshipUtils","../support/utils","../../support/styleUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d,m,y,g){"use strict";var _;return e.default=_=class extends a{constructor(e,t){super(e,t),this.effectList=null,this.isChild=!1,this.legendElement=null}render(){const e=this._renderLegendElement(),t=d.getLegendElementTitle(this.legendElement,this.messages),s=this.isChild?c.css.layerChildTable:c.css.layerTable,i=t?g.tsx("div",{class:c.css.layerCaption},t):null,r={[c.css.layerTableSizeRamp]:"size-ramp"===this.legendElement.type||!this.isChild};return g.tsx("section",{class:this.classes(s,r),key:`${this.key}-table`},i,e)}_renderLegendElement(){switch(this.legendElement.type){case"symbol-table":return this._renderSymbolTable(this.legendElement);case"size-ramp":return g.tsx(h,{key:this.key,legendElement:this.legendElement,messages:this.messages});case"color-ramp":case"opacity-ramp":case"heatmap-ramp":case"stretch-ramp":return g.tsx(l,{key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"relationship-ramp":return f.renderRelationshipRamp(this.legendElement,this.id,{opacity:this.layer.opacity,effectList:this.effectList,ariaLabel:this.messages.previewRelationshipRampAriaLabel,key:this.key});case"pie-chart-ramp":return g.tsx("div",{afterCreate:m.attachToNode,bind:this.legendElement.preview,key:`${this.key}-preview`});case"univariate-above-and-below-ramp":return g.tsx(u,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});case"univariate-color-size-ramp":return g.tsx(p,{effectList:this.effectList,key:this.key,legendElement:this.legendElement,messages:this.messages,opacity:this.layer.opacity});default:return null}}_renderSymbolTable(e){const t=e.infos.map(t=>this._renderElementInfo(t,e.legendType)).filter(Boolean);return t.length?g.tsx("div",{class:c.css.layerBody},t):null}_renderElementInfo(e,t){const{layer:s}=this,i="label"in e?e.label:null,r=`${this.key}-${i}`;if("type"in e&&e.type)return g.tsx(_,{effectList:this.effectList,isChild:!0,key:r,layer:s,legendElement:e,messages:this.messages});if(!("preview"in e&&e.preview||"src"in e&&e.src))return null;const n=m.isImageryStretchedLegend(s,t),o={[c.css.imageryLayerInfoStretched]:n},a={[c.css.imageryLayerInfoStretched]:n};return g.tsx("div",{class:c.css.layerRow,key:`${r}-row`},g.tsx("div",{class:this.classes(c.css.symbolContainer,a)},this._renderPreview(e,n)),g.tsx("div",{class:this.classes(c.css.layerInfo,o)},m.getTitle(this.messages,i,!1)||""))}_renderPreview(e,t){const{layer:s}=this;return"preview"in e&&e.preview?g.tsx("div",{afterCreate:m.attachToNode,bind:e.preview,class:c.css.symbol}):"src"in e&&e.src?this._renderImage(e,s,t):null}_renderImage(e,t,s){const{label:i,src:r,opacity:n}=e,o={[c.css.imageryLayerStretchedImage]:s,[c.css.symbol]:!s},a={opacity:`${n??t.opacity}`},l=m.getTitle(this.messages,i,!1);return g.tsx("img",{alt:l,"aria-label":l,border:0,class:this.classes(o),height:e.height,src:r,styles:a,width:e.width})}},t.__decorate([s.property()],e.default.prototype,"effectList",void 0),t.__decorate([s.property()],e.default.prototype,"isChild",void 0),t.__decorate([s.property()],e.default.prototype,"layer",void 0),t.__decorate([s.property()],e.default.prototype,"legendElement",void 0),t.__decorate([s.property()],e.default.prototype,"messages",void 0),e.default=_=t.__decorate([o.subclass("esri.widgets.Legend.styles.classic.LegendElement")],e.default),e.default})},"esri/widgets/Legend/styles/classic/ColorRamp":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","../support/utils","../../support/styleUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p){"use strict";return e.default=class extends a{constructor(e,t){super(e,t),this.legendElement=null,this.opacity=1}get _preview(){const e=this.legendElement.preview;if(!e)return null;const t="opacity-ramp"===this.legendElement.type?l.css.opacityRamp:"";return e.className=`${l.css.colorRamp} ${t}`,null!=this.opacity&&(e.style.opacity=this.opacity.toString()),e}render(){const{legendElement:e,_preview:t}=this;if(!t)return null;const s={height:t.style.height};return p.tsx("div",{class:l.css.layerRow,key:`${this.key}-row`},p.tsx("div",{class:l.css.symbolContainer,styles:{width:"24px"}},p.tsx("div",{afterCreate:h.attachToNode,bind:t,class:l.css.rampContainer})),p.tsx("div",{class:l.css.layerInfo},p.tsx("div",{class:l.css.rampLabelsContainer,styles:s},e.infos.map((t,s)=>this._renderRampLabel(t,s,e.type)))))}_renderRampLabel(e,t,s){return p.tsx("div",{class:e.label?l.css.rampLabel:void 0,key:`${this.key}-stop-${e.label??t}-label`},c.getRampStopLabel(e,s,this.messages))}},t.__decorate([s.property()],e.default.prototype,"_preview",null),t.__decorate([s.property()],e.default.prototype,"legendElement",void 0),t.__decorate([s.property()],e.default.prototype,"messages",void 0),t.__decorate([s.property()],e.default.prototype,"opacity",void 0),e.default=t.__decorate([o.subclass("esri.widgets.Legend.styles.classic.ColorRamp")],e.default),e.default})},"esri/widgets/Legend/styles/classic/SizeRamp":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","../support/sizeRampUtils","../../support/styleUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p){"use strict";return e.default=class extends a{constructor(e,t){super(e,t),this.legendElement=null}render(){const e=this.legendElement.infos.map(e=>this._renderRow(e)).filter(Boolean);return e.length?"spike"===this.legendElement.theme?c.renderSpikeRamp(this.legendElement):p.tsx("div",{class:l.css.layerBody},e):null}_renderRow(e){return e.preview?p.tsx("div",{class:l.css.layerRow,key:`${this.key}-${e.label}-row`},p.tsx("div",{class:this.classes(l.css.symbolContainer,l.css.sizeRamp)},p.tsx("div",{afterCreate:h.attachToNode,bind:e.preview,class:l.css.symbol})),p.tsx("div",{class:l.css.layerInfo},h.getTitle(this.messages,e.label,!1)||"")):null}},t.__decorate([s.property()],e.default.prototype,"legendElement",void 0),t.__decorate([s.property()],e.default.prototype,"messages",void 0),e.default=t.__decorate([o.subclass("esri.widgets.Legend.styles.classic.SizeRamp")],e.default),e.default})},"esri/widgets/Legend/styles/classic/UnivariateAboveAndBelowRamp":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","../support/univariateUtils","../../support/styleUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p){"use strict";return e.default=class extends a{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:t,effectList:s,key:i}=this,{sizeRampElement:r,colorRampElement:n}=c.getUnivariateAboveAndBelowRampElements(e,t);if(!r)return null;const o=this.messages.previewColorRampAriaLabel,a=c.getUnivariateColorRampSize(r,"above",!0),u=c.getUnivariateColorRampSize(r,"below",!0),f=c.getUnivariateColorRampPreview(n,{width:12,height:a,rampAlignment:"vertical",opacity:t,type:"above",effectList:s,ariaLabel:o}),d=c.getUnivariateColorRampPreview(n,{width:12,height:u,rampAlignment:"vertical",opacity:t,type:"below",effectList:s,ariaLabel:o}),m=c.getUnivariateColorRampMargin(r),y=r.infos.map(e=>e.label),g=y.map((e,t)=>{const s=2===t;return 0===t?p.tsx("div",{class:e?f?l.css.univariateAboveAndBelowLabel:l.css.rampLabel:void 0,key:`${i}-color-ramp-above-label-${e??t}`},e):s?p.tsx("div",null):null}),_=y.length-1,b=Math.floor(y.length/2),x=y.map((e,t)=>t===b||t===_?p.tsx("div",{class:e?f?l.css.univariateAboveAndBelowLabel:l.css.rampLabel:void 0,key:`${i}-color-ramp-below-label-${e??t}`},e):null),S={display:"table-cell",verticalAlign:"middle"},v={marginTop:`${m}px`},w={height:`${a}px`},C={height:`${u}px`};return p.tsx("div",{key:`${i}-container`,styles:c.univariateRampContainerStyles},p.tsx("div",{class:l.css.layerBody},r.infos.map((e,t)=>p.tsx("div",{class:this.classes(l.css.layerRow,l.css.sizeRamp),key:`${i}-row-${t}`},p.tsx("div",{afterCreate:h.attachToNode,bind:e.preview,class:l.css.symbol,styles:S}),f||t%2!=0?null:p.tsx("div",{class:l.css.layerInfo},y[t])))),f?p.tsx("div",{styles:v},p.tsx("div",{styles:c.univariateColorRampContainerStyles},p.tsx("div",{styles:c.univariateColorRampStyles},p.tsx("div",{afterCreate:h.attachToNode,bind:f,class:l.css.rampContainer})),p.tsx("div",{styles:c.univariateColorRampStyles},p.tsx("div",{class:l.css.rampLabelsContainer,styles:w},g))),p.tsx("div",{styles:c.univariateColorRampContainerStyles},p.tsx("div",{styles:c.univariateColorRampStyles},p.tsx("div",{afterCreate:h.attachToNode,bind:d,class:l.css.rampContainer})),p.tsx("div",{styles:c.univariateColorRampStyles},p.tsx("div",{class:l.css.rampLabelsContainer,styles:C},x)))):null)}},t.__decorate([s.property()],e.default.prototype,"effectList",void 0),t.__decorate([s.property()],e.default.prototype,"legendElement",void 0),t.__decorate([s.property()],e.default.prototype,"messages",void 0),t.__decorate([s.property()],e.default.prototype,"opacity",void 0),e.default=t.__decorate([o.subclass("esri.widgets.Legend.styles.classic.UnivariateAboveAndBelowRamp")],e.default),e.default})},"esri/widgets/Legend/styles/classic/UnivariateColorSizeRamp":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./css","../support/univariateUtils","../../support/styleUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p){"use strict";return e.default=class extends a{constructor(e,t){super(e,t),this.effectList=null,this.legendElement=null,this.opacity=1}render(){const{legendElement:e,opacity:t,effectList:s,key:i}=this,{sizeRampElement:r,colorRampElement:n}=c.getUnivariateColorSizeRampElements(e);if(!r)return null;const o=c.getUnivariateColorRampMargin(r),a=c.getUnivariateColorRampSize(r,"full",!1),u=c.getUnivariateColorRampPreview(n,{width:12,height:a,rampAlignment:"vertical",opacity:t,type:"full",effectList:s,ariaLabel:this.messages?.previewColorRampAriaLabel}),f=r.infos.length-1,d=r.infos.map((e,t)=>0===t||t===f?p.tsx("div",{class:e.label?n?l.css.univariateAboveAndBelowLabel:l.css.rampLabel:void 0,key:`${i}-color-ramp-label-${e.label??t}`},e.label):null),m={display:"table-cell",verticalAlign:"middle"},y={marginTop:`${o}px`},g={height:`${a}px`};return p.tsx("div",{key:`${i}-container`,styles:c.univariateRampContainerStyles},p.tsx("div",{class:l.css.layerBody},r.infos.map((e,t)=>p.tsx("div",{class:this.classes(l.css.layerRow,l.css.sizeRamp),key:`${i}-row-${t}`},p.tsx("div",{afterCreate:h.attachToNode,bind:e.preview,class:l.css.symbol,styles:m})))),p.tsx("div",{styles:y},p.tsx("div",{styles:c.univariateColorRampContainerStyles},p.tsx("div",{styles:c.univariateColorRampStyles},p.tsx("div",{afterCreate:h.attachToNode,bind:u,class:l.css.rampContainer})),p.tsx("div",{styles:c.univariateColorRampStyles},p.tsx("div",{class:l.css.rampLabelsContainer,styles:g},d)))))}},t.__decorate([s.property()],e.default.prototype,"effectList",void 0),t.__decorate([s.property()],e.default.prototype,"legendElement",void 0),t.__decorate([s.property()],e.default.prototype,"messages",void 0),t.__decorate([s.property()],e.default.prototype,"opacity",void 0),e.default=t.__decorate([o.subclass("esri.widgets.Legend.styles.classic.UnivariateColorSizeRamp")],e.default),e.default})},"*noref":1}}),define(["../chunks/tslib.es6","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Widget","./Legend/LegendViewModel","./Legend/styles/card/CardView","./Legend/styles/classic/ClassicView","./support/globalCss","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory"],function(e,t,s,i,r,n,o,a,l,c,h,u,p,f,d){"use strict";let m=class extends a{constructor(e,t){super(e,t),this.headingLevel=3,this.messages=null,this.viewModel=new l,this.style=new h}initialize(){this.addHandles([t.on(()=>this.view,"resize",()=>this.scheduleRender()),t.on(()=>this.activeLayerInfos,"change",()=>this._refreshActiveLayerInfos(this.activeLayerInfos)),t.watch(()=>this.headingLevel,e=>{const{style:t}=this;t&&(t.headingLevel=e)}),t.watch(()=>this.style,(e,t)=>{t&&e!==t&&t.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view),e.headingLevel=this.headingLevel)},t.initial)])}destroy(){this.style?.destroy()}get activeLayerInfos(){return this.viewModel.activeLayerInfos}set activeLayerInfos(e){this.viewModel.activeLayerInfos=e}get basemapLegendVisible(){return this.viewModel.basemapLegendVisible}set basemapLegendVisible(e){this.viewModel.basemapLegendVisible=e}get groundLegendVisible(){return this.viewModel.groundLegendVisible}set groundLegendVisible(e){this.viewModel.groundLegendVisible=e}get hideLayersNotInCurrentView(){return this.viewModel.hideLayersNotInCurrentView}set hideLayersNotInCurrentView(e){this.viewModel.hideLayersNotInCurrentView=e}get keepCacheOnDestroy(){return this.viewModel.keepCacheOnDestroy}set keepCacheOnDestroy(e){this.viewModel.keepCacheOnDestroy=e}get respectLayerDefinitionExpression(){return this.viewModel.respectLayerDefinitionExpression}set respectLayerDefinitionExpression(e){this.viewModel.respectLayerDefinitionExpression=e}get respectLayerVisibility(){return this.viewModel.respectLayerVisibility}set respectLayerVisibility(e){this.viewModel.respectLayerVisibility=e}get icon(){return"legend"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layerInfos(){return this.viewModel.layerInfos}set layerInfos(e){this.viewModel.layerInfos=e}set style(e){const t=this._get("style");e!==t&&t?.destroy(),this._set("style",e)}castStyle(e){if(e instanceof c||e instanceof h)return e;if("string"==typeof e)return"card"===e?new c:new h;if(e&&"string"==typeof e.type){const t={...e};return delete t.type,"card"===e.type?new c(t):new h(t)}return new h}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}render(){return d.tsx("div",{class:this.classes("esri-legend",u.globalCss.widget,this.style instanceof h?u.globalCss.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){e.forEach(e=>{this.removeHandles(`version_${e.layer.uid}`),this._renderOnActiveLayerInfoChange(e)}),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const s=t.watch(()=>e.version,()=>this.scheduleRender());this.addHandles(s,`version_${e.layer.uid}`);const i=t.on(()=>e.children,"change",()=>e.children.forEach(e=>this._renderOnActiveLayerInfoChange(e)),t.initial);this.addHandles(i,`version_${e.layer.uid}`),e.children.forEach(e=>this._renderOnActiveLayerInfoChange(e))}};return e.__decorate([s.property()],m.prototype,"activeLayerInfos",null),e.__decorate([s.property()],m.prototype,"basemapLegendVisible",null),e.__decorate([s.property()],m.prototype,"groundLegendVisible",null),e.__decorate([s.property()],m.prototype,"headingLevel",void 0),e.__decorate([s.property()],m.prototype,"hideLayersNotInCurrentView",null),e.__decorate([s.property()],m.prototype,"keepCacheOnDestroy",null),e.__decorate([s.property()],m.prototype,"respectLayerDefinitionExpression",null),e.__decorate([s.property()],m.prototype,"respectLayerVisibility",null),e.__decorate([s.property()],m.prototype,"icon",null),e.__decorate([s.property()],m.prototype,"label",null),e.__decorate([s.property()],m.prototype,"layerInfos",null),e.__decorate([s.property(),f.messageBundle("esri/widgets/Legend/t9n/Legend")],m.prototype,"messages",void 0),e.__decorate([s.property()],m.prototype,"style",null),e.__decorate([i.cast("style")],m.prototype,"castStyle",null),e.__decorate([s.property()],m.prototype,"view",null),e.__decorate([s.property()],m.prototype,"viewModel",void 0),m=e.__decorate([o.subclass("esri.widgets.Legend")],m),m});