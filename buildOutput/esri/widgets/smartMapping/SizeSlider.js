// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../chunks/tslib.es6","../../Color","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../renderers/support/authoringInfoUtils","../../renderers/visualVariables/SizeVariable","../../renderers/visualVariables/support/SizeStop","./SmartMappingSliderBase","./SizeSlider/SizeSliderViewModel","./support/utils","../support/globalCss","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory"],function(e,t,s,r,a,i,o,l,n,d,p,m,u,c,h,g,v){"use strict";var b;const y="esri-size-slider",S={base:y,rampElement:`${y}__ramp`,sliderContainer:`${y}__slider-container`,histogramContainer:`${y}__histogram-container`,primaryHandle:`${y}--primary-handle`,track:`${y}--interactive-track`},z={trackFillColor:new t([149,149,149]),trackBackgroundColor:new t([224,224,224])};let _=b=class extends p{constructor(e,t){super(e,t),this._maxRampFillWidth=1,this._minRampFillWidth=.2,this._rampNode=null,this.messages=null,this.style={...z},this.viewModel=new m}get handlesSyncedToPrimary(){return this.viewModel.handlesSyncedToPrimary}set handlesSyncedToPrimary(e){this.viewModel.handlesSyncedToPrimary=e}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get persistSizeRangeEnabled(){return this.viewModel.persistSizeRangeEnabled}set persistSizeRangeEnabled(e){this.viewModel.persistSizeRangeEnabled=e}get primaryHandleEnabled(){return this.viewModel.primaryHandleEnabled}set primaryHandleEnabled(e){this.viewModel.primaryHandleEnabled=e}get stops(){return this.viewModel.stops}set stops(e){this.viewModel.stops=e}castStyle(e){return{...z,...e}}static fromRendererResult(e,t){const{visualVariables:s,statistics:r}=e,{avg:a,stddev:i}=r,o=s[0],[n,p]=u.getSizesFromVariable(o),[m,c]=l.authoringInfoFirstVariableSliderMinMax(e.renderer.authoringInfo);return new b({max:c,min:m,stops:[new d({value:o.minDataValue??void 0,size:p}),new d({value:o.maxDataValue??void 0,size:n})],histogramConfig:{average:a??void 0,standardDeviation:i??void 0,bins:t?t.bins:[]}})}updateFromRendererResult(e,t){const{visualVariables:s,statistics:r}=e,{avg:a,stddev:i}=r,o=s[0],[n,d]=u.getSizesFromVariable(o),[p,m]=l.authoringInfoFirstVariableSliderMinMax(e.renderer.authoringInfo);this.set({max:m,min:p,stops:[{value:o.minDataValue,size:d},{value:o.maxDataValue,size:n}],histogramConfig:{average:a,standardDeviation:i,bins:t?t.bins:[]}})}updateVisualVariable(e){const t=e.clone(),{stops:s}=this;if(!e||!s)return null;if(t.stops)return t.stops=s,t;const r=s[0],a=s[s.length-1];let i=t.maxSize,o=t.minSize;if(i instanceof n){const e=i.stops,t=a.size/e[0].size,s=e.map(e=>(e.size*=t,e));i.stops=s}else i=a.size;if(o instanceof n){const e=o.stops,t=r.size/e[0].size,s=e.map(e=>(e.size*=t,e));o.stops=s}else o=r.size;return t.set({maxDataValue:a.value,minDataValue:r.value,maxSize:i,minSize:o}),t}updateFromVisualVariable(e){if(!e)return;const{maxDataValue:t,minDataValue:s,stops:r}=e;if(r)this.stops=r;else{const[r,a]=u.getSizesFromVariable(e);this.stops=[new d({value:s??void 0,size:a}),new d({value:t??void 0,size:r})]}}render(){const{label:e,primaryHandleEnabled:t,state:s,visibleElements:r}=this,a="disabled"===s,i=this.classes(S.base,c.globalCss.widget,c.globalCss.panel,{[c.globalCss.disabled]:a,[S.primaryHandle]:t,[S.track]:!!r.interactiveTrack});return v.tsx("div",{"aria-label":e,class:i},a?null:this.renderContent(this._renderRamp(),S.sliderContainer,S.histogramContainer))}_renderRamp(){const{style:{trackBackgroundColor:e},zoomOptions:t}=this;return v.tsx("div",{afterCreate:h.storeNode,bind:this,class:S.rampElement,"data-node-ref":"_rampNode"},v.tsx("svg",{key:"ramp-svg",xmlns:"http://www.w3.org/2000/svg"},v.tsx("rect",{fill:u.getFillFromColor(e),height:"100%",width:"100%",x:"0",y:"0"}),this._renderPath()),t?this.renderZoomCaps():null)}_renderPath(){if(!this._rampNode)return;const{offsetHeight:e=0,offsetWidth:t=0}=this._rampNode;if(null==e||null==t)return;const{primaryHandleEnabled:s,stops:r,style:{trackFillColor:a},values:i,viewModel:{max:o,min:l},_maxRampFillWidth:n,_minRampFillWidth:d}=this,p=[n,d];r[0].size<r[r.length-1].size&&p.reverse();const m=i.slice().sort((e,t)=>e>t?1:-1),[c,h]=p,[g,b]=m,y=s?u.getDynamicPathForSizeStops({max:o,min:l,pathHeight:e,pathWidth:t,stops:r,padding:h}):u.getPathForSizeStops({bottomValue:g,bottomWidth:c,max:o,min:l,pathHeight:e,pathWidth:t,topValue:b,topWidth:h});return v.tsx("path",{d:y,fill:u.getFillFromColor(a)})}};return e.__decorate([s.property()],_.prototype,"handlesSyncedToPrimary",null),e.__decorate([s.property()],_.prototype,"label",null),e.__decorate([s.property(),g.messageBundle("esri/widgets/smartMapping/SizeSlider/t9n/SizeSlider")],_.prototype,"messages",void 0),e.__decorate([s.property()],_.prototype,"persistSizeRangeEnabled",null),e.__decorate([s.property()],_.prototype,"primaryHandleEnabled",null),e.__decorate([s.property()],_.prototype,"stops",null),e.__decorate([s.property()],_.prototype,"style",void 0),e.__decorate([r.cast("style")],_.prototype,"castStyle",null),e.__decorate([s.property({type:m})],_.prototype,"viewModel",void 0),_=b=e.__decorate([o.subclass("esri.widgets.smartMapping.SizeSlider")],_),_});