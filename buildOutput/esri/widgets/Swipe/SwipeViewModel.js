// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../chunks/tslib.es6","../../core/Accessor","../../core/Collection","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../views/layers/support/ClipRect"],function(i,t,e,r,s,o,a,l,n,p){"use strict";const c={left:0,right:0,top:0,bottom:0};let y=class extends t{constructor(i){super(i),this._leadingClips=new Map,this._trailingClips=new Map,this.direction="horizontal",this.leadingLayers=new e,this.max=100,this.min=0,this.precision=4,this.step=.5,this.stepMultiplier=10,this.trailingLayers=new e,this.view=null}initialize(){this.addHandles([r.watch(()=>[this.view,this.view?.ready,this.position,this.direction],()=>this._clipLayers(),r.initial),r.watch(()=>this.leadingLayers.toArray(),()=>this._clipLeadingLayers(),r.initial),r.watch(()=>this.trailingLayers.toArray(),()=>this._clipTrailingLayers(),r.initial)])}destroy(){this._removeExistingClips()}get position(){return 25}set position(i){const{precision:t,min:e,max:r}=this;this._set("position",function(i,t){const e=10**t;return Math.round(i*e)/e}(Math.max(Math.min(i,r),e),t))}get state(){return this.view?.ready?"ready":"disabled"}_clipLayers(){this._clipLeadingLayers(),this._clipTrailingLayers()}_clipLeadingLayers(){this._removeClips("leading");const{leadingLayers:i}=this;i.forEach(i=>this._clipLayer({layer:i,type:"leading"}))}_clipTrailingLayers(){this._removeClips("trailing");const{trailingLayers:i}=this;i.forEach(i=>this._clipLayer({layer:i,type:"trailing"}))}async _getLayerView(i){const{view:t}=this;if(!i||!t)return null;const e=await t.whenLayerView(i);return"clips"in e?e:null}_getVerticalClipRect(i){const{position:t}=this;return"leading"===i?new p({...c,bottom:100-t+"%"}):"trailing"===i?new p({...c,top:`${t}%`}):null}_getHorizontalClipRect(i){const{position:t}=this;return"leading"===i?new p({...c,right:100-t+"%"}):"trailing"===i?new p({...c,left:`${t}%`}):null}_getClipRect(i){const{direction:t}=this;return"vertical"===t?this._getVerticalClipRect(i):"horizontal"===t?this._getHorizontalClipRect(i):null}async _clipLayer(i){const{_leadingClips:t,_trailingClips:e}=this,{layer:r,type:s}=i,o="trailing"===s?e:"leading"===s?t:null,a=await this._getLayerView(r);if(!(a&&"clips"in a&&o&&a.hasOwnProperty("clips")))return;const l=o.get(a);l&&a.clips.remove(l);const n=this._getClipRect(s);n&&(o.set(a,n),a.clips.add(n))}_removeClips(i){const{_leadingClips:t,_trailingClips:e}=this,r="trailing"===i?e:"leading"===i?t:null;r&&(r.forEach((i,t)=>{t&&t.hasOwnProperty("clips")&&t.clips.remove(i)}),r.clear())}_removeExistingClips(){this._removeClips("leading"),this._removeClips("trailing")}};return i.__decorate([s.property()],y.prototype,"direction",void 0),i.__decorate([s.property({type:e,nonNullable:!0})],y.prototype,"leadingLayers",void 0),i.__decorate([s.property({readOnly:!0})],y.prototype,"max",void 0),i.__decorate([s.property({readOnly:!0})],y.prototype,"min",void 0),i.__decorate([s.property()],y.prototype,"position",null),i.__decorate([s.property()],y.prototype,"precision",void 0),i.__decorate([s.property({readOnly:!0})],y.prototype,"state",null),i.__decorate([s.property()],y.prototype,"step",void 0),i.__decorate([s.property()],y.prototype,"stepMultiplier",void 0),i.__decorate([s.property({type:e,nonNullable:!0})],y.prototype,"trailingLayers",void 0),i.__decorate([s.property()],y.prototype,"view",void 0),y=i.__decorate([n.subclass("esri.widgets.Swipe.SwipeViewModel")],y),y});