// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../chunks/tslib.es6","../intl","../core/has","../core/maybe","../core/reactiveUtils","../core/timeUtils","../core/accessorSupport/decorators/property","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../intl/substitute","./Slider","./Widget","./ShadowCast/css","./ShadowCast/ShadowCastViewModel","./ShadowCast/ShadowCastVisibleElements","./ShadowCast/components/DiscreteConfigurator","./ShadowCast/components/DurationConfigurator","./ShadowCast/components/ShadowTooltip","./ShadowCast/components/ThresholdConfigurator","../chunks/componentsUtils","./support/globalCss","./support/Heading","./support/timeWidgetUtils","./support/TimezonePicker","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","../intl/locale","../intl/date"],function(e,t,i,s,o,a,l,n,r,d,c,h,u,p,m,v,g,w,b,y,_,C,S,f,k,T,M,x,V,D,z){"use strict";const P={labelFormatFunction:k.formatSliderLabel,min:0,max:1439,steps:15,rangeLabelInputsEnabled:!1,visibleElements:{labels:!1,rangeLabels:!1},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:(e,t,i)=>k.onPrimaryTickCreated({tickElement:t,labelElement:i})},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:(e,t)=>k.onSecondaryTickCreated({tickElement:t})}]};let O=class extends p{constructor(e,t){super(e,t),this.viewModel=null,this.headingLevel=4,this.visibleElements=new g,this._defaultViewModel=null,this._timeSlider=new u({...P,container:document.createElement("div")}),this._tooltip=null,this._onTimezoneChange=e=>{this.viewModel.utcOffset=e},this._onDateChange=e=>{const t=e.currentTarget.valueAsDate;this.viewModel.date=Array.isArray(t)?t[0]:t},e?.viewModel||(this._defaultViewModel=new v({view:e?.view}),this.viewModel=this._defaultViewModel)}initialize(){this.addHandles([a.watch(()=>({viewModel:this.viewModel,slider:this._timeSlider}),e=>this._connectTimeSlider(e),a.syncAndInitial),a.watch(()=>({container:this.view?.surface,viewModel:this.viewModel,tooltipVisible:this.visibleElements.tooltip}),({container:e,viewModel:t,tooltipVisible:i})=>{this._tooltip=o.destroyMaybe(this._tooltip),null!=e&&i&&(this._tooltip=new y.ShadowTooltip({viewModel:t,container:e}))},a.syncAndInitial),a.watch(()=>({viewModel:this.viewModel,visible:this.visible}),({viewModel:e,visible:t})=>e.setRunning(t),a.syncAndInitial)])}destroy(){this._timeSlider=o.destroyMaybe(this._timeSlider),this._tooltip=o.destroyMaybe(this._tooltip),null!=this._defaultViewModel&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy()}loadDependencies(){return C.loadCalciteComponents({"input-date-picker":()=>new Promise((t,i)=>e(["../chunks/index27"],t,i)),option:()=>new Promise((t,i)=>e(["../chunks/index8"],t,i)),select:()=>new Promise((t,i)=>e(["../chunks/index9"],t,i))})}render(){const{visibleElements:e,viewModel:t}=this,i="disabled"===t.state;return V.tsx("div",{class:this.classes(m.css.base,S.globalCss.widget,S.globalCss.panel,{[S.globalCss.widgetDisabled]:i}),key:this},this._renderTimeRangeSection(),e.visualizationOptions?this._renderVisualizationOptionsSection():null)}get view(){return this.viewModel?.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get icon(){return"measure-building-height-shadow"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get testData(){}_connectTimeSlider({viewModel:e,slider:t}){if(this.removeHandles("slider"),null==t)return;const i=e=>l.convertTime(e,"milliseconds","minutes"),s=e=>l.convertTime(e,"minutes","milliseconds"),o=({index:t,value:i})=>{0===t?e.startTimeOfDay=s(i):e.endTimeOfDay=s(i)},n=()=>k.adjustTimeSliderForLocale(t.domNode);n(),this.addHandles([a.watch(()=>[e.startTimeOfDay,e.endTimeOfDay],e=>{t.values=e.map(i)},a.syncAndInitial),t.on("thumb-change",o),t.on("thumb-drag",o),t.on("segment-drag",()=>{[e.startTimeOfDay,e.endTimeOfDay]=t.values.map(s)}),D.onLocaleChange(n)],"slider")}_renderTimeRangeSection(){const{visibleElements:e}=this;return e.timeRangeSlider||e.datePicker?V.tsx("section",{class:m.css.timeRange,key:"time-range"},V.tsx(f.Heading,{level:this.headingLevel},this.messages.timeLabel),e.timeRangeSlider?this._renderTimeRange():null,e.datePicker?this._renderDatePicker():null):null}_renderTimeRange(){const{messages:e,viewModel:t,visibleElements:i}=this,{startTimeOfDay:s,endTimeOfDay:o}=t,[a,l]=[s,o].map(e=>z.formatDate(new Date(e),k.timeStringFormattingOptions));return[V.tsx("div",{class:m.css.timeRangeIndicator,key:"time-range-indicator"},h.substitute(e.timeRange,{start:a,end:l}),i.timezone?V.tsx(T.TimezonePicker,{disabled:this._timeSlider?.disabled,value:t.utcOffset,onChange:this._onTimezoneChange}):null),V.tsx("div",{afterCreate:this._timeSliderContainerAfterCreate,afterRemoved:this._timeSliderContainerAfterRemoved,bind:this,key:"time-slider-container"})]}_timeSliderContainerAfterCreate(e){const t=this._timeSlider?.container;t&&e.appendChild(t)}_timeSliderContainerAfterRemoved(e){const t=this._timeSlider?.container;t&&e.removeChild(t)}_renderDatePicker(){return V.tsx("div",{class:m.css.datePickerContainer,key:m.css.datePickerContainer},V.tsx("calcite-input-date-picker",{class:m.css.datePicker,"data-testid":"date-picker",key:m.css.datePicker,overlayPositioning:"fixed",placement:"bottom",scale:"s",valueAsDate:this.viewModel.date,onCalciteInputDatePickerChange:this._onDateChange}))}_renderVisualizationOptionsSection(){const{headingLevel:e,messages:t,viewModel:i,visibleElements:s}=this,{colorPicker:o,thresholdContext:a,thresholdContextToggle:l,thresholdContextTimeInterval:n,thresholdContextColor:r}=s,d=e=>this.classes(i.visualizationType===e?null:m.css.visualizationConfigHidden);return V.tsx("section",{class:m.css.visualization,key:"visualization"},V.tsx(f.Heading,{level:e},t.visualizationLabel),this._renderVisualizationSelect(),V.tsx("div",{class:d("threshold"),key:"threshold-configurator"},V.tsx(_.ThresholdConfigurator,{colorPickerVisible:o,contextColorPickerVisible:r,contextTimeIntervalVisible:n,contextToggleVisible:l,contextVisible:a,options:i.thresholdOptions})),V.tsx("div",{class:d("duration"),key:"duration-configurator"},V.tsx(b.DurationConfigurator,{colorPickerVisible:o,options:i.durationOptions})),V.tsx("div",{class:d("discrete"),key:"discrete-configurator"},V.tsx(w.DiscreteConfigurator,{colorPickerVisible:o,options:i.discreteOptions})))}_renderVisualizationSelect(){const e=this.messages,t=this.viewModel.visualizationType;return V.tsx("calcite-select",{bind:this,class:m.css.visualizationSelect,key:"visualization-select",label:e.visualizationLabel,scale:"s",onCalciteSelectChange:this._onVisualizationTypeChange},[{type:"threshold",label:e.threshold.label},{type:"duration",label:e.duration.label},{type:"discrete",label:e.discrete.label}].map(({type:e,label:i})=>V.tsx("calcite-option",{selected:e===t,value:e},i)))}_onVisualizationTypeChange(e){const t=e.currentTarget.selectedOption?.value;this.viewModel.visualizationType=t??"threshold"}};return t.__decorate([n.property()],O.prototype,"viewModel",void 0),t.__decorate([n.property()],O.prototype,"view",null),t.__decorate([n.property()],O.prototype,"headingLevel",void 0),t.__decorate([n.property()],O.prototype,"icon",null),t.__decorate([n.property()],O.prototype,"label",null),t.__decorate([n.property({type:g,nonNullable:!0})],O.prototype,"visibleElements",void 0),t.__decorate([n.property(),x.messageBundle("esri/widgets/ShadowCast/t9n/ShadowCast")],O.prototype,"messages",void 0),t.__decorate([n.property()],O.prototype,"_defaultViewModel",void 0),t.__decorate([n.property()],O.prototype,"_timeSlider",void 0),t.__decorate([n.property()],O.prototype,"_tooltip",void 0),O=t.__decorate([c.subclass("esri.widgets.ShadowCast")],O),O});