// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/tslib.es6","../../../chunks/Tick","../../../chunks/Theme","../../../chunks/ColorSet","../../../chunks/DefaultTheme"],function(e,t,i,s,a,r){"use strict";class n extends s.Text{constructor(){super(...arguments),Object.defineProperty(this,"_display",{enumerable:!0,configurable:!0,writable:!0,value:this._root._renderer.makeRadialText("",this.textStyle)})}_afterNew(){super._afterNew()}_beforeChanged(){super._beforeChanged(),this._display.clear(),this.isDirty("textType")&&(this._display.textType=this.get("textType"),this.markDirtyBounds()),this.isDirty("radius")&&(this._display.radius=this.get("radius"),this.markDirtyBounds()),this.isDirty("startAngle")&&(this._display.startAngle=(this.get("startAngle",0)+90)*s.RADIANS,this.markDirtyBounds()),this.isDirty("inside")&&(this._display.inside=this.get("inside"),this.markDirtyBounds()),this.isDirty("orientation")&&(this._display.orientation=this.get("orientation"),this.markDirtyBounds()),this.isDirty("kerning")&&(this._display.kerning=this.get("kerning"),this.markDirtyBounds())}}Object.defineProperty(n,"className",{enumerable:!0,configurable:!0,writable:!0,value:"RadialText"}),Object.defineProperty(n,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:s.Text.classNames.concat([n.className])});class l extends s.Label{constructor(){super(...arguments),Object.defineProperty(this,"_flipped",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._textKeys.push("textType","kerning"),super._afterNew()}_makeText(){this._text=this.children.push(n.new(this._root,{}))}baseRadius(){const e=this.getPrivate("radius",0),t=this.getPrivate("innerRadius",0),i=this.get("baseRadius",0);return t+s.relativeToValue(i,e-t)}radius(){const e=this.get("inside",!1);return this.baseRadius()+this.get("radius",0)*(e?-1:1)}_updateChildren(){if(super._updateChildren(),this.isDirty("baseRadius")||this.isPrivateDirty("radius")||this.isPrivateDirty("innerRadius")||this.isDirty("labelAngle")||this.isDirty("radius")||this.isDirty("inside")||this.isDirty("orientation")||this.isDirty("textType")){const e=this.get("textType","adjusted"),t=this.get("inside",!1),i=this.get("orientation");let a=s.normalizeAngle(this.get("labelAngle",0));this._text.set("startAngle",this.get("labelAngle",0)),this._text.set("inside",t);const r=s.sin(a),n=s.cos(a);let l=this.baseRadius(),o=this.radius();if(this._display.angle=0,"circular"==e)this.setAll({paddingTop:0,paddingBottom:0,paddingLeft:0,paddingRight:0}),this.setRaw("x",void 0),this.setRaw("y",void 0),this._text.set("orientation",i),this._text.set("radius",o);else{0==l&&(a=0,o=0);let t=o*n,c=o*r;"radial"==e?(this.setRaw("x",t),this.setRaw("y",c),a<90||a>270||"auto"!=i?(this._display.angle=a,this._flipped=!1):(this._display.angle=a+180,this._flipped=!0),this._dirty.rotation=!1):"adjusted"==e?(this.setRaw("centerX",s.p50),this.setRaw("centerY",s.p50),this.setRaw("x",t),this.setRaw("y",c)):"regular"==e&&(this.setRaw("x",t),this.setRaw("y",c))}this.markDirtyPosition(),this.markDirtyBounds()}}_updatePosition(){const e=this.get("textType","regular"),t=this.get("inside",!1);let i=0,a=0,r=this.get("labelAngle",0),n=this.localBounds(),l=n.right-n.left,o=n.bottom-n.top;if("radial"==e){if(this._flipped){let e=this.get("centerX");e instanceof s.Percent&&(l*=1-2*e.value),i=l*s.cos(r),a=l*s.sin(r)}}else t||"adjusted"!=e||(i=l/2*s.cos(r),a=o/2*s.sin(r));this.setRaw("dx",i),this.setRaw("dy",a),super._updatePosition()}get text(){return this._text}}Object.defineProperty(l,"className",{enumerable:!0,configurable:!0,writable:!0,value:"RadialLabel"}),Object.defineProperty(l,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:s.Label.classNames.concat([l.className])});const o=Math.abs,c=Math.atan2,h=Math.cos,u=Math.max,d=Math.min,p=Math.sin,g=Math.sqrt,y=1e-12,b=Math.PI,m=b/2,f=2*b;function _(e){return e>=1?m:e<=-1?-m:Math.asin(e)}function v(e){return e.innerRadius}function x(e){return e.outerRadius}function w(e){return e.startAngle}function D(e){return e.endAngle}function k(e){return e&&e.padAngle}function A(e,t,i,s,a,r,n){var l=e-i,o=t-s,c=(n?r:-r)/g(l*l+o*o),h=c*o,d=-c*l,p=e+h,y=t+d,b=i+h,m=s+d,f=(p+b)/2,_=(y+m)/2,v=b-p,x=m-y,w=v*v+x*x,D=a-r,k=p*m-b*y,A=(x<0?-1:1)*g(u(0,D*D*w-k*k)),T=(k*x-v*A)/w,R=(-k*v-x*A)/w,P=(k*x+v*A)/w,L=(-k*v+x*A)/w,N=T-f,S=R-_,C=P-f,j=L-_;return N*N+S*S>C*C+j*j&&(T=P,R=L),{cx:T,cy:R,x01:-h,y01:-d,x11:T*(a/D-1),y11:R*(a/D-1)}}function T(){var e=v,t=x,s=i.constant(0),a=null,r=w,n=D,l=k,u=null,T=i.withPath(R);function R(){var i,v,x,w=+e.apply(this,arguments),D=+t.apply(this,arguments),k=r.apply(this,arguments)-m,R=n.apply(this,arguments)-m,P=o(R-k),L=R>k;if(u||(u=i=T()),D<w&&(v=D,D=w,w=v),D>y)if(P>f-y)u.moveTo(D*h(k),D*p(k)),u.arc(0,0,D,k,R,!L),w>y&&(u.moveTo(w*h(R),w*p(R)),u.arc(0,0,w,R,k,L));else{var N,S,C=k,j=R,O=k,I=R,M=P,B=P,V=l.apply(this,arguments)/2,F=V>y&&(a?+a.apply(this,arguments):g(w*w+D*D)),H=d(o(D-w)/2,+s.apply(this,arguments)),X=H,Y=H;if(F>y){var z=_(F/w*p(V)),W=_(F/D*p(V));(M-=2*z)>y?(O+=z*=L?1:-1,I-=z):(M=0,O=I=(k+R)/2),(B-=2*W)>y?(C+=W*=L?1:-1,j-=W):(B=0,C=j=(k+R)/2)}var U=D*h(C),K=D*p(C),q=w*h(I),E=w*p(I);if(H>y){var G,J=D*h(j),Q=D*p(j),Z=w*h(O),$=w*p(O);if(P<b)if(G=function(e,t,i,s,a,r,n,l){var o=i-e,c=s-t,h=n-a,u=l-r,d=u*o-h*c;if(!(d*d<y))return[e+(d=(h*(t-r)-u*(e-a))/d)*o,t+d*c]}(U,K,Z,$,J,Q,q,E)){var ee=U-G[0],te=K-G[1],ie=J-G[0],se=Q-G[1],ae=1/p(((x=(ee*ie+te*se)/(g(ee*ee+te*te)*g(ie*ie+se*se)))>1?0:x<-1?b:Math.acos(x))/2),re=g(G[0]*G[0]+G[1]*G[1]);X=d(H,(w-re)/(ae-1)),Y=d(H,(D-re)/(ae+1))}else X=Y=0}B>y?Y>y?(N=A(Z,$,U,K,D,Y,L),S=A(J,Q,q,E,D,Y,L),u.moveTo(N.cx+N.x01,N.cy+N.y01),Y<H?u.arc(N.cx,N.cy,Y,c(N.y01,N.x01),c(S.y01,S.x01),!L):(u.arc(N.cx,N.cy,Y,c(N.y01,N.x01),c(N.y11,N.x11),!L),u.arc(0,0,D,c(N.cy+N.y11,N.cx+N.x11),c(S.cy+S.y11,S.cx+S.x11),!L),u.arc(S.cx,S.cy,Y,c(S.y11,S.x11),c(S.y01,S.x01),!L))):(u.moveTo(U,K),u.arc(0,0,D,C,j,!L)):u.moveTo(U,K),w>y&&M>y?X>y?(N=A(q,E,J,Q,w,-X,L),S=A(U,K,Z,$,w,-X,L),u.lineTo(N.cx+N.x01,N.cy+N.y01),X<H?u.arc(N.cx,N.cy,X,c(N.y01,N.x01),c(S.y01,S.x01),!L):(u.arc(N.cx,N.cy,X,c(N.y01,N.x01),c(N.y11,N.x11),!L),u.arc(0,0,w,c(N.cy+N.y11,N.cx+N.x11),c(S.cy+S.y11,S.cx+S.x11),L),u.arc(S.cx,S.cy,X,c(S.y11,S.x11),c(S.y01,S.x01),!L))):u.arc(0,0,w,I,O,L):u.lineTo(q,E)}else u.moveTo(0,0);if(u.closePath(),i)return u=null,i+""||null}return R.centroid=function(){var i=(+e.apply(this,arguments)+ +t.apply(this,arguments))/2,s=(+r.apply(this,arguments)+ +n.apply(this,arguments))/2-b/2;return[h(s)*i,p(s)*i]},R.innerRadius=function(t){return arguments.length?(e="function"==typeof t?t:i.constant(+t),R):e},R.outerRadius=function(e){return arguments.length?(t="function"==typeof e?e:i.constant(+e),R):t},R.cornerRadius=function(e){return arguments.length?(s="function"==typeof e?e:i.constant(+e),R):s},R.padRadius=function(e){return arguments.length?(a=null==e?null:"function"==typeof e?e:i.constant(+e),R):a},R.startAngle=function(e){return arguments.length?(r="function"==typeof e?e:i.constant(+e),R):r},R.endAngle=function(e){return arguments.length?(n="function"==typeof e?e:i.constant(+e),R):n},R.padAngle=function(e){return arguments.length?(l="function"==typeof e?e:i.constant(+e),R):l},R.context=function(e){return arguments.length?(u=e??null,R):u},R}class R extends s.Graphics{constructor(){super(...arguments),Object.defineProperty(this,"ix",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"iy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_generator",{enumerable:!0,configurable:!0,writable:!0,value:T()})}_getTooltipPoint(){let e=this.get("tooltipX"),t=this.get("tooltipY"),i=0,a=0;s.isNumber(e)&&(i=e),s.isNumber(t)&&(a=t);let r=this.get("radius",0),n=this.get("innerRadius",0);return r+=this.get("dRadius",0),n+=this.get("dInnerRadius",0),n<0&&(n=r+n),e instanceof s.Percent&&(i=this.ix*(n+(r-n)*e.value)),t instanceof s.Percent&&(a=this.iy*(n+(r-n)*t.value)),this.get("arc")>=360&&0==n&&(i=0,a=0),{x:i,y:a}}_beforeChanged(){super._beforeChanged(),(this.isDirty("radius")||this.isDirty("arc")||this.isDirty("innerRadius")||this.isDirty("startAngle")||this.isDirty("dRadius")||this.isDirty("dInnerRadius")||this.isDirty("cornerRadius")||this.isDirty("shiftRadius"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){let e=this.get("startAngle",0),t=this.get("arc",0);const i=this._generator;t<0&&(e+=t,t*=-1),t>.1&&i.cornerRadius(this.get("cornerRadius",0)),i.context(this._display);let a=this.get("radius",0),r=this.get("innerRadius",0);a+=this.get("dRadius",0),r+=this.get("dInnerRadius",0),r<0&&(r=a+r),i({innerRadius:r,outerRadius:a,startAngle:(e+90)*s.RADIANS,endAngle:(e+t+90)*s.RADIANS});let n=e+t/2;this.ix=s.cos(n),this.iy=s.sin(n);const l=this.get("shiftRadius",0);this.setRaw("dx",this.ix*l),this.setRaw("dy",this.iy*l),this.markDirtyPosition()}}}Object.defineProperty(R,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Slice"}),Object.defineProperty(R,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:s.Graphics.classNames.concat([R.className])});class P extends s.Theme{setupDefaultRules(){super.setupDefaultRules();const e=this._root.interfaceColors,t=this.rule.bind(this);t("PercentSeries").setAll({legendLabelText:"{category}",legendValueText:"{valuePercentTotal.formatNumber('0.00p')}",colors:a.ColorSet.new(this._root,{}),width:s.p100,height:s.p100}),t("PieChart").setAll({radius:s.percent(80),startAngle:-90,endAngle:270}),t("PieSeries").setAll({alignLabels:!0,startAngle:-90,endAngle:270}),t("PieSeries").states.create("hidden",{endAngle:-90,opacity:0}),t("Slice",["pie"]).setAll({position:"absolute",isMeasured:!1,x:0,y:0,toggleKey:"active",tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}",strokeWidth:1,strokeOpacity:1,role:"figure",lineJoin:"round"}),t("Slice",["pie"]).states.create("active",{shiftRadius:20,scale:1}),t("Slice",["pie"]).states.create("hoverActive",{scale:1.04}),t("Slice",["pie"]).states.create("hover",{scale:1.04}),t("RadialLabel",["pie"]).setAll({textType:"aligned",radius:10,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",paddingTop:5,paddingBottom:5,populateText:!0}),t("Tick",["pie"]).setAll({location:1}),t("SlicedChart").setAll({paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10}),t("FunnelSeries").setAll({startLocation:0,endLocation:1,orientation:"vertical",alignLabels:!0,sequencedInterpolation:!0}),t("FunnelSlice").setAll({interactive:!0,expandDistance:0}),t("FunnelSlice").states.create("hover",{expandDistance:.15}),t("Label",["funnel"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:s.p50}),t("Label",["funnel","horizontal"]).setAll({centerX:0,centerY:s.p50,rotation:-90}),t("Label",["funnel","vertical"]).setAll({centerY:s.p50,centerX:0}),t("Tick",["funnel"]).setAll({location:1}),t("FunnelSlice",["funnel","link"]).setAll({fillOpacity:.5,strokeOpacity:0,expandDistance:-.1}),t("FunnelSlice",["funnel","link","vertical"]).setAll({height:10}),t("FunnelSlice",["funnel","link","horizontal"]).setAll({width:10}),t("PyramidSeries").setAll({valueIs:"area"}),t("FunnelSlice",["pyramid","link"]).setAll({fillOpacity:.5}),t("FunnelSlice",["pyramid","link","vertical"]).setAll({height:0}),t("FunnelSlice",["pyramid","link","horizontal"]).setAll({width:0}),t("FunnelSlice",["pyramid"]).setAll({interactive:!0,expandDistance:0}),t("FunnelSlice",["pyramid"]).states.create("hover",{expandDistance:.15}),t("Label",["pyramid"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:s.p50}),t("Label",["pyramid","horizontal"]).setAll({centerX:0,centerY:s.p50,rotation:-90}),t("Label",["pyramid","vertical"]).setAll({centerY:s.p50,centerX:0}),t("Tick",["pyramid"]).setAll({location:1}),t("FunnelSlice",["pictorial"]).setAll({interactive:!0,tooltipText:"{category}: {valuePercentTotal.formatNumber('0.00p')}"}),t("Label",["pictorial"]).setAll({populateText:!0,text:"{category}: {valuePercentTotal.formatNumber('0.00p')}",centerY:s.p50}),t("Label",["pictorial","horizontal"]).setAll({centerX:0,centerY:s.p50,rotation:-90}),t("Label",["pictorial","vertical"]).setAll({centerY:s.p50,centerX:0}),t("FunnelSlice",["pictorial","link"]).setAll({fillOpacity:.5,width:0,height:0}),t("Tick",["pictorial"]).setAll({location:.5});{const i=t("Graphics",["pictorial","background"]);i.setAll({fillOpacity:.2}),r.setColor(i,"fill",e,"alternativeBackground")}}}class L extends i.SerialChart{_afterNew(){this._defaultThemes.push(P.new(this._root)),super._afterNew(),this.chartContainer.children.push(this.seriesContainer),this.seriesContainer.children.push(this.bulletsContainer)}_processSeries(e){super._processSeries(e),this.seriesContainer.children.moveValue(this.bulletsContainer,this.seriesContainer.children.length-1)}}Object.defineProperty(L,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentChart"}),Object.defineProperty(L,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:i.SerialChart.classNames.concat([L.className])});class N extends i.Series{constructor(){super(...arguments),Object.defineProperty(this,"slicesContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(s.Container.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"labelsContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(s.Container.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"ticksContainer",{enumerable:!0,configurable:!0,writable:!0,value:this.children.push(s.Container.new(this._root,{position:"absolute",isMeasured:!1}))}),Object.defineProperty(this,"_lLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_rLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_hLabels",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"slices",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeSlices())}),Object.defineProperty(this,"labels",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeLabels())}),Object.defineProperty(this,"ticks",{enumerable:!0,configurable:!0,writable:!0,value:this.addDisposer(this._makeTicks())})}makeSlice(e){const t=this.slicesContainer.children.push(this.slices.make());return t.on("fill",()=>{this.updateLegendMarker(e)}),t.on("fillPattern",()=>{this.updateLegendMarker(e)}),t.on("stroke",()=>{this.updateLegendMarker(e)}),t._setDataItem(e),e.set("slice",t),this.slices.push(t),t}makeLabel(e){const t=this.labelsContainer.children.push(this.labels.make());return t._setDataItem(e),e.set("label",t),this.labels.push(t),t}_shouldMakeBullet(e){return null!=e.get("value")}makeTick(e){const t=this.ticksContainer.children.push(this.ticks.make());return t._setDataItem(e),e.set("tick",t),this.ticks.push(t),t}_afterNew(){this.fields.push("category","fill"),super._afterNew()}_onDataClear(){const e=this.get("colors");e&&e.reset();const t=this.get("patterns");t&&t.reset()}_prepareChildren(){if(super._prepareChildren(),this._lLabels=[],this._rLabels=[],this._hLabels=[],this._valuesDirty){let e=0,t=0,i=0,a=1/0,r=0;s.each(this._dataItems,i=>{let s=i.get("valueWorking",0);e+=s,t+=Math.abs(s)}),s.each(this._dataItems,e=>{let s=e.get("valueWorking",0);s>i&&(i=s),s<a&&(a=s),r++;let n=s/t;0==t&&(n=0),e.setRaw("valuePercentTotal",100*n)}),this.setPrivateRaw("valueLow",a),this.setPrivateRaw("valueHigh",i),this.setPrivateRaw("valueSum",e),this.setPrivateRaw("valueAverage",e/r),this.setPrivateRaw("valueAbsoluteSum",t)}}show(e){const i=Object.create(null,{show:{get:()=>super.show}});return t.__awaiter(this,void 0,void 0,function*(){let t=[];t.push(i.show.call(this,e)),t.push(this._sequencedShowHide(!0,e)),yield Promise.all(t)})}hide(e){const i=Object.create(null,{hide:{get:()=>super.hide}});return t.__awaiter(this,void 0,void 0,function*(){let t=[];t.push(i.hide.call(this,e)),t.push(this._sequencedShowHide(!1,e)),yield Promise.all(t)})}_updateChildren(){super._updateChildren(),this._valuesDirty&&s.each(this._dataItems,e=>{e.get("label").text.markDirtyText()}),(this.isDirty("legendLabelText")||this.isDirty("legendValueText"))&&s.each(this._dataItems,e=>{this.updateLegendValue(e)}),this._arrange()}_arrange(){this._arrangeDown(this._lLabels),this._arrangeUp(this._lLabels),this._arrangeDown(this._rLabels),this._arrangeUp(this._rLabels),this._arrangeLeft(this._hLabels),this._arrangeRight(this._hLabels),s.each(this.dataItems,e=>{this._updateTick(e)})}_afterChanged(){super._afterChanged(),this._arrange()}processDataItem(e){if(super.processDataItem(e),null==e.get("fill")){let t=this.get("colors");t&&e.setRaw("fill",t.next())}if(null==e.get("fillPattern")){let t=this.get("patterns");t&&e.setRaw("fillPattern",t.next())}}showDataItem(e,i){const a=Object.create(null,{showDataItem:{get:()=>super.showDataItem}});return t.__awaiter(this,void 0,void 0,function*(){const t=[a.showDataItem.call(this,e,i)];s.isNumber(i)||(i=this.get("stateAnimationDuration",0));const r=this.get("stateAnimationEasing");let n=e.get("value");const l=e.animate({key:"valueWorking",to:n,duration:i,easing:r});l&&t.push(l.waitForStop());const o=e.get("tick");o&&t.push(o.show(i));const c=e.get("label");c&&t.push(c.show(i));const h=e.get("slice");h&&t.push(h.show(i)),h.get("active")&&h.states.applyAnimate("active"),yield Promise.all(t)})}hideDataItem(e,i){const a=Object.create(null,{hideDataItem:{get:()=>super.hideDataItem}});return t.__awaiter(this,void 0,void 0,function*(){const t=[a.hideDataItem.call(this,e,i)],r=this.states.create("hidden",{});s.isNumber(i)||(i=r.get("stateAnimationDuration",this.get("stateAnimationDuration",0)));const n=r.get("stateAnimationEasing",this.get("stateAnimationEasing")),l=e.animate({key:"valueWorking",to:0,duration:i,easing:n});l&&t.push(l.waitForStop());const o=e.get("tick");o&&t.push(o.hide(i));const c=e.get("label");c&&t.push(c.hide(i));const h=e.get("slice");h.hideTooltip(),h&&t.push(h.hide(i)),yield Promise.all(t)})}disposeDataItem(e){super.disposeDataItem(e);let t=e.get("label");t&&(this.labels.removeValue(t),t.dispose());let i=e.get("tick");i&&(this.ticks.removeValue(i),i.dispose());let s=e.get("slice");s&&(this.slices.removeValue(s),s.dispose())}hoverDataItem(e){const t=e.get("slice");t&&!t.isHidden()&&t.hover()}unhoverDataItem(e){const t=e.get("slice");t&&t.unhover()}updateLegendMarker(e){if(e){const t=e.get("slice");if(t){const i=e.get("legendDataItem");if(i){const e=i.get("markerRectangle");s.each(s.visualSettings,i=>{null!=t.get(i)&&e.set(i,t.get(i))})}}}}_arrangeDown(e){if(e){let t=this._getNextDown();e.sort((e,t)=>e.y>t.y?1:e.y<t.y?-1:0),s.each(e,e=>{const i=e.label.adjustedLocalBounds();let s=i.top;e.y+s<t&&(e.y=t-s),e.label.set("y",e.y),t=e.y+i.bottom})}}_getNextUp(){return this.labelsContainer.maxHeight()}_getNextDown(){return 0}_arrangeUp(e){if(e){let t=this._getNextUp();e.sort((e,t)=>e.y<t.y?1:e.y>t.y?-1:0),s.each(e,e=>{const i=e.label.adjustedLocalBounds();let s=i.bottom;e.y+s>t&&(e.y=t-s),e.label.set("y",e.y),t=e.y+i.top})}}_arrangeRight(e){if(e){let t=0;e.sort((e,t)=>e.y>t.y?1:e.y<t.y?-1:0),s.each(e,e=>{const i=e.label.adjustedLocalBounds();let s=i.left;e.y+s<t&&(e.y=t-s),e.label.set("x",e.y),t=e.y+i.right})}}_arrangeLeft(e){if(e){let t=this.labelsContainer.maxWidth();e.sort((e,t)=>e.y<t.y?1:e.y>t.y?-1:0),s.each(e,e=>{const i=e.label.adjustedLocalBounds();let s=i.right;e.y+s>t&&(e.y=t-s),e.label.set("x",e.y),t=e.y+i.left})}}_updateSize(){super._updateSize(),this.markDirty()}_updateTick(e){}_dispose(){super._dispose();const e=this.chart;e&&e.series.removeValue(this)}}Object.defineProperty(N,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PercentSeries"}),Object.defineProperty(N,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:i.Series.classNames.concat([N.className])});class S extends L{constructor(){super(...arguments),Object.defineProperty(this,"_maxRadius",{enumerable:!0,configurable:!0,writable:!0,value:1})}_afterNew(){super._afterNew(),this.seriesContainer.setAll({x:s.p50,y:s.p50})}_prepareChildren(){super._prepareChildren();const e=this.chartContainer,t=e.innerWidth(),i=e.innerHeight(),a=this.get("startAngle",0),r=this.get("endAngle",0),n=this.get("innerRadius");let l=s.getArcBounds(0,0,a,r,1);const o=t/(l.right-l.left),c=i/(l.bottom-l.top);let h={left:0,right:0,top:0,bottom:0};if(n instanceof s.Percent){let e=n.value,l=Math.min(o,c);e=Math.max(l*e,l-Math.min(i,t))/l,h=s.getArcBounds(0,0,a,r,e),this.setPrivateRaw("irModifyer",e/n.value)}l=s.mergeBounds([l,h]);const u=this._maxRadius;this._maxRadius=Math.min(o,c);const d=s.relativeToValue(this.get("radius",0),this._maxRadius);this.seriesContainer.setAll({dy:-d*(l.bottom+l.top)/2,dx:-d*(l.right+l.left)/2}),(this.isDirty("startAngle")||this.isDirty("endAngle")||u!=this._maxRadius)&&this.series.each(e=>{e._markDirtyKey("startAngle")}),(this.isDirty("innerRadius")||this.isDirty("radius"))&&this.series.each(e=>{e._markDirtyKey("innerRadius")})}radius(e){let t=s.relativeToValue(this.get("radius",0),this._maxRadius),i=s.relativeToValue(this.get("innerRadius",0),t);if(e){let a=this.series.indexOf(e),r=this.series.length,n=e.get("radius");return null!=n?i+s.relativeToValue(n,t-i):i+(t-i)/r*(a+1)}return t}innerRadius(e){const t=this.radius();let i=s.relativeToValue(this.get("innerRadius",0),t);if(i<0&&(i=t+i),e){let a=this.series.indexOf(e),r=this.series.length,n=e.get("innerRadius");return null!=n?i+s.relativeToValue(n,t-i):i+(t-i)/r*a}return i}_updateSize(){super._updateSize(),this.markDirtyKey("radius")}}Object.defineProperty(S,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieChart"}),Object.defineProperty(S,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:L.classNames.concat([S.className])});class C extends N{_makeSlices(){return new s.ListTemplate(s.Template.new({}),()=>R._new(this._root,{themeTags:s.mergeTags(this.slices.template.get("themeTags",[]),["pie","series"])},[this.slices.template]))}_makeLabels(){return new s.ListTemplate(s.Template.new({}),()=>l._new(this._root,{themeTags:s.mergeTags(this.labels.template.get("themeTags",[]),["pie","series"])},[this.labels.template]))}_makeTicks(){return new s.ListTemplate(s.Template.new({}),()=>i.Tick._new(this._root,{themeTags:s.mergeTags(this.ticks.template.get("themeTags",[]),["pie","series"])},[this.ticks.template]))}processDataItem(e){super.processDataItem(e);const t=this.makeSlice(e);t.on("scale",()=>{this._updateTick(e)}),t.on("shiftRadius",()=>{this._updateTick(e)}),t.events.on("positionchanged",()=>{this._updateTick(e)});const i=this.makeLabel(e);i.events.on("positionchanged",()=>{this._updateTick(e)}),this.makeTick(e),t.events.on("positionchanged",()=>{i.markDirty()})}_getNextUp(){const e=this.chart;return e?e._maxRadius:this.labelsContainer.maxHeight()/2}_getNextDown(){const e=this.chart;return e?-e._maxRadius:-this.labelsContainer.maxHeight()/2}_prepareChildren(){super._prepareChildren();const e=this.chart;if(e){if(this.isDirty("alignLabels")){let e=this.labels.template;if(this.get("alignLabels"))e.set("textType","aligned");else{let t=e.get("textType");null!=t&&"aligned"!=t||e.set("textType","adjusted")}}if(this._valuesDirty||this.isDirty("radius")||this.isDirty("innerRadius")||this.isDirty("startAngle")||this.isDirty("endAngle")||this.isDirty("alignLabels")){this.markDirtyBounds();const t=this.get("startAngle",e.get("startAngle",-90)),i=this.get("endAngle",e.get("endAngle",270))-t;let a=t;const r=e.radius(this);this.setPrivateRaw("radius",r);let n=e.innerRadius(this)*e.getPrivate("irModifyer",1);n<0&&(n=r+n),s.each(this._dataItems,e=>{this.updateLegendValue(e);let t=i*e.get("valuePercentTotal")/100;const l=e.get("slice");if(l){l.set("radius",r),l.set("innerRadius",n),l.set("startAngle",a),l.set("arc",t);const i=e.get("fill");l._setDefault("fill",i),l._setDefault("stroke",i);const s=e.get("fillPattern");l._setDefault("fillPattern",s)}let o=s.normalizeAngle(a+t/2);const c=e.get("label");if(c&&(c.setPrivate("radius",r),c.setPrivate("innerRadius",n),c.set("labelAngle",o),"aligned"==c.get("textType"))){let e=r+c.get("radius",0),t=r*s.sin(o);o>90&&o<=270?(c.isHidden()||c.isHiding()||this._lLabels.push({label:c,y:t}),e*=-1,e-=this.labelsContainer.get("paddingLeft",0),c.set("centerX",s.p100),c.setPrivateRaw("left",!0)):(c.isHidden()||c.isHiding()||this._rLabels.push({label:c,y:t}),e+=this.labelsContainer.get("paddingRight",0),c.set("centerX",0),c.setPrivateRaw("left",!1)),c.set("x",e),c.set("y",r*s.sin(o))}a+=t,this._updateTick(e)})}}}_updateTick(e){const t=e.get("tick"),i=e.get("label"),a=e.get("slice"),r=t.get("location",1);if(t&&i&&a){const e=(a.get("shiftRadius",0)+a.get("radius",0))*a.get("scale",1)*r,n=i.get("labelAngle",0),l=s.cos(n),o=s.sin(n),c=this.labelsContainer,h=c.get("paddingLeft",0),u=c.get("paddingRight",0);let d=0,p=0;d=i.x(),p=i.y();let g=[];if(0!=d||0!=p){if("circular"==i.get("textType")){const e=i.radius()-i.get("paddingBottom",0),t=i.get("labelAngle",0);d=e*s.cos(t),p=e*s.sin(t)}let t=-u;i.getPrivate("left")&&(t=h),g=[{x:a.x()+e*l,y:a.y()+e*o},{x:d+t,y:p},{x:d,y:p}]}t.set("points",g)}}_positionBullet(e){const t=e.get("sprite");if(t){const i=t.dataItem.get("slice");if(i){const a=i.get("innerRadius",0),r=i.get("radius",0),n=i.get("startAngle",0)+i.get("arc",0)*e.get("locationX",.5),l=a+(r-a)*e.get("locationY",.5);t.setAll({x:s.cos(n)*l,y:s.sin(n)*l})}}}}Object.defineProperty(C,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PieSeries"}),Object.defineProperty(C,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:N.classNames.concat([C.className])}),e.PieChartAm5=S,e.PieSeriesAm5=C,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});