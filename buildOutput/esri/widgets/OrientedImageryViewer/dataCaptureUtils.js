// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../Graphic","../../core/Error","../../geometry/Polygon","../../geometry/support/jsonUtils","../../layers/orientedImagery/transformations/utils","./constants","./symbols"],function(e,t,a,n,o,r,i,p){"use strict";function c(e,t,a){const n=e.toLowerCase(),o=t.toLowerCase()===n,i=a?.toLowerCase()===n;return r.or(o,i)}function m(e){return"point"===e.geometryType||"polygon"===e.geometryType||"polyline"===e.geometryType}function s(e,t){const{geometry:a}=JSON.parse(atob(e[t]));return o.fromJSON(a)}function l(e){switch(e.type){case"point":e.x+=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map(e=>e.map(([e,t])=>[e+.5,.5-t]));break;case"polygon":e.rings=e.rings.map(e=>e.map(([e,t])=>[e+.5,.5-t]));break;case"multipoint":e.points=e.points.map(([e,t])=>[e+.5,.5-t]);break;case"extent":e.xmin+=.5,e.xmax+=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}function y(e,t){switch(e.type){case"point":{const{x:a,y:n}=r.convertSphereVertexToPixelLocation(e,t[0],t[1]);e.x=a,e.y=n,delete e.z;break}case"polyline":e.paths=e.paths.map(e=>e.map(e=>{const{x:a,y:n}=r.convertSphereVertexToPixelLocation({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[a,n]}));break;case"polygon":e.rings=e.rings.map(e=>e.map(e=>{const{x:a,y:n}=r.convertSphereVertexToPixelLocation({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[a,n]}));break;case"multipoint":e.points=e.points.map(e=>{const{x:a,y:n}=r.convertSphereVertexToPixelLocation({x:e[0],y:e[1],z:e[2]},t[0],t[1]);return[a,n]});break;case"extent":{const{xmin:a,xmax:o,ymin:r,ymax:i}=y(n.fromExtent(e),t).extent;e.xmax=o,e.xmin=a,e.ymax=i,e.ymin=r;break}}return e}function u(e,t,a){switch(t){case"default":return x(e);case"panoramic":return g(e,a)}}function x(e){switch(e.type){case"point":e.x-=.5,e.y=.5-e.y;break;case"polyline":e.paths=e.paths.map(e=>e.map(([e,t])=>[e-.5,.5-t]));break;case"polygon":e.rings=e.rings.map(e=>e.map(([e,t])=>[e-.5,.5-t]));break;case"multipoint":e.points=e.points.map(([e,t])=>[e-.5,.5-t]);break;case"extent":e.xmin-=.5,e.xmax-=.5,e.ymin=.5-e.ymin,e.ymax=.5-e.ymax}return e}function g(e,t){switch(e.type){case"point":{const[a,n,o]=r.convertPixelLocationToSphereVertex(e,t[0],t[1]);e.x=a,e.y=n,e.z=o;break}case"polyline":e.paths=e.paths.map(e=>e.map(e=>{const[a,n,o]=r.convertPixelLocationToSphereVertex({x:e[0],y:e[1]},t[0],t[1]);return[a,n,o]}));break;case"polygon":e.rings=e.rings.map(e=>e.map(e=>{const[a,n,o]=r.convertPixelLocationToSphereVertex({x:e[0],y:e[1]},t[0],t[1]);return[a,n,o]}));break;case"multipoint":e.points=e.points.map(e=>{const[a,n,o]=r.convertPixelLocationToSphereVertex({x:e[0],y:e[1]},t[0],t[1]);return[a,n,o]});break;case"extent":{const{xmin:a,xmax:o,ymin:r,ymax:i}=g(n.fromExtent(e),t).extent;e.xmax=o,e.xmin=a,e.ymax=i,e.ymin=r}}return e}e.configureSketchTool=function(e,t,a){if(!e)return;const{renderer:n}=e,o=p.dataCaptureFeatureSymbol(t),r=n?"symbol"in n?n.symbol:"defaultSymbol"in n?n.defaultSymbol:n.getSymbol():null,i=o(r?.color);a[`${t}Symbol`]=(t===e.geometryType?r:null)??i},e.constructGraphicFromImageGeometry=function(e,n,o,r,i,c,m){let l=s(e,n);if(!l)throw new a("orientedimagery","InvalidGeometry");return l=u(l,c,i),new t({attributes:e,layer:o,symbol:p.createGraphicSymbol(l.type,o.geometryType,m),geometry:l,visible:o.visible&&r})},e.extractFieldsFromDataCaptureLayer=function(e,t,n){const o=e.fields.find(({name:e,alias:a,type:n})=>c(t?.length?t:i.defaultImageGeometryField,e,a)&&"blob"===n),r=e.fields.find(({name:e,alias:t})=>c(n?.length?n:i.defaultOIObjectIDField,e,t));if(!o||!r)throw new a("invalid-data-capture-layer","Data capture layer is not configured correctly.",{layer:e,imageGeometryField:o,oiObjectIdField:r});return{imageGeometryField:o,oiObjectIdField:r}},e.isValidDataCaptureLayer=function(e,t,a){return!("point"!==(n=e.geometryType)&&"polygon"!==n&&"polyline"!==n||2!==e.fields.filter(({name:e,type:n,alias:o})=>c(a?.length?a:i.defaultOIObjectIDField,e,o)||c(t?.length?t:i.defaultImageGeometryField,e,o)&&"blob"===n).length);var n},e.isValidOverlayLayer=function(e){return"feature"===e.type&&m(e)},e.mapSpaceToImageSpace=function(e,t,a){switch(t){case"default":return l(e);case"panoramic":return y(e,a)}},e.mapSpaceToImageSpaceDefault=l,e.mapSpaceToImageSpacePanoramic=y,e.parseAndExtractField=s,e.pixelToMapSpace=u,e.pixelToMapSpaceDefault=x,e.pixelToMapSpacePanoramic=g,e.supportedDigitigedGeometryType=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});