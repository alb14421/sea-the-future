// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../core/sql","../../../layers/orientedImagery/queries","../../../layers/orientedImagery/core/coverageUtils"],function(e,r,t,n,o){"use strict";const s=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));class i{constructor(e,r){this.response=e,this.error=r}}class u{constructor(e,r,t){this.nextLocation=e,this.response=r,this.error=t}}async function a(r,t){const n=await new Promise((r,t)=>e(["../../../layers/orientedImagery/core/ExposurePoint"],e=>r(s(e)),t)).then(e=>e.default);r.features.forEach(e=>{const r=n.fromJSON({...e.toJSON(),layer:t});r&&(e.attributes=r)})}function c(...e){let r="1=1";return e.forEach(e=>{r=t.sqlAnd(r,e)}),r}r.QueryNextLocationFeaturesResponse=u,r.QueryOrientedImageryFeaturesResponse=i,r.queryAfterSequenceField=async function(e,r,t=0,n=1,o,s){const u=e.sequenceOrderField??"SequenceOrder",y=function(e,r){return r>0?[`${e}`]:[`${e} DESC`]}(u,t),d=c(e.definitionExpression,o,function(e,r,t){return e>0?`${t} IS NOT NULL AND ${t} > ${r}`:`${t} IS NOT NULL AND ${t} < ${r}`}(t,r,u));try{const r=await e.queryFeatures({where:d,orderByFields:y,num:n,outFields:["*"],returnGeometry:!0},s);return await a(r,e),new i(r)}catch(e){return new i(void 0,e)}},r.queryFeatureByObjectIds=async function(e,r,t,n){const o=Array.isArray(r)?r:[r],s=c(e.definitionExpression,t,`${e.objectIdField} IN (${o.join(",")})`);try{const r=await e.queryFeatures({where:s,outFields:["*"],returnGeometry:!0},n);return await a(r,e),new i(r)}catch(e){return new i(void 0,e)}},r.queryNextLocationFeatures=async function(e,r,t,s){const i=o.createCoveragePolygon(r.attributes).polygon.centroid;i.z=void 0;const a=c(e.definitionExpression,t);let y,d;try{y=await n.searchImages({layerInstanceOrURL:e,point:i,queryParams:{where:a}},s)}catch(e){d=e}return new u(i,y,d)},r.queryOffsetSequenceFeatures=async function(e,r,n,o="ASC",s,u){const y=e.sequenceOrderField??"SequenceOrder";let d=c(e.definitionExpression,s,`${y} IS NOT NULL`);const l="number"==typeof r?r-1:void 0;"string"===r&&(d=t.sqlAnd(d,`${y} = ${r}`));try{const r=await e.queryFeatures({where:d,returnGeometry:!0,orderByFields:[`${y} ${o}`],outFields:["*"],start:l,num:n},u);return await a(r,e),new i(r)}catch(e){return new i(void 0,e)}},r.querySequenceCount=function(e,r,t){const n=e.sequenceOrderField,o=c(e.definitionExpression,r,`${n} IS NOT NULL`);return e.queryFeatureCount({where:o},t)},r.querySequenceFeaturesAroundPoint=async function(e,r,t,o){const s=e.sequenceOrderField??"SequenceOrder",i=c(e.definitionExpression,t,`${s} IS NOT NULL`);let a,y;try{a=await n.searchImages({layerInstanceOrURL:e,point:r,queryParams:{where:i,orderByFields:[`${s}`],returnGeometry:!0,outFields:["*"]}},o)}catch(e){y=e}return new u(r,a,y)},Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});