// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../chunks/tslib.es6","../../intl","../../core/string","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../support/actions/actionUtils","../Widget","./css","../Popup/actions","../../chunks/componentsUtils","../support/widgetUtils","../support/decorators/messageBundle","../support/jsxFactory","../../intl/substitute"],function(e,t,s,i,o,a,l,r,n,c,d,u,p,h,m,w,f,g,x){"use strict";const y=h.zoomToFeature.clone();return t.default=class extends u{constructor(e,t){super(e,t),this.flowItems=null,this.messages=null,this.closed=!1,this.closable=!0,this.selectLastFlowItem=!0,this._handleOpenFeature=e=>{this.emit("open-feature",{feature:e})},this._handleZoomToFeature=e=>{this.emit("zoom-to-feature",{featureWidget:e})}}loadDependencies(){return Promise.all([d.loadActionUtilsComponents(),m.loadCalciteComponents({action:()=>new Promise((t,s)=>e(["../../chunks/index12"],t,s)),"action-bar":()=>new Promise((t,s)=>e(["../../chunks/index46"],t,s)),"action-group":()=>new Promise((t,s)=>e(["../../chunks/index18"],t,s)).then(e=>e.index),"flow-item":()=>new Promise((t,s)=>e(["../../chunks/index15"],t,s))})])}render(){const{flowItems:e}=this,t=e?.toArray();return g.tsx(g.tsxFragment,null,t?.map((e,s)=>this._renderFlowItem(e,this.selectLastFlowItem&&s===t.length-1)))}_handleCloseClick(){this.emit("close")}_handleExitClick(){this.emit("exit")}_handleDrillInBackClick(){const{flowItems:e}=this,t=e?.pop();t&&("activeCategory"in t.viewModel?(t.viewModel.activeCategory=null,e?.length||(t.viewModel.showAllEnabled=!1)):"showAllEnabled"in t.viewModel&&(t.viewModel.showAllEnabled=!1),t&&(t.viewModel=null,t.destroy()))}_getExitMessage(e){switch(e.flowType){case"feature":case"feature-association":return"";case"feature-relationship":return this.messages.exitRelatedRecords;case"feature-utility-network-associations":case"feature-utility-network-association-type":return this.messages.exitAssociations}}_renderFlowItem(e,t){const{messages:s,closable:i,closed:a}=this,l="graphic"in e&&!e.isTable,r="feature-association"===e.flowType,n=this._getExitMessage(e),c=s.selectFeature;return g.tsx("calcite-flow-item",{bind:this,closable:i,closed:a,description:o.stripHTML(this._getDrillInFlowItemDescription(e)??""),heading:o.stripHTML(e.title??""),key:`flow-item-${e.viewModel.uid}`,selected:t,onCalciteFlowItemBack:e=>{e.preventDefault(),this._handleDrillInBackClick()},onCalciteFlowItemClose:this._handleCloseClick},g.tsx("calcite-action",{appearance:"transparent",bind:this,class:p.css.actionExit,icon:"move-up",key:"exit-action",onclick:this._handleExitClick,slot:"header-actions-start",text:n,title:n}),l?g.tsx("calcite-action",{appearance:"transparent",bind:this,icon:"zoom-to-object",key:"open-feature-action",onclick:()=>this._handleOpenFeature(e),slot:"header-actions-end",text:c,title:c}):null,r?g.tsx("calcite-action-bar",{expandDisabled:!0,expanded:!0,key:"header-action-bar",scale:"s",slot:"action-bar"},g.tsx("calcite-action-group",{overlayPositioning:"fixed",scale:"s"},d.renderAction(y,{key:`action-${y.uid}`,title:this._getActionTitle(y),text:this._getActionTitle(y),textEnabled:!0,onclick:()=>this._handleZoomToFeature(e),bind:this}))):null,g.tsx("div",{class:p.css.container},e.render()))}_getActionTitle(e){const{messages:t}=this,s=e.title??"";return"zoom-to-feature"===e.id?x.substitute(s,{messages:t}):s}_getDrillInFlowItemDescription(e){switch(e.flowType){case"feature":case"feature-association":case"feature-utility-network-associations":return e.viewModel.description??"";case"feature-relationship":return e.allItemsDescription;case"feature-utility-network-association-type":return e.description??""}}},s.__decorate([a.property()],t.default.prototype,"flowItems",void 0),s.__decorate([a.property(),f.messageBundle("esri/widgets/Features/t9n/Features")],t.default.prototype,"messages",void 0),s.__decorate([a.property()],t.default.prototype,"closed",void 0),s.__decorate([a.property()],t.default.prototype,"closable",void 0),s.__decorate([a.property()],t.default.prototype,"selectLastFlowItem",void 0),t.default=s.__decorate([c.subclass("esri.widgets.Features.FeaturesDrillIn")],t.default),t.default});