// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/ResponsiveTheme","../../../intl","../../../core/handleUtils","../../../core/has","../../../core/promiseUtils","../../../core/signal","../../../core/unitFormatUtils","../../../core/unitUtils","../../../core/libs/gl-matrix-2/math/common","./constants","./intlUtils","./niceScale","./profileUtils","../../../chunks/chartUtilsAm5","../../support/widgetUtils","../../../support/modeUtils","../../../chunks/LineSeries","../../../chunks/Theme","../../../chunks/Tooltip","../../../intl/number","../../../intl/substitute"],function(t,e,i,n,o,s,a,l,r,d,c,u,p,x,g,m,f,h,A,v,b,T){"use strict";const y="#f8f8f8",L="#a9a9a9",M="#323232",S={fontFamily:"Avenir Next",paddingBottom:6,paddingLeft:0,paddingRight:0,paddingTop:0,axisGridStroke:"#f4f4f4",axisLabelsFontSize:9,axisLabelsFontWeight:"400",axisLabelsColor:L,axisTooltipFontSize:12,axisTooltipBackgroundColor:M,axisTooltipLabelColor:y,axisTooltipPaddingTop:Math.round(3),axisTooltipPaddingBottom:Math.round(3),axisTooltipPaddingHorizontal:Math.round(3.75),xAxisMinGridDistance:50,xAxisLabelsSpacing:Math.round(6),xAxisMinLabelPosition:.05,xAxisMaxLabelPosition:.9,yAxisMinGridDistance:30,yAxisLabelSpacing:Math.round(3.75),yAxisMinLabelPosition:0,yAxisMaxLabelPosition:.8,seriesTooltipFontSize:12,seriesTooltipBackgroundColor:y,seriesTooltipLabelColor:M,seriesFillLighten:.9,seriesTooltipSpacing:6,seriesTooltipPaddingVertical:Math.round(3.75),seriesTooltipPaddingHorizontal:Math.round(3.75)},F={...S,axisGridStroke:M,axisLabelsColor:L,axisTooltipBackgroundColor:M,axisTooltipLabelColor:y,seriesTooltipBackgroundColor:M,seriesTooltipLabelColor:y,seriesFillLighten:-.75},k={minX:void 0,maxX:void 0,minY:void 0,maxY:void 0};function C(t){return"destroyed"===t.state}function P(t){C(t)||(t.xAxis.zoom(0,1),t.yAxis.zoom(0,1))}function X({data:t,pixelWidth:e,pixelHeight:i}){if(null==t)return k;const n=t.statistics,o=n?.maxDistance;let s=n?.minElevation,a=n?.maxElevation;if(null==o||null==s||null==a)return k;const l=Math.max(o-0,.001);let d=Math.max(a-s,.001);const u=t.effectiveUnits;if(t.dynamicElevationRange){const t=r.convertUnit(l,u.distance,u.elevation);d=Math.max(d,t/c.getConfig().maxChartRatio)}return s-=.02*d,a=s+d+.1*d,[s,a]=p.niceScale(s,a,10),d=a-s,t.uniformScaling?function({data:t,bounds:e,pixelWidth:i,pixelHeight:n,centered:o}){if(null==t)return e;let{minX:s,maxX:a,minY:l,maxY:d}=e;if(null==s||null==a||null==l||null==d)return k;const c=a-s,u=d-l,p=t.effectiveUnits,x=r.convertUnit(u,p.elevation,p.distance)/n/(c/i);return x>=1?[s,a]=Y([s,a],x):[l,d]=Y([l,d],1/x),{minX:s,maxX:a,minY:l,maxY:d}}({data:t,bounds:{minX:0,maxX:o,minY:s,maxY:a},pixelWidth:e,pixelHeight:i,centered:!0}):{minX:0,maxX:0+l,minY:s,maxY:s+d}}function Y([t,e],i,n){const o=(e-t)*i;{const i=(t+e)/2-o/2;return[i,i+o]}}function z({theme:t},e,i){const n=A.color(i.color.toCss()),o=i.samples??[],s=o.length>0,{line:a,fill:l}=e;a.set("visible",s),a.set("stroke",n),l?.set("visible",s),l?.set("fill",A.Color.lighten(n,t.seriesFillLighten)),a.data.setAll(o),l?.data.setAll(o)}function w(t,e){const{id:i}=e,n=H(t,`line-${i}`),o=function({theme:t,chart:e,rtl:i}){const n=v.Tooltip.new(e.root,{autoTextColor:!1,forceHidden:!0,getFillFromSprite:!1,getLabelFillFromSprite:!1,pointerOrientation:"vertical",visible:!1}),o=t.seriesTooltipPaddingHorizontal,s=t.seriesTooltipPaddingVertical;return n.label.setAll({fill:A.color(t.seriesTooltipLabelColor),fontFamily:t.fontFamily,fontSize:t.seriesTooltipFontSize,paddingBottom:s,paddingLeft:o,paddingRight:o,paddingTop:s,textAlign:i?"end":"start",direction:"ltr"}),n.get("background")?.setAll({stroke:void 0,fill:A.color(t.seriesTooltipBackgroundColor)}),n.adapters.add("dy",e=>{const i=t.seriesTooltipSpacing,o=n.get("pointTo")?.y??0;return(e??0)+(n.y()>o?i:-i)}),n}(t);n.setAll({dy:e.chartStrokeOffsetY,tooltip:o}),n.strokes.template.setAll({strokeWidth:e.chartStrokeWidth});let s=null;return e.chartFillEnabled&&(s=H(t,`fill-${i}`),s.fills.template.setAll({fillOpacity:1,visible:!0})),{id:i,line:n,fill:s}}function H(t,e){return h.LineSeries.new(t.chart.root,{connect:!1,excludeFromTotal:!0,fill:void 0,id:e,stroke:void 0,valueXField:"distance",valueYField:"elevation",xAxis:t.xAxis,yAxis:t.yAxis})}function R(t,e){const{xAxis:i,yAxis:n}=t,o=()=>{e(B(i),B(n))},s=t=>[t.on("start",o),t.on("end",o)];return N([...s(i),...s(n)])}function B(t){const e=Math.abs((t.get("end")??0)-(t.get("start")??0)),i=0!==e?1/e:1;return Math.abs(1-i)<d.getEpsilon()?1:i}function U(t,e){const{chart:i,xAxis:n,yAxis:o}=t,s=i.get("cursor"),a=i.plotContainer.events,l=e=>{t.pointerIsOver=e,G(t)},r=()=>{l(!1),e(null,null)};return N([s?.events.on("cursormoved",()=>{if(!t.pointerIsOver)return;G(t);let i=s?.getPrivate("positionX")??0,a=s?.getPrivate("positionY")??0;const l=t.data;if(null!=l?.statistics){const{maxDistance:t,minElevation:e,maxElevation:s}=l.statistics;let r,d;null!=t&&(1===B(n)?(r=0,d=t):(r=I(n),d=$(n)),i=D(i,r,d,0,t)),null!=e&&null!=s&&(1===B(o)?(r=e,d=s):(r=I(o),d=$(o)),a=D(a,r,d,e,s))}e(i,a)}),a.on("pointerover",()=>l(!0)),a.on("pointerout",r),a.on("blur",r)])}function D(t,e,i,n,o){return(e+t*(i-e)-n)/(o-n)}function G(t){const e=function(t){const{data:e}=t,i=e?.lines.map(e=>({line:e,y:E(t,e)?.elevation})).sort(O);return i&&0!==i.length&&null!=i[0].y?i.map(({y:e,line:i})=>function(t,e,i){const{data:n,messages:o}=t;if(null==n||null==o)return"";const s=`[${e.color.toHex()}]●[/]`,a=c.getConfig().formatPrecision,r=T.substitute(o.chartTooltip,{name:u.getTranslatedLineTitle(e,o),elevation:null!=i?l.formatDecimal(o,i,n.effectiveUnits.elevation,a):c.notAvailable});return t.rtl?r+"  "+s:s+"  "+r}(t,i,e)).join("\n"):null}(t);e?(t.seriesInfos.forEach(t=>{const i=t.line.get("tooltip");i.set("forceHidden",!1),i.label.set("text",e)}),t.xAxis.getTooltip().setAll({tooltipText:W(t)})):t.seriesInfos.forEach(t=>{t.line.get("tooltip")?.set("forceHidden",!0)})}function O({y:t},{y:e}){return null==t?1:null==e?-1:e-t}function W(t){const{data:e,messages:i}=t;if(null==e||null==i)return"";const n=e.lines[0],o=n?E(t,n):null,s=c.getConfig().formatPrecision;return null!=o?l.formatDecimal(i,o.distance,e.effectiveUnits.distance,s):"-"}function V(t,e){const i=g.NumberFormatter.new(t.chart.root,{});return i.format=(i,n,o)=>{const{data:s,messages:a}=t;return null==a||null==s||"string"==typeof i?"":`${b.formatNumber(i,{maximumFractionDigits:o})} ${l.unitName(a,s.effectiveUnits[e],"abbr")}`},i}function E({chart:t,xAxis:e},i){const n=i.samples??[];if(0===n.length)return null;const o=t.get("cursor"),s=o?.getPrivate("positionX")??0,a=e.toAxisPosition(s),l=e.positionToValue(a);return x.binaryFindClosest(n,l,t=>t.distance)}function I(t){return t.positionToValue(t.get("start")??0)}function $(t){return t.positionToValue(t.get("end")??1)}function N(t){return n.handlesGroup(t.map(j))}function j(t){return n.makeHandle(()=>{t?.dispose()})}t.createChart=async function(t){const i=await g.createRoot(t.container);s.throwIfAborted(t.abortOptions);const o=f.isDarkMode(),l=o?F:S;i.setThemes(o?[e.ResponsiveTheme.new(i),e.DarkTheme.new(i)]:[e.ResponsiveTheme.new(i)]);const r=m.isRTL(t.container),d=i.container.children.push(h.XYChart.new(i,{panX:!0,panY:!0,paddingTop:l.paddingTop,paddingBottom:l.paddingBottom,paddingLeft:r?l.paddingRight:l.paddingLeft,paddingRight:r?l.paddingLeft:l.paddingRight,maxTooltipDistance:-1}));d.zoomOutButton.set("forceHidden",!0);const u=d.xAxes.push(h.ValueAxis.new(i,{renderer:h.AxisRendererX.new(i,{})})),p=d.yAxes.push(h.ValueAxis.new(i,{renderer:h.AxisRendererY.new(i,{})})),x=a.signal(null),b=a.signal("loading"),T={chart:d,xAxis:u,yAxis:p,seriesInfos:new Map,messages:null,theme:l,pointerIsOver:!1,rtl:r,get state(){return b.value},get data(){return x.value},set data(t){x.value=t}};!function(t){const{chart:e,xAxis:i,theme:n}=t;i.setAll({extraMax:0,extraMin:0,maxDeviation:0,numberFormatter:V(t,"distance"),strictMinMax:!0,strictMinMaxSelection:!0}),i.axisHeader.set("forceHidden",!0);const o=i.get("renderer");o.setAll({inside:!1,minGridDistance:n.xAxisMinGridDistance}),o.labels.template.setAll({centerX:A.p0,centerY:A.p0,fill:A.color(n.axisLabelsColor),fontFamily:n.fontFamily,fontSize:n.axisLabelsFontSize,fontWeight:n.axisLabelsFontWeight,maxPosition:n.xAxisMaxLabelPosition,minPosition:n.xAxisMinLabelPosition,paddingLeft:0,paddingRight:0,paddingTop:n.xAxisLabelsSpacing});const s=i.set("tooltip",v.Tooltip.new(e.root,{paddingBottom:0,paddingLeft:0,paddingRight:0,paddingTop:0}));s.get("background")?.setAll({fill:A.color(n.axisTooltipBackgroundColor),stroke:void 0}),s.label.setAll({fill:A.color(n.axisTooltipLabelColor),fontFamily:n.fontFamily,fontSize:n.axisTooltipFontSize,paddingBottom:n.axisTooltipPaddingBottom,paddingLeft:n.axisTooltipPaddingHorizontal,paddingRight:n.axisTooltipPaddingHorizontal,paddingTop:n.axisTooltipPaddingTop,direction:t.rtl?"rtl":"ltr"}),o.grid.template.setAll({strokeOpacity:1,stroke:A.color(n.axisGridStroke)})}(T),function(t){const{yAxis:e,theme:i,rtl:n}=t;e.setAll({baseValue:c.getConfig().noDataValue,extraMax:0,extraMin:0,maxDeviation:0,numberFormatter:V(t,"elevation"),strictMinMax:!0,strictMinMaxSelection:!0,tooltip:void 0}),e.axisHeader.set("visible",!1);const o=e.get("renderer");o.setAll({minGridDistance:i.yAxisMinGridDistance,opposite:n,inside:!0}),o.labels.template.setAll({centerX:A.p0,centerY:A.p100,fill:A.color(i.axisLabelsColor),fontFamily:i.fontFamily,fontSize:i.axisLabelsFontSize,fontWeight:i.axisLabelsFontWeight,maxPosition:i.yAxisMaxLabelPosition,minPosition:i.yAxisMinLabelPosition,paddingBottom:0,paddingLeft:n?0:i.yAxisLabelSpacing,paddingRight:n?i.yAxisLabelSpacing:0,paddingTop:0,textAlign:"start"}),o.grid.template.setAll({strokeOpacity:1,stroke:A.color(i.axisGridStroke)})}(T),function({chart:t,xAxis:e,yAxis:i}){const n=h.XYCursor.new(t.root,{behavior:"none",xAxis:e,yAxis:i,snapToSeriesBy:"y"});n.lineY.set("visible",!1),t.set("cursor",n)}(T);const y=n.handlesGroup([R(T,t.onRangeChange),U(T,t.onCursorPositionChange),j(i.events.once("frameended",()=>{b.value="ready"})),j(i)]);return{destroy:()=>{y.remove(),b.value="destroyed"},update:t=>{t.data===T.data&&t.messages===T.messages||C(T)||function(t,e){if(C(t))return;const i=t.data??void 0,n=e.data??void 0;t.chart.get("cursor")?.set("forceHidden",!n?.refined);const o=i!==n,s=i?.effectiveUnits!==n?.effectiveUnits,a=i?.uniformScaling!==n?.uniformScaling;t.data=n,t.messages=e.messages,(o||s)&&(function(t){const{chart:e,data:i,xAxis:n,yAxis:o}=t,{minX:s,maxX:a,minY:l,maxY:r}=X({data:i,pixelWidth:n.width(),pixelHeight:o.height()}),d=!!i?.uniformScaling,c=!!i?.refined;e.setAll({panX:!0,panY:d,pinchZoomX:c,pinchZoomY:c&&d,wheelX:"panX",wheelY:c?d?"zoomXY":"zoomX":"none"}),n.setAll({max:a,min:s,panX:!0,panY:!1,zoomX:!0,zoomY:d}),o.setAll({max:r,min:l,panX:!1,panY:d,zoomX:d,zoomY:d})}(t),function(t){const{chart:e,data:i,seriesInfos:n,xAxis:o,yAxis:s}=t;if(null==i||0===i.lines.length)return void e.series.clear();const a=new Map,l=new Set(e.series.values),r=i.lines.length;for(let o=0;o<r;o++){const s=i.lines[o];let d=n.get(s.id);d?(d.fill&&l.delete(d.fill),l.delete(d.line)):(d=w(t,s),d.fill&&e.series.push(d.fill),e.series.push(d.line)),a.set(d.id,d);const c=r-o-1;d.fill?.set("layer",c),d.line.set("layer",r+c),z(t,d,s)}t.seriesInfos=a;for(const t of l)e.series.removeValue(t);o.set("layer",r+1),s.set("layer",r+2)}(t)),a&&P(t),G(t)}(T,t)},zoomOut:()=>P(T),test:void 0}},t.getAdjustedBounds=X,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});