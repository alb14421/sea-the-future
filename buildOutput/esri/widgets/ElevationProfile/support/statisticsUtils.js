// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/arrayUtils","../../../core/unitUtils","./constants"],function(t,e,n,l){"use strict";function i(t,e){return null==e?t:null!=t?Math.min(t,e):e}function a(t,e){return null==e?t:null!=t?Math.max(t,e):e}function o(t,e){return null!=t&&null!=e?t*e:null}class s{constructor(){this._start=0,this._totalElevation=0,this._sampleCount=0}get avgElevation(){return this._totalElevation/this._sampleCount}get isHole(){return 0===this._sampleCount}get start(){return this._start}copy(t){this._start=t._start,this._sampleCount=t._sampleCount,this._totalElevation=t._totalElevation}reset(){this._start=0,this._sampleCount=0,this._totalElevation=0}restart(t,e){this._start=t,this._sampleCount=1,this._totalElevation=e}insert(t){++this._sampleCount,this._totalElevation+=t}}t.getBoundsInMeters=function(t){let e=null,l=null,s=null;for(const r of t){if(null==r)continue;const{statistics:t,spatialReference:u}=r;if(null==t)continue;const c=n.getMetersPerUnitForSR(u);e=a(e,o(t.maxDistance,c));const v=n.getMetersPerVerticalUnitForSR(u);s=i(s,o(t.minElevation,v)),l=a(l,o(t.maxElevation,v))}return{minDistance:0,maxDistance:e??0,minElevation:s??0,maxElevation:l??0}},t.getStatistics=function(t,e){const o=t.length;if(0===o)return null;const r=t[0],u=r.sampledZ;let c=u,v=u,m=0,g=0,p=null,f=null,h=null!=u?u:0,E=0,S=0,x=null!=u?1:0,_=0,d=0;const P=n.getMetersPerUnitForSR(e),C=n.getMetersPerVerticalUnitForSR(e),M=l.getConfig().minSlopeSampleDistance/P,D=2*M,U=new s,N=new s,y=()=>{R(),U.copy(N),N.reset()},H=(t,e)=>{y(),t>0&&t-U.start<=D&&(t=U.start+M),N.restart(t,e)},R=()=>{if(U.isHole||N.isHole)return;const t=N.avgElevation-U.avgElevation,e=N.start-U.start,l=t*C,i=e*P,o=n.convertUnit(Math.atan2(l,i),"radians","degrees");o>0?(E+=o,p=a(p,o),_++):o<0&&(S-=o,f=a(f,-o),d++)};null!=r.sampledZ&&H(r.distance,r.sampledZ);for(let e=1;e<o;++e){const n=t[e-1],l=t[e],o=l.sampledZ;if(null==o){N.isHole||y();continue}x++,h+=o,c=i(c,o),v=a(v,o),N.isHole||l.distance-N.start>=M?H(l.distance,o):N.insert(o);const s=n.sampledZ;if(null!=s){const t=o-s;t>0?m+=t:t<0&&(g-=t)}}return y(),0===x?null:{maxDistance:t[o-1].distance,minElevation:c,maxElevation:v,avgElevation:0===x?null:h/x,elevationGain:m,elevationLoss:g,maxPositiveSlope:p,maxNegativeSlope:f,avgPositiveSlope:0===_?null:E/_,avgNegativeSlope:0===d?null:S/d}},t.mergeStatistics=function(t){const n=t.filter(e.isSome),l=n.length;if(0===l)return null;const o=n[0];if(1===l)return o;let s=o.maxDistance,r=o.minElevation,u=o.maxElevation,c=o.maxPositiveSlope,v=o.maxNegativeSlope;for(let t=1;t<n.length;++t){const e=n[t];s=a(s,e.maxDistance),r=i(r,e.minElevation),u=a(u,e.maxElevation),c=a(c,e.maxPositiveSlope),v=a(v,e.maxNegativeSlope)}return{maxDistance:s,minElevation:r,maxElevation:u,avgElevation:null,elevationGain:null,elevationLoss:null,maxPositiveSlope:c,maxNegativeSlope:v,avgPositiveSlope:null,avgNegativeSlope:null}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});