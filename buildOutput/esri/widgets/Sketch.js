// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/interactive/sketch/SketchValueOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./Units"],function(e,t,o,r,i,n,s,a,l){"use strict";return e.default=class extends o{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?"relative-bilateral":"relative";case"absolute":return"absolute"}}get displayUnits(){return this._get("displayUnits")??new l}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new l}set inputUnits(e){this._set("inputUnits",e)}},t.__decorate([r.property({type:String,nonNullable:!0})],e.default.prototype,"directionMode",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"relativeDirectionIsBilateral",void 0),t.__decorate([r.property()],e.default.prototype,"effectiveDirectionMode",null),t.__decorate([r.property({type:l,nonNullable:!0})],e.default.prototype,"displayUnits",null),t.__decorate([r.property({type:l,nonNullable:!0})],e.default.prototype,"inputUnits",null),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchValueOptions")],e.default),e.default})},"esri/views/interactive/sketch/Units":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s,a){"use strict";return e.default=class extends o{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}},t.__decorate([r.property()],e.default.prototype,"length",void 0),t.__decorate([r.property()],e.default.prototype,"verticalLength",void 0),t.__decorate([r.property()],e.default.prototype,"area",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.Units")],e.default),e.default})},"esri/widgets/Sketch/SketchViewModel":function(){define(["require","exports","../../chunks/tslib.es6","../../core/Collection","../../core/Error","../../core/Evented","../../core/handleUtils","../../core/has","../../core/Logger","../../core/maybe","../../core/promiseUtils","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles","../../geometry/ellipsoidUtils","../../geometry/projectionUtils","../../geometry/support/coordsUtils","../../geometry/support/spatialReferenceUtils","../../layers/GraphicsLayer","../../layers/support/layerUtils","../../symbols/FillSymbol3DLayer","../../symbols/MeshSymbol3D","../../symbols/SimpleFillSymbol","../../symbols/SimpleLineSymbol","../../symbols/SimpleMarkerSymbol","../../symbols/support/typeUtils","../../views/3d/interactive/editingTools/isSupportedObjectUtils","../../views/3d/interactive/editingTools/move/isSupportedObject","../../views/3d/interactive/editingTools/reshape/isSupportedObject","../../views/3d/interactive/editingTools/transform/isSupportedGraphic","../../views/draw/support/layerUtils","../../views/input/InputManager","../../views/interactive/keybindings","../../views/interactive/sketch/SketchLabelOptions","../../views/interactive/sketch/SketchOptions","../../views/interactive/sketch/SketchTooltipOptions","../../views/interactive/sketch/SketchValueOptions","../../views/interactive/snapping/SnappingManager","../../views/interactive/snapping/SnappingOptions","../../views/interactive/snapping/snappingUtils","../../views/support/automaticAreaMeasurementUtils","../../views/support/automaticLengthMeasurementUtils","../../views/support/HighlightDefaults","../../views/support/hitTestSelectUtils","../../views/support/screenUtils","./support/OperationHandle","./support/sketchUtils"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g,f,m,v,_,b,w,S,M,T,x,C,L,O,k,E,P,A,I,G,R,V,U,H,D,F,j,z,q,N,B,W,K,Z){"use strict";const $=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),Q={defaultZ:0},Y={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:N.defaultHighlightName},tool:"transform"},J=Symbol();t.default=class extends n.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new g.UpdatingHandles,this._internalGraphicsLayer=new b({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new C({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new T({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new x({color:[130,130,130,1],width:2}),this.meshSymbol=new M({symbolLayers:new r([new S])}),this.updateGraphics=new r,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new C({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new V,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Q,this.defaultUpdateOptions=Y,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new F}initialize(){this.addHandles([d.on(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),d.on(()=>this.layer?.graphics,"change",e=>{if(null!=this._operationHandle)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),d.watch(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},d.syncAndInitial),d.watch(()=>this.view,t=>{this._defaultSnappingManager=c.destroyMaybe(this._defaultSnappingManager),t&&(this.snappingManager||(this._defaultSnappingManager=new D.SnappingManager({view:t,options:this.snappingOptions})),"2d"===t.type?new Promise((t,o)=>e(["../../views/2d/interactive/editingTools"],t,o)):"3d"===t.type&&(new Promise((t,o)=>e(["../../views/3d/interactive/editingTools"],t,o)),new Promise((t,o)=>e(["../../views/3d/layers/GraphicsLayerView3D"],e=>t($(e)),o))))},d.syncAndInitial),d.watch(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),j.setupSnappingToggleHandles(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=c.destroyMaybe(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||null!=this.snappingManager&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return"create"===this._operationHandle?.type&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,o=!t&&e&&"tooltip"in e?e.tooltip:null;return o?.visible?o:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return null==this.activeComponent||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Q,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Y,...e,reshapeOptions:{...Y.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...Y.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){null!=this._defaultSnappingManager&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=c.destroyMaybe(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:e}=this;!this._defaultSnappingManager&&e&&(this._defaultSnappingManager=new D.SnappingManager({options:this.snappingOptions,view:e})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:e,map:o}=t;e&&this._clearCursor(),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const o="view-ready";this.removeHandles(o),e&&this.addHandles(d.when(()=>e.ready,t=>{this.removeHandles(this._viewHandlesKey),t&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},d.syncAndInitial),o),this._set("view",e)}cancel(){this._moduleLoaderAbortController=c.abortMaybe(this._moduleLoaderAbortController),this._viewReadyAbortController=c.abortMaybe(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if("active"===e&&t.length){const{activeTool:e,layer:o}=this,r=t.toArray();o.removeMany(r),this.cancel(),this._emitDeleteEvent({graphics:r,tool:e})}}duplicate(){if("active"===this.state&&this.updateGraphics.length){const e=this.updateGraphics.map(e=>e.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:o,layer:r}=this;if(!o||"disabled"===this.state)throw r||this._logMissingLayer(),p.createAbortError();if(null!=o.activeTool&&(o.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");A.addUniqueLayer(o,this._internalGraphicsLayer);const i=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));null==i||this.destroyed?o.map.remove(this._internalGraphicsLayer):(i.on("complete",()=>{if(i===this._operationHandle){const o=this.createGraphic,n=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),i.cancelled||null==o||r.add(o),this._sketchContinuationFlag=!1,this.emit("create",{graphic:o,state:n?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),n||this._sketchContinuationFlag)return;const{creationMode:s}=this;if("continuous"===s){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(p.ignoreAbortErrors(this.create(e,t)))}else"update"===s&&o&&this._updatingHandles.addPromise(p.ignoreAbortErrors(this.update([o])))}}),this._operationHandle=i,o.ready&&o.focus())}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:o,view:r,state:i}=this;if(!r||"disabled"===i)throw o||this._logMissingLayer(),p.createAbortError();null!=r.activeTool&&(r.activeTool=null);const n=Array.isArray(e)?e:[e];if(null==e||!n?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(n.some(e=>e.layer!==o?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):null==e.geometry&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const s=await this._updatingHandles.addPromise(this._setupUpdateOperation(n,t));this.destroyed||null==s||ae(s)||(A.addUniqueLayer(r,this._internalGraphicsLayer),this._setUpdateOperationHandle(s,t),this.emit("update",{graphics:n,state:"start",aborted:!1,tool:s.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const o of e)null==o.geometry||"mesh"===o.geometry.type||_.equals(o.geometry.spatialReference,t.spatialReference)||(m.canProjectWithoutEngine(o.geometry.spatialReference,t.spatialReference)||m.isLoaded()||await m.load(),o.geometry=m.project(o.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if("2d"===t.type){const o=[];t.map.allLayers.forEach(e=>{"vector-tile"!==e.type&&"imagery"!==e.type||o.push(e)});const r=await t.hitTest(e,{exclude:o});return B.findFirstGraphicHit(r.results)}const o=[t.map.ground];t.map.allLayers.forEach(e=>{w.isIntegratedMeshLayer(e.type)&&o.push(e)});const r=await t.hitTest(e,{exclude:o});if(r.results.length>0){const e=r.results[0];if(null!=e&&"graphic"===e.type&&e.graphic&&(!r.ground.mapPoint||t.map.ground.opacity<1||r.ground.distance-(e.distance??0)>-Math.min(3*r.ground.distance,"global"===t.viewingMode?f.getReferenceEllipsoid(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null}_generateViewHandles(e){return[e.on("immediate-click",async e=>{const t="active"===this.state&&"create"===this._operationHandle?.type;"disabled"!==this.state&&!t&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(e))},I.ViewEventPriorities.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer(()=>this._getFirstHit(W.createScreenPointFromEvent(e)));let o=null;if(null!=t){const r=t.graphic;this.updateGraphics.includes(r)||r.layer===this.layer?(e.stopPropagation(),o=r):"2d"!==this.view?.type||this._isComponentGraphic(r)||"active"!==this.state||this.cancel()}else"active"===this.state&&this.cancel();null==o||this.updateGraphics.includes(o)||await this.update([o],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const o=this.view;if(!o)return this._logMissingView(),null;const r={hasZ:"3d"===o.type,...this.defaultCreateOptions,...t},i=await this._setupDrawGraphicTool(e,o,r);return null==i?null:(o.tools.add(i),o.activeTool=i,this._setupCreateOperationHandle(i))}async _setupDrawGraphicTool(e,t,o){if("multipoint"===e&&"3d"===t.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:r,defaultZ:i,hasZ:n,geometryToPlace:s,graphicProperties:a,mode:l,preserveAspectRatio:c}=o,p=Z.getModeFromCreateOptions(l,e),d=Z.getDrawToolGeometryTypeFromCreateTool(e),u=o?.optionsPerTool?.has(e)?o.optionsPerTool.get(e):{},h=u?.preserveAspectRatio??c??"rectangle"!==e,y={centered:"rectangle"!==e&&!("circle"===e&&!h),cursor:r,defaultZ:i,forceUniformSize:h,graphicProperties:{...a,attributes:{...a?.attributes}},geometryToPlace:s,geometryType:d,mode:p,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:n,snappingManager:this.snappingManager,snapToScene:!1,view:t,...u};return"2d"===t.type?this._makeDrawGraphicTool2D(y):this._makeDrawGraphicTool3D(y)}async _makeDrawGraphicTool2D(t){const[o,r,i]=await Promise.all([this._requireModule(new Promise((t,o)=>e(["../../views/2d/interactive/editingTools"],t,o))),z.loadAutomaticAreaMeasurementUtils(),q.loadAutomaticLengthMeasurementUtils()]);return ae(o)||this.destroyed?null:new o.module.DrawGraphicTool2D({...t,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:(n=t.geometryType,"polygon"===n||"rectangle"===n||"circle"===n?this.activeFillSymbol:null),sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:i});var n}async _makeDrawGraphicTool3D(t){const[o,r,i]=await Promise.all([this._requireModule(new Promise((t,o)=>e(["../../views/3d/interactive/editingTools"],t,o))),z.loadAutomaticAreaMeasurementUtils(),q.loadAutomaticLengthMeasurementUtils()]);if(ae(o)||this.destroyed)return null;const{elevationInfo:n}=this.layer;return new o.module.DrawGraphicTool3D({...t,elevationInfo:n,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:r,automaticLengthMeasurementUtils:i})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let o=null;const r=e.forceUniformSize,i=e.centered,n=[t.on("key-down",t=>{if(t.key===G.sketchKeys.pan)t.stopPropagation(),t.repeat||(e.enabled=!1);else if(t.key===G.sketchKeys.complete)t.stopPropagation(),e.completeCreateOperation();else if(t.key!==G.sketchKeys.vertexAdd||t.repeat)t.key===G.sketchKeys.undo?(t.stopPropagation(),a.undo()):t.key===G.sketchKeys.redo?(t.stopPropagation(),a.redo()):t.key!==G.sketchKeys.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType||t.repeat?t.key===G.sketchKeys.center&&(t.repeat||(e.centered=!i,t.stopPropagation())):(e.forceUniformSize=!r,t.stopPropagation());else{const o=e.drawOperation.geometryType;"polyline"!==o&&"polygon"!==o&&"multipoint"!==o||(t.stopPropagation(),e.drawOperation.commitStagedVertex())}},I.ViewEventPriorities.WIDGET),t.on("key-up",t=>{t.key===G.sketchKeys.pan?e.enabled=!0:t.key!==G.sketchKeys.constraint||"rectangle"!==e.geometryType&&"circle"!==e.geometryType?t.key===G.sketchKeys.center&&(e.centered=i,t.stopPropagation()):(e.forceUniformSize=r,t.stopPropagation())},I.ViewEventPriorities.WIDGET),e.on("vertex-add",t=>{switch(o=null==o?"start":"active",t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:o,tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",t=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:t.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",t=>{switch(t.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:t,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",e=>{this._set("createGraphic",e.graphic),o="complete",e.aborted?a&&a.cancel():a&&a.complete()}),d.watch(()=>this._getGraphicSymbolFromTool(e.geometryType),t=>{e.graphicSymbol=t})],a=new K.CreateOperationHandle({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{s.drainHandles(n),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return a}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:o,view:r}=this;if(!r)return this._logMissingView(),null;const i={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let n=i.tool??Y.tool;for(const t of e)o.remove(t),o.add(t);if("3d"===r.type){if(0===e.length)return null;switch(n){case"move":return this._setupMove3DOperation(e,i,r,n);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],i,r);case"transform":return this._setupGraphicTransform3DOperation(e,i,r)}}switch(n){case"move":return this._setupMove2DOperation(e,i,r);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,n,i,r);case"transform":if(1===e.length){const t=e[0].geometry?.type;"point"!==t&&"multipoint"!==t||(n="reshape")}return this._setupTransformOrReshape2DOperation(e,n,i,r)}}async _setupMove3DOperation(t,o,r,i,n=!1){const[a,l]=await Promise.all([this._requireModule(new Promise((t,o)=>e(["../../views/3d/interactive/editingTools"],t,o))),q.loadAutomaticLengthMeasurementUtils()]);if(ae(a))return a;const{ManipulatedObject3DGraphic:c,MoveTool3D:p}=a.module,d=new Map,u=()=>{d.forEach(e=>e.destroy()),d.clear()};for(const e of t){const t=new c({view:r,graphic:e}),o=k.isSupportedObject(t);if(0!==o)return u(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${O.isSupportedObjectResultMessage(o)}).`),null;d.set(e,t)}const h=new p({view:r,enableZ:o.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:l});r.tools.add(h),h.objects.addMany(Array.from(d.values())),n||this.updateGraphics.addMany(t);const y=[],g=new K.UpdateOperationHandle({activeComponent:h,tool:i,type:"update",onEnd:()=>{s.drainHandles(y),se(r,h),u()},undo:()=>{ie(this.view,h),te(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{oe(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:e=>{this.updateGraphics.push(e);const t=new c({view:r,graphic:e});d.set(e,t),h.objects.push(t),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);if(g.history.undo.forEach(e=>e.updates.splice(t,1)),g.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0===this.updateGraphics.length)return void g.complete();const o=d.get(e);o&&(h.objects.remove(o),o.destroy(),d.delete(e))},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===o.toggleToolOnClick)return;if("transform"!==i)return;const e=this.updateGraphics.at(0),t=await this._setupReshape3DOperation(e,o,r,!0);t&&!ae(t)&&(g.onEnd(),g.destroy(),this._setUpdateOperationHandle(t,o))}});return y.push(...this._getHandlesForComponent(g,o),r.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(g,e,o),I.ViewEventPriorities.WIDGET),r.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)},I.ViewEventPriorities.WIDGET)),g}_setupGraphicTransform3DOperation(e,t,o,r=!1){if(1===e.length&&0===P.isSupportedGraphic(e[0])){const i=e[0],n=i.geometry;if(null!=n&&("point"===n.type||"mesh"===n.type))return this._setupPointTransform3DOperation(i,t,o);if(null!=n&&("polygon"===n.type||"polyline"===n.type))return this._setupPolyTransform3DOperation(i,t,o,r)}return this._setupMove3DOperation(e,t,o,"transform",r)}async _setupPointTransform3DOperation(t,o,r){const i="transform",{enableRotation:n,enableScaling:a,enableZ:l}=o,c=await this._requireModule(new Promise((t,o)=>e(["../../views/3d/interactive/editingTools"],t,o)));if(ae(c))return c;const{TransformTool3D:p,ManipulatedObject3DGraphic:d}=c.module,u=new d({graphic:t,view:r}),h=new p({object:u,view:r,enableRotation:n,enableScaling:a,enableZ:l,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});r.tools.add(h),this.updateGraphics.add(t);const y=[],g=new K.UpdateOperationHandle({activeComponent:h,tool:i,type:"update",onEnd:()=>{s.drainHandles(y),se(r,h),u.destroy()},undo:()=>{ie(this.view,h),te(g,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:i})},redo:()=>{oe(g,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:i})},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const t=await this._setupMove3DOperation(this.updateGraphics.toArray(),o,r,"transform",!0);ae(t)||this._setUpdateOperationHandle(t,o)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),g.complete()},toggleTool:()=>{}});return y.push(...this._getHandlesForComponent(g,o),r.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(g,e,o),I.ViewEventPriorities.WIDGET),r.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(g,e)},I.ViewEventPriorities.WIDGET)),g}async _setupPolyTransform3DOperation(t,o,r,i=!1){const n="transform",{enableRotation:a,enableScaling:l,enableZ:c,preserveAspectRatio:p}=o,[d,u]=await Promise.all([this._requireModule(new Promise((t,o)=>e(["../../views/3d/interactive/editingTools"],t,o))),q.loadAutomaticLengthMeasurementUtils()]);if(ae(d))return d;const{ManipulatedObject3DGraphic:h,ExtentTransformTool:y}=d.module,g=this.view?.inputManager?.isModifierKeyDown(G.sketchKeys.constraint),f=new h({view:r,graphic:t}),m=new y({object:f,view:r,enableRotation:a,enableScaling:l,enableZ:c,preserveAspectRatio:!!p!=!!g,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:u});r.tools.add(m),i||this.updateGraphics.add(t);const v=[],_=new K.UpdateOperationHandle({activeComponent:m,tool:n,type:"update",onEnd:()=>{s.drainHandles(v),se(r,m),f.destroy()},canUndo:()=>!m.destroyed&&m.canUndo,undo:()=>{m.destroyed||(m.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},canRedo:()=>!m.destroyed&&m.canRedo,redo:()=>{m.destroyed||(m.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),_.onEnd(),_.destroy();const t=await this._setupMove3DOperation(this.updateGraphics.toArray(),o,r,"transform",!0);ae(t)||this._setUpdateOperationHandle(t,o)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),_.complete()},toggleTool:async()=>{if(1!==this.updateGraphics.length||!1===o.toggleToolOnClick)return;const e=await this._setupReshape3DOperation(t,o,r,!0);e&&!ae(e)&&(_.onEnd(),_.destroy(),this._setUpdateOperationHandle(e,o))}});return v.push(...this._getHandlesForComponent(_,o),r.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(_,e,o),I.ViewEventPriorities.WIDGET),r.on("key-down",e=>this._getCommonUpdateOperationKeyDownHandlers(_,e),I.ViewEventPriorities.WIDGET),r.on("key-down",e=>{e.key!==G.sketchKeys.constraint||e.repeat||(m.preserveAspectRatio=!m.preserveAspectRatio,e.stopPropagation())},I.ViewEventPriorities.WIDGET),r.on("key-up",e=>{e.key===G.sketchKeys.constraint&&(m.preserveAspectRatio=!m.preserveAspectRatio,e.stopPropagation())},I.ViewEventPriorities.WIDGET)),_}async _setupMove2DOperation(e,t,o){const r="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const i=await this._getGraphicMover(e,t,o);if(ae(i))return i;const n=new K.UpdateOperationHandle({activeComponent:i,tool:r,type:"update",onEnd:()=>{this._clearCursor(),s.drainHandles(c),s.drainHandles(l),i.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const e=this.updateGraphics.toArray();te(n,e),n.refreshComponent(),this._emitUndoEvent({graphics:e,tool:r})},redo:()=>{const e=this.updateGraphics.toArray();oe(n,e),n.refreshComponent(),this._emitRedoEvent({graphics:e,tool:r})},addToSelection:async e=>{await this._updatingHandles.addPromise(this._updateSpatialReference(e)),this.updateGraphics.push(e),i.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);n.history.undo.forEach(e=>e.updates.splice(t,1)),n.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),0!==this.updateGraphics.length?i.graphics=o:n.complete()}});let a=!1;const l=[o.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(n,e,t),I.ViewEventPriorities.WIDGET),o.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(n,e),e.key!==G.sketchKeys.constraint||e.repeat||(a=!0,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},I.ViewEventPriorities.WIDGET),o.on("key-up",e=>{e.key===G.sketchKeys.constraint&&a&&(a=!1,i.enableMoveAllGraphics=!i.enableMoveAllGraphics)},I.ViewEventPriorities.WIDGET)],c=this._getHandlesForComponent(n,t);return n}async _setupReshape3DOperation(t,o,r,i=!1){const n="reshape",[a,l,c]=await Promise.all([this._requireModule(new Promise((t,o)=>e(["../../views/3d/interactive/editingTools"],t,o))),z.loadAutomaticAreaMeasurementUtils(),q.loadAutomaticLengthMeasurementUtils()]);if(ae(a))return a;const{ManipulatedObject3DGraphic:p,ReshapeTool3D:d}=a.module,u=new p({view:r,graphic:t}),h=E.isSupportedObject(u);if(0!==h)return u.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${O.isSupportedObjectResultMessage(h)}).`),null;const y=o.reshapeOptions,g=new d({view:r,object:u,enableZVertex:o.enableZ&&"move"===y?.vertexOperation,enableZShape:o.enableZ&&"move"===y?.shapeOperation,enableMoveObject:"move"===y?.shapeOperation||"move-xy"===y?.shapeOperation,enableMidpoints:"split"===y?.edgeOperation,enableEdgeOffset:"offset"===y?.edgeOperation,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:l,automaticLengthMeasurementUtils:c});r.tools.add(g),i||this.updateGraphics.add(u.graphic);const f=[],m=new K.UpdateOperationHandle({activeComponent:g,tool:n,type:"update",onEnd:()=>{s.drainHandles(f),se(r,g),u.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n}))},addToSelection:async e=>{this.updateGraphics.add(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"}),m.onEnd(),m.destroy();const t=await this._setupMove3DOperation(this.updateGraphics.toArray(),o,r,"transform",!0);ae(t)||this._setUpdateOperationHandle(t,o)},removeFromSelection:e=>{this.updateGraphics.remove(e),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"}),m.complete()},toggleTool:async()=>{if(!1===o.toggleToolOnClick)return;m.onEnd(),m.destroy();const e=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),o,r,!0);ae(e)||this._setUpdateOperationHandle(e,o)}});return f.push(...this._getHandlesForComponent(m,o),r.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(m,e,o),I.ViewEventPriorities.WIDGET),r.on("key-down",e=>{this._getCommonUpdateOperationKeyDownHandlers(m,e)},I.ViewEventPriorities.WIDGET)),m}async _setupTransformOrReshape2DOperation(e,t,o,r){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const i="transform"===t?await this._getBox(e,o,r):await this._getReshape(e,o,r);if(ae(i))return i;const n=new K.UpdateOperationHandle({activeComponent:i,type:"update",onEnd:()=>{s.drainHandles(l),s.drainHandles(a),n.activeComponent&&!n.activeComponent.destroyed&&n.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{te(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},redo:()=>{oe(n,this.updateGraphics.toArray()),n.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n.tool})},addToSelection:async e=>{let t=n.activeComponent;if("reshape"===t?.type){const t=[...this.updateGraphics,e];this.updateGraphics.removeAll(),n.onEnd(),n.destroy();const i=await this._setupTransformOrReshape2DOperation(t,"transform",o,r);if(ae(i))return;this._setUpdateOperationHandle(i,o)}else this.updateGraphics.add(e),t.graphics=this.updateGraphics.toArray(),t.refresh(),n.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[e],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:e=>{const t=this.updateGraphics.indexOf(e);n.history.undo.forEach(e=>e.updates.splice(t,1)),n.history.redo.forEach(e=>e.updates.splice(t,1)),this.updateGraphics.remove(e);const o=this.updateGraphics.toArray();if(0===o.length)n.complete();else{const e=o[0].geometry;1!==o.length||null==e||"point"!==e.type&&"multipoint"!==e.type?n.activeComponent.graphics=o:n.toggleTool()}this.emit("update",{graphics:o,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[e],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const e=this.updateGraphics.at(0),t=e.geometry;if(null!=t&&("reshape"===n.tool&&("point"===t.type||"multipoint"===t.type)||"transform"===n.tool&&"extent"===t.type))return;let i=null;"transform"===n.tool?i=await this._getReshape([e],o,r):"reshape"===n.tool&&(i=await this._getBox([e],o,r)),ae(i)||(n.activeComponent?.destroy(),n.activeComponent=i,n.activeComponent&&(s.drainHandles(l),l=this._getHandlesForComponent(n,o)))}}),a=[r.on("immediate-click",e=>this._getCommonUpdateOperationClickHandlers(n,e,o),I.ViewEventPriorities.WIDGET),r.on("key-down",e=>{if(this._getCommonUpdateOperationKeyDownHandlers(n,e),e.key===G.sketchKeys.constraint&&!e.repeat&&n){const e=n.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},I.ViewEventPriorities.WIDGET),r.on("key-up",e=>{if(e.key===G.sketchKeys.constraint&&n){const e=n.activeComponent;e&&"box"===e.type&&(e.preserveAspectRatio=!e.preserveAspectRatio)}},I.ViewEventPriorities.WIDGET)];let l=this._getHandlesForComponent(n,o);return n}async _getGraphicMover(t,o,r){const{enableMoveAllGraphics:i,highlightOptions:n}=o,s=await this._requireModule(new Promise((t,o)=>e(["../../views/draw/support/GraphicMover"],e=>t($(e)),o)));return ae(s)?s:new s.module.default({enableMoveAllGraphics:i,highlightName:n?.name,highlightsEnabled:!!n?.enabled,indicatorsEnabled:!1,graphics:t,view:r,callbacks:{onGraphicMoveStart:({dx:e,dy:t,graphic:o})=>{this._displayCursor("grabbing"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:"move-start"},type:"update"})},onGraphicMove:({dx:e,dy:t,graphic:o})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:"move"},type:"update"}),onGraphicMoveStop:({dx:e,dy:t,graphic:o})=>{this._displayCursor("pointer"),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayCursor("move"),onGraphicPointerOut:()=>this._clearCursor()}})}async _getBox(t,o,r){const{enableRotation:i,enableScaling:n,highlightOptions:s,preserveAspectRatio:a}=o,[l,c]=await Promise.all([this._requireModule(new Promise((t,o)=>e(["../../views/draw/support/Box"],e=>t($(e)),o))),q.loadAutomaticLengthMeasurementUtils()]);if(ae(l))return l;const p=this.view?.inputManager?.isModifierKeyDown(G.sketchKeys.constraint);return new l.module.default({graphics:t,enableRotation:i,enableScaling:n,highlightName:s?.name,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!a!=!!p,layer:this._internalGraphicsLayer,view:r,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:c,callbacks:{onMoveStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMove:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onMoveStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScale:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onScaleStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotate:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onRotateStop:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"})}})}async _getReshape(t,o,r){const{highlightOptions:i,reshapeOptions:n}=o,s="split"===n?.edgeOperation,a="move"===n?.shapeOperation,[l,c,p]=await Promise.all([this._requireModule(new Promise((t,o)=>e(["../../views/draw/support/Reshape"],e=>t($(e)),o))),z.loadAutomaticAreaMeasurementUtils(),q.loadAutomaticLengthMeasurementUtils()]);return ae(l)?l:new l.module.default({enableMidpoints:s,enableMovement:a,graphic:t[0],highlightName:i?.name,highlightsEnabled:!!i?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:c,automaticLengthMeasurementUtils:p,view:r,callbacks:{onReshapeStart:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshape:e=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e},type:"update"}),onReshapeStop:({mover:e,type:t})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e,type:t},type:"update"}),onMoveStart:({dx:e,dy:t,mover:o,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:r},type:"update"}),onMove:({dx:e,dy:t,mover:o,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:r},type:"update"}),onMoveStop:({dx:e,dy:t,mover:o,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e,dy:t,mover:o,type:r},type:"update"}),onVertexAdd:({added:e,type:t,vertices:o})=>{const r=e.map(e=>v.geometryToCoordinates(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:r,vertices:o,type:t},type:"update"})},onVertexRemove:({removed:e,type:t,vertices:o})=>{const r=e.map(e=>v.geometryToCoordinates(e.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:r,vertices:o,type:t},type:"update"})}}})}_getHandlesForComponent(e,t){const o=e.activeComponent;if(!o)return[];switch(o.type){case"graphic-mover":return[o.on("graphic-click",({graphic:o,viewEvent:r})=>{r.native?.shiftKey&&t.multipleSelectionEnabled&&(r.stopPropagation(),e.removeFromSelection(o))}),o.on("graphic-move-start",t=>e.addToHistory(ne(t.allGraphics)))];case"box":return[o.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),o.on("move-start",t=>e.addToHistory(ne(t.graphics))),o.on("rotate-start",t=>e.addToHistory(ne(t.graphics))),o.on("scale-start",t=>e.addToHistory(ne(t.graphics)))];case"reshape":return[o.on("graphic-click",o=>this._onTransformOrReshape2DGraphicClick(e,t,o)),o.on("move-start",t=>e.addToHistory(ne([t.mover]))),o.on("reshape-start",t=>e.addToHistory(ne([t.graphic]))),o.on("vertex-add",t=>e.addToHistory(ne([t.oldGraphic]))),o.on("vertex-remove",t=>e.addToHistory(ne([t.oldGraphic])))];case"move-3d":return[o.events.on("record-undo",({updates:t})=>{e.addToHistory({updates:t})}),o.events.on("move-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-start"},type:"update"})}),o.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:e.dx,dy:e.dy,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move"},type:"update"})}),o.events.on("move-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:e.objects.length>0?e.objects[0].graphic:null,type:"move-stop"},type:"update"})}),o.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[o.events.on("record-undo",({updates:t})=>{e.addToHistory({updates:t})}),o.events.on("translate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-start"},type:"update"})}),o.events.on("translate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move-stop"},type:"update"})}),o.events.on("rotate-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-start"},type:"update"})}),o.events.on("rotate-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate-stop"},type:"update"})}),o.events.on("scale-start",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-start"},type:"update"})}),o.events.on("scale-stop",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale-stop"},type:"update"})}),o.events.on("translate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,dx:e.dxScreen,dy:e.dyScreen,type:"move"},type:"update"})}),o.events.on("rotate",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,angle:e.angle,type:"rotate"},type:"update"})}),o.events.on("scale",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:e.object.graphic,xScale:e.xScale,yScale:e.yScale,type:"scale"},type:"update"})}),o.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[o.events.on("reshape",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})}),o.events.on("move",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...e,mover:e.object.graphic},type:"update"})}),o.events.on("vertex-add",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),o.events.on("vertex-remove",e=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:e,type:"update"})}),o.events.on("immediate-click",o=>{o.shiftKey?this._toggleSelection([o.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,o){const{graphic:r,viewEvent:i}=o;return i.native?.shiftKey&&r.layer===this.layer?(i.stopPropagation(),e.removeFromSelection(r)):t.toggleToolOnClick?(i.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const o=this.view?.map;this._disablePopup(t),e.on("complete",()=>{if(e===this._operationHandle){const r=this.updateGraphics.toArray(),i=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),o&&o.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:r,state:"complete",aborted:e.cancelled,tool:i,toolEventInfo:null,type:"update"})}})}async _getCommonUpdateOperationClickHandlers(e,t,o){const r=W.createScreenPointFromEvent(t),i=await t.defer(()=>this._getFirstHit(r));null!=i&&(t.native.shiftKey&&this._toggleSelection([i.graphic],e,o)||this.updateGraphics.includes(i.graphic))?t.stopPropagation():e.complete()}_toggleSelection(e,t,o){const r=!!o.multipleSelectionEnabled;return e.some(e=>!(null==e||!r||e.layer!==this.layer||(this.updateGraphics.includes(e)?t.removeFromSelection(e):t.addToSelection(e),0)))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const o=t.key;o===G.sketchKeys.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):o===G.sketchKeys.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):o===G.sketchKeys.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&G.sketchKeys.delete.includes(o)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||"update"!==this._operationHandle.type)return;const t=this.activeComponent,o=this.updateGraphics.toArray();null!=t&&("reshape"!==t.type||1===o.length&&"point"===o[0].geometry?.type)&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=c.destroyMaybe(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||null==t)&&(e.attributes?.esriSketchTool||"draw-2d"===t.type&&t.graphic===e||("box"===t.type||"reshape"===t.type)&&t.isUIGraphic(e))}_clearCursor(){this.removeHandles(J)}_displayCursor(e){this.removeHandles(J),this.view?.container&&null!=e&&this.addHandles(this.view.acquireCursor(e,"high"),J)}_logError(e,t,o){l.getLogger(this).error(new i(e,t,o))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const o=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:o}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return d.whenOnce(()=>!this.updating)}_disablePopupEnabled(e){return"3d"!==this.view?.type||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&null==this._originalPopupEnabled&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&null!=this._originalPopupEnabled&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(c.abortMaybe(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await p.whenOrAbort(d.whenOnce(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",ee("view"))}_logMissingLayer(){this._logError(X,ee("layer"))}},o.__decorate([u.property()],t.default.prototype,"_defaultSnappingManager",void 0),o.__decorate([u.property()],t.default.prototype,"updating",null),o.__decorate([u.property({readOnly:!0})],t.default.prototype,"_updatingHandles",void 0),o.__decorate([u.property()],t.default.prototype,"_operationHandle",void 0),o.__decorate([u.property({readOnly:!0})],t.default.prototype,"activeTool",null),o.__decorate([u.property({readOnly:!0})],t.default.prototype,"activeCreateToolDrawMode",null),o.__decorate([u.property()],t.default.prototype,"activeTooltip",null),o.__decorate([u.property({types:L.symbolTypes})],t.default.prototype,"activeFillSymbol",void 0),o.__decorate([u.property()],t.default.prototype,"activeLineSymbol",void 0),o.__decorate([u.property()],t.default.prototype,"activeVertexSymbol",void 0),o.__decorate([u.property()],t.default.prototype,"allowDeleteKey",void 0),o.__decorate([u.property({readOnly:!0})],t.default.prototype,"createGraphic",null),o.__decorate([u.property()],t.default.prototype,"defaultCreateOptions",null),o.__decorate([u.property()],t.default.prototype,"defaultUpdateOptions",null),o.__decorate([u.property({type:R,nonNullable:!0})],t.default.prototype,"labelOptions",null),o.__decorate([u.property()],t.default.prototype,"layer",void 0),o.__decorate([u.property({types:L.symbolTypes})],t.default.prototype,"pointSymbol",void 0),o.__decorate([u.property({types:L.symbolTypes})],t.default.prototype,"polygonSymbol",void 0),o.__decorate([u.property({types:L.symbolTypes})],t.default.prototype,"polylineSymbol",void 0),o.__decorate([u.property()],t.default.prototype,"meshSymbol",void 0),o.__decorate([u.property({type:F,nonNullable:!0})],t.default.prototype,"snappingOptions",null),o.__decorate([u.property()],t.default.prototype,"snappingManager",null),o.__decorate([u.property({readOnly:!0})],t.default.prototype,"state",null),o.__decorate([u.property({type:U,nonNullable:!0})],t.default.prototype,"tooltipOptions",null),o.__decorate([u.property({readOnly:!0})],t.default.prototype,"updateGraphics",void 0),o.__decorate([u.property()],t.default.prototype,"updateOnGraphicClick",void 0),o.__decorate([u.property()],t.default.prototype,"creationMode",void 0),o.__decorate([u.property({type:H,nonNullable:!0})],t.default.prototype,"valueOptions",null),o.__decorate([u.property({types:L.symbolTypes})],t.default.prototype,"vertexSymbol",void 0),o.__decorate([u.property({value:null})],t.default.prototype,"view",null),o.__decorate([u.property({constructOnly:!0,type:V})],t.default.prototype,"sketchOptions",void 0),t.default=o.__decorate([y.subclass("esri.widgets.Sketch.SketchViewModel")],t.default);const X="sketch:missing-property",ee=e=>`Property '${e}' is missing on SketchViewModel.`;function te(e,t){re("undo",e.history.undo,e.history.redo,t)}function oe(e,t){re("redo",e.history.redo,e.history.undo,t)}function re(e,t,o,r){const i=t.pop();if(!i)return;const n=i.updates,s=[];r.forEach((t,o)=>{const r=n[o];null!=r&&("geometry"in r&&null!=r.geometry&&(s.push({geometry:t.geometry}),t.geometry=r.geometry),"symbol"in r&&null!=r.symbol&&(s.push({symbol:t.symbol}),t.symbol=r.symbol),"undo"in r&&(s.push(r),r[e](t)))}),o.push({updates:s})}function ie(e,t){null!=e&&t.hasGrabbedManipulators&&(e.activeTool=null)}function ne(e){return{updates:e.map(({geometry:e})=>"mesh"===e?.type?{geometry:e.cloneShallow()}:{geometry:e})}}function se(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function ae(e){return"requireError"in e&&"aborted"===e.requireError}return t.default})},"esri/layers/GraphicsLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/support/OwningCollection","./Layer","./mixins/BlendLayer","./mixins/ScaleRangeLayer","../support/GraphicsCollection","../symbols/support/ElevationInfo"],function(e,t,o,r,i,n,s,a,l,c,p,d,u){"use strict";return e.default=class extends(c.BlendLayer(p.ScaleRangeLayer(l))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new d.GraphicsCollection,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}get loaded(){return super.loaded}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}graphicChanged(e){this.emit("graphic-update",e)}},t.__decorate([o.property({type:u})],e.default.prototype,"elevationInfo",void 0),t.__decorate([o.property(a.owningCollectionProperty(d.GraphicsCollection,"graphics"))],e.default.prototype,"graphics",void 0),t.__decorate([o.property({type:["show","hide"]})],e.default.prototype,"listMode",void 0),t.__decorate([o.property()],e.default.prototype,"screenSizePerspectiveEnabled",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property({constructOnly:!0})],e.default.prototype,"internal",void 0),e.default=t.__decorate([s.subclass("esri.layers.GraphicsLayer")],e.default),e.default})},"esri/views/3d/interactive/editingTools/isSupportedObjectUtils":function(){define(["exports","../../../../core/has"],function(e,t){"use strict";e.isSupportedObjectResultMessage=function(e){switch(e){case 0:break;case 1:return"not owned by a graphics layer";case 2:return"no geometry";case 3:return"the geometry type is not supported";case 4:return"the elevation mode is not supported";case 5:return"the symbol type is not supported"}return""},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/interactive/editingTools/move/isSupportedObject":function(){define(["exports","../../../../../core/has","../../../../../support/elevationInfoUtils"],function(e,t,o){"use strict";e.isSupportedObject=function(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return 1;const t=e.operations?.data.type;if(!t)return 3;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return 3}const r=e.elevationInfo;return o.hasEffectiveFeatureExpressionInfo(r)?4:0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/elevationInfoUtils":function(){define(["exports","../core/unitUtils","../symbols/support/unitConversionUtils"],function(e,t,o){"use strict";function r(e){return e?g:f}function i(e,t){return t?.mode?t.mode:r(e).mode}function n(e,t){return null!=t?t:r(e)}function s(e,t){return i(null==e||(e.hasZ??!1),t)}function a(e){const t=p(e),o=s(e.geometry,t),r=null!=t&&"on-the-ground"!==o?y(t):0,i=t?.featureExpressionInfo;return{mode:o,offset:r,featureExpressionInfo:i}}function l(e){return"0"===e?.featureExpressionInfo?.expression}function c(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function p(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function d(e,o){if(!e?.offset)return 0;const{offset:r,unit:i}=e;if("decimal-degrees"===i)return 0;const n="unknown"!==i&&i?i:"meters",s=t.verticalLengthUnitFromSpatialReference(o);return s?t.convertUnit(r,n,s):0}function u(e,t,o,r,i,n,s=null){if(null==n)return;const a=null!=s?s.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=h(t,o,r,i,e,n);return function(e,t,o,r,i,n,s,a){const l=d(s,i);switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-((n.elevationProvider.getElevation(t,o,r,i,"ground")??0)+l);case"relative-to-scene":return e-((n.elevationProvider.getElevation(t,o,r,i,"scene")??0)+l)}}(l,t,o,r,i,e,s,a)}function h(e,t,o,r,i,n){const s=d(n,r);switch(n.mode){case"absolute-height":return{absoluteZ:o+s,elevation:0};case"on-the-ground":{const o=i.elevationProvider.getElevation(e,t,0,r,"ground")??0;return{absoluteZ:o,elevation:o}}case"relative-to-ground":{const n=i.elevationProvider.getElevation(e,t,o,r,"ground")??0;return{absoluteZ:o+n+s,elevation:n}}case"relative-to-scene":{const n=i.elevationProvider.getElevation(e,t,o,r,"scene")??0;return{absoluteZ:o+n+s,elevation:n}}}}function y(e){return(e?.offset??0)*o.getMetersPerUnit(e?.unit)}const g={mode:"absolute-height",offset:0},f={mode:"on-the-ground",offset:null};e.absoluteHeightElevationInfo=g,e.elevationContextAffectsAlignment=function(e,t){if(null==t)return!1;const{mode:o}=t;return null!=o&&("scene"===e&&"relative-to-scene"===o||"ground"===e&&"absolute-height"!==o)},e.elevationModeRequiredMessage=function(e,t,o){return o&&o.mode!==t?`${e} only support ${t} elevation mode`:null},e.elevationModeUnsupportedMessage=function(e,t,o){return o?.mode===t?`${e} do not support ${t} elevation mode`:null},e.featureExpressionInfoIsZero=l,e.featureExpressionUnsupportedMessage=function(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null},e.getConvertedElevation=function(e,t,o,r=null){return u(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,o,r)},e.getConvertedElevationFromVector=function(e,t,o,r,i=null){return u(e,t[0],t[1],t.length>2?t[2]:0,o,r,i)},e.getConvertedElevationFromXYZ=u,e.getEffectiveElevationInfo=n,e.getEffectiveElevationMode=i,e.getElevationOffset=d,e.getElevationOffsetInMeters=y,e.getGeometryEffectiveElevationInfo=function(e,t){return n(null==e||(e.hasZ??!1),t)},e.getGeometryEffectiveElevationMode=s,e.getGraphicEffectiveElevationInfo=a,e.getGraphicEffectiveElevationMode=function(e){const t=p(e);return s(e.geometry,t)},e.getZForElevationMode=function(e,t,o){if(!o?.mode)return;const r=e.hasZ?e.z:0,i=d(o,e.spatialReference);switch(o.mode){case"absolute-height":return r-i;case"on-the-ground":return 0;case"relative-to-ground":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"ground")??0)+i);case"relative-to-scene":return r-((t.elevationProvider.getElevation(e.x,e.y,r,e.spatialReference,"scene")??0)+i)}},e.hasEffectiveFeatureExpressionInfo=c,e.hasFeatureExpressionInfo=function(e){return c(e)||l(e)},e.hasGraphicFeatureExpressionInfo=function(e){return c(a(e))},e.logInvalidElevationInfoWarning=function(e,t){t&&e.warn(".elevationInfo=",t)},e.onTheGroundElevationInfo=f,e.zValueInAbsoluteHeightMode=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/interactive/editingTools/reshape/isSupportedObject":function(){define(["exports","../../../../../support/elevationInfoUtils"],function(e,t){"use strict";e.isSupportedObject=function(e){return function(e){if(e.graphic&&"graphics"!==e.graphic.layer?.type)return{result:1};if(!e.operations)return{result:2};if(t.hasEffectiveFeatureExpressionInfo(e.elevationInfo))return{result:4};const o=e.operations.data.type,r=e.operations.data.geometry;return"point"===o||"mesh"===o||"polyline"===o||"polygon"===o?{result:0,geometry:r}:{result:3}}(e).result},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/interactive/editingTools/transform/isSupportedGraphic":function(){define(["exports","../../../../../core/has","../../../../../support/elevationInfoUtils"],function(e,t,o){"use strict";e.isSupportedGraphic=function(e){if("graphics"!==e.layer?.type)return 1;if(null==e.geometry)return 2;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return 0;default:return 3}const t=null!=e.symbol&&"point-3d"===e.symbol.type&&e.symbol.symbolLayers;return t&&t.some(e=>"object"===e.type)?"on-the-ground"!==o.getGraphicEffectiveElevationMode(e)&&o.hasGraphicFeatureExpressionInfo(e)?4:0:5},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/draw/support/layerUtils":function(){define(["exports","../../../layers/support/editableLayers","../../../layers/support/layerUtils"],function(e,t,o){"use strict";e.addUniqueLayer=function(e,t,o){if(!t||!e?.map)return;const{map:r}=e,i=r.layers.find(e=>e===t);i||r.add(t,o),i&&null!=o&&r.layers.reorder(i,o)},e.findLayerView=function(e,t){const o="subtype-sublayer"===t?.type?t.parent:t;return e.allLayerViews.find(e=>{const t=e.layer;return t===o||"sublayers"in t&&null!=t.sublayers&&t.sublayers.includes(o)})},e.isConnectedReshapeSupportedLayer=function(e){return t.isEditableLayer(e)||o.isSubtypeSublayer(e)||o.isGraphicsLayer(e)||o.isKnowledgeGraphSublayer(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/sketch/SketchLabelOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s,a){"use strict";return e.default=class extends o{constructor(e){super(e),this.enabled=!1}},t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"enabled",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchLabelOptions")],e.default),e.default})},"esri/views/interactive/sketch/SketchOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./SketchLabelOptions","./SketchTooltipOptions","./SketchValueOptions"],function(e,t,o,r,i,n,s,a,l,c,p){"use strict";return e.default=class extends o{constructor(e){super(e),this.labels=new l,this.tooltips=new c,this.values=new p}},t.__decorate([r.property({nonNullable:!0,type:l})],e.default.prototype,"labels",void 0),t.__decorate([r.property({nonNullable:!0,type:c})],e.default.prototype,"tooltips",void 0),t.__decorate([r.property({nonNullable:!0,type:p})],e.default.prototype,"values",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchOptions")],e.default),e.default})},"esri/views/interactive/sketch/SketchTooltipOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./SketchTooltipElevationOptions","./SketchTooltipVisibleElements"],function(e,t,o,r,i,n,s,a,l,c){"use strict";return e.default=class extends o{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new l.SketchTooltipElevationOptions,this.placement="auto",this.offset=null,this.visibleElements=new c,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}},t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"enabled",void 0),t.__decorate([r.property()],e.default.prototype,"forceEnabled",void 0),t.__decorate([r.property()],e.default.prototype,"effectiveEnabled",null),t.__decorate([r.property()],e.default.prototype,"helpMessage",void 0),t.__decorate([r.property()],e.default.prototype,"helpMessageIcon",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"inputEnabled",void 0),t.__decorate([r.property({type:l.SketchTooltipElevationOptions,nonNullable:!0})],e.default.prototype,"elevation",void 0),t.__decorate([r.property()],e.default.prototype,"placement",void 0),t.__decorate([r.property()],e.default.prototype,"offset",void 0),t.__decorate([r.property({type:c,nonNullable:!0})],e.default.prototype,"visibleElements",void 0),t.__decorate([r.property()],e.default.prototype,"visualVariables",void 0),t.__decorate([r.property()],e.default.prototype,"xyMode",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchTooltipOptions")],e.default),e.default})},"esri/views/interactive/sketch/SketchTooltipElevationOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s,a){"use strict";e.SketchTooltipElevationOptions=class extends o{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}},t.__decorate([r.property({type:String,nonNullable:!0})],e.SketchTooltipElevationOptions.prototype,"mode",void 0),e.SketchTooltipElevationOptions=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchTooltipElevationOptions")],e.SketchTooltipElevationOptions),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/sketch/SketchTooltipVisibleElements":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s,a){"use strict";return e.default=class extends o{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}},t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"area",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"coordinates",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"direction",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"distance",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"elevation",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"header",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"helpMessage",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"orientation",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"radius",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"rotation",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"scale",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"size",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.default.prototype,"totalLength",void 0),e.default=t.__decorate([a.subclass("esri.views.interactive.sketch.SketchTooltipVisibleElements")],e.default),e.default})},"esri/views/interactive/snapping/SnappingManager":function(){define(["require","exports","../../../chunks/tslib.es6","../../../core/asyncUtils","../../../core/Evented","../../../core/has","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/projectionUtils","../../../support/elevationInfoUtils","../sketch/normalizedPoint","./Settings","./SnappingOptions","./snappingUtils","./candidates/DrapedEdgeSnappingCandidate","./candidates/EdgeSnappingCandidate","./candidates/IntersectionSnappingCandidate","./candidates/LineSnappingCandidate","./candidates/ParallelLineSnappingCandidate","./candidates/RightAngleSnappingCandidate","./candidates/RightAngleTriangleSnappingCandidate","../support/viewUtils","../../support/geodesicLengthMeasurementUtils"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g,f,m,v,_,b,w,S,M,T,x,C){"use strict";t.SnappingManager=class extends i.EventedAccessor{constructor(e){super(e),this.options=new f,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}initialize(){this.addHandles([a.watch(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:o,effectiveFeatureEnabled:r,effectiveGridEnabled:i}=this.options;return{selfEnabled:o,featureEnabled:r,gridEnabled:"2d"===this.view.type&&i,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=r.createTask(o=>this._updateEngines(e,t,o))},a.syncAndInitial),a.watch(()=>this.options,e=>{for(const t of this._engines)t.options=e},a.sync)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,o){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const r=this._engineCache,i=await Promise.allSettled([e.featureEnabled&&!r.has("feature")?this._createFeatureSnappingEngine(o):void 0,e.selfEnabled&&!r.has("self")?this._createSelfSnappingEngine(o):void 0,e.gridEnabled&&!r.has("grid")?this._createGridSnappingEngine(o):void 0]);if(o.aborted)for(const e of i)"fulfilled"===e.status&&e.value?.engine.destroy();else{for(const e of i)"fulfilled"===e.status&&e.value&&r.set(e.value.type,e.value.engine);this._engines=Array.from(r.values())}}async _createSelfSnappingEngine(t){const[{SelfSnappingEngine:o},r]=await Promise.all([new Promise((t,o)=>e(["./SelfSnappingEngine"],t,o)),C.loadGeodesicLengthMeasurementUtils()]);return s.throwIfAborted(t),{type:"self",engine:new o({view:this.view,options:this.options,geodesicLengthMeasurementUtils:r})}}async _createGridSnappingEngine(t){const{view:o}=this;if("2d"!==o.type)return;const{GridSnappingEngine:r}=await new Promise((t,o)=>e(["./GridSnappingEngine"],t,o));return s.throwIfAborted(t),{type:"grid",engine:new r({view:o,options:this.options})}}async _createFeatureSnappingEngine(t){const{FeatureSnappingEngine:o}=await new Promise((t,o)=>e(["./FeatureSnappingEngine"],t,o));s.throwIfAborted(t);const{view:r,options:i}=this,{spatialReference:n}=r;return{type:"feature",engine:new o({view:r,options:i,spatialReference:n})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,o=e*t;return o*o}snap(e){return function(e){return null!=e.scenePoint}(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:o}=e;this._removeVisualization();const r=this._currentMainCandidate;if(null==r)return t;const i=this._selectUpdateInput(e);if(null==i)return t;const{spatialReference:n}=o,s=u.project(i,n);if(null==s)return t;const{view:a}=this,{elevationInfo:l,visualizer:c}=o,p=[],d=y.fromPoint(s,a,l),h=r.constraint.closestTo(d);if(!this._arePointsWithinScreenThreshold(d,h,o)||!k(r,o.drawConstraints))return this._resetSnappingState(),t;r.targetPoint=y.markAsTarget(h),p.push(...r.hints);for(const e of this._currentOtherActiveCandidates)k(e,o.drawConstraints)&&(e.targetPoint=y.markAsTarget(h),p.push(...e.hints));return null!=c&&this.addHandles(c.draw(p,{spatialReference:n,elevationInfo:P(o),view:a,selfSnappingZ:o.selfSnappingZ}),L),y.toElevationAlignedDehydratedPoint(h,a,t,o)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case 0:return e;case 1:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=0}_removeVisualization(){this.removeHandles(L)}async _snapSinglePoint({point:e,context:t,signal:o}){const{view:r}=this,{elevationInfo:i}=t,n=y.fromPoint(e,r,i),s=await this._fetchCandidates(n,3,t,o);return this._createSnapResult(n,0,s,r,e,t,o)}async _snapMultiPoint({point:e,scenePoint:t,context:o,signal:r}){const{view:i}=this,{coordinateHelper:n,elevationInfo:s,spatialReference:a}=o;await u.initializeProjection(t.spatialReference,a);const l=u.project(t,a),c=y.fromPoint(l,i,s),p=await this._fetchCandidates(c,1,o,r);if(p.length>0){const e=await this._fetchCandidates(c,2,o,r);return this._createSnapResult(c,1,[...p,...e],i,l,o,r)}const d=y.fromPoint(e,i,s),h=await this._fetchCandidates(d,2,o,r);return this._createSnapResult(d,0,h,i,{z:n.hasZ()&&e.hasZ?e.z??0:void 0,m:n.hasM()&&e.hasM?e.m??0:void 0},o,r)}async _fetchCandidates(e,t,o,r){return(await Promise.all(this._engines.map(i=>i.fetchCandidates(e,t,o,r)))).flat()}_createSnapResult(e,t,o,r,i,n,a){return{get valid(){return!s.isAborted(a)},apply:()=>{const{spatialReference:s}=n,{snappedPoint:a,hints:l}=this._processCandidates(e,t,o,n);return this._removeVisualization(),null!=n.visualizer&&this.addHandles(n.visualizer.draw(l,{spatialReference:s,elevationInfo:h.absoluteHeightElevationInfo,view:r,selfSnappingZ:n.selfSnappingZ}),L),y.toElevationAlignedDehydratedPoint(a,r,i,n)}}}_processCandidates(e,t,o,r){if(o.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),m.sortCandidatesInPlace(e,o);const i=this._currentMainCandidate;if(null!=i){const a=(s=o,(n=i)instanceof b.IntersectionSnappingCandidate?E(s,n.first)>=0&&E(s,n.second)>=0?0:-1:E(s,n));if(a>=0){if(!(o[a]instanceof b.IntersectionSnappingCandidate))return this._intersectWithOtherCandidates(a,o,e,t,r);if(this._arePointsWithinScreenThreshold(e,i.targetPoint,r))return this._updateSnappingCandidate(i,t,o,r)}}var n,s;return this._intersectWithOtherCandidates(0,o,e,t,r)}_intersectWithOtherCandidates(e,t,o,r,i){const{coordinateHelper:n}=i,s=t[e],a=[];for(let r=0;r<t.length;++r){if(r===e)continue;const i=t[r],l=s.constraint.intersect(i.constraint);if(l)for(const e of l.closestPoints(s.targetPoint))a.push([new b.IntersectionSnappingCandidate(y.markAsTarget(e),s,i,i.isDraped),this._squaredScreenDistance(o,e,n)])}return a.length>0&&(a.sort((e,t)=>e[1]-t[1]),a[0][1]<this._squaredPointProximityThreshold(i.pointer))?this._updateSnappingCandidate(a[0][0],r,t,i):k(s,i.drawConstraints)?this._updateSnappingCandidate(s,r,t,i):{snappedPoint:o,hints:[]}}_updateSnappingCandidate(e,t,o,r){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const i=this._currentMainCandidate.targetPoint,n=[];n.push(...e.hints);for(const t of o){if(e instanceof b.IntersectionSnappingCandidate){if(t.constraint.equals(e.first.constraint)||t.constraint.equals(e.second.constraint))continue}else if(t.constraint.equals(e.constraint))continue;const o=t.constraint.closestTo(i);this._squaredScreenDistance(o,i,r.coordinateHelper)<O()&&(t.targetPoint=i,this._currentOtherActiveCandidates.push(t),n.push(...t.hints))}return{snappedPoint:i,hints:n}}_squaredPointProximityThreshold(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,o){return this._squaredScreenDistance(e,t,o.coordinateHelper)<this._squaredPointProximityThreshold(o.pointer)}_squaredScreenDistance(e,t,o){return m.squaredScreenDistance(this._toScreen(e,o),this._toScreen(t,o))}_toScreen(e,t){return x.vectorToScreenPoint(e,t.spatialReference,h.absoluteHeightElevationInfo,this.view)}get test(){}},o.__decorate([l.property({constructOnly:!0})],t.SnappingManager.prototype,"view",void 0),o.__decorate([l.property()],t.SnappingManager.prototype,"options",void 0),o.__decorate([l.property({readOnly:!0})],t.SnappingManager.prototype,"updating",null),o.__decorate([l.property()],t.SnappingManager.prototype,"_loadTask",void 0),o.__decorate([l.property()],t.SnappingManager.prototype,"_engines",void 0),o.__decorate([l.property()],t.SnappingManager.prototype,"_squaredMouseProximityThreshold",null),o.__decorate([l.property()],t.SnappingManager.prototype,"_squaredTouchProximityThreshold",null),t.SnappingManager=o.__decorate([d.subclass("esri.views.interactive.snapping.SnappingManager")],t.SnappingManager);const L="visualization-handle";function O(){return g.defaults.satisfiesConstraintScreenThreshold*g.defaults.satisfiesConstraintScreenThreshold}function k(e,t){return!t||null==t.direction&&null==t.distance||!(e instanceof v.DrapedEdgeSnappingCandidate||e instanceof _.EdgeSnappingCandidate||e instanceof w.LineSnappingCandidate||e instanceof S.ParallelLineSnappingCandidate||e instanceof T.RightAngleTriangleSnappingCandidate)&&(!(e instanceof M.RightAngleSnappingCandidate)||null==t.direction&&1===e.selfSnappingType)}function E(e,t){let o=-1;for(let r=0;r<e.length;++r)if(t.constraint.equals(e[r].constraint)){o=r;break}return o}function P({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?h.absoluteHeightElevationInfo:t}Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/sketch/normalizedPoint":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../layers/graphics/dehydratedPoint","../../../support/elevationInfoUtils"],function(e,t,o,r){"use strict";function i(e=0,o=0,r=0){return t.fromValues(e,o,r)}function n(e,t,o,n=i()){return n[0]=e.x,n[1]=e.y,n[2]=e.z??0,null==t||("2d"===t.type?n[2]=0:n[2]=r.getConvertedElevation(t,e,o,r.absoluteHeightElevationInfo)??0),n}const s=o.makeDehydratedPoint(0,0,0,null);e.asVec2=function(e){return e},e.clone=function(e){const[t,o,r]=e;return e.length>3?[t,o,r,e[3]]:[t,o,r]},e.create=function(e,t,o){return i(e,t,o)},e.createWritable=i,e.fromAnyMapPoint=function(e,t,{coordinateHelper:o,elevationInfo:r},i){return e?n(o.vectorToDehydratedPoint(e,s),t,r,i):null},e.fromPoint=n,e.fromValues=function(e,o,r){return t.fromValues(e,o,r)},e.fromVec3=function(e){return e},e.isTarget=function(e){return Boolean(1&((e.length>3?e[3]:void 0)??0))},e.markAsTarget=function(e){return e[3]=1|((e.length>3?e[3]:void 0)??0),e},e.toDehydratedPoint=function(e,t,r){return r?(o.setDehydratedPoint(r,e[0],e[1],e[2],t),r):o.makeDehydratedPoint(e[0],e[1],e[2],t)},e.toElevationAlignedDehydratedPoint=function(e,t,{z:i,m:n},s,a){const{spatialReference:l,elevationInfo:c}=s;let p;if(null==i&&null==n)p=void 0;else if(null==t||"2d"===t.type)p=i??void 0;else{const o=r.absoluteHeightElevationInfo;p=r.getConvertedElevationFromVector(t,e,l,o,c)??0}const[d,u]=e;return a?o.setDehydratedPoint(a,d,u,p,l):a=o.makeDehydratedPoint(d,u,p,l),null!=n&&(a.m=n,a.hasM=!0),a},e.withSelfSnappingZ=function(e,t,o,n,s=i()){const[a,l]=e;return s[0]=a,s[1]=l,e.length>3&&(s[3]=e[3]??0),"3d"!==o?.type?(s[2]=t.value,s):(s[2]=r.getConvertedElevationFromXYZ(o,a,l,t.value,n,t.elevationInfo,r.absoluteHeightElevationInfo)??0,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],function(e){"use strict";e.ImmutableDehydratedPoint=class{constructor(e,t,o,r,i){this.spatialReference=e,this._position=void 0!==i?[t,o,r??0,i??0]:void 0!==r?[t,o,r??0]:[t,o],this._flags=(void 0!==r?1:0)+(void 0!==i?2:0)}get hasZ(){return!(1&~this._flags)}get hasM(){return!(2&~this._flags)}get type(){return"point"}get x(){return this._position[0]}get y(){return this._position[1]}get z(){return this.hasZ?this._position[2]:void 0}get m(){return this.hasM?this._position[3]:void 0}},e.makeDehydratedPoint=function(e,t,o,r){return{x:e,y:t,z:o,hasZ:null!=o,hasM:!1,spatialReference:r,type:"point"}},e.setDehydratedPoint=function(e,t,o,r,i){e.x=t,e.y=o,e.z=r,e.hasZ=null!=r,e.spatialReference=i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/Settings":function(){define(["exports","../../../chunks/tslib.es6","../../../Color","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n){"use strict";let s=class extends r.JSONSupport{constructor(){super(...arguments),this.enabled=!0}};t.__decorate([i.property({type:Boolean})],s.prototype,"enabled",void 0),s=t.__decorate([n.subclass("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],s);let a=class extends r.JSONSupport{constructor(e){super(e),this.lineSnapper=new s,this.parallelLineSnapper=new s,this.rightAngleSnapper=new s,this.rightAngleTriangleSnapper=new s,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new o([255,127,0]),this.orangeTransparent=new o([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};t.__decorate([i.property({type:s,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"lineSnapper",void 0),t.__decorate([i.property({type:s,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"parallelLineSnapper",void 0),t.__decorate([i.property({type:s,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"rightAngleSnapper",void 0),t.__decorate([i.property({type:s,constructOnly:!0,nonNullable:!0,json:{write:!0}})],a.prototype,"rightAngleTriangleSnapper",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],a.prototype,"shortLineThreshold",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],a.prototype,"distance",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"pointThreshold",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"intersectionParallelLineThreshold",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"parallelLineThreshold",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"verticalLineThresholdMeters",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"touchSensitivityMultiplier",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],a.prototype,"pointOnLineThreshold",void 0),t.__decorate([i.property({type:o,nonNullable:!0})],a.prototype,"orange",void 0),t.__decorate([i.property({type:o,nonNullable:!0})],a.prototype,"orangeTransparent",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"lineHintWidthReference",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"lineHintWidthTarget",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],a.prototype,"lineHintFadedExtensions",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],a.prototype,"parallelLineHintWidth",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],a.prototype,"parallelLineHintLength",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],a.prototype,"parallelLineHintOffset",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],a.prototype,"rightAngleHintSize",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],a.prototype,"rightAngleHintOutlineSize",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],a.prototype,"satisfiesConstraintScreenThreshold",void 0),a=t.__decorate([n.subclass("esri.views.interactive.snapping.Settings.Defaults")],a);const l=new a;e.defaults=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/SnappingOptions":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/arrayUtils","../../../core/Collection","../../../core/Logger","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/decorators/subclass","./FeatureSnappingLayerSource","./Settings"],function(e,t,o,r,i,n,s,a,l,c,p){"use strict";function d(e){return"subtype-group"===e.layer.type}function u(e){return"subtype-group"!==e.layer.type}function h(e){return"subtype-sublayer"===e.layer.type}return e.default=class extends o{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new i,this.distance=p.defaults.distance,this.touchSensitivityMultiplier=p.defaults.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(d)&&n.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(h),o=this._get("_effectiveFeatureSources")?.filter(d)??new i;for(const e of t){const t=o.find(t=>t.layer===e.layer.parent);if(t)t.sublayerSources.includes(e)||t.sublayerSources.add(e);else if(e.layer.parent){const t=new c({layer:e.layer.parent});t.sublayerSources.add(e),o.add(t)}}for(const e of o){const o=e.sublayerSources.filter(e=>!t.includes(e));e.sublayerSources.removeMany(o)}o.removeMany(o.filter(e=>0===e.sublayerSources.length));const s=e.filter(u),a=this._get("_effectiveFeatureSources")??new i,{added:l,removed:p}=r.difference(a.toArray(),[...s,...o]);return a.removeMany(p),a.addMany(l),a}},t.__decorate([s.property()],e.default.prototype,"enabled",void 0),t.__decorate([s.property()],e.default.prototype,"enabledToggled",void 0),t.__decorate([s.property()],e.default.prototype,"forceDisabled",void 0),t.__decorate([s.property()],e.default.prototype,"selfEnabled",void 0),t.__decorate([s.property()],e.default.prototype,"featureEnabled",void 0),t.__decorate([s.property()],e.default.prototype,"gridEnabled",void 0),t.__decorate([s.property()],e.default.prototype,"attributeRulesEnabled",void 0),t.__decorate([s.property({type:i.ofType(c)})],e.default.prototype,"featureSources",void 0),t.__decorate([s.property()],e.default.prototype,"distance",void 0),t.__decorate([s.property()],e.default.prototype,"touchSensitivityMultiplier",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"effectiveEnabled",null),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"effectiveGridEnabled",null),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"effectiveSelfEnabled",null),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"effectiveFeatureEnabled",null),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"_effectiveFeatureSources",null),e.default=t.__decorate([l.subclass("esri.views.interactive.snapping.SnappingOptions")],e.default),e.default})},"esri/views/interactive/snapping/FeatureSnappingLayerSource":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Collection","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s,a,l){"use strict";return e.default=class extends o{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new r}},t.__decorate([i.property({constructOnly:!0})],e.default.prototype,"layer",void 0),t.__decorate([i.property()],e.default.prototype,"enabled",void 0),t.__decorate([i.property()],e.default.prototype,"updating",void 0),t.__decorate([i.property()],e.default.prototype,"availability",void 0),t.__decorate([i.property()],e.default.prototype,"sublayerSources",void 0),e.default=t.__decorate([l.subclass("esri.views.interactive.snapping.FeatureSnappingLayerSource")],e.default),e.default})},"esri/views/interactive/snapping/snappingUtils":function(){define(["exports","../../../core/reactiveUtils","../../../core/SetUtils","../../../core/sql","../../../core/timeUtils","../../../chunks/vec32","../../../layers/graphics/dehydratedPoint","../../../rest/support/Query","../../input/InputManager","../keybindings","../sketch/normalizedPoint","../../../webmap/utils"],function(e,t,o,r,i,n,s,a,l,c,p,d){"use strict";const u=Symbol("grid-placement-graphic");function h(e,t){const o=e.x-t.x,r=e.y-t.y;return o*o+r*r}const y=Symbol("snapping-toggle");e.editEdgeToSnappingEdge=function(e,t,o){return{left:p.fromAnyMapPoint(e.leftVertex.pos,t,o),right:p.fromAnyMapPoint(e.rightVertex.pos,t,o)}},e.gridPlacementGraphicSymbol=u,e.isUtilityNetworkWebMap=function(e){return d.isWebMap(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length},e.makeSnappingQuery=function({parameters:{point:e,distance:t,returnEdge:n,vertexMode:l,coordinateHelper:{spatialReference:c},filter:p},mode:d,returnZ:u,filter:h}){const y=h?.clone()??new a({where:"1=1"});return y.returnZ=u??"3d"===d,p&&(y.geometry=p.geometry,y.distance=p.distance,y.spatialRelationship=p.spatialRelationship,y.where=r.sqlAnd(y.where,p.where),y.timeExtent=i.mergeTimeExtents(y.timeExtent,p.timeExtent),y.objectIds=(g=y.objectIds,f=p.objectIds,g||f?f?g?Array.from(o.intersection(new Set(g),new Set(f))):f:g:null)),{point:s.makeDehydratedPoint(e[0],e[1],e[2],c.toJSON()),mode:d,distance:t,returnEdge:n,vertexMode:l,query:y.toJSON()};var g,f},e.objectEqual=function(e,t){const o=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return o;case 3:return o&&e[2]===t[2];case 4:return o&&e[2]===t[2]&&e[3]===t[3]}return!1},e.screenDistance=function(e,t){return Math.sqrt(h(e,t))},e.setupSnappingToggleHandles=function(e,o=()=>{}){const r=t.watch(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:t,snappingOptions:r})=>{if(e.removeHandles(y),!t||!r)return;const i=l.ViewEventPriorities.TOOL,n=[t.on("key-down",e=>{e.key!==c.snappingKeys.toggle||e.repeat||(r.enabledToggled=!0,o())},i),t.on("key-up",e=>{e.key===c.snappingKeys.toggle&&(r.enabledToggled=!1,o())},i),t.on("pointer-move",e=>{const t=e.native.ctrlKey;r.enabledToggled!==t&&(r.enabledToggled=t,o())},i)];e.addHandles(n,y)},t.syncAndInitial);e.addHandles(r)},e.sortCandidatesInPlace=function(e,t){t.sort((t,o)=>n.squaredDistance(t.targetPoint,e)-n.squaredDistance(o.targetPoint,e))},e.squaredScreenDistance=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webmap/utils":function(){define(["exports","./Version"],function(e,t){"use strict";const o=new t.Version(2,34);e.currentVersion=o,e.isWebMap=function(e){return null!=e&&"object"==typeof e&&"declaredClass"in e&&"esri.WebMap"===e.declaredClass},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webmap/Version":function(){define(["exports","../core/Version"],function(e,t){"use strict";class o extends t.Version{constructor(e,t){super(e,t,"webmap")}}e.Version=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/DrapedEdgeSnappingCandidate":function(){define(["exports","../../sketch/constraints","./FeatureSnappingCandidate","../hints/LineSnappingHint"],function(e,t,o,r){"use strict";class i extends o.FeatureSnappingCandidate{constructor(e){super({...e,isDraped:!0,constraint:new t.DrapedLineConstraint(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new r.LineSnappingHint(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}e.DrapedEdgeSnappingCandidate=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/sketch/constraints":function(){define(["exports","../../../core/arrayUtils","../../../core/mathUtils","../../../core/libs/gl-matrix-2/math/vec2","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../chunks/vec42","../../../core/libs/gl-matrix-2/factories/vec4f64","../../../geometry/support/geodesicConstants","../../../geometry/support/geodesicUtils","../../../geometry/support/plane","../../../chunks/sphere","../../3d/support/mathUtils","./normalizedPoint","../../support/geometry3dUtils"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g){"use strict";class f{intersect(e){return j(this,e)}closestPoints(e){return[this.closestTo(e)]}}class m extends f{constructor(e){super(),this.point=e}equals(e){return this===e||ee(e)&&n.exactEquals(this.point,e.point)}closestTo(){return y.clone(this.point)}}class v extends f{constructor(e,t,o){super(),this.start=e,this.end=t,this.lineLike={start:e,end:t,type:o}}equals(e){return this===e||te(e)&&this.lineLike.type===e.lineLike.type&&n.exactEquals(this.start,e.start)&&n.exactEquals(this.end,e.end)}closestTo(e){const t=y.createWritable();return g.projectPointToLineLike(e,this.lineLike,t),t}}class _ extends v{constructor(e,t){super(e,t,1)}}class b extends v{constructor(e,t){super(e,t,0)}}class w extends f{constructor(e){super(),this.constraints=e}equals(e){return this===e||X(e)&&t.equals(this.constraints,e.constraints,(e,t)=>e.equals(t))}closestTo(e){let t,o=1/0;for(const r of this.constraints){const i=r.closestTo(e),s=n.squaredDistance(e,i);s<o&&(o=s,t=i)}return y.clone(t??e)}closestPoints(e){return this.constraints.flatMap(t=>t===this?[]:t.closestPoints(e))}}class S extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ie(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}closestTo(e){const t=y.createWritable();return g.projectPointToVerticalCylinder(e,this.center,this.radius,t),t}}class M extends f{constructor(e,t){super(),this.center=e,this.radius=t}equals(e){return this===e||ne(e)&&n.exactEquals(this.center,e.center)&&this.radius===e.radius}closestTo(e){const t=y.createWritable();return g.projectPointToVerticalCylinder(e,this.center,this.radius,t),t[2]=this.center[2],t}asCircle(){return new T(y.clone(this.center),this.radius,y.fromValues(0,0,1))}}class T extends f{constructor(e,t,o,r=void 0){super(),this.center=e,this.radius=t,this.normal=o,this.slicePlane=r}equals(e){return this===e||se(e)&&n.exactEquals(this.center,e.center)&&n.exactEquals(this.normal,e.normal)&&this.radius===e.radius}closestTo(e){const{center:t,radius:o}=this;d.projectPoint(this.getPlane(C),e,x);const r=n.sub(x,x,t),i=n.squaredLength(r);if(g.isClose(i,0))return y.clone(e);const s=o/Math.sqrt(i),a=y.createWritable();n.scaleAndAdd(a,t,r,s);const{slicePlane:l}=this;if(l&&!g.isPointInsidePlane(l,a)){const t=q(l,this);return t?.closestTo(e)??y.clone(e)}return a}getPlane(e=d.create()){return d.fromPositionAndNormal(this.center,this.normal,e)}}const x=s.create(),C=d.create();class L extends f{constructor(e){super(),this.z=e}equals(e){return this===e||oe(e)&&this.z===e.z}closestTo(e){return y.fromValues(e[0],e[1],this.z)}getPlane(e=d.create()){return n.set(O,0,0,this.z),d.fromPositionAndNormal(O,s.UNIT_Z,e)}}const O=s.create();class k extends f{constructor(e,t,o){super(),this.start=e,this.end=t,this.planeLike={start:y.asVec2(e),end:y.asVec2(t),type:o}}equals(e){return this===e||re(e)&&this.planeLike.type===e.planeLike.type&&n.exactEquals(this.start,e.start)&&n.exactEquals(this.end,e.end)}closestTo(e){const t=y.createWritable();return g.projectPointToVerticalPlane(e,this.planeLike,t),t}closestEndTo(e){const{start:t,end:o}=this.planeLike;return Math.sign(r.dot(r.subtract(E,o,t),r.subtract(P,y.asVec2(e),t)))>0?this.end:this.start}getPlane(e=d.create()){const t=n.copy(A,this.end);return t[2]+=1,d.fromPoints(this.start,this.end,t,e)}getSlicePlane(e=d.create()){const{start:t,end:o,type:r}=this.planeLike;if(0===r)return;const i=n.set(A,t[0],t[1],0),s=n.set(I,o[0],o[1],0),a=n.subtract(I,s,i);return d.fromPositionAndNormal(i,a,e),e}}const E=i.create(),P=i.create(),A=s.create(),I=s.create();class G extends f{constructor(e,t){super(),this.sphere=u.fromCenterAndRadius(e,t)}equals(e){return this===e||ae(e)&&u.exactEquals(this.sphere,e.sphere)}closestTo(e){const t=y.createWritable();return u.projectPoint(this.sphere,e,t),t}get center(){return u.getCenter(this.sphere)}get radius(){return this.sphere[3]}}class R extends f{constructor(e,t,o){super(),this.start=e,this.end=t,this.getZ=o,this.planeLike={start:y.asVec2(e),end:y.asVec2(t),type:0}}equals(e){return this===e||le(e)&&n.exactEquals(this.start,e.start)&&n.exactEquals(this.end,e.end)&&this.getZ===e.getZ}closestTo(e){return function(e,t){const o=y.createWritable();return g.projectPointToVerticalPlane(t,e.planeLike,o),o[2]=e.getZ(o[0],o[1])??ce,o}(this,e)}addIfOnTheGround(e,t){for(const o of t){const t=this.getZ(o[0],o[1])??0;g.isClose(o[2],t)&&(o[2]=t,e.push(o))}}}class V extends f{constructor(e,t,o){super(),this._x=e,this._y=t,this._z=o}equals(e){return this===e||e instanceof V&&this._x===e._x&&this._y===e._y&&this._z===e._z}closestTo([e,t,o]){return y.create(this._x??e,this._y??t,this._z??o)}}class U extends f{constructor(e,t,o,r,i){super(),this._origin=e,this._spatialReference=t,this._distanceMeters=o,this._z=r,this._directionDegrees=i}equals(e){return this===e||e instanceof U&&r.exactEquals(this._origin,e._origin)&&this._spatialReference===e._spatialReference&&this._distanceMeters===e._distanceMeters&&this._z===e._z&&this._directionDegrees===e._directionDegrees}closestTo([e,t,o]){return r.set(H,e,t),r.exactEquals(H,this._origin)||this._applyDirectionAndDistance(H),y.create(H[0],H[1],this._z??o)}_applyDirectionAndDistance(e){if(null!=this._directionDegrees&&null!=this._distanceMeters)p.directGeodeticSolver(e,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(null!=this._directionDegrees)!function(e,t,o,r,i){let{azimuth:n,distance:s}=p.inverseGeodeticSolver(F,t,r,i);n??=0;let a=s*Math.cos((n-o)*c.toRadians);a=Math.max(0,a),p.directGeodeticSolver(e,t,o,a,i)}(e,this._origin,this._directionDegrees,e,this._spatialReference);else if(null!=this._distanceMeters){const{azimuth:t}=p.inverseGeodeticSolver(D,this._origin,e,this._spatialReference);p.directGeodeticSolver(e,this._origin,t??0,this._distanceMeters,this._spatialReference)}}}const H=[0,0],D=new p.InverseGeodeticSolverResult,F=new p.InverseGeodeticSolverResult;function j(e,t){if(X(e)){const o=[];for(const r of e.constraints){const e=r.intersect(t);e&&o.push(e)}return J(o)}if(X(t))return j(t,e);if(le(e))return Z(e,t);if(le(t))return Z(t,e);if(ee(e)){const{point:o}=e;if(ee(t))return n.exactEquals(o,t.point)?e:void 0;const r=t.closestTo(o);return n.equals(r,o)?e:void 0}if(te(e)){if(ee(t))return j(t,e);if(te(t))return Q(g.intersectLineLikes(e.lineLike,t.lineLike));if(oe(t))return z(e,t);if(re(t))return Q(g.intersectVerticalPlaneAndLineLike(t.planeLike,e.lineLike));if(ie(t))return Q(g.intersectLineLikeAndVerticalCylinder(e.lineLike,t.center,t.radius));if(se(t))return Q(g.intersectLineLikeAndCircle(e.lineLike,t));if(ne(t))return function({lineLike:e},{center:t,radius:o}){const r=t[2];return Q(g.intersectLineLikeAndVerticalCylinder(e,t,o).filter(e=>g.isClose(e[2],r)))}(e,t);if(ae(t))return function({lineLike:e},{sphere:t}){return Q(u.intersectLine(t,e.start,e.end))}(e,t)}else if(oe(e)){if(ee(t)||te(t))return j(t,e);if(oe(t))return function(e,t){return g.isClose(e.z,t.z)?e:void 0}(e,t);if(re(t))return function({z:e},{planeLike:t}){const[o,r]=t.start,[i,n]=t.end,s=y.fromValues(o,r,e),a=y.fromValues(i,n,e);return 0===t.type?new _(s,a):new b(s,a)}(e,t);if(ie(t))return function(e,t){const[o,r]=t.center;return new M(y.fromValues(o,r,e.z),t.radius)}(e,t);if(se(t))return N(e,t);if(ne(t))return o=e,i=t,g.isClose(i.center[2],o.z)?i:void 0;if(ae(t))return function(e,{center:t,radius:o}){const r=Math.abs(t[2]-e.z);if(r>o&&!g.isClose(r,o))return;const i=y.fromValues(t[0],t[1],e.z),n=Math.sqrt(o**2-r**2);return g.isClose(n,0)?void 0:new M(i,n)}(e,t)}else if(re(e)){if(ee(t)||te(t)||oe(t))return j(t,e);if(re(t))return $(g.intersectVerticalPlanes(e.planeLike,t.planeLike));if(ie(t))return $(g.intersectVerticalPlaneAndVerticalCylinder(e.planeLike,t.center,t.radius));if(se(t))return W(e,t);if(ne(t))return B(e,t);if(ae(t))return K(e,t)}else if(ie(e)){if(ee(t)||te(t)||oe(t)||re(t))return j(t,e);if(ie(t))return $(g.intersectVerticalCylinders(y.asVec2(e.center),e.radius,y.asVec2(t.center),t.radius));if(se(t))return;if(ne(t))return function(e,t){const o=r.squaredDistance(y.asVec2(e.center),y.asVec2(t.center));return g.isClose(o,0)&&g.isClose(e.radius,t.radius)?t:Y(g.intersectVerticalCylinders(y.asVec2(e.center),e.radius,y.asVec2(t.center),t.radius),t.center[2])}(e,t);if(ae(t))return}else if(se(e)){if(ee(t)||te(t)||oe(t)||re(t)||ie(t))return j(t,e);if(se(t))return;if(ne(t))return void t.asCircle();if(ae(t))return}else if(ne(e)){if(ee(t)||te(t)||oe(t)||re(t)||ie(t)||se(t))return j(t,e);if(ne(t))return function(e,t){if(!g.vectorsHaveCloseZ(e.center,t.center))return;const o=r.squaredDistance(y.asVec2(e.center),y.asVec2(t.center));return g.isClose(o,0)&&g.isClose(e.radius,t.radius)?e:Y(g.intersectVerticalCylinders(y.asVec2(e.center),e.radius,y.asVec2(t.center),t.radius),e.center[2])}(t,e);if(ae(t))return}else if(ae(e)){if(ee(t)||te(t)||oe(t)||re(t)||ie(t)||ne(t))return j(t,e);if(ae(t))return}var o,i}const z=(()=>{const e=d.create();return(t,o)=>{const{start:r,end:i}=t;if(g.vectorsHaveCloseZ(r,i)&&g.isClose(r[2],o.z))return t;const n=y.createWritable();return d.intersectLine(o.getPlane(e),r,i,n)?new m(n):void 0}})(),q=(()=>{const e=l.create(),t=s.create(),r=s.create();return(i,l,c)=>{const{normal:p,center:u,radius:f}=l;h.tangentFrame(p,t,r);const v=d.getNormal(i),_=f*n.dot(v,t),b=f*n.dot(v,r);a.set(e,u[0],u[1],u[2],1);const w=a.dot(i,e),S=Math.hypot(_,b),M=g.isClose(S,0);if(g.isClose(d.distance(i,u),0)){if(M)return l;if(g.isClose(f,0))return!c||g.isPointInsidePlane(c,u)?new m(y.clone(u)):void 0;n.cross(t,v,p),n.normalize(t,t);const e=new Array,o=s.clone(u);n.scaleAndAdd(o,o,t,f),c&&!g.isPointInsidePlane(c,o)||e.push(o);const r=s.clone(u);return n.scaleAndAdd(r,r,t,-f),c&&!g.isPointInsidePlane(c,r)||e.push(r),Q(e)}if(M)return;const T=-w/S;if(Math.abs(T)>1||g.isClose(T,1))return;const x=Math.atan(_/b),C=o.asinClamped(T)-x,L=Math.PI-C,O=new Array,k=s.create();n.scaleAndAdd(k,u,t,f*Math.cos(C)),n.scaleAndAdd(k,k,r,f*Math.sin(C)),O.push(k);const E=s.create();return n.scaleAndAdd(E,u,t,f*Math.cos(L)),n.scaleAndAdd(E,E,r,f*Math.sin(L)),O.push(E),Q(c?g.pointsInsidePlane(c,O):O)}})(),N=(()=>{const e=d.create();return(t,o)=>q(t.getPlane(e),o,o.slicePlane)})(),B=(()=>{const e=d.create();return(t,{center:o,radius:r})=>{const i=g.intersectVerticalPlaneAndVerticalCylinder(t.planeLike,o,r),n=o[2];t.getSlicePlane(e);const s=new Array;for(const[t,o]of i){const r=[t,o,n];g.isPointInsidePlane(e,r)&&s.push(r)}return Q(s)}})(),W=(()=>{const e=d.create(),t=d.create();return(o,r)=>q(o.getPlane(e),r,o.getSlicePlane(t))})(),K=(()=>{const e=d.create();return(t,{center:o,radius:r})=>{const i=t.getPlane(e),a=d.signedDistance(i,o),l=Math.abs(a);if(l>r&&!g.isClose(l,r))return;const c=Math.sqrt(r**2-a**2);if(g.isClose(c,0)){const e=y.createWritable();return d.projectPoint(i,o,e),new m(e)}const p=y.createWritable(),u=s.clone(d.getNormal(i));return n.scaleAndAdd(p,o,u,a),new T(p,c,u,t.getSlicePlane())}})();function Z(e,t){const{planeLike:o,getZ:r}=e,i=new Array;if(ee(t))e.addIfOnTheGround(i,g.intersectVerticalPlaneAndPoint(o,t.point));else if(te(t))e.addIfOnTheGround(i,g.intersectVerticalPlaneAndLineLike(o,t.lineLike));else if(ie(t))for(const[e,n]of g.intersectVerticalPlaneAndVerticalCylinder(o,t.center,t.radius)){const t=r(e,n);null!=t&&i.push(s.fromValues(e,n,t))}else if(re(t)||le(t))for(const[e,n]of g.intersectVerticalPlanes(o,t.planeLike)){const t=r(e,n)??ce;i.push(s.fromValues(e,n,t))}return Q(i)}function $(e){return J(e.map(([e,t])=>{const o=y.fromValues(e,t,0),r=y.fromValues(e,t,1);return new _(o,r)}))}function Q(e){return J(e.map(e=>e?new m(y.fromVec3(e)):void 0))}function Y(e,t){return Q(e.map(([e,o])=>[e,o,t]))}function J(e){if(0!==e.length)return 1===e.length?e[0]??void 0:new w(e.filter(t.isSome))}function X(e){return e instanceof w}function ee(e){return e instanceof m}function te(e){return e instanceof v}function oe(e){return e instanceof L}function re(e){return e instanceof k}function ie(e){return e instanceof S}function ne(e){return e instanceof M}function se(e){return e instanceof T}function ae(e){return e instanceof G}function le(e){return e instanceof R}const ce=0;e.CircleConstraint=T,e.Constraint=f,e.CoordinateConstraint=V,e.DrapedLineConstraint=R,e.GeodesicConstraint=U,e.HorizontalCircleConstraint=M,e.HorizontalPlaneConstraint=L,e.LineConstraint=_,e.LineLikeConstraint=v,e.PointConstraint=m,e.RayConstraint=b,e.SetConstraint=w,e.SphereConstraint=G,e.VerticalCylinderConstraint=S,e.VerticalHalfPlaneConstraint=class extends k{constructor(e,t){super(e,t,1)}},e.VerticalPlaneConstraint=class extends k{constructor(e,t){super(e,t,0)}},e.VerticalPlaneLikeConstraint=k,e.constraintOrSet=J,e.isPoint=ee,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(e,t){"use strict";function o(e,t){return e[0]=t[0],e[1]=t[1],e}function r(e,t,o){return e[0]=t,e[1]=o,e}function i(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e}function n(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e}function s(e,t,o){return e[0]=t[0]*o[0],e[1]=t[1]*o[1],e}function a(e,t,o){return e[0]=t[0]/o[0],e[1]=t[1]/o[1],e}function l(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function c(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function p(e,t,o){return e[0]=Math.min(t[0],o[0]),e[1]=Math.min(t[1],o[1]),e}function d(e,t,o){return e[0]=Math.max(t[0],o[0]),e[1]=Math.max(t[1],o[1]),e}function u(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function h(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e}function y(e,t,o,r){return e[0]=t[0]+o[0]*r,e[1]=t[1]+o[1]*r,e}function g(e,t){const o=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(o*o+r*r)}function f(e,t){const o=t[0]-e[0],r=t[1]-e[1];return o*o+r*r}function m(e){const t=e[0],o=e[1];return Math.sqrt(t*t+o*o)}function v(e){const t=e[0],o=e[1];return t*t+o*o}function _(e,t){return e[0]=-t[0],e[1]=-t[1],e}function b(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function w(e,t){const o=t[0],r=t[1];let i=o*o+r*r;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}function S(e,t){return e[0]*t[0]+e[1]*t[1]}function M(e,t,o){const r=t[0]*o[1]-t[1]*o[0];return e[0]=e[1]=0,e[2]=r,e}function T(e,t,o,r){const i=t[0],n=t[1];return e[0]=i+r*(o[0]-i),e[1]=n+r*(o[1]-n),e}function x(e,o=1){const r=2*t.RANDOM()*Math.PI;return e[0]=Math.cos(r)*o,e[1]=Math.sin(r)*o,e}function C(e,t,o){const r=t[0],i=t[1];return e[0]=o[0]*r+o[2]*i,e[1]=o[1]*r+o[3]*i,e}function L(e,t,o){const r=t[0],i=t[1];return e[0]=o[0]*r+o[2]*i+o[4],e[1]=o[1]*r+o[3]*i+o[5],e}function O(e,t,o){const r=t[0],i=t[1];return e[0]=o[0]*r+o[3]*i+o[6],e[1]=o[1]*r+o[4]*i+o[7],e}function k(e,t,o){const r=t[0],i=t[1];return e[0]=o[0]*r+o[4]*i+o[12],e[1]=o[1]*r+o[5]*i+o[13],e}function E(e,t,o,r){const i=t[0]-o[0],n=t[1]-o[1],s=Math.sin(r),a=Math.cos(r);return e[0]=i*a-n*s+o[0],e[1]=i*s+n*a+o[1],e}function P(e,t){const o=e[0],r=e[1],i=t[0],n=t[1];let s=o*o+r*r;s>0&&(s=1/Math.sqrt(s));let a=i*i+n*n;a>0&&(a=1/Math.sqrt(a));const l=(o*i+r*n)*s*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function A(e){return"vec2("+e[0]+", "+e[1]+")"}function I(e,t){return e[0]===t[0]&&e[1]===t[1]}function G(e,o){const r=e[0],i=e[1],n=o[0],s=o[1],a=t.getEpsilon();return Math.abs(r-n)<=a*Math.max(1,Math.abs(r),Math.abs(n))&&Math.abs(i-s)<=a*Math.max(1,Math.abs(i),Math.abs(s))}function R(e,t,o,r,i){let n=t[0]-o[0],s=t[1]-o[1];const a=(r[0]*n+r[1]*s)*(i-1);return n=r[0]*a,s=r[1]*a,e[0]=t[0]+n,e[1]=t[1]+s,e}const V=m,U=n,H=s,D=a,F=g,j=f,z=v,q=Object.freeze(Object.defineProperty({__proto__:null,add:i,angle:P,ceil:l,copy:o,cross:M,dist:F,distance:g,div:D,divide:a,dot:S,equals:G,exactEquals:I,floor:c,inverse:b,len:V,length:m,lerp:T,max:d,min:p,mul:H,multiply:s,negate:_,normalize:w,projectAndScale:R,random:x,rotate:E,round:u,scale:h,scaleAndAdd:y,set:r,sqrDist:j,sqrLen:z,squaredDistance:f,squaredLength:v,str:A,sub:U,subtract:n,transformMat2:C,transformMat2d:L,transformMat3:O,transformMat4:k},Symbol.toStringTag,{value:"Module"}));e.add=i,e.angle=P,e.ceil=l,e.copy=o,e.cross=M,e.dist=F,e.distance=g,e.div=D,e.divide=a,e.dot=S,e.equals=G,e.exactEquals=I,e.floor=c,e.inverse=b,e.len=V,e.length=m,e.lerp=T,e.max=d,e.min=p,e.mul=H,e.multiply=s,e.negate=_,e.normalize=w,e.projectAndScale=R,e.random=x,e.rotate=E,e.round=u,e.scale=h,e.scaleAndAdd=y,e.set=r,e.sqrDist=j,e.sqrLen=z,e.squaredDistance=f,e.squaredLength=v,e.str=A,e.sub=U,e.subtract=n,e.transformMat2=C,e.transformMat2d=L,e.transformMat3=O,e.transformMat4=k,e.vec2=q,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(e){"use strict";function t(){return[0,0]}function o(e){return[e[0],e[1]]}function r(e,t){return[e,t]}function i(e,t){return[e,t]}function n(e,t=[0,0]){const o=Math.min(2,e.length);for(let r=0;r<o;++r)t[r]=e[r];return t}function s(){return[0,0]}function a(){return r(1,1)}function l(){return r(1,0)}function c(){return r(0,1)}const p=[0,0],d=a(),u=l(),h=c(),y=Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:u,UNIT_Y:h,ZEROS:p,clone:o,create:t,freeze:i,fromArray:n,fromValues:r,ones:a,unitX:l,unitY:c,zeros:s},Symbol.toStringTag,{value:"Module"}));e.ONES=d,e.UNIT_X=u,e.UNIT_Y=h,e.ZEROS=p,e.clone=o,e.create=t,e.freeze=i,e.fromArray=n,e.fromValues=r,e.ones=a,e.unitX=l,e.unitY=c,e.vec2f64=y,e.zeros=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/geodesicUtils":function(){define(["exports","../../core/Error","../../core/unitUtils","../../core/accessorSupport/ensureType","../Point","../Polygon","../Polyline","../SpatialReference","./geodesicConstants","./spatialReferenceUtils"],function(e,t,o,r,i,n,s,a,l,c){"use strict";function p(e){if(!e)return null;const t=e.wkid;if(t)return l.spheroids[t];const o=e.wkt2??e.wkt;return o?function(e){const t=l.wktSpheroidRegex.exec(e);if(!t||2!==t.length)return null;const o=t[1].split(",");if(!o||o.length<3)return null;const r=parseFloat(o[1]),i=parseFloat(o[2]);return isNaN(r)||isNaN(i)?null:{a:r,f:0===i?0:1/i}}(o):null}function d(e){const t=p(e);if(function(e){return null!=e&&"b"in e&&"eSq"in e&&"radius"in e}(t))return t;const o=t.a*(1-t.f);return Object.assign(t,{b:o,eSq:1-(o/t.a)**2,radius:(2*t.a+o)/3,densificationRatio:1e4/((2*t.a+o)/3)})}function u(e){return null!=e&&e<0?e+360:e}function h(e,t,o){const{a:r,eSq:i}=d(o),n=Math.sqrt(i),s=Math.sin(t[1]*l.toRadians),a=r*t[0]*l.toRadians;let c;return c=i>0?r*((1-i)*(s/(1-i*(s*s))-1/(2*n)*Math.log((1-n*s)/(1+n*s))))*.5:r*s,e[0]=a,e[1]=c,e}function y(e){return c.isGeographic(e)&&!!p(e)}function g(e,o){if("polyline"!==e.type&&"polygon"!==e.type)throw new t("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:i}=e;if(!y(i))throw new t("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const l="polyline"===e.type?e.paths:e.rings,c=[],p=[0,0],d=new f;for(const e of l){const t=[];c.push(t),t.push([e[0][0],e[0][1]]);let r,n,s=e[0][0],a=e[0][1];for(let l=0;l<e.length-1;l++){if(r=e[l+1][0],n=e[l+1][1],s===r&&a===n)continue;const c=[s,a];v(d,[s,a],[r,n],i);const{azimuth:u,distance:h}=d,y=h/o;if(y>1){for(let e=1;e<=y-1;e++)m(p,c,u,e*o,i),t.push(p.slice());m(p,c,u,(h+Math.floor(y-1)*o)/2,i),t.push(p.slice())}m(p,c,u,h,i),t.push(p.slice()),s=p[0],a=p[1]}}const u=r.ensureClass(a,i);return"polyline"===e.type?new s({paths:c,spatialReference:u}):new n({rings:c,spatialReference:u})}class f{constructor(e=0,t=void 0,o=void 0){this.distance=e,this.azimuth=t,this.reverseAzimuth=o}}function m(e,t,o,r,i){const n=t[0],s=t[1],a=n*l.toRadians,c=s*l.toRadians,p=(o??0)*l.toRadians,{a:u,b:h,f:y}=d(i),g=Math.sin(p),f=Math.cos(p),m=(1-y)*Math.tan(c),v=1/Math.sqrt(1+m*m),_=m*v,b=Math.atan2(m,f),w=v*g,S=w*w,M=1-S,T=M*(u*u-h*h)/(h*h),x=1+T/16384*(4096+T*(T*(320-175*T)-768)),C=T/1024*(256+T*(T*(74-47*T)-128));let L,O,k,E=r/(h*x),P=2*Math.PI;for(;Math.abs(E-P)>1e-12;)k=Math.cos(2*b+E),L=Math.sin(E),O=Math.cos(E),P=E,E=r/(h*x)+C*L*(k+C/4*(O*(2*k*k-1)-C/6*k*(4*L*L-3)*(4*k*k-3)));const A=_*L-v*O*f,I=Math.atan2(_*O+v*L*f,(1-y)*Math.sqrt(S+A*A)),G=y/16*M*(4+y*(4-3*M)),R=Math.atan2(L*g,v*O-_*L*f)-(1-G)*y*w*(E+G*L*(k+G*O*(2*k*k-1)));return e[0]=(a+R)/l.toRadians,e[1]=I/l.toRadians,e}function v(e,t,o,r){const i=t[0]*l.toRadians,n=t[1]*l.toRadians,s=o[0]*l.toRadians,a=o[1]*l.toRadians,{a:c,b:p,f:u,radius:h}=d(r),y=s-i,g=Math.atan((1-u)*Math.tan(n)),f=Math.atan((1-u)*Math.tan(a)),m=Math.sin(g),v=Math.cos(g),_=Math.sin(f),b=Math.cos(f);let w,S,M,T,x,C,L,O,k,E,P=1e3,A=y;do{if(L=Math.sin(A),O=Math.cos(A),M=Math.sqrt(b*L*(b*L)+(v*_-m*b*O)*(v*_-m*b*O)),0===M)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;x=m*_+v*b*O,C=Math.atan2(M,x),k=v*b*L/M,S=1-k*k,T=x-2*m*_/S,isNaN(T)&&(T=0),E=u/16*S*(4+u*(4-3*S)),w=A,A=y+(1-E)*u*k*(C+E*M*(T+E*x*(2*T*T-1)))}while(Math.abs(A-w)>1e-12&&--P>0);if(0===P){const t=h,o=Math.acos(Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos(s-i))*t,r=s-i,c=Math.sin(r)*Math.cos(a),p=Math.cos(n)*Math.sin(a)-Math.sin(n)*Math.cos(a)*Math.cos(r),d=Math.atan2(c,p);return e.azimuth=d/l.toRadians,e.distance=o,e.reverseAzimuth=void 0,e}const I=S*(c*c-p*p)/(p*p),G=I/1024*(256+I*(I*(74-47*I)-128)),R=p*(1+I/16384*(4096+I*(I*(320-175*I)-768)))*(C-G*M*(T+G/4*(x*(2*T*T-1)-G/6*T*(4*M*M-3)*(4*T*T-3)))),V=Math.atan2(b*Math.sin(A),v*_-m*b*Math.cos(A)),U=Math.atan2(v*Math.sin(A),v*_*Math.cos(A)-m*b);return e.azimuth=V/l.toRadians,e.distance=R,e.reverseAzimuth=U/l.toRadians,e}e.InverseGeodeticSolverResult=f,e.directGeodeticSolver=m,e.geodesicAreas=function(e,r="square-meters"){if(e.some(e=>!y(e.spatialReference)))throw new t("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let t=0;t<e.length;t++){const o=e[t],r=o.spatialReference,{radius:n,densificationRatio:s}=d(r),a=n*s;i.push(g(o,a))}const n=[],s=[0,0],a=[0,0];for(let e=0;e<i.length;e++){const{rings:t,spatialReference:l}=i[e];let c=0;for(let e=0;e<t.length;e++){const o=t[e];h(s,o[0],l),h(a,o[o.length-1],l);let r=a[0]*s[1]-s[0]*a[1];for(let e=0;e<o.length-1;e++)h(s,o[e+1],l),h(a,o[e],l),r+=a[0]*s[1]-s[0]*a[1];c+=r}c=o.convertUnit(c,"square-meters",r),n.push(c/-2)}return n},e.geodesicCompatibleSpatialReference=function(e){return y(e)?e:c.isWebMercator(e)?a.WGS84:null},e.geodesicDensify=g,e.geodesicDistance=function(e,r,i="meters"){if(!e||!r)throw new t("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!e.spatialReference||!r.spatialReference)throw new t("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!c.equals(e.spatialReference,r.spatialReference))throw new t("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");const{spatialReference:n}=e;if(!y(n))throw new t("geodesic-distance:not-supported","input geometry spatial reference is not supported");if(e.x===r.x&&e.y===r.y)return new f(0,0,0);const s=new f;return v(s,[e.x,e.y],[r.x,r.y],n),s.distance=o.convertUnit(s.distance,"meters",i),s.azimuth=u(s.azimuth),s.reverseAzimuth=u(s.reverseAzimuth),s},e.geodesicLengths=function(e,r="meters"){if(!e)throw new t("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some(e=>!y(e.spatialReference)))throw new t("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const i=[];for(let t=0;t<e.length;t++){const n=e[t],{spatialReference:s}=n,a="polyline"===n.type?n.paths:n.rings;let l=0;for(let e=0;e<a.length;e++){const t=a[e];let o=0;for(let e=1;e<t.length;e++){const r=t[e-1][0],i=t[e][0],n=t[e-1][1],a=t[e][1];if(n!==a||r!==i){const e=new f;v(e,[r,n],[i,a],s),o+=e.distance}}l+=o}l=o.convertUnit(l,"meters",r),i.push(l)}return i},e.inverseGeodeticSolver=v,e.isSupported=y,e.pointFromDistance=function(e,o,r){if(!e||null==o||null==r)throw new t("point-from-distance:missing-parameters","one or more input parameters are missing or undefined");if(r<0||r>360)throw new t("point-from-distance:-of-bounds","azimuth is restricted to angles between, and including, 0° to 360° degrees");if(!e.spatialReference)throw new t("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");const{spatialReference:n}=e;if(!y(n))throw new t("geodesic-distance:not-supported","input geometry spatial reference is not supported");const s=[0,0];return m(s,[e.x,e.y],r,o,n),new i({x:s[0],y:s[1],spatialReference:n})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/plane":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../chunks/vec42","./vector","./vectorStacks","../../views/3d/support/mathUtils"],function(e,t,o,r,i,n,s,a){"use strict";function l(e=C){return[e[0],e[1],e[2],e[3]]}const c=i.exactEquals,p=i.equals;function d(e,t){return u(t[0],t[1],t[2],t[3],e)}function u(e,t,o,r,i=l()){return i[0]=e,i[1]=t,i[2]=o,i[3]=r,i}function h(e,t,o){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=Math.abs(r-1)>1e-5&&r>1e-12?1/Math.sqrt(r):1;return o[0]=t[0]*i,o[1]=t[1]*i,o[2]=t[2]*i,o[3]=-(o[0]*e[0]+o[1]*e[1]+o[2]*e[2]),o}function y(e,t,o,r=l()){const i=o[0]-t[0],n=o[1]-t[1],s=o[2]-t[2],a=e[0]-t[0],c=e[1]-t[1],p=e[2]-t[2],d=n*p-s*c,u=s*a-i*p,h=i*c-n*a,y=d*d+u*u+h*h,g=Math.abs(y-1)>1e-5&&y>1e-12?1/Math.sqrt(y):1;return r[0]=d*g,r[1]=u*g,r[2]=h*g,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function g(e,t,r,i=0,n=Math.floor(r*(1/3)),s=Math.floor(r*(2/3))){if(r<3)return!1;t(m,i);let a=n,l=!1;for(;a<r-1&&!l;)t(v,a),a++,l=!o.exactEquals(m,v);if(!l)return!1;for(a=Math.max(a,s),l=!1;a<r&&!l;)t(_,a),a++,o.subtract(b,m,v),o.normalize(b,b),o.subtract(w,v,_),o.normalize(w,w),l=!o.exactEquals(m,_)&&!o.exactEquals(v,_)&&Math.abs(o.dot(b,w))<f;return l?(y(m,v,_,e),!0):(0!==i||1!==n||2!==s)&&g(e,t,r,0,1,2)}const f=.99619469809,m=r.create(),v=r.create(),_=r.create(),b=r.create(),w=r.create();function S(e,t,r){const i=o.scale(s.sv3d.get(),e,o.dot(e,t));return o.subtract(r,t,i),r}function M(e,t){return o.dot(e,t)+e[3]}function T(e){return 0===e||1===e}function x(e,r,i,n,s){const a=o.dot(e,i),l=M(e,r);if(0===a)return l>=0?2:3;let c=-l/a;return 1&n&&(c=t.clamp(c,0,1)),!(4&n)&&c<0||!(8&n)&&c>1?l>=0?2:3:(o.add(s,r,o.scale(s,i,c)),l>=0?0:1)}const C=[0,0,1,0];e.clip=function(e,t){const r=o.dot(e,t.ray.direction),i=-M(e,t.ray.origin);if(i<0&&r>=0)return!1;if(r>-1e-6&&r<1e-6)return i>0;if((i<0||r<0)&&!(i<0&&r<0))return!0;const n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1},e.clipInfinite=function(e,t){const r=o.dot(e,t.ray.direction),i=-M(e,t.ray.origin);if(r>-1e-6&&r<1e-6)return i>0;const n=i/r;return r>0?n<t.c1&&(t.c1=n):n>t.c0&&(t.c0=n),t.c0<=t.c1},e.copy=d,e.create=l,e.distance=function(e,t){return Math.abs(M(e,t))},e.equals=p,e.exactEquals=c,e.fromArray=function(e,t,r=!0){const i=t.length/3;return g(e,(e,r)=>o.set(e,t[3*r+0],t[3*r+1],t[3*r+2]),r?i-1:i)},e.fromManyPoints=g,e.fromNormalAndOffset=function(e,t,r){return o.copy(r,e),r[3]=t,r},e.fromPoints=y,e.fromPositionAndNormal=h,e.fromValues=u,e.fromVectorsAndPoint=function(e,t,r,i){return o.cross(_,t,e),h(r,_,i)},e.getNormal=function(e){return e},e.intersectLine=function(e,t,r,i){return T(x(e,t,o.subtract(s.sv3d.get(),r,t),12,i))},e.intersectLineOrRay=x,e.intersectLineSegment=function(e,t,o){return T(x(e,t.origin,t.vector,0,o))},e.intersectLineSegmentClamp=function(e,t,o){return T(x(e,t.origin,t.vector,1,o))},e.intersectRay=function(e,t,o){return null!=t&&T(x(e,t.origin,t.direction,8,o))},e.isPointInside=function(e,t){return M(e,t)>=0},e.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.projectPoint=function(e,t,r){const i=o.scale(s.sv3d.get(),e,-e[3]),n=S(e,o.subtract(s.sv3d.get(),t,i),s.sv3d.get());return o.add(r,n,i),r},e.projectPointLocal=function(e,t,r,i){const l=e,c=s.sv3d.get(),p=s.sv3d.get();a.tangentFrame(l,c,p);const d=o.subtract(s.sv3d.get(),r,t),u=n.projectPointSignedLength(c,d),h=n.projectPointSignedLength(p,d),y=n.projectPointSignedLength(l,d);return o.set(i,u,h,y)},e.projectVector=S,e.setOffsetFromPoint=function(e,t,r){return t!==e&&d(e,t),e[3]=-o.dot(e,r),e},e.signedDistance=M,e.up=C,e.wrap=function(e=C[0],t=C[1],o=C[2],r=C[3]){return u(e,t,o,r,s.sv4d.get())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,o,r){"use strict";const i=r.create(),n=r.create();e.angle=function(e,r){const i=o.dot(e,r)/(o.length(e)*o.length(r));return-t.acosClamped(i)},e.angleAroundAxis=function(e,r,s){o.normalize(i,e),o.normalize(n,r);const a=o.dot(i,n),l=t.acosClamped(a),c=o.cross(i,i,n);return o.dot(c,s)<0?2*Math.PI-l:l},e.projectPoint=function(e,t,r){const i=o.dot(e,t)/o.dot(e,e);return o.scale(r,e,i)},e.projectPointSignedLength=function(e,t){return o.dot(e,t)/o.length(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(e,t){"use strict";const o=t.VectorStack.createVec2f64(),r=t.VectorStack.createVec3f64(),i=t.VectorStack.createVec4f64(),n=t.VectorStack.createMat3f64(),s=t.VectorStack.createMat4f64(),a=t.VectorStack.createQuatf64();e.sm3d=n,e.sm4d=s,e.sq4d=a,e.sv2d=o,e.sv3d=r,e.sv4d=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define(["exports","./has","./nextTick","./libs/gl-matrix-2/factories/mat3f64","./libs/gl-matrix-2/factories/mat4f64","./libs/gl-matrix-2/factories/quatf64","./libs/gl-matrix-2/factories/vec2f64","./libs/gl-matrix-2/factories/vec3f64","./libs/gl-matrix-2/factories/vec4f64"],function(e,t,o,r,i,n,s,a,l){"use strict";class c{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&o.nextTick(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new c(s.create)}static createVec3f64(){return new c(a.create)}static createVec4f64(){return new c(l.create)}static createMat3f64(){return new c(r.create)}static createMat4f64(){return new c(i.create)}static createQuatf64(){return new c(n.create)}get test(){}}e.VectorStack=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,o,r){"use strict";const i=r.create(),n=r.create(),s=r.create(),a=r.create(),l=r.create();e.angle=function(e,r,i){e=o.normalize(a,e),r=o.normalize(l,r);const n=t.acosClamped(o.dot(e,r));if(i){const t=o.cross(s,e,r);if(o.dot(t,i)<0)return-n}return n},e.bilerp=function(e,t,o,r,i,n){const s=e+(t-e)*i;return s+(o+(r-o)*i-s)*n},e.cosCapped=function(e,t){return e>t?Math.cos(t):Math.cos(e)},e.fovx2fovy=function(e,t,o){return 2*Math.atan(o*Math.tan(.5*e)/t)},e.fovy2fovx=function(e,t,o){return 2*Math.atan(t*Math.tan(.5*e)/o)},e.makeOrthonormal=function(e,t,r){r=r||e;const i=o.dot(e,t);o.set(r,e[0]-i*t[0],e[1]-i*t[1],e[2]-i*t[2]),o.normalize(r,r)},e.makePiecewiseLinearFunction=function(e){const t=e.length;return o=>{if(o<=e[0][0])return e[0][1];if(o>=e[t-1][0])return e[t-1][1];let r=1;for(;o>e[r][0];)r++;const i=e[r-1][0],n=e[r][0],s=(n-o)/(n-i);return s*e[r-1][1]+(1-s)*e[r][1]}},e.maxScale=function(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],o=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],r=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,o,r))},e.midpoint3d=function(e,t){if(o.set(t,0,0,0),e.length>0){for(let r=0;r<e.length;++r)o.add(t,t,e[r]);o.scale(t,t,1/e.length)}},e.planeFromPoints=function(e,t,r,s){o.subtract(i,t,e),o.subtract(n,r,e),o.cross(s,i,n),o.normalize(s,s),s[3]=-o.dot(e,s)},e.scaleFromMatrix=function(e,t){const r=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),i=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),n=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return o.set(e,r,i,n),e},e.slerp=function(e,t,i,n=r.create()){const s=o.length(e),c=o.length(t),p=o.dot(e,t)/(s*c);if(p<.9999999999999999){const r=Math.acos(p),d=((1-i)*s+i*c)/Math.sin(r),u=d/s*Math.sin((1-i)*r),h=d/c*Math.sin(i*r);return o.scale(a,e,u),o.scale(l,t,h),o.add(n,a,l)}return o.lerp(n,e,t,i)},e.slerpTangent=function(e,t,i,n=r.create(),s=r.create()){const c=o.length(e),p=o.length(t),d=o.dot(e,t)/(c*p);if(d<.9999999999999999){const r=Math.acos(d),u=Math.sin(r),h=Math.sin(i*r),y=Math.sin((1-i)*r),g=(1-i)*c+i*p;{const r=g/u,i=r/c*y,s=r/p*h;o.scale(a,e,i),o.scale(l,t,s),o.add(n,a,l)}{const n=1/c*(-Math.cos((1-i)*r)*r*g+y*(-c+p));o.scale(a,e,n);const d=1/p*(Math.cos(i*r)*r*g+h*(-c+p));o.scale(l,t,d),o.add(s,a,l),o.scale(s,s,1/u)}return s}return o.lerp(n,e,t,i),o.subtract(s,t,e),o.normalize(s,s),s},e.tangentFrame=function(e,t,r){Math.abs(e[0])>Math.abs(e[1])?o.set(t,0,1,0):o.set(t,1,0,0),o.cross(r,e,t),o.cross(t,r,e),o.normalize(r,r),o.normalize(t,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/sphere":function(){define(["exports","../core/has","../core/Logger","../core/mathUtils","../core/libs/gl-matrix-2/math/mat4","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","./vec42","../core/libs/gl-matrix-2/factories/vec4f64","../core/libs/gl-matrix-2/math/common","../geometry/support/ray","../geometry/support/sphereUtils","../geometry/support/vector","../geometry/support/vectorStacks"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h){"use strict";const y=g();function g(){return l.create()}const f=a.equals,m=a.equals;function v(e,t){return a.copy(t,e)}function _(e,t){return l.fromValues(e[0],e[1],e[2],t)}function b(e){return e}function w(e){e[0]=e[1]=e[2]=e[3]=0}function S(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function M(e){return e[3]}function T(e){return e}function x(e,t,o,r){return l.fromValues(e,t,o,r)}function C(e,t,o){return e!==o&&(o[0]=e[0],o[1]=e[1],o[2]=e[2]),o[3]=e[3]+t,o}function L(e,t,o){return e!==o&&v(e,o),o}function O(e,t){return t}function k(e,t,o){if(null==t)return!1;if(!A(e,t,P))return!1;let{t0:r,t1:i}=P;if((r<0||i<r&&i>0)&&(r=i),r<0)return!1;if(o){const{origin:e,direction:i}=t;o[0]=e[0]+i[0]*r,o[1]=e[1]+i[1]*r,o[2]=e[2]+i[2]*r}return!0}function E(e,t,o){const r=p.fromPoints(t,o);if(!A(e,r,P))return[];const{origin:i,direction:a}=r,{t0:l,t1:d}=P,u=t=>{const o=s.create();return n.scaleAndAdd(o,i,a,t),D(e,o,o)};return Math.abs(l-d)<c.getEpsilon()?[u(l)]:[u(l),u(d)]}const P={t0:0,t1:0};function A(e,t,o){const{origin:r,direction:i}=t,n=I;n[0]=r[0]-e[0],n[1]=r[1]-e[1],n[2]=r[2]-e[2];const s=i[0]*i[0]+i[1]*i[1]+i[2]*i[2];if(0===s)return!1;const a=2*(i[0]*n[0]+i[1]*n[1]+i[2]*n[2]),l=a*a-4*s*(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);return o.t0=(-a-c)/(2*s),o.t1=(-a+c)/(2*s),!0}const I=s.create();function G(e,t){return k(e,t,null)}function R(e,t,o){if(k(e,t,o))return o;const r=V(e,t,h.sv3d.get());return n.add(o,t.origin,n.scale(h.sv3d.get(),t.direction,n.distance(t.origin,r)/n.length(t.direction))),o}function V(e,t,o){const r=h.sv3d.get(),s=h.sm4d.get();n.cross(r,t.origin,t.direction);const a=M(e);n.cross(o,r,t.origin),n.scale(o,o,1/n.length(o)*a);const l=j(e,t.origin),c=u.angle(t.origin,o);return i.fromRotation(s,c+l,r),n.transformMat4(o,o,s),o}function U(e,t,o,r){const i=M(e),n=i*i,s=t+.5*Math.PI,a=o*o+n-2*Math.cos(s)*o*i,l=Math.sqrt(a),c=a-n;if(c<=0)return.5;const p=Math.sqrt(c),d=Math.acos(p/l)-Math.asin(i/(l/Math.sin(s)));return Math.min(1,(d+.5*r)/r)}function H(e,t,o){return k(e,t,o)?o:(p.closestPoint(t,e,o),D(e,o,o))}function D(e,t,o){const r=n.subtract(h.sv3d.get(),t,e),i=n.scale(h.sv3d.get(),r,e[3]/n.length(r));return n.add(o,i,e)}function F(e,t){const o=n.subtract(h.sv3d.get(),t,e),r=n.squaredLength(o),i=e[3]*e[3];return Math.sqrt(Math.abs(r-i))}function j(e,t){const o=n.subtract(h.sv3d.get(),t,e),i=n.length(o),s=M(e),a=s+Math.abs(s-i);return r.acosClamped(s/a)}const z=s.create();function q(e,t,o,r){const i=n.subtract(z,t,e);switch(o){case 0:{const e=d.cartesianToSpherical(i,z)[2];return n.set(r,-Math.sin(e),Math.cos(e),0)}case 1:{const e=d.cartesianToSpherical(i,z),t=e[1],o=e[2],s=Math.sin(t);return n.set(r,-s*Math.cos(o),-s*Math.sin(o),Math.cos(t))}case 2:return n.normalize(r,i);default:return}}function N(e,t){const o=n.subtract(Z,t,e);return n.length(o)-e[3]}function B(e,t,o,r){const i=N(e,t),s=q(e,t,2,Z),a=n.scale(Z,s,o-i);return n.add(r,t,a)}function W(e,t){const o=n.squaredDistance(e,t),r=M(e);return o<=r*r}function K(e,t,o=l.create()){const r=n.distance(e,t),i=e[3],s=t[3];return r+s<i?(a.copy(o,e),o):r+i<s?(a.copy(o,t),o):(n.lerp(o,e,t,(r+s-i)/(2*r)),o[3]=(r+i+s)/2,o)}const Z=s.create(),$=g(),Q=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:y,altitudeAt:N,angleToSilhouette:j,axisAt:q,cameraFrustumCoverage:U,clear:w,closestPoint:H,closestPointOnSilhouette:V,containsPoint:W,copy:v,create:g,distanceToSilhouette:F,elevate:C,equals:m,exactEquals:f,fromCenterAndRadius:_,fromRadius:S,fromValues:x,getCenter:T,getExtent:O,getRadius:M,intersectLine:E,intersectRay:k,intersectRayClosestSilhouette:R,intersectsRay:G,projectPoint:D,setAltitudeAt:B,setExtent:L,tmpSphere:$,union:K,wrap:b},Symbol.toStringTag,{value:"Module"}));e.NullSphere=y,e.altitudeAt=N,e.angleToSilhouette=j,e.axisAt=q,e.cameraFrustumCoverage=U,e.clear=w,e.closestPoint=H,e.closestPointOnSilhouette=V,e.containsPoint=W,e.copy=v,e.create=g,e.distanceToSilhouette=F,e.elevate=C,e.equals=m,e.exactEquals=f,e.fromCenterAndRadius=_,e.fromRadius=S,e.fromValues=x,e.getCenter=T,e.getExtent=O,e.getRadius=M,e.intersectLine=E,e.intersectRay=k,e.intersectRayClosestSilhouette=R,e.intersectsRay=G,e.projectPoint=D,e.setAltitudeAt=B,e.setExtent=L,e.sphere=Q,e.tmpSphere=$,e.union=K,e.wrap=b})},"esri/geometry/support/ray":function(){define(["exports","../../core/arrayUtils","../../core/ObjectStack","../../core/libs/gl-matrix-2/math/mat3","../../core/libs/gl-matrix-2/factories/mat3f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],function(e,t,o,r,i,n,s,a){"use strict";function l(e){return e?c(s.clone(e.origin),s.clone(e.direction)):c(s.create(),s.create())}function c(e,t){return{origin:e,direction:t}}function p(e,t,o=l()){return n.copy(o.origin,e),n.copy(o.direction,t),o}const d=new o.ObjectStack(()=>l()),u=s.create(),h=s.create(),y=s.create(),g=i.create();e.closestPoint=function(e,t,o){const r=n.dot(e.direction,n.subtract(o,t,e.origin));return n.add(o,e.origin,n.scale(o,e.direction,r)),o},e.closestPoints=function(e,t,o,i){const s=e.origin,a=t.origin,l=e.direction,c=t.direction,p=n.dot(n.normalize(h,l),n.normalize(y,c));if(Math.abs(p)>=1)return null;const d=n.cross(h,l,c),f=n.sub(u,a,s),m=r.set(g,l[0],l[1],l[2],-c[0],-c[1],-c[2],d[0],d[1],d[2]),v=r.invert(g,m);if(null==v)return[o,i];const _=n.dot(n.set(h,v[0],v[3],v[6]),f),b=n.dot(n.set(y,v[1],v[4],v[7]),f);return n.add(o,s,n.scale(u,l,_)),n.add(i,a,n.scale(u,c,b)),[o,i]},e.copy=function(e,t=l()){return p(e.origin,e.direction,t)},e.create=l,e.distance2=function(e,t){const o=n.cross(a.sv3d.get(),n.normalize(a.sv3d.get(),e.direction),n.subtract(a.sv3d.get(),t,e.origin));return n.dot(o,o)},e.equals=function(e,o){return t.equals(e.origin,o.origin)&&t.equals(e.direction,o.direction)},e.fromPoints=function(e,t,o=l()){return n.copy(o.origin,e),n.subtract(o.direction,t,e),o},e.fromValues=p,e.wrap=function(e,t){const o=d.get();return o.origin=e,o.direction=t,o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(e,t){"use strict";e.ObjectStack=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&t.nextTick(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,1024));e++)this._items.push(this._allocator())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],function(e,t){"use strict";function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function i(e,t,o,r,i,n,s,a,l,c){return e[0]=t,e[1]=o,e[2]=r,e[3]=i,e[4]=n,e[5]=s,e[6]=a,e[7]=l,e[8]=c,e}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function s(e,t){if(e===t){const o=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=o,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function a(e,t){const o=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],p=t[8],d=p*s-a*c,u=-p*n+a*l,h=c*n-s*l;let y=o*d+r*u+i*h;return y?(y=1/y,e[0]=d*y,e[1]=(-p*r+i*c)*y,e[2]=(a*r-i*s)*y,e[3]=u*y,e[4]=(p*o-i*l)*y,e[5]=(-a*o+i*n)*y,e[6]=h*y,e[7]=(-c*o+r*l)*y,e[8]=(s*o-r*n)*y,e):null}function l(e,t){const o=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],p=t[8];return e[0]=s*p-a*c,e[1]=i*c-r*p,e[2]=r*a-i*s,e[3]=a*l-n*p,e[4]=o*p-i*l,e[5]=i*n-o*a,e[6]=n*c-s*l,e[7]=r*l-o*c,e[8]=o*s-r*n,e}function c(e){const t=e[0],o=e[1],r=e[2],i=e[3],n=e[4],s=e[5],a=e[6],l=e[7],c=e[8];return t*(c*n-s*l)+o*(-c*i+s*a)+r*(l*i-n*a)}function p(e,t,o){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],p=t[7],d=t[8],u=o[0],h=o[1],y=o[2],g=o[3],f=o[4],m=o[5],v=o[6],_=o[7],b=o[8];return e[0]=u*r+h*s+y*c,e[1]=u*i+h*a+y*p,e[2]=u*n+h*l+y*d,e[3]=g*r+f*s+m*c,e[4]=g*i+f*a+m*p,e[5]=g*n+f*l+m*d,e[6]=v*r+_*s+b*c,e[7]=v*i+_*a+b*p,e[8]=v*n+_*l+b*d,e}function d(e,t,o){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],p=t[7],d=t[8],u=o[0],h=o[1];return e[0]=r,e[1]=i,e[2]=n,e[3]=s,e[4]=a,e[5]=l,e[6]=u*r+h*s+c,e[7]=u*i+h*a+p,e[8]=u*n+h*l+d,e}function u(e,t,o){const r=t[0],i=t[1],n=t[2],s=t[3],a=t[4],l=t[5],c=t[6],p=t[7],d=t[8],u=Math.sin(o),h=Math.cos(o);return e[0]=h*r+u*s,e[1]=h*i+u*a,e[2]=h*n+u*l,e[3]=h*s-u*r,e[4]=h*a-u*i,e[5]=h*l-u*n,e[6]=c,e[7]=p,e[8]=d,e}function h(e,t,o){const r=o[0],i=o[1],n=o[2];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=n*t[6],e[7]=n*t[7],e[8]=n*t[8],e}function y(e,t,o){const r=o[0],i=o[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e}function g(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function f(e,t){const o=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=o,e[2]=0,e[3]=-o,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function m(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function v(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function _(e,t){const o=t[0],r=t[1],i=t[2],n=t[3],s=o+o,a=r+r,l=i+i,c=o*s,p=r*s,d=r*a,u=i*s,h=i*a,y=i*l,g=n*s,f=n*a,m=n*l;return e[0]=1-d-y,e[3]=p-m,e[6]=u+f,e[1]=p+m,e[4]=1-c-y,e[7]=h-g,e[2]=u-f,e[5]=h+g,e[8]=1-c-d,e}function b(e,t){const o=t[0],r=t[1],i=t[2],n=t[4],s=t[5],a=t[6],l=t[8],c=t[9],p=t[10],d=p*s-a*c,u=-p*n+a*l,h=c*n-s*l,y=o*d+r*u+i*h;if(!y)return null;const g=1/y;return e[0]=d*g,e[1]=(-p*r+i*c)*g,e[2]=(a*r-i*s)*g,e[3]=u*g,e[4]=(p*o-i*l)*g,e[5]=(-a*o+i*n)*g,e[6]=h*g,e[7]=(-c*o+r*l)*g,e[8]=(s*o-r*n)*g,e}function w(e,t){const o=t[0],r=t[1],i=t[2],n=t[3],s=t[4],a=t[5],l=t[6],c=t[7],p=t[8],d=t[9],u=t[10],h=t[11],y=t[12],g=t[13],f=t[14],m=t[15],v=o*a-r*s,_=o*l-i*s,b=o*c-n*s,w=r*l-i*a,S=r*c-n*a,M=i*c-n*l,T=p*g-d*y,x=p*f-u*y,C=p*m-h*y,L=d*f-u*g,O=d*m-h*g,k=u*m-h*f;let E=v*k-_*O+b*L+w*C-S*x+M*T;return E?(E=1/E,e[0]=(a*k-l*O+c*L)*E,e[1]=(l*C-s*k-c*x)*E,e[2]=(s*O-a*C+c*T)*E,e[3]=(i*O-r*k-n*L)*E,e[4]=(o*k-i*C+n*x)*E,e[5]=(r*C-o*O-n*T)*E,e[6]=(g*M-f*S+m*w)*E,e[7]=(f*b-y*M-m*_)*E,e[8]=(y*S-g*b+m*v)*E,e):null}function S(e,t,o){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/o,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function M(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function T(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function x(e,t,o){return e[0]=t[0]+o[0],e[1]=t[1]+o[1],e[2]=t[2]+o[2],e[3]=t[3]+o[3],e[4]=t[4]+o[4],e[5]=t[5]+o[5],e[6]=t[6]+o[6],e[7]=t[7]+o[7],e[8]=t[8]+o[8],e}function C(e,t,o){return e[0]=t[0]-o[0],e[1]=t[1]-o[1],e[2]=t[2]-o[2],e[3]=t[3]-o[3],e[4]=t[4]-o[4],e[5]=t[5]-o[5],e[6]=t[6]-o[6],e[7]=t[7]-o[7],e[8]=t[8]-o[8],e}function L(e,t,o){return e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e[3]=t[3]*o,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*o,e}function O(e,t,o,r){return e[0]=t[0]+o[0]*r,e[1]=t[1]+o[1]*r,e[2]=t[2]+o[2]*r,e[3]=t[3]+o[3]*r,e[4]=t[4]+o[4]*r,e[5]=t[5]+o[5]*r,e[6]=t[6]+o[6]*r,e[7]=t[7]+o[7]*r,e[8]=t[8]+o[8]*r,e}function k(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function E(e,o){const r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],l=e[5],c=e[6],p=e[7],d=e[8],u=o[0],h=o[1],y=o[2],g=o[3],f=o[4],m=o[5],v=o[6],_=o[7],b=o[8],w=t.getEpsilon();return Math.abs(r-u)<=w*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(i-h)<=w*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(n-y)<=w*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(s-g)<=w*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-f)<=w*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(l-m)<=w*Math.max(1,Math.abs(l),Math.abs(m))&&Math.abs(c-v)<=w*Math.max(1,Math.abs(c),Math.abs(v))&&Math.abs(p-_)<=w*Math.max(1,Math.abs(p),Math.abs(_))&&Math.abs(d-b)<=w*Math.max(1,Math.abs(d),Math.abs(b))}function P(e){const o=t.getEpsilon(),r=e[0],i=e[1],n=e[2],s=e[3],a=e[4],l=e[5],c=e[6],p=e[7],d=e[8];return Math.abs(1-(r*r+s*s+c*c))<=o&&Math.abs(1-(i*i+a*a+p*p))<=o&&Math.abs(1-(n*n+l*l+d*d))<=o}const A=p,I=C,G=Object.freeze(Object.defineProperty({__proto__:null,add:x,adjoint:l,copy:r,determinant:c,equals:E,exactEquals:k,frob:T,fromMat2d:v,fromMat4:o,fromQuat:_,fromRotation:f,fromScaling:m,fromTranslation:g,identity:n,invert:a,isOrthoNormal:P,mul:A,multiply:p,multiplyScalar:L,multiplyScalarAndAdd:O,normalFromMat4:w,normalFromMat4Legacy:b,projection:S,rotate:u,scale:h,scaleByVec2:y,set:i,str:M,sub:I,subtract:C,translate:d,transpose:s},Symbol.toStringTag,{value:"Module"}));e.add=x,e.adjoint=l,e.copy=r,e.determinant=c,e.equals=E,e.exactEquals=k,e.frob=T,e.fromMat2d=v,e.fromMat4=o,e.fromQuat=_,e.fromRotation=f,e.fromScaling=m,e.fromTranslation=g,e.identity=n,e.invert=a,e.isOrthoNormal=P,e.mat3=G,e.mul=A,e.multiply=p,e.multiplyScalar=L,e.multiplyScalarAndAdd=O,e.normalFromMat4=w,e.normalFromMat4Legacy=b,e.projection=S,e.rotate=u,e.scale=h,e.scaleByVec2=y,e.set=i,e.str=M,e.sub=I,e.subtract=C,e.translate=d,e.transpose=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/sphereUtils":function(){define(["exports","../../core/mathUtils","../../chunks/vec32"],function(e,t,o){"use strict";e.cartesianToSpherical=function(e,r){const i=o.length(e),n=t.asinClamped(e[2]/i),s=Math.atan2(e[1]/i,e[0]/i);return o.set(r,i,n,s),r},e.sphericalToCartesian=function(e,t){const r=e[0],i=e[1],n=e[2],s=Math.cos(i);o.set(t,r*s*Math.cos(n),r*s*Math.sin(n),r*Math.sin(i))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geometry3dUtils":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../core/libs/gl-matrix-2/math/common","../../geometry/support/plane","../3d/support/mathUtils","./geometry2dUtils"],function(e,t,o,r,i,n,s,a,l,c){"use strict";function p(e,{start:t,end:o,type:r},s=n.create()){const a=i.sub(w,e,t),l=i.sub(S,o,t),c=i.dot(a,l)/i.dot(l,l);return i.scaleAndAdd(s,t,l,0===r?Math.max(c,0):c)}function d({start:e,end:t,type:o},r){const n=i.sub(w,r,e),a=i.sub(S,t,e);if(0===o&&i.dot(a,n)<-s.getEpsilon())return i.distance(e,r);const l=i.cross(M,a,n);return i.len(l)/i.len(a)}const u=(()=>{const e=n.create(),t=n.create(),s=n.create();return({start:p,end:d},{center:u,radius:h,normal:y,slicePlane:g})=>{const v=a.fromPositionAndNormal(u,y,O);if(f(a.distance(v,p),0)&&f(a.distance(v,d),0)){l.tangentFrame(y,e,t);const a=(r,n)=>(i.subtract(s,n,u),o.set(r,i.dot(s,e),i.dot(s,t)),r),f=c.intersectLineLikeAndCircle({start:a(_,p),end:a(b,d),type:1},r.ZEROS,h),v=[];for(const[o,r]of f){const s=i.copy(n.create(),u);i.scaleAndAdd(s,s,e,o),i.scaleAndAdd(s,s,t,r),g&&!m(g,s)||v.push(s)}return v}const w=n.create();return a.intersectLine(v,p,d,w)?!f(i.distance(w,u),h)||g&&!m(g,w)?[]:[w]:[]}})();function h(e,t){const o=e.start,r=e.end,a=t.start,l=t.end,c=i.sub(w,r,o),p=i.sub(S,l,a),d=i.sub(M,a,o),u=i.cross(T,c,p);if(!f(i.dot(d,u),0))return[];const h=i.sqrLen(u);if(f(h,0))return[];const y=i.cross(x,d,p),g=i.dot(y,u)/h,m=i.scaleAndAdd(C,o,c,g);if(0===e.type){const e=i.sub(L,m,o);if(i.dot(c,e)<-s.getEpsilon())return[]}if(0===t.type){const e=i.sub(L,m,a);if(i.dot(p,e)<-s.getEpsilon())return[]}return[n.clone(m)]}function y({start:e,end:t,type:o},r){const a=i.sub(w,r,e),l=i.sub(S,t,e),c=i.cross(M,l,a),p=i.sqrLen(c)/i.sqrLen(l),d=s.getEpsilon();if(p<d)switch(o){case 1:return[n.clone(r)];case 0:return i.dot(l,a)<-d?[]:[n.clone(r)]}return[]}function g(e,t,{start:o,end:r,type:n}){return i.set(e.start,o[0],o[1],t),i.set(e.end,r[0],r[1],t),e.type=v[n],e}function f(e,o){return t.floatEqualAbsolute(Math.abs(e-o),0,s.getEpsilon())}function m(e,t){return a.isPointInside(e,t)}const v={0:1,1:0},_=r.create(),b=r.create(),w=n.create(),S=n.create(),M=n.create(),T=n.create(),x=n.create(),C=n.create(),L=n.create(),O=a.create(),k={start:n.create(),end:n.create(),type:1},E={start:n.create(),end:n.create(),type:1};e.intersectLineAndPoint=y,e.intersectLineLikeAndCircle=u,e.intersectLineLikeAndVerticalCylinder=function({start:e,end:t,type:r},s,a){const l=[],c=i.subtract(w,t,e),p=o.subtract(b,e,s),d=o.squaredLength(c),u=2*o.dot(c,p),h=u*u-4*d*(o.squaredLength(p)-a*a);if(0===h){const t=-u/(2*d);(1===r||t>=0)&&l.push(i.scaleAndAdd(n.create(),e,c,t))}else if(h>0){const t=Math.sqrt(h),o=(-u+t)/(2*d);(1===r||o>=0)&&l.push(i.scaleAndAdd(n.create(),e,c,o));const s=(-u-t)/(2*d);(1===r||s>=0)&&l.push(i.scaleAndAdd(n.create(),e,c,s))}return l},e.intersectLineLikes=h,e.intersectVerticalCylinderAndPoint=function(e,t,r){return f(o.squaredDistance(r,e),t*t)?[n.clone(r)]:[]},e.intersectVerticalCylinders=function(e,t,i,n){const[s,a]=e,[l,c]=i,p=l-s,d=c-a,u=p*p+d*d,h=Math.sqrt(u);if(h>t+n)return[];if(h<Math.abs(t-n))return[];if(f(h,0)&&f(t,n))return[];const y=(t*t-n*n+u)/(2*h),g=Math.sqrt(t*t-y*y),m=g*d/h,v=g*p/h,[b,w]=o.lerp(_,e,i,y/h);return f(m,v)?[r.fromValues(b,w)]:[r.fromValues(b+m,w-v),r.fromValues(b-m,w+v)]},e.intersectVerticalPlaneAndLineLike=function(e,t){const r=e.start,a=e.end,l=o.subtract(_,a,r),c=i.set(S,-l[1],l[0],0),p=t.start,d=t.end,u=i.sub(M,d,p),h=i.dot(u,c),y=i.set(T,r[0],r[1],0),g=i.sub(x,y,p),f=i.dot(g,c),m=s.getEpsilon();if(Math.abs(h)<m)return Math.abs(f),[];const v=f/h,w=i.scaleAndAdd(C,p,u,v);if(0===t.type){const e=i.sub(L,w,p);if(i.dot(e,u)<-m)return[]}if(1===e.type){const e=o.sub(b,w,r);if(o.dot(e,l)<-m)return[]}return[n.clone(w)]},e.intersectVerticalPlaneAndPoint=function(e,t){return y(g(k,t[2],e),t)},e.intersectVerticalPlaneAndVerticalCylinder=function({start:e,end:t,type:i},n,s){const a=[],l=o.subtract(_,t,e),c=o.subtract(b,e,n),p=o.squaredLength(l),d=2*o.dot(l,c),u=d*d-4*p*(o.squaredLength(c)-s*s);if(0===u){const t=-d/(2*p);(0===i||t>=0)&&a.push(o.scaleAndAdd(r.create(),e,l,t))}else if(u>0){const t=Math.sqrt(u),n=(-d+t)/(2*p);(0===i||n>=0)&&a.push(o.scaleAndAdd(r.create(),e,l,n));const s=(-d-t)/(2*p);(0===i||s>=0)&&a.push(o.scaleAndAdd(r.create(),e,l,s))}return a},e.intersectVerticalPlanes=function(e,t){return h(g(k,0,e),g(E,0,t)).map(([e,t])=>r.fromValues(e,t))},e.isClose=f,e.isPointInsidePlane=m,e.pointToLineLikeDistance=d,e.pointToVerticalCylinderDistance=function(e,t,r){return o.distance(e,t)-r},e.pointToVerticalPlaneDistance=function(e,t){return d(g(k,e[2],t),e)},e.pointsInsidePlane=function(e,t){return t.filter(t=>m(e,t))},e.projectPointToLineLike=p,e.projectPointToVerticalCylinder=function(e,t,r,i=n.create()){const s=o.subtract(_,e,t),a=o.length(s),l=0===a?1:r/a;return o.scaleAndAdd(i,t,s,l),i[2]=e[2],i},e.projectPointToVerticalPlane=function(e,t,o){return p(e,g(k,e[2],t),o)},e.vectorsHaveCloseZ=function(e,t){return f(e[2],t[2])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geometry2dUtils":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64"],function(e,t,o,r){"use strict";function i(e,t){return e[0]*t[1]-e[1]*t[0]}function n(e,t,r){const i=o.dot(r,t)/o.squaredLength(r);return o.scale(e,r,i)}function s(e,t,r,i,s=r){return o.subtract(l,i,r),o.subtract(p,t,s),n(d,p,l),o.add(e,s,d)}function a(e,t,r,i){o.subtract(l,t,r);const n=i/o.length(l);return o.scaleAndAdd(e,r,l,n)}const l=r.create(),c=r.create(),p=r.create(),d=r.create();e.cross=i,e.intersectCircleAndPoint=function(e,o,i){return a(p,i,e,o),t.floatEqualAbsolute(p[0],i[0])&&t.floatEqualAbsolute(p[1],i[1])?[r.clone(i)]:[]},e.intersectLineAndPoint=function(e,o){return s(p,o,e.start,e.end),t.floatEqualAbsolute(p[0],o[0])&&t.floatEqualAbsolute(p[1],o[1])?[r.clone(o)]:[]},e.intersectLineAndRay=function(e,t){const r=e.start,n=e.end,s=t.start,a=t.end,u=o.subtract(l,n,r),h=o.subtract(c,a,s),y=i(u,h);if(Math.abs(y)<=1e-6)return[];const g=o.subtract(p,r,s),f=i(h,g)/y,m=i(u,g)/y;if(f>=0){if(m>=0||1===t.type)return[o.scaleAndAdd(d,r,u,f)]}else if(1===e.type&&(m>=0||1===t.type))return[o.scaleAndAdd(d,r,u,f)];return[]},e.intersectLineLikeAndCircle=function(e,t,r){const i=[],n=o.subtract(l,e.end,e.start),s=o.subtract(c,e.start,t),a=o.squaredLength(n),u=2*o.dot(n,s),h=u*u-4*a*(o.squaredLength(s)-r*r);if(0===h){const t=-u/(2*a);(1===e.type||t>=0)&&i.push(o.scaleAndAdd(d,e.start,n,t))}else if(h>0){const t=Math.sqrt(h),r=(-u+t)/(2*a);(1===e.type||r>=0)&&i.push(o.scaleAndAdd(d,e.start,n,r));const s=(-u-t)/(2*a);(1===e.type||s>=0)&&i.push(o.scaleAndAdd(p,e.start,n,s))}return i},e.pointToLineDistance=function(e,t,r){const i=(t[0]-e[0])*(r[1]-e[1])-(t[1]-e[1])*(r[0]-e[0]);return Math.abs(i)/o.distance(t,r)},e.projectPoint=n,e.projectPointToCircle=a,e.projectPointToLine=s,e.projectPointToRay=function(e,t,r,i){o.subtract(l,i,r),o.subtract(p,t,r);const n=o.dot(l,p)/o.squaredLength(l);return n>0?o.scaleAndAdd(e,r,l,n):o.copy(e,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/FeatureSnappingCandidate":function(){define(["exports","./SnappingCandidate"],function(e,t){"use strict";class o extends t.SnappingCandidate{constructor({targetPoint:e,objectId:t,constraint:o,isDraped:r}){super(e,o,r,1),this.objectId=t}}e.FeatureSnappingCandidate=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/SnappingCandidate":function(){define(["exports"],function(e){"use strict";e.SnappingCandidate=class{constructor(e,t,o,r){this.targetPoint=e,this.constraint=t,this.isDraped=o,this.domain=r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/LineSnappingHint":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../chunks/vec32","./SnappingHint"],function(e,t,o,r,i){"use strict";class n extends i.SnappingHint{constructor(e,t,o,r,i=3,n=!0,s=!0){super(r,i),this.type=e,this.lineStart=t,this.lineEnd=o,this.fadeLeft=n,this.fadeRight=s}equals(e){return e instanceof n&&this.type===e.type&&r.exactEquals(this.lineStart,e.lineStart)&&r.exactEquals(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}get length(){return r.distance(this.lineStart,this.lineEnd)}}e.LineSnappingHint=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/SnappingHint":function(){define(["exports"],function(e){"use strict";e.SnappingHint=class{constructor(e,t){this.isDraped=e,this.domain=t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/EdgeSnappingCandidate":function(){define(["exports","../../sketch/constraints","./FeatureSnappingCandidate","../hints/LineSnappingHint"],function(e,t,o,r){"use strict";class i extends o.FeatureSnappingCandidate{constructor(e){super({...e,constraint:new t.LineConstraint(e.edgeStart,e.edgeEnd)})}get hints(){return[new r.LineSnappingHint(1,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}e.EdgeSnappingCandidate=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/IntersectionSnappingCandidate":function(){define(["exports","../../sketch/constraints","./SnappingCandidate","../hints/IntersectionSnappingHint"],function(e,t,o,r){"use strict";class i extends o.SnappingCandidate{constructor(e,o,r,i){super(e,new t.PointConstraint(e),i,3),this.first=o,this.second=r}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new r.IntersectionSnappingHint(this.targetPoint,this.isDraped,this.domain)]}}e.IntersectionSnappingCandidate=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/IntersectionSnappingHint":function(){define(["exports","../../../../chunks/vec32","./SnappingHint"],function(e,t,o){"use strict";class r extends o.SnappingHint{constructor(e,t,o=3){super(t,o),this.intersectionPoint=e}equals(e){return e instanceof r&&t.exactEquals(this.intersectionPoint,e.intersectionPoint)}}e.IntersectionSnappingHint=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/LineSnappingCandidate":function(){define(["exports","../../sketch/constraints","./SnappingCandidate","../hints/LineSnappingHint"],function(e,t,o,r){"use strict";class i extends o.SnappingCandidate{constructor({lineStart:e,lineEnd:o,targetPoint:i,isDraped:n}){super(i,new t.VerticalPlaneConstraint(e,o),n,2),this._referenceLineHint=new r.LineSnappingHint(2,e,o,n,this.domain)}get hints(){return[this._referenceLineHint,new r.LineSnappingHint(0,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}}e.LineSnappingCandidate=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/ParallelLineSnappingCandidate":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../sketch/constraints","../../sketch/normalizedPoint","./SnappingCandidate","../hints/LineSnappingHint","../hints/ParallelSnappingHint"],function(e,t,o,r,i,n,s,a){"use strict";class l extends n.SnappingCandidate{constructor({referenceLine:e,lineStart:n,targetPoint:s,isDraped:a}){const l=o.clone(n),{left:c,right:p}=e;t.subtract(l,t.add(l,l,p),c),super(s,new r.VerticalPlaneConstraint(n,i.fromVec3(l)),a,2),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new s.LineSnappingHint(0,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new a.ParallelSnappingHint(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new s.LineSnappingHint(1,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const o={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(r=>{t.exactEquals(e.right,r.edge.left)&&(r.fadeLeft=!1,o.fadeRight=!1),t.exactEquals(e.right,r.edge.right)&&(r.fadeRight=!1,o.fadeRight=!1),t.exactEquals(e.left,r.edge.right)&&(r.fadeRight=!1,o.fadeLeft=!1),t.exactEquals(e.left,r.edge.left)&&(r.fadeLeft=!1,o.fadeLeft=!1)}),this._referenceLines.push(o)}}e.ParallelLineSnappingCandidate=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/ParallelSnappingHint":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../chunks/vec32","./SnappingHint"],function(e,t,o,r,i){"use strict";class n extends i.SnappingHint{constructor(e,t,o,r=3){super(o,r),this.lineStart=e,this.lineEnd=t}equals(e){return e instanceof n&&r.exactEquals(this.lineStart,e.lineStart)&&r.exactEquals(this.lineEnd,e.lineEnd)}}e.ParallelSnappingHint=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/RightAngleSnappingCandidate":function(){define(["exports","./SnappingCandidate","../hints/LineSnappingHint","../hints/RightAngleSnappingHint"],function(e,t,o,r){"use strict";class i extends t.SnappingCandidate{constructor({targetPoint:e,constraint:t,previousVertex:o,otherVertex:r,otherVertexType:i,isDraped:n,selfSnappingType:s,objectId:a,domain:l}){super(e,t,n,l??2),this.previousVertex=o,this.otherVertex=r,this.otherVertexType=i,this.selfSnappingType=s??0,this.objectId=a??null}get hints(){const e=this.previousVertex,t=1===this.otherVertexType?this.otherVertex:this.targetPoint,i=1===this.otherVertexType?this.targetPoint:this.otherVertex;return[new o.LineSnappingHint(0,t,i,this.isDraped,this.domain),new o.LineSnappingHint(1,e,t,this.isDraped,this.domain),new r.RightAngleSnappingHint(this.previousVertex,t,i,this.isDraped,this.domain)]}}e.RightAngleSnappingCandidate=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/hints/RightAngleSnappingHint":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../chunks/vec32","./SnappingHint"],function(e,t,o,r,i){"use strict";class n extends i.SnappingHint{constructor(e,t,o,r,i=3){super(r,i),this.previousVertex=e,this.centerVertex=t,this.nextVertex=o}equals(e){return e instanceof n&&r.exactEquals(this.previousVertex,e.previousVertex)&&r.exactEquals(this.centerVertex,e.centerVertex)&&r.exactEquals(this.nextVertex,e.nextVertex)}}e.RightAngleSnappingHint=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/candidates/RightAngleTriangleSnappingCandidate":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../sketch/constraints","../../sketch/normalizedPoint","./SnappingCandidate","../hints/LineSnappingHint","../hints/RightAngleSnappingHint"],function(e,t,o,r,i,n,s,a,l){"use strict";class c extends s.SnappingCandidate{constructor({targetPoint:e,point1:s,point2:a,isDraped:l}){super(e,new i.VerticalCylinderConstraint(n.fromVec3(o.lerp(r.create(),s,a,.5)),.5*t.distance(n.asVec2(s),n.asVec2(a))),l,2),this._p1=s,this._p2=a}get hints(){return[new a.LineSnappingHint(1,this.targetPoint,this._p1,this.isDraped,this.domain),new a.LineSnappingHint(1,this.targetPoint,this._p2,this.isDraped,this.domain),new l.RightAngleSnappingHint(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}e.RightAngleTriangleSnappingCandidate=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/support/viewUtils":function(){define(["exports","../../../core/screenUtils","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../layers/graphics/dehydratedPoint","../../3d/interactive/support/viewUtils"],function(e,t,o,r,i){"use strict";const n=r.makeDehydratedPoint(0,0,0,null),s=o.create(),a=t.createScreenPointArray();e.vectorToScreenPoint=function(e,o,r,l){return"2d"===l.type?(n.x=e[0],n.y=e[1],n.spatialReference=o,l.toScreen(n)):(i.vectorToRender(e,o,r,l,s),l.state.camera.projectToScreen(s,a),t.createScreenPoint(a[0],a[1]))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/interactive/support/viewUtils":function(){define(["exports","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/math/vec2","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../support/elevationInfoUtils"],function(e,t,o,r,i,n){"use strict";const s=i.create(),a=t.createRenderScreenPointArray(),l=t.createRenderScreenPointArray();e.renderScreenSpaceTangent=function(e,t,r,i){r.projectToRenderScreen(e,a),r.projectToRenderScreen(t,l),o.subtract(i,l,a),o.normalize(i,i)},e.vectorToRender=function(e,t,o,a,l=i.create()){const c=r.copy(s,e);return c[2]=n.getConvertedElevationFromVector(a,c,t,o)||0,a.renderCoordsHelper.toRenderCoords(c,t,l),l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geodesicLengthMeasurementUtils":function(){define(["exports","../../core/quantityUtils","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/Polyline","../../chunks/geodeticLengthOperator","../../geometry/support/geodesicUtils","../../geometry/support/spatialReferenceUtils","./geodesicMeasurementUtils"],function(e,t,o,r,i,n,s,a){"use strict";function l(e,t,o){return a.geodesicMeasure(o,p,d,e,t,o)}const c={geodesicLength:function(e){const{spatialReference:t}=e;return a.geodesicMeasure(t,u,h,e)},geodesicDistanceBetweenPoints:function(e,t){if(!s.equals(e.spatialReference,t.spatialReference))return null;const{spatialReference:o}=e;return g[0]=e.x,g[1]=e.y,g[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,l(g,f,o)},geodesicDistance:l};function p(e,o,r){return t.createLength(n.inverseGeodeticSolver(y,e,o,r).distance,"meters")}function d(e,o,n){return t.createLength(i.execute(function(e,t,o){return new r({spatialReference:o,paths:[[[...e],[...t]]]})}(e,o,n),{unit:"meters"}),"meters")}function u(e){return t.createLength(n.geodesicLengths([e],"meters")[0],"meters")}function h(e){return t.createLength(i.execute(e,{unit:"meters"}),"meters")}const y=new n.InverseGeodeticSolverResult,g=o.create(),f=o.create();e.loadGeodesicLengthMeasurementUtils=async function(){return await i.load(),c},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/quantityUtils":function(){define(["exports","./unitUtils"],function(e,t){"use strict";function o(e,o){return{type:t.unitType(o),value:e,unit:o}}function r(e,o){return{type:t.unitType(o),value:e,unit:o}}function i(e,o){return{type:t.unitType(o),value:e,unit:o}}function n(e,o,r="arithmetic"){return{type:t.unitType(o),value:e,unit:o,rotationType:r}}function s(e,t){const r=a(e,t);return"angle"===e.type?n(r,t,e.rotationType):o(r,t)}function a(e,o){return t.convertUnit(e.value,e.unit,o)}const l=r(0,"meters"),c=i(0,"square-meters"),p=n(0,"radians"),d=n(0,"degrees"),u=n(0,"degrees","geographic");e.convertRotationType=function(e,t,o){if(t===o)return e;switch(o){case"arithmetic":case"geographic":return 90-e}},e.createAngle=n,e.createArea=i,e.createLength=r,e.createQuantity=o,e.createScalar=function(e){return{value:e}},e.isBaseUnit=function(e){return t.isBaseUnit(e.unit)},e.max=function(e,o){return null==e?o:null==o||e.value>t.convertUnit(o.value,o.unit,e.unit)?e:o},e.min=function(e,o){return null==e?o:null==o||e.value<t.convertUnit(o.value,o.unit,e.unit)?e:o},e.scale=function(e,t){return null==e?null:{...e,value:e.value*t}},e.toBaseUnit=function(e){return s(e,t.baseUnitForUnit(e.unit))},e.toUnit=s,e.valueInUnit=a,e.zeroDegrees=d,e.zeroDegreesGeographic=u,e.zeroMeters=l,e.zeroRadians=p,e.zeroSquareMeters=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/geodeticLengthOperator":function(){define(["require","exports","../core/unitUtils","../geometry/operators/gx/operatorGeodeticLength","../geometry/operators/support/geodeticCurveType"],function(e,t,o,r,i){"use strict";let n,s,a;function l(){return!!n&&r.isLoaded()}async function c(){if(!l()){const[o]=await Promise.all([new Promise((t,o)=>e(["../geometry/operators/support/apiConverter"],t,o)),r.load()]);n=o.fromGeometry,s=o.fromSpatialReference,a=o.getSpatialReference,t.supportsCurves=r.supportsCurves()}}function p(e,t={}){const{curveType:l="geodesic",unit:c}=t,p=a(e);let d=r.execute(n(e),s(p),i.geodeticCurveType[l]);return d&&c&&(d=o.convertUnit(d,"meters",c)),d}t.supportsCurves=void 0;const d=Object.freeze(Object.defineProperty({__proto__:null,execute:p,isLoaded:l,load:c,get supportsCurves(){return t.supportsCurves}},Symbol.toStringTag,{value:"Module"}));t.execute=p,t.geodeticLengthOperator=d,t.isLoaded=l,t.load=c})},"esri/geometry/operators/gx/operatorGeodeticLength":function(){define(["require","exports","../../../chunks/pe"],function(e,t,o){"use strict";let r;function i(){return!!r&&o.isLoaded()}t.execute=function(e,t,o){return r.execute(e,t,o,null)},t.isLoaded=i,t.load=async function(){if(!i()){const[t,i]=await Promise.all([new Promise((t,o)=>e(["../../../chunks/OperatorGeodeticLength"],t,o)),new Promise((t,o)=>e(["../../../chunks/ProjectionTransformation"],t,o)).then(e=>e.SpatialReference).then(({injectPe:e})=>e),o.load()]);r=new t.OperatorGeodeticLength,i(o.pe)}},t.supportsCurves=function(){return r.supportsCurves()},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/operators/support/geodeticCurveType":function(){define(["exports"],function(e){"use strict";e.geodeticCurveType={geodesic:0,loxodrome:1,"great-elliptic":2,"normal-section":3,"shape-preserving":4},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geodesicMeasurementUtils":function(){define(["exports","../../geometry/support/geodesicUtils","../../geometry/support/spatialReferenceUtils"],function(e,t,o){"use strict";e.geodesicDistanceThreshold=1e5,e.geodesicMeasure=function(e,o,r,...i){return t.isSupported(e)?o.apply(void 0,i):e.isWebMercator?r.apply(void 0,i):null},e.supportsGeodesicMeasurement=function(e){return t.isSupported(e)||o.isWebMercator(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/automaticAreaMeasurementUtils":function(){define(["exports","./euclideanAreaMeasurementUtils","./geodesicAreaMeasurementUtils"],function(e,t,o){"use strict";const r=e=>({autoAreaByElevationMode(o,r,i=t.createEuclideanPlanarAreaCache()){if("on-the-ground"===r){const r=e.geodesicArea(o);return null!=r?r:t.euclideanHorizontalPlanarArea(o,i)}return t.euclideanPlanarArea(o,i)},autoArea2D(e,o=t.createEuclideanPlanarAreaCache()){return this.autoAreaByElevationMode(e,"on-the-ground",o)}});let i=null;e.loadAutomaticAreaMeasurementUtils=async function(){return i||(i=r(await o.loadGeodesicAreaMeasurementUtils())),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/euclideanAreaMeasurementUtils":function(){define(["exports","../../core/quantityUtils","../../core/unitUtils","../../chunks/earcut","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/projection/projectVectorToVector","../../geometry/support/plane","../../geometry/support/triangle","./measurementUtils"],function(e,t,o,r,i,n,s,a,l,c){"use strict";function p(e,r,p=e.hasZ){const y=c.computeEuclideanMeasurementSR(e.spatialReference),g=o.areaUnitFromSpatialReference(y);if(null==g)return null;const f=(e,t)=>!(t.length<2||(i.set(e,t[0],t[1],p&&t[2]||0),0));let m=0;for(const t of e.rings){const o=t.length;if(o<3)continue;const{positionsWorldCoords:c}=r;for(;c.length<o;)c.push(n.create());const p=d,g=i.set(u,0,0,0),v=1/o;for(let r=0;r<o;r++){if(!f(p,t[r]))return null;if(!s.projectVectorToVector(p,e.spatialReference,c[r],y))return null;i.scaleAndAdd(g,g,c[r],v)}const _=a.fromPoints(c[0],c[1],g,a.wrap());if(0===i.squaredLength(a.getNormal(_)))continue;for(let e=0;e<o;e++)a.projectPointLocal(_,g,c[e],c[e]);const b=h(c);for(let e=0;e<b.length;e+=3)m+=l.areaPoints2d(c[b[e]],c[b[e+1]],c[b[e+2]])}return t.createArea(m,g)}const d=n.create(),u=n.create();function h(e){return r.earcut(function(e){const t=new Float64Array(2*e.length);for(let o=0;o<e.length;++o){const r=e[o],i=2*o;t[i]=r[0],t[i+1]=r[1]}return t}(e),[],2)}e.computeEuclideanPlanarArea=p,e.createEuclideanPlanarAreaCache=function(){return{positionsWorldCoords:[]}},e.euclideanHorizontalPlanarArea=function(e,t={positionsWorldCoords:[]}){return p(e,t,!1)},e.euclideanPlanarArea=function(e,t={positionsWorldCoords:[]}){return p(e,t)},e.triangulate=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports"],function(e){"use strict";function t(e,t,n){n=n||2;var s,a,l,p,u,h,g,f=t&&t.length,m=f?t[0]*n:e.length,v=o(e,0,m,n,!0),_=[];if(!v||v.next===v.prev)return _;if(f&&(v=function(e,t,i,n){var s,a,l,p=[];for(s=0,a=t.length;s<a;s++)(l=o(e,t[s]*n,s<a-1?t[s+1]*n:e.length,n,!1))===l.next&&(l.steiner=!0),p.push(y(l));for(p.sort(c),s=0;s<p.length;s++)i=r(i=d(p[s],i),i.next);return i}(e,t,v,n)),e.length>80*n){s=l=e[0],a=p=e[1];for(var b=n;b<m;b+=n)(u=e[b])<s&&(s=u),(h=e[b+1])<a&&(a=h),u>l&&(l=u),h>p&&(p=h);g=0!==(g=Math.max(l-s,p-a))?1/g:0}return i(v,_,n,s,a,g),_}function o(e,t,o,r,i){var n,s;if(i===L(e,t,o,r)>0)for(n=t;n<o;n+=r)s=T(n,e[n],e[n+1],s);else for(n=o-r;n>=t;n-=r)s=T(n,e[n],e[n+1],s);if(s&&v(s,s.next)){var a=s.next;x(s),s=a}return s}function r(e,t){if(!e)return e;t||(t=e);var o,r=e;do{if(o=!1,r.steiner||!v(r,r.next)&&0!==m(r.prev,r,r.next))r=r.next;else{var i=r.prev;if(x(r),(r=t=i)===r.next)break;o=!0}}while(o||r!==t);return t}function i(e,t,o,c,p,d,u){if(e){!u&&d&&function(e,t,o,r){var i=e;do{null===i.z&&(i.z=h(i.x,i.y,t,o,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,o,r,i,n,s,a,l,c=1;do{for(o=e,e=null,n=null,s=0;o;){for(s++,r=o,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||o.z<=r.z)?(i=o,o=o.nextZ,a--):(i=r,r=r.nextZ,l--),n?n.nextZ=i:e=i,i.prevZ=n,n=i;o=r}n.nextZ=null,c*=2}while(s>1)}(i)}(e,c,p,d);for(var y,g,f=e;e.prev!==e.next;)if(y=e.prev,g=e.next,d?s(e,c,p,d):n(e))t.push(y.i/o),t.push(e.i/o),t.push(g.i/o),x(e),e=g.next,f=g.next;else if((e=g)===f){u?1===u?i(e=a(r(e),t,o),t,o,c,p,d,2):2===u&&l(e,t,o,c,p,d):i(r(e),t,o,c,p,d,1);break}}}function n(e){var t=e.prev,o=e,r=e.next;if(m(t,o,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(g(t.x,t.y,o.x,o.y,r.x,r.y,i.x,i.y)&&m(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function s(e,t,o,r){var i=e.prev,n=e,s=e.next;if(m(i,n,s)>=0)return!1;for(var a=i.x<n.x?i.x<s.x?i.x:s.x:n.x<s.x?n.x:s.x,l=i.y<n.y?i.y<s.y?i.y:s.y:n.y<s.y?n.y:s.y,c=i.x>n.x?i.x>s.x?i.x:s.x:n.x>s.x?n.x:s.x,p=i.y>n.y?i.y>s.y?i.y:s.y:n.y>s.y?n.y:s.y,d=h(a,l,t,o,r),u=h(c,p,t,o,r),y=e.prevZ,f=e.nextZ;y&&y.z>=d&&f&&f.z<=u;){if(y!==e.prev&&y!==e.next&&g(i.x,i.y,n.x,n.y,s.x,s.y,y.x,y.y)&&m(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,f!==e.prev&&f!==e.next&&g(i.x,i.y,n.x,n.y,s.x,s.y,f.x,f.y)&&m(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;y&&y.z>=d;){if(y!==e.prev&&y!==e.next&&g(i.x,i.y,n.x,n.y,s.x,s.y,y.x,y.y)&&m(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;f&&f.z<=u;){if(f!==e.prev&&f!==e.next&&g(i.x,i.y,n.x,n.y,s.x,s.y,f.x,f.y)&&m(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function a(e,t,o){var i=e;do{var n=i.prev,s=i.next.next;!v(n,s)&&_(n,i,i.next,s)&&S(n,s)&&S(s,n)&&(t.push(n.i/o),t.push(i.i/o),t.push(s.i/o),x(i),x(i.next),i=e=s),i=i.next}while(i!==e);return r(i)}function l(e,t,o,n,s,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&f(l,c)){var p=M(l,c);return l=r(l,l.next),p=r(p,p.next),i(l,t,o,n,s,a),void i(p,t,o,n,s,a)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function p(e){if(e.next.prev===e)return e;let t=e;for(;;){const o=t.next;if(o.prev===t||o===t||o===e)break;t=o}return t}function d(e,t){var o=function(e,t){var o,r=t,i=e.x,n=e.y,s=-1/0;do{if(n<=r.y&&n>=r.next.y&&r.next.y!==r.y){var a=r.x+(n-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(n===r.y)return r;if(n===r.next.y)return r.next}o=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!o)return null;if(i===s)return o;var l,c=o,p=o.x,d=o.y,h=1/0;r=o;do{i>=r.x&&r.x>=p&&i!==r.x&&g(n<d?i:s,n,p,d,n<d?s:i,n,r.x,r.y)&&(l=Math.abs(n-r.y)/(i-r.x),S(r,e)&&(l<h||l===h&&(r.x>o.x||r.x===o.x&&u(o,r)))&&(o=r,h=l)),r=r.next}while(r!==c);return o}(e,t);if(!o)return t;var i=M(o,e),n=r(o,o.next);let s=p(i);return r(s,s.next),n=p(n),p(t===o?n:t)}function u(e,t){return m(e.prev,e,t.prev)<0&&m(t.next,e,e.next)<0}function h(e,t,o,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-o)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e){var t=e,o=e;do{(t.x<o.x||t.x===o.x&&t.y<o.y)&&(o=t),t=t.next}while(t!==e);return o}function g(e,t,o,r,i,n,s,a){return(i-s)*(t-a)-(e-s)*(n-a)>=0&&(e-s)*(r-a)-(o-s)*(t-a)>=0&&(o-s)*(n-a)-(i-s)*(r-a)>=0}function f(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var o=e;do{if(o.i!==e.i&&o.next.i!==e.i&&o.i!==t.i&&o.next.i!==t.i&&_(o,o.next,e,t))return!0;o=o.next}while(o!==e);return!1}(e,t)&&(S(e,t)&&S(t,e)&&function(e,t){var o=e,r=!1,i=(e.x+t.x)/2,n=(e.y+t.y)/2;do{o.y>n!=o.next.y>n&&o.next.y!==o.y&&i<(o.next.x-o.x)*(n-o.y)/(o.next.y-o.y)+o.x&&(r=!r),o=o.next}while(o!==e);return r}(e,t)&&(m(e.prev,e,t.prev)||m(e,t.prev,t))||v(e,t)&&m(e.prev,e,e.next)>0&&m(t.prev,t,t.next)>0)}function m(e,t,o){return(t.y-e.y)*(o.x-t.x)-(t.x-e.x)*(o.y-t.y)}function v(e,t){return e.x===t.x&&e.y===t.y}function _(e,t,o,r){var i=w(m(e,t,o)),n=w(m(e,t,r)),s=w(m(o,r,e)),a=w(m(o,r,t));return i!==n&&s!==a||!(0!==i||!b(e,o,t))||!(0!==n||!b(e,r,t))||!(0!==s||!b(o,e,r))||!(0!==a||!b(o,t,r))}function b(e,t,o){return t.x<=Math.max(e.x,o.x)&&t.x>=Math.min(e.x,o.x)&&t.y<=Math.max(e.y,o.y)&&t.y>=Math.min(e.y,o.y)}function w(e){return e>0?1:e<0?-1:0}function S(e,t){return m(e.prev,e,e.next)<0?m(e,t,e.next)>=0&&m(e,e.prev,t)>=0:m(e,t,e.prev)<0||m(e,e.next,t)<0}function M(e,t){var o=new C(e.i,e.x,e.y),r=new C(t.i,t.x,t.y),i=e.next,n=t.prev;return e.next=t,t.prev=e,o.next=i,i.prev=o,r.next=o,o.prev=r,n.next=r,r.prev=n,r}function T(e,t,o,r){var i=new C(e,t,o);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function x(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function C(e,t,o){this.i=e,this.x=t,this.y=o,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function L(e,t,o,r){for(var i=0,n=t,s=o-r;n<o;n+=r)i+=(e[s]-e[n])*(e[n+1]+e[s+1]),s=n;return i}t.deviation=function(e,t,o,r){var i=t&&t.length,n=i?t[0]*o:e.length,s=Math.abs(L(e,0,n,o));if(i)for(var a=0,l=t.length;a<l;a++){var c=t[a]*o,p=a<l-1?t[a+1]*o:e.length;s-=Math.abs(L(e,c,p,o))}var d=0;for(a=0;a<r.length;a+=3){var u=r[a]*o,h=r[a+1]*o,y=r[a+2]*o;d+=Math.abs((e[u]-e[y])*(e[h+1]-e[u+1])-(e[u]-e[h])*(e[y+1]-e[u+1]))}return 0===s&&0===d?0:Math.abs((d-s)/s)},t.flatten=function(e){for(var t=e[0][0].length,o={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var n=0;n<e[i].length;n++)for(var s=0;s<t;s++)o.vertices.push(e[i][n][s]);i>0&&(r+=e[i-1].length,o.holes.push(r))}return o},e.earcut=t})},"esri/geometry/projection/projectVectorToVector":function(){define(["exports","../projectionUtils","../SpatialReference","./projectPointToVector","../../layers/graphics/dehydratedPoint"],function(e,t,o,r,i){"use strict";function n(e,t,o,i,n){return!(null==t||null==i||e.length<2)&&(s.x=e[0],s.y=e[1],s.z=e[2],s.spatialReference=t,r.projectPointToVector(s,o,i,n))}const s=i.makeDehydratedPoint(0,0,0,o.WGS84);e.projectVectorToVector=n,e.projectVectorToVectorAsync=async function(e,o,r,i,s,a){return await t.initializeProjection(o,i,null,a),n(e,o,r,i,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projectionUtils","./projectBuffer"],function(e,t,o,r){"use strict";function i(e,t,i,s){if(o.canProjectWithoutEngine(e.spatialReference,i)){n[0]=e.x,n[1]=e.y;const o=e.z;return n[2]=o??s??0,r.projectBuffer(n,e.spatialReference,0,t,i,0)}const a=o.tryProjectWithZConversion(e,i);return!!a&&(t[0]=a?.x,t[1]=a?.y,t[2]=a?.z??s??0,!0)}const n=t.create();e.projectPointToVector=i,e.projectPointToVectorAsync=async function(e,t,r,n,s){return await o.initializeProjection(e.spatialReference,r,null,s),i(e,t,r,n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define(["exports","../../core/ObjectStack","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./lineSegment","./vectorStacks"],function(e,t,o,r,i,n){"use strict";function s(e){return e?{p0:r.clone(e.p0),p1:r.clone(e.p1),p2:r.clone(e.p2)}:{p0:r.create(),p1:r.create(),p2:r.create()}}function a(e,t,r,i=s()){return o.copy(i.p0,e),o.copy(i.p1,t),o.copy(i.p2,r),i}const l=new t.ObjectStack(i.create),c=new t.ObjectStack(()=>s()),p=r.create(),d=r.create();e.areaPoints2d=function(e,t,o){const r=t[0]-e[0],i=t[1]-e[1],n=o[0]-e[0],s=o[1]-e[1];return.5*Math.abs(r*s-i*n)},e.areaPoints3d=function(e,t,r){return o.subtract(p,t,e),o.subtract(d,r,e),.5*o.length(o.cross(p,p,d))},e.copy=function(e,t=s()){return a(e.p0,e.p1,e.p2,t)},e.create=s,e.distance2=function(e,t){const r=e.p0,s=e.p1,a=e.p2,c=o.subtract(n.sv3d.get(),s,r),p=o.subtract(n.sv3d.get(),a,s),d=o.subtract(n.sv3d.get(),r,a),u=o.subtract(n.sv3d.get(),t,r),h=o.subtract(n.sv3d.get(),t,s),y=o.subtract(n.sv3d.get(),t,a),g=o.cross(c,c,d),f=o.dot(o.cross(n.sv3d.get(),c,g),u),m=o.dot(o.cross(n.sv3d.get(),p,g),h),v=o.dot(o.cross(n.sv3d.get(),d,g),y);if(f>0&&m>0&&v>0){const e=o.dot(g,u);return e*e/o.dot(g,g)}const _=i.distance2(i.fromValues(r,c,l.get()),t),b=i.distance2(i.fromValues(s,p,l.get()),t),w=i.distance2(i.fromValues(a,d,l.get()),t);return Math.min(_,b,w)},e.fromValues=a,e.intersectRay=function(e,t,r){const i=1e-5,{direction:n,origin:s}=t,{p0:a,p1:l,p2:c}=e,p=l[0]-a[0],d=l[1]-a[1],u=l[2]-a[2],h=c[0]-a[0],y=c[1]-a[1],g=c[2]-a[2],f=n[1]*g-y*n[2],m=n[2]*h-g*n[0],v=n[0]*y-h*n[1],_=p*f+d*m+u*v;if(_>-i&&_<i)return!1;const b=1/_,w=s[0]-a[0],S=s[1]-a[1],M=s[2]-a[2],T=b*(w*f+S*m+M*v);if(T<0||T>1)return!1;const x=S*u-d*M,C=M*p-u*w,L=w*d-p*S,O=b*(n[0]*x+n[1]*C+n[2]*L);if(O<0||T+O>1)return!1;if(r){const e=b*(h*x+y*C+g*L);o.scale(r,n,e),o.add(r,s,r)}return!0},e.wrap=function(e,t,o){const r=c.get();return r.p0=e,r.p1=t,r.p2=o,r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/lineSegment":function(){define(["exports","../../core/mathUtils","../../core/ObjectStack","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],function(e,t,o,r,i,n){"use strict";function s(e){return e?{origin:i.clone(e.origin),vector:i.clone(e.vector)}:{origin:i.create(),vector:i.create()}}function a(e,t){const o=u.get();return o.origin=e,o.vector=t,o}function l(e,t,o=s()){return r.copy(o.origin,e),r.copy(o.vector,t),o}function c(e,o,i,s,a){const{vector:l,origin:c}=e,p=r.subtract(n.sv3d.get(),o,c),d=r.dot(l,p)/r.squaredLength(l);return r.scale(a,l,t.clamp(d,i,s)),r.add(a,a,e.origin)}function p(e,o,i,s){const a=1e-6,l=e.origin,c=r.add(n.sv3d.get(),l,e.vector),p=o.origin,d=r.add(n.sv3d.get(),p,o.vector),u=n.sv3d.get(),h=n.sv3d.get();if(u[0]=l[0]-p[0],u[1]=l[1]-p[1],u[2]=l[2]-p[2],h[0]=d[0]-p[0],h[1]=d[1]-p[1],h[2]=d[2]-p[2],Math.abs(h[0])<a&&Math.abs(h[1])<a&&Math.abs(h[2])<a)return!1;const y=n.sv3d.get();if(y[0]=c[0]-l[0],y[1]=c[1]-l[1],y[2]=c[2]-l[2],Math.abs(y[0])<a&&Math.abs(y[1])<a&&Math.abs(y[2])<a)return!1;const g=u[0]*h[0]+u[1]*h[1]+u[2]*h[2],f=h[0]*y[0]+h[1]*y[1]+h[2]*y[2],m=u[0]*y[0]+u[1]*y[1]+u[2]*y[2],v=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],_=(y[0]*y[0]+y[1]*y[1]+y[2]*y[2])*v-f*f;if(Math.abs(_)<a)return!1;let b=(g*f-m*v)/_,w=(g+f*b)/v;i&&(b=t.clamp(b,0,1),w=t.clamp(w,0,1));const S=n.sv3d.get(),M=n.sv3d.get();return S[0]=l[0]+b*y[0],S[1]=l[1]+b*y[1],S[2]=l[2]+b*y[2],M[0]=p[0]+w*h[0],M[1]=p[1]+w*h[1],M[2]=p[2]+w*h[2],s.tA=b,s.tB=w,s.pA=S,s.pB=M,s.distance2=r.squaredDistance(S,M),!0}const d={tA:0,tB:0,pA:i.create(),pB:i.create(),distance2:0},u=new o.ObjectStack(()=>s());e.closestLineSegmentPoint=function(e,t,o){return!!p(e,t,!0,d)&&(r.copy(o,d.pA),!0)},e.closestRayDistance2=function(e,t){if(p(e,a(t.origin,t.direction),!1,d)){const{tA:t,pB:o,distance2:i}=d;if(t>=0&&t<=1)return i;if(t<0)return r.squaredDistance(e.origin,o);if(t>1)return r.squaredDistance(r.add(n.sv3d.get(),e.origin,e.vector),o)}return null},e.copy=function(e,t=s()){return l(e.origin,e.vector,t)},e.create=s,e.distance2=function(e,o){const i=r.subtract(n.sv3d.get(),o,e.origin),s=r.dot(e.vector,i),a=r.dot(e.vector,e.vector),l=t.clamp(s/a,0,1),c=r.subtract(n.sv3d.get(),r.scale(n.sv3d.get(),e.vector,l),i);return r.dot(c,c)},e.fromPoints=function(e,t,o=s()){return r.copy(o.origin,e),r.subtract(o.vector,t,e),o},e.fromValues=l,e.pointAt=function(e,t,o){return r.add(o,e.origin,r.scale(o,e.vector,t))},e.projectPoint=function(e,t,o){return c(e,t,0,1,o)},e.projectPointClamp=c,e.wrap=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/measurementUtils":function(){define(["exports","../../geometry/ellipsoidUtils","../../geometry/spatialReferenceEllipsoidUtils","../../geometry/support/spatialReferenceUtils"],function(e,t,o,r){"use strict";e.computeEuclideanMeasurementSR=function(e){return r.isEarth(e)?r.isWGS84(e)||r.isWebMercator(e)||r.isCGCS2000(e)||t.isSphericalECEF(e)?o.WGS84ECEFSpatialReference:e:o.getSphericalPCPF(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],function(e,t,o,r){"use strict";const i=new o(t.SphericalECEFSpatialReferenceLike),n=new o(t.SphericalPCPFMarsLike),s=new o(t.SphericalPCPFMoonLike),a=new o(t.WGS84ECEFSpatialReferenceLike),l=new Map,c=n.wkt.toUpperCase(),p=s.wkt.toUpperCase();e.SphericalECEFSpatialReference=i,e.SphericalPCPFMars=n,e.SphericalPCPFMoon=s,e.WGS84ECEFSpatialReference=a,e.cleanupSpatialReferenceEllipsoidUtils=function(){l.clear()},e.getSphericalPCPF=function(e){const t=l.get(e);if(t)return t;let o=i;if(e)if(e===n)o=n;else if(e===s)o=s;else{const t=e.wkid,i=e.latestWkid;if(null!=t||null!=i)r.isWKIDFromMars(t)||r.isWKIDFromMars(i)?o=n:(r.isWKIDFromMoon(t)||r.isWKIDFromMoon(i))&&(o=s);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===c?o=n:e===p&&(o=s)}}}return l.set(e,o),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/geodesicAreaMeasurementUtils":function(){define(["require","exports","../../core/quantityUtils","../../geometry/support/geodesicUtils","./geodesicMeasurementUtils"],function(e,t,o,r,i){"use strict";function n(e){return o.createArea(Math.abs(r.geodesicAreas([e],"square-meters")[0]),"square-meters")}t.loadGeodesicAreaMeasurementUtils=async function(){return t=await new Promise((t,o)=>e(["../../geometry/geometryEngine"],t,o)),{geodesicArea(e){const{spatialReference:r}=e;return i.geodesicMeasure(r,n,e=>function(e,t){try{return o.createArea(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch(e){return null}}(t,e),e)}};var t},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/automaticLengthMeasurementUtils":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","./euclideanLengthMeasurementUtils","./geodesicLengthMeasurementUtils"],function(e,t,o,r){"use strict";const i=t.create(),n=t.create();e.loadAutomaticLengthMeasurementUtils=async function(){return e=await r.loadGeodesicLengthMeasurementUtils(),{autoLength2D:t=>e.geodesicLength(t)??o.euclideanHorizontalLength(t),autoDistanceBetweenPoints2D:(t,r)=>e.geodesicDistanceBetweenPoints(t,r)??o.euclideanHorizontalDistanceBetweenPoints(t,r),autoDistance2D:(t,r,s)=>(i[0]=t[0],i[1]=t[1],i[2]=3===t.length?t[2]:0,n[0]=r[0],n[1]=r[1],n[2]=3===r.length?r[2]:0,e.geodesicDistance(i,n,s)??o.euclideanHorizontalDistance(i,n,s))};var e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/euclideanLengthMeasurementUtils":function(){define(["exports","../../core/quantityUtils","../../core/unitUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/projection/projectVectorToVector","../../geometry/support/spatialReferenceUtils","./measurementUtils"],function(e,t,o,r,i,n,s,a){"use strict";function l(e,r){const{hasZ:i,spatialReference:n}=e,s=a.computeEuclideanMeasurementSR(n);let l=0;const c=o.lengthUnitFromSpatialReference(s);if(null==c)return null;const p=0===r?d:u;for(const t of e.paths){if(t.length<2)continue;const e=t.length-1;for(let o=0;o<e;++o){const e=t[o];g[0]=e[0],g[1]=e[1],g[2]=i?e[2]:0;const r=t[o+1];f[0]=r[0],f[1]=r[1],f[2]=i?r[2]:0;const s=p(g,f,n);if(null==s)return null;l+=s.value}}return t.createLength(l,c)}function c(e,r){const i=o.verticalLengthUnitFromSpatialReference(r);return null!=i?t.createLength(e??0,i):null}function p(e,o,r){const i=y(e,o,r);return null!=i?{direct:t.createLength(i.direct,i.unit),horizontal:t.createLength(i.horizontal,i.unit),vertical:t.createLength(i.vertical,i.unit)}:null}function d(e,o,r){const i=y(e,o,r,0);return null!=i?t.createLength(i.direct,i.unit):null}function u(e,o,r){const i=y(e,o,r,1);return null!=i?t.createLength(i.horizontal,i.unit):null}function h(e,o,r){const i=y(e,o,r,2);return null!=i?t.createLength(i.verticalSigned,i.unit):null}function y(e,t,i,s){const l=a.computeEuclideanMeasurementSR(i),c=o.lengthUnitFromSpatialReference(l);if(null==c)return null;const p=t[2]-e[2];if(2===s)return{verticalSigned:p,unit:c};if(!n.projectVectorToVector(e,i,m,l)||!n.projectVectorToVector(t,i,v,l))return null;if(0===s)return{direct:r.distance(v,m),unit:c};if(r.set(_,e[0],e[1],t[2]),!n.projectVectorToVector(_,i,_,l))return null;const d=r.distance(_,v);return 1===s?{horizontal:d,unit:c}:{direct:r.distance(v,m),horizontal:d,vertical:Math.abs(p),unit:c}}const g=i.create(),f=i.create(),m=i.create(),v=i.create(),_=i.create();e.elevationFromPoint=function(e){return null!=e?c(e.hasZ?e.z:0,e.spatialReference):null},e.elevationFromZ=c,e.euclideanDirectDistance=d,e.euclideanDirectDistanceBetweenPoints=function(e,t){const{spatialReference:o}=e;return s.equals(o,t.spatialReference)?(g[0]=e.x,g[1]=e.y,g[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,d(g,f,o)):null},e.euclideanDistance=p,e.euclideanDistanceBetweenPoints=function(e,t){const{spatialReference:o}=e;return s.equals(o,t.spatialReference)?(g[0]=e.x,g[1]=e.y,g[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,p(g,f,o)):null},e.euclideanHorizontalDistance=u,e.euclideanHorizontalDistanceBetweenPoints=function(e,t){const{spatialReference:o}=e;return s.equals(o,t.spatialReference)?(g[0]=e.x,g[1]=e.y,g[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,u(g,f,o)):null},e.euclideanHorizontalLength=function(e){return l(e,1)},e.euclideanLength=function(e){return l(e,0)},e.verticalDistance=function(e,o,r){const i=y(e,o,r,2);return null!=i?t.createLength(Math.abs(i.verticalSigned),i.unit):null},e.verticalSignedDistance=h,e.verticalSignedDistanceBetweenPoints=function(e,t){const{spatialReference:o}=e;return s.equals(o,t.spatialReference)?(g[0]=e.x,g[1]=e.y,g[2]=e.hasZ?e.z:0,f[0]=t.x,f[1]=t.y,f[2]=t.hasZ?t.z:0,h(g,f,o)):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],function(e){"use strict";function t(e){return"graphic"===e?.type}e.filterGraphicHits=function(e){return e.filter(t)},e.findFirstGraphicHit=function(e){return e.find(t)??null},e.hitTestSelectSimilarDistance=async function(e,t){if("2d"===e.type)return e.hitTest(t);const o=await e.hitTest(t);if(0===o.results.length)return o;const r=o.results[0],i=1.05*(r.distance??0),n=o.results.findIndex(e=>(e.distance??0)>i);return-1!==n&&(o.results=o.results.slice(0,n)),r&&o.ground.distance>i&&(o.ground.mapPoint=null),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Sketch/support/OperationHandle":function(){define(["exports","../../../chunks/tslib.es6","../../../core/compilerUtils","../../../core/Evented","../../../core/accessorSupport/decorators/property","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s,a){"use strict";e.OperationHandle=class extends r.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:o.neverReached(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&("box"!==e.type&&"reshape"!==e.type&&"graphic-mover"!==e.type||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}},t.__decorate([i.property()],e.OperationHandle.prototype,"activeComponent",void 0),t.__decorate([i.property()],e.OperationHandle.prototype,"cancelled",void 0),t.__decorate([i.property()],e.OperationHandle.prototype,"history",void 0),t.__decorate([i.property()],e.OperationHandle.prototype,"tool",null),t.__decorate([i.property()],e.OperationHandle.prototype,"type",void 0),t.__decorate([i.property()],e.OperationHandle.prototype,"canUndo",null),t.__decorate([i.property()],e.OperationHandle.prototype,"canRedo",null),t.__decorate([i.property()],e.OperationHandle.prototype,"onEnd",void 0),t.__decorate([i.property()],e.OperationHandle.prototype,"undo",null),t.__decorate([i.property()],e.OperationHandle.prototype,"redo",null),t.__decorate([i.property()],e.OperationHandle.prototype,"toggleTool",void 0),t.__decorate([i.property()],e.OperationHandle.prototype,"addToSelection",void 0),t.__decorate([i.property()],e.OperationHandle.prototype,"removeFromSelection",void 0),e.OperationHandle=t.__decorate([a.subclass("esri.widgets.Sketch.support.OperationHandle")],e.OperationHandle),e.CreateOperationHandle=class extends e.OperationHandle{},t.__decorate([i.property()],e.CreateOperationHandle.prototype,"activeComponent",void 0),e.CreateOperationHandle=t.__decorate([a.subclass("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],e.CreateOperationHandle),e.UpdateOperationHandle=class extends e.OperationHandle{},t.__decorate([i.property()],e.UpdateOperationHandle.prototype,"activeComponent",void 0),e.UpdateOperationHandle=t.__decorate([a.subclass("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],e.UpdateOperationHandle),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Sketch/support/sketchUtils":function(){define(["exports"],function(e){"use strict";e.getDrawToolGeometryTypeFromCreateTool=function(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}},e.getModeFromCreateOptions=function(e,t){return"freehandPolygon"===t||"freehandPolyline"===t?"freehand":e??("rectangle"===t||"circle"===t?"hybrid":"click")},e.isDrawGraphicTool=function(e){return!!e&&("draw-2d"===e.type||"draw-3d"===e.type)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Sketch/VisibleElements":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../support/SnappingControls/VisibleElements"],function(e,t,o,r,i,n,s,a,l){"use strict";e.CreateToolVisibilityMap=class extends o{constructor(e){super(e),this.point=!0,this.polyline=!0,this.polygon=!0,this.rectangle=!0,this.circle=!0,this.multipoint=!0,this.mesh=!0,this.freehandPolyline=!1,this.freehandPolygon=!1}},t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"point",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"polyline",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"polygon",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"rectangle",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"circle",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"multipoint",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"mesh",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"freehandPolyline",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.CreateToolVisibilityMap.prototype,"freehandPolygon",void 0),e.CreateToolVisibilityMap=t.__decorate([a.subclass("esri.widgets.Sketch.VisibleElements.CreateToolVisibilityMap")],e.CreateToolVisibilityMap),e.SelectionToolVisibilityMap=class extends o{constructor(e){super(e),this["rectangle-selection"]=!0,this["lasso-selection"]=!0,this["custom-selection"]=!0}},t.__decorate([r.property({nonNullable:!0})],e.SelectionToolVisibilityMap.prototype,"rectangle-selection",void 0),t.__decorate([r.property({nonNullable:!0})],e.SelectionToolVisibilityMap.prototype,"lasso-selection",void 0),t.__decorate([r.property({nonNullable:!0})],e.SelectionToolVisibilityMap.prototype,"custom-selection",void 0),e.SelectionToolVisibilityMap=t.__decorate([a.subclass("esri.widgets.Sketch.VisibleElements.SelectionToolVisibilityMap")],e.SelectionToolVisibilityMap),e.VisibleElements=class extends o{constructor(t){super(t),this.createTools=new e.CreateToolVisibilityMap,this.directionModePicker=!1,this.duplicateButton=!0,this.deleteButton=!0,this.selectionCountLabel=!0,this.labelsToggle=!0,this.selectionTools=new e.SelectionToolVisibilityMap,this.settingsMenu=!0,this.snappingControls=!0,this.snappingControlsElements=new l,this.tooltipsToggle=!0,this.undoRedoMenu=!0}},t.__decorate([r.property({type:e.CreateToolVisibilityMap,nonNullable:!0})],e.VisibleElements.prototype,"createTools",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"directionModePicker",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"duplicateButton",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"deleteButton",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"selectionCountLabel",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"labelsToggle",void 0),t.__decorate([r.property({type:e.SelectionToolVisibilityMap,nonNullable:!0})],e.VisibleElements.prototype,"selectionTools",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"settingsMenu",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"snappingControls",void 0),t.__decorate([r.property({type:l,nonNullable:!0})],e.VisibleElements.prototype,"snappingControlsElements",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"tooltipsToggle",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0})],e.VisibleElements.prototype,"undoRedoMenu",void 0),e.VisibleElements=t.__decorate([a.subclass("esri.widgets.Sketch.VisibleElements")],e.VisibleElements),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SnappingControls/VisibleElements":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../GridControls/VisibleElements"],function(e,t,o,r,i,n,s,a){"use strict";let l=class extends t{constructor(e){super(e),this.enabledToggle=!0,this.featureEnabledToggle=!0,this.gridEnabledToggle=!0,this.header=!1,this.layerList=!0,this.gridControls=!0,this.gridControlsElements=new a({gridSnapEnabledToggle:!1,gridEnabledToggle:!1}),this.layerListToggleLayersButton=!0,this.selfEnabledToggle=!0}};return e.__decorate([o.property({type:Boolean,nonNullable:!0})],l.prototype,"enabledToggle",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],l.prototype,"featureEnabledToggle",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],l.prototype,"gridEnabledToggle",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],l.prototype,"header",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],l.prototype,"layerList",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],l.prototype,"gridControls",void 0),e.__decorate([o.property({type:a,nonNullable:!0})],l.prototype,"gridControlsElements",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],l.prototype,"layerListToggleLayersButton",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],l.prototype,"selfEnabledToggle",void 0),l=e.__decorate([s.subclass("esri.widgets.support.SnappingControls.VisibleElements")],l),l})},"esri/widgets/support/GridControls/VisibleElements":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.colorSelection=!0,this.dynamicScaleToggle=!0,this.gridEnabledToggle=!0,this.numericInputs=!0,this.gridSnapEnabledToggle=!0,this.lineIntervalInput=!0,this.outOfScaleWarning=!0,this.placementButtons=!0,this.rotateWithMapToggle=!0}};return e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"colorSelection",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"dynamicScaleToggle",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"gridEnabledToggle",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"numericInputs",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"gridSnapEnabledToggle",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"lineIntervalInput",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"outOfScaleWarning",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"placementButtons",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"rotateWithMapToggle",void 0),a=e.__decorate([s.subclass("esri.widgets.support.GridControls.VisibleElements")],a),a})},"esri/widgets/Sketch/support/ResponsiveToolbar/ResponsiveToolbar":function(){define(["require","exports","../../../../chunks/tslib.es6","../../../../core/arrayUtils","../../../../core/maybe","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./MeasuredContentGroup","./OverflowGroup","./ResponsiveToolbarManager","./SplitButton","../../../../chunks/componentsUtils","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g,f){"use strict";const m="esri-responsive-toolbar",v={rulerBase:`${m}__ruler`,rulerBarHorizontal:`${m}__ruler--bar`,rulerBarVertical:`${m}__ruler--bar--vertical`,rulerPadVertical:`${m}__ruler--pad--vertical`,rulerPadHorizontal:`${m}__ruler--pad--horizontal`,bar:`${m}__bar`,barHorizontal:`${m}__bar--horizontal`,barVertical:`${m}__bar--vertical`,pad:`${m}__pad`,padVertical:`${m}__pad--vertical`,padHorizontal:`${m}__pad--horizontal`};return t.default=class extends c{constructor(e){super(e),this.scale="m",this.barStyle="floating",this._measurementManager=new u,this._managedWidgets=new Map}loadDependencies(){return y.loadCalciteComponents({"action-bar":()=>new Promise((t,o)=>e(["../../../../chunks/index46"],t,o))})}destroy(){this._measurementManager=i.destroyMaybe(this._measurementManager),this._managedWidgets.forEach(e=>e.destroy()),this._managedWidgets.clear()}set layout(e){const t=this._get("layout");this._set("layout",e),this._measurementManager&&(this._measurementManager.layout=e),t!==e&&this.scheduleRender()}get _barClasses(){const e="docked"===this.barStyle,t="vertical"===this.layout;return{[v.barHorizontal]:e&&!t,[v.barVertical]:e&&t,[v.bar]:e,[v.padHorizontal]:!e&&!t,[v.padVertical]:!e&&t,[v.pad]:!e}}render(){const{layout:e,scale:t,barStyle:o}=this,r={layout:e,scale:t,expandDisabled:!0,key:"measured-toolbar"},i="docked"===o?"vertical"===e?v.rulerBarVertical:v.rulerBarHorizontal:"horizontal"===e?v.rulerPadHorizontal:v.rulerPadVertical;return f.tsx("div",null,f.tsx("div",{afterCreate:e=>{this._measurementManager?.connect(e)},class:this.classes(v.rulerBase,i)}),f.tsx("calcite-action-bar",{...r,classes:this._barClasses,floating:"docked"!==o,overflowActionsDisabled:!0},this._renderChildren()))}_renderChildren(){if(!this.children)return;const e=this.children.filter(e=>void 0!==e.properties?.key&&"group-kind"in e.properties),t=new Set,o=e.map(e=>{const o=e.properties,r=o.key;t.add(r);const i="docked"===this.barStyle?o.slot??void 0:void 0,n=o.priority??0,s=o["group-kind"]??"overflow-group",a=o["allow-collapse"]??!0,l=this._managedWidgets.get(r);if(l)return l.children=e.children,l.priority=n,"allowCollapse"in l&&(l.allowCollapse=a),l.slot=i,l.layout=this.layout,l.scale=this.scale,l.measurementManager=this._measurementManager,l;const c={scale:this.scale,priority:n,measurementManager:this._measurementManager,children:e.children,slot:i,layout:this.layout};switch(s){case"split-button":{const e=new h.SplitButton({...c,allowCollapse:a});return this._managedWidgets.set(r,e),e}case"overflow-group":{const e=new d({...c,allowCollapse:a});return this._managedWidgets.set(r,e),e}case"measured-content":{const e=new p({...c});return this._managedWidgets.set(r,e),e}}}).filter(r.isSome);return Array.from(this._managedWidgets.keys()).filter(e=>!t.has(e)).forEach(e=>{this._managedWidgets.get(e)?.destroy(),this._managedWidgets.delete(e)}),this._measurementManager?.allocate(),o.map(e=>e.render())}},o.__decorate([n.property()],t.default.prototype,"scale",void 0),o.__decorate([n.property({value:"horizontal"})],t.default.prototype,"layout",null),o.__decorate([n.property()],t.default.prototype,"barStyle",void 0),o.__decorate([n.property()],t.default.prototype,"_measurementManager",void 0),o.__decorate([n.property()],t.default.prototype,"_managedWidgets",void 0),o.__decorate([n.property()],t.default.prototype,"_barClasses",null),t.default=o.__decorate([l.subclass("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbar")],t.default),t.default})},"esri/widgets/Sketch/support/ResponsiveToolbar/MeasuredContentGroup":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./ToolbarGroupBase","../../../support/widgetUtils","../../../support/jsxFactory"],function(e,t,o,r,i,n,s,a,l,c,p){"use strict";const d=Symbol("on-resize-handle-key");return e.default=class extends(l.ToolbarGroupBase(a)){constructor(e){super(e),this._measuredWidth=0,this._measuredHeight=0,this._measuredElement=null}destroy(){this._measuredElement=null}get lengthOptions(){return["horizontal"===this.layout?this._measuredWidth:this._measuredHeight]}render(){return p.tsx("div",{afterCreate:e=>{this._measuredElement=e.firstElementChild,this.addHandles(c.onResize(this._measuredElement,()=>{this._measuredWidth=this._measuredElement?.clientWidth??0,this._measuredHeight=this._measuredElement?.clientHeight??0}),d)},afterRemoved:()=>this.removeHandles(d)},this.children)}},t.__decorate([o.property()],e.default.prototype,"_measuredWidth",void 0),t.__decorate([o.property()],e.default.prototype,"_measuredHeight",void 0),t.__decorate([o.property()],e.default.prototype,"lengthOptions",null),t.__decorate([o.property()],e.default.prototype,"_measuredElement",void 0),e.default=t.__decorate([s.subclass("esri.widgets.Sketch.support.ResponsiveToolbar.MeasuredContentGroup")],e.default),e.default})},"esri/widgets/Sketch/support/ResponsiveToolbar/ToolbarGroupBase":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./responsiveToolbarUtils"],function(e,t,o,r,i,n,s,a){"use strict";e.ToolbarGroupBase=e=>{const r=e;let i=class extends r{constructor(){super(...arguments),this.priority=0,this.scale="m",this.slot=void 0,this.lastActiveKey=null,this.layout="horizontal"}destroy(){this.measurementManager?.managedElements.remove(this),this.measurementManager=null}set measurementManager(e){const t=this._get("measurementManager");e!==t&&(t&&t.managedElements.remove(this),this._set("measurementManager",e),e?.managedElements.add(this))}set budgetedLength(e){this.budgetedLength!==e&&(this._set("budgetedLength",e),this.scheduleRender())}get actionChildren(){return this.children?.flatMap(e=>a.findMatchingChildren(e,"calcite-action"))??[]}get activeChildElement(){const e=this.actionChildren.find(e=>!0===e.properties?.active);return e?(this._set("lastActiveKey",e.properties?.key),e):this.lastActiveKey?this.actionChildren.find(e=>e.properties?.key===this.lastActiveKey):void 0}_handleClick(e){e?.dataset&&"dataset"in e&&e.dataset.actionKey&&(this.lastActiveKey=e.dataset.actionKey)}};return t.__decorate([o.property()],i.prototype,"priority",void 0),t.__decorate([o.property()],i.prototype,"measurementManager",null),t.__decorate([o.property()],i.prototype,"budgetedLength",null),t.__decorate([o.property()],i.prototype,"actionChildren",null),t.__decorate([o.property()],i.prototype,"activeChildElement",null),t.__decorate([o.property()],i.prototype,"scale",void 0),t.__decorate([o.property()],i.prototype,"slot",void 0),t.__decorate([o.property()],i.prototype,"lastActiveKey",void 0),t.__decorate([o.property()],i.prototype,"layout",void 0),i=t.__decorate([s.subclass("esri.widgets.Sketch.support.ResponsiveToolbar.ToolbarGroupBase")],i),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Sketch/support/ResponsiveToolbar/responsiveToolbarUtils":function(){define(["exports"],function(e){"use strict";e.Icons={splitButton:{horizontal:"chevron-down",vertical:"ellipsis"},overflow:"ellipsis"},e.WellKnownSizes={groupSeparator:1,action:{s:32,m:48,l:64},splitButtonPart:{horizontal:{s:16,m:16,l:24},vertical:{s:16,m:24,l:40}}},e.findMatchingChildren=function e(t,o){return t.vnodeSelector===o?[t]:t.children?.flatMap(t=>e(t,o))??[]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Sketch/support/ResponsiveToolbar/OverflowGroup":function(){define(["require","exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./responsiveToolbarUtils","./ToolbarGroupBase","../../../../chunks/componentsUtils","../../../support/widgetUtils","../../../support/decorators/messageBundle","../../../support/jsxFactory"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y){"use strict";return t.default=class extends(p.ToolbarGroupBase(l)){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return d.loadCalciteComponents({action:()=>new Promise((t,o)=>e(["../../../../chunks/index12"],t,o)),"action-group":()=>new Promise((t,o)=>e(["../../../../chunks/index18"],t,o)).then(e=>e.index),"action-menu":()=>new Promise((t,o)=>e(["../../../../chunks/index19"],t,o)).then(e=>e.index)})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const{actionChildren:e,scale:t}=this;return e.length?this.allowCollapse?c.WellKnownSizes.groupSeparator+c.WellKnownSizes.action[t]*Math.min(e.length,2):c.WellKnownSizes.groupSeparator+c.WellKnownSizes.action[t]*e.length:0}get lengthOptions(){const{actionChildren:e,scale:t,minimumLength:o,allowCollapse:r,priority:i}=this,n=[o];if(e.length<=2||!r||i<1)return n;for(let r=1;r<e.length-1;r++)n.push(o+c.WellKnownSizes.action[t]*r);return n}render(){if(!this.actionChildren.length)return y.tsx(y.tsxFragment,null,void 0);const{budgetedLength:e,actionChildren:t,activeChildElement:o,layout:r,slot:i,scale:n}=this,s=Math.floor(e/c.WellKnownSizes.action[n]),a=[],l=[];if(s>=t.length)a.push(...t);else{const e=o??a.at(0);if(a.push(...t.slice(0,s-1)),l.push(...t.slice(s-1)),e&&l.includes(e)){const[t]=l.splice(l.indexOf(e),1),o=a.pop();a.push(t),o&&l.unshift(o)}}return y.tsx("calcite-action-group",{key:"overflow-button-group",layout:r,onclick:e=>this._handleClick(e.target),slot:i},a.map(e=>this._renderManagedAction(e)),l.length>0?y.tsx("calcite-action-menu",{key:"split-button-dropdown",label:this.messagesCommon.more,overlayPositioning:"fixed"},y.tsx("calcite-action",{icon:c.Icons.overflow,key:"split-button-dropdown-trigger",scale:n,slot:"trigger",text:this.messagesCommon.more}),l.map(e=>this._renderManagedAction(e))):void 0)}_renderManagedAction(e){return y.tsx("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}},o.__decorate([r.property()],t.default.prototype,"allowCollapse",void 0),o.__decorate([r.property()],t.default.prototype,"minimumLength",null),o.__decorate([r.property(),h.messageBundle("esri/t9n/common")],t.default.prototype,"messagesCommon",void 0),o.__decorate([r.property()],t.default.prototype,"lengthOptions",null),t.default=o.__decorate([a.subclass("esri.widgets.Sketch.support.ResponsiveToolbar.OverflowGroup")],t.default),t.default})},"esri/widgets/Sketch/support/ResponsiveToolbar/ResponsiveToolbarManager":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Collection","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s,a,l){"use strict";return e.default=class extends o{constructor(){super(...arguments),this.measuredElement=null,this.managedElements=new r,this.availableLength=0,this.layout="horizontal",this._resizeObserver=new ResizeObserver(()=>{this._measure()})}get _sortedElements(){return[...this.managedElements].sort((e,t)=>t.priority-e.priority)}connect(e){this._resizeObserver.disconnect(),this.measuredElement=e,this._resizeObserver.observe(e),this._measure()}allocate(){const e=new Map,{availableLength:t,_sortedElements:o}=this;let r=0;for(const t of o){const o=t.lengthOptions[0];e.set(t,o),r+=o}for(const i of o)for(;r<t;){const o=e.get(i);if(!o)break;const n=i.lengthOptions.find(e=>e>o);if(!n)break;const s=r-o+n;if(s>t)break;e.set(i,n),r=s}for(const[t,o]of e)t.budgetedLength=o}_measure(){const e=this.measuredElement;this.availableLength=e?"horizontal"===this.layout?e.clientWidth??0:e.clientHeight??0:0,this.allocate()}destroy(){this._resizeObserver.disconnect()}},t.__decorate([i.property()],e.default.prototype,"measuredElement",void 0),t.__decorate([i.property()],e.default.prototype,"managedElements",void 0),t.__decorate([i.property()],e.default.prototype,"_sortedElements",null),t.__decorate([i.property()],e.default.prototype,"availableLength",void 0),t.__decorate([i.property()],e.default.prototype,"layout",void 0),e.default=t.__decorate([l.subclass("esri.widgets.Sketch.support.ResponsiveToolbar.ResponsiveToolbarManager")],e.default),e.default})},"esri/widgets/Sketch/support/ResponsiveToolbar/SplitButton":function(){define(["require","exports","../../../../chunks/tslib.es6","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../Widget","./responsiveToolbarUtils","./ToolbarGroupBase","../../../../chunks/componentsUtils","../../../support/widgetUtils","../../../support/decorators/messageBundle","../../../support/jsxFactory"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y){"use strict";t.SplitButton=class extends(p.ToolbarGroupBase(l)){constructor(e){super(e),this.allowCollapse=!0,this.messagesCommon=null}loadDependencies(){return d.loadCalciteComponents({action:()=>new Promise((t,o)=>e(["../../../../chunks/index12"],t,o)),"action-group":()=>new Promise((t,o)=>e(["../../../../chunks/index18"],t,o)).then(e=>e.index),"action-menu":()=>new Promise((t,o)=>e(["../../../../chunks/index19"],t,o)).then(e=>e.index)})}static{this.vnodeSelector="calcite-action-group"}get minimumLength(){const e=this.actionChildren;return e.length?1===e.length?c.WellKnownSizes.action[this.scale]+c.WellKnownSizes.groupSeparator:this.allowCollapse?c.WellKnownSizes.action[this.scale]+c.WellKnownSizes.splitButtonPart[this.layout][this.scale]+c.WellKnownSizes.groupSeparator:c.WellKnownSizes.action[this.scale]*e.length+c.WellKnownSizes.groupSeparator:0}get lengthOptions(){const{actionChildren:e,minimumLength:t,layout:o,scale:r,priority:i,allowCollapse:n}=this;if(e.length<2||i<0||!n)return[t];const s=c.WellKnownSizes.groupSeparator+c.WellKnownSizes.action[r]*e.length;return[c.WellKnownSizes.groupSeparator+c.WellKnownSizes.action[r]+c.WellKnownSizes.splitButtonPart[o][r],s]}render(){if(!this.actionChildren.length)return y.tsx(y.tsxFragment,null,void 0);const{actionChildren:e,minimumLength:t,budgetedLength:o,layout:r,slot:i,allowCollapse:n}=this,s=!n||e.length<2||o>t;return y.tsx("calcite-action-group",{key:"split-button-group",layout:r,onclick:e=>this._handleClick(e.target),slot:i},s?this._renderUnSplit():this._renderSplit())}_renderSplit(){const{activeChildElement:e,layout:t,actionChildren:o,scale:r,messagesCommon:i}=this,n=e??o.at(0);if(!n)return;const s=o.filter(e=>e!==n);return[this._renderManagedAction(n),y.tsx("calcite-action-menu",{key:"split-button-dropdown",label:i.more,overlayPositioning:"fixed",placement:"horizontal"===t?"bottom-end":"right-end"},y.tsx("calcite-action",{class:`esri-split-button--split-part--${t}--${this.scale}`,compact:"horizontal"===t,icon:c.Icons.splitButton[t],key:"split-button-dropdown-trigger",scale:r,slot:"trigger",text:i.more}),s?.map(e=>this._renderManagedAction(e)))]}_renderUnSplit(){return this.actionChildren.map(e=>this._renderManagedAction(e))}_renderManagedAction(e){return y.tsx("calcite-action",{...e?.properties,"data-action-key":e?.properties?.key,text:e?.properties?.text??""})}},o.__decorate([r.property()],t.SplitButton.prototype,"minimumLength",null),o.__decorate([r.property()],t.SplitButton.prototype,"allowCollapse",void 0),o.__decorate([r.property()],t.SplitButton.prototype,"lengthOptions",null),o.__decorate([r.property(),h.messageBundle("esri/t9n/common")],t.SplitButton.prototype,"messagesCommon",void 0),t.SplitButton=o.__decorate([a.subclass("esri.widgets.Sketch.support.ResponsiveToolbar.SplitButton")],t.SplitButton),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SelectionToolbar":function(){define(["require","../../chunks/tslib.es6","../../intl","../../core/deprecate","../../core/handleUtils","../../core/Logger","../../core/maybe","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../Widget","../../chunks/componentsUtils","./globalCss","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SelectionToolbar/SelectionToolbarViewModel","./SelectionToolbar/VisibleElements","../../intl/number"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g,f,m,v,_,b){"use strict";const w="esri-selection-toolbar",S={base:w,container:`${w}__container`,toolButton:`${w}__tool-button`};let M=class extends u{constructor(e,t){super(e,t),this._viewModelHandlesGroup=null,this.disabled=!1,this.layout="horizontal",this.messages=null,this.scale="s",this.viewModel=new v,this.visibleElements=new _}initialize(){this._viewModelHandlesGroup=i.handlesGroup([a.on(()=>this.viewModel,"before-activate",e=>this.emit("before-activate",e)),a.on(()=>this.viewModel,"complete",e=>this.emit("complete",e)),a.on(()=>this.viewModel,"selection-change",e=>this.emit("selection-change",e))])}destroy(){this._viewModelHandlesGroup=s.removeMaybe(this._viewModelHandlesGroup)}loadDependencies(){return h.loadCalciteComponents({action:()=>new Promise((t,o)=>e(["../../chunks/index12"],t,o)),"action-bar":()=>new Promise((t,o)=>e(["../../chunks/index46"],t,o)),chip:()=>new Promise((t,o)=>e(["../../chunks/index11"],t,o))})}get _effectiveDisabled(){return this.disabled||"disabled"===this.state}get activeOperation(){return this.viewModel.activeOperation}get continuousSelectionEnabled(){return this.viewModel.continuousSelectionEnabled}set continuousSelectionEnabled(e){this.viewModel.continuousSelectionEnabled=e}get defaultLassoToolOptions(){return this.viewModel.defaultLassoToolOptions}set defaultLassoToolOptions(e){this.viewModel.defaultLassoToolOptions=e}get defaultOperationType(){return this.viewModel.defaultOperationType}set defaultOperationType(e){this.viewModel.defaultOperationType=e}get defaultPointToolOptions(){return this.viewModel.defaultPointToolOptions}set defaultPointToolOptions(e){this.viewModel.defaultPointToolOptions=e}get defaultRectangleToolOptions(){return this.viewModel.defaultRectangleToolOptions}set defaultRectangleToolOptions(e){this.viewModel.defaultRectangleToolOptions=e}get effectiveSelectionManager(){return this.viewModel.effectiveSelectionManager}get effectiveSources(){return this.viewModel.effectiveSources}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return r.deprecatedProperty(n.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources}set layers(e){r.deprecatedProperty(n.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.viewModel.sources=e}get layerViewPreferenceEnabled(){return this.viewModel.layerViewPreferenceEnabled}set layerViewPreferenceEnabled(e){this.viewModel.layerViewPreferenceEnabled=e}get persistSelection(){return this.viewModel.persistSelection}set persistSelection(e){this.viewModel.persistSelection=e}get returnFeatureTitleFields(){return this.viewModel.returnFeatureTitleFields}set returnFeatureTitleFields(e){this.viewModel.returnFeatureTitleFields=e}get returnGeometry(){return this.viewModel.returnGeometry}set returnGeometry(e){this.viewModel.returnGeometry=e}get selectOnComplete(){return this.viewModel.selectOnComplete}set selectOnComplete(e){this.viewModel.selectOnComplete=e}get selectionManager(){return this.viewModel.selectionManager}set selectionManager(e){this.viewModel.selectionManager=e}get state(){return this.viewModel.state}get sources(){return this.viewModel.sources}set sources(e){this.viewModel.sources=e}get toolConfigs(){return this.viewModel.toolConfigs}set toolConfigs(e){this.viewModel.toolConfigs=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get visibleToolCount(){const{visibleElements:e}=this;return this.toolConfigs.length+(e.lassoTool?1:0)+(e.rectangleTool?1:0)}activate(e){if(this.cancel(),!this._effectiveDisabled)return this.viewModel.activate(e)}activateTool(e){if(!this._effectiveDisabled)return this.viewModel.activateTool(e)}cancel(){this.viewModel.cancel()}toggleTool(e){if(!this._effectiveDisabled)return this.viewModel.toggleTool(e)}render(){return m.tsx("div",{"aria-label":this.label,class:this.classes(S.base,y.globalCss.widget)},m.tsx("div",{class:S.container},m.tsx("calcite-action-bar",{expandDisabled:!0,layout:"horizontal",scale:this.scale},this._renderDefaultTools(),this._renderCustomTools(),this._renderChip())))}_renderDefaultTools(){return[this._renderPanAction(),this._renderPointTool(),this._renderRectangleTool(),this._renderLassoTool()]}_renderPanAction(){if(!this.visibleElements.pan)return;const e=this.messages.pan,t=`${this.id}-tool-pan`;return this._renderAction({active:!this.activeOperation,disabled:this._effectiveDisabled,icon:"pan",id:t,key:t,onclick:()=>this.cancel(),text:e,title:e})}_renderChip(){if(!this.visibleElements.chip)return;const{effectiveSelectionManager:e}=this,t=e?.count??0,o=b.formatNumber(t);return m.tsx("calcite-chip",{appearance:"outline",closable:t>0,closed:0===t,disabled:this._effectiveDisabled||0===t,label:o,scale:this.scale,slot:"actions-end",title:this.messages.clearSelection,onCalciteChipClose:()=>e?.clear()},o)}_renderCustomTools(){return this.toolConfigs.map(({toolName:e,icon:t})=>this._renderToolWithTooltip(e,t))}_renderPointTool(){if(this.visibleElements.pointTool)return this._renderToolWithTooltip("point","selection-set",this.messages.selectByPoint)}_renderLassoTool(){if(this.visibleElements.lassoTool)return this._renderToolWithTooltip("lasso","lasso-select",this.messages.selectByLasso)}_renderRectangleTool(){if(this.visibleElements.rectangleTool)return this._renderToolWithTooltip("rectangle","cursor-marquee",this.messages.selectByRectangle)}_renderToolWithTooltip(e,t,o=e){const r=`${this.id}-tool-${e}`;return this._renderAction({active:this.activeOperation?.toolName===e,disabled:this._effectiveDisabled,icon:t||"selection",id:r,key:r,onclick:()=>this.toggleTool(e),text:o,title:o})}_renderAction(e){return m.tsx("calcite-action",{...e,bind:this,class:S.toolButton,scale:this.scale})}};return t.__decorate([l.property()],M.prototype,"_effectiveDisabled",null),t.__decorate([l.property()],M.prototype,"activeOperation",null),t.__decorate([l.property()],M.prototype,"continuousSelectionEnabled",null),t.__decorate([l.property()],M.prototype,"defaultLassoToolOptions",null),t.__decorate([l.property()],M.prototype,"defaultOperationType",null),t.__decorate([l.property()],M.prototype,"defaultPointToolOptions",null),t.__decorate([l.property()],M.prototype,"defaultRectangleToolOptions",null),t.__decorate([l.property()],M.prototype,"disabled",void 0),t.__decorate([l.property()],M.prototype,"effectiveSelectionManager",null),t.__decorate([l.property()],M.prototype,"effectiveSources",null),t.__decorate([l.property()],M.prototype,"label",null),t.__decorate([l.property()],M.prototype,"layers",null),t.__decorate([l.property()],M.prototype,"layerViewPreferenceEnabled",null),t.__decorate([l.property()],M.prototype,"layout",void 0),t.__decorate([l.property(),f.messageBundle("esri/widgets/support/SelectionToolbar/t9n/SelectionToolbar")],M.prototype,"messages",void 0),t.__decorate([l.property()],M.prototype,"persistSelection",null),t.__decorate([l.property()],M.prototype,"returnFeatureTitleFields",null),t.__decorate([l.property()],M.prototype,"returnGeometry",null),t.__decorate([l.property()],M.prototype,"selectOnComplete",null),t.__decorate([l.property()],M.prototype,"scale",void 0),t.__decorate([l.property()],M.prototype,"selectionManager",null),t.__decorate([l.property()],M.prototype,"state",null),t.__decorate([l.property()],M.prototype,"sources",null),t.__decorate([l.property()],M.prototype,"toolConfigs",null),t.__decorate([l.property()],M.prototype,"view",null),t.__decorate([l.property()],M.prototype,"viewModel",void 0),t.__decorate([l.property({type:_,nonNullable:!0})],M.prototype,"visibleElements",void 0),t.__decorate([l.property()],M.prototype,"visibleToolCount",null),M=t.__decorate([d.subclass("esri.widgets.support.SelectionToolbar")],M),M})},"esri/widgets/support/globalCss":function(){define(["exports"],function(e){"use strict";e.globalCss={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",primaryTickLabelKeepAll:"primary-tick__label--keep-all",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SelectionToolbar/SelectionToolbarViewModel":function(){define(["../../../chunks/tslib.es6","../../../core/deprecate","../../../core/Evented","../../../core/handleUtils","../../../core/Logger","../../../core/maybe","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../layers/support/layerUtils","../../../views/draw/support/layerUtils","../../../views/support/layerViewUtils","../Selector2D/SelectionOperation"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y){"use strict";let g=class extends o.EventedAccessor{constructor(e){super(e),this._operationHandlesGroup=null,this.activeOperation=null,this.continuousSelectionEnabled=!1,this.defaultLassoToolOptions={createTool:"polygon",mode:"hybrid",toolName:"lasso"},this.defaultOperationType="add",this.defaultPointToolOptions={createTool:"point",toolName:"point"},this.defaultRectangleToolOptions={createTool:"rectangle",toolName:"rectangle"},this.layerViewPreferenceEnabled=!0,this.persistSelection=!0,this.selectionManager=null,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selectOnComplete=!0,this.sources=null,this.toolConfigs=[]}initialize(){this.addHandles([s.watch(()=>this.effectiveSources,e=>{this.activeOperation&&(this.activeOperation.sources=e)})])}destroy(){this.activeOperation?.cancel(),this.activeOperation?.destroy(),this._operationHandlesGroup=n.removeMaybe(this._operationHandlesGroup)}get effectiveSelectionManager(){return this.selectionManager??this.view?.selectionManager}get effectiveSources(){const{layerViewPreferenceEnabled:e,sources:t,view:o}=this,r=t??this.effectiveSelectionManager?.sources;if(!r?.length)return[];const i=[];return r.forEach(t=>{if(h.isSelectableLayerView2D(t))i.push(t);else if(d.isKnowledgeGraphLayer(t)||d.isLinkChartLayer(t))(t.layers||[]).forEach(t=>{const r=o?u.findLayerView(o,t):void 0,n=e&&h.isSelectableLayerView2D(r)?r:t;i.push(n)});else if(e){const e=o?u.findLayerView(o,t):void 0,r=h.isSelectableLayerView2D(e)?e:t;i.push(r)}else i.push(t)}),i}get layers(){return t.deprecatedProperty(i.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources}set layers(e){t.deprecatedProperty(i.getLogger(this),"layers",{replacement:"Use SelectionToolbar.sources instead."}),this.sources=e}get state(){return this.activeOperation?"active":this.view?.ready&&this.effectiveSources.length?"ready":"disabled"}activate(e){const{state:t}=this,o=e?.view||this.view,n=e?.sources||this.effectiveSources;if("disabled"===t||!o)return void i.getLogger(this).warn("Unable to start selection operation.");"active"===t&&this.cancel();const s=new CustomEvent("before-activate",{cancelable:!0,detail:{toolName:e?.toolName??null}});if(this.emit("before-activate",s),s.defaultPrevented)return;const a={type:this.defaultOperationType,persistSelection:this.persistSelection,returnFeatureTitleFields:this.returnFeatureTitleFields,returnGeometry:this.returnGeometry,selectOnComplete:this.selectOnComplete,selectionManager:this.effectiveSelectionManager,...e,sources:n,view:o},l=new y({...a});return this._operationHandlesGroup=r.handlesGroup([l.on("selection-change",e=>this.emit("selection-change",e)),l.once("complete",e=>this._onOperationComplete(e,a))]),this._set("activeOperation",l),l}activateTool(e){this.cancel();const t=this._getToolOptions(e);if(t)return this.activate(t);i.getLogger(this).warn("Unable to activate tool: unable to determine options.")}cancel(){this.activeOperation?.cancel(),this._set("activeOperation",null)}toggleTool(e){const{activeOperation:t}=this;if(t){const o=t.toolName;if(this.cancel(),o===e)return}return this.activateTool(e)}_onOperationComplete(e,t){this._operationHandlesGroup=n.removeMaybe(this._operationHandlesGroup),this.activeOperation?.destroy(),this._set("activeOperation",null),this.emit("complete",e),this.continuousSelectionEnabled&&!e.aborted&&this.activate(t)}_getToolOptions(e){return this.toolConfigs.find(t=>t.toolName===e)||("lasso"===e?this.defaultLassoToolOptions:"point"===e?this.defaultPointToolOptions:"rectangle"===e?this.defaultRectangleToolOptions:void 0)}};return e.__decorate([a.property({readOnly:!0})],g.prototype,"activeOperation",void 0),e.__decorate([a.property()],g.prototype,"continuousSelectionEnabled",void 0),e.__decorate([a.property()],g.prototype,"defaultLassoToolOptions",void 0),e.__decorate([a.property()],g.prototype,"defaultOperationType",void 0),e.__decorate([a.property()],g.prototype,"defaultPointToolOptions",void 0),e.__decorate([a.property()],g.prototype,"defaultRectangleToolOptions",void 0),e.__decorate([a.property()],g.prototype,"effectiveSelectionManager",null),e.__decorate([a.property()],g.prototype,"effectiveSources",null),e.__decorate([a.property()],g.prototype,"layers",null),e.__decorate([a.property()],g.prototype,"layerViewPreferenceEnabled",void 0),e.__decorate([a.property()],g.prototype,"persistSelection",void 0),e.__decorate([a.property()],g.prototype,"selectionManager",void 0),e.__decorate([a.property()],g.prototype,"returnFeatureTitleFields",void 0),e.__decorate([a.property()],g.prototype,"returnGeometry",void 0),e.__decorate([a.property()],g.prototype,"selectOnComplete",void 0),e.__decorate([a.property()],g.prototype,"sources",void 0),e.__decorate([a.property({readOnly:!0})],g.prototype,"state",null),e.__decorate([a.property()],g.prototype,"toolConfigs",void 0),e.__decorate([a.property()],g.prototype,"view",void 0),g=e.__decorate([p.subclass("esri.widgets.support.SelectionToolbar.SelectionToolbarViewModel")],g),g})},"esri/widgets/support/Selector2D/SelectionOperation":function(){define(["require","../../../chunks/tslib.es6","../../../core/asyncUtils","../../../core/Collection","../../../core/Evented","../../../core/handleUtils","../../../core/Logger","../../../core/maybe","../../../core/promiseUtils","../../../core/screenUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Point","../../../geometry/Polygon","../../../geometry/support/coordsUtils","../../../views/interactive/keybindings","../../../views/support/automaticLengthMeasurementUtils","./selectorUtils"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g,f,m,v,_){"use strict";let b=class extends i.EventedAccessor{constructor(e){super(e),this._completed=!1,this._isConstraintKeyDown=!1,this._processTask=null,this.createTool="rectangle",this.mode=null,this.persistSelection=!0,this.returnFeatureTitleFields=!1,this.returnGeometry=!0,this.selection=new r,this.selectionManager=null,this.selectOnComplete=!0,this.sources=null,this.toolName="",this.type="add",this._process=l.debounce(async(e,t)=>{const{callback:r,selector:i,completed:n}=e,s=o.createTask(async e=>{const{effectiveSelectionManager:t,returnFeatureTitleFields:o,returnGeometry:s,selection:a,sources:l,view:c}=this;if((l?.length||t.sources.length)&&c){if(i&&null!=l){const r=await _.getSelectionFromGeometry({returnFeatureTitleFields:o,returnGeometry:s,selector:i,signal:e,sources:l,view:c});if(a.removeAll(),a.addMany(r),n&&this.persistSelection)switch(this.effectiveType){case"remove":t.updateSelection({current:[],added:[],removed:r});break;case"replace":t.clear(),t.updateSelection({current:r,added:[],removed:[]});break;default:t.updateSelection({current:r,added:[],removed:[]})}}r&&r()}else a.removeAll()});return l.onAbort(t,()=>s.abort()),this._processTask=s,s.promise},100),this._onOperationFinish=this._onOperationFinish.bind(this)}initialize(){this._setup()}get _defaultMode(){return"polygon"===this.createTool?"click":"hybrid"}get _selectionArea(){const e=this._tool.coordinates;if(0===e.length)return;const t=c.createScreenPoint(),o=this.view.spatialReference,r=e=>{t.x=e[0],t.y=e[1];const o=this.view.toMap(t);return[o?.x??0,o?.y??0]};if(1===e.length||e.every(([t,o])=>t===e[0][0]&&o===e[0][1])){const[t,i]=r(e[0]);return new y({x:t,y:i,spatialReference:o})}const i=e.map(r);return 0!==i.length?(f.isClockwise(i)||i.reverse(),new g({spatialReference:o,rings:[i]})):void 0}get completed(){return this._completed}get effectiveSelectionManager(){return this.selectionManager??this.view.selectionManager}get effectiveType(){const e=this.type??"add";if(this._isConstraintKeyDown)switch(e){case"add":return"remove";case"remove":case"replace":return"add";default:return e}return e}get processingFinalSelection(){return!(!this._processTask||!this._tool?.drawOperation?.isCompleted)}cancel(){this.selection.removeAll(),this._onOperationFinish(!0)}destroy(){this._toolImportController=a.abortMaybe(this._toolImportController)}async _setup(){const{createTool:t,view:o}=this;if(await o.whenReady(),this.destroyed||this._toolImportController)return;const r=new AbortController;this._toolImportController=r;const[i,a]=await Promise.all([new Promise((t,o)=>e(["../../../views/draw/DrawScreenTool"],t,o)),v.loadAutomaticLengthMeasurementUtils()]);if(r.signal.aborted)return;const c=Symbol();try{this._tool=new i.DrawScreenTool({view:o,mode:this.mode??this._defaultMode,geometryType:t,cursor:"point"===t?"default":"crosshair",automaticLengthMeasurementUtils:a})}finally{this._toolImportController=null}this._tool?(this.selectOnComplete||this.addHandles(this._tool.on(["cursor-update","vertex-add","vertex-remove"],()=>{this._syncConstraintKeyDown(),l.ignoreAbortErrors(this._process({selector:this._selectionArea}))}),c),this.addHandles([o.on("key-down",e=>{if(!e.repeat)switch(e.key){case m.sketchKeys.constraint:this._tool.uniformSizeToggled=!0,e.stopPropagation();break;case m.sketchKeys.center:this._tool.centeredToggled=!0,e.stopPropagation()}}),o.on("key-up",e=>{switch(e.key){case m.sketchKeys.constraint:this._tool.uniformSizeToggled=!1,e.stopPropagation();break;case m.sketchKeys.center:this._tool.centeredToggled=!1,e.stopPropagation()}}),this.selection.on("change",({added:e,removed:t})=>this.emit("selection-change",{operationType:this.effectiveType,added:e,removed:t})),this._tool.on("complete",async e=>{this._syncConstraintKeyDown(),this.removeHandles(c),e.aborted?this.cancel():(this._tool.cursor="progress",await this._process({selector:this._selectionArea,callback:this._onOperationFinish,completed:!0}))})],c),this.addHandles(n.makeHandle(()=>o.tools.remove(this._tool))),o.addAndActivateTool(this._tool)):s.getLogger(this).warn("Unable to import Draw module. SelectionOperation failed to load.")}_syncConstraintKeyDown(){const{inputManager:e}=this.view;this._isConstraintKeyDown=m.selectionKeys.invertType.some(t=>e.isModifierKeyDown(t))}_onOperationFinish(e=!1){this.removeAllHandles(),this._processTask?.abort(),this.emit("complete",{aborted:e,operationType:this.effectiveType,selection:this.selection.toArray(),toolName:this.toolName}),this._completed=!0}};return t.__decorate([p.property()],b.prototype,"_completed",void 0),t.__decorate([p.property()],b.prototype,"_defaultMode",null),t.__decorate([p.property()],b.prototype,"_isConstraintKeyDown",void 0),t.__decorate([p.property()],b.prototype,"_processTask",void 0),t.__decorate([p.property()],b.prototype,"_selectionArea",null),t.__decorate([p.property()],b.prototype,"completed",null),t.__decorate([p.property({constructOnly:!0})],b.prototype,"createTool",void 0),t.__decorate([p.property()],b.prototype,"effectiveSelectionManager",null),t.__decorate([p.property()],b.prototype,"effectiveType",null),t.__decorate([p.property({constructOnly:!0})],b.prototype,"mode",void 0),t.__decorate([p.property()],b.prototype,"persistSelection",void 0),t.__decorate([p.property()],b.prototype,"processingFinalSelection",null),t.__decorate([p.property()],b.prototype,"returnFeatureTitleFields",void 0),t.__decorate([p.property()],b.prototype,"returnGeometry",void 0),t.__decorate([p.property({readOnly:!0})],b.prototype,"selection",void 0),t.__decorate([p.property({constructOnly:!0})],b.prototype,"selectionManager",void 0),t.__decorate([p.property({constructOnly:!0})],b.prototype,"selectOnComplete",void 0),t.__decorate([p.property()],b.prototype,"sources",void 0),t.__decorate([p.property({constructOnly:!0})],b.prototype,"toolName",void 0),t.__decorate([p.property({constructOnly:!0})],b.prototype,"type",void 0),t.__decorate([p.property({constructOnly:!0})],b.prototype,"view",void 0),b=t.__decorate([h.subclass("esri.widgets.support.Selector2D.SelectionOperation")],b),b})},"esri/widgets/support/Selector2D/selectorUtils":function(){define(["require","exports","../../../core/arrayUtils","../../../core/promiseUtils","../../../layers/support/fieldUtils","../../../layers/support/layerUtils","../../../renderers/support/clickToleranceUtils","../../../views/support/drapedUtils","../../../views/support/layerViewUtils"],function(e,t,o,r,i,n,s,a,l){"use strict";async function c(e){const{candidates:t,layerViews:i,returnGeometry:n,selector:s,signal:a,view:l}=e;"point"!==s.type?await r.whenOrAbort(Promise.allSettled(i.map(async e=>{const r=function(e,t,o,r=!0){const i=e.createQuery();return i.outFields=["*"],i.geometry=d(t,e.layer,o),i.returnGeometry=r,i.outSpatialReference=o.spatialReference,i}(e,s,l,n),i=await e.queryFeatures(r,{signal:a});o.addMany(t,i.features)})),a):await async function({candidates:e,layerViews:t,selector:o,view:r}){const i=r.toScreen(o);if(!i)return;const n=t.map(e=>e.layer),{results:s}=await r.hitTest(i,{include:n});s.forEach(t=>{"graphic"in t&&t.graphic&&e.push(t.graphic)})}({candidates:t,layerViews:i,selector:s,view:l})}async function p(e){const{candidates:t,layers:i,returnFeatureTitleFields:n,returnGeometry:s,selector:a,signal:l,view:c}=e;await r.whenOrAbort(Promise.allSettled(i.map(async e=>{if("isTable"in e&&e.isTable)return;const r=function(e,t,o,r=!1,i=!0){const n=e.createQuery();return n.outFields=u(e,o,r),n.geometry=d(t,e,o),n.returnGeometry=i,n.outSpatialReference=o.spatialReference,n}(e,a,c,n,s),i=await e.queryFeatures(r,{signal:l});o.addMany(t,i.features)})),l)}function d(e,t,o){return"point"===e.type?a.createQueryGeometry(e,"renderer"in t?s.calculateTolerance({renderer:t.renderer}):0,o):e}function u(e,t,o){const{fields:r,fieldsIndex:n}=e,s=new Set([e.objectIdField]);"globalIdField"in e&&null!=e.globalIdField&&n.has(e.globalIdField)&&s.add(n.get(e.globalIdField).name);const a="displayField"in e?e.displayField:null,l=i.getDisplayFieldName({displayField:a,fields:r});if(null!=l&&n.has(l)&&s.add(l),"subtypeField"in e&&null!=e.subtypeField){const o=n.get(e.subtypeField)?.name;if(null!=o&&s.add(o),"utilityNetworks"in t.map&&t.map.utilityNetworks?.length){const e=n.get("assetgroup");e?.name&&s.add(e.name);const t=n.get("assettype");t?.name&&s.add(t.name)}}return(o||t.requiredFieldsOptions.featureTitleFields)&&"featureTitleFields"in e&&e.featureTitleFields&&e.featureTitleFields.forEach(e=>s.add(e)),Array.from(s.values())}async function h(t){const{candidates:o,graphicsLayers:r,selector:i}=t,n=r.flatMap(e=>e.graphics.toArray())??[];if(!n?.length||!i)return;const s=await new Promise((t,o)=>e(["../../../geometry/operators/intersectsOperator"],t,o));s.accelerateGeometry(i),n.forEach(e=>{e.geometry&&"mesh"!==e.geometry.type&&s.execute(i,e.geometry)&&o.push(e)})}t.collectSelectionFromFeatureLayerViews=c,t.collectSelectionFromFeatureLayers=p,t.collectSelectionFromGraphicsLayers=h,t.getSelectionFromGeometry=async function(e){const{returnFeatureTitleFields:t,returnGeometry:o,selector:i,signal:s,sources:a,view:d}=e;if(!a?.length)return[];const{layers:u,layerViews:y,graphicsLayers:g}=function(e){const t=[],o=[],r=[];return e.forEach(e=>{n.isFeatureLayer(e)||n.isSubtypeGroupLayer(e)||n.isSubtypeSublayer(e)?t.push(e):(n.isKnowledgeGraphLayer(e)||n.isLinkChartLayer(e))&&e.layers?.length?t.push(...e.layers.toArray()):n.isMapNotesLayer(e)&&e.sublayers?.length?r.push(...e.sublayers.toArray()):n.isGraphicsLayer(e)?r.push(e):l.isSelectableLayerView2D(e)&&o.push(e)}),{layers:t,layerViews:o,graphicsLayers:r}}(a),f=[];return await r.ignoreAbortErrors(r.whenOrAbort(Promise.all([p({candidates:f,layers:u,returnFeatureTitleFields:t,returnGeometry:o,selector:i,signal:s,view:d}),c({candidates:f,layerViews:y,returnGeometry:o,selector:i,signal:s,view:d}),h({candidates:f,graphicsLayers:g,selector:i})]),s)),f},t.getSuggestedQueryGeometry=d,t.getSuggestedQueryOutFields=u,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(e){"use strict";function t(e,t){return t?"xoffset"in t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):"yoffset"in t&&t.yoffset?Math.max(e,Math.abs(t.yoffset||0)):e:e}function o(e,t){return"number"==typeof e?e:e?.stops?.length?function(e){let t=0,o=0;for(let r=0;r<e.length;r++){const i=e[r].size;"number"==typeof i&&(t+=i,o++)}return t/o}(e.stops):t}e.calculateTolerance=function(e){const r=e?.renderer,i=e?.pointerType,n="touch"===i?9:6;if(!r)return n;const s="visualVariables"in r?function(e,t){if(!t)return e;const r=t.filter(e=>"size"===e.type).map(t=>{const{maxSize:r,minSize:i}=t;return(o(r,e)+o(i,e))/2});let i=0;const n=r.length;if(0===n)return e;for(let e=0;e<n;e++)i+=r[e];const s=Math.floor(i/n);return Math.max(s,e)}(n,r.visualVariables):n;if("simple"===r.type)return t(s,r.symbol);if("unique-value"===r.type){let e=s;return r.uniqueValueInfos?.forEach(o=>{e=t(e,o.symbol)}),e}if("class-breaks"===r.type){let e=s;return r.classBreakInfos.forEach(o=>{e=t(e,o.symbol)}),e}return"dot-density"===r.type||r.type,s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/drapedUtils":function(){define(["exports","../../core/unitUtils","../../geometry/Extent","../../renderers/support/clickToleranceUtils"],function(e,t,o,r){"use strict";function i(e,r,i,n=new o){let s=0;if("2d"===i.type)s=r*(i.resolution??0);else if("3d"===i.type){const o=i.overlayPixelSizeInMapUnits(e),n=i.basemapSpatialReference;s=null==n||n.equals(i.spatialReference)?r*o:t.getMetersPerUnitForSR(n)/t.getMetersPerUnitForSR(i.spatialReference)}const a=e.x-s,l=e.y-s,c=e.x+s,p=e.y+s,{spatialReference:d}=i;return n.xmin=Math.min(a,c),n.ymin=Math.min(l,p),n.xmax=Math.max(a,c),n.ymax=Math.max(l,p),n.spatialReference=d,n}let n=new o;e.cleanupDrapedUtils=function(){n=new o},e.createQueryGeometry=i,e.intersectsDrapedGeometry=function(e,t,o){const s=o.toMap(e);return null!=s&&i(s,r.calculateTolerance(),o,n).intersects(t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SelectionToolbar/VisibleElements":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.chip=!0,this.lassoTool=!0,this.pan=!0,this.pointTool=!0,this.rectangleTool=!0}};return e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"chip",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"lassoTool",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"pan",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"pointTool",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"rectangleTool",void 0),a=e.__decorate([s.subclass("esri.widgets.support.SelectionToolbar.VisibleElements")],a),a})},"esri/widgets/support/SketchTooltipControls":function(){define(["require","../../chunks/tslib.es6","../../core/arrayUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../views/interactive/sketch/SketchOptions","../../views/interactive/tooltip/components/directionModeIcons","../Widget","../../chunks/componentsUtils","./globalCss","./LabeledSwitch","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SketchTooltipControls/VisibleElements"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g,f){"use strict";const m="esri-sketch-tooltip-controls",v={base:m,block:`${m}__block`,blockContent:`${m}__block-content`,radioButtonLabelWrapper:`${m}__radio-button-label-wrapper`};let _=class extends c{constructor(e,t){super(e,t),this.viewModel=null,this.visibleElements=new f,this.sketchOptions=new a,this.viewType=void 0,this._onTooltipsEnabledChange=e=>{this.sketchOptions.tooltips.enabled=e},this._onLabelsEnabledChange=e=>{this.sketchOptions.labels.enabled=e},this._onDirectionModeChange=e=>{this.sketchOptions.values.directionMode=e.currentTarget.selectedItem.value}}loadDependencies(){return Promise.all([p.loadCalciteComponents({block:()=>new Promise((t,o)=>e(["../../chunks/index13"],t,o)),label:()=>new Promise((t,o)=>e(["../../chunks/index5"],t,o)),icon:()=>new Promise((t,o)=>e(["../../chunks/index7"],t,o)),"radio-button":()=>new Promise((t,o)=>e(["../../chunks/index35"],t,o)),"radio-button-group":()=>new Promise((t,o)=>e(["../../chunks/index36"],t,o))}),u.loadLabeledSwitchComponents()])}render(){const{label:e,visibleElements:t}=this,o=this._renderContent();return g.tsx("div",{"aria-label":e,class:this.classes(v.base,d.globalCss.widget)},o?g.tsx("calcite-block",{class:v.block,expanded:!0,heading:t.header?this.label:"",key:"content-block",label:this.label},g.tsx("div",{class:v.blockContent,key:"content"},o)):void 0)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}_renderContent(){const{visibleElements:e,viewType:t}=this,r=[e.tooltipsToggle?this._renderTooltipsToggle():null,e.labelsToggle&&"2d"!==t?this._renderLabelsToggle():null,e.directionModePicker?this._renderDirectionModePicker():null].filter(o.isSome);return 0===r.length?null:r}_renderTooltipsToggle(){const{messages:e,sketchOptions:t}=this;return g.tsx(u.LabeledSwitch,{checked:t.tooltips.effectiveEnabled,hint:e.tooltipsToggleHint,key:`${this.id}__tooltips`,label:e.tooltipsToggle,onChange:this._onTooltipsEnabledChange})}_renderLabelsToggle(){const{messages:e,sketchOptions:t}=this;return g.tsx(u.LabeledSwitch,{checked:t.labels.enabled,hint:e.labelsToggleHint,key:`${this.id}__labels`,label:e.labelsToggle,onChange:this._onLabelsEnabledChange})}_renderDirectionModePicker(){const{messages:e,sketchOptions:t}=this,{directionMode:o}=t.values;return g.tsx("calcite-label",{key:"direction-mode",layout:"default",scale:"s"},e.directionModePicker,g.tsx("calcite-radio-button-group",{key:"radio-button-group",layout:"horizontal",name:this.id,scale:"s",value:o,onCalciteRadioButtonGroupChange:this._onDirectionModeChange},this._renderDirectionModeOption("relative",o,e.directionModeRelative),this._renderDirectionModeOption("absolute",o,e.directionModeAbsolute)))}_renderDirectionModeOption(e,t,o){return g.tsx("calcite-label",{key:e,layout:"inline",scale:"s"},g.tsx("calcite-radio-button",{checked:e===t,scale:"s",value:e}),g.tsx("div",{class:v.radioButtonLabelWrapper,key:"label-wrapper"},g.tsx("calcite-icon",{icon:l.directionModeIcons[e],scale:"s"}),o))}};return t.__decorate([r.property()],_.prototype,"label",null),t.__decorate([r.property({type:f,nonNullable:!0})],_.prototype,"visibleElements",void 0),t.__decorate([r.property(),y.messageBundle("esri/widgets/support/SketchTooltipControls/t9n/SketchTooltipControls")],_.prototype,"messages",void 0),t.__decorate([r.property({nonNullable:!0,type:a})],_.prototype,"sketchOptions",void 0),t.__decorate([r.property({type:String})],_.prototype,"viewType",void 0),_=t.__decorate([s.subclass("esri.widgets.support.SketchTooltipControls")],_),_})},"esri/views/interactive/tooltip/components/directionModeIcons":function(){define(["exports"],function(e){"use strict";e.directionModeIcons={absolute:"absolute-direction",relative:"relative-direction"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/LabeledSwitch":function(){define(["require","exports","../../chunks/componentsUtils","./widgetUtils","./jsxFactory"],function(e,t,o,r,i){"use strict";const n="esri-labeled-switch",s={label:`${n}__label`,labelContent:`${n}__label-content`,iconInfo:`${n}__icon_info`,iconWarning:`${n}__icon_warning`,tooltip:`${n}__tooltip`};t.LabeledSwitch=function({checked:e,disabled:t,hint:o,key:r,label:n,onChange:a,hintIcon:l,hintKind:c}){return i.tsx("calcite-label",{class:s.label,disabled:t,key:r,layout:"inline-space-between",scale:"s"},o?i.tsx("div",{class:s.labelContent,key:"label-content"},i.tsx("div",null,n),i.tsx("calcite-icon",{class:"warning"!==c?s.iconInfo:s.iconWarning,icon:l??"information",id:r,onclick:e=>e.stopPropagation(),onpointerdown:e=>{e.preventDefault(),e.stopPropagation();const t=e.target.nextElementSibling;t.open=!t.open},scale:"s",tabIndex:0}),i.tsx("calcite-tooltip",{class:s.tooltip,overlayPositioning:"fixed",referenceElement:r},o)):n,i.tsx("calcite-switch",{checked:e,disabled:t,scale:"s",onCalciteSwitchChange:e=>a(e.currentTarget.checked)}))},t.loadLabeledSwitchComponents=()=>o.loadCalciteComponents({icon:()=>new Promise((t,o)=>e(["../../chunks/index7"],t,o)),label:()=>new Promise((t,o)=>e(["../../chunks/index5"],t,o)),switch:()=>new Promise((t,o)=>e(["../../chunks/index33"],t,o)),tooltip:()=>new Promise((t,o)=>e(["../../chunks/index17"],t,o))}),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SketchTooltipControls/VisibleElements":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,o,r,i,n,s){"use strict";let a=class extends t{constructor(e){super(e),this.directionModePicker=!1,this.header=!1,this.labelsToggle=!0,this.tooltipsToggle=!0}};return e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"directionModePicker",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"header",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"labelsToggle",void 0),e.__decorate([o.property({type:Boolean,nonNullable:!0})],a.prototype,"tooltipsToggle",void 0),a=e.__decorate([s.subclass("esri.widgets.support.SketchTooltipControls.VisibleElements")],a),a})},"esri/widgets/support/SnappingControls":function(){define(["require","../../chunks/tslib.es6","../../core/arrayUtils","../../core/asyncUtils","../../core/maybe","../../core/reactiveUtils","../../core/uid","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../Widget","../../chunks/componentsUtils","./globalCss","./LabeledSwitch","./widgetUtils","./decorators/messageBundle","./jsxFactory","./SnappingControls/SnappingControlsViewModel","./SnappingControls/snappingLayerListUtils","./SnappingControls/VisibleElements"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g,f,m,v,_,b){"use strict";const w=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),S="esri-snapping-controls",M={base:S,container:`${S}__container`,toggleBlock:`${S}__toggle-block`,layerListBlock:`${S}__layer-list-block`,layerList:`${S}__layer-list`,layerListFilter:`${S}__layer-list__filter`,layerListButton:`${S}__layer-list__button`,layerListItem:`${S}__layer-list__item`,layerListGroup:`${S}__layer-list__group`,nestedContainer:`${S}__nested-container`};let T=class extends d{constructor(e,t){super(e,t),this._defaultViewModel=null,this._layerListFilter=null,this._gridLoadTask=null,this.layerListOpen=!0,this.gridOptionsOpen=!1,this.messages=null,this.messagesCommon=null,this.snappingManager=null,this.visibleElements=new b,this._enableSnappingSwitchChange=e=>{this.snappingOptions.enabled=e},this._featureEnabledSwitchChange=e=>{this.snappingOptions.featureEnabled=e},this._gridEnabledSwitchChange=e=>{this.snappingOptions.gridEnabled=e,e&&this._startLoadGrid()},this._selfEnabledSwitchChange=e=>{this.snappingOptions.selfEnabled=e},this._onToggleLayersButtonClick=e=>{this.viewModel.toggleSnappingForAllLayers(!this.viewModel.allLayersEnabled),g.setFocus(e.target)};const{snappingOptions:o,view:r,viewModel:i}=e;this.viewModel=i??(this._defaultViewModel=new v({snappingOptions:o,view:r}))}normalizeCtorArgs(e){const{snappingOptions:t,view:o,viewModel:r,...i}=e;return i}destroy(){this.viewModel!==this._defaultViewModel&&(this._defaultViewModel=i.destroyMaybe(this._defaultViewModel))}loadDependencies(){return Promise.all([u.loadCalciteComponents({block:()=>new Promise((t,o)=>e(["../../chunks/index13"],t,o)),button:()=>new Promise((t,o)=>e(["../../chunks/index2"],t,o)),input:()=>new Promise((t,o)=>e(["../../chunks/index4"],t,o)),list:()=>new Promise((t,o)=>e(["../../chunks/index16"],t,o)),"list-item":()=>new Promise((t,o)=>e(["../../chunks/index20"],t,o)),checkbox:()=>new Promise((t,o)=>e(["../../chunks/index44"],t,o)),loader:()=>new Promise((t,o)=>e(["../../chunks/index32"],t,o))}),y.loadLabeledSwitchComponents()])}initialize(){this.addHandles(n.watch(()=>"2d"===this.view?.type&&!!this.view.grid,e=>{this.visibleElements.gridControls&&(this.snappingOptions.gridEnabled=e)}))}get _openAndReady(){return this.gridOptionsOpen&&this.snappingOptions.gridEnabled&&this.snappingOptions.enabled}get icon(){return"snap-to-point"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){e!==this._get("viewModel")&&(null!=this._defaultViewModel&&this._defaultViewModel===e||(this._defaultViewModel=i.destroyMaybe(this._defaultViewModel)),this._set("viewModel",e))}render(){const{label:e}=this;return m.tsx("div",{"aria-label":e,class:this.classes(M.base,h.globalCss.widget)},m.tsx("div",{class:M.container},this._renderContent()))}_renderContent(){return[this._renderToggles(),this._renderLayerList(),"2d"===this.view?.type&&this.visibleElements.gridControls?this._renderGridOptions():null]}_renderToggles(){const{visibleElements:e,view:t}=this,r=[e.selfEnabledToggle?this._renderSelfEnabledToggle():null,e.featureEnabledToggle?this._renderFeatureEnabledToggle():null,e.gridEnabledToggle&&"2d"===t?.type?this._renderGridEnabledToggle():null].filter(o.isSome),i=[e.enabledToggle?this._renderEnabledToggle():null,r.length>0?m.tsx("div",{class:M.nestedContainer},r):null].filter(o.isSome);return 0===i.length?null:m.tsx("calcite-block",{class:M.toggleBlock,expanded:!0,heading:e.header?this.label:"",key:"toggle-block",label:this.label},i)}_renderEnabledToggle(){return m.tsx(y.LabeledSwitch,{checked:this.viewModel.snappingOptions.enabled,disabled:this._enabledToggleDisabled,key:`${this.id}__enabled-toggle`,label:this.messages.enableSnapping,onChange:this._enableSnappingSwitchChange})}_renderSelfEnabledToggle(){return m.tsx(y.LabeledSwitch,{checked:this.viewModel.snappingOptions.selfEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__self-enabled-toggle`,label:this.messages.geometryGuides,onChange:this._selfEnabledSwitchChange})}_renderFeatureEnabledToggle(){return m.tsx(y.LabeledSwitch,{checked:this.viewModel.snappingOptions.featureEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__feature-enabled-toggle`,label:this.messages.featureToFeature,onChange:this._featureEnabledSwitchChange})}_renderGridEnabledToggle(){return m.tsx(y.LabeledSwitch,{checked:this.viewModel.snappingOptions.gridEnabled,disabled:this._secondaryElementsDisabled,key:`${this.id}__grid-enabled-toggle`,label:this.messages.grid,onChange:this._gridEnabledSwitchChange})}_renderLayerList(){if(!this.visibleElements.layerList)return null;const{messages:e,viewModel:t}=this,o=t.layerListViewModel.operationalItems.length>9?m.tsx("calcite-input",{class:M.layerListFilter,clearable:!0,placeholder:e?.searchLayers,onCalciteInputInput:({currentTarget:{value:e}})=>{this._layerListFilter=""===e?null:new RegExp(e,"i")}}):null,r=this._secondaryElementsDisabled,i=this.layerListOpen&&!r,n=t.layerListViewModel.operationalItems?.find(e=>!!e.children.length);return m.tsx("calcite-block",{class:M.layerListBlock,collapsible:!0,disabled:this._secondaryElementsDisabled,expanded:i,heading:e.snappingLayers,key:"list-block",onCalciteBlockToggle:e=>this.layerListOpen=e.currentTarget.expanded},o,this._renderToggleLayersButton(),m.tsx("calcite-list",{class:M.layerList,displayMode:n?"nested":"flat",label:e?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(t.layerListViewModel.operationalItems)))}_renderGridOptions(){const{view:e,visibleElements:t,snappingManager:o,snappingOptions:r,_openAndReady:i}=this,{gridEnabled:n,enabled:s}=r;(i||"2d"===e?.type&&e.grid)&&this._startLoadGrid();const a=this._gridLoadTask?.value,l=a&&"2d"===e?.type&&m.tsx(a,{snappingManager:o,snappingOptions:r,view:e,visibleElements:t.gridControlsElements});return m.tsx("calcite-block",{class:M.layerListBlock,collapsible:!0,disabled:!n||!s,expanded:i,heading:this.messages.gridOptionsHeading,key:"grid-block",onCalciteBlockClose:()=>this.gridOptionsOpen=!1,onCalciteBlockOpen:()=>this.gridOptionsOpen=!0},l??m.tsx("calcite-loader",{label:this.messagesCommon.loading,scale:"s",text:this.messagesCommon.loading}))}_startLoadGrid(){!this._gridLoadTask&&this.visibleElements.gridControls&&"2d"===this.view?.type&&(this._gridLoadTask=r.createTask(async()=>(await new Promise((t,o)=>e(["./GridControls"],e=>t(w(e)),o))).default))}_renderLayerListItemCollection(e){const t=this._layerListFilter;return e.map(e=>{switch(t?_.itemTitleMatchesFilter(e,t):null){case"children":{const o=e.children.filter(e=>!1!==_.itemTitleMatchesFilter(e,t));return this._renderLayerListItemGroup(e,o)}case"self":case null:return this._renderLayerListItemOrGroup(e);case!1:return"self"===_.itemTitleMatchesFilter(e.parent,t)?this._renderLayerListItemOrGroup(e):null}}).toArray().filter(o.isSome)}_renderToggleLayersButton(){if(!this.visibleElements.layerListToggleLayersButton)return null;const{viewModel:{allLayersEnabled:e},messages:t}=this,o=e?t.disableAllLayers:t.enableAllLayers;return m.tsx("calcite-button",{appearance:"transparent",class:M.layerListButton,label:o,name:"layer-toggle",onclick:this._onToggleLayersButtonClick},o)}_renderLayerListItemOrGroup(e){if(e.children.length)return this._renderLayerListItemGroup(e);const{messages:{untitledLayer:t}}=this,o=e.title||t,r=()=>{this.viewModel.toggleSnappingForLayers([e.layer?.id],"enabled"!==e.enabled)};return m.tsx("calcite-list-item",{class:M.layerListItem,key:`${this.id}-list-item-${e.uid}`,label:o,onCalciteListItemSelect:e=>{e.stopPropagation(),r()}},m.tsx("calcite-checkbox",{checked:"enabled"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:r}))}_renderLayerListItemGroup(e,t){const{messages:o}=this,{children:r,title:i}=e,n=i||o.untitledLayer,a=i&&""!==i?i:s.generateUID(),l=!!t?.length,c=t??r,p=()=>{this.viewModel.toggleSnappingForLayers(e.childLayerIds,"enabled"!==e.enabled)},d=c?.find(e=>!!e.children.length);return m.tsx("calcite-list-item",{class:M.layerListGroup,expanded:l,key:a,label:n,onCalciteListItemSelect:e=>{e.stopPropagation(),p()}},m.tsx("calcite-checkbox",{checked:"enabled"===e.enabled,indeterminate:"indeterminate"===e.enabled,slot:"actions-start",onCalciteCheckboxChange:p}),m.tsx("calcite-list",{displayMode:d?"nested":"flat",label:o?.snappingLayers,selectionMode:"none"},this._renderLayerListItemCollection(c)))}get _enabledToggleDisabled(){const e=this.snappingOptions;return e.enabledToggled||e.forceDisabled}get _secondaryElementsDisabled(){return this._enabledToggleDisabled||!this.snappingOptions.enabled}};return t.__decorate([a.property()],T.prototype,"_defaultViewModel",void 0),t.__decorate([a.property()],T.prototype,"_layerListFilter",void 0),t.__decorate([a.property()],T.prototype,"_gridLoadTask",void 0),t.__decorate([a.property()],T.prototype,"_openAndReady",null),t.__decorate([a.property()],T.prototype,"label",null),t.__decorate([a.property({type:Boolean,nonNullable:!0})],T.prototype,"layerListOpen",void 0),t.__decorate([a.property({type:Boolean,nonNullable:!0})],T.prototype,"gridOptionsOpen",void 0),t.__decorate([a.property(),f.messageBundle("esri/widgets/support/SnappingControls/t9n/SnappingControls")],T.prototype,"messages",void 0),t.__decorate([a.property(),f.messageBundle("esri/t9n/common")],T.prototype,"messagesCommon",void 0),t.__decorate([a.property()],T.prototype,"snappingOptions",null),t.__decorate([a.property()],T.prototype,"snappingManager",void 0),t.__decorate([a.property()],T.prototype,"view",null),t.__decorate([a.property()],T.prototype,"viewModel",null),t.__decorate([a.property({type:b,nonNullable:!0})],T.prototype,"visibleElements",void 0),t.__decorate([a.property()],T.prototype,"_enabledToggleDisabled",null),t.__decorate([a.property()],T.prototype,"_secondaryElementsDisabled",null),T=t.__decorate([p.subclass("esri.widgets.support.SnappingControls")],T),T})},"esri/widgets/support/SnappingControls/SnappingControlsViewModel":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../views/interactive/snapping/FeatureSnappingLayerSource","../../../views/interactive/snapping/SnappingOptions","../../LayerList/support/layerListUtils","./SnappingLayerListViewModel"],function(e,t,o,r,i,n,s,a,l,c,p,d,u){"use strict";let h=class extends t{constructor(e){super(e),this.layerListViewModel=new u.SnappingLayerListViewModel,this.snappingOptions=new p,this.view=null}initialize(){this.addHandles([r.watch(()=>({viewModel:this.layerListViewModel,view:this.view}),({viewModel:e,view:t})=>{e.view=t},r.initial),r.watch(()=>({viewModel:this.layerListViewModel,sources:this.snappingOptions?.featureSources}),({viewModel:e,sources:t})=>{e.featureSnappingSources=t},r.initial)])}get allLayersEnabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>"enabled"===e.enabled)}get allLayersDisabled(){return(this.layerListViewModel?.selectableItems??[]).every(e=>!e.enabled)}get layersEnabledCount(){return this.layerListViewModel?.selectableItems?.filter(e=>"enabled"===e.enabled).length??0}get state(){return this.snappingOptions?"ready":"disabled"}toggleSnappingForLayers(e,t){e?.forEach(e=>t?this.enableSnappingForLayer(e):this.disableSnappingForLayer(e))}toggleSnappingForAllLayers(e){this.layerListViewModel.selectableItems.forEach(({layer:t})=>{const o=t?.id;e?this.enableSnappingForLayer(o):this.disableSnappingForLayer(o)})}enableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e)??this._makeSnappingSourceForLayer(e);t&&(t.enabled=!0)}disableSnappingForLayer(e){const t=this._findSnappingSourceForLayer(e);t&&(t.enabled=!1)}updateEnabledFeatureSources(e){for(const t of this.snappingOptions.featureSources)d.canDisplayLayer(t.layer)&&(t.enabled=e.includes(t.layer.id))}_findSnappingSourceForLayer(e){return this.snappingOptions.featureSources.find(t=>t.layer.id===e)}_makeSnappingSourceForLayer(e){const t=this.layerListViewModel.operationalItemsFlat.find(t=>t.layer?.id===e)?.layer;if(!t)throw new o("snapping-controls:layer-not-found",`cannot enable snapping for layer with id ${e} because no such layer was found in the view`);if("group"===t.type)return;const r=new c({layer:t});return this.snappingOptions.featureSources.add(r),r}};return e.__decorate([i.property()],h.prototype,"allLayersEnabled",null),e.__decorate([i.property()],h.prototype,"allLayersDisabled",null),e.__decorate([i.property({constructOnly:!0})],h.prototype,"layerListViewModel",void 0),e.__decorate([i.property()],h.prototype,"layersEnabledCount",null),e.__decorate([i.property({type:p,nonNullable:!0})],h.prototype,"snappingOptions",void 0),e.__decorate([i.property()],h.prototype,"state",null),e.__decorate([i.property()],h.prototype,"view",void 0),h=e.__decorate([l.subclass("esri.widgets.support.SnappingControls.SnappingControlsViewModel")],h),h})},"esri/widgets/LayerList/support/layerListUtils":function(){define(["exports"],function(e){"use strict";function t(e){return e?.listMode??void 0}function o(e){return null!=e&&"minScale"in e&&null!=e.minScale?e.minScale:void 0}function r(e){return null!=e&&"maxScale"in e&&null!=e.maxScale?e.maxScale:void 0}function i(e){if(e&&(!("type"in e)||"wmts"!==e.type))return"sublayers"in e?"sublayers":"layers"in e?"layers":void 0}function n(e,t){e?.sort((e,o)=>{const r="uid"in e?t.indexOf(e.uid):-1,i="uid"in o?t.indexOf(o.uid):-1;return r>i?-1:r<i?1:0})}function s(e){return null!=e&&"layer"in e&&null!=e.layer}function a(e){return e&&"capabilities"in e&&null!=e.capabilities&&"exportMap"in e.capabilities?e.capabilities.exportMap:void 0}function l(e){return e?.["data-item"]}e.areChildrenHidden=function(e){return"hide-children"===e?.listMode},e.canDisplayLayer=function(e){return"hide"!==t(e)},e.canSortSublayers=function(e){const t=(e?.layer&&s(e.layer)?e.layer.layer:void 0)??e?.layer;return!!t&&"catalog"!==t.type&&(function(e){const t=a(e);return null!=t&&"supportsDynamicLayers"in t?t.supportsDynamicLayers:void 0}(t)??!0)},e.findLayerListMode=t,e.findLayerMaxScale=r,e.findLayerMinScale=o,e.findLayerVisibilityMode=function(e){if(!e)return"inherited";const t=function(e){const t=a(e);return null!=t&&"supportsSublayerVisibility"in t?t.supportsSublayerVisibility:void 0}(s(e)?e.layer:e);return null!=t?t?"independent":"inherited":"visibilityMode"in e&&null!=e.visibilityMode?e.visibilityMode:"independent"},e.getItem=l,e.getItemLayers=function(e){const t=e?.layer;return t&&"layers"in t?t.layers:null},e.getLayerType=function(e){return e?.getAttribute("data-layer-type")},e.getNormalizedChildLayerProperty=i,e.getSingleAction=function(e){for(const t of e)for(const e of t)if("button"===e.type||"toggle"===e.type)return e},e.getStatusIcon=function({connectionStatus:e,publishing:t}){return e?"connected"===e?"beacon":"offline":t?"square":"bullet-point"},e.getVisibilityIcon=function({exclusive:e,visible:t,visibilityAppearance:o}){const r="checkbox"===o;return t?e?"circle-f":r?"check-square-f":"view-visible":e?"circle":r?"square":"view-hide"},e.isLayerOutsideScaleRange=function(e,t){if(!e||null==t||isNaN(t))return!1;const i=o(e),n=r(e),s=null!=i&&!isNaN(i)&&i>0&&t>i,a=null!=n&&!isNaN(n)&&n>0&&t<n;return s||a},e.isSublayer=s,e.listItemHasChildren=function(e){const{children:t,error:o}=e,r="incompatible"in e&&e.incompatible;return!!t?.filter(e=>!e.hidden).length&&!o&&!r},e.minDragEnabledItems=2,e.minFilterItems=10,e.removeDestroyedListItems=function(e){e?.removeMany(e.filter(e=>e?.destroyed))},e.setFilterPredicate=function(e,t){e&&(e.filterPredicate=t?e=>t(l(e)):void 0)},e.sortChildLayersToIds=function(e,t){const o=e?.layer;if(!o)return;const r=i(o);if(!r)return;let s;"layers"===r&&"layers"in o?s=o.layers:"sublayers"===r&&"sublayers"in o&&(s=o.sublayers),n(s,t)},e.sortLayersToIds=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SnappingControls/SnappingLayerListViewModel":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Collection","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../LayerList/LayerListViewModel","./snappingLayerListUtils","./SnappingListItem"],function(e,t,o,r,i,n,s,a,l,c,p){"use strict";e.SnappingLayerListViewModel=class extends l{constructor(){super(...arguments),this.featureSnappingSources=new o}get operationalItemsFlat(){return this.operationalItems.flatten(e=>e.children)}get selectableItems(){return this.operationalItemsFlat.filter(e=>!e.children?.length)}_compileList(){const e=this.view?.map?.layers;if(!e)return;const t=e.filter(c.isValidSnappingLayer);this._watchLayersListMode(t);const o=this._getViewableLayers(t);o?.length?(this._createNewItems(o),this._removeItems(o),this._sortItems(o)):this._removeAllItems()}_createListItem(e){return new p.SnappingListItem({layer:e,view:this.view,getFeatureSnappingSources:()=>this.featureSnappingSources})}},t.__decorate([r.property()],e.SnappingLayerListViewModel.prototype,"featureSnappingSources",void 0),t.__decorate([r.property()],e.SnappingLayerListViewModel.prototype,"operationalItems",void 0),t.__decorate([r.property()],e.SnappingLayerListViewModel.prototype,"operationalItemsFlat",null),t.__decorate([r.property()],e.SnappingLayerListViewModel.prototype,"selectableItems",null),e.SnappingLayerListViewModel=t.__decorate([a.subclass("esri.widgets.support.SnappingControls.SnappingLayerListViewModel")],e.SnappingLayerListViewModel),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/LayerList/LayerListViewModel":function(){define(["../../chunks/tslib.es6","../../core/Collection","../../core/Evented","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../linkChart/utils","./ListItem","./support/layerListUtils"],function(e,t,o,r,i,n,s,a,l,c,p,d){"use strict";const u="view-layers",h="map-layers",y="layer-views",g="layer-list-mode",f=t.ofType(p);let m=class extends o.EventedAccessor{constructor(e){super(e),this.checkPublishStatusEnabled=!1,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.operationalItems=new f,this.view=null}initialize(){this.addHandles([r.watch(()=>!0===this.view?.ready,()=>this._viewHandles(),r.initial),r.watch(()=>[this.listItemCreatedFunction,this.checkPublishStatusEnabled,this.listModeDisabled],()=>this._recompileList()),r.watch(()=>c.isLinkChartView(this.view)?this.view.inGeographicLayout:null,()=>this._compileList())],"view")}destroy(){this._removeAllItems(),this.view=null}get state(){const{view:e}=this;return e?.ready?"ready":e?"loading":"disabled"}get totalItems(){return this.operationalItems.flatten(e=>e.children).length}triggerAction(e,t){e&&!e.disabled&&this.emit("trigger-action",{action:e,item:t})}moveListItem(e,t,o,r){const i=e?.layer;if(!i||"subtype-sublayer"===i.type||"sublayer"===i.type)return;const n=this.view?.map?.layers,s=t?d.getItemLayers(t):n,a=o?d.getItemLayers(o):n;if(!s||!a)return;const{operationalItems:l}=this,c=t?.children||l,p=o?.children||l,u=a.length-r;e.parent=o||null,c.remove(e),s.remove(i),p.includes(e)||p.add(e,u),a.includes(i)||a.add(i,u),this._compileList()}_createLayerViewHandles(e){this.removeHandles(y),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),y)}_createMapLayerHandles(e){this.removeHandles(h),this._compileList(),e&&this.addHandles(e.on("change",()=>this._compileList()),h)}_createListItem(e){const{view:t,listItemCreatedFunction:o,checkPublishStatusEnabled:r,listModeDisabled:i}=this;return new p({checkPublishStatusEnabled:r,listModeDisabled:i,layer:e,listItemCreatedFunction:o,view:t})}_removeAllItems(){this.operationalItems.destroyAll()}_getViewableLayers(e){return e?this.listModeDisabled?e:e.filter(e=>"hide"!==d.findLayerListMode(e)):void 0}_watchLayersListMode(e){this.removeHandles(g),e&&!this.listModeDisabled&&this.addHandles(r.watch(()=>e.filter(e=>"listMode"in e).map(e=>e.listMode).toArray(),()=>this._compileList()),g)}_compileList(){const e=this.view?.map?.layers,t=c.isLinkChartView(this.view)&&!this.view.inGeographicLayout?e?.filter(({type:e})=>"link-chart"===e):e;this._watchLayersListMode(t);const o=this._getViewableLayers(t);o?.length?(this._createNewItems(o),this._removeItems(o),this._sortItems(o)):this._removeAllItems()}_createNewItems(e){const{operationalItems:t}=this;e.forEach(e=>{t.some(t=>t.layer===e)||t.add(this._createListItem(e))})}_removeItems(e){const{operationalItems:t}=this,o=[];t.forEach(t=>{t&&e&&e.includes(t.layer)||o.push(t)}),t.destroyMany(o)}_sortItems(e){const{operationalItems:t}=this;t.sort((t,o)=>{const r=e.indexOf(t.layer),i=e.indexOf(o.layer);return r>i?-1:r<i?1:0})}_recompileList(){this._removeAllItems(),this._compileList()}_viewHandles(){const{view:e}=this;this.removeHandles([h,y,u]),e?.ready?this.addHandles([r.watch(()=>this.view?.map?.allLayers,e=>this._createMapLayerHandles(e),r.initial),r.watch(()=>this.view?.allLayerViews,e=>this._createLayerViewHandles(e),r.initial)],u):this._removeAllItems()}};return e.__decorate([i.property()],m.prototype,"checkPublishStatusEnabled",void 0),e.__decorate([i.property()],m.prototype,"listItemCreatedFunction",void 0),e.__decorate([i.property({nonNullable:!0})],m.prototype,"listModeDisabled",void 0),e.__decorate([i.property({type:f})],m.prototype,"operationalItems",void 0),e.__decorate([i.property({readOnly:!0})],m.prototype,"state",null),e.__decorate([i.property()],m.prototype,"totalItems",null),e.__decorate([i.property()],m.prototype,"view",void 0),m=e.__decorate([l.subclass("esri.widgets.LayerList.LayerListViewModel")],m),m})},"esri/linkChart/utils":function(){define(["exports"],function(e){"use strict";e.isLinkChartView=function(e){return null!=e&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/LayerList/ListItem":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/arrayUtils","../../core/Collection","../../core/Identifiable","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/get","../../support/actions/ActionBase","../../support/actions/ActionButton","../../support/actions/ActionToggle","./ListItemPanel","./support/layerListUtils"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g){"use strict";var f;const m=r.ofType({key:"type",defaultKeyValue:"button",base:d,typeMap:{button:u,toggle:h}}),v=r.ofType(m),_="layer",b="child-list-mode";let w=f=class extends(i.IdentifiableMixin(t)){constructor(e){super(e),this.actionsSections=new v,this.actionsOpen=!1,this.checkPublishStatusEnabled=!1,this.children=new(r.ofType(f)),this.childrenSortable=!0,this.hidden=!1,this.layer=null,this.listItemCreatedFunction=null,this.listModeDisabled=!1,this.open=!1,this.parent=null,this.view=null}initialize(){if(this.addHandles([n.watch(()=>[this.layer,this.layer?.listMode,this.listModeDisabled],()=>this._watchLayerProperties(this.layer),n.initial),n.watch(()=>this.checkPublishStatusEnabled,e=>this._updateChildrenPublishing(e),n.initial),n.watch(()=>this.view,e=>this._updateChildrenView(e),n.initial),n.watch(()=>this.panel,e=>this._setListItemOnPanel(e),n.initial)]),"function"==typeof this.listItemCreatedFunction){const e={item:this};this.listItemCreatedFunction.call(null,e)}}destroy(){this.panel?.destroy(),this.children.destroyAll(),this.view=null}get connectionStatus(){const{layerView:e,publishing:t}=this;if(!t&&e&&"connectionStatus"in e)return e.connectionStatus}get error(){return this.layer?.loadError}get incompatible(){const{layerView:e}=this;return!(!e||!("spatialReferenceSupported"in e)||e.spatialReferenceSupported)}get layerView(){const{layer:e,view:t}=this;if(!e||!t||"sublayer"===e.type)return null;const o="subtype-sublayer"===e.type?e.parent:e;return t.allLayerViews.find(e=>e.layer===o)??null}set panel(e){const t=this._get("panel");e!==t&&e&&t?.destroy(),this._set("panel",e)}castPanel(e){return this.panel?.open&&!e.hasOwnProperty("open")&&(e.open=!0),e?new y(e):null}get sortable(){return"knowledge-graph-sublayer"!==this.layer?.type&&this._get("sortable")}set sortable(e){this._set("sortable",e)}get title(){const e=p.get(this,"layer.layer");return(!e||e&&p.get(this,"layer.layer.loaded"))&&p.get(this,"layer.title")||p.get(this,"layer.attributes.title")||""}set title(e){this._override("title",e)}get publishing(){const{layer:e,checkPublishStatusEnabled:t}=this;return!!(t&&e&&"publishingInfo"in e&&"publishing"===e.publishingInfo?.status)}get updating(){const{layerView:e,connectionStatus:t,layer:o,publishing:r}=this;return!r&&!t&&(e?e.updating:"loading"===o?.loadStatus||!1)}get visible(){return!!this.layer?.visible}set visible(e){const t=this.layer;t&&(t.visible=e)}get visibleAtCurrentScale(){return this.layerView?.visibleAtCurrentScale??!g.isLayerOutsideScaleRange(this.layer,this.view?.scale)}get visibleAtCurrentTimeExtent(){return this.layerView?.visibleAtCurrentTimeExtent??!0}get visibilityMode(){return g.findLayerVisibilityMode(this.layer)}clone(){return new f({actionsSections:this.actionsSections.clone(),actionsOpen:this.actionsOpen,checkPublishStatusEnabled:this.checkPublishStatusEnabled,children:this.children.clone(),childrenSortable:this.childrenSortable,hidden:this.hidden,layer:this.layer,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,open:this.open,panel:this.panel,parent:this.parent,sortable:this.sortable,title:this.title,view:this.view,visible:this.visible})}_setListItemOnPanel(e){e&&(e.listItem=this)}_updateChildrenPublishing(e){this.children?.forEach(t=>t.checkPublishStatusEnabled=e)}_updateChildrenView(e){const t=this.children;t&&t.forEach(t=>t.view=e)}_createChildren(e){const{listModeDisabled:t,children:o}=this,r=e.filter(e=>!o.some(t=>t.layer===e));o.addMany(this._createChildItems(r,t))}_destroyChildren(e){const{children:t}=this,o=t.filter(t=>!!t.layer&&!e.includes(t.layer));t.destroyMany(o)}_sortChildren(e){this.children.sort((t,o)=>e.indexOf(o.layer)-e.indexOf(t.layer))}_destroyAllChildren(){this.removeHandles(b),this.children.destroyAll()}_watchChildLayerListMode(e){this.removeHandles(b),this.listModeDisabled||this.addHandles(e.toArray().map(t=>n.watch(()=>t.listMode,()=>this._compileChildren(e))),b)}_compileChildren(e){const t=this.listModeDisabled?e:e?.filter(e=>"hide"!==g.findLayerListMode(e));e?.length?(this._createChildren(t),this._destroyChildren(t),this._sortChildren(t),this._watchChildLayerListMode(e)):this._destroyAllChildren()}_watchSublayerChanges(e){e&&this.addHandles(e.on("change",()=>this._compileChildren(e)),_)}_initializeChildLayers(e){this._compileChildren(e),this._watchSublayerChanges(e)}_createChildItems(e,t){return e.reverse().map(e=>t||g.canDisplayLayer(e)?new f({layer:e,checkPublishStatusEnabled:this.checkPublishStatusEnabled,listItemCreatedFunction:this.listItemCreatedFunction,listModeDisabled:this.listModeDisabled,parent:this,view:this.view}):null).filter(o.isSome)}_watchLayerProperties(e){if(this.removeHandles(_),this.removeHandles(b),!e)return;if("hide-children"===(!this.listModeDisabled&&g.findLayerListMode(e)))return void this.children.destroyAll();const t=g.getNormalizedChildLayerProperty(e);t&&this.addHandles(n.watch(()=>e[t],o=>{e.hasOwnProperty(t)&&this._initializeChildLayers(o)},n.initial),_)}};return e.__decorate([s.property({type:v})],w.prototype,"actionsSections",void 0),e.__decorate([s.property()],w.prototype,"actionsOpen",void 0),e.__decorate([s.property()],w.prototype,"checkPublishStatusEnabled",void 0),e.__decorate([s.property({type:r.ofType(w)})],w.prototype,"children",void 0),e.__decorate([s.property()],w.prototype,"childrenSortable",void 0),e.__decorate([s.property({readOnly:!0})],w.prototype,"connectionStatus",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"error",null),e.__decorate([s.property()],w.prototype,"hidden",void 0),e.__decorate([s.property({readOnly:!0})],w.prototype,"incompatible",null),e.__decorate([s.property()],w.prototype,"layer",void 0),e.__decorate([s.property({readOnly:!0})],w.prototype,"layerView",null),e.__decorate([s.property()],w.prototype,"listItemCreatedFunction",void 0),e.__decorate([s.property({nonNullable:!0})],w.prototype,"listModeDisabled",void 0),e.__decorate([s.property()],w.prototype,"open",void 0),e.__decorate([s.property({type:y})],w.prototype,"panel",null),e.__decorate([a.cast("panel")],w.prototype,"castPanel",null),e.__decorate([s.property()],w.prototype,"parent",void 0),e.__decorate([s.property({value:!0})],w.prototype,"sortable",null),e.__decorate([s.property()],w.prototype,"title",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"publishing",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"updating",null),e.__decorate([s.property()],w.prototype,"view",void 0),e.__decorate([s.property()],w.prototype,"visible",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"visibleAtCurrentScale",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"visibleAtCurrentTimeExtent",null),e.__decorate([s.property({readOnly:!0})],w.prototype,"visibilityMode",null),w=f=e.__decorate([c.subclass("esri.widgets.LayerList.ListItem")],w),w})},"esri/widgets/LayerList/ListItemPanel":function(){define(["require","../../chunks/tslib.es6","../../core/Identifiable","../../core/maybe","../../core/reactiveUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../Widget","./support/layerListUtils","../support/widget","../support/jsxFactory"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h){"use strict";const y=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));let g=class extends(o.IdentifiableMixin(p)){constructor(e,t){super(e,t),this._legend=null,this.content=null,this.flowEnabled=!1,this.image=null,this.listItem=null,this.open=!1,this.visible=!0}initialize(){this.addHandles([i.watch(()=>this._canCreateLegend,()=>this._createLegend(),i.initial),i.watch(()=>[this._legend,this._legendOptions],()=>this._updateLegend(),i.initial)])}destroy(){this._legend=r.destroyMaybe(this._legend)}get _canCreateLegend(){const{content:e,listItem:t}=this;if(!t)return!1;const o="legend";return e===o||null!=e&&!!Array.isArray(e)&&e.includes(o)}get _legendOptions(){const{listItem:e,_legendLayerInfo:t}=this,o=e?.view;return t&&o?{view:o,layerInfos:[t]}:{}}get _legendLayerInfo(){const e=this.listItem?.layer;if(!e||"subtype-sublayer"===e.type)return null;const t=d.isSublayer(e)?e:null,o=e?.parent,r=null!=o&&"type"in o&&"map-image"===o.type?t?.source:null;return r&&o?{layer:o,title:"",sublayerIds:[r.mapLayerId]}:{layer:e,title:""}}get disabled(){const{listItem:e,_legend:t,content:o}=this;return!(e&&(Array.isArray(o)&&o.length>1||!t||t.activeLayerInfos?.length&&e.visibleAtCurrentScale&&e.visible))}set disabled(e){this._overrideIfSome("disabled",e)}get icon(){const{image:e}=this,t=this._getFirstWidget();return this._get("icon")??(!e&&t?t.icon:null)}set icon(e){this._overrideIfSome("icon",e)}get title(){return this._get("title")||(this._getFirstWidget()?.label??"")}set title(e){this._override("title",e)}render(){return h.tsx("div",{class:"esri-list-item-panel"},this._renderContents())}_renderContent(e){const{_legend:t,disabled:o,open:r}=this;return e&&!o&&r?"legend"===e&&t?h.tsx("div",{key:"legend-widget"},t.render()):"string"==typeof e?h.tsx("div",{innerHTML:e,key:e}):u.isWidget(e)?h.tsx("div",{key:"content-widget"},e.render()):e instanceof HTMLElement?h.tsx("div",{afterCreate:this._attachToNode,bind:e,key:"content-element"}):null:null}_renderContents(){const{content:e,open:t}=this;return t?Array.isArray(e)?e.map(e=>this._renderContent(e)):this._renderContent(e):null}async _createLegend(){if(r.destroyMaybe(this._legend),this._legend=null,!this._canCreateLegend)return;const{default:t}=await new Promise((t,o)=>e(["../Legend"],e=>t(y(e)),o)),o=new t(this._legendOptions);this._legend=o}_attachToNode(e){e.appendChild(this)}_updateLegend(){const e=this._legend;e&&e.set(this._legendOptions)}_getWidget(e){return"legend"===e?this._legend:u.isWidget(e)?e:null}_getFirstWidget(){const{content:e}=this;return Array.isArray(e)?e.map(e=>this._getWidget(e)).find(e=>e):this._getWidget(e)}};return t.__decorate([n.property()],g.prototype,"_legend",void 0),t.__decorate([n.property()],g.prototype,"_canCreateLegend",null),t.__decorate([n.property()],g.prototype,"_legendOptions",null),t.__decorate([n.property()],g.prototype,"_legendLayerInfo",null),t.__decorate([n.property()],g.prototype,"content",void 0),t.__decorate([n.property()],g.prototype,"disabled",null),t.__decorate([n.property()],g.prototype,"flowEnabled",void 0),t.__decorate([n.property()],g.prototype,"icon",null),t.__decorate([n.property()],g.prototype,"image",void 0),t.__decorate([n.property()],g.prototype,"listItem",void 0),t.__decorate([n.property()],g.prototype,"open",void 0),t.__decorate([n.property()],g.prototype,"title",null),t.__decorate([n.property()],g.prototype,"visible",void 0),g=t.__decorate([c.subclass("esri.widgets.LayerList.ListItemPanel")],g),g})},"esri/widgets/support/SnappingControls/snappingLayerListUtils":function(){define(["exports","../../LayerList/support/layerListUtils"],function(e,t){"use strict";const o=e=>r(e)||i(e),r=e=>{if(!("type"in e))return!1;switch(e.type){case"feature":case"geojson":case"csv":case"graphics":case"wfs":case"map-notes":case"oriented-imagery":case"scene":case"building-scene":case"subtype-sublayer":return!0;default:return!1}},i=e=>{const r=t.getNormalizedChildLayerProperty(e);if(null!=r&&e.hasOwnProperty(r)&&null!=e[r])for(const t of e[r])if(o(t))return!0;return!1},n=(e,t)=>null!=t&&null!=e&&(t.test(e.title)?"self":!!e.children.some(e=>!1!==n(e,t))&&"children");e.isValidSnappingLayer=o,e.isValidSnappingLayerGroup=i,e.isValidSnappingLayerSource=r,e.itemTitleMatchesFilter=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/SnappingControls/SnappingListItem":function(){define(["exports","../../../chunks/tslib.es6","../../../core/arrayUtils","../../../core/Collection","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/accessorSupport/decorators/subclass","../../LayerList/ListItem","../../LayerList/support/layerListUtils","./snappingLayerListUtils"],function(e,t,o,r,i,n,s,a,l,c,p){"use strict";var d;e.SnappingListItem=d=class extends l{constructor(e){super(e),this.children=new r,this.parent=null}get enabled(){const{children:e}=this;if(0===e.length)return null!=this.featureSource&&this.featureSource.enabled?"enabled":"disabled";let t=!1,o=!1;for(const r of e){if("indeterminate"===r.enabled)return r.enabled;if("enabled"===r.enabled?t=!0:"disabled"===r.enabled&&(o=!0),o&&t)return"indeterminate"}return o?"disabled":"enabled"}get childLayerIds(){return this.children.toArray().flatMap(e=>[e.layer?.id,...e.childLayerIds])}get featureSource(){const{layer:e,getFeatureSnappingSources:t}=this;return t().find(t=>t.layer===e)}_initializeChildLayers(e){if(!e)return;const t=e.filter(p.isValidSnappingLayer);super._initializeChildLayers(t)}_createChildItems(e){return e.map(e=>c.canDisplayLayer(e)?new d({layer:e,parent:this,view:this.view,getFeatureSnappingSources:this.getFeatureSnappingSources}):null).filter(o.isSome).reverse()}},t.__decorate([i.property()],e.SnappingListItem.prototype,"enabled",null),t.__decorate([i.property()],e.SnappingListItem.prototype,"children",void 0),t.__decorate([i.property()],e.SnappingListItem.prototype,"childLayerIds",null),t.__decorate([i.property()],e.SnappingListItem.prototype,"featureSource",null),t.__decorate([i.property({constructOnly:!0})],e.SnappingListItem.prototype,"getFeatureSnappingSources",void 0),t.__decorate([i.property()],e.SnappingListItem.prototype,"parent",void 0),e.SnappingListItem=d=t.__decorate([a.subclass("esri.widgets.support.SnappingControls.SnappingListItem")],e.SnappingListItem),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["require","../chunks/tslib.es6","../intl","../core/arrayUtils","../core/handleUtils","../core/Logger","../core/maybe","../core/promiseUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/decorators/subclass","../views/interactive/sketch/SketchValueOptions","./Widget","./Sketch/SketchViewModel","./Sketch/VisibleElements","./Sketch/support/ResponsiveToolbar/ResponsiveToolbar","../chunks/componentsUtils","./support/SelectionToolbar","./support/SketchTooltipControls","./support/SnappingControls","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/SelectionToolbar/VisibleElements","./support/SketchTooltipControls/VisibleElements","../intl/substitute"],function(e,t,o,r,i,n,s,a,l,c,p,d,u,h,y,g,f,m,v,_,b,w,S,M,T,x,C,L){"use strict";const O="esri-sketch",k={base:O,vertical:`${O}--vertical`,docked:`${O}-bar`,floating:`${O}-pad`,chipHorizontal:`${O}__selection-count-chip--horizontal`,chipVertical:`${O}__selection-count-chip--vertical`,chipVerticalSmall:`${O}__selection-count-chip--vertical--s`,popoverWrapper:`${O}__popover-wrapper`},E={point:"pin",polyline:"line",polygon:"polygon",rectangle:"rectangle",circle:"circle",multipoint:"pins",mesh:"i3d-building",freehandPolygon:"freehand-area",freehandPolyline:"freehand"};let P=class extends h{constructor(e,t){super(e,t),this._activeCustomToolOptions=null,this._selectionToolbar=null,this._viewModelHandlesGroup=null,this.availableCreateTools=["point","polyline","polygon","rectangle","circle"],this.customToolOptions=null,this.customActions=null,this.toolbarKind="floating",this.contextualToolLocation="separate",this.groupCollapsePriorities=null,this.groupAllowCollapseOptions=null,this.messages=null,this.messagesCommon=null,this.visibleElements=new g.VisibleElements,this._defaultViewModel=null,this._calcitePopoverReferenceElement=null,this._relativeLocation="top",this._popoverOpen=!1,this._activateCreateTool=this._activateCreateTool.bind(this),this.viewModel=e?.viewModel||(this._defaultViewModel=new y({creationMode:e?.creationMode??"continuous"}))}initialize(){const{layer:e,view:t}=this,o="2d"===t?.type,r=new v({persistSelection:!1,visibleElements:new x({chip:!1,pan:!1,pointTool:!1,lassoTool:o,rectangleTool:o}),view:t,sources:e?[e]:null,scale:this.scale});this.addHandles([l.watch(()=>this.viewModel,e=>{this._viewModelHandlesGroup=s.removeMaybe(this._viewModelHandlesGroup),e&&(this._viewModelHandlesGroup=i.handlesGroup([e.on("create",()=>this.scheduleRender()),e.on("update",()=>this.scheduleRender()),e.on("delete",e=>this.emit("delete",e)),e.on("undo",()=>this.scheduleRender()),e.on("redo",()=>this.scheduleRender()),l.watch(()=>e.layer,e=>{this._selectionToolbar&&(this._selectionToolbar.sources=e?[e]:null)}),l.watch(()=>e.view,e=>{this._selectionToolbar&&(this._selectionToolbar.view=e)}),l.watch(()=>e.state,()=>this.notifyChange("state"))]))},l.syncAndInitial),l.when(()=>r.activeOperation,()=>this.viewModel.cancel()),r.on("complete",e=>this._onSelectionOperationComplete(e)),l.watch(()=>{const{view:e,visibleElements:{selectionTools:t}}=this;return{lassoTool:"3d"!==e?.type&&!!t?.["lasso-selection"],rectangleTool:"3d"!==e?.type&&!!t?.["rectangle-selection"]}},e=>{Object.assign(r.visibleElements,e)},l.syncAndInitial)]),this._selectionToolbar=r}loadDependencies(){return m.loadCalciteComponents({action:()=>new Promise((t,o)=>e(["../chunks/index12"],t,o)),chip:()=>new Promise((t,o)=>e(["../chunks/index11"],t,o)),popover:()=>new Promise((t,o)=>e(["../chunks/index57"],t,o)).then(e=>e.index)})}destroy(){this._selectionToolbar?.destroy(),this._viewModelHandlesGroup=s.removeMaybe(this._viewModelHandlesGroup)}get activeTool(){const e=this._selectionToolbar?.activeOperation;if(e)switch(e.toolName){case"lasso":return"lasso-selection";case"rectangle":return"rectangle-selection";case"default":return"custom-selection"}const t=this._effectiveAvailableCreateTools,{activeTool:o,activeCreateToolDrawMode:r}=this.viewModel;return"polygon"===o&&"freehand"===r&&t?.includes("freehandPolygon")?"freehandPolygon":"polyline"===o&&"freehand"===r&&t?.includes("freehandPolyline")?"freehandPolyline":this.viewModel.activeTool}get activeTooltip(){return this.viewModel.activeTooltip}get createGraphic(){return this.viewModel.createGraphic}get creationMode(){return this.viewModel.creationMode}set creationMode(e){this.viewModel.creationMode=e}get defaultCreateOptions(){return this.viewModel.defaultCreateOptions}set defaultCreateOptions(e){this.viewModel.defaultCreateOptions=e}get defaultUpdateOptions(){return this.viewModel.defaultUpdateOptions}set defaultUpdateOptions(e){this.viewModel.defaultUpdateOptions=e}get icon(){return"pencil"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get labelOptions(){return this.viewModel.labelOptions}set labelOptions(e){this.viewModel.labelOptions=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}set layout(e){this._set("layout",e),this._selectionToolbar&&(this._selectionToolbar.layout=e)}set scale(e){this._set("scale",e),this._selectionToolbar&&(this._selectionToolbar.scale=e)}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(e){this.viewModel.snappingOptions=e}get state(){return this._selectionToolbar?.activeOperation?"active":this.viewModel.state}get tooltipOptions(){return this.viewModel.tooltipOptions}set tooltipOptions(e){this.viewModel.tooltipOptions=e}get updateGraphics(){return this.viewModel.updateGraphics}get valueOptions(){return this.viewModel.valueOptions}set valueOptions(e){this.viewModel.valueOptions=e}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}set viewModel(e){const t=this._get("viewModel");e!==t&&(t&&t===this._defaultViewModel&&s.destroyMaybe(t),this._set("viewModel",e))}get _effectiveAvailableCreateTools(){const{availableCreateTools:e,view:t,visibleElements:o}=this,r=e?.filter(e=>!!o.createTools?.[e]);return"3d"===t?.type?r?.filter(e=>"multipoint"!==e):r}create(e,t,o){const r=o?.createOptions??t;return this._activeCustomToolOptions=o,a.ignoreAbortErrors(this.viewModel.create(e,r))}update(e,t){return a.ignoreAbortErrors(this.viewModel.update(e,t))}complete(){this.viewModel.complete()}cancel(){this._selectionToolbar?.cancel(),this.viewModel.cancel(),this._activeCustomToolOptions=null}undo(){this.viewModel.undo(),this.view?.focus()}redo(){this.viewModel.redo(),this.view?.focus()}delete(){this.viewModel.delete()}duplicate(){return this.viewModel.duplicate()}dismissFloatingElements(){this._popoverOpen=!1}render(){const{toolbarKind:e,layout:t,scale:o}=this,r=this.customActions?.filter(e=>"selection-toolbar"===e.position);return T.tsx("div",null,T.tsx("div",{classes:{[k.base]:!0,[k.floating]:"floating"===e,[k.docked]:"docked"===e,[k.vertical]:"vertical"===t}},T.tsx(f,{barStyle:e,layout:t,scale:o},this._renderSelectionSetItemGroupInline(),T.tsx("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionTools")??!0,"group-kind":"split-button",key:"selection-split-button",priority:this.groupCollapsePriorities?.get("selectionTools")??0},this._renderDefaultSelectionButton(),this._selectionToolbar?.render(),r?.map(e=>this._renderToolbarItem(e))),this._renderCreateToolActionGroup(),this._renderUndoRedoMenuItemGroup(),this._renderSettingsMenuItemGroup()),this._renderSelectionSetToolbar(),this._renderSettingsMenuPopover()))}_renderSettingsMenuPopover(){const{messagesCommon:e,snappingOptions:t,view:o,viewModel:r,visibleElements:i}=this;if(!this._calcitePopoverReferenceElement)return;const n={directionModePicker:i.directionModePicker,labelsToggle:i.labelsToggle,tooltipsToggle:i.tooltipsToggle},s="horizontal"===this.layout?"top"===this._relativeLocation?"bottom-end":"top-end":"right-end";return T.tsx("calcite-popover",{closable:!0,focusTrapDisabled:!0,heading:e.settings,label:e.settings,open:this._popoverOpen,overlayPositioning:"fixed",placement:s,referenceElement:this._calcitePopoverReferenceElement,scale:this.scale,onCalcitePopoverBeforeClose:()=>this._popoverOpen=!1,onCalcitePopoverBeforeOpen:e=>this._remeasurePopoverSizes(e.currentTarget),onCalcitePopoverClose:()=>this._refocusOnView()},T.tsx("div",{class:k.popoverWrapper},Object.values(n).includes(!0)?T.tsx(_,{sketchOptions:r.sketchOptions,viewType:o?.type,visibleElements:new C(n)}):void 0,i.snappingControls&&o&&t?T.tsx(b,{snappingManager:this.viewModel.snappingManager,snappingOptions:t,view:o,visibleElements:i.snappingControlsElements}):void 0))}_renderSelectionSetToolbar(){if("separate"!==this.contextualToolLocation)return;const e=this._renderSelectionSetItemGroup();return e?.length?T.tsx(f,{barStyle:this.toolbarKind,layout:this.layout,scale:this.scale},e):void 0}_renderSelectionSetItemGroupInline(){return"separate"===this.contextualToolLocation?[]:this._renderSelectionSetItemGroup()}_renderUndoRedoMenuItemGroup(){return T.tsx("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("undoRedo")??!0,"group-kind":"split-button",key:"undo-redo-menu",priority:this.groupCollapsePriorities?.get("undoRedo")??10,slot:"actions-end"},this._renderUndoButton(),this._renderRedoButton())}_renderSettingsMenuItemGroup(){const e=[],t=[];this.customActions?.forEach(o=>{"settings-before"===o.position?t.push(o):"settings-after"===o.position&&e.push(o)});const o=[...t.map(e=>this._renderToolbarItem(e)),this._renderSettingsMenuButton(),...e.map(e=>this._renderToolbarItem(e))].filter(r.isSome);if(o.length)return T.tsx("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("settings")??!1,"group-kind":"overflow-group",key:"settings-menu",priority:this.groupCollapsePriorities?.get("settings")??1e3,slot:"actions-end"},o)}_renderSelectionSetItemGroup(){if(!this.updateGraphics.length)return[];const e="inline-end"===this.contextualToolLocation?"actions-end":void 0,t=this.customActions?.filter(e=>"before-selection-set"===e.position),o=this.customActions?.filter(e=>"after-selection-set"===e.position),r=this.groupCollapsePriorities?.get("selectionSet")??100;return[T.tsx("div",{"group-kind":"measured-content",key:"selection-count-chip-group",priority:r,slot:e},this._renderFeatureCountChip()),T.tsx("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("selectionSet")??!1,"group-kind":"overflow-group",key:"selection-set-tool-group",priority:r,slot:e},t?.map(e=>this._renderToolbarItem(e)),this._renderDuplicateButton(),this._renderDeleteButton(),o?.map(e=>this._renderToolbarItem(e)))]}_renderDefaultSelectionButton(){if(!this.viewModel.updateOnGraphicClick)return[];const{messages:e,state:t}=this;return this._renderToolbarItem({id:"pointer-select",text:e.selectFeature,icon:"cursor",onclick:this._activateDefaultSelectTool,active:"ready"===t})}_renderCreateToolActionGroup(){const e=this._effectiveAvailableCreateTools?.flatMap(e=>this._renderBuiltInCreateToolItem(e))??[],t=this.customToolOptions?.flatMap(e=>this._renderCustomToolItem(e))??[];return T.tsx("div",{"allow-collapse":this.groupAllowCollapseOptions?.get("createTools")??!0,"group-kind":"overflow-group",key:"create-tools-group",priority:this.groupCollapsePriorities?.get("createTools")??100},e,t)}_renderBuiltInCreateToolItem(e){return this._renderToolbarItem({id:`${e}-button`,text:this.messages.draw[e],icon:E[e],onclick:()=>this._activateCreateTool(e),active:this.activeTool===e&&!this._activeCustomToolOptions})}_renderCustomToolItem(e){const{toolKey:t}=e;return this._renderToolbarItem({id:`custom-${e.toolKey}`,text:e.label,icon:e.icon,onclick:()=>this._activateCreateTool(e.toolName,null,e),active:this._activeCustomToolOptions?.toolKey===t})}_renderUndoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"undo-button",text:this.messages.undo,icon:"undo",disabled:!this.viewModel.canUndo(),onclick:this.undo,flipRTL:!0}):[]}_renderRedoButton(){return this.visibleElements.undoRedoMenu?this._renderToolbarItem({id:"redo-button",text:this.messages.redo,icon:"redo",disabled:!this.viewModel.canRedo(),onclick:this.redo,flipRTL:!0}):[]}_renderSettingsMenuButton(){return this.visibleElements.settingsMenu?this._renderToolbarItem({id:"settings-menu-action",text:this.messagesCommon.settings,icon:"gear",active:this._popoverOpen,onclick:()=>this._popoverOpen=!this._popoverOpen,afterCreate:e=>this._calcitePopoverReferenceElement=e,afterUpdate:e=>this._calcitePopoverReferenceElement=e,afterRemoved:()=>this._calcitePopoverReferenceElement=null}):[]}_renderFeatureCountChip(){if(!this.visibleElements.selectionCountLabel)return[];const{layout:e,messages:t,scale:o,id:r,updateGraphics:{length:i}}=this,n=L.substitute(t.selectedCount,{count:i}),s="s"===o?99:999,a=i>s?L.substitute(t.selectedCountTruncated,{truncated:s}):i,l="s"===o&&"vertical"===e,c=l?`${r}-selection-chip-small`:`${r}-selection-chip`;return[l?T.tsx("span",{classes:{[k.chipVertical]:!0,[k.chipVerticalSmall]:"s"===this.scale},id:c,tabIndex:0,title:n},a):T.tsx("calcite-chip",{appearance:"outline",class:"horizontal"===e?k.chipHorizontal:k.chipVertical,id:c,kind:"brand",label:n,scale:"l"===o?"m":"s",tabIndex:0,title:"vertical"===e?n:void 0},"vertical"===e?a:n)]}_renderDuplicateButton(){if(!this.visibleElements.duplicateButton)return[];const{messages:e}=this;return this._renderToolbarItem({id:"duplicate",text:this.updateGraphics.length>1?e.duplicateFeatures:e.duplicateFeature,icon:"copy",onclick:this._onDuplicateSelect})}_renderDeleteButton(){if(!this.visibleElements.deleteButton)return[];const{messages:e}=this,t=this.updateGraphics.length>1?e.deleteFeatures:e.deleteFeature;return this._renderToolbarItem({id:"delete",text:t,icon:"trash",onclick:this.delete})}_renderToolbarItem({id:e,text:t,icon:o,disabled:r,onclick:i,active:n,flipRTL:s,afterCreate:a,afterUpdate:l,afterRemoved:c}){const p=`${this.id}-${e}`;return[T.tsx("calcite-action",{active:n,afterCreate:a,afterRemoved:c,afterUpdate:l,bind:this,"data-testid":e,disabled:r||"disabled"===this.state,icon:o,iconFlipRtl:s??!1,id:p,key:e,onclick:i,scale:this.scale,text:t,title:t})]}_remeasurePopoverSizes(e){try{const t=e.parentElement,o=this?.view?.container?.getBoundingClientRect(),r=t?.style;if(!(t&&o&&r&&this.view?.container?.contains(t)))return;const i=this._calcitePopoverReferenceElement;if(!i)return;const{bottom:n,top:s}=i.getBoundingClientRect();if("horizontal"===this.layout){const e=n<o.height/2;e!==("top"===this._relativeLocation)&&(this._relativeLocation=e?"top":"bottom"),e?(r?.setProperty("--sketch-view-height-offset",n-o.top+"px"),r?.setProperty("--sketch-view-margin-offset","30px")):(r?.setProperty("--sketch-view-height-offset",o.bottom-s+"px"),r?.setProperty("--sketch-view-margin-offset","15px"))}else"vertical"===this.layout&&(r.setProperty("--sketch-view-height-offset","15px"),r.setProperty("--sketch-view-margin-offset","15px"));const a=e.shadowRoot?.querySelector("div.header")?.getBoundingClientRect().height;r.setProperty("--sketch-popover-header-offset",`${a}px`)}catch(e){n.getLogger(this.declaredClass).warnOnce("Sketch failed to lay out settings menu.",e)}}_activateCreateTool(e,t,o){const r=this._activeCustomToolOptions;if(o||r){if(o?.toolKey===r?.toolKey)return void this.cancel()}else if(this.activeTool===e)return void this.cancel();this._selectionToolbar?.cancel(),this.create(e,t,o)}_onDuplicateSelect(){const e=this.duplicate(),t=this.viewModel.activeTool;"transform"!==t&&"reshape"!==t||this.update(e,{tool:t})}_onSelectionOperationComplete(e){const{viewModel:{defaultUpdateOptions:t}}=this,{selection:o}=e;if(!e.aborted&&o.length){const e=t.tool,r=o.length>1&&"reshape"===e?"transform":e;this.update(o,{...t,tool:r})}this.notifyChange("state")}_activateDefaultSelectTool(){this.cancel(),this.view?.focus()}_refocusOnView(){this.activeTool&&this.view?.focus()}};return t.__decorate([c.property()],P.prototype,"_activeCustomToolOptions",void 0),t.__decorate([c.property()],P.prototype,"activeTool",null),t.__decorate([c.property({readOnly:!0})],P.prototype,"activeTooltip",null),t.__decorate([c.property({cast:e=>{if(!e?.length)return null;const t=new Set(["point","polyline","polygon","rectangle","circle","multipoint","freehandPolyline","freehandPolygon","mesh"]);return e.filter(e=>t.has(e))}})],P.prototype,"availableCreateTools",void 0),t.__decorate([c.property({readOnly:!0})],P.prototype,"createGraphic",null),t.__decorate([c.property()],P.prototype,"creationMode",null),t.__decorate([c.property()],P.prototype,"customToolOptions",void 0),t.__decorate([c.property()],P.prototype,"customActions",void 0),t.__decorate([c.property()],P.prototype,"defaultCreateOptions",null),t.__decorate([c.property()],P.prototype,"defaultUpdateOptions",null),t.__decorate([c.property()],P.prototype,"icon",null),t.__decorate([c.property()],P.prototype,"label",null),t.__decorate([c.property()],P.prototype,"labelOptions",null),t.__decorate([c.property()],P.prototype,"layer",null),t.__decorate([c.property({type:["horizontal","vertical"],value:"horizontal"})],P.prototype,"layout",null),t.__decorate([c.property({value:"m"})],P.prototype,"scale",null),t.__decorate([c.property()],P.prototype,"toolbarKind",void 0),t.__decorate([c.property()],P.prototype,"contextualToolLocation",void 0),t.__decorate([c.property()],P.prototype,"groupCollapsePriorities",void 0),t.__decorate([c.property()],P.prototype,"groupAllowCollapseOptions",void 0),t.__decorate([c.property(),S.messageBundle("esri/widgets/Sketch/t9n/Sketch")],P.prototype,"messages",void 0),t.__decorate([c.property(),S.messageBundle("esri/t9n/common")],P.prototype,"messagesCommon",void 0),t.__decorate([c.property()],P.prototype,"snappingOptions",null),t.__decorate([c.property()],P.prototype,"state",null),t.__decorate([c.property()],P.prototype,"tooltipOptions",null),t.__decorate([c.property({readOnly:!0})],P.prototype,"updateGraphics",null),t.__decorate([c.property({type:u,nonNullable:!0})],P.prototype,"valueOptions",null),t.__decorate([c.property()],P.prototype,"view",null),t.__decorate([c.property({type:y}),M.vmEvent(["create","update","undo","redo"])],P.prototype,"viewModel",null),t.__decorate([c.property({type:g.VisibleElements,nonNullable:!0})],P.prototype,"visibleElements",void 0),t.__decorate([c.property()],P.prototype,"_effectiveAvailableCreateTools",null),t.__decorate([c.property()],P.prototype,"_defaultViewModel",void 0),t.__decorate([c.property()],P.prototype,"_calcitePopoverReferenceElement",void 0),t.__decorate([c.property()],P.prototype,"_relativeLocation",void 0),t.__decorate([c.property()],P.prototype,"_popoverOpen",void 0),P=t.__decorate([d.subclass("esri.widgets.Sketch")],P),P});