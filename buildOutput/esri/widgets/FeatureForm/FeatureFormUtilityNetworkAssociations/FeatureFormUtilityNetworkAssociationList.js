// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../../../chunks/tslib.es6","../../../intl","../../../core/string","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../UtilityNetworkAssociationInput","./AssociationDetails","./VisibleElements","../../../chunks/componentsUtils","../../support/globalCss","../../support/Heading","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/jsxFactory","../../support/UtilityNetworkAssociations/FeatureUtilityNetworkAssociationsViewModel","../../support/UtilityNetworkAssociations/UtilityNetworkAssociationList","../../support/UtilityNetworkAssociations/utils/formatPercentAlong","../../support/UtilityNetworkAssociations/utils/isConnectivity","../../support/UtilityNetworkAssociations/utils/isConnectivityMidspan","../../../intl/substitute"],function(e,t,s,i,o,r,a,n,c,l,d,u,p,h,y,m,g,_,F,v,A,L,f,x){"use strict";const w="esri-feature-form-utility-network-association-list",b={base:w,header:`${w}__header`,headingContent:`${w}__heading-content`,listContainer:`${w}__list-container`};let k=class extends v{constructor(e,t){super(e,t),this._isLoadingSelectFeature=!1,this.associationInput=null,this.headingLevel=5,this.messagesFeatureForm=null,this.onSelectLayer=()=>{},this.onSelectFeature=async()=>{},this.onAddAssociation=()=>{},this.viewModel=new F,this.visibleElements=new u}initialize(){this.setUpObserver()}loadDependencies(){return p.loadCalciteComponents({chip:()=>new Promise((t,s)=>e(["../../../chunks/index11"],t,s)),fab:()=>new Promise((t,s)=>e(["../../../chunks/index38"],t,s)),icon:()=>new Promise((t,s)=>e(["../../../chunks/index7"],t,s)),list:()=>new Promise((t,s)=>e(["../../../chunks/index16"],t,s)),"list-item":()=>new Promise((t,s)=>e(["../../../chunks/index20"],t,s)),tooltip:()=>new Promise((t,s)=>e(["../../../chunks/index17"],t,s))})}get associatedFeatureCount(){const{associationInput:e}=this;if(!e)return 0;const{associatedFeatureInfos:t,associatedLayer:s}=e,i=s?t.get(s):null;return i?i.length:0}render(){const{associationInput:e}=this;if(!e)return _.tsx("div",{class:this.classes(b.base,h.globalCss.widget)});const{associatedLayer:t}=e,{state:s}=this.viewModel;return _.tsx("div",{class:this.classes(b.base,h.globalCss.widget)},"loading"===s||"querying"===s?this.renderLoading():t?this._renderFeatureList(e,t):this._renderLayerList(e))}_renderLayerList(e){const{associatedFeatureInfos:t,editable:s}=e;return _.tsx("div",{class:b.listContainer},_.tsx("calcite-list",{label:this.messagesFeatureForm?.associations.associatedLayers},Array.from(t.keys(),t=>this._renderLayerItem(e,t))),s?_.tsx("calcite-fab",{appearance:"outline-fill",icon:"plus",key:`${e.uid}-add-button`,kind:"neutral",onclick:()=>this.onAddAssociation({feature:e.feature,associationType:e.activeAssociationType,utilityNetwork:e.utilityNetwork}),text:this.messagesCommon.add,textEnabled:!0}):null)}_renderFeatureList(e,t){return _.tsx(_.tsxFragment,null,this._renderHeader(e,t),_.tsx("div",{class:b.listContainer},this.renderFeatureCountWarning(),_.tsx("calcite-list",{label:this.messagesFeatureForm?.associations.associatedFeatures},this._renderAssociatedFeatureListPage(e,t),this.renderFeatureObserver())))}_renderLayerTitle(e){return e.title?_.tsx(y.Heading,{key:"title",level:this.headingLevel},_.tsx("div",{class:b.headingContent},_.tsx("calcite-icon",{icon:"layer"}),e.title)):null}_renderTotal(e,t){const{messagesFeature:s}=this,{associatedFeatureInfos:i}=e,o=i.get(t),r=x.substitute(s?.numberRecords,{number:o?.length??"0"});return _.tsx("div",{key:t.id},r)}_renderHeader(e,t){const{messagesFeatureForm:s}=this,{activeAssociationType:i,featureItem:o,feature:r}=e;return _.tsx("div",{class:b.header,key:"filter"},this.visibleElements.associationDetails?_.tsx(d.AssociationDetails,{associationType:i?.type,feature:r,heading:o?.label,messages:s.associations}):void 0,this._renderLayerTitle(t),this.renderFilter(),this._renderTotal(e,t))}_renderAssociatedFeatureListPage(e,t){const{filterText:s,endIndex:i}=this,o=e.associatedFeatureInfos.get(t)?.filter(e=>e.title?.toLowerCase().includes(s)??!1).slice(0,i).toArray()??[];return[...this._renderTooltips(o),...this._renderAssociatedFeatureList(o)]}_renderItemTooltip(e){const{tooltipReferenceMap:t}=this,s=e.feature.uid.toString();return L.isConnectivity(e.association)?_.tsx("calcite-tooltip",{key:`tooltip-${s}`,overlayPositioning:"fixed",referenceElement:t.get(s)},this.getConnectivityTooltip(e.association.associationType)):null}_renderAssociatedFeature(e){const t=this.messagesCommon.untitled,s=e.title||t,o=e.feature.uid.toString();return _.tsx("calcite-list-item",{description:i.stripHTML(e.terminalName??""),key:`associated-feature-type-${o}`,label:i.stripHTML(s),onCalciteListItemSelect:()=>this._selectAssociation(e)},L.isConnectivity(e.association)?this.renderConnectivityIcon(e.association.associationType,o):null,f.isConnectivityMidspan(e.association)?_.tsx("calcite-chip",{label:A.formatPercentAlong(e.association),scale:"s",slot:"content-end"},A.formatPercentAlong(e.association)):null,_.tsx("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderTooltips(e){return e.map(e=>this._renderItemTooltip(e))}_renderAssociatedFeatureList(e){return e.map(e=>this._renderAssociatedFeature(e))}_renderLayerItem(e,t){const{associatedFeatureInfos:s}=e,i=s.get(t)?.length??0;return _.tsx("calcite-list-item",{expanded:!0,key:`${t.id}-show-all`,label:t.title??this.messagesCommon.untitled,value:t.id,onCalciteListItemSelect:()=>this._showAllAssociations(t)},_.tsx("calcite-chip",{label:i.toString(),scale:"s",slot:"content-end"},i),_.tsx("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}async _selectAssociation(e){this._isLoadingSelectFeature||(this._isLoadingSelectFeature=!0,await this.onSelectFeature({feature:e.feature,association:e.association}),this._isLoadingSelectFeature=!1)}_showAllAssociations(e){this.onSelectLayer({layer:e,associationInput:this.associationInput})}};return t.__decorate([o.property()],k.prototype,"associatedFeatureCount",null),t.__decorate([o.property({type:l})],k.prototype,"associationInput",void 0),t.__decorate([o.property()],k.prototype,"headingLevel",void 0),t.__decorate([o.property(),g.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],k.prototype,"messagesFeatureForm",void 0),t.__decorate([o.property({constructOnly:!0})],k.prototype,"onSelectLayer",void 0),t.__decorate([o.property({constructOnly:!0})],k.prototype,"onSelectFeature",void 0),t.__decorate([o.property({constructOnly:!0})],k.prototype,"onAddAssociation",void 0),t.__decorate([o.property({type:F})],k.prototype,"viewModel",void 0),t.__decorate([o.property({type:u,nonNullable:!0})],k.prototype,"visibleElements",void 0),k=t.__decorate([c.subclass("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.FeatureFormUtilityNetworkAssociationList")],k),k});