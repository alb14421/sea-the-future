// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../Widget","../../../chunks/componentsUtils","../../support/globalCss","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/jsxFactory","../../support/UtilityNetworkAssociations/utils/getAssociationTitle","../../support/UtilityNetworkAssociations/utils/isFromElement"],function(e,t,o,n,i,s,r,a,c,l,d,u,p,m,g){"use strict";const y="esri-feature-form-utility-network-association-settings",h={base:y,infoContainer:`${y}__info-container`};let b=class extends a{constructor(e,t){super(e,t),this.percentAlong=50,this.headingLevel=5,this.messagesFeature=null,this.messagesCommon=null,this.messagesFeatureForm=null,this.readOnly=!1,this.sourceFeature=null,this.targetFeature=null,this.utilityNetwork=null}loadDependencies(){return c.loadCalciteComponents({block:()=>new Promise((t,o)=>e(["../../../chunks/index13"],t,o)),combobox:()=>new Promise((t,o)=>e(["../../../chunks/index21"],t,o)),"combobox-item":()=>new Promise((t,o)=>e(["../../../chunks/index22"],t,o)),"input-number":()=>new Promise((t,o)=>e(["../../../chunks/index28"],t,o)),label:()=>new Promise((t,o)=>e(["../../../chunks/index5"],t,o)),switch:()=>new Promise((t,o)=>e(["../../../chunks/index33"],t,o))})}get association(){return this._get("association")}set association(e){this.percentAlong=e.percentAlong?100*e.percentAlong:50,this._set("association",e)}get associationType(){return this.association.associationType}set associationType(e){this.association.associationType=e,"junction-edge-to-connectivity"!==e&&"junction-edge-from-connectivity"!==e||(this.association.percentAlong=void 0)}render(){return p.tsx("div",{class:this.classes(h.base,l.globalCss.widget)},this._renderFromAssociationEndpoint(),this._renderToAssociationEndpoint(),this._renderAdditionalContent())}_renderFromAssociationEndpoint(){const{associationType:e,association:t,sourceFeature:o,targetFeature:n,messagesFeatureForm:i}=this,s=g.isFromElement(o.feature,t)?o:n,r=s.label,a=m.getAssociationTitle(t,"from",i.associations);switch(e){case"connectivity":case"junction-junction-connectivity":case"junction-edge-midspan-connectivity":case"junction-edge-from-connectivity":case"junction-edge-to-connectivity":return this._renderAssociationEndpoint(r,a,this._renderConnectivityContent(s.feature,t.fromNetworkElement))}return this._renderAssociationEndpoint(r,a)}_renderToAssociationEndpoint(){const{associationType:e,association:t,sourceFeature:o,targetFeature:n,messagesFeatureForm:i}=this,s=g.isFromElement(o.feature,t)?n:o,r=s.label,a=m.getAssociationTitle(t,"to",i.associations);let c;switch(e){case"connectivity":case"junction-junction-connectivity":c=this._renderConnectivityContent(s.feature,t.toNetworkElement);break;case"containment":c=this._isNonspatial(s.feature)?null:this._renderContainmentContent()}return this._renderAssociationEndpoint(r,a,c)}_renderAssociationEndpoint(e,t,o){return p.tsx("calcite-block",{description:t,expanded:!0,heading:e},o)}_renderContainmentContent(){const{messagesFeatureForm:e,association:t}=this,o=t.isContentVisible??!1;return p.tsx("calcite-label",{layout:"inline"},e.associations.visible,p.tsx("calcite-switch",{checked:o,onCalciteSwitchChange:({currentTarget:e})=>{t.isContentVisible=e.checked}}))}_renderConnectivityContent(e,t){const{messagesFeatureForm:o,utilityNetwork:n}=this,i=n.getTerminalConfiguration(e),s=i?.terminals.map(e=>this._renderComboboxListItemNumber(e.id,t.terminalId,e.name))||[];return p.tsx("calcite-label",null,o.associations.terminal,p.tsx("calcite-combobox",{allowCustomValues:!1,clearDisabled:!0,label:o.associations.terminalComboboxLabel,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:e})=>{t.terminalId=parseInt(e.value,10)}},...s))}_renderAdditionalContent(){const{associationType:e}=this;switch(e){case"connectivity":case"junction-junction-connectivity":case"attachment":case"containment":return}const t="junction-edge-midspan-connectivity"===e?e:"junction-edge-from-connectivity",{messagesFeatureForm:o}=this,n=[this._renderComboboxListItemString("junction-edge-midspan-connectivity",t,o.associations.midspanEdge),this._renderComboboxListItemString("junction-edge-from-connectivity",t,o.associations.endpointEdge)];return p.tsx("div",{class:h.infoContainer},p.tsx("calcite-label",{key:"additional-content"},o.associations.connectTo,p.tsx("calcite-combobox",{allowCustomValues:!1,clearDisabled:!0,label:o.associations.edgeConnectionComboboxLabel,overlayPositioning:"fixed",selectionMode:"single",onCalciteComboboxChange:({currentTarget:e})=>{this.associationType=e.value}},...n)),"junction-edge-midspan-connectivity"===t?this._renderMidspanEdgeContent():this._renderEndpointEdgeContent())}_renderMidspanEdgeContent(){const{messagesFeatureForm:e,percentAlong:t,association:o}=this;return o.percentAlong=t/100,p.tsx("calcite-label",{key:"midspan-edge"},e.associations.midspanLocation,p.tsx("calcite-input-number",{max:100,min:0,numberButtonType:"vertical",suffixText:"%",value:`${t}`,onCalciteInputNumberInput:({currentTarget:e})=>{this.percentAlong=parseFloat(e.value)}}))}_renderEndpointEdgeContent(){const{associationType:e,messagesFeatureForm:t}=this,o="junction-edge-to-connectivity"===e;return p.tsx("calcite-label",{key:"endpoint-edge"},t.associations.edgeSide,p.tsx("calcite-label",{layout:"inline"},t.associations.fromSide,p.tsx("calcite-switch",{checked:o,onCalciteSwitchChange:({currentTarget:e})=>{const t=e.checked?"junction-edge-to-connectivity":"junction-edge-from-connectivity";this.associationType=t}}),t.associations.toSide))}_renderComboboxListItemNumber(e,t,o){return p.tsx("calcite-combobox-item",{heading:o,key:`#${e}`,selected:t===e,value:`${e}`})}_renderComboboxListItemString(e,t,o){return p.tsx("calcite-combobox-item",{heading:o,key:`#${e}`,selected:t===e,value:`${e}`})}_isNonspatial(e){const{sourceLayer:t}=e;return null!=t&&"geometryType"in t&&null==t.geometryType}};return t.__decorate([o.property()],b.prototype,"association",null),t.__decorate([o.property()],b.prototype,"percentAlong",void 0),t.__decorate([o.property()],b.prototype,"associationType",null),t.__decorate([o.property()],b.prototype,"headingLevel",void 0),t.__decorate([o.property(),u.messageBundle("esri/widgets/Feature/t9n/Feature")],b.prototype,"messagesFeature",void 0),t.__decorate([o.property(),u.messageBundle("esri/t9n/common")],b.prototype,"messagesCommon",void 0),t.__decorate([o.property(),u.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],b.prototype,"messagesFeatureForm",void 0),t.__decorate([o.property()],b.prototype,"readOnly",void 0),t.__decorate([o.property()],b.prototype,"sourceFeature",void 0),t.__decorate([o.property()],b.prototype,"targetFeature",void 0),t.__decorate([o.property()],b.prototype,"utilityNetwork",void 0),b=t.__decorate([r.subclass("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.UtilityNetworkAssociationSettings")],b),b});