// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../../chunks/tslib.es6","../../Graphic","../../core/compilerUtils","../../core/Evented","../../core/Logger","../../core/maybe","../../core/Promise","../../core/promiseUtils","../../core/reactiveUtils","../../core/string","../../core/accessorSupport/decorators/property","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/support/UpdatingHandles","../../form/FormTemplate","../../form/support/formUtils","../../layers/support/ContingentValue","../../layers/support/editableLayers","../../layers/support/LayerContingentValuesCache","../../time/constants","./featureFormUtils","./FieldInput","./FormExpressionsManager","./GroupInput","./RelationshipInput","./TextElementInput","../support/forms/expressions/FormExpressionArcadeExecutor"],function(e,t,n,s,i,o,r,a,l,u,p,c,d,h,f,y,m,g,_,I,v,E,x,C,F,b,V,w){"use strict";const A=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),T=new n({attributes:{}}),M={field:["editableExpression","requiredExpression","valueExpression","visibilityExpression"],group:["visibilityExpression"],relationship:["editableExpression","visibilityExpression"],text:["visibilityExpression"],utilityNetworkAssociations:["editableExpression","visibilityExpression"]},N="#JSAPI_CONTINGENT_VALUE_ANY_HASH";let k=class extends(a.EsriPromiseMixin(i.EventedAccessor)){constructor(e){super(e),this._expressionExecutorsInUse=new Set,this._expressionExecutorLookup=new Map,this._expressionsManager=null,this._contingentValuesCache=null,this._featureClone=T.clone(),this._initialFeature=T.clone(),this._timeZone=null,this._updatingHandles=new f.UpdatingHandles,this.activeAssociation=null,this.editType="NA",this.contingencyConstraintViolations=new Map,this.disabled=!1,this.highlightHelper=null,this.inputs=[],this.map=null,this.callbacks=null,this.strict=!1,this.pendingSubtypeChoice=null,this._updateInputs=l.debounce(async()=>{this._stopExpressions();const{_featureClone:e,_initialFeature:t,editType:n,formTemplate:s,inputs:i,layer:o,timeZone:r}=this;if(!o)return;const a={editType:n,feature:e,initialFeature:t,layer:o,timeZone:r},l=i.slice(),u=s?.elements&&s.elements.length>0?await this._updateInputsUsingFormElements(l,s.elements,a):this._updateInputsUsingLayerFields(l,o?.fields,a);this.inputs=u,this._startExpressions()})}initialize(){const e=u.watch(()=>[this.layer,!!this.layer?.loaded,this.formTemplate,this.feature,this.timeZone,this.editType],([e,t])=>{null!=e&&(t?this._updatingHandles.addPromise(this._updateInputs()):e.load().catch(()=>{}))},u.syncAndInitial),t=u.watch(()=>this._arcadeContextInfo,e=>{null!=this._expressionsManager&&(this._expressionsManager.arcadeContextInfo=e,this._evaluateExpressions(e=>e.evaluateAll()))}),n=u.watch(()=>this.layer,e=>{const t="subtype-sublayer"===e?.type?e.parent:"feature"===e?.type?e:null;t&&this.addResolvingPromise(I.createLoadedLayerContingentValuesCache(t).then(e=>{this._contingentValuesCache=e,this.notifyChange("fieldsWithContingentValues")}))},{initial:!0});this.addHandles([e,t,n])}destroy(){this.feature=null,this.layer=null,this._contingentValuesCache=r.destroyMaybe(this._contingentValuesCache),this.highlightHelper?.removeAll(),this._updatingHandles.destroy()}get _expressionInfosLookup(){return new Map(this.formTemplate?.expressionInfos?.map(e=>[e.name,e]))}get activeAssociationInput(){return this.allAssociationInputs.find(e=>e.uid===this.associationId)}get activeRelationshipInput(){return this.allRelationshipInputs.find(e=>e.relationshipId===this.relationshipId||e.activeCategory||e.showAllEnabled)}get _arcadeContextInfo(){const{_initialFeature:e,editType:t,layer:n,map:s,spatialReference:i,timeZone:o}=this;return{layer:_.isEditableLayer(n)?n:null,originalFeature:e,editType:t,map:s,spatialReference:i,timeZone:o}}get associationId(){return this._get("associationId")}set associationId(e){null==e&&this.activeAssociationInput?.viewModel&&(this.activeAssociationInput.associatedLayer=null,this.activeAssociationInput.viewModel.activeAssociationType=null),this._set("associationId",e)}get associatedLayer(){return this.activeAssociationInput?.associatedLayer}set associatedLayer(e){this.activeAssociationInput&&(this.activeAssociationInput.associatedLayer=e)}get allAssociationInputs(){return E.flattenAssociationInputs(this.inputs)}get allFieldInputs(){return E.flattenFieldInputs(this.inputs)}get allGroupInputs(){return this.inputs.filter(E.isGroupInput)}get allRelationshipInputs(){return E.flattenRelationshipInputs(this.inputs)}get _layerFieldsByName(){return new Map(this.layer?.fields.map(e=>[e.name,e]))}get feature(){return this._get("feature")}set feature(e){const t=this._get("feature");this._featureClone=e?e.clone():T.clone(),this._initialFeature=this._featureClone.clone(),this._expressionsManager&&(this._expressionsManager.feature=this._featureClone),e?(this._resetFieldInputValues(this._featureClone),this.allRelationshipInputs.forEach(t=>t.feature=e)):(this.inputs.forEach(e=>e.destroy()),this.inputs.length=0),t!==e&&(this.pendingSubtypeChoice=null),this.contingencyConstraintViolations.clear(),this._set("feature",e)}get fieldsWithContingentValues(){if(null==this._contingentValuesCache)return new Set;const e=this._contingentValuesCache.fieldGroups.flatMap(e=>e.fields);return new Set(e)}get formTemplate(){return this.layer&&"formTemplate"in this.layer?this.layer.formTemplate:null}set formTemplate(e){void 0===e?this._clearOverride("formTemplate"):this._override("formTemplate",e)}get formDescription(){const{formTemplate:e,layer:t}=this;return e?.description&&t?E.parseFormTemplateString({label:e.description,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formTitle(){const{formTemplate:e,layer:t}=this;return e?.title&&t?E.parseFormTemplateString({label:e.title,attributes:this.getValues(),fieldsIndex:t.fieldsIndex,timeZone:this.timeZone}):null}get formHeaderVisible(){const{activeRelationshipInput:e,activeAssociationInput:t,formDescription:n,formTitle:s}=this;return!(e||t||!n&&!s)}get joinedContingentValues(){return this._joinContingentValues()}get layer(){return this.feature?.sourceLayer&&"applyEdits"in this.feature.sourceLayer?this.feature.sourceLayer:null}set layer(e){this._override("layer",e)}get relationshipId(){return this._get("relationshipId")}set relationshipId(e){const t=this.allRelationshipInputs;if(null!=e&&e===this.relationshipId||t.forEach(e=>{e.showAllEnabled=!1,e.activeCategory=null}),null!=e){const n=t.find(t=>t.relationshipId===e);n&&(n.showAllEnabled=!0)}this._set("relationshipId",e)}get spatialReference(){return this.layer?.spatialReference??null}set spatialReference(e){this._override("spatialReference",e)}get state(){return this.layer?.loaded?"ready":"disabled"}get submittable(){return!!this.valid||this.allFieldInputs.filter(e=>!e.valid).every(({submittable:e})=>e)}get timeZone(){const{layer:e}=this;if(e&&"datesInUnknownTimezone"in e&&e.datesInUnknownTimezone)return v.utc;const t=e&&"preferredTimeZone"in e&&e.preferredTimeZone;return this._timeZone===v.unknown?t||v.utc:this._timeZone||v.system}set timeZone(e){this._timeZone=e}get updating(){return this._updatingHandles.updating}get valid(){const e=this.allFieldInputs;return e.length>0&&e.every(({valid:e})=>e)}findField(e){return this.allFieldInputs.find(t=>t.name===e)}findGroup(e){return this.allGroupInputs.find(t=>t.id===e)}getFieldValueOptionsForField(e,t){const n=this.findField(e);if(!n)return[[],[],[]];const s="coded-value"===n.domain?.type?n.domain.codedValues.map(({name:e,code:t})=>({name:e,value:t})):[],i=null==n.value||s.some(e=>e.value===n.value)?[]:[{name:`${n.value}`,value:n.value}],o=this.fieldsWithContingentValues.has(e)?this._getContingentValueOptionsForField(e,t):[];if(o.length>0){const e=new Set(o.map(e=>e.value));return[o,s.filter(t=>!e.has(t.value)),i]}return[s,[],i]}getValue(e){const t=this.layer?.getField(e);if(null!=t)return this._featureClone.getAttribute(t.name)??null}setValue(e,t){const{_featureClone:n,strict:s}=this,i=this.findField(e);t=""===t?null:t,i&&n.getAttribute(e)!==t&&(i.value=t,s&&!i.valid||(this._afterValueChange(i),this._evaluateExpressions(t=>t.evaluateInvalidated([e]))))}getValues(){return{...this._featureClone.attributes}}overrideInitialFeature(e){this._initialFeature=e}submit(){const e=this.allFieldInputs,t=new Set(e.filter(e=>e.valid).map(({name:e})=>e)),n=e.filter(e=>!e.valid).map(({name:e})=>e),s=this.getValues();if(this.validateContingencyConstraints(s,{includeIncompleteViolations:!0}).length>0)for(const[e,s]of this.contingencyConstraintViolations.entries())"error"===s.type&&(t.delete(e),n.push(e));this.notifyChange("submittable"),this.notifyChange("valid"),this.emit("submit",{valid:[...t],invalid:n,values:s})}validateContingencyConstraints(e,t){const{_contingentValuesCache:n}=this,s=new Map;if(this.contingencyConstraintViolations=s,null==n)return[];const{invalid:i,incomplete:o}=n.validateContingencyConstraints(e),r=[...i,...t?.includeIncompleteViolations?o:[]];for(const e of r)for(const t of e.fieldGroup.fields)s.set(t,e);return r}notifyFeatureGeometryChanged(){const{feature:e,_featureClone:t}=this;e&&(t.geometry=e.geometry,this._evaluateExpressions(e=>e.evaluateInvalidatedByGeometry()))}applySubtypeDefaults(e){const{defaultValues:t}=e,{allFieldInputs:n}=this;for(const{name:e}of n){const n=t[e];null!=n&&this.setValue(e,n)}}_emitChangeEvent({name:e,valid:t,value:n}){this.emit("value-change",{layer:this.layer,feature:this.feature,fieldName:e,value:n,valid:t})}_evaluateExpressions(e){const t=this._expressionsManager;null!=t&&this._updatingHandles.addPromise(e(t).finally(()=>this._afterExpressionsEvaluated()))}async _updateInputsUsingFormElements(e,t,n){const s=new Map;for(const t of e)if(E.isGroupInput(t)){s.set(t.element,t);for(const e of t.inputs)e.element&&s.set(e.element,e)}else t.element&&s.set(t.element,t);const i=new Map,o=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:s,updatedElements:t.filter(e=>this._isSupportedElement(e)),sharedInitializationProperties:n,group:null,newExpressionExecutorPromises:i});for(const[e,t]of s.entries())s.delete(e),t.destroy();return await Promise.all(Array.from(i.values())),o}async _updateInputsUsingFormElementsRecursive(e){const{existingInputsByElement:t,updatedElements:n,sharedInitializationProperties:s,group:i,newExpressionExecutorPromises:o}=e,r=[];for(const e of n){const n=t.has(e),a=n?t.get(e):m.isUtilityNetworkAssociationsElement(e)?await this._makeUtilityNetworkAssociationInputFromElement(e,s,i):this._makeInputFromElement(e,s,i);if(a){if(r.push(a),await u.whenOnce(()=>!a.updating),this._assignExpressionExecutors(a,e,o),n)if(t.delete(e),E.isGroupInput(a)){const{feature:e,timeZone:t}=s;a.set({feature:e,timeZone:t})}else if(E.isRelationshipInput(a)){const t=this.relationshipId===e.relationshipId;a.set(s),a.set({map:this.map,showAllEnabled:t})}else m.isUtilityNetworkAssociationsElement(a)?(a.set(s),a.set({map:this.map})):a.set(s);if(m.isGroupElement(e)){const n=e.elements.filter(e=>this._isSupportedElement(e));a.inputs=await this._updateInputsUsingFormElementsRecursive({existingInputsByElement:t,updatedElements:n,sharedInitializationProperties:s,group:a,newExpressionExecutorPromises:o})}}}return r}_updateInputsUsingLayerFields(e,t,n){if(!Array.isArray(t))return o.getLogger(this).warn(this.declaredClass,"No attribute fields found."),[];const s=new Map;for(const t of e)if(E.isGroupInput(t)){for(const e of t.inputs)e.destroy();t.inputs.length=0,t.destroy()}else E.isRelationshipInput(t)?t.destroy():E.isFieldInput(t)&&(null!==t.element?t.destroy():s.set(t.field,t));const i=[];for(const e of t){const t=n.feature?.getAttribute(e.name)??null,o=s.get(e)??new x({field:e,preservesValueWhenHidden:this.formTemplate?.preserveFieldValuesWhenHidden});i.push(o.set({...n,value:t})),s.delete(e)}for(const[e,t]of s.entries())s.delete(e),t.destroy();return i}_resetFieldInputValues(e){for(const t of this.allFieldInputs)t.value=e.getAttribute(t.name)??null}_makeInputFromElement(e,t,n){return m.isGroupElement(e)?function(e,t){const{feature:n,layer:s}=t;return new F({element:e,inputs:[],feature:n,layer:s})}(e,t):m.isFieldElement(e)?this._makeFieldInputFromElement(e,t,n):m.isRelationshipElement(e)?this._makeRelationshipInputFromElement(e,t,n):m.isUtilityNetworkAssociationsElement(e)?this._makeUtilityNetworkAssociationInputFromElement(e,t,n):m.isTextElement(e)?function(e,t,n=null){const{feature:s,layer:i,timeZone:o}=t;return new V({element:e,feature:s,group:n,layer:i,timeZone:o})}(e,t):m.isUtilityNetworkAssociationsElement(e)?this._makeUtilityNetworkAssociationInputFromElement(e,t,n):s.neverReached()}_makeFieldInputFromElement(e,t,n){const{editType:s,feature:i,initialFeature:o,layer:r,timeZone:a}=t,{fieldName:l}=e,u=l&&this._layerFieldsByName.get(l);return u?new x({editType:s,element:e,field:u,value:i?.getAttribute(e.fieldName)??null,feature:i,initialFeature:o,layer:r,group:n,preservesValueWhenHidden:this.formTemplate?.preserveFieldValuesWhenHidden,timeZone:a}):null}_makeRelationshipInputFromElement(e,t,n=null){const{map:s}=this,{feature:i,layer:o,timeZone:r}=t,a=new b({element:e,feature:i,group:n,layer:o,map:s,timeZone:r});return a.addHandles(u.on(()=>a.relatedLayer,"edits",()=>this._evaluateExpressions(e=>e.evaluateAsyncExpressions()))),a}async _makeUtilityNetworkAssociationInputFromElement(t,n,s=null){const{map:i}=this,{feature:o,layer:r,timeZone:a}=n;return new(0,(await new Promise((t,n)=>e(["./UtilityNetworkAssociationInput"],e=>t(A(e)),n))).default)({element:t,feature:o,group:s,layer:r,map:i,timeZone:a})}_assignExpressionExecutors(e,t,n){const s=M[t.type],i=[];for(const o of s){const s=`${o}Executor`;if(e[s]){this._useExecutor(e[s]);continue}const r=t[o];if(null!=r&&""!==r){const t=this._expressionInfosLookup.get(r)?.expression??r;i.push(this._getOrCreateExecutorForExpression(t,n).then(t=>{e[s]=this._useExecutor(t)}))}}return E.isTextElementInput(e)&&i.push(...this._assignTextElementExpressionExecutors(e,n)),i}_assignTextElementExpressionExecutors(e,t){const{_expressionInfosLookup:n}=this,s=[];for(const i of e.expressionsUsed){const r=n.get(i);null!=r?s.push(this._getOrCreateExecutorForExpression(r.expression,t).then(t=>e.setExpressionExecutor(i,this._useExecutor(t)))):o.getLogger(this).error("feature-form:expression-not-found",`Could not find expressionInfo object with name '${i}'`)}for(const n of e.fieldsUsed){const i=`return $feature['${n}'];`;s.push(this._getOrCreateExecutorForExpression(i,t).then(t=>e.setFieldExecutor(n,this._useExecutor(t))))}return s}async _getOrCreateExecutorForExpression(e,t){const{_expressionExecutorLookup:n}=this;if(n.has(e))return n.get(e);if(t.has(e))return t.get(e);const s=w.createFormExpressionArcadeExecutor(e,this.layer);t.set(e,s);const i=await s;return n.set(e,i),i}_createExpressionsManager(e){const{_arcadeContextInfo:t,_featureClone:n,allFieldInputs:s,formTemplate:i}=this;this._expressionsManager=new C.FormExpressionsManager({executors:e,feature:n,arcadeContextInfo:t,fieldInputs:s,preserveFieldValuesWhenHidden:!0===i?.preserveFieldValuesWhenHidden})}_startExpressions(){if(0===this._expressionExecutorsInUse.size)return;const e=Array.from(this._expressionExecutorsInUse);this._createExpressionsManager(e),this._evaluateExpressions(e=>e.evaluateAll())}_stopExpressions(){this._expressionsManager=r.destroyMaybe(this._expressionsManager),this._expressionExecutorsInUse.clear()}_useExecutor(e){return this._expressionExecutorsInUse.add(e),e}_afterValueChange(e){const{name:t,value:n}=e,{_featureClone:s,formTemplate:i,layer:o}=this;if(!o)return;const r=s.getAttribute(t);s.setAttribute(t,n);const{typeFieldName:a,types:l}=E.getNormalizedFeatureTypeInfo(o);if((e.isSubtypeField||t===a)&&n!==r){if("subtype-sublayer"===o.type){const e=o.parent?.findSublayerForFeature(s);e&&(this.feature&&(this.feature.sourceLayer=e),s.sourceLayer=e)}const e=new Set;for(const t of l)if(t.domains&&"object"==typeof t.domains)for(const n of Object.keys(t.domains))e.add(n);for(const t of e){const e=this.findField(t);e&&e.notifyChange("domain")}this.notifyChange("joinedContingentValues")}if(null!=i){const{description:e,title:n}=i;n&&p.templateHasKey(n,t)&&this.notifyChange("formTitle"),e&&p.templateHasKey(e,t)&&this.notifyChange("formDescription")}this._emitChangeEvent(e)}_afterExpressionsEvaluated(){const{_featureClone:e}=this;for(const t of this.allFieldInputs)t.value!==e.getAttribute(t.name)&&this._afterValueChange(t)}_joinContingentValues(){const e=this._contingentValuesCache;if(null==e)return[];const{typeFieldName:t}=E.getNormalizedFeatureTypeInfo(this.layer),n=t?this.getValue(t):null,s=[];for(const t of e.fieldGroups){const{contingencies:e,fields:i,name:o}=t,r=[];for(const t of e)t.isRetired||null!=t.subtype&&t.subtype.code!==n||r.push({values:t.values});r.length>0&&s.push({name:o,fields:i,contingencies:r})}const[i,o]=this._generateJoinPlan(s);return[...i.flatMap(e=>this._joinFieldGroupContingencies(e)),...o.flatMap(e=>e.contingencies)]}_generateJoinPlan(e){const t=new Map,n=[],s=new Set;for(const i of e)for(const e of i.fields)if(t.has(e)){const o=t.get(e),r=i,a=[o.name,r.name].sort().join("|");if(s.has(a))continue;n.push([o,r]),s.add(a),t.set(e,r)}else t.set(e,i);const i=new Set(n.flat()),o=new Set(e);for(const e of i)o.delete(e);const r=new Map,a=new Map;for(const e of new Set(n.flat())){const t=Symbol(e.name);r.set(t,new Set([e])),a.set(e,t)}for(const[e,t]of n){const n=a.get(e),s=a.get(t);if(n===s)continue;const i=r.get(n),o=r.get(s);for(const e of o)i.add(e),a.set(e,n);r.delete(s)}return[[...r.values()].map(e=>[...e]),[...o]]}_joinFieldGroupContingencies(e){const t=e.slice(),n=t.shift();let s=t.shift(),i=this._generateJoinKey(n.fields,s.fields),o=new Set([...n.fields,...s.fields]),r=new Map;for(const e of n.contingencies){const[t]=this._hashContingency(e,i.codedValueFields,!0);r.has(t)?r.get(t)?.push(e):r.set(t,[e])}for(;t.length>0;){const e=new Map,n=t.shift(),a=this._generateJoinKey(o,n.fields);for(const t of s.contingencies){const[n,s]=this._hashContingency(t,i.codedValueFields),o=s?this._findMatchingContingenciesWithAnyHashMask(r,n):r.get(n);if(r.has(N)&&o?.push(...this._findMatchingContingenciesContainingAny(t,r.get(N),i.codedValueFields)),null!=o)for(const n of o){const s=i.rangeFields.length>0?this._joinContingenciesWithRangeDomains(n,t,i.rangeFields):this._joinContingencies(n,t);if(null==s)break;const[o]=this._hashContingency(s,a.codedValueFields,!0);e.has(o)?e.get(o)?.push(s):e.set(o,[s])}}r=e,s=n,i=a,o=new Set([...o,...s.fields])}const a=[];for(const e of s.contingencies){const[t,n]=this._hashContingency(e,i.codedValueFields),s=n?this._findMatchingContingenciesWithAnyHashMask(r,t):r.get(t);if(r.has(N)&&s.push(...this._findMatchingContingenciesContainingAny(e,r.get(N),i.codedValueFields)),null!=s)for(const t of s){const n=i.rangeFields.length>0?this._joinContingenciesWithRangeDomains(t,e,i.rangeFields):this._joinContingencies(t,e);null!=n&&a.push(n)}}return a}_joinContingencies(e,t){const n={values:{...e.values,...t.values}};for(const[t,s]of Object.entries(n.values))"any"===s.objectType&&null!=e.values[t]&&(n.values[t]=e.values[t]);return n}_joinContingenciesWithRangeDomains(e,t,n){const s=this._joinContingencies(e,t);for(const i of n){const n=e.values[i],o=t.values[i],{leftIsNull:r,rightIsNull:a,bothAreNull:l,leftIsAny:u,rightIsAny:p,bothAreAny:c,leftIsRange:d,rightIsRange:h}=this._compareObjectTypes(n.objectType,o.objectType);if(l||c)continue;if(r&&p||a&&u){s.values[i]=new g({objectType:"null"});continue}if(r&&h||a&&d)return null;u?(n.minValue=-1/0,n.maxValue=1/0):p&&(o.minValue=-1/0,o.maxValue=1/0);const f=Math.max(n.minValue,o.minValue),y=Math.min(n.maxValue,o.maxValue);if(f>y)return null;s.values[i]=new g({objectType:"range",minValue:f,maxValue:y})}return s}_findMatchingContingenciesContainingAny(e,t,n){return t.filter(t=>n.every(n=>{const s=t.values[n],i=e.values[n];return"any"===s.objectType||"any"===i.objectType||s.codedValue?.code===i.codedValue?.code}))}_findMatchingContingenciesWithAnyHashMask(e,t){const n=RegExp(`${t}$`),s=[];for(const[t,i]of e){if(t===N)break;n.test(t)&&s.push(...i)}return s}_generateJoinKey(e,t){const n=Array.isArray(e)?new Set(e):e,s=Array.isArray(t)?new Set(t):t,i=n.size<s.size?n:s,o=i===n?s:n,{feature:r}=this,a=new Set,l=new Set;for(const e of i)if(o.has(e)){const t=this.layer?.getFieldDomain(e,{feature:r??void 0,excludeImpliedDomains:!0});if(null==t)continue;switch(t.type){case"coded-value":a.add(e);break;case"range":l.add(e)}}return{codedValueFields:[...a],rangeFields:[...l]}}_contingencyIsValid(e,t){const n={};for(const{name:t,value:s}of this.allFieldInputs)this.fieldsWithContingentValues.has(t)&&null!=s&&t!==e&&(n[t]=s);return Object.entries(n).every(([e,n])=>!t.values.hasOwnProperty(e)||E.valueIsValidContingentValue(n,t.values[e]))}_getContingentValueOptionsForField(e,t){const n=this.joinedContingentValues.slice(),s=new Map,i={code:"",name:t??"No value"};for(const t of n){const n=t.values[e];if("code"===n?.objectType||"null"===n?.objectType){const{code:o,name:r}=n.codedValue&&"null"!==n.objectType?n.codedValue:i;!s.has(o)&&this._contingencyIsValid(e,t)&&s.set(o,{name:r,value:o})}}return[...s.values()]}_hashContingency(e,t,n=!1){if(t.length<1)return["#JSAPI_CONTINGENT_VALUE_EMPTY_HASH",!1];const s=[];let i=!1;for(const o of t){const t=e.values[o];if("any"===t.objectType){if(n)return[N,!0];i=!0,s.push(`${o}:.*`)}else"null"===t.objectType?s.push(`${o}:#JSAPI_CONTINGENT_VALUE_NULL_HASH`):s.push(`${o}:${t.codedValue?.code}`)}return[s.sort().join("&"),i]}_compareObjectTypes(e,t){return{leftIsNull:"null"===e,rightIsNull:"null"===t,bothAreNull:"null"===e&&"null"===t,leftIsAny:"any"===e,rightIsAny:"any"===t,bothAreAny:"any"===e&&"any"===t,leftIsRange:"range"===e,rightIsRange:"range"===t}}_isSupportedElement(e){return"field"===e.type||"group"===e.type||"relationship"===e.type||"text"===e.type||"utilityNetworkAssociations"===e.type||(o.getLogger(this).warn("form-info::unsupported-element-type","Only element types 'field', 'group' and 'relationship' are supported",`Element ${e.label} has unsupported type '${e.type}'`),!1)}get test(){return{featureClone:this._featureClone}}};return t.__decorate([c.property()],k.prototype,"_expressionInfosLookup",null),t.__decorate([c.property()],k.prototype,"_featureClone",void 0),t.__decorate([c.property()],k.prototype,"_timeZone",void 0),t.__decorate([c.property()],k.prototype,"activeAssociation",void 0),t.__decorate([c.property()],k.prototype,"activeAssociationInput",null),t.__decorate([c.property()],k.prototype,"activeRelationshipInput",null),t.__decorate([c.property()],k.prototype,"_arcadeContextInfo",null),t.__decorate([c.property()],k.prototype,"associationId",null),t.__decorate([c.property()],k.prototype,"associatedLayer",null),t.__decorate([c.property()],k.prototype,"allAssociationInputs",null),t.__decorate([c.property()],k.prototype,"allFieldInputs",null),t.__decorate([c.property()],k.prototype,"allGroupInputs",null),t.__decorate([c.property()],k.prototype,"allRelationshipInputs",null),t.__decorate([c.property()],k.prototype,"_layerFieldsByName",null),t.__decorate([c.property()],k.prototype,"editType",void 0),t.__decorate([c.property()],k.prototype,"contingencyConstraintViolations",void 0),t.__decorate([c.property()],k.prototype,"disabled",void 0),t.__decorate([c.property()],k.prototype,"feature",null),t.__decorate([c.property()],k.prototype,"fieldsWithContingentValues",null),t.__decorate([c.property({type:y})],k.prototype,"formTemplate",null),t.__decorate([c.property()],k.prototype,"formDescription",null),t.__decorate([c.property()],k.prototype,"formTitle",null),t.__decorate([c.property()],k.prototype,"formHeaderVisible",null),t.__decorate([c.property()],k.prototype,"highlightHelper",void 0),t.__decorate([c.property()],k.prototype,"inputs",void 0),t.__decorate([c.property()],k.prototype,"joinedContingentValues",null),t.__decorate([c.property()],k.prototype,"layer",null),t.__decorate([c.property()],k.prototype,"map",void 0),t.__decorate([c.property()],k.prototype,"callbacks",void 0),t.__decorate([c.property()],k.prototype,"relationshipId",null),t.__decorate([c.property()],k.prototype,"spatialReference",null),t.__decorate([c.property()],k.prototype,"state",null),t.__decorate([c.property()],k.prototype,"strict",void 0),t.__decorate([c.property()],k.prototype,"submittable",null),t.__decorate([c.property()],k.prototype,"timeZone",null),t.__decorate([c.property()],k.prototype,"updating",null),t.__decorate([c.property()],k.prototype,"valid",null),t.__decorate([c.property()],k.prototype,"pendingSubtypeChoice",void 0),t.__decorate([c.property()],k.prototype,"getValues",null),t.__decorate([c.property()],k.prototype,"submit",null),t.__decorate([c.property()],k.prototype,"test",null),k=t.__decorate([h.subclass("esri.widgets.FeatureForm.FeatureFormViewModel")],k),k});