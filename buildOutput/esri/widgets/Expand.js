// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../chunks/tslib.es6","../core/handleUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Widget","./Expand/ExpandViewModel","../chunks/componentsUtils","./support/globalCss","./support/widget","./support/decorators/messageBundle","./support/jsxFactory"],function(e,t,o,n,s,r,i,l,a,d,p,c,h,_,u,g){"use strict";const v="esri-expand",y={base:v,toggle:`${v}__toggle`,popoverContent:`${v}__popover-content`,panel:`${v}__panel`,panelContent:`${v}__panel-content`,sheet:`${v}__sheet`,contentContainer:`${v}__content-container`,icon:"esri-collapse__icon",iconFlip:"esri-collapse__icon-flip",iconNumber:`${v}__icon-number`},x="chevrons-left",m="chevrons-right",w=Symbol("scheduleRender-override-handle");let C=class extends d{constructor(e,t){super(e,t),this._boundScheduledRender=this.scheduleRender.bind(this),this.closeOnEsc=!0,this.collapseTooltip="",this.content="",this.expandTooltip="",this.focusTrapDisabled=!1,this.iconNumber=0,this.messages=null,this.messagesCommon=null,this.mode="auto",this.placement=null,this.viewModel=new p,this.toggle=()=>{this.viewModel.expanded=!this.viewModel.expanded},this._handlePopoverClose=e=>{e.target===this._popoverEl&&(this.viewModel.expanded=e.currentTarget.open)},this._handleSheetClose=e=>{this.viewModel.expanded=e.currentTarget.open},this._handlePanelClose=e=>{this.viewModel.expanded=!e.currentTarget.closed},this._handleKeyDown=e=>{this.viewModel.expanded&&"Escape"===e.key&&!this._willCloseOnEsc(e)&&e.preventDefault()},this._storeToggleActionEl=e=>{this._toggleActionEl=e},this._storePopoverEl=e=>{this._popoverEl=e}}initialize(){this.addHandles(n.watch(()=>this.viewModel?.view?.size,()=>this._popoverEl?.reposition(),n.initial))}loadDependencies(){return c.loadCalciteComponents({action:()=>new Promise((t,o)=>e(["../chunks/index12"],t,o)),icon:()=>new Promise((t,o)=>e(["../chunks/index7"],t,o)),panel:()=>new Promise((t,o)=>e(["../chunks/index51"],t,o)).then(e=>e.index),popover:()=>new Promise((t,o)=>e(["../chunks/index57"],t,o)).then(e=>e.index),sheet:()=>new Promise((t,o)=>e(["../chunks/index58"],t,o))})}get expandTitle(){const{expanded:e,messagesCommon:t,collapseTooltip:o,expandTooltip:n}=this;return(e?o||t?.collapse:n||t?.expand)??""}get _displaySheet(){switch(this.mode){case"drawer":return!0;case"auto":return"xsmall"===this.viewModel.view?.widthBreakpoint;default:return!1}}get autoCollapse(){return this.viewModel.autoCollapse}set autoCollapse(e){this.viewModel.autoCollapse=e}get collapseIcon(){return m}set collapseIcon(e){this._overrideIfSome("collapseIcon",e)}get expanded(){return this.viewModel.expanded}set expanded(e){this.viewModel.expanded=e}get expandIcon(){return"object"==typeof this.content&&"icon"in this.content&&this.content.icon?this.content.icon:x}set expandIcon(e){this._overrideIfSome("expandIcon",e)}get group(){return this.viewModel.group}set group(e){this.viewModel.group=e}get icon(){return null}get label(){return"object"==typeof this.content&&"label"in this.content&&this.content.label?this.content.label:this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}expand(){this.viewModel.expanded=!0}collapse(){this.viewModel.expanded=!1}render(){const{_displaySheet:e,_toggleActionEl:t,viewModel:{expanded:o},label:n,placement:s}=this;return g.tsx("div",{class:this.classes(y.base,h.globalCss.widget)},this._renderToggle(),e?g.tsx("calcite-sheet",{class:y.sheet,heightScale:"l",label:n,onkeydown:this._handleKeyDown,open:o,position:"block-end",onCalciteSheetClose:this._handleSheetClose},g.tsx("calcite-panel",{class:y.panel,closable:!0,closed:!o,heading:n,onkeydown:this._handleKeyDown,onCalcitePanelClose:this._handlePanelClose},g.tsx("div",{class:y.panelContent},this._renderContent()))):t?g.tsx("calcite-popover",{afterCreate:this._storePopoverEl,afterUpdate:this._storePopoverEl,focusTrapDisabled:this.focusTrapDisabled,label:n,onkeydown:this._handleKeyDown,open:o,overlayPositioning:"fixed",placement:s??this._getPlacement(),referenceElement:t,onCalcitePopoverClose:this._handlePopoverClose},g.tsx("div",{class:y.popoverContent},this._renderContent())):null)}_getPlacement(){const{container:e,view:t}=this,o=e&&t?t.ui.getPosition(e):null;if(!o||"manual"===o)return"auto";const[n,s]=o.split("-");return`${"right"===s?"left":"right"}-${"bottom"===n?"end":"start"}`}_willCloseOnEsc(e){const{closeOnEsc:t}=this;return"function"==typeof t?t(e):t}_renderBadgeNumber(){const{expanded:e,iconNumber:t}=this;return t&&!e?g.tsx("span",{class:y.iconNumber,key:"expand__icon-number"},t):null}_renderToggleButton(){const{expanded:e,expandTitle:t,expandIcon:o,collapseIcon:n}=this,s=e?n:o,r=s===x||s===m;return g.tsx("calcite-action",{afterCreate:this._storeToggleActionEl,afterUpdate:this._storeToggleActionEl,class:h.globalCss.widgetButton,onclick:this.toggle,scale:"s",text:t,title:t},s?g.tsx("calcite-icon",{class:this.classes(y.icon,r&&y.iconFlip),icon:s,scale:"s"}):null)}_renderToggle(){return g.tsx("div",{class:y.toggle},this._renderToggleButton(),this._renderBadgeNumber())}_renderContent(){const{content:e}=this;return"string"==typeof e?g.tsx("div",{class:y.contentContainer,innerHTML:e,key:"content__string"}):_.isWidget(e)?g.tsx("div",{afterCreate:()=>{this._overwriteChildScheduleRender(e)},afterRemoved:()=>this.removeHandles(w),afterUpdate:()=>{e.scheduleRender!==this._boundScheduledRender&&(this.removeHandles(w),this._overwriteChildScheduleRender(e))},class:y.contentContainer,key:"content__widget"},e.render()):e instanceof HTMLElement?g.tsx("div",{afterCreate:this._attachToNode,bind:e,class:y.contentContainer,key:"content__html-element"}):_.hasDomNode(e)?g.tsx("div",{afterCreate:this._attachToNode,bind:e.domNode,class:y.contentContainer,key:"content__node"}):null}_overwriteChildScheduleRender(e){const t=e.scheduleRender;e.scheduleRender=this._boundScheduledRender,this.addHandles(o.makeHandle(()=>e.scheduleRender=t),w)}_attachToNode(e){e.appendChild(this)}};return t.__decorate([s.property({readOnly:!0})],C.prototype,"expandTitle",null),t.__decorate([s.property()],C.prototype,"_toggleActionEl",void 0),t.__decorate([s.property()],C.prototype,"_displaySheet",null),t.__decorate([s.property()],C.prototype,"autoCollapse",null),t.__decorate([s.property()],C.prototype,"closeOnEsc",void 0),t.__decorate([s.property()],C.prototype,"collapseIcon",null),t.__decorate([s.property()],C.prototype,"collapseTooltip",void 0),t.__decorate([s.property()],C.prototype,"content",void 0),t.__decorate([s.property()],C.prototype,"expanded",null),t.__decorate([s.property()],C.prototype,"expandIcon",null),t.__decorate([s.property()],C.prototype,"expandTooltip",void 0),t.__decorate([s.property()],C.prototype,"focusTrapDisabled",void 0),t.__decorate([s.property()],C.prototype,"group",null),t.__decorate([s.property()],C.prototype,"icon",null),t.__decorate([s.property()],C.prototype,"iconNumber",void 0),t.__decorate([s.property()],C.prototype,"label",null),t.__decorate([s.property(),u.messageBundle("esri/widgets/Expand/t9n/Expand")],C.prototype,"messages",void 0),t.__decorate([s.property(),u.messageBundle("esri/t9n/common")],C.prototype,"messagesCommon",void 0),t.__decorate([s.property()],C.prototype,"mode",void 0),t.__decorate([s.property()],C.prototype,"placement",void 0),t.__decorate([s.property()],C.prototype,"view",null),t.__decorate([s.property({type:p})],C.prototype,"viewModel",void 0),C=t.__decorate([a.subclass("esri.widgets.Expand")],C),C});