// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../chunks/tslib.es6","../intl","../core/has","../core/MapUtils","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","../support/guards","./Widget","./BatchAttributeForm/batchAttributeFormUtils","./BatchAttributeForm/BatchAttributeFormViewModel","./BatchAttributeForm/css","./BatchAttributeForm/VisibleElements","./BatchAttributeForm/inputs/support/inputUtils","../chunks/componentsUtils","./support/dateUtils","./support/globalCss","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","./support/forms/formUtils","../intl/substitute"],function(e,t,i,n,s,a,o,r,l,d,u,p,c,m,h,v,f,b,g,_,C,y,F,x,w,I,V){"use strict";const k="data-element-id";let M=class extends c{constructor(e,t){super(e,t),this.headingLevel=2,this.messagesCommon=null,this.messages=null,this.featureFormMessages=null,this.viewModel=new h,this.visibleElements=new f.VisibleElements,this.groupDisplay="all",this._attemptFocusOnNextRender=!1,this._dateComponentMap=new Map,this._touchedInputs=new Set,this._focusedFieldInput=null,this._batchSwitchInputInitialValues=new Map,this._saveInput=this._saveInput.bind(this),this._onFormSubmit=this._onFormSubmit.bind(this),this._onComponentFocus=this._onComponentFocus.bind(this),this._onComponentBlur=this._onComponentBlur.bind(this),this._afterComponentCreateOrUpdate=this._afterComponentCreateOrUpdate.bind(this),this._afterDateComponentCreate=this._afterDateComponentCreate.bind(this),this._afterRadioGroupCreateOrUpdate=this._afterRadioGroupCreateOrUpdate.bind(this)}initialize(){this.addHandles([a.watch(()=>this.features,()=>{this._dateComponentMap.clear()}),a.watch(()=>this.viewModel.activeForm,()=>{this._batchSwitchInputInitialValues.clear()}),a.on(()=>this.viewModel,"submit",()=>{this.valid||this.goToClosestError()})])}loadDependencies(){return g.loadCalciteComponents({input:()=>new Promise((t,i)=>e(["../chunks/index4"],t,i)),block:()=>new Promise((t,i)=>e(["../chunks/index13"],t,i)),button:()=>new Promise((t,i)=>e(["../chunks/index2"],t,i)),combobox:()=>new Promise((t,i)=>e(["../chunks/index21"],t,i)),"combobox-item":()=>new Promise((t,i)=>e(["../chunks/index22"],t,i)),"combobox-item-group":()=>new Promise((t,i)=>e(["../chunks/index23"],t,i)),dropdown:()=>new Promise((t,i)=>e(["../chunks/index24"],t,i)),"dropdown-group":()=>new Promise((t,i)=>e(["../chunks/index25"],t,i)),"dropdown-item":()=>new Promise((t,i)=>e(["../chunks/index26"],t,i)),"input-date-picker":()=>new Promise((t,i)=>e(["../chunks/index27"],t,i)),"input-number":()=>new Promise((t,i)=>e(["../chunks/index28"],t,i)),"input-time-picker":()=>new Promise((t,i)=>e(["../chunks/index29"],t,i)),"input-time-zone":()=>new Promise((t,i)=>e(["../chunks/index30"],t,i)),label:()=>new Promise((t,i)=>e(["../chunks/index5"],t,i)),"input-message":()=>new Promise((t,i)=>e(["../chunks/index31"],t,i)),loader:()=>new Promise((t,i)=>e(["../chunks/index32"],t,i)),notice:()=>new Promise((t,i)=>e(["../chunks/index6"],t,i)),switch:()=>new Promise((t,i)=>e(["../chunks/index33"],t,i)),"text-area":()=>new Promise((t,i)=>e(["../chunks/index34"],t,i)),"radio-button":()=>new Promise((t,i)=>e(["../chunks/index35"],t,i)),"radio-button-group":()=>new Promise((t,i)=>e(["../chunks/index36"],t,i))})}get activeFeatureIndex(){return this.viewModel.activeFeatureIndex}set activeFeatureIndex(e){this.viewModel.activeFeatureIndex=e}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get _effectiveDisabled(){return this.disabled||this.viewModel.updating}get features(){return this.viewModel.features}set features(e){this.viewModel.features=e}get map(){return this.viewModel.map}set map(e){this.viewModel.map=e}get spatialReference(){return this.viewModel.spatialReference}set spatialReference(e){this.viewModel.spatialReference=e}get timeZone(){return this.viewModel.timeZone}set timeZone(e){this.viewModel.timeZone=e}get icon(){return"edit-attributes"}set icon(e){this._overrideIfSome("icon",e)}get readOnly(){return this.viewModel.readOnly}set readOnly(e){this.viewModel.readOnly=e}get valid(){return this.viewModel.valid}goToClosestError(){const e=this.viewModel.getFirstVisibleInvalidFieldInput();if(!e)return;const{groupInput:t}=e;t&&(t.open||(t.open=!0)),this._focusedFieldInput=e.input,this._attemptFocusOnNextRender=!0,this.scheduleRender()}render(){const{status:e}=this.viewModel;return"failed"===e?this.viewModel.hasTooManyComplexFeatures?this._renderErrorNotice(V.substitute(this.messages.formFailedToLoadTooManyComplexFeatures,{num:this.viewModel.maximumFeatureCountWithComplexForms})):this.viewModel.hasTooManyFeatures?this._renderErrorNotice(V.substitute(this.messages.formFailedToLoadTooManyFeatures,{num:this.viewModel.maximumFeatureCount})):this._renderErrorNotice(this.messages.formFailedToLoad):this.viewModel.expressionEvaluationFailed?this._renderErrorNotice(this.messages.expressionEvaluationFailed):this.viewModel.hasLayersWithContingentValues?this._renderErrorNotice(this.messages.unsupportedContingentValues):w.tsx("div",{class:this.classes(v.css.base,C.globalCss.widget,C.globalCss.panel)},"loaded"===e?this._renderForm():"loading"===e&&this.visibleElements.loadingIndicator?w.tsx("calcite-loader",{key:"loader",label:this.messagesCommon?.loading}):null)}submit(){this.viewModel.submit()}_setDateTimeTimeZoneMap(e){const{datePart:t,elementId:i}=e.dataset,n=s.getOrCreateMapValue(this._dateComponentMap,`${i}`,()=>({}));switch(t){case"date":n.date=e;break;case"time":n.time=e;break;case"timeZone":n.timeZone=e}}_renderErrorNotice(e){return w.tsx("div",{class:this.classes(v.css.base,C.globalCss.widget,C.globalCss.panel)},w.tsx("calcite-notice",{class:v.css.noticeError,icon:!0,kind:"warning",open:!0},w.tsx("div",{slot:"message"},e)))}_renderForm(){return w.tsx("form",{onsubmit:this._onFormSubmit},this._renderInvisibleFieldsError(),this._renderContent())}_renderInvisibleFieldsError(){const{viewModel:e}=this,{hasNonActiveInvalidFeatures:t,activeForm:i}=e;let n;if(!e.submitHasBeenAttempted)return null;if(i.invalidHiddenInputs.length>0)if(n=m.getHiddenFieldsValidationErrorMessage(i,e.mode,this.messages),"batch"===this.viewModel.mode){const e=i.invalidHiddenInputs.filter(e=>"hidden:group-visibility-expression:all-features"===e.effectiveVisibilityCode||"hidden:visibility-expression:all-features"===e.visibilityCode);e.length>0?n+=` (${e.map(e=>e.label).join(", ")})`:n=null}else n+=` (${i.invalidHiddenInputs.map(e=>e.label).join(", ")})`;else if(t)return null;return n?w.tsx("calcite-notice",{class:v.css.noticeError,icon:!0,kind:"danger",open:!0},w.tsx("div",{slot:"message"},n)):null}_renderContent(){if(!this.viewModel.hasVisibleInputs)return[w.tsx("calcite-notice",{class:v.css.noticeError,icon:!0,kind:"warning",open:!0},w.tsx("div",{slot:"message"},this.messages.noVisibleFields[this.viewModel.noVisibleElementsReason]))];const{inputs:e}=this.viewModel.activeForm;return e.filter(e=>e.visible).map(e=>this._renderInput(e))}_renderInput(e){return b.isGroupInput(e)?this._renderGroupInput(e):b.isFieldInput(e)?this._renderLabeledField(e):void 0}_renderGroupInput(e){const{inputs:t,template:i,open:n}=e,s=t.filter(e=>e.visible),a=i.label??"";return w.tsx("calcite-block",{class:this.classes(v.css.group,"sequential"===this.groupDisplay?v.css.groupSequential:null,this.disabled?v.css.inputDisabled:null),collapsible:!0,description:i.description??void 0,disabled:this._effectiveDisabled,expanded:n,heading:a,headingLevel:this.headingLevel,key:`{${i.elementId}-key}`,label:a,onCalciteBlockClose:()=>{e.open=!1},onCalciteBlockOpen:()=>{e.open=!0}},s.map(e=>this._renderInput(e)))}_renderLabeledField(e){const{label:t,elementId:i}=e.template,{required:n,dataType:s}=e,a=n?V.substitute(this.messages.requiredFieldLabel,{name:t}):t;return w.tsx("calcite-label",{"aria-label":a,class:v.css.label,key:`field--${i}`},w.tsx("div",{class:v.css.labelTextContent,key:"labelTextContainer"},t,n?w.tsx("span",{"aria-hidden":"true",title:this.messagesCommon.required},"*"):void 0),"unsupported"!==s?this._renderFieldInput(e):this._renderReadOnlyComponent(e),this._renderAuxiliaryText(e))}_renderFieldInput(e){const t=this.getCommonInputProps(e),{dataType:i}=e;return"date"===i?this._renderDateComponents(e,t):"coded-value"===e.domain?.type?this._renderCodedInputs({input:e,props:t}):"number"===i?this._renderNumberComponent(e,t):this._renderStringComponent(e,t)}_renderAuxiliaryText(e){const{compositeError:t,description:i,submittable:n}=e,s=!n&&t&&(this.viewModel.submitHasBeenAttempted||this._touchedInputs.has(e.template.elementId))?m.getVisibleFieldInputValidationErrorMessage(e,t,this.messages):null;return s?w.tsx("calcite-input-message",{icon:!0,status:"invalid"},s):i?w.tsx("calcite-input-message",{class:v.css.description,icon:!1,status:"idle"},i):null}_renderCodedInputs({input:e,props:t}){const i=e.template.input?.type??null,n=e.codedValueOptions;switch(i){case"switch":return this._renderSwitchField({input:e,props:t});case"radio-buttons":return this._renderRadioButtonGroupComponent({input:e,options:n.flat(),props:t});default:return this._renderComboBoxComponent({options:n,props:t,input:e})}}_renderSwitchField({input:e,props:t}){if((this._batchSwitchInputInitialValues.get(e)===b.differentValuesString||e.value===b.differentValuesString)&&"batch"===this.viewModel.mode){const i={dropdown:{afterCreate:this._afterComponentCreateOrUpdate,afterUpdate:this._afterComponentCreateOrUpdate,disabled:t.readOnly,open:!1,[k]:t[k]},trigger:{appearance:"transparent",iconEnd:"chevron-down",kind:"neutral",slot:"trigger",label:t.label},group:{mode:"single"}};return this._renderDropdownComponent({buttonValue:e.value,dropdownProps:i,options:[{name:this.messages.differentValuesPlaceholder,value:b.differentValuesString,disabled:!0},...e.codedValueDomainOptions]})}return this._renderSwitchComponent({input:e,props:t})}_renderSwitchComponent({input:e,props:t}){return w.tsx("calcite-switch",{...t,checked:!!m.isElementTemplateWithInputType(e.template,"switch")&&e.value===e.template.input.onValue,class:v.css.inputSwitch,disabled:t.readOnly,onblur:()=>{this._focusedFieldInput=null},onCalciteSwitchChange:({currentTarget:e})=>this._saveInput(e)})}_renderDropdownComponent({buttonValue:e,options:t,dropdownProps:i}){const{trigger:n,dropdown:s,group:a}=i;return w.tsx("calcite-dropdown",{...s,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,onCalciteDropdownSelect:({currentTarget:e})=>this._saveInput(e)},w.tsx("calcite-button",{...n},e===b.differentValuesString?this.messages.differentValuesPlaceholder:e),w.tsx("calcite-dropdown-group",{selectionMode:a.mode},t.map(t=>w.tsx("calcite-dropdown-item",{disabled:t.disabled,label:String(t.name),selected:e===t.value},t.name))))}_renderComboBoxComponent({input:e,options:t,props:i}){const n="INSERT"===this.viewModel.editType,s=this._touchedInputs.has(e?.template?.elementId),a=n&&e.showNoValueOptionEnabled&&!s?()=>{}:i.onblur,o={...i,onblur:a};return w.tsx("calcite-combobox",{...o,selectionMode:"single",value:i.placeholder===this.messages.differentValuesPlaceholder?b.differentValuesString:String(i.value),onCalciteComboboxChange:({currentTarget:e})=>{e.value!==b.differentValuesString&&this._saveInput(e)}},this.renderComboboxOptionsList({input:e,options:t,props:i}))}renderComboboxOptionsList({input:e,options:t,props:i}){const[n,s]=t.map(e=>e.map(({name:e,value:t})=>w.tsx("calcite-combobox-item",{key:`#${t}`,selected:i.value===t,textLabel:e,value:`${t}`}))),a=[...n];s.length>0&&a.push(w.tsx("calcite-combobox-item-group",{key:"unsupported",label:this.featureFormMessages.subtypes.unsupportedDomainGroupTitle},s));const o=i.placeholder===this.messages.differentValuesPlaceholder,r=!o&&I.isEmptyValue(i.value);return e.showNoValueOptionEnabled&&a.unshift(w.tsx("calcite-combobox-item",{key:"empty-option",selected:r,textLabel:e.showNoValueLabel||this.messages.empty,value:""})),o&&a.unshift(w.tsx("calcite-combobox-item",{key:b.differentValuesString,selected:!0,textLabel:this.messages.differentValuesPlaceholder,value:b.differentValuesString})),a}_renderRadioButtonGroupComponent({input:e,options:t,props:i}){const n=t.map(({name:t,value:n})=>this._renderRadioButtons({label:t,value:n,selected:n===e.value,props:i}));if(e.showNoValueOptionEnabled){const t="",s=e.showNoValueLabel||this.messages.empty,a=I.isEmptyValue(e.value);n.unshift(this._renderRadioButtons({label:s,value:t,selected:a,props:i}))}return w.tsx("calcite-radio-button-group",{afterCreate:this._afterRadioGroupCreateOrUpdate,afterUpdate:this._afterRadioGroupCreateOrUpdate,class:v.css.inputRadioGroup,disabled:i.readOnly,key:`${i.key}-radio-group`,layout:"vertical",name:i.name,required:i.required},n,i.placeholder===this.messages.differentValuesPlaceholder?w.tsx("calcite-label",{class:v.css.placeholderRadio,key:i.label,layout:"inline"},w.tsx("calcite-radio-button",{checked:!0,class:v.css.inputRadio,disabled:!0,name:i.placeholder,value:i.placeholder}),i.placeholder):null)}_renderRadioButtons({value:e,selected:t,label:i,props:n}){return w.tsx("calcite-label",{class:v.css.inputRadioLabel,key:n.label,layout:"inline"},w.tsx("calcite-radio-button",{...n,afterCreate:void 0,afterUpdate:void 0,checked:t,class:v.css.inputRadio,disabled:n.readOnly,name:n.label,onblur:()=>{this._focusedFieldInput=null},value:e,onCalciteRadioButtonChange:({currentTarget:e})=>{e.checked&&this._saveInput(e)}}),i)}_renderStringComponent(e,t){const{template:i}=e;return!i.field.editable||this.readOnly?this._renderReadOnlyComponent(e):i.input&&"text-area"===i.input.type?w.tsx("calcite-text-area",{...t,class:this.classes(v.css.individualElement),resize:"vertical",value:t.value?String(t.value):"",onCalciteTextAreaInput:({currentTarget:e})=>this._saveInput(e)}):w.tsx("calcite-input",{...t,class:this.classes(v.css.individualElement),type:"text",value:t.value?String(t.value):"",onCalciteInputInput:({currentTarget:e})=>this._saveInput(e)})}_renderNumberComponent(e,t){const i=u.isIntegerField(e.field);return w.tsx("calcite-input-number",{...t,integer:i,type:"number",value:i&&""!==t.value?Math.round(parseFloat(String(t.value))).toString():String(t.value),onCalciteInputNumberInput:({currentTarget:e})=>this._saveInput(e)})}_renderReadOnlyComponent(e,t){const i=this.getCommonInputProps(e);return w.tsx("calcite-input",{...i,class:this.classes(v.css.fieldInput,v.css.inputDisabled,v.css.individualElement),readOnly:!0,type:"text",value:String(t??i.value??"")})}_renderDateComponents(e,t){const{field:i}=e;let n;switch(i.type){case"date":n=this._renderDateFieldComponents(e,t);break;case"date-only":n=this._renderDateOnlyFieldComponent(e,t);break;case"time-only":n=this._renderTimeOnlyFieldComponent(e,t);break;case"timestamp-offset":n=this._renderTimestampOffsetFieldComponents(e,t);break;default:n=this._renderReadOnlyComponent(e,_.getLabelForDateFieldValue(i,t.value,{timeZone:e.effectiveTimeZone,..._.getIntlOptionsForField(e.template.field)}))}return e.value===b.differentValuesString?[n,w.tsx("calcite-input-message",{icon:"information",key:"diff-values-message",status:"idle"},this.messages.differentValues)]:n}_renderDateOnlyFieldComponent(e,t){const{class:i,key:n,readOnly:s}=t,{rawMax:a,rawMin:o}=e.range;return w.tsx("calcite-input-date-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,class:i,"data-date-part":"date","data-element-id":t[k],key:`${n}-date-input`,max:p.isString(a)?a:void 0,min:p.isString(o)?o:void 0,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:s,value:e.value===b.differentValuesString?"":e.value?String(e.value):"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.currentTarget)})}_renderTimeOnlyFieldComponent(e,t){const{class:i,key:n,readOnly:s}=t;return w.tsx("calcite-input-time-picker",{afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,class:i,"data-date-part":"time","data-element-id":t[k],key:`${n}-time-input`,onblur:()=>{this._focusedFieldInput=null},onfocus:this._onComponentFocus,overlayPositioning:"fixed",readOnly:s,value:e.value===b.differentValuesString?"":e.value?String(e.value):"",onCalciteInputTimePickerChange:t=>this._saveValueFromDateComponent(e,t.currentTarget)})}_renderTimestampOffsetFieldComponents(e,t){const{class:i,key:n,readOnly:s}=t,{rawMax:a,rawMin:o}=e.range,r=_.prepareISOFieldValueForDateComponents(a),l=_.prepareISOFieldValueForDateComponents(o),d=_.prepareISOFieldValueForDateComponents(e.value===b.differentValuesString?"":e.value),u=e.includeTimeOffset,p={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,overlayPositioning:"fixed",readOnly:s,[k]:t[k],onfocus:this._onComponentFocus};return w.tsx("div",{class:v.css.dateInputContainer,key:`${n}-date-time-container`},w.tsx("calcite-input-date-picker",{...p,class:i,"data-date-part":"date",key:`${n}-date-input`,max:r?.date??void 0,min:l?.date??void 0,onblur:()=>{this._focusedFieldInput=null},value:d.date??"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),w.tsx("calcite-input-time-picker",{...p,class:i,"data-date-part":"time",key:`${n}-time-input`,onblur:()=>{this._focusedFieldInput=null},value:d.time??"",onCalciteInputTimePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),u?w.tsx("calcite-input-time-zone",{...p,class:i,clearable:e.value===b.differentValuesString||null==e.value,"data-date-part":"timeZone",key:`${n}-timezone-input`,onblur:()=>{this._focusedFieldInput=null},value:d.timeZoneOffset||"",onCalciteInputTimeZoneChange:t=>this._saveValueFromDateComponent(e,t.target)}):null)}_renderDateFieldComponents(e,t){const{class:i,key:n,readOnly:s,min:a,max:o}=t,r=e.effectiveTimeZone,l=_.prepareUnixFieldValueForDateComponents(e.value===b.differentValuesString?"":e.value,r),d=_.prepareUnixFieldValueForDateComponents(o,r),u=_.prepareUnixFieldValueForDateComponents(a,r),p=e.includeTime,c={afterCreate:this._afterDateComponentCreate,afterUpdate:this._afterComponentCreateOrUpdate,overlayPositioning:"fixed",readOnly:s,[k]:t[k],onfocus:this._onComponentFocus};return w.tsx("div",{class:v.css.dateInputContainer,key:`${n}-date-time-container`},w.tsx("calcite-input-date-picker",{...c,class:i,"data-date-part":"date",key:`${n}-date-input`,max:d?.date??void 0,min:u?.date??void 0,onblur:()=>{this._focusedFieldInput=null},value:l.date??"",onCalciteInputDatePickerChange:t=>this._saveValueFromDateComponent(e,t.target)}),p?w.tsx("calcite-input-time-picker",{...c,"data-date-part":"time",key:`${n}-time-input`,onblur:()=>{this._focusedFieldInput=null},step:1,value:l.time??"",onCalciteInputTimePickerChange:t=>{this._saveValueFromDateComponent(e,t.target)}}):null)}getCommonInputProps(e){const{template:t,valid:i,value:n,minLength:s,maxLength:a,required:o,fieldName:r,editable:l,userHasChangedValue:d,range:{max:u,min:p}}=e,c=!l||this.readOnly,m=!c&&this._effectiveDisabled;let h=t.hint??void 0,f=!1;return n===b.differentValuesString&&(h=this.messages.differentValuesPlaceholder,f=!0),{afterCreate:this._afterComponentCreateOrUpdate,afterUpdate:this._afterComponentCreateOrUpdate,"aria-invalid":i?"false":"true",class:this.classes(v.css.fieldInput,c?v.css.inputDisabled:null),status:!d&&!this.viewModel.submitHasBeenAttempted||i?"idle":"invalid",maxLength:a&&a>-1?a:void 0,minLength:s&&s>-1?s:void 0,key:t.elementId,label:r,name:r,max:null!=u?u:void 0,min:null!=p?p:void 0,disabled:m,readOnly:c,onblur:this._onComponentBlur,required:o,placeholder:h,value:f?"":n??"",[k]:t.elementId,onfocus:this._onComponentFocus}}_onFormSubmit(e){e.preventDefault()}_getFieldInputFromHTMLElement(e){return this.viewModel.findFieldInput(e.getAttribute(k))}_afterRadioGroupCreateOrUpdate(e){const t=e.selectedItem,i=e.querySelector("calcite-radio-button"),n=t||i;n&&this._afterComponentCreateOrUpdate(n)}_onComponentFocus(e){const t=e.target,i=this._getFieldInputFromHTMLElement(t);this._touchedInputs.add(i.template.elementId),this._focusedFieldInput=i}_afterComponentCreateOrUpdate(e){const t=this._getFieldInputFromHTMLElement(e),i=this._focusedFieldInput;this._attemptFocusOnNextRender&&i===t&&(this._attemptFocusOnNextRender=!1,y.setFocus(e))}_onComponentBlur(){this._focusedFieldInput=null}_parseValue(e,t){if(m.isElementTemplateWithInputType(t.template,"switch")){if("calcite-dropdown"===e.localName&&t.domain)for(const i of t.domain.codedValues)if(i.name===e.selectedItems[0].textContent)return i.code;return e.checked?t.template.input.onValue:t.template.input.offValue}const i=e.value;return null==i||""===i?null:"number"===t.dataType?"-0"===i||"-0."===i||"-0,"===i?i:parseFloat(i):"date"===t.field.type?parseFloat(i):i}_saveInput(e){const t=this._getFieldInputFromHTMLElement(e),{elementId:i}=t.template;if(!t)return;const n=t?.value;if(m.isElementTemplateWithInputType(t.template,"switch")&&"single"!==this.viewModel.mode){const e=s.getOrCreateMapValue(this._batchSwitchInputInitialValues,t,()=>t.value);this._batchSwitchInputInitialValues.set(t,null===e?n:e)}const a=this._parseValue(e,t);a!==n&&this.viewModel.setValue(i,a)}_afterDateComponentCreate(e){this._setDateTimeTimeZoneMap(e),this._afterComponentCreateOrUpdate(e)}_saveValueFromDateComponent(e,t){const{elementId:i}=e.template,n=e.field.type,s=this._dateComponentMap.get(`${i}`);if(!s)return;const a=e.effectiveTimeZone;let o=e.value===b.differentValuesString?void 0:e.value,r=null;"date-only"===n?r=Array.isArray(t.value)?t.value[0]:t.value:"time-only"===n?(o=_.normalizeTimeOnlyString(o),r=_.normalizeTimeOnlyString(t.value)):r="timestamp-offset"===n?null!=t.value?_.getISOFieldValueFromDateComponents({dateComponent:s.date,timeComponent:s.time,oldValue:o,timeZoneComponent:s.timeZone,defaultTimeZone:a}):null:null!=t.value?_.getUnixFieldValueFromDateComponents({oldValue:o,dateComponent:s.date,timeZone:a,timeComponent:s.time?.value===b.differentValuesString?void 0:s.time}):null,o!==r&&(null!==r&&t.value?this.viewModel.setValue(`${i}`,r):this.viewModel.setValue(`${i}`,null))}};return t.__decorate([o.property()],M.prototype,"activeFeatureIndex",null),t.__decorate([o.property()],M.prototype,"disabled",null),t.__decorate([o.property()],M.prototype,"_effectiveDisabled",null),t.__decorate([o.property()],M.prototype,"features",null),t.__decorate([o.property()],M.prototype,"map",null),t.__decorate([o.property()],M.prototype,"spatialReference",null),t.__decorate([o.property()],M.prototype,"timeZone",null),t.__decorate([o.property()],M.prototype,"headingLevel",void 0),t.__decorate([o.property()],M.prototype,"icon",null),t.__decorate([o.property(),F.messageBundle("esri/t9n/common")],M.prototype,"messagesCommon",void 0),t.__decorate([o.property(),F.messageBundle("esri/widgets/BatchAttributeForm/t9n/BatchAttributeForm")],M.prototype,"messages",void 0),t.__decorate([o.property(),F.messageBundle("esri/widgets/FeatureForm/t9n/FeatureForm")],M.prototype,"featureFormMessages",void 0),t.__decorate([o.property()],M.prototype,"readOnly",null),t.__decorate([o.property()],M.prototype,"valid",null),t.__decorate([o.property(),x.vmEvent(["value-change","submit"])],M.prototype,"viewModel",void 0),t.__decorate([o.property({type:f.VisibleElements,nonNullable:!0})],M.prototype,"visibleElements",void 0),t.__decorate([o.property()],M.prototype,"groupDisplay",void 0),M=t.__decorate([d.subclass("esri.widgets.BatchAttributeForm")],M),M});