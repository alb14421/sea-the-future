// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../chunks/tslib.es6","../intl","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../layers/support/layerUtils","./Widget","./FeatureTemplates/featureTemplatesUtils","./FeatureTemplates/FeatureTemplatesViewModel","./FeatureTemplates/VisibleElements","../chunks/componentsUtils","./support/globalCss","./support/ItemList","./support/symbolPreviewUtils","./support/widgetUtils","./support/decorators/messageBundle","./support/decorators/vmEvent","./support/jsxFactory","../intl/substitute"],function(e,t,r,o,s,i,n,l,a,d,p,c,u,m,h,y,v,_,b,g,I,f,w){"use strict";function C(e){return e.id}let L=class extends p{constructor(e,t){super(e,t),this.enableListScroll=!0,this.filterText="",this.headingLevel=4,this.messages=null,this.messagesCommon=null,this.messagesLegend=null,this.selectionMode="none",this.viewModel=new u,this.visibleElements=new m,this.renderCustomItem=e=>null,this.renderCustomGroupContent=e=>null,this.renderItemLabel=()=>null,this.renderItemDescription=()=>null,this.renderItemContent=e=>null,this.renderItemContentEnd=e=>null,this._iconIntersectionObserver=new IntersectionObserver((e,t)=>{e.forEach(async e=>{if(e.isIntersecting){const o=e.target;if(r=o,r?.["data-has-icon"])return void t.unobserve(o);const s=function(e){return e?.["data-item"]}(o),{layer:i,template:n}=s;M(o,!0);const l=s.label?w.substitute(this.messagesLegend.previewTemplateAriaLabel,{label:s.label}):this.messagesCommon.preview,a=await _.fetchThumbnail(n,i,{ariaLabel:l}).catch(()=>(M(o,!1),null));if(null==a)return;o.appendChild(a)}var r})}),this._renderItemIcon=e=>d.isTable(e.layer)?f.tsx("span",{"data-has-icon":!0,"data-item":e,key:"icon"},f.tsx("calcite-icon",{icon:"table"})):f.tsx("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":e,key:"icon"}),this._afterItemCreateOrUpdate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)}}initialize(){const e=({label:e})=>!this.filterText||!!e?.toLowerCase().includes(this.filterText.toLowerCase());this.addHandles(o.watch(()=>this.viewModel,(t,r)=>{t&&!t.filterFunction&&(this.filterFunction=e),r&&r!==t&&r.filterFunction===e&&(r.filterFunction=null)},o.initial))}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}loadDependencies(){return h.loadCalciteComponents({icon:()=>new Promise((t,r)=>e(["../chunks/index7"],t,r)),loader:()=>new Promise((t,r)=>e(["../chunks/index32"],t,r)),input:()=>new Promise((t,r)=>e(["../chunks/index4"],t,r)),list:()=>new Promise((t,r)=>e(["../chunks/index16"],t,r)),"list-item":()=>new Promise((t,r)=>e(["../chunks/index20"],t,r)),notice:()=>new Promise((t,r)=>e(["../chunks/index6"],t,r))})}get disabled(){return this.viewModel.disabled}set disabled(e){this.viewModel.disabled=e}get filterFunction(){return this.viewModel.filterFunction}set filterFunction(e){this.viewModel.filterFunction=e}get groupBy(){return this.viewModel.groupBy}set groupBy(e){this.viewModel.groupBy=e}get icon(){return"list-rectangle"}set icon(e){this._overrideIfSome("icon",e)}get label(){return this.messages?.widgetLabel??""}set label(e){this._overrideIfSome("label",e)}get layers(){return this.viewModel.layers}set layers(e){this.viewModel.layers=e}get selectedItem(){return this.viewModel.selectedItem}select(e,t){return this.viewModel.select(e,t)}render(){const{disabled:e,enableListScroll:t,filterText:r,headingLevel:o,messages:s,viewModel:{items:i,numberOfFeatureTemplates:n,selectedItem:l,state:a}}=this,d=this.visibleElements.filter&&n>1;if((p=i).length>0&&c.isTemplateItemGroup(p[0])){const e=i.find(e=>e.label===c.nullGroupBy.label);e&&(e.label=s.other)}var p;return f.tsx("div",{"aria-label":s.widgetLabel,class:this.classes("esri-feature-templates",y.globalCss.widget)},"loading"===a?f.tsx("calcite-loader",{key:"loader",label:this.messagesCommon.loading,type:"indeterminate"}):"ready"===a?f.tsx(v.ItemList,{disabled:e,enableListScroll:t,filterEnabled:d,filterText:r,headingLevel:o,id:this.id,identify:C,items:i,messages:{filterPlaceholder:s.filterPlaceholder,noItems:s.noItems,noMatches:s.noMatches},renderCustomGroupContent:this.renderCustomGroupContent,renderCustomItem:this.renderCustomItem,renderIcon:this._renderItemIcon,renderItemContent:this.renderItemContent,renderItemContentEnd:this.renderItemContentEnd,renderItemDescription:this.renderItemDescription,renderItemLabel:this.renderItemLabel,selectedItem:l??void 0,selectionMode:this.selectionMode??void 0,onFilterChange:e=>{this.filterText=e},onItemSelect:e=>!c.isTemplateItemGroup(e)&&this.viewModel.select(e)}):null)}};function M(e,t){e&&(e["data-has-icon"]=t)}return t.__decorate([s.property()],L.prototype,"disabled",null),t.__decorate([s.property()],L.prototype,"enableListScroll",void 0),t.__decorate([s.property()],L.prototype,"filterFunction",null),t.__decorate([s.property()],L.prototype,"filterText",void 0),t.__decorate([s.property()],L.prototype,"groupBy",null),t.__decorate([s.property()],L.prototype,"headingLevel",void 0),t.__decorate([s.property()],L.prototype,"icon",null),t.__decorate([s.property()],L.prototype,"label",null),t.__decorate([s.property()],L.prototype,"layers",null),t.__decorate([s.property(),g.messageBundle("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],L.prototype,"messages",void 0),t.__decorate([s.property(),g.messageBundle("esri/t9n/common")],L.prototype,"messagesCommon",void 0),t.__decorate([s.property(),g.messageBundle("esri/widgets/Legend/t9n/Legend")],L.prototype,"messagesLegend",void 0),t.__decorate([s.property({readOnly:!0})],L.prototype,"selectedItem",null),t.__decorate([s.property()],L.prototype,"selectionMode",void 0),t.__decorate([s.property(),I.vmEvent("select")],L.prototype,"viewModel",void 0),t.__decorate([s.property({type:m,nonNullable:!0})],L.prototype,"visibleElements",void 0),t.__decorate([s.property()],L.prototype,"renderCustomItem",void 0),t.__decorate([s.property()],L.prototype,"renderCustomGroupContent",void 0),t.__decorate([s.property()],L.prototype,"renderItemLabel",void 0),t.__decorate([s.property()],L.prototype,"renderItemDescription",void 0),t.__decorate([s.property()],L.prototype,"renderItemContent",void 0),t.__decorate([s.property()],L.prototype,"renderItemContentEnd",void 0),L=t.__decorate([a.subclass("esri.widgets.FeatureTemplates")],L),L});