// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../Graphic","../../core/handleUtils","../../core/promiseUtils","../../core/reactiveUtils","./workflowUtils"],function(e,r,o,t,a,n,l){"use strict";function c(e){const r=e?.layer;return"scene"===r?.type}r.handleModelUpload=async function({view:r,data:s,signal:i,next:d,cancel:u}){const{creationInfo:m}=s;if(!m)return t.makeHandle();if(!c(m))return t.makeHandle();const{layer:p}=m,f=null!=m.geometryToPlace;if(m.geometryToPlace=null,f)return u(),t.makeHandle();const{Upload:y}=await new Promise((r,o)=>e(["./Upload"],r,o));a.throwIfAborted(i);const g=new y;s.upload=g;let h=null;const w=()=>h?.remove(),k=t.handlesGroup([n.watch(()=>g.state,e=>{switch(e){case"default":case"error":w();break;case"pending":w(),h=l.showProgressCursor(r);break;case"success":{m.maxFeatures=1;const{result:e}=g;"georeferenced"===e?.type||"georeferenced-reprojected"===e?.type?(m.geometryToPlace=e.mesh,m.initialFeature=new o({geometry:e.mesh,sourceLayer:p})):m.geometryToPlace=e?.mesh,w(),d();break}}}),t.makeHandle(()=>{g.cancel(),w()})]);return g.uploadTo(p),k},r.isModelUpload=c,Object.defineProperty(r,Symbol.toStringTag,{value:"Module"})});