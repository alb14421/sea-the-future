// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../../../chunks/tslib.es6","../../../intl","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../Widget","../css","../../../chunks/componentsUtils","../../support/Heading","../../support/ItemList","../../support/symbolPreviewUtils","../../support/widgetUtils","../../support/decorators/messageBundle","../../support/jsxFactory","../../../intl/substitute"],function(e,t,r,s,a,i,n,o,c,l,d,u,m,p,h,g,b,f){"use strict";let v=class extends c{constructor(){super(...arguments),this.workflow=null,this.headingLevel=4,this._iconIntersectionObserver=new IntersectionObserver((e,t)=>{e.forEach(async e=>{if(e.isIntersecting){const s=e.target;if(r=s,r?.["data-has-icon"])return void t.unobserve(s);const a=function(e){return e?.["data-item"]}(s),{graphic:i}=a,n=i.sourceLayer??this.workflow?.data.creationInfo?.layer;if(!n||!i)return;I(s,!0);const o=a.id?f.substitute(this.messagesLegend.previewTemplateAriaLabel,{label:a.id}):this.messagesCommon.preview,c=await p.fetchThumbnail(i,n,{ariaLabel:o}).catch(()=>(I(s,!1),null));if(null==c)return;s.appendChild(c)}var r})}),this.messages=null,this.messagesLegend=null,this.messagesCommon=null,this._renderActionEnd=({graphic:e})=>{const{workflow:t,messages:r}=this;if(!t)return;const s=e.geometry?b.tsx("calcite-action",{appearance:"transparent",icon:"zoom-to-object",onblur:()=>{t.data.temporaryHighlightFeature=null},onclick:()=>t.data.viewModel.zoomTo(e),onfocus:()=>{t.data.temporaryHighlightFeature=e},scale:"s",slot:"actions-end",text:this.messages.zoomTo,title:this.messages.zoomTo}):void 0,a=t.data.isSharedTemplateWorkflow?void 0:b.tsx("calcite-action",{appearance:"transparent",icon:"trash",onblur:()=>{t.data.temporaryHighlightFeature=null},onclick:()=>t.cancelFeature(e),onfocus:()=>{t.data.temporaryHighlightFeature=e},scale:"s",slot:"actions-end",text:r.createFeaturesSelectionList.discard,title:r.createFeaturesSelectionList.discard});return b.tsx(b.tsxFragment,null,s,a)},this._renderItemContentEnd=({graphic:e})=>{const{workflow:t}=this,r=t?.data.isSubmittable(e);return[r?void 0:b.tsx("calcite-icon",{class:l.css.pendingFeatureListIcon,icon:"exclamation-mark-triangle",scale:"s",slot:"content-end"})]},this._renderItemIcon=e=>{if(null!=e?.graphic?.geometry)return b.tsx("span",{afterCreate:this._afterItemCreateOrUpdate,afterRemoved:this._afterItemRemoved,afterUpdate:this._afterItemCreateOrUpdate,"data-has-icon":!1,"data-item":e,key:"icon"})},this._afterItemCreateOrUpdate=e=>{this._iconIntersectionObserver?.observe(e)},this._afterItemRemoved=e=>{this._iconIntersectionObserver?.unobserve(e)}}loadDependencies(){return d.loadCalciteComponents({action:()=>new Promise((t,r)=>e(["../../../chunks/index12"],t,r)),icon:()=>new Promise((t,r)=>e(["../../../chunks/index7"],t,r)),list:()=>new Promise((t,r)=>e(["../../../chunks/index16"],t,r))})}destroy(){this._iconIntersectionObserver?.disconnect(),this._iconIntersectionObserver=null}render(){const e=this.workflow;if(!e)return b.tsx(b.tsxFragment,null,void 0);const t=this.messages,r=e.pendingFeatures.filter(t=>e.data.isDisplayable(t)).map((r,s)=>{const a=e.data.isSubmittable(r),i=a?t.createFeaturesSelectionList.featureReadyToSubmit:t.createFeaturesSelectionList.featureNotReadyToSubmit;return{disabled:!1,id:`${e.data.getFeatureTitle(r)??s}`,graphic:r,label:i,submittable:a}}).toArray();return b.tsx("div",null,b.tsx(u.Heading,{level:u.incrementHeadingLevel(this.headingLevel)},t.createFeaturesSelectionList.heading),b.tsx("calcite-list",{label:t.createFeaturesSelectionList.heading},m.ItemList({enableListScroll:!1,filterEnabled:!1,filterText:"",id:"update-features-pick-list",items:r,messages:{filterPlaceholder:"",noItems:"",noMatches:""},renderIcon:this._renderItemIcon,renderItemTitle:e=>e.label,renderItemLabel:e=>e.id,onItemMouseEnter:t=>e.data.temporaryHighlightFeature=t.graphic,onItemMouseLeave:()=>e.data.temporaryHighlightFeature=null,onItemSelect:t=>e.updatePendingFeature(t.graphic),renderItemContentEnd:this._renderItemContentEnd,renderItemActionEnd:this._renderActionEnd})))}};function I(e,t){e&&(e["data-has-icon"]=t)}return t.__decorate([s.property()],v.prototype,"workflow",void 0),t.__decorate([s.property()],v.prototype,"headingLevel",void 0),t.__decorate([s.property(),g.messageBundle("esri/widgets/Editor/t9n/Editor")],v.prototype,"messages",void 0),t.__decorate([s.property(),g.messageBundle("esri/widgets/Legend/t9n/Legend")],v.prototype,"messagesLegend",void 0),t.__decorate([s.property(),g.messageBundle("esri/t9n/common")],v.prototype,"messagesCommon",void 0),v=t.__decorate([o.subclass("esri.widgets.Editor.components.PendingFeatureList")],v),v});