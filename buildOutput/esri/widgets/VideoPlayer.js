// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","../chunks/tslib.es6","../core/deprecate","../core/lang","../core/Logger","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/decorators/subclass","../intl/date","../views/VideoView","./Slider","./Widget","../chunks/componentsUtils","./support/globalCss","./support/widgetUtils","./support/decorators/messageBundle","./support/jsxFactory","./VideoPlayer/css","./VideoPlayer/VideoPlayerViewModel","./VideoPlayer/components/MetadataSection","./VideoPlayer/components/PlayerActionsGroup","./VideoPlayer/components/PlayerControlsGroup","./VideoPlayer/components/SettingsButton"],function(e,t,i,s,o,r,n,a,d,l,c,p,u,h,m,v,w,g,y,_,V,b,M,P){"use strict";let x=class extends u{constructor(e,t){super(e,t),this._settings=s.clone(P.defaultSettings),this._metadataVisible=!1,this._slider=new p({visibleElements:{labels:!1,rangeLabels:!1},min:0,max:100,values:[0],thumbsConstrained:!1}),this.videoView=new c({container:document.createElement("div"),constraints:{rotationEnabled:!1}}),this.viewModel=new _,i.deprecateWidget(o.getLogger(this),"Video Player","arcgis-video-player",{version:"4.33"})}initialize(){this.addHandles([r.watch(()=>this.viewModel.layer,()=>{this.videoView.layer=this.viewModel.layer},r.initial),r.watch(()=>this.view?.map,()=>{this.videoView.map=this.view?.map},r.initial),this._slider.on(["thumb-change","thumb-drag"],({value:e})=>{const t=e*this.viewModel.duration/100;this.viewModel.seekTo(t)})])}loadDependencies(){return Promise.all([b.loadPlayerActionsGroupComponents(),M.loadPlayerControlsGroupComponents(),V.loadMetadataSectionComponents(),h.loadCalciteComponents({progress:()=>new Promise((t,i)=>e(["../chunks/index61"],t,i)),panel:()=>new Promise((t,i)=>e(["../chunks/index51"],t,i)).then(e=>e.index),scrim:()=>new Promise((t,i)=>e(["../chunks/index10"],t,i))})])}get icon(){return"video-web"}set icon(e){this._overrideIfSome("icon",e)}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get rotationEnabled(){return this.videoView.constraints.rotationEnabled}set rotationEnabled(e){this.videoView.constraints.rotationEnabled=e,this.videoView.ui.components=e?[...this.videoView.ui.components,"compass"]:this.videoView.ui.components.filter(e=>"compass"!==e)}get view(){return this.viewModel.view}set view(e){this.viewModel.view=e}get zoomEnabled(){return this.videoView.navigation.mouseWheelZoomEnabled}set zoomEnabled(e){this.videoView.navigation.mouseWheelZoomEnabled=e,this.videoView.ui.components=e?[...this.videoView.ui.components,"zoom"]:this.videoView.ui.components.filter(e=>"zoom"!==e)}render(){return g.tsx("div",{class:this.classes(y.css.base,m.globalCss.widget)},g.tsx("calcite-panel",{heading:this.layer?.title||"Video Player"},this._renderLoadingScrim(),this._renderBuffering(),this._renderVideoSection(),this._renderActionBar(),this._renderMetadataSection()))}_renderLoadingScrim(){const{state:e}=this.viewModel;return this.videoView.ready?null:g.tsx("calcite-scrim",{loading:"error"!==e},"error"===e?this.messages.errorLoadingLayer:null)}_renderBuffering(){const{currentTime:e,buffered:t,duration:i}=this.viewModel,s=t/(i||1),o=e/(i||1);return this.viewModel.ended||s>o?null:g.tsx("calcite-progress",{type:"indeterminate"})}_renderVideoSection(){const{buffered:e,currentTime:t,duration:i}=this.viewModel,s=this.videoView.container;if(!s)return null;s.className=y.css.videoView;const o=e/(i||1),r=t/(i||1);return this._slider.values=[100*r],g.tsx("section",{afterCreate:S,bind:s},g.tsx("div",{class:y.css.sliderProgressContainer},g.tsx("progress",{class:y.css.progress,max:"1",value:`${o}`}),g.tsx("div",{class:y.css.slider},this._slider.render())))}_renderActionBar(){return g.tsx("div",{class:y.css.playerToolbar},g.tsx(b.PlayerActionsGroup,{messages:this.messages,viewModel:this.viewModel}),g.tsx("div",{class:y.css.playerTimecode},f(this.viewModel.currentTime)," / ",f(this.viewModel.duration)),g.tsx(M.PlayerControlsGroup,{messages:this.messages,settings:this._settings,toggleMetadata:()=>this._metadataVisible=!this._metadataVisible,viewModel:this.viewModel}))}_renderMetadataSection(){return this._metadataVisible?g.tsx(V.MetadataSection,{messages:this.messages,viewModel:this.viewModel}):null}};function f(e){return isFinite(e)?l.formatDate(1e3*Math.round(e),{minute:"2-digit",second:"2-digit"}):""}function S(e){e.prepend(this)}return t.__decorate([n.property()],x.prototype,"_settings",void 0),t.__decorate([n.property()],x.prototype,"icon",null),t.__decorate([n.property()],x.prototype,"layer",null),t.__decorate([n.property(),w.messageBundle("esri/widgets/VideoPlayer/t9n/VideoPlayer")],x.prototype,"messages",void 0),t.__decorate([n.property()],x.prototype,"rotationEnabled",null),t.__decorate([n.property()],x.prototype,"videoView",void 0),t.__decorate([n.property({type:_})],x.prototype,"viewModel",void 0),t.__decorate([n.property()],x.prototype,"view",null),t.__decorate([n.property()],x.prototype,"zoomEnabled",null),x=t.__decorate([d.subclass("esri.widgets.VideoPlayer")],x),x});