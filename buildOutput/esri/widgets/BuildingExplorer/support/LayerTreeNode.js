// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Collection","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,i,r,o,l,s,n,a,d){"use strict";function h(e,t){let i=null;for(const r of e.items){const e=t(r);if(null!=i&&i!==e)return null;i=e}return i}e.LayerTreeNode=class extends i{constructor(e){super(e),this.id="root",this.parent=null,this.children=new r,this.layers=new r,this.level=0,this._childIds=new Set,this._layerUniqueIds=new Set}initialize(){this.addHandles([this.layers.on("before-add",e=>{this._layerUniqueIds.has(e.item.uid)?e.preventDefault():this._layerUniqueIds.add(e.item.uid)}),this.layers.on("after-add",({item:e})=>{this.addHandles([o.watch(()=>e.visible,()=>this.notifyChange("visible"),o.initial),o.watch(()=>e.title,()=>this.notifyChange("title"),o.initial)],e.uid)}),this.layers.on("before-remove",({item:e})=>{this.removeHandles(e.uid),this.notifyChange("title"),this.notifyChange("visible")}),this.children.on("before-add",e=>{this._childIds.has(e.item.id)?e.preventDefault():(e.item._set("parent",this),this._childIds.add(e.item.id))})])}destroy(){this.children.forEach(e=>e.destroy())}get hasChildren(){return this.children.length>0}get isDiscipline(){return 1===this.level}get visible(){return h(this.layers,e=>e.visible)}get title(){return h(this.layers,e=>e.title)||this.layers.items.map(e=>e.title).join(", ")||null}toggleVisibility(e){const t=void 0===e?!this.visible:e;this.layers.forEach(e=>{e.visible=t}),t&&null!=this.parent&&this.parent.toggleVisibility(!0)}toggleAllSiblingsVisibility(e){const t=void 0===e?!this.visible:e;this.toggleVisibility(t),null!=this.parent&&(this.parent.toggleVisibility(t),this.parent.children.forEach(e=>e.toggleVisibility(t)))}},t.__decorate([l.property({nonNullable:!0})],e.LayerTreeNode.prototype,"id",void 0),t.__decorate([l.property()],e.LayerTreeNode.prototype,"parent",void 0),t.__decorate([l.property({nonNullable:!0,readOnly:!0})],e.LayerTreeNode.prototype,"children",void 0),t.__decorate([l.property({nonNullable:!0,readOnly:!0})],e.LayerTreeNode.prototype,"layers",void 0),t.__decorate([l.property({nonNullable:!0})],e.LayerTreeNode.prototype,"level",void 0),t.__decorate([l.property({readOnly:!0})],e.LayerTreeNode.prototype,"hasChildren",null),t.__decorate([l.property({readOnly:!0})],e.LayerTreeNode.prototype,"isDiscipline",null),t.__decorate([l.property({readOnly:!0})],e.LayerTreeNode.prototype,"visible",null),t.__decorate([l.property({readOnly:!0})],e.LayerTreeNode.prototype,"title",null),e.LayerTreeNode=t.__decorate([d.subclass("esri.widgets.BuildingExplorer.support.LayerTreeNode")],e.LayerTreeNode),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});