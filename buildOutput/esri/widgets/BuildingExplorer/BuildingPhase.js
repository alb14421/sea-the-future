// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./BuildingNumericFilterViewModel","./support/buildingLayerUtils","./support/filterUtils","./support/validation"],function(e,s,t,l,i,r,o,a,d,n){"use strict";let h=class extends o{constructor(e){super(e),this._createdPhaseFieldName=null,this._demolishedPhaseFieldName=null,this._parseValueFromFilter=e=>{const s=this._createdPhaseFieldName,t=new RegExp(`${s}\\s*<=\\s*(\\d+)\\s*OR\\s*${s}\\s*IS\\s*NULL`,"gi"),l=this._demolishedPhaseFieldName,i=new RegExp(`${l}\\s*>\\s*(\\d+)\\s*OR\\s*${l}\\s*IS\\s*NULL`,"gi");for(const{filterExpression:s}of e.filterBlocks?.items??[]){const e=s?t.exec(s)??i.exec(s):null;if(e)return parseInt(e[1],10)}return null}}get filterExpressions(){if(!this.enabled)return{solid:null,xRay:null};const e=[],s=this._createdPhaseFieldName;s&&e.push(`(${s} <= ${this.value} OR ${s} IS NULL)`);const t=this._demolishedPhaseFieldName;t&&e.push(`(${t} > ${this.value} OR ${t} IS NULL)`);const l=e.join(" AND ");return{solid:l,xRay:l}}get _lastValue(){const e=this.allowedValues;return e.length>0?e[e.length-1]:0}_setup(){const e=[];this.layers.forEach(s=>{const t=a.findFieldInfoByModelName(s,"createdphase");null!=t&&(this._createdPhaseFieldName=t.fieldName,e.push(t));const l=a.findFieldInfoByModelName(s,"demolishedphase");null!=l&&(this._demolishedPhaseFieldName=l.fieldName,e.push(l))}),this._domainInfo=n.getDomainInfo(e);const s=this._valueBeforeReady;if(this._set("state","ready"),this._valueBeforeReady=null,this.allowedValues.length>0){const e=s??d.getValueFromFilters(this.layers,this._parseValueFromFilter);this.select(e??this._lastValue)}else this.clear()}};return e.__decorate([s.property({readOnly:!0})],h.prototype,"filterExpressions",null),e.__decorate([s.property()],h.prototype,"_createdPhaseFieldName",void 0),e.__decorate([s.property()],h.prototype,"_demolishedPhaseFieldName",void 0),e.__decorate([s.property({readOnly:!0})],h.prototype,"_lastValue",null),h=e.__decorate([r.subclass("esri.widgets.BuildingExplorer.BuildingPhase")],h),h});