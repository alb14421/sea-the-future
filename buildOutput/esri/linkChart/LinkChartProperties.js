// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../chunks/tslib.es6","../applications/KnowledgeStudio/resourceSerializationUtils","../core/Clonable","../core/MultiOriginJSONSupport","../core/urlUtils","../core/uuid","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../core/accessorSupport/PropertyOrigin","../layers/knowledgeGraph/supportUtils","./enums","./LayoutSettings","./NonspatialDataDisplay","../chunks/persistableUrlUtils"],function(e,t,r,o,i,s,n,a,l,p,c,u,d,y,h,g,U,w,_){"use strict";let m=class extends(r.ClonableMixin(o.MultiOriginJSONSupport)){constructor(e){super(e),this.aggregatedEntitiesUrl=null,this.aggregatedRelationshipsUrl=null,this.autoCollapseRelationships=!0,this.centralityIsUpToDate=!0,this.entitiesUrl=null,this.layoutSettings=null,this.layoutType="organic-standard",this.nonspatialDataDisplay=null,this.relationshipsUrl=null}readEntitiesUrl(e,t,r){return _.fromJSON(e,r)}writeEntitiesUrl(e,t,r,o){const i=o?.portalItem,s=o?.resources,n=y.nameToId(o?.origin),a=o?.webmap?.activeLinkChartLayer;i&&s&&null!=n&&a&&a.membershipModified?this._saveUrlAsNewResource(t,r,s,i,a):e&&(t[r]=_.toJSON(e,o))}readRelationshipsUrl(e,t,r){return _.fromJSON(e,r)}writeRelationshipsUrl(e,t,r,o){const i=o?.portalItem,s=o?.resources,n=y.nameToId(o?.origin),a=o?.webmap?.activeLinkChartLayer;i&&s&&null!=n&&a&&a.membershipModified?this._saveUrlAsNewResource(t,r,s,i,a):e&&(t[r]=_.toJSON(e,o))}_saveUrlAsNewResource(e,r,o,n,a){e[r]="<pending>";const l=(a.knowledgeGraph.dataModel.relationshipTypes??[]).map(e=>e.name).reduce((e,t)=>{if(!t)return e;const{members:r}=a.dataManager.inclusionModeDefinition.namedTypeDefinitions.get(t)||{members:void 0};if(!r)return e;for(const[o]of r)e.push({id:o,typeName:t});return e},[]);o.pendingOperations.push(new Promise(p=>{h.getRelationshipEndNodeMap(l,a.knowledgeGraph).then(l=>{(async function(e,r,o,i){let s;return s="entitiesUrl"===r?await t.serializeInclusionDefinitionToEntitiesPbf(e,o,i):await t.serializeInclusionDefinitionToRelationshipsPbf(e,o,i),new Blob([s],{type:"application/x-protobuf"})})(a.dataManager.inclusionModeDefinition,r,a.knowledgeGraph,l).then(t=>{const a=function(e,t){const r=`${t}-${s.generateUUID()}.dat`,o=i.join("linkChart",r);return e.resourceFromPath(o)}(n,"entitiesUrl"===r?"entitiesUrl":"relationshipsUrl");e[r]=a.itemRelativeUrl,o.toAdd.push({resource:a,content:{type:"blob",blob:t},compress:!1,finish:e=>{"entitiesUrl"===r?this.entitiesUrl=e.url:this.relationshipsUrl=e.url}}),p()})})}))}};return e.__decorate([n.property({type:String,json:{write:!0}})],m.prototype,"aggregatedEntitiesUrl",void 0),e.__decorate([n.property({type:String,json:{write:!0}})],m.prototype,"aggregatedRelationshipsUrl",void 0),e.__decorate([n.property({type:Boolean,json:{write:!0}})],m.prototype,"autoCollapseRelationships",void 0),e.__decorate([n.property({type:Boolean,json:{write:!0}})],m.prototype,"centralityIsUpToDate",void 0),e.__decorate([n.property({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],m.prototype,"entitiesUrl",void 0),e.__decorate([c.reader("entitiesUrl")],m.prototype,"readEntitiesUrl",null),e.__decorate([d.writer("entitiesUrl")],m.prototype,"writeEntitiesUrl",null),e.__decorate([n.property({type:U,json:{write:!0}})],m.prototype,"layoutSettings",void 0),e.__decorate([n.property({type:g.layoutTypes,json:{write:!0}})],m.prototype,"layoutType",void 0),e.__decorate([n.property({type:w,json:{write:!0}})],m.prototype,"nonspatialDataDisplay",void 0),e.__decorate([n.property({type:String,json:{write:{ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],m.prototype,"relationshipsUrl",void 0),e.__decorate([c.reader("relationshipsUrl")],m.prototype,"readRelationshipsUrl",null),e.__decorate([d.writer("relationshipsUrl")],m.prototype,"writeRelationshipsUrl",null),m=e.__decorate([u.subclass("esri.linkChart.LinkChartProperties")],m),m});