// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["./chunks/tslib.es6","./Basemap","./WebDocument2D","./core/Error","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/RandomLCG","./core/accessorSupport/decorators/subclass","./layers/knowledgeGraph/supportUtils","./linkChart/LayoutSettings","./linkChart/LinkChartProperties","./linkChart/NonspatialDataDisplay","./webmap/InitialViewProperties","./webmap/utils","./webmap/Version"],function(t,e,r,a,i,n,o,h,s,l,c,y,k,p,L,d){"use strict";var C;const u={currentVersion:L.currentVersion,createInitialViewProperties:()=>new p,parseVersion:d.Version.parse,itemType:"Web Link Chart",name:"linkchart",origin:"link-chart"};let w=C=class extends r{constructor(t){super(t),this.mapType="webLinkChart",this.linkChartProperties=new y}get activeLinkChartLayer(){return this.layers.find(({type:t})=>"link-chart"===t)}get context(){return u}async applyLayout(t="organic-standard",r){if(await this.load(),!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");"geographic-organic-standard"!==t||this.basemap?.baseLayers?.length||(this.basemap=e.fromId("topo-vector"),await(this.basemap?.load())),this.linkChartProperties.layoutType=t;const i=r?.layoutSettings??this.linkChartProperties.layoutSettings??new c;this.linkChartProperties.layoutSettings=i;const n={...r,layoutSettings:i};return this.activeLinkChartLayer.applyNewLinkChartLayout(t,n)}changeNonspatialDataDisplay(t){if(!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");this.linkChartProperties.nonspatialDataDisplay||(this.linkChartProperties.nonspatialDataDisplay=new k),this.linkChartProperties.nonspatialDataDisplay.mode=t}async addRecords(t,e){if(await this.load(),!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");return this.activeLinkChartLayer.addRecords(t,e)}async createSublayerForNamedType(t){if(await this.load(),!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");return this.activeLinkChartLayer.createSublayerForNamedType(t)}async removeRecords(t){if(await this.load(),!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");return this.activeLinkChartLayer.removeRecords(t)}async expand(t,e){if(await this.load(),!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");const r=await this.activeLinkChartLayer.expand(t,e);return r?.records??[]}async refreshLinkChartData(t){if(await this.load(),!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");return this.activeLinkChartLayer.refreshLinkChartCache(t)}async connectBetweenEntities(t,e){if(await this.load(),!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");const r=await this.activeLinkChartLayer.connectBetweenEntities(t,e);return r?.records??[]}async connectFromEntities(t,e){if(await this.load(),!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");const r=await this.activeLinkChartLayer.connectFromEntities(t,e);return r?.records??[]}getMemberIdsByType(t){if(!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");return Array.from(this.activeLinkChartLayer?.dataManager.sublayerCaches.get(t)?.keys()??[])}get diagramNodesExtent(){if(!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");return this.activeLinkChartLayer.linkChartExtent}get entityCount(){if(!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");return this.activeLinkChartLayer.entityLinkChartDiagramLookup.size}get relationshipCount(){if(!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");return this.activeLinkChartLayer.relationshipLinkChartDiagramLookup.size}get knowledgeGraph(){if(!this.activeLinkChartLayer)throw new a("WebLinkChart:no-link-chart-layer","No link chart layer found");return this.activeLinkChartLayer?.knowledgeGraph}add(t,e){if(this.activeLinkChartLayer&&"type"in t&&"link-chart"===t.type)throw new a("linkchart:one-link-chart-layer","Web Link Charts can only have one Link Chart Layer, another cannot be added");if(super.add(t,e),"type"in t&&"link-chart"===t.type){const e=t.initializationLinkChartConfig?.layoutMode;e&&(this.linkChartProperties.layoutType=e);const r=t.initializationLinkChartConfig?.layoutSettings;r&&(this.linkChartProperties.layoutSettings=r)}}static fromJSON(t){if(t)return new C({resourceInfo:t});throw new a("linkchart:empty-resource","Expected a JSON resource but got nothing")}handleChronologicalOverlay(){if(!this.activeLinkChartLayer)return;const t=this.activeLinkChartLayer,e=this.findLayerById(l.getDefaultChronologicalOverlayLayerId());if(e&&this.remove(e),"chronological-mono-timeline"===this.linkChartProperties.layoutType||"chronological-multi-timeline"===this.linkChartProperties.layoutType){const e=l.getChronologicalOverlay(t);this.add(e,0)}}};return t.__decorate([i.property({readOnly:!0})],w.prototype,"activeLinkChartLayer",null),t.__decorate([i.property({json:{write:{ignoreOrigin:!0}}})],w.prototype,"mapType",void 0),t.__decorate([i.property({type:y,nonNullable:!0,json:{write:{ignoreOrigin:!0}}})],w.prototype,"linkChartProperties",void 0),t.__decorate([i.property({readOnly:!0})],w.prototype,"diagramNodesExtent",null),t.__decorate([i.property({readOnly:!0})],w.prototype,"entityCount",null),t.__decorate([i.property({readOnly:!0})],w.prototype,"relationshipCount",null),t.__decorate([i.property({readOnly:!0})],w.prototype,"knowledgeGraph",null),w=C=t.__decorate([s.subclass("esri.WebLinkChart")],w),w});