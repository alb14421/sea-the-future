// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/asyncUtils","../../core/events","../../core/handleUtils","../../core/promiseUtils","../../core/reactiveUtils","../../core/scheduling","../../core/screenUtils","../../views/interactive/sketch/SketchTooltipVisibleElements"],function(e,o,t,i,n,r,s,a,c){"use strict";const l=new Map,d={area:!1,distance:!1,direction:!1,elevation:!1,orientation:!1,radius:!1,rotation:!1,scale:!1,size:!1,totalLength:!1,coordinates:!1,helpMessage:!1,header:!1};e.hideAllVisibleElements=function(e){e.tooltipOptions.visibleElements=new c(d)},e.showTooltipAndFocusField=async function(e,c,d={}){const p=l.get(e);p&&(p.abort(),await p.promise);const f=o.createTask(async function(o){const l=function(e){const{activeComponent:o}=e;return o&&"tooltip"in o&&"activeTooltipInfo"in o&&"destroyed"in o?o:null}(e),{tooltipOptions:p}=e;if("coordinates"===c?(c="x",p.xyMode="coordinates"):"direction"!==c&&"distance"!==c||(p.xyMode="direction-distance"),await s.waitAnimationFrame(),n.isAborted(d)||n.isAborted(o))return;const f=l?.tooltip;if(!f||!l.activeTooltipInfo?.editableFields?.find(e=>e.name===c))return;const{handle:u,promise:m}=function(e,{hideOnBlur:o=!0}){const r=n.createResolver();if(!o)return{promise:r.promise,handle:i.makeHandle()};const{outerContainer:s}=e,a=t.on(s,"focusout",({relatedTarget:e})=>{e instanceof HTMLElement&&s.contains(e)||r.resolve()});return{promise:r.promise,handle:a}}(f,d),v=n.createResolver(),b=n.onAbort(d.signal,v.resolve),h=n.onAbort(o,v.resolve),w=p.offset,y=f.position;try{if(p.forceEnabled=!0,await n.waitTick(),d.position&&(p.offset=0,f.position=a.createScreenPoint(d.position[0],d.position[1])),await f.enterInputMode(c),n.isAborted(d)||n.isAborted(o))return;d.onOpen?.(),await Promise.race([r.whenOnce(()=>l.destroyed||"feedback"===f.content?.mode,d),m,v.promise])}finally{b?.remove(),h?.remove(),u.remove();const o=f.outerContainer.contains(document.activeElement);p.enabled?await f.exitInputMode({focusOnView:o}):o&&e.view?.focus(),d.onClose?.(),f.position=y,p.offset=w,p.forceEnabled=!1}});return l.set(e,f),f.promise.catch(n.ignoreAbortErrors).finally(()=>{l.get(e)===f&&l.delete(e)})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});