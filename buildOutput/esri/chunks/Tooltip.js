// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./Theme"],function(e,t){"use strict";class i extends t.Graphics{_beforeChanged(){super._beforeChanged(),(this.isDirty("pointerBaseWidth")||this.isDirty("cornerRadius")||this.isDirty("pointerLength")||this.isDirty("pointerX")||this.isDirty("pointerY")||this.isDirty("width")||this.isDirty("height"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){this.markDirtyBounds();let e=this.width(),i=this.height();if(e>0&&i>0){let s=this.get("cornerRadius",8);s=t.fitToRange(s,0,Math.min(e/2,i/2));let o=this.get("pointerX",0),l=this.get("pointerY",0),r=this.get("pointerBaseWidth",15)/2,n=0,a=0,h=0,p=(o-n)*(i-a)-(l-a)*(e-n),u=(o-h)*(0-i)-(l-i)*(e-h);const d=this._display;if(d.moveTo(s,0),p>0&&u>0){let i=Math.round(t.fitToRange(o,s+r,e-r-s));l=t.fitToRange(l,-1/0,0),d.lineTo(i-r,0),d.lineTo(o,l),d.lineTo(i+r,0)}if(d.lineTo(e-s,0),d.arcTo(e,0,e,s,s),p>0&&u<0){let n=Math.round(t.fitToRange(l,s+r,i-r-s));o=t.fitToRange(o,e,1/0),d.lineTo(e,s),d.lineTo(e,Math.max(n-r,s)),d.lineTo(o,l),d.lineTo(e,n+r)}if(d.lineTo(e,i-s),d.arcTo(e,i,e-s,i,s),p<0&&u<0){let n=Math.round(t.fitToRange(o,s+r,e-r-s));l=t.fitToRange(l,i,1/0),d.lineTo(e-s,i),d.lineTo(n+r,i),d.lineTo(o,l),d.lineTo(n-r,i)}if(d.lineTo(s,i),d.arcTo(0,i,0,i-s,s),p<0&&u>0){let e=Math.round(t.fitToRange(l,s+r,i-s-r));o=t.fitToRange(o,-1/0,0),d.lineTo(0,i-s),d.lineTo(0,e+r),d.lineTo(o,l),d.lineTo(0,Math.max(e-r,s))}d.lineTo(0,s),d.arcTo(0,0,s,0,s),d.closePath()}}}}Object.defineProperty(i,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PointedRectangle"}),Object.defineProperty(i,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:t.Graphics.classNames.concat([i.className])});class s extends t.Container{constructor(e,t,i,s=[]){super(e,t,i,s),Object.defineProperty(this,"_fx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_fy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillGrDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_strokeDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_labelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_w",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_h",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_keepHoverDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_htmlContentHovered",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._settings.themeTags=t.mergeTags(this._settings.themeTags,["tooltip"]),super._afterNew(),this._setDefaultFn("background",()=>i.new(this._root,{})).set("themeTags",["tooltip","background"]),this._label=this.children.push(t.Label.new(this._root,{})),this._disposers.push(this._label.events.on("boundschanged",()=>{this._updateBackground()})),this._disposers.push(this.on("bounds",()=>{this._updateBackground()})),this._updateTextColor(),this._root.tooltipContainer.children.push(this),this.hide(0),this._disposers.push(this.label.onPrivate("htmlElement",e=>{e&&(this._disposers.push(t.addEventListener(e,"pointerover",e=>{this._htmlContentHovered=!0})),this._disposers.push(t.addEventListener(e,"pointerout",e=>{this._htmlContentHovered=!1})))})),this.on("visible",e=>{this._handleReaderAnnouncement()}),this.label.events.on("dataitemchanged",e=>{this._handleReaderAnnouncement()}),this._root._tooltips.push(this)}_handleReaderAnnouncement(){this.get("readerAnnounce")&&this.isVisibleDeep()&&this._root.readerAlert(this.label.getAccessibleText())}get label(){return this._label}_dispose(){super._dispose(),t.remove(this._root._tooltips,this)}_updateChildren(){super._updateChildren(),(this.isDirty("pointerOrientation")||this.isPrivateDirty("minWidth")||this.isPrivateDirty("minHeight"))&&this.get("background")._markDirtyKey("width"),null!=this.get("labelText")&&this.label.set("text",this.get("labelText")),null!=this.get("labelHTML")&&this.label.set("html",this.get("labelHTML")),null!=this.get("labelAriaLabel")&&this.label.set("ariaLabel",this.get("labelAriaLabel"))}_changed(){if(super._changed(),(this.isDirty("pointTo")||this.isDirty("pointerOrientation"))&&this._updateBackground(),this.isDirty("tooltipTarget")&&this.updateBackgroundColor(),this.isDirty("keepTargetHover"))if(this.get("keepTargetHover")){const e=this.get("background");this._keepHoverDp=new t.MultiDisposer([e.events.on("pointerover",e=>{let t=this.get("tooltipTarget");t&&(t.parent&&t.parent.getPrivate("tooltipTarget")==t&&(t=t.parent),t.hover())}),e.events.on("pointerout",e=>{let t=this.get("tooltipTarget");t&&(t.parent&&t.parent.getPrivate("tooltipTarget")==t&&(t=t.parent),this._htmlContentHovered||t.unhover())})]),this.label.onPrivate("htmlElement",i=>{this._keepHoverDp&&i&&this._keepHoverDp.disposers.push(t.addEventListener(i,"pointerleave",t=>{const i=this.root._renderer.getEvent(t);e.events.dispatch("pointerout",{type:"pointerout",originalEvent:i.event,point:i.point,simulated:!1,target:e})}))})}else this._keepHoverDp&&(this._keepHoverDp.dispose(),this._keepHoverDp=void 0)}_onShow(){super._onShow(),this.updateBackgroundColor()}updateBackgroundColor(){let e=this.get("tooltipTarget");const t=this.get("background");let i,s;if(e&&t){if(i=e.get("fill"),s=e.get("stroke"),null==i&&(i=s),this.get("getFillFromSprite")&&(this._fillDp&&this._fillDp.dispose(),null!=i&&t.set("fill",i),this._fillDp=e.on("fill",e=>{null!=e&&(t.set("fill",e),this._updateTextColor(e))}),this._disposers.push(this._fillDp)),this.get("getFillGradientFromSprite")){this._fillGrDp&&this._fillGrDp.dispose();let i=e.get("fillGradient");null!=i&&t.set("fillGradient",i),this._fillGrDp=e.on("fillGradient",e=>{null!=e&&t.set("fillGradient",e)}),this._disposers.push(this._fillGrDp)}this.get("getStrokeFromSprite")&&(this._strokeDp&&this._strokeDp.dispose(),null!=i&&t.set("stroke",i),this._strokeDp=e.on("fill",e=>{null!=e&&t.set("stroke",e)}),this._disposers.push(this._strokeDp)),this.get("getLabelFillFromSprite")&&(this._labelDp&&this._labelDp.dispose(),null!=i&&this.label.set("fill",i),this._labelDp=e.on("fill",e=>{null!=e&&this.label.set("fill",e)}),this._disposers.push(this._labelDp))}this._updateTextColor(i)}_updateTextColor(e){this.get("autoTextColor")&&(null==e&&(e=this.get("background").get("fill")),null==e&&(e=this._root.interfaceColors.get("background")),e instanceof t.Color&&this.label.set("fill",t.Color.alternative(e,this._root.interfaceColors.get("alternativeText"),this._root.interfaceColors.get("text"))))}_setDataItem(e){super._setDataItem(e),this.label._setDataItem(e)}_updateBackground(){super.updateBackground();const e=this._root.container;if(e){let s=.5,o=.5,l=this.get("centerX");l instanceof t.Percent&&(s=l.value);let r=this.get("centerY");r instanceof t.Percent&&(o=r.value);let n=e.width(),a=e.height(),h=this.parent,p=0,u=0;if(h){p=h.x(),u=h.y();const e=h.get("layerMargin");e&&(p+=e.left||0,u+=e.top||0,n+=(e.left||0)+(e.right||0),a+=(e.top||0)+(e.bottom||0))}const d=this.get("bounds",{left:-p,top:-u,right:n-p,bottom:a-u});this._updateBounds();let g=this.width(),c=this.height();0===g&&(g=this._w),0===c&&(c=this._h);let b=this.get("pointTo",{x:n/2,y:a/2}),f=b.x,_=b.y,v=this.get("pointerOrientation"),m=this.get("background"),T=0,D=0,y=0;m instanceof i&&(T=m.get("pointerLength",0),D=m.get("strokeWidth",0)/2,y=D,m.set("width",g),m.set("height",c));let k=0,w=0,P=d.right-d.left,x=d.bottom-d.top;"horizontal"==v||"left"==v||"right"==v?(D=0,"horizontal"==v?f>d.left+P/2?(f-=g*(1-s)+T,y*=-1):f+=g*s+T:"left"==v?f+=g*(1-s)+T:(f-=g*s+T,y*=-1)):(y=0,"vertical"==v?_>d.top+c/2+T?_-=c*(1-o)+T:(_+=c*o+T,D*=-1):"down"==v?_-=c*(1-o)+T:(_+=c*o+T,D*=-1)),f=t.fitToRange(f,d.left+g*s,d.left+P-g*(1-s))+y,_=t.fitToRange(_,d.top+c*o,d.top+x-c*(1-o))-D,k=b.x-f+g*s+y,w=b.y-_+c*o-D,this._fx=f,this._fy=_;const C=this.get("animationDuration",0);if(C>0&&this.get("visible")&&this.get("opacity")>.1){const e=this.get("animationEasing");this.animate({key:"x",to:f,duration:C,easing:e}),this.animate({key:"y",to:_,duration:C,easing:e})}else this.set("x",f),this.set("y",_);m instanceof i&&(m.set("pointerX",k),m.set("pointerY",w)),g>0&&(this._w=g),c>0&&(this._h=c)}}}Object.defineProperty(s,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Tooltip"}),Object.defineProperty(s,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:t.Container.classNames.concat([s.className])}),e.Tooltip=s});