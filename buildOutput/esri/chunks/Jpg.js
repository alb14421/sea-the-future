// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./_commonjsHelpers"],function(e,n){"use strict";var r,o,t,a={exports:{}},i=(r||(r=1,o=a,t=function(){var e=function(){function e(e){this.message="JPEG error: "+e}return e.prototype=new Error,e.prototype.name="JpegError",e.constructor=e,e}(),n=function(){if(!self||!self.Uint8ClampedArray)return null;var n=new Uint8Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),r=4017,o=799,t=3406,a=2276,i=1567,s=3784,c=5793,f=2896;function l(){this.decodeTransform=null,this.colorTransform=-1}function u(e,n){for(var r,o,t=0,a=[],i=16;i>0&&!e[i-1];)i--;a.push({children:[],index:0});var s,c=a[0];for(r=0;r<i;r++){for(o=0;o<e[r];o++){for((c=a.pop()).children[c.index]=n[t];c.index>0;)c=a.pop();for(c.index++,a.push(c);a.length<=r;)a.push(s={children:[],index:0}),c.children[c.index]=s.children,c=s;t++}r+1<i&&(a.push(s={children:[],index:0}),c.children[c.index]=s.children,c=s)}return a[0].children}function h(e,n,r){return 64*((e.blocksPerLine+1)*n+r)}function m(r,o,t,a,i,s,c,f,l){var u=t.mcusPerLine,m=t.progressive,v=o,d=0,b=0;function k(){if(b>0)return b--,d>>b&1;if(255===(d=r[o++])){var n=r[o++];if(n)throw new e("unexpected marker "+(d<<8|n).toString(16))}return b=7,d>>>7}function g(n){for(var r=n;;){if("number"==typeof(r=r[k()]))return r;if("object"!=typeof r)throw new e("invalid huffman sequence")}}function C(e){for(var n=0;e>0;)n=n<<1|k(),e--;return n}function w(e){if(1===e)return 1===k()?1:-1;var n=C(e);return n>=1<<e-1?n:n+(-1<<e)+1}var x,D=0,y=0;function T(e,n,r,o,t){var a=r%u;n(e,h(e,(r/u|0)*e.v+o,a*e.h+t))}function P(e,n,r){n(e,h(e,r/e.blocksPerLine|0,r%e.blocksPerLine))}var L,A,_,U,I,z,M=a.length;z=m?0===s?0===f?function(e,n){var r=g(e.huffmanTableDC),o=0===r?0:w(r)<<l;e.blockData[n]=e.pred+=o}:function(e,n){e.blockData[n]|=k()<<l}:0===f?function(e,r){if(D>0)D--;else for(var o=s,t=c;o<=t;){var a=g(e.huffmanTableAC),i=15&a,f=a>>4;if(0!==i){var u=n[o+=f];e.blockData[r+u]=w(i)*(1<<l),o++}else{if(f<15){D=C(f)+(1<<f)-1;break}o+=16}}}:function(r,o){for(var t,a,i=s,f=c,u=0;i<=f;){var h=n[i];switch(y){case 0:if(u=(a=g(r.huffmanTableAC))>>4,0==(t=15&a))u<15?(D=C(u)+(1<<u),y=4):(u=16,y=1);else{if(1!==t)throw new e("invalid ACn encoding");x=w(t),y=u?2:3}continue;case 1:case 2:r.blockData[o+h]?r.blockData[o+h]+=k()<<l:0===--u&&(y=2===y?3:0);break;case 3:r.blockData[o+h]?r.blockData[o+h]+=k()<<l:(r.blockData[o+h]=x<<l,y=0);break;case 4:r.blockData[o+h]&&(r.blockData[o+h]+=k()<<l)}i++}4===y&&0===--D&&(y=0)}:function(e,r){var o=g(e.huffmanTableDC),t=0===o?0:w(o);e.blockData[r]=e.pred+=t;for(var a=1;a<64;){var i=g(e.huffmanTableAC),s=15&i,c=i>>4;if(0!==s){var f=n[a+=c];e.blockData[r+f]=w(s),a++}else{if(c<15)break;a+=16}}};var Y,q,S,H,R=0;for(q=1===M?a[0].blocksPerLine*a[0].blocksPerColumn:u*t.mcusPerColumn;R<q;){var j=i?Math.min(q-R,i):q;for(A=0;A<M;A++)a[A].pred=0;if(D=0,1===M)for(L=a[0],I=0;I<j;I++)P(L,z,R),R++;else for(I=0;I<j;I++){for(A=0;A<M;A++)for(S=(L=a[A]).h,H=L.v,_=0;_<H;_++)for(U=0;U<S;U++)T(L,z,R,_,U);R++}b=0,(Y=p(r,o))&&Y.invalid&&(console.log("decodeScan - unexpected MCU data, next marker is: "+Y.invalid),o=Y.offset);var E=Y&&Y.marker;if(!E||E<=65280)throw new e("marker was not found");if(!(E>=65488&&E<=65495))break;o+=2}return(Y=p(r,o))&&Y.invalid&&(console.log("decodeScan - unexpected Scan data, next marker is: "+Y.invalid),o=Y.offset),o-v}function v(n,l,u){var h,m,v,d,p,b,k,g,C,w,x,D,y,T,P,L,A,_=n.quantizationTable,U=n.blockData;if(!_)throw new e("missing required Quantization Table.");for(var I=0;I<64;I+=8)C=U[l+I],w=U[l+I+1],x=U[l+I+2],D=U[l+I+3],y=U[l+I+4],T=U[l+I+5],P=U[l+I+6],L=U[l+I+7],C*=_[I],0!==(w|x|D|y|T|P|L)?(w*=_[I+1],x*=_[I+2],D*=_[I+3],y*=_[I+4],T*=_[I+5],P*=_[I+6],L*=_[I+7],m=(h=(h=c*C+128>>8)+(m=c*y+128>>8)+1>>1)-m,A=(v=x)*s+(d=P)*i+128>>8,v=v*i-d*s+128>>8,k=(p=(p=f*(w-L)+128>>8)+(k=T<<4)+1>>1)-k,b=(g=(g=f*(w+L)+128>>8)+(b=D<<4)+1>>1)-b,d=(h=h+(d=A)+1>>1)-d,v=(m=m+v+1>>1)-v,A=p*a+g*t+2048>>12,p=p*t-g*a+2048>>12,g=A,A=b*o+k*r+2048>>12,b=b*r-k*o+2048>>12,k=A,u[I]=h+g,u[I+7]=h-g,u[I+1]=m+k,u[I+6]=m-k,u[I+2]=v+b,u[I+5]=v-b,u[I+3]=d+p,u[I+4]=d-p):(A=c*C+512>>10,u[I]=A,u[I+1]=A,u[I+2]=A,u[I+3]=A,u[I+4]=A,u[I+5]=A,u[I+6]=A,u[I+7]=A);for(var z=0;z<8;++z)C=u[z],0!==((w=u[z+8])|(x=u[z+16])|(D=u[z+24])|(y=u[z+32])|(T=u[z+40])|(P=u[z+48])|(L=u[z+56]))?(m=(h=4112+((h=c*C+2048>>12)+(m=c*y+2048>>12)+1>>1))-m,A=(v=x)*s+(d=P)*i+2048>>12,v=v*i-d*s+2048>>12,d=A,k=(p=(p=f*(w-L)+2048>>12)+(k=T)+1>>1)-k,b=(g=(g=f*(w+L)+2048>>12)+(b=D)+1>>1)-b,A=p*a+g*t+2048>>12,p=p*t-g*a+2048>>12,g=A,A=b*o+k*r+2048>>12,b=b*r-k*o+2048>>12,C=(C=(h=h+d+1>>1)+g)<16?0:C>=4080?255:C>>4,w=(w=(m=m+v+1>>1)+(k=A))<16?0:w>=4080?255:w>>4,x=(x=(v=m-v)+b)<16?0:x>=4080?255:x>>4,D=(D=(d=h-d)+p)<16?0:D>=4080?255:D>>4,y=(y=d-p)<16?0:y>=4080?255:y>>4,T=(T=v-b)<16?0:T>=4080?255:T>>4,P=(P=m-k)<16?0:P>=4080?255:P>>4,L=(L=h-g)<16?0:L>=4080?255:L>>4,U[l+z]=C,U[l+z+8]=w,U[l+z+16]=x,U[l+z+24]=D,U[l+z+32]=y,U[l+z+40]=T,U[l+z+48]=P,U[l+z+56]=L):(A=(A=c*C+8192>>14)<-2040?0:A>=2024?255:A+2056>>4,U[l+z]=A,U[l+z+8]=A,U[l+z+16]=A,U[l+z+24]=A,U[l+z+32]=A,U[l+z+40]=A,U[l+z+48]=A,U[l+z+56]=A)}function d(e,n){for(var r=n.blocksPerLine,o=n.blocksPerColumn,t=new Int16Array(64),a=0;a<o;a++)for(var i=0;i<r;i++)v(n,h(n,a,i),t);return n.blockData}function p(e,n,r){function o(n){return e[n]<<8|e[n+1]}var t=e.length-1,a=r<n?r:n;if(n>=t)return null;var i=o(n);if(i>=65472&&i<=65534)return{invalid:null,marker:i,offset:n};for(var s=o(a);!(s>=65472&&s<=65534);){if(++a>=t)return null;s=o(a)}return{invalid:i.toString(16),marker:s,offset:a}}return l.prototype={parse:function(r){function o(){var e=r[c]<<8|r[c+1];return c+=2,e}function t(){var e=o(),n=c+e-2,t=p(r,n,c);t&&t.invalid&&(console.log("readDataBlock - incorrect length, next marker is: "+t.invalid),n=t.offset);var a=r.subarray(c,n);return c+=a.length,a}function a(e){for(var n=Math.ceil(e.samplesPerLine/8/e.maxH),r=Math.ceil(e.scanLines/8/e.maxV),o=0;o<e.components.length;o++){R=e.components[o];var t=Math.ceil(Math.ceil(e.samplesPerLine/8)*R.h/e.maxH),a=Math.ceil(Math.ceil(e.scanLines/8)*R.v/e.maxV),i=n*R.h,s=r*R.v*64*(i+1);R.blockData=new Int16Array(s),R.blocksPerLine=t,R.blocksPerColumn=a}e.mcusPerLine=n,e.mcusPerColumn=r}var i,s,c=0,f=null,l=null,h=[],v=[],b=[],k=o();if(65496!==k)throw new e("SOI not found");for(k=o();65497!==k;){var g,C,w;switch(k){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var x=t();65504===k&&74===x[0]&&70===x[1]&&73===x[2]&&70===x[3]&&0===x[4]&&(f={version:{major:x[5],minor:x[6]},densityUnits:x[7],xDensity:x[8]<<8|x[9],yDensity:x[10]<<8|x[11],thumbWidth:x[12],thumbHeight:x[13],thumbData:x.subarray(14,14+3*x[12]*x[13])}),65518===k&&65===x[0]&&100===x[1]&&111===x[2]&&98===x[3]&&101===x[4]&&(l={version:x[5]<<8|x[6],flags0:x[7]<<8|x[8],flags1:x[9]<<8|x[10],transformCode:x[11]});break;case 65499:for(var D=o()+c-2;c<D;){var y=r[c++],T=new Uint16Array(64);if(y>>4){if(y>>4!=1)throw new e("DQT - invalid table spec");for(C=0;C<64;C++)T[n[C]]=o()}else for(C=0;C<64;C++)T[n[C]]=r[c++];h[15&y]=T}break;case 65472:case 65473:case 65474:if(i)throw new e("Only single frame JPEGs supported");o(),(i={}).extended=65473===k,i.progressive=65474===k,i.precision=r[c++],i.scanLines=o(),i.samplesPerLine=o(),i.components=[],i.componentIds={};var P,L=r[c++],A=0,_=0;for(g=0;g<L;g++){P=r[c];var U=r[c+1]>>4,I=15&r[c+1];A<U&&(A=U),_<I&&(_=I);var z=r[c+2];w=i.components.push({h:U,v:I,quantizationId:z,quantizationTable:null}),i.componentIds[P]=w-1,c+=3}i.maxH=A,i.maxV=_,a(i);break;case 65476:var M=o();for(g=2;g<M;){var Y=r[c++],q=new Uint8Array(16),S=0;for(C=0;C<16;C++,c++)S+=q[C]=r[c];var H=new Uint8Array(S);for(C=0;C<S;C++,c++)H[C]=r[c];g+=17+S,(Y>>4?v:b)[15&Y]=u(q,H)}break;case 65501:o(),s=o();break;case 65498:o();var R,j=r[c++],E=[];for(g=0;g<j;g++){var J=i.componentIds[r[c++]];R=i.components[J];var V=r[c++];R.huffmanTableDC=b[V>>4],R.huffmanTableAC=v[15&V],E.push(R)}var B=r[c++],N=r[c++],G=r[c++],O=m(r,c,i,E,s,B,N,G>>4,15&G);c+=O;break;case 65535:255!==r[c]&&c--;break;default:if(255===r[c-3]&&r[c-2]>=192&&r[c-2]<=254){c-=3;break}throw new e("unknown marker "+k.toString(16))}k=o()}for(this.width=i.samplesPerLine,this.height=i.scanLines,this.jfif=f,this.eof=c,this.adobe=l,this.components=[],g=0;g<i.components.length;g++){var Q=h[(R=i.components[g]).quantizationId];Q&&(R.quantizationTable=Q),this.components.push({output:d(0,R),scaleX:R.h/i.maxH,scaleY:R.v/i.maxV,blocksPerLine:R.blocksPerLine,blocksPerColumn:R.blocksPerColumn})}this.numComponents=this.components.length},_getLinearizedBlockData:function(e,n){var r,o,t,a,i,s,c,f,l,u,h,m=this.width/e,v=this.height/n,d=0,p=this.components.length,b=e*n*p,k=new Uint8ClampedArray(b),g=new Uint32Array(e),C=4294967288;for(c=0;c<p;c++){for(o=(r=this.components[c]).scaleX*m,t=r.scaleY*v,d=c,h=r.output,a=r.blocksPerLine+1<<3,i=0;i<e;i++)f=0|i*o,g[i]=(f&C)<<3|7&f;for(s=0;s<n;s++)for(u=a*((f=0|s*t)&C)|(7&f)<<3,i=0;i<e;i++)k[d]=h[u+g[i]],d+=p}var w=this.decodeTransform;if(w)for(c=0;c<b;)for(f=0,l=0;f<p;f++,c++,l+=2)k[c]=(k[c]*w[l]>>8)+w[l+1];return k},_isColorConversionNeeded:function(){return this.adobe?!!this.adobe.transformCode:3===this.numComponents?0!==this.colorTransform:1===this.colorTransform},_convertYccToRgb:function(e){for(var n,r,o,t=0,a=e.length;t<a;t+=3)n=e[t],r=e[t+1],o=e[t+2],e[t]=n-179.456+1.402*o,e[t+1]=n+135.459-.344*r-.714*o,e[t+2]=n-226.816+1.772*r;return e},_convertYcckToRgb:function(e){for(var n,r,o,t,a=0,i=0,s=e.length;i<s;i+=4)n=e[i],r=e[i+1],o=e[i+2],t=e[i+3],e[a++]=r*(-660635669420364e-19*r+.000437130475926232*o-54080610064599e-18*n+.00048449797120281*t-.154362151871126)-122.67195406894+o*(-.000957964378445773*o+.000817076911346625*n-.00477271405408747*t+1.53380253221734)+n*(.000961250184130688*n-.00266257332283933*t+.48357088451265)+t*(-.000336197177618394*t+.484791561490776),e[a++]=107.268039397724+r*(219927104525741e-19*r-.000640992018297945*o+.000659397001245577*n+.000426105652938837*t-.176491792462875)+o*(-.000778269941513683*o+.00130872261408275*n+.000770482631801132*t-.151051492775562)+n*(.00126935368114843*n-.00265090189010898*t+.25802910206845)+t*(-.000318913117588328*t-.213742400323665),e[a++]=r*(-.000570115196973677*r-263409051004589e-19*o+.0020741088115012*n-.00288260236853442*t+.814272968359295)-20.810012546947+o*(-153496057440975e-19*o-.000132689043961446*n+.000560833691242812*t-.195152027534049)+n*(.00174418132927582*n-.00255243321439347*t+.116935020465145)+t*(-.000343531996510555*t+.24165260232407);return e},_convertYcckToCmyk:function(e){for(var n,r,o,t=0,a=e.length;t<a;t+=4)n=e[t],r=e[t+1],o=e[t+2],e[t]=434.456-n-1.402*o,e[t+1]=119.541-n+.344*r+.714*o,e[t+2]=481.816-n-1.772*r;return e},_convertCmykToRgb:function(e){for(var n,r,o,t,a=0,i=1/255,s=0,c=e.length;s<c;s+=4)n=e[s]*i,r=e[s+1]*i,o=e[s+2]*i,t=e[s+3]*i,e[a++]=255+n*(-4.387332384609988*n+54.48615194189176*r+18.82290502165302*o+212.25662451639585*t-285.2331026137004)+r*(1.7149763477362134*r-5.6096736904047315*o-17.873870861415444*t-5.497006427196366)+o*(-2.5217340131683033*o-21.248923337353073*t+17.5119270841813)-t*(21.86122147463605*t+189.48180835922747),e[a++]=255+n*(8.841041422036149*n+60.118027045597366*r+6.871425592049007*o+31.159100130055922*t-79.2970844816548)+r*(-15.310361306967817*r+17.575251261109482*o+131.35250912493976*t-190.9453302588951)+o*(4.444339102852739*o+9.8632861493405*t-24.86741582555878)-t*(20.737325471181034*t+187.80453709719578),e[a++]=255+n*(.8842522430003296*n+8.078677503112928*r+30.89978309703729*o-.23883238689178934*t-14.183576799673286)+r*(10.49593273432072*r+63.02378494754052*o+50.606957656360734*t-112.23884253719248)+o*(.03296041114873217*o+115.60384449646641*t-193.58209356861505)-t*(22.33816807309886*t+180.12613974708367);return e},getData:function(n,r,o){if(this.numComponents>4)throw new e("Unsupported color mode");var t=this._getLinearizedBlockData(n,r);if(1===this.numComponents&&o){for(var a=t.length,i=new Uint8ClampedArray(3*a),s=0,c=0;c<a;c++){var f=t[c];i[s++]=f,i[s++]=f,i[s++]=f}return i}if(3===this.numComponents&&this._isColorConversionNeeded())return this._convertYccToRgb(t);if(4===this.numComponents){if(this._isColorConversionNeeded())return o?this._convertYcckToRgb(t):this._convertYcckToCmyk(t);if(o)return this._convertCmykToRgb(t)}return t}},l}();return n}(),void 0!==t&&(o.exports=t)),a.exports);const s=n.getDefaultExportFromCjs(i);e.JpegImage=s});