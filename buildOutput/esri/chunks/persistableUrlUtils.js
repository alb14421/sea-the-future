// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../kernel","../core/urlUtils","../portal/support/urlUtils"],function(e,t,r,o){"use strict";function n(e,t){const o=t?.url?.path;if(e&&o&&(e=r.makeAbsolute(e,o,{preserveProtocolRelative:!0}),t.portalItem&&t.readResourcePaths)){const o=r.makeRelative(e,t.portalItem.itemUrl);null!=o&&o.startsWith(c)&&t.readResourcePaths.push(t.portalItem.resourceFromPath(o).path)}return(e=f(e,t?.portal))&&a.test(e)?h(e):e}function l(e,t,o=0){if(null==(e=e&&a.test(e)?d(e):e))return e;!r.isAbsolute(e)&&t?.blockedRelativeUrls&&t.blockedRelativeUrls.push(e);let n=r.makeAbsolute(e);if(t){const o=t.verifyItemRelativeUrls?.rootPath||t.url?.path;if(o){const l=f(o,t.portal),s=f(n,t.portal);n=r.makeRelative(s,l,l),null!=n&&n!==s&&n!==e&&t.verifyItemRelativeUrls&&t.verifyItemRelativeUrls.writtenUrls.push(n)}}return n=p(n,t?.portal),r.isAbsolute(n)&&(n=r.normalize(n)),t?.resources&&t?.portalItem&&!r.isAbsolute(n)&&!r.isDataProtocol(n)&&0===o&&t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(n),compress:!1}),n}function s(e,t,r){return n(e,r)}function i(e,t,r,o){const n=l(e,o);void 0!==n&&(t[r]=n)}const a=/\/items\/([^/]+)\/resources\/(.*)/,c="./resources/";function u(e){const t=e?.match(a)??null;return t?.[1]??null}function m(e){const t=e?.match(a)??null;if(null==t)return null;const o=t[2],n=o.lastIndexOf("/");if(-1===n){const{path:e,extension:t}=r.splitPathExtension(o);return{prefix:null,filename:e,extension:t}}const{path:l,extension:s}=r.splitPathExtension(o.slice(n+1));return{prefix:o.slice(0,n),filename:l,extension:s}}function p(e,t){return t&&!t.isPortal&&t.urlKey&&t.customBaseUrl?r.changeDomain(e,`${t.urlKey}.${t.customBaseUrl}`,t.portalHostname):e}function f(e,t){if(!t||t.isPortal||!t.urlKey||!t.customBaseUrl)return e;const o=`${t.urlKey}.${t.customBaseUrl}`,n=r.getAppUrl();return r.hasSameOrigin(n,`${n.scheme}://${o}`)?r.changeDomain(e,t.portalHostname,o):r.changeDomain(e,o,t.portalHostname)}function h(e){if(!e)return e||null;let r=e;return r&&t.id&&!t.id.findCredential(r)&&(r=o.normalizeArcGISOnlineOrgDomain(r),r=r.replace(/^https?:\/\/www\.arcgis\.com/,"https://cdn.arcgis.com"),r=r.replace(/^https?:\/\/devext\.arcgis\.com/,"https://cdndev.arcgis.com"),r=r.replace(/^https?:\/\/qaext\.arcgis\.com/,"https://cdnqa.arcgis.com")),r}function d(e){if(!e)return e||null;let r=e;return r=r.replace(/^https?:\/\/cdn\.arcgis\.com/,"https://www.arcgis.com"),r=r.replace(/^https?:\/\/cdndev\.arcgis\.com/,"https://devext.arcgis.com"),r=r.replace(/^https?:\/\/cdnqa\.arcgis\.com/,"https://qaext.arcgis.com"),r&&t.id&&!t.id.findCredential(r)&&(r=o.normalizeArcGISOnlineOrgDomain(r)),r}const U=Object.freeze(Object.defineProperty({__proto__:null,ensureMainOnlineDomain:p,fromCDNUrl:d,fromJSON:n,itemIdFromResourceUrl:u,prefixAndFilenameFromResourceUrl:m,read:s,toCDNUrl:h,toJSON:l,write:i},Symbol.toStringTag,{value:"Module"}));e.ensureMainOnlineDomain=p,e.fromCDNUrl=d,e.fromJSON=n,e.itemIdFromResourceUrl=u,e.persistableUrlUtils=U,e.prefixAndFilenameFromResourceUrl=m,e.read=s,e.toCDNUrl=h,e.toJSON=l,e.write=i});