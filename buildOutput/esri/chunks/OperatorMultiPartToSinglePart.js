// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./SimpleGeometryCursor","./MultiPathImpl","./Geometry","./Envelope2D","./Envelope","./ProjectionTransformation"],function(e,t,r,n,s,o,i){"use strict";class a extends t.GeometryCursor{constructor(e,t,r,n){super(),this.m_progressTracker=r,this.m_inputGeoms=e,this.m_spatialReference=t,this.m_currentGeometry=null,this.m_singlePartIndex=-1,this.m_singlePartCount=-1,this.m_polygonStart=-1,this.m_index=-1,this.m_options=n}tock(){return!0}getRank(){return 1}next(){if(this.m_singlePartIndex===this.m_singlePartCount){const t=this.m_inputGeoms.next();if(null===t)return null;if(n.throwIfMesh(t),t.getGeometryType()===n.GeometryType.enumPolygon)if(1===this.m_options)this.m_currentGeometry=(new i.OperatorSimplify).execute(t,this.m_spatialReference,!1,this.m_progressTracker);else if(2===this.m_options)if(t.getPathCount()<2)this.m_currentGeometry=t;else{const e=[0],a=t.getImpl().getIsSimple(0,e);if(o.isAtLeastPlanarSimple(a))this.m_currentGeometry=t;else{const e=new r.EditShape,a=e.addGeometry(t);let l=null;if(e.hasCurves()){l=new i.CurveStitcher;const r=new s.Envelope2D;t.queryEnvelope(r);const n=o.calculateToleranceFromGeometryForOpFromGeom(null,t,!0),a=i.densificationDeviationFromTolerance(n.total(),r);i.buildSegmentParentageForIsSimple(e,a,n.total(),12e3,null,l,null,this.m_progressTracker)}const m=e.createPathUserIndex();{let t=0;for(let n=e.getFirstPath(a);n!==r.nullHandle;n=e.getNextPath(n))e.setPathUserIndex(n,m,t++)}const u=i.executeMp2sp(e,a,this.m_progressTracker);n.geometryReleaseAssert(u>=0);const g=[];for(let t=e.getFirstPath(a);t!==r.nullHandle;t=e.getNextPath(t))g.push(t);g.sort((t,r)=>Math.abs(e.getPathUserIndex(t,u))-Math.abs(e.getPathUserIndex(r,u)));const h=t,c=new r.Polygon({vd:t.getDescription()});c.reserveParts(h.getPointCount(),h.getPathCount());for(let t=0,r=g.length;t<r;t++){const r=g[t],n=e.getPathUserIndex(r,m),s=h.calculateRingArea2D(n)>0,o=e.getPathUserIndex(r,u)>=0;c.addPath(h,n,s===o)}this.m_currentGeometry=c}}else n.throwInvalidArgumentException("");else this.m_currentGeometry=t;this.m_singlePartCount=(e=this.m_currentGeometry).isEmpty()?1:i.querySinglePartCount(e),this.m_singlePartIndex=0,this.m_polygonStart=0,this.m_index=this.m_inputGeoms.getGeometryID()}var e;const t=this.getSingleGeometry(this.m_singlePartIndex,this.m_singlePartCount,this.m_polygonStart,this.m_currentGeometry);return t.getGeometryType()===n.GeometryType.enumPolygon&&(this.m_polygonStart+=t.getPathCount()),this.m_singlePartIndex++,t}getGeometryID(){return this.m_index}getSingleGeometry(e,t,r,s){let i=null;switch(s.getGeometryType()){case n.GeometryType.enumMultiPoint:i=new o.Point({vd:s.getDescription()}),s.isEmpty()||s.getPointByVal(e,i);break;case n.GeometryType.enumPolyline:if(1===t)i=s;else{i=s.createInstance(),i.getImpl().addPath(s.getImpl(),e,!0);const t=[0],r=s.getImpl().getIsSimple(0,t);i.getImpl().setIsSimple(r,t[0],!0)}break;case n.GeometryType.enumPolygon:if(1===t)i=s;else{i=s.createInstance();const e=i.getImpl(),t=s.getImpl(),n=t.getPathFlagsStreamRef();let o=r;const a=t.getPathCount();do{e.addPath(t,o,!0),o++}while(o<a&&!(8&n.read(o)));e.getPathFlagsStreamRef().setBits(0,8);const l=[0],m=t.getIsSimple(0,l);e.setIsSimple(m,l[0],!0)}break;default:i=s}return i}}e.OperatorMultiPartToSinglePart=class{getOperatorType(){return 10700}accelerateGeometry(e,t,r){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}executeMany(e,t,r,n=1){return new a(e,t,r,n)}}});