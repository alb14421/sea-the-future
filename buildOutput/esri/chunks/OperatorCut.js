// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./SimpleGeometryCursor","./Geometry","./MultiPathImpl","./Envelope","./ProjectionTransformation"],function(e,t,n,s,o,r){"use strict";var i=r.CurveStitcher;function c(e,t){return{m_geometry:e,m_side:t}}class l extends t.GeometryCursor{constructor(e,t,n,r,i){super(),this.m_cutIndex=-1,this.m_cuts=[],this.m_progressTracker=i,this.m_cuttee=t.clone(),this.m_cutter=new s.Polyline({copy:n}),this.m_bConsiderTouch=e;const c=o.getMergedExtent(t,n);this.m_tolerance=o.calculateToleranceFromGeometryForOp(r,c,!0)}next(){return-1===this.m_cutIndex&&this.generateCuts(),++this.m_cutIndex<this.m_cuts.length?this.m_cuts[this.m_cutIndex]:null}getGeometryID(){return this.m_cutIndex}tock(){return!0}getRank(){return 1}generateCuts(){switch(this.m_cuttee.getGeometryType()){case n.GeometryType.enumPolyline:this.generatePolylineCuts();break;case n.GeometryType.enumPolygon:this.generatePolygonCuts()}}generatePolylineCuts(){const e=new s.Polyline,t=new s.Polyline,o=new s.Polyline;this.m_cuts.length=0,this.m_cuts.push(e),this.m_cuts.push(t);const l=[];!function(e,t,n,o,l,m){if(t.isEmpty()){const e=c(t,0);return void l.push(e)}if(n.isEmpty()){const e=c(t,0);return void l.push(e)}const u=[],a=new s.EditShape;{const s=a.createGeometryUserIndex(),h=a.addGeometry(t),d=a.addGeometry(n),y=new r.TopologicalOperations(m);let g=0,p=null;if(a.hasCurves()){p=new i;const e=a.getEnvelope2D(m);g=r.stitchingDensificationDeviationFromTolerance(o.total());const t=r.densificationDeviationFromTolerance(o.total(),e);r.buildSegmentParentage(a,t,o.total(),12e3,p,null,m)}a.dbgVerifyCurves(),y.setEditShapeCrackAndCluster(a,o),y.cut(e,s,h,d,u);for(const e of u){null!==p&&p.stitchCurves(a,e,g,!1);const t=c(a.getGeometry(e),r.s_IntToPublicCutSide(a.getGeometryUserIndex(e,s)));l.push(t)}null!==p&&p.clearStitcher(a)}}(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,l,this.m_progressTracker);for(let s=0;s<l.length;s++){const r=l[s];1===r.m_side?e.add(r.m_geometry,!1):2===r.m_side||4===r.m_side?t.add(r.m_geometry,!1):3===r.m_side?this.m_cuts.push(r.m_geometry):0===r.m_side?o.add(r.m_geometry,!1):n.throwInternalErrorException("")}o.isEmpty()||e.isEmpty()&&t.isEmpty()&&!(this.m_cuts.length>=3)||this.m_cuts.push(o),e.isEmpty()&&t.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}generatePolygonCuts(){const e=new s.Polygon,t=new s.Polygon,o=new s.Polygon;this.m_cuts.length=0,this.m_cuts.push(e),this.m_cuts.push(t);const l=[];!function(e,t,n,o,l,m){if(t.isEmpty()){const e=c(t,0);return void l.push(e)}if(n.isEmpty()){const e=c(t,0);return void l.push(e)}const u=[],a=new s.EditShape;{const e=a.createGeometryUserIndex(),h=a.addGeometry(t),d=a.addGeometry(n),y=new r.TopologicalOperations(m);let g=0,p=null;if(a.hasCurves()){p=new i;const e=a.getEnvelope2D(m);g=r.stitchingDensificationDeviationFromTolerance(o.total());const t=r.densificationDeviationFromTolerance(o.total(),e);r.buildSegmentParentage(a,t,o.total(),12e3,p,null,m)}a.dbgVerifyCurves(),y.setEditShapeCrackAndCluster(a,o),y.cut(!1,e,h,d,u),null!==p&&p.stitchCurves(a,s.nullHandle,g,!0);let _=a.getGeometry(h);const f=new s.Polygon,E=new s.Polygon,C=[];for(let t=0;t<u.length;t++){let n=null;{const i=new s.EditShape,c=i.addGeometry(_),l=i.addGeometry(a.getGeometry(u[t]));if(i.hasCurves()){const e=i.getEnvelope2D(m);g=r.stitchingDensificationDeviationFromTolerance(o.total());const t=r.densificationDeviationFromTolerance(o.total(),e);r.buildSegmentParentage(i,t,o.total(),12e3,p,null,m)}y.setEditShapeCrackAndCluster(i,o);const h=y.intersection(c,l);if(null!==p&&p.stitchCurves(i,s.nullHandle,g,!0),n=i.getGeometry(h),n.isEmpty())continue;const d=a.getGeometryUserIndex(u[t],e);2===d?f.add(n,!1):1===d?E.add(n,!1):C.push(n)}{const e=new s.EditShape,n=e.addGeometry(_),i=e.addGeometry(a.getGeometry(u[t]));if(e.hasCurves()){const t=e.getEnvelope2D(m);g=r.stitchingDensificationDeviationFromTolerance(o.total());const n=r.densificationDeviationFromTolerance(o.total(),t);r.buildSegmentParentage(e,n,o.total(),12e3,p,null,m)}y.setEditShapeCrackAndCluster(e,o);const c=y.difference(n,i);null!==p&&p.stitchCurves(e,s.nullHandle,g,!0),_=e.getGeometry(c)}}if(!_.isEmpty()&&u.length>0&&C.push(_),f.isEmpty()&&E.isEmpty())return;if(!f.isEmpty()){const e=c(f,1);l.push(e)}if(!E.isEmpty()){const e=c(E,2);l.push(e)}for(let e=0,t=C.length;e<t;++e){const t=c(C[e],3);l.push(t)}}}(this.m_bConsiderTouch,this.m_cuttee,this.m_cutter,this.m_tolerance,l,this.m_progressTracker);for(let s=0;s<l.length;s++){const r=l[s];1===r.m_side?e.add(r.m_geometry,!1):2===r.m_side?t.add(r.m_geometry,!1):3===r.m_side?this.m_cuts.push(r.m_geometry):0===r.m_side?o.add(r.m_geometry,!1):n.throwInternalErrorException("")}n.geometryReleaseAssert(o.isEmpty()||1===l.length),e.isEmpty()&&t.isEmpty()&&this.m_cuts.length<3&&(this.m_cuts.length=0)}}e.OperatorCut=class{getOperatorType(){return 10005}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}supportsCurves(){return!0}execute(e,t,n,s,o){return new l(e,t,n,s,o)}}});