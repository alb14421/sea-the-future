// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./dom"],function(e,t){"use strict";const n="calciteInternalLabelClick",l="calciteInternalLabelConnected",o="calciteInternalLabelDisconnected",s="calcite-label",a=new WeakMap,i=new WeakMap,c=new WeakMap,r=new WeakMap,d=new Set;function u(e){if(!e)return;const u=(e=>{const{id:n}=e,l=n&&t.queryElementRoots(e,{selector:`${s}[for="${n}"]`});if(l)return l;const o=t.closestElementCrossShadowBoundary(e,s);return!o||function(e,t){let n;const l="custom-element-ancestor-check",o=l=>{l.stopImmediatePropagation();const o=l.composedPath();n=o.slice(o.indexOf(t),o.indexOf(e))};return e.addEventListener(l,o,{once:!0}),t.dispatchEvent(new CustomEvent(l,{composed:!0,bubbles:!0})),e.removeEventListener(l,o),n.filter(n=>n!==t&&n!==e).filter(e=>e.tagName?.includes("-")).length>0}(o,e)?null:o})(e.el);if(i.has(u)&&u===e.labelEl||!u&&d.has(e))return;const f=m.bind(e);if(u){e.labelEl=u;const t=a.get(u)||[];t.push(e),a.set(u,t.sort(b)),i.has(e.labelEl)||(i.set(e.labelEl,E),e.labelEl.addEventListener(n,E)),d.delete(e),document.removeEventListener(l,c.get(e)),r.set(e,f),document.addEventListener(o,f)}else d.has(e)||(f(),document.removeEventListener(o,r.get(e)))}function b(e,n){return t.isBefore(e.el,n.el)?-1:1}function E(e){const t=e.detail.sourceEvent.target,n=a.get(this),l=n.find(e=>e.el===t);if(n.includes(l))return;const o=n[0];o.disabled||o.onLabelClick(e)}function f(){d.has(this)&&u(this)}function m(){d.add(this);const e=c.get(this)||f.bind(this);c.set(this,e),document.addEventListener(l,e)}e.associateExplicitLabelToUnlabeledComponent=async function(e){if(await e.componentOnReady(),a.has(e))return;const t=e.ownerDocument?.getElementById(e.for);t&&requestAnimationFrame(()=>{for(const e of d)if(e.el===t){u(e);break}})},e.connectLabel=u,e.disconnectLabel=function(e){if(!e)return;if(d.delete(e),document.removeEventListener(l,c.get(e)),document.removeEventListener(o,r.get(e)),c.delete(e),r.delete(e),!e.labelEl)return;const t=a.get(e.labelEl);1===t.length&&(e.labelEl.removeEventListener(n,i.get(e.labelEl)),i.delete(e.labelEl)),a.set(e.labelEl,t.filter(t=>t!==e).sort(b)),e.labelEl=null},e.getLabelText=function(e){return e.label||e.labelEl?.textContent?.trim()||""},e.labelConnectedEvent=l,e.labelDisconnectedEvent=o});