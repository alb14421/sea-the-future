// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./index68","./index7","./index31","./index61","./customElement","./index28","./componentsUtils","./ref","./keyed","./dom","./component","./index72","./index32","./index2","./index70","./index71","./index69","./repeat","./interactive","./key","./math","./useT9n","./observers","./throttle"],function(e,t,a,i,n,l,o,s,r,h,c,d,p,u,C,S,v,m,f,g,x,y,b,I,w){"use strict";const $=s.i`:host{display:block}.container{display:flex;inline-size:100%;flex-wrap:nowrap;align-items:center}.hex-input{flex-grow:1;text-transform:uppercase}.opacity-input{inline-size:100px;margin-inline-start:-1px}:host([hidden]){display:none}[hidden]{display:none}`,T=t.Color();class D extends s.LitElement{constructor(){super(...arguments),this.internalColor=T,this.alphaChannel=!1,this.allowEmpty=!1,this.hexLabel="Hex",this.scale="m",this.value=t.normalizeHex(t.hexify(T,this.alphaChannel),this.alphaChannel,!0),this.calciteColorPickerHexInputChange=s.createEvent({cancelable:!1})}static{this.properties={internalColor:[16,{},{state:!0}],alphaChannel:[5,{},{type:Boolean}],allowEmpty:[5,{},{type:Boolean}],hexLabel:1,messages:[0,{},{attribute:!1}],numberingSystem:1,scale:[3,{},{reflect:!0}],value:[3,{},{reflect:!0}]}}static{this.styles=$}async setFocus(){return await d.componentFocusable(this),c.focusElement(this.hexInputNode)}connectedCallback(){super.connectedCallback(),this.previousNonNullValue=this.value;const{allowEmpty:e,alphaChannel:a,value:i}=this;if(i){const e=t.normalizeHex(i,a);return void(t.isValidHex(e,a)&&this.internalSetValue(e,e,!1))}e&&this.internalSetValue(void 0,void 0,!1)}willUpdate(e){e.has("value")&&(this.hasUpdated||this.value!==t.normalizeHex(t.hexify(T,this.alphaChannel),this.alphaChannel,!0))&&this.internalSetValue(this.value,e.get("value"),!1)}onHexInputBlur(){const e=this.hexInputNode,a=e.value,i=`#${a}`,{allowEmpty:n,internalColor:l}=this,o=n&&!a,s=t.isLonghandHex(i);(t.isShorthandHex(i,!0)||t.isShorthandHex(i,!1))&&this.onHexInputChange(),o||t.isValidHex(i)&&s||(e.value=n&&!l?"":this.formatHexForInternalInput(t.rgbToHex(l.object())))}onOpacityInputBlur(){const e=this.opacityInputNode,t=e.value,{allowEmpty:a,internalColor:i}=this;a&&!t||(e.value=a&&!i?"":this.formatOpacityForInternalInput(i))}onOpacityInputInput(){this.onOpacityInputChange()}onHexInputChange(){let e=this.hexInputNode.value;if(e){const a=t.normalizeHex(e,!1);t.isValidHex(a)&&this.alphaChannel&&this.internalColor&&(e=`${a+t.normalizeHex(this.internalColor.hexa(),!0).slice(-2)}`)}this.internalSetValue(e,this.value)}onOpacityInputChange(){const e=this.opacityInputNode;let a;if(e.value){const i=t.opacityToAlpha(Number(e.value));a=this.internalColor?.alpha(i).hexa()}else a=e.value;this.internalSetValue(a,this.value)}onInputFocus(e){"calciteInternalInputTextFocus"===e.type?this.hexInputNode.selectText():this.opacityInputNode.selectText()}onHexInputInput(){const e=`#${this.hexInputNode.value}`,a=this.value;t.isValidHex(e,this.alphaChannel)&&t.isLonghandHex(e,this.alphaChannel)&&this.internalSetValue(e,a)}onInputKeyDown(e){const{altKey:a,ctrlKey:i,metaKey:n,shiftKey:l}=e,{alphaChannel:o,hexInputNode:s,internalColor:r,value:h}=this,{key:c}=e,d=e.composedPath();if("Tab"===c&&t.isShorthandHex(h,this.alphaChannel)||"Enter"===c)return d.includes(s)?this.onHexInputChange():this.onOpacityInputChange(),void("Enter"===c&&e.preventDefault());const p="ArrowDown"===c||"ArrowUp"===c,u=this.value;if(p){if(!h)return this.internalSetValue(this.previousNonNullValue,u),void e.preventDefault();const a="ArrowUp"===c?1:-1,i=l?10:1;return this.internalSetValue(t.hexify(this.nudgeRGBChannels(r,i*a,d.includes(s)?"rgb":"a"),o),u),void e.preventDefault()}const C=a||i||n,S=1===c.length,v=t.hexChar.test(c);!S||C||v||e.preventDefault()}onHexInputPaste(e){const a=e.clipboardData.getData("text");t.isValidHex(a,this.alphaChannel)&&t.isLonghandHex(a,this.alphaChannel)&&(e.preventDefault(),this.hexInputNode.value=a.slice(1),this.internalSetValue(a,this.value))}internalSetValue(e,a,i=!0){if(e){const{alphaChannel:a}=this,n=t.normalizeHex(e,a,a);if(t.isValidHex(n,a)){const{internalColor:e}=this,l=t.Color(n),o=t.normalizeHex(t.hexify(l,a),a),s=!e||o!==t.normalizeHex(t.hexify(e,a),a);return this.internalColor=l,this.previousNonNullValue=o,this.value=o,void(s&&i&&this.calciteColorPickerHexInputChange.emit())}}else if(this.allowEmpty)return this.internalColor=void 0,this.value=void 0,void(i&&this.calciteColorPickerHexInputChange.emit());this.value=a}storeHexInputRef(e){this.hexInputNode=e}storeOpacityInputRef(e){this.opacityInputNode=e}formatHexForInternalInput(e){return e?e.replace("#","").slice(0,6):""}formatOpacityForInternalInput(e){return e?`${t.alphaToOpacity(e.alpha())}`:""}nudgeRGBChannels(e,a,i){let n;const l=e.array(),o=l.slice(0,3);if("rgb"===i)n=[...o.map(e=>e+a),this.alphaChannel?l[3]:void 0];else{const i=t.opacityToAlpha(t.alphaToOpacity(e.alpha())+a);n=[...o,i]}return t.Color(n)}render(){const{alphaChannel:e,hexLabel:a,internalColor:i,messages:n,scale:l,value:o}=this,c=this.formatHexForInternalInput(o),d=this.formatOpacityForInternalInput(i),p="l"===l?"m":"s";return s.x`<div class=${s.safeClassMap("container")}><calcite-input-text class=${s.safeClassMap("hex-input")} .label=${n?.hex||a} .maxLength=${this.alphaChannel?8:6} @keydown=${this.onInputKeyDown} @paste=${this.onHexInputPaste} @calciteInputTextChange=${this.onHexInputChange} @calciteInputTextInput=${this.onHexInputInput} @calciteInternalInputTextBlur=${this.onHexInputBlur} @calciteInternalInputTextFocus=${this.onInputFocus} prefix-text=# .scale=${p} .value=${c} ${r.n(this.storeHexInputRef)}></calcite-input-text>${e?h.i("opacity-input",s.x`<calcite-input-number class=${s.safeClassMap("opacity-input")} .label=${n?.opacity} .max=${t.OPACITY_LIMITS.max} max-length=3 .min=${t.OPACITY_LIMITS.min} number-button-type=none .numberingSystem=${this.numberingSystem} @keydown=${this.onInputKeyDown} @calciteInputNumberInput=${this.onOpacityInputInput} @calciteInternalInputNumberBlur=${this.onOpacityInputBlur} @calciteInternalInputNumberFocus=${this.onInputFocus} .scale=${p} suffix-text=% .value=${d} ${r.n(this.storeOpacityInputRef)}></calcite-input-number>`):null}</div>`}}s.customElement("calcite-color-picker-hex-input",D);const A=s.i`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{display:inline-block;font-size:var(--calcite-font-size--2);line-height:1rem;font-weight:var(--calcite-font-weight-normal);inline-size:var(--calcite-internal-color-picker-min-width);min-inline-size:var(--calcite-internal-color-picker-min-width)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}:host([scale=s]){--calcite-internal-color-picker-min-width: 200px;--calcite-color-picker-spacing: 8px}:host([scale=s]) .saved-colors{gap:.25rem;grid-template-columns:repeat(auto-fill,20px)}:host([scale=m]){--calcite-internal-color-picker-min-width: 240px;--calcite-color-picker-spacing: 12px}:host([scale=l]){--calcite-internal-color-picker-min-width: 304px;--calcite-color-picker-spacing: 16px;font-size:var(--calcite-font-size--1);line-height:1rem}:host([scale=l]) .section:first-of-type{padding-block-start:var(--calcite-color-picker-spacing)}:host([scale=l]) .saved-colors{grid-template-columns:repeat(auto-fill,32px)}:host([scale=l]) .control-section{display:flex;flex-direction:column;flex-wrap:wrap;align-items:baseline}:host([scale=l]) .color-hex-options{inline-size:100%;display:flex;flex-shrink:1;flex-direction:column;justify-content:space-around}:host([scale=l]) .color-mode-container{flex-shrink:3}.container{background-color:var(--calcite-color-foreground-1);display:flex;flex-direction:column;block-size:min-content;border:1px solid var(--calcite-color-border-1)}.control-and-scope{position:relative;display:flex;cursor:pointer;touch-action:none}.color-field,.control-and-scope{-webkit-user-select:none;user-select:none}.scope{pointer-events:none;position:absolute;z-index:var(--calcite-z-index);block-size:1px;inline-size:1px;border-radius:9999px;background-color:transparent;font-size:var(--calcite-font-size--1);outline-color:transparent}.scope:focus{outline:2px solid var(--calcite-color-focus, var(--calcite-ui-focus-color, var(--calcite-color-brand)));outline-offset:calc(2px*(1 - (2*clamp(0,var(--calcite-offset-invert-focus),1))));outline-offset:6px}.hex-and-channels-group{display:flex;inline-size:100%;flex-direction:column;flex-wrap:wrap}.section{padding-block:0 var(--calcite-color-picker-spacing);padding-inline:var(--calcite-color-picker-spacing)}.section:first-of-type{padding-block-start:var(--calcite-color-picker-spacing)}.sliders{display:flex;flex-direction:column;justify-content:space-between;margin-inline-start:var(--calcite-color-picker-spacing);gap:var(--calcite-spacing-xxs)}.preview-and-sliders{display:flex;align-items:center;padding:var(--calcite-color-picker-spacing)}.color-hex-options,.section--split{flex-grow:1}.header{display:flex;align-items:center;justify-content:space-between;color:var(--calcite-color-text-1)}.color-mode-container{padding-block-start:var(--calcite-color-picker-spacing)}.channels{display:flex}.channel{flex-grow:1}.channel[data-channel-index="3"]{margin-inline-start:-1px;min-inline-size:81px}:host([scale=s]) .channel[data-channel-index="3"]{min-inline-size:68px}:host([scale=l]) .channel[data-channel-index="3"]{min-inline-size:88px}.saved-colors{display:grid;gap:.5rem;padding-block-start:var(--calcite-color-picker-spacing);grid-template-columns:repeat(auto-fill,24px)}.saved-colors-buttons{display:flex}.saved-color{outline-offset:0;outline-color:transparent;cursor:pointer}.saved-color:focus{outline:2px solid var(--calcite-color-brand);outline-offset:2px}.saved-color:hover{transition:outline-color var(--calcite-internal-animation-timing-fast) ease-in-out;outline:2px solid var(--calcite-color-border-2);outline-offset:2px}:host([hidden]){display:none}[hidden]{display:none}`;class k extends s.LitElement{constructor(){super(),this._color=t.DEFAULT_COLOR,this.internalColorUpdateContext=null,this.isActiveChannelInputEmpty=!1,this.mode=t.CSSColorMode.HEX,this.resizeObserver=I.createObserver("resize",e=>this.resizeCanvas(e)),this.shiftKeyChannelAdjustment=0,this.upOrDownArrowKeyTracker=null,this._valueWasSet=!1,this.messages=b.useT9n({blocking:!0}),this.captureColorFieldColor=(e,a,i=!0)=>{const{width:n,height:l}=this.dynamicDimensions.colorField,o=Math.round(t.HSV_LIMITS.s/n*e),s=Math.round(t.HSV_LIMITS.v/l*(l-a));this.internalColorSet(this.baseColorFieldColor.hsv().saturationv(o).value(s),i)},this.drawColorControls=w.throttle((e="all")=>{"all"!==e&&"color-field"!==e||!this.colorFieldRenderingContext||this.drawColorField(),"all"!==e&&"hue-slider"!==e||!this.hueSliderRenderingContext||this.drawHueSlider(),this.alphaChannel&&("all"===e||"opacity-slider"===e)&&this.opacitySliderRenderingContext&&this.drawOpacitySlider()},16),this.globalPointerMoveHandler=e=>{const{activeCanvasInfo:t,el:a}=this;if(!a.isConnected||!t)return;const{context:i,bounds:n}=t;let l,o;const{clientX:s,clientY:r}=e;i.canvas.matches(":hover")?(l=s-n.x,o=r-n.y):(l=s<n.x+n.width&&s>n.x?s-n.x:s<n.x?0:n.width,o=r<n.y+n.height&&r>n.y?r-n.y:r<n.y?0:n.height),i===this.colorFieldRenderingContext?this.captureColorFieldColor(l,o,!1):i===this.hueSliderRenderingContext?this.captureHueSliderColor(l):i===this.opacitySliderRenderingContext&&this.captureOpacitySliderValue(l)},this.globalPointerUpHandler=e=>{if(!c.isPrimaryPointerButton(e))return;const t=this.activeCanvasInfo;this.activeCanvasInfo=null,this.drawColorControls(),t&&this.calciteColorPickerChange.emit()},this.resizeCanvas=w.throttle(e=>{if(!this.hasUpdated)return;const[t]=e,a=Math.floor(t.contentBoxSize[0].inlineSize);this.dynamicDimensions.colorField.width!==a&&(this.updateDynamicDimensions(a),this.updateCanvasSize(),this.drawColorControls())},16),this.updateDynamicDimensions=e=>{const a={width:t.getSliderWidth(e,this.staticDimensions,this.alphaChannel),height:this.staticDimensions.slider.height};this.dynamicDimensions={colorField:t.getColorFieldDimensions(e),slider:a}},this.channelMode="rgb",this.channels=this.toChannels(t.DEFAULT_COLOR),this.staticDimensions=t.STATIC_DIMENSIONS.m,this.savedColors=[],this.allowEmpty=!1,this.alphaChannel=!1,this.channelsDisabled=!1,this.clearable=!1,this.disabled=!1,this.format="auto",this.hexDisabled=!1,this.savedDisabled=!1,this.scale="m",this.calciteColorPickerChange=s.createEvent({cancelable:!1}),this.calciteColorPickerInput=s.createEvent({cancelable:!1}),this.listen("keydown",this.handleChannelKeyUpOrDown,{capture:!0}),this.listen("keyup",this.handleChannelKeyUpOrDown,{capture:!0})}static{this.properties={channelMode:[16,{},{state:!0}],channels:[16,{},{state:!0}],colorFieldScopeLeft:[16,{},{state:!0}],colorFieldScopeTop:[16,{},{state:!0}],staticDimensions:[16,{},{state:!0}],hueScopeLeft:[16,{},{state:!0}],opacityScopeLeft:[16,{},{state:!0}],savedColors:[16,{},{state:!0}],scopeOrientation:[16,{},{state:!0}],allowEmpty:[7,{},{reflect:!0,type:Boolean}],alphaChannel:[5,{},{type:Boolean}],channelsDisabled:[5,{},{type:Boolean}],clearable:[7,{},{reflect:!0,type:Boolean}],color:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],format:[3,{},{reflect:!0}],hexDisabled:[5,{},{type:Boolean}],messageOverrides:[0,{},{attribute:!1}],numberingSystem:[3,{},{reflect:!0}],savedDisabled:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],storageId:[3,{},{reflect:!0}],value:1}}static{this.styles=A}get color(){return this._color}set color(e){const t=this._color;this._color=e,this.handleColorChange(e,t)}get value(){return this._value}set value(e){const t=this._value;this._value=e,this.handleValueChange(e,t),this._valueWasSet=!0}async setFocus(){await d.componentFocusable(this),c.focusFirstTabbable(this.el)}connectedCallback(){super.connectedCallback(),this.observeResize()}async load(){this._valueWasSet||(this._value??=t.normalizeHex(t.hexify(t.DEFAULT_COLOR,this.alphaChannel))),this.handleAllowEmptyOrClearableChange();const{isClearable:e,color:a,format:i,value:n}=this,l=e&&!n,o=t.parseMode(n),s=l||"auto"===i&&o||i===o,r=l?null:s?t.Color(n):a;s||this.showIncompatibleColorWarning(n,i),this.setMode(i,!1),this.internalColorSet(r,!1,"initial"),this.updateStaticDimensions(this.scale),this.updateDynamicDimensions(t.STATIC_DIMENSIONS[this.scale].minWidth);const h=`${t.DEFAULT_STORAGE_KEY_PREFIX}${this.storageId}`;this.storageId&&localStorage.getItem(h)&&(this.savedColors=JSON.parse(localStorage.getItem(h)))}willUpdate(e){(e.has("allowEmpty")&&(this.hasUpdated||!1!==this.allowEmpty)||e.has("clearable")&&(this.hasUpdated||!1!==this.clearable))&&this.handleAllowEmptyOrClearableChange(),e.has("alphaChannel")&&(this.hasUpdated||!1!==this.alphaChannel)&&this.handleAlphaChannelChange(this.alphaChannel),this.hasUpdated&&(e.has("alphaChannel")&&!1!==this.alphaChannel||e.has("staticDimensions")&&this.staticDimensions!==t.STATIC_DIMENSIONS.m)&&this.handleAlphaChannelDimensionsChange(),(e.has("alphaChannel")&&(this.hasUpdated||!1!==this.alphaChannel)||e.has("format")&&(this.hasUpdated||"auto"!==this.format))&&this.handleFormatOrAlphaChannelChange(),e.has("scale")&&(this.hasUpdated||"m"!==this.scale)&&this.handleScaleChange(this.scale)}updated(){g.updateHostInteraction(this)}loaded(){this.handleAlphaChannelDimensionsChange()}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("pointermove",this.globalPointerMoveHandler),window.removeEventListener("pointerup",this.globalPointerUpHandler),this.resizeObserver?.disconnect()}get baseColorFieldColor(){return this.color||this.previousColor||t.DEFAULT_COLOR}get effectiveSliderWidth(){return this.dynamicDimensions.slider.width}observeResize(){this.resizeObserver?.observe(this.el)}handleAllowEmptyOrClearableChange(){this.isClearable=this.clearable||this.allowEmpty}handleAlphaChannelChange(e){const{format:a}=this;e&&"auto"!==a&&!t.alphaCompatible(a)&&(console.warn(`ignoring alphaChannel as the current format (${a}) does not support alpha`),this.alphaChannel=!1)}handleAlphaChannelDimensionsChange(){this.drawColorControls()}handleColorChange(e,t){this.drawColorControls(),this.updateChannelsFromColor(e),this.previousColor=t}handleFormatOrAlphaChannelChange(){this.setMode(this.format),this.internalColorSet(this.color,!1,"internal")}handleScaleChange(e="m"){this.updateStaticDimensions(e),this.updateCanvasSize(),this.drawColorControls()}handleValueChange(e,a){const{isClearable:i,format:n}=this;let l=!1;if(!i||e){const i=t.parseMode(e);if(!i||"auto"!==n&&i!==n)return this.showIncompatibleColorWarning(e,n),void(this._value=a);l=this.mode!==i,this.setMode(i,null===this.internalColorUpdateContext)}const o=this.activeCanvasInfo;if("initial"===this.internalColorUpdateContext)return;if("user-interaction"===this.internalColorUpdateContext)return this.calciteColorPickerInput.emit(),void(o||this.calciteColorPickerChange.emit());const s=i&&!e?null:t.Color(null!=e&&"object"==typeof e&&t.alphaCompatible(this.mode)?t.normalizeColor(e):e),r=!t.colorEqual(s,this.color);(l||r)&&this.internalColorSet(s,this.alphaChannel&&!(this.mode.endsWith("a")||this.mode.endsWith("a-css"))||"internal"===this.internalColorUpdateContext,"internal")}handleTabActivate(e){this.channelMode=e.currentTarget.getAttribute("data-color-mode"),this.updateChannelsFromColor(this.color)}handleColorFieldScopeKeyDown(e){const{key:t}=e,a={ArrowUp:{x:0,y:-10},ArrowRight:{x:10,y:0},ArrowDown:{x:0,y:10},ArrowLeft:{x:-10,y:0}};a[t]&&(e.preventDefault(),this.scopeOrientation="ArrowDown"===t||"ArrowUp"===t?"vertical":"horizontal",this.captureColorFieldColor(this.colorFieldScopeLeft+a[t].x||0,this.colorFieldScopeTop+a[t].y||0,!1))}handleHueScopeKeyDown(e){const t=e.shiftKey?10:1,{key:a}=e,i={ArrowUp:1,ArrowRight:1,ArrowDown:-1,ArrowLeft:-1};if(i[a]){e.preventDefault();const n=i[a]*t,l=this.baseColorFieldColor.hue(),o=this.baseColorFieldColor.hue(l+n);this.internalColorSet(o,!1)}}handleHexInputChange(e){e.stopPropagation();const{isClearable:a,color:i}=this,n=e.target.value;!a||n?n!==(i&&t.normalizeHex(t.hexify(i,t.alphaCompatible(this.mode))))&&this.internalColorSet(t.Color(n)):this.internalColorSet(null)}handleSavedColorSelect(e){const a=e.currentTarget;this.internalColorSet(t.Color(a.color))}handleChannelInput(e){const a=e.currentTarget,i=Number(a.getAttribute("data-channel-index")),n=3===i?t.OPACITY_LIMITS.max:"rgb"===this.channelMode?t.RGB_LIMITS[Object.keys(t.RGB_LIMITS)[i]]:t.HSV_LIMITS[Object.keys(t.HSV_LIMITS)[i]];let l;if(a.value){const e=Number(a.value)+this.shiftKeyChannelAdjustment;l=y.clamp(e,0,n).toString()}else l="",this.isActiveChannelInputEmpty=!0,this.upOrDownArrowKeyTracker=null;a.value=l,(""!==l&&0!==this.shiftKeyChannelAdjustment||""!==l)&&this.handleChannelChange(e)}handleChannelBlur(e){const t=e.currentTarget,a=Number(t.getAttribute("data-channel-index")),i=[...this.channels];!t.value&&!this.isClearable&&(t.value=i[a]?.toString())}handleChannelFocus(e){e.currentTarget.selectText()}handleChannelKeyUpOrDown(e){this.shiftKeyChannelAdjustment=0;const{key:a}=e;if("ArrowUp"!==a&&"ArrowDown"!==a||!e.composedPath().some(e=>e.classList?.contains(t.CSS.channel)))return;const{shiftKey:i}=e;if(e.preventDefault(),!this.color)return this.internalColorSet(this.previousColor),void e.stopPropagation();this.shiftKeyChannelAdjustment="ArrowUp"===a&&i?9:"ArrowDown"===a&&i?-9:0,"ArrowUp"===a&&(this.upOrDownArrowKeyTracker="up"),"ArrowDown"===a&&(this.upOrDownArrowKeyTracker="down")}getChannelInputLimit(e){return"rgb"===this.channelMode?t.RGB_LIMITS[Object.keys(t.RGB_LIMITS)[e]]:t.HSV_LIMITS[Object.keys(t.HSV_LIMITS)[e]]}handleChannelChange(e){const a=e.currentTarget,i=Number(a.getAttribute("data-channel-index")),n=[...this.channels];if(this.isClearable&&!a.value)return this.channels=[null,null,null,null],void this.internalColorSet(null);const l=3===i;this.isActiveChannelInputEmpty&&this.upOrDownArrowKeyTracker&&(a.value="up"===this.upOrDownArrowKeyTracker?(n[i]+1<=this.getChannelInputLimit(i)?n[i]+1:this.getChannelInputLimit(i)).toString():(n[i]-1>=0?n[i]-1:0).toString(),this.isActiveChannelInputEmpty=!1,this.upOrDownArrowKeyTracker=null);const o=a.value?Number(a.value):n[i];n[i]=l?t.opacityToAlpha(o):o,this.updateColorFromChannels(n)}handleSavedColorKeyDown(e){x.isActivationKey(e.key)&&(e.preventDefault(),this.handleSavedColorSelect(e))}handleColorFieldPointerDown(e){this.handleCanvasControlPointerDown(e,this.colorFieldRenderingContext,this.captureColorFieldColor,this.colorFieldScopeNode)}focusScope(e){requestAnimationFrame(()=>{e.focus()})}handleHueSliderPointerDown(e){this.handleCanvasControlPointerDown(e,this.hueSliderRenderingContext,this.captureHueSliderColor,this.hueScopeNode)}handleOpacitySliderPointerDown(e){this.handleCanvasControlPointerDown(e,this.opacitySliderRenderingContext,this.captureOpacitySliderValue,this.opacityScopeNode)}handleCanvasControlPointerDown(e,t,a,i){c.isPrimaryPointerButton(e)&&(window.addEventListener("pointermove",this.globalPointerMoveHandler),window.addEventListener("pointerup",this.globalPointerUpHandler,{once:!0}),this.activeCanvasInfo={context:t,bounds:t.canvas.getBoundingClientRect()},a.call(this,e.offsetX,e.offsetY),this.focusScope(i))}storeColorFieldScope(e){this.colorFieldScopeNode=e}storeHueScope(e){this.hueScopeNode=e}handleKeyDown(e){"Enter"===e.key&&e.preventDefault()}showIncompatibleColorWarning(e,t){console.warn(`ignoring color value (${e}) as it is not compatible with the current format (${t})`)}setMode(e,t=!0){const a="auto"===e?this.mode:e;this.mode=this.ensureCompatibleMode(a,t)}ensureCompatibleMode(e,a){const{alphaChannel:i}=this,n=t.alphaCompatible(e);if(i&&!n){const i=t.toAlphaMode(e);return a&&console.warn(`setting format to (${i}) as the provided one (${e}) does not support alpha`),i}if(!i&&n){const i=t.toNonAlphaMode(e);return a&&console.warn(`setting format to (${i}) as the provided one (${e}) does not support alpha`),i}return e}captureHueSliderColor(e){const a=t.HUE_LIMIT_CONSTRAINED/this.effectiveSliderWidth*e;this.internalColorSet(this.baseColorFieldColor.hue(a),!1)}captureOpacitySliderValue(e){const a=t.opacityToAlpha(t.OPACITY_LIMITS.max/this.effectiveSliderWidth*e);this.internalColorSet(this.baseColorFieldColor.alpha(a),!1)}internalColorSet(e,a=!0,i="user-interaction"){a&&t.colorEqual(e,this.color)||(this.internalColorUpdateContext=i,this.color=e,this.value=this.toValue(e),this.internalColorUpdateContext=null)}toValue(e,a=this.mode){if(!e)return null;if(a.includes("hex")){const i=a===t.CSSColorMode.HEXA;return t.normalizeHex(t.hexify(e.round(),i),i)}if(a.includes("-css")){const t=e[a.replace("-css","").replace("a","")]().round().string();return(a.endsWith("a")||a.endsWith("a-css"))&&1===e.alpha()?`${t.slice(0,3)}a(${t.slice(4,-1)}, ${e.alpha()})`:t}const i=e[t.toNonAlphaMode(a)]().round().object();return a.endsWith("a")?t.normalizeAlpha(i):i}getSliderCapSpacing(){const{staticDimensions:{slider:{height:e},thumb:{radius:t}}}=this;return 2*t-e}updateStaticDimensions(e="m"){this.staticDimensions=t.STATIC_DIMENSIONS[e]}deleteColor(){const e=t.hexify(this.color,this.alphaChannel);if(!(this.savedColors.indexOf(e)>-1))return;const a=this.savedColors.filter(t=>t!==e);this.savedColors=a;const i=`${t.DEFAULT_STORAGE_KEY_PREFIX}${this.storageId}`;this.storageId&&localStorage.setItem(i,JSON.stringify(a))}saveColor(){const e=t.hexify(this.color,this.alphaChannel);if(this.savedColors.indexOf(e)>-1)return;const a=[...this.savedColors,e];this.savedColors=a;const i=`${t.DEFAULT_STORAGE_KEY_PREFIX}${this.storageId}`;this.storageId&&localStorage.setItem(i,JSON.stringify(a))}drawColorField(){const e=this.colorFieldRenderingContext,{width:t,height:a}=this.dynamicDimensions.colorField;e.fillStyle=this.baseColorFieldColor.hsv().saturationv(100).value(100).alpha(1).string(),e.fillRect(0,0,t,a);const i=e.createLinearGradient(0,0,t,0);i.addColorStop(0,"rgba(255,255,255,1)"),i.addColorStop(1,"rgba(255,255,255,0)"),e.fillStyle=i,e.fillRect(0,0,t,a);const n=e.createLinearGradient(0,0,0,a);n.addColorStop(0,"rgba(0,0,0,0)"),n.addColorStop(1,"rgba(0,0,0,1)"),e.fillStyle=n,e.fillRect(0,0,t,a),this.drawActiveColorFieldColor()}setCanvasContextSize(e,{height:t,width:a}){if(!e)return;const i=window.devicePixelRatio||1;e.width=a*i,e.height=t*i,e.style.height=`${t}px`,e.style.width=`${a}px`,e.getContext("2d").scale(i,i)}initColorField(e){e&&(this.colorFieldRenderingContext=e.getContext("2d"),this.updateCanvasSize("color-field"),this.drawColorControls())}initHueSlider(e){e&&(this.hueSliderRenderingContext=e.getContext("2d"),this.updateCanvasSize("hue-slider"),this.drawHueSlider())}initOpacitySlider(e){e&&(this.opacitySliderRenderingContext=e.getContext("2d"),this.updateCanvasSize("opacity-slider"),this.drawOpacitySlider())}updateCanvasSize(e="all"){const{dynamicDimensions:t,staticDimensions:a}=this;"all"!==e&&"color-field"!==e||this.setCanvasContextSize(this.colorFieldRenderingContext?.canvas,t.colorField);const i={width:this.effectiveSliderWidth,height:a.slider.height+2*(a.thumb.radius-t.slider.height/2)};"all"!==e&&"hue-slider"!==e||this.setCanvasContextSize(this.hueSliderRenderingContext?.canvas,i),"all"!==e&&"opacity-slider"!==e||this.setCanvasContextSize(this.opacitySliderRenderingContext?.canvas,i)}drawActiveColorFieldColor(){const{color:e}=this;if(!e)return;const a=e.hsv(),{staticDimensions:{thumb:{radius:i}}}=this,{width:n,height:l}=this.dynamicDimensions.colorField,o=a.saturationv()/(t.HSV_LIMITS.s/n),s=l-a.value()/(t.HSV_LIMITS.v/l);requestAnimationFrame(()=>{this.colorFieldScopeLeft=o,this.colorFieldScopeTop=s}),this.drawThumb(this.colorFieldRenderingContext,i,o,s,a,!1)}drawThumb(e,t,a,i,n,l){const o=2*Math.PI;if(e.beginPath(),e.arc(a,i,t,0,o),e.fillStyle="#fff",e.fill(),e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=1,e.stroke(),l&&n.alpha()<1){const n=e.createPattern(this.getCheckeredBackgroundPattern(),"repeat");e.beginPath(),e.arc(a,i,t-3,0,o),e.fillStyle=n,e.fill()}e.globalCompositeOperation="source-atop",e.beginPath(),e.arc(a,i,t-3,0,o);const s=l?n.alpha():1;e.fillStyle=n.rgb().alpha(s).string(),e.fill(),e.globalCompositeOperation="source-over"}drawActiveHueSliderColor(){const{color:e}=this;if(!e)return;const a=e.hsv().saturationv(100).value(100),{staticDimensions:{thumb:{radius:i}}}=this,n=this.effectiveSliderWidth,l=a.hue()/(t.HUE_LIMIT_CONSTRAINED/n),o=i,s=this.getSliderBoundX(l,n,i);requestAnimationFrame(()=>{this.hueScopeLeft=s}),this.drawThumb(this.hueSliderRenderingContext,i,s,o,a,!1)}drawHueSlider(){const e=this.hueSliderRenderingContext,{staticDimensions:{slider:{height:a},thumb:{radius:i}}}=this,n=i-a/2,l=this.effectiveSliderWidth,o=e.createLinearGradient(0,0,l,0),s=["red","yellow","lime","cyan","blue","magenta","#ff0004"],r=1/(s.length-1);let h=0;s.forEach(e=>{o.addColorStop(h,t.Color(e).string()),h+=r}),e.clearRect(0,0,l,a+2*this.getSliderCapSpacing()),this.drawSliderPath(e,a,l,0,n),e.fillStyle=o,e.fill(),e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=1,e.stroke(),this.drawActiveHueSliderColor()}drawOpacitySlider(){const e=this.opacitySliderRenderingContext,{baseColorFieldColor:t,staticDimensions:{slider:{height:a},thumb:{radius:i}}}=this,n=i-a/2,l=this.effectiveSliderWidth;e.clearRect(0,0,l,a+2*this.getSliderCapSpacing());const o=e.createLinearGradient(0,n,l,0),s=t.rgb().alpha(0),r=t.rgb().alpha(.5),h=t.rgb().alpha(1);o.addColorStop(0,s.string()),o.addColorStop(.5,r.string()),o.addColorStop(1,h.string()),this.drawSliderPath(e,a,l,0,n);const c=e.createPattern(this.getCheckeredBackgroundPattern(),"repeat");e.fillStyle=c,e.fill(),e.fillStyle=o,e.fill(),e.strokeStyle="rgba(0,0,0,0.3)",e.lineWidth=1,e.stroke(),this.drawActiveOpacitySliderColor()}drawSliderPath(e,t,a,i,n){const l=t/2+1;e.beginPath(),e.moveTo(i+l,n),e.lineTo(i+a-l,n),e.quadraticCurveTo(i+a,n,i+a,n+l),e.lineTo(i+a,n+t-l),e.quadraticCurveTo(i+a,n+t,i+a-l,n+t),e.lineTo(i+l,n+t),e.quadraticCurveTo(i,n+t,i,n+t-l),e.lineTo(i,n+l),e.quadraticCurveTo(i,n,i+l,n),e.closePath()}getCheckeredBackgroundPattern(){if(this.checkerPattern)return this.checkerPattern;const e=document.createElement("canvas");e.width=10,e.height=10;const t=e.getContext("2d");return t.fillStyle="#ccc",t.fillRect(0,0,10,10),t.fillStyle="#fff",t.fillRect(0,0,5,5),t.fillRect(5,5,5,5),this.checkerPattern=e,e}drawActiveOpacitySliderColor(){const{color:e}=this;if(!e)return;const a=e,{staticDimensions:{thumb:{radius:i}}}=this,n=this.effectiveSliderWidth,l=t.alphaToOpacity(a.alpha())/(t.OPACITY_LIMITS.max/n),o=i,s=this.getSliderBoundX(l,n,i);requestAnimationFrame(()=>{this.opacityScopeLeft=s}),this.drawThumb(this.opacitySliderRenderingContext,i,s,o,a,!0)}getSliderBoundX(e,t,a){const i=y.closeToRangeEdge(e,t,a);return 0===i?e:-1===i?y.remap(e,0,t,a,2*a):y.remap(e,0,t,t-2*a,t-a)}storeOpacityScope(e){this.opacityScopeNode=e}handleOpacityScopeKeyDown(e){const t=e.shiftKey?10:1,{key:a}=e,i={ArrowUp:.01,ArrowRight:.01,ArrowDown:-.01,ArrowLeft:-.01};if(i[a]){e.preventDefault();const n=i[a]*t,l=this.baseColorFieldColor.alpha(),o=this.baseColorFieldColor.alpha(l+n);this.internalColorSet(o,!1)}}updateColorFromChannels(e){this.internalColorSet(t.Color(e,this.channelMode))}updateChannelsFromColor(e){this.channels=e?this.toChannels(e):[null,null,null,null]}toChannels(e){const{channelMode:t}=this,a=e[t]().array().map((e,t)=>3===t?e:Math.floor(e));return 3===a.length&&a.push(1),a}getAdjustedScopePosition(e,a){return[e-t.SCOPE_SIZE/2,a-t.SCOPE_SIZE/2]}render(){const{channelsDisabled:e,color:a,colorFieldScopeLeft:i,colorFieldScopeTop:n,staticDimensions:{thumb:{radius:l}},hexDisabled:o,hueScopeLeft:h,messages:c,alphaChannel:d,opacityScopeLeft:p,savedColors:u,savedDisabled:C,scale:S,scopeOrientation:v}=this,m=this.effectiveSliderWidth,x=a?t.hexify(a,d):null,y=l,b=h??m*t.DEFAULT_COLOR.hue()/t.HSV_LIMITS.h,I=l,w=p??m*t.alphaToOpacity(t.DEFAULT_COLOR.alpha())/t.OPACITY_LIMITS.max,$=void 0===a,T="vertical"===v,[D,A]=this.getAdjustedScopePosition(i,n),[k,O]=this.getAdjustedScopePosition(b,y),[M,F]=this.getAdjustedScopePosition(w,I);return g.InteractiveContainer({disabled:this.disabled,children:s.x`<div class=${s.safeClassMap(t.CSS.container)}><div class=${s.safeClassMap(t.CSS.controlAndScope)}><canvas class=${s.safeClassMap(t.CSS.colorField)} @pointerdown=${this.handleColorFieldPointerDown} ${r.n(this.initColorField)}></canvas><div .ariaLabel=${T?c.value:c.saturation} .ariaValueMax=${T?t.HSV_LIMITS.v:t.HSV_LIMITS.s} aria-valuemin=0 .ariaValueNow=${(T?a?.saturationv():a?.value())||"0"} class=${s.safeClassMap({[t.CSS.scope]:!0,[t.CSS.colorFieldScope]:!0})} @keydown=${this.handleColorFieldScopeKeyDown} role=slider style=${s.safeStyleMap({top:`${A||0}px`,left:`${D||0}px`})} tabindex=0 ${r.n(this.storeColorFieldScope)}></div></div><div class=${s.safeClassMap(t.CSS.previewAndSliders)}><calcite-color-picker-swatch class=${s.safeClassMap(t.CSS.preview)} .color=${x} .scale=${this.alphaChannel?"l":this.scale}></calcite-color-picker-swatch><div class=${s.safeClassMap(t.CSS.sliders)}><div class=${s.safeClassMap(t.CSS.controlAndScope)}><canvas class=${s.safeClassMap({[t.CSS.slider]:!0,[t.CSS.hueSlider]:!0})} @pointerdown=${this.handleHueSliderPointerDown} ${r.n(this.initHueSlider)}></canvas><div .ariaLabel=${c.hue} .ariaValueMax=${t.HSV_LIMITS.h} aria-valuemin=0 .ariaValueNow=${a?.round().hue()||t.DEFAULT_COLOR.round().hue()} class=${s.safeClassMap({[t.CSS.scope]:!0,[t.CSS.hueScope]:!0})} @keydown=${this.handleHueScopeKeyDown} role=slider style=${s.safeStyleMap({top:`${O}px`,left:`${k}px`})} tabindex=0 ${r.n(this.storeHueScope)}></div></div>${d?s.x`<div class=${s.safeClassMap(t.CSS.controlAndScope)}><canvas class=${s.safeClassMap({[t.CSS.slider]:!0,[t.CSS.opacitySlider]:!0})} @pointerdown=${this.handleOpacitySliderPointerDown} ${r.n(this.initOpacitySlider)}></canvas><div .ariaLabel=${c.opacity} .ariaValueMax=${t.OPACITY_LIMITS.max} .ariaValueMin=${t.OPACITY_LIMITS.min} .ariaValueNow=${(a||t.DEFAULT_COLOR).round().alpha()} class=${s.safeClassMap({[t.CSS.scope]:!0,[t.CSS.opacityScope]:!0})} @keydown=${this.handleOpacityScopeKeyDown} role=slider style=${s.safeStyleMap({top:`${F}px`,left:`${M}px`})} tabindex=0 ${r.n(this.storeOpacityScope)}></div></div>`:null}</div></div>${o&&e?null:s.x`<div class=${s.safeClassMap({[t.CSS.controlSection]:!0,[t.CSS.section]:!0})}><div class=${s.safeClassMap(t.CSS.hexAndChannelsGroup)}>${o?null:s.x`<div class=${s.safeClassMap(t.CSS.hexOptions)}><calcite-color-picker-hex-input .allowEmpty=${this.isClearable} .alphaChannel=${d} class=${s.safeClassMap(t.CSS.control)} .messages=${c} .numberingSystem=${this.numberingSystem} @calciteColorPickerHexInputChange=${this.handleHexInputChange} .scale=${S} .value=${x}></calcite-color-picker-hex-input></div>`}${e?null:s.x`<calcite-tabs class=${s.safeClassMap({[t.CSS.colorModeContainer]:!0,[t.CSS.splitSection]:!0})} .scale=${"l"===S?"m":"s"}><calcite-tab-nav slot=title-group>${this.renderChannelsTabTitle("rgb")}${this.renderChannelsTabTitle("hsv")}</calcite-tab-nav>${this.renderChannelsTab("rgb")}${this.renderChannelsTab("hsv")}</calcite-tabs>`}</div></div>`}${C?null:s.x`<div class=${s.safeClassMap({[t.CSS.savedColorsSection]:!0,[t.CSS.section]:!0})}><div class=${s.safeClassMap(t.CSS.header)}><label>${c.saved}</label><div class=${s.safeClassMap(t.CSS.savedColorsButtons)}><calcite-button appearance=transparent class=${s.safeClassMap(t.CSS.deleteColor)} .disabled=${$} icon-start=minus kind=neutral .label=${c.deleteColor} @click=${this.deleteColor} .scale=${S} type=button></calcite-button><calcite-button appearance=transparent class=${s.safeClassMap(t.CSS.saveColor)} .disabled=${$} icon-start=plus kind=neutral .label=${c.saveColor} @click=${this.saveColor} .scale=${S} type=button></calcite-button></div></div>${u.length>0?s.x`<div class=${s.safeClassMap(t.CSS.savedColors)}>${f.c(u,e=>e,e=>s.x`<calcite-color-picker-swatch class=${s.safeClassMap(t.CSS.savedColor)} .color=${e} @click=${this.handleSavedColorSelect} @keydown=${this.handleSavedColorKeyDown} .scale=${S} tabindex=0></calcite-color-picker-swatch>`)}</div>`:null}</div>`}</div>`})}renderChannelsTabTitle(e){const{channelMode:a,messages:i}=this,n=e===a,l="rgb"===e?i.rgb:i.hsv;return h.i(e,s.x`<calcite-tab-title class=${s.safeClassMap(t.CSS.colorMode)} data-color-mode=${e??s.E} @calciteTabsActivate=${this.handleTabActivate} .selected=${n}>${l}</calcite-tab-title>`)}renderChannelsTab(e){const{isClearable:a,channelMode:i,channels:n,messages:l,alphaChannel:o}=this,r=e===i,d="rgb"===e?[l.red,l.green,l.blue]:[l.hue,l.saturation,l.value],p=c.getElementDir(this.el),u=o?n:n.slice(0,3);return h.i(e,s.x`<calcite-tab class=${s.safeClassMap(t.CSS.control)} .selected=${r}><div class=${s.safeClassMap(t.CSS.channels)} dir=ltr>${u.map((e,i)=>{const n=3===i;return n&&(e=a&&!e?e:t.alphaToOpacity(e)),this.renderChannel(e,i,d[i],p,n?"%":"")})}</div></calcite-tab>`)}renderChannel(e,a,i,n,l){return h.i(a,s.x`<calcite-input-number class=${s.safeClassMap(t.CSS.channel)} data-channel-index=${a??s.E} dir=${n??s.E} .label=${i} lang=${this.messages._lang??s.E} number-button-type=none .numberingSystem=${this.numberingSystem} @keydown=${this.handleKeyDown} @calciteInputNumberChange=${this.handleChannelChange} @calciteInputNumberInput=${this.handleChannelInput} @calciteInternalInputNumberBlur=${this.handleChannelBlur} @calciteInternalInputNumberFocus=${this.handleChannelFocus} .scale=${"l"===this.scale?"m":"s"} style=${s.safeStyleMap({marginLeft:a>0&&("s"!==this.scale||!this.alphaChannel||3!==a)?"-1px":""})} .suffixText=${l} .value=${e?.toString()}></calcite-input-number>`)}}s.customElement("calcite-color-picker",k),e.ColorPicker=k,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});