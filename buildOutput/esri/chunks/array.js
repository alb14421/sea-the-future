// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../arcade/deepClone","../arcade/executionError","../arcade/ImmutableArray","./languageUtils","../core/promiseUtils","../support/guards"],function(n,r,t,e,o,i,c){"use strict";function u(n){function u(n,r,o){if(n instanceof e)return n.toArray();if(c.isArray(n))return n;throw new t.ArcadeExecutionError(r,"InvalidParameter",o)}function a(n,r){const t=n.length,e=Math.floor(t/2);return 0===t?[]:1===t?[n[0]]:function(n,r,t){const e=[];for(;n.length>0||r.length>0;)if(n.length>0&&r.length>0){let o=t(n[0],r[0]);isNaN(o)&&(o=0),o<=0?(e.push(n[0]),n=n.slice(1)):(e.push(r[0]),r=r.slice(1))}else n.length>0?(e.push(n[0]),n=n.slice(1)):r.length>0&&(e.push(r[0]),r=r.slice(1));return e}(a(n.slice(0,e),r),a(n.slice(e,t),r),r)}async function s(n,r){const t=n.length,e=Math.floor(t/2);if(0===t)return[];if(1===t)return[n[0]];const o=[await s(n.slice(0,e),r),await s(n.slice(e,t),r)];return l(o[0],o[1],r,[])}async function l(n,r,t,e){const o=e;if(n.length>0||r.length>0){if(n.length>0&&r.length>0){let i=await t(n[0],r[0]);return isNaN(i)&&(i=1),i<=0?(o.push(n[0]),n=n.slice(1)):(o.push(r[0]),r=r.slice(1)),l(n,r,t,e)}return n.length>0?(o.push(n[0]),l(n=n.slice(1),r,t,e)):(o.push(r[0]),l(n,r=r.slice(1),t,e))}return e}function d(n,r,e,i){o.pcCheck(e,1,2,n,r);let u=e[0];if(o.isImmutableArray(u)&&(u=u.toArray()),!1===c.isArray(u))throw new t.ArcadeExecutionError(n,"InvalidParameter",r);if(e.length>1){if(!1===o.isFunctionParameter(e[1]))throw new t.ArcadeExecutionError(n,"InvalidParameter",r);let c=u;const l=e[1].createFunction(n);return i?s(c,l):(c=a(c,(n,r)=>l(n,r)),c)}let l=u;if(0===l.length)return[];const d={};for(let n=0;n<l.length;n++){const r=o.getType(l[n]);""!==r&&(d[r]=!0)}if(!0===d.Array||!0===d.Dictionary||!0===d.Feature||!0===d.Voxel||!0===d.Point||!0===d.Polygon||!0===d.Polyline||!0===d.Multipoint||!0===d.Extent||!0===d.Function)return l.slice();let f=0,h="";for(const n in d)f++,h=n;return l=f>1||"String"===h?a(l,(n,r)=>{if(null==n||n===o.voidOperation)return null==r||r===o.voidOperation?0:1;if(null==r||r===o.voidOperation)return-1;const t=o.toString(n),e=o.toString(r);return t<e?-1:t===e?0:1}):"Number"===h?a(l,(n,r)=>n-r):"Boolean"===h?a(l,(n,r)=>n===r?0:r?-1:1):"Date"===h?a(l,(n,r)=>n.toNumber()-r.toNumber()):l.slice(),l}n.functions.array=function(e,i){return n.standardFunction(e,i,(n,u,a)=>{if(o.pcCheck(a,0,2,e,i),0===a.length)return[];if(1===a.length&&null===a[0])return[];if(c.isArray(a[0])){if(2===a.length&&!1===c.isBoolean(a[1]))throw new t.ArcadeExecutionError(e,"InvalidParameter",i);return!0===o.defaultUndefined(a[1],!1)?r.deepClone(a[0]):a[0].slice()}if(o.isImmutableArray(a[0])){if(2===a.length&&!1===c.isBoolean(a[1]))throw new t.ArcadeExecutionError(e,"InvalidParameter",i);return!0===o.defaultUndefined(a[1],!1)?r.deepClone(a[0]):a[0].toArray().slice()}const s=o.toNumber(a[0]);if(isNaN(s)||!1===c.isInteger(s))throw new t.ArcadeExecutionError(e,"InvalidParameter",i);const l=o.defaultUndefined(a[1],null),d=new Array(s);return d.fill(l),d})},n.functions.front=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,1,1,r,e),o.isImmutableArray(u[0])){if(u[0].length()<=0)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);return u[0].get(0)}if(c.isArray(u[0])){if(u[0].length<=0)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);return u[0][0]}throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.back=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,1,1,r,e),o.isImmutableArray(u[0])){if(u[0].length()<=0)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);return u[0].get(u[0].length()-1)}if(c.isArray(u[0])){if(u[0].length<=0)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);return u[0][u[0].length-1]}throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.push=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,1,2,r,e),c.isArray(u[0]))return u[0][u[0].length]=u[1],u[0].length;throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.pop=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,1,1,r,e),c.isArray(u[0])){if(u[0].length<=0)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);const n=u[0][u[0].length-1];return u[0].length=u[0].length-1,n}throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.erase=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,2,2,r,e),c.isArray(u[0])){let n=o.toNumber(u[1]);if(isNaN(n)||!1===c.isInteger(n))throw new t.ArcadeExecutionError(r,"InvalidParameter",e);const i=u[0];if(i.length<=0)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);if(n<0&&(n=i.length+n),n<0)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);if(n>=i.length)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);return i.splice(n,1),o.voidOperation}throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.insert=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,3,3,r,e),c.isArray(u[0])){const n=o.toNumber(u[1]);if(isNaN(n)||!1===c.isInteger(n))throw new t.ArcadeExecutionError(r,"InvalidParameter",e);const i=u[2],a=u[0];if(n>a.length)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);if(n<0&&n<-1*a.length)throw new t.ArcadeExecutionError(r,"OutOfBounds",e);return n===a.length?(a[n]=i,o.voidOperation):(a.splice(n,0,i),o.voidOperation)}throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.resize=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,2,3,r,e),c.isArray(u[0])){const n=o.toNumber(u[1]);if(isNaN(n)||!1===c.isInteger(n))throw new t.ArcadeExecutionError(r,"InvalidParameter",e);if(n<0)throw new t.ArcadeExecutionError(r,"InvalidParameter",e);const i=o.defaultUndefined(u[2],null),a=u[0];if(a.length>=n)return a.length=n,o.voidOperation;const s=a.length;a.length=n;for(let n=s;n<a.length;n++)a[n]=i;return o.voidOperation}throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.includes=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,2,2,r,e),c.isArray(u[0])){const n=u[1];return!!u[0].some(r=>o.equalityTest(r,n))}if(o.isImmutableArray(u[0])){const n=u[1];return!!u[0].toArray().some(r=>o.equalityTest(r,n))}throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.slice=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,1,3,r,e),c.isArray(u[0])){const n=o.toNumber(o.defaultUndefined(u[1],0)),i=o.toNumber(o.defaultUndefined(u[2],u[0].length));if(isNaN(n)||!1===c.isInteger(n))throw new t.ArcadeExecutionError(r,"InvalidParameter",e);if(isNaN(i)||!1===c.isInteger(i))throw new t.ArcadeExecutionError(r,"InvalidParameter",e);return u[0].slice(n,i)}if(o.isImmutableArray(u[0])){const n=u[0],i=o.toNumber(o.defaultUndefined(u[1],0)),a=o.toNumber(o.defaultUndefined(u[2],n.length()));if(isNaN(i)||!1===c.isInteger(i))throw new t.ArcadeExecutionError(r,"InvalidParameter",e);if(isNaN(a)||!1===c.isInteger(a))throw new t.ArcadeExecutionError(r,"InvalidParameter",e);return n.toArray().slice(i,a)}throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.splice=function(r,t){return n.standardFunction(r,t,(n,r,t)=>{const e=[];for(let n=0;n<t.length;n++)c.isArray(t[n])?e.push(...t[n]):o.isImmutableArray(t[n])?e.push(...t[n].toArray()):e.push(t[n]);return e})},n.functions.top=function(r,e){return n.standardFunction(r,e,(n,i,u)=>{if(o.pcCheck(u,2,2,r,e),c.isArray(u[0]))return o.toNumber(u[1])>=u[0].length?u[0].slice():u[0].slice(0,o.toNumber(u[1]));if(o.isImmutableArray(u[0]))return o.toNumber(u[1])>=u[0].length()?u[0].slice():u[0].slice(0,o.toNumber(u[1]));throw new t.ArcadeExecutionError(r,"InvalidParameter",e)})},n.functions.first=function(r,t){return n.standardFunction(r,t,(n,e,i)=>(o.pcCheck(i,1,1,r,t),c.isArray(i[0])?0===i[0].length?null:i[0][0]:o.isImmutableArray(i[0])?0===i[0].length()?null:i[0].get(0):null))},"sync"===n.mode&&(n.functions.sort=function(r,t){return n.standardFunction(r,t,(n,t,e)=>d(r,t,e,!1))},n.functions.any=function(r,t){return n.standardFunction(r,t,(n,t,e)=>{o.pcCheck(e,2,2,r,t);const i=e[1].createFunction(r),a=u(e[0],r,t);for(const n of a){const r=i(n);if(c.isBoolean(r)&&!0===r)return!0}return!1})},n.functions.all=function(r,t){return n.standardFunction(r,t,(n,t,e)=>{o.pcCheck(e,2,2,r,t);const i=e[1].createFunction(r),c=u(e[0],r,t);for(const n of c)if(!0!==i(n))return!1;return!0})},n.functions.none=function(r,t){return n.standardFunction(r,t,(n,t,e)=>{o.pcCheck(e,2,2,r,t);const i=e[1].createFunction(r),c=u(e[0],r,t);for(const n of c)if(!0===i(n))return!1;return!0})},n.functions.reduce=function(r,t){return n.standardFunction(r,t,(n,t,e)=>{o.pcCheck(e,2,3,r,t);const i=e[1].createFunction(r),c=u(e[0],r,t);return 2===e.length?0===c.length?null:c.reduce((n,r)=>{const t=i(n,r);return void 0!==t&&t!==o.voidOperation?t:null}):c.reduce((n,r)=>{const t=i(n,r);return void 0!==t&&t!==o.voidOperation?t:null},e[2])})},n.functions.map=function(r,t){return n.standardFunction(r,t,(n,t,e)=>{o.pcCheck(e,2,2,r,t);const i=e[1].createFunction(r),c=u(e[0],r,t),a=[];for(const n of c){const r=i(n);void 0!==r&&r!==o.voidOperation?a.push(r):a.push(null)}return a})},n.functions.filter=function(r,t){return n.standardFunction(r,t,(n,t,e)=>{o.pcCheck(e,2,2,r,t);const i=e[1].createFunction(r),c=u(e[0],r,t),a=[];for(const n of c)!0===i(n)&&a.push(n);return a})}),"async"===n.mode&&(n.functions.sort=function(r,t){return n.standardFunctionAsync(r,t,async(n,t,e)=>d(r,t,e,!0))},n.functions.any=function(r,t){return n.standardFunctionAsync(r,t,async(n,t,e)=>{o.pcCheck(e,2,2,r,t);const a=e[1].createFunction(r),s=u(e[0],r,t);for(const n of s){const r=await a(n);let t=null;if(t=i.isPromiseLike(t)?await r:r,c.isBoolean(t)&&!0===t)return!0}return!1})},n.functions.all=function(r,t){return n.standardFunctionAsync(r,t,async(n,t,e)=>{o.pcCheck(e,2,2,r,t);const c=e[1].createFunction(r),a=u(e[0],r,t);for(const n of a){const r=await c(n);let t=null;if(t=i.isPromiseLike(t)?await r:r,!0!==t)return!1}return!0})},n.functions.none=function(r,t){return n.standardFunctionAsync(r,t,async(n,t,e)=>{o.pcCheck(e,2,2,r,t);const c=e[1].createFunction(r),a=u(e[0],r,t);for(const n of a){const r=await c(n);let t=null;if(t=i.isPromiseLike(t)?await r:r,!0===t)return!1}return!0})},n.functions.filter=function(r,t){return n.standardFunctionAsync(r,t,async(n,t,e)=>{o.pcCheck(e,2,2,r,t);const c=e[1].createFunction(r),a=u(e[0],r,t),s=[];for(const n of a){const r=await c(n);let t=null;t=i.isPromiseLike(t)?await r:r,!0===t&&s.push(n)}return s})},n.functions.reduce=function(r,t){return n.standardFunctionAsync(r,t,async(n,t,e)=>{o.pcCheck(e,2,3,r,t);const i=e[1].createFunction(r),c=u(e[0],r,t);let a;if(e.length>2){const n=o.defaultUndefined(e[2],null);a=c.reduce(async(n,r)=>{let t=await n;return void 0!==t&&t!==o.voidOperation||(t=null),i(t,r)},Promise.resolve(n))}else{if(0===c.length)return null;a=c.reduce(async(n,r,t)=>{if(t<=1)return i(n,r);let e=await n;return void 0!==e&&e!==o.voidOperation||(e=null),i(e,r)})}return a.then(n=>void 0!==n&&n!==o.voidOperation?n:null)})},n.functions.map=function(r,t){return n.standardFunctionAsync(r,t,async(n,t,e)=>{o.pcCheck(e,2,2,r,t);const c=e[1].createFunction(r),a=u(e[0],r,t),s=[];for(const n of a){const r=await c(n);let t=null;t=i.isPromiseLike(t)?await r:r,void 0!==t&&t!==o.voidOperation?s.push(t):s.push(null)}return s})})}const a=Object.freeze(Object.defineProperty({__proto__:null,registerFunctions:u},Symbol.toStringTag,{value:"Module"}));n.ArrayFunctions=a,n.registerFunctions=u});