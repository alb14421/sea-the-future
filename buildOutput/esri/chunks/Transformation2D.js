// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./Geometry","./Point2D"],function(t,s,e){"use strict";class o{constructor(t,s,e){if(t instanceof o)return this.data=t.data,this.N=t.N,this.M=t.M,t.data=null,t.N=0,void(t.M=0);this.data=t,this.N=s,this.M=e}assignCopy(t){return this===t||(s.geometryReleaseAssert(this.N*this.M===t.N*t.M),this.data.set(t.data),this.N=t.N,this.M=t.M),this}setZero(){return this.data?.fill(0),this}setIdentity(){for(let t=0;t<this.N;t++)for(let s=0;s<this.M;s++)this.setRowCol(t,s,t===s?1:0);return this}rows(){return this.N}cols(){return this.M}row(t){return s.geometryReleaseAssert(0),{}}set(t,s){return this.data[t]=s,this}setRowCol(t,s,e){return this.data[t*this.M+s]=e,this}at(t){return this.data[t]}atRowCol(t,s){return this.data[t*this.M+s]}mulScalar(t,e){s.geometryReleaseAssert(0)}mul(t,e){if(s.geometryReleaseAssert(this.M===t.rows()),s.geometryReleaseAssert(this.N===e.rows()),s.geometryReleaseAssert(t.cols()===e.cols()),e===this){const s=new Float64Array(this.N*this.M),i=new o(s,this.N,this.M);return this.mul(t,i),void e.assignCopy(i)}if(e===t){const s=new Float64Array(t.N*t.M),i=new o(s,t.N,t.M);return this.mul(t,i),void e.assignCopy(i)}const i=t.cols();for(let s=0;s<this.N;s++)for(let o=0;o<i;o++){let i=0;for(let e=0;e<this.M;e++)i+=this.atRowCol(s,e)*t.atRowCol(e,o);e.setRowCol(s,o,i)}}mulTranspose(t,e){if(s.geometryReleaseAssert(this.M===t.cols()),s.geometryReleaseAssert(this.N===e.rows()),s.geometryReleaseAssert(t.rows()===e.cols()),e===this){const s=new Float64Array(this.N*this.M),i=new o(s,this.N,this.M);return this.mulTranspose(t,i),void e.assignCopy(i)}if(e===t){const s=new Float64Array(t.N*t.M),i=new o(s,t.N,t.M);return this.mulTranspose(t,i),void e.assignCopy(i)}const i=t.rows();for(let s=0;s<this.N;s++)for(let o=0;o<i;o++){let i=0;for(let e=0;e<this.M;e++)i+=this.atRowCol(s,e)*t.atRowCol(o,e);e.setRowCol(s,o,i)}}mulLeft(t,e){s.geometryReleaseAssert(0)}mulLeftTranspose(t,e){s.geometryReleaseAssert(0)}mulDiag(t,e){if(s.geometryReleaseAssert(this.M===t.N*t.M),s.geometryReleaseAssert(this.N===e.rows()),s.geometryReleaseAssert(this.M===e.cols()),e===this){const s=new Float64Array(this.N*this.M),i=new o(s,this.N,this.M);return this.mulDiag(t,i),void e.assignCopy(i)}const i=this.M;for(let s=0;s<this.N;s++)for(let o=0;o<i;o++)e.setRowCol(s,o,this.atRowCol(s,o)*t.at(o))}transposeInPlace(){if(this.N===this.M){for(let t=0;t<this.N;t++)for(let s=t+1;s<this.M;s++){const e=this.atRowCol(t,s);this.setRowCol(t,s,this.atRowCol(s,t)),this.setRowCol(s,t,e)}return this}const t=new Float64Array(this.N*this.M),s=new o(t,this.N,this.M);return s.assignCopy(this),this.M=e.swap(this.N,this.N=this.M),s.transpose(this),this}transpose(t){if(this!==t){o.checkDims(t,this.M,this.N);for(let s=0;s<this.N;s++)for(let e=0;e<this.M;e++)t.setRowCol(e,s,this.atRowCol(s,e))}else t.transposeInPlace()}add(t,s){}svd(t,e,i,h=!1){if(o.checkDims(t,this.N,this.M),o.checkDims(e,this.M,1),o.checkDims(i,this.M,this.M),h){if(s.geometryReleaseAssert(this.N===this.M),!this.symmetricEigen(e,i))return!1;for(let t=0;t<this.M;++t)e.at(t)<0&&e.set(t,0);return t.assignCopy(i),!0}let r,a,l,y,n,x,w,R=0,u=0,C=0,f=0,c=0;const d=this.M,M=this.N;t.assignCopy(this);const m=new Float64Array(d),N=new o(m,d,1),g=(t,s)=>s>=0?Math.abs(t):-Math.abs(t),b=(t,s)=>{if((t=Math.abs(t))>(s=Math.abs(s))){const e=s/t;return t*Math.sqrt(e*e+1)}if(s>0){const e=t/s;return s*Math.sqrt(e*e+1)}return 0};for(let s=0;s<d;s++){if(R=s+1,N.set(s,f*C),C=y=f=0,s<M){for(let e=s;e<M;e++)f+=Math.abs(t.atRowCol(e,s));if(f){for(let e=s;e<M;e++)t.setRowCol(e,s,t.atRowCol(e,s)/f),y+=t.atRowCol(e,s)*t.atRowCol(e,s);a=t.atRowCol(s,s),C=-g(Math.sqrt(y),a),l=a*C-y,t.setRowCol(s,s,a-C);for(let e=R;e<d;e++){y=0;for(let o=s;o<M;o++)y+=t.atRowCol(o,s)*t.atRowCol(o,e);a=y/l;for(let o=s;o<M;o++)t.setRowCol(o,e,t.atRowCol(o,e)+a*t.atRowCol(o,s))}for(let e=s;e<M;e++)t.setRowCol(e,s,t.atRowCol(e,s)*f)}}if(e.set(s,f*C),C=y=f=0,s<M&&s!==d-1){for(let e=R;e<d;e++)f+=Math.abs(t.atRowCol(s,e));if(f){for(let e=R;e<d;e++)t.setRowCol(s,e,t.atRowCol(s,e)/f),y+=t.atRowCol(s,e)*t.atRowCol(s,e);a=t.atRowCol(s,R),C=-g(Math.sqrt(y),a),l=a*C-y,t.setRowCol(s,R,a-C);for(let e=R;e<d;e++)N.set(e,t.atRowCol(s,e)/l);for(let e=R;e<M;e++){y=0;for(let o=R;o<d;o++)y+=t.atRowCol(e,o)*t.atRowCol(s,o);for(let s=R;s<d;s++)t.setRowCol(e,s,t.atRowCol(e,s)+y*N.at(s))}for(let e=R;e<d;e++)t.setRowCol(s,e,t.atRowCol(s,e)*f)}}const o=Math.abs(e.at(s))+Math.abs(N.at(s));c=o>c?o:c}for(let s=d-1;s>=0;s--){if(s<d-1){if(C){for(let e=R;e<d;e++)i.setRowCol(e,s,t.atRowCol(s,e)/t.atRowCol(s,R)/C);for(let e=R;e<d;e++){y=0;for(let o=R;o<d;o++)y+=t.atRowCol(s,o)*i.atRowCol(o,e);for(let t=R;t<d;t++)i.setRowCol(t,e,i.atRowCol(t,e)+y*i.atRowCol(t,s))}}for(let t=R;t<d;t++)i.setRowCol(s,t,0),i.setRowCol(t,s,0)}i.setRowCol(s,s,1),C=N.at(s),R=s}for(let s=(M<d?M:d)-1;s>=0;s--){R=s+1,C=e.at(s);for(let e=R;e<d;e++)t.setRowCol(s,e,0);if(C){C=1/C;for(let e=R;e<d;e++){y=0;for(let o=R;o<M;o++)y+=t.atRowCol(o,s)*t.atRowCol(o,e);a=y/t.atRowCol(s,s)*C;for(let o=s;o<M;o++)t.setRowCol(o,e,t.atRowCol(o,e)+a*t.atRowCol(o,s))}for(let e=s;e<M;e++)t.setRowCol(e,s,t.atRowCol(e,s)*C)}else for(let e=s;e<M;e++)t.setRowCol(e,s,0);t.setRowCol(s,s,t.atRowCol(s,s)+1)}for(let s=d-1;s>=0;s--)for(let o=1;;o++){let h=1;for(R=s;R>=0;R--){if(u=R-1,Math.abs(N.at(R))+c===c){h=0;break}if(Math.abs(e.at(u))+c===c)break}if(h){r=0,y=1;for(let o=R;o<=s&&(a=y*N.at(o),N.set(o,N.at(o)*r),Math.abs(a)+c!==c);o++){C=e.at(o),l=b(a,C),e.set(o,l),l=1/l,r=C*l,y=-a*l;for(let s=0;s<M;s++)x=t.atRowCol(s,u),w=t.atRowCol(s,o),t.setRowCol(s,u,x*r+w*y),t.setRowCol(s,o,w*r-x*y)}}if(w=e.at(s),R===s){if(w<0){e.set(s,-w);for(let t=0;t<d;t++)i.setRowCol(t,s,-i.atRowCol(t,s))}break}if(100===o)return!1;n=e.at(R),u=s-1,x=e.at(u),C=N.at(u),l=N.at(s),a=((x-w)*(x+w)+(C-l)*(C+l))/(2*l*x),C=b(a,1),a=((n-w)*(n+w)+l*(x/(a+g(C,a))-l))/n,r=y=1;for(let s=R;s<=u;s++){const o=s+1;C=N.at(o),x=e.at(o),l=y*C,C*=r,w=b(a,l),N.set(s,w),r=a/w,y=l/w,a=n*r+C*y,C=C*r-n*y,l=x*y,x*=r;for(let t=0;t<d;t++)n=i.atRowCol(t,s),w=i.atRowCol(t,o),i.setRowCol(t,s,n*r+w*y),i.setRowCol(t,o,w*r-n*y);w=b(a,l),e.set(s,w),w&&(w=1/w,r=a*w,y=l*w),a=r*C+y*x,n=r*x-y*C;for(let e=0;e<M;e++)x=t.atRowCol(e,s),w=t.atRowCol(e,o),t.setRowCol(e,s,x*r+w*y),t.setRowCol(e,o,w*r-x*y)}N.set(R,0),N.set(s,a),e.set(s,n)}const A=new Float64Array(this.N),p=new Float64Array(this.M),D=new o(A,this.N,1),P=new o(p,this.M,1);let v=1;do{v*=3,v++}while(v<=this.M);do{v/=3,v=Math.trunc(v);for(let s=v;s<this.M;s++){const o=e.at(s);for(let e=0;e<this.N;e++)D.set(e,t.atRowCol(e,s));for(let t=0;t<this.M;t++)P.set(t,i.atRowCol(t,s));let h=s;for(;e.at(h-v)<o;){e.set(h,e.at(h-v));for(let s=0;s<this.N;s++)t.setRowCol(s,h,t.atRowCol(s,h-v));for(let t=0;t<this.M;t++)i.setRowCol(t,h,i.atRowCol(t,h-v));if(h-=v,h<v)break}e.set(h,o);for(let s=0;s<this.N;s++)t.setRowCol(s,h,D.at(s));for(let t=0;t<this.M;t++)i.setRowCol(t,h,P.at(t))}}while(v>1);for(let s=0;s<this.M;s++){let e=0;for(let o=0;o<this.N;o++)t.atRowCol(o,s)<0&&e++;for(let t=0;t<this.M;t++)i.atRowCol(t,s)<0&&e++;if(e>Math.trunc((this.N+this.M)/2)){for(let e=0;e<this.N;e++)t.setRowCol(e,s,-t.atRowCol(e,s));for(let t=0;t<this.M;t++)i.setRowCol(t,s,-i.atRowCol(t,s))}}return!0}isSymmetric(){if(this.N!==this.M)return!1;for(let t=0;t<this.N;t++)for(let s=t+1;s<this.M;s++)if(this.atRowCol(t,s)!==this.atRowCol(s,t))return!1;return!0}isZero(){return s.geometryReleaseAssert(0),!1}isIdentity(){return s.geometryReleaseAssert(0),!1}equals(t,e){if(void 0!==e&&s.geometryReleaseAssert(0),this.N!==t.N||this.M!==t.M)return!1;for(let s=0;s<this.N*this.M;s++)if(this.data[s]!==t.data[s])return!1;return!0}maxElement(){return s.geometryReleaseAssert(0),0}minElement(){return s.geometryReleaseAssert(0),0}determinant(){if(s.geometryReleaseAssert(this.N===this.M),1===this.N)return this.data[0];if(2===this.N)return this.data[0]*this.data[3]-this.data[1]*this.data[2];if(3===this.N){const t=this;return t.atRowCol(0,0)*(t.atRowCol(1,1)*t.atRowCol(2,2)-t.atRowCol(1,2)*t.atRowCol(2,1))-t.atRowCol(0,1)*(t.atRowCol(1,0)*t.atRowCol(2,2)-t.atRowCol(2,0)*t.atRowCol(1,2))+t.atRowCol(0,2)*(t.atRowCol(1,0)*t.atRowCol(2,1)-t.atRowCol(1,1)*t.atRowCol(2,0))}const t=new Float64Array(this.N*this.N),e=new o(t,this.N,this.N),i=new Float64Array(this.N);if(!this.luDecomposition(e,i))return 0;let h=1;for(let t=0;t<this.N;t++)h*=e.atRowCol(t,t),i[t]!==t&&(h=-h);return h}submatrix(t,e,o){s.geometryReleaseAssert(0)}inverse(t){s.geometryReleaseAssert(0)}pseudoInverse(t,s=!1,e=2220446049250313e-31){if(t.setZero(),1===this.N&&1===this.M)return 0!==this.atRowCol(0,0)?t.setRowCol(0,0,1/this.atRowCol(0,0)):t.setRowCol(0,0,0),!0;if(2===this.N&&2===this.M){const s=this.atRowCol(0,0)*this.atRowCol(1,1)-this.atRowCol(0,1)*this.atRowCol(1,0),e=1e-5*(Math.abs(this.atRowCol(0,0)*this.atRowCol(1,1))+Math.abs(this.atRowCol(0,1)*this.atRowCol(1,0)));if(Math.abs(s)>e)return t.setRowCol(0,0,this.atRowCol(1,1)/s),t.setRowCol(0,1,-this.atRowCol(0,1)/s),t.setRowCol(1,0,-this.atRowCol(1,0)/s),t.setRowCol(1,1,this.atRowCol(0,0)/s),!0}const i=new Float64Array(this.N*this.M),h=new o(i,this.N,this.M),r=new Float64Array(this.M),a=new o(r,this.M,1),l=new Float64Array(this.M*this.M),y=new o(l,this.M,this.M);if(!this.svd(h,a,y,s))return!1;const n=Math.max(this.N,this.M),x=e*Math.abs(a.at(0))*n;for(let t=0;t<this.M;t++)a.at(t)>x?a.set(t,1/a.at(t)):a.set(t,0);return y.mulDiag(a,t),t.mulTranspose(h,t),!0}luDecomposition(t,e){return s.geometryReleaseAssert(0),!1}symmetricEigen(t,e){s.geometryReleaseAssert(this.rows()===this.cols()),s.geometryReleaseAssert(this.rows()===t.rows()),s.geometryReleaseAssert(e.rows()===e.cols()&&e.rows()===this.rows()),s.geometryReleaseAssert(this.isSymmetric());const i=new Float64Array(this.N*this.M),h=new o(i,this.N,this.M);h.assignCopy(this);const r=100/Number.EPSILON,a=this.rows(),l=new Float64Array(a),y=new Float64Array(a),n=new o(l,a,1),x=new o(y,a,1);for(let s=0;s<a;s++)n.set(s,h.atRowCol(s,s)),t.set(s,h.atRowCol(s,s)),x.set(s,0);e.setIdentity();const w=()=>{const s=n;e.transposeInPlace();let o=1;do{o*=3,o++}while(o<=a);do{o/=3,o=Math.trunc(o);for(let i=o;i<a;i++){const h=t.at(i),r=Math.abs(h);for(let t=0;t<this.M;t++)s.set(t,e.atRowCol(t,i));let a=i;for(;Math.abs(t.at(a-o))<r;){t.set(a,t.at(a-o));for(let t=0;t<this.M;t++)e.setRowCol(t,a,e.atRowCol(t,a-o));if(a-=o,a<o)break}if(a!==i){t.set(a,h);for(let t=0;t<this.M;t++)e.setRowCol(t,a,s.at(t))}}}while(o>1)};for(let s=1;;s++){let o=0;for(let t=1;t<a;t++)for(let s=0;s<t;s++)o+=Math.abs(h.atRowCol(t,s));if(0===o)return w(),!0;const i=s<4?.2*o/(a*a):0;for(let o=0;o<a;o++)for(let l=o+1;l<a;l++){let y=r*Math.abs(h.atRowCol(l,o));if(s>4&&y<=Math.abs(t.at(o))&&y<=Math.abs(t.at(l)))h.setRowCol(l,o,0);else if(Math.abs(h.atRowCol(l,o))>i){let s,i=t.at(l)-t.at(o);if(y<Math.abs(i))s=h.atRowCol(l,o)/i;else{const t=.5*i/h.atRowCol(l,o);s=1/(Math.abs(t)+Math.sqrt(1+t*t)),t<0&&(s=-s)}const r=1/Math.sqrt(1+s*s),n=s*r,w=n/(1+r);i=s*h.atRowCol(l,o),x.set(o,x.at(o)-i),x.set(l,x.at(l)+i),t.set(o,t.at(o)-i),t.set(l,t.at(l)+i),h.setRowCol(l,o,0);let R=0;for(;R<o;R++)y=h.atRowCol(o,R),i=h.atRowCol(l,R),h.setRowCol(o,R,y-n*(i+y*w)),h.setRowCol(l,R,i+n*(y-i*w));for(R++;R<l;R++)y=h.atRowCol(R,o),i=h.atRowCol(l,R),h.setRowCol(R,o,y-n*(i+y*w)),h.setRowCol(l,R,i+n*(y-i*w));for(R++;R<a;R++)y=h.atRowCol(R,o),i=h.atRowCol(R,l),h.setRowCol(R,o,y-n*(i+y*w)),h.setRowCol(R,l,i+n*(y-i*w));for(R=0;R<a;R++)y=e.atRowCol(o,R),i=e.atRowCol(l,R),e.setRowCol(o,R,y-n*(i+y*w)),e.setRowCol(l,R,i+n*(y-i*w))}}for(let s=0;s<a;s++)n.set(s,n.at(s)+x.at(s)),t.set(s,n.at(s)),x.set(s,0)}}static checkDims(t,e,o){s.geometryReleaseAssert(t.rows()===e&&t.cols()===o)}}class i extends o{constructor(t){if(t.copy){const s=new Float64Array(t.copy.N*t.copy.M);return super(s,t.copy.N,t.copy.M),this.buffer=s,void this.assignCopy(t.copy)}const s=new Float64Array(t.NN*t.MM);super(s,t.NN,t.MM),this.buffer=s,t.initializerList&&e.memcpy(this.buffer,t.initializerList,0,0,t.initializerList.length)}assignCopy(t){return this===t||super.assignCopy(t),this}}class h{constructor(t){this.m_TransformationType=1,void 0===t?this.setIdentity():t instanceof h?this.set(t):this.setScale(t)}set(t){return this.xx=t.xx,this.xy=t.xy,this.xd=t.xd,this.yx=t.yx,this.yy=t.yy,this.yd=t.yd,this}clone(){return(new h).set(this)}setZero(){this.xx=0,this.yy=0,this.xy=0,this.yx=0,this.xd=0,this.yd=0}isEqual(t){return this===t||this.xx===t.xx&&this.xy===t.xy&&this.xd===t.xd&&this.yx===t.yx&&this.yy===t.yy&&this.yd===t.yd}transformInPlace(t){const s=this.xx*t.x+this.xy*t.y+this.xd,e=this.yx*t.x+this.yy*t.y+this.yd;t.x=s,t.y=e}transform(t){const s=t.clone();return this.transformInPlace(s),s}queryTransform(t,s){const e=this.xx*t.x+this.xy*t.y+this.xd,o=this.yx*t.x+this.yy*t.y+this.yd;s.setCoords(e,o)}transformEnvInPlace(t){if(t.isEmpty())return;const s=e.makeObjectArray(e.Point2D,4);t.queryCorners(s),this.transformPoints2D(s,4,s),t.setFromPoints(s,4)}queryTransformEnv(t,e){s.geometryReleaseAssert(0)}transformPoints2D(t,s,e){for(let o=0;o<s;++o)this.queryTransform(t[o],e[o])}transformInterleavedPoints(t,s,o){s*=2;const i=e.Point2D.getNAN();for(let e=0;e<s;e+=2)i.x=t[e],i.y=t[e+1],this.transformInPlace(i),o[e]=i.x,o[e+1]=i.y}multiply(t){return h.st_multiply(this,t,this),this}mulLeft(t){return s.geometryReleaseAssert(0),this}static st_multiply(t,s,e){const o=t.xx*s.xx+t.yx*s.xy,i=t.xy*s.xx+t.yy*s.xy,h=t.xd*s.xx+t.yd*s.xy+s.xd,r=t.xx*s.yx+t.yx*s.yy,a=t.xy*s.yx+t.yy*s.yy,l=t.xd*s.yx+t.yd*s.yy+s.yd;e.xx=o,e.xy=i,e.xd=h,e.yx=r,e.yy=a,e.yd=l}getCoefficients(t){s.geometryReleaseAssert(t.length>=6),t[0]=this.xx,t[1]=this.xy,t[2]=this.xd,t[3]=this.yx,t[4]=this.yy,t[5]=this.yd}setCoefficients(t){s.geometryReleaseAssert(t.length>=6),this.xx=t[0],this.xy=t[1],this.xd=t[2],this.yx=t[3],this.yy=t[4],this.yd=t[5]}copyTo(t){s.geometryReleaseAssert(0)}initializeFromRect(t,s){t.isEmpty()||s.isEmpty()||!t.width()||!t.height()?this.setZero():(this.xy=this.yx=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xd=s.xmin-t.xmin*this.xx,this.yd=s.ymin-t.ymin*this.yy)}initializeFromRectIsotropic(t,s){if(t.isEmpty()||!t.width()||!t.height()||s.isEmpty())this.setZero();else{this.yx=0,this.xy=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xx>this.yy?this.xx=this.yy:this.yy=this.xx;const e=s.getCenter(),o=t.getCenter();this.xd=e.x-o.x*this.xx,this.yd=e.y-o.y*this.yy}}initializeFromTwoPointsArray(t,o){if(t[0].equals(o[0])&&t[1].equals(o[1]))return void this.setIdentity();if(t[0].equals(t[1])){if(o[0].equals(o[1]))return void this.setShift(o[0].sub(t[0]));s.throwInvalidArgumentException("")}if(!t[0].equals(t[1])&&o[0].equals(o[1]))return this.setZero(),void this.shift(o[0]);this.setShiftCoords(-t[0].x,-t[0].y);const i=e.Point2D.distance(t[0],t[1]),h=e.Point2D.distance(o[0],o[1]),r=h/i;this.scale(r,r);const a=t[1].sub(t[0]);a.divThis(i);const l=o[1].sub(o[0]);l.divThis(h);const y=a.crossProduct(l),n=a.dotProduct(l);this.rotate(n,y),this.shiftCoords(o[0].x,o[0].y)}initializeFromTwoPoints(t,s,e,o){const i=[t,s],h=[e,o];this.initializeFromTwoPointsArray(i,h)}transformSizeInPlace(t){s.geometryReleaseAssert(0)}transformSize(t,e){s.geometryReleaseAssert(0)}transformTol(t){return s.geometryReleaseAssert(0),0}transformWithoutTranslateArray(t,s,e){for(let o=0;o<s;++o)this.transformWithoutTranslate(t[o],e[o])}transformWithoutTranslateInPlace(t){const s=this.xx*t.x+this.xy*t.y,e=this.yx*t.x+this.yy*t.y;t.setCoords(s,e)}transformWithoutTranslate(t,s){const e=this.xx*t.x+this.xy*t.y,o=this.yx*t.x+this.yy*t.y;s.setCoords(e,o)}setIdentity(){this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=1,this.yd=0}isIdentity(){return!(1!==this.xx||1!==this.yy||this.xy||this.xd||this.yx||this.yd)}isIdentityTol(t){const s=t*t;return!(e.sqr(this.xd)+e.sqr(this.yd)>s||e.sqr(this.xy+this.xd)+e.sqr(this.yy+this.yd-1)>s||e.sqr(this.xx+this.xd-1)+e.sqr(this.yx+this.yd)>s)}isReflective(){return this.xx*this.yy-this.yx*this.xy<0}isUniform(t){const s=this.xx*this.xx+this.yx*this.yx,e=this.xy*this.xy+this.yy*this.yy,o=(s+e)*t;return Math.abs(s-e)<=o&&Math.abs(this.xx*this.xy+this.yx*this.yy)<=o}isUniformNoRotation(){return 0!==this.xx&&Math.abs(this.xx)===Math.abs(this.yy)&&0===this.xy&&0===this.yx}isTranslate(){return 1===this.xx&&1===this.yy&&!this.xy&&!this.yx}isTranslateTol(t){const s=new e.Point2D;return s.setCoords(0,1),this.transformWithoutTranslateInPlace(s),s.y-=1,!(s.sqrLength()>t*t)&&(s.setCoords(1,0),this.transformWithoutTranslateInPlace(s),s.x-=1,s.sqrLength()<=t*t)}isOrthonormal(t){const s=new h;return s.xx=this.xx*this.xx+this.xy*this.xy,s.xy=this.xx*this.yx+this.xy*this.yy,s.yx=this.yx*this.xx+this.yy*this.xy,s.yy=this.yx*this.yx+this.yy*this.yy,s.xd=0,s.yd=0,s.isIdentityTol(t)}isDegenerate(t){return Math.abs(this.xx*this.yy-this.yx*this.xy)<=2*t*(Math.abs(this.xx*this.yy)+Math.abs(this.yx*this.xy))}isZero(){return 0===this.xx&&0===this.yy&&0===this.xy&&0===this.yx&&0===this.xd&&0===this.yd}isScaleAndTranslateTol(t){return this.xy*this.xy+this.yx*this.yx<=(this.xx*this.xx+this.yy*this.yy)*t}setTranslate(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShiftCoords(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShift(t){return this.xx=1,this.xy=0,this.xd=t.x,this.yx=0,this.yy=1,this.yd=t.y,this}setScaleCoords(t,s){return this.xx=t,this.xy=0,this.xd=0,this.yx=0,this.yy=s,this.yd=0,this}setScale(t){return this.setScaleCoords(t,t),this}setFlipX(t,s){return this.xx=-1,this.xy=0,this.xd=t+s,this.yx=0,this.yy=1,this.yd=0,this}setFlipY(t,s){return this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=-1,this.yd=t+s,this}setShear(t,s){return this.xx=1,this.xy=t,this.xd=0,this.yx=s,this.yy=1,this.yd=0,this}scale(t,s){return this.xx*=t,this.xy*=t,this.xd*=t,this.yx*=s,this.yy*=s,this.yd*=s,this}setRotateAngle(t){return this.setRotate(Math.cos(t),Math.sin(t))}setRotate(t,s){return this.xx=t,this.xy=-s,this.xd=0,this.yx=s,this.yy=t,this.yd=0,this}setRotateAngleAbout(t,s){return this.setRotateAbout(Math.cos(t),Math.sin(t),s)}setRotateAbout(t,s,e){return this.setTranslate(-e.x,-e.y),this.rotate(t,s),this.translate(e.x,e.y)}setSwapCoordinates(){return this.xx=0,this.xy=1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}setRotateCw90(){return this.xx=0,this.xy=1,this.xd=0,this.yx=-1,this.yy=0,this.yd=0,this}setRotateCcw90(){return this.xx=0,this.xy=-1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}shiftCoords(t,s){return this.xd+=t,this.yd+=s,this}shift(t){return this.xd+=t.x,this.yd+=t.y,this}translate(t,s){return this.xd+=t,this.yd+=s,this}flipX(t,s){return this.xx=-this.xx,this.xy=-this.xy,this.xd=t+s-this.xd,this}flipY(t,s){return this.yx=-this.yx,this.yy=-this.yy,this.yd=t+s-this.yd,this}shear(t,s){const e=new h;return e.setShear(t,s),this.multiply(e)}rotateAngle(t){const s=new h;return s.setRotateAngle(t),this.multiply(s)}rotate(t,s){const e=new h;return e.setRotate(t,s),this.multiply(e)}rotateAbout(t,s,e){return this.translate(-e.x,-e.y),this.rotate(t,s),this.translate(e.x,e.y)}rotateAngleAbout(t,s){return this.rotateAbout(Math.cos(t),Math.sin(t),s)}setInvert(t){return this.set(t),this.invertThis()}invertThis(){let t=this.xx*this.yy-this.xy*this.yx;if(0===t)return this.setZero(),this;t=1/t;const s=(this.xy*this.yd-this.xd*this.yy)*t,e=(this.xd*this.yx-this.xx*this.yd)*t,o=this.yy*t,i=-this.xy*t,h=-this.yx*t,r=this.xx*t;return this.xd=s,this.yd=e,this.xx=o,this.yy=r,this.xy=i,this.yx=h,this}invertPrecise(t){return this.set(t),this.invertPreciseThis()}invertPreciseThis(){const t=e.MPValue.constructDouble(this.xy),s=e.MPValue.constructDouble(this.xx),o=s.mulDouble(this.yy).sub(t.mulDouble(this.yx));if(o.isZero())return this.setZero(),this;const i=o.clone();i.invertThis();const h=e.MPValue.constructDouble(this.xd),r=t.mulDouble(this.yd).sub(h.mulDouble(this.yy)).mul(i).toDouble(),a=h.mulDouble(this.yx).sub(s.mulDouble(this.yd)).mul(i).toDouble(),l=i.mulDouble(this.yy).toDouble(),y=i.mulDouble(-this.xy).toDouble(),n=i.mulDouble(-this.yx).toDouble(),x=i.mulDouble(this.xx).toDouble();return this.xd=r,this.yd=a,this.xx=l,this.yy=x,this.xy=y,this.yx=n,this}extractScaleTransform(t,s){const e=Math.sqrt(this.xx*this.xx+this.xy*this.xy),o=Math.sqrt(this.yx*this.yx+this.yy*this.yy);s.setScaleCoords(1/e,1/o),s.multiply(this),t.setScaleCoords(e,o)}setFromTwoTriangles(t,s){let o=!0;for(let e=0;e<3;++e)o=o&&t[e].equals(s[e]);if(o)return this.setIdentity(),!0;const i=new e.Point2D;i.setSub(t[0],t[1]);const h=new e.Point2D;h.setSub(t[0],t[2]);const r=new e.Point2D;r.setSub(s[0],s[1]);const a=new e.Point2D;a.setSub(s[0],s[2]);const l=4*Number.EPSILON*(Math.abs(i.x*h.y)+Math.abs(h.x*i.y));let y=i.x*h.y-i.y*h.x;return Math.abs(y)>l?(y=1/y,this.xx=(r.x*h.y-i.y*a.x)*y,this.xy=(i.x*a.x-r.x*h.x)*y,this.yx=(r.y*h.y-i.y*a.y)*y,this.yy=(i.x*a.y-r.y*h.x)*y,this.xd=s[0].x-(this.xx*t[0].x+this.xy*t[0].y),this.yd=s[0].y-(this.yx*t[0].x+this.yy*t[0].y),!0):(this.setZero(),!1)}initializeFromControlPoints(t,o,l,y,n=null){return 0===o?(this.setIdentity(),void(n&&n.setIdentity())):1===o?(this.setShift(y[0].sub(l[0])),void(n&&n.setShift(l[0].sub(y[0])))):(o<3&&(t=1),void(4===t&&o>2?function(t,o,h,r,l){const y=e.Point2D.average(h,o),n=e.Point2D.average(r,o),x=new i({NN:2,MM:2});x.setZero();const w=new i({NN:2,MM:2});w.setZero();for(let t=0;t<o;++t)x.setRowCol(0,0,x.atRowCol(0,0)+(h[t].x-y.x)*(h[t].x-y.x)),x.setRowCol(0,1,x.atRowCol(0,1)+(h[t].x-y.x)*(h[t].y-y.y)),x.setRowCol(1,1,x.atRowCol(1,1)+(h[t].y-y.y)*(h[t].y-y.y)),w.setRowCol(0,0,w.atRowCol(0,0)+(r[t].x-n.x)*(h[t].x-y.x)),w.setRowCol(0,1,w.atRowCol(0,1)+(r[t].x-n.x)*(h[t].y-y.y)),w.setRowCol(1,0,w.atRowCol(1,0)+(r[t].y-n.y)*(h[t].x-y.x)),w.setRowCol(1,1,w.atRowCol(1,1)+(r[t].y-n.y)*(h[t].y-y.y));x.setRowCol(1,0,x.atRowCol(0,1));const R=new i({NN:2,MM:2});x.pseudoInverse(R,!0)||s.throwMathSingularityException("Failed to compute pseudo inverse"),w.mul(R,w),a(t,w);const u=y.clone();t.transformInPlace(u),t.xd=n.x-u.x,t.yd=n.y-u.y,l&&(w.pseudoInverse(R,!1)||s.throwMathSingularityException("Failed to compute pseudo inverse"),a(l,R),l.transformInPlace(n),l.xd=y.x-n.x,l.yd=y.y-n.y)}(this,o,l,y,n):function(t,o,l,y,n,x){s.geometryReleaseAssert(1===t||0===t||2===t||3===t),o.setIdentity();const w=e.Point2D.average(y,l),R=e.Point2D.average(n,l);if(s.geometryReleaseAssert(t<r.length&&t>0),8&r[t]){const e=new i({NN:2,MM:2});e.setZero();for(let t=0;t<l;++t)e.setRowCol(0,0,e.atRowCol(0,0)+(n[t].x-R.x)*(y[t].x-w.x)),e.setRowCol(1,0,e.atRowCol(1,0)+(n[t].x-R.x)*(y[t].y-w.y)),e.setRowCol(0,1,e.atRowCol(0,1)+(n[t].y-R.y)*(y[t].x-w.x)),e.setRowCol(1,1,e.atRowCol(1,1)+(n[t].y-R.y)*(y[t].y-w.y));const x=new i({NN:2,MM:2}),u=new i({NN:2,MM:1}),C=new i({NN:2,MM:2});e.svd(x,u,C)||s.throwMathSingularityException("Failed to compute svd");const f=new i({NN:2,MM:2});x.transpose(f);const c=new i({NN:2,MM:2});C.mul(f,c),32&r[t]||c.determinant()<0&&(f.setRowCol(1,0,-f.atRowCol(1,0)),f.setRowCol(1,1,-f.atRowCol(1,1)),C.mul(f,c));const d=new h;a(d,c),o.set(d)}if(2&r[t]){let t=0,s=0;for(let e=0;e<l;++e){const i=y[e].sub(w);t+=i.sqrLength(),o.transformInPlace(i),s+=i.dotProduct(n[e].sub(R))}if(0===t)0===s?o.setIdentity():o.setZero();else{const e=s/t;o.scale(e,e)}}else s.geometryReleaseAssert(!(4&r[t]));const u=w.clone();o.transformInPlace(u),o.xd=R.x-u.x,o.yd=R.y-u.y,x&&(x.set(o),x.invertThis(),x.isZero()&&(x.xd=w.x,x.yd=w.y))}(t,this,o,l,y,n)))}calculateErrors(t,o,i,h){s.geometryReleaseAssert(t>0&&null!==o&&null!==i);let r=0;for(let s=0;s<t;++s){const t=this.transform(o[s]),a=e.Point2D.sqrDistance(i[s],t);r+=a,h&&(h[s]=Math.sqrt(a))}return Math.sqrt(r/t)}}const r=[43,11,41,9,61];function a(t,e){s.geometryReleaseAssert(!(2!==e.rows()&&3!==e.rows()||2!==e.cols()&&3!==e.rows())),t.xx=e.atRowCol(0,0),t.xy=e.atRowCol(0,1),t.yx=e.atRowCol(1,0),t.yy=e.atRowCol(1,1),3===e.cols()?(t.xd=e.atRowCol(0,2),t.yd=e.atRowCol(1,2)):(t.xd=0,t.yd=0)}t.Transformation2D=h});