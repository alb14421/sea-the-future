// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../chunks/tslib.es6","../../Color","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../libs/maquette/projection","../../libs/maquette/h","../../libs/maquette/projector"],function(t,e,o,r,i,s,a,l,n,d,h,p){"use strict";const c={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};t.default=class extends r{get position(){return[this.x,this.y]}set position(t){this._set("x",t[0]),this._set("y",t[1])}get _textShadowColor(){const{textColor:t,backgroundColor:e}=this,o=e.clone();return o.a*=t.a,o}get _textShadow(){const t=this._textShadowColor.toCss(!0);return`0 0 ${this._textShadowSize}px ${t}`}get padding(){return.5*this.fontSize}get borderRadius(){return this.padding}set borderRadius(t){this._overrideIfSome("borderRadius",t)}constructor(t){super(t),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.isDecoration=!0,this.backgroundColor=new o([0,0,0,.6]),this.textColor=new o([255,255,255]),this._textShadowSize=1}render(){return h.h("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this.padding+"px",borderRadius:this.borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(t){if(!this.visible)return;const e=t.font.replace(/^(.*?)px/,"");t.font=`${this.fontSize}px ${e}`;const{padding:o,borderRadius:r}=this,i=t.measureText(this.text).width,s=""!==this.text?this.fontSize:0,a=x[this.anchor];t.textAlign="center",t.textBaseline="middle";const l=i+2*o,n=s+2*o,d=this.x+a.x*l,h=this.y+a.y*n;this._roundedRect(t,d,h,l,n,r),t.fillStyle=this.backgroundColor.toCss(!0),t.fill();const p=this.x+(a.x+.5)*l,c=this.y+(a.y+.5)*n;this._renderTextShadow(t,this.text,p,c),t.fillStyle=this.textColor.toCss(!0),t.fillText(this.text,p,c)}_renderTextShadow(t,e,o,r){t.lineJoin="miter",t.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/y.length})`;const i=this._textShadowSize;for(const[s,a]of y)t.fillText(e,o+i*s,r+i*a)}_roundedRect(t,e,o,r,i,s){s=Math.min(s,i/2,r/2),t.beginPath(),t.moveTo(e,o+s),t.arcTo(e,o,e+s,o,s),t.lineTo(e+r-s,o),t.arcTo(e+r,o,e+r,o+s,s),t.lineTo(e+r,o+i-s),t.arcTo(e+r,o+i,e+r-s,o+i,s),t.lineTo(e+s,o+i),t.arcTo(e,o+i,e,o+i-s,s),t.closePath()}_cssClasses(){const t={"esri-text-overlay-item":!0};let e;for(e in c)t[c[e]]=this.anchor===e;return t}},e.__decorate([i.property()],t.default.prototype,"x",void 0),e.__decorate([i.property()],t.default.prototype,"y",void 0),e.__decorate([i.property()],t.default.prototype,"position",null),e.__decorate([i.property()],t.default.prototype,"text",void 0),e.__decorate([i.property()],t.default.prototype,"fontSize",void 0),e.__decorate([i.property()],t.default.prototype,"anchor",void 0),e.__decorate([i.property()],t.default.prototype,"visible",void 0),e.__decorate([i.property()],t.default.prototype,"isDecoration",void 0),e.__decorate([i.property()],t.default.prototype,"backgroundColor",void 0),e.__decorate([i.property()],t.default.prototype,"textColor",void 0),e.__decorate([i.property()],t.default.prototype,"_textShadowSize",void 0),e.__decorate([i.property()],t.default.prototype,"_textShadowColor",null),e.__decorate([i.property()],t.default.prototype,"_textShadow",null),e.__decorate([i.property()],t.default.prototype,"padding",null),e.__decorate([i.property()],t.default.prototype,"borderRadius",null),t.default=e.__decorate([n.subclass("esri.views.overlay.TextOverlayItem")],t.default);const x={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},y=[];{const t=16;for(let e=0;e<360;e+=360/t)y.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)])}return t.default});