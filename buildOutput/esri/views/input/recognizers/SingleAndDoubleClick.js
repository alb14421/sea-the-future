// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/clock","../../../core/maybe","../InputHandler","./support"],function(e,t,i,o,n){"use strict";class r extends o.InputHandler{constructor(e={},i=t.clock){super(!1),this._clock=i,this._pointerState=new Map,this._parameters=n.getDoubleClickParameters(e),this._click=this.registerOutgoing("click"),this._doubleClick=this.registerOutgoing("double-click"),this.registerIncoming("immediate-click",e=>this._handleImmediateClick(e)),this.registerIncoming("pointer-down",e=>this._handlePointerDown(e))}onUninstall(){this._pointerState.forEach(e=>e.doubleClickTimer=i.removeMaybe(e.doubleClickTimer))}get hasPendingInputs(){for(const e of this._pointerState.values())if(null!=e.doubleClickTimer)return!0;return!1}_clearDoubleClickTimer(e,t){const o=this._pointerState.get(e);o&&(o.doubleClickTimer=i.removeMaybe(o.doubleClickTimer),t&&this._click.emit(o.event.data,void 0,o.event.modifiers),this._pointerState.delete(e),this.refreshHasPendingInputs())}_doubleClickTimeoutExceeded(e){const t=this._pointerState.get(e);1===t.pointerDownCount&&this._click.emit(t.event.data,void 0,t.event.modifiers),t.doubleClickTimer=null,this._pointerState.delete(e),this.refreshHasPendingInputs()}_handleImmediateClick(e){const t=e.data,{pointerType:i}=t.native,o=function(e){const{pointerId:t,pointerType:i,button:o}=e.native;return"mouse"===i?`${t}:${o}`:`${i}`}(t);if(!this._pointerState.has(o))return void this._startClick(e);const r=this._pointerState.get(o),{data:s,modifiers:a}=r.event,l="touch"===i?this._parameters.maximumDoubleTouchDistance:this._parameters.maximumDoubleClickDistance;n.manhattanDistance(s,t)>l?(this._clearDoubleClickTimer(o,!0),this._startClick(e)):(this._clearDoubleClickTimer(o,!1),2===r.pointerDownCount&&this._doubleClick.emit(s,void 0,a))}_handlePointerDown(e){const t=n.getPointerId(e.data),i=this._pointerState.get(t);i&&(i.pointerDownCount+=1)}_startClick(e){const{data:t}=e,{native:{pointerType:i}}=t,o=n.getPointerId(t),r="touch"===i?this._parameters.maximumDoubleTouchDelay:this._parameters.maximumDoubleClickDelay,s=this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(o),r);this._pointerState.set(o,{event:e,doubleClickTimer:s,pointerDownCount:1}),this.refreshHasPendingInputs()}}e.SingleAndDoubleClick=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});