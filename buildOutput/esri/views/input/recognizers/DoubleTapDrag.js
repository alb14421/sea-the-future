// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/clock","../../../core/maybe","../../../core/screenUtils","../DragEventSeparator","../InputHandler","./support"],function(t,e,a,r,i,o,n){"use strict";class s extends o.InputHandler{constructor(t={},a=e.clock){super(!1),this._clock=a,this._doubleTapDragReady=!1,this._doubleTapDragActive=!1,this._dragStartCenter=r.createScreenPoint(0,0),this._pointerState=new Map,this._parameters=n.getDoubleClickParameters(t),this._doubleTapDrag=this.registerOutgoing("double-tap-drag"),this._dragEventSeparator=new i.DragEventSeparator({start:(t,e)=>this._dragStart(t,e),update:(t,e)=>this._dragUpdate(e),end:(t,e)=>this._dragEnd(e)}),this.registerIncoming("drag",t=>this._dragEventSeparator.handle(t)),this.registerIncoming("pointer-down",t=>this._handlePointerDown(t)),this.registerIncoming("pointer-up",()=>this._handlePointerUp())}onUninstall(){this._pointerState.forEach(t=>{t.doubleTapTimeout=a.removeMaybe(t.doubleTapTimeout)})}get hasPendingInputs(){for(const t of this._pointerState.values())if(null!=t.doubleTapTimeout)return!0;return!1}_clearPointerDown(t){const e=this._pointerState.get(t);e&&(e.doubleTapTimeout=a.removeMaybe(e.doubleTapTimeout),this._pointerState.delete(t),this.refreshHasPendingInputs())}_dragStart(t,e){if(!this._doubleTapDragReady||1!==t)return;this._doubleTapDragReady=!1,this._doubleTapDragActive=!0;const{data:a,modifiers:i}=e,{center:o}=a;this._dragStartCenter=o;const n=d("begin",r.createScreenPoint(0,0),a);this._doubleTapDrag.emit(n,void 0,i),e.stopPropagation()}_dragUpdate(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:a}=t,{center:i}=e,o=d("update",r.createScreenPoint(i.x-this._dragStartCenter.x,i.y-this._dragStartCenter.y),e);this._doubleTapDrag.emit(o,void 0,a),t.stopPropagation()}_dragEnd(t){if(!this._doubleTapDragActive)return;const{data:e,modifiers:a}=t,{center:i}=e,o=d("end",r.createScreenPoint(i.x-this._dragStartCenter.x,i.y-this._dragStartCenter.y),e);this._doubleTapDrag.emit(o,void 0,a),this._doubleTapDragActive=!1,t.stopPropagation()}_handlePointerDown(t){const{data:e}=t,a=n.getPointerId(e),r=this._pointerState.get(a),{pointerType:i}=e.native;if(r){const o="touch"===i?this._parameters.maximumDoubleTouchDistance:this._parameters.maximumDoubleClickDistance;this._clearPointerDown(a),n.manhattanDistance(r.event.data,e)>o?this._storePointerDown(t):this._doubleTapDragReady=!0}else this._storePointerDown(t)}_handlePointerUp(){this._doubleTapDragReady=!1}_storePointerDown(t){const{data:e}=t,{pointerType:a}=e.native,r=n.getPointerId(e),i="touch"===a?this._parameters.maximumDoubleTouchDelay:this._parameters.maximumDoubleClickDelay,o=this._clock.setTimeout(()=>this._clearPointerDown(r),i);this._pointerState.set(r,{event:t,doubleTapTimeout:o}),this.refreshHasPendingInputs()}}function d(t,e,a){const{button:r,buttons:i,pointer:o,pointers:n,pointerType:s,timestamp:d}=a;return{action:t,delta:e,button:r,buttons:i,pointer:o,pointers:n,pointerType:s,timestamp:d}}t.DoubleTapDrag=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});