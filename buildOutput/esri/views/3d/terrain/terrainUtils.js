// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/Collection","../../../geometry/support/spatialReferenceUtils","../../../layers/support/layerUtils","./TerrainData","../../../chunks/terrainUtilsPlanar","../../../chunks/terrainUtilsSpherical"],function(e,n,t,r,i,o,l){"use strict";const a={1:l.terrainUtilsSpherical,2:o.terrainUtilsPlanar};function u(e){return"imagery-tile"===e?.type||"wcs"===e?.type}function s(e){return"imagery-tile-3d"===e?.type}function c(e){return"tile-3d"===e?.type}function f(e){return"vector-tile-3d"===e?.type}function T(e){return"wmts-3d"===e?.type}function p(e){return"elevation-3d"===e?.type}function y(e){return e&&(c(e)||s(e)||f(e)||T(e))}function I(e){return i.isVectorTile(e?.data)}function d(e,n,t,r,i){return a[r].checkIfTileInfoSupportedForViewSR(e,t,n,i)}function h(e,t,i){const o=r.getTileMaxtrixSetFromActiveLayer(e);if(null!=o){if(!n.isCollection(o))return{tileInfo:o.tileInfo,fullExtent:o.fullExtent};{const e=o.find(e=>null==d(e.tileInfo,e.fullExtent,t,i));if(e)return{tileInfo:e.tileInfo,fullExtent:e.fullExtent}}}return{tileInfo:null,fullExtent:null}}function L(e){return e.isWGS84||e.isWebMercator||t.isCGCS2000(e)||!t.isEarth(e)}e.enableTerrainInternalChecks=!1,e.enableWaterproofTests=!1;const g={force512VTL:!1},m=1e-5;e.almostEquals=function(e,n,t=m){return Math.abs(e-n)<t},e.checkIfTileInfoSupportedForView=d,e.enableInternalTerrainChecks=function(n){e.enableTerrainInternalChecks=n},e.enableTerrainWaterproofChecks=function(n){e.enableWaterproofTests=n,e.enableTerrainInternalChecks=e.enableTerrainInternalChecks||n},e.eps=m,e.getTileInfoAndExtentFromWMTSLayer=h,e.getTiledLayerInfo=function(e,n,t){let r=null,i=null;if("wmts"===e?.type){const o=h(e,n,t);r=o.tileInfo,i=o.fullExtent}else{i=u(e)?e.getCompatibleFullExtent(n):e.fullExtent;const o=2===t;r=u(e)?e.getCompatibleTileInfo(n,i,o):"vector-tile"===e?.type?o&&!L(n)||g.force512VTL?e.tileInfo:e.tileInfo.getCompatibleForVTL(256):e.tileInfo}const o="tilemapCache"in e?e.tilemapCache?.effectiveMaxLOD:void 0;return null!=r&&null!=i&&null==d(r,i,n,t,o)?{tileInfo:r,fullExtent:i}:null},e.internalAssert=function(n,t){if(e.enableTerrainInternalChecks&&!n){const e=(new Error).stack?.slice(5);throw console.warn("Terrain internal: "+(t??"")+" at "+e),new Error("Assertion failed"+(t?": "+t:""))}},e.isBlendableLayerView=function(e){return e&&(c(e)||T(e)||s(e)||f(e))},e.isEast=function(e){return 1===e||2===e||3===e},e.isElevationLayer=function(e){return"elevation"===e?.type},e.isElevationLayerView=p,e.isGroupLayerView=function(e){return"group"===e?.type},e.isImageSourceRenderInfo=function(e){const n=e?.sourceLayerInfo?.data;return i.isImageWithType(n)||n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof ImageData},e.isImageryTileLayerView=s,e.isImageryTileRenderInfo=function(e){return i.isRasterTile(e?.sourceLayerInfo?.data)},e.isMapTileLayerView=y,e.isNorth=function(e){return 1===e||0===e||7===e},e.isNorthCorner=function(e){return 7===e||1===e},e.isProjectableRasterLayer=u,e.isSouth=function(e){return 3===e||4===e||5===e},e.isSurfaceLayerView=function(e){return y(e)||p(e)},e.isTextureTileRenderInfo=function(e){return i.isTileTexture(e?.sourceLayerInfo?.data)},e.isTileLayerView=c,e.isVectorTileLayerView=f,e.isVectorTilePerLayerInfo=I,e.isVectorTileRenderInfo=function(e){return I(e?.sourceLayerInfo)||!!e?.isVTLBackground},e.isWMTSLayerView=T,e.isWest=function(e){return 7===e||6===e||5===e},e.isWestCorner=function(e){return 7===e||5===e},e.lij2s=function(e){return"["+e[0]+","+e[1]+","+e[2]+"]"},e.neighborCornerIndices=[1,3,5,7],e.neighborEdgeIndices=[0,2,4,6],e.oppositeCorner=function(e){return 1===e?5:7===e?3:5===e?1:7},e.oppositeEdge=function(e){return 0===e?4:2===e?6:4===e?0:2},e.releaseTerrainData=function(e){return null!=e&&"release"in e&&e.release(),null},e.test=g,e.useFetchTileForLayer=function(e){return e.fetchTile&&!1!==e.hasOverriddenFetchTile},e.v32s=function(e){return"("+e[0]+","+e[1]+","+e[2]+")"},e.vtlAssumes256PixelSizeAsDefault=L,e.weakAssert=function(e,n){e||console.warn("Terrain: "+n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});