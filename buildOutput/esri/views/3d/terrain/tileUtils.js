// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/PooledArray","./terrainUtils"],function(e,t,r){"use strict";function n(e,t,r=()=>!0){if(t(e),!e.leaf&&r(e))for(const r of e.children)n(r,t)}function i(e,t){const r=e.lij,n=t.lij;return r[0]-n[0]||r[1]-n[1]||r[2]-n[2]}function l(e,t){const r=e.screenDepth-t.screenDepth;if(0!==r)return r;const n=e.lij,i=t.lij;return n[0]-i[0]||n[1]-i[1]||n[2]-i[2]}function s(e,t){const r=e.screenDepth,n=t.screenDepth;return r<n?-1:r>n?1:i(e,t)}function o(e,t,r){return a(e,r)===a(t,r)?s(e,t):e?1:-1}function a(e,t){for(const r of t)if(e.intersectsExtent(r))return!0;return!1}function u(e,t){const r=e.distanceToPOI-t.distanceToPOI;if(0!==r)return r;const n=e.lij,i=t.lij;return n[0]-i[0]||n[1]-i[1]||n[2]-i[2]}e.IteratorPostorder=class{constructor(){this._q=new t}get done(){return 0===this._q.length}reset(e){if(this._q.clear(),null!=e){this._q.pushArray(e);for(let e=0;e<this._q.length;++e){const t=this._q.data[e];t.leaf||this._q.pushArray(t.children)}}}next(){return this._q.pop()}},e.IteratorPreorder=class{constructor(){this._queue=new t,this.remove=()=>{}}get done(){return 0===this._queue.length&&(!this._last||this._last.leaf)}resetOne(e){this._queue.clear(),this._queue.push(e),this._last=void 0}reset(e=null){this._queue.clear(),null!=e&&this._queue.pushArray(e),this._last=void 0}skipSubtree(){this._last=void 0}next(){const e=this._last?.children;return e?.[0]&&this._queue.pushArray(e),this._last=this._queue.pop(),this._last}},e.compareTiles=s,e.compareTilesByLij=i,e.compareTilesWithStencil=o,e.computeUpsampleInfo=function(e,t,r){let n=1,i=0,l=0;for(;e!==t;)if(n*=.5,i*=.5,l*=.5,1&e.lij[2]&&(i+=.5),1&e.lij[1]||(l+=.5),null==(e=e.parent))throw new Error("tile was not a descendant of upsampleTile");r.init(t,i,l,n)},e.fallsWithinLayerView=function(e,t){if(null==t||t.destroyed)return!1;const n=(i=t,r.isImageryTileLayerView(i)?{fullExtent:i.fullExtent,minScale:i.layer.minScale,maxScale:i.layer.maxScale}:i.layer);var i;if(null==n?.fullExtent)return!1;const l=n.fullExtent,s=e.extent;if(l.xmin>s[2]||l.ymin>s[3]||l.xmax<s[0]||l.ymax<s[1])return!1;const o=e.surface.tilingScheme.levels[e.level].scale,a=n.minScale;if(a>0&&o>1.00000001*a)return!1;const u=n.maxScale;return!(u>0&&o<.99999999*u)},e.getTileMapCache=function(e){return!r.isImageryTileLayerView(e)&&e.layer&&"tilemapCache"in e.layer?e.layer.tilemapCache:null},e.hasLoadableSiblings=function(e){for(let t=0;t<e.length;t++){const r=e[t],n=r.parent;if(n)for(let e=0;e<4;e++){const t=n.children[e];if(t&&t!==r)return!0}}return!1},e.sortTiles=function(e,t=null){null==t||0===t.length?e.sort(l):e.sort((e,r)=>o(e,r,t))},e.sortTilesByPOI=function(e,t){const r=e.length;for(let n=0;n<r;++n)e.at(n).updateDistanceToPOI(t);e.sort(u)},e.tilesAreRelated=function(e,t){if(!e||!t||e[0]===t[0])return!1;const r=e[0]<t[0],n=r?e:t,i=r?t:e,l=1<<i[0]-n[0];return Math.floor(i[1]/l)===n[1]&&Math.floor(i[2]/l)===n[2]},e.traverseTilesPreorder=function(e,t,r=()=>!0){if(Array.isArray(e))for(let i=0;i<e.length;i++)n(e[i],t,r);else n(e,t,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});