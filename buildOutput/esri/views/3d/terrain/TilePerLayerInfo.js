// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/maybe","../../../core/ObjectPool","../../../core/PooledArray","./terrainUtils","./tileUtils"],function(e,t,s,a,i,n){"use strict";class l{constructor(){this.waitingAgents=new a,this.pendingUpdates=0}static acquire(e){const t=o.acquire();return t._init(e),t}release(){this.dispose(),r.delete(this),o.release(this)}dispose(){this.loadingAgent=t.disposeMaybe(this.loadingAgent),this.abortRequest(),this._unsetUpsampleInfo(),this.pendingUpdates=0,this._data=i.releaseTerrainData(this._data)}static prune(){o.prune(0)}_init(e){this.waitingAgents.clear(),this._data=i.releaseTerrainData(this._data),this.dataMissing=!1,this.dataInvalidated=!1,this._unsetUpsampleInfo(),this.abortRequest(),this.loadingAgent=null,this.pendingUpdates=0,this._pool=e,this.elevationBounds=null}invalidateSourceData(){this.dataInvalidated=!0,this.dataMissing=!1,this._unsetUpsampleInfo()}abortRequest(){this.requestAbort=t.abortMaybe(this.requestAbort),this.requestPromise=null}_unsetUpsampleInfo(){this.upsampleInfo&&(this.upsampleInfo.tile?.unrefMapData(),this._pool.release(this.upsampleInfo),this.upsampleInfo=null)}setUpsampleInfo(e,t){if(e!==t&&null!=t){if(null==this.upsampleInfo)this.upsampleInfo=this._pool.acquire();else{if(this.upsampleInfo.tile===t)return;this.upsampleInfo.tile?.unrefMapData()}t.refMapData(),n.computeUpsampleInfo(e,t,this.upsampleInfo)}else this._unsetUpsampleInfo()}get data(){return this._data}set data(e){i.releaseTerrainData(this._data),this._data=e}}const o=new s(l,null,()=>{}),r=new Map;e.TilePerLayerInfo=l,e.clearTilePerLayerInfo=function(){o.prune(),r.clear()},e.printAllocations=function(){r.size>0&&(console.log(`${r.size} live TilePerLayerInfo allocations:`),r.forEach(e=>console.log(e,"\n")))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});