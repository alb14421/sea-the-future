// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/maybe"],function(t,e){"use strict";class i{constructor(t){this._getFadeDuration=t,this._fadeStart=0,this._delayedTime=0}clear(){this._current=e.destroyMaybe(this._current),this._next=e.destroyMaybe(this._next),this._waiting=e.destroyMaybe(this._waiting),this._delayed=e.destroyMaybe(this._delayed)}get current(){if(null==this._current)return null;if(!this._isFadingEnabled){let t=null;this._delayed?(t=this._delayed,this._delayed=null):this._waiting?(t=this._waiting,this._waiting=null):this._next&&(t=this._next,this._next=null),t&&(this.clear(),this._current=t)}let t=i.test.fadeMoment;if(this._delayed&&(t=t||performance.now(),t>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null)),this._next){t=t||performance.now();const i=this._fadeDuration,n=null!=this._current&&this._next.texture===this._current.texture,s=0!==this._next.type,a=t-this._fadeStart>=i;(n||s||a)&&(e.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(t))}return this._current}get next(){return this._next}get fadeFactor(){if(null==this._next)return 1;const t=i.test.fadeMoment||performance.now(),e=Math.max(0,t-this._fadeStart),n=this._fadeDuration;return e>n?0:1-e/n}get isFading(){return null!=this._next||null!=this._delayed}push(t,i=0){this._delayed=e.destroyMaybe(this._delayed),this._push(t,i)}_push(t,n){if(this._isFadingEnabled||this.clear(),null==this._current)return void(this._current=t);const s=i.test.fadeMoment||performance.now();return 0!==n?(this._delayed=t,void(this._delayedTime=s+n)):null==this._next?(this._next=t,void(this._fadeStart=this._alignFadeStart(s))):void(null!=t&&(e.destroyMaybe(this._waiting),this._waiting=t))}get _fadeDuration(){const t=this._getFadeDuration();return this._waiting?.5*t:t}_alignFadeStart(t){const e=this._getFadeDuration();return t+e-t%e}get _isFadingEnabled(){return this._getFadeDuration()>0}static{this.test={fadeMoment:0}}}t.TextureFader=i,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});