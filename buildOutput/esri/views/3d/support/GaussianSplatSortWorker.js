// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/aaBoundingBox"],function(t,e,n){"use strict";class r{constructor(t){this.newSortOrder=t}}let a=e.create(),o=e.create();const s=n.create();let l=null,i=null;t.SplatSortWorkerOutput=r,t.destroy=function(){l=null,i=null},t.sortCentersRelativeToCamera=async function(t){const{cameraPosition:e,cameraDirection:n,gaussianCenters:c,sortOrder:h}=t;if(0===c.length||0===h.length||h.length!==c.length/3)return{result:new r(h)};const u=.001;return Math.abs(e[0]-a[0])>u||Math.abs(e[1]-a[1])>u||Math.abs(e[2]-a[2])>u||Math.abs(n[0]-o[0])>u||Math.abs(n[1]-o[1])>u||Math.abs(n[2]-o[2])>u?(a=e,o=e,function(t){let e=!1;for(let n=0;n<t.length;n+=3){const r=t[n],a=t[n+1],o=t[n+2];e?(s[0]=Math.min(s[0],r),s[3]=Math.max(s[3],r),s[1]=Math.min(s[1],a),s[4]=Math.max(s[4],a),s[2]=Math.min(s[2],o),s[5]=Math.max(s[5],o)):(s[0]=s[3]=r,s[1]=s[4]=a,s[2]=s[5]=o,e=!0)}e||(s[0]=s[3]=0,s[1]=s[4]=0,s[2]=s[5]=0)}(c),function(t,e,n){const r=n[0],a=n[1],o=n[2],c=t.length/3,h=Math.max(10,Math.min(20,Math.round(Math.log2(c/.25)))),u=1+(1<<h);!function(t,e){l?.length!==t&&(l=new Uint32Array(t)),i&&i.length===1+(1<<e)?i.fill(0):i=new Uint32Array(1+(1<<e))}(c,h);let f=0,M=0;for(let t=0;t<8;++t){const e=(1&t?s[0]:s[3])*r+(2&t?s[1]:s[4])*a+(4&t?s[2]:s[5])*o;0===t?f=M=e:(f=Math.min(f,e),M=Math.max(M,e))}const m=M-f;if(m<1e-6)for(let t=0;t<c;++t)l[t]=0,i[0]++;else{const e=(1<<h)/m;for(let n=0,s=0;n<c;++n){const c=(t[s++]*r+t[s++]*a+t[s++]*o-f)*e>>>0;l[n]=c,i[c]++}}for(let t=1;t<u;t++)i[t]+=i[t-1];for(let t=0;t<c;t++){const n=l[t];e[--i[n]]=t}}(c,h,n),{result:new r(h),transferList:[h.buffer]}):{result:new r(h),transferList:[h.buffer]}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});