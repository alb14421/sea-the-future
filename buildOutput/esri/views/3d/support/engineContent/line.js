// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/projectors","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../../../geometry/support/HalfFloatArray","../../../../geometry/support/Indices","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/Geometry"],function(t,e,r,n,o,a,i,l,u,s,c,p){"use strict";const f=r.create(),b=r.create();function g(t){const e=u.newHalfFloatArray(3*t.length),r=t[0],n=t[t.length-1];for(let o=0;o<t.length;o++)e[3*o]=t[o],e[3*o+1]=r,e[3*o+2]=n;return e}t.createGeometry=function(t,r,u=null){const g=[],m=r.mapPositions;!function(t,e){const{attributeData:{position:r},removeDuplicateStartEnd:n}=t,o=function(t){const e=t.length;return t[0]===t[e-3]&&t[1]===t[e-2]&&t[2]===t[e-1]}(r)&&n,a=r.length/3-(o?1:0),i=new Array(2*(a-1)),l=o?r.slice(0,-3):r;let u=0;for(let t=0;t<a-1;t++)i[u++]=t,i[u++]=t+1;e.push(["position",new c.Attribute(l,i,3,o)])}(r,g);const h=g[0][1].data,y=g[0][1].indices.length,A=s.getZeroIndexArray(y);return function(t,e,r){if(null!=t.attributeData.colorFeature)return;const o=t.attributeData.color;e.push(["color",new c.Attribute(o??n.ONES,r,4)])}(r,g,A),function(t,e,r){null==t.attributeData.sizeFeature&&e.push(["size",new c.Attribute([t.attributeData.size??1],r,1,!0)])}(r,g,A),function(t,e,r){t.attributeData.normal&&e.push(["normal",new c.Attribute(t.attributeData.normal,r,3)])}(r,g,A),function(t,e,r){null!=t.attributeData.colorFeature&&e.push(["colorFeatureAttribute",new c.Attribute([t.attributeData.colorFeature],r,1,!0)])}(r,g,A),function(t,e,r){null!=t.attributeData.sizeFeature&&e.push(["sizeFeatureAttribute",new c.Attribute([t.attributeData.sizeFeature],r,1,!0)])}(r,g,A),function(t,e){const{attributeData:{position:r,timeStamps:n}}=t;if(!n)return;const o=r.length/3,a=new Array(2*(o-1));let i=0;for(let t=0;t<o-1;t++)a[i++]=t,a[i++]=t+1;e.push(["timeStamps",new c.Attribute(n,a,3)])}(r,g),function(t,e,r){null!=t.attributeData.opacityFeature&&e.push(["opacityFeatureAttribute",new c.Attribute([t.attributeData.opacityFeature],r,1,!0)])}(r,g,A),function(t,r,n){if(null==t.overlayInfo||1!==t.overlayInfo.renderCoordsHelper.viewingMode||!t.overlayInfo.spatialReference.isGeographic)return;const u=i.newDoubleArray(n.length),s=o.getReferenceEllipsoid(t.overlayInfo.spatialReference);for(let t=0;t<u.length;t+=3)a.lonLatToWebMercatorComparable(n,t,u,t,s);const p=n.length/3,g=l.newFloatArray(p+1);let m=f,h=b,y=0,A=0;e.set(m,u[A++],u[A++]),A++,g[0]=0;for(let t=1;t<p+1;++t)t===p&&(A=0),e.set(h,u[A++],u[A++]),A++,y+=e.dist(m,h),g[t]=y,[m,h]=[h,m];r.push(["distanceToStart",new c.Attribute(g,r[0][1].indices,1,!0)])}(r,g,h),new p.Geometry(t,g,m,2,u)},t.getLinearTimeStamps=function(t,e=0,r=.01){const n=u.newHalfFloatArray(t.length);n[0]=0;for(let e=1;e<t.length;e++){const r=t[e-1],o=t[e],a=Math.sqrt((o[0]-r[0])**2+(o[1]-r[1])**2+(o[2]-r[2])**2);n[e]=n[e-1]+a}const o=n.map(t=>t*r);if(0!==e&&e<o.length){const t=o[e];for(let e=0;e<o.length;e++)o[e]-=t}return o},t.lineStripsToParameters=function(t,e,r){if(null==t||0===t.length)return[];const n=[];return t.forEach((t,o)=>{const a=t.length,l=i.newDoubleArray(3*a);t.forEach((t,e)=>{l[3*e]=t[0],l[3*e+1]=t[1],l[3*e+2]=t[2]});const u=null!=r?g(r[o]):void 0,s={attributeData:{position:l,normal:e,timeStamps:u},removeDuplicateStartEnd:!1};n.push(s)}),n},t.timeStampsToAttribute=g,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});