// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../geometry/support/aaBoundingRect","../../../2d/engine/flow/dataUtils","../../layers/support/FeatureTileDescriptor"],function(t,n,e,l){"use strict";function i(t,n){return null==n?t:Math.max(t,n)}function o(t,n){return null==n?t:Math.min(t,n)}t.FlowDataTile=class{constructor(t,n,e,l,i,o){this.data=t,this.mask=n,this.width=e,this.height=l,this.lij=i,this.extent=o}},t.boundingRectOfTiles=function(t){let[e,l,r,u]=[null,null,null,null];for(const n of t){const t=n.extent;e=o(t[0],e),l=o(t[1],l),r=i(t[2],r),u=i(t[3],u)}return null==e||null==l||null==r||null==u?null:n.create([e,l,r,u])},t.createFlowFieldFromDataTiled=function(t,l,i,o,r){const[u,a]=i;let s=null;const c=new Map;l.forEach(n=>{c.set(n.lij,e.createFlowFieldFromData(t,n))});const f=(t,e,l)=>n.containsXY(t.extent,e,l);return(t,e)=>{const i=Math.round(t),h=Math.round(e);if(i<0||i>=u||h<0||h>=a)return[0,0];const d=t/u*n.width(o)+o[0],g=(a-e)/a*n.height(o)+o[1];if(null==s||!f(s,d,g)){s=null;for(const[t,n]of l)if(f(n,d,g)){s=n;break}}if(null==s?.data)return[0,0];const F=c.get(s.lij);if(null==F)return[0,0];const p=s.extent;return F((d-p[0])/n.width(p)*r,r-(g-p[1])/n.height(p)*r)}},t.tileToKey=function(t){return l.getFeatureTileId(t.lij[0],t.lij[1],t.lij[2])},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});