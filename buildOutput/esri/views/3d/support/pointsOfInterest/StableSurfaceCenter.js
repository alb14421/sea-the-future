// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/has","../../../../core/Error","../../../../core/Logger","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/Point","../../../../geometry/support/aaBoundingRect"],function(e,t,r,o,a,s,c,n,i,l,u,p,d){"use strict";e.StableSurfaceCenter=class extends r{get surface(){return this.view.map?.ground}get surfaceView(){return this.view.basemapTerrain}get renderLocation(){if(!this.location)return null;const e=u.create();return this.view.renderCoordsHelper.toRenderCoords(this.location,e),e}constructor(e){super(e),this.location=null,this._updateController=null}initialize(){this.view.state.isLocal&&(this.addHandles([c.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),c.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())}_update(){if(this._updateController&&(this._updateController.abort(),this._updateController=null),null==this.surfaceView?.extent||null==this.surfaceView.spatialReference)return void this._set("location",null);const e=d.center(this.surfaceView.extent),t=new p({x:e[0],y:e[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&this.surface.layers.length>0?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(t,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(e=>{this._updateController=null,this._set("location",e.geometry)}).catch(e=>{})):this._set("location",t)}},t.__decorate([n.property({constructOnly:!0})],e.StableSurfaceCenter.prototype,"view",void 0),t.__decorate([n.property({constructOnly:!0})],e.StableSurfaceCenter.prototype,"cache",void 0),t.__decorate([n.property()],e.StableSurfaceCenter.prototype,"surface",null),t.__decorate([n.property()],e.StableSurfaceCenter.prototype,"surfaceView",null),t.__decorate([n.property({readOnly:!0})],e.StableSurfaceCenter.prototype,"location",void 0),t.__decorate([n.property({readOnly:!0})],e.StableSurfaceCenter.prototype,"renderLocation",null),e.StableSurfaceCenter=t.__decorate([l.subclass("esri.views.3d.support.pointsOfInterest.StableSurfaceCenter")],e.StableSurfaceCenter),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});