// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/tslib.es6","../../../core/maybe","../../../core/reactiveUtils","../../../core/Logger","../../../core/has","../../../core/RandomLCG","../../../core/Error","../../../core/accessorSupport/decorators/subclass","../../../core/libs/gl-matrix-2/math/mat4","../../../core/libs/gl-matrix-2/factories/mat4f64","../webgl","../../../chunks/SimpleAtmosphere.glsl","./SimpleAtmosphereTechnique","./SimpleAtmosphereTechniqueConfiguration","./resources/SimpleAtmosphereTexture","../support/buffer/glUtil","../webgl-engine/effects/OpaqueEnvironment","../webgl-engine/lib/GeometryUtil","../webgl-engine/lib/VertexArrayObject","../../webgl/enums","../../webgl/Texture","../../webgl/TextureDescriptor","../../webgl/VertexBuffer"],function(e,t,r,s,i,o,a,n,c,h,l,u,m,p,b,g,d,f,_,v,x,w,A,y){"use strict";e.LocalAtmosphere=class extends f.OpaqueEnvironment{constructor(){super(...arguments),this._configuration=new b.SimpleAtmosphereTechniqueConfiguration,this._passParameters=new m.SimpleAtmospherePassParameters,this._vao=null,this._vaoCount=0}initialize(){this._configuration.geometry=1,this.addHandles([s.watch(()=>this.view.environment.atmosphereEnabled,e=>e?this._enable():this._disable(),s.initial)])}destroy(){this._passParameters.texture=r.disposeMaybe(this._passParameters.texture),this._vao=r.disposeMaybe(this._vao)}precompile(){this.techniques.precompile(p.SimpleAtmosphereTechnique,this._configuration)}render(e){const t=e.find(({name:e})=>e===u.InternalRenderCategory.OPAQUE_ENVIRONMENT),r=this.techniques.get(p.SimpleAtmosphereTechnique,this._configuration);if(!r.compiled)return this.requestRender(1),t;const s=this.renderingContext;if(this._vao||(this._vao=function(e){const t=_.createPolySphereData(1,2,!1),{data:r,indices:s}=t[0][1],i=p.layout.createBuffer(s.length),o=i.position;for(let e=0;e<s.length;++e){const t=3*s[e%3==0?e+2:e%3==2?e-2:e];o.set(e,0,r[t]),o.set(e,1,r[t+1]),o.set(e,2,r[t+2])}return new v.VertexArrayObject(e,new y.VertexBuffer(e,d.glLayout(p.layout),i.buffer))}(s),this._vaoCount=this._vao.vertexCount("geometry")),!this._passParameters.texture){const e=new A.TextureDescriptor(1,512);e.wrapMode=33071,e.flipped=!0,this._passParameters.texture=new w.Texture(s,e,g.earthAtmosphereTextureSimple)}const i=s.bindTechnique(r,this.bindParameters,this._passParameters);var o,a;return o=T,a=this.bindParameters.camera.viewMatrix,h.copy(o,a),o[12]=0,o[13]=0,o[14]=0,o[15]=1,i.setUniformMatrix4fv("view",T),s.bindVAO(this._vao),i.assertCompatibleVertexAttributeLocations(this._vao),s.drawArrays(x.PrimitiveType.TRIANGLES,0,this._vaoCount),t}},e.LocalAtmosphere=t.__decorate([c.subclass("esri.views.3d.environment.LocalAtmosphere")],e.LocalAtmosphere);const T=l.create();Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});