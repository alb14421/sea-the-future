// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/promiseUtils","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/SpatialReference","../../../../geometry/projection/projectPointToVector","../../../../layers/graphics/dehydratedPoint","../../../../support/elevationInfoUtils","./elevationAlignmentUtils","./ElevationContext","./featureExpressionInfoUtils"],function(e,t,o,n,r,i,a,s,c,l){"use strict";e.elevationAlignPointsInFeatures=async function(e,f,p,d,v){const{elevationProvider:u,renderCoordsHelper:I}=e,{elevationInfo:g}=f,{pointsInFeatures:y,spatialReference:m}=d,x=n.fromJSON(m),E=l.extractExpressionInfo(g,!0),P=await l.createContext(E,x,v);t.throwIfAborted(v);const h=[],S=new Set,b=new Set,j=new c.ElevationContext,w=i.makeDehydratedPoint(0,0,0,n.WGS84),A=new s.SampleElevationInfo,C=o.create();w.spatialReference=x;const R=e.elevationProvider.spatialReference??e.spatialReference;for(const{objectId:e,points:t}of y){const o=p(e);if(null==o){for(const e of t)h.push(e.z??0);S.add(e);continue}o.isDraped&&b.add(e);const n=o.graphic.geometry;j.setFromElevationInfo(a.getGeometryEffectiveElevationInfo(n,g)),j.updateFeatureExpressionInfoContext(P,o.graphic,f);for(const{x:e,y:o,z:n}of t)w.x=e,w.y=o,w.z=n??0,await r.projectPointToVectorAsync(w,C,R,0,{signal:v}),s.evaluateElevationInfoAtPoint(C,u,j,I,A),h.push(A.z)}return{elevations:h,drapedObjectIds:b,failedObjectIds:S}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});