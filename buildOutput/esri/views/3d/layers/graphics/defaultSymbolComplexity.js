// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/compilerUtils","../../../../core/has","../../../../symbols/support/ObjectSymbol3DLayerResource","./Graphics3DPathSymbolLayerConstants","./primitiveObjectSymbolUtils","./SymbolComplexity","../support/edgeUtils","../../webgl-engine/materials/DefaultMaterial"],function(e,r,t,a,s,u,o,y,i){"use strict";const l=new o.EstimatedSymbolComplexity({});function b(e){let r=0,t=0,a=0,s=!1,u=0;const y=new o.SymbolComplexityMemory;for(const o of e)null!=o&&(r+=o.verticesPerFeature,t+=o.verticesPerCoordinate,a+=o.drawCallsPerFeature,y.bytesPerFeature+=o.memory.bytesPerFeature,y.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,y.resourceBytes+=o.memory.resourceBytes,y.draped.bytesPerFeature+=o.memory.bytesPerFeature,y.draped.bytesPerFeatureLabel+=o.memory.bytesPerFeatureLabel,s=s||o.estimated,++u);return s?new o.EstimatedAggregateSymbolComplexity(u,{verticesPerFeature:r,verticesPerCoordinate:t,drawCallsPerFeature:a,memory:y}):new o.AggregateSymbolComplexity(u,{verticesPerFeature:r,verticesPerCoordinate:t,drawCallsPerFeature:a,memory:y})}const m={};function n(e,t){const u=c(e,t),i=y.hasEdges(t)?2:0;switch(t.type){case"extrude":return new o.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:12,drawCallsPerFeature:i,memory:u});case"fill":if("mesh-3d"===e.type)return new o.SymbolComplexity({drawCallsPerFeature:i,memory:u});if(null!=t.outline&&t.outline.size>0)return new o.SymbolComplexity({verticesPerFeature:-12,verticesPerCoordinate:9,memory:u});case"water":return new o.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:3,memory:u});case"line":return new o.SymbolComplexity({verticesPerFeature:-6,verticesPerCoordinate:6,memory:u});case"object":return t.resource?.href?new o.EstimatedSymbolComplexity({verticesPerFeature:100,memory:u}):{...P(t.resource?.primitive??a.defaultPrimitive),memory:u};case"path":{let e=0,a=0;switch(t.profile){case"circle":e=s.pathNumCircleProfileSubdivisions;break;case"quad":e=4;break;default:return void r.neverReached(t.profile)}switch(t.join){case"round":a=s.pathNumRoundJoinSubdivisions;break;case"miter":case"bevel":a=1;break;default:return}const y=2*e,i=e*a*2,l=i+y;let b=-2*i-y;switch(t.cap){case"none":break;case"butt":case"square":b+=2*(e-1);break;case"round":b+=2*(e*(s.pathNumRoundCapExtrusionSubdivisions-1)*2+e);break;default:return}return new o.SymbolComplexity({verticesPerFeature:b,verticesPerCoordinate:l,memory:u})}case"text":{const r="label-3d"===e.type?0:2;return new o.SymbolComplexity({verticesPerFeature:6,memory:u,drawCallsPerFeature:r})}case"icon":return new o.SymbolComplexity({verticesPerFeature:6,memory:u});default:return}}function c(e,t){const a="point-3d"===e.type;switch(t.type){case"extrude":return t.edges&&t.edges.size>0?F.EXTRUDE_EDGES:F.EXTRUDE;case"fill":return null!=t.outline&&t.outline.size>0?F.FILL_OUTLINE:F.FILL;case"water":return F.FILL;case"line":return"round"===t.join?F.LINE_ROUND:F.LINE_MITER;case"path":switch(t.join){case"round":switch(t.profile){case"circle":return F.PATH_ROUND_CIRCLE;case"quad":return F.PATH_ROUND_QUAD;default:return void r.neverReached(t.profile)}case"miter":case"bevel":switch(t.profile){case"circle":return F.PATH_MITER_CIRCLE;case"quad":return F.PATH_MITER_QUAD;default:return void r.neverReached(t.profile)}default:return}case"object":return a?F.OBJECT_POINT:F.OBJECT_POLYGON;case"icon":case"text":return a?F.ICON_POINT:F.ICON_POLYGON;default:return}}function P(e){const r=m[e];if(r)return r;const t=d(u.primitiveLodResources(e,new i.DefaultMaterial({},{spherical:!0})).levels);return m[e]=new o.SymbolComplexity({verticesPerFeature:t}),m[e]}function d(e){return e.reduce((e,r,t)=>e+r.numVertices*(1/10**t),0)/e.reduce((e,r,t)=>e+1/10**t,0)}const F={ICON_POINT:{bytesPerFeature:3063,bytesPerFeatureLabel:3813,resourceBytes:0,draped:{bytesPerFeature:2010,bytesPerFeatureLabel:3851}},ICON_POLYGON:{bytesPerFeature:3222,bytesPerFeatureLabel:2792,resourceBytes:0,draped:{bytesPerFeature:1408,bytesPerFeatureLabel:2523}},OBJECT_POINT:{bytesPerFeature:477,bytesPerFeatureLabel:3260,resourceBytes:0,draped:{bytesPerFeature:477,bytesPerFeatureLabel:3260}},OBJECT_POLYGON:{bytesPerFeature:586,bytesPerFeatureLabel:2250,resourceBytes:0,draped:{bytesPerFeature:586,bytesPerFeatureLabel:2250}},LINE_MITER:{bytesPerFeature:1660,bytesPerFeatureLabel:2326,resourceBytes:0,draped:{bytesPerFeature:1221,bytesPerFeatureLabel:1970}},LINE_ROUND:{bytesPerFeature:544,bytesPerFeatureLabel:2173,resourceBytes:0,draped:{bytesPerFeature:383,bytesPerFeatureLabel:1808}},PATH_MITER_CIRCLE:{bytesPerFeature:22559,bytesPerFeatureLabel:2885,resourceBytes:0,draped:{bytesPerFeature:22559,bytesPerFeatureLabel:2885}},PATH_ROUND_CIRCLE:{bytesPerFeature:25707,bytesPerFeatureLabel:2666,resourceBytes:0,draped:{bytesPerFeature:25707,bytesPerFeatureLabel:2666}},PATH_MITER_QUAD:{bytesPerFeature:24444,bytesPerFeatureLabel:3248,resourceBytes:0,draped:{bytesPerFeature:24444,bytesPerFeatureLabel:3248}},PATH_ROUND_QUAD:{bytesPerFeature:24060,bytesPerFeatureLabel:3228,resourceBytes:0,draped:{bytesPerFeature:24060,bytesPerFeatureLabel:3228}},FILL:{bytesPerFeature:3558,bytesPerFeatureLabel:2829,resourceBytes:0,draped:{bytesPerFeature:1418,bytesPerFeatureLabel:2381}},FILL_OUTLINE:{bytesPerFeature:3793,bytesPerFeatureLabel:2371,resourceBytes:0,draped:{bytesPerFeature:1583,bytesPerFeatureLabel:2050}},EXTRUDE:{bytesPerFeature:4051,bytesPerFeatureLabel:2286,resourceBytes:0,draped:{bytesPerFeature:4051,bytesPerFeatureLabel:2286}},EXTRUDE_EDGES:{bytesPerFeature:3037,bytesPerFeatureLabel:1960,resourceBytes:0,draped:{bytesPerFeature:3037,bytesPerFeatureLabel:1960}}};if(t("esri-tests-disable-symbol-memory-estimators"))for(const e in F){const r=F[e];r.bytesPerFeature=0,r.bytesPerFeatureLabel=0,r.draped.bytesPerFeature=0,r.draped.bytesPerFeatureLabel=0}e.averageSymbolComplexities=function(e){const r=b(e);return r.numComplexities>0&&(r.verticesPerFeature/=r.numComplexities,r.verticesPerCoordinate/=r.numComplexities,r.drawCallsPerFeature/=r.numComplexities,r.memory.bytesPerFeature/=r.numComplexities,r.memory.bytesPerFeatureLabel/=r.numComplexities,r.memory.resourceBytes/=r.numComplexities,r.memory.draped.bytesPerFeature/=r.numComplexities,r.memory.draped.bytesPerFeatureLabel/=r.numComplexities),r},e.defaultSymbolComplexity=function(e){return"web-style"===e.type?l:b(e.symbolLayers.toArray().map(r=>n(e,r)))},e.defaultSymbolLayerComplexity=n,e.defaultSymbolLayerMemoryComplexity=c,e.emptySymbolComplexity=l,e.estimateNumVerticesForLods=d,e.totalSymbolComplexities=b,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});