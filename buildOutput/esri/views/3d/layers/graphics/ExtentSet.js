// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/has","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(t,e,r,n,s){"use strict";t.ExtentSet=class{constructor(){this._extents=new r({allocator:t=>t||n.create()}),this._tmpExtent=n.create(),this._dirty=!1}destroy(){this._extents.prune()}get empty(){return 0===this._extents.length}get size(){return this._extents.length}clear(){this._extents.clear()}add(t){this._contains(t)||(this._removeContained(t),n.copy(this._extents.pushNew(),t),this._dirty=!0)}pop(){return this._dirty&&this._mergeTight(),this._extents.pop()}merge(t){return this._mergeTight(t),t.hasProgressed}_mergeTight(t=s.noBudget){const e=this._extents,r=new Set;let o=0;for(;o!==e.length;){e.sort((t,e)=>t[0]-e[0]),o=e.length,r.clear();for(let s=0;s<e.length;++s){if(t.done)return;const o=e.at(s);if(o){for(let t=s+1;t<e.length;++t){const n=e.at(t);if(null==n||n[0]>=o[2])break;r.add(n)}r.forEach(s=>{if(o===s)return;if(s[2]<=o[0])return void r.delete(s);const i=n.area(o),a=n.area(s),h=this._tmpExtent;n.expand(o,s,h);const c=i+a;(n.area(h)-c)/c<.05&&(n.copy(o,h),r.delete(s),e.remove(s),t.madeProgress())}),r.add(o)}}}this._dirty=!1}_contains(t){return this._extents.some(e=>n.contains(e,t))}_removeContained(t){this._extents.filterInPlace(e=>!n.contains(t,e))}get test(){}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});