// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../core/Evented","../../../../../../core/memoryEstimations","../../../../../../core/libs/rbush/PooledRBush","../../../../../../layers/graphics/centroid","../../../../../../layers/graphics/OptimizedGeometry"],function(e,t,i,r,s,n){"use strict";class o{constructor(e,t){this._index=e,this._view=t}get usedMemory(){return i.baseObjectMemory+i.estimateNumberMemory}getObjectId(){return this._view.getObjectId(this._index)}getAttribute(e){return this._view.getAttribute(this._index,e)}getAttributeAsTimestamp(e){return this._view.getAttributeAsTimestamp(this._index,e)}getAttributes(){return this._view.getAttributes(this._index)}getOptimizedGeometry(){return this._view.getOptimizedGeometry(this._index)}getCentroid(e){return this._view.getCentroid(this._index,e)}getBounds(){return this._view.getBounds(this._index)}getBoundingBox(){return this._view.getBoundingBox(this._index)}cloneWithGeometry(e){return new u(this._index,this._view,e)}}class u extends o{constructor(e,t,i){super(e,t),this._geometryOverride=i}getOptimizedGeometry(){return this._geometryOverride}getCentroid(e){return s.getCentroidOptimizedGeometry(new n,this._geometryOverride,e.hasZ,e.hasM)}}class d{constructor(e,t){this.featureData=e,this.bounds=t}}class a{static{this.shared=new a}getObjectId(e){return e.getObjectId()}getAttribute(e,t){return e.getAttribute(t)}getAttributeAsTimestamp(e,t){return e.getAttributeAsTimestamp(t)}getAttributes(e){return e.getAttributes()}getGeometry(e){return e.getOptimizedGeometry()}getCentroid(e,t){return e.getCentroid(t)}cloneWithGeometry(e,t){return e.cloneWithGeometry(t)}}const h=new r.BBox;e.FeatureHandle=o,e.TiledFeatureStore=class{constructor(){this._tileBounds=new Map,this.events=new t.EventEmitter,this.featureAdapter=a.shared}get usedMemory(){return i.baseObjectMemory+i.baseObjectMemory*this._tileBounds.size}addTile(e){const{featureCount:t}=e;if(0===t)return;const i=new r.PooledRBush(9,t=>e.getBounds(t)),s=new Array;for(let e=0;e<t;++e)s[e]=e;i.load(s),this._tileBounds.set(e.id,new d(e,i)),this.events.emit("changed")}removeTile(e){this._tileBounds.delete(e),this.events.emit("changed")}clear(){this._tileBounds.clear(),this.events.emit("changed")}forEach(e){for(const{featureData:t,bounds:i}of this._tileBounds.values())i.all(i=>{t.getEnabled(i)&&e(new o(i,t))})}forEachInBounds(e,t){h.minX=e[0],h.minY=e[1],h.maxX=e[2],h.maxY=e[3];for(const{featureData:e,bounds:i}of this._tileBounds.values())i.search(h,i=>{e.getEnabled(i)&&t(new o(i,e))})}forEachBounds(e,t){for(const i of e)t(i.getBoundingBox())}getFullExtent(e){let t=1/0,i=1/0,r=-1/0,s=-1/0;for(const{bounds:e}of this._tileBounds.values()){const{minX:n,minY:o,maxX:u,maxY:d}=e.toJSON();t=Math.min(t,n),i=Math.min(i,o),r=Math.min(r,u),s=Math.min(s,d)}return{xmin:t,ymin:i,xmax:r,ymax:s,spatialReference:e}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});