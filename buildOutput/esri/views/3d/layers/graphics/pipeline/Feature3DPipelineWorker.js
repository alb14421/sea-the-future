// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/Evented":function(){define(["exports","./Accessor","./handleUtils"],function(e,t,r){"use strict";const i=e=>{const t=e;return class extends t{constructor(){super(...arguments),this._listenersMap=null}clearEvents(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clearEvents()}emit(e,t){let r=this._listenersMap?.get(e);if(!r)return!1;let i=!1;for(const e of r.slice()){const r="deref"in e?e.deref():e;r?r?.call(this,t):i=!0}return i&&(r=r.filter(e=>!("deref"in e)||null!=e.deref()),this._listenersMap.set(e,r)),r.length>0}on(e,t){if(Array.isArray(e)){const i=e.map(e=>this.on(e,t));return r.handlesGroup(i)}if(e.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const i=this._listenersMap.get(e)||[];return i.push(t),this._listenersMap.set(e,i),r.makeHandle(()=>{const r=this._listenersMap?.get(e),i=r?.indexOf(t)??-1;i>=0&&r.splice(i,1)})}once(e,t){const r=this.on(e,e=>{r.remove();const i="deref"in t?t.deref():t;i?.call(null,e)});return r}hasEventListener(e){const t=this._listenersMap?.get(e);return null!=t&&t.length>0}}},o=i(class{}),s=o,n=i(t);e.EventEmitter=s,e.Evented=o,e.EventedAccessor=n,e.EventedMixin=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define(["exports","../../../core/arrayUtils","../../../core/compilerUtils","../../../core/Error","../../../core/has","../../../core/lang","../../../core/maybe","../../../core/promiseUtils","../../../core/unitUtils","../../../core/support/jsonUtils","../../../geometry/projectionUtils","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../../../geometry/support/boundsUtils","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../featureConversionUtils","./attributeSupport","./geometryUtils","./projectionSupport","./QueryEngineCache","./QueryEngineCapabilities","./QueryEngineResult","./queryUtils","./queryValidationUtils","./spatialQuerySupport","./timeSupport","../../support/FieldsIndex","../../../views/support/Scheduler"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M,T,P,I,C){"use strict";function O(e){if(T.canQueryWithRBush(e)){if(f.isExtent(e))return[p.fromValues(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if(f.isPolygon(e))return e.rings.map(e=>p.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1])))}return[h.getBoundsXY(p.create(),e)]}function F(e,t,r,i,o){const s={xmin:e[0],ymin:e[1],xmax:e[3],ymax:e[4],spatialReference:b.cleanFromGeometryEngine(i)};o&&isFinite(e[2])&&isFinite(e[5])&&(s.zmin=e[2],s.zmax=e[5],s.hasZ=!0);const n=_.project(s,t,r);if(n.spatialReference=b.cleanFromGeometryEngine(r),n.xmax-n.xmin===0){const e=l.getMetersPerUnitForSR(n.spatialReference);n.xmin-=e,n.xmax+=e}if(n.ymax-n.ymin===0){const e=l.getMetersPerUnitForSR(n.spatialReference);n.ymin-=e,n.ymax+=e}if(o&&null!=n.zmin&&null!=n.zmax&&n.zmax-n.zmin===0){const e=l.getMetersPerUnitForSR(n.spatialReference);n.zmin-=e,n.zmax+=e}return n}e.Feature=class{constructor(e,t=null,r,i,o){this.attributes=e,this.geometry=r,this.centroid=i,this.filterFlags=o,this.groupId=-1,this.displayId=t}},e.QueryEngine=class{constructor(e){this._changeHandle=null,this.capabilities={query:S.queryCapabilities},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._cache=e.cache??new v.QueryEngineCache,this.timeInfo=e.timeInfo,this.featureIdInfo=e.featureIdInfo,"object-id"===e.featureIdInfo.type&&(this.objectIdField=e.featureIdInfo.fieldName),this._changeHandle=this.featureStore.events.on("changed",()=>this._clearCache()),this.fieldsIndex=c.isSerializable(e.fieldsIndex)?e.fieldsIndex:I.fromJSON(e.fieldsIndex),!e.availableFields||1===e.availableFields.length&&"*"===e.availableFields[0]?this.availableFields=new Set(this.fieldsIndex.fields.map(e=>e.name)):this.availableFields=new Set(e.availableFields.map(e=>this.fieldsIndex.get(e)?.name).filter(e=>null!=e)),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._changeHandle=n.removeMaybe(this._changeHandle),this._frameTask=n.removeMaybe(this._frameTask),this._clearCache(),n.destroyMaybe(this._cache)}get featureAdapter(){return this.featureStore.featureAdapter}_clearCache(){this._cache.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}async executeQuery(e,t){const r=a.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{},r);return await t.createQueryResponse()}catch(t){if(t!==w.queryEngineEmptyResult)throw t;return new x.QueryEngineResult([],e,this).createQueryResponse()}}async executeQueryForCount(e={},t){const r=a.signalFromSignalOrOptions(t);try{return(await this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},r)).createQueryResponseForCount()}catch(e){if(e!==w.queryEngineEmptyResult)throw e;return 0}}async executeQueryForExtent(e,t){const r=a.signalFromSignalOrOptions(t),i=e.outSR;try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),o=t.size;return o?{count:o,extent:await this._getBounds(t.items,t.spatialReference,i||this.spatialReference)}:{count:0,extent:null}}catch(e){if(e===w.queryEngineEmptyResult)return{count:0,extent:null};throw e}}async executeQueryForIds(e,t){return this.executeQueryForIdSet(e,t).then(e=>Array.from(e))}async executeQueryForIdSet(e,t){const r=a.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),i=t.items,o=new Set;return await this.reschedule(()=>{for(const e of i)o.add(t.featureAdapter.getObjectId(e))},r),o}catch(e){if(e===w.queryEngineEmptyResult)return new Set;throw e}}async executeQueryForLatestObservations(e,t){const r=a.signalFromSignalOrOptions(t);if(!this.timeInfo?.trackIdField)throw new i("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const t=await this._executeQuery(e,{},r);return await this.reschedule(()=>this._filterLatest(t),r),await t.createQueryResponse()}catch(t){if(t!==w.queryEngineEmptyResult)throw t;return new x.QueryEngineResult([],e,this).createQueryResponse()}}async executeQueryForOpaqueFeatures(e,t){const r=a.signalFromSignalOrOptions(t);return(await this._executeQuery(e,{},r)).items}async executeAttributeBinsQuery(e,t){const r=a.signalFromSignalOrOptions(t);let i;e=s.clone(e);try{e=await this.schedule(()=>w.normalizeAttributeBinsQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>M.validateAttributeBinsQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r);const t=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r);i=await this.reschedule(()=>this._executeGeometryQuery(e,t,r),r),await this.reschedule(()=>this._executeAggregateIdsQuery(i),r),await this.reschedule(()=>this.executeObjectIdsQuery(i),r),await this.reschedule(()=>this.executeTimeQuery(i),r),await this.reschedule(()=>this.executeAttributesQuery(i),r)}catch(t){if(t!==w.queryEngineEmptyResult)throw t;i=new x.QueryEngineResult([],e,this)}return i.createQueryBinsResponse(e)}async executeQueryForSummaryStatistics(e={},t,r){const i=a.signalFromSignalOrOptions(r),{field:o,normalizationField:s,valueExpression:n}=t;return(await this._executeQueryForStatistics(e,{field:o,normalizationField:s,valueExpression:n},i)).createSummaryStatisticsResponse(t)}async executeQueryForUniqueValues(e={},t,r){const i=a.signalFromSignalOrOptions(r),{field:o,field2:s,field3:n,valueExpression:l}=t;return(await this._executeQueryForStatistics(e,{field:o,field2:s,field3:n,valueExpression:l},i)).createUniqueValuesResponse(t)}async executeQueryForClassBreaks(e={},t,r){const i=a.signalFromSignalOrOptions(r),{field:o,normalizationField:s,valueExpression:n}=t;return(await this._executeQueryForStatistics(e,{field:o,normalizationField:s,valueExpression:n},i)).createClassBreaksResponse(t)}async executeQueryForHistogram(e={},t,r){const i=a.signalFromSignalOrOptions(r),{field:o,normalizationField:s,valueExpression:n}=t;return(await this._executeQueryForStatistics(e,{field:o,normalizationField:s,valueExpression:n},i)).createHistogramResponse(t)}async fetchRecomputedExtents(e){const t=a.signalFromSignalOrOptions(e);this._timeExtentPromise||=P.getTimeExtent(this.timeInfo,this.featureStore);const[r,i]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);return a.throwIfAborted(t),{fullExtent:r,timeExtent:i}}async _getBounds(e,t,r){const i=d.set(d.create(),d.negativeInfinity);return await this.featureStore.forEachBounds(e,e=>d.expandWithAABB(i,e)),F(i,t,r,this.spatialReference,this.hasZ)}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(e=>this._getBounds(e,this.spatialReference,this.spatialReference)),this._fullExtentPromise}async schedule(e,t){return this._frameTask?.schedule(e,t)??e(C.noBudget)}async reschedule(e,t){return this._frameTask?.reschedule(e,t)??e(C.noBudget)}async _getAllFeaturesQueryEngineResult(e){return new x.QueryEngineResult(await this._getAllFeatures(),e,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const e=[];this._allFeaturesPromise=(async()=>await this.featureStore.forEach(t=>e.push(t)))().then(()=>r.toConst(e))}const e=this._allFeaturesPromise,t=await e;return e===this._allFeaturesPromise?t.slice():this._getAllFeatures()}async _executeQuery(e,t,r){e=s.clone(e),e=await this.schedule(()=>w.normalizeQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>M.validateQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r),e={...e,...t};const i=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r),o=await this.reschedule(()=>this._executeGeometryQuery(e,i,r),r);return await this.reschedule(()=>this._executeAggregateIdsQuery(o),r),await this.reschedule(()=>this.executeObjectIdsQuery(o),r),await this.reschedule(()=>this.executeTimeQuery(o),r),await this.reschedule(()=>this.executeAttributesQuery(o),r),o}async _executeSceneFilterQuery(e,t){if(null==e.sceneFilter)return null;const{outSR:r,returnGeometry:i,returnCentroid:o}=e,s=this.featureStore.featureSpatialReference,n=e.sceneFilter.geometry,a=null==s||m.equals(s,n.spatialReference)?n:_.project(n,s);if(!a)return null;const l=i||o,c=m.isValid(r)&&!m.equals(this.spatialReference,r)&&l?async e=>this._project(e,r):e=>e,u=this.featureAdapter,d=await this.reschedule(()=>this.searchFeatures(O(a)),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!d.length)return null;const r=new Set;for(const e of d)r.add(u.getObjectId(e));const i=await this.reschedule(()=>this._getAllFeatures(),t);return c(await this.reschedule(async()=>{const o=await T.getSpatialQueryOperator("esriSpatialRelDisjoint",a,this.geometryType,this.hasZ,this.hasM),s=await this.runSpatialFilter(i,e=>!r.has(u.getObjectId(e))||o(u.getGeometry(e)),t);return new x.QueryEngineResult(s,e,this)},t))}if(!d.length)return new x.QueryEngineResult([],e,this);if(this._canExecuteSinglePass(a,e))return c(new x.QueryEngineResult(d,e,this));const p=await T.getSpatialQueryOperator("esriSpatialRelContains",a,this.geometryType,this.hasZ,this.hasM),h=await this.runSpatialFilter(d,e=>p(u.getGeometry(e)),t);return c(new x.QueryEngineResult(h,e,this))}async _executeGeometryQuery(e,r,i){if(null!=r&&0===r.items.length)return r;const{geometry:o,outSR:s,returnGeometry:n,returnCentroid:a}=e,l=r?null:this._getCacheKey(e),c=l?this._cache.get(l):null;if(c)return new x.QueryEngineResult(c,e,this);const u=m.isValid(s)&&!m.equals(this.spatialReference,s),d=n||a,p=async e=>(u&&d&&await this._project(e,s),l&&this._cache.put(l,e.items),e),h=this.featureStore.featureSpatialReference,f=!o||null==h||m.equals(h,o.spatialReference)?o:_.project(o,h);if(!f)return p(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const y=this.featureAdapter;let g=await this.reschedule(()=>this.searchFeatures(O(o)),i);const b=e.spatialRel??"esriSpatialRelIntersects";if("esriSpatialRelDisjoint"===b){if(!g.length)return p(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const t=new Set;for(const e of g)t.add(y.getObjectId(e));const o=null!=r?r.items:await this.reschedule(()=>this._getAllFeatures(),i);return p(await this.reschedule(async()=>{const r=await T.getSpatialQueryOperator(b,f,this.geometryType,this.hasZ,this.hasM),s=await this.runSpatialFilter(o,e=>!t.has(y.getObjectId(e))||r(y.getGeometry(e)),i);return new x.QueryEngineResult(s,e,this)},i))}if(null!=r){const e=new t.PositionHint;g=g.filter(i=>t.indexOf(r.items,i,r.items.length,e)>=0)}if(!g.length){const t=new x.QueryEngineResult([],e,this);return l&&this._cache.put(l,t.items),t}if(this._canExecuteSinglePass(f,e))return p(new x.QueryEngineResult(g,e,this));const v=await T.getSpatialQueryOperator(b,f,this.geometryType,this.hasZ,this.hasM),S=await this.runSpatialFilter(g,e=>v(y.getGeometry(e)),i);return p(new x.QueryEngineResult(S,e,this))}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const r of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach(e=>t.add(e));const r=this.featureAdapter.getObjectId;e.items=e.items.filter(e=>t.has(r(e)))}executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter(e=>t.has(r(e)))}executeTimeQuery(e){if(0===e.items.length)return;const t=P.getTimeOperator(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}executeAttributesQuery(e){if(0===e.items.length)return;const t=g.getWhereClause(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter(e=>t.testFeature(e,this.featureAdapter))}}async runSpatialFilter(e,t,r){if(!t)return e;if(null==this._frameTask)return e.filter(e=>t(e));let i=0;const o=new Array,s=async n=>{for(;i<e.length;){const a=e[i++];t(a)&&(o.push(a),n.madeProgress()),n.done&&await this.reschedule(e=>s(e),r)}};return this.reschedule(e=>s(e),r).then(()=>o)}_filterLatest(e){const{trackIdField:t,startTimeField:r,endTimeField:i}=this.timeInfo,o=i||r,s=new Map,n=this.featureAdapter.getAttribute;for(const r of e.items){const e=n(r,t),i=n(r,o),a=s.get(e);(!a||i>n(a,o))&&s.set(e,r)}e.items=Array.from(s.values())}_getCacheKey(e){const{geometry:t,spatialRel:r,returnGeometry:i,returnCentroid:o,outSR:s,resultType:n,cacheHint:a}=e;if("tile"!==n&&!a)return null;const l=i||o;return m.isValid(s)&&!m.equals(this.spatialReference,s)&&l?JSON.stringify([t,r,s]):JSON.stringify([t,r])}_canExecuteSinglePass(e,t){const{spatialRel:r}=t;return T.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}async _project(e,t){if(!t||m.equals(this.spatialReference,t))return e;const i=this.featureAdapter;let o;try{const e=await this._getFullExtent();o=u.getTransformation(this.spatialReference,t,e)}catch{}const s=await _.projectMany(e.items.map(e=>b.getGeometry(this.geometryType,this.hasZ,this.hasM,i.getGeometry(e))),this.spatialReference,t,o);return e.items=r.toConst(s.map((t,r)=>i.cloneWithGeometry(e.items[r],y.convertFromGeometry(t,this.hasZ,this.hasM)))),e}async searchFeatures(e){const t=new Set;await Promise.all(e.map(e=>this.featureStore.forEachInBounds(e,e=>t.add(e))));const r=Array.from(t.values());return t.clear(),r}async _executeQueryForStatistics(e,t,r){e=s.clone(e);try{e=await this.schedule(()=>w.normalizeQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>M.validateStatisticsQuery(e,t,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r);const i=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r),o=await this.reschedule(()=>this._executeGeometryQuery(e,i,r),r);return await this.reschedule(()=>this._executeAggregateIdsQuery(o),r),await this.reschedule(()=>this.executeObjectIdsQuery(o),r),await this.reschedule(()=>this.executeTimeQuery(o),r),await this.reschedule(()=>this.executeAttributesQuery(o),r),o}catch(t){if(t!==w.queryEngineEmptyResult)throw t;return new x.QueryEngineResult([],e,this)}}get test(){}},e.getQueryBBoxes=O,e.getQueryResultExtent=F,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../Extent","./aaBoundingRect","./DoubleArray"],function(e,t,r,i){"use strict";function o(e=m){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function s(e,t,r,i,s,n,a=o()){return a[0]=e,a[1]=t,a[2]=r,a[3]=i,a[4]=s,a[5]=n,a}function n(e,t,r,i=o()){return p(i,f),a(i,e,t,r),i}function a(e,t,r=0,i=t.length/3){let o=e[0],s=e[1],n=e[2],a=e[3],l=e[4],c=e[5];for(let e=0;e<i;e++)o=Math.min(o,t[r+3*e]),s=Math.min(s,t[r+3*e+1]),n=Math.min(n,t[r+3*e+2]),a=Math.max(a,t[r+3*e]),l=Math.max(l,t[r+3*e+1]),c=Math.max(c,t[r+3*e+2]);e[0]=o,e[1]=s,e[2]=n,e[3]=a,e[4]=l,e[5]=c}function l(e){return e[0]>=e[3]?0:e[3]-e[0]}function c(e){return e[1]>=e[4]?0:e[4]-e[1]}function u(e){return e[2]>=e[5]?0:e[5]-e[2]}function d(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function p(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function h(e){return 6===e.length}const f=[1/0,1/0,1/0,-1/0,-1/0,-1/0],m=[0,0,0,0,0,0],y=o();e.allFinite=function(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0},e.center=function(e,t=[0,0,0]){return t[0]=e[0]+l(e)/2,t[1]=e[1]+c(e)/2,t[2]=e[2]+u(e)/2,t},e.contains=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]},e.containsPoint=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]},e.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[2]>=e[2]-r&&t[0]<=e[3]+r&&t[1]<=e[4]+r&&t[2]<=e[5]+r},e.create=o,e.depth=c,e.diameter=function(e){const t=l(e),r=u(e),i=c(e);return Math.sqrt(t*t+r*r+i*i)},e.empty=function(e){return e?p(e,f):o(f)},e.equals=function(e,t,r){if(null==e||null==t)return e===t;if(!h(e)||!h(t))return!1;if(r){for(let i=0;i<e.length;i++)if(!r(e[i],t[i]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},e.expandWithAABB=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])},e.expandWithBuffer=a,e.expandWithNestedArray=function(e,t,r){const i=t.length;let o=e[0],s=e[1],n=e[2],a=e[3],l=e[4],c=e[5];if(r)for(let e=0;e<i;e++){const r=t[e];o=Math.min(o,r[0]),s=Math.min(s,r[1]),n=Math.min(n,r[2]),a=Math.max(a,r[0]),l=Math.max(l,r[1]),c=Math.max(c,r[2])}else for(let e=0;e<i;e++){const r=t[e];o=Math.min(o,r[0]),s=Math.min(s,r[1]),a=Math.max(a,r[0]),l=Math.max(l,r[1])}e[0]=o,e[1]=s,e[2]=n,e[3]=a,e[4]=l,e[5]=c},e.expandWithOffset=function(e,t,r,i){e[0]=Math.min(e[0],e[0]+t),e[3]=Math.max(e[3],e[3]+t),e[1]=Math.min(e[1],e[1]+r),e[4]=Math.max(e[4],e[4]+r),e[2]=Math.min(e[2],e[2]+i),e[5]=Math.max(e[5],e[5]+i)},e.expandWithRect=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])},e.expandWithVec3=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])},e.fromBuffer=function(e,t=o()){return n(e,0,e.length/3,t)},e.fromExtent=function(e,t=o()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.hasZ?e.zmin:-1/0,t[3]=e.xmax,t[4]=e.ymax,t[5]=e.hasZ?e.zmax:1/0,t},e.fromMinMax=function(e,t,r=o()){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},e.fromRect=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e},e.fromRectValues=function(e,t,r,i,o){return e[0]=t,e[1]=r,e[2]=Number.NEGATIVE_INFINITY,e[3]=i,e[4]=o,e[5]=Number.POSITIVE_INFINITY,e},e.fromSubBuffer=n,e.fromValues=s,e.getMax=function(e,t){return t[0]=e[3],t[1]=e[4],t[2]=e[5],t},e.getMin=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.height=u,e.intersects=d,e.intersectsClippingArea=function(e,t){return null==t||d(e,t)},e.intersectsSegment=function(e,t,r){let i=0,o=1;for(let s=0;s<3;++s){const n=e[s],a=e[s+3],l=t[s],c=r[s],u=c<l,d=u?c:l,p=u?l:c,h=Math.max(n,d),f=Math.min(a,p);if(h>f)return!1;if(p===d)break;const m=p-d,y=(h-d)/m,g=(f-d)/m;if(i=Math.max(i,u?1-g:y),o=Math.min(o,u?1-y:g),i>o)return!1}return!0},e.is=h,e.isPoint=function(e){return 0===l(e)&&0===c(e)&&0===u(e)},e.maximumDimension=function(e){return Math.max(l(e),u(e),c(e))},e.negativeInfinity=f,e.offset=function(e,t,r,i,o=e){return o[0]=e[0]+t,o[1]=e[1]+r,o[2]=e[2]+i,o[3]=e[3]+t,o[4]=e[4]+r,o[5]=e[5]+i,o},e.positiveInfinity=[-1/0,-1/0,-1/0,1/0,1/0,1/0],e.scale=function(e,t,r=e){const i=e[0]+l(e)/2,o=e[1]+c(e)/2,s=e[2]+u(e)/2;return r[0]=i+(e[0]-i)*t,r[1]=o+(e[1]-o)*t,r[2]=s+(e[2]-s)*t,r[3]=i+(e[3]-i)*t,r[4]=o+(e[4]-o)*t,r[5]=s+(e[5]-s)*t,r},e.set=p,e.setMax=function(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e},e.setMin=function(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r},e.size=function(e,t=[0,0,0]){return t[0]=l(e),t[1]=c(e),t[2]=u(e),t},e.toCorners=function(e,t=i.newDoubleArray(24)){const[r,o,s,n,a,l]=e;return t[0]=r,t[1]=o,t[2]=s,t[3]=r,t[4]=o,t[5]=l,t[6]=r,t[7]=a,t[8]=s,t[9]=r,t[10]=a,t[11]=l,t[12]=n,t[13]=o,t[14]=s,t[15]=n,t[16]=o,t[17]=l,t[18]=n,t[19]=a,t[20]=s,t[21]=n,t[22]=a,t[23]=l,t},e.toExtent=function(e,r){const i=isFinite(e[2])||isFinite(e[5]);return new t(i?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:r}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:r})},e.toRect=function(e,t){return t||(t=r.create()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t},e.width=l,e.wrap=function(e,t,r,i,o,n){return s(e,t,r,i,o,n,y)},e.zero=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(e,t){"use strict";e.copyInto=function(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e},e.doubleArrayFrom=function(e){return(t.isTypedArray(e)?e.byteLength/8:e.length)<=t.nativeArrayMaxSize?Array.from(e):new Float64Array(e)},e.doubleSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},e.ensurePackedArray=function(e){return[...e]},e.newDoubleArray=function(e,r=!1){return e<=t.nativeArrayMaxSize?r?new Array(e).fill(0):new Array(e):new Float64Array(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/featureConversionUtils":function(){define(["exports","../../core/Error","../../core/Logger","../../core/maybe","../../geometry/support/aaBoundingBox","../../geometry/support/aaBoundingRect","../../geometry/support/jsonUtils","./OptimizedFeature","./OptimizedFeatureSet","./OptimizedGeometry","./data/createFeatureId"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";function d(e,t){return e?t?4:3:t?3:2}const p=()=>r.getLogger("esri.layers.graphics.featureConversionUtils"),h={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},f=(e,t,r,i,o,s)=>{e[r]=o,e[r+1]=s},m=(e,t,r,i,o,s)=>{e[r]=o,e[r+1]=s,e[r+2]=t[i+2]},y=(e,t,r,i,o,s)=>{e[r]=o,e[r+1]=s,e[r+2]=t[i+3]},g=(e,t,r,i,o,s)=>{e[r]=o,e[r+1]=s,e[r+2]=t[i+2],e[r+3]=t[i+3]};function b(e,t,r,i){if(e){if(r)return t&&i?g:m;if(t&&i)return y}else if(t&&i)return m;return f}function _({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function v({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function S({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function x({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function w({scale:e,translate:t},r,i){return r*e[i]+t[i]}function M(e){const t=e.coords;return{x:t[0],y:t[1]}}function T(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function P(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function I(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function C(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function O(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function F(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function A(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function R(e,t){return e&&t?A:e?I:t?O:T}function D(e,t,r,i,o){const s=R(r,i);for(const r of t){const t=null!=r.geometry?s(new c,r.geometry):null;e.push(new a.OptimizedFeature(t,r.attributes,null,u.createFeatureId(r,o)))}return e}function E(e,t,r=R(null!=t.z,null!=t.m)){return r(e,t)}function V(e,t,r,i){for(const{geometry:o,attributes:s}of t)e.push({attributes:s,geometry:null!=o?L(o,r,i):null});return e}function L(e,t,r){if(null==e)return null;const i=d(t,r),o=[];for(let t=0;t<e.coords.length;t+=i){const r=[];for(let o=0;o<i;o++)r.push(e.coords[t+o]);o.push(r)}return t?r?{points:o,hasZ:t,hasM:r}:{points:o,hasZ:t}:r?{points:o,hasM:r}:{points:o}}function z(e,t,r,i,o){const s=d(r,i);for(const r of t){const t=null!=r.geometry?U(new c,r.geometry,s):null;e.push(new a.OptimizedFeature(t,r.attributes,null,u.createFeatureId(r,o)))}return e}function U(e,t,r=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const i=e.coords;let o=0;for(const e of t.points)for(let t=0;t<r;t++)i[o++]=e[t];return e}function j(e,t,r){if(!e)return null;const i=d(t,r),{coords:o,lengths:s}=e,n=[];let a=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(o[a++]);t.push(e)}n.push(t)}return t?r?{paths:n,hasZ:t,hasM:r}:{paths:n,hasZ:t}:r?{paths:n,hasM:r}:{paths:n}}function B(e,t,r,i,o){const s=d(r,i);for(const r of t){const t=null!=r.geometry?N(new c,r.geometry,s):null,i=null!=r.centroid?E(new c,r.centroid):null;e.push(new a.OptimizedFeature(t,r.attributes,i,u.createFeatureId(r,o)))}return e}function N(e,t,r=d(t.hasZ,t.hasM)){const{lengths:i,coords:o}=e;let s=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)o[s++]=t[e];i.push(e.length)}return e}function k(e,t,r){if(!e)return null;const i=d(t,r),{coords:o,lengths:s}=e,n=[];let a=0;for(const e of s){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<i;t++)e.push(o[a++]);t.push(e)}n.push(t)}return t?r?{rings:n,hasZ:t,hasM:r}:{rings:n,hasZ:t}:r?{rings:n,hasM:r}:{rings:n}}function q(e,t,r=t.hasZ,i=t.hasM){return G(e,t.rings,r,i)}function G(e,t,r,i){const o=d(r,i),{lengths:s,coords:n}=e;let a=0;re(e);for(const e of t){for(const t of e)for(let e=0;e<o;e++)n[a++]=t[e];s.push(e.length)}return e}const H=[],W=[];function $(e,r,i,o,s,n){if(ie(e),!i){for(const t of r){const r=u.createFeatureId(t,n);e.push(new a.OptimizedFeature(null,t.attributes,null,r))}return e}switch(i){case"esriGeometryPoint":return D(e,r,o,s,n);case"esriGeometryMultipoint":return z(e,r,o,s,n);case"esriGeometryPolyline":return B(e,r,o,s,n);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,r,i,o){for(const s of t){const t=null!=s.geometry?q(new c,s.geometry,r,i):null,n=u.createFeatureId(s,o);null!=s.centroid?e.push(new a.OptimizedFeature(t,s.attributes,T(new c,s.centroid),n)):e.push(new a.OptimizedFeature(t,s.attributes,null,n))}return e}(e,r,o,s,n);default:p().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${i}'`)),ie(e)}return e}function J(e,r,i,o){const s=e&&("coords"in e?e:e.geometry);if(null==s)return null;switch(r){case"esriGeometryPoint":{let e=M;return i&&o?e=F:i?e=P:o&&(e=C),e(s)}case"esriGeometryMultipoint":return L(s,i,o);case"esriGeometryPolyline":return j(s,i,o);case"esriGeometryPolygon":return k(s,i,o);default:return p().error("convertToGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${r}'`)),null}}function Y(e,r,i,o,s){if(ie(e),null==i)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,r);switch(i){case"esriGeometryPoint":return function(e,t,r,i){let o=M;r&&i?o=F:r?o=P:i&&(o=C);for(const r of t){const{geometry:t,attributes:i}=r,s=null!=t?o(t):null;e.push({attributes:i,geometry:s})}return e}(e,r,o,s);case"esriGeometryMultipoint":return V(e,r,o,s);case"esriGeometryPolyline":return function(e,t,r,i){for(const{geometry:o,attributes:s}of t)e.push({attributes:s,geometry:null!=o?j(o,r,i):null});return e}(e,r,o,s);case"esriGeometryPolygon":return function(e,t,r,i){for(const{geometry:o,attributes:s,centroid:n}of t){const t=null!=o?k(o,r,i):null;if(null!=n){const r=M(n);e.push({attributes:s,centroid:r,geometry:t})}else e.push({attributes:s,geometry:t})}return e}(e,r,o,s);default:p().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${i}'`))}return e}function Z(e,t,r,i,o,s,n=r,a=i){if(re(e),!t?.coords.length)return null;const l=h[o],{coords:c,lengths:u}=t,p=d(r,i),f=d(r&&n,i&&a),m=b(r,i,n,a);if(!u.length)return m(e.coords,c,0,0,_(s,c[0]),v(s,c[1])),re(e,p,0),e;let y,g,S,x,w=0,M=0,T=M;for(const t of u){if(t<l)continue;let r=0;M=T,S=y=_(s,c[w]),x=g=v(s,c[w+1]),m(e.coords,c,M,w,S,x),r++,w+=p,M+=f;for(let i=1;i<t;i++,w+=p)S=_(s,c[w]),x=v(s,c[w+1]),S===y&&x===g||(m(e.coords,c,M,w,S-y,x-g),M+=f,r++,y=S,g=x);r>=l&&(e.lengths.push(r),T=M)}return ie(e.coords,T),e.coords.length?e:null}function Q(e,t,r,i){const o=e[t],s=e[t+1],n=e[r],a=e[r+1],l=e[i],c=e[i+1];let u=n,d=a,p=l-u,h=c-d;if(0!==p||0!==h){const e=((o-u)*p+(s-d)*h)/(p*p+h*h);e>1?(u=l,d=c):e>0&&(u+=p*e,d+=h*e)}return p=o-u,h=s-d,p*p+h*h}function X(e,t,r,i,o,s,n){let a,l=i,c=0;for(let e=s+r;e<n;e+=r)a=Q(t,e,s,n),a>l&&(c=e,l=a);l>i&&(c-s>r&&X(e,t,r,i,o,s,c),o(e,t,e.length,c,t[c],t[c+1]),n-c>r&&X(e,t,r,i,o,c,n))}function K(e,t,r,o,s){const{coords:n,lengths:a}=t,l=d(r,o);if(!n.length)return e!==t&&re(e),e;i.assertIsSome(s);const{originPosition:c,scale:u,translate:p}=s,h=oe;h.originPosition=c;const f=h.scale;f[0]=u[0]??1,f[1]=-(u[1]??1),f[2]=u[2]??1,f[3]=u[3]??1;const m=h.translate;if(m[0]=p[0]??0,m[1]=p[1]??0,m[2]=p[2]??0,m[3]=p[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=w(h,n[t],t);return e!==t&&re(e,l,0),e}let y=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[y+t]=w(h,n[y+t],t);let i=e.coords[y],o=e.coords[y+1];y+=l;for(let t=1;t<r;t++,y+=l){i+=n[y]*f[0],o+=n[y+1]*f[1],e.coords[y]=i,e.coords[y+1]=o;for(let t=2;t<l;++t)e.coords[y+t]=w(h,n[y+t],t)}}return e!==t&&re(e,n.length,a.length),e}function ee(e,t,r,i){let o=0,s=e[i*t],n=e[i*(t+1)];for(let a=1;a<r;a++){const r=s+e[i*(t+a)],l=n+e[i*(t+a)+1],c=(r-s)*(l+n);s=r,n=l,o+=c}return.5*o}function te(e,t,r,i){return 0===e*i-r*t&&e*r+t*i>0}function re(e,t=0,r=0){ie(e.lengths,r),ie(e.coords,t)}function ie(e,t=0){e.length!==t&&(e.length=t)}const oe={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};e.convertFromFeature=function(e,t,r,i,o){H[0]=e;const[s]=$(W,H,t,r,i,o);return ie(H),ie(W),s},e.convertFromFeatureSet=function(e,t){const r=new l,{hasM:i,hasZ:o,features:s,spatialReference:n,geometryType:a,exceededTransferLimit:c,transform:u,fields:d}=e;return d&&(r.fields=d),r.geometryType=a??null,r.spatialReference=n??null,s&&$(r.features,s,a,o,i,t),c&&(r.exceededTransferLimit=c),i&&(r.hasM=i),o&&(r.hasZ=o),u&&(r.transform=u),r},e.convertFromFeatures=$,e.convertFromGeometry=function(e,r,i){if(null==e)return null;const o=new c;return"hasZ"in e&&null==r&&(r=e.hasZ),"hasM"in e&&null==i&&(i=e.hasM),n.isPoint(e)?R(null!=r?r:null!=e.z,null!=i?i:null!=e.m)(o,e):n.isPolygon(e)?q(o,e,r,i):n.isPolyline(e)?N(o,e,d(r,i)):n.isMultipoint(e)?U(o,e,d(r,i)):void p().error("convertFromGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${e}'`))},e.convertFromMultipoint=U,e.convertFromMultipointFeatures=z,e.convertFromNestedArray=G,e.convertFromPoint=E,e.convertFromPointFeatures=D,e.convertFromPolygon=q,e.convertFromPolyline=N,e.convertFromPolylineFeatures=B,e.convertToFeature=function(e,t,r,i){W[0]=e,Y(H,W,t,r,i);const o=H[0];return ie(H),ie(W),o},e.convertToFeatureSet=function(e){const{spatialReference:t,transform:r,fields:i,hasM:o,hasZ:s,features:n,geometryType:a,exceededTransferLimit:l,queryGeometry:c,queryGeometryType:u}=e,d={features:Y([],n,a,s,o),fields:i,geometryType:a,spatialReference:t,queryGeometry:J(c,u,!1,!1)};return r&&(d.transform=r),l&&(d.exceededTransferLimit=l),o&&(d.hasM=o),s&&(d.hasZ=s),d},e.convertToFeatures=Y,e.convertToGeometry=J,e.convertToMultipoint=L,e.convertToMultipointFeatures=V,e.convertToPoint=function(e,t,r){return e?t?r?F(e):P(e):r?C(e):M(e):null},e.convertToPolygon=k,e.convertToPolyline=j,e.generalizeOptimizedGeometry=function(e,t,r,i,o,s,n=r,a=i){if(re(e),!t?.coords.length)return null;const l=h[o],{coords:c,lengths:u}=t,p=d(r,i),f=d(r&&n,i&&a),m=b(r,i,n,a);if(!u.length)return m(e.coords,c,0,0,c[0],c[1]),re(e,p,0),e;let y=0;const g=s*s;for(const t of u){if(t<l){y+=t*p;continue}const r=e.coords.length/f,i=y,o=y+(t-1)*p;m(e.coords,c,e.coords.length,i,c[i],c[i+1]),X(e.coords,c,p,g,m,i,o),m(e.coords,c,e.coords.length,o,c[o],c[o+1]);const s=e.coords.length/f-r;s>=l?e.lengths.push(s):ie(e.coords,r*f),y+=t*p}return e.coords.length?e:null},e.getBoundsOptimizedGeometry=function(e,t,r,i){if(!t?.coords?.length)return null;const n=d(r,i);let a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=n){const r=e[t],i=e[t+1];a=Math.min(a,r),c=Math.max(c,r),l=Math.min(l,i),u=Math.max(u,i)}}return o.is(e)?o.fromRectValues(e,a,l,c,u):s.fromValues(a,l,c,u,e),e},e.getQuantizedArea=function(e,t){const{coords:r,lengths:i}=e;let o=0,s=0;for(let e=0;e<i.length;e++){const n=i[e];s+=ee(r,o,n,t),o+=n}return Math.abs(s)},e.getQuantizedBoundsOptimizedGeometry=function(e,t,r,i){const o=d(r,i),{lengths:s,coords:n}=t;let a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,p=0;for(const e of s){let t=n[p],r=n[p+1];a=Math.min(t,a),l=Math.min(r,l),c=Math.max(t,c),u=Math.max(r,u),p+=o;for(let i=1;i<e;i++,p+=o){const e=n[p],i=n[p+1];t+=e,r+=i,e<0&&(a=Math.min(a,t)),e>0&&(c=Math.max(c,t)),i<0?l=Math.min(l,r):i>0&&(u=Math.max(u,r))}}return e[0]=a,e[1]=l,e[2]=c,e[3]=u,e},e.getSignedQuantizedRingArea=ee,e.quantizeForDisplay=function(e,t,r,i,o){const s=d(i,o);if(!e.lengths.length){if(e.coords.length<2)return null;const[r,i]=e.coords,o=S(t,r),s=x(t,i);return new c([],[o,s])}const n=new c([],[0,0]),a=h[r],l="esriGeometryPolygon"===r||"esriGeometryPolyline"===r;let u=0,p=0;for(let r=0;r<e.lengths.length;r++){const i=e.lengths[r],o=p;let c=S(t,e.coords[s*u]),d=x(t,e.coords[s*u+1]);n.coords[p++]=c,n.coords[p++]=d;let h=0,f=0,m=1;for(let r=1;r<i;r++){const i=S(t,e.coords[s*(r+u)]),o=x(t,e.coords[s*(r+u)+1]);if(i!==c||o!==d){const e=i-c,t=o-d;l&&te(h,f,e,t)?(n.coords[p-2]+=e,n.coords[p-1]+=t,c+=e,d+=t):(n.coords[p++]=i,n.coords[p++]=o,c=i,d=o,h=e,f=t,m+=1)}}m<a?p=o:n.lengths.push(m),u+=i}return 0===n.lengths.length?null:n},e.quantizeOptimizedFeatureSet=function(e,t){const{geometryType:r,features:i,hasM:o,hasZ:s}=t;if(!e)return t;for(let t=0;t<i.length;t++){const n=i[t],a=n.weakClone();a.geometry=new c,Z(a.geometry,n.geometry,o,s,r,e),n.centroid&&(a.centroid=new c,Z(a.centroid,n.centroid,o,s,"esriGeometryPoint",e)),i[t]=a}return t.transform=e,t},e.quantizeOptimizedGeometry=Z,e.quantizeX=_,e.quantizeY=v,e.removeCollinearVertices=function(e,t,r,i,o){if(!t?.coords?.length)return null;const s=h[r],{coords:n,lengths:a}=t,l=b(i,o,i,o),c=d(i,o);let u=0,p=0,f=0,m=0;for(const t of a){p=m,l(e.coords,n,p,u,n[u],n[u+1]),u+=c;let r=n[u],i=n[u+1],o=r,a=i,d=i/r;p+=c,l(e.coords,n,p,u,o,a),u+=c;for(let s=2;s<t;s++){r=n[u],i=n[u+1];const t=i/r,s=d===t||!isFinite(d)&&!isFinite(t),h=s&&isFinite(t)?d>=0&&t>=0||d<=0&&t<=0:a>=0&&i>=0||a<=0&&i<=0;s&&h?(o+=r,a+=i):(o=r,a=i,p+=c),l(e.coords,n,p,u,o,a),u+=c,d=t}p+=c;const h=(p-m)/c;h>=s&&(e.lengths[f]=h,m=p,f++)}return e.coords.length>m&&(e.coords.length=m),e.lengths.length>f&&(e.lengths.length=f),e.coords.length&&e.lengths.length?e:null},e.removeZMValues=function(e,t,r,i,o,s){if(re(e),e.lengths.push(...t.lengths),r===o&&i===s)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const n=d(r,i),a=b(r,i,o,s),l=t.coords;for(let t=0;t<l.length;t+=n)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e},e.unquantizeOptimizedFeatureSet=function(e){const{transform:t,features:r,hasM:i,hasZ:o}=e;if(!t)return e;for(const e of r)null!=e.geometry&&K(e.geometry,e.geometry,i,o,t),null!=e.centroid&&K(e.centroid,e.centroid,i,o,t);return e.transform=null,e},e.unquantizeOptimizedGeometry=K,e.unquantizeValue=w,e.unquantizeX=function(e,t){return w(e,t,0)},e.unquantizeY=function(e,t){return w(e,-t,1)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeature":function(){define(["exports","../../core/memoryEstimations","./centroid","./OptimizedGeometry"],function(e,t,r,i){"use strict";class o{constructor(e=null,t={},r,i,o=0){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=i,this.displayId=o}static fromJSON(e){const t=e.geometry?i.fromJSON(e.geometry):null,r=e.centroid?i.fromJSON(e.centroid):null,s=e.objectId;return new o(t,e.attributes,r,s)}weakClone(){const e=new o(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),t=new o(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t}ensureCentroid(e){return this.centroid??=r.getCentroidOptimizedGeometry(new i,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+t.estimateAttributesMemory(this.attributes)+(this.geometry?.usedMemory??0)}}e.OptimizedFeature=o,e.OptimizedFeatureWithGeometry=class extends o{},e.hasGeometry=function(e){return!!e.geometry?.coords?.length},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,i,o,s,n){const a=t(s,n);let l=i,c=i+a,u=0,d=0,p=0,h=0,f=0;for(let t=0,i=o-1;t<i;t++,l+=a,c+=a){const t=r[l],i=r[l+1],o=r[l+2],n=r[c],a=r[c+1],m=r[c+2];let y=t*a-n*i;h+=y,u+=(t+n)*y,d+=(i+a)*y,s&&(y=t*m-n*o,p+=(o+m)*y,f+=y),t<e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),i<e[2]&&(e[2]=i),i>e[3]&&(e[3]=i),s&&(o<e[4]&&(e[4]=o),o>e[5]&&(e[5]=o))}if(h>0&&(h*=-1),f>0&&(f*=-1),!h)return null;const m=[u,d,.5*h];return s&&(m[3]=p,m[4]=.5*f),m}function i(e,r,i,l,c){const u=t(l,c);let d=r,p=r+u,h=0,f=0,m=0,y=0;for(let t=0,r=i-1;t<r;t++,d+=u,p+=u){const t=e[d],r=e[d+1],i=e[d+2],c=e[p],u=e[p+1],g=e[p+2],b=l?s(t,r,i,c,u,g):o(t,r,c,u);if(b)if(h+=b,l){const e=a(t,r,i,c,u,g);f+=b*e[0],m+=b*e[1],y+=b*e[2]}else{const e=n(t,r,c,u);f+=b*e[0],m+=b*e[1]}}return h>0?l?[f/h,m/h,y/h]:[f/h,m/h]:i>0?l?[e[r],e[r+1],e[r+2]]:[e[r],e[r+1]]:null}function o(e,t,r,i){const o=r-e,s=i-t;return Math.sqrt(o*o+s*s)}function s(e,t,r,i,o,s){const n=i-e,a=o-t,l=s-r;return Math.sqrt(n*n+a*a+l*l)}function n(e,t,r,i){return[e+.5*(r-e),t+.5*(i-t)]}function a(e,t,r,i,o,s){return[e+.5*(i-e),t+.5*(o-t),r+.5*(s-r)]}e.getCentroidOptimizedGeometry=function(e,o,s,n){if(!o?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],c=s?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:d}=o,p=t(s,n);let h=0;for(const e of u){const t=r(c,d,h,e,s,n);t&&l.push(t),h+=e*p}if(l.sort((e,t)=>{let r=e[2]-t[2];return 0===r&&s&&(r=e[4]-t[4]),r}),l.length){let e=6*l[0][2];a[0]=l[0][0]/e,a[1]=l[0][1]/e,s&&(e=6*l[0][4],a[2]=0!==e?l[0][3]/e:0),(a[0]<c[0]||a[0]>c[1]||a[1]<c[2]||a[1]>c[3]||s&&(a[2]<c[4]||a[2]>c[5]))&&(a.length=0)}if(!a.length){const e=o.lengths[0]?i(d,0,u[0],s,n):null;if(!e)return null;a[0]=e[0],a[1]=e[1],s&&e.length>2&&(a[2]=e[2])}return e},e.lineCentroid=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedGeometry":function(){define(["../../core/memoryEstimations"],function(e){"use strict";class t{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new t(e.lengths,e.coords)}static fromRect(e){const[r,i,o,s]=e,n=o-r,a=s-i;return new t([5],[r,i,n,0,0,a,-n,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,t)=>e+t)}get usedMemory(){return 64+e.estimateNumberArrayMemory(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];if(i<3)continue;let o=this.coords[2*t],s=this.coords[2*t+1];for(let r=1;r<i;r+=1){const i=this.coords[2*(r+t)],n=this.coords[2*(r+t)+1];e+=-.5*(i-o)*(n+s),o=i,s=n}t+=i}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const i=this.lengths[r];for(let r=0;r<i;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=i}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let i=0;for(const e of r){for(let r=1;r<e;r++)t[2*(i+r)]+=t[2*(i+r)-2],t[2*(i+r)+1]+=t[2*(i+r)-1];i+=e}return e}clone(e){if(0===this.lengths.length)return new t([],[this.coords[0],this.coords[1]]);const r=2*(0===this.lengths.length?1:this.lengths.reduce((e,t)=>e+t)),i=this.coords.slice(0,r);return e?(e.set(i),new t(this.lengths,e)):new t(Array.from(this.lengths),Array.from(i))}}return t})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(function(){"use strict";class e{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new e;return t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}return e})},"esri/layers/graphics/data/createFeatureId":function(){define(["exports"],function(e){"use strict";e.createFeatureId=function(e,t){switch(t.type){case"object-id":case"unique-id-simple":return e.attributes[t.fieldName];case"unique-id-composite":{const r=[];for(const i of t.fieldNames)r.push(e.attributes[i]??null);return JSON.stringify(r)}}},e.createFeatureIdFromLayer=function(e,t){if("uniqueIdFields"in t&&t.uniqueIdFields?.length){if(1===t.uniqueIdFields.length)return e.attributes?.[t.uniqueIdFields[0]];const r=t.uniqueIdFields.map(t=>e.attributes?.[t]);return JSON.stringify(r)}return"objectIdField"in t&&t.objectIdField?e.attributes?.[t.objectIdField]:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(e,t,r,i){"use strict";const o=new r.WhereClauseCache(50,500),s="unsupported-query",n=" as ",a=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),l=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),c=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...a,...l]);function u(e,r,i={}){const n=d(r,e);if(!n){const i=o.getError(r,e);throw new t(s,"invalid SQL expression",{expression:r,error:i})}const a=i.expressionName||"expression";if(i.validateStandardized&&!n.isStandardized)throw new t(s,`${a} is not standard`,{expression:r});if(i.validateAggregate&&!n.isAggregate)throw new t(s,`${a} does not contain a valid aggregate function`,{expression:r});return n.fieldNames}function d(e,t){return e?o.get(e,t):null}function p(e){return/\((.*?)\)/.test(e)?e:e.split(n)[0]}function h(e,r,i,o={}){const n=new Map;if(function(e,t,r,i,o){const s=o.includes("*")?[...r,...o.filter(e=>"*"!==e)]:o;for(const o of s)if(t.get(o))f(e,t,r,i,o);else try{const s=u(t,p(o),{validateStandardized:!0});for(const o of s)f(e,t,r,i,o)}catch(t){e.set(o,{type:"expression-error",expression:o,error:t})}}(n,e,r,o.allowedFieldTypes??c,i),n.size){const e=o.expressionName??"expression";throw new t(s,`${e} contains invalid or missing fields`,{errors:Array.from(n.values()),query:o.query})}}function f(e,t,r,o,s){const n=t.get(s);n?r.has(n.name)?"all"!==o&&!1===o?.has(n.type)&&e.set(s,{type:"invalid-type",fieldName:n.name,fieldType:i.kebabDict.fromJSON(n.type),allowedFieldTypes:Array.from(o,e=>i.kebabDict.fromJSON(e))}):e.set(s,{type:"missing-field",fieldName:n.name}):e.set(s,{type:"invalid-field",fieldName:s})}e.allDateAndTimeFieldTypes=l,e.getAliasFromFieldName=function(e){return e.split(n)[1]},e.getExpressionFromFieldName=p,e.getWhereClause=d,e.numericFieldTypes=a,e.validateFields=h,e.validateHaving=function(e,r,i,o,n){if(!i)return!0;const a="having clause",l=u(e,i,{validateAggregate:!0,expressionName:a});h(e,r,l,{expressionName:a,query:n});const c=d(i,e),p=c?.getExpressions().every(t=>{const{aggregateType:r,field:i}=t,s=e.get(i)?.name;return o.some(t=>{const{onStatisticField:i,statisticType:o}=t,n=e.get(i)?.name;return n===s&&o.toLowerCase().trim()===r})});if(!p)throw new t(s,"expressions in having clause should also exist in outStatistics",{having:i});return!0},e.validateWhere=function(e,t,r,i){if(!r)return!0;const o="where clause";return h(e,t,u(e,r,{validateStandardized:!0,expressionName:o}),{expressionName:o,query:i}),!0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],function(e,t,r){"use strict";e.WhereClauseCache=class{constructor(e,r){this._cache=new t.LRUCache(e),this._invalidCache=new t.LRUCache(r)}get(e,t){const i=`${t?.uid}:${e}`,o=this._cache.get(i);if(o)return o;if(null!=this._invalidCache.get(i))return null;try{const o=r.create(e,{fieldsIndex:t});return this._cache.put(i,o),o}catch(e){return this._invalidCache.put(i,e),null}}getError(e,t){const r=`${t?.uid}:${e}`;return this._invalidCache.get(r)??null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/LRUCache":function(){define(["exports","./MemCache"],function(e,t){"use strict";e.LRUCache=class{constructor(e,r){this.removeFunc=r,this._storage=new t.MemCacheStorage,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy(),this._storage=null}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCache":function(){define(["exports","./has"],function(e,t){"use strict";const r=!!t("esri-tests-disable-gpu-memory-measurements");class i{constructor(e,t,r,i=0){this.name=e,this._storage=t,this.removeFunc=r,this._defaultPriority=i,this.id=`${o++}${n}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}set maxSize(e){this._storage.setMaxSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,r=this._defaultPriority){this._storage.put(this,e,t,t.cachedMemory,r)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t){this._storage.updateSize(this,e,t,t.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}let o=0;class s{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}const n=":";e.MemCache=i,e.MemCacheStorage=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear(),this._db=null}register(e){this._users.set(e.id.slice(0,-1),e)}deregister(e){this.clear(e),this._sizeLimits.delete(e),this._users.delete(e.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,i,o,n){t=e.id+t;const a=this._db.get(t);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(t),a.entry!==i&&this._notifyRemove(t,a.entry,a.size,0)),o>this._maxSize)return void this._notifyRemove(t,i,o,0);if(void 0===i)return void console.warn("Refusing to cache undefined entry ");if(!o||o<0)return r||console.warn(`Refusing to cache entry with size ${o} for key ${t}`),void this._notifyRemove(t,i,0,0);const l=1+Math.max(n,-4)- -3;this._db.set(t,new s(i,o,l)),this._size+=o,e.size+=o,this._checkSize()}updateSize(e,t,r,i){t=e.id+t;const o=this._db.get(t);if(o&&o.entry===r){for(this._size-=o.size,e.size-=o.size;i>this._maxSize;){const e=this._notifyRemove(t,r,i,1);if(!(null!=e&&e>0))return void this._db.delete(t);i=e}o.size=i,this._size+=i,e.size+=i,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach((e,i)=>{const o=e.lifetime;r[o]=(r[o]||0)+e.size,this._users.forEach(r=>{const{id:o,name:s}=r;if(i.startsWith(o)){const r=t[s]||0;t[s]=r+e.size}})});const i={};this._users.forEach(e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const o=t[r]||0;t[r]=o,i[r]=Math.round(100*e.hitRate)+"%"}else i[r]="0%"});const o=Object.keys(t);o.sort((e,r)=>t[r]-t[e]),o.forEach(r=>e[r]=Math.round(t[r]/2**20)+"MB / "+i[r]);for(let t=r.length-1;t>=0;--t){const i=r[t];i&&(e["Priority "+(t+-3-1)]=Math.round(i/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEach(e=>e.resetHitRate())}clear(e){const t=e.id;this._db.forEach((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,0))}),e.size=0}clearAll(){this._db.forEach((e,t)=>this._notifyRemove(t,e.entry,e.size,0)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}*values(e){for(const[t,r]of this._db)t.startsWith(e.id)&&(yield r.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,i){const o=this._users.get(e.split(n)[0])?.removeFunc,s=o?.(t,i,r);return"number"==typeof s?s:null}_checkSize(){this._sizeLimits.forEach((e,t)=>this._checkSizeLimits(e,t)),this._checkSizeLimits(this.maxSize)}setMaxSize(e,t){null==t||t<=0?this._sizeLimits.delete(e):this._sizeLimits.set(e,t)}_checkSizeLimits(e,t){const r=t??this;if(r.size<=e)return;const i=t?.id;let o=!0;for(;o;){o=!1;for(const[s,a]of this._db)if(0===a.lifetime&&(!i||s.startsWith(i))){const i=t??this._users.get(s.split(n)[0]);if(this._purgeItem(s,a,i),r.size<=.9*e)return;o||=this._db.has(s)}}for(const[o,s]of this._db)if(!i||o.startsWith(i)){const i=t??this._users.get(o.split(n)[0]);if(this._purgeItem(o,s,i),r.size<=.9*e)return}}_purgeItem(e,t,r){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const i=this._notifyRemove(e,t.entry,t.size,1);null!=i&&i>0&&(this._size+=i,r&&(r.size+=i),t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}},e.MinPriority=-3,e.NoPriority=-4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(e,t,r){"use strict";const i=new r,o=new r,s=new r,n={esriGeometryPoint:t.convertToPoint,esriGeometryPolyline:t.convertToPolyline,esriGeometryPolygon:t.convertToPolygon,esriGeometryMultipoint:t.convertToMultipoint},a="_geVersion",l=(e,t)=>e===a?void 0:t;e.cleanFromGeometryEngine=function(e){return e&&a in e?JSON.parse(JSON.stringify(e,l)):e},e.getGeometry=function(e,r,a,l,c,u,d=r,p=a){const h=r&&d,f=a&&p,m=null!=l?"coords"in l?l:l.geometry:null;if(null==m)return null;if(c){let i=t.generalizeOptimizedGeometry(o,m,r,a,e,c,d,p);return u&&(i=t.quantizeOptimizedGeometry(s,i,h,f,e,u)),n[e]?.(i,h,f)??null}if(u){const i=t.quantizeOptimizedGeometry(s,m,r,a,e,u,d,p);return n[e]?.(i,h,f)??null}return t.removeZMValues(i,m,r,a,d,p),n[e]?.(i,h,f)??null},e.transformCentroid=function(e,r,i,o=e.hasZ,n=e.hasM){if(null==r)return null;const a=e.hasZ&&o,l=e.hasM&&n;if(i){const c=t.quantizeOptimizedGeometry(s,r,e.hasZ,e.hasM,"esriGeometryPoint",i,o,n);return t.convertToPoint(c,a,l)}return t.convertToPoint(r,a,l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define(["exports","../../../core/arrayUtils","../../../core/promiseUtils","../../../geometry/projectionUtils","../../../geometry/geometryAdapters/json","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils"],function(e,t,r,i,o,s,n){"use strict";const a=[0,0];function l(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,a),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,a),[r.xmax,r.ymax]=e(t.xmax,t.ymax,a),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:c(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:c(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:u(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function c(e,t){const r=[];for(const i of e)r.push(u(i,t));return r}function u(e,t){const r=[];for(const i of e){const e=t(i[0],i[1],[0,0]);r.push(e),i.length>2&&e.push(i[2]),i.length>3&&e.push(i[3])}return r}const d=l.bind(null,n.lngLatToXY),p=l.bind(null,n.xyToLngLat),h=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,i,o){if(!e?.length||!t||!i||s.equals(t,i))return e;const n={geometries:e,inSpatialReference:t,outSpatialReference:i,geographicTransformation:o,resolve:r.createResolver()};return this._jobs.push(n),this._timer??=setTimeout(this._process,10),n.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:a,resolve:l,geographicTransformation:c}=e;n.canProject(r,a)?s.isWebMercator(a)?l(t.map(d)):l(t.map(p)):l(i.projectMany(o.jsonAdapter,t,r,a,c,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};e.checkProjectionSupport=async function(e,r){if(!e||!r)return;const o=Array.isArray(e)?e.map(e=>null!=e.geometry?e.geometry.spatialReference:null).filter(t.isSome):[e];await i.initializeProjection(o.map(e=>({source:e,dest:r})))},e.project=function(e,t,r,a){if(!e)return null;if(r||(r=t,t=e.spatialReference),!s.isValid(t)||!s.isValid(r)||s.equals(t,r))return e;if(n.canProject(t,r)){const t=s.isWebMercator(r)?d(e):p(e);return t.spatialReference=r,t}return i.projectMany(o.jsonAdapter,[e],t,r,null,a)[0]},e.projectMany=function(e,t,r,i){return h.push(e,t,r,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(e){"use strict";const t={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,i){const o=new r(e.getPointX(t),e.getPointY(t),i),s=e.hasZ(t),n=e.hasM(t);return s&&(o.z=e.getPointZ(t)),n&&(o.m=e.getPointM(t)),o},exportPolygon:function(e,t,r){return new i(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new o(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new s(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const i=e.hasZ(t),o=e.hasM(t),s=new n(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(i){const r=e.getZExtent(t);s.zmin=r.vmin,s.zmax=r.vmax}if(o){const r=e.getMExtent(t);s.mmin=r.vmin,s.mmax=r.vmax}return s}};class r{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class i{constructor(e,t,r,i){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class o{constructor(e,t,r,i){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class s{constructor(e,t,r,i){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),i&&(this.hasM=i)}}class n{constructor(e,t,r,i,o){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=i,this.spatialReference=o,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}e.jsonAdapter=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCache":function(){define(["exports","../../../core/has"],function(e,t){"use strict";let r=0;class i{constructor(e){this.items=e,this.time=performance.now(),this.id=r++}}e.QueryEngineCache=class{constructor(){this._storage=new Map,this._purgeInterval=5,this._sweep=()=>{if(this._timer=void 0,!this._storage)return;const e=1e3*this._purgeInterval,t=performance.now()-e;for(const[r,i]of this._storage){if(!(i.time<t))return void(this._storage.size>0&&(this._timer=setTimeout(this._sweep,e)));this._storage.delete(r)}}}destroy(){this._storage?.clear(),this._storage=null,clearTimeout(this._timer)}put(e,t){this._storage?.set(e,new i(t)),this._scheduleSweep()}get(e){const t=this._storage?.get(e);if(t)return this._storage?.delete(e),t.time=performance.now(),this._storage?.set(e,t),t.items}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??=setTimeout(this._sweep,1e3*this._purgeInterval))}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(e){"use strict";e.queryBinsCapabilities={supportsDate:!0,supportsFixedInterval:!0,supportsAutoInterval:!0,supportsFixedBoundaries:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!0,supportedStatistics:{count:!0,sum:!0,avg:!0,var:!0,stddev:!0,min:!0,max:!0,percentileContinuous:!0,percentileDiscrete:!0,envelope:!0,centroid:!0,convexHull:!0},supportedNormalizationTypes:{field:!0,log:!0,naturalLog:!0,percentOfTotal:!0,squareRoot:!0}},e.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsCurrentUser:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsPaginationOnAggregatedQueries:!1,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsReturnMesh:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0,supportsTrueCurve:!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define(["require","exports","../../../core/lang","../../../geometry/support/centroid","../../../geometry/support/extentUtils","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","./AttributesBuilder","./geometryUtils","./projectionSupport","./queryUtils","./SnappingCandidate","../../support/fieldUtils","../../../rest/support/AutoIntervalBinParameters","../../../rest/support/DateBinParameters","../../../rest/support/DateBinUtils","../../../rest/support/FixedBoundariesBinParameters","../../../rest/support/FixedIntervalBinParameters","../../../statistics/utils","../../../time/constants","../../../chunks/datetime"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v){"use strict";const S="bin";function x(e,t,r,i){const o=i.x-r.x,s=i.y-r.y,n=t.x-r.x,a=t.y-r.y,l=o*o+s*s;if(0===l)return!1;const c=n*o+a*s,u=Math.min(1,Math.max(0,c/l));return e.x=r.x+o*u,e.y=r.y+s*u,!0}function w(e,t){return e?t?4:3:t?3:2}class M{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}const T=[1];t.QueryEngineResult=class{constructor(e,t,r){this.items=e,this.query=t,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new a(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:r,outStatistics:i}=this.query,o=t?.length;if(!o)return 1;const s=new Map,n=new Map,l=new Set;for(const o of i){const{statisticType:i}=o,a="exceedslimit"!==i?o.onStatisticField:void 0;if(!n.has(a)){const r=[];for(const i of t){const t=this._getAttributeValues(e,i,this.items,s);r.push(t)}n.set(a,this._calculateUniqueValues(r,this.items,e.returnDistinctValues))}const c=n.get(a);for(const t in c){const{data:i,items:o}=c[t],s=i.join(",");r&&!e.validateItems(o,r)||l.add(s)}}return l.size}async createQueryResponse(){let e;if(e=this.query.outStatistics?this.query.outStatistics.some(e=>"exceedslimit"===e.statisticType)?this._createExceedsLimitQueryResponse():await this._createStatisticsQueryResponse(this.query,this.items):this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry){const t=this.query.geometry;n.isValid(this.query.outSR)&&!n.equals(t.spatialReference,this.query.outSR)?e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...c.project(t,t.spatialReference,this.query.outSR)}):e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...t})}return e}createSnappingResponse(e,t,r){const i=this.featureAdapter,o=w(this.hasZ,this.hasM),{point:s,mode:n}=e,a="number"==typeof e.distance?e.distance:e.distance.x,l="number"==typeof e.distance?e.distance:e.distance.y,c={candidates:[]},u="esriGeometryPolygon"===this.geometryType,p="esriGeometryPolyline"===this.geometryType||"esriGeometryPoint"===this.geometryType,h=this._getPointCreator(n,t,this.spatialReference,r),f=new M(null,0),m=new M(null,0),y={x:0,y:0,z:0};for(const t of this.items){const r=i.getGeometry(t);if(null==r)continue;const{coords:n}=r,g=r.isPoint?T:r.lengths;if(f.coords=n,m.coords=n,e.returnEdge){let e=0;for(let r=0;r<g.length;r++){const n=g[r],p=e;for(let r=0;r<n;r++,e+=o){if(!u&&r===n-1)continue;const g=f;g.coordsIndex=e;const b=m;b.coordsIndex=r===n-1?p:e+o;const _=y;if(!x(y,s,g,b))continue;const v=(s.x-_.x)/a,S=(s.y-_.y)/l,w=v*v+S*S;w<=1&&c.candidates.push(d.makeEdgeCandidate(i.getObjectId(t),h(_),Math.sqrt(w),h(g),h(b)))}}}if("all"===e.vertexMode){let e=0;for(let r=0;r<g.length;r++){const n=g[r],p=e,y=m;y.coordsIndex=p;for(let r=0;r<n;r++,e+=o){const o=f;if(o.coordsIndex=e,u&&r===n-1&&o.x===y.x&&o.y===y.y)continue;const p=(s.x-o.x)/a,m=(s.y-o.y)/l,g=p*p+m*m;g<=1&&c.candidates.push(d.makeVertexCandidate(i.getObjectId(t),h(o),Math.sqrt(g)))}}}else if(p&&"ends"===e.vertexMode){let e=0;const r=[];for(let t=0;t<g.length;t++){r.push(e);const i=g[t];e+=i*o,!u&&i>1&&r.push(e-o)}for(const e of r){const r=f;r.coordsIndex=e;const o=(s.x-r.x)/a,n=(s.y-r.y)/l,u=o*o+n*n;u<=1&&c.candidates.push(d.makeVertexCandidate(i.getObjectId(t),h(r),Math.sqrt(u)))}}}return c.candidates.sort((e,t)=>e.distance-t.distance),c}_getPointCreator(e,t,r,i){const o=null==i||n.equals(r,i)?e=>e:e=>c.project(e,r,i),{hasZ:s}=this;return"3d"===e?s&&t?({x:e,y:t,z:r})=>o({x:e,y:t,z:r}):({x:e,y:t})=>o({x:e,y:t,z:0}):({x:e,y:t})=>o({x:e,y:t})}async createSummaryStatisticsResponse(e){const{field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,minValue:n,maxValue:a,scale:l,timeZone:c,outStatisticTypes:u}=e,d=this.fieldsIndex.get(t),h=p.isDateField(d)||p.isDateOnlyField(d)||p.isTimestampOffsetField(d),f=await this._getDataValues({field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,scale:l,timeZone:c},this.items),m=b.isNullCountSupported({normalizationType:o,normalizationField:i,minValue:n,maxValue:a}),y={value:.5,fieldType:d?.type},g=p.isStringField(d)?b.calculateStringStatistics({values:f,supportsNullCount:m,percentileParams:y,outStatisticTypes:u}):b.calculateStatistics({values:f,minValue:n,maxValue:a,useSampleStdDev:!o,supportsNullCount:m,percentileParams:y,outStatisticTypes:u});return b.processSummaryStatisticsResult(g,u,h)}async createUniqueValuesResponse(e){const{field:t,valueExpression:r,domains:i,returnAllCodedValues:o,scale:s,timeZone:n}=e,a=await this._getDataValues({field:t,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:r,scale:s,timeZone:n},this.items,!1),l=b.calculateUniqueValuesCount(a);return b.createUVResult(l,i,o,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a,minValue:l,maxValue:c,numClasses:u,scale:d,timeZone:p}=e,h=await this._getDataValues({field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,scale:d,timeZone:p},this.items),f=b.calculateClassBreaks(h,{field:t,normalizationField:i,normalizationType:o,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a,minValue:l,maxValue:c,numClasses:u});return b.resolveCBResult(f,n)}async createHistogramResponse(e){const{field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a,minValue:l,maxValue:c,numBins:u,scale:d,timeZone:p}=e,h=await this._getDataValues({field:t,valueExpression:r,normalizationField:i,normalizationType:o,normalizationTotal:s,scale:d,timeZone:p},this.items);return b.calculateHistogram(h,{field:t,normalizationField:i,normalizationType:o,normalizationTotal:s,classificationMethod:n,standardDeviationInterval:a,minValue:l,maxValue:c,numBins:u})}_sortFeatures(e,t,r){if(e.length>1&&t?.length)for(const i of t.slice().reverse()){const t=i.split(" "),o=t[0],s=this.fieldsIndex.get(o),n=!!t[1]&&"desc"===t[1].toLowerCase(),a=b.getAttributeComparator(s?.type,n);e.sort((e,t)=>{const i=r(e,o,s),n=r(t,o,s);return a(i,n)})}}_createFeatureQueryResponse(e){const{items:t,geometryType:r,hasM:i,hasZ:o,objectIdField:n,spatialReference:a}=this,{outFields:c,outSR:u,quantizationParameters:d,resultRecordCount:p,resultOffset:h,returnZ:f,returnM:m}=e,y=null!=p&&t.length>(h||0)+p,g=c&&(c.includes("*")?[...this.fieldsIndex.fields]:c.map(e=>this.fieldsIndex.get(e)));return{exceededTransferLimit:y,features:this._createFeatures(e,t),fields:g,geometryType:r,hasM:i&&m,hasZ:o&&f,objectIdFieldName:n,spatialReference:l.cleanFromGeometryEngine(u||a),transform:d&&s.toQuantizationTransform(d)||null}}_createFeatures(e,t){const r=new a(e,this.featureAdapter,this.fieldsIndex),{hasM:i,hasZ:o}=this,{orderByFields:n,quantizationParameters:c,returnGeometry:u,returnCentroid:d,maxAllowableOffset:p,resultOffset:h,resultRecordCount:f,returnZ:m=!1,returnM:y=!1}=e,g=o&&m,b=i&&y;let _=[],v=0;const S=[...t];if(this._sortFeatures(S,n,(e,t,i)=>r.getFieldValue(e,t,i)),this.geometryType&&(u||d)){const e=s.toQuantizationTransform(c)??void 0,t="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(u&&!d)for(const i of S){const o=this.featureAdapter.getGeometry(i),s={attributes:r.getAttributes(i),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,o,p,e,g,b),metadata:this.featureAdapter.getMetadata?.(i)};t&&o&&!s.geometry&&(s.centroid=l.transformCentroid(this,this.featureAdapter.getCentroid(i,this),e)),_[v++]=s}else if(!u&&d)for(const t of S)_[v++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of S)_[v++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),p,e,g,b),metadata:this.featureAdapter.getMetadata?.(t)}}else for(const e of S){const t=r.getAttributes(e);t&&(_[v++]={attributes:t})}const x=h||0;if(null!=f){const e=x+f;_=_.slice(x,Math.min(_.length,e))}return _}_createExceedsLimitQueryResponse(){let e=!1,t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;for(const e of this.query.outStatistics??[])if("exceedslimit"===e.statisticType){t=null!=e.maxPointCount?e.maxPointCount:Number.POSITIVE_INFINITY,r=null!=e.maxRecordCount?e.maxRecordCount:Number.POSITIVE_INFINITY,i=null!=e.maxVertexCount?e.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)e=this.items.length>t;else if(this.items.length>r)e=!0;else{const t=w(this.hasZ,this.hasM),r=this.featureAdapter;e=this.items.reduce((e,t)=>{const i=r.getGeometry(t);return e+(null!=i&&i.coords.length||0)},0)/t>i}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(e)}}]}}async _createStatisticsQueryResponse(e,t,r={attributes:{}}){const i=[],o=new Map,s=new Map,n=new Map,l=new Map,c=new a(e,this.featureAdapter,this.fieldsIndex),u=e.outStatistics,{groupByFieldsForStatistics:d,having:h,orderByFields:f,resultRecordCount:m}=e,y=d?.length,g=!!y,b=g?d[0]:null,_=g&&!this.fieldsIndex.get(b);for(const e of u??[]){const{outStatisticFieldName:a,statisticType:u}=e,f=e,m="exceedslimit"!==u?e.onStatisticField:void 0,v="percentile_disc"===u||"percentile_cont"===u,S="EnvelopeAggregate"===u||"CentroidAggregate"===u||"ConvexHullAggregate"===u,x=g&&1===y&&(m===b||_)&&"count"===u;if(g){if(!n.has(m)){const e=[];for(const r of d){const i=this._getAttributeValues(c,r,t,o);e.push(i)}n.set(m,this._calculateUniqueValues(e,t,!S&&c.returnDistinctValues))}const e=n.get(m);if(!e)continue;const r=Object.keys(e);for(const i of r){const{count:r,data:s,items:n,itemPositions:u}=e[i],p=s.join(",");if(!h||c.validateItems(n,h)){const e=l.get(p)||{attributes:{}};if(S){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:t,outStatisticFieldName:r}=await this._getAggregateGeometry(f,n);e.aggregateGeometries[r]=t}else{let i=null;if(x)i=r;else{const e=this._getAttributeValues(c,m,t,o),r=u.map(t=>e[t]);i=v&&"statisticParameters"in f?this._getPercentileValue(f,r):this._getStatisticValue(f,r,null,c.returnDistinctValues)}e.attributes[a]=i}let i=0;d.forEach((t,r)=>e.attributes[this.fieldsIndex.get(t)?t:"EXPR_"+ ++i]=s[r]),l.set(p,e)}}}else if(S){r.aggregateGeometries||(r.aggregateGeometries={});const{aggregateGeometries:e,outStatisticFieldName:i}=await this._getAggregateGeometry(f,t);r.aggregateGeometries[i]=e}else{const e=this._getAttributeValues(c,m,t,o);r.attributes[a]=v&&"statisticParameters"in f?this._getPercentileValue(f,e):this._getStatisticValue(f,e,s,c.returnDistinctValues)}const w="min"!==u&&"max"!==u||!p.isStringField(this.fieldsIndex.get(m))&&!this._isAnyDateField(m)?null:this.fieldsIndex.get(m)?.type;i.push({name:a,alias:a,type:w||"esriFieldTypeDouble"})}const v=g?Array.from(l.values()):[r];return this._sortFeatures(v,f,(e,t)=>e.attributes[t]),m&&(v.length=Math.min(m,v.length)),{fields:i,features:v}}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return p.isDateField(t)||p.isDateOnlyField(t)||p.isTimestampOffsetField(t)||p.isTimeOnlyField(t)}async _getAggregateGeometry(t,r){const{convexHull:s,union:n}=await new Promise((t,r)=>e(["../../../geometry/geometryEngineJSON"],t,r)),{statisticType:a,outStatisticFieldName:c}=t,{featureAdapter:u,spatialReference:d,geometryType:p,hasZ:h,hasM:f}=this,m=r.map(e=>l.getGeometry(p,h,f,u.getGeometry(e))),y=s(d,m,!0)[0],g={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===a){const e=y?o.getPolygonExtent(y):o.getGeometryExtent(n(d,m));g.aggregateGeometries={...e,spatialReference:d},g.outStatisticFieldName=c||"extent"}else if("CentroidAggregate"===a){const e=y?i.polygonCentroid(y):i.extentCentroid(o.getGeometryExtent(n(d,m)));g.aggregateGeometries={x:e[0],y:e[1],spatialReference:d},g.outStatisticFieldName=c||"centroid"}else"ConvexHullAggregate"===a&&(g.aggregateGeometries=y,g.outStatisticFieldName=c||"convexHull");return g}_getStatisticValue(e,t,r,i){const{onStatisticField:o,statisticType:s}=e;let n=null;return n=r?.has(o)?r.get(o):p.isStringField(this.fieldsIndex.get(o))||this._isAnyDateField(o)?b.calculateStringStatistics({values:t,returnDistinct:i}):b.calculateStatistics({values:i?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(o,n),n["var"===s?"variance":s]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:i,statisticType:o}=e,{value:s,orderBy:n}=i,a=this.fieldsIndex.get(r),l={value:s,orderBy:n,fieldType:a?.type,isDiscrete:"percentile_disc"===o};return b.calculatePercentile(t,l)}_getAttributeValues(e,t,r,i){if(i.has(t))return i.get(t);const o=this.fieldsIndex.get(t),s=r.map(r=>e.getFieldValue(r,t,o));return i.set(t,s),s}_calculateUniqueValues(e,t,r){const i={},o=t.length;for(let s=0;s<o;s++){const o=t[s],n=[];for(const t of e)n.push(t[s]);const a=n.join(",");null==i[a]?i[a]={count:1,data:n,items:[o],itemPositions:[s]}:(r||i[a].count++,i[a].items.push(o),i[a].itemPositions.push(s))}return i}async _getDataValues(e,t,i=!0){const o=new a(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:s,scale:n,timeZone:l}=e;return s?o.getExpressionValues(t,s,{viewingMode:"map",scale:n,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},l):o.getDataValues(t,r.clone(e),i)}_calculateHistogramBins(e,t,r){if(null==t.min&&null==t.max)return[];const i=t.intervals,o=t.min??0,s=t.max??0,n=i.map(([e,t])=>({minValue:e,maxValue:t,count:0,items:[]}));for(let t=0;t<e.length;t++){const a=e[t],l=r[t];if(null!=a&&a>=o&&a<=s){const e=b.binIndex(i,a);e>-1&&(n[e].count++,n[e].items.push(l))}}return n}async createQueryBinsResponse(e){const t=e.bin?.splitBy;if(!t)return this._createBinsResponse(e);const{value:r,outAlias:i,valueType:o}=t,s=[],n=[{name:i??r,alias:i??r,type:o??"esriFieldTypeString"},{name:S,alias:S,type:"esriFieldTypeInteger"}],l=new a(e,this.featureAdapter,this.fieldsIndex),c=new Map,u=[...this.items];this._sortFeatures(u,[r],(e,t,r)=>l.getFieldValue(e,t,r));const d=this._getAttributeValues(l,r,u,c),p=this._calculateUniqueValues([d],u,l.returnDistinctValues);for(const t in p){const{items:o}=p[t],a=await this._createBinsResponse(e,o);if(s.push(...a.features.map(e=>({...e,attributes:{...e.attributes,[i??r]:t}}))),a.fields)for(const e of a.fields)n.some(t=>t.name===e.name)||n.push(e)}return{fields:n,features:s}}async _createBinsResponse(e,t){const r=e.bin;switch(t=t??this.items,r.type){case"autoIntervalBin":return this._createAutoIntervalBinsResponse(h.fromJSON(r),e,t);case"dateBin":return this._createDateBinsResponse(f.fromJSON(r),e,t);case"fixedBoundariesBin":return this._createFixedBoundariesBinsResponse(y.fromJSON(r),e,t);case"fixedIntervalBin":return this._createFixedIntervalBinsResponse(g.fromJSON(r),e,t)}}async _createAutoIntervalBinsResponse(e,t,r){const{field:i,normalizationField:o,numBins:s,normalizationType:n,normalizationTotal:a,start:l,end:c}=e,d=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),p=b.getBinParams(d,{field:i,normalizationField:o,normalizationType:n,normalizationTotal:a,numBins:s,minValue:u.getDateInNumber(l,!1),maxValue:u.getDateInNumber(c,!1)}),h=this._calculateHistogramBins(d,p,r);return this._createFeaturesFromHistogramBins(h,t)}async _createDateBinsResponse(e,t,r){const{field:i,interval:o,start:s,end:n,snapToData:a,returnFullIntervalBin:l}=e,c=o.unit,d=await this._getDataValues({field:e.field,timeZone:t.outTimeReference?.ianaTimeZone},r),h=p.isTimeOnlyField(this.fieldsIndex.get(i)),f=m.unitsDict.toJSON(c),y=d.filter(Boolean).sort((e,t)=>e-t),g=null!=s?u.getDateInNumber(s,h):y[0],b=null!=n?u.getDateInNumber(n,h):y[y.length-1],S={zone:t.outTimeReference?.ianaTimeZone??_.utc},x=v.DateTime.fromMillis(g,S),w=v.DateTime.fromMillis(b,S),M=[];if("last"===a){let e=w;for(;e>x;){const t=e.minus({[f]:o.value});if(t<x){M.unshift([l?t.toMillis():x.toMillis(),e.toMillis()]);break}M.unshift([t.toMillis(),e.toMillis()]),e=t}}else{let e="first"===a?x:x.startOf(f);for(;e<=w;){const t=e.plus({[f]:o.value});if(t>w){M.push([e.toMillis(),l?t.toMillis():w.toMillis()]);break}M.push([e.toMillis(),t.toMillis()]),e=t}}const T=this._calculateHistogramBins(d,{intervals:M,min:g,max:b},r);return this._createFeaturesFromHistogramBins(T,t)}async _createFixedBoundariesBinsResponse(e,t,r){const{field:i}=e,o=await this._getDataValues({field:i,timeZone:t.outTimeReference?.ianaTimeZone},r),s=p.isTimeOnlyField(this.fieldsIndex.get(i)),n=e.boundaries.map(e=>u.getDateInNumber(e,s)).sort((e,t)=>e-t),a=[];for(let e=0;e<n.length-1;e++)a.push([n[e],n[e+1]]);const l={intervals:a,min:n.at(0),max:n.at(-1)},c=this._calculateHistogramBins(o,l,r);return this._createFeaturesFromHistogramBins(c,t)}async _createFixedIntervalBinsResponse(e,t,r){const{field:i,interval:o,start:s,end:n}=e,a=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),l=p.isTimeOnlyField(this.fieldsIndex.get(i)),c=b.getBinParams(a,{field:i,classificationMethod:"defined-interval",definedInterval:o,minValue:u.getDateInNumber(s,l),maxValue:u.getDateInNumber(n,l)},!0),d=this._calculateHistogramBins(a,c,r);return this._createFeaturesFromHistogramBins(d,t)}async _createFeaturesFromHistogramBins(e,t){const{upperBoundaryAlias:r,lowerBoundaryAlias:i}=t,o=i||"lowerBoundary",s=r||"upperBoundary",n=[],a=[{name:o,alias:o,type:"esriFieldTypeDouble"},{name:s,alias:s,type:"esriFieldTypeDouble"}],l=t.bin?.stackBy?.value,c=t.bin?.stackBy?.outAlias;l&&a.push({name:S,alias:S,type:"esriFieldTypeInteger"},{name:c??l,alias:c??l,type:"esriFieldTypeString"});let u=0;const d="dateBin"===t.bin.type,p=t.outTimeReference?.ianaTimeZone;for(const r of e){const{minValue:e,maxValue:i,items:h}=r,f={attributes:{}};let m;if(f.attributes[o]=d&&p&&null!=e?v.DateTime.fromMillis(e,{zone:p}).toISO():e,f.attributes[s]=d&&p&&null!=i?v.DateTime.fromMillis(i,{zone:p}).toISO():i,l?(m=await this._createStatisticsQueryResponse({...t,groupByFieldsForStatistics:[l],orderByFields:[l]},h),f.attributes[S]=++u,"flat"===t.bin.jsonStyle?n.push(...m.features.map(({attributes:{EXPR_1:e,...t},...r})=>({...r,attributes:c??e?{...t,[c??e]:e,...f.attributes}:{...t,...f.attributes}}))):(f.stackedAttributes=m.features.map(({attributes:{EXPR_1:e,...t}})=>c??e?{...t,[c??e]:e}:t),n.push(f))):(t.bin?.splitBy&&(f.attributes[S]=++u),m=await this._createStatisticsQueryResponse(t,h,f),n.push(f)),m.fields)for(const e of m.fields)a.some(t=>t.name===e.name)||a.push(e)}return"desc"===t.binOrder&&n.reverse(),{fields:a,features:n}}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(e,t){"use strict";function r(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:i}=e,o=r[0]??1,s=r[1]??1;return{originPosition:"lowerLeft",scale:[o,"lowerLeft"===t?s:-s,r[2]??1,r[3]??1],translate:[i[0]??0,i[1]??0,i[2]??0,i[3]??0]}}function i({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function o({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function s({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}function n({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}function a(e,t){return e&&t?d:e&&!t?c:!e&&t?u:l}const l=(e,t)=>{const r=[];if(!t.length)return null;const s=t[0];let n=i(e,s[0]),a=o(e,s[1]);r.push([n,a]);for(let s=1;s<t.length;s++){const[l,c]=t[s],u=i(e,l),d=o(e,c);u===n&&d===a||r.push([u-n,d-a]),n=u,a=d}return r},c=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let a=i(e,n[0]),l=o(e,n[1]),c=s(e,n[2]);r.push([a,l,c]);for(let n=1;n<t.length;n++){const[u,d,p]=t[n],h=i(e,u),f=o(e,d),m=s(e,p);h===a&&f===l&&m===c||r.push([h-a,f-l,m]),a=h,l=f,c=m}return r},u=(e,t)=>{const r=[];if(!t.length)return null;const s=t[0];let a=i(e,s[0]),l=o(e,s[1]),c=n(e,s[2]);r.push([a,l,c]);for(let s=1;s<t.length;s++){const[u,d,p]=t[s],h=i(e,u),f=o(e,d),m=n(e,p);h===a&&f===l&&m===c||r.push([h-a,f-l,m]),a=h,l=f,c=m}return r},d=(e,t)=>{const r=[];if(!t.length)return null;const a=t[0];let l=i(e,a[0]),c=o(e,a[1]),u=s(e,a[2]),d=n(e,a[3]);r.push([l,c,u,d]);for(let a=1;a<t.length;a++){const[p,h,f,m]=t[a],y=i(e,p),g=o(e,h),b=s(e,f),_=n(e,m);y===l&&g===c&&b===u&&_===d||r.push([y-l,g-c,b,_]),l=y,c=g,u=b,d=_}return r};function p({scale:e,translate:t},r){return r*e[0]+t[0]}function h({scale:e,translate:t},r){return r*e[1]+t[1]}function f({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function m({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function y(e,t){return e&&t?v:e&&!t?b:!e&&t?_:g}const g=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let o=p(e,i[0]),s=h(e,i[1]);r[0]=[o,s];const{scale:n,originPosition:a}=e,l=n[0],c="lowerLeft"===a?n[1]:-n[1];for(let e=1;e<t.length;e++){const[i,n]=t[e];o+=l*i,s+=c*n,r[e]=[o,s]}return r},b=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let o=p(e,i[0]),s=h(e,i[1]);r[0]=[o,s,f(e,i[2])];const{scale:n,originPosition:a}=e,l=n[0],c="lowerLeft"===a?n[1]:-n[1];for(let i=1;i<t.length;i++){const[n,a,u]=t[i];o+=l*n,s+=c*a,r[i]=[o,s,f(e,u)]}return r},_=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let o=p(e,i[0]),s=h(e,i[1]);r[0]=[o,s,m(e,i[2])];const{scale:n,originPosition:a}=e,l=n[0],c="lowerLeft"===a?n[1]:-n[1];for(let i=1;i<t.length;i++){const[n,a,u]=t[i];o+=l*n,s+=c*a,r[i]=[o,s,m(e,u)]}return r},v=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const i=t[0];let o=p(e,i[0]),s=h(e,i[1]);r[0]=[o,s,f(e,i[2]),m(e,i[3])];const{scale:n,originPosition:a}=e,l=n[0],c="lowerLeft"===a?n[1]:-n[1];for(let i=1;i<t.length;i++){const[n,a,u,d]=t[i];o+=l*n,s+=c*a,r[i]=[o,s,f(e,u),m(e,d)]}return r};function S(e,t,r){const i=new Array(r.length);for(let o=0;o<r.length;o++)i[o]=t(e,r[o]);return i}function x(e,t,r){let[i,o]=r[0],s=Math.min(i,t[0]),n=Math.min(o,t[1]),a=Math.max(i,t[2]),l=Math.max(o,t[3]);for(let e=1;e<r.length;e++){const[t,c]=r[e];i+=t,o+=c,t<0&&(s=Math.min(s,i)),t>0&&(a=Math.max(a,i)),c<0?n=Math.min(n,o):c>0&&(l=Math.max(l,o))}return e[0]=s,e[1]=n,e[2]=a,e[3]=l,e}function w(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++)x(e,e,t[r]);return e}function M(e,t,a){const l=r(e);return t.xmin=i(l,a.xmin),t.ymin=o(l,a.ymin),t.xmax=i(l,a.xmax),t.ymax=o(l,a.ymax),a.hasZ&&(t.zmin=s(l,a.zmin),t.zmax=s(l,a.zmax)),a.hasM&&(t.mmin=n(l,a.mmin),t.mmax=n(l,a.mmax)),t.hasZ=a.hasZ??!1,t.hasM=a.hasM??!1,t}function T(e,t,i){const o=r(e);return t.points=a(i.hasZ,i.hasM)(o,i.points)??[],t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t}function P(e,t,a){const l=r(e);return t.x=i(l,a.x),t.y=o(l,a.y),null!=a.z&&(t.z=s(l,a.z)),null!=a.m&&(t.m=n(l,a.m)),t}function I(e,t,i){const o=function(e,t,r,i){const o=[],s=a(r,i);for(let r=0;r<t.length;r++){const i=s(e,t[r]);i&&i.length>=3&&o.push(i)}return o.length?o:null}(r(e),i.rings,i.hasZ,i.hasM);return o?(t.rings=o,t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t):null}function C(e,t,i){const o=function(e,t,r,i){const o=[],s=a(r,i);for(let r=0;r<t.length;r++){const i=s(e,t[r]);i&&i.length>=2&&o.push(i)}return o.length?o:null}(r(e),i.paths,i.hasZ,i.hasM);return o?(t.paths=o,t.hasZ=i.hasZ??!1,t.hasM=i.hasM??!1,t):null}e.getQuantizedBoundsCoordsArray=x,e.getQuantizedBoundsCoordsArrayArray=w,e.getQuantizedBoundsPaths=function(e){return w([0,0,0,0],e)},e.getQuantizedBoundsPoints=function(e){const t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return x(t,t,e)},e.getQuantizedBoundsRings=function(e){return w([0,0,0,0],e)},e.normalizeTransform=r,e.quantizeBounds=function(e,t,s){const n=r(e);return t[0]=i(n,s[0]),t[3]=o(n,s[1]),t[2]=i(n,s[2]),t[1]=o(n,s[3]),t},e.quantizeCoordsArrayXY=l,e.quantizeCoordsArrayXYM=u,e.quantizeCoordsArrayXYZ=c,e.quantizeCoordsArrayXYZM=d,e.quantizeExtent=M,e.quantizeGeometry=function(e,r){return e&&r?t.isPoint(r)?P(e,{},r):t.isPolyline(r)?C(e,{},r):t.isPolygon(r)?I(e,{},r):t.isMultipoint(r)?T(e,{},r):t.isExtent(r)?M(e,{},r):null:null},e.quantizeM=n,e.quantizeMultipoint=T,e.quantizePoint=P,e.quantizePolygon=I,e.quantizePolyline=C,e.quantizeX=i,e.quantizeY=o,e.quantizeZ=s,e.toQuantizationTransform=function(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null},e.unquantizeBounds=function(e,t,i){const o=r(e);return i?(t[0]=p(o,i[0]),t[1]=h(o,i[3]),t[2]=p(o,i[2]),t[3]=h(o,i[1]),t):[p(o,t[0]),h(o,t[3]),p(o,t[2]),h(o,t[1])]},e.unquantizeCoordsArrayArray=S,e.unquantizeCoordsArrayXY=g,e.unquantizeCoordsArrayXYM=_,e.unquantizeCoordsArrayXYZ=b,e.unquantizeCoordsArrayXYZM=v,e.unquantizeExtent=function(e,t,i,o=i.hasZ??!1,s=i.hasM??!1){const n=r(e);return t.xmin=p(n,i.xmin),t.xmax=p(n,i.xmax),t.ymin=h(n,i.ymin),t.ymax=h(n,i.ymax),o&&(t.zmin=f(n,i.zmin),t.zmax=f(n,i.zmax)),s&&(t.mmin=m(n,i.mmin),t.mmax=m(n,i.mmax)),t.hasZ=o,t.hasM=s,t},e.unquantizeM=m,e.unquantizeMultipoint=function(e,t,i,o=i?.hasZ??!1,s=i?.hasM??!1){if(null!=i){const n=r(e);t.points=y(o,s)(n,i.points),t.hasZ=o,t.hasM=s}return t},e.unquantizePoint=function(e,t,i,o=null!=i?.z,s=null!=i?.m){if(null==i)return t;const n=r(e);return t.x=p(n,i.x),t.y=h(n,i.y),o&&(t.z=f(n,i.z)),s&&(t.m=m(n,i.m)),t},e.unquantizePolygon=function(e,t,i,o=i?.hasZ??!1,s=i?.hasM??!1){if(null!=i){const n=r(e);t.rings=S(n,y(o,s),i.rings),t.hasZ=o,t.hasM=s}return t},e.unquantizePolyline=function(e,t,i,o=i?.hasZ??!1,s=i?.hasM??!1){if(null!=i){const n=r(e);t.paths=S(n,y(o,s),i.paths),t.hasZ=o,t.hasM=s}return t},e.unquantizeX=p,e.unquantizeY=h,e.unquantizeZ=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["./attributeSupport","./geometryUtils","../../support/fieldUtils","../../../smartMapping/statistics/support/utils","../../../statistics/utils","../../../support/loadArcade"],function(e,t,r,i,o,s){"use strict";return class{constructor(t,r,i){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues??!1,this.fieldsIndex=i,this.featureAdapter=r;const o=t.outFields;if(o&&!o.includes("*")){this.outFields=o;let t=0;for(const r of o){const o=e.getExpressionFromFieldName(r),s=this.fieldsIndex.get(o),n=s?null:e.getWhereClause(o,i),a=s?s.name:e.getAliasFromFieldName(r)||"FIELD_EXP_"+t++;this._fieldDataCache.set(r,{alias:a,clause:n})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach(e=>this.getAttributes(e)),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(t,r,i){const o=i?i.name:r;let s=null;return this._fieldDataCache.has(o)?s=this._fieldDataCache.get(o)?.clause:i||(s=e.getWhereClause(r,this.fieldsIndex),this._fieldDataCache.set(o,{alias:o,clause:s})),i?this.featureAdapter.getAttribute(t,o):s?.calculateValue(t,this.featureAdapter)}getDataValues(e,t,s=!0){const n=t.normalizationType,a=t.normalizationTotal,l=this.fieldsIndex.get(t.field),c=r.isDateOnlyField(l)||r.isTimestampOffsetField(l),u=r.isTimeOnlyField(l);return e.map(e=>{let r=t.field&&this.getFieldValue(e,t.field,this.fieldsIndex.get(t.field));if(t.field2?(r=`${o.processNullValue(r)}${t.fieldDelimiter}${o.processNullValue(this.getFieldValue(e,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(r=`${r}${t.fieldDelimiter}${o.processNullValue(this.getFieldValue(e,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof r&&s&&(c?r=r?new Date(r).getTime():null:u&&(r=r?i.timeOnlyToMilliseconds(r):null)),n&&Number.isFinite(r)){const i="field"===n&&t.normalizationField?this.getFieldValue(e,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;r=o.getNormalizedValue(r,n,i,a)}return r})}async getExpressionValues(e,r,i,o,n){const{arcadeUtils:a}=await s.loadArcade(),l=a.hasGeometryOperations(r);l&&await a.enableGeometryOperations();const c=a.createFunction(r),u=a.getViewInfo(i),d={fields:this.fieldsIndex.fields};return e.map(e=>{const r={attributes:this.featureAdapter.getAttributes(e),layer:d,geometry:l?{...t.getGeometry(o.geometryType,o.hasZ,o.hasM,this.featureAdapter.getGeometry(e)),spatialReference:i?.spatialReference}:null},s=a.createExecContext(r,u,n);return a.executeFunction(c,s)})}validateItem(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testFeature(t,this.featureAdapter)??!1}validateItems(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testSet(t,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const r={};for(const i of t){const{alias:t,clause:o}=this._fieldDataCache.get(i);r[t]=o?o.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const i of t){const{alias:t}=this._fieldDataCache.get(i);r.push(e[t])}else for(const t in e)r.push(e[t]);const i=`${(t||["*"]).join(",")}=${r.join(",")}`;let o=this._returnDistinctMap.get(i)||0;return this._returnDistinctMap.set(i,++o),o>1?null:e}}})},"esri/smartMapping/statistics/support/utils":function(){define(["exports","../../../core/Error","../../../core/screenUtils","../../../core/timeUtils","../../../geometry/Point","../../../geometry/SpatialReference","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/support/fieldUtils","../../../renderers/support/heatmapUtils","../../support/utils","../../../statistics/utils","../../../support/loadArcade"],function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";let h=null;const f=/^(?<hh>([01][0-9])|(2[0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?(\.(?<ms>\d+))?$/;function m(e){const t=f.exec(e);if(!t)return null;const{hh:r,mm:o,ss:s,ms:n}=t.groups;return Number(r)*i.millisecondsPerTimeUnit.hours+Number(o)*i.millisecondsPerTimeUnit.minutes+Number(s)*i.millisecondsPerTimeUnit.seconds+Number(n||0)}function y(e,t){let r=null!=e?e:"";return null!=t&&t&&(r=r?"("+r+") AND ("+t+")":t),r}e.calculateHeatmapStats=function(e,t=18,i,o,s){const n=new Float64Array(o*s);t=Math.round(r.pt2px(t));let a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const u=c.createValueFunction(i);for(const{geometry:r,attributes:i}of e){const{x:e,y:d}=r,p=Math.max(0,e-t),h=Math.max(0,d-t),f=Math.min(s,d+t),m=Math.min(o,e+t),y=+u(i);for(let r=h;r<f;r++)for(let i=p;i<m;i++){const s=r*o+i,u=c.evaluateDensityKernel(i-e,r-d,t)*y,p=n[s]+=u;a=Math.min(a,p),l=Math.max(l,p)}}return{min:a,max:l}},e.getDataValues=async function(e,t,r=!0){if(!t)return[];const{field:i,field2:o,field3:n,fieldDelimiter:a,fieldInfos:c,timeZone:f}=e,y=i&&c?.find(e=>e.name.toLowerCase()===i.toLowerCase()),g=!!y&&l.isTimeOnlyField(y),b=!!y&&u.isAnyDateField(y),_=e.valueExpression,v=e.normalizationType,S=e.normalizationField,x=e.normalizationTotal,w=[],M=e.viewInfoParams;let T=null,P=null;if(_){if(!h){const{arcadeUtils:e}=await p.loadArcade();h=e}h.hasGeometryOperations(_)&&await h.enableGeometryOperations(),T=h.createFunction(_),P=M?h.getViewInfo({viewingMode:M.viewingMode,scale:M.scale,spatialReference:new s(M.spatialReference)}):null}const I=e.fieldInfos,C=t[0]&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass||!I?null:{fields:I};return t.forEach(e=>{const t=e.attributes;let s;if(_){const t=C?Object.assign({},e,{layer:C}):e,r=h.createExecContext(t,P,f);s=h.executeFunction(T,r)}else t&&(s=t[i],o?(s=`${d.processNullValue(s)}${a}${d.processNullValue(t[o])}`,n&&(s=`${s}${a}${d.processNullValue(t[n])}`)):"string"==typeof s&&r&&(b?s=s?new Date(s).getTime():null:g&&(s=s?m(s):null)));if(v&&"number"==typeof s&&isFinite(s)){const e=t&&parseFloat(t[S]);s=d.getNormalizedValue(s,v,e,x)}w.push(s)}),w},e.getRangeExpr=function(e,t,r){const i=null!=t?e+" >= "+t:"",o=null!=r?e+" <= "+r:"";let s="";return s=i&&o?y(i,o):i||o,s?"("+s+")":""},e.getSQLFilterForNormalization=function(e){const t=e.field,r=e.normalizationType,i=e.normalizationField;let o;return"field"===r?o="(NOT "+i+" = 0)":"log"!==r&&"natural-log"!==r&&"square-root"!==r||(o=`(${t} > 0)`),o},e.getSumOfAttributesExpr=function(e,t,r){const i=[],o=[],s=[],n=[],a=[];e.forEach((e,t)=>{const l=e.field?"field":"expression",c=e.field||e.valueExpression;e.field?(a.push(c),o.push(`var ${l}${t} = Number($feature["${c}"]);`)):(i.push(`function getValueForExpr${t}() {\n  ${c} \n}`),o.push(`var ${l}${t} = Number(getValueForExpr${t}());`)),r||s.push(`${l}${t} = IIf(${l}${t} < 0, 0, ${l}${t});`),n.push(`${l}${t}`)});const l=i.length?null:a.reduce((e,t)=>`${e} + ${t}`);let c=null;return t||r?t?r||l&&(c=`(( ${l} ) >= 0)`):l&&(c=`(( ${l} ) <> 0)`):l&&(c=`(( ${l} ) > 0)`),{valueExpression:[i.length?i.join("\n"):"",o.join("\n"),s.join("\n"),`var total = ${n.join(" + ")};`,"return total;"].filter(Boolean).join("\n\n"),sqlExpression:l,sqlWhere:c}},e.mergeWhereClauses=y,e.quantizeFeatures=function(e,t,r,i){const s=a.isWrappable(r)?a.getInfo(r):null,l=s?Math.round((s.valid[1]-s.valid[0])/t.scale[0]):null;return e.map(e=>{const r=new o(e.geometry);return n.quantizePoint(t,r,r),e.geometry=s?function(e,t,r){return e.x<0?e.x+=t:e.x>r&&(e.x-=t),e}(r,l??0,i[0]):r,e})},e.timeOnlyToMilliseconds=m,e.verifyBasicFieldValidity=function(e,r,i){const o=function(e){const t=e.layer;return e.fields.filter(e=>!t.getField(e))}({layer:e,fields:r});if(o.length)return new t(i,"Unknown fields: "+o.join(", ")+". You can only use fields defined in the layer schema");const s=function(e){const t=e.layer;return e.fields.filter(e=>{const r=t.getFieldUsageInfo(e);return!r||!r.supportsStatistics})}({layer:e,fields:r});return s.length?new t(i,"Unsupported fields: "+s.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0},e.verifyFieldType=function(e,r,i,o){let s;return r?r.name!==e.objectIdField&&o.includes(r.type)||(s=new t(i,"'field' should be one of these types: "+o.join(","))):s=new t(i,"'field' is not defined in the layer schema"),s},e.verifyFilterValidity=function(e,r){if(e&&"intersects"!==e.spatialRelationship)return new t(r,"Only 'intersects' spatialRelationship is supported for featureFilter")},e.verifyNumericField=function(e,r,i){let o;return r?r.name!==e.objectIdField&&l.isNumericField(r)||(o=new t(i,"'field' should be one of these numeric types: "+l.numericTypes.join(","))):o=new t(i,"'field' is not defined in the layer schema"),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/screenUtils":function(){define(["exports"],function(e){"use strict";const t=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function r(e){return e?72*e/96:0}function i(e=0,t=0){return{x:e,y:t}}e.castRenderScreenPointArray=function(e){return e},e.castRenderScreenPointArray3=function(e){return e},e.castScreenPointArray=function(e){return e},e.cloneScreenPoint=function(e){return e?i(e.x,e.y):null},e.createRenderScreenPoint=function(e=0,t=0){return{x:e,y:t}},e.createRenderScreenPointArray=function(e=0,t=0){return[e,t]},e.createRenderScreenPointArray3=function(e=0,t=0,r=0){return[e,t,r]},e.createScreenPoint=i,e.createScreenPointArray=function(e=0,t=0){return[e,t]},e.pt2px=function(e){return e?e/72*96:0},e.px2pt=r,e.screenPointArrayToObject=function(e,t){return t?(t.x=e[0],t.y=e[1],t):{x:e[0],y:e[1]}},e.screenPointObjectToArray=function(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]},e.toPt=function(e){if("string"==typeof e){const i=e.match(t);if(i){const t=Number(i[1]),o=i[3]&&i[3].toLowerCase(),s=e.startsWith("-"),n="px"===o?r(t):t;return s?-n:n}return console.warn("screenUtils.toPt: input not recognized!"),null}return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64"],function(e,t,r,i,o){"use strict";function s(e,r,o,s){let{color:n,ratio:a}=r,{color:l,ratio:c}=o;if(c===a){const e=1e-6;1===c?a-=e:c+=e}const u=t.clamp((s-a)/(c-a),0,1);i.lerp(e,n.toArray(),l.toArray(),u)}e.createValueFunction=function(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1},e.evaluateDensityKernel=function(e,t,r){const i=Math.sqrt(e**2+t**2)/r;return i>1?0:3/(Math.PI*r**2)*(1-i**2)**2},e.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(e){return r.px2pt(2.4*e)},e.generateGradient=function(e){const t=new Uint8ClampedArray(2048);if((e=e.filter(({ratio:e})=>e>=0&&e<=1).sort((e,t)=>e.ratio-t.ratio).map(({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)}))).length<1)return t;let r=e[0],i=e[0],n=1;const a=o.create();for(let o=0;o<512;o++){const l=(o+.5)/512;for(;l>i.ratio&&n<e.length;)r=i,i=e[n++];s(a,r,i,l),t.set(a,4*o)}return t},e.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(e){return r.pt2px(e)/2.4},e.magicKernelDensityRadiusInflationFactor=2.4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define(["exports","../../intl/date","../../layers/support/fieldUtils","../../support/basemapUtils","../../support/loadArcade","../../time/constants","../../time/timeZoneUtils"],function(e,t,r,i,o,s,n){"use strict";const a={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},c=new Set(["integer","small-integer"]);let u=null;function d(e){return String(e).padStart(2,"0")}function p(e,t,r){let i;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),i=`TIMESTAMP'${r?e.getFullYear():e.getUTCFullYear()}-${d((r?e.getMonth():e.getUTCMonth())+1)}-${d(r?e.getDate():e.getUTCDate())} ${d(r?e.getHours():e.getUTCHours())}:${d(r?e.getMinutes():e.getUTCMinutes())}:${d(r?e.getSeconds():e.getUTCSeconds())}'`):i=e,i}function h(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const i=e.getField(t);if("<now>"===t.toLowerCase())return;if(r.isDateField(i))return"field"}}e.castIntegerFieldToFloat=function(e){return`cast(${e} as float)`},e.dateTypes=["date","date-only","timestamp-offset"],e.defaultBasemapGroups=a,e.defaultStatisticTypes={exclude:["median"]},e.fieldDelimiter=",",e.formatAnyDate=function(e,r){const{format:i,timeZoneOptions:o,fieldType:a}=r??{};let l,c;if(o&&({timeZone:l,timeZoneName:c}=n.getTimeZoneFormattingOptions(o.layerTimeZone,o.datesInUnknownTimezone,o.viewTimeZone,t.convertDateFormatToIntlOptions(i||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const r=t.convertDateFormatToIntlOptions(i||"short-date");return"string"==typeof e?t.formatDateOnly(e,{...r}):t.formatDate(e,{...r,timeZone:s.utc})}case"time-only":{const r=t.convertDateFormatToIntlOptions(i||"short-time");return"string"==typeof e?t.formatTimeOnly(e,r):t.formatDate(e,{...r,timeZone:s.utc})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const r=i||o?t.convertDateFormatToIntlOptions(i||"short-date-short-time"):void 0,s=r?{...r,timeZone:l,timeZoneName:c}:void 0;return"string"==typeof e?t.formatTimestamp(e,s):t.formatDate(e,s)}default:{const r=i||o?t.convertDateFormatToIntlOptions(i||"short-date-short-time"):void 0;return t.formatDate("string"==typeof e?new Date(e):e,r?{...r,timeZone:l,timeZoneName:c}:void 0)}}},e.getBasemapGroup=function(e,t=a){for(const r in t)if(t[r].includes(e))return r},e.getBasemapId=function(e,t,r=!0){let o=null;return e&&("string"==typeof e?t.includes(e)&&(o=e):o=i.getWellKnownBasemapId(e)),r?o||"gray":o},e.getDateDiffSQL=function(e,t,r,i){const{hasQueryEngine:o}=e,s=`(${p(r,h(e,r),o)} - ${p(t,h(e,t),o)})`;let n=l[i],a="/";return n<1&&(n=1/n,a="*"),{sqlExpression:1===n?s:`(${s} ${a} ${n})`,sqlWhere:null}},e.getDateType=h,e.getFieldsList=async function(e){const{field:t,field2:r,field3:i,normalizationField:s,valueExpression:n}=e;let a=[];if(n){if(!u){const{arcadeUtils:e}=await o.loadArcade();u=e}a=u.extractFieldNames(n)}return t&&a.push(t),r&&a.push(r),i&&a.push(i),s&&a.push(s),a},e.getNormalizationType=function(e){let t=e.normalizationType;return t||(e.normalizationField?t="field":null!=e.normalizationTotal&&(t="percent-of-total")),t??void 0},e.isAnyDateField=function(e){return r.isDateField(e)||r.isDateOnlyField(e)||r.isTimestampOffsetField(e)},e.isIntegerField=function(e,t){const r=t&&e.getField(t);return!!r&&c.has(r.type)},e.unitValueInDays=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapUtils":function(){define(["exports","../core/Collection","../core/maybe","../core/urlUtils","../layers/effects/utils","./basemapDefinitions"],function(e,t,r,i,o,s){"use strict";let n;function a(e){if(n)return n(e);let t=null;const r=d(e),i=!r?.baseLayers.length;for(const e in s.esriBasemapDefinitions){const o=g(r,m(s.esriBasemapDefinitions[e]),{mustMatchReferences:i});if("equal"===o){t=e;break}"base-layers-equal"===o&&(t=e)}return t}function l(e){if(u(e.url))return!0;if("vector-tile"===e.type)for(const t in e.sourceNameToSource){const r=e.sourceNameToSource[t];if(u(r?.sourceUrl))return!0}return!1}const c=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function u(e){if(!e)return!1;const t=new i.Url(i.makeAbsolute(e));return!!t.authority&&c.test(t.authority)}function d(e){return e?!e.loaded&&e.resourceInfo?m(e.resourceInfo.data):{baseLayers:p(e.baseLayers),referenceLayers:p(e.referenceLayers)}:null}function p(e){return(t.isCollection(e)?e.toArray():e).map(h)}function h(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:v("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers?void 0:e.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function f(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function m(e){return e?{baseLayers:y((e.baseMapLayers??[]).filter(e=>!f(e))),referenceLayers:y((e.baseMapLayers??[]).filter(e=>f(e)))}:null}function y(e){return e.map(e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:v(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e))}function g(e,t,r){return null!=e!=(null!=t)?"not-equal":e&&t?b(e.baseLayers,t.baseLayers)?b(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function b(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!_(e[r],t[r]))return!1;return!0}function _(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(!o.effectEquals(e.effect,t.effect))return!1;if(null!=e.activeLayerId||null!=t.activeLayerId)return e.activeLayerId===t.activeLayerId;if(null!=e.sublayers||null!=t.sublayers){if(null==e.sublayers||null==t.sublayers||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const i=e.sublayers.at(r),o=t.sublayers.at(r);if(i?.id!==o?.id||i?.visible!==o?.visible)return!1}}return!0}function v(e){return e?i.normalize(e).replace(/^\s*https?:/i,"").toLowerCase():""}function S(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}e.contentEquals=function(e,t){return e===t||null!=e?.portalItem?.id&&e.portalItem.id===t?.portalItem?.id||"equal"===g(d(e),d(t),{mustMatchReferences:!0})},e.findSpatialReference=function(e,t){if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};const r=t.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const i=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),o=e.spatialReference;return o?{spatialReference:i.find(e=>o.equals(e))??i[0]??null,updating:!1}:{spatialReference:i[0],updating:!1}},e.getBasemapThumbnailUrl=function(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const i=a(e);return i?s.esriBasemapDefinitions[i].thumbnailUrl:r.mappedFind(e.baseLayers,S)},e.getWellKnownBasemapId=a,e.hasDeveloperBasemapLayer=function(e){return!!e?.baseLayers.concat(e.referenceLayers).some(l)},e.isBasemap3D=function(e){return"Web Scene"===e.portalItem?.type||e.referenceLayers.some(e=>"scene"===e.type)},e.isBasemapInBeta=function(e){return!!e?.portalItem?.tags?.some(e=>"beta"===e.toLowerCase())},e.isBasemapLayerView=function(e,t){const r=e.allLayerViews.find(e=>e.uid===t);return r?.layer.parent===e.map?.basemap},e.isDeveloperBasemapLayer=l,e.layerDefinitionEquals=_,e.layerToDefinition=h,e.overrideGetWellKnownBasemapId=function(e){n=e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/Collection":function(){define(["../chunks/tslib.es6","./ArrayPool","./Evented","./handleUtils","./lang","./ObjectPool","./scheduling","./accessorSupport/ensureType","./accessorSupport/tracking","./accessorSupport/decorators/property","./accessorSupport/decorators/shared","./accessorSupport/decorators/subclass","./accessorSupport/tracking/SimpleObservable","./support/jsonUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";var f;class m{constructor(e,t,r,i,o){this.target=e,this.added=t,this.removed=r,this.start=i,this.deleteCount=o}}const y=new s(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1});function g(e){e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy&&e.destroy()}function b(e){return e?e instanceof I?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function _(e){if(e?.length)return e[0]}function v(e,t,r,i){const o=Math.min(e.length-r,t.length-i);let s=0;for(;s<o&&e[r+s]===t[i+s];)s++;return s}function S(e,t,r,i){t&&t.forEach((t,o,s)=>{e.push(t),S(e,r.call(i,t,o,s),r,i)})}const x=new Set,w=new Set,M=new Set,T=new Map;let P=0,I=class extends r.EventedAccessor{static{f=this}static{this.ofType=t=>{if(!t)return f;if(T.has(t))return T.get(t);let r=null;if("function"==typeof t)r=t.prototype.declaredClass;else if(t.base)r=t.base.prototype.declaredClass;else for(const e in t.typeMap){const i=t.typeMap[e].prototype.declaredClass;r?r+=` | ${i}`:r=i}let i=class extends f{};return e.__decorate([u.shared({Type:t,ensureType:"function"==typeof t?a.ensureType(t):a.ensureOneOfType(t)})],i.prototype,"itemType",void 0),i=e.__decorate([d.subclass(`esri.core.Collection<${r}>`)],i),T.set(t,i),i}}static isCollection(e){return null!=e&&e instanceof f}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new p.SimpleObservable,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:P++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof f?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),super.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return l.trackAccess(this._observable),this._items}set items(e){this._emitBeforeChanges(1)||(this._splice(0,this.length,b(e)),this._emitAfterChanges(1))}hasEventListener(e){return!this.destroyed&&("change"===e?this._chgListeners.length>0:super.hasEventListener(e))}on(e,t){if(this.destroyed)return i.makeHandle();if("change"===e){const e=this._chgListeners,r={removed:!1,callback:t};return e.push(r),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),i.makeHandle(()=>{r.removed=!0,e.splice(e.indexOf(r),1)})}return super.on(e,t)}once(e,t){const r="deref"in t?()=>t.deref():()=>t,i=this.on(e,e=>{r()?.call(null,e),i.remove()});return i}add(e,t){if(l.trackAccess(this._observable),this._emitBeforeChanges(1))return this;const r=this.getNextIndex(t??null);return this._splice(r,0,[e]),this._emitAfterChanges(1),this}addMany(e,t=this._items.length){if(l.trackAccess(this._observable),!e?.length)return this;if(this._emitBeforeChanges(1))return this;const r=this.getNextIndex(t);return this._splice(r,0,b(e)),this._emitAfterChanges(1),this}at(e){if(l.trackAccess(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return[];const e=this._removeAllRaw();return this._emitAfterChanges(2),e}_removeAllRaw(){return 0===this.length?[]:this._splice(0,this.length)||[]}clone(){return l.trackAccess(this._observable),this._createNewInstance({items:this._items.map(o.clone)})}concat(...e){l.trackAccess(this._observable);const t=e.map(b);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const r=this._splice(0,this.length),i=r.length;for(let o=0;o<i;o++)e.call(t,r[o],o,r);this._emitAfterChanges(2)}destroyAll(){this.drain(g)}destroyMany(e){const t=this.removeMany(e);return t.forEach(g),t}every(e,t){return l.trackAccess(this._observable),this._items.every(e,t)}filter(e,t){l.trackAccess(this._observable);const r=2===arguments.length?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:r})}find(e,t){return l.trackAccess(this._observable),this._items.find(e,t)}findIndex(e,t){return l.trackAccess(this._observable),this._items.findIndex(e,t)}flatten(e,t){l.trackAccess(this._observable);const r=[];return S(r,this,e,t),new f(r)}forEach(e,t){return l.trackAccess(this._observable),this._items.forEach(e,t)}getItemAt(e){return l.trackAccess(this._observable),this._items[e]}getNextIndex(e){l.trackAccess(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return l.trackAccess(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return l.trackAccess(this._observable),this._items.indexOf(e,t)}join(e=","){return l.trackAccess(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return l.trackAccess(this._observable),this._items.lastIndexOf(e,t)}map(e,t){l.trackAccess(this._observable);const r=this._items.map(e,t);return new f({items:r})}reorder(e,t=this.length-1){l.trackAccess(this._observable);const r=this.indexOf(e);if(-1!==r){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(4))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(4)}return e}}pop(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=_(this._splice(this.length-1,1));return this._emitAfterChanges(2),e}push(...e){return l.trackAccess(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,e),this._emitAfterChanges(1)),this.length}reduce(e,t){l.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){l.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return l.trackAccess(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(l.trackAccess(this._observable),e<0||e>=this.length||this._emitBeforeChanges(2))return;const t=_(this._splice(e,1));return this._emitAfterChanges(2),t}removeMany(e){if(l.trackAccess(this._observable),!e?.length||this._emitBeforeChanges(2))return[];const t=e instanceof f?e.toArray():e,r=this._items,i=[],o=t.length;for(let e=0;e<o;e++){const o=t[e],s=r.indexOf(o);if(s>-1){const o=1+v(t,r,e+1,s+1),n=this._splice(s,o);n&&n.length>0&&i.push.apply(i,n),e+=o-1}}return this._emitAfterChanges(2),i}reverse(){if(l.trackAccess(this._observable),this._emitBeforeChanges(4))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(4),this}shift(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=_(this._splice(0,1));return this._emitAfterChanges(2),e}slice(e=0,t=this.length){return l.trackAccess(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return l.trackAccess(this._observable),this._items.some(e,t)}sort(e){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(4)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(4),this}_requiresSort(e=(e,t)=>e===t?0:e<t?-1:1){const t=this.length-1;for(let r=0;r<t;r++)if(e(this.items[r],this.items[r+1])>0)return!0;return!1}splice(e,t,...r){l.trackAccess(this._observable),1===arguments.length&&(t=this.length),t??=0;const i=(t?2:0)|(r.length?1:0);if(this._emitBeforeChanges(i))return[];const o=this._splice(e,t,r)||[];return this._emitAfterChanges(i),o}toArray(){return l.trackAccess(this._observable),this._items.slice()}toJSON(e){return l.trackAccess(this._observable),this.toArray().map(t=>h.isSerializable(t)?t.toJSON(e):t)}toLocaleString(){return l.trackAccess(this._observable),this._items.toLocaleString()}toString(){return l.trackAccess(this._observable),this._items.toString()}unshift(...e){return l.trackAccess(this._observable),!e.length||this._emitBeforeChanges(1)||(this._splice(0,0,e),this._emitAfterChanges(1)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const i=this._items,o=this.itemType;let s,a;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=n.schedule(()=>this._dispatchChange())),e<0&&(e+=this.length),t){if(a=i.splice(e,t),this.hasEventListener("before-remove")){const t=y.acquire();t.target=this,t.cancellable=!0;for(let r=0,o=a.length;r<o;r++)s=a[r],t.reset(s),this.emit("before-remove",t),t.defaultPrevented&&(a.splice(r,1),i.splice(e,0,s),e+=1,r-=1,o-=1);y.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=y.acquire();e.target=this,e.cancellable=!1;const t=a.length;for(let r=0;r<t;r++)e.reset(a[r]),this.emit("after-remove",e);y.release(e)}}if(r?.length){if(o){const e=[];for(const t of r){const r=o.ensureType(t);null==r&&null!=t||e.push(r)}r=e}const t=this.hasEventListener("before-add"),s=this.hasEventListener("after-add"),n=e===this.length;if(t||s){const o=y.acquire();o.target=this,o.cancellable=!0;const a=y.acquire();a.target=this,a.cancellable=!1;for(const l of r)t?(o.reset(l),this.emit("before-add",o),o.defaultPrevented||(n?i.push(l):i.splice(e++,0,l),this._set("length",i.length),s&&(a.reset(l),this.emit("after-add",a)))):(n?i.push(l):i.splice(e++,0,l),this._set("length",i.length),a.reset(l),this.emit("after-add",a));y.release(a),y.release(o)}else{if(n)for(const e of r)i.push(e);else i.splice(e,0,...r);this._set("length",i.length)}}if((r?.length||a?.length)&&this._notifyChangeEvent(r,a),this.hasEventListener("after-splice")){const i=new m(this,r,a,e,t);this.emit("after-splice",i)}return a}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=y.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,y.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=y.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),y.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const r of e){const e=r.changes;x.clear(),w.clear(),M.clear();for(const{added:t,removed:r}of e){if(t)if(0===M.size&&0===w.size)for(const e of t)x.add(e);else for(const e of t)w.has(e)?(M.add(e),w.delete(e)):M.has(e)||x.add(e);if(r)if(0===M.size&&0===x.size)for(const e of r)w.add(e);else for(const e of r)x.has(e)?x.delete(e):(M.delete(e),w.add(e))}const i=t.acquire();x.forEach(e=>{i.push(e)});const o=t.acquire();w.forEach(e=>{o.push(e)});const s=this._items,n=r.items,a=t.acquire();if(M.forEach(e=>{n.indexOf(e)!==s.indexOf(e)&&a.push(e)}),r.listeners&&(i.length||o.length||a.length)){const e={target:this,added:i,removed:o,moved:a},t=r.listeners.length;for(let i=0;i<t;i++){const t=r.listeners[i];t.removed||t.callback.call(this,e)}}t.release(i),t.release(o),t.release(a)}x.clear(),w.clear(),M.clear()}};return e.__decorate([c.property()],I.prototype,"_updating",void 0),e.__decorate([c.property()],I.prototype,"length",void 0),e.__decorate([c.property()],I.prototype,"items",null),e.__decorate([c.property({readOnly:!0})],I.prototype,"updating",null),I=f=e.__decorate([d.subclass("esri.core.Collection")],I),I})},"esri/core/accessorSupport/decorators/shared":function(){define(["exports"],function(e){"use strict";e.shared=function(e){return(t,r)=>{t[r]=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/utils":function(){define(["exports","./effects"],function(e,t){"use strict";e.canInterpolateEffects=function(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every((e,t)=>e.type===r[t].type)},e.effectEquals=function(e,t){return JSON.stringify(e??null)===JSON.stringify(t??null)},e.isEffectFunctions=function(e){const t=e[0];return!!t&&"type"in t},e.normalizeEffects=function(e,r){const i=e.length>r.length?e:r,o=e.length>r.length?r:e;for(let e=o.length;e<i.length;e++)o.push(t.createEffectWithInitialValues(i[e]))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/effects":function(){define(["exports","../../colorUtils","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/mat4f32","./colorMatrixFunctions"],function(e,t,r,i,o){"use strict";class s{constructor(e,t,r){this.strength=e,this.radius=t,this.threshold=r,this.type="bloom"}interpolate(e,t,r){this.strength=d(e.strength,t.strength,r),this.radius=d(e.radius,t.radius,r),this.threshold=d(e.threshold,t.threshold,r)}clone(){return new s(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:p(this.radius),strength:this.strength,threshold:this.threshold}}}class n{constructor(e){this.radius=e,this.type="blur"}interpolate(e,t,r){this.radius=Math.round(d(e.radius,t.radius,r))}clone(){return new n(this.radius)}toJSON(){return{type:"blur",radius:p(this.radius)}}}class a{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.amount=d(e.amount,t.amount,r),this._updateMatrix()}clone(){return new a(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||i.create();switch(this.type){case"brightness":this._colorMatrix=o.brightness(e,this.amount);break;case"contrast":this._colorMatrix=o.contrast(e,this.amount);break;case"grayscale":this._colorMatrix=o.grayscale(e,this.amount);break;case"invert":this._colorMatrix=o.invert(e,this.amount);break;case"saturate":this._colorMatrix=o.saturate(e,this.amount);break;case"sepia":this._colorMatrix=o.sepia(e,this.amount)}}}class l{constructor(e,t,r,i){this.offsetX=e,this.offsetY=t,this.blurRadius=r,this.color=i,this.type="drop-shadow"}interpolate(e,t,r){this.offsetX=d(e.offsetX,t.offsetX,r),this.offsetY=d(e.offsetY,t.offsetY,r),this.blurRadius=d(e.blurRadius,t.blurRadius,r),this.color[0]=Math.round(d(e.color[0],t.color[0],r)),this.color[1]=Math.round(d(e.color[1],t.color[1],r)),this.color[2]=Math.round(d(e.color[2],t.color[2],r)),this.color[3]=d(e.color[3],t.color[3],r)}clone(){return new l(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:p(this.offsetX),yoffset:p(this.offsetY),blurRadius:p(this.blurRadius),color:e}}}class c{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.angle=d(e.angle,t.angle,r),this._updateMatrix()}clone(){return new c(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||i.create();this._colorMatrix=o.rotateHue(e,this.angle)}}class u{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,r){this.amount=d(e.amount,t.amount,r)}clone(){return new u(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function d(e,t,r){return e+(t-e)*r}function p(e){return Math.round(1e3*r.px2pt(e))/1e3}e.BloomEffect=s,e.BlurEffect=n,e.ColorMatrixEffect=a,e.DropShadowEffect=l,e.HueRotateEffect=c,e.OpacityEffect=u,e.createEffectWithInitialValues=function(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new a(e.type,0);case"saturate":case"brightness":case"contrast":return new a(e.type,1);case"opacity":return new u(1);case"hue-rotate":return new c(0);case"blur":return new n(0);case"drop-shadow":return new l(0,0,0,[...t.getNamedColor("transparent")]);case"bloom":return new s(0,0,1)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["exports"],function(e){"use strict";function t(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function r(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function i(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){const y=new Float32Array(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=i,y[4]=o,y[5]=s,y[6]=n,y[7]=a,y[8]=l,y[9]=c,y[10]=u,y[11]=d,y[12]=p,y[13]=h,y[14]=f,y[15]=m,y}const o=t(),s=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:i},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=i,e.mat4f32=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/colorMatrixFunctions":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(e,t){"use strict";e.brightness=(e,r)=>{const i=t.set(e,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return t.transpose(i,i)},e.contrast=(e,r)=>{const i=t.set(e,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return t.transpose(i,i)},e.grayscale=(e,r)=>{const i=1-r,o=t.set(e,.2126+.7874*i,.7152-.7152*i,.0722-.0722*i,0,.2126-.2126*i,.7152+.2848*i,.0722-.0722*i,0,.2126-.2126*i,.7152-.7152*i,.0722+.9278*i,0,0,0,0,1);return t.transpose(o,o)},e.invert=(e,r)=>{const i=1-2*r,o=r,s=t.set(e,i,0,0,o,0,i,0,o,0,0,i,o,0,0,0,1);return t.transpose(s,s)},e.rotateHue=(e,r)=>{const i=Math.sin(r*Math.PI/180),o=Math.cos(r*Math.PI/180),s=t.set(e,.213+.787*o-.213*i,.715-.715*o-.715*i,.072-.072*o+.928*i,0,.213-.213*o+.143*i,.715+.285*o+.14*i,.072-.072*o-.283*i,0,.213-.213*o-.787*i,.715-.715*o+.715*i,.072+.928*o+.072*i,0,0,0,0,1);return t.transpose(s,s)},e.saturate=(e,r)=>{const i=r,o=t.set(e,.213+.787*i,.715-.715*i,.072-.072*i,0,.213-.213*i,.715+.285*i,.072-.072*i,0,.213-.213*i,.715-.715*i,.072+.928*i,0,0,0,0,1);return t.transpose(o,o)},e.sepia=(e,r)=>{const i=1-r,o=t.set(e,.393+.607*i,.769-.769*i,.189-.189*i,0,.349-.349*i,.686+.314*i,.168-.168*i,0,.272-.272*i,.534-.534*i,.131+.869*i,0,0,0,0,1);return t.transpose(o,o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["exports","../factories/vec3f64","./common"],function(e,t,r){"use strict";function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e[4]=s,e[5]=n,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=d,e[11]=p,e[12]=h,e[13]=f,e[14]=m,e[15]=y,e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function n(e,t){if(e===t){const r=t[1],i=t[2],o=t[3],s=t[6],n=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=s,e[11]=t[14],e[12]=o,e[13]=n,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function a(e,t){return l(e,t)||s(e),e}function l(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],h=t[11],f=t[12],m=t[13],y=t[14],g=t[15],b=r*a-i*n,_=r*l-o*n,v=r*c-s*n,S=i*l-o*a,x=i*c-s*a,w=o*c-s*l,M=u*m-d*f,T=u*y-p*f,P=u*g-h*f,I=d*y-p*m,C=d*g-h*m,O=p*g-h*y;let F=b*O-_*C+v*I+S*P-x*T+w*M;return F?(F=1/F,e[0]=(a*O-l*C+c*I)*F,e[1]=(o*C-i*O-s*I)*F,e[2]=(m*w-y*x+g*S)*F,e[3]=(p*x-d*w-h*S)*F,e[4]=(l*P-n*O-c*T)*F,e[5]=(r*O-o*P+s*T)*F,e[6]=(y*v-f*w-g*_)*F,e[7]=(u*w-p*v+h*_)*F,e[8]=(n*C-a*P+c*M)*F,e[9]=(i*P-r*C-s*M)*F,e[10]=(f*x-m*v+g*b)*F,e[11]=(d*v-u*x-h*b)*F,e[12]=(a*T-n*I-l*M)*F,e[13]=(r*I-i*T+o*M)*F,e[14]=(m*_-f*S-y*b)*F,e[15]=(u*S-d*_+p*b)*F,e):null}function c(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],h=t[11],f=t[12],m=t[13],y=t[14],g=t[15];return e[0]=a*(p*g-h*y)-d*(l*g-c*y)+m*(l*h-c*p),e[1]=-(i*(p*g-h*y)-d*(o*g-s*y)+m*(o*h-s*p)),e[2]=i*(l*g-c*y)-a*(o*g-s*y)+m*(o*c-s*l),e[3]=-(i*(l*h-c*p)-a*(o*h-s*p)+d*(o*c-s*l)),e[4]=-(n*(p*g-h*y)-u*(l*g-c*y)+f*(l*h-c*p)),e[5]=r*(p*g-h*y)-u*(o*g-s*y)+f*(o*h-s*p),e[6]=-(r*(l*g-c*y)-n*(o*g-s*y)+f*(o*c-s*l)),e[7]=r*(l*h-c*p)-n*(o*h-s*p)+u*(o*c-s*l),e[8]=n*(d*g-h*m)-u*(a*g-c*m)+f*(a*h-c*d),e[9]=-(r*(d*g-h*m)-u*(i*g-s*m)+f*(i*h-s*d)),e[10]=r*(a*g-c*m)-n*(i*g-s*m)+f*(i*c-s*a),e[11]=-(r*(a*h-c*d)-n*(i*h-s*d)+u*(i*c-s*a)),e[12]=-(n*(d*y-p*m)-u*(a*y-l*m)+f*(a*p-l*d)),e[13]=r*(d*y-p*m)-u*(i*y-o*m)+f*(i*p-o*d),e[14]=-(r*(a*y-l*m)-n*(i*y-o*m)+f*(i*l-o*a)),e[15]=r*(a*p-l*d)-n*(i*p-o*d)+u*(i*l-o*a),e}function u(e){const t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],n=e[5],a=e[6],l=e[7],c=e[8],u=e[9],d=e[10],p=e[11],h=e[12],f=e[13],m=e[14],y=e[15];return(t*n-r*s)*(d*y-p*m)-(t*a-i*s)*(u*y-p*f)+(t*l-o*s)*(u*m-d*f)+(r*a-i*n)*(c*y-p*h)-(r*l-o*n)*(c*m-d*h)+(i*l-o*a)*(c*f-u*h)}function d(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=t[9],h=t[10],f=t[11],m=t[12],y=t[13],g=t[14],b=t[15];let _=r[0],v=r[1],S=r[2],x=r[3];return e[0]=_*i+v*a+S*d+x*m,e[1]=_*o+v*l+S*p+x*y,e[2]=_*s+v*c+S*h+x*g,e[3]=_*n+v*u+S*f+x*b,_=r[4],v=r[5],S=r[6],x=r[7],e[4]=_*i+v*a+S*d+x*m,e[5]=_*o+v*l+S*p+x*y,e[6]=_*s+v*c+S*h+x*g,e[7]=_*n+v*u+S*f+x*b,_=r[8],v=r[9],S=r[10],x=r[11],e[8]=_*i+v*a+S*d+x*m,e[9]=_*o+v*l+S*p+x*y,e[10]=_*s+v*c+S*h+x*g,e[11]=_*n+v*u+S*f+x*b,_=r[12],v=r[13],S=r[14],x=r[15],e[12]=_*i+v*a+S*d+x*m,e[13]=_*o+v*l+S*p+x*y,e[14]=_*s+v*c+S*h+x*g,e[15]=_*n+v*u+S*f+x*b,e}function p(e,t,r){const i=r[0],o=r[1],s=r[2];if(t===e)e[12]=t[0]*i+t[4]*o+t[8]*s+t[12],e[13]=t[1]*i+t[5]*o+t[9]*s+t[13],e[14]=t[2]*i+t[6]*o+t[10]*s+t[14],e[15]=t[3]*i+t[7]*o+t[11]*s+t[15];else{const r=t[0],n=t[1],a=t[2],l=t[3],c=t[4],u=t[5],d=t[6],p=t[7],h=t[8],f=t[9],m=t[10],y=t[11];e[0]=r,e[1]=n,e[2]=a,e[3]=l,e[4]=c,e[5]=u,e[6]=d,e[7]=p,e[8]=h,e[9]=f,e[10]=m,e[11]=y,e[12]=r*i+c*o+h*s+t[12],e[13]=n*i+u*o+f*s+t[13],e[14]=a*i+d*o+m*s+t[14],e[15]=l*i+p*o+y*s+t[15]}return e}function h(e,t,r){const i=r[0],o=r[1],s=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,o,s){let n=s[0],a=s[1],l=s[2],c=Math.sqrt(n*n+a*a+l*l);if(c<=r.getEpsilon())return void i(e,t);c=1/c,n*=c,a*=c,l*=c;const u=Math.sin(o),d=Math.cos(o),p=1-d,h=t[0],f=t[1],m=t[2],y=t[3],g=t[4],b=t[5],_=t[6],v=t[7],S=t[8],x=t[9],w=t[10],M=t[11],T=n*n*p+d,P=a*n*p+l*u,I=l*n*p-a*u,C=n*a*p-l*u,O=a*a*p+d,F=l*a*p+n*u,A=n*l*p+a*u,R=a*l*p-n*u,D=l*l*p+d;e[0]=h*T+g*P+S*I,e[1]=f*T+b*P+x*I,e[2]=m*T+_*P+w*I,e[3]=y*T+v*P+M*I,e[4]=h*C+g*O+S*F,e[5]=f*C+b*O+x*F,e[6]=m*C+_*O+w*F,e[7]=y*C+v*O+M*F,e[8]=h*A+g*R+S*D,e[9]=f*A+b*R+x*D,e[10]=m*A+_*R+w*D,e[11]=y*A+v*R+M*D,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}function m(e,t,r){const i=Math.sin(r),o=Math.cos(r),s=t[4],n=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],p=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*o+c*i,e[5]=n*o+u*i,e[6]=a*o+d*i,e[7]=l*o+p*i,e[8]=c*o-s*i,e[9]=u*o-n*i,e[10]=d*o-a*i,e[11]=p*o-l*i,e}function y(e,t,r){const i=Math.sin(r),o=Math.cos(r),s=t[0],n=t[1],a=t[2],l=t[3],c=t[8],u=t[9],d=t[10],p=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*o-c*i,e[1]=n*o-u*i,e[2]=a*o-d*i,e[3]=l*o-p*i,e[8]=s*i+c*o,e[9]=n*i+u*o,e[10]=a*i+d*o,e[11]=l*i+p*o,e}function g(e,t,r){const i=Math.sin(r),o=Math.cos(r),s=t[0],n=t[1],a=t[2],l=t[3],c=t[4],u=t[5],d=t[6],p=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*o+c*i,e[1]=n*o+u*i,e[2]=a*o+d*i,e[3]=l*o+p*i,e[4]=c*o-s*i,e[5]=u*o-n*i,e[6]=d*o-a*i,e[7]=p*o-l*i,e}function b(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function _(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t,i){if(0===t)return s(e);let o=i[0],n=i[1],a=i[2],l=Math.sqrt(o*o+n*n+a*a);if(l<=r.getEpsilon())return null;l=1/l,o*=l,n*=l,a*=l;const c=Math.sin(t),u=Math.cos(t),d=1-u;return e[0]=o*o*d+u,e[1]=n*o*d+a*c,e[2]=a*o*d-n*c,e[3]=0,e[4]=o*n*d-a*c,e[5]=n*n*d+u,e[6]=a*n*d+o*c,e[7]=0,e[8]=o*a*d+n*c,e[9]=n*a*d-o*c,e[10]=a*a*d+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function M(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=i+i,l=o+o,c=s+s,u=i*a,d=i*l,p=i*c,h=o*l,f=o*c,m=s*c,y=n*a,g=n*l,b=n*c;return e[0]=1-(h+m),e[1]=d+b,e[2]=p-g,e[3]=0,e[4]=d-b,e[5]=1-(u+m),e[6]=f+y,e[7]=0,e[8]=p+g,e[9]=f-y,e[10]=1-(u+h),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function T(e,t){const r=P,i=-t[0],o=-t[1],s=-t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=i*i+o*o+s*s+n*n;return d>0?(r[0]=2*(a*n+u*i+l*s-c*o)/d,r[1]=2*(l*n+u*o+c*i-a*s)/d,r[2]=2*(c*n+u*s+a*o-l*i)/d):(r[0]=2*(a*n+u*i+l*s-c*o),r[1]=2*(l*n+u*o+c*i-a*s),r[2]=2*(c*n+u*s+a*o-l*i)),M(e,t,r),e}const P=t.create();function I(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function C(e,t){const r=t[0],i=t[1],o=t[2],s=t[4],n=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+o*o),e[1]=Math.sqrt(s*s+n*n+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function O(e,t){const r=t[0]+t[5]+t[10];let i=0;return r>0?(i=2*Math.sqrt(r+1),e[3]=.25*i,e[0]=(t[6]-t[9])/i,e[1]=(t[8]-t[2])/i,e[2]=(t[1]-t[4])/i):t[0]>t[5]&&t[0]>t[10]?(i=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/i,e[0]=.25*i,e[1]=(t[1]+t[4])/i,e[2]=(t[8]+t[2])/i):t[5]>t[10]?(i=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/i,e[0]=(t[1]+t[4])/i,e[1]=.25*i,e[2]=(t[6]+t[9])/i):(i=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/i,e[0]=(t[8]+t[2])/i,e[1]=(t[6]+t[9])/i,e[2]=.25*i),e}function F(e,t,r,i){const o=t[0],s=t[1],n=t[2],a=t[3],l=o+o,c=s+s,u=n+n,d=o*l,p=o*c,h=o*u,f=s*c,m=s*u,y=n*u,g=a*l,b=a*c,_=a*u,v=i[0],S=i[1],x=i[2];return e[0]=(1-(f+y))*v,e[1]=(p+_)*v,e[2]=(h-b)*v,e[3]=0,e[4]=(p-_)*S,e[5]=(1-(d+y))*S,e[6]=(m+g)*S,e[7]=0,e[8]=(h+b)*x,e[9]=(m-g)*x,e[10]=(1-(d+f))*x,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function A(e,t,r,i,o){const s=t[0],n=t[1],a=t[2],l=t[3],c=s+s,u=n+n,d=a+a,p=s*c,h=s*u,f=s*d,m=n*u,y=n*d,g=a*d,b=l*c,_=l*u,v=l*d,S=i[0],x=i[1],w=i[2],M=o[0],T=o[1],P=o[2],I=(1-(m+g))*S,C=(h+v)*S,O=(f-_)*S,F=(h-v)*x,A=(1-(p+g))*x,R=(y+b)*x,D=(f+_)*w,E=(y-b)*w,V=(1-(p+m))*w;return e[0]=I,e[1]=C,e[2]=O,e[3]=0,e[4]=F,e[5]=A,e[6]=R,e[7]=0,e[8]=D,e[9]=E,e[10]=V,e[11]=0,e[12]=r[0]+M-(I*M+F*T+D*P),e[13]=r[1]+T-(C*M+A*T+E*P),e[14]=r[2]+P-(O*M+R*T+V*P),e[15]=1,e}function R(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=r+r,a=i+i,l=o+o,c=r*n,u=i*n,d=i*a,p=o*n,h=o*a,f=o*l,m=s*n,y=s*a,g=s*l;return e[0]=1-d-f,e[1]=u+g,e[2]=p-y,e[3]=0,e[4]=u-g,e[5]=1-c-f,e[6]=h+m,e[7]=0,e[8]=p+y,e[9]=h-m,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function D(e,t,r,i,o,s,n){const a=1/(r-t),l=1/(o-i),c=1/(s-n);return e[0]=2*s*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*s*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(o+i)*l,e[10]=(n+s)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=n*s*2*c,e[15]=0,e}function E(e,t,r,i,o){const s=1/Math.tan(t/2);let n;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=o&&o!==1/0?(n=1/(i-o),e[10]=(o+i)*n,e[14]=2*o*i*n):(e[10]=-1,e[14]=-2*i),e}function V(e,t,r,i){const o=Math.tan(t.upDegrees*Math.PI/180),s=Math.tan(t.downDegrees*Math.PI/180),n=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(n+a),c=2/(o+s);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(n-a)*l*.5,e[9]=(o-s)*c*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function L(e,t,r,i,o,s,n){const a=1/(t-r),l=1/(i-o),c=1/(s-n);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(o+i)*l,e[14]=(n+s)*c,e[15]=1,e}function z(e,t,i,o){const n=t[0],a=t[1],l=t[2];let c=n-i[0],u=a-i[1],d=l-i[2];const p=r.getEpsilon();if(Math.abs(c)<p&&Math.abs(u)<p&&Math.abs(d)<p)return void s(e);let h=1/Math.sqrt(c*c+u*u+d*d);c*=h,u*=h,d*=h;const f=o[0],m=o[1],y=o[2];let g=m*d-y*u,b=y*c-f*d,_=f*u-m*c;h=Math.sqrt(g*g+b*b+_*_),h?(h=1/h,g*=h,b*=h,_*=h):(g=0,b=0,_=0);let v=u*_-d*b,S=d*g-c*_,x=c*b-u*g;h=Math.sqrt(v*v+S*S+x*x),h?(h=1/h,v*=h,S*=h,x*=h):(v=0,S=0,x=0),e[0]=g,e[1]=v,e[2]=c,e[3]=0,e[4]=b,e[5]=S,e[6]=u,e[7]=0,e[8]=_,e[9]=x,e[10]=d,e[11]=0,e[12]=-(g*n+b*a+_*l),e[13]=-(v*n+S*a+x*l),e[14]=-(c*n+u*a+d*l),e[15]=1}function U(e,t,r,i){const o=t[0],s=t[1],n=t[2],a=i[0],l=i[1],c=i[2];let u=o-r[0],d=s-r[1],p=n-r[2],h=u*u+d*d+p*p;h>0&&(h=1/Math.sqrt(h),u*=h,d*=h,p*=h);let f=l*p-c*d,m=c*u-a*p,y=a*d-l*u;return h=f*f+m*m+y*y,h>0&&(h=1/Math.sqrt(h),f*=h,m*=h,y*=h),e[0]=f,e[1]=m,e[2]=y,e[3]=0,e[4]=d*y-p*m,e[5]=p*f-u*y,e[6]=u*m-d*f,e[7]=0,e[8]=u,e[9]=d,e[10]=p,e[11]=0,e[12]=o,e[13]=s,e[14]=n,e[15]=1,e}function j(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function B(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function N(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function k(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function q(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function G(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e[9]=t[9]+r[9]*i,e[10]=t[10]+r[10]*i,e[11]=t[11]+r[11]*i,e[12]=t[12]+r[12]*i,e[13]=t[13]+r[13]*i,e[14]=t[14]+r[14]*i,e[15]=t[15]+r[15]*i,e}function H(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function W(e,t){if(e===t)return!0;const i=e[0],o=e[1],s=e[2],n=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=e[9],h=e[10],f=e[11],m=e[12],y=e[13],g=e[14],b=e[15],_=t[0],v=t[1],S=t[2],x=t[3],w=t[4],M=t[5],T=t[6],P=t[7],I=t[8],C=t[9],O=t[10],F=t[11],A=t[12],R=t[13],D=t[14],E=t[15],V=r.getEpsilon();return Math.abs(i-_)<=V*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(o-v)<=V*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-S)<=V*Math.max(1,Math.abs(s),Math.abs(S))&&Math.abs(n-x)<=V*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(a-w)<=V*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-M)<=V*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-T)<=V*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(u-P)<=V*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(d-I)<=V*Math.max(1,Math.abs(d),Math.abs(I))&&Math.abs(p-C)<=V*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(h-O)<=V*Math.max(1,Math.abs(h),Math.abs(O))&&Math.abs(f-F)<=V*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(m-A)<=V*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(y-R)<=V*Math.max(1,Math.abs(y),Math.abs(R))&&Math.abs(g-D)<=V*Math.max(1,Math.abs(g),Math.abs(D))&&Math.abs(b-E)<=V*Math.max(1,Math.abs(b),Math.abs(E))}function $(e){const t=r.getEpsilon(),i=e[0],o=e[1],s=e[2],n=e[4],a=e[5],l=e[6],c=e[8],u=e[9],d=e[10];return Math.abs(1-(i*i+n*n+c*c))<=t&&Math.abs(1-(o*o+a*a+u*u))<=t&&Math.abs(1-(s*s+l*l+d*d))<=t}function J(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}const Y=d,Z=k,Q=Object.freeze(Object.defineProperty({__proto__:null,add:N,adjoint:c,copy:i,determinant:u,equals:W,exactEquals:H,frob:B,fromQuat:R,fromQuat2:T,fromRotation:v,fromRotationTranslation:M,fromRotationTranslationScale:F,fromRotationTranslationScaleOrigin:A,fromScaling:_,fromTranslation:b,fromXRotation:S,fromYRotation:x,fromZRotation:w,frustum:D,getRotation:O,getScale:C,getTranslation:I,hasIdentityRotation:J,identity:s,invert:l,invertOrIdentity:a,isOrthoNormal:$,lookAt:z,mul:Y,multiply:d,multiplyScalar:q,multiplyScalarAndAdd:G,ortho:L,perspective:E,perspectiveFromFieldOfView:V,rotate:f,rotateX:m,rotateY:y,rotateZ:g,scale:h,set:o,str:j,sub:Z,subtract:k,targetTo:U,translate:p,transpose:n},Symbol.toStringTag,{value:"Module"}));e.add=N,e.adjoint=c,e.copy=i,e.determinant=u,e.equals=W,e.exactEquals=H,e.frob=B,e.fromQuat=R,e.fromQuat2=T,e.fromRotation=v,e.fromRotationTranslation=M,e.fromRotationTranslationScale=F,e.fromRotationTranslationScaleOrigin=A,e.fromScaling=_,e.fromTranslation=b,e.fromXRotation=S,e.fromYRotation=x,e.fromZRotation=w,e.frustum=D,e.getRotation=O,e.getScale=C,e.getTranslation=I,e.hasIdentityRotation=J,e.identity=s,e.invert=l,e.invertOrIdentity=a,e.isOrthoNormal=$,e.lookAt=z,e.mat4=Q,e.mul=Y,e.multiply=d,e.multiplyScalar=q,e.multiplyScalarAndAdd=G,e.ortho=L,e.perspective=E,e.perspectiveFromFieldOfView=V,e.rotate=f,e.rotateX=m,e.rotateY=y,e.rotateZ=g,e.scale=h,e.set=o,e.str=j,e.sub=Z,e.subtract=k,e.targetTo=U,e.translate=p,e.transpose=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapDefinitions":function(){define(["exports","../assets","../intl/messages"],function(e,t,r){"use strict";const i={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}};e.esriBasemapDefinitions=i,e.getBasemapTitle=async function(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,i=await r.fetchMessageBundle("esri/t9n/basemaps");return i[e]||i[t]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl/messages":function(){define(["exports","../core/Error","../core/handleUtils","../core/promiseUtils","./locale"],function(e,t,r,i,o){"use strict";const s={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function n(e){if(function(e){return e in s}(e)){const t=s[e];return!0===t?e:t}return null}const a=[],l=new Map;function c(e){for(const t of l.keys())u(e.pattern,t)&&l.delete(t)}function u(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}o.beforeLocaleChange(()=>{l.clear()});const d=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=i.createResolver())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}},p={cache:l,loaders:a};e.fetchMessageBundle=async function(e){const r=o.getLocale();l.has(e)||l.set(e,async function(e,r){const i=[];for(const t of a)if(u(t.pattern,e))try{return await t.fetchMessageBundle(e,r)}catch(e){i.push(e)}if(i.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:i});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,r));const i=l.get(e);return i&&await d.add(i),i},e.messageBundlesLocaleMap=s,e.normalizeMessageBundleLocale=function(e){const t=o.getLocaleLanguage(e);return t?n(e)??n(t):null},e.registerMessageBundleLoader=function(e){return a.includes(e)||(c(e),a.unshift(e)),r.makeHandle(()=>{const t=a.indexOf(e);t>-1&&(a.splice(t,1),c(e))})},e.test=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(e,t,r){"use strict";const i=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,o=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),s=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),n=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function a(e){return null==e||"string"==typeof e&&!e?"<Null>":e}function l(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,i=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!i}function c(e){const{values:t,useSampleStdDev:r,supportsNullCount:i,outStatisticTypes:o}=e;let s=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,a=null,l=null,c=null,d=null,p=0;const h=null==e.minValue?-1/0:e.minValue,f=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=h&&e<=f&&(a=null===a?e:a+e,s=Math.min(s,e),n=Math.max(n,e),p++):"string"==typeof e&&p++;if(p&&null!=a){l=a/p;let e=0;for(const r of t)Number.isFinite(r)&&r>=h&&r<=f&&(e+=(r-l)**2);d=r?p>1?e/(p-1):0:p>0?e/p:0,c=Math.sqrt(d)}else s=null,n=null;const m={avg:l,count:p,max:n,min:s,stddev:c,sum:a,variance:d};return i&&(m.nullcount=t.length-p),!e.percentileParams||o?.include?.length&&!o.include.includes("median")||o?.exclude?.length&&o.exclude.includes("median")||(m.median=u(t,e.percentileParams)),m}function u(e,t){const{fieldType:r,value:i,orderBy:o,isDiscrete:s}=t,n=d(r,"desc"===o);if(0===(e=[...e].filter(e=>null!=e).sort((e,t)=>n(e,t))).length)return null;if(i<=0)return e[0];if(i>=1)return e[e.length-1];const a=(e.length-1)*i,l=Math.floor(a),c=l+1,u=a%1,p=e[l],h=e[c];return c>=e.length||s||"string"==typeof p||"string"==typeof h?p:p*(1-u)+h*u}function d(e,t){if(e){if(o.has(e))return x(t);if(s.has(e))return _(t,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?y:m}(t);const r=_(t,!0);if("esriFieldTypeString"===e)return r;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,t)=>r(w(e),w(t))}const r=t?1:-1,i=x(t),n=_(t,!0),a=f(t);return(e,t)=>"number"==typeof e&&"number"==typeof t?i(e,t):"string"==typeof e&&"string"==typeof t?n(e,t):a(e,t)??r}const p=(e,t)=>null==e?null==t?0:1:null==t?-1:null,h=(e,t)=>null==e?null==t?0:-1:null==t?1:null;function f(e){return e?p:h}const m=(e,t)=>h(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),y=(e,t)=>p(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime()),g=(e,t)=>h(e,t)??(e===t?0:e<t?-1:1),b=(e,t)=>p(e,t)??(e===t?0:e<t?1:-1);function _(e,t){if(!t)return e?b:g;const r=f(e);return e?(e,t)=>{const i=r(e,t);return null!=i?i:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const i=r(e,t);return null!=i?i:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}const v=(e,t)=>p(e,t)??t-e,S=(e,t)=>h(e,t)??e-t;function x(e){return e?v:S}function w(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function M(e){return"coded-value"!==e?.type?[]:e.codedValues.map(e=>e.code)}function T(e,t,i){const o=P({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,definedInterval:t.definedInterval,breakCount:t.numClasses||5});return e=function(e,t,r){const i=t??-1/0,o=r??1/0;return e.filter(e=>Number.isFinite(e)&&e>=i&&e<=o)}(e,t.minValue,t.maxValue),r.createGenerateRendererClassBreaks({definition:o,values:e,normalizationTotal:t.normalizationTotal},i)}function P(e){const{breakCount:r,field:i,normalizationField:o,normalizationType:s}=e,n=e.classificationMethod||"equal-interval",a="standard-deviation"===n?e.standardDeviationInterval||1:void 0,l="defined-interval"===n?e.definedInterval:void 0;return new t({breakCount:r,classificationField:i,classificationMethod:n,normalizationField:"field"===s?o:void 0,normalizationType:s,standardDeviationInterval:a,definedInterval:l})}function I(e,t,r=!1){const{field:i,classificationMethod:o,standardDeviationInterval:s,definedInterval:n,normalizationType:a,normalizationField:u,normalizationTotal:d,minValue:p,maxValue:h}=t,f=t.numBins||10;let m=null,y=null,g=null;if(o&&"equal-interval"!==o||a){const{classBreaks:t}=T(e,{field:i,normalizationType:a,normalizationField:u,normalizationTotal:d,classificationMethod:o,standardDeviationInterval:s,definedInterval:n,minValue:p,maxValue:h,numClasses:f},null!=p&&null!=h?[p,h]:void 0);m=t[0]?.minValue,y=t[t.length-1]?.maxValue,g=t.map(e=>[e.minValue,e.maxValue])}else{if(null!=p&&null!=h)m=p,y=h;else{const t=c({values:e,minValue:p,maxValue:h,useSampleStdDev:!a,supportsNullCount:l({normalizationType:a,normalizationField:u,minValue:p,maxValue:h})});m=t.min??null,y=t.max??null}g=O(m??0,y??0,f)}if(r&&g.length){const e=g.at(-1)[1];g.push([e,e])}return{min:m,max:y,intervals:g}}function C(e,t){let r=-1;for(let i=e.length-1;i>=0;i--)if(t>=e[i][0]){r=i;break}return r}function O(e,t,r){const i=(t-e)/r,o=[];let s,n=e;for(let e=1;e<=r;e++)s=n+i,s=Number(s.toFixed(16)),o.push([n,e===r?t:s]),n=s;return o}e.binIndex=C,e.calculateClassBreaks=T,e.calculateHistogram=function(e,t){const r=I(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};const i=r.intervals,o=r.min??0,s=r.max??0,n=i.map((e,t)=>({minValue:i[t][0],maxValue:i[t][1],count:0}));for(const t of e)if(null!=t&&t>=o&&t<=s){const e=C(i,t);e>-1&&n[e].count++}return{bins:n,minValue:o,maxValue:s,normalizationTotal:t.normalizationTotal}},e.calculatePercentile=u,e.calculateStatistics=c,e.calculateStringStatistics=function(e){const{outStatisticTypes:t}=e,r=e.returnDistinct?[...new Set(e.values)]:e.values,i=r.filter(e=>null!=e).sort(),o=i.length,s={count:o,min:i[0],max:i[o-1]};return e.supportsNullCount&&(s.nullcount=r.length-o),!e.percentileParams||t?.include?.length&&!t.include.includes("median")||t?.exclude?.length&&t.exclude.includes("median")||(s.median=u(r,e.percentileParams)),s},e.calculateUniqueValuesCount=function(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}},e.createClassBreaksDefinition=P,e.createUVResult=function(e,t,r,i){const o=e.count,s=[];if(r&&t){const e=[],r=M(t[0]);for(const o of r)if(t[1]){const r=M(t[1]);for(const s of r)if(t[2]){const r=M(t[2]);for(const t of r)e.push(`${a(o)}${i}${a(s)}${i}${a(t)}`)}else e.push(`${a(o)}${i}${a(s)}`)}else e.push(o);for(const t of e)o.hasOwnProperty(t)||(o[t]={data:t,count:0})}for(const e in o){const t=o[e];s.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:s}},e.getAttributeComparator=d,e.getBinParams=I,e.getEqualIntervalBins=O,e.getNormalizedValue=function(e,t,r,i){let o=null;switch(t){case"log":0!==e&&(o=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(i)&&0!==i&&(o=e/i*100);break;case"field":Number.isFinite(r)&&0!==r&&(o=e/r);break;case"natural-log":e>0&&(o=Math.log(e));break;case"square-root":e>0&&(o=e**.5)}return o},e.isNullCountSupported=l,e.processNullValue=a,e.processSummaryStatisticsResult=function(e,t,r){let i;for(i in e)t?.include?.length&&!t.include.includes(i)||t?.exclude?.length&&t.exclude.includes(i)?delete e[i]:n.includes(i)&&(Number.isFinite(e[i])||(e[i]=null));return r?(["avg","stddev","variance"].forEach(t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]??0))}),e):e},e.resolveCBResult=function(e,t){let r=e.classBreaks;const o=r.length,s=r[0]?.minValue,n=r[o-1]?.maxValue,a="standard-deviation"===t,l=i;return r=r.map(e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(a&&t){const e=t.match(l),i=e?.map(e=>+e.trim())??[];2===i.length?(r.minStdDev=i[0],r.maxStdDev=i[1],i[0]<0&&i[1]>0&&(r.hasAvg=!0)):1===i.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=i[0]):t.includes(">")&&(r.minStdDev=i[0],r.maxStdDev=null))}return r}),{minValue:s,maxValue:n,classBreakInfos:r,normalizationTotal:e.normalizationTotal}},e.statisticTypes=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=new r.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),d=new r.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});return e.default=class extends i.JSONSupport{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}},t.__decorate([l.enumeration({classBreaksDef:"class-breaks-definition"})],e.default.prototype,"type",void 0),t.__decorate([o.property({json:{write:!0}})],e.default.prototype,"breakCount",void 0),t.__decorate([o.property({json:{write:!0}})],e.default.prototype,"classificationField",void 0),t.__decorate([o.property({type:String,json:{read:u.read,write:u.write}})],e.default.prototype,"classificationMethod",void 0),t.__decorate([o.property({json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([o.property({json:{read:d.read,write:d.write}})],e.default.prototype,"normalizationType",void 0),t.__decorate([o.property({value:null,json:{write:!0}})],e.default.prototype,"standardDeviationInterval",null),t.__decorate([o.property({value:null,json:{write:!0}})],e.default.prototype,"definedInterval",null),e.default=t.__decorate([c.subclass("esri.rest.support.ClassBreaksDefinition")],e.default),e.default})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(e,t){"use strict";function r(e,t){return Number(e.toFixed(t))}function i(e,t,r){let i=null;return i=e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t,i}function o(e){const t=[],r=[];let i=Number.MIN_VALUE,o=1,s=-1;for(let n=0;n<e.length;n++){const a=e[n];a===i?(o++,r[s]=o):null!==a&&(t.push(a),i=a,o=1,r.push(o),s++)}return{uniqueValues:t,valueFrequency:r}}function s(e,t,r,i){let o=[],s=[],a=[],l=0;const c=[],u=[];for(let o=0;o<i;o++){const i=n(o,e,t,r);c.push(i.sbMean),u.push(i.sbSdcm),l+=u[o]}let d,p=l,h=!0;for(;h||l<p;){h=!1,o=[];for(let t=0;t<i;t++)o.push(e[t]);for(let r=0;r<i;r++)for(let o=e[r]+1;o<=e[r+1];o++)if(d=t[o],r>0&&o!==e[r+1]&&Math.abs(d-c[r])>Math.abs(d-c[r-1]))e[r]=o;else if(r<i-1&&e[r]!==o-1&&Math.abs(d-c[r])>Math.abs(d-c[r+1])){e[r+1]=o-1;break}p=l,l=0,s=[],a=[];for(let o=0;o<i;o++){s.push(c[o]),a.push(u[o]);const i=n(o,e,t,r);c[o]=i.sbMean,u[o]=i.sbSdcm,l+=u[o]}}if(l>p){for(let t=0;t<i;t++)e[t]=o[t],c[t]=s[t],u[t]=a[t];l=p}return{mean:c,sdcm:u}}function n(e,r,i,o){let s=0,n=0;for(let t=r[e]+1;t<=r[e+1];t++){const e=o[t];s+=i[t]*e,n+=e}n<=0&&t.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");const a=s/n;let l=0;for(let t=r[e]+1;t<=r[e+1];t++)l+=o[t]*(i[t]-a)**2;return{sbMean:a,sbSdcm:l}}e.createGenerateRendererClassBreaks=function(e,t){const{normalizationTotal:a}=e;return{classBreaks:function(e,t){const a=e.definition,{classificationMethod:l,normalizationType:c,definedInterval:u}=a,d=a.breakCount??1,p=[];let h=e.values;if(0===h.length)return[];h=h.sort((e,t)=>e-t);const[f,m]=t??[h.at(0),h.at(-1)];if("equal-interval"===l)if(h.length>=d){const e=(m-f)/d;let t=f;for(let o=1;o<d;o++){const s=r(f+o*e,6);p.push({minValue:t,maxValue:s,label:i(t,s,c)}),t=s}p.push({minValue:t,maxValue:m,label:i(t,m,c)})}else h.forEach(e=>{p.push({minValue:e,maxValue:e,label:i(e,e,c)})});else if("natural-breaks"===l){const t=o(h),a=e.valueFrequency||t.valueFrequency,l=function(e,t,r){const i=e.length,o=[];r>i&&(r=i);for(let e=0;e<r;e++)o.push(Math.round(e*i/r-1));o.push(i-1);let a=s(o,e,t,r);return function(e,t,r,i,o,s){let a=0,l=0,c=0,u=0,d=!0;for(let p=0;p<2&&d;p++){0===p&&(d=!1);for(let p=0;p<s-1;p++)for(;r[p+1]+1!==r[p+2];){r[p+1]=r[p+1]+1;const s=n(p,r,i,o);c=s.sbMean,a=s.sbSdcm;const h=n(p+1,r,i,o);if(u=h.sbMean,l=h.sbSdcm,!(a+l<t[p]+t[p+1])){r[p+1]=r[p+1]-1;break}t[p]=a,t[p+1]=l,e[p]=c,e[p+1]=u,d=!0}for(let p=s-1;p>0;p--)for(;r[p]!==r[p-1]+1;){r[p]=r[p]-1;const s=n(p-1,r,i,o);c=s.sbMean,a=s.sbSdcm;const h=n(p,r,i,o);if(u=h.sbMean,l=h.sbSdcm,!(a+l<t[p-1]+t[p])){r[p]=r[p]+1;break}t[p-1]=a,t[p]=l,e[p-1]=c,e[p]=u,d=!0}}return d}(a.mean,a.sdcm,o,e,t,r)&&(a=s(o,e,t,r)),o}(t.uniqueValues,a,d);let u=f;for(let e=1;e<d;e++)if(t.uniqueValues.length>e){const o=r(t.uniqueValues[l[e]],6);p.push({minValue:u,maxValue:o,label:i(u,o,c)}),u=o}p.push({minValue:u,maxValue:m,label:i(u,m,c)})}else if("quantile"===l)if(h.length>=d&&f!==m){let e=f,t=Math.ceil(h.length/d),r=0;for(let o=1;o<d;o++){let s=t+r-1;s>h.length&&(s=h.length-1),s<0&&(s=0),p.push({minValue:e,maxValue:h[s],label:i(e,h[s],c)}),e=h[s],r+=t,t=Math.ceil((h.length-r)/(d-o))}p.push({minValue:e,maxValue:m,label:i(e,m,c)})}else{let e=-1;for(let t=0;t<h.length;t++){const r=h[t];r!==e&&(e=r,p.push({minValue:e,maxValue:r,label:i(e,r,c)}),e=r)}}else if("standard-deviation"===l){const e=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(h),t=function(e,t){let r=0;for(let i=0;i<e.length;i++){const o=e[i];r+=(o-t)*(o-t)}return r/=e.length,Math.sqrt(r)}(h,e);if(0===t)p.push({minValue:h[0],maxValue:h[0],label:i(h[0],h[0],c)});else{const o=function(e,t,r,i,o){let s=Math.max(i-e,t-i)/o/r;return s=s>=1?1:s>=.5?.5:.25,s}(f,m,d,e,t),s=o*t;let n=0,a=f;for(let t=d;t>=1;t--){const o=r(e-(t-.5)*s,6);p.push({minValue:a,maxValue:o,label:i(a,o,c)}),a=o,n++}let l=r(e+.5*s,6);p.push({minValue:a,maxValue:l,label:i(a,l,c)}),a=l,n++;for(let t=1;t<=d;t++)l=n===2*d?m:r(e+(t+.5)*s,6),p.push({minValue:a,maxValue:l,label:i(a,l,c)}),a=l,n++}}else if("defined-interval"===l){if(!u)return p;const[e,o]=t??[h.at(0),h.at(-1)],s=Math.ceil((o-e)/u);let n=e;for(let t=1;t<s;t++){const o=r(e+t*u,6);p.push({minValue:n,maxValue:o,label:i(n,o,c)}),n=o}p.push({minValue:n,maxValue:o,label:i(n,o,c)})}return p}(e,t),normalizationTotal:a}},e.createGenerateRendererUniqueValues=function(e){const t=o(e),r=[],i=t.uniqueValues.length;for(let e=0;e<i;e++){const i=t.uniqueValues[e],o=t.valueFrequency[e],s=i.toString();r.push({value:i,count:o,label:s})}return{uniqueValues:r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define(["require","exports","../../../core/Error","../../../core/jsonMap","../../../core/unitUtils","../../../geometry/projectionUtils","../../../geometry/support/extentUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","./projectionSupport"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";const d=new i.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),p=Object.freeze({});async function h(e,t,r){const{outFields:i,orderByFields:o,groupByFieldsForStatistics:s,outStatistics:n}=e;if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(o)for(let e=0;e<o.length;e++)o[e]=o[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(n)for(let e=0;e<n.length;e++)n[e].onStatisticField&&(n[e].onStatisticField=n[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),f(e,t,r)}async function f(t,i,s){if(!t)return null;let{where:h}=t;if(t.where=h=h?.trim(),(!h||/^1 *= *1$/.test(h)||i&&i===h)&&(t.where=null),!t.geometry)return t;let f=await async function(t){const{distance:i,units:s}=t,n=t.geometry;if(null==i||"vertexAttributes"in n)return n;const l=n.spatialReference,p=s?d.fromJSON(s):o.getUnitString(l),h=l&&(c.isGeographic(l)||c.isWebMercator(l))?n:await u.checkProjectionSupport(l,c.wgs84).then(()=>u.project(n,c.wgs84)),f=await new Promise((t,r)=>e(["../../../geometry/operators/json/geodesicBufferOperator"],t,r));await f.load();const m=f.execute(h,i||1,{unit:p})??void 0;if(!m||!a.isPolygon(m)||0===m.rings.length)throw new r("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return m}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;f=n.getGeometryExtent(f),f.spatialReference=e}if(f){await u.checkProjectionSupport(f.spatialReference,s),f=function(e,t){const r=e.spatialReference;return m(e,t)&&a.isExtent(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(f,s);const e=(await l.normalizeCentralMeridian(a.fromJSON(f)))[0];if(null==e)throw p;const r="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,i=r&&m(f,s)?{densificationStep:8*r}:void 0,o=e.toJSON(),n=u.project(o,o.spatialReference,s,i);if(!n)throw p;n.spatialReference=s,t.geometry=n}return t}function m(e,t){if(!e)return!1;const r=e.spatialReference;return(a.isExtent(e)||a.isPolygon(e)||a.isPolyline(e))&&!c.equals(r,t)&&!s.canProjectWithoutEngine(r,t)}t.getDateInNumber=function(e,t){return null==e?null:"string"==typeof e?t?new Date(`1970-01-01T${e}Z`).getTime():new Date(e).getTime():e instanceof Date?e.getTime():e},t.normalizeAttributeBinsQuery=async function(e,t,r){const i=e.bin;return i.onField&&(i.onField=i.onField.trim()),i.onExpression?.value&&(i.onExpression.value=i.onExpression.value.trim()),i.splitBy&&(i.splitBy.value&&(i.splitBy.value=i.splitBy.value.trim()),i.splitBy.outAlias&&(i.splitBy.outAlias=i.splitBy.outAlias.trim())),i.stackBy&&(i.stackBy.value&&(i.stackBy.value=i.stackBy.value.trim()),i.stackBy.outAlias&&(i.stackBy.outAlias=i.stackBy.outAlias.trim())),"normalizationField"in i.parameters&&i.parameters.normalizationField&&(i.parameters.normalizationField=i.parameters.normalizationField.trim()),e.outStatistics?.length||(e.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:"frequency"}]),h(e,t,r)},t.normalizeQuery=h,t.normalizeQueryLike=f,t.queryEngineEmptyResult=p,t.unitsKebabDict=d,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtils":function(){define(["exports","../../config","../../core/Error","../../core/Logger","../Polygon","../Polyline","./normalizeUtilsCommon","./spatialReferenceUtils","./webMercatorUtils","../../rest/geometryService/cut","../../rest/geometryService/simplify"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";const d=()=>i.getLogger("esri.geometry.support.normalizeUtils");function p(e){return"polygon"===e[0].type}function h(e){return"polyline"===e[0].type}function f(e){const t=[];let r=0,i=0;for(let o=0;o<e.length;o++){const s=e[o];let n=null;for(let e=0;e<s.length;e++)n=s[e],t.push(n),0===e?(r=n[0],i=r):(r=Math.min(r,n[0]),i=Math.max(i,n[0]));n&&t.push([(r+i)/2,0])}return t}function m(e,t){if(!(e instanceof s||e instanceof o)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw d().error(e),new r("internal:geometry",e)}const i=n.getGeometryParts(e),a=[];for(const e of i){const r=[];a.push(r),r.push([e[0][0],e[0][1]]);for(let i=0;i<e.length-1;i++){const o=e[i][0],s=e[i][1],n=e[i+1][0],a=e[i+1][1],l=Math.sqrt((n-o)*(n-o)+(a-s)*(a-s)),c=(a-s)/l,u=(n-o)/l,d=l/t;if(d>1){for(let e=1;e<=d-1;e++){const i=e*t,n=u*i+o,a=c*i+s;r.push([n,a])}const e=(l+Math.floor(d-1)*t)/2,i=u*e+o,n=c*e+s;r.push([i,n])}r.push([n,a])}}return function(e){return"polygon"===e.type}(e)?new o({rings:a,spatialReference:e.spatialReference}):new s({paths:a,spatialReference:e.spatialReference})}function y(e,t,r){if(t){const t=m(e,1e6);e=l.webMercatorToGeographic(t,!0)}return r&&(e=n.updatePolyGeometry(e,r)),e}function g(e,t,r){if(Array.isArray(e)){const i=e[0];if(i>t){const r=n.offsetMagnitude(i,t);e[0]=i+r*(-2*t)}else if(i<r){const t=n.offsetMagnitude(i,r);e[0]=i+t*(-2*r)}}else{const i=e.x;if(i>t){const r=n.offsetMagnitude(i,t);e=e.clone().offset(r*(-2*t),0)}else if(i<r){const t=n.offsetMagnitude(i,r);e=e.clone().offset(t*(-2*r),0)}}return e}e.getClosestDenormalizedXToReference=function(e,t,r){const i=a.getInfo(r);if(null==i)return e;const[o,s]=i.valid,n=2*s;let l=0,c=0;t>s?l=Math.ceil(Math.abs(t-s)/n):t<o&&(l=-Math.ceil(Math.abs(t-o)/n)),e>s?c=Math.ceil(Math.abs(e-s)/n):e<o&&(c=-Math.ceil(Math.abs(e-o)/n));let u=e+(l-c)*n;const d=u-t;return d>s?u-=n:d<o&&(u+=n),u},e.getDenormalizedExtent=function(e){if(!e)return null;const t=e.extent;if(!t)return null;const r=e.spatialReference&&a.getInfo(e.spatialReference);if(!r)return t;const[i,o]=r.valid,s=2*o,{width:n}=t;let l,{xmin:c,xmax:u}=t;if([c,u]=[u,c],"extent"===e.type||0===n||n<=o||n>s||c<i||u>o)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;l=f(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;l=f(e.paths);break;case"multipoint":l=e.points}const d=t.clone();for(let e=0;e<l.length;e++){let t=l[e][0];t<0?(t+=o,u=Math.max(t,u)):(t-=o,c=Math.min(t,c))}return d.xmin=c,d.xmax=u,d.width<n?(d.xmin-=o,d.xmax-=o,d):t},e.normalizeCentralMeridian=async function e(r,i,f){if(!Array.isArray(r))return e([r],i);i&&"string"!=typeof i&&d().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const m="string"==typeof i?i:i?.url??t.geometryServiceUrl;let b,_,v,S,x,w,M,T,P=0;const I=[],C=[];for(const e of r)if(null!=e)if(b||(b=e.spatialReference,_=a.getInfo(b),v=b.isWebMercator,w=v?102100:4326,S=n.cutParams[w].maxX,x=n.cutParams[w].minX,M=n.cutParams[w].plus180Line,T=n.cutParams[w].minus180Line),_)if("mesh"===e.type)C.push(e);else if("point"===e.type)C.push(g(e.clone(),S,x));else if("multipoint"===e.type){const t=e.clone();t.points=t.points.map(e=>g(e,S,x)),C.push(t)}else if("extent"===e.type){const t=e.clone()._normalize(!1,!1,_);C.push(t.rings?new o(t):t)}else if(e.extent){const t=e.extent,r=n.offsetMagnitude(t.xmin,x)*(2*S);let i=0===r?e.clone():n.updatePolyGeometry(e.clone(),r);t.offset(r,0);let{xmin:o,xmax:s}=t;o=Number(o.toFixed(9)),s=Number(s.toFixed(9)),t.intersects(M)&&s!==S?(P=s>P?s:P,i=y(i,v),I.push(i),C.push("cut")):t.intersects(T)&&o!==x?(P=s*(2*S)>P?s*(2*S):P,i=y(i,v,360),I.push(i),C.push("cut")):C.push(i)}else C.push(e.clone());else C.push(e);else C.push(e);let O=n.offsetMagnitude(P,S),F=-90;const A=O,R=new s;for(;O>0;){const e=360*O-180;R.addPath([[e,F],[e,-1*F]]),F*=-1,O--}if(I.length>0&&A>0){const e=function(e,t){let r=-1;for(let i=0;i<t.cutIndexes.length;i++){const o=t.cutIndexes[i],s=t.geometries[i],a=n.getGeometryParts(s);for(let e=0;e<a.length;e++){const t=a[e];t.some(r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const i=t[e][0];r=i>r?i:r}r=Number(r.toFixed(9));const i=-360*n.offsetMagnitude(r,180);for(let r=0;r<t.length;r++){const t=s.getPoint(e,r);s.setPoint(e,r,t.clone().offset(i,0))}return!0}})}if(o===r){if(p(e))for(const t of n.getGeometryParts(s))e[o]=e[o].addRing(t);else if(h(e))for(const t of n.getGeometryParts(s))e[o]=e[o].addPath(t)}else r=o,e[o]=s}return e}(I,await c.cut(m,I,R,f)),t=[],i=[];for(let o=0;o<C.length;o++){const s=C[o];if("cut"!==s)i.push(s);else{const s=e.shift(),n=r[o];null!=n&&"polygon"===n.type&&n.rings&&n.rings.length>1&&s.rings.length>=n.rings.length?(t.push(s),i.push("simplify")):i.push(v?l.geographicToWebMercator(s):s)}}if(!t.length)return i;const o=await u.simplify(m,t,f),s=[];for(let e=0;e<i.length;e++){const t=i[e];"simplify"!==t?s.push(t):s.push(v?l.geographicToWebMercator(o.shift()):o.shift())}return s}const D=[];for(let e=0;e<C.length;e++){const t=C[e];if("cut"!==t)D.push(t);else{const e=I.shift();D.push(!0===v?l.geographicToWebMercator(e):e)}}return D},e.normalizeMapX=function(e,t){const r=a.getInfo(t);if(r){const[t,i]=r.valid,o=i-t;if(e<t)for(;e<t;)e+=o;if(e>i)for(;e>i;)e-=o}return e},e.straightLineDensify=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsCommon":function(){define(["exports","../Polyline","../SpatialReference","./jsonUtils"],function(e,t,r,i){"use strict";const o={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new t({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator}),minus180Line:new t({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new t({paths:[[[180,-180],[180,180]]],spatialReference:r.WGS84}),minus180Line:new t({paths:[[[-180,-180],[-180,180]]],spatialReference:r.WGS84})}};function s(e){return i.isPolygon(e)?e.rings:e.paths}e.cutParams=o,e.getGeometryParts=s,e.offsetMagnitude=function(e,t){return Math.ceil((e-t)/(2*t))},e.updatePolyGeometry=function(e,t){const r=s(e);for(const e of r)for(const r of e)r[0]+=t;return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/cut":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","../utils"],function(e,t,r,i,o){"use strict";e.cut=async function(e,s,n,a){const l=o.parseUrl(e),c=s[0].spatialReference,u={...a,responseType:"json",query:{...l.query,f:"json",sr:i.srToRESTValue(c),target:JSON.stringify({geometryType:r.getJsonType(s[0]),geometries:s}),cutter:JSON.stringify(n)}},d=await t(l.path+"/cut",u),{cutIndexes:p,geometries:h=[]}=d.data;return{cutIndexes:p,geometries:h.map(e=>{const t=r.fromJSON(e);return t.spatialReference=c,t})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/utils":function(){define(["require","exports","../config","../kernel","../core/lang","../core/urlUtils","../support/apiKeyUtils"],function(e,t,r,i,o,s,n){"use strict";const a=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));function l(e,t){return e?t&&n.supportsApiKey(e)?t:n.getApiKey(e)??i.id?.findCredential(e)?.token:null}t.asValidOptions=function(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}},t.encode=function e(t,r,i){const o={};for(const s in t){if("declaredClass"===s)continue;const n=t[s];if(null!=n&&"function"!=typeof n)if(Array.isArray(n))o[s]=n.map(t=>e(t));else if("object"==typeof n)if(n.toJSON){const e=n.toJSON(i?.[s]);o[s]=r?e:JSON.stringify(e)}else o[s]=r?n:JSON.stringify(n);else o[s]=n}return o},t.findToken=l,t.getToken=async function(t,o,s){const n=l(t,o);if(n)return n;!i.id&&r.request.useIdentity&&await new Promise((t,r)=>e(["../identity/IdentityManager"],e=>t(a(e)),r));const c=await i.id.getCredential(t,s);return c?.token},t.parseUrl=function(e){return"string"==typeof e?s.urlToObject(e):o.clone(e)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/simplify":function(){define(["exports","../../request","../../core/urlUtils","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","./utils"],function(e,t,r,i,o,s){"use strict";e.simplify=async function(e,n,a){const l="string"==typeof e?r.urlToObject(e):e,c=n[0].spatialReference,u=i.getJsonType(n[0]),d={...a,query:{...l.query,f:"json",sr:o.srToRESTValue(c),geometries:JSON.stringify(s.encodeGeometries(n))}},{data:p}=await t(l.path+"/simplify",d);return s.decodeGeometries(p.geometries,u,c)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],function(e,t){"use strict";e.decodeGeometries=function(e,r,i){const o=t.getGeometryType(r);return e.map(e=>{const t=o.fromJSON(e);return t.spatialReference=i,t})},e.encodeGeometries=function(e){return{geometryType:t.getJsonType(e[0]),geometries:e.map(e=>e.toJSON())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(e){"use strict";e.makeEdgeCandidate=function(e,t,r,i,o,s=!1){return{objectId:e,target:t,distance:r,type:"edge",start:i,end:o,draped:s}},e.makeVertexCandidate=function(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/AutoIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";function d(e,t,i){r.setDeepValue(i,e instanceof Date?e.getTime():e,t)}return e.default=class extends(u.NormalizationBinParametersMixin(c)){constructor(e){super(e),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}},t.__decorate([i.property({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],e.default.prototype,"numBins",void 0),t.__decorate([i.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([a.enumeration({autoIntervalBin:"auto-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.AutoIntervalBinParameters")],e.default),e.default.from=o.ensureType(e.default),e.default})},"esri/rest/support/BinParametersBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./AttributeBinsGrouping"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";const p=new i.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),h=new i.JSONMap({naturalLog:"natural-log",squareRoot:"square-root"});return e.default=class extends(r.ClonableMixin(o.JSONSupport)){constructor(e){super(e),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}},t.__decorate([s.property({type:String,json:{name:"onExpression.value",write:!0}})],e.default.prototype,"expression",void 0),t.__decorate([c.enumeration(p,{name:"onExpression.valueType"})],e.default.prototype,"expressionValueType",void 0),t.__decorate([s.property({type:String,json:{name:"onField",write:!0}})],e.default.prototype,"field",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"firstDayOfWeek",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"hideUpperBound",void 0),t.__decorate([s.property({type:d,json:{write:{overridePolicy(){return{enabled:null!=this.splitBy?.value||null!=this.splitBy?.type}}}}})],e.default.prototype,"splitBy",void 0),t.__decorate([s.property({type:d,json:{write:{target:{stackBy:{type:d},jsonStyle:{type:String}},writer:(e,t)=>{e&&(t.stackBy=e.toJSON(),null!=e.responseType&&(t.jsonStyle=e.responseType))},overridePolicy(){return{enabled:null!=this.stackBy?.value||null!=this.stackBy?.type}}},read:{source:["stackBy","jsonStyle"],reader:(e,t)=>d.fromJSON({...t.stackBy,responseType:t.jsonStyle})}}})],e.default.prototype,"stackBy",void 0),t.__decorate([c.enumeration(h)],e.default.prototype,"transformation",void 0),e.default=t.__decorate([u.subclass("esri.rest.support.BinParametersBase")],e.default),e.default})},"esri/rest/support/AttributeBinsGrouping":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=new r.JSONMap({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let d=class extends(t.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};e.__decorate([o.property({type:String,json:{name:"outAlias",write:!0}})],d.prototype,"alias",void 0),e.__decorate([o.property({type:String})],d.prototype,"responseType",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"type",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"value",void 0),e.__decorate([l.enumeration(u)],d.prototype,"valueType",void 0),d=e.__decorate([c.subclass("esri.rest.support.AttributeBinsGrouping")],d);const p=d;return d.from=s.ensureType(d),p})},"esri/rest/support/NormalizationBinParametersMixin":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l){"use strict";const c=r.strict()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),u="percent-of-total",d="field";e.NormalizationBinParametersMixin=e=>{const r=e;let s=class extends r{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&d||r&&u||null,t&&r&&i.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==d&&e!==u||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}};return t.__decorate([o.property({type:String,json:{name:"parameters.normalizationField",write:!0}})],s.prototype,"normalizationField",void 0),t.__decorate([o.property({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],s.prototype,"normalizationMaxValue",void 0),t.__decorate([o.property({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],s.prototype,"normalizationMinValue",void 0),t.__decorate([o.property({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],s.prototype,"normalizationTotal",void 0),t.__decorate([a.enumeration(c,{name:"parameters.normalizationType"})],s.prototype,"normalizationType",null),s=t.__decorate([l.subclass("esri.rest.support.NormalizationBinParametersMixin")],s),s},e.normalizationTypeJsonMap=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/DateBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./DateBinTimeInterval"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";function d(e,t,i){r.setDeepValue(i,"string"==typeof e?e:e?.getTime(),t)}function p(e,t){const r=e.parameters[t];return r?"string"==typeof r?r:new Date(r):null}return e.default=class extends c{constructor(e){super(e),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=!1,this.start=null,this.snapToData=null,this.type="date"}},t.__decorate([i.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.end",read:{reader:(e,t)=>p(t,"end")},write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({type:u,json:{name:"parameters",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([i.property({type:u,json:{name:"parameters.offset",write:!0}})],e.default.prototype,"offset",void 0),t.__decorate([i.property({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],e.default.prototype,"returnFullIntervalBin",void 0),t.__decorate([i.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.start",read:{reader:(e,t)=>p(t,"start")},write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([i.property({type:String,json:{name:"parameters.snapToData",write:!0}})],e.default.prototype,"snapToData",void 0),t.__decorate([a.enumeration({dateBin:"date"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.DateBinParameters")],e.default),e.default.from=o.ensureType(e.default),e.default})},"esri/rest/support/DateBinTimeInterval":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./DateBinUtils"],function(e,t,r,i,o,s,n,a,l,c){"use strict";let u=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.value=null,this.unit=null}};e.__decorate([i.property({type:Number,json:{name:"number",write:!0}})],u.prototype,"value",void 0),e.__decorate([a.enumeration(c.unitsDict)],u.prototype,"unit",void 0),u=e.__decorate([l.subclass("esri.rest.support.DateBinTimeInterval")],u);const d=u;return u.from=o.ensureType(u),d})},"esri/rest/support/DateBinUtils":function(){define(["exports","../../core/jsonMap"],function(e,t){"use strict";const r=t.strict()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"});e.unitsDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/FixedBoundariesBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase"],function(e,t,r,i,o,s,n,a,l,c){"use strict";return e.default=class extends c{constructor(e){super(e),this.boundaries=[],this.type="fixed-boundaries"}},t.__decorate([i.property({json:{name:"parameters.boundaries",write:{writer:function(e,t,i){r.setDeepValue(i,e&&e[0]instanceof Date?e.map(e=>e.getTime()):e,t)}}}})],e.default.prototype,"boundaries",void 0),t.__decorate([a.enumeration({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedBoundariesBinParameters")],e.default),e.default.from=o.ensureType(e.default),e.default})},"esri/rest/support/FixedIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";function d(e,t,i){r.setDeepValue(i,e instanceof Date?e.getTime():e,t)}return e.default=class extends(u.NormalizationBinParametersMixin(c)){constructor(e){super(e),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}},t.__decorate([i.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.interval",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([i.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([a.enumeration({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedIntervalBinParameters")],e.default),e.default.from=o.ensureType(e.default),e.default})},"esri/layers/graphics/data/queryValidationUtils":function(){define(["exports","../../../core/Error","./attributeSupport","./projectionSupport","./spatialQuerySupport","../../../support/loadArcade"],function(e,t,r,i,o,s){"use strict";const n="unsupported-query";async function a(e,{fieldsIndex:s,geometryType:a,spatialReference:u,availableFields:d}){if(null!=e.geometryPrecision||e.multipatchOption&&"xyFootprint"!==e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new t(n,"Unsupported query options",{query:e});return l(s,d,e),function(e,i,o){const{outStatistics:s,groupByFieldsForStatistics:a,having:l}=o,u=a?.length,d=s?.length;if(l){if(!u||!d)throw new t(n,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:o});r.validateHaving(e,i,l,s,o)}if(d){if(!function(e){return null!=e&&e.every(e=>"exceedslimit"!==e.statisticType)}(s))return;const l=s.map(e=>e.onStatisticField).filter(Boolean);r.validateFields(e,i,l,{expressionName:"onStatisticFields",query:o}),u&&r.validateFields(e,i,a,{expressionName:"groupByFieldsForStatistics",query:o});for(const a of s){const{onStatisticField:s,statisticType:l}=a;if("percentile_disc"!==l&&"percentile_cont"!==l||!("statisticParameters"in a))e.get(s)&&"count"!==l&&"min"!==l&&"max"!==l&&r.validateFields(e,i,[s],{expressionName:`outStatistics with '${l}' statistic type`,allowedFieldTypes:c,query:o});else{const{statisticParameters:e}=a;if(!e)throw new t(n,"statisticParameters should be set for percentile type",{definition:a,query:o})}}}}(s,d,e),Promise.all([o.checkSpatialQuerySupport(e,a,u),i.checkProjectionSupport(u,e.outSR)]).then(()=>e)}function l(e,i,o){const{returnDistinctValues:s,outStatistics:a}=o,l=a?a.map(e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if("orderByFields"in o&&o.orderByFields&&o.orderByFields.length>0){const t=" asc",s=" desc",n=o.orderByFields.map(e=>{const r=e.toLowerCase();return r.includes(t)?r.split(t)[0]:r.includes(s)?r.split(s)[0]:e}).filter(e=>!l.includes(e));r.validateFields(e,i,n,{expressionName:"orderByFields",query:o})}if("outFields"in o)if(o.outFields?.length)r.validateFields(e,i,o.outFields,{expressionName:"outFields",query:o,allowedFieldTypes:"all"});else if(s)throw new t(n,"outFields should be specified for returnDistinctValues",{query:o});r.validateWhere(e,i,o.where,o)}const c=new Set([...r.numericFieldTypes,...r.allDateAndTimeFieldTypes]);async function u(e,i,o,a){let l=[];if(o.valueExpression){const{arcadeUtils:e}=await s.loadArcade();l=e.extractFieldNames(o.valueExpression)}if(o.field&&l.push(o.field),o.field2&&l.push(o.field2),o.field3&&l.push(o.field3),o.normalizationField&&l.push(o.normalizationField),!l.length&&!o.valueExpression)throw new t(n,"field or valueExpression is required",{params:o});r.validateFields(e,i,l,{expressionName:"statistics",query:a})}e.validateAttributeBinsQuery=async function(e,r){const i=e.bin;if(!i.onField&&!i.onExpression?.value||"autoIntervalBin"===i.type&&null==i.parameters.numberOfBins||"dateBin"===i.type&&(null==i.parameters.number||null==i.parameters.unit)||"fixedBoundariesBin"===i.type&&null==i.parameters.boundaries||"fixedIntervalBin"===i.type&&null==i.parameters.interval)throw new t(n,"Unsupported query options",{query:e});return a(e,r)},e.validateQuery=a,e.validateStatisticsQuery=async function(e,r,{fieldsIndex:s,geometryType:a,spatialReference:c,availableFields:d}){if(null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new t(n,"Unsupported query options",{query:e});return l(s,d,e),Promise.all([u(s,d,r,e),o.checkSpatialQuerySupport(e,a,c),i.checkProjectionSupport(c,e.outSR)]).then(()=>e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define(["require","exports","../../../core/Error","../../../geometry/support/contains","../../../geometry/support/intersects","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../contains","../featureConversionUtils","../OptimizedGeometry","./geometryUtils","./projectionSupport"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";const p="unsupported-query",h={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},f={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1},y={esriSpatialRelIntersects:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/intersectsOperator"],t,r)),esriSpatialRelContains:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/containsOperator"],t,r)),esriSpatialRelCrosses:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/crossesOperator"],t,r)),esriSpatialRelDisjoint:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/disjointOperator"],t,r)),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/overlapsOperator"],t,r)),esriSpatialRelTouches:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/touchesOperator"],t,r)),esriSpatialRelWithin:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/withinOperator"],t,r)),esriSpatialRelRelation:null};t.canQueryWithRBush=function(e){if(s.isExtent(e))return!0;if(s.isPolygon(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1},t.checkSpatialQuerySupport=async function(e,t,i){const{spatialRel:o,geometry:a}=e;if(a){if(null==(l=o)||!0!==h[l])throw new r(p,"Unsupported query spatial relationship",{query:e});var l;if(n.isValid(a.spatialReference)&&n.isValid(i)){if(!function(e){return null!=e&&!0===f[s.getJsonType(e)]}(a))throw new r(p,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===m[e]}(t))throw new r(p,"Unsupported layer geometry type",{query:e});if(e.outSR)return d.checkProjectionSupport(e.geometry?.spatialReference,e.outSR)}}},t.getSpatialQueryOperator=async function(e,t,r,n,d){if(s.isPolygon(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=l.convertFromPolygon(new c,t,!1,!1);return t=>a.polygonContainsPoint(e,!1,!1,t)}if("esriGeometryMultipoint"===r){const r=l.convertFromPolygon(new c,t,!1,!1);if("esriSpatialRelContains"===e)return e=>a.polygonContainsMultipoint(r,!1,!1,e,n,d)}}if(s.isExtent(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return e=>i.extentContainsPoint(t,u.getGeometry(r,n,d,e));if("esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return e=>i.extentContainsMultipoint(t,u.getGeometry(r,n,d,e));if("esriSpatialRelIntersects"===e){const e=o.getExtentIntersector(r);return i=>e(t,u.getGeometry(r,n,d,i))}}"esriSpatialRelEnvelopeIntersects"===e&&(e="esriSpatialRelIntersects");const p=await function(e){const t=y[e];if(null==t)throw new Error(`Cannot load unsupported spatial operator: ${e}`);return t()}(e);return e=>p.execute(t,u.getGeometry(r,n,d,e))},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(e,t){"use strict";e.extentIntersectsExtent=t.extentIntersectsExtent,e.extentIntersectsMultipoint=t.extentIntersectsMultipoint,e.extentIntersectsPoint=t.extentIntersectsPoint,e.extentIntersectsPolygon=t.extentIntersectsPolygon,e.extentIntersectsPolyline=t.extentIntersectsPolyline,e.getFeatureExtentIntersector=t.getFeatureExtentIntersector,e.isSelfIntersecting=t.isSelfIntersecting,e.segmentIntersects=t.segmentIntersects,e.getExtentIntersector=function(e){return"mesh"===e?t.extentIntersectsExtent:t.getFeatureExtentIntersector(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,o,s,n){if(!e)return!1;const a=t(r,o),{coords:l,lengths:c}=e;let u=!1,d=0;for(const e of c)u=i(u,l,a,d,e,s,n),d+=e*a;return u}function i(e,t,r,i,o,s,n){let a=e,l=i;for(let e=i,c=i+o*r;e<c;e+=r){l=e+r,l===c&&(l=i);const o=t[e],u=t[e+1],d=t[l],p=t[l+1];(u<n&&p>=n||p<n&&u>=n)&&o+(n-u)/(p-u)*(d-o)<s&&(a=!a)}return a}e.polygonContainsCoords=r,e.polygonContainsMultipoint=function(e,i,o,s,n,a){const l=t(n,a),{coords:c,lengths:u}=s;if(!u)return!1;for(let t=0,s=0;t<u.length;t++,s+=l)if(!r(e,i,o,c[s],c[s+1]))return!1;return!0},e.polygonContainsPoint=function(e,t,i,o){return r(e,t,i,o.coords[0],o.coords[1])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports","../../../core/compilerUtils"],function(e,t){"use strict";e.getTimeExtent=async function(e,r){if(!e)return null;const i=r.featureAdapter,{startTimeField:o,endTimeField:s}=e;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(o&&s)await r.forEach(e=>{const r=i.getAttribute(t.toConst(e),o),l=i.getAttribute(t.toConst(e),s);null==r||isNaN(r)||(n=Math.min(n,r)),null==l||isNaN(l)||(a=Math.max(a,l))});else{const e=o||s;await r.forEach(r=>{const o=i.getAttribute(t.toConst(r),e);null==o||isNaN(o)||(n=Math.min(n,o),a=Math.max(a,o))})}return{start:n,end:a}},e.getTimeOperator=function(e,t,r){if(!t||!e)return null;const{startTimeField:i,endTimeField:o}=e;if(!i&&!o)return null;const{start:s,end:n}=t;if(null===s&&null===n)return null;if(void 0===s&&void 0===n)return()=>!1;const a=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return i&&o?function(e,t,r,i,o){return null!=i&&null!=o?s=>{const n=e(s,t),a=e(s,r);return(null==n||n<=o)&&(null==a||a>=i)}:null!=i?t=>{const o=e(t,r);return null==o||o>=i}:null!=o?r=>{const i=e(r,t);return null==i||i<=o}:void 0}(a,i,o,s,n):function(e,t,r,i){return null!=r&&null!=i&&r===i?i=>e(i,t)===r:null!=r&&null!=i?o=>{const s=e(o,t);return null!=s&&s>=r&&s<=i}:null!=r?i=>{const o=e(i,t);return null!=o&&o>=r}:null!=i?r=>{const o=e(r,t);return null!=o&&o<=i}:void 0}(a,i||o,s,n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FieldsIndex":function(){define(["../../core/Error","../../core/Logger","../../core/MapUtils","../../core/sql/UnknownTimeZone","../../core/support/jsonUtils","./fieldUtils","../../time/constants","../../time/timeZoneUtils","../../chunks/datetime"],function(e,t,r,i,o,s,n,a,l){"use strict";const c=new Map;class u{static fromJSON(e){return new u(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new u(e.fields??[],f(e))}static fromLayerJSON(e){return new u(e.fields??[],f(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const e of this.fields){const t=e?.name,i=p(t);if(t&&i){const o=d(t);this._fieldsMap.set(t,e),this._fieldsMap.set(o,e),this._normalizedFieldsMap.set(i,e),r.push(`${o}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),s.isDateField(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):s.isNumericField(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),s.isObjectIDField(e)||s.isGlobalIDField(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)s.isObjectIDField(e)||s.isGlobalIDField(e)||e.nullable||void 0!==s.getFieldDefaultValue(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(d(e))??this._normalizedFieldsMap.get(p(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(r){const i=this.get(r&&"string"!=typeof r?r.name:r);return i?this._timeZoneByFieldName?this._timeZoneByFieldName.get(i.name):"date"===i.type||"esriFieldTypeDate"===i.type?(t.getLogger("esri.layers.support.FieldsIndex").errorOnce(new e("getTimeZone:no-timezone-information",`no time zone information for field '${i.name}'`)),n.utc):h.has(i.type)?n.unknown:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===n.unknown?i.UnknownTimeZone.instance:t===n.utc?l.FixedOffsetZone.utcInstance:r.getOrCreateMapValue(c,t,()=>l.IANAZone.create(t)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return s.isTimeOnlyField(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>o.isSerializable(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function d(e){return e.trim().toLowerCase()}function p(e){return s.normalizeFieldName(e)?.toLowerCase()??""}const h=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function f(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:i,editFieldsInfo:o}=e,s=(i?"startField"in i?i.startField:i.startTimeField:"")??"",l=(i?"endField"in i?i.endField:i.endTimeField:"")??"",c="dateFieldsTimeZone"in e?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?a.fromTimeReference(e.dateFieldsTimeReference):null,u=o?"timeZone"in o?o.timeZone??c:o.dateFieldsTimeReference?a.fromTimeReference(o.dateFieldsTimeReference):c??n.utc:null,p=i?"timeZone"in i?i.timeZone??c:i.timeReference?a.fromTimeReference(i.timeReference):c:null,f=new Map([[d(o?.creationDateField??""),u],[d(o?.editDateField??""),u],[d(s),p],[d(l),p]]);for(const{name:i,type:o}of e.fields)if(h.has(o))t.set(i,n.unknown);else if("date"!==o&&"esriFieldTypeDate"!==o)t.set(i,null);else if(r)t.set(i,n.unknown);else{const e=f.get(d(i??""))??c;t.set(i,e)}return t}return u})},"esri/views/support/Scheduler":function(){define(["exports","../../core/arrayUtils","../../core/Handles","../../core/has","../../core/Logger","../../core/maybe","../../core/PerformanceSampler","../../core/promiseUtils","../../core/reactiveUtils","../../core/signal","../../core/time","../../layers/support/PromiseQueue","./debugFlags","./Yield"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";const f={RESOURCE_CONTROLLER_IMMEDIATE:"immediate",RESOURCE_CONTROLLER:"schedule",SLIDE:"slide",STREAM_DATA_LOADER:"stream loader",ELEVATION_QUERY:"elevation query",TERRAIN_SURFACE:"terrain",SURFACE_GEOMETRY_UPDATES:"surface geometry updates",LOD_RENDERER:"LoD renderer",GRAPHICS_CORE:"Graphics3D",I3S_CONTROLLER:"I3S",POINT_CLOUD_LAYER:"point cloud",FEATURE_TILE_FETCHER:"feature fetcher",STREAM_CONTROLLER:"stream controller",OVERLAY:"overlay",OVERLAY_RENDERER:"overlay renderer",STAGE:"stage",GRAPHICS_DECONFLICTOR:"graphics deconflictor",FILTER_VISIBILITY:"Graphics3D filter visibility",SCALE_VISIBILITY:"Graphics3D scale visibility",FRUSTUM_VISIBILITY:"Graphics3D frustum visibility",POINT_OF_INTEREST_FREQUENT:"POI frequent",POINT_OF_INTEREST_INFREQUENT:"POI infrequent",LABELER:"labeler",FEATURE_QUERY_ENGINE:"feature query",FEATURE_TILE_TREE:"feature tile tree",FEATURE_TILE_TREE_ACTIVE:"fast feature tile tree",ELEVATION_ALIGNMENT:"elevation alignment",ELEVATION_ALIGNMENT_SCENE:"elevation alignment scene",TEXT_TEXTURE_ATLAS:"text texture atlas",TEXTURE_UNLOAD:"texture unload",LINE_OF_SIGHT_TOOL:"line of sight tool",LINE_OF_SIGHT_TOOL_INTERACTIVE:"interactive line of sight tool",ELEVATION_PROFILE:"elevation profile",SNAPPING:"snapping",SHADOW_ACCUMULATOR:"shadow accumulator",CLOUDS_GENERATOR:"clouds generator",FLOW_GENERATOR:"flow generator",MAPVIEW_FETCH_QUEUE:"mapview fetch queue",MAPVIEW_LAYERVIEW_UPDATE:"mapview layerview update",MAPVIEW_VECTOR_TILE_PARSING_QUEUE:"mapview vector tile parsing queue",NONE:0,TEST_PRIO:1},m=new Map([[f.RESOURCE_CONTROLLER_IMMEDIATE,0],[f.RESOURCE_CONTROLLER,4],[f.SLIDE,0],[f.STREAM_DATA_LOADER,0],[f.ELEVATION_QUERY,0],[f.TERRAIN_SURFACE,1],[f.SURFACE_GEOMETRY_UPDATES,1],[f.LOD_RENDERER,2],[f.GRAPHICS_CORE,2],[f.I3S_CONTROLLER,2],[f.POINT_CLOUD_LAYER,2],[f.FEATURE_TILE_FETCHER,2],[f.STREAM_CONTROLLER,2],[f.CLOUDS_GENERATOR,2],[f.OVERLAY,4],[f.OVERLAY_RENDERER,4],[f.STAGE,4],[f.GRAPHICS_DECONFLICTOR,4],[f.FILTER_VISIBILITY,4],[f.SCALE_VISIBILITY,4],[f.FRUSTUM_VISIBILITY,4],[f.POINT_OF_INTEREST_FREQUENT,6],[f.POINT_OF_INTEREST_INFREQUENT,30],[f.LABELER,8],[f.FEATURE_QUERY_ENGINE,8],[f.FEATURE_TILE_TREE,16],[f.FEATURE_TILE_TREE_ACTIVE,0],[f.ELEVATION_ALIGNMENT,12],[f.ELEVATION_ALIGNMENT_SCENE,14],[f.TEXT_TEXTURE_ATLAS,12],[f.TEXTURE_UNLOAD,12],[f.LINE_OF_SIGHT_TOOL,16],[f.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[f.SNAPPING,0],[f.SHADOW_ACCUMULATOR,30],[f.FLOW_GENERATOR,12],[f.MAPVIEW_FETCH_QUEUE,0],[f.MAPVIEW_LAYERVIEW_UPDATE,2],[f.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function y(e){return m.has(e)?m.get(e):"number"==typeof e?e:1}const g=u.Milliseconds(6.5),b=u.Milliseconds(1),_=u.Milliseconds(30),v=u.Milliseconds(1e3/30),S=u.Milliseconds(100);class x{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(e=>e.needsUpdate)}constructor(){this._updating=c.signal(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new n("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new M,this._state=1,this._tasks=new Array,this._runQueue=new Array,this._load=0,this._idleStateCallbacks=new Array,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=l.watch(()=>p.SCHEDULER_LOG_SLOW_TASKS,e=>this._debug=e,l.initial);for(const e of Object.keys(f))this.performanceInfo.tasks.set(f[e],new n(String(f[e])))}destroy(){this._tasks.forEach(e=>e.remove()),this._tasks.length=0,this._idleStateCallbacks.length=0,this._runQueue.length=0,s.removeMaybe(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())}))}registerTask(e,t){const r=new w(this,e,t);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new n(e)),r}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),2===this.state&&this._idleUpdatesStartFired&&r.idleBegin();const i=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){i._idleUpdatesStartFired&&(r.idleEnd(),2===i._state&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forEach(e=>e.idleEnd())))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=g,r=e.frameDuration,i=b;switch(this.state){case 2:t=u.Milliseconds(0),r=u.Milliseconds(Math.max(S,e.frameDuration)),i=_;break;case 1:r=u.Milliseconds(Math.max(v,e.frameDuration))}return r=u.Milliseconds(r-e.elapsedFrameTime-t),2!==this.state&&r<b&&!this._forceTask?(this._forceTask=!0,!1):(r=u.Milliseconds(Math.max(r,i)),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forEach(e=>e.idleBegin())),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(u.Milliseconds(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),t.removeUnordered(this._idleStateCallbacks,e)}removeTask(e){t.removeUnordered(this._tasks,e),t.removeUnordered(this._runQueue,e),this._updatingChanged()}_updateTask(e){this._tasks.forEach(t=>{t.name===e&&t.setPriority(e)})}_getState(e){if(this._runQueue.some(t=>t.name===e))return"s";let t="i";return this._tasks.forEach(r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t="r":"r"!==t&&(t="w"))}),t}_getRuntime(e){let t=0;return this._tasks.forEach(r=>{r.name===e&&(t+=r.runtime)}),t}_resetRuntimes(){this._tasks.forEach(e=>e.runtime=0)}_getRunning(){const e=new Map;if(this._tasks.forEach(t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)}),0===e.size)return null;let t="";return e.forEach((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`}),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce((e,t)=>t.needsUpdate?++e:e,0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(t.filterInPlace(this._runQueue,e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)),this._tasks.forEach(e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)});0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forEach(r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)}),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const e=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.task.runTask(this._budget)===h.Yield&&(t.blockFrame=this._frameNumber)}catch(e){o.getLogger("esri.views.support.Scheduler").error(`Exception in task "${t.name}"`,e),t.blockFrame=this._frameNumber}!this._budget.hasProgressed&&t.blockFrame!==this._frameNumber&&t.needsUpdate&&(t.name,t.blockFrame=this._frameNumber),t.schedulePriority=t.basePriority;const r=this._budget.now()-e;if(t.runtime+=r,this._frameTaskTimes.set(t.priority,this._frameTaskTimes.get(t.priority)+r),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(f))this._frameTaskTimes.set(f[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach((e,t)=>this.performanceInfo.tasks.get(t).push(e)),this.performanceInfo.total.push(e)}get test(){return this._test}}class w{get task(){return this._task.value}get readyToRun(){return this._queue.readyToRun}get updating(){return this._queue.updating}constructor(e,t,i){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new d.PromiseQueue,this._handles=new r,this._basePriority=y(t),this.schedulePriority=this._basePriority,this._task=c.signal(null!=i?i:this._queue),this._handles.add(l.when(()=>this.task.readyToRun,t=>e.taskRunningChanged(t)))}remove(){this.processQueue(T),this._scheduler.removeTask(this),this.schedule=P.schedule,this.reschedule=P.reschedule,this.scheduleGenerator=P.scheduleGenerator,this.rescheduleGenerator=P.rescheduleGenerator,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=y(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.readyToRun||!this.task.destroyed&&this.task.readyToRun}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}scheduleGenerator(e,t,r){return this._queue.pushGenerator(e,t,r)}rescheduleGenerator(e,t,r){return this._queue.unshiftGenerator(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class M{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}const T=new M;T.enabled=!1;const P=new class{remove(){}processQueue(){}schedule(e,t,r){try{if(a.isAborted(t)){const e=a.createAbortError();return r?Promise.resolve(r(e)):Promise.reject(e)}return a.when(e(T))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}async scheduleGenerator(e,t,r){if(a.isAborted(t)){const e=a.createAbortError();if(r)return r(e);throw e}const i=e(T);for(;;){const e=i.next(T),o=a.isPromiseLike(e)?await e:e;if(a.isAborted(t)){const e=a.createAbortError();if(r)return r(e);throw e}if(o.done)return o.value}}rescheduleGenerator(e,t,r){return this.rescheduleGenerator(e,t,r)}};e.ImmediateTask=P,e.TaskPriority=f,e.getTaskPriority=y,e.makeBudget=function(e){const t=new M;return t.reset(e),t},e.newScheduler=function(){return new x},e.noBudget=T,e.taskPriorities=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/signal":function(){define(["exports","./lang","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t,r,i){"use strict";class o{constructor(e,t){this._observable=new i.SimpleObservable,this._value=e,this._equalityFunction=t}get value(){return r.trackAccess(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}}e.signal=function(e,r=t.equalsShallow){return new o(e,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/compilerUtils","../../core/Logger","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(e,t,r,i,o,s){"use strict";function n(e){i.isPromiseLike(e)?e.then(a):a(e)}function a(e){e.done||r.getLogger("esri.layers.support.PromiseQueue").warn("Generator iterator was aborted, but it is not done.")}class l{constructor(e,t,r=void 0,i=void 0){this.resolve=e,this.reject=t,this.signal=r,this.abortCallback=i}}class c extends l{constructor(e,t,r,i,o){super(e,t,i,o),this.callback=r,this.type=0}}class u extends l{constructor(e,t,r,i,o,s){super(e,t,i,o),this.generatorFunction=r,this.scheduleFunction=s,this.type=1}}class d extends l{constructor(e,t,r,i,o,s){super(e,t,i,o),this.iterator=r,this.scheduleFunction=s,this.type=2}}e.PromiseQueue=class{constructor(){this._tasks=new Array,this._numPendingTasks=o.signal(0),this._readyToRun=o.signal(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get readyToRun(){return this._readyToRun.value}_updateReadyToRun(){this._readyToRun.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return s.Yield;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return this._addTask((i,o)=>new c(i,o,e,t,r),Array.prototype.push)}unshift(e,t,r){return this._addTask((i,o)=>new c(i,o,e,t,r),Array.prototype.unshift)}pushGenerator(e,t,r){const i=Array.prototype.push;return this._addTask((o,s)=>new u(o,s,e,t,r,i),i)}unshiftGenerator(e,t,r){const i=Array.prototype.unshift;return this._addTask((o,s)=>new u(o,s,e,t,r,i),i)}_process(e){if(0===this._tasks.length)return!1;const r=this._tasks.shift();this._updateReadyToRun();try{if(i.isAborted(r.signal))this._cancelTask(r,i.createAbortError());else switch(r.type){case 0:this._processSimple(r,e);break;case 1:this._processGenerator(r,e);break;case 2:this._processIterator(r,e);break;default:t.neverReached(r)}}catch(e){r.reject(e)}return!0}cancelAll(){const e=i.createAbortError();for(const t of this._tasks)this._cancelTask(t,e);this._tasks.length=0,this._updateReadyToRun()}_cancelTask(e,t){if(e.abortCallback){const r=e.abortCallback(t);2===e.type&&e.iterator.return&&n(e.iterator.return()),i.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}else 2===e.type&&e.iterator.throw&&n(e.iterator.throw(t)),e.reject(t)}_onIteratorResult(e,t){t.done?e.resolve(t.value):(e.scheduleFunction.call(this._tasks,e),this._updateReadyToRun())}_processSimple(e,t){const r=e.callback(t);i.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}_processGenerator(e,t){const r=e.generatorFunction(t),i=new d(e.resolve,e.reject,r,e.signal,e.abortCallback,e.scheduleFunction);this._processIterator(i,t)}_processIterator(e,t){const r=e.iterator.next(t);i.isPromiseLike(r)?r.then(t=>this._onIteratorResult(e,t),e.reject):this._onIteratorResult(e,r)}_addTask(e,t){return new Promise((r,i)=>{const o=e(r,i);t.call(this._tasks,o),++this._numPendingTasks.value,this._updateReadyToRun()}).finally(()=>--this._numPendingTasks.value)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Yield":function(){define(["exports"],function(e){"use strict";const t=Symbol("Yield");e.Yield=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";let a=class extends t{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};return e.__decorate([r.property()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),e.__decorate([r.property()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=e.__decorate([n.subclass("esri.views.support.debugFlags")],a),new a})},"esri/views/3d/layers/graphics/pipeline/FeatureProcessingContext":function(){define(["exports","../../../../../renderers/support/jsonUtils","./PipelineCommand","./symbolization/factoryUtils","./symbolization/IconSymbolLayerRenderer","./symbolization/Point3DSymbolRenderer","./symbolization/SimpleFeatureRenderer","./symbolization/UniqueValueFeatureRenderer"],function(e,t,r,i,o,s,n,a){"use strict";class l{constructor(e){this.context=e}createSymbolRendererFromJSON(e){const r=t.read(e??c)??void 0;if(!r)throw new Error("Failed to create renderer");const i=r.type;switch(i){case"simple":return new n.SimpleFeatureRenderer(r,this.context);case"unique-value":return new a.UniqueValueFeatureRenderer(r,this.context);default:return console.warn(`Unable to create symbolrenderer for renderer of ${i}`),this.createSymbolRendererFromJSON(c)}}createSymbolRendererFromSymbol(e){const t=e?.type;switch(t){case"point-3d":return new s.Point3DSymbolRenderer(e,this.context);case"picture-marker":case"simple-marker":return new o.IconSymbolLayerRenderer(i.createDefaultIconSymbolLayer(),this.context);default:return console.warn(`Unable to create symbolrenderer for symbol of ${t}`),null}}createSymbolRendererFromSymbolLayer(e){const t=e.type;return"icon"===t?new o.IconSymbolLayerRenderer(e,this.context):(console.warn(`Unable to create symbolrenderer for symbolLayer of ${t}`),null)}}const c={type:"simple"};e.FeatureProcessingContext=class{constructor(e,t,r,i,o,s,n){this.viewSpatialReference=e,this.renderSpatialReference=t,this.mainThreadDelegate=r,this.renderCoordsHelper=i,this.renderCommandContext=o,this.layerInfo=s,this.layerViewInfo=n,this.symbolRendererFactory=new l(this)}createPipelineCommand(e=this.renderCommandContext.createRenderCommandBuffer(),t=[]){return new r.PipelineCommand(this.renderCommandContext,e,t)}joinPipelineCommands(e){return 0===e.length?this.createPipelineCommand():e.filter(e=>null!=e).reduce((e,t)=>(e.append(t),e))}},e.SymbolRendererFactory=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/jsonUtils":function(){define(["exports","../../core/Warning","../../core/accessorSupport/extensions/serializableProperty/reader","./typeUtils"],function(e,t,r,i){"use strict";const o=r.createTypeReader({types:i.rendererTypes});function s(e,r,i){return e?e&&(e.styleName||e.styleUrl)&&"uniqueValue"!==e.type?(i?.messages&&i.messages.push(new t("renderer:unsupported","Only UniqueValueRenderer can be referenced from a web style, but found '"+e.type+"'",{definition:e,context:i})),null):o(e,r,i):null}e.fromJSON=function(e,t){return s(e,null,t)},e.read=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/typeUtils":function(){define(["exports","../../core/Logger","../ClassBreaksRenderer","../DictionaryRenderer","../DotDensityRenderer","../HeatmapRenderer","../PieChartRenderer","../Renderer","../SimpleRenderer","../UniqueValueRenderer"],function(e,t,r,i,o,s,n,a,l,c){"use strict";const u={key:"type",base:a,typeMap:{heatmap:s,simple:l,"unique-value":c,"class-breaks":r,"dot-density":o,dictionary:i,"pie-chart":n},errorContext:"renderer"},d={key:"type",base:a,typeMap:{simple:l,"unique-value":c,"class-breaks":r,heatmap:s},errorContext:"renderer",validate:function(e){switch(e.type){case"simple":return function(e){if(e.symbol)return e;t.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}(e);case"unique-value":return function(e){const r=e.uniqueValueInfos,i=r?.filter(({symbol:e,label:r},i)=>(e||t.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${i}] ${r}) without a symbol from web scene.`),!!e));return i?.length!==r?.length&&(e.uniqueValueInfos=i),e}(e);case"class-breaks":return function(e){const r=e.classBreakInfos,i=r?.filter(({symbol:e,label:r},i)=>(e||t.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${i}] ${r}) without a symbol from web scene.`),!!e));return i?.length!==r?.length&&(e.classBreakInfos=i),e}(e);case"heatmap":return e}}};e.isRenderer=function(e){return e instanceof a},e.rendererTypes=u,e.webSceneRendererTypes=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/ClassBreaksRenderer":function(){define(["exports","../chunks/tslib.es6","../core/jsonMap","../core/lang","../core/Logger","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../core/accessorSupport/ensureType","../layers/support/fieldUtils","./Renderer","./mixins/VisualVariablesMixin","./support/ClassBreakInfo","./support/commonProperties","./support/RendererLegendOptions","../support/loadArcade","../symbols/support/typeUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_){"use strict";var v;const S="percent-of-total",x="field",w=new r.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:S,esriNormalizeByField:x}),M=d.ensureType(m);return e.default=v=class extends(f.VisualVariablesMixin(h)){constructor(e){super(e),this._compiledValueExpression={valueExpression:null,compiledFunction:null},this.backgroundFillSymbol=null,this.classBreakInfos=null,this.defaultLabel=null,this.defaultSymbol=null,this.field=null,this.isMaxInclusive=!0,this.legendOptions=null,this.normalizationField=null,this.normalizationTotal=null,this.type="class-breaks",this.valueExpression=null,this.valueExpressionTitle=null,this._set("classBreakInfos",[])}readClassBreakInfos(e,t,r){if(!Array.isArray(e))return;let i=t.minValue;return e.map(e=>{const t=new m;return t.read(e,r),null==t.minValue&&(t.minValue=i),null==t.maxValue&&(t.maxValue=t.minValue),i=t.maxValue,t})}writeClassBreakInfos(e,t,r,i){const o=e.map(e=>e.write({},i));this._areClassBreaksConsecutive()&&o.forEach(e=>delete e.classMinValue),t[r]=o}castField(e){return null==e?e:"function"==typeof e?(o.getLogger(this).error(".field: field must be a string value"),null):d.ensureString(e)}get minValue(){return this.classBreakInfos&&this.classBreakInfos[0]&&this.classBreakInfos[0].minValue||0}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&x||r&&S||null,t&&r&&o.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==x&&e!==S||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}addClassBreakInfo(e,t,r){let o=null;o="number"==typeof e?new m({minValue:e,maxValue:t,symbol:_.ensureType(r)}):M(i.clone(e)),this.classBreakInfos.push(o),1===this.classBreakInfos.length&&this.notifyChange("minValue")}removeClassBreakInfo(e,t){const r=this.classBreakInfos.length;for(let i=0;i<r;i++){const r=[this.classBreakInfos[i].minValue,this.classBreakInfos[i].maxValue];if(r[0]===e&&r[1]===t){this.classBreakInfos.splice(i,1);break}}}getBreakIndex(e,t){return this.valueExpression&&null==t?.arcade&&o.getLogger(this).warn(""),this.valueExpression?this._getBreakIndexForExpression(e,t):this._getBreakIndexForField(e)}async getClassBreakInfo(e,t){let r=t;this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await b.loadArcade()});const i=this.getBreakIndex(e,r);return-1!==i?this.classBreakInfos[i]:null}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void o.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this.getBreakIndex(e,t);return r>-1?this.classBreakInfos[r].symbol:this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==t?.arcade){const e=await b.loadArcade(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this.getBreakIndex(e,r);return i>-1?this.classBreakInfos[i].symbol:this.defaultSymbol}get symbols(){const e=[];return this.classBreakInfos.forEach(t=>{t.symbol&&e.push(t.symbol)}),this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=`${this.normalizationField}.${this.normalizationType}.${this.normalizationTotal}`;return`${e}.${t}.${this.classBreakInfos.reduce((e,t)=>e+t.getMeshHash(),"")}.${r}.${this.field}.${this.valueExpression}`}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}clone(){return new v({field:this.field,backgroundFillSymbol:this.backgroundFillSymbol?.clone(),defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol?.clone(),valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,classBreakInfos:i.clone(this.classBreakInfos),isMaxInclusive:this.isMaxInclusive,normalizationField:this.normalizationField,normalizationTotal:this.normalizationTotal,normalizationType:this.normalizationType,visualVariables:i.clone(this.visualVariables),legendOptions:i.clone(this.legendOptions),authoringInfo:i.clone(this.authoringInfo)})}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.symbols.map(r=>r.collectRequiredFields(e,t)),p.collectArcadeFieldNames(e,t,this.valueExpression)];p.collectField(e,t,this.field),p.collectField(e,t,this.normalizationField),await Promise.all(r)}_getBreakIndexForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:o,arcade:s,timeZone:n}=t??{},{valueExpression:a}=this;let l=this._compiledValueExpression.valueExpression===a?this._compiledValueExpression.compiledFunction:null;const c=s.arcadeUtils;if(!l){const e=c.createSyntaxTree(a);l=c.createFunction(e),this._compiledValueExpression.compiledFunction=l}this._compiledValueExpression.valueExpression=a;const u=c.executeFunction(l,c.createExecContext(e,c.getViewInfo({viewingMode:r,scale:i,spatialReference:o}),n));return this._getBreakIndexfromInfos(u)}_getBreakIndexForField(e){const t=this.field,r=e.attributes,i=this.normalizationType;let o=parseFloat(r[t]);if(i){const e=this.normalizationTotal,t=parseFloat(this.normalizationField?r[this.normalizationField]:void 0);if("log"===i)o=Math.log(o)*Math.LOG10E;else if(i!==S||null==e||isNaN(e)){if(i===x&&!isNaN(t)){if(isNaN(o)||isNaN(t))return-1;o/=t}}else o=o/e*100}return this._getBreakIndexfromInfos(o)}_getBreakIndexfromInfos(e){const t=this.isMaxInclusive;if(null!=e&&"number"==typeof e&&!isNaN(e))for(let r=0;r<this.classBreakInfos.length;r++){const i=[this.classBreakInfos[r].minValue,this.classBreakInfos[r].maxValue];if(i[0]<=e&&(t?e<=i[1]:e<i[1]))return r}return-1}_areClassBreaksConsecutive(){const e=this.classBreakInfos,t=e.length;for(let r=1;r<t;r++)if(e[r-1].maxValue!==e[r].minValue)return!1;return!0}},t.__decorate([s.property(y.rendererBackgroundFillSymbolProperty)],e.default.prototype,"backgroundFillSymbol",void 0),t.__decorate([s.property({type:[m],json:{write:{isRequired:!0}}})],e.default.prototype,"classBreakInfos",void 0),t.__decorate([l.reader("classBreakInfos")],e.default.prototype,"readClassBreakInfos",null),t.__decorate([u.writer("classBreakInfos")],e.default.prototype,"writeClassBreakInfos",null),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"defaultLabel",void 0),t.__decorate([s.property(y.rendererSymbolProperty)],e.default.prototype,"defaultSymbol",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"field",void 0),t.__decorate([n.cast("field")],e.default.prototype,"castField",null),t.__decorate([s.property({type:Boolean})],e.default.prototype,"isMaxInclusive",void 0),t.__decorate([s.property({type:g,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([s.property({type:Number,readOnly:!0,value:null,json:{read:!1,write:{overridePolicy(){return 0!==this.classBreakInfos.length&&this._areClassBreaksConsecutive()?{enabled:!0}:{enabled:!1}}}}})],e.default.prototype,"minValue",null),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"normalizationTotal",void 0),t.__decorate([s.property({type:w.apiValues,value:null,json:{type:w.jsonValues,read:w.read,write:w.write}})],e.default.prototype,"normalizationType",null),t.__decorate([a.enumeration({classBreaks:"class-breaks"})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpression",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpressionTitle",void 0),e.default=v=t.__decorate([c.subclass("esri.renderers.ClassBreaksRenderer")],e.default),e.default})},"esri/renderers/Renderer":function(){define(["exports","../chunks/tslib.es6","../core/jsonMap","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./support/AuthoringInfo"],function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=new r.JSONMap({simple:"simple",uniqueValue:"unique-value",classBreaks:"class-breaks",heatmap:"heatmap",dotDensity:"dot-density",dictionary:"dictionary",pieChart:"pie-chart"},{ignoreUnknown:!0});return e.default=class extends i.JSONSupport{constructor(e){super(e),this.authoringInfo=null,this.type=null}async getRequiredFields(e){if(!this.collectRequiredFields)return[];const t=new Set;return await this.collectRequiredFields(t,e),Array.from(t).sort()}getSymbol(e,t){}async getSymbolAsync(e,t){}get symbols(){return[]}get arcadeRequired(){return!1}getAttributeHash(){return JSON.stringify(this)}getMeshHash(){return JSON.stringify(this)}},t.__decorate([o.property({type:c,json:{write:!0}})],e.default.prototype,"authoringInfo",void 0),t.__decorate([o.property({type:u.apiValues,readOnly:!0,json:{type:u.jsonValues,read:!1,write:{writer:u.write,ignoreOrigin:!0,isRequired:!0}}})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.renderers.Renderer")],e.default),e.default})},"esri/renderers/support/AuthoringInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","./AuthoringInfoFieldInfo","./AuthoringInfoVisualVariable","../../rest/support/colorRamps"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=new r.JSONMap({esriClassifyDefinedInterval:"defined-interval",esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation"}),f=new r.JSONMap({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density",flow:"flow"}),m=new r.JSONMap({classedSize:"class-breaks-size",classedColor:"class-breaks-color",univariateColorSize:"univariate-color-size",relationship:"relationship",predominance:"predominance",dotDensity:"dot-density"}),y=["inches","feet","yards","miles","nautical-miles","millimeters","centimeters","decimeters","meters","kilometers"];return e.default=p=class extends i.JSONSupport{constructor(e){super(e),this.colorRamp=null,this.fadeRatio=null,this.isAutoGenerated=!1,this.lengthUnit=null,this.maxSliderValue=null,this.minSliderValue=null,this.visualVariables=null}get classificationMethod(){const e=this._get("classificationMethod"),t=this.type;return t&&"relationship"!==t?"class-breaks-size"===t||"class-breaks-color"===t?e||"manual":null:e}set classificationMethod(e){this._set("classificationMethod",e)}readColorRamp(e){return e?d.fromJSON(e):void 0}get fields(){return this.type&&"predominance"!==this.type?null:this._get("fields")}set fields(e){this._set("fields",e)}get field1(){return this.type&&"relationship"!==this.type?null:this._get("field1")}set field1(e){this._set("field1",e)}get field2(){return this.type&&"relationship"!==this.type?null:this._get("field2")}set field2(e){this._set("field2",e)}get flowTheme(){return"flow"===this.type?this._get("flowTheme"):null}set flowTheme(e){this._set("flowTheme",e)}get focus(){return this.type&&"relationship"!==this.type?null:this._get("focus")}set focus(e){this._set("focus",e)}get numClasses(){return this.type&&"relationship"!==this.type?null:this._get("numClasses")}set numClasses(e){this._set("numClasses",e)}get statistics(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("statistics"):null}set statistics(e){this._set("statistics",e)}get standardDeviationInterval(){const e=this.type;return e&&"relationship"!==e&&"class-breaks-size"!==e&&"class-breaks-color"!==e||this.classificationMethod&&"standard-deviation"!==this.classificationMethod?null:this._get("standardDeviationInterval")}set standardDeviationInterval(e){this._set("standardDeviationInterval",e)}get type(){return this._get("type")}set type(e){let t=e;"classed-size"===e?t="class-breaks-size":"classed-color"===e&&(t="class-breaks-color"),this._set("type",t)}get univariateSymbolStyle(){return"univariate-color-size"===this.type&&"above-and-below"===this.univariateTheme?this._get("univariateSymbolStyle"):null}set univariateSymbolStyle(e){this._set("univariateSymbolStyle",e)}get univariateTheme(){return"univariate-color-size"===this.type?this._get("univariateTheme"):null}set univariateTheme(e){this._set("univariateTheme",e)}clone(){return new p({classificationMethod:this.classificationMethod,colorRamp:o.clone(this.colorRamp),fadeRatio:o.clone(this.fadeRatio),fields:this.fields?.slice(),field1:o.clone(this.field1),field2:o.clone(this.field2),isAutoGenerated:this.isAutoGenerated,focus:this.focus,numClasses:this.numClasses,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,lengthUnit:this.lengthUnit,statistics:this.statistics,standardDeviationInterval:this.standardDeviationInterval,type:this.type,visualVariables:this.visualVariables&&this.visualVariables.map(e=>e.clone()),univariateSymbolStyle:this.univariateSymbolStyle,univariateTheme:this.univariateTheme,flowTheme:this.flowTheme})}},t.__decorate([s.property({type:h.apiValues,value:null,json:{type:h.jsonValues,read:h.read,write:h.write,origins:{"web-document":{default:"manual",type:h.jsonValues,read:h.read,write:h.write}}}})],e.default.prototype,"classificationMethod",null),t.__decorate([s.property({types:d.types,json:{write:!0}})],e.default.prototype,"colorRamp",void 0),t.__decorate([a.reader("colorRamp")],e.default.prototype,"readColorRamp",null),t.__decorate([s.property({json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"fadeRatio",void 0),t.__decorate([s.property({type:[String],value:null,json:{write:!0}})],e.default.prototype,"fields",null),t.__decorate([s.property({type:c.AuthoringInfoFieldInfo,value:null,json:{write:!0}})],e.default.prototype,"field1",null),t.__decorate([s.property({type:c.AuthoringInfoFieldInfo,value:null,json:{write:!0}})],e.default.prototype,"field2",null),t.__decorate([s.property({type:["flow-line","wave-front"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"flowTheme",null),t.__decorate([s.property({type:["HH","HL","LH","LL"],value:null,json:{write:!0}})],e.default.prototype,"focus",null),t.__decorate([s.property({type:Boolean,json:{write:!0,default:!1,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"isAutoGenerated",void 0),t.__decorate([s.property({type:Number,value:null,json:{type:n.Integer,write:!0}})],e.default.prototype,"numClasses",null),t.__decorate([s.property({type:y,json:{type:y,read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],e.default.prototype,"lengthUnit",void 0),t.__decorate([s.property({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"maxSliderValue",void 0),t.__decorate([s.property({type:Number,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"minSliderValue",void 0),t.__decorate([s.property({type:Object,value:null,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"statistics",null),t.__decorate([s.property({type:[.25,.33,.5,1],value:null,json:{type:[.25,.33,.5,1],write:!0}})],e.default.prototype,"standardDeviationInterval",null),t.__decorate([s.property({type:f.apiValues,value:null,json:{type:f.jsonValues,read:f.read,write:f.write,origins:{"web-scene":{type:m.jsonValues,write:{writer:m.write,overridePolicy:e=>({enabled:"flow"!==e})}}}}})],e.default.prototype,"type",null),t.__decorate([s.property({type:[u],json:{write:!0}})],e.default.prototype,"visualVariables",void 0),t.__decorate([s.property({type:["caret","circle-caret","arrow","circle-arrow","plus-minus","circle-plus-minus","square","circle","triangle","happy-sad","thumb","custom"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"univariateSymbolStyle",null),t.__decorate([s.property({type:["high-to-low","above-and-below","above","below"],value:null,json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"univariateTheme",null),e.default=p=t.__decorate([l.subclass("esri.renderers.support.AuthoringInfo")],e.default),e.default})},"esri/renderers/support/AuthoringInfoFieldInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./AuthoringInfoClassBreakInfo"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;e.AuthoringInfoFieldInfo=c=class extends r.JSONSupport{constructor(e){super(e),this.field="",this.normalizationField="",this.label="",this.classBreakInfos=new Array}clone(){return new c({field:this.field,normalizationField:this.normalizationField,label:this.label,classBreakInfos:i.clone(this.classBreakInfos)})}},t.__decorate([o.property({type:String,json:{write:!0}})],e.AuthoringInfoFieldInfo.prototype,"field",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.AuthoringInfoFieldInfo.prototype,"normalizationField",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.AuthoringInfoFieldInfo.prototype,"label",void 0),t.__decorate([o.property({type:[l.AuthoringInfoClassBreakInfo],json:{write:!0}})],e.AuthoringInfoFieldInfo.prototype,"classBreakInfos",void 0),e.AuthoringInfoFieldInfo=c=t.__decorate([a.subclass("esri.renderers.support.AuthoringInfoFieldInfo")],e.AuthoringInfoFieldInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/AuthoringInfoClassBreakInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";var l;e.AuthoringInfoClassBreakInfo=l=class extends r.JSONSupport{constructor(e){super(e),this.minValue=0,this.maxValue=0}clone(){return new l({minValue:this.minValue,maxValue:this.maxValue})}},t.__decorate([i.property({type:Number,json:{write:!0}})],e.AuthoringInfoClassBreakInfo.prototype,"minValue",void 0),t.__decorate([i.property({type:Number,json:{write:!0}})],e.AuthoringInfoClassBreakInfo.prototype,"maxValue",void 0),e.AuthoringInfoClassBreakInfo=l=t.__decorate([a.subclass("esri.renderers.support.AuthoringInfoClassBreakInfo")],e.AuthoringInfoClassBreakInfo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/AuthoringInfoVisualVariable":function(){define(["../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","./AuthoringInfoSizeStop"],function(e,t,r,i,o,s,n,a){"use strict";var l;const c=new t.JSONMap({percentTotal:"percent-of-total",ratio:"ratio",percent:"percent"}),u=new t.JSONMap({sizeInfo:"size",colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation"}),d={key:e=>"number"==typeof e?"number":"string",typeMap:{number:Number,string:String},base:null},p=["high-to-low","above-and-below","centered-on","extremes"],h=[...new Set(["high-to-low","above-and-below","centered-on","extremes","above","below","high-to-low","above-and-below","above","below","reference-size","spike"])],f=["seconds","minutes","hours","days","months","years"];let m=l=class extends r.JSONSupport{constructor(e){super(e),this.endTime=null,this.field=null,this.maxSliderValue=null,this.minSliderValue=null,this.startTime=null,this.type=null,this.units=null}castEndTime(e){return"string"==typeof e||"number"==typeof e?e:null}get normalizationField(){return"reference-size"===this.theme||"spike"===this.theme?this._get("normalizationField"):null}set normalizationField(e){this._set("normalizationField",e)}get referenceSizeScale(){return"reference-size"===this.theme?this._get("referenceSizeScale"):null}set referenceSizeScale(e){this._set("referenceSizeScale",e)}get referenceSizeSymbolStyle(){return"reference-size"===this.theme?this._get("referenceSizeSymbolStyle"):null}set referenceSizeSymbolStyle(e){this._set("referenceSizeSymbolStyle",e)}get spikeSymbolStyle(){return"spike"===this.theme?this._get("spikeSymbolStyle"):null}set spikeSymbolStyle(e){this._set("spikeSymbolStyle",e)}castStartTime(e){return"string"==typeof e||"number"==typeof e?e:null}get sizeStops(){return"reference-size"===this.theme||"spike"===this.theme?this._get("sizeStops"):null}set sizeStops(e){this._set("sizeStops",e)}get style(){return"color"===this.type?this._get("style"):null}set style(e){this._set("style",e)}get theme(){return"color"===this.type||"size"===this.type?this._get("theme")||"high-to-low":null}set theme(e){this._set("theme",e)}clone(){return new l({endTime:this.endTime,field:this.field,maxSliderValue:this.maxSliderValue,minSliderValue:this.minSliderValue,normalizationField:this.normalizationField,referenceSizeScale:this.referenceSizeScale,referenceSizeSymbolStyle:this.referenceSizeSymbolStyle,spikeSymbolStyle:this.spikeSymbolStyle,sizeStops:i.clone(this.sizeStops),startTime:this.startTime,style:this.style,theme:this.theme,type:this.type,units:this.units})}};return e.__decorate([o.property({types:d,json:{write:!0}})],m.prototype,"endTime",void 0),e.__decorate([s.cast("endTime")],m.prototype,"castEndTime",null),e.__decorate([o.property({type:String,json:{write:!0}})],m.prototype,"field",void 0),e.__decorate([o.property({type:Number,json:{write:!0}})],m.prototype,"maxSliderValue",void 0),e.__decorate([o.property({type:Number,json:{write:!0}})],m.prototype,"minSliderValue",void 0),e.__decorate([o.property({type:String,json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"normalizationField",null),e.__decorate([o.property({type:Number,value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"referenceSizeScale",null),e.__decorate([o.property({type:["circle","diamond","hexagon-flat","hexagon-pointy","square"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"referenceSizeSymbolStyle",null),e.__decorate([o.property({type:["triangle-closed-outline","triangle-gradient-fill-closed","triangle-gradient-fill-closed-outline","triangle-gradient-fill-open","triangle-gradient-fill-open-outline","triangle-open-outline","triangle-solid-fill-closed","triangle-solid-fill-closed-outline","triangle-solid-fill-open","triangle-solid-fill-open-outline"],value:null,json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"spikeSymbolStyle",null),e.__decorate([o.property({types:d,json:{write:!0}})],m.prototype,"startTime",void 0),e.__decorate([s.cast("startTime")],m.prototype,"castStartTime",null),e.__decorate([o.property({type:[a],json:{origins:{"web-scene":{write:!1}},write:!0}})],m.prototype,"sizeStops",null),e.__decorate([o.property({type:c.apiValues,value:null,json:{type:c.jsonValues,read:c.read,write:c.write}})],m.prototype,"style",null),e.__decorate([o.property({type:h,value:null,json:{type:h,origins:{"web-scene":{type:p,write:{writer:(e,t)=>{p.includes(e)&&(t.theme=e)}}}},write:!0}})],m.prototype,"theme",null),e.__decorate([o.property({type:u.apiValues,json:{type:u.jsonValues,read:u.read,write:u.write}})],m.prototype,"type",void 0),e.__decorate([o.property({type:f,json:{type:f,write:!0}})],m.prototype,"units",void 0),m=l=e.__decorate([n.subclass("esri.renderers.support.AuthoringInfoVisualVariable")],m),m})},"esri/renderers/support/AuthoringInfoSizeStop":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t.JSONSupport{constructor(e){super(e),this.label=null,this.size=null,this.value=null}clone(){return new a({label:this.label,value:this.value,size:this.size})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"label",void 0),e.__decorate([r.property({type:Number,json:{write:!0}})],l.prototype,"size",void 0),e.__decorate([r.property({type:Number,json:{write:!0}})],l.prototype,"value",void 0),l=a=e.__decorate([n.subclass("esri.renderers.support.AuthoringInfoSizeStop")],l),l})},"esri/rest/support/colorRamps":function(){define(["exports","./AlgorithmicColorRamp","./ColorRamp","./MultipartColorRamp"],function(e,t,r,i){"use strict";const o={key:"type",base:r,typeMap:{algorithmic:t,multipart:i}};e.fromJSON=function(e){return e?.type?"algorithmic"===e.type?t.fromJSON(e):"multipart"===e.type?i.fromJSON(e):null:null},e.types=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/AlgorithmicColorRamp":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/lang","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./ColorRamp"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends l{constructor(e){super(e),this.algorithm=null,this.fromColor=null,this.toColor=null,this.type="algorithmic"}clone(){return new c({fromColor:i.clone(this.fromColor),toColor:i.clone(this.toColor),algorithm:this.algorithm})}},t.__decorate([n.enumeration({esriCIELabAlgorithm:"cie-lab",esriHSVAlgorithm:"hsv",esriLabLChAlgorithm:"lab-lch"})],e.default.prototype,"algorithm",void 0),t.__decorate([o.property({type:r,json:{type:[s.Integer],write:{isRequired:!0}}})],e.default.prototype,"fromColor",void 0),t.__decorate([o.property({type:r,json:{type:[s.Integer],write:{isRequired:!0}}})],e.default.prototype,"toColor",void 0),t.__decorate([o.property({type:["algorithmic"],json:{write:{isRequired:!0}}})],e.default.prototype,"type",void 0),e.default=c=t.__decorate([a.subclass("esri.rest.support.AlgorithmicColorRamp")],e.default),e.default})},"esri/rest/support/ColorRamp":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r.JSONSupport{constructor(e){super(e),this.type=null}},t.__decorate([i.property({readOnly:!0,json:{read:!1,write:!0}})],e.default.prototype,"type",void 0),e.default=t.__decorate([a.subclass("esri.rest.support.ColorRamp")],e.default),e.default})},"esri/rest/support/MultipartColorRamp":function(){define(["exports","../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./AlgorithmicColorRamp","./ColorRamp"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;return e.default=d=class extends u{constructor(e){super(e),this.colorRamps=null,this.type="multipart",this.weights=void 0}writeColorRamps(e,t,r,i){const o=e?.map(e=>e.toJSON(i)),{weights:s}=this;if(o&&s?.length&&o.length===s?.length){const e=100/s.reduce((e,t)=>e+t);let t=0;o.forEach((r,i)=>{r.start=t,t+=s[i]*e,r.stop=t})}t.colorRamps=o}readWeights(e,t){const r=t.colorRamps?.map(({start:e,stop:t})=>null==e||null==t?-1:t-e);if(!r?.some(e=>e<0))return r}clone(){return new d({colorRamps:r.clone(this.colorRamps)})}},t.__decorate([i.property({type:[c],json:{write:{isRequired:!0}}})],e.default.prototype,"colorRamps",void 0),t.__decorate([l.writer("colorRamps")],e.default.prototype,"writeColorRamps",null),t.__decorate([i.property({type:["multipart"],json:{write:{isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([i.property({type:[Number]})],e.default.prototype,"weights",void 0),t.__decorate([n.reader("weights",["colorRamps"])],e.default.prototype,"readWeights",null),e.default=d=t.__decorate([a.subclass("esri.rest.support.MultipartColorRamp")],e.default),e.default})},"esri/renderers/mixins/VisualVariablesMixin":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../layers/support/fieldUtils","../visualVariables/ColorVariable","../visualVariables/OpacityVariable","../visualVariables/RotationVariable","../visualVariables/SizeVariable","../visualVariables/VisualVariable","../visualVariables/VisualVariableFactory","../../support/arcadeExpressionUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";const g={base:f,key:"type",typeMap:{opacity:d,color:u,rotation:p,size:h}};function b(e,t,r){const i=y.matchRandomRotationExpression(e);return null!=i&&(c.collectField(t,r,i),!0)}e.VisualVariablesMixin=e=>{const i=e;let o=class extends i{constructor(){super(...arguments),this._vvFactory=new m}set visualVariables(e){this._vvFactory.visualVariables=e,this._set("visualVariables",this._vvFactory.visualVariables)}readVisualVariables(e,t,r){return this._vvFactory.readVariables(e,t,r)}writeVisualVariables(e,t,r,i){t[r]=this._vvFactory.writeVariables(e,i)}get arcadeRequiredForVisualVariables(){return this.visualVariables?.some(({arcadeRequired:e})=>e)??!1}hasVisualVariables(e,t){return e?this.getVisualVariablesForType(e,t).length>0:this.getVisualVariablesForType("size",t).length>0||this.getVisualVariablesForType("color",t).length>0||this.getVisualVariablesForType("opacity",t).length>0||this.getVisualVariablesForType("rotation",t).length>0}getVisualVariablesForType(e,t){return this.visualVariables?.filter(r=>r.type===e&&("string"==typeof t?r.target===t:!1!==t||!r.target))??[]}async collectVVRequiredFields(e,t){let r=[];this.visualVariables&&(r=r.concat(this.visualVariables));for(const i of r)i&&(i.field&&c.collectField(e,t,i.field),i.normalizationField&&c.collectField(e,t,i.normalizationField),i.valueExpression&&(b(i.valueExpression,e,t)||await c.collectArcadeFieldNames(e,t,i.valueExpression)))}};return t.__decorate([r.property({types:[g],value:null,json:{write:!0}})],o.prototype,"visualVariables",null),t.__decorate([n.reader("visualVariables",["visualVariables","rotationType","rotationExpression"])],o.prototype,"readVisualVariables",null),t.__decorate([l.writer("visualVariables")],o.prototype,"writeVisualVariables",null),o=t.__decorate([a.subclass("esri.renderers.mixins.VisualVariablesMixin")],o),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/visualVariables/ColorVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./VisualVariable","./support/ColorStop"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends a{constructor(e){super(e),this.type="color",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(e=>!!e)).sort((e,t)=>e.value-t.value),this._set("stops",e)}clone(){return new c({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}},t.__decorate([r.property({readOnly:!0})],e.default.prototype,"cache",null),t.__decorate([r.property({type:["color"],json:{type:["colorInfo"]}})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:String,json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([r.property({type:[l],json:{write:!0}})],e.default.prototype,"stops",null),e.default=c=t.__decorate([n.subclass("esri.renderers.visualVariables.ColorVariable")],e.default),e.default})},"esri/renderers/visualVariables/VisualVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/ensureType","./support/VisualVariableLegendOptions"],function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=new r.JSONMap({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"});return e.default=class extends i.JSONSupport{constructor(e){super(e),this.index=null,this.type=null,this.field=null,this.valueExpression=null,this.valueExpressionTitle=null,this.legendOptions=null}castField(e){return null==e?e:"function"==typeof e?(o.getLogger(this).error(".field: field must be a string value"),null):l.ensureString(e)}get arcadeRequired(){return!!this.valueExpression}clone(){}getAttributeHash(){return`${this.type}-${this.field}-${this.valueExpression}`}},t.__decorate([s.property()],e.default.prototype,"index",void 0),t.__decorate([s.property({type:u.apiValues,readOnly:!0,json:{read:u.read,write:{writer:u.write,isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"field",void 0),t.__decorate([n.cast("field")],e.default.prototype,"castField",null),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpression",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpressionTitle",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"arcadeRequired",null),t.__decorate([s.property({type:c,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),e.default=t.__decorate([a.subclass("esri.renderers.visualVariables.VisualVariable")],e.default),e.default})},"esri/renderers/visualVariables/support/VisualVariableLegendOptions":function(){define(["../../../chunks/tslib.es6","../../../core/Clonable","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";let l=class extends(t.ClonableMixin(r.JSONSupport)){constructor(){super(...arguments),this.showLegend=null,this.title=null}};return e.__decorate([i.property({type:Boolean,json:{write:!0}})],l.prototype,"showLegend",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],l.prototype,"title",void 0),l=e.__decorate([a.subclass("esri.renderers.visualVariables.support.VisualVariableLegendOptions")],l),l})},"esri/renderers/visualVariables/support/ColorStop":function(){define(["../../../chunks/tslib.es6","../../../Color","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../core/accessorSupport/decorators/writer"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;let u=c=class extends r.JSONSupport{constructor(e){super(e),this.color=null,this.label=null,this.value=null}writeValue(e,t,r){t[r]=e??0}clone(){return new c({color:this.color&&this.color.clone(),label:this.label,value:this.value})}};return e.__decorate([i.property({type:t,json:{type:[o.Integer],write:{isRequired:!0}}})],u.prototype,"color",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],u.prototype,"label",void 0),e.__decorate([i.property({type:Number,json:{write:{writerEnsuresNonNull:!0}}})],u.prototype,"value",void 0),e.__decorate([l.writer("value")],u.prototype,"writeValue",null),u=c=e.__decorate([a.subclass("esri.renderers.visualVariables.support.ColorStop")],u),u})},"esri/renderers/visualVariables/OpacityVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./VisualVariable","./support/OpacityStop"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends a{constructor(e){super(e),this.type="opacity",this.normalizationField=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null}}set stops(e){e&&Array.isArray(e)&&(e=e.filter(e=>!!e)).sort((e,t)=>e.value-t.value),this._set("stops",e)}clone(){return new c({field:this.field,normalizationField:this.normalizationField,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,stops:this.stops&&this.stops.map(e=>e.clone()),legendOptions:this.legendOptions?.clone()})}getAttributeHash(){return`${super.getAttributeHash()}-${this.normalizationField}`}_interpolateData(){return this.stops&&this.stops.map(e=>e.value||0)}},t.__decorate([r.property({readOnly:!0})],e.default.prototype,"cache",null),t.__decorate([r.property({type:["opacity"],json:{type:["transparencyInfo"]}})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:String,json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([r.property({type:[l],json:{write:!0}})],e.default.prototype,"stops",null),e.default=c=t.__decorate([n.subclass("esri.renderers.visualVariables.OpacityVariable")],e.default),e.default})},"esri/renderers/visualVariables/support/OpacityStop":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/reader","../../../core/accessorSupport/decorators/subclass","../../../core/accessorSupport/decorators/writer","../../../webdoc/support/opacityUtils"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;let d=u=class extends t.JSONSupport{constructor(e){super(e),this.label=null,this.opacity=null,this.value=null}readOpacity(e,t){return c.transparencyToOpacity(t.transparency)}writeOpacity(e,t,r){t[r]=c.opacityToTransparency(e)}clone(){return new u({label:this.label,opacity:this.opacity,value:this.value})}};return e.__decorate([r.property({type:String,json:{write:!0}})],d.prototype,"label",void 0),e.__decorate([r.property({type:Number,json:{type:i.Integer,write:{target:"transparency",isRequired:!0}}})],d.prototype,"opacity",void 0),e.__decorate([n.reader("opacity",["transparency"])],d.prototype,"readOpacity",null),e.__decorate([l.writer("opacity")],d.prototype,"writeOpacity",null),e.__decorate([r.property({type:Number,json:{write:{isRequired:!0}}})],d.prototype,"value",void 0),d=u=e.__decorate([a.subclass("esri.renderers.visualVariables.support.OpacityStop")],d),d})},"esri/webdoc/support/opacityUtils":function(){define(["exports","../../core/accessorSupport/ensureType"],function(e,t){"use strict";e.opacityToTransparency=function(e){const r=t.ensureInteger(100*(1-e));return Math.max(0,Math.min(r,100))},e.transparencyToOpacity=function(e){const t=1-e/100;return Math.max(0,Math.min(t,1))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/visualVariables/RotationVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./VisualVariable"],function(e,t,r,i,o,s,n,a){"use strict";var l;return e.default=l=class extends a{constructor(e){super(e),this.axis=null,this.type="rotation",this.rotationType="geographic"}get cache(){return{hasExpression:!!this.valueExpression,compiledFunc:null}}clone(){return new l({axis:this.axis,rotationType:this.rotationType,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,legendOptions:this.legendOptions?.clone()})}},t.__decorate([r.property({readOnly:!0})],e.default.prototype,"cache",null),t.__decorate([r.property({type:["heading","tilt","roll"],json:{origins:{"web-scene":{default:"heading",write:!0}}}})],e.default.prototype,"axis",void 0),t.__decorate([r.property({type:["rotation"],json:{type:["rotationInfo"]}})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:["geographic","arithmetic"],json:{write:!0,origins:{"web-document":{write:!0,default:"geographic"}}}})],e.default.prototype,"rotationType",void 0),e.default=l=t.__decorate([n.subclass("esri.renderers.visualVariables.RotationVariable")],e.default),e.default})},"esri/renderers/visualVariables/SizeVariable":function(){define(["exports","../../chunks/tslib.es6","../../core/Error","../../core/jsonMap","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./VisualVariable","./support/castSizeVariable","./support/SizeStop","./support/SizeVariableLegendOptions","./support/sizeVariableUtils","./support/visualVariableUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;const g=new i.JSONMap({width:"width",depth:"depth",height:"height",widthAndDepth:"width-and-depth",all:"all"}),b=new i.JSONMap({unknown:"unknown",inch:"inches",foot:"feet",yard:"yards",mile:"miles","nautical-mile":"nautical-miles",millimeter:"millimeters",centimeter:"centimeters",decimeter:"decimeters",meter:"meters",kilometer:"kilometers"});function _(t){if(null!=t)return"string"==typeof t||"number"==typeof t?d.castSizeFromStringOrNumber(t):"size"===t.type?f.isSizeVariable(t)?t:(delete(t={...t}).type,new e.default(t)):void 0}function v(t,r,i){if("object"!=typeof t)return t;const o=new e.default;return o.read(t,i),o}return e.default=y=class extends u{constructor(e){super(e),this.axis=null,this.legendOptions=null,this.normalizationField=null,this.scaleBy=null,this.target=null,this.type="size",this.useSymbolValue=null,this.valueExpression=null,this.valueRepresentation=null,this.valueUnit=null}get cache(){return{ipData:this._interpolateData(),hasExpression:!!this.valueExpression,compiledFunc:null,isScaleDriven:null!=this.valueExpression&&m.viewScaleRE.test(this.valueExpression)}}set index(e){f.isSizeVariable(this.maxSize)&&(this.maxSize.index=`visualVariables[${e}].maxSize`),f.isSizeVariable(this.minSize)&&(this.minSize.index=`visualVariables[${e}].minSize`),this._set("index",e)}get inputValueType(){return f.getInputValueType(this)}set maxDataValue(e){e&&this.stops&&(o.getLogger(this).warn("cannot set maxDataValue when stops is not null."),e=null),this._set("maxDataValue",e)}set maxSize(e){e&&this.stops&&(o.getLogger(this).warn("cannot set maxSize when stops is not null."),e=null),this._set("maxSize",e)}castMaxSize(e){return _(e)}readMaxSize(e,t,r){return v(e,0,r)}set minDataValue(e){e&&this.stops&&(o.getLogger(this).warn("cannot set minDataValue when stops is not null."),e=null),this._set("minDataValue",e)}set minSize(e){e&&this.stops&&(o.getLogger(this).warn("cannot set minSize when stops is not null."),e=null),this._set("minSize",e)}castMinSize(e){return _(e)}readMinSize(e,t,r){return v(e,0,r)}get arcadeRequired(){return!!this.valueExpression||null!=this.minSize&&"object"==typeof this.minSize&&this.minSize.arcadeRequired||null!=this.maxSize&&"object"==typeof this.maxSize&&this.maxSize.arcadeRequired}set stops(e){null==this.minDataValue&&null==this.maxDataValue&&null==this.minSize&&null==this.maxSize?e&&Array.isArray(e)&&(e=e.filter(e=>!!e)).sort((e,t)=>e.value-t.value):e&&(o.getLogger(this).warn("cannot set stops when one of minDataValue, maxDataValue, minSize or maxSize is not null."),e=null),this._set("stops",e)}get transformationType(){return f.getTransformationType(this,this.inputValueType)}readValueExpression(e,t){return e||t.expression&&"$view.scale"}writeValueExpressionWebScene(e,t,i,o){if("$view.scale"===e){if(o?.messages){const e=this.index,t="string"==typeof e?e:`visualVariables[${e}]`;o.messages.push(new r("property:unsupported",this.type+"VisualVariable.valueExpression = '$view.scale' is not supported in Web Scene. Please remove this property to save the Web Scene.",{instance:this,propertyName:t+".valueExpression",context:o}))}}else t[i]=e}readValueUnit(e){return e?b.read(e):null}clone(){return new y({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:f.isSizeVariable(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:f.isSizeVariable(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops?.map(e=>e.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions?.clone()})}flipSizes(){if("clamped-linear"===this.transformationType){const{minSize:e,maxSize:t}=this;return this.minSize=t,this.maxSize=e,this}if("stops"===this.transformationType){const e=this.stops;if(!e)return this;const t=e.map(e=>e.size).reverse(),r=e.length;for(let i=0;i<r;i++)e[i].size=t[i];return this}return this}getAttributeHash(){return`${super.getAttributeHash()}-${this.target}-${this.normalizationField}`}_interpolateData(){return this.stops?.map(e=>e.value||0)}},t.__decorate([s.property({readOnly:!0})],e.default.prototype,"cache",null),t.__decorate([s.property({type:g.apiValues,json:{type:g.jsonValues,origins:{"web-map":{read:!1}},read:g.read,write:g.write}})],e.default.prototype,"axis",void 0),t.__decorate([s.property()],e.default.prototype,"index",null),t.__decorate([s.property({type:String,readOnly:!0})],e.default.prototype,"inputValueType",null),t.__decorate([s.property({type:h,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([s.property({type:Number,value:null,json:{write:!0}})],e.default.prototype,"maxDataValue",null),t.__decorate([s.property({type:Number,value:null,json:{write:!0}})],e.default.prototype,"maxSize",null),t.__decorate([n.cast("maxSize")],e.default.prototype,"castMaxSize",null),t.__decorate([a.reader("maxSize")],e.default.prototype,"readMaxSize",null),t.__decorate([s.property({type:Number,value:null,json:{write:!0}})],e.default.prototype,"minDataValue",null),t.__decorate([s.property({type:Number,value:null,json:{write:!0}})],e.default.prototype,"minSize",null),t.__decorate([n.cast("minSize")],e.default.prototype,"castMinSize",null),t.__decorate([a.reader("minSize")],e.default.prototype,"readMinSize",null),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"arcadeRequired",null),t.__decorate([s.property({type:String})],e.default.prototype,"scaleBy",void 0),t.__decorate([s.property({type:[p],value:null,json:{write:!0}})],e.default.prototype,"stops",null),t.__decorate([s.property({type:["outline"],json:{write:!0}})],e.default.prototype,"target",void 0),t.__decorate([s.property({type:String,readOnly:!0})],e.default.prototype,"transformationType",null),t.__decorate([s.property({type:["size"],json:{type:["sizeInfo"]}})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:Boolean,json:{write:!0,origins:{"web-map":{read:!1}}}})],e.default.prototype,"useSymbolValue",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpression",void 0),t.__decorate([a.reader("valueExpression",["valueExpression","expression"])],e.default.prototype,"readValueExpression",null),t.__decorate([c.writer("web-scene","valueExpression")],e.default.prototype,"writeValueExpressionWebScene",null),t.__decorate([s.property({type:["radius","diameter","area","width","distance"],json:{write:!0}})],e.default.prototype,"valueRepresentation",void 0),t.__decorate([s.property({type:b.apiValues,json:{write:b.write,origins:{"web-map":{read:!1},"web-scene":{write:!0},"portal-item":{write:!0}}}})],e.default.prototype,"valueUnit",void 0),t.__decorate([a.reader("valueUnit")],e.default.prototype,"readValueUnit",null),e.default=y=t.__decorate([l.subclass("esri.renderers.visualVariables.SizeVariable")],e.default),e.default})},"esri/renderers/visualVariables/support/castSizeVariable":function(){define(["exports","../../../core/screenUtils"],function(e,t){"use strict";e.castSizeFromStringOrNumber=function(e){return t.toPt(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/visualVariables/support/SizeStop":function(){define(["exports","../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/screenUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r.JSONSupport{constructor(e){super(e),this.label=null,this.size=null,this.value=null,this.useMinValue=null,this.useMaxValue=null}clone(){return new c({label:this.label,size:this.size,value:this.value,useMaxValue:this.useMaxValue,useMinValue:this.useMinValue})}},t.__decorate([o.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:{isRequired:!0}}})],e.default.prototype,"size",void 0),t.__decorate([o.property({type:Number,json:{write:{isRequired:!0}}})],e.default.prototype,"value",void 0),t.__decorate([o.property({type:Boolean,json:{write:!1}})],e.default.prototype,"useMinValue",void 0),t.__decorate([o.property({type:Boolean,json:{write:!1}})],e.default.prototype,"useMaxValue",void 0),e.default=c=t.__decorate([l.subclass("esri.renderers.visualVariables.support.SizeStop")],e.default),e.default})},"esri/renderers/visualVariables/support/SizeVariableLegendOptions":function(){define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./VisualVariableLegendOptions"],function(e,t,r,i,o,s,n){"use strict";let a=class extends n{constructor(){super(...arguments),this.customValues=null}};return e.__decorate([t.property({type:[Number],json:{write:!0}})],a.prototype,"customValues",void 0),a=e.__decorate([s.subclass("esri.renderers.visualVariables.support.SizeVariableLegendOptions")],a),a})},"esri/renderers/visualVariables/support/sizeVariableUtils":function(){define(["exports"],function(e){"use strict";function t(e){return e.valueExpression?"expression":e.field&&"string"==typeof e.field?"field":"unknown"}e.getInputValueType=t,e.getTransformationType=function(e,r){const i=r||t(e),o=e.valueUnit||"unknown";return"unknown"===i?"constant":e.stops?"stops":null!=e.minSize&&null!=e.maxSize&&null!=e.minDataValue&&null!=e.maxDataValue?"clamped-linear":"unknown"===o?null!=e.minSize&&null!=e.minDataValue?e.minSize&&e.minDataValue?"proportional":"additive":"identity":"real-world-size"},e.isSizeVariable=function(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass},e.isValidNumber=function(e){return null!=e&&!isNaN(e)&&isFinite(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/visualVariables/support/visualVariableUtils":function(){define(["exports","../../../Color","../../../Graphic","../../../core/compilerUtils","../../../core/Logger","../../support/lengthUtils","./sizeVariableUtils"],function(e,t,r,i,o,s,n){"use strict";const a=()=>o.getLogger("esri.renderers.visualVariables.support.visualVariableUtils"),l=e=>a().warn(`The visualVariable should be an instance of esri.renderers.visualVariables.${e}`),c=()=>a().error("Use of arcade expressions requires an arcade context"),u=new r,d=Math.PI;function p(e,r,i){const o="visualVariables"in e?e.visualVariables?.find(e=>"color"===e.type):e;if(!o)return;if("esri.renderers.visualVariables.ColorVariable"!==o.declaredClass)return void l("ColorVariable");const s="number"==typeof r,a=s?null:r,u=a?.attributes;let d=s?r:null;const p=o.field,{ipData:h,hasExpression:f}=o.cache;let m=o.cache.compiledFunc;if(!p&&!f){const e=o.stops;return e&&e[0]&&e[0].color}if("number"!=typeof d)if(f){if(null==i?.arcade)return void c();const e={viewingMode:i.viewingMode,scale:i.scale,spatialReference:i.spatialReference},t=i.arcade.arcadeUtils,r=t.getViewInfo(e),s=t.createExecContext(a,r,i.timeZone);if(!m){const e=t.createSyntaxTree(o.valueExpression);m=t.createFunction(e),o.cache.compiledFunc=m}d=t.executeFunction(m,s)}else u&&(d=u[p]);const y=o.normalizationField,g=null!=u&&null!=y?parseFloat(u[y]):void 0;if(null!=d&&(!y||s||!isNaN(g)&&0!==g)){n.isValidNumber(g)&&!s&&(d/=g);const e=_(d,h);if(e){const r=e[0],s=e[1],n=r===s?o.stops[r].color:t.blendColors(o.stops[r].color,o.stops[s].color,e[2],null!=i?i.color:void 0);return new t(n)}}}function h(e,t,r){const i="visualVariables"in e?e.visualVariables?.find(e=>"opacity"===e.type):e;if(!i)return;if("esri.renderers.visualVariables.OpacityVariable"!==i.declaredClass)return void l("OpacityVariable");const o="number"==typeof t,s=o?null:t,a=s?.attributes;let u=o?t:null;const d=i.field,{ipData:p,hasExpression:h}=i.cache;let f=i.cache.compiledFunc;if(!d&&!h){const e=i.stops;return e&&e[0]&&e[0].opacity}if("number"!=typeof u)if(h){if(null==r?.arcade)return void c();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,o=t.getViewInfo(e),n=t.createExecContext(s,o,r.timeZone);if(!f){const e=t.createSyntaxTree(i.valueExpression);f=t.createFunction(e),i.cache.compiledFunc=f}u=t.executeFunction(f,n)}else a&&(u=a[d]);const m=i.normalizationField,y=null!=a&&null!=m?parseFloat(a[m]):void 0;if(null!=u&&(!m||o||!isNaN(y)&&0!==y)){n.isValidNumber(y)&&!o&&(u/=y);const e=_(u,p);if(e){const t=e[0],r=e[1];if(t===r)return i.stops[t].opacity;{const o=i.stops[t].opacity;return o+(i.stops[r].opacity-o)*e[2]}}}}function f(e,t,r){const i="visualVariables"in e?e.visualVariables?.find(e=>"rotation"===e.type):e;if(!i)return;if("esri.renderers.visualVariables.RotationVariable"!==i.declaredClass)return void l("RotationVariable");const o=i.axis||"heading",s="heading"===o&&"arithmetic"===i.rotationType?90:0,n="heading"===o&&"arithmetic"===i.rotationType?-1:1,a="number"==typeof t?null:t,u=a?.attributes,d=i.field,{hasExpression:p}=i.cache;let h=i.cache.compiledFunc,f=null;if(!d&&!p)return f;if(p){if(null==r?.arcade)return void c();const e={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},t=r.arcade.arcadeUtils,o=t.getViewInfo(e),s=t.createExecContext(a,o,r.timeZone);if(!h){const e=t.createSyntaxTree(i.valueExpression);h=t.createFunction(e),i.cache.compiledFunc=h}f=t.executeFunction(h,s)}else u&&(f=u[d]);return f="number"!=typeof f||isNaN(f)?null:s+n*f,f}function m(e,t,r){const i="visualVariables"in e?e.visualVariables?.find(e=>"size"===e.type):e;if(!i)return;if("esri.renderers.visualVariables.SizeVariable"!==i.declaredClass)return void l("SizeVariable");const o=function(e,t,r){const i="number"==typeof t,o=i?null:t,s=o?.attributes;let a=i?t:null;const{isScaleDriven:l}=e.cache;let u=e.cache.compiledFunc;if(l){const t=null!=r?r.scale:void 0,i=null!=r?r.view:void 0;a=null==t||"3d"===i?function(e){let t=null,r=null;const i=e.stops;return i?(t=i[0].value,r=i[i.length-1].value):(t=e.minDataValue||0,r=e.maxDataValue||0),(t+r)/2}(e):t}else if(!i)switch(e.inputValueType){case"expression":{if(null==r?.arcade)return void c();const t={viewingMode:r.viewingMode,scale:r.scale,spatialReference:r.spatialReference},i=r.arcade.arcadeUtils,s=i.getViewInfo(t),n=i.createExecContext(o,s,r.timeZone);if(!u){const t=i.createSyntaxTree(e.valueExpression);u=i.createFunction(t),e.cache.compiledFunc=u}a=i.executeFunction(u,n);break}case"field":s&&(a=s[e.field]);break;case"unknown":a=null}if(!n.isValidNumber(a))return null;if(i||!e.normalizationField)return a;const d=s?parseFloat(s[e.normalizationField]):null;return n.isValidNumber(d)&&0!==d?a/d:null}(i,t,r),s=b(o,i,t,r,i.cache.ipData);return null==s||isNaN(s)?void 0:s}function y(e,t,r){return null==e?null:n.isSizeVariable(e)?m(e,t,r):n.isValidNumber(e)?e:null}function g(e,t,r){return n.isValidNumber(r)&&e>r?r:n.isValidNumber(t)&&e<t?t:e}function b(e,t,r,i,o){switch(t.transformationType){case"additive":return function(e,t,r,i){const o=y(t.minSize,r,i)||t.minDataValue;return null==e&&null==o?null:(e??0)+(o??0)}(e,t,r,i);case"constant":return function(e,t,r){const i=e.stops;let o=i?.length&&i[0].size;return null==o&&(o=e.minSize),y(o,t,r)}(t,r,i);case"clamped-linear":return function(e,t,r,i){const o=y(t.minSize,r,i);if(null==e)return o;const{minDataValue:s,maxDataValue:n}=t;if(null==s||null==n)return null;const a=(e-s)/(n-s),l=y(t.maxSize,r,i),c=null!=i?i.shape:void 0;if(e<=s)return o;if(e>=n)return l;if(null==o||null==l)return null;if("area"===t.scaleBy&&c){const e="circle"===c,t=e?d*(o/2)**2:o*o,r=t+a*((e?d*(l/2)**2:l*l)-t);return e?2*Math.sqrt(r/d):Math.sqrt(r)}return o+a*(l-o)}(e,t,r,i);case"proportional":return function(e,t,r,i){const o=y(t.minSize,r,i);if(null==e||null==o)return o;const s=null!=i?i.shape:void 0,{minDataValue:n}=t;if(null==n)return null;const a=e/n,l=y(t.maxSize,r,i);let c=null;return c="circle"===s?2*Math.sqrt(a*(o/2)**2):"square"===s||"diamond"===s||"image"===s?Math.sqrt(a*o**2):a*o,g(c,o,l)}(e,t,r,i);case"stops":return function(e,t,r,i,o){if(null==e)return null;const[s,n,a]=_(e,o);if(s===n)return y(t.stops?.[s].size,r,i);{const e=y(t.stops?.[s].size,r,i),o=y(t.stops?.[n].size,r,i);return null==e||null==o?null:e+(o-e)*a}}(e,t,r,i,o);case"real-world-size":return function(e,t,r,i){const o=(i?.resolution??1)*s.meterIn[t.valueUnit],n=y(t.minSize,r,i),a=y(t.maxSize,r,i),{valueRepresentation:l}=t;if(null==e)return n;let c=null;return c="area"===l?2*Math.sqrt(e/d)/o:"radius"===l||"distance"===l?2*e/o:e/o,g(c,n,a)}(e,t,r,i);case"identity":return e;case"unknown":return null}}function _(e,t){if(!t)return;let r=0,i=t.length-1;return t.some((t,o)=>e<t?(i=o,!0):(r=o,!1)),[r,i,(e-t[r])/(t[i]-t[r])]}e.getAllSizes=function(e,t,r){const o=["proportional","proportional","proportional"];for(const s of e){const e=s.useSymbolValue?"symbol-value":m(s,t,r)??"proportional";switch(s.axis){case"width":o[0]=e;break;case"depth":o[1]=e;break;case"height":o[2]=e;break;case"width-and-depth":o[0]=e,o[1]=e;break;case"all":case void 0:case null:o[0]=e,o[1]=e,o[2]=e;break;default:i.neverReached(s.axis)}}return o},e.getColor=p,e.getOpacity=h,e.getRotationAngle=f,e.getSize=m,e.getSizeForValue=b,e.getSizeFromNumberOrVariable=y,e.getSizeRangeAtScale=function(e,t,r){const{isScaleDriven:i}=e.cache;if(!(i&&"3d"===r||t))return null;const o={scale:t,view:r};let s=y(e.minSize,u,o),n=y(e.maxSize,u,o);if(null!=s||null!=n){if(s>n){const e=n;n=s,s=e}return{minSize:s,maxSize:n}}},e.getVisualVariableValues=function(e,t,r){if(!e.visualVariables)return;const i=[],o=[],s=[],n=[],a=[];for(const t of e.visualVariables)switch(t.type){case"color":o.push(t);break;case"opacity":s.push(t);break;case"rotation":a.push(t);break;case"size":n.push(t)}return o.forEach(e=>{const o=p(e,t,r);i.push({variable:e,value:o})}),s.forEach(e=>{const o=h(e,t,r);i.push({variable:e,value:o})}),a.forEach(e=>{const o=f(e,t,r);i.push({variable:e,value:o})}),n.forEach(e=>{const o=m(e,t,r);i.push({variable:e,value:o})}),i},e.viewScaleRE=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/Graphic":function(){define(["exports","./chunks/tslib.es6","./PopupTemplate","./core/Clonable","./core/deprecate","./core/JSONSupport","./core/Logger","./core/reactiveUtils","./core/uid","./core/accessorSupport/decorators/property","./core/has","./core/RandomLCG","./core/accessorSupport/decorators/subclass","./core/support/jsonUtils","./geometry/support/jsonUtils","./geometry/support/typeUtils","./layers/graphics/data/createFeatureId","./symbols/support/typeUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g){"use strict";var b;function _(e){if(null==e)return null;const t={};for(const r in e){const i=e[r];i&&(t[r]=i.toJSON())}return 0!==Object.keys(t).length?t:null}return e.default=class extends(i.ClonableMixin(s.JSONSupport)){static{b=this}constructor(e){super(e),this.isAggregate=!1,this.layer=null,this.origin=null,this.sourceLayer=null,this._version=0,Object.defineProperty(this,"uid",{value:l.generateUID(),configurable:!0}),Object.defineProperty(this,"_lastMeshTransform",{value:{},configurable:!0,writable:!0,enumerable:!1}),arguments.length>1&&o.deprecatedConstructorSignature(n.getLogger(this),"Graphic",{version:"4.30"})}initialize(){this._watchMeshGeometryChanges()}set aggregateGeometries(e){const t=this._get("aggregateGeometries");JSON.stringify(t)!==JSON.stringify(e)&&this._set("aggregateGeometries",e)}set attributes(e){const t=this._get("attributes");t!==e&&(this._set("attributes",e),this._notifyLayer("attributes",t,e))}set geometry(e){const t=this._get("geometry");t!==e&&(this._set("geometry",e),"mesh"!==e?.type&&this._notifyLayer("geometry",t,e))}set popupTemplate(e){const t=this._get("popupTemplate");t!==e&&(this._set("popupTemplate",e),this._notifyLayer("popupTemplate",t,e))}set symbol(e){const t=this._get("symbol");t!==e&&(this._set("symbol",e),this._notifyLayer("symbol",t,e))}get version(){return this._version}set visible(e){const t=this._get("visible");t!==e&&(this._set("visible",e),this._notifyLayer("visible",t,e))}cloneShallow(){return new b({aggregateGeometries:this.aggregateGeometries,attributes:this.attributes,geometry:this.geometry,isAggregate:this.isAggregate,layer:this.layer,popupTemplate:this.popupTemplate,sourceLayer:this.sourceLayer,symbol:this.symbol,visible:this.visible,origin:this.origin})}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.origin&&"layer"in this.origin?this.origin.layer:null;for(const r of[t,this.sourceLayer,this.layer])if(r&&"object"==typeof r){if("popupTemplate"in r&&r.popupTemplate)return r.popupTemplate;if(e&&"defaultPopupTemplate"in r&&null!=r.defaultPopupTemplate)return r.defaultPopupTemplate}return null}getAttribute(e){return this.attributes?.[e]}setAttribute(e,t){if(this.attributes){const r=this.getAttribute(e);this.attributes[e]=t,this._notifyLayer("attributes",r,t,e)}else this.attributes={[e]:t}}getObjectId(){const e=this.sourceLayer??this.layer;return e?y.createFeatureIdFromLayer(this,e):null}getGlobalId(){const e=this.sourceLayer??this.layer;return e&&"globalIdField"in e&&e.globalIdField?this.getAttribute(e.globalIdField):null}toJSON(){return{aggregateGeometries:_(this.aggregateGeometries),geometry:null!=this.geometry?this.geometry.toJSON():null,symbol:null!=this.symbol?this.symbol.toJSON():null,attributes:h.isSerializable(this.attributes)?this.attributes.toJSON():{...this.attributes},popupTemplate:this.popupTemplate?.toJSON()??null}}notifyMeshTransformChanged(e={}){const{geometry:t}=this;if("mesh"===t?.type){const r={origin:t.origin,transform:t.transform};this._notifyLayer("origin-transform",r,r,e.action)}}_notifyLayer(e,t,r,i){if(this._version++,!this.layer||!("graphicChanged"in this.layer))return;const o={graphic:this,property:e,oldValue:t,newValue:r};"origin-transform"===e&&(o.action=i),"attributes"===e&&(o.attributeName=i),this.layer.graphicChanged(o)}_watchMeshGeometryChanges(){this.addHandles([a.when(()=>"mesh"===this.geometry?.type&&this.geometry.vertexSpace.origin?{localMatrix:this.geometry.transform?.localMatrix,origin:this.geometry.vertexSpace.origin}:void 0,({localMatrix:e,origin:t})=>{this._lastMeshTransform.localMatrix===e&&this._lastMeshTransform.origin===t||(this._lastMeshTransform.localMatrix=e,this._lastMeshTransform.origin=t,this.notifyMeshTransformChanged())}),a.when(()=>"mesh"===this.geometry?.type?{vertexAttributes:this.geometry.vertexAttributes}:void 0,()=>{const e=this.geometry;"mesh"===e?.type&&e.vertexSpace.origin?(this._lastMeshTransform.localMatrix=e.transform?.localMatrix,this._lastMeshTransform.origin=e.vertexSpace.origin):(this._lastMeshTransform.localMatrix=void 0,this._lastMeshTransform.origin=void 0),this._notifyLayer("geometry",this.geometry,this.geometry)},{equals:(e,t)=>e===t,sync:!0})])}},t.__decorate([c.property({value:null,json:{read:function(e){if(!e)return null;const t={};for(const r in e){const i=f.fromJSON(e[r]);i&&(t[r]=i)}return 0!==Object.keys(t).length?t:null}}})],e.default.prototype,"aggregateGeometries",null),t.__decorate([c.property({value:null})],e.default.prototype,"attributes",null),t.__decorate([c.property({value:null,types:m.geometryTypes,json:{read:f.fromJSON}})],e.default.prototype,"geometry",null),t.__decorate([c.property({type:Boolean})],e.default.prototype,"isAggregate",void 0),t.__decorate([c.property({clonable:!1})],e.default.prototype,"layer",void 0),t.__decorate([c.property({clonable:"reference"})],e.default.prototype,"origin",void 0),t.__decorate([c.property({type:r,value:null})],e.default.prototype,"popupTemplate",null),t.__decorate([c.property({clonable:"reference"})],e.default.prototype,"sourceLayer",void 0),t.__decorate([c.property({value:null,types:g.symbolTypes})],e.default.prototype,"symbol",null),t.__decorate([c.property({clonable:!1,json:{read:!1,write:!1}})],e.default.prototype,"_version",void 0),t.__decorate([c.property({type:Boolean,value:!0})],e.default.prototype,"visible",null),e.default=b=t.__decorate([p.subclass("esri.Graphic")],e.default),e.default})},"esri/PopupTemplate":function(){define(["./chunks/tslib.es6","./core/Clonable","./core/Collection","./core/JSONSupport","./core/lang","./core/Logger","./core/promiseUtils","./core/accessorSupport/decorators/property","./core/accessorSupport/decorators/cast","./core/accessorSupport/decorators/reader","./core/accessorSupport/decorators/subclass","./core/accessorSupport/decorators/writer","./core/accessorSupport/ensureType","./layers/support/fieldUtils","./popup/content","./popup/ExpressionInfo","./popup/FieldInfo","./popup/LayerOptions","./popup/RelatedRecordsInfo","./popup/content/support/mediaInfoTypes","./support/actions/ActionBase","./support/actions/ActionButton","./support/actions/ActionToggle","./popup/content/UtilityNetworkAssociationsContent","./popup/content/RelationshipContent","./popup/content/ExpressionContent","./popup/content/FieldsContent","./popup/content/AttachmentsContent","./popup/content/TextContent","./popup/content/CustomContent","./popup/content/MediaContent","./popup/content/Content"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M,T,P,I,C,O,F,A){"use strict";const R="relationships/",D="expression/",E=r.ofType({key:"type",defaultKeyValue:"button",base:v,typeMap:{button:S,toggle:x}}),V={base:A,key:"type",typeMap:{media:F,custom:O,text:C,attachments:I,fields:P,expression:T,relationship:M,utilityNetworkAssociations:w}},L=new Set(["attachments","fields","media","text","expression","relationship"]),z=new Set([...L,"utility-network-associations"]);let U=class extends(t.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.actions=null,this.content="",this.expressionInfos=null,this.fieldInfos=null,this.layerOptions=null,this.lastEditInfoEnabled=!0,this.outFields=null,this.overwriteActions=!1,this.returnGeometry=!1,this.title=""}castContent(e){return Array.isArray(e)?e.map(e=>p.ensureOneOfType(V,e)):"string"==typeof e||"function"==typeof e||e instanceof HTMLElement||n.isPromiseLike(e)?e:(s.getLogger(this).error("content error","unsupported content value",{value:e}),null)}readContent(e,t){const{popupElements:r}=t;return Array.isArray(r)&&r.length>0?this._readPopupInfoElements(t.description,t.mediaInfos,r):this._readPopupInfo(t)}writeWebSceneContent(e,t,r,i){this._writePopupTemplateContent(e,t,i)}writeWebMapContent(e,t,r,i){this._writePopupTemplateContent(e,t,i)}writeFieldInfos(e,t,r,i){const{content:o}=this,s=Array.isArray(o)?o:null;if(e){const r=s?s.filter(e=>"fields"===e.type):[],o=r.length&&r.every(e=>e.fieldInfos?.length);t.fieldInfos=e.filter(Boolean).map(e=>{const t=e.toJSON(i);return o&&(t.visible=!1),t})}if(s)for(const e of s)"fields"===e.type&&this._writeFieldsContent(e,t)}writeLayerOptions(e,t,r,i){t[r]=!e||null===e.showNoDataRecords&&null===e.returnTopmostRaster?null:e.toJSON(i)}writeTitle(e,t){t.title=e||""}async collectRequiredFields(e,t){const r=this.expressionInfos||[];await this._collectExpressionInfoFields(e,t,[...r,...this._getContentExpressionInfos(this.content,r)]),h.collectFields(e,t,[...this.outFields||[],...this._getActionsFields(this.actions),...this._getTitleFields(this.title),...this._getContentFields(this.content)])}async getRequiredFields(e){const t=new Set;return await this.collectRequiredFields(t,e),[...t].sort()}_writePopupTemplateContent(e,t,r){"string"!=typeof e?Array.isArray(e)&&(t.popupElements=e.filter(e=>"web-scene"===r?.origin?L.has(e.type):z.has(e.type)).map(e=>e?.toJSON(r)),t.popupElements.forEach(e=>{"attachments"===e.type?this._writeAttachmentContent(t):"media"===e.type?this._writeMediaContent(e,t):"text"===e.type?this._writeTextContent(e,t):"relationship"===e.type&&this._writeRelationshipContent(e,t)})):t.description=e}_writeFieldsContent(e,t){if(!Array.isArray(e.fieldInfos)||!e.fieldInfos.length)return;const r=o.clone(e.fieldInfos);Array.isArray(t.fieldInfos)?r.forEach(e=>{const r=t.fieldInfos.find(t=>t.fieldName?.toLowerCase()===e.fieldName?.toLowerCase());r?r.visible=!0:t.fieldInfos.push(e)}):t.fieldInfos=r}_writeAttachmentContent(e){e.showAttachments||(e.showAttachments=!0)}_writeRelationshipContent(e,t){const r=e.orderByFields?.map(t=>this._toFieldOrderJSON(t,e.relationshipId))||[],i=[...t.relatedRecordsInfo?.orderByFields||[],...r];t.relatedRecordsInfo={showRelatedRecords:!0,...i?.length&&{orderByFields:i}}}_writeTextContent(e,t){!t.description&&e.text&&(t.description=e.text)}_writeMediaContent(e,t){if(!Array.isArray(e.mediaInfos)||!e.mediaInfos.length)return;const r=o.clone(e.mediaInfos);Array.isArray(t.mediaInfos)?t.mediaInfos=[...t.mediaInfos,...r]:t.mediaInfos=r}_readPopupInfoElements(e,t,r){const i={description:!1,mediaInfos:!1};return r.map(r=>"media"===r.type?(r.mediaInfos||!t||i.mediaInfos||(r.mediaInfos=t,i.mediaInfos=!0),F.fromJSON(r)):"text"===r.type?(r.text||!e||i.description||(r.text=e,i.description=!0),C.fromJSON(r)):"attachments"===r.type?I.fromJSON(r):"fields"===r.type?P.fromJSON(r):"expression"===r.type?T.fromJSON(r):"relationship"===r.type?M.fromJSON(r):"utilityNetworkAssociations"===r.type?w.fromJSON(r):void 0).filter(Boolean)}_toRelationshipContent(e){const{field:t,order:r}=e;if(!t?.startsWith(R))return null;const i=t.replace(R,"").split("/");if(2!==i.length)return null;const o=parseInt(i[0],10),s=i[1];return!Number.isNaN(o)&&s?M.fromJSON({relationshipId:o,orderByFields:[{field:s,order:r}]}):null}_toFieldOrderJSON(e,t){const{order:r,field:i}=e;return{field:`${R}${t}/${i}`,order:r}}_readPopupInfo({description:e,mediaInfos:t,showAttachments:r,relatedRecordsInfo:i={showRelatedRecords:!1}}){const o=[];e?o.push(new C({text:e})):o.push(new P),Array.isArray(t)&&t.length&&o.push(F.fromJSON({mediaInfos:t})),r&&o.push(I.fromJSON({displayType:"auto"}));const{showRelatedRecords:s,orderByFields:n}=i;return s&&n?.length&&n.forEach(e=>{const t=this._toRelationshipContent(e);t&&o.push(t)}),o.length?o:e}_getContentElementFields(e){const t=e?.type;if("attachments"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)];if("custom"===t)return e.outFields||[];if("fields"===t)return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...this._getFieldInfoFields(e.fieldInfos??this.fieldInfos)];if("media"===t){const t=e.mediaInfos||[];return[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description),...t.reduce((e,t)=>[...e,...this._getMediaInfoFields(t)],[])]}return"text"===t?this._extractFieldNames(e.text):"relationship"===t||"utility-network-associations"===t?[...this._extractFieldNames(e.title),...this._extractFieldNames(e.description)]:[]}_getMediaInfoFields(e){const{caption:t,title:r,value:i}=e,o=i||{},{fields:s,normalizeField:n,tooltipField:a,sourceURL:l,linkURL:c}=o,u=[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(l),...this._extractFieldNames(c),...s??[]];return n&&u.push(n),a&&u.push(a),u}_getContentExpressionInfos(e,t){return Array.isArray(e)?e.reduce((e,t)=>[...e,..."expression"===t.type&&t.expressionInfo?[t.expressionInfo]:[]],t):[]}_getContentFields(e){return"string"==typeof e?this._extractFieldNames(e):Array.isArray(e)?e.reduce((e,t)=>[...e,...this._getContentElementFields(t)],[]):[]}async _collectExpressionInfoFields(e,t,r){r&&await Promise.all(r.map(r=>h.collectArcadeFieldNames(e,t,r.expression)))}_getFieldInfoFields(e){return e?e.filter(({fieldName:e,visible:t})=>!(void 0!==t&&!t||!e||e.startsWith(R)||e.startsWith(D))).map(e=>e.fieldName):[]}_getActionsFields(e){return e?e.toArray().reduce((e,t)=>[...e,...this._getActionFields(t)],[]):[]}_getActionFields(e){const{className:t,title:r,type:i}=e,o="button"===i||"toggle"===i?e.image:"";return[...this._extractFieldNames(r),...this._extractFieldNames(t),...this._extractFieldNames(o)]}_getTitleFields(e){return"string"==typeof e?this._extractFieldNames(e):[]}_extractFieldNames(e){return h.extractSubstitutionTemplatesFromString(e).filter(e=>!(e.startsWith(R)||e.startsWith(D)))}};return e.__decorate([a.property({type:E})],U.prototype,"actions",void 0),e.__decorate([a.property()],U.prototype,"content",void 0),e.__decorate([l.cast("content")],U.prototype,"castContent",null),e.__decorate([c.reader("content",["description","fieldInfos","popupElements","mediaInfos","showAttachments","relatedRecordsInfo"])],U.prototype,"readContent",null),e.__decorate([d.writer("web-scene","content",{popupElements:{type:r.ofType(f.persistableWebSceneTypes)},showAttachments:{type:Boolean},mediaInfos:{type:r.ofType(_.types)},description:{type:String},relatedRecordsInfo:{type:b}})],U.prototype,"writeWebSceneContent",null),e.__decorate([d.writer("content",{popupElements:{type:r.ofType(f.persistableTypes)},showAttachments:{type:Boolean},mediaInfos:{type:r.ofType(_.types)},description:{type:String},relatedRecordsInfo:{type:b}})],U.prototype,"writeWebMapContent",null),e.__decorate([a.property({type:[m],json:{write:!0}})],U.prototype,"expressionInfos",void 0),e.__decorate([a.property({type:[y]})],U.prototype,"fieldInfos",void 0),e.__decorate([d.writer("fieldInfos")],U.prototype,"writeFieldInfos",null),e.__decorate([a.property({type:g})],U.prototype,"layerOptions",void 0),e.__decorate([d.writer("layerOptions")],U.prototype,"writeLayerOptions",null),e.__decorate([a.property({type:Boolean,json:{read:{source:"showLastEditInfo"},write:{target:"showLastEditInfo"},default:!0}})],U.prototype,"lastEditInfoEnabled",void 0),e.__decorate([a.property()],U.prototype,"outFields",void 0),e.__decorate([a.property()],U.prototype,"overwriteActions",void 0),e.__decorate([a.property()],U.prototype,"returnGeometry",void 0),e.__decorate([a.property({json:{type:String}})],U.prototype,"title",void 0),e.__decorate([d.writer("title")],U.prototype,"writeTitle",null),U=e.__decorate([u.subclass("esri.PopupTemplate")],U),U})},"esri/popup/content":function(){define(["exports","./content/AttachmentsContent","./content/Content","./content/CustomContent","./content/ExpressionContent","./content/FieldsContent","./content/MediaContent","./content/RelationshipContent","./content/TextContent","./content/UtilityNetworkAssociationsContent"],function(e,t,r,i,o,s,n,a,l,c){"use strict";const u={base:null,key:"type",typeMap:{attachment:t,media:n,text:l,expression:o,field:s,relationship:a,utilityNetworkAssociations:c}},d={base:null,key:"type",typeMap:{attachment:t,media:n,text:l,expression:o,field:s,relationship:a}};e.AttachmentsContent=t,e.BaseContent=r,e.CustomContent=i,e.ExpressionContent=o,e.FieldsContent=s,e.MediaContent=n,e.RelationshipContent=a,e.TextContent=l,e.UtilityNetworkAssociationsContent=c,e.isContent=function(e){return e instanceof r},e.persistableTypes=u,e.persistableWebSceneTypes=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/popup/content/AttachmentsContent":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./Content","../support/AttachmentsOrderByInfo"],function(e,t,r,i,o,s,n,a,l){"use strict";let c=class extends(t.ClonableMixin(a)){constructor(e){super(e),this.description=null,this.displayType="auto",this.orderByFields=null,this.title=null,this.type="attachments"}};return e.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"description",void 0),e.__decorate([r.property({type:["auto","preview","list"],json:{write:!0}})],c.prototype,"displayType",void 0),e.__decorate([r.property({type:[l],json:{write:!0}})],c.prototype,"orderByFields",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"title",void 0),e.__decorate([r.property({type:["attachments"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],c.prototype,"type",void 0),c=e.__decorate([n.subclass("esri.popup.content.AttachmentsContent")],c),c})},"esri/popup/content/Content":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";let a=class extends t.JSONSupport{constructor(e){super(e),this.type=null}};return e.__decorate([r.property({type:["attachments","custom","fields","media","text","expression","relationship","utility-network-associations"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=e.__decorate([n.subclass("esri.popup.content.Content")],a),a})},"esri/popup/support/AttachmentsOrderByInfo":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l){"use strict";const c=new r.JSONMap({asc:"ascending",desc:"descending"});let u=class extends(t.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.field=null,this.order="ascending"}};return e.__decorate([o.property({type:String,json:{write:!0}})],u.prototype,"field",void 0),e.__decorate([o.property({type:c.apiValues,json:{type:c.jsonValues,read:c.read,write:c.write}})],u.prototype,"order",void 0),u=e.__decorate([l.subclass("esri.popup.support.AttachmentsOrderByInfo")],u),u})},"esri/popup/content/CustomContent":function(){define(["../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./Content"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends n{constructor(e){super(e),this.creator=null,this.destroyer=null,this.outFields=null,this.type="custom"}clone(){return new a({creator:this.creator,destroyer:this.destroyer,outFields:Array.isArray(this.outFields)?t.clone(this.outFields):null})}};return e.__decorate([r.property()],l.prototype,"creator",void 0),e.__decorate([r.property()],l.prototype,"destroyer",void 0),e.__decorate([r.property()],l.prototype,"outFields",void 0),e.__decorate([r.property({type:["custom"],readOnly:!0})],l.prototype,"type",void 0),l=a=e.__decorate([s.subclass("esri.popup.content.CustomContent")],l),l})},"esri/popup/content/ExpressionContent":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../ElementExpressionInfo","./Content"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends a{constructor(e){super(e),this.expressionInfo=null,this.type="expression"}clone(){return new l({expressionInfo:this.expressionInfo?.clone()})}};return e.__decorate([t.property({type:n,json:{write:!0}})],c.prototype,"expressionInfo",void 0),e.__decorate([t.property({type:["expression"],readOnly:!0,json:{read:!1,write:!0}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.ExpressionContent")],c),c})},"esri/popup/ElementExpressionInfo":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t.JSONSupport{constructor(e){super(e),this.title=null,this.expression=null,this.returnType="dictionary"}clone(){return new a({title:this.title,expression:this.expression})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"title",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"expression",void 0),e.__decorate([r.property({type:["dictionary"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"returnType",void 0),l=a=e.__decorate([n.subclass("esri.popup.ElementExpressionInfo")],l),l})},"esri/popup/content/FieldsContent":function(){define(["../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../FieldInfo","./Content"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;let u=c=class extends l{constructor(e){super(e),this.attributes=null,this.description=null,this.fieldInfos=null,this.title=null,this.type="fields"}writeFieldInfos(e,t){t.fieldInfos=e&&e.map(e=>e.toJSON())}clone(){return new c(t.clone({attributes:this.attributes,description:this.description,fieldInfos:this.fieldInfos,title:this.title}))}};return e.__decorate([r.property({type:Object,json:{write:!0}})],u.prototype,"attributes",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],u.prototype,"description",void 0),e.__decorate([r.property({type:[a]})],u.prototype,"fieldInfos",void 0),e.__decorate([n.writer("fieldInfos")],u.prototype,"writeFieldInfos",null),e.__decorate([r.property({type:String,json:{write:!0}})],u.prototype,"title",void 0),e.__decorate([r.property({type:["fields"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],u.prototype,"type",void 0),u=c=e.__decorate([s.subclass("esri.popup.content.FieldsContent")],u),u})},"esri/popup/FieldInfo":function(){define(["../chunks/tslib.es6","../core/jsonMap","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./support/FieldInfoFormat"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;let d=u=class extends r.JSONSupport{constructor(e){super(e),this.fieldName=null,this.format=void 0,this.isEditable=!0,this.label=null,this.stringFieldOption="text-box",this.statisticType=null,this.tooltip=null,this.visible=!0}clone(){return new u({fieldName:this.fieldName,format:this.format?.clone(),isEditable:this.isEditable,label:this.label,stringFieldOption:this.stringFieldOption,statisticType:this.statisticType,tooltip:this.tooltip,visible:this.visible})}};return e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"fieldName",void 0),e.__decorate([i.property({type:c,json:{write:!0}})],d.prototype,"format",void 0),e.__decorate([i.property({type:Boolean,json:{write:{alwaysWriteDefaults:!0},default:!0}})],d.prototype,"isEditable",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"label",void 0),e.__decorate([a.enumeration(new t.JSONMap({richtext:"rich-text",textarea:"text-area",textbox:"text-box"}),{default:"text-box"})],d.prototype,"stringFieldOption",void 0),e.__decorate([i.property({type:["count","sum","min","max","avg","stddev","var"],json:{write:!0}})],d.prototype,"statisticType",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"tooltip",void 0),e.__decorate([i.property({type:Boolean,json:{write:!0}})],d.prototype,"visible",void 0),d=u=e.__decorate([l.subclass("esri.popup.FieldInfo")],d),d})},"esri/popup/support/FieldInfoFormat":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../intl/date"],function(e,t,r,i,o,s,n,a,l,c){"use strict";let u=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.dateFormat=null,this.digitSeparator=!1,this.places=null}};return e.__decorate([a.enumeration(c.dateFormatJSONMap)],u.prototype,"dateFormat",void 0),e.__decorate([i.property({type:Boolean,json:{write:!0}})],u.prototype,"digitSeparator",void 0),e.__decorate([i.property({type:o.Integer,json:{write:!0}})],u.prototype,"places",void 0),u=e.__decorate([l.subclass("esri.popup.support.FieldInfoFormat")],u),u})},"esri/popup/content/MediaContent":function(){define(["../../chunks/tslib.es6","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./BarChartMediaInfo","./ColumnChartMediaInfo","./Content","./ImageMediaInfo","./LineChartMediaInfo","./PieChartMediaInfo","./support/mediaInfoTypes"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";var m;let y=m=class extends u{constructor(e){super(e),this.activeMediaInfoIndex=null,this.attributes=null,this.description=null,this.mediaInfos=null,this.title=null,this.type="media"}readMediaInfos(e){return e&&e.map(e=>"image"===e.type?d.fromJSON(e):"barchart"===e.type?l.fromJSON(e):"columnchart"===e.type?c.fromJSON(e):"linechart"===e.type?p.fromJSON(e):"piechart"===e.type?h.fromJSON(e):void 0).filter(Boolean)}writeMediaInfos(e,t){t.mediaInfos=e&&e.map(e=>e.toJSON())}clone(){return new m(t.clone({activeMediaInfoIndex:this.activeMediaInfoIndex,attributes:this.attributes,description:this.description,mediaInfos:this.mediaInfos,title:this.title}))}};return e.__decorate([r.property()],y.prototype,"activeMediaInfoIndex",void 0),e.__decorate([r.property({type:Object,json:{write:!0}})],y.prototype,"attributes",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],y.prototype,"description",void 0),e.__decorate([r.property({types:[f.types]})],y.prototype,"mediaInfos",void 0),e.__decorate([s.reader("mediaInfos")],y.prototype,"readMediaInfos",null),e.__decorate([a.writer("mediaInfos")],y.prototype,"writeMediaInfos",null),e.__decorate([r.property({type:String,json:{write:!0}})],y.prototype,"title",void 0),e.__decorate([r.property({type:["media"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],y.prototype,"type",void 0),y=m=e.__decorate([n.subclass("esri.popup.content.MediaContent")],y),y})},"esri/popup/content/BarChartMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/ChartMediaInfo","./support/chartMediaInfoUtils"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.type="bar-chart"}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};return e.__decorate([t.property({type:["bar-chart"],readOnly:!0,json:{type:["barchart"],read:!1,write:{writer:a.chartTypeKebabDict.write,isRequired:!0}}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.BarChartMediaInfo")],c),c})},"esri/popup/content/mixins/ChartMediaInfo":function(){define(["../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./MediaInfo","../support/ChartMediaInfoValue"],function(e,t,r,i,o,s,n,a){"use strict";let l=class extends n{constructor(e){super(e),this.type=null,this.value=void 0}};return e.__decorate([t.property({type:["bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],l.prototype,"type",void 0),e.__decorate([t.property({type:a,json:{write:{isRequired:!0}}})],l.prototype,"value",void 0),l=e.__decorate([s.subclass("esri.popup.content.mixins.ChartMediaInfo")],l),l})},"esri/popup/content/mixins/MediaInfo":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";let a=class extends t.JSONSupport{constructor(e){super(e),this.altText=null,this.caption="",this.title="",this.type=null}};return e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"altText",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"caption",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],a.prototype,"title",void 0),e.__decorate([r.property({type:["image","bar-chart","column-chart","line-chart","pie-chart"],readOnly:!0,json:{read:!1,write:!0}})],a.prototype,"type",void 0),a=e.__decorate([n.subclass("esri.popup.content.mixins.MediaInfo")],a),a})},"esri/popup/content/support/ChartMediaInfoValue":function(){define(["../../../chunks/tslib.es6","../../../Color","../../../core/JSONSupport","../../../core/lang","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/ensureType","../../../core/accessorSupport/decorators/subclass","./ChartMediaInfoValueSeries"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends r.JSONSupport{constructor(e){super(e),this.colors=null,this.fields=[],this.normalizeField=null,this.series=[],this.tooltipField=null}clone(){return new l({colors:i.clone(this.colors),fields:i.clone(this.fields),normalizeField:this.normalizeField,series:i.clone(this.series),tooltipField:this.tooltipField})}};return e.__decorate([o.property({type:[t],json:{type:[[s.Integer]],write:!0}})],c.prototype,"colors",void 0),e.__decorate([o.property({type:[String],json:{write:{isRequired:!0}}})],c.prototype,"fields",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],c.prototype,"normalizeField",void 0),e.__decorate([o.property({type:[a],json:{read:!1}})],c.prototype,"series",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],c.prototype,"tooltipField",void 0),c=l=e.__decorate([n.subclass("esri.popup.content.support.ChartMediaInfoValue")],c),c})},"esri/popup/content/support/ChartMediaInfoValueSeries":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t{constructor(e){super(e),this.color=null,this.fieldName=null,this.tooltip=null,this.value=null}clone(){return new a({color:this.color?.clone(),fieldName:this.fieldName,tooltip:this.tooltip,value:this.value})}};return e.__decorate([r.property()],l.prototype,"color",void 0),e.__decorate([r.property()],l.prototype,"fieldName",void 0),e.__decorate([r.property()],l.prototype,"tooltip",void 0),e.__decorate([r.property()],l.prototype,"value",void 0),l=a=e.__decorate([n.subclass("esri.popup.content.support.ChartMediaInfoValueSeries")],l),l})},"esri/popup/content/support/chartMediaInfoUtils":function(){define(["exports","../../../core/jsonMap"],function(e,t){"use strict";const r=t.strict()({barchart:"bar-chart",columnchart:"column-chart",linechart:"line-chart",piechart:"pie-chart"});e.chartTypeKebabDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/popup/content/ColumnChartMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/ChartMediaInfo","./support/chartMediaInfoUtils"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.type="column-chart"}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};return e.__decorate([t.property({type:["column-chart"],readOnly:!0,json:{type:["columnchart"],read:!1,write:{writer:a.chartTypeKebabDict.write,isRequired:!0}}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.ColumnChartMediaInfo")],c),c})},"esri/popup/content/ImageMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/MediaInfo","./support/ImageMediaInfoValue"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.refreshInterval=0,this.type="image",this.value=void 0}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,refreshInterval:this.refreshInterval,value:this.value?.clone()})}};return e.__decorate([t.property({type:Number,json:{write:!0}})],c.prototype,"refreshInterval",void 0),e.__decorate([t.property({type:["image"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],c.prototype,"type",void 0),e.__decorate([t.property({type:a,json:{write:{isRequired:!0}}})],c.prototype,"value",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.ImageMediaInfo")],c),c})},"esri/popup/content/support/ImageMediaInfoValue":function(){define(["../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t.JSONSupport{constructor(e){super(e),this.linkURL=null,this.sourceURL=null}clone(){return new a({linkURL:this.linkURL,sourceURL:this.sourceURL})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"linkURL",void 0),e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],l.prototype,"sourceURL",void 0),l=a=e.__decorate([n.subclass("esri.popup.content.support.ImageMediaInfoValue")],l),l})},"esri/popup/content/LineChartMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/ChartMediaInfo","./support/chartMediaInfoUtils"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.type="line-chart"}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};return e.__decorate([t.property({type:["line-chart"],readOnly:!0,json:{type:["linechart"],read:!1,write:{writer:a.chartTypeKebabDict.write,isRequired:!0}}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.LineChartMediaInfo")],c),c})},"esri/popup/content/PieChartMediaInfo":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./mixins/ChartMediaInfo","./support/chartMediaInfoUtils"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends n{constructor(e){super(e),this.type="pie-chart"}clone(){return new l({altText:this.altText,title:this.title,caption:this.caption,value:this.value?.clone()})}};return e.__decorate([t.property({type:["pie-chart"],readOnly:!0,json:{type:["piechart"],read:!1,write:{writer:a.chartTypeKebabDict.write,isRequired:!0}}})],c.prototype,"type",void 0),c=l=e.__decorate([s.subclass("esri.popup.content.PieChartMediaInfo")],c),c})},"esri/popup/content/support/mediaInfoTypes":function(){define(["exports","../BarChartMediaInfo","../ColumnChartMediaInfo","../ImageMediaInfo","../LineChartMediaInfo","../PieChartMediaInfo","../mixins/MediaInfo"],function(e,t,r,i,o,s,n){"use strict";const a={base:n,key:"type",defaultKeyValue:"image",typeMap:{"bar-chart":t,"column-chart":r,"line-chart":o,"pie-chart":s,image:i}};e.types=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/popup/content/RelationshipContent":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./Content","../support/RelatedRecordsInfoFieldOrder"],function(e,t,r,i,o,s,n,a,l){"use strict";let c=class extends(t.ClonableMixin(a)){constructor(e){super(e),this.description=null,this.displayCount=null,this.displayType="list",this.orderByFields=null,this.relationshipId=null,this.title=null,this.type="relationship"}};return e.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"description",void 0),e.__decorate([r.property({type:Number,json:{type:i.Integer,write:!0}})],c.prototype,"displayCount",void 0),e.__decorate([r.property({type:["list"],json:{write:{isRequired:!0}}})],c.prototype,"displayType",void 0),e.__decorate([r.property({type:[l],json:{write:!0}})],c.prototype,"orderByFields",void 0),e.__decorate([r.property({type:Number,json:{type:i.Integer,write:{isRequired:!0}}})],c.prototype,"relationshipId",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"title",void 0),e.__decorate([r.property({type:["relationship"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],c.prototype,"type",void 0),c=e.__decorate([n.subclass("esri.popup.content.RelationshipContent")],c),c})},"esri/popup/support/RelatedRecordsInfoFieldOrder":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t.JSONSupport{constructor(e){super(e),this.field=null,this.order=null}clone(){return new a({field:this.field,order:this.order})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"field",void 0),e.__decorate([r.property({type:["asc","desc"],json:{write:!0}})],l.prototype,"order",void 0),l=a=e.__decorate([n.subclass("esri.popup.support.RelatedRecordsInfoFieldOrder")],l),l})},"esri/popup/content/TextContent":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./Content"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends n{constructor(e){super(e),this.text=null,this.type="text"}clone(){return new a({text:this.text})}};return e.__decorate([t.property({type:String,json:{write:!0}})],l.prototype,"text",void 0),e.__decorate([t.property({type:["text"],readOnly:!0,json:{read:!1,write:{isRequired:!0}}})],l.prototype,"type",void 0),l=a=e.__decorate([s.subclass("esri.popup.content.TextContent")],l),l})},"esri/popup/content/UtilityNetworkAssociationsContent":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Content","../support/UtilityNetworkAssociationType"],function(e,t,r,i,o,s,n,a,l,c){"use strict";let u=class extends(t.ClonableMixin(l)){constructor(e){super(e),this.description=null,this.displayCount=null,this.title=null,this.associationTypes=[],this.type="utility-network-associations"}};return e.__decorate([r.property({type:String,json:{write:!0}})],u.prototype,"description",void 0),e.__decorate([r.property({type:Number,json:{type:i.Integer,write:!0}})],u.prototype,"displayCount",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],u.prototype,"title",void 0),e.__decorate([r.property({type:[c],json:{write:!0}})],u.prototype,"associationTypes",void 0),e.__decorate([n.enumeration({utilityNetworkAssociations:"utility-network-associations"})],u.prototype,"type",void 0),u=e.__decorate([a.subclass("esri.popup.content.UtilityNetworkAssociationsContent")],u),u})},"esri/popup/support/UtilityNetworkAssociationType":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";let l=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.title=null,this.description=null,this.type=null,this.associatedNetworkSourceId=null,this.associatedAssetGroup=null,this.associatedAssetType=null}};return e.__decorate([i.property({type:String,json:{write:!0}})],l.prototype,"title",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],l.prototype,"description",void 0),e.__decorate([i.property({type:["attachment","connectivity","container","content","structure"],json:{write:!0}})],l.prototype,"type",void 0),e.__decorate([i.property({type:Number,json:{type:o.Integer,write:!0}})],l.prototype,"associatedNetworkSourceId",void 0),e.__decorate([i.property({type:Number,json:{type:o.Integer,write:!0}})],l.prototype,"associatedAssetGroup",void 0),e.__decorate([i.property({type:Number,json:{type:o.Integer,write:!0}})],l.prototype,"associatedAssetType",void 0),l=e.__decorate([a.subclass("esri.popup.support.UtilityNetworkAssociationType")],l),l})},"esri/popup/ExpressionInfo":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t.JSONSupport{constructor(e){super(e),this.name=null,this.title=null,this.expression=null,this.returnType=null}clone(){return new a({name:this.name,title:this.title,expression:this.expression,returnType:this.returnType})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"name",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"title",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"expression",void 0),e.__decorate([r.property({type:["string","number"],json:{write:!0}})],l.prototype,"returnType",void 0),l=a=e.__decorate([n.subclass("esri.popup.ExpressionInfo")],l),l})},"esri/popup/LayerOptions":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t.JSONSupport{constructor(e){super(e),this.returnTopmostRaster=null,this.showNoDataRecords=null}clone(){return new a({showNoDataRecords:this.showNoDataRecords,returnTopmostRaster:this.returnTopmostRaster})}};return e.__decorate([r.property({type:Boolean,json:{write:!0}})],l.prototype,"returnTopmostRaster",void 0),e.__decorate([r.property({type:Boolean,json:{write:!0}})],l.prototype,"showNoDataRecords",void 0),l=a=e.__decorate([n.subclass("esri.popup.LayerOptions")],l),l})},"esri/popup/RelatedRecordsInfo":function(){define(["../chunks/tslib.es6","../core/JSONSupport","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","./support/RelatedRecordsInfoFieldOrder"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends t.JSONSupport{constructor(e){super(e),this.showRelatedRecords=null,this.orderByFields=null}clone(){return new l({showRelatedRecords:this.showRelatedRecords,orderByFields:this.orderByFields?r.clone(this.orderByFields):null})}};return e.__decorate([i.property({type:Boolean,json:{write:!0}})],c.prototype,"showRelatedRecords",void 0),e.__decorate([i.property({type:[a],json:{write:!0}})],c.prototype,"orderByFields",void 0),c=l=e.__decorate([n.subclass("esri.popup.RelatedRecordsInfo")],c),c})},"esri/support/actions/ActionBase":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/Identifiable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends(r.IdentifiableMixin(t)){constructor(e){super(e),this.active=!1,this.className=null,this.disabled=!1,this.icon=null,this.id=null,this.indicator=!1,this.title=null,this.type=null,this.visible=!0}clone(){return new l({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible})}};return e.__decorate([i.property()],c.prototype,"active",void 0),e.__decorate([i.property()],c.prototype,"className",void 0),e.__decorate([i.property()],c.prototype,"disabled",void 0),e.__decorate([i.property()],c.prototype,"icon",void 0),e.__decorate([i.property()],c.prototype,"id",void 0),e.__decorate([i.property()],c.prototype,"indicator",void 0),e.__decorate([i.property()],c.prototype,"title",void 0),e.__decorate([i.property()],c.prototype,"type",void 0),e.__decorate([i.property()],c.prototype,"visible",void 0),c=l=e.__decorate([a.subclass("esri.support.actions.ActionBase")],c),c})},"esri/core/Identifiable":function(){define(["exports","../chunks/tslib.es6","./accessorSupport/decorators/subclass"],function(e,t,r){"use strict";let i=0;const o=e=>{const o=e;let s=class extends o{constructor(...e){super(...e),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:Date.now().toString(16)+"-object-"+i++})}};return s=t.__decorate([r.subclass("esri.core.Identifiable")],s),s},s=o(class{});e.Identifiable=s,e.IdentifiableMixin=o,e.NumericIdentifiableMixin=e=>{const o=e;let s=class extends o{constructor(...e){super(...e),Object.defineProperty(this,"uid",{writable:!1,configurable:!1,value:i++})}};return s=t.__decorate([r.subclass("esri.core.Identifiable.NumericIdentifiable")],s),s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/actions/ActionButton":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./ActionBase"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends n{constructor(e){super(e),this.image=null,this.type="button"}clone(){return new a({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image})}};return e.__decorate([t.property()],l.prototype,"image",void 0),l=a=e.__decorate([s.subclass("esri.support.actions.ActionButton")],l),l})},"esri/support/actions/ActionToggle":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./ActionBase"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends n{constructor(e){super(e),this.image=null,this.type="toggle",this.value=!1}clone(){return new a({active:this.active,className:this.className,disabled:this.disabled,icon:this.icon,id:this.id,indicator:this.indicator,title:this.title,visible:this.visible,image:this.image,value:this.value})}};return e.__decorate([t.property()],l.prototype,"image",void 0),e.__decorate([t.property()],l.prototype,"value",void 0),l=a=e.__decorate([s.subclass("esri.support.actions.ActionToggle")],l),l})},"esri/symbols/support/typeUtils":function(){define(["exports","../../core/accessorSupport/ensureType","../../core/accessorSupport/extensions/serializableProperty/reader","../CIMSymbol","../LabelSymbol3D","../LineSymbol3D","../MeshSymbol3D","../PictureFillSymbol","../PictureMarkerSymbol","../PointSymbol3D","../PolygonSymbol3D","../SimpleFillSymbol","../SimpleLineSymbol","../SimpleMarkerSymbol","../Symbol","../TextSymbol","../WebStyleSymbol"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";const g={base:f,key:"type",typeMap:{"simple-fill":d,"picture-fill":a,"picture-marker":l,"simple-line":p,"simple-marker":h,text:m,"label-3d":o,"line-3d":s,"mesh-3d":n,"point-3d":c,"polygon-3d":u,"web-style":y,cim:i},errorContext:"symbol"},b={base:f,key:"type",typeMap:{"simple-fill":d,cim:i},errorContext:"symbol"},_={base:f,key:"type",typeMap:{"picture-marker":l,"simple-marker":h,"point-3d":c,cim:i},errorContext:"symbol"},v={base:f,key:"type",typeMap:{"simple-line":p,"line-3d":s,cim:i},errorContext:"symbol"},S={base:f,key:"type",typeMap:{"simple-fill":d,"picture-fill":a,"polygon-3d":u,cim:i},errorContext:"symbol"},x={base:f,key:"type",typeMap:{"picture-marker":l,"simple-marker":h,text:m,"web-style":y,cim:i},errorContext:"symbol"},w=r.createTypeReader({types:g}),M={base:f,key:"type",typeMap:{"simple-fill":d,"picture-fill":a,"picture-marker":l,"simple-line":p,"simple-marker":h,text:m,"line-3d":s,"mesh-3d":n,"point-3d":c,"polygon-3d":u,"web-style":y,cim:i},errorContext:"symbol"},T={base:f,key:"type",typeMap:{text:m,"label-3d":o},errorContext:"symbol"},P={base:f,key:"type",typeMap:{"label-3d":o,"line-3d":s,"mesh-3d":n,"point-3d":c,"polygon-3d":u,"web-style":y},errorContext:"symbol"},I={base:f,key:"type",typeMap:{"line-3d":s,"mesh-3d":n,"point-3d":c,"polygon-3d":u,"web-style":y,cim:i},errorContext:"symbol"},C={base:f,key:"type",typeMap:{"label-3d":o},errorContext:"symbol"},O=t.ensureOneOfType(g);e.ensureType=O,e.isSymbol=function(e){return e instanceof f},e.isSymbol2D=function(e){if(!e)return!1;switch(e.type){case"picture-fill":case"picture-marker":case"simple-fill":case"simple-line":case"simple-marker":case"text":case"cim":return!0;default:return!1}},e.isSymbol3D=function(e){switch(e?.type){case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":return!0;default:return!1}},e.lineSymbolTypes=v,e.pointSymbolTypes=_,e.polygonSymbolTypes=S,e.readSymbol=w,e.simpleFillAndCIMSymbolTypes=b,e.symbolTypes=g,e.symbolTypes3D=P,e.symbolTypesCluster=x,e.symbolTypesLabel=T,e.symbolTypesLabel3D=C,e.symbolTypesRenderer=M,e.symbolTypesRenderer3D=I,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/CIMSymbol":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/string","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../layers/support/fieldUtils","./Symbol"],function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;return e.default=h=class extends p{constructor(e){super(e),this.data=null,this.type="cim"}readData(e,t){return t}writeData(e,t){Object.assign(t,e)}async collectRequiredFields(e,t){if("CIMSymbolReference"===this.data?.type){const r=this.data.primitiveOverrides;if(r){const i=r.map(r=>{const i=r.valueExpressionInfo;return i?d.collectArcadeFieldNames(e,t,i.expression):null});await Promise.all(i)}}}clone(){return new h({data:r.clone(this.data)})}hash(){return i.numericHash(JSON.stringify(this.data)).toString()}},t.__decorate([o.property({json:{write:!1}})],e.default.prototype,"color",void 0),t.__decorate([o.property({json:{write:!0}})],e.default.prototype,"data",void 0),t.__decorate([l.reader("data",["symbol"])],e.default.prototype,"readData",null),t.__decorate([u.writer("data",{})],e.default.prototype,"writeData",null),t.__decorate([a.enumeration({CIMSymbolReference:"cim"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=h=t.__decorate([c.subclass("esri.symbols.CIMSymbol")],e.default),e.default})},"esri/symbols/Symbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/jsonMap","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";const d=new i.JSONMap({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let p=0;return e.default=class extends o.JSONSupport{constructor(e){super(e),this.id="sym"+p++,this.type=null,this.color=new r([0,0,0,1])}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}},t.__decorate([s.property({type:d.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:d.write,isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:r,json:{write:{allowNull:!0}}})],e.default.prototype,"color",void 0),t.__decorate([c.reader("color")],e.default.prototype,"readColor",null),e.default=t.__decorate([u.subclass("esri.symbols.Symbol")],e.default),e.default})},"esri/symbols/LabelSymbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3D","./TextSymbol3DLayer","./callouts/calloutUtils","./support/Symbol3DVerticalOffset"],function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;const f=r.ofType({base:null,key:"type",typeMap:{text:u}});return e.default=h=class extends c{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.styleOrigin=null,this.symbolLayers=new f,this.type="label-3d"}supportsCallout(){return!0}hasVisibleCallout(){return d.hasVisibleCallout(this)}hasVisibleVerticalOffset(){return d.hasVisibleVerticalOffset(this)}clone(){return new h({styleOrigin:i.clone(this.styleOrigin),symbolLayers:i.clone(this.symbolLayers),thumbnail:i.clone(this.thumbnail),callout:i.clone(this.callout),verticalOffset:i.clone(this.verticalOffset)})}static fromTextSymbol(e){return new h({symbolLayers:new r([u.fromTextSymbol(e)])})}},t.__decorate([o.property({type:p,json:{write:!0}})],e.default.prototype,"verticalOffset",void 0),t.__decorate([o.property(d.calloutProperty)],e.default.prototype,"callout",void 0),t.__decorate([o.property({json:{read:!1,write:!1}})],e.default.prototype,"styleOrigin",void 0),t.__decorate([o.property({type:f})],e.default.prototype,"symbolLayers",void 0),t.__decorate([a.enumeration({LabelSymbol3D:"label-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=h=t.__decorate([l.subclass("esri.symbols.LabelSymbol3D")],e.default),e.default})},"esri/symbols/Symbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/collectionUtils","../core/Logger","../core/urlUtils","../core/Warning","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../portal/Portal","../chunks/persistableUrlUtils","./ExtrudeSymbol3DLayer","./FillSymbol3DLayer","./IconSymbol3DLayer","./LineSymbol3DLayer","./ObjectSymbol3DLayer","./PathSymbol3DLayer","./Symbol","./Symbol3DLayer","./TextSymbol3DLayer","./WaterSymbol3DLayer","./support/StyleOrigin","./support/Thumbnail"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M,T,P,I){"use strict";const C={icon:b,object:v,line:_,path:S,fill:g,extrude:y,text:M,water:T},O=r.ofType({base:w,key:"type",typeMap:C,errorContext:"symbol-layer"});return e.default=class extends x{constructor(e){super(e),this.styleOrigin=null,this.thumbnail=null,this.type=null;const t=this.__accessor__&&this.__accessor__.metadata&&this.__accessor__.metadata.symbolLayers,i=t?.type,o=i||r;this._set("symbolLayers",new o)}get color(){return null}set color(e){this.constructed&&o.getLogger(this).error("Symbol3D does not support colors on the symbol level. Colors may be set on individual symbol layer materials instead.")}set symbolLayers(e){i.referenceSetter(e,this._get("symbolLayers"))}readStyleOrigin(e,t,r){if(e.styleUrl&&e.name){const t=m.fromJSON(e.styleUrl,r);return new P({styleUrl:t,name:e.name})}if(e.styleName&&e.name)return new P({portal:r?.portal||f.getDefault(),styleName:e.styleName,name:e.name});r?.messages&&r.messages.push(new n("symbol3d:incomplete-style-origin","Style origin requires either a 'styleUrl' or 'styleName' and a 'name' property",{context:r,definition:e}))}writeStyleOrigin(e,t,r,i){if(e.styleUrl&&e.name){let r=m.toJSON(e.styleUrl,i);s.isAbsolute(r)&&(r=s.normalize(r)),t.styleOrigin={styleUrl:r,name:e.name}}else e.styleName&&e.name&&(e.portal&&i?.portal&&!s.hasSamePortal(e.portal.restUrl,i.portal.restUrl)?i?.messages&&i.messages.push(new n("symbol:cross-portal","The symbol style origin cannot be persisted because it refers to an item on a different portal than the one being saved to.",{symbol:this})):t.styleOrigin={styleName:e.styleName,name:e.name})}normalizeCtorArgs(e){return e instanceof w||e&&C[e.type]?{symbolLayers:[e]}:Array.isArray(e)?{symbolLayers:e}:e}},t.__decorate([a.property({json:{read:!1,write:!1}})],e.default.prototype,"color",null),t.__decorate([a.property({type:O,nonNullable:!0,json:{write:!0}}),l.cast(i.castForReferenceSetter)],e.default.prototype,"symbolLayers",null),t.__decorate([a.property({type:P})],e.default.prototype,"styleOrigin",void 0),t.__decorate([d.reader("styleOrigin")],e.default.prototype,"readStyleOrigin",null),t.__decorate([h.writer("styleOrigin",{"styleOrigin.styleUrl":{type:String},"styleOrigin.styleName":{type:String},"styleOrigin.name":{type:String}})],e.default.prototype,"writeStyleOrigin",null),t.__decorate([a.property({type:I.Thumbnail,json:{read:!1}})],e.default.prototype,"thumbnail",void 0),t.__decorate([a.property({type:["point-3d","line-3d","polygon-3d","mesh-3d","label-3d"],readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([p.subclass("esri.symbols.Symbol3D")],e.default),e.default})},"esri/core/collectionUtils":function(){define(["exports","./Collection"],function(e,t){"use strict";e.castForReferenceSetter=function(e){return e},e.referenceSetter=function(e,r,i=t){return r||(r=new i),r===e||r.destroyed||(r.removeAll(),function(e){return e&&(Array.isArray(e)||"items"in e&&Array.isArray(e.items))}(e)?r.addMany(e):e&&r.add(e)),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/portal/Portal":function(){define(["require","exports","../chunks/tslib.es6","../config","../kernel","../request","../core/Error","../core/JSONSupport","../core/Loadable","../core/maybe","../core/promiseUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../geometry/Extent","../intl/locale","./portalDefault","./PortalGroup","./PortalQueryParams","./PortalQueryResult","./PortalUser","../support/apiKeyUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M){"use strict";const T=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));var P;let I;const C={PortalGroup:()=>Promise.resolve({default:v}),PortalItem:()=>new Promise((t,r)=>e(["./PortalItem"],e=>t(T(e)),r)),PortalUser:()=>Promise.resolve({default:w})};t.default=class extends(a.JSONSupportMixin(l.Loadable)){static{P=this}static{this.AUTH_MODE_ANONYMOUS="anonymous"}static{this.AUTH_MODE_AUTO="auto"}static{this.AUTH_MODE_IMMEDIATE="immediate"}static{this.AUTH_MODE_NO_PROMPT="no-prompt"}constructor(e){super(e),this._esriIdCredentialCreateHandle=null,this.access=null,this.allSSL=!1,this.authMode="auto",this.authorizedCrossOriginDomains=null,this.basemapGalleryGroupQuery=null,this.basemapGalleryGroupQuery3D=null,this.bingKey=null,this.canListApps=!1,this.canListData=!1,this.canListPreProvisionedItems=!1,this.canProvisionDirectPurchase=!1,this.canSearchPublic=!0,this.canShareBingPublic=!1,this.canSharePublic=!1,this.canSignInArcGIS=!1,this.canSignInIDP=!1,this.colorSetsGroupQuery=null,this.commentsEnabled=!1,this.created=null,this.culture=null,this.customBaseUrl=null,this.default3DBasemapQuery=null,this.defaultBasemap=null,this.defaultDevBasemap=null,this.defaultExtent=null,this.defaultVectorBasemap=null,this.description=null,this.devBasemapGalleryGroupQuery=null,this.eueiEnabled=null,this.featuredGroups=null,this.featuredItemsGroupQuery=null,this.galleryTemplatesGroupQuery=null,this.layoutGroupQuery=null,this.livingAtlasGroupQuery=null,this.hasCategorySchema=!1,this.hasClassificationSchema=!1,this.helperServices=null,this.homePageFeaturedContent=null,this.homePageFeaturedContentCount=null,this.httpPort=null,this.httpsPort=null,this.id=null,this.ipCntryCode=null,this.isPortal=!1,this.isReadOnly=!1,this.layerTemplatesGroupQuery=null,this.maxTokenExpirationMinutes=null,this.modified=null,this.name=null,this.portalHostname=null,this.portalMode=null,this.portalProperties=null,this.region=null,this.recycleBinEnabled=!1,this.rotatorPanels=null,this.showHomePageDescription=!1,this.sourceJSON=null,this.supportsHostedServices=!1,this.symbolSetsGroupQuery=null,this.templatesGroupQuery=null,this.units=null,this.url=i.portalUrl,this.urlKey=null,this.user=null,this.use3dBasemaps=!0,this.useDefault3dBasemap=!1,this.useStandardizedQuery=!1,this.useVectorBasemaps=!1,this.vectorBasemapGalleryGroupQuery=null}normalizeCtorArgs(e){return"string"==typeof e?{url:e}:e}destroy(){O.unregister(this),this.defaultBasemap=c.destroyMaybe(this.defaultBasemap),this.defaultDevBasemap=c.destroyMaybe(this.defaultDevBasemap),this.defaultVectorBasemap=c.destroyMaybe(this.defaultVectorBasemap),this._esriIdCredentialCreateHandle=c.removeMaybe(this._esriIdCredentialCreateHandle)}readAuthorizedCrossOriginDomains(e){if(e)for(const t of e)i.request.trustedServers.includes(t)||i.request.trustedServers.push(t);return e}readDefaultBasemap(e){return this._readBasemap(e)}readDefaultDevBasemap(e){return this._readBasemap(e)}readDefaultVectorBasemap(e){return this._readBasemap(e)}get extraQuery(){const e=this.user?.orgId,t=!e||this.canSearchPublic;return this.id&&!t?` AND orgid:${this.id}`:null}get hasAPIKey(){return M.isApiKeyApplicable(this.restUrl)}get isOrganization(){return!!this.access}get itemPageUrl(){return this.url?`${this.url}/home/item.html`:null}get loaded(){return super.loaded}get restUrl(){let e=this.url;if(e){const t=e.indexOf("/sharing");e=t>0?e.slice(0,t):this.url.replace(/\/+$/,""),e+="/sharing/rest"}return e}get thumbnailUrl(){const e=this.restUrl,t=this.thumbnail;return e&&t?this._normalizeSSL(e+"/portals/self/resources/"+t):null}readUrlKey(e){return e?e.toLowerCase():e}readUser(e){let t=null;return e&&(t=w.fromJSON(e),t.portal=this),t}load(t){const r=new Promise((t,r)=>e(["../Basemap"],e=>t(T(e)),r)).then(({default:e})=>{u.throwIfAborted(t),I=e}).then(()=>this.sourceJSON?this.sourceJSON:this.fetchSelf(this.authMode,!1,t)).then(e=>{if(!this.hasAPIKey&&o.id){const e=o.id;this.credential=e.findCredential(this.restUrl),this.credential||this.authMode!==P.AUTH_MODE_AUTO&&this.authMode!==P.AUTH_MODE_NO_PROMPT||(this._esriIdCredentialCreateHandle?.remove(),this._esriIdCredentialCreateHandle=e.on("credential-create",function(e){const t=o.id;return()=>{const r=e.deref();r&&t.findCredential(r.restUrl)&&r.signIn().catch(()=>{})}}(new WeakRef(this))),O.register(this,this._esriIdCredentialCreateHandle,this))}this.sourceJSON=e,this.read(e)});return this.addResolvingPromise(r),Promise.resolve(this)}async createElevationLayers(){await this.load();const t=this._getHelperService("defaultElevationLayers"),r=(await new Promise((t,r)=>e(["../layers/ElevationLayer"],e=>t(T(e)),r))).default;return t?t.map(e=>new r({id:e.id,url:e.url})):[]}async fetchBasemaps(e,t){const r=await this._fetchBasemaps(e,t);if(!0===t?.include3d&&!1!==this.use3dBasemaps){const i=await this._fetchBasemaps3D(e,t);r.unshift(...i)}return r}async fetchDefault3DBasemap(e){if(!this.useDefault3dBasemap||!this.default3DBasemapQuery||"none"===this.default3DBasemapQuery)return null;const t=new S;t.query=this.default3DBasemapQuery,t.disableExtraQuery=!0;const r=(await this.queryItems(t,e)).results.find(e=>"Web Scene"===e.type);return r?new I({portalItem:r}):null}fetchCategorySchema(e){return this.hasCategorySchema?this.request(this.restUrl+"/portals/self/categorySchema",e).then(e=>e.categorySchema):u.isAborted(e)?Promise.reject(u.createAbortError()):Promise.resolve([])}async fetchClassificationSchema(e){return this.hasClassificationSchema?this.request(this.restUrl+"/portals/self/classification/classificationSchema",e).then(e=>e.classificationSchema):null}fetchFeaturedGroups(e){const t=this.featuredGroups,r=new S({num:100,sortField:"title"});if(t?.length){const i=[];for(const e of t)i.push(`(title:"${e.title}" AND owner:${e.owner})`);return r.query=i.join(" OR "),this.queryGroups(r,e).then(e=>e.results)}return u.isAborted(e)?Promise.reject(u.createAbortError()):Promise.resolve([])}fetchRegions(e){const t=this.user?.culture||this.culture||b.getLocale();return this.request(this.restUrl+"/portals/regions",{...e,query:{culture:t}})}fetchSettings(e){const t=this.user?.culture||this.culture||b.getLocale();return this.request(this.restUrl+"/portals/self/settings",{...e,query:{culture:t}})}static getDefault(){return _.ensureDefaultPortalInstance(()=>new P)}queryGroups(e,t){return this.queryPortal("/community/groups",e,"PortalGroup",t)}queryItems(e,t){return this.queryPortal("/search",e,"PortalItem",t)}queryUsers(e,t){return e.sortField||(e.sortField="username"),this.queryPortal("/community/users",e,"PortalUser",t)}fetchSelf(e=this.authMode,t=!1,r){const i=this.restUrl+"/portals/self",o={authMode:e,query:{culture:b.getLocale().toLowerCase()},withCredentials:!0,...r};return"auto"===o.authMode&&(o.authMode="no-prompt"),t&&(o.query.default=!0),this.request(i,o)}queryPortal(e,t,r,i){const o=p.ensureType(S,t),s=t=>this.request(this.restUrl+e,{...o.toRequestOptions(this),...i}).then(e=>{const r=o.clone();return r.start=e.nextStart,new x({nextQueryParams:r,queryParams:o,total:e.total,results:P._resultsToTypedArray(t,{portal:this},e,i)})}).then(e=>Promise.all(e.results.map(t=>"function"==typeof t.when?t.when():e)).then(()=>e,t=>(u.throwIfAbortError(t),e)));return r&&C[r]?C[r]().then(({default:e})=>(u.throwIfAborted(i),s(e))):s()}signIn(){if(this.hasAPIKey)return this.load().then(()=>{if(!this.user)throw new n("portal:not-authenticated","Unable to authenticate user. Portal.user is missing")});if(this.authMode===P.AUTH_MODE_ANONYMOUS||this.authMode===P.AUTH_MODE_NO_PROMPT&&!o.id)return Promise.reject(new n("portal:invalid-auth-mode",`Current "authMode"' is "${this.authMode}"`));if("failed"===this.loadStatus)return Promise.reject(this.loadError);const e=e=>Promise.resolve().then(()=>"not-loaded"===this.loadStatus?(e||(this.authMode="immediate"),this.load().then(()=>null)):"loading"===this.loadStatus?this.load().then(()=>this.credential?null:(this.credential=e,this.fetchSelf("immediate"))):this.user&&this.credential===e?null:(this.credential=e,this.fetchSelf("immediate"))).then(e=>{e&&(this.sourceJSON=e,this.read(e))});return o.id?o.id.getCredential(this.restUrl,{prompt:this.authMode!==P.AUTH_MODE_NO_PROMPT}).then(t=>e(t)):e(this.credential)}normalizeUrl(e){const t=this.credential?.token;return this._normalizeSSL(t?e+(e.includes("?")?"&":"?")+"token="+t:e)}requestToTypedArray(e,t,r){return this.request(e,t).then(e=>{const t=P._resultsToTypedArray(r,{portal:this},e);return Promise.all(t.map(t=>"function"==typeof t.when?t.when():e)).then(()=>t,()=>t)})}request(e,t={}){const r={f:"json",...t.query},{authMode:i=(this.authMode===P.AUTH_MODE_ANONYMOUS||this.authMode===P.AUTH_MODE_NO_PROMPT?this.authMode:"auto"),body:o=null,cacheBust:n=!1,method:a="auto",responseType:l="json",signal:c}=t,u={authMode:i,body:o,cacheBust:n,method:a,query:r,responseType:l,timeout:0,signal:c};return t.withCredentials&&(u.withCredentials=!0),s(this._normalizeSSL(e),u).then(e=>e.data)}toJSON(){throw new n("internal:not-yet-implemented","Portal.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");return new P({sourceJSON:e})}_getHelperService(e){const t=this.helperServices&&this.helperServices[e];if(!t)throw new n("portal:service-not-found",`The \`helperServices\` do not include an entry named "${e}"`);return t}async _fetchBasemaps(e,t){const r=new S;r.query=e||(M.hasBasemapStylesApiKey()?this.devBasemapGalleryGroupQuery:this.useVectorBasemaps?this.vectorBasemapGalleryGroupQuery:this.basemapGalleryGroupQuery),r.disableExtraQuery=!0;const i=await this.queryGroups(r,t);if(!i.total)return[];const o=i.results[0];r.num=100,r.query='type:"Web Map" -type:"Web Application"',r.sortField=o.sortField||"name",r.sortOrder=o.sortOrder||"desc";const s=await o.queryItems(r,t);return s.total?s.results.filter(e=>"Web Map"===e.type).map(e=>new I({portalItem:e})):[]}async _fetchBasemaps3D(e,t){const r=e||this.basemapGalleryGroupQuery3D;if(!r)return[];if(M.hasBasemapStylesApiKey())return[];const i=new S({query:r,disableExtraQuery:!0}),o=await this.queryGroups(i,t);if(!o.total)return[];const s=o.results[0];i.num=100,i.query='type:"Web Scene"',i.sortField=s.sortField||"name",i.sortOrder=s.sortOrder||"desc";const n=await s.queryItems(i,t);return n.total?n.results.filter(e=>"Web Scene"===e.type).map(e=>new I({portalItem:e})):[]}_normalizeSSL(e){return e.replace(/^http:/i,"https:").replace(":7080",":7443")}_readBasemap(e){if(e){const t=I.fromJSON(e);return t.portalItem={portal:this},t}return null}static _resultsToTypedArray(e,t,r,i){let o;if(r){const s=null!=i?i.signal:null;o=r.listings||r.notifications||r.userInvitations||r.tags||r.items||r.groups||r.comments||r.provisions||r.results||r.relatedItems||r,(e||t)&&(o=o.map(r=>{const i=Object.assign(e?e.fromJSON(r):r,t);return"function"==typeof i.load&&i.load(s),i}))}else o=[];return o}},r.__decorate([d.property()],t.default.prototype,"access",void 0),r.__decorate([d.property()],t.default.prototype,"allSSL",void 0),r.__decorate([d.property()],t.default.prototype,"authMode",void 0),r.__decorate([d.property()],t.default.prototype,"authorizedCrossOriginDomains",void 0),r.__decorate([m.reader("authorizedCrossOriginDomains")],t.default.prototype,"readAuthorizedCrossOriginDomains",null),r.__decorate([d.property()],t.default.prototype,"basemapGalleryGroupQuery",void 0),r.__decorate([d.property({json:{name:"3DBasemapGalleryGroupQuery"}})],t.default.prototype,"basemapGalleryGroupQuery3D",void 0),r.__decorate([d.property()],t.default.prototype,"bingKey",void 0),r.__decorate([d.property()],t.default.prototype,"canListApps",void 0),r.__decorate([d.property()],t.default.prototype,"canListData",void 0),r.__decorate([d.property()],t.default.prototype,"canListPreProvisionedItems",void 0),r.__decorate([d.property()],t.default.prototype,"canProvisionDirectPurchase",void 0),r.__decorate([d.property()],t.default.prototype,"canSearchPublic",void 0),r.__decorate([d.property()],t.default.prototype,"canShareBingPublic",void 0),r.__decorate([d.property()],t.default.prototype,"canSharePublic",void 0),r.__decorate([d.property()],t.default.prototype,"canSignInArcGIS",void 0),r.__decorate([d.property()],t.default.prototype,"canSignInIDP",void 0),r.__decorate([d.property()],t.default.prototype,"colorSetsGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"commentsEnabled",void 0),r.__decorate([d.property({type:Date})],t.default.prototype,"created",void 0),r.__decorate([d.property()],t.default.prototype,"credential",void 0),r.__decorate([d.property()],t.default.prototype,"culture",void 0),r.__decorate([d.property()],t.default.prototype,"currentVersion",void 0),r.__decorate([d.property()],t.default.prototype,"customBaseUrl",void 0),r.__decorate([d.property()],t.default.prototype,"default3DBasemapQuery",void 0),r.__decorate([d.property()],t.default.prototype,"defaultBasemap",void 0),r.__decorate([m.reader("defaultBasemap")],t.default.prototype,"readDefaultBasemap",null),r.__decorate([d.property()],t.default.prototype,"defaultDevBasemap",void 0),r.__decorate([m.reader("defaultDevBasemap")],t.default.prototype,"readDefaultDevBasemap",null),r.__decorate([d.property({type:g})],t.default.prototype,"defaultExtent",void 0),r.__decorate([d.property()],t.default.prototype,"defaultVectorBasemap",void 0),r.__decorate([m.reader("defaultVectorBasemap")],t.default.prototype,"readDefaultVectorBasemap",null),r.__decorate([d.property()],t.default.prototype,"description",void 0),r.__decorate([d.property()],t.default.prototype,"devBasemapGalleryGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"eueiEnabled",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"extraQuery",null),r.__decorate([d.property()],t.default.prototype,"featuredGroups",void 0),r.__decorate([d.property()],t.default.prototype,"featuredItemsGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"galleryTemplatesGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"layoutGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"livingAtlasGroupQuery",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"hasAPIKey",null),r.__decorate([d.property()],t.default.prototype,"hasCategorySchema",void 0),r.__decorate([d.property()],t.default.prototype,"hasClassificationSchema",void 0),r.__decorate([d.property()],t.default.prototype,"helpBase",void 0),r.__decorate([d.property()],t.default.prototype,"helperServices",void 0),r.__decorate([d.property()],t.default.prototype,"helpMap",void 0),r.__decorate([d.property()],t.default.prototype,"homePageFeaturedContent",void 0),r.__decorate([d.property()],t.default.prototype,"homePageFeaturedContentCount",void 0),r.__decorate([d.property()],t.default.prototype,"httpPort",void 0),r.__decorate([d.property()],t.default.prototype,"httpsPort",void 0),r.__decorate([d.property()],t.default.prototype,"id",void 0),r.__decorate([d.property()],t.default.prototype,"ipCntryCode",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"isOrganization",null),r.__decorate([d.property()],t.default.prototype,"isPortal",void 0),r.__decorate([d.property()],t.default.prototype,"isReadOnly",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"itemPageUrl",null),r.__decorate([d.property()],t.default.prototype,"layerTemplatesGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"maxTokenExpirationMinutes",void 0),r.__decorate([d.property({type:Date})],t.default.prototype,"modified",void 0),r.__decorate([d.property()],t.default.prototype,"name",void 0),r.__decorate([d.property()],t.default.prototype,"portalHostname",void 0),r.__decorate([d.property()],t.default.prototype,"portalMode",void 0),r.__decorate([d.property()],t.default.prototype,"portalProperties",void 0),r.__decorate([d.property()],t.default.prototype,"region",void 0),r.__decorate([d.property()],t.default.prototype,"recycleBinEnabled",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"restUrl",null),r.__decorate([d.property()],t.default.prototype,"rotatorPanels",void 0),r.__decorate([d.property()],t.default.prototype,"showHomePageDescription",void 0),r.__decorate([d.property()],t.default.prototype,"sourceJSON",void 0),r.__decorate([d.property()],t.default.prototype,"staticImagesUrl",void 0),r.__decorate([d.property({json:{name:"2DStylesGroupQuery"}})],t.default.prototype,"stylesGroupQuery2d",void 0),r.__decorate([d.property({json:{name:"stylesGroupQuery"}})],t.default.prototype,"stylesGroupQuery3d",void 0),r.__decorate([d.property()],t.default.prototype,"supportsHostedServices",void 0),r.__decorate([d.property()],t.default.prototype,"symbolSetsGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"templatesGroupQuery",void 0),r.__decorate([d.property()],t.default.prototype,"thumbnail",void 0),r.__decorate([d.property({readOnly:!0})],t.default.prototype,"thumbnailUrl",null),r.__decorate([d.property()],t.default.prototype,"units",void 0),r.__decorate([d.property()],t.default.prototype,"url",void 0),r.__decorate([d.property()],t.default.prototype,"urlKey",void 0),r.__decorate([m.reader("urlKey")],t.default.prototype,"readUrlKey",null),r.__decorate([d.property()],t.default.prototype,"user",void 0),r.__decorate([m.reader("user")],t.default.prototype,"readUser",null),r.__decorate([d.property()],t.default.prototype,"use3dBasemaps",void 0),r.__decorate([d.property()],t.default.prototype,"useDefault3dBasemap",void 0),r.__decorate([d.property()],t.default.prototype,"useStandardizedQuery",void 0),r.__decorate([d.property()],t.default.prototype,"useVectorBasemaps",void 0),r.__decorate([d.property()],t.default.prototype,"vectorBasemapGalleryGroupQuery",void 0),t.default=P=r.__decorate([y.subclass("esri.portal.Portal")],t.default);const O=new FinalizationRegistry(e=>{e.remove()});return t.default})},"esri/core/Loadable":function(){define(["exports","../chunks/tslib.es6","./Error","./maybe","./Promise","./promiseUtils","./Warning","./accessorSupport/decorators/property","./accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l){"use strict";const c="loaded",u=e=>{const o=e;let u=class extends o{constructor(...e){super(...e),this._loadController=null,this.loadError=null,this.loadStatus="not-loaded",this._set("loadWarnings",[]),this.addResolvingPromise(new Promise(e=>{const t=this.load.bind(this);this.load=i=>{const o=new Promise((e,t)=>{const o=s.onAbortOrThrow(i,t);this.destroyed&&t(new r("load:instance-destroyed",`Instance of '${this.declaredClass||this.constructor.name}' is already destroyed`,{instance:this})),this.when(e,t).finally(()=>{o&&o.remove()})});if("not-loaded"===this.loadStatus){this._set("loadStatus","loading");const e=this._loadController=new AbortController;t({signal:e.signal})}return e(),o}})),this.when(()=>{this._set("loadStatus",c),this._loadController=null},e=>{this.destroyed||(this._set("loadStatus","failed"),this._set("loadError",e),this._loadController=null)})}destroy(){this._loadController&&(this._loadController=i.abortMaybe(this._loadController),this._promiseProps.abort()),this._set("loadError",null),this._set("loadWarnings",[])}get loaded(){return this.loadStatus===c}get loadWarnings(){return this._get("loadWarnings")}load(e){return null}cancelLoad(){return this.isFulfilled()||(this._set("loadError",new r("load:cancelled","Cancelled")),this._loadController?.abort(),this._promiseProps.abort()),this}};return t.__decorate([a.property({readOnly:!0})],u.prototype,"loaded",null),t.__decorate([a.property({readOnly:!0})],u.prototype,"loadError",void 0),t.__decorate([a.property({clonable:!1})],u.prototype,"loadStatus",void 0),t.__decorate([a.property({type:[n],readOnly:!0})],u.prototype,"loadWarnings",null),u=t.__decorate([l.subclass("esri.core.Loadable")],u),u},d=u(o.EsriPromise);e.Loadable=d,e.LoadableMixin=u,e.isLoadable=function(e){return!(!e||!e.load)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/Promise":function(){define(["exports","../chunks/tslib.es6","./Accessor","./handleUtils","./promiseUtils","./accessorSupport/decorators/subclass"],function(e,t,r,i,o,s){"use strict";class n{constructor(){this._resolver=o.createResolver(),this._status=0,this._resolvingPromises=[],this._resolver.promise.then(()=>{this._status=1,this._cleanUp()},()=>{this._status=2,this._cleanUp()}),this.promise=this._resolver.promise}destroy(){this._cleanUp()}addResolvingPromise(e){this._resolvingPromises.push(e),this._tryResolve()}isResolved(){return 1===this._status}isRejected(){return 2===this._status}isFulfilled(){return 0!==this._status}abort(){this._resolver.reject(o.createAbortError())}_cleanUp(){this._allPromise=null,this._resolvingPromises=null}_tryResolve(){if(this.isFulfilled())return;const e=o.createResolver(),t=[...this._resolvingPromises,e.promise],r=this._allPromise=Promise.all(t);r.then(()=>{this.isFulfilled()||this._allPromise!==r||this._resolver.resolve()},e=>{this.isFulfilled()||this._allPromise!==r||o.isAbortError(e)||this._resolver.reject(e)}),e.resolve()}}const a=e=>{const r=e;let o=class extends r{constructor(...e){super(...e),this._promiseProps=new n,this.addResolvingPromise(Promise.resolve())}destroy(){this._promiseProps.destroy()}isResolved(){return this._promiseProps.isResolved()}isRejected(){return this._promiseProps.isRejected()}isFulfilled(){return this._promiseProps.isFulfilled()}when(e,t){return this._promiseProps.promise.then(()=>this).then(e,t)}catch(e){return this.when(null,e)}addResolvingPromise(e){e&&!this._promiseProps.isFulfilled()&&this._promiseProps.addResolvingPromise("_promiseProps"in e?e.when():e)}addResolvingTask(e){e&&!this._promiseProps.isFulfilled()&&(this.addHandles(i.abortHandle(e)),this._promiseProps.addResolvingPromise(e.promise))}};return o=t.__decorate([s.subclass("esri.core.Promise")],o),o},l=a(r);e.EsriPromise=l,e.EsriPromiseMixin=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/portal/portalDefault":function(){define(["exports"],function(e){"use strict";let t;e.clearDefaultPortalInstance=function(){t=void 0},e.ensureDefaultPortalInstance=function(e){return t&&!t.destroyed||(t=e()),t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/portal/PortalGroup":function(){define(["exports","../chunks/tslib.es6","../core/Error","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./PortalQueryParams"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;return e.default=u=class extends i.JSONSupport{constructor(e){super(e),this.access=null,this.created=null,this.description=null,this.id=null,this.isInvitationOnly=!1,this.modified=null,this.owner=null,this.portal=null,this.snippet=null,this.sortField=null,this.sortOrder=null,this.sourceJSON=null,this.tags=null,this.title=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t&&this.portal?this.portal?.normalizeUrl(`${e}/info/${t}?f=json`):null}get url(){const e=this.portal?.restUrl;return e?e+"/community/groups/"+this.id:null}fetchCategorySchema(e){return this.portal.request(this.url+"/categorySchema",e).then(t=>{const r=t.categorySchema||[];return r.some(e=>"contentCategorySetsGroupQuery.LivingAtlas"===e.source)?this._fetchCategorySchemaSet("LivingAtlas",e):r})}fetchMembers(e){return this.portal.request(this.url+"/users",e)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}toJSON(){throw new r("internal:not-yet-implemented","PortalGroup.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new u({sourceJSON:e});return t.read(e),t}queryItems(e,t){let r=s.ensureType(c,e);const i=this.portal;return parseFloat(i.currentVersion)>5?(r=r||new c,i.queryPortal(`/content/groups/${this.id}/search`,r,"PortalItem",t)):(r=r?r.clone():new c,r.query="group:"+this.id+(r.query?" "+r.query:""),i.queryItems(r,t))}_fetchCategorySchemaSet(e,t){const i=this.portal;return i.fetchSelf(i.authMode,!0,t).then(e=>{const o=e.contentCategorySetsGroupQuery;if(o){const e=new c({disableExtraQuery:!0,num:1,query:o});return i.queryGroups(e,t)}throw new r("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery value not found")}).then(i=>{if(i.total){const r=i.results[0],o=new c({num:1,query:`typekeywords:"${e}"`});return r.queryItems(o,t)}throw new r("portal-group:fetchCategorySchema","contentCategorySetsGroupQuery group not found")}).then(e=>e.total?e.results[0].fetchData("json",t).then(e=>{const t=e?.categorySchema;return t?.length?t:[]}):[])}},t.__decorate([o.property()],e.default.prototype,"access",void 0),t.__decorate([o.property({type:Date})],e.default.prototype,"created",void 0),t.__decorate([o.property()],e.default.prototype,"description",void 0),t.__decorate([o.property()],e.default.prototype,"id",void 0),t.__decorate([o.property()],e.default.prototype,"isInvitationOnly",void 0),t.__decorate([o.property({type:Date})],e.default.prototype,"modified",void 0),t.__decorate([o.property()],e.default.prototype,"owner",void 0),t.__decorate([o.property()],e.default.prototype,"portal",void 0),t.__decorate([o.property()],e.default.prototype,"snippet",void 0),t.__decorate([o.property()],e.default.prototype,"sortField",void 0),t.__decorate([o.property()],e.default.prototype,"sortOrder",void 0),t.__decorate([o.property()],e.default.prototype,"sourceJSON",void 0),t.__decorate([o.property()],e.default.prototype,"tags",void 0),t.__decorate([o.property()],e.default.prototype,"thumbnail",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"thumbnailUrl",null),t.__decorate([o.property()],e.default.prototype,"title",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"url",null),e.default=u=t.__decorate([l.subclass("esri.portal.PortalGroup")],e.default),e.default})},"esri/portal/PortalQueryParams":function(){define(["exports","../chunks/tslib.es6","../core/Accessor","../core/jsonMap","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","../geometry/Extent","../geometry/SpatialReference","../geometry/support/webMercatorUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=new i.JSONMap({avgRating:"avg-rating",numRatings:"num-ratings",numComments:"num-comments",numViews:"num-views"});return e.default=p=class extends r{constructor(e){super(e),this.categories=null,this.disableExtraQuery=!1,this.extent=null,this.filter=null,this.num=10,this.query=null,this.sortField=null,this.start=1}get sortOrder(){return this._get("sortOrder")||"asc"}set sortOrder(e){"asc"!==e&&"desc"!==e||this._set("sortOrder",e)}clone(){return new p({categories:this.categories?o.clone(this.categories):null,disableExtraQuery:this.disableExtraQuery,extent:this.extent?this.extent.clone():null,filter:this.filter,num:this.num,query:this.query,sortField:this.sortField,sortOrder:this.sortOrder,start:this.start})}toRequestOptions(e,t){let r=[];this.categories&&(r=this.categories.map(e=>Array.isArray(e)?JSON.stringify(e):e));let i="";if(this.extent){const e=d.project(this.extent,u.WGS84);null!=e&&(i=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`)}let o=this.query;!this.disableExtraQuery&&e.extraQuery&&(o="("+o+")"+e.extraQuery);const s={categories:r,bbox:i,q:o,filter:this.filter,num:this.num,sortField:null,sortOrder:null,start:this.start};return this.sortField&&(s.sortField=this.sortField.split(",").map(e=>h.toJSON(e.trim())).join(","),s.sortOrder=this.sortOrder),{query:{...t,...s}}}},t.__decorate([s.property()],e.default.prototype,"categories",void 0),t.__decorate([s.property()],e.default.prototype,"disableExtraQuery",void 0),t.__decorate([s.property({type:c})],e.default.prototype,"extent",void 0),t.__decorate([s.property()],e.default.prototype,"filter",void 0),t.__decorate([s.property()],e.default.prototype,"num",void 0),t.__decorate([s.property()],e.default.prototype,"query",void 0),t.__decorate([s.property()],e.default.prototype,"sortField",void 0),t.__decorate([s.property()],e.default.prototype,"sortOrder",null),t.__decorate([s.property()],e.default.prototype,"start",void 0),e.default=p=t.__decorate([l.subclass("esri.portal.PortalQueryParams")],e.default),e.default})},"esri/portal/PortalQueryResult":function(){define(["exports","../chunks/tslib.es6","../core/Accessor","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r{constructor(e){super(e),this.nextQueryParams=null,this.queryParams=null,this.results=null,this.total=null}},t.__decorate([i.property()],e.default.prototype,"nextQueryParams",void 0),t.__decorate([i.property()],e.default.prototype,"queryParams",void 0),t.__decorate([i.property()],e.default.prototype,"results",void 0),t.__decorate([i.property()],e.default.prototype,"total",void 0),e.default=t.__decorate([a.subclass("esri.portal.PortalQueryResult")],e.default),e.default})},"esri/portal/PortalUser":function(){define(["require","exports","../chunks/tslib.es6","../core/Error","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./PortalFolder","./PortalGroup"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";const p=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));var h;return t.default=h=class extends o.JSONSupport{constructor(e){super(e),this.access=null,this.created=null,this.culture=null,this.description=null,this.email=null,this.fullName=null,this.id=null,this.modified=null,this.orgId=null,this.portal=null,this.preferredView=null,this.privileges=null,this.region=null,this.role=null,this.roleId=null,this.sourceJSON=null,this.units=null,this.username=null,this.userLicenseTypeId=null,this.userType=null}get thumbnailUrl(){const e=this.url,t=this.thumbnail;return e&&t?this.portal.normalizeUrl(`${e}/info/${t}?f=json`):null}get userContentUrl(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.id}`:null}get url(){const e=this.portal?.restUrl;return e?`${e}/community/users/${this.id}`:null}addItem(e){const t=e&&e.item,r=e?.data,i=e?.folder,o={method:"post"};t&&(o.query=t.createPostQuery(),null!=r&&("string"==typeof r?o.query.text=r:"object"==typeof r&&(o.query.text=JSON.stringify(r))));let s=this.userContentUrl;return i&&(s+="/"+("string"==typeof i?i:i.id)),this.portal.request(s+"/addItem",o).then(e=>(t.id=e.id,t.portal=this.portal,t.loaded?t.reload():t.load()))}async deleteItem(e,t=!1){let r=this.userContentUrl;e.ownerFolder&&(r+="/"+e.ownerFolder);const i=t?{permanentDelete:!0}:{};await this.portal.request(r+`/items/${e.id}/delete`,{method:"post",query:i}),e.id=null,e.portal=null}async deleteItems(e,t=!1){e=e.slice();const r=this.userContentUrl+"/deleteItems",o=[],s=e.map(e=>e.id);if(s.length){const n={method:"post",query:{items:s.join(","),permanentDelete:t}},a=await this.portal.request(r,n);for(const t of a.results){const r=e.find(e=>t.itemId===e.id),s=t.success;let n=null;s?(r.id=null,r.portal=null):t.error&&(n=new i("portal:delete-item-failed",t.error.message,t.error)),o.push({item:r,success:s,error:n})}}return o}fetchFolders(){return this.portal.request(this.userContentUrl??"",{query:{num:1}}).then(e=>{let t;return t=e&&e.folders?e.folders.map(e=>{const t=u.fromJSON(e);return t.portal=this.portal,t}):[],t})}fetchGroups(){return this.portal.request(this.url??"").then(e=>{let t;return t=e&&e.groups?e.groups.map(e=>{const t=d.fromJSON(e);return t.portal=this.portal,t}):[],t})}async fetchItems(t){t??={};let r=this.userContentUrl??"";t.folder&&(r+="/"+t.folder.id);const{default:i}=await new Promise((t,r)=>e(["./PortalItem"],e=>t(p(e)),r)),o={folders:!1,inRecycleBin:!!t.inRecycleBin||null,foldersContent:!(t.folder||!t.includeSubfolderItems)||null,num:t.num||10,start:t.start||1,sortField:t.sortField||"created",sortOrder:t.sortOrder||"asc"},s=await this.portal.request(r,{query:o});let n;return s?.items?(n=s.items.map(e=>{const t=i.fromJSON(e);return t.portal=this.portal,t}),await Promise.all(n.map(e=>e.load())),{items:n,nextStart:s.nextStart,total:s.total}):{items:[],nextStart:-1,total:0}}fetchTags(){return this.portal.request(this.url+"/tags").then(e=>e.tags)}getThumbnailUrl(e){let t=this.thumbnailUrl;return t&&e&&(t+=`&w=${e}`),t}queryFavorites(e){return this.favGroupId?(this._favGroup||(this._favGroup=new d({id:this.favGroupId,portal:this.portal})),this._favGroup.queryItems(e)):Promise.reject(new i("internal:unknown","Unknown internal error",{internalError:"Unknown favGroupId"}))}async restoreItem(e,t){const r=this.userContentUrl,i=t?{folderID:"string"==typeof t?t:t.id}:null;await this.portal.request(r+`/items/${e.id}/restore`,{method:"post",query:i})}toJSON(){throw new i("internal:not-yet-implemented","PortalUser.toJSON is not yet implemented")}static fromJSON(e){if(!e)return null;if(e.declaredClass)throw new Error("JSON object is already hydrated");const t=new h({sourceJSON:e});return t.read(e),t}},r.__decorate([s.property()],t.default.prototype,"access",void 0),r.__decorate([s.property({type:Date})],t.default.prototype,"created",void 0),r.__decorate([s.property()],t.default.prototype,"culture",void 0),r.__decorate([s.property()],t.default.prototype,"description",void 0),r.__decorate([s.property()],t.default.prototype,"email",void 0),r.__decorate([s.property()],t.default.prototype,"favGroupId",void 0),r.__decorate([s.property()],t.default.prototype,"fullName",void 0),r.__decorate([s.property()],t.default.prototype,"id",void 0),r.__decorate([s.property({type:Date})],t.default.prototype,"modified",void 0),r.__decorate([s.property()],t.default.prototype,"orgId",void 0),r.__decorate([s.property()],t.default.prototype,"portal",void 0),r.__decorate([s.property()],t.default.prototype,"preferredView",void 0),r.__decorate([s.property()],t.default.prototype,"privileges",void 0),r.__decorate([s.property()],t.default.prototype,"region",void 0),r.__decorate([s.property()],t.default.prototype,"role",void 0),r.__decorate([s.property()],t.default.prototype,"roleId",void 0),r.__decorate([s.property()],t.default.prototype,"sourceJSON",void 0),r.__decorate([s.property()],t.default.prototype,"thumbnail",void 0),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"thumbnailUrl",null),r.__decorate([s.property()],t.default.prototype,"units",void 0),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"userContentUrl",null),r.__decorate([s.property({readOnly:!0})],t.default.prototype,"url",null),r.__decorate([s.property()],t.default.prototype,"username",void 0),r.__decorate([s.property()],t.default.prototype,"userLicenseTypeId",void 0),r.__decorate([s.property()],t.default.prototype,"userType",void 0),t.default=h=r.__decorate([c.subclass("esri.portal.PortalUser")],t.default),t.default})},"esri/portal/PortalFolder":function(){define(["exports","../chunks/tslib.es6","../core/Error","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l){"use strict";return e.default=class extends i.JSONSupport{constructor(e){super(e),this.created=null,this.id=null,this.portal=null,this.title=null,this.username=null}get url(){const e=this.portal?.restUrl;return e?`${e}/content/users/${this.username}/${this.id}`:null}toJSON(){throw new r("internal:not-yet-implemented","PortalFolder.toJSON is not yet implemented")}},t.__decorate([o.property({type:Date})],e.default.prototype,"created",void 0),t.__decorate([o.property()],e.default.prototype,"id",void 0),t.__decorate([o.property()],e.default.prototype,"portal",void 0),t.__decorate([o.property()],e.default.prototype,"title",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"url",null),t.__decorate([o.property()],e.default.prototype,"username",void 0),e.default=t.__decorate([l.subclass("esri.portal.PortalFolder")],e.default),e.default})},"esri/symbols/ExtrudeSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./edges/utils","./support/Symbol3DMaterial"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;return e.default=class extends l{static{d=this}constructor(e){super(e),this.type="extrude",this.size=1,this.material=null,this.castShadows=!0,this.edges=null}clone(){return new d({edges:this.edges?.clone(),enabled:this.enabled,material:this.material?.clone(),castShadows:this.castShadows,size:this.size})}},t.__decorate([n.enumeration({Extrude:"extrude"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:Number,json:{write:{enabled:!0,isRequired:!0}},nonNullable:!0})],e.default.prototype,"size",void 0),t.__decorate([r.property({type:u.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e.default.prototype,"castShadows",void 0),t.__decorate([r.property(c.symbol3dEdgesProperty)],e.default.prototype,"edges",void 0),e.default=d=t.__decorate([a.subclass("esri.symbols.ExtrudeSymbol3DLayer")],e.default),e.default})},"esri/symbols/Symbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer"],function(e,t,r,i,o,s,n,a,l){"use strict";return e.default=class extends r.JSONSupport{constructor(e){super(e),this.enabled=!0,this.type=null,this.ignoreDrivers=!1}writeEnabled(e,t,r){e||(t[r]=e)}},t.__decorate([i.property({type:Boolean,json:{read:{source:"enable"},write:{target:"enable"}}})],e.default.prototype,"enabled",void 0),t.__decorate([l.writer("enabled")],e.default.prototype,"writeEnabled",null),t.__decorate([i.property({type:["icon","object","line","path","fill","water","extrude","text"],readOnly:!0,json:{write:{isRequired:!0}}})],e.default.prototype,"type",void 0),e.default=t.__decorate([a.subclass("esri.symbols.Symbol3DLayer")],e.default),e.default})},"esri/symbols/edges/utils":function(){define(["exports","./Edges3D","./SketchEdges3D","./SolidEdges3D"],function(e,t,r,i){"use strict";const o={types:{key:"type",base:t,typeMap:{solid:i,sketch:r}},json:{write:!0}};e.symbol3dEdgesProperty=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/edges/Edges3D":function(){define(["../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/lang","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../support/materialUtils"],function(e,t,r,i,o,s,n,a,l,c){"use strict";let u=class extends r.JSONSupport{constructor(e){super(e),this.color=new t([0,0,0,1]),this.extensionLength=0,this.size=o.px2pt(1)}clone(){}cloneProperties(){return{color:i.clone(this.color),size:this.size,extensionLength:this.extensionLength}}};return e.__decorate([s.property({type:["solid","sketch"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],u.prototype,"type",void 0),e.__decorate([s.property(c.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],u.prototype,"color",void 0),e.__decorate([s.property({...c.screenSizeProperty,json:{write:{overridePolicy:e=>({enabled:!!e})}}})],u.prototype,"extensionLength",void 0),e.__decorate([s.property(c.screenSizeProperty)],u.prototype,"size",void 0),u=e.__decorate([l.subclass("esri.symbols.edges.Edges3D")],u),u})},"esri/symbols/support/materialUtils":function(){define(["exports","../../Color","../../core/screenUtils","../../core/accessorSupport/ensureType","../../webdoc/support/opacityUtils"],function(e,t,r,i,o){"use strict";function s(e,r){const i=null!=r.transparency?o.transparencyToOpacity(r.transparency):1,s=r.color;return s&&Array.isArray(s)?new t([s[0]||0,s[1]||0,s[2]||0,i]):null}function n(e,t){t.color=e.toJSON().slice(0,3);const r=o.opacityToTransparency(e.a);0!==r&&(t.transparency=r)}const a={type:Number,cast:r.toPt,json:{write:!0}};e.colorAndTransparencyProperty=function(e){return{type:t,nonNullable:e?.nonNullable,json:{type:[i.Integer],default:null,read:{source:["color","transparency"],reader:s},write:{target:{color:{type:[i.Integer],isRequired:e?.colorRequiredOnWrite},transparency:{type:i.Integer}},writer:n}}}},e.getEmissiveMode=function(e){return"emissive"===e?0:1},e.screenSizeProperty=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/edges/SketchEdges3D":function(){define(["../../chunks/tslib.es6","../../core/Logger","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Edges3D"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends a{constructor(e){super(e),this.type="sketch"}clone(){return new l(this.cloneProperties())}};return e.__decorate([s.enumeration({sketch:"sketch"},{readOnly:!0})],c.prototype,"type",void 0),c=l=e.__decorate([n.subclass("esri.symbols.edges.SketchEdges3D")],c),c})},"esri/symbols/edges/SolidEdges3D":function(){define(["../../chunks/tslib.es6","../../core/Logger","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Edges3D"],function(e,t,r,i,o,s,n,a){"use strict";var l;let c=l=class extends a{constructor(e){super(e),this.type="solid"}clone(){return new l(this.cloneProperties())}};return e.__decorate([s.enumeration({solid:"solid"},{readOnly:!0})],c.prototype,"type",void 0),c=l=e.__decorate([n.subclass("esri.symbols.edges.SolidEdges3D")],c),c})},"esri/symbols/support/Symbol3DMaterial":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./materialUtils","./Symbol3DEmissive"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;e.Symbol3DMaterial=u=class extends r.JSONSupport{constructor(e){super(e),this.color=null,this.emissive=new c.Symbol3DEmissive({source:"emissive"})}clone(){const e={color:this.color?.clone()??null,emissive:this.emissive?.clone()??null};return new u(e)}},t.__decorate([i.property(l.colorAndTransparencyProperty())],e.Symbol3DMaterial.prototype,"color",void 0),t.__decorate([i.property({type:c.Symbol3DEmissive,json:{write:!1}})],e.Symbol3DMaterial.prototype,"emissive",void 0),e.Symbol3DMaterial=u=t.__decorate([a.subclass("esri.symbols.support.Symbol3DMaterial")],e.Symbol3DMaterial),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/Symbol3DEmissive":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";var l;e.Symbol3DEmissive=l=class extends r.JSONSupport{constructor(){super(...arguments),this.strength=null,this.source="emissive"}clone(){const e={strength:this.strength,source:this.source};return new l(e)}},t.__decorate([i.property({json:{write:!1}})],e.Symbol3DEmissive.prototype,"strength",void 0),t.__decorate([i.property({json:{write:!1}})],e.Symbol3DEmissive.prototype,"source",void 0),e.Symbol3DEmissive=l=t.__decorate([a.subclass("esri.symbols.support.Symbol3DEmissive")],e.Symbol3DEmissive),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/FillSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./edges/utils","./patterns/LineStylePattern3D","./patterns/StylePattern3D","./patterns/utils","./support/colors","./support/Symbol3DFillMaterial","./support/Symbol3DOutline"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;return e.default=class extends l{static{y=this}constructor(e){super(e),this.type="fill",this.material=null,this.pattern=null,this.castShadows=!0,this.outline=null,this.edges=null}clone(){const e={edges:null!=this.edges?this.edges.clone():null,enabled:this.enabled,material:null!=this.material?this.material.clone():null,pattern:null!=this.pattern?this.pattern.clone():null,castShadows:this.castShadows,outline:null!=this.outline?this.outline.clone():null};return new y(e)}static fromSimpleFillSymbol(e){const t=e.outline&&e.outline.style&&"solid"!==e.outline.style?new u({style:e.outline.style}):null,r={size:e.outline?.width??0,color:(e.outline?.color??h.white).clone(),pattern:t};return t&&e.outline?.cap&&(r.patternCap=e.outline.cap),new y({material:new f.Symbol3DFillMaterial({color:(e.color??h.transparentWhite).clone()}),pattern:e.style&&"solid"!==e.style?new d({style:e.style}):null,outline:r})}},t.__decorate([n.enumeration({Fill:"fill"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:f.Symbol3DFillMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([r.property(p.symbol3dPatternProperty)],e.default.prototype,"pattern",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e.default.prototype,"castShadows",void 0),t.__decorate([r.property({type:m.Symbol3DOutline,json:{write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([r.property(c.symbol3dEdgesProperty)],e.default.prototype,"edges",void 0),e.default=y=t.__decorate([a.subclass("esri.symbols.FillSymbol3DLayer")],e.default),e.default})},"esri/symbols/patterns/LineStylePattern3D":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./LinePattern3D","./lineStyles"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;const p=r.strict()({dash:"dash","dash-dot":"dash-dot","dash-dot-dot":"long-dash-dot-dot",dot:"dot","long-dash":"long-dash","long-dash-dot":"long-dash-dot",null:"none","short-dash":"short-dash","short-dash-dot":"short-dash-dot","short-dash-dot-dot":"short-dash-dot-dot","short-dot":"short-dot",solid:"solid"});return e.default=d=class extends c{constructor(e){super(e),this.type="style",this.style="solid"}clone(){const e={style:this.style};return new d(e)}},t.__decorate([i.property({type:["style"],json:{write:{isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([a.enumeration(p),i.property({type:u.lineStyles,json:{write:{isRequired:!0}}})],e.default.prototype,"style",void 0),e.default=d=t.__decorate([l.subclass("esri.symbols.patterns.LineStylePattern3D")],e.default),e.default})},"esri/symbols/patterns/LinePattern3D":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r.JSONSupport{constructor(e){super(e)}clone(){throw new Error("Subclasses of LinePattern3D should implement their own clone method.")}},t.__decorate([i.property({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],e.default.prototype,"type",void 0),e.default=t.__decorate([a.subclass("esri.symbols.patterns.LinePattern3D")],e.default),e.default})},"esri/symbols/patterns/lineStyles":function(){define(["exports"],function(e){"use strict";e.lineStyles=["dash","dash-dot","dot","long-dash","long-dash-dot","long-dash-dot-dot","none","short-dash","short-dash-dot","short-dash-dot-dot","short-dot","solid"],Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/patterns/StylePattern3D":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./Pattern3D","./styles"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends a{constructor(e){super(e),this.type="style",this.style="solid"}clone(){return new c({style:this.style})}},t.__decorate([r.property({type:["style"],json:{write:{isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:l,json:{read:!0,write:{isRequired:!0}}})],e.default.prototype,"style",void 0),e.default=c=t.__decorate([n.subclass("esri.symbols.patterns.StylePattern3D")],e.default),e.default})},"esri/symbols/patterns/Pattern3D":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r.JSONSupport{constructor(e){super(e),this.type="style"}clone(){throw new Error("Subclasses of Pattern3D should implement their own clone method.")}},t.__decorate([i.property({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0}}})],e.default.prototype,"type",void 0),e.default=t.__decorate([a.subclass("esri.symbols.patterns.Pattern3D")],e.default),e.default})},"esri/symbols/patterns/styles":function(){define(function(){"use strict";return["backward-diagonal","cross","diagonal-cross","forward-diagonal","horizontal","none","solid","vertical"]})},"esri/symbols/patterns/utils":function(){define(["exports","./LinePattern3D","./LineStylePattern3D","./Pattern3D","./StylePattern3D"],function(e,t,r,i,o){"use strict";const s={types:{key:"type",base:i,typeMap:{style:o}},json:{write:!0}},n={types:{key:"type",base:t,typeMap:{style:r}},json:{write:!0}};e.symbol3dLinePatternProperty=n,e.symbol3dPatternProperty=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/colors":function(){define(["exports","../../Color"],function(e,t){"use strict";const r=new t("white"),i=new t([255,255,255,0]);e.isBlack=function(e){return 0===e.r&&0===e.g&&0===e.b},e.transparentWhite=i,e.white=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/Symbol3DFillMaterial":function(){define(["exports","../../chunks/tslib.es6","../../core/Logger","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Symbol3DMaterial"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;e.Symbol3DFillMaterial=c=class extends l.Symbol3DMaterial{constructor(e){super(e),this.colorMixMode=null}clone(){const e={color:this.color?.clone()??null,colorMixMode:this.colorMixMode,emissive:this.emissive?.clone()??null};return new c(e)}},t.__decorate([n.enumeration({multiply:"multiply",replace:"replace",tint:"tint"})],e.Symbol3DFillMaterial.prototype,"colorMixMode",void 0),e.Symbol3DFillMaterial=c=t.__decorate([a.subclass("esri.symbols.support.Symbol3DFillMaterial")],e.Symbol3DFillMaterial),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/Symbol3DOutline":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../patterns/utils","./materialUtils","./symbolLayerUtils3D"],function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;e.Symbol3DOutline=h=class extends i.JSONSupport{constructor(e){super(e),this.color=new r([0,0,0,1]),this.size=o.px2pt(1),this.pattern=null,this.patternCap="butt"}clone(){const e={color:null!=this.color?this.color.clone():null,size:this.size,pattern:null!=this.pattern?this.pattern.clone():null,patternCap:this.patternCap};return new h(e)}},t.__decorate([s.property(d.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],e.Symbol3DOutline.prototype,"color",void 0),t.__decorate([s.property({...d.screenSizeProperty,json:{write:{isRequired:!0}}})],e.Symbol3DOutline.prototype,"size",void 0),t.__decorate([s.property(u.symbol3dLinePatternProperty)],e.Symbol3DOutline.prototype,"pattern",void 0),t.__decorate([s.property({type:p.lineCaps,json:{default:"butt",write:{overridePolicy(){return{enabled:null!=this.pattern}}}}})],e.Symbol3DOutline.prototype,"patternCap",void 0),e.Symbol3DOutline=h=t.__decorate([c.subclass("esri.symbols.support.Symbol3DOutline")],e.Symbol3DOutline),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/symbolLayerUtils3D":function(){define(["exports","../../core/has","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/support/aaBoundingBox"],function(e,t,r,i){"use strict";const o=i.fromValues(-.5,-.5,-.5,.5,.5,.5),s=i.fromValues(-.5,-.5,0,.5,.5,1),n=i.fromValues(-.5,-.5,0,.5,.5,.5),a=["butt","square","round"],l=[...a,"none"];e.lineCaps=a,e.lineJoins=["miter","bevel","round"],e.objectSymbolLayerBoundingBoxTetrahedron=n,e.objectSymbolLayerBoundingBoxUnitCube=o,e.objectSymbolLayerBoundingBoxUnitCylinder=s,e.objectSymbolLayerPrimitiveBoundingBox=function(e){switch(e){case"sphere":case"cube":case"diamond":return o;case"cylinder":case"cone":case"inverted-cone":return s;case"tetrahedron":return n;default:return}},e.objectSymbolLayerSizeWithResourceSize=function(e,{isPrimitive:t,width:i,depth:o,height:s}){const n=t?10:1;if(null==i&&null==s&&null==o)return[n*e[0],n*e[1],n*e[2]];const a=r.fromValues(i,o,s);let l;for(let t=0;t<3;t++){const r=a[t];if(null!=r){l=r/e[t];break}}for(let t=0;t<3;t++)null==a[t]&&(a[t]=e[t]*l);return a},e.pathCaps=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/IconSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/Logger","../core/urlUtils","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./support/colors","./support/IconSymbol3DLayerResource","./support/materialUtils","./support/Symbol3DAnchorPosition2D","./support/Symbol3DIconOutline","./support/Symbol3DMaterial"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;function g(e){const t="width"in e?e.width:e.size,r="height"in e?e.height:e.size,i=b(e.xoffset),o=b(e.yoffset);return(i||o)&&t&&r?{x:-i/t,y:o/r}:null}function b(e){return isFinite(e)?e:0}e.default=class extends c{static{y=this}constructor(e){super(e),this.material=null,this.resource=null,this.type="icon",this.size=12,this.anchor="center",this.anchorPosition=null,this.outline=null,this.angle=0}clone(){return new y({anchor:this.anchor,anchorPosition:r.clone(this.anchorPosition),enabled:this.enabled,material:r.clone(this.material),outline:r.clone(this.outline),resource:r.clone(this.resource),angle:this.angle,size:this.size})}static fromSimpleMarkerSymbol(e){const t=e.color||u.white,r=g(e),o=e.outline&&e.outline.width>0?{size:e.outline.width,color:(e.outline.color||u.white).clone()}:null;return new y({size:e.size,angle:e.angle,resource:{primitive:(s=()=>i.getLogger(this.prototype),n=e.style,_[n]||(s().warn(`${n} cannot be mapped to Icon symbol. Fallback to "circle"`),"circle"))},material:{color:t},outline:o,anchor:r?"relative":void 0,anchorPosition:r});var s,n}static fromPictureMarkerSymbol(e){const t=!e.color||u.isBlack(e.color)?u.white:e.color,r=g(e);return new y({size:e.width<=e.height?e.height:e.width,angle:e.angle,resource:{href:e.url},material:{color:t.clone()},anchor:r?"relative":void 0,anchorPosition:r})}static fromCIMSymbol(e){return new y({resource:{href:o.makeData({mediaType:"application/json",data:JSON.stringify(e.data)})}})}},t.__decorate([s.property({type:m.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([s.property({type:d.IconSymbol3DLayerResource,json:{write:!0}})],e.default.prototype,"resource",void 0),t.__decorate([a.enumeration({Icon:"icon"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({...p.screenSizeProperty,json:{write:{isRequired:!0}}})],e.default.prototype,"size",void 0),t.__decorate([a.enumeration({center:"center",left:"left",right:"right",top:"top",bottom:"bottom",topLeft:"top-left",topRight:"top-right",bottomLeft:"bottom-left",bottomRight:"bottom-right",relative:"relative"},{default:"center"})],e.default.prototype,"anchor",void 0),t.__decorate([s.property({type:h.Symbol3DAnchorPosition2D,json:{type:[Number],read:{reader:e=>new h.Symbol3DAnchorPosition2D({x:e[0],y:e[1]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],e.default.prototype,"anchorPosition",void 0),t.__decorate([s.property({type:f.Symbol3DIconOutline,json:{write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([s.property({type:Number,json:{write:!0,default:0}})],e.default.prototype,"angle",void 0),e.default=y=t.__decorate([l.subclass("esri.symbols.IconSymbol3DLayer")],e.default);const _={circle:"circle",cross:"cross",diamond:"kite",square:"square",x:"x",triangle:"triangle",path:null};return e.default})},"esri/symbols/support/IconSymbol3DLayerResource":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/urlUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../chunks/persistableUrlUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";var f;const m=r.strict()({circle:"circle",square:"square",cross:"cross",x:"x",kite:"kite",triangle:"triangle"});e.IconSymbol3DLayerResource=f=class extends i.JSONSupport{constructor(e){super(e)}readHref(e,t,r){return e?h.fromJSON(e,r):t.dataURI}writeHref(e,t,r,i){e&&(o.isDataProtocol(e)?t.dataURI=e:(t.href=h.toJSON(e,i),o.isAbsolute(t.href)&&(t.href=o.normalize(t.href))))}clone(){return new f({href:this.href,primitive:this.primitive})}},t.__decorate([s.property({type:String,json:{write:!0,read:{source:["href","dataURI"]}}})],e.IconSymbol3DLayerResource.prototype,"href",void 0),t.__decorate([u.reader("href")],e.IconSymbol3DLayerResource.prototype,"readHref",null),t.__decorate([p.writer("href",{href:{type:String},dataURI:{type:String}})],e.IconSymbol3DLayerResource.prototype,"writeHref",null),t.__decorate([c.enumeration(m)],e.IconSymbol3DLayerResource.prototype,"primitive",void 0),e.IconSymbol3DLayerResource=f=t.__decorate([d.subclass("esri.symbols.support.IconSymbol3DLayerResource")],e.IconSymbol3DLayerResource),e.defaultPrimitive="circle",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/Symbol3DAnchorPosition2D":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";var l;e.Symbol3DAnchorPosition2D=l=class extends r{constructor(){super(...arguments),this.x=0,this.y=0}clone(){return new l({x:this.x,y:this.y})}},t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition2D.prototype,"x",void 0),t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition2D.prototype,"y",void 0),e.Symbol3DAnchorPosition2D=l=t.__decorate([a.subclass("esri.symbols.support.Symbol3DAnchorPosition2D")],e.Symbol3DAnchorPosition2D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/Symbol3DIconOutline":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./materialUtils"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;e.Symbol3DIconOutline=d=class extends i.JSONSupport{constructor(e){super(e),this.color=new r([0,0,0,1]),this.size=o.px2pt(1)}clone(){const e={color:null!=this.color?this.color.clone():null,size:this.size};return new d(e)}},t.__decorate([s.property(u.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],e.Symbol3DIconOutline.prototype,"color",void 0),t.__decorate([s.property({...u.screenSizeProperty,json:{write:{isRequired:!0}}})],e.Symbol3DIconOutline.prototype,"size",void 0),e.Symbol3DIconOutline=d=t.__decorate([c.subclass("esri.symbols.support.Symbol3DIconOutline")],e.Symbol3DIconOutline),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/LineSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./LineStyleMarker3D","./Symbol3DLayer","./patterns/LineStylePattern3D","./patterns/utils","./support/colors","./support/materialUtils","./support/Symbol3DMaterial","./support/symbolLayerUtils3D"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";var g;return e.default=class extends u{static{g=this}constructor(e){super(e),this.material=null,this.type="line",this.join="miter",this.cap="butt",this.size=r.px2pt(1),this.pattern=null,this.marker=null}clone(){const e={enabled:this.enabled,material:null!=this.material?this.material.clone():null,size:this.size,join:this.join,cap:this.cap,pattern:null!=this.pattern?this.pattern.clone():null,marker:null!=this.marker?this.marker.clone():null};return new g(e)}static fromSimpleLineSymbol(e){const t={enabled:!0,size:e.width??r.px2pt(1),cap:e.cap||"butt",join:e.join||"miter",pattern:e.style?new d({style:e.style}):null,material:new m.Symbol3DMaterial({color:(e.color||h.white).clone()}),marker:e.marker?new c({placement:e.marker.placement,style:e.marker.style,color:e.marker.color?.clone()??null}):null};return new g(t)}},t.__decorate([i.property({type:m.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([a.enumeration({Line:"line"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({type:y.lineJoins,json:{write:!0,default:"miter"}})],e.default.prototype,"join",void 0),t.__decorate([i.property({type:y.lineCaps,json:{write:!0,default:"butt"}})],e.default.prototype,"cap",void 0),t.__decorate([i.property({...f.screenSizeProperty,json:{write:{isRequired:!0}}})],e.default.prototype,"size",void 0),t.__decorate([i.property(p.symbol3dLinePatternProperty)],e.default.prototype,"pattern",void 0),t.__decorate([i.property({types:{key:"type",base:c,typeMap:{style:c}},json:{write:!0}})],e.default.prototype,"marker",void 0),e.default=g=t.__decorate([l.subclass("esri.symbols.LineSymbol3DLayer")],e.default),e.default})},"esri/symbols/LineStyleMarker3D":function(){define(["exports","../chunks/tslib.es6","../Color","../core/Clonable","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./support/lineMarkers"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";return e.default=class extends(i.ClonableMixin(o.JSONSupport)){constructor(e){super(e),this.type="style",this.placement="begin-end",this.style="arrow",this.color=null}equals(e){return null!=e&&e.placement===this.placement&&e.style===this.style&&(null==this.color&&null==e.color||null!=this.color&&null!=e.color&&this.color.toJSON()===e.color.toJSON())}},t.__decorate([s.property({type:["style"],readOnly:!0,json:{read:!0,write:{ignoreOrigin:!0,isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:u.lineMarkerPlacements,json:{default:"begin-end",write:!0}})],e.default.prototype,"placement",void 0),t.__decorate([s.property({type:u.lineMarkerStyles,json:{default:"arrow",write:!0}})],e.default.prototype,"style",void 0),t.__decorate([s.property({type:r,json:{type:[n.Integer],default:null,write:!0}})],e.default.prototype,"color",void 0),e.default=t.__decorate([c.subclass("esri.symbols.LineStyleMarker3D")],e.default),e.default})},"esri/symbols/support/lineMarkers":function(){define(["exports"],function(e){"use strict";e.lineMarkerPlacements=["begin","end","begin-end"],e.lineMarkerStyles=["arrow","circle","square","diamond","cross","x"],Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/ObjectSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./support/ObjectSymbol3DLayerResource","./support/Symbol3DAnchorPosition3D","./support/Symbol3DMaterial"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;return e.default=class extends l{static{p=this}constructor(e){super(e),this.material=null,this.castShadows=!0,this.resource=null,this.type="object",this.width=void 0,this.height=void 0,this.depth=void 0,this.anchor=void 0,this.anchorPosition=void 0,this.heading=void 0,this.tilt=void 0,this.roll=void 0}clone(){return new p({heading:this.heading,tilt:this.tilt,roll:this.roll,anchor:this.anchor,anchorPosition:this.anchorPosition?.clone(),depth:this.depth,enabled:this.enabled,height:this.height,material:this.material?.clone()??null,castShadows:this.castShadows,resource:this.resource?.clone(),width:this.width})}get isPrimitive(){return!this.resource||"string"!=typeof this.resource.href}},t.__decorate([r.property({type:d.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e.default.prototype,"castShadows",void 0),t.__decorate([r.property({type:c.ObjectSymbol3DLayerResource,json:{write:!0}})],e.default.prototype,"resource",void 0),t.__decorate([n.enumeration({Object:"object"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"depth",void 0),t.__decorate([n.enumeration({center:"center",top:"top",bottom:"bottom",origin:"origin",relative:"relative"},{default:"origin"})],e.default.prototype,"anchor",void 0),t.__decorate([r.property({type:u.Symbol3DAnchorPosition3D,json:{type:[Number],read:{reader:e=>new u.Symbol3DAnchorPosition3D({x:e[0],y:e[1],z:e[2]})},write:{writer:(e,t)=>{t.anchorPosition=[e.x,e.y,e.z]},overridePolicy(){return{enabled:"relative"===this.anchor}}}}})],e.default.prototype,"anchorPosition",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"heading",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"tilt",void 0),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"roll",void 0),t.__decorate([r.property({readOnly:!0})],e.default.prototype,"isPrimitive",null),e.default=p=t.__decorate([a.subclass("esri.symbols.ObjectSymbol3DLayer")],e.default),e.default})},"esri/symbols/support/ObjectSymbol3DLayerResource":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../chunks/persistableUrlUtils"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;const p=r.strict()({sphere:"sphere",cylinder:"cylinder",cube:"cube",cone:"cone",diamond:"diamond",tetrahedron:"tetrahedron",invertedCone:"inverted-cone"});e.ObjectSymbol3DLayerResource=d=class extends i.JSONSupport{clone(){return new d({href:this.href,primitive:this.primitive})}},t.__decorate([o.property({type:String,json:{read:u.read,write:u.write}})],e.ObjectSymbol3DLayerResource.prototype,"href",void 0),t.__decorate([l.enumeration(p)],e.ObjectSymbol3DLayerResource.prototype,"primitive",void 0),e.ObjectSymbol3DLayerResource=d=t.__decorate([c.subclass("esri.symbols.support.ObjectSymbol3DLayerResource")],e.ObjectSymbol3DLayerResource),e.defaultPrimitive="sphere",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/Symbol3DAnchorPosition3D":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";var l;e.Symbol3DAnchorPosition3D=l=class extends r{constructor(){super(...arguments),this.x=0,this.y=0,this.z=0}clone(){return new l({x:this.x,y:this.y,z:this.z})}},t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition3D.prototype,"x",void 0),t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition3D.prototype,"y",void 0),t.__decorate([i.property({type:Number})],e.Symbol3DAnchorPosition3D.prototype,"z",void 0),e.Symbol3DAnchorPosition3D=l=t.__decorate([a.subclass("esri.symbols.support.Symbol3DAnchorPosition3D")],e.Symbol3DAnchorPosition3D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/PathSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","./Symbol3DLayer","./support/Symbol3DMaterial","./support/symbolLayerUtils3D"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;return e.default=class extends c{static{p=this}constructor(e){super(e),this.material=null,this.castShadows=!0,this.type="path",this.profile="circle",this.join="miter",this.cap="butt",this.width=void 0,this.height=void 0,this.anchor="center",this.profileRotation="all"}readWidth(e,t){return null!=e?e:null==t.height&&null!=t.size?t.size:void 0}readHeight(e,t){return null!=e?e:null==t.width&&null!=t.size?t.size:void 0}clone(){return new p({enabled:this.enabled,material:null!=this.material?this.material.clone():null,castShadows:this.castShadows,profile:this.profile,join:this.join,cap:this.cap,width:this.width,height:this.height,profileRotation:this.profileRotation,anchor:this.anchor})}},t.__decorate([r.property({type:u.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:!0,default:!0}})],e.default.prototype,"castShadows",void 0),t.__decorate([n.enumeration({Path:"path"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([r.property({type:["circle","quad"],nonNullable:!0,json:{write:!0,default:"circle"}})],e.default.prototype,"profile",void 0),t.__decorate([r.property({type:d.lineJoins,nonNullable:!0,json:{write:!0,default:"miter"}})],e.default.prototype,"join",void 0),t.__decorate([r.property({type:d.pathCaps,nonNullable:!0,json:{write:!0,default:"butt"}})],e.default.prototype,"cap",void 0),t.__decorate([r.property({type:Number,json:{write:{enabled:!0,target:{width:{type:Number},size:{type:Number}}}}})],e.default.prototype,"width",void 0),t.__decorate([a.reader("width",["width","size","height"])],e.default.prototype,"readWidth",null),t.__decorate([r.property({type:Number,json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([a.reader("height",["height","size","width"])],e.default.prototype,"readHeight",null),t.__decorate([r.property({type:["center","bottom","top"],nonNullable:!0,json:{write:!0,default:"center"}})],e.default.prototype,"anchor",void 0),t.__decorate([r.property({type:["heading","all"],nonNullable:!0,json:{write:!0,default:"all"}})],e.default.prototype,"profileRotation",void 0),e.default=p=t.__decorate([l.subclass("esri.symbols.PathSymbol3DLayer")],e.default),e.default})},"esri/symbols/TextSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./Font","./Symbol3DLayer","./support/materialUtils","./support/Symbol3DHalo","./support/Symbol3DMaterial","./support/Symbol3DTextBackground","./support/textUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;return e.default=class extends u{static{y=this}constructor(e){super(e),this._userSize=void 0,this.halo=null,this.horizontalAlignment="center",this.lineHeight=1,this.material=null,this.background=null,this.text=null,this.type="text",this.verticalAlignment="baseline"}get font(){return this._get("font")||null}set font(e){null!=e&&null!=this._userSize&&(e.size=this._userSize),this._set("font",e)}writeFont(e,t,r,i){const o={...i,textSymbol3D:!0};t.font=e.write({},o),delete t.font.size}get size(){return null!=this._userSize?this._userSize:null!=this.font?.size?this.font.size:9}set size(e){this._userSize=e,null!=this.font&&(this.font.size=this._userSize),this.notifyChange("size")}clone(){const e=new y({enabled:this.enabled,font:this.font&&r.clone(this.font),halo:this.halo&&r.clone(this.halo),horizontalAlignment:this.horizontalAlignment,lineHeight:this.lineHeight,material:null!=this.material?this.material.clone():null,text:this.text,verticalAlignment:this.verticalAlignment,background:r.clone(this.background)});return e._userSize=this._userSize,e}static fromTextSymbol(e){return new y({font:null!=e.font?e.font.clone():new c,halo:(t=e.haloColor,i=e.haloSize,t&&null!=i&&i>0?new p.Symbol3DHalo({color:r.clone(t),size:i}):null),horizontalAlignment:e.horizontalAlignment,lineHeight:e.lineHeight,material:e.color?new h.Symbol3DMaterial({color:e.color.clone()}):null,text:e.text,verticalAlignment:e.verticalAlignment,background:e.backgroundColor?new f.Symbol3DTextBackground({color:e.backgroundColor.clone()}):null});var t,i}},t.__decorate([i.property({type:c,json:{write:!0}})],e.default.prototype,"font",null),t.__decorate([l.writer("font")],e.default.prototype,"writeFont",null),t.__decorate([i.property({type:p.Symbol3DHalo,json:{write:!0}})],e.default.prototype,"halo",void 0),t.__decorate([i.property({...m.horizontalAlignmentProperty,json:{default:"center",write:!0}})],e.default.prototype,"horizontalAlignment",void 0),t.__decorate([i.property({...m.lineHeightProperty,json:{default:1,write:!0}})],e.default.prototype,"lineHeight",void 0),t.__decorate([i.property({type:h.Symbol3DMaterial,json:{write:!0}})],e.default.prototype,"material",void 0),t.__decorate([i.property({type:f.Symbol3DTextBackground,json:{write:!0}})],e.default.prototype,"background",void 0),t.__decorate([i.property(d.screenSizeProperty)],e.default.prototype,"size",null),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"text",void 0),t.__decorate([n.enumeration({Text:"text"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({...m.verticalAlignmentProperty,json:{default:"baseline",write:!0}})],e.default.prototype,"verticalAlignment",void 0),e.default=y=t.__decorate([a.subclass("esri.symbols.TextSymbol3DLayer")],e.default),e.default})},"esri/symbols/Font":function(){define(["exports","../chunks/tslib.es6","../core/JSONSupport","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./support/textUtils"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;return e.default=u=class extends r.JSONSupport{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return i.toPt(e)}clone(){return new u({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}},t.__decorate([o.property({type:c.fontDecorations,json:{default:"none",write:!0}})],e.default.prototype,"decoration",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.default.prototype,"family",void 0),t.__decorate([o.property({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],e.default.prototype,"size",void 0),t.__decorate([s.cast("size")],e.default.prototype,"castSize",null),t.__decorate([o.property({type:c.fontStyles,json:{default:"normal",write:!0}})],e.default.prototype,"style",void 0),t.__decorate([o.property({type:c.fontWeights,json:{default:"normal",write:!0}})],e.default.prototype,"weight",void 0),e.default=u=t.__decorate([l.subclass("esri.symbols.Font")],e.default),e.default})},"esri/symbols/support/textUtils":function(){define(["exports","../../core/mathUtils","../../core/accessorSupport/ensureType"],function(e,t,r){"use strict";const i={type:Number,cast:e=>{const i=r.ensureNumber(e);return 0===i?1:t.clamp(i,.1,4)},nonNullable:!0},o=["left","right","center"],s=["baseline","top","middle","bottom"],n={type:o,nonNullable:!0},a={type:s,nonNullable:!0};e.backgroundPadding=8,e.fontDecorations=["none","underline","line-through"],e.fontStyles=["normal","italic","oblique"],e.fontWeights=["normal","lighter","bold","bolder"],e.horizontalAlignmentProperty=n,e.horizontalAlignments=o,e.lineHeightProperty=i,e.verticalAlignmentProperty=a,e.verticalAlignments=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/Symbol3DHalo":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","./materialUtils"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;e.Symbol3DHalo=u=class extends i.JSONSupport{constructor(){super(...arguments),this.color=new r([0,0,0,1]),this.size=0}clone(){const e={color:o.clone(this.color),size:this.size};return new u(e)}},t.__decorate([s.property(c.colorAndTransparencyProperty())],e.Symbol3DHalo.prototype,"color",void 0),t.__decorate([s.property(c.screenSizeProperty)],e.Symbol3DHalo.prototype,"size",void 0),e.Symbol3DHalo=u=t.__decorate([l.subclass("esri.symbols.support.Symbol3DHalo")],e.Symbol3DHalo),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/Symbol3DTextBackground":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./materialUtils"],function(e,t,r,i,o,s,n,a,l,c){"use strict";e.Symbol3DTextBackground=class extends(r.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.color=null}},t.__decorate([o.property(c.colorAndTransparencyProperty())],e.Symbol3DTextBackground.prototype,"color",void 0),e.Symbol3DTextBackground=t.__decorate([l.subclass("esri.symbols.support.Symbol3DTextBackground")],e.Symbol3DTextBackground),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/WaterSymbol3DLayer":function(){define(["exports","../chunks/tslib.es6","../Color","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol3DLayer"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;e.default=class extends c{static{u=this}constructor(e){super(e),this.color=d.clone(),this.type="water",this.waterbodySize="medium",this.waveDirection=null,this.waveStrength="moderate"}clone(){return new u({color:this.color.clone(),waterbodySize:this.waterbodySize,waveDirection:this.waveDirection,waveStrength:this.waveStrength})}},t.__decorate([i.property({type:r,nonNullable:!0,json:{type:[o.Integer],write:(e,t,r)=>t[r]=e.toArray(1),default:()=>d.clone(),defaultEquals:e=>e.toCss(!0)===d.toCss(!0)}})],e.default.prototype,"color",void 0),t.__decorate([a.enumeration({Water:"water"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({type:["small","medium","large"],json:{write:!0,default:"medium"}})],e.default.prototype,"waterbodySize",void 0),t.__decorate([i.property({type:Number,json:{write:!0,default:null}})],e.default.prototype,"waveDirection",void 0),t.__decorate([i.property({type:["calm","rippled","slight","moderate"],json:{write:!0,default:"moderate"}})],e.default.prototype,"waveStrength",void 0),e.default=u=t.__decorate([l.subclass("esri.symbols.WaterSymbol3DLayer")],e.default);const d=new r([0,119,190]);return e.default})},"esri/symbols/support/StyleOrigin":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../portal/Portal"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r{constructor(e){super(e),this.name=null,this.styleUrl=null,this.styleName=null,this.portal=null}clone(){return new c({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}},t.__decorate([i.property({type:String})],e.default.prototype,"name",void 0),t.__decorate([i.property({type:String})],e.default.prototype,"styleUrl",void 0),t.__decorate([i.property({type:String})],e.default.prototype,"styleName",void 0),t.__decorate([i.property({type:l})],e.default.prototype,"portal",void 0),e.default=c=t.__decorate([a.subclass("esri.symbols.support.StyleOrigin")],e.default),e.default})},"esri/symbols/support/Thumbnail":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";var l;e.Thumbnail=l=class extends r{constructor(){super(...arguments),this.url=""}clone(){return new l({url:this.url})}},t.__decorate([i.property({type:String})],e.Thumbnail.prototype,"url",void 0),e.Thumbnail=l=t.__decorate([a.subclass("esri.symbols.support.Thumbnail")],e.Thumbnail),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/callouts/calloutUtils":function(){define(["exports","./Callout3D","./LineCallout3D"],function(e,t,r){"use strict";function i(e){if(!e)return!1;const t=e.verticalOffset;return!(!t||t.screenLength<=0||null!=t.maxWorldLength&&t.maxWorldLength<=0)}const o={types:{key:"type",base:t,typeMap:{line:r}},json:{write:!0}};e.calloutProperty=o,e.hasCalloutSupport=function(e){return"point-3d"===e.type||"label-3d"===e.type},e.hasVisibleCallout=function(e){if(!e||!e.supportsCallout||!e.supportsCallout())return!1;const t=e.callout;return!!t?.visible&&!!i(e)},e.hasVisibleVerticalOffset=i,e.textSymbolLayerSupportsVerticalOffset=function(e){return"center"===e.horizontalAlignment},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/callouts/Callout3D":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r.JSONSupport{constructor(e){super(e),this.visible=!0}clone(){throw new Error("Subclasses of Callout3D should implement their own clone method.")}},t.__decorate([i.property({type:["line"],constructOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([i.property({readOnly:!0})],e.default.prototype,"visible",void 0),e.default=t.__decorate([a.subclass("esri.symbols.callouts.Callout3D")],e.default),e.default})},"esri/symbols/callouts/LineCallout3D":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/lang","../../core/screenUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./Callout3D","./LineCallout3DBorder","../support/materialUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;return e.default=h=class extends u{constructor(e){super(e),this.type="line",this.color=new r([0,0,0,1]),this.size=o.px2pt(1),this.border=null}get visible(){return this.size>0&&null!=this.color&&this.color.a>0}clone(){return new h({color:i.clone(this.color),size:this.size,border:i.clone(this.border)})}},t.__decorate([l.enumeration({line:"line"})],e.default.prototype,"type",void 0),t.__decorate([s.property(p.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],e.default.prototype,"color",void 0),t.__decorate([s.property({...p.screenSizeProperty,json:{write:{isRequired:!0}}})],e.default.prototype,"size",void 0),t.__decorate([s.property({type:d,json:{write:!0}})],e.default.prototype,"border",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"visible",null),e.default=h=t.__decorate([c.subclass("esri.symbols.callouts.LineCallout3D")],e.default),e.default})},"esri/symbols/callouts/LineCallout3DBorder":function(){define(["../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/lang","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/accessorSupport/decorators/subclass","../support/materialUtils"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;let u=c=class extends r.JSONSupport{constructor(e){super(e),this.color=new t("white")}clone(){return new c({color:i.clone(this.color)})}};return e.__decorate([o.property(l.colorAndTransparencyProperty({colorRequiredOnWrite:!0}))],u.prototype,"color",void 0),u=c=e.__decorate([a.subclass("esri.symbols.callouts.LineCallout3DBorder")],u),u})},"esri/symbols/support/Symbol3DVerticalOffset":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./materialUtils"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r.JSONSupport{constructor(e){super(e),this.screenLength=0,this.minWorldLength=0,this.maxWorldLength=null}clone(){return new c({screenLength:this.screenLength,minWorldLength:this.minWorldLength,maxWorldLength:this.maxWorldLength})}},t.__decorate([i.property({...l.screenSizeProperty,json:{write:{isRequired:!0}}})],e.default.prototype,"screenLength",void 0),t.__decorate([i.property({type:Number,nonNullable:!0,json:{write:!0,default:0}})],e.default.prototype,"minWorldLength",void 0),t.__decorate([i.property({type:Number,json:{write:!0}})],e.default.prototype,"maxWorldLength",void 0),e.default=c=t.__decorate([a.subclass("esri.symbols.support.Symbol3DVerticalOffset")],e.default),e.default})},"esri/symbols/LineSymbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./LineSymbol3DLayer","./PathSymbol3DLayer","./Symbol3D"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=r.ofType({base:null,key:"type",typeMap:{line:c,path:u}}),f=r.ofType({base:null,key:"type",typeMap:{line:c,path:u}});return e.default=p=class extends d{constructor(e){super(e),this.symbolLayers=new h,this.type="line-3d"}clone(){return new p({styleOrigin:i.clone(this.styleOrigin),symbolLayers:i.clone(this.symbolLayers),thumbnail:i.clone(this.thumbnail)})}static fromSimpleLineSymbol(e){return new p({symbolLayers:new r([c.fromSimpleLineSymbol(e)])})}},t.__decorate([o.property({type:h,json:{type:f}})],e.default.prototype,"symbolLayers",void 0),t.__decorate([a.enumeration({LineSymbol3D:"line-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=p=t.__decorate([l.subclass("esri.symbols.LineSymbol3D")],e.default),e.default})},"esri/symbols/MeshSymbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./FillSymbol3DLayer","./Symbol3D"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;const p=r.ofType({base:null,key:"type",typeMap:{fill:c}});return e.default=d=class extends u{constructor(e){super(e),this.symbolLayers=new p,this.type="mesh-3d"}clone(){return new d({styleOrigin:i.clone(this.styleOrigin),symbolLayers:i.clone(this.symbolLayers),thumbnail:i.clone(this.thumbnail)})}static fromSimpleFillSymbol(e){return new d({symbolLayers:new r([c.fromSimpleFillSymbol(e)])})}},t.__decorate([o.property({type:p})],e.default.prototype,"symbolLayers",void 0),t.__decorate([a.enumeration({MeshSymbol3D:"mesh-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=d=t.__decorate([l.subclass("esri.symbols.MeshSymbol3D")],e.default),e.default})},"esri/symbols/PictureFillSymbol":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./FillSymbol","./support/urlUtils"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;return e.default=d=class extends c{constructor(...e){super(...e),this.type="picture-fill",this.url=null,this.xscale=1,this.yscale=1,this.width=12,this.height=12,this.xoffset=0,this.yoffset=0,this.source=null}normalizeCtorArgs(e,t,r,o){if(e&&"string"!=typeof e&&null==e.imageData)return e;const s={};return e&&(s.url=e),t&&(s.outline=t),null!=r&&(s.width=i.toPt(r)),null!=o&&(s.height=i.toPt(o)),s}clone(){const e=new d({color:r.clone(this.color),height:this.height,outline:r.clone(this.outline),url:this.url,width:this.width,xoffset:this.xoffset,xscale:this.xscale,yoffset:this.yoffset,yscale:this.yscale});return e._set("source",r.clone(this.source)),e}hash(){return`${super.hash()}.${this.color?.hash()}.${this.height}.${this.url}.${this.width}.${this.xoffset}.${this.xscale}.${this.yoffset}.${this.yscale}`}},t.__decorate([a.enumeration({esriPFS:"picture-fill"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property(u.urlPropertyDefinition)],e.default.prototype,"url",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"xscale",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"yscale",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"xoffset",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"yoffset",void 0),t.__decorate([o.property(u.sourcePropertyDefinition)],e.default.prototype,"source",void 0),e.default=d=t.__decorate([l.subclass("esri.symbols.PictureFillSymbol")],e.default),e.default})},"esri/symbols/FillSymbol":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./SimpleLineSymbol","./Symbol"],function(e,t,r,i,o,s,n,a,l){"use strict";return e.default=class extends l{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}},t.__decorate([r.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":a}},json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([r.property({type:["simple-fill","picture-fill"],readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([n.subclass("esri.symbols.FillSymbol")],e.default),e.default})},"esri/symbols/SimpleLineSymbol":function(){define(["exports","../chunks/tslib.es6","../core/jsonMap","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./LineSymbol","./LineSymbolMarker"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=new r.JSONMap({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});return e.default=p=class extends u{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,i,s,n){if(e&&"string"!=typeof e)return e;const a={};return null!=e&&(a.style=e),null!=t&&(a.color=t),null!=r&&(a.width=o.toPt(r)),null!=i&&(a.cap=i),null!=s&&(a.join=s),null!=n&&(a.miterLimit=o.toPt(n)),a}clone(){return new p({color:i.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}},t.__decorate([l.enumeration({esriSLS:"simple-line"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:h.apiValues,json:{read:h.read,write:h.write}})],e.default.prototype,"style",void 0),t.__decorate([s.property({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&null==r?.origin})}}})],e.default.prototype,"cap",void 0),t.__decorate([s.property({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&null==r?.origin})}}})],e.default.prototype,"join",void 0),t.__decorate([s.property({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":d}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"marker",void 0),t.__decorate([s.property({type:Number,json:{read:!1,write:!1}})],e.default.prototype,"miterLimit",void 0),e.default=p=t.__decorate([c.subclass("esri.symbols.SimpleLineSymbol")],e.default),e.default})},"esri/symbols/LineSymbol":function(){define(["exports","../chunks/tslib.es6","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol"],function(e,t,r,i,o,s,n,a,l,c){"use strict";return e.default=class extends c{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}},t.__decorate([a.enumeration({esriSLS:"simple-line"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({type:Number,cast:r.toPt,json:{write:!0}})],e.default.prototype,"width",void 0),e.default=t.__decorate([l.subclass("esri.symbols.LineSymbol")],e.default),e.default})},"esri/symbols/LineSymbolMarker":function(){define(["../chunks/tslib.es6","../Color","../core/JSONSupport","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./support/lineMarkers"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;let h=p=class extends r.JSONSupport{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,i){t[r]="web-map"===i?.origin?"arrow":e}set color(e){this._set("color",e)}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,i){"web-map"===i?.origin||(t[r]=e)}clone(){return new p({color:i.clone(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};return e.__decorate([o.property({type:["begin","end","begin-end"],json:{write:!0}})],h.prototype,"placement",void 0),e.__decorate([a.enumeration({"line-marker":"line-marker"},{readOnly:!0}),o.property({json:{origins:{"web-map":{write:!1}}}})],h.prototype,"type",void 0),e.__decorate([o.property({type:d.lineMarkerStyles})],h.prototype,"style",void 0),e.__decorate([u.writer("style")],h.prototype,"writeStyle",null),e.__decorate([o.property({type:t,value:null,json:{write:{allowNull:!0}}})],h.prototype,"color",null),e.__decorate([l.reader("color")],h.prototype,"readColor",null),e.__decorate([u.writer("color")],h.prototype,"writeColor",null),h=p=e.__decorate([c.subclass("esri.symbols.LineSymbolMarker")],h),h})},"esri/symbols/support/urlUtils":function(){define(["exports","../../core/urlUtils","../../chunks/persistableUrlUtils"],function(e,t,r){"use strict";function i(e,r,i){return r.imageData?t.makeData({mediaType:r.contentType||"image/png",isBase64:!0,data:r.imageData}):o(r.url,i)}function o(e,i){if(!t.isAbsolute(e)){const r=function(e){if(!e)return null;const{origin:t,layer:r}=e;if("service"!==t&&"portal-item"!==t)return null;const i=r?.type;return"feature"===i||"stream"===i?r.parsedUrl?.path:"map-image"===i||"tile"===i?e.url?.path:null}(i);if(r)return t.join(r,"images",e)}return r.fromJSON(e,i)}function s(e,i,o,s){if(t.isDataProtocol(e)){const n=t.dataComponents(e);if(!n)return;i.contentType=n.mediaType,i.imageData=n.data,o&&o.imageData===i.imageData&&o.url&&r.write(o.url,i,"url",s)}else r.write(e,i,"url",s)}const n={json:{read:{source:["imageData","url"],reader:i},write:{writer(e,t,r,i){s(e,t,this.source,i)}}}},a={readOnly:!0,json:{read:{source:["imageData","url"],reader(e,t,r){const i={};return t.imageData&&(i.imageData=t.imageData),t.contentType&&(i.contentType=t.contentType),t.url&&(i.url=o(t.url,r)),i}}}};e.read=o,e.readImageDataOrUrl=i,e.sourcePropertyDefinition=a,e.urlPropertyDefinition=n,e.writeImageDataAndUrl=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/PictureMarkerSymbol":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","./MarkerSymbol","./support/urlUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;return e.default=p=class extends u{constructor(...e){super(...e),this.color=null,this.type="picture-marker",this.url=null,this.source=null,this.height=12,this.width=12,this.size=null}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e&&null==e.imageData)return e;const o={};return e&&(o.url=e),null!=t&&(o.width=i.toPt(t)),null!=r&&(o.height=i.toPt(r)),o}readHeight(e,t){return t.size||e}readWidth(e,t){return t.size||e}clone(){const e=new p({angle:this.angle,height:this.height,url:this.url,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset});return e._set("source",r.clone(this.source)),e}hash(){return`${super.hash()}.${this.height}.${this.url}.${this.width}`}},t.__decorate([o.property({json:{write:!1}})],e.default.prototype,"color",void 0),t.__decorate([a.enumeration({esriPMS:"picture-marker"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property(d.urlPropertyDefinition)],e.default.prototype,"url",void 0),t.__decorate([o.property(d.sourcePropertyDefinition)],e.default.prototype,"source",void 0),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"height",void 0),t.__decorate([l.reader("height",["height","size"])],e.default.prototype,"readHeight",null),t.__decorate([o.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([o.property({json:{write:!1}})],e.default.prototype,"size",void 0),e.default=p=t.__decorate([c.subclass("esri.symbols.PictureMarkerSymbol")],e.default),e.default})},"esri/symbols/MarkerSymbol":function(){define(["exports","../chunks/tslib.es6","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Symbol"],function(e,t,r,i,o,s,n,a,l){"use strict";return e.default=class extends l{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}},t.__decorate([i.property({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],e.default.prototype,"angle",void 0),t.__decorate([i.property({type:["simple-marker","picture-marker"],readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([i.property({type:Number,cast:r.toPt,json:{write:!0}})],e.default.prototype,"xoffset",void 0),t.__decorate([i.property({type:Number,cast:r.toPt,json:{write:!0}})],e.default.prototype,"yoffset",void 0),t.__decorate([i.property({cast:e=>"auto"===e?e:o.ensureNumber(r.toPt(e)),json:{write:!0}})],e.default.prototype,"size",void 0),e.default=t.__decorate([a.subclass("esri.symbols.MarkerSymbol")],e.default),e.default})},"esri/symbols/PointSymbol3D":function(){define(["exports","../chunks/tslib.es6","../Color","../core/Collection","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./IconSymbol3DLayer","./ObjectSymbol3DLayer","./Symbol3D","./TextSymbol3DLayer","./callouts/calloutUtils","./callouts/LineCallout3D","./support/Symbol3DVerticalOffset"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";var g;const b=i.ofType({base:null,key:"type",typeMap:{icon:u,object:d,text:h}});return e.default=g=class extends p{constructor(e){super(e),this.verticalOffset=null,this.callout=null,this.symbolLayers=new b,this.type="point-3d"}supportsCallout(){if((this.symbolLayers?this.symbolLayers.length:0)<1)return!1;for(const e of this.symbolLayers.items)switch(e.type){case"icon":case"text":case"object":continue;default:return!1}return!0}hasVisibleCallout(){return f.hasVisibleCallout(this)}hasVisibleVerticalOffset(){return f.hasVisibleVerticalOffset(this)}clone(){return new g({verticalOffset:o.clone(this.verticalOffset),callout:o.clone(this.callout),styleOrigin:o.clone(this.styleOrigin),symbolLayers:o.clone(this.symbolLayers),thumbnail:o.clone(this.thumbnail)})}static fromSimpleMarkerSymbol(e){return new g({symbolLayers:new i([u.fromSimpleMarkerSymbol(e)])})}static fromPictureMarkerSymbol(e){return new g({symbolLayers:new i([u.fromPictureMarkerSymbol(e)])})}static fromCIMSymbol(e){const t=e.data?.symbol?.type;if("CIMPointSymbol"!==t)return null;const o=e.data.symbol;return new g(o?.callout?{symbolLayers:new i([u.fromCIMSymbol(e)]),callout:new m({size:.5,color:new r([0,0,0])}),verticalOffset:new y({screenLength:40})}:{symbolLayers:new i([u.fromCIMSymbol(e)])})}static fromTextSymbol(e){return new g({symbolLayers:new i([h.fromTextSymbol(e)])})}},t.__decorate([s.property({type:y,json:{write:!0}})],e.default.prototype,"verticalOffset",void 0),t.__decorate([s.property(f.calloutProperty)],e.default.prototype,"callout",void 0),t.__decorate([s.property({type:b,json:{origins:{"web-scene":{write:!0}}}})],e.default.prototype,"symbolLayers",void 0),t.__decorate([l.enumeration({PointSymbol3D:"point-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=g=t.__decorate([c.subclass("esri.symbols.PointSymbol3D")],e.default),e.default})},"esri/symbols/PolygonSymbol3D":function(){define(["exports","../chunks/tslib.es6","../core/Collection","../core/deprecate","../core/lang","../core/Logger","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/has","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./ExtrudeSymbol3DLayer","./FillSymbol3DLayer","./IconSymbol3DLayer","./LineSymbol3DLayer","./ObjectSymbol3DLayer","./Symbol3D","./TextSymbol3DLayer","./WaterSymbol3DLayer"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b){"use strict";var _;const v=r.ofType({base:null,key:"type",typeMap:{extrude:d,fill:p,icon:h,line:f,object:m,text:g,water:b}});return e.default=_=class extends y{constructor(e){super(e),this.symbolLayers=new v,this.type="polygon-3d"}initialize(){const e=e=>{"line"===e.type&&i.deprecated(s.getLogger(this),"LineSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use FillSymbol3DLayer.outline instead.",version:"4.28"}),"text"===e.type&&i.deprecated(s.getLogger(this),"TextSymbol3DLayer can not be used as a SymbolLayer with a PolygonSymbol3D symbol anymore.",{replacement:"Use Labels instead.",version:"4.28"})};for(const t of this.symbolLayers)e(t);this.addHandles(n.on(()=>this.symbolLayers,"after-add",({item:t})=>e(t),n.sync))}clone(){return new _({styleOrigin:o.clone(this.styleOrigin),symbolLayers:o.clone(this.symbolLayers),thumbnail:o.clone(this.thumbnail)})}static fromJSON(e){const t=new _;if(t.read(e),2===t.symbolLayers.length&&"fill"===t.symbolLayers.at(0).type&&"line"===t.symbolLayers.at(1).type){const r=t.symbolLayers.at(0),i=t.symbolLayers.at(1);!i.enabled||e.symbolLayers?.[1]&&!1===e.symbolLayers[1].enable||(r.outline={size:i.size,color:null!=i.material?i.material.color:null}),t.symbolLayers.removeAt(1)}return t}static fromSimpleFillSymbol(e){return new _({symbolLayers:new r([p.fromSimpleFillSymbol(e)])})}},t.__decorate([a.property({type:v,json:{write:!0}})],e.default.prototype,"symbolLayers",void 0),t.__decorate([c.enumeration({PolygonSymbol3D:"polygon-3d"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=_=t.__decorate([u.subclass("esri.symbols.PolygonSymbol3D")],e.default),e.default})},"esri/symbols/SimpleFillSymbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/jsonMap","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./FillSymbol","./SimpleLineSymbol"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";var p;const h=new i.JSONMap({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});return e.default=p=class extends u{constructor(...e){super(...e),this.color=new r([0,0,0,.25]),this.outline=new d,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const i={};return e&&(i.style=e),t&&(i.outline=t),r&&(i.color=r),i}clone(){return new p({color:o.clone(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}},t.__decorate([s.property()],e.default.prototype,"color",void 0),t.__decorate([s.property()],e.default.prototype,"outline",void 0),t.__decorate([l.enumeration({esriSFS:"simple-fill"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:h.apiValues,json:{read:h.read,write:h.write}})],e.default.prototype,"style",void 0),e.default=p=t.__decorate([c.subclass("esri.symbols.SimpleFillSymbol")],e.default),e.default})},"esri/symbols/SimpleMarkerSymbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/jsonMap","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./MarkerSymbol","./SimpleLineSymbol"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";var f;const m=new i.JSONMap({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});return e.default=f=class extends p{constructor(...e){super(...e),this.color=new r([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new h}normalizeCtorArgs(e,t,r,i){if(e&&"string"!=typeof e)return e;const o={};return e&&(o.style=e),null!=t&&(o.size=s.toPt(t)),r&&(o.outline=r),i&&(o.color=i),o}writeColor(e,t){e&&"x"!==this.style&&"cross"!==this.style&&(t.color=e.toJSON()),null===e&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new f({angle:this.angle,color:o.clone(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}},t.__decorate([n.property()],e.default.prototype,"color",void 0),t.__decorate([d.writer("color")],e.default.prototype,"writeColor",null),t.__decorate([c.enumeration({esriSMS:"simple-marker"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([n.property()],e.default.prototype,"size",void 0),t.__decorate([n.property({type:m.apiValues,json:{read:m.read,write:m.write}})],e.default.prototype,"style",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"path",null),t.__decorate([n.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":h}},json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),e.default=f=t.__decorate([u.subclass("esri.symbols.SimpleMarkerSymbol")],e.default),e.default})},"esri/symbols/TextSymbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./Font","./Symbol","./support/textUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;return e.default=h=class extends d{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new u,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const i={};return e&&(i.text=e),t&&(i.font=t),r&&(i.color=r),i}writeLineWidth(e,t,r,i){i&&"string"!=typeof i?i.origin:t[r]=e}castLineWidth(e){return o.toPt(e)}writeLineHeight(e,t,r,i){i&&"string"!=typeof i?i.origin:t[r]=e}clone(){return new h({angle:this.angle,backgroundColor:i.clone(this.backgroundColor),borderLineColor:i.clone(this.borderLineColor),borderLineSize:this.borderLineSize,color:i.clone(this.color),font:this.font&&this.font.clone(),haloColor:i.clone(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}},t.__decorate([s.property({type:r,json:{write:!0}})],e.default.prototype,"backgroundColor",void 0),t.__decorate([s.property({type:r,json:{write:!0}})],e.default.prototype,"borderLineColor",void 0),t.__decorate([s.property({type:Number,json:{write:!0},cast:o.toPt})],e.default.prototype,"borderLineSize",void 0),t.__decorate([s.property({type:u,json:{write:!0}})],e.default.prototype,"font",void 0),t.__decorate([s.property({...p.horizontalAlignmentProperty,json:{write:!0}})],e.default.prototype,"horizontalAlignment",void 0),t.__decorate([s.property({type:Boolean,json:{write:!0}})],e.default.prototype,"kerning",void 0),t.__decorate([s.property({type:r,json:{write:!0}})],e.default.prototype,"haloColor",void 0),t.__decorate([s.property({type:Number,cast:o.toPt,json:{write:!0}})],e.default.prototype,"haloSize",void 0),t.__decorate([s.property({type:Boolean,json:{write:!0}})],e.default.prototype,"rightToLeft",void 0),t.__decorate([s.property({type:Boolean,json:{write:!0}})],e.default.prototype,"rotated",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"text",void 0),t.__decorate([a.enumeration({esriTS:"text"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({...p.verticalAlignmentProperty,json:{write:!0}})],e.default.prototype,"verticalAlignment",void 0),t.__decorate([s.property({type:Number,cast:o.toPt,json:{write:!0}})],e.default.prototype,"xoffset",void 0),t.__decorate([s.property({type:Number,cast:o.toPt,json:{write:!0}})],e.default.prototype,"yoffset",void 0),t.__decorate([s.property({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],e.default.prototype,"angle",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([s.property({type:Number})],e.default.prototype,"lineWidth",void 0),t.__decorate([c.writer("lineWidth")],e.default.prototype,"writeLineWidth",null),t.__decorate([n.cast("lineWidth")],e.default.prototype,"castLineWidth",null),t.__decorate([s.property(p.lineHeightProperty)],e.default.prototype,"lineHeight",void 0),t.__decorate([c.writer("lineHeight")],e.default.prototype,"writeLineHeight",null),e.default=h=t.__decorate([l.subclass("esri.symbols.TextSymbol")],e.default),e.default})},"esri/symbols/WebStyleSymbol":function(){define(["require","exports","../chunks/tslib.es6","../core/deprecate","../core/Error","../core/Logger","../core/promiseUtils","../core/accessorSupport/decorators/property","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../portal/Portal","../chunks/persistableUrlUtils","./Symbol","./support/Thumbnail"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;return t.default=y=class extends f{constructor(e){super(e),this.color=null,this.styleName=null,this.portal=null,this.styleUrl=null,this.thumbnail=null,this.name=null,this.type="web-style"}get _fetchCacheKey(){const e=null!=this.portal?this.portal:p.getDefault(),t=e.user?e.user.username:null;return`${this.styleName}:${this.styleUrl}:${this.name}:${t}:${e.url}`}read(e,t){this.portal=t?.portal,super.read(e,t)}clone(){return new y({name:this.name,styleUrl:this.styleUrl,styleName:this.styleName,portal:this.portal})}fetchSymbol(e){return this._fetchSymbol(e)}async fetchCIMSymbol(e){i.deprecatedFunction(s.getLogger(this),"WebStyleSymbol.fetchCIMSymbol is deprecated in favour of WebStyleSymbol.fetchSymbol which now supports both web and cim symbology",{version:"4.33",replacement:"WebStyleSymbol.fetchSymbol",see:"https://arcg.is/0CXPTr#fetchSymbol",warnOnce:!0});const t=await this._fetchSymbol({...e,acceptedFormats:["cim"]});if("cim"!==t?.type)throw new o("webstylesymbol:fetchCIMSymbol","Resolved web style symbol is not of type 'cim'");return t}async _fetchSymbol(t){const r=null!=t?t.cache:null,i=r?this._fetchCacheKey:null;if(null!=r){const e=i&&r.get(i);if(e)return e.clone()}const{resolveWebStyleSymbol:o}=await new Promise((t,r)=>e(["./support/webStyleSymbolUtils"],t,r));n.throwIfAborted(t);const a=o(this,{portal:this.portal},t);a.catch(e=>{s.getLogger(this).error("#fetchSymbol()","Failed to create symbol from style",e)});const l=await a;return null!=r&&r.set(i,l.clone()),l}},r.__decorate([a.property({json:{write:!1}})],t.default.prototype,"color",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.default.prototype,"styleName",void 0),r.__decorate([a.property({type:p,json:{write:!1}})],t.default.prototype,"portal",void 0),r.__decorate([a.property({type:String,json:{read:h.read,write:h.write}})],t.default.prototype,"styleUrl",void 0),r.__decorate([a.property({type:m.Thumbnail,json:{read:!1}})],t.default.prototype,"thumbnail",void 0),r.__decorate([a.property({type:String,json:{write:!0}})],t.default.prototype,"name",void 0),r.__decorate([u.enumeration({styleSymbolReference:"web-style"},{readOnly:!0})],t.default.prototype,"type",void 0),r.__decorate([a.property()],t.default.prototype,"_fetchCacheKey",null),t.default=y=r.__decorate([d.subclass("esri.symbols.WebStyleSymbol")],t.default),t.default})},"esri/renderers/support/lengthUtils":function(){define(["exports","../../core/unitUtils","../../geometry/support/Ellipsoid"],function(e,t,r){"use strict";const i={unknown:1,inches:t.convertUnit(1,"meters","inches"),feet:t.convertUnit(1,"meters","feet"),"us-feet":t.convertUnit(1,"meters","us-feet"),yards:t.convertUnit(1,"meters","yards"),miles:t.convertUnit(1,"meters","miles"),"nautical-miles":t.convertUnit(1,"meters","nautical-miles"),millimeters:t.convertUnit(1,"meters","millimeters"),centimeters:t.convertUnit(1,"meters","centimeters"),decimeters:t.convertUnit(1,"meters","decimeters"),meters:t.convertUnit(1,"meters","meters"),kilometers:t.convertUnit(1,"meters","kilometers"),"decimal-degrees":1/t.lengthToDegrees(1,"meters",r.earth.radius)};e.meterIn=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/visualVariables/VisualVariableFactory":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/jsonMap","../../core/Logger","../../core/Warning","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./ColorVariable","./OpacityVariable","./RotationVariable","./SizeVariable"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";const f={color:u,size:h,opacity:d,rotation:p},m=new i.JSONMap({colorInfo:"color",transparencyInfo:"opacity",rotationInfo:"rotation",sizeInfo:"size"}),y=/^\[([^\]]+)\]$/i;return e.default=class extends r{constructor(){super(...arguments),this.colorVariables=null,this.opacityVariables=null,this.rotationVariables=null,this.sizeVariables=null}set visualVariables(e){if(this._resetVariables(),e=e?.filter(e=>!!e),e?.length){for(const t of e)switch(t.type){case"color":this.colorVariables.push(t);break;case"opacity":this.opacityVariables.push(t);break;case"rotation":this.rotationVariables.push(t);break;case"size":this.sizeVariables.push(t)}this.sizeVariables.length&&this.sizeVariables.some(e=>!!e.target)&&e.sort((e,t)=>{let r=null;return r=e.target===t.target?0:e.target?1:-1,r});for(let t=0;t<e.length;t++)e[t].index=t;this._set("visualVariables",e)}else this._set("visualVariables",e)}readVariables(e,t,r){const{rotationExpression:i,rotationType:n}=t,a=i?.match(y),l=a?.[1];if(l&&(e||(e=[]),e.push({type:"rotationInfo",rotationType:n,field:l})),e)return e.map(e=>{const t=m.read(e.type),i=f[t];i||(o.getLogger(this).warn(`Unknown variable type: ${t}`),r?.messages&&r.messages.push(new s("visual-variable:unsupported",`visualVariable of type '${t}' is not supported`,{definition:e,context:r})));const n=new i;return n.read(e,r),n})}writeVariables(e,t){const r=[];for(const i of e){const e=i.toJSON(t);e&&r.push(e)}return r}_resetVariables(){this.colorVariables=[],this.opacityVariables=[],this.rotationVariables=[],this.sizeVariables=[]}},t.__decorate([n.property()],e.default.prototype,"visualVariables",null),e.default=t.__decorate([c.subclass("esri.renderers.visualVariables.VisualVariableFactory")],e.default),e.default})},"esri/renderers/support/ClassBreakInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./commonProperties"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r.JSONSupport{constructor(e){super(e),this.description=null,this.label=null,this.minValue=null,this.maxValue=0,this.symbol=null}clone(){return new c({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,symbol:this.symbol?.clone()??null})}getMeshHash(){const e=JSON.stringify(this.symbol);return`${this.minValue}.${this.maxValue}.${e}`}},t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"description",void 0),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([i.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],e.default.prototype,"minValue",void 0),t.__decorate([i.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],e.default.prototype,"maxValue",void 0),t.__decorate([i.property(l.requiredRendererSymbolProperty)],e.default.prototype,"symbol",void 0),e.default=c=t.__decorate([a.subclass("esri.renderers.support.ClassBreakInfo")],e.default),e.default})},"esri/renderers/support/commonProperties":function(){define(["exports","../../core/object","../../core/accessorSupport/extensions/serializableProperty/reader","../../symbols/PolygonSymbol3D","../../symbols/Symbol","../../symbols/support/jsonUtils","../../symbols/support/typeUtils"],function(e,t,r,i,o,s,n){"use strict";const a={types:n.symbolTypesRenderer,json:{write:{writer:s.write},origins:{"web-scene":{types:n.symbolTypesRenderer3D,write:{writer:s.write},read:{reader:r.createTypeReader({types:n.symbolTypesRenderer3D})}}}}},l=t.deepMerge({json:{origins:{"web-scene":{write:{isRequired:!0}}}}},a),c={types:{base:o,key:"type",typeMap:{"simple-fill":n.symbolTypes.typeMap["simple-fill"],"picture-fill":n.symbolTypes.typeMap["picture-fill"],"polygon-3d":n.symbolTypes.typeMap["polygon-3d"],cim:n.symbolTypes.typeMap.cim}},json:{write:{writer:s.write},origins:{"web-scene":{type:i,write:{writer:s.write}}}}},u={cast:e=>null==e||"string"==typeof e||"number"==typeof e?e:`${e}`,json:{type:String,write:{writer:(e,t)=>{t.value=e?.toString()}}}};e.rendererBackgroundFillSymbolProperty=c,e.rendererSymbolProperty=a,e.requiredRendererSymbolProperty=l,e.uniqueValueProperty=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/jsonUtils":function(){define(["exports","../../core/Error","../../core/object","../../layers/support/layerUtils","../WebStyleSymbol","./symbolConversion","./typeUtils"],function(e,t,r,i,o,s,n){"use strict";function a(e){return n.isSymbol3D(e)||e instanceof o}function l(e,r,o){if(null==e)return null;const{context:n,isLabelSymbol:l}=o,c=n?.origin,u=n?.messages;if("web-scene"===c&&!a(e)){const i=s.to3D(e,{retainCIM:!0,hasLabelingContext:l});return null!=i.symbol?i.symbol.write(r,n):(u?.push(new t("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in scenes. Use 3D symbology instead when working with WebScene and SceneView`,{symbol:e,context:n,error:i.error})),null)}return i.isSceneServiceLayer(n?.layer)&&function(e){return"polygon-3d"===e?.type||"line-3d"===e?.type}(e)?(u?.push(new t("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported on layers of type '${n?.layer?.declaredClass}'.`,{symbol:e,context:n})),null):("web-map"===c||"portal-item"===c&&!i.isSceneServiceLayer(n?.layer))&&a(e)?(u?.push(new t("symbol:unsupported",`Symbols of type '${e.declaredClass}' are not supported in web maps and portal items. Use 2D symbology and CIMSymbol instead when working with MapView`,{symbol:e,context:n})),null):e.write(r,n)}e.fromJSON=function(e,t){return n.readSymbol(e,null,t)},e.write=function(e,t,i,o){const s=l(e,{},{context:o,isLabelSymbol:!1});null!=s&&r.setDeepValue(i,s,t)},e.writeLabelSymbol=function(e,t,r,i){const o=l(e,{},{context:i,isLabelSymbol:!0});null!=o&&(t[r]=o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/layerUtils":function(){define(["exports","../../kernel","../../request","../../core/Collection","../../core/urlUtils","../catalog/catalogUtils"],function(e,t,r,i,o,s){"use strict";function n(e){return"scene"===e?.type}function a(e){return null!=e&&"object"==typeof e&&"type"in e&&"subtype-group"===e.type&&"sublayers"in e}function l(e){const t=e?.type;return"imagery-tile"===t||"tile"===t||"open-street-map"===t||"vector-tile"===t||"web-tile"===t||"wmts"===t}function c(e,t){return null!=e?.parent&&"declaredClass"in e.parent&&"esri.Basemap"===e.parent.declaredClass&&e.parent[t].includes(e)}function u(e){if(!("capabilities"in e))return!1;switch(e.type){case"catalog":case"catalog-footprint":case"csv":case"feature":case"geojson":case"imagery":case"knowledge-graph-sublayer":case"ogc-feature":case"oriented-imagery":case"scene":case"sublayer":case"subtype-group":case"subtype-sublayer":case"wfs":return!0;default:return!1}}function d(e){return!e||"Feature Service"===e.type&&!e.sourceUrl}e.applyPreferredHostToPortalItem=function(e,t){if(!t||!d(e))return;const r=(e.url,null);r&&(e.url=r)},e.getEffectiveEditingEnabled=function(e){return!!function(e){if(!("editingEnabled"in e))return!1;switch(e.type){case"csv":case"feature":case"geojson":case"oriented-imagery":case"scene":case"subtype-group":case"subtype-sublayer":return!0;default:return!1}}(e)&&("effectiveEditingEnabled"in e?e.effectiveEditingEnabled:e.editingEnabled)},e.getEffectiveLayerCapabilities=function(e){return u(e)?"effectiveCapabilities"in e?e.effectiveCapabilities:e.capabilities:null},e.getLayersWithChartSupport=function(e){const t=new i;for(const r of e.allLayers.concat(e.allTables))"csv"===r.type||s.isLayerFromCatalog(r)||("charts"in r&&t.push(r),"subtype-group"===r.type&&t.push(...r.sublayers));return t},e.getOwningPortalUrl=async function(e,i){const o=t.id?.findServerInfo(e);if(null!=o?.currentVersion)return o.owningSystemUrl||null;const s=e.toLowerCase().indexOf("/rest/services");if(-1===s)return null;const n=`${e.slice(0,s)}/rest/info`,a=null!=i?i.signal:null,{data:l}=await r(n,{query:{f:"json"},responseType:"json",signal:a});return l?.owningSystemUrl||null},e.getPreferredHost=function(e){return null},e.getPreferredUrl=function(e,t){return null},e.getSubtypesFromLayer=function(e){return e?("subtypes"in e?e.subtypes:a(e.parent)?e.parent.subtypes:[])??[]:[]},e.getTileMaxtrixSetFromActiveLayer=function(e){if(e.activeLayer){const t=e.activeLayer.tileMatrixSet;if(t)return t;const r=e.activeLayer.tileMatrixSets;if(r)return r}return null},e.isBaseLayer=function(e){return c(e,"baseLayers")},e.isBasemap3DSupportedLayer=function(e){return l(e)||n(e)},e.isBasemapSupportedTiledLayer=l,e.isFeatureCollectionLayer=function(e){return"feature"===e?.type&&!e.url&&"memory"===e.source?.type},e.isFeatureLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"feature"===e.type},e.isFeatureServiceLayer=function(e){return"feature"===e?.type&&"feature-layer"===e.source?.type},e.isGraphicsLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"graphics"===e.type},e.isGroupLayer=function(e){return null!=e&&"type"in e&&"group"===e.type},e.isImageryTileLayer=function(e){return"imagery-tile"===e?.type},e.isIntegratedMeshLayer=function(e){return"integrated-mesh"===e||"integrated-mesh-3dtiles"===e},e.isIntegratedMeshOperationalLayer=function(e){return"IntegratedMeshLayer"===e||"IntegratedMesh3DTilesLayer"===e},e.isKnowledgeGraphLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"knowledge-graph"===e.type&&"layers"in e},e.isKnowledgeGraphSublayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"knowledge-graph-sublayer"===e.type},e.isLayerWithFeatureCapabilities=u,e.isLayerWithFeatureLayerSource=function(e){const t=e?.type;return("feature"===t||"subtype-group"===t||"oriented-imagery"===t)&&"feature-layer"===e?.source?.type},e.isLayerWithFlowRenderer=function(e){return("imagery"===e.type||"imagery-tile"===e.type)&&"flow"===e.renderer?.type},e.isLinkChartLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"link-chart"===e.type&&"layers"in e},e.isMapImageLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"map-image"===e.type},e.isMapNotesLayer=function(e){return null!=e&&"object"==typeof e&&"type"in e&&"map-notes"===e.type&&"sublayers"in e},e.isPreferredUrlApplicable=d,e.isReferenceLayer=function(e){return c(e,"referenceLayers")},e.isSceneLayer=n,e.isSceneServiceLayer=function(e){const t=e?.type;return"building-scene"===t||"integrated-mesh"===t||"point-cloud"===t||"scene"===t},e.isSubtypeGroupLayer=a,e.isSubtypeSublayer=function(e){return"subtype-sublayer"===e?.type},e.isTable=function(e){return null!=e&&"object"==typeof e&&"isTable"in e&&!!e.isTable},e.isTiledLayer=function(e){const t=e?.type;return"base-tile"===t||"tile"===t||"elevation"===t||"imagery-tile"===t||"base-elevation"===t||"open-street-map"===t||"wcs"===t||"web-tile"===t||"wmts"===t||"vector-tile"===t},e.isVoxelLayer=function(e){return"voxel"===e?.type},e.sceneServiceLayerTypeToClassName={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"},e.serializeLayerDefinitions=function(e){const t=/[:;]/,r=[];let i=!1;if(e&&(e.forEach((e,o)=>{r.push([o,e]),!i&&t.test(e)&&(i=!0)}),r.length>0)){let e;if(i){const t={};r.forEach(e=>{t[e[0]]=e[1]}),e=JSON.stringify(t)}else{const t=[];r.forEach(e=>{t.push(e[0]+":"+e[1])}),e=t.join(";")}return e}return null},e.serializeTimeOptions=function(e){if(!e)return;const t=[];return e.forEach((e,r)=>{t.push('"'+r+'":'+JSON.stringify(e))}),t.length?"{"+t.join(",")+"}":void 0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/catalog/catalogUtils":function(){define(["exports","../../core/handleUtils","../../core/reactiveUtils"],function(e,t,r){"use strict";const i=new WeakMap;e.getCatalogLayerForLayer=function(e){return e.parent&&"type"in e.parent&&"catalog-dynamic-group"===e.parent.type?e.parent.parent:null},e.isCatalogSublayer=function(e,t){const r=e.parent,i=e.layer;if("map-image"!==i?.type||!i.sourceJSON||!r)return!1;const o=i.sourceJSON.layers;if(!o)return!1;const s=o.find(t=>e.id===t.id),n="footprints"===t?"Feature Layer":"Catalog Dynamic Group Layer";return s?.type===n&&"Catalog Layer"===o.find(e=>e.id===r.id)?.type},e.isLayerFromCatalog=function e(o){return!o.destroyed&&(i.has(o)||o.addHandles([r.watch(()=>{const t=o.parent;return!(!t||!("type"in t))&&("catalog-dynamic-group"===t.type||e(t))},e=>i.set(o,e),r.syncAndInitial),t.makeHandle(()=>i.delete(o))]),i.get(o))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/symbolConversion":function(){define(["exports","../../core/Error","../LabelSymbol3D","../LineSymbol3D","../MeshSymbol3D","../PictureMarkerSymbol","../PointSymbol3D","../PolygonSymbol3D","../SimpleFillSymbol","../SimpleLineSymbol","../SimpleMarkerSymbol","../TextSymbol","../WebStyleSymbol","./defaults3D","./typeUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";const m="#useCIMFallbackSymbology()",y={retainId:!1,ignoreDrivers:!1,hasLabelingContext:!0};e.defaultTo3DOptions=y,e.to3D=function(e,g=y){if(!e)return{symbol:null};const{retainId:b=y.retainId,ignoreDrivers:_=y.ignoreDrivers,hasLabelingContext:v=y.hasLabelingContext,retainCIM:S=y.retainCIM,cimFallbackEnabled:x=y.cimFallbackEnabled}=g;let w=null;if(f.isSymbol3D(e))w=e.clone();else if("web-style"===e.type)w=e.clone();else if("cim"===e.type){const r=e.data?.symbol?.type;switch(r){case"CIMPointSymbol":w=S?e.clone():n.fromCIMSymbol(e);break;case"CIMLineSymbol":x&&(w=h.defaultRendererPolylineSymbol3D.clone(),g?.logWarning?.(m,"Unsupported CIM line symbology converted to fallback 3D line symbology"));break;case"CIMPolygonSymbol":x&&(w=h.defaultRendererPolygonSymbol3D.clone(),g?.logWarning?.(m,"Unsupported CIM polygon symbology converted to fallback 3D polygon symbology"))}if(!w)return{error:new t("symbol-conversion:unsupported-cim-symbol",`CIM symbol of type '${r||"unknown"}' is unsupported in 3D`,{symbol:e})}}else if(e instanceof c)w=i.fromSimpleLineSymbol(e);else if(e instanceof u)w=n.fromSimpleMarkerSymbol(e);else if(e instanceof s)w=n.fromPictureMarkerSymbol(e);else if(e instanceof l)w=g.geometryType&&"mesh"===g.geometryType?o.fromSimpleFillSymbol(e):a.fromSimpleFillSymbol(e);else{if(!(e instanceof d))return{error:new t("symbol-conversion:unsupported-2d-symbol",`2D symbol of type '${e.type||e.declaredClass}' is unsupported in 3D`,{symbol:e})};w=v?r.fromTextSymbol(e):n.fromTextSymbol(e)}return b&&w&&"cim"!==w.type&&(w.id=e.id),!_||"cim"===w.type||w instanceof p||w.symbolLayers.forEach(e=>e.ignoreDrivers=!0),{symbol:w}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults3D":function(){define(["exports","../../Color","../../core/Collection","../../core/has","../../core/screenUtils","../FillSymbol3DLayer","../LineSymbol3D","../LineSymbol3DLayer","../MeshSymbol3D","../PointSymbol3D","../PolygonSymbol3D","../edges/SolidEdges3D","./defaults","./defaultsJSON"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";const f=c.fromSimpleMarkerSymbol(p.defaultPointSymbol2D),m=n.fromSimpleLineSymbol(p.defaultPolylineSymbol2D),y=u.fromSimpleFillSymbol(p.defaultPolygonSymbol2D),g=new l({symbolLayers:new r([new s({material:{color:h.defaultColor},edges:new d({size:o.px2pt(1),color:new t(h.defaultOutlineColor)})})])}),b=new n({symbolLayers:new r([new a({material:{color:new t([0,0,0])},size:o.px2pt(1)})])}),_=new u({symbolLayers:new r([new s({outline:{color:new t([0,0,0]),size:o.px2pt(1)}})])});e.defaultRendererPolygonSymbol3D=_,e.defaultRendererPolylineSymbol3D=b,e.getDefaultSymbol3D=function(e){if(null==e)return null;switch(e.type){case"mesh":return g;case"point":case"multipoint":return f;case"polyline":return m;case"polygon":case"extent":return y}return null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults":function(){define(["exports","../../core/has","../SimpleFillSymbol","../SimpleLineSymbol","../SimpleMarkerSymbol","../TextSymbol","./defaultsJSON"],function(e,t,r,i,o,s,n){"use strict";const a=o.fromJSON(n.defaultPointSymbolJSON),l=i.fromJSON(n.defaultPolylineSymbolJSON),c=r.fromJSON(n.defaultPolygonSymbolJSON),u=s.fromJSON(n.defaultTextSymbolJSON),d=o.fromJSON(n.errorPointSymbolJSON),p=i.fromJSON(n.errorPolylineSymbolJSON),h=r.fromJSON(n.errorPolygonSymbolJSON);e.defaultPointSymbol2D=a,e.defaultPolygonSymbol2D=c,e.defaultPolylineSymbol2D=l,e.defaultTextSymbol2D=u,e.errorPointSymbol2D=d,e.errorPolygonSymbol2D=h,e.errorPolylineSymbol2D=p,e.getDefaultSymbol2D=function(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return a;case"polyline":return l;case"polygon":case"extent":return c}return null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaultsJSON":function(){define(["exports"],function(e){"use strict";const t=[252,146,31,255],r={type:"esriSMS",style:"esriSMSCircle",size:6,color:t,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},i={type:"esriSLS",style:"esriSLSSolid",width:.75,color:t};e.defaultColor=t,e.defaultOutlineColor=[153,153,153,255],e.defaultPointSymbolJSON=r,e.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},e.defaultPolylineSymbolJSON=i,e.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},e.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},e.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},e.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/RendererLegendOptions":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;const d=r.strict()({ascendingValues:"ascending-values",descendingValues:"descending-values"});let p=u=class extends(t.ClonableMixin(i.JSONSupport)){static from(e){return s.ensureClass(u,e)}constructor(e){super(e),this.title=null,this.order=null}};return e.__decorate([o.property({type:String,json:{write:!0}})],p.prototype,"title",void 0),e.__decorate([l.enumeration(d)],p.prototype,"order",void 0),p=u=e.__decorate([c.subclass("esri.renderers.support.RendererLegendOptions")],p),p})},"esri/renderers/DictionaryRenderer":function(){define(["exports","../chunks/tslib.es6","../request","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../layers/support/fieldUtils","./Renderer","./mixins/VisualVariablesMixin","./support/DictionaryLoader"],function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";var h;return e.default=h=class extends(d.VisualVariablesMixin(u)){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){const e=this.getDictionaryInfo();return new p.DictionaryLoader(this.url,this.config,this.fieldMap??{},e)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,i){i?.origin||super.writeVisualVariables(e,t,r,i)}clone(){return new h({config:i.clone(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:i.clone(this.fieldMap),url:i.clone(this.url),visualVariables:i.clone(this.visualVariables)})}async getSymbolAsync(e,t,r=!0){return this._loader.getSymbolAsync(e,t,r)}async getSymbolForControlString(e,t,r){return this._loader.getSymbolForControlString(e,t,r)}getDictionaryInfo(){return this._dictionaryInfoPromise||(this._dictionaryInfoPromise=this._fetchDictionaryInfo()),this._dictionaryInfoPromise}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await c.collectArcadeFieldNames(e,t,this.scaleExpression);for(const r in this.fieldMap){const i=this.fieldMap[r];t.has(i)&&e.add(i)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}async _fetchDictionaryInfo(){const{data:e}=await r(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"}});return e}},t.__decorate([o.property({type:p.DictionaryLoader})],e.default.prototype,"_loader",null),t.__decorate([o.property({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],e.default.prototype,"config",void 0),t.__decorate([o.property({type:Object,json:{write:!0}})],e.default.prototype,"fieldMap",void 0),t.__decorate([o.property({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],e.default.prototype,"scaleExpression",void 0),t.__decorate([l.writer("scaleExpression")],e.default.prototype,"writeData",null),t.__decorate([o.property({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],e.default.prototype,"scaleExpressionTitle",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.default.prototype,"url",void 0),t.__decorate([l.writer("visualVariables")],e.default.prototype,"writeVisualVariables",null),e.default=h=t.__decorate([a.subclass("esri.renderers.DictionaryRenderer")],e.default),e.default})},"esri/renderers/support/DictionaryLoader":function(){define(["require","exports","../../request","../../core/lang","../../core/LRUCache","../../geometry/support/jsonUtils","./DictionaryControlString","./DictionaryScriptEvaluator","../../support/ArcadeExpression","../../symbols/CIMSymbol","../../symbols/cim/utils"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";const d={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};function p(e,t,r){if(!e||0===e.length)return null;const i={...e[0]};if(e.length>1){i.effects=null,i.symbolLayers=[];for(const t of e){const e=t;if(null!=e.effects)for(const t of e.symbolLayers)null==t.effects?t.effects=e.effects:t.effects.unshift(...e.effects);i.symbolLayers.unshift(...e.symbolLayers)}}return r&&(i.callout=d),{type:"CIMSymbolReference",symbol:i,primitiveOverrides:t}}t.DictionaryLoader=class{constructor(e,t,r,i){this.url=e,this.fieldMap=r,this.dictionaryInfo=i,this._symbolPartCache=new o.LRUCache(100),this._evaluator=(async()=>a.DictionaryScriptEvaluator.from(await i,t,r))()}async getSymbolAsync(e,t,r=!0){const i=await this._evaluator,o=t?.fields??l.deriveFields(e.attributes),a=i.createDictionaryFieldsIndex(o),c=i.evaluate(e,t?.scale??0,a,t?.spatialReference);if(null==c)return null;const u=s.getJsonType(e.geometry),d=n.DictionaryControlString.parse(c,i.itemNames,u),p="esriGeometryPoint"===u&&!e.geometry?.hasZ;return await this._cimPartsToCIMSymbol(e,d.partNames,d.overrides,p,t,r,a)}async getSymbolForControlString(e,t,r){const i=await this._evaluator,o=n.DictionaryControlString.parse(e,i.itemNames,t),s="esriGeometryPoint"===t&&!r,a=p(await Promise.all(o.partNames.map(e=>this._getSymbolPart(e))),o.overrides,s);return new c({data:a})}async _cimPartsToCIMSymbol(t,r,o,s,n,a,l){const d=r.map(e=>this._getSymbolPart(e,n));let h=await Promise.all(d);if(a&&this.fieldMap&&h.length>0){const{OverrideHelper:r}=await new Promise((t,r)=>e(["../../symbols/cim/OverrideHelper"],t,r));h=i.clone(h);for(const e of h)r.applyDictionaryTextOverrides(e,t,this.fieldMap,l,u.getTextCasing(e))}const f=p(h,o,s);return new c({data:f})}async _fetchSymbolPart(e,t){const i=await this.dictionaryInfo,o=(this.url+"/"+i.cimRefTemplateUrl).replaceAll(/\{itemName\}/gi,e),{data:s}=await r(o,{responseType:"json",query:{f:"json"},...t});return s}async _getSymbolPart(e,t){let r=this._symbolPartCache.get(e);return r||(r=this._fetchSymbolPart(e,t),this._symbolPartCache.put(e,r)),r}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/DictionaryControlString":function(){define(["exports","../../Color"],function(e,t){"use strict";class r{static parse(e,t,s){const n=[],a=[],l=e.split(";");for(let e=0;e<l.length;e++){const r=l[e];if(r){if(r.includes("po:")){const e=r.slice(3).split("|");if(3===e.length){const[t,r,o]=e,s=i(t,r,o);s&&a.push(s)}continue}if(r.includes("|")){for(const e of r.split("|"))if(t.has(e)){n.push(e);break}}else if(t.has(r))n.push(r);else if(0===e){n.length=0,n.push(o(s));break}}}return new r(n,a)}constructor(e,t){this.partNames=e,this.overrides=t}}function i(e,r,i){const o=function(e,r){if("DashTemplate"===e)return r.split(" ").map(e=>Number(e));if("Color"===e){const e=new t(r).toRgba();return[e[0],e[1],e[2],255*e[3]]}return Number(r)}(r,i);return{primitiveName:e,propertyName:r,value:o,defaultValue:null}}function o(e){switch(e){case"esriGeometryPolyline":return"Invalid_L";case"esriGeometryPolygon":return"Invalid_A";default:return"Invalid_P"}}e.DictionaryControlString=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/DictionaryScriptEvaluator":function(){define(["exports","../../core/Error","../../core/Logger","../../core/Version","../../layers/support/FieldsIndex","../../support/ArcadeExpression"],function(e,t,r,i,o,s){"use strict";class n{static async from(e,o,l){const c=e.dictionary_version?i.Version.parse(e.dictionary_version):null,u=new Set(e.itemsNames),d={};if(o)for(const e in o)d[e]=o[e];if(e.authoringInfo.configuration)for(const t of e.authoringInfo.configuration)d.hasOwnProperty(t.name)||(d[t.name]=t.value);const p=new Set(e.authoringInfo.symbol);for(const e of Object.keys(l))p.delete(e);p.size&&r.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("missing-fields: fieldMap entries for the following symbol fields are missing",{symbolFields:p});const h=await s.createDictionaryExpression(e.expression,null,d);if(!h)throw new t("dictionary-renderer:expression-error","Unable to create dictionary renderer expression");const f=!c||!c.greaterEqual(4,0);f&&r.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("Dictionary script does not support native field types. Applying fallback",{version:c});const m=new a(l,f);return new n(f,u,h,m)}constructor(e,t,r,i){this._requiresFieldCoercionToString=e,this._itemNames=t,this._compiled=r,this._reader=i}get itemNames(){return this._itemNames}evaluate(e,t,i,o){try{return this._reader.bind(e,i,o),this._compiled.evaluate(this._reader,{$view:{scale:t}})}catch(e){r.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("arcade: dictionary script evaluation failed",{error:e})}return null}createDictionaryFieldsIndex(e){if(!this._requiresFieldCoercionToString)return new o(e);const t=e.map(e=>({...e,type:"esriFieldTypeString"}));return new o(t)}}class a extends s.ArcadeFeatureReader{constructor(e,t){super(),this._fieldMap=e,this._requiresFieldCoercionToString=t}_getField(e){const t=this._fieldMap[e]??e;return this._boundSchema.fieldsIndex.get(t)}field(e){if(!this._requiresFieldCoercionToString)return super.field(e,!1);const t=this._getField(e);return null==t||null==this._boundTarget.attributes[t.name]?"":""+this._boundTarget.attributes[t.name]}}e.DictionaryScriptEvaluator=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/Version":function(){define(["exports","./Error"],function(e,t){"use strict";e.Version=class e{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}greaterEqual(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",i=this._context&&this._context+" ";throw new t(r+"unsupported-version",`Required major ${i}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new e(this.major,this.minor,this._context)}static parse(r,i=""){const[o,s]=r.split("."),n=/^\s*\d+\s*$/;if(!o?.match||!n.test(o))throw new t((i&&i+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:r});if(!s?.match||!n.test(s))throw new t((i&&i+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:r});const a=parseInt(o,10),l=parseInt(s,10);return new e(a,l,i)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/ArcadeExpression":function(){define(["exports","../arcade/ArcadeDate","../core/Error","../core/has","../core/sql/DateOnly","../core/sql/TimeOnly","../geometry/support/jsonUtils","../layers/support/FieldsIndex","./loadArcade","../time/constants"],function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=["geometry","scale","timeProperties"];class d{static async create(e,t,i,o){const{arcade:s,Dictionary:n}=await l.loadArcade();let a;try{a=s.parseScript(e)}catch(t){throw new r("arcade-bad-expression","Failed to parse arcade script",{script:e,error:t})}const c=s.scriptUsesGeometryEngine(a);c&&await s.enableGeometrySupport(),await s.loadDependentModules(new Set,a,null,!1,c);const u={vars:o.reduce((e,t)=>({...e,[t]:null}),{}),spatialReference:t,useAsync:!1},p=s.compileScript(a,u);let h=null;null!=i&&(h=new n(i),h.immutable=!0);const f=new n;return f.immutable=!1,f.setField("scale",0),new d(e,s,a,p,t,f,h,n)}constructor(e,t,r,i,o,s,n,a){this.script=e,this._arcade=t,this._syntaxTree=r,this._compiled=i,this._spatialReference=o,this._viewDict=s,this._configDict=n,this._dictionaryCtor=a,this._dependencies=new Map,this._featureReader=new p,this._dependencies.set("geometry",t.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set("scale",this._arcade.referencesMember(this._syntaxTree,"scale")),this._dependencies.set("timeProperties",this._arcade.scriptUsesViewProperties(this._syntaxTree,["timeProperties"]))}evaluate(e,r){const i=r.$view?.timeZone;if(r.$view){let e;if(this._viewDict.setField("scale",r.$view.scale),null!=r.$view.timeProperties){const{currentStart:o,currentEnd:s}=r.$view.timeProperties;e=new this._dictionaryCtor({currentStart:null!=o?null!=i?t.ArcadeDate.epochToArcadeDate(o,i):t.ArcadeDate.unknownEpochToArcadeDate(o):void 0,currentEnd:null!=s?null!=i?t.ArcadeDate.epochToArcadeDate(s,i):t.ArcadeDate.unknownEpochToArcadeDate(s):void 0,startIncluded:!0,endIncluded:!0})}this._viewDict.setField("timeProperties",e)}return this._compiled({vars:{$view:this._viewDict,$config:this._configDict,$feature:e},spatialReference:this._spatialReference,timeZone:i})}repurposeFeature(e,t){return this._featureReader.bind(e,t,this._spatialReference),this._featureReader}references(e){return this._dependencies.get(e)??!1}}class p{constructor(){this._boundTarget=null,this._boundSchema={fields:null,fieldsIndex:null,spatialReference:null,get geometryType(){return null},get objectIdField(){return null}},this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}bind(e,t,r){const i=t??new a(h(e.attributes));this._boundTarget=e,this._boundSchema.fields=i.fields,this._boundSchema.fieldsIndex=i,this._boundSchema.spatialReference=r}_getField(e){return this._boundSchema.fieldsIndex.get(e)}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(e){this._contextTimeZone=e}readArcadeFeature(){return this}hasField(e){return this._boundSchema.fieldsIndex.has(e)}geometry(){if("fromJSON"in this._boundTarget)return this._boundTarget.geometry;const e=n.fromJSON(this._boundTarget.geometry);if(e){if(!this._boundSchema.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");e.spatialReference=this._boundSchema.spatialReference}return e}isUnknownDateTimeField(e){return this._boundSchema.fieldsIndex.getTimeZone(e)===c.unknown}field(e,r=!0){const i=this._getField(e);if(i){const r=this._boundTarget.attributes[i.name];if(null==r)return null;switch(i.type){case"date-only":case"esriFieldTypeDateOnly":return o.DateOnly.fromReader(r);case"time-only":case"esriFieldTypeTimeOnly":return s.TimeOnly.fromReader(r);case"esriFieldTypeTimestampOffset":case"timestamp-offset":return t.ArcadeDate.fromReaderAsTimeStampOffset(r);case"date":case"esriFieldTypeDate":return this.isUnknownDateTimeField(e)?t.ArcadeDate.unknownEpochToArcadeDate(r):t.ArcadeDate.epochToArcadeDate(r,this.contextTimeZone??c.system);default:return r}}if(r)throw new Error(`Field ${e} does not exist`);return null}setField(e,t){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this._boundSchema.fieldsIndex.fields.map(e=>e.name)}castToText(e=!1){return JSON.stringify(this._boundTarget)}gdbVersion(){return null}fullSchema(){return this._boundSchema}castAsJson(e=null){return{attributes:this._boundTarget.attributes,geometry:!0===e?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(e=null,t=null){return Promise.resolve(this.castAsJson(t))}}function h(e){const t=[];for(const r in e)t.push({name:r,alias:r,type:"string"==typeof e[r]?"esriFieldTypeString":"esriFieldTypeDouble"});return t}e.ArcadeExpression=d,e.ArcadeFeatureReader=p,e.collectExpressionDependencies=function(e,t){if(null!=t)for(const r of u)t.hasArcadeDependency(r)&&e.add(r);return e},e.createDictionaryExpression=function(e,t,r){return d.create(e,t,r,["$feature","$view","$config"])},e.createLabelExpression=function(e,t){return d.create(e,t,null,["$feature","$view"])},e.createRendererExpression=function(e,t){return d.create(e,t,null,["$feature","$view"])},e.deriveFields=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/utils":function(){define(["require","exports","./defaultCIMValues"],function(e,t,r){"use strict";function i(e){return"function"==typeof e}function o(e){let t=e.length;for(;t--;)if(!" /-,\n".includes(e.charAt(t)))return!1;return!0}function s(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function n(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function a(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}class l{constructor(e){this._import=e}getImportPromise(){return null==this._promise&&(this._promise=this._import().then(e=>this.module=e)),this._promise}}function c(e){return new l(e)}const u=c(()=>new Promise((t,r)=>e(["../../geometry/geometryEngineJSON"],t,r)));function d(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function p(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...r.defaultCIMColor[t]];const i=r.defaultCIMValues[e];if(!i)throw new Error(`InternalError: default value for type ${e}.`);return i[t]}function h(e){return e.split(" ").map(e=>Number(e))}function f(e){return"string"==typeof e?h(e):e}function m(e,t){if(null!==t){const r=t.get(e);return r?r.name:e}return e}function y(e,t,r,i,o){const s=r*Math.PI/180;if(s){const r=Math.cos(s);return(Math.sin(s)*e+r*t)*i+o}return t*i+o}function g(e,t,r,i,o){const s=r*Math.PI/180;return s?(Math.cos(s)*e-Math.sin(s)*t)*i+o:e*i+o}function b(e,t,r){return t?r-e:r+e}t.adjustTextCase=s,t.analyzeTextParts=function(e,t){const r=[];let i=0,s=-1;do{if(s=e.indexOf("[",i),s>=i){if(s>i){const t=e.slice(i,s);r.push([t,null,o(t)])}if(i=s+1,s=e.indexOf("]",i),s>=i){if(s>i){const o=t[e.slice(i,s)];o&&r.push([null,o,!1])}i=s+1}}}while(-1!==s);if(i<e.length){const t=e.slice(i);r.push([t,null,o(t)])}return r},t.applyParentTransform=function(e,t,r,i,o,s,n=!0){const{infos:a}=s;let l=1,c=0,u=0,d=0,p=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:r,rotation:i,size:o,frameHeight:s,rotateClockWise:h,scaleSymbolsProportionally:f}of a)p=e?1:l,u=g(t,r,c,p,u),d=y(t,r,c,p,d),s&&(f||n)&&(l*=o/s),c=b(i,h,c);const h=g(i,o,c,p,u),f=y(i,o,c,p,d);return{size:e*l,rotation:b(t,r,c),offsetX:h,offsetY:f}},t.assignTextValuesFromFeature=function(e,t,r,i){let o="",n=null;for(const i of t){const[t,s,a]=i;if(null!=t&&""!==t)a?n=t:(null!=n&&(o+=n,n=null),o+=t);else{let t=s;null!=r&&(t=m(s,r));const i=e.attributes[t];null!=i&&""!==i&&(null!=n&&(o+=n,n=null),o+=i)}}return s(o,i)},t.attributesToFields=function(e){return(e?Object.keys(e):[]).map(t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"}))},t.colorToArray=function(e){return[e.r,e.g,e.b,e.a]},t.evaluateValueOrFunction=function(e,t,r,o){return i(e)?e(t,r,o):e},t.fromCIMFontDecoration=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"},t.fromCIMFontStyle=function(e){let t="normal",r="normal";if(e){const i=e.toLowerCase();i.includes("italic")?t="italic":i.includes("oblique")&&(t="oblique"),i.includes("bold")?r="bold":i.includes("light")&&(r="lighter")}return{style:t,weight:r}},t.fromCIMHorizontalAlignment=function(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}},t.fromCIMVerticalAlignment=function(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}},t.getDefaultCIMValue=p,t.getEnum=(e,t)=>e??t,t.getFieldName=m,t.getFillColor=function e(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const r of t.symbolLayers){const t=e(r);if(null!=t)return t}break;case"CIMTextSymbol":return e(t.symbol);case"CIMSolidFill":return t.color}return null},t.getFontStyle=function(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}},t.getFontWeight=function(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}},t.getNumericValue=(e,t=0)=>null==e||isNaN(e)?t:e,t.getProcessParam=function(e,t,r){const i="Color"===r||"TintColor"===r||"ToColor"===r,o="Rotation"===r||"Angle"===r||"ToRotation"===r;let s=t[d(r)];if(null!=s&&(i?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:o&&(s*=Math.PI/180)),null==s&&(s=p(t.type,r.toLowerCase()),null!=s&&(i?s=[s[0]/255,s[1]/255,s[2]/255,s[3]]:o&&(s*=Math.PI/180))),null!=t.primitiveName){const n=e[t.primitiveName];if(null!=n){const e=n[r];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(s=e,null!=s&&(i?s=[s[0]/255,s[1]/255,s[2]/255,s[3]/255]:o&&(s*=Math.PI/180))):(s={valueExpressionInfo:e,defaultValue:s},null!=s&&(i?s={type:"Process",op:"ArcadeColor",value:s}:o&&(s={type:"Process",op:"Divide",left:s,right:180/Math.PI}))))}}if(null==s)throw new Error(`Failed to derive a value or an expression for "${r}".`);return s},t.getRelativeGradientSize=function(e,t){return Math.max(Math.min((e??t)/100,1),0)},t.getSize=function(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const i of e.symbolLayers)if(i)switch(i.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=i.size??r.defaultCIMValues.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const i of e.symbolLayers)if(i)switch(i.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=i.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(i.markerPlacement&&a(i.markerPlacement)){const e=i.size??r.defaultCIMValues.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=i.height;null!=e&&e>t&&(t=e)}}return t}}},t.getStrokeColor=function e(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const r=t.symbolLayers;if(r)for(const t of r){const r=e(t);if(null!=r)return r}break}case"CIMTextSymbol":return e(t.symbol);case"CIMSolidStroke":return t.color}},t.getStrokeWidth=function e(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const r of t.symbolLayers){const t=e(r);if(void 0!==t)return t}break;case"CIMTextSymbol":return e(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}},t.getTextCasing=function e(t){if(null==t)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return"Normal";for(const t of r)if("CIMVectorMarker"===t.type)return e(t)}break;case"CIMVectorMarker":{const r=t.markerGraphics;if(!r)return"Normal";for(const t of r)if(t.symbol)return e(t.symbol)}}return"Normal"},t.getTextValuesFromFeatureHandle=function(e,t,r){let i="",o=null;for(const r of t){const[t,s,n]=r;if(null!=t&&""!==t)n?o=t:(null!=o&&(i+=o,o=null),i+=t);else{const t=e.readAttribute(s);null!=t&&""!==t&&(null!==o&&(i+=o,o=null),i+=t)}}return s(i,r)},t.getTintColor=e=>e.tintColor?n(e.tintColor):[255,255,255,1],t.getValue=(e,t)=>null!=e?e:t,t.hasProcessParam=function(e,t,r){if(null!=t[d(r)])return!0;if(null!=t.primitiveName){const i=e[t.primitiveName];if(null!=i&&null!=i[r])return!0}return!1},t.hasStrokeLayer=function(e){for(const t of e)if(t.enable)switch(t.type){case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return!0}return!1},t.importLazily=c,t.isCIMFill=function(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)},t.isCIMMarker=function(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type},t.isCIMMarkerStrokePlacement=a,t.isCIMStroke=function(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type},t.isFeatureValueFn=i,t.isSVGImage=e=>e.includes("data:image/svg+xml"),t.isValidCIMValue=function e(t){if(null==t)return!1;if(Array.isArray(t))return t.every(t=>e(t));switch(typeof t){case"string":return!!t;case"number":return!isNaN(t)}},t.lazyGeometryEngine=u,t.mapCIMSymbolToGeometryType=function(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}},t.normalizeAlpha=n,t.normalizeDashEffectTemplate=function(e){return e?.dashTemplate&&(e.dashTemplate=f(e.dashTemplate)),e},t.normalizeDashTemplate=f,t.normalizePrimitiveOverrideProps=function(e){return e.map(e=>({...e,propertyName:d(e.propertyName)}))},t.parseDashTemplate=h,t.resampleHermite=function(e,t,r,i,o,s,n=!0){const a=t/o,l=r/s,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let r=0;r<s;r++)for(let d=0;d<o;d++){const p=4*(d+(n?s-r-1:r)*o);let h=0,f=0,m=0,y=0,g=0,b=0,_=0;const v=(r+.5)*l;for(let i=Math.floor(r*l);i<(r+1)*l;i++){const r=Math.abs(v-(i+.5))/u,o=(d+.5)*a,s=r*r;for(let r=Math.floor(d*a);r<(d+1)*a;r++){let n=Math.abs(o-(r+.5))/c;const a=Math.sqrt(s+n*n);a>=-1&&a<=1&&(h=2*a*a*a-3*a*a+1,h>0&&(n=4*(r+i*t),_+=h*e[n+3],m+=h,e[n+3]<255&&(h=h*e[n+3]/250),y+=h*e[n],g+=h*e[n+1],b+=h*e[n+2],f+=h))}}i[p]=y/f,i[p+1]=g/f,i[p+2]=b/f,i[p+3]=_/m}},t.toCIMSymbolJSON=function(e){return e.data?.symbol??null},t.toLowerCaseProps=function(e){const t={};for(const r in e){const i=e[r];t[d(r)]=i}return t},t.uncapitalize=d,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/defaultCIMValues":function(){define(["exports"],function(e){"use strict";e.defaultCIMColor={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},e.defaultCIMValues={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1,gradientMethod:"AcrossLine",gradientSize:75,gradientSizeUnits:0,gradientType:"Discrete",interval:5},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGradientFill:{enable:!0,angle:90,gradientMethod:"Linear",gradientSize:75,gradientSizeUnits:0,gradientType:"Discrete",interval:5},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRadial:{angle:0,length:5},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0,easing:"Linear"},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0,rotateclockwise:!1},CIMSymbolAnimationOffset:{offsetx:0,offsety:0},CIMSymbolAnimationMoveAlongLine:{speed:30,distanceAlong:100}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/DotDensityRenderer":function(){define(["exports","../chunks/tslib.es6","../Color","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","./Renderer","./mixins/VisualVariablesMixin","./support/AttributeColorInfo","./support/DotDensityLegendOptions","../symbols/SimpleFillSymbol","../symbols/SimpleLineSymbol"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";var y;return e.default=y=class extends(d.VisualVariablesMixin(u)){constructor(e){super(e),this.attributes=null,this.backgroundColor=new r([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new m,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}set visualVariables(e){super.visualVariables=e}calculateDotValue(e){if(null==this.referenceScale)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new f({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new y({attributes:i.clone(this.attributes),backgroundColor:i.clone(this.backgroundColor),dotBlendingEnabled:i.clone(this.dotBlendingEnabled),dotShape:i.clone(this.dotShape),dotSize:i.clone(this.dotSize),dotValue:i.clone(this.dotValue),legendOptions:i.clone(this.legendOptions),outline:i.clone(this.outline),referenceScale:i.clone(this.referenceScale),seed:i.clone(this.seed),visualVariables:i.clone(this.visualVariables),authoringInfo:i.clone(this.authoringInfo)})}getControllerHash(){const e=this.attributes?.map(e=>e.field||e.valueExpression||"");return`${e}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes??[])r.valueExpression&&await c.collectArcadeFieldNames(e,t,r.valueExpression),r.field&&e.add(r.field)}},t.__decorate([o.property({type:[p],json:{write:!0}})],e.default.prototype,"attributes",void 0),t.__decorate([o.property({type:r,json:{write:!0}})],e.default.prototype,"backgroundColor",void 0),t.__decorate([o.property({type:Boolean,json:{write:!0}})],e.default.prototype,"dotBlendingEnabled",void 0),t.__decorate([o.property({type:String,json:{write:!1}})],e.default.prototype,"dotShape",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"dotSize",void 0),t.__decorate([o.property({type:h,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([o.property({type:m,json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"dotValue",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"referenceScale",void 0),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"seed",void 0),t.__decorate([a.enumeration({dotDensity:"dot-density"})],e.default.prototype,"type",void 0),e.default=y=t.__decorate([l.subclass("esri.renderers.DotDensityRenderer")],e.default),e.default})},"esri/renderers/support/AttributeColorInfo":function(){define(["../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/ensureType"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;let d=u=class extends r.JSONSupport{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return null==e?e:"function"==typeof e?(i.getLogger(this).error(".field: field must be a string value"),null):c.ensureString(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new u({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};return e.__decorate([o.property({type:t,json:{type:[Number],write:!0}})],d.prototype,"color",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"field",void 0),e.__decorate([s.cast("field")],d.prototype,"castField",null),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"label",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"valueExpression",void 0),e.__decorate([o.property({type:String,json:{write:!0}})],d.prototype,"valueExpressionTitle",void 0),d=u=e.__decorate([l.subclass("esri.renderers.support.AttributeColorInfo")],d),d})},"esri/renderers/support/DotDensityLegendOptions":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";var a;let l=a=class extends t.JSONSupport{constructor(){super(...arguments),this.unit=null}clone(){return new a({unit:this.unit})}};return e.__decorate([r.property({type:String,json:{write:!0}})],l.prototype,"unit",void 0),l=a=e.__decorate([n.subclass("esri.renderers.support.DotDensityLegendOptions")],l),l})},"esri/renderers/HeatmapRenderer":function(){define(["exports","../chunks/tslib.es6","../Color","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","./Renderer","./support/AuthoringInfo","./support/HeatmapColorStop","./support/HeatmapLegendOptions","./support/heatmapUtils","../symbols/SimpleMarkerSymbol"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y){"use strict";var g;function b(e){if(null!=e){const{maxDensity:t,minDensity:r,radius:i}=e;if(null!=t||null!=r||null!=i){const{blurRadius:t,maxPixelIntensity:r,minPixelIntensity:i,...o}=e;return o}}return e}return e.default=g=class extends d{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new h({ratio:0,color:new r("rgba(255, 140, 0, 0)")}),new h({ratio:.75,color:new r("rgba(255, 140, 0, 1)")}),new h({ratio:.9,color:new r("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(e){return b(e)}get blurRadius(){return m.kernelDensityRadiusPtToGaussianBlurRadiusPx(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",m.gaussianBlurRadiusPxToKernelDensityRadiusPt(e)),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(m.magicKernelDensityRadiusInflationFactor**2*this.blurRadius**4)}read(e,t){e=b(e),super.read(e,t)}getSymbol(){return new y}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,i=this.valueExpression;r&&"string"==typeof r&&u.collectField(e,t,r),i&&"string"==typeof i&&await u.collectArcadeFieldNames(e,t,i)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new g({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:i.clone(this.colorStops),field:this.field,legendOptions:i.clone(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}},t.__decorate([s.property({type:p,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],e.default.prototype,"authoringInfo",void 0),t.__decorate([s.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],e.default.prototype,"blurRadius",null),t.__decorate([s.property({type:[h],json:{write:{isRequired:!0}}})],e.default.prototype,"colorStops",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"field",void 0),t.__decorate([s.property({type:f.HeatmapLegendOptions,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"maxDensity",void 0),t.__decorate([s.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],e.default.prototype,"maxPixelIntensity",null),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"minDensity",void 0),t.__decorate([s.property({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],e.default.prototype,"minPixelIntensity",null),t.__decorate([s.property({type:Number,cast:o.toPt,json:{write:!0}})],e.default.prototype,"radius",void 0),t.__decorate([s.property({type:Number,range:{min:0},json:{default:0,write:!0}})],e.default.prototype,"referenceScale",void 0),t.__decorate([l.enumeration({heatmap:"heatmap"})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],e.default.prototype,"valueExpression",void 0),t.__decorate([s.property({type:String})],e.default.prototype,"valueExpressionTitle",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"_pixelIntensityToDensity",null),e.default=g=t.__decorate([c.subclass("esri.renderers.HeatmapRenderer")],e.default),e.default})},"esri/renderers/support/HeatmapColorStop":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends i.JSONSupport{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new c({color:this.color&&this.color.clone(),ratio:this.ratio})}},t.__decorate([o.property({type:r,json:{type:[s.Integer],default:null,write:{isRequired:!0}}})],e.default.prototype,"color",void 0),t.__decorate([o.property({type:Number,json:{write:{isRequired:!0}}})],e.default.prototype,"ratio",void 0),e.default=c=t.__decorate([l.subclass("esri.renderers.support.HeatmapColorStop")],e.default),e.default})},"esri/renderers/support/HeatmapLegendOptions":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l){"use strict";e.HeatmapLegendOptions=class extends(r.ClonableMixin(i.JSONSupport)){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}},t.__decorate([o.property({type:String,json:{write:!0}})],e.HeatmapLegendOptions.prototype,"minLabel",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.HeatmapLegendOptions.prototype,"maxLabel",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.HeatmapLegendOptions.prototype,"title",void 0),e.HeatmapLegendOptions=t.__decorate([l.subclass("esri.renderers.support.HeatmapLegendOptions")],e.HeatmapLegendOptions),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/PieChartRenderer":function(){define(["exports","../chunks/tslib.es6","../Color","../core/arrayUtils","../core/Clonable","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../layers/support/fieldUtils","./Renderer","./mixins/VisualVariablesMixin","./support/AttributeColorInfo","./support/commonProperties","./support/OthersCategory","./support/RendererLegendOptions","./visualVariables/OpacityVariable","./visualVariables/SizeVariable","./visualVariables/VisualVariable","../symbols/SimpleLineSymbol","../symbols/SimpleMarkerSymbol"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x){"use strict";const w={base:v,key:"type",typeMap:{size:_,opacity:b}};return e.default=class extends(h.VisualVariablesMixin(o.ClonableMixin(p))){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new r([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new y.OthersCategory,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new x({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(i.isSome)}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return this.symbols.reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await d.collectArcadeFieldNames(e,t,r.valueExpression),r.field&&e.add(r.field)}},t.__decorate([n.property({type:[f],json:{write:!0}})],e.default.prototype,"attributes",void 0),t.__decorate([n.property(m.rendererBackgroundFillSymbolProperty)],e.default.prototype,"backgroundFillSymbol",void 0),t.__decorate([n.property({type:r,json:{write:!0}})],e.default.prototype,"defaultColor",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"defaultLabel",void 0),t.__decorate([n.property({type:Number,range:{min:0,max:1},json:{write:!0}})],e.default.prototype,"holePercentage",void 0),t.__decorate([n.property({type:y.OthersCategory,json:{write:!0}})],e.default.prototype,"othersCategory",void 0),t.__decorate([n.property({type:g,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([n.property({type:S,json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([n.property({type:Number,cast:s.toPt,json:{write:!0}})],e.default.prototype,"size",void 0),t.__decorate([c.enumeration({pieChart:"pie-chart"})],e.default.prototype,"type",void 0),t.__decorate([n.property({types:[w]})],e.default.prototype,"visualVariables",void 0),e.default=t.__decorate([u.subclass("esri.renderers.PieChartRenderer")],e.default),e.default})},"esri/renderers/support/OthersCategory":function(){define(["exports","../../chunks/tslib.es6","../../Color","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l,c){"use strict";e.OthersCategory=class extends(i.ClonableMixin(o.JSONSupport)){constructor(){super(...arguments),this.color=new r([0,0,0,0]),this.label=null,this.threshold=0}},t.__decorate([s.property({type:r,json:{write:!0}})],e.OthersCategory.prototype,"color",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.OthersCategory.prototype,"label",void 0),t.__decorate([s.property({type:Number,range:{min:0,max:1},json:{write:!0}})],e.OthersCategory.prototype,"threshold",void 0),e.OthersCategory=t.__decorate([c.subclass("esri.renderers.support.OthersCategory")],e.OthersCategory),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/SimpleRenderer":function(){define(["exports","../chunks/tslib.es6","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Renderer","./mixins/VisualVariablesMixin","./support/commonProperties"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";var d;return e.default=d=class extends(c.VisualVariablesMixin(l)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.type="simple"}async collectRequiredFields(e,t){await Promise.all([this.collectSymbolFields(e,t),this.collectVVRequiredFields(e,t)])}async collectSymbolFields(e,t){await Promise.all(this.symbols.map(r=>r.collectRequiredFields(e,t)))}getSymbol(e,t){return this.symbol}async getSymbolAsync(e,t){return this.symbol}get symbols(){return this.symbol?[this.symbol]:[]}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return this.symbols.reduce((e,t)=>e+JSON.stringify(t),"")}get arcadeRequired(){return this.arcadeRequiredForVisualVariables}clone(){return new d({description:this.description,label:this.label,symbol:r.clone(this.symbol),visualVariables:r.clone(this.visualVariables),authoringInfo:r.clone(this.authoringInfo)})}},t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"description",void 0),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([i.property(u.requiredRendererSymbolProperty)],e.default.prototype,"symbol",void 0),t.__decorate([n.enumeration({simple:"simple"})],e.default.prototype,"type",void 0),e.default=d=t.__decorate([a.subclass("esri.renderers.SimpleRenderer")],e.default),e.default})},"esri/renderers/UniqueValueRenderer":function(){define(["exports","../chunks/tslib.es6","../core/Error","../core/lang","../core/Logger","../core/object","../core/reactiveUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","../core/accessorSupport/diffUtils","../core/accessorSupport/ensureType","../layers/support/fieldUtils","../portal/Portal","./Renderer","./mixins/VisualVariablesMixin","./support/commonProperties","./support/RendererLegendOptions","./support/UniqueValue","./support/UniqueValueClass","./support/UniqueValueGroup","./support/UniqueValueInfo","../support/loadArcade","../chunks/persistableUrlUtils","../symbols/WebStyleSymbol","../symbols/support/styleUtils","../symbols/support/typeUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M,T,P,I,C,O){"use strict";var F;const A="uvInfos-watcher",R="uvGroups-watcher",D=f.ensureType(M);function E(e){return null!=e&&""!==e&&("string"!=typeof e||""!==e.trim()&&"<null>"!==e.toLowerCase())||(e=null),e+""}return e.default=F=class extends(b.VisualVariablesMixin(g)){constructor(e){super(e),this._valueInfoMap={},this._isDefaultSymbolDerived=!1,this._isInfosSource=null,this.type="unique-value",this.backgroundFillSymbol=null,this.orderByClassesEnabled=!1,this.valueExpressionTitle=null,this.legendOptions=null,this.defaultLabel=null,this.portal=null,this.styleOrigin=null,this.diff={uniqueValueInfos(e,t){if(!e&&!t)return;if(!e||!t)return{type:"complete",oldValue:e,newValue:t};let r=!1;const i={type:"collection",added:[],removed:[],changed:[],unchanged:[]};for(let o=0;o<t.length;o++){const s=e.find(e=>e.value===t[o].value);s?h.diff(s,t[o])?(i.changed.push({type:"complete",oldValue:s,newValue:t[o]}),r=!0):i.unchanged.push({oldValue:s,newValue:t[o]}):(i.added.push(t[o]),r=!0)}for(let o=0;o<e.length;o++)t.find(t=>t.value===e[o].value)||(i.removed.push(e[o]),r=!0);return r?i:void 0}},this._set("uniqueValueInfos",[]),this._set("uniqueValueGroups",[])}get _cache(){return{compiledFunc:null}}set field(e){this._set("field",e),this._updateFieldDelimiter(),this._updateUniqueValues()}castField(e){return null==e||"function"==typeof e?e:f.ensureString(e)}writeField(e,t,i,s){"string"==typeof e?t[i]=e:s?.messages?s.messages.push(new r("property:unsupported","UniqueValueRenderer.field set to a function cannot be written to JSON")):o.getLogger(this).error(".field: cannot write field to JSON since it's not a string value")}set field2(e){this._set("field2",e),this._updateFieldDelimiter(),this._updateUniqueValues()}set field3(e){this._set("field3",e),this._updateUniqueValues()}set valueExpression(e){this._set("valueExpression",e),this._updateUniqueValues()}set defaultSymbol(e){this._isDefaultSymbolDerived=!1,this._set("defaultSymbol",e)}set fieldDelimiter(e){this._set("fieldDelimiter",e),this._updateUniqueValues()}readPortal(e,t,r){return r.portal||y.getDefault()}readStyleOrigin(e,t,r){if(t.styleName)return Object.freeze({styleName:t.styleName});if(t.styleUrl){const e=P.fromJSON(t.styleUrl,r);return Object.freeze({styleUrl:e})}}writeStyleOrigin(e,t,r,i){e.styleName?t.styleName=e.styleName:e.styleUrl&&(t.styleUrl=P.toJSON(e.styleUrl,i))}set uniqueValueGroups(e){this.styleOrigin?o.getLogger(this).error("#uniqueValueGroups=","Cannot modify unique value groups of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueGroups",e),this._updateInfosFromGroups(),this._isInfosSource=!1,this._watchUniqueValueGroups())}set uniqueValueInfos(e){this.styleOrigin?o.getLogger(this).error("#uniqueValueInfos=","Cannot modify unique value infos of a UniqueValueRenderer created from a web style"):(this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos())}addUniqueValueInfo(e,t){if(this.styleOrigin)return void o.getLogger(this).error("#addUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");let r;r="object"==typeof e?D(e):new M({value:e,symbol:O.ensureType(t)}),this.uniqueValueInfos?.push(r),this._valueInfoMap[E(r.value)]=r,this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}removeUniqueValueInfo(e){if(this.styleOrigin)return void o.getLogger(this).error("#removeUniqueValueInfo()","Cannot modify unique value infos of a UniqueValueRenderer created from a web style");const t=this.uniqueValueInfos;if(t)for(let r=0;r<t.length;r++){const i=t[r];if(String(i.value)===String(e)){delete this._valueInfoMap[E(e)],t.splice(r,1);break}}this._updateGroupsFromInfos(),this._isInfosSource=!0,this._watchUniqueValueInfos()}async getUniqueValueInfo(e,t){let r=t;return this.valueExpression&&null==t?.arcade&&(r={...r,arcade:await T.loadArcade()}),this._getUniqueValueInfo(e,r)}getSymbol(e,t){if(this.valueExpression&&null==t?.arcade)return void o.getLogger(this).error("#getSymbol()","Please use getSymbolAsync if valueExpression is used");const r=this._getUniqueValueInfo(e,t);return r?.symbol||this.defaultSymbol}async getSymbolAsync(e,t){let r=t;if(this.valueExpression&&null==r?.arcade){const e=await T.loadArcade(),{arcadeUtils:t}=e;t.hasGeometryOperations(this.valueExpression)&&await t.enableGeometryOperations(),r={...r,arcade:e}}const i=this._getUniqueValueInfo(e,r);return i?.symbol||this.defaultSymbol}get symbols(){const e=[];for(const t of this.uniqueValueInfos??[])t.symbol&&e.push(t.symbol);return this.defaultSymbol&&e.push(this.defaultSymbol),e}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){const e=JSON.stringify(this.backgroundFillSymbol),t=JSON.stringify(this.defaultSymbol),r=this.uniqueValueInfos?.reduce((e,t)=>e+t.getMeshHash(),"");return`${e}.${t}.${r}.${this.field}.${this.field2}.${this.field3}.${this.fieldDelimiter}.${this.valueExpression}`}clone(){const e=new F({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:i.clone(this.defaultSymbol),orderByClassesEnabled:this.orderByClassesEnabled,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,fieldDelimiter:this.fieldDelimiter,visualVariables:i.clone(this.visualVariables),legendOptions:i.clone(this.legendOptions),authoringInfo:i.clone(this.authoringInfo),backgroundFillSymbol:i.clone(this.backgroundFillSymbol)});this._isDefaultSymbolDerived&&(e._isDefaultSymbolDerived=!0),e._set("portal",this.portal);const t=i.clone(this.uniqueValueInfos),r=i.clone(this.uniqueValueGroups);return this.styleOrigin&&(e._set("styleOrigin",Object.freeze(i.clone(this.styleOrigin))),Object.freeze(t),Object.freeze(r)),e._set("uniqueValueInfos",t),e._updateValueInfoMap(),e._set("uniqueValueGroups",r),e._isInfosSource=this._isInfosSource,e._watchUniqueValueInfosAndGroups(),e}get arcadeRequired(){return this.arcadeRequiredForVisualVariables||!!this.valueExpression}async collectRequiredFields(e,t){const r=[this.collectVVRequiredFields(e,t),this.collectSymbolFields(e,t)];await Promise.all(r)}async collectSymbolFields(e,t){const r=[...this.symbols.map(r=>r.collectRequiredFields(e,t)),m.collectArcadeFieldNames(e,t,this.valueExpression)];m.collectField(e,t,this.field),m.collectField(e,t,this.field2),m.collectField(e,t,this.field3),await Promise.all(r)}populateFromStyle(){return C.fetchStyle(this.styleOrigin,{portal:this.portal}).then(e=>{const t=[];return this._valueInfoMap={},e?.data&&Array.isArray(e.data.items)&&e.data.items.forEach(r=>{const i=new I({styleUrl:e.styleUrl,styleName:e.styleName,portal:this.portal,name:r.name});this.defaultSymbol||r.name!==e.data.defaultItem||(this.defaultSymbol=i,this._isDefaultSymbolDerived=!0);const o=new M({value:r.name,symbol:i});t.push(o),this._valueInfoMap[E(r.name)]=o}),this._set("uniqueValueInfos",Object.freeze(t)),this._updateGroupsFromInfos(!0),this._isInfosSource=null,this._watchUniqueValueInfos(),!this.defaultSymbol&&this.uniqueValueInfos?.length&&(this.defaultSymbol=this.uniqueValueInfos[0].symbol,this._isDefaultSymbolDerived=!0),this})}_updateFieldDelimiter(){this.field&&this.field2&&!this.fieldDelimiter&&this._set("fieldDelimiter",",")}_updateUniqueValues(){null!=this._isInfosSource&&(this._isInfosSource?this._updateGroupsFromInfos():this._updateInfosFromGroups())}_updateValueInfoMap(){this._valueInfoMap={};const{uniqueValueInfos:e}=this;if(e)for(const t of e)this._valueInfoMap[E(t.value)]=t}_watchUniqueValueInfosAndGroups(){this._watchUniqueValueInfos(),this._watchUniqueValueGroups()}_watchUniqueValueInfos(){this.removeHandles(A);const{uniqueValueInfos:e}=this;if(e){const t=[];for(const r of e)t.push(n.watch(()=>({symbol:r.symbol,value:r.value,label:r.label,description:r.description}),(e,t)=>{e!==t&&(this._updateGroupsFromInfos(),this._isInfosSource=!0)},{sync:!0}));this.addHandles(t,A)}}_watchUniqueValueGroups(){this.removeHandles(R);const{uniqueValueGroups:e}=this;if(e){const t=[];for(const r of e){t.push(n.watch(()=>({classes:r.classes}),(e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}));for(const e of r.classes??[])t.push(n.watch(()=>({symbol:e.symbol,values:e.values,label:e.label,description:e.description}),(e,t)=>{e!==t&&(this._updateInfosFromGroups(),this._isInfosSource=!1)},{sync:!0}))}this.addHandles(t,R)}}_updateInfosFromGroups(){if(!this.uniqueValueGroups)return this._set("uniqueValueInfos",null),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const e=[],{field:t,field2:r,field3:i,fieldDelimiter:o,uniqueValueGroups:s,valueExpression:n}=this;if(!t&&!n)return this._set("uniqueValueInfos",e),this._updateValueInfoMap(),void this._watchUniqueValueInfos();const a=!(!t||!r);for(const t of s)for(const s of t.classes??[]){const{symbol:t,label:n,values:l,description:c}=s;for(const s of l??[]){const{value:l,value2:u,value3:d}=s,p=[l];r&&p.push(u),i&&p.push(d);const h=a?p.join(o||""):p[0]??void 0;e.push(new M({symbol:t,label:n,value:h,description:c}))}}this._set("uniqueValueInfos",e),this._updateValueInfoMap(),this._watchUniqueValueInfos()}_updateGroupsFromInfos(e=!1){if(!this.uniqueValueInfos)return this._set("uniqueValueGroups",null),void this._watchUniqueValueGroups();const{field:t,field2:r,valueExpression:i,fieldDelimiter:o,uniqueValueInfos:s}=this;if(!t&&!i||!s.length)return this._set("uniqueValueGroups",[]),void this._watchUniqueValueGroups();const n=!(!t||!r),a=s.map(e=>{const{symbol:t,label:r,value:i,description:s}=e,[a,l,c]=n?i?.toString()?.split(o||"")||[]:[i];return new x({symbol:t,label:r,description:s,values:[new S({value:a,value2:l,value3:c})]})}),l=[new w({classes:a})];e&&Object.freeze(l),this._set("uniqueValueGroups",l),this._watchUniqueValueGroups()}_getUniqueValueInfo(e,t){return this.valueExpression?this._getUnqiueValueInfoForExpression(e,t):this._getUnqiueValueInfoForFields(e)}_getUnqiueValueInfoForExpression(e,t){const{viewingMode:r,scale:i,spatialReference:o,arcade:s,timeZone:n}=t??{};let a=this._cache.compiledFunc;const l=s.arcadeUtils;if(!a){const e=l.createSyntaxTree(this.valueExpression);a=l.createFunction(e),this._cache.compiledFunc=a}const c=l.executeFunction(a,l.createExecContext(e,l.getViewInfo({viewingMode:r,scale:i,spatialReference:o}),n));return this._valueInfoMap[E(c)]}_getUnqiueValueInfoForFields(e){const t=this.field,r=e.attributes;let i;if(this.field2){const e=this.field2,o=this.field3,s=[];t&&s.push(r[t]),e&&s.push(r[e]),o&&s.push(r[o]),i=s.join(this.fieldDelimiter||"")}else t&&(i=r[t]);return this._valueInfoMap[E(i)]}static fromPortalStyle(e,t){const r=new F(t?.properties);r._set("styleOrigin",Object.freeze({styleName:e})),r._set("portal",t?.portal||y.getDefault());const i=r.populateFromStyle();return i.catch(t=>{o.getLogger(this.prototype).error(`#fromPortalStyle('${e}'[, ...])`,"Failed to create unique value renderer from style name",t)}),i}static fromStyleUrl(e,t){const r=new F(t?.properties);r._set("styleOrigin",Object.freeze({styleUrl:e}));const i=r.populateFromStyle();return i.catch(t=>{o.getLogger(this.prototype).error(`#fromStyleUrl('${e}'[, ...])`,"Failed to create unique value renderer from style URL",t)}),i}},t.__decorate([a.property({readOnly:!0})],e.default.prototype,"_cache",null),t.__decorate([c.enumeration({uniqueValue:"unique-value"})],e.default.prototype,"type",void 0),t.__decorate([a.property(_.rendererBackgroundFillSymbolProperty)],e.default.prototype,"backgroundFillSymbol",void 0),t.__decorate([a.property({value:null,json:{type:String,read:{source:"field1"},write:{target:"field1"}}})],e.default.prototype,"field",null),t.__decorate([l.cast("field")],e.default.prototype,"castField",null),t.__decorate([p.writer("field")],e.default.prototype,"writeField",null),t.__decorate([a.property({type:String,value:null,json:{write:!0}})],e.default.prototype,"field2",null),t.__decorate([a.property({type:String,value:null,json:{write:!0}})],e.default.prototype,"field3",null),t.__decorate([a.property({type:Boolean,json:{name:"drawInClassOrder",default:!1,write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"orderByClassesEnabled",void 0),t.__decorate([a.property({type:String,value:null,json:{write:!0}})],e.default.prototype,"valueExpression",null),t.__decorate([a.property({type:String,json:{write:!0}})],e.default.prototype,"valueExpressionTitle",void 0),t.__decorate([a.property({type:v,json:{write:!0}})],e.default.prototype,"legendOptions",void 0),t.__decorate([a.property({type:String,json:{write:!0}})],e.default.prototype,"defaultLabel",void 0),t.__decorate([a.property(s.deepMerge({..._.rendererSymbolProperty},{json:{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}},origins:{"web-scene":{write:{overridePolicy(){return{enabled:!this._isDefaultSymbolDerived}}}}}}}))],e.default.prototype,"defaultSymbol",null),t.__decorate([a.property({type:String,value:null,json:{write:!0}})],e.default.prototype,"fieldDelimiter",null),t.__decorate([a.property({type:y,readOnly:!0})],e.default.prototype,"portal",void 0),t.__decorate([u.reader("portal",["styleName"])],e.default.prototype,"readPortal",null),t.__decorate([a.property({readOnly:!0,json:{write:{enabled:!1,overridePolicy:()=>({enabled:!0})}}})],e.default.prototype,"styleOrigin",void 0),t.__decorate([u.reader("styleOrigin",["styleName","styleUrl"])],e.default.prototype,"readStyleOrigin",null),t.__decorate([p.writer("styleOrigin",{styleName:{type:String},styleUrl:{type:String}})],e.default.prototype,"writeStyleOrigin",null),t.__decorate([a.property({type:[w],json:{read:{source:["uniqueValueGroups","uniqueValueInfos"],reader:(e,t,r)=>{const i=t.uniqueValueGroups||function(e){const{field1:t,field2:r,field3:i,fieldDelimiter:o,uniqueValueInfos:s,valueExpression:n}=e,a=!(!t||!r);return[{classes:(s??[]).map(e=>{const{symbol:s,label:l,value:c,description:u}=e,[d,p,h]=a?c?.toString()?.split(o||"")||[]:[c],f=[];return(t||n)&&f.push(d),r&&f.push(p),i&&f.push(h),{symbol:s,label:l,values:[f],description:u}})}]}(t);return i.map(e=>w.fromJSON(e,r))}},write:{overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0}}}}})],e.default.prototype,"uniqueValueGroups",null),t.__decorate([a.property({type:[M],json:{read:!1,write:{isRequired:!0,overridePolicy(){return this.styleOrigin?{enabled:!1}:{enabled:!0,isRequired:!0}}}}})],e.default.prototype,"uniqueValueInfos",null),e.default=F=t.__decorate([d.subclass("esri.renderers.UniqueValueRenderer")],e.default),e.default})},"esri/core/accessorSupport/diffUtils":function(){define(["exports","../Accessor","../Collection","./utils"],function(e,t,r,i){"use strict";const o=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function s(e){return e instanceof t}function n(e){return e instanceof r?Object.keys(e.items):s(e)?i.getProperties(e).keys():e?Object.keys(e):[]}function a(e,t){return e instanceof r?e.items[t]:e[t]}function l(e){return e?e.declaredClass:null}function c(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const i=n(e),u=n(t);if(0===i.length&&0===u.length)return;if(!i.length||!u.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const d=u.filter(e=>!i.includes(e)),p=i.filter(e=>!u.includes(e)),h=i.filter(r=>u.includes(r)&&a(e,r)!==a(t,r)).concat(d,p).sort(),f=l(e);if(f&&o.has(f)&&h.length)return{type:"complete",oldValue:e,newValue:t};let m;const y=s(e)&&s(t);for(const i of h){const o=a(e,i),s=a(t,i);let n;if((y||"function"!=typeof o&&"function"!=typeof s)&&o!==s&&(null!=o||null!=s)){if(r&&r[i]&&"function"==typeof r[i])n=r[i]?.(o,s);else if(o instanceof Date&&s instanceof Date){if(o.getTime()===s.getTime())continue;n={type:"complete",oldValue:o,newValue:s}}else n="object"==typeof o&&"object"==typeof s&&l(o)===l(s)?c(o,s):{type:"complete",oldValue:o,newValue:s};null!=n&&(null!=m?m.diff[i]=n:m={type:"partial",diff:{[i]:n}})}}return m}function u(e,t){if(null==e)return!1;const r=t.split(".");let i=e;for(const e of r){if("complete"===i.type)return!0;if("partial"!==i.type)return!1;{const t=i.diff[e];if(!t)return!1;i=t}}return!0}e.diff=function(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&l(e)!==l(t)?{type:"complete",oldValue:e,newValue:t}:c(e,t)},e.hasDiff=u,e.hasRootDiff=function(e,t){return u(e,t)},e.hasRootDiffOnly=function(e,t){if(!e)return!1;if("partial"===e.type){const r=Object.keys(e.diff);return 1===r.length&&r[0]===t}return!1},e.isEmpty=function e(t){if(null==t)return!0;switch(t.type){case"complete":return!1;case"collection":{const r=t;for(const t of r.added)if(!e(t))return!1;for(const t of r.removed)if(!e(t))return!1;for(const t of r.changed)if(!e(t))return!1;return!0}case"partial":for(const r in t.diff)if(!e(t.diff[r]))return!1;return!0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/UniqueValue":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./commonProperties"],function(e,t,r,i,o,s,n,a,l,c){"use strict";return e.default=class extends(r.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.value=null,this.value2=null,this.value3=null}},t.__decorate([o.property(c.uniqueValueProperty)],e.default.prototype,"value",void 0),t.__decorate([o.property(c.uniqueValueProperty)],e.default.prototype,"value2",void 0),t.__decorate([o.property(c.uniqueValueProperty)],e.default.prototype,"value3",void 0),e.default=t.__decorate([l.subclass("esri.renderers.support.UniqueValue")],e.default),e.default})},"esri/renderers/support/UniqueValueClass":function(){define(["exports","../../chunks/tslib.es6","../../core/arrayUtils","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/cast","../../core/has","../../core/accessorSupport/decorators/subclass","./commonProperties","./UniqueValue"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";return e.default=class extends(i.ClonableMixin(o.JSONSupport)){constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.values=null}castValues(e){if(null==e)return null;const t=typeof(e=Array.isArray(e)?e:[e])[0];return"string"===t||"number"===t?e.map(e=>new u({value:e})):"object"===t?e[0]instanceof u?e:e.map(e=>new u(e)):null}},t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"description",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([s.property(c.rendererSymbolProperty)],e.default.prototype,"symbol",void 0),t.__decorate([s.property({type:[u],json:{type:[[String]],read:{reader:e=>e?e.map(e=>new u({value:e[0],value2:e[1],value3:e[2]})):null},write:{writer:(e,t)=>{const i=[];for(const t of e){const e=[t.value,t.value2,t.value3].filter(r.isSome).map(e=>e.toString());i.push(e)}t.values=i}}}})],e.default.prototype,"values",void 0),t.__decorate([n.cast("values")],e.default.prototype,"castValues",null),e.default=t.__decorate([l.subclass("esri.renderers.support.UniqueValueClass")],e.default),e.default})},"esri/renderers/support/UniqueValueGroup":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./UniqueValueClass"],function(e,t,r,i,o,s,n,a,l,c){"use strict";return e.default=class extends(r.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.heading=null,this.classes=null}},t.__decorate([o.property({type:String,json:{write:!0}})],e.default.prototype,"heading",void 0),t.__decorate([o.property({type:[c],json:{write:{isRequired:!0}}})],e.default.prototype,"classes",void 0),e.default=t.__decorate([l.subclass("esri.renderers.support.UniqueValueGroup")],e.default),e.default})},"esri/renderers/support/UniqueValueInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./commonProperties"],function(e,t,r,i,o,s,n,a,l){"use strict";var c;return e.default=c=class extends r.JSONSupport{constructor(e){super(e),this.description=null,this.label=null,this.symbol=null,this.value=null}clone(){return new c({value:this.value,description:this.description,label:this.label,symbol:this.symbol?this.symbol.clone():null})}getMeshHash(){const e=JSON.stringify(this.symbol?.toJSON());return`${this.value}.${e}`}},t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"description",void 0),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"label",void 0),t.__decorate([i.property(l.requiredRendererSymbolProperty)],e.default.prototype,"symbol",void 0),t.__decorate([i.property(l.uniqueValueProperty)],e.default.prototype,"value",void 0),e.default=c=t.__decorate([a.subclass("esri.renderers.support.UniqueValueInfo")],e.default),e.default})},"esri/symbols/support/styleUtils":function(){define(["exports","../../request","../../core/Error","../../core/has","../../core/promiseUtils","../../core/urlUtils","../../portal/Portal","../../portal/PortalQueryParams","./styleCache"],function(e,t,r,i,o,s,n,a,l){"use strict";function c(e,t){if(!i("enable-feature:force-wosr"))return e.formatInfos?.find(e=>e.type===t)?.href}function u(e,r){const i={responseType:"json",query:{f:"json"},...r};return t(s.normalize(e),i)}const d="esri_en",p="Style";e.Style2DUrlTemplate="https://cdn.arcgis.com/sharing/rest/content/items/220936cc6ed342c9937abd8f180e7d1e/resources/styles/cim/{SymbolName}.json?f=json",e.fetchStyle=function(e,t,i){return null!=e?.styleUrl?async function(e,t){try{return{data:(await u(e,t)).data,baseUrl:s.removeFile(e),styleUrl:e}}catch(e){return o.throwIfAbortError(e),null}}(e.styleUrl,i):null!=e?.styleName?function(e,t,i){const o=null!=t.portal?t.portal:n.getDefault();let s;const c=`${o.url} - ${o.user?.username} - ${e}`,u=l.cachedStyles.get(c);if(u)return u;const h=function(e,t,i){return t.load(i).then(()=>{const r=new a({disableExtraQuery:!0,query:`owner:${d} AND type:${p} AND typekeywords:"${e}"`});return t.queryItems(r,i)}).then(({results:t})=>{let o=null;const s=e.toLowerCase();if(t&&Array.isArray(t))for(const e of t){const t=e.typeKeywords?.some(e=>e.toLowerCase()===s);if(t&&e.type===p&&e.owner===d){o=e;break}}if(!o)throw new r("symbolstyleutils:style-not-found",`The style '${e}' could not be found`,{styleName:e});return o.load(i)})}(e,o,i).then(e=>(s=e,e.fetchData())).then(t=>({data:t,baseUrl:s.itemUrl??"",styleName:e}));return l.cachedStyles.set(c,h),h}(e.styleName,t,i):Promise.reject(new r("symbolstyleutils:style-url-and-name-missing","Either styleUrl or styleName is required to resolve a style"))},e.makeCIMSymbolRef=function(e){return null===e||"CIMSymbolReference"===e.type?e:{type:"CIMSymbolReference",symbol:e}},e.requestJSON=u,e.symbolUrlFromStyleItem=function(e,t){for(const r of t)switch(r){case"cim":if(e.cimRef)return{format:r,url:encodeURI(e.cimRef)};break;case"web-gltf-basisu":{const t=c(e,"gltf_basisu");if(t)return{format:r,url:t};break}case"web-gltf":{const t=c(e,"gltf");if(t)return{format:r,url:t};break}case"web":{const t=c(e,"gltf");if(t)return{format:"web-gltf",url:t};if(e.webRef)return{format:r,url:encodeURI(e.webRef)};break}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/styleCache":function(){define(["exports"],function(e){"use strict";const t=new Map;e.cachedStyles=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/PipelineCommand":function(){define(["exports"],function(e){"use strict";class t{constructor(e,t,r){this.renderCommandContext=e,this.renderCommandBuffer=t,this.pipelineStateCommands=r}append(e){this.appendRenderCommands(e.renderCommandBuffer),this.appendPipelineStateCommands(e.pipelineStateCommands)}appendRenderCommands(e){this.renderCommandBuffer.commands.push(...e.commands),this.renderCommandBuffer.transferList.push(...e.transferList)}appendPipelineStateCommand(e){this.pipelineStateCommands.push(e)}appendPipelineStateCommands(e){for(const t of e)this.appendPipelineStateCommand(t)}async execute(){for(const e of this.pipelineStateCommands)e();await this.renderCommandContext.dispatchRenderCommands(this.renderCommandBuffer)}static create(e,r=[]){return new t(e,e.createRenderCommandBuffer(),r)}}e.PipelineCommand=t,e.joinCommands=function(e){return 0===e.length?null:e.reduce((e,t)=>(e.append(t),e))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/symbolization/factoryUtils":function(){define(["exports","../../../../../../Color","../../../../../../symbols/IconSymbol3DLayer","../../../../../../symbols/ObjectSymbol3DLayer","../../../../../../symbols/support/Symbol3DMaterial"],function(e,t,r,i,o){"use strict";e.createDefaultIconSymbolLayer=function(){return new r({material:new o.Symbol3DMaterial({color:new t("red")})})},e.createDefaultObjectSymbolLayer=function(){return new i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/symbolization/IconSymbolLayerRenderer":function(){define(["exports","../../../../../../Color","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../../../symbols/support/IconSymbol3DLayerResource","../../graphicUtils","../../placementUtils","../PipelineCommand","../featureData/processingUtils","./symbolizationUtils","../../../../support/engineContent/sdfPrimitives","../../../../webgl-engine/lib/Attribute"],function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";function h(e){return null!=e&&("cross"===e||"x"===e)}function f(e){return e.resource?.href?null:e.resource?.primitive??s.defaultPrimitive}const m={hasIntrinsicColor:!1},y=o.ZEROS;e.IconSymbolLayerRenderer=class{constructor(e,t){this._context=null,this._symbolLayer=null,this._draped=!1,this._loaded=!1,this._loadingPromise=null,this._iconTextureID=null,this._materialId=null,this._context=t,this._symbolLayer=e}get loaded(){return this._loaded}load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}_destroy(){this._iconTextureID=null}async _load(){const e=this._context.renderCommandContext,t=await e.createTexture(()=>d.createTextureInfo("circle"));this._iconTextureID=t;const r={anchorPosition:a.namedAnchorToHUDMaterialAnchorPos.center,occlusionTest:!0,hasSlicePlane:!1,color:this._getFillColor(),outlineColor:this._getOutlineColor(),outlineSize:1,distanceFieldBoundingBox:d.defaultBoundingBox,textureId:t,textureIsSignedDistanceField:!0,sampleSignedDistanceFieldTexelCenter:d.requiresHalfTexelOffset("circle")};this._materialId=await e.createMaterial({type:"hud",parameters:r}),await e.createDirectRenderer(this._materialId),this._loaded=!0}async createAddCommand(e){const{_materialId:t,_context:r}=this,{renderCommandContext:i}=r;if(null==t)throw new Error("expected material not to be null");const o=await this._createGeometry(e);if(null==o)return r.createPipelineCommand();const s=c.computeTileCenterRenderCoordinates(e,r);return r.createPipelineCommand(i.addDirectRendererGeometry(e.id,o,s))}async _createGeometry(e){const{_materialId:t,_context:i}=this,{mainThreadDelegate:o}=i,{featureCount:s}=e;if(0===s||null==t)return null;const n=c.readObjectIds(e),a=c.readMapCoordinates(e),l=await o.applyElevationAlignmentTo(a),d=c.projectToRenderCoordinates(l,i),h=new Float64Array([0,0,1]),f=new Float64Array([255,255,255,255]),m=new Float64Array([24,24]),y=new Float64Array([0,0,0,1]),g=new Float64Array([0,0]),b=new Float64Array([0]),_=new Uint32Array(s);for(let e=0;e<s;++e)_[e]=e;const v=new Uint32Array(s);for(let e=0;e<s;++e)v[e]=0;const S=[["position",new p.Attribute(d,_,3,!0)],["normal",new p.Attribute(h,v,3,!0)],["uv0",new p.Attribute(g,v,2,!0)],["color",new p.Attribute(f,v,4,!0)],["rotation",new p.Attribute(b,v,1,!0)],["size",new p.Attribute(m,v,2,!0)],["centerOffsetAndDistance",new p.Attribute(y,v,4,!0)]],x=new Uint8Array(s);return e.getVisibilityArray(x),{attributes:u.inputAttributesToAttributesMap(S),olidColor:void 0,transformation:r.create(),materialId:t,objectIds:n,visibilities:x}}async createRemoveCommand(e){const{_materialId:t,_context:r}=this,i=r.renderCommandContext;return null==t?r.createPipelineCommand():r.createPipelineCommand(i.removeDirectRendererGeometryBuffer(t,e))}async createUpdateVisibilityCommand(e){const{_materialId:t,_context:r}=this,i=r.renderCommandContext;if(null==t)return r.createPipelineCommand();const o=new Uint8Array(e.featureCount);return e.getVisibilityArray(o),r.createPipelineCommand(i.updateVisibility(t,e.id,o))}async createUpdateLayerViewOpacityCommand(e){const{_context:t,_materialId:r}=this,i=t.renderCommandContext;return null==r?t.createPipelineCommand():t.createPipelineCommand(i.updateMaterial({type:"hud",materialId:r,parameters:{color:this._getFillColor(),outlineColor:this._getOutlineColor()}}))}async createUpdateElevationCommand(e){const{_materialId:t,_context:r}=this,{renderCommandContext:i}=r,{featureCount:o,id:s}=e;if(null==t||0===o)return r.createPipelineCommand();const n=await this._createGeometry(e);if(null==n)return r.createPipelineCommand();const a=c.computeTileCenterRenderCoordinates(e,r);return r.createPipelineCommand(i.updateDirectRendererGeometry(s,n,a))}async createDestroyCommand(){const{_iconTextureID:e,_context:t}=this,r=t.renderCommandContext;let i;return i=null!=e?await r.releaseTexture(e):l.PipelineCommand.create(r),i.appendPipelineStateCommand(()=>this._destroy()),i}_getOutlineColor(){const e=this._getLayerOpacity(),r=this._symbolLayer,i=r?.outline?.color;if(null!=i){const r=t.toUnitRGB(i),o=i.a*e;return[r[0],r[1],r[2],o]}return[0,0,0,0]}_getFillColor(){if(h(this._getPrimitive()))return y;const e=null==this._getPrimitive(),t=this._symbolLayer?.material?.color;return this._getCombinedOpacityAndColor(t,{hasIntrinsicColor:e})}_getLayerOpacity(){return this._context.layerViewInfo.fullOpacity}_getCombinedOpacity(e,t=m){const r=this._draped?1:this._getLayerOpacity();return e?r*e.a:t.hasIntrinsicColor?r:0}_getCombinedOpacityAndColor(e,r=m){const o=this._getCombinedOpacity(e,r),s=null!=e?t.toUnitRGB(e):i.ONES;return n.mixinColorAndOpacity(s,o)}_getPrimitive(){return f(this._symbolLayer)}},e.defaultMaterialOptions=m,e.getPrimitive=f,e.isOutlineOnly=h,e.transparentUnit=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["exports"],function(e){"use strict";function t(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]}function i(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){return[e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m]}const o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:i},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=i,e.mat4f64=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define(["exports","../../../../core/unitUtils","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/projectionUtils","../../../../geometry/support/aaBoundingBox","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/centroid","../../../../geometry/support/coordsUtils","../../../../geometry/support/meshVertexSpaceUtils","../../../../layers/graphics/dehydratedPoint","../../../../layers/graphics/hydratedFeatures"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";function m(e){const t=e.paths[0];if(!t||0===t.length)return null;const r=d.getPointOnPath(t,d.getPathLength(t)/2);return h.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}function y(e,t,r){const i=r?e:f.clonePoint(e);return t&&e?a.projectPoint(e,i,t)?i:null:i}function g(e){const t=e=>null==e||e>=0;return Array.isArray(e)?e.every(t):t(e)}e.computeCentroid=function(e,t){if("point"===e.type)return y(e,t,!1);if(f.isHydratedGeometry(e))switch(e.type){case"extent":return y(e.center,t,!1);case"polygon":return y(e.centroid,t,!1);case"polyline":return y(m(e),t,!0);case"mesh":return y(p.vertexSpaceOriginToPoint(e.vertexSpace,e.spatialReference)??e.extent.center,t,!1);case"multipoint":return}else switch(e.type){case"extent":return y(function(e){return h.makeDehydratedPoint(.5*(e.xmax+e.xmin),.5*(e.ymax+e.ymin),null!=e.zmin&&null!=e.zmax&&isFinite(e.zmin)&&isFinite(e.zmax)?.5*(e.zmax+e.zmin):void 0,e.spatialReference)}(e),t,!0);case"polygon":return y(function(e){const t=e.rings[0];if(!t||0===t.length)return null;const r=u.ringsCentroid(e.rings,!!e.hasZ);return h.makeDehydratedPoint(r[0],r[1],r[2],e.spatialReference)}(e),t,!0);case"polyline":return y(m(e),t,!0);case"multipoint":return}},e.computeMaxZ=function(e){if(!e)return 0;switch(e.type){case"point":return e.z;case"extent":return e.zmax;case"polygon":return e.hasZ?e.rings.reduce((e,t)=>t.reduce((e,t)=>Math.max(e,t[2]),e),-1/0):void 0;case"polyline":return e.hasZ?e.paths.reduce((e,t)=>t.reduce((e,t)=>Math.max(e,t[2]),e),-1/0):void 0;case"mesh":return e.extent.zmax;case"multipoint":return}},e.computeObjectRotation=function(e,t,o,s=i.create()){return e&&r.rotateZ(s,s,-e/180*Math.PI),t&&r.rotateX(s,s,t/180*Math.PI),o&&r.rotateY(s,s,o/180*Math.PI),s},e.computeObjectScale=function(e=o.ONES,t,r,i=1){const s=new Array(3);if(null==t||null==r)s[0]=1,s[1]=1,s[2]=1;else{let i,o=0;for(let n=2;n>=0;n--){const a=e[n],l=null!=a,c=0===n&&!i&&!l,u=r[n];let d;"symbol-value"===a||c?d=0!==u?t[n]/u:1:l&&"proportional"!==a&&isFinite(a)&&(d=0!==u?a/u:1),null!=d&&(s[n]=d,i=d,o=Math.max(o,Math.abs(d)))}for(let e=2;e>=0;e--)null==s[e]?s[e]=i:0===s[e]&&(s[e]=.001*o)}for(let e=2;e>=0;e--)s[e]/=i;return o.fromArray(s)},e.demResolutionForBoundingBox=function(e,r,i){if(null!=i.minDemResolution)return i.minDemResolution;const o=t.getMetersPerUnitForSR(r),s=l.width(e)*o,n=l.depth(e)*o,a=l.height(e)*(r.isGeographic?1:o);return 0===s&&0===n&&0===a?i.minDemResolutionForPoints:.01*Math.max(s,n,a)},e.enlargeExtent=function(e,t,r,i=0){if(e){t||(t=c.create());const o=e;let n=.5*o.width*(r-1),a=.5*o.height*(r-1);return o.width<1e-7*o.height?n+=a/20:o.height<1e-7*o.width&&(a+=n/20),s.set(t,o.xmin-n-i,o.ymin-a-i,o.xmax+n+i,o.ymax+a+i),t}return null},e.isValidSize=g,e.mixinColorAndOpacity=function(e,t,r=null){const i=n.clone(n.ONES);return null!=e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],e.length>3&&(i[3]=e[3])),null!=t&&(i[3]=t),r&&s.scale(i,i,r),i},e.overrideColor=function(e,t,r,i,o,s){for(let t=0;t<3;++t)s[t]=null!=e?.[t]?e[t]:null!=r?.[t]?r[t]:o[t];return s[3]=null!=t?t:null!=i?i:o[3],s},e.validateSymbolLayerSize=function(e){return g(null!=e.isPrimitive?[e.width,e.depth,e.height]:e)?null:"Symbol sizes may not be negative values"},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshVertexSpaceUtils":function(){define(["exports","../../chunks/vec32","../Point","./MeshGeoreferencedVertexSpace","./MeshLocalVertexSpace"],function(e,t,r,i,o){"use strict";function s(e){return null!=e.origin}e.isAbsoluteVertexSpace=function(e){return null==e.origin},e.isMeshWithRelativeVertexSpace=function(e){return s(e.vertexSpace)},e.isRelativeVertexSpace=s,e.selectVertexSpace=function(e,t){const{x:r,y:s,z:n,spatialReference:a}=e,l=[r,s,n??0];return"local"===(t?.vertexSpace??function(e){return e.isGeographic||e.isWebMercator?"local":"georeferenced"}(a))?new o({origin:l}):new i({origin:l})},e.vertexSpaceEquals=function(e,r){return e.type===r.type&&(e.origin===r.origin||null!=e.origin&&null!=r.origin&&t.exactEquals(e.origin,r.origin))},e.vertexSpaceOriginToPoint=function(e,t){if(!s(e))return null;const[i,o,n]=e.origin;return new r({x:i,y:o,z:n,spatialReference:t})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec32":function(){define(["exports","../core/libs/gl-matrix-2/factories/vec3f64","../core/libs/gl-matrix-2/math/common"],function(e,t,r){"use strict";function i(e){const t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function s(e,t,r,i){return e[0]=t,e[1]=r,e[2]=i,e}function n(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function l(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function c(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function u(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function d(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function p(e,t){return e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e}function h(e,t){return e[0]=Math.sign(t[0]),e[1]=Math.sign(t[1]),e[2]=Math.sign(t[2]),e}function f(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function m(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function y(e,t=0,r=1){return e[0]=Math.min(Math.max(e[0],t),r),e[1]=Math.min(Math.max(e[1],t),r),e[2]=Math.min(Math.max(e[2],t),r),e}function g(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function b(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function _(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e}function v(e,t){const r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(r*r+i*i+o*o)}function S(e,t){const r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return r*r+i*i+o*o}function x(e){const t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i}function w(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function M(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function T(e,t){const r=t[0],i=t[1],o=t[2];let s=r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s),e}function P(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function I(e,t,r){const i=t[0],o=t[1],s=t[2],n=r[0],a=r[1],l=r[2];return e[0]=o*l-s*a,e[1]=s*n-i*l,e[2]=i*a-o*n,e}function C(e,t,r){const i=t[0],o=t[1],s=t[2],n=r[0],a=r[1],l=r[2],c=o*l-s*a,u=s*n-i*l,d=i*a-o*n,p=Math.sqrt(c*c+u*u+d*d);return e[0]=c/p,e[1]=u/p,e[2]=d/p,e}function O(e,t,r,i){const o=t[0],s=t[1],n=t[2];return e[0]=o+i*(r[0]-o),e[1]=s+i*(r[1]-s),e[2]=n+i*(r[2]-n),e}function F(e,t,r,i,o,s){const n=s*s,a=n*(2*s-3)+1,l=n*(s-2)+s,c=n*(s-1),u=n*(3-2*s);return e[0]=t[0]*a+r[0]*l+i[0]*c+o[0]*u,e[1]=t[1]*a+r[1]*l+i[1]*c+o[1]*u,e[2]=t[2]*a+r[2]*l+i[2]*c+o[2]*u,e}function A(e,t,r,i,o,s){const n=1-s,a=n*n,l=s*s,c=a*n,u=3*s*a,d=3*l*n,p=l*s;return e[0]=t[0]*c+r[0]*u+i[0]*d+o[0]*p,e[1]=t[1]*c+r[1]*u+i[1]*d+o[1]*p,e[2]=t[2]*c+r[2]*u+i[2]*d+o[2]*p,e}function R(e,t=1){const i=r.RANDOM,o=2*i()*Math.PI,s=2*i()-1,n=Math.sqrt(1-s*s)*t;return e[0]=Math.cos(o)*n,e[1]=Math.sin(o)*n,e[2]=s*t,e}function D(e,t,r){const i=t[0],o=t[1],s=t[2];return e[0]=r[0]*i+r[4]*o+r[8]*s+r[12],e[1]=r[1]*i+r[5]*o+r[9]*s+r[13],e[2]=r[2]*i+r[6]*o+r[10]*s+r[14],e}function E(e,t,r){const i=t[0],o=t[1],s=t[2];return e[0]=i*r[0]+o*r[3]+s*r[6],e[1]=i*r[1]+o*r[4]+s*r[7],e[2]=i*r[2]+o*r[5]+s*r[8],e}function V(e,t,r){const i=r[0],o=r[1],s=r[2],n=r[3],a=t[0],l=t[1],c=t[2],u=o*c-s*l,d=s*a-i*c,p=i*l-o*a,h=o*p-s*d,f=s*u-i*p,m=i*d-o*u,y=2*n;return e[0]=a+u*y+2*h,e[1]=l+d*y+2*f,e[2]=c+p*y+2*m,e}function L(e,t,r,i){const o=[],s=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],s[0]=o[0],s[1]=o[1]*Math.cos(i)-o[2]*Math.sin(i),s[2]=o[1]*Math.sin(i)+o[2]*Math.cos(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function z(e,t,r,i){const o=[],s=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],s[0]=o[2]*Math.sin(i)+o[0]*Math.cos(i),s[1]=o[1],s[2]=o[2]*Math.cos(i)-o[0]*Math.sin(i),e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function U(e,t,r,i){const o=[],s=[];return o[0]=t[0]-r[0],o[1]=t[1]-r[1],o[2]=t[2]-r[2],s[0]=o[0]*Math.cos(i)-o[1]*Math.sin(i),s[1]=o[0]*Math.sin(i)+o[1]*Math.cos(i),s[2]=o[2],e[0]=s[0]+r[0],e[1]=s[1]+r[1],e[2]=s[2]+r[2],e}function j(e,t){T(B,e),T(N,t);const r=P(B,N);return r>1?0:r<-1?Math.PI:Math.acos(r)}const B=t.create(),N=t.create();function k(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function q(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function G(e,t){if(e===t)return!0;const i=e[0],o=e[1],s=e[2],n=t[0],a=t[1],l=t[2],c=r.getEpsilon();return Math.abs(i-n)<=c*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(o-a)<=c*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(s-l)<=c*Math.max(1,Math.abs(s),Math.abs(l))}function H(e,t,r){const i=r[0]-t[0],o=r[1]-t[1],s=r[2]-t[2];let n=i*i+o*o+s*s;return n>0?(n=1/Math.sqrt(n),e[0]=i*n,e[1]=o*n,e[2]=s*n,e):(e[0]=0,e[1]=0,e[2]=0,e)}const W=a,$=l,J=c,Y=v,Z=S,Q=i,X=x,K=Object.freeze(Object.defineProperty({__proto__:null,abs:p,add:n,angle:j,bezier:A,ceil:u,clamp:y,copy:o,cross:I,crossAndNormalize:C,direction:H,dist:Y,distance:v,div:J,divide:c,dot:P,equals:G,exactEquals:q,floor:d,hermite:F,inverse:M,len:Q,length:i,lerp:O,max:m,min:f,mul:$,multiply:l,negate:w,normalize:T,random:R,rotateX:L,rotateY:z,rotateZ:U,round:g,scale:b,scaleAndAdd:_,set:s,sign:h,sqrDist:Z,sqrLen:X,squaredDistance:S,squaredLength:x,str:k,sub:W,subtract:a,transformMat3:E,transformMat4:D,transformQuat:V},Symbol.toStringTag,{value:"Module"}));e.abs=p,e.add=n,e.angle=j,e.bezier=A,e.ceil=u,e.clamp=y,e.copy=o,e.cross=I,e.crossAndNormalize=C,e.direction=H,e.dist=Y,e.distance=v,e.div=J,e.divide=c,e.dot=P,e.equals=G,e.exactEquals=q,e.floor=d,e.hermite=F,e.inverse=M,e.len=Q,e.length=i,e.lerp=O,e.max=m,e.min=f,e.mul=$,e.multiply=l,e.negate=w,e.normalize=T,e.random=R,e.rotateX=L,e.rotateY=z,e.rotateZ=U,e.round=g,e.scale=b,e.scaleAndAdd=_,e.set=s,e.sign=h,e.sqrDist=Z,e.sqrLen=X,e.squaredDistance=S,e.squaredLength=x,e.str=k,e.sub=W,e.subtract=a,e.transformMat3=E,e.transformMat4=D,e.transformQuat=V,e.vec3=K})},"esri/geometry/support/MeshGeoreferencedVertexSpace":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a,l,c){"use strict";var u;return e.default=class extends(r.ClonableMixin(i.JSONSupport)){static{u=this}constructor(e){super(e),this.type="georeferenced",this.origin=null}static{this.absolute=new u}},t.__decorate([l.enumeration({georeferenced:"georeferenced"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property({type:[Number],nonNullable:!1,json:{write:!0}})],e.default.prototype,"origin",void 0),e.default=u=t.__decorate([c.subclass("esri.geometry.support.MeshGeoreferencedVertexSpace")],e.default),e.default})},"esri/geometry/support/MeshLocalVertexSpace":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";return e.default=class extends(r.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.type="local",this.origin=u.create()}},t.__decorate([l.enumeration({local:"local"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property({type:[Number],nonNullable:!0,json:{write:!0}})],e.default.prototype,"origin",void 0),e.default=t.__decorate([c.subclass("esri.geometry.support.MeshLocalVertexSpace")],e.default),e.default})},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],function(e){"use strict";e.ImmutableDehydratedPoint=class{constructor(e,t,r,i,o){this.spatialReference=e,this._position=void 0!==o?[t,r,i??0,o??0]:void 0!==i?[t,r,i??0]:[t,r],this._flags=(void 0!==i?1:0)+(void 0!==o?2:0)}get hasZ(){return!(1&~this._flags)}get hasM(){return!(2&~this._flags)}get type(){return"point"}get x(){return this._position[0]}get y(){return this._position[1]}get z(){return this.hasZ?this._position[2]:void 0}get m(){return this.hasM?this._position[3]:void 0}},e.makeDehydratedPoint=function(e,t,r,i){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:i,type:"point"}},e.setDehydratedPoint=function(e,t,r,i,o){e.x=t,e.y=r,e.z=i,e.hasZ=null!=i,e.spatialReference=o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/hydratedFeatures":function(){define(["exports","../../Graphic","../../core/has","../../core/lang","../../core/typedArrayUtil","../../geometry/SpatialReference","../../geometry/support/jsonUtils","./dehydratedPoint"],function(e,t,r,i,o,s,n,a){"use strict";function l(e){return"declaredClass"in e}function c(e){return"declaredClass"in e}function u(e){return"declaredClass"in e}function d(e){return null==e?null:l(e)?e:n.fromJSON(function(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:o}=e.spatialReference,s={wkid:t,wkt:r,wkt2:i,latestWkid:o};switch(e.type){case"point":{const{x:t,y:r,z:i,m:o}=e;return{x:t,y:r,z:i,m:o,spatialReference:s}}case"polygon":{const{rings:t,hasZ:r,hasM:i}=e;return{rings:p(t),hasZ:r,hasM:i,spatialReference:s}}case"polyline":{const{paths:t,hasZ:r,hasM:i}=e;return{paths:p(t),hasZ:r,hasM:i,spatialReference:s}}case"extent":{const{xmin:t,xmax:r,ymin:i,ymax:o,zmin:n,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:d}=e;return{xmin:t,xmax:r,ymin:i,ymax:o,zmin:n,zmax:a,mmin:l,mmax:c,hasZ:u,hasM:d,spatialReference:s}}case"multipoint":{const{points:t,hasZ:r,hasM:i}=e;return{points:f(t)?h(t):t,hasZ:r,hasM:i,spatialReference:s}}default:return}}(e))}function p(e){return function(e){for(const t of e)if(0!==t.length)return f(t);return!1}(e)?e.map(e=>h(e)):e}function h(e){return e.map(e=>Array.from(e))}function f(e){return e.length>0&&(o.isFloat32Array(e[0])||o.isFloat64Array(e[0]))}e.clonePoint=function(e,t){if(!e)return null;let r;if(c(e)){if(null==t)return e.clone();if(c(t))return t.copy(e)}return null!=t?(r=t,r.x=e.x,r.y=e.y,r.spatialReference=e.spatialReference,e.hasZ?(r.z=e.z,r.hasZ=e.hasZ):(r.z=void 0,r.hasZ=!1),e.hasM?(r.m=e.m,r.hasM=!0):(r.m=void 0,r.hasM=!1)):(r=a.makeDehydratedPoint(e.x,e.y,e.z,e.spatialReference),e.hasM&&(r.m=e.m,r.hasM=!0)),r},e.hydrateGeometry=d,e.hydrateGraphic=function(e,r){return e?u(e)?e:new t({layer:r,sourceLayer:r,visible:e.visible,symbol:i.clone(e.symbol),attributes:i.clone(e.attributes),geometry:d(e.geometry)}):null},e.hydratedSpatialReference=function(e){const{wkid:t,wkt:r,wkt2:i,latestWkid:o}=e,n={wkid:t,wkt:r,wkt2:i,latestWkid:o};return s.fromJSON(n)},e.isHydratedGeometry=l,e.isHydratedGraphic=u,e.isHydratedPoint=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../webgl-engine/lib/TextRenderer"],function(e,t,r,i){"use strict";const o=Object.freeze({left:0,center:.5,right:1}),s=Object.freeze({"bottom-left":r.fromValues(0,0),bottom:r.fromValues(.5,0),"bottom-right":r.fromValues(1,0),left:r.fromValues(0,.5),center:r.fromValues(.5,.5),right:r.fromValues(1,.5),"top-left":r.fromValues(0,1),top:r.fromValues(.5,1),"top-right":r.fromValues(1,1)});e.anchorFromPlacements=function(e,t){switch(t){case"bottom":return"left"===e?"bottom-left":"right"===e?"bottom-right":"bottom";case"center":return e;case"top":return"left"===e?"top-left":"right"===e?"top-right":"top"}},e.horizontalPlacementFromAnchor=function(e){switch(e){case"bottom-left":case"left":case"top-left":return"left";case"bottom":case"center":case"top":return"center";case"bottom-right":case"right":case"top-right":return"right"}},e.horizontalPlacementToAnchorX=o,e.namedAnchorToHUDMaterialAnchorPos=s,e.textRenderAlignmentFromHorizontalPlacement=function(e){switch(e){case"left":return 0;case"right":return 2;default:return 1}},e.verticalPlacementFromAlignment=function(e){return"middle"===e?"center":e},e.verticalPlacementFromAnchor=function(e){switch(e){case"bottom-left":case"bottom":case"bottom-right":return"bottom";case"left":case"center":case"right":return"center";case"top-left":case"top":case"top-right":return"top"}},e.verticalScreenOffsetFromAlignment=function(e,o){switch(e){case"top":return t.set(o,0,i.textVerticalPaddingPx);case"bottom":return t.set(o,0,-i.textVerticalPaddingPx);default:return t.copy(o,r.ZEROS)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e}function i(e,t,r){return e[0]=t,e[1]=r,e}function o(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function s(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function n(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function a(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function l(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function c(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function u(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function d(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function p(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function h(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function f(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e}function m(e,t){const r=t[0]-e[0],i=t[1]-e[1];return Math.sqrt(r*r+i*i)}function y(e,t){const r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i}function g(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function b(e){const t=e[0],r=e[1];return t*t+r*r}function _(e,t){return e[0]=-t[0],e[1]=-t[1],e}function v(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function S(e,t){const r=t[0],i=t[1];let o=r*r+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o),e}function x(e,t){return e[0]*t[0]+e[1]*t[1]}function w(e,t,r){const i=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=i,e}function M(e,t,r,i){const o=t[0],s=t[1];return e[0]=o+i*(r[0]-o),e[1]=s+i*(r[1]-s),e}function T(e,r=1){const i=2*t.RANDOM()*Math.PI;return e[0]=Math.cos(i)*r,e[1]=Math.sin(i)*r,e}function P(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[2]*o,e[1]=r[1]*i+r[3]*o,e}function I(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[2]*o+r[4],e[1]=r[1]*i+r[3]*o+r[5],e}function C(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[3]*o+r[6],e[1]=r[1]*i+r[4]*o+r[7],e}function O(e,t,r){const i=t[0],o=t[1];return e[0]=r[0]*i+r[4]*o+r[12],e[1]=r[1]*i+r[5]*o+r[13],e}function F(e,t,r,i){const o=t[0]-r[0],s=t[1]-r[1],n=Math.sin(i),a=Math.cos(i);return e[0]=o*a-s*n+r[0],e[1]=o*n+s*a+r[1],e}function A(e,t){const r=e[0],i=e[1],o=t[0],s=t[1];let n=r*r+i*i;n>0&&(n=1/Math.sqrt(n));let a=o*o+s*s;a>0&&(a=1/Math.sqrt(a));const l=(r*o+i*s)*n*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function R(e){return"vec2("+e[0]+", "+e[1]+")"}function D(e,t){return e[0]===t[0]&&e[1]===t[1]}function E(e,r){const i=e[0],o=e[1],s=r[0],n=r[1],a=t.getEpsilon();return Math.abs(i-s)<=a*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-n)<=a*Math.max(1,Math.abs(o),Math.abs(n))}function V(e,t,r,i,o){let s=t[0]-r[0],n=t[1]-r[1];const a=(i[0]*s+i[1]*n)*(o-1);return s=i[0]*a,n=i[1]*a,e[0]=t[0]+s,e[1]=t[1]+n,e}const L=g,z=s,U=n,j=a,B=m,N=y,k=b,q=Object.freeze(Object.defineProperty({__proto__:null,add:o,angle:A,ceil:l,copy:r,cross:w,dist:B,distance:m,div:j,divide:a,dot:x,equals:E,exactEquals:D,floor:c,inverse:v,len:L,length:g,lerp:M,max:d,min:u,mul:U,multiply:n,negate:_,normalize:S,projectAndScale:V,random:T,rotate:F,round:p,scale:h,scaleAndAdd:f,set:i,sqrDist:N,sqrLen:k,squaredDistance:y,squaredLength:b,str:R,sub:z,subtract:s,transformMat2:P,transformMat2d:I,transformMat3:C,transformMat4:O},Symbol.toStringTag,{value:"Module"}));e.add=o,e.angle=A,e.ceil=l,e.copy=r,e.cross=w,e.dist=B,e.distance=m,e.div=j,e.divide=a,e.dot=x,e.equals=E,e.exactEquals=D,e.floor=c,e.inverse=v,e.len=L,e.length=g,e.lerp=M,e.max=d,e.min=u,e.mul=U,e.multiply=n,e.negate=_,e.normalize=S,e.projectAndScale=V,e.random=T,e.rotate=F,e.round=p,e.scale=h,e.scaleAndAdd=f,e.set=i,e.sqrDist=N,e.sqrLen=k,e.squaredDistance=y,e.squaredLength=b,e.str=R,e.sub=z,e.subtract=s,e.transformMat2=P,e.transformMat2d=I,e.transformMat3=C,e.transformMat4=O,e.vec2=q,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(e){"use strict";function t(){return[0,0]}function r(e){return[e[0],e[1]]}function i(e,t){return[e,t]}function o(e,t){return[e,t]}function s(e,t=[0,0]){const r=Math.min(2,e.length);for(let i=0;i<r;++i)t[i]=e[i];return t}function n(){return[0,0]}function a(){return i(1,1)}function l(){return i(1,0)}function c(){return i(0,1)}const u=[0,0],d=a(),p=l(),h=c(),f=Object.freeze(Object.defineProperty({__proto__:null,ONES:d,UNIT_X:p,UNIT_Y:h,ZEROS:u,clone:r,create:t,freeze:o,fromArray:s,fromValues:i,ones:a,unitX:l,unitY:c,zeros:n},Symbol.toStringTag,{value:"Module"}));e.ONES=d,e.UNIT_X=p,e.UNIT_Y=h,e.ZEROS=u,e.clone=r,e.create=t,e.freeze=o,e.fromArray=s,e.fromValues=i,e.ones=a,e.unitX=l,e.unitY=c,e.vec2f64=f,e.zeros=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../core/mathUtils","../../support/debugFlags","./FontMetrics","./TextHelperCanvas"],function(e,t,r,i,o){"use strict";const s=[];{const e=16;for(let t=0;t<360;t+=360/e)s.push([Math.cos(Math.PI*t/180),Math.sin(Math.PI*t/180)])}const n={canvas:null},a=512,l="rgb(255, 0, 255, 0.5)";class c{get firstLineHeight(){return this.firstLineAscent+this.maxLineDescent}get midLineHeight(){return this.maxLineAscent+this.maxLineDescent}get lastLineHeight(){return this.maxLineAscent+this.lastLineDescent}constructor(e,t,r,i,o){this.firstLineAscent=e,this.lastLineDescent=t,this.maxLineAscent=r,this.maxLineDescent=i,this.displayWidth=o}}e.TextRenderer=class{constructor(e,t,r,i){this.text=e,this._alignment=t,this._parameters=r,this._maxSize=i,this._textWidths=[],this._lineWidths=[],this._renderPixelRatio=null,this._metricsCached=null,this.key=`${e}--${this._parameters.key}-${this._alignment}`,this._lines=e.replaceAll(" "," ").split(/\r?\n/)}get displayWidth(){return Math.ceil(this._displayWidth+2*this._horizontalPadding)}get displayHeight(){let e=this._metrics.firstLineAscent;for(let t=0;t<this._lines.length-1;t++)e+=this._lineSpacing;return e+=this._metrics.lastLineDescent,Math.ceil(e+2*this._haloSize+2*this._verticalPadding)}get renderedWidth(){return this._toRoundedRenderUnit(this.displayWidth)}get renderedHeight(){return this._toRoundedRenderUnit(this.displayHeight)}get firstRenderedBaselinePosition(){return this._toRenderUnit(this._firstLineYOffset+this._metrics.firstLineAscent)}get _firstLineYOffset(){return this._verticalPadding+this._haloSize}get _metrics(){if(null==this._metricsCached){const e=o.getTextHelperCanvas(n,a,a).getContext("2d"),t=this._parameters.definition.pixelRatio,r=this._fontSize*t;this._parameters.setFontProperties(e,r);let s=2*this._haloSize;const l=this._parameters.definition.font;"italic"!==l.style&&"oblique"!==l.style&&"bold"!==l.weight&&"bolder"!==l.weight||(s+=.3*e.measureText("A").width),this._textWidths.length=0,this._lineWidths.length=0;let u=0,d=0,p=0,h=0,f=0;this._lines.forEach((r,i)=>{const o=e.measureText(r),n=o.width/t,a=n+s;this._textWidths.push(n),this._lineWidths.push(a),u=Math.max(u,a),h=Math.max(h,o.actualBoundingBoxAscent/t),f=Math.max(f,o.actualBoundingBoxDescent/t),0===i&&(d=o.actualBoundingBoxAscent/t),i===this._lines.length-1&&(p=o.actualBoundingBoxDescent/t)});const m=i.getFontMetrics(this._parameters),y=Math.max(h,m.maxAscent),g=Math.max(f,m.maxDescent),b=d,_="underline"===this._parameters.definition.font.decoration?g:p,v=u;this._metricsCached=new c(b,_,y,g,v)}return this._metricsCached}get _lineSpacing(){return(this._midLineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}get _midLineHeight(){return this._metrics.midLineHeight}get _linePadding(){return.2*this._midLineHeight}get _midLineAscent(){return this._metrics.maxLineAscent}get _renderedFontSize(){return this._toRenderUnit(this._fontSize)}get _fontSize(){return this._parameters.definition.size}get _renderedHaloSize(){return this._toRenderUnit(this._haloSize)}get _haloSize(){return this._parameters.haloSize}get _horizontalPadding(){return this._hasBackground?this._parameters.definition.background.padding[0]:0}get _verticalPadding(){return Math.max(this._hasBackground?this._parameters.definition.background.padding[1]:0,1)}get _hasBackground(){return!!this._parameters.backgroundStyle}get renderPixelRatio(){if(null==this._renderPixelRatio){const e=this._parameters.definition.pixelRatio;this._renderPixelRatio=Math.min(e,Math.min(this._maxSize[0]/this.displayWidth,this._maxSize[1]/this.displayHeight))}return this._renderPixelRatio}_getLineXOffset(e){switch(this._alignment){case 0:return this._horizontalPadding;case 1:return(this.displayWidth-this._lineWidths[e])/2;case 2:return this.displayWidth-this._horizontalPadding-this._lineWidths[e]}}render(e,t,i){e.save();const o=t/=this.renderPixelRatio,s=i/=this.renderPixelRatio,n=this._haloSize,a=this._firstLineYOffset+this._metrics.firstLineAscent;t+=n,i+=a;const c=this._haloSize>0;c&&this._renderHalo(e,o,s,n,a),this._parameters.setFontProperties(e,this._renderedFontSize);for(let r=0;r<this._lines.length;++r){const o=this._lines[r],s=this._getLineXOffset(r);c&&(e.globalCompositeOperation="destination-out",e.fillStyle="rgb(0, 0, 0)",this._fillText(e,o,t+s,i),this._renderLineDecoration(e,t+s,i,this._textWidths[r])),e.globalCompositeOperation="source-over",e.fillStyle=this._parameters.textStyle,this._fillText(e,o,t+this._getLineXOffset(r),i),this._renderLineDecoration(e,t+s,i,this._textWidths[r]),i+=this._lineSpacing}if(r.debugFlags.TEXT_SHOW_BASELINE){e.strokeStyle=l,e.setLineDash([2,2]),e.lineWidth=1;let t=s+a;for(let r=0;r<this._lines.length;++r)this._drawLine(e,[o,t],[o+this.displayWidth,t]),t+=this._lineSpacing}if(r.debugFlags.TEXT_SHOW_BORDER&&(e.strokeStyle=l,e.setLineDash([]),e.lineWidth=1,this._drawBox(e,[o,s],[this.displayWidth,this.displayHeight])),this._hasBackground){const t=this._parameters.definition.background.borderRadius*this.renderPixelRatio;this._roundedRect(e,o,s,t),e.globalCompositeOperation="destination-over",e.fillStyle=this._parameters.backgroundStyle,e.fill()}e.restore()}_renderLineDecoration(e,t,r,i,o=!1){if("none"===this._parameters.definition.font.decoration||0===i)return;const s=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case"underline":r+=2*s;break;case"line-through":r-=.33*this._midLineAscent}const n=o?this._haloSize:0;e.strokeStyle=o?this._parameters.haloStyle:this._parameters.textStyle,e.lineWidth=this._toRenderUnit(s+2*n),e.beginPath(),e.moveTo(this._toRenderUnit(t-n),this._toRenderUnit(r)),e.lineTo(this._toRenderUnit(t+i+n),this._toRenderUnit(r)),e.stroke()}_roundedRect(e,r,i,o){r=this._toRenderUnit(r),i=this._toRenderUnit(i);const s=this.renderedWidth,n=this.renderedHeight;0!==o?(o=t.clamp(o,0,Math.floor(n/2)),e.beginPath(),e.moveTo(r,i+o),e.arcTo(r,i,r+o,i,o),e.lineTo(r+s-o,i),e.arcTo(r+s,i,r+s,i+o,o),e.lineTo(r+s,i+n-o),e.arcTo(r+s,i+n,r+s-o,i+n,o),e.lineTo(r+o,i+n),e.arcTo(r,i+n,r,i+n-o,o),e.closePath()):e.rect(r,i,s,n)}_renderHalo(e,t,r,i,s){const l=this.renderedWidth,c=this.renderedHeight,u=o.getTextHelperCanvas(n,Math.max(l,a),Math.max(c,a)),d=u.getContext("2d");d.clearRect(0,0,l,c),this._parameters.setFontProperties(d,this._renderedFontSize),d.fillStyle=this._parameters.haloStyle,d.strokeStyle=this._parameters.haloStyle;const p=this._renderedHaloSize<3;d.lineJoin=p?"miter":"round",p?this._renderHaloEmulated(d,i,s):this._renderHaloNative(d,i,s);let h=s;for(let e=0;e<this._lines.length;++e){const t=this._getLineXOffset(e);this._renderLineDecoration(d,i+t,h,this._textWidths[e],!0),h+=this._lineSpacing}e.globalAlpha=this._parameters.definition.halo.color[3],e.drawImage(u,0,0,l,c,this._toRenderUnit(t),this._toRenderUnit(r),l,c),e.globalAlpha=1}_renderHaloEmulated(e,t,r){for(let i=0;i<this._lines.length;++i){const o=this._lines[i],n=this._getLineXOffset(i);for(const[i,a]of s)this._fillText(e,o,t+n+this._haloSize*i,r+this._haloSize*a);r+=this._lineSpacing}}_renderHaloNative(e,t,r){const i=2*this._haloSize;for(let o=0;o<this._lines.length;++o){const s=this._lines[o],n=this._getLineXOffset(o),a=5,l=.1;for(let o=0;o<a;o++){const c=1-(a-1)*l+o*l;e.lineWidth=this._toRenderUnit(c*i),this._strokeText(e,s,t+n,r)}r+=this._lineSpacing}}get _displayWidth(){return this._metrics.displayWidth}_toRenderUnit(e){return e*this.renderPixelRatio}_toRoundedRenderUnit(e){return Math.round(e*this.renderPixelRatio)}_fillText(e,t,r,i){e.fillText(t,this._toRenderUnit(r),this._toRenderUnit(i))}_strokeText(e,t,r,i){e.strokeText(t,this._toRenderUnit(r),this._toRenderUnit(i))}_drawLine(e,t,r){e.beginPath(),e.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5),e.lineTo(this._toRoundedRenderUnit(r[0])+.5,this._toRoundedRenderUnit(r[1])+.5),e.stroke()}_drawBox(e,t,r){const i=this._toRenderUnit(t[0]),o=this._toRenderUnit(t[1]),s=this._toRenderUnit(r[0]),n=this._toRenderUnit(r[1]),a=Math.floor(i)+.5,l=Math.ceil(i+s)-.5,c=Math.floor(o)+.5,u=Math.ceil(o+n)-.5;e.beginPath(),e.moveTo(a,c),e.lineTo(l,c),e.lineTo(l,u),e.lineTo(a,u),e.lineTo(a,c),e.stroke()}},e.textVerticalPaddingPx=1,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugFlags":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n,a){"use strict";let l=class extends r{constructor(){super(...arguments),this.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1,this.DECONFLICTOR_SHOW_VISIBLE=!1,this.DECONFLICTOR_SHOW_INVISIBLE=!1,this.DECONFLICTOR_SHOW_GRID=!1,this.LABELS_SHOW_BORDER=!1,this.TEXT_SHOW_BASELINE=!1,this.TEXT_SHOW_BORDER=!1,this.OVERLAY_DRAW_DEBUG_TEXTURE=!1,this.OVERLAY_SHOW_CENTER=!1,this.SHOW_POI=!1,this.TESTS_DISABLE_OPTIMIZATIONS=!1,this.TESTS_DISABLE_FAST_UPDATES=!1,this.DRAW_MESH_GEOMETRY_NORMALS=!1,this.FEATURE_TILE_FETCH_SHOW_TILES=!1,this.FEATURE_TILE_TREE_SHOW_TILES=!1,this.TERRAIN_TILE_TREE_SHOW_TILES=!1,this.I3S_TREE_SHOW_TILES=!1,this.I3S_SHOW_MODIFICATIONS=!1,this.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1,this.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1,this.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1,this.LINE_WIREFRAMES=!1}};t.__decorate([i.property()],l.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0),t.__decorate([i.property()],l.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0),t.__decorate([i.property()],l.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0),t.__decorate([i.property()],l.prototype,"DECONFLICTOR_SHOW_GRID",void 0),t.__decorate([i.property()],l.prototype,"LABELS_SHOW_BORDER",void 0),t.__decorate([i.property()],l.prototype,"TEXT_SHOW_BASELINE",void 0),t.__decorate([i.property()],l.prototype,"TEXT_SHOW_BORDER",void 0),t.__decorate([i.property()],l.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0),t.__decorate([i.property()],l.prototype,"OVERLAY_SHOW_CENTER",void 0),t.__decorate([i.property()],l.prototype,"SHOW_POI",void 0),t.__decorate([i.property()],l.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0),t.__decorate([i.property()],l.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0),t.__decorate([i.property()],l.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0),t.__decorate([i.property()],l.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0),t.__decorate([i.property()],l.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0),t.__decorate([i.property()],l.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0),t.__decorate([i.property()],l.prototype,"I3S_TREE_SHOW_TILES",void 0),t.__decorate([i.property()],l.prototype,"I3S_SHOW_MODIFICATIONS",void 0),t.__decorate([i.property()],l.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0),t.__decorate([i.property()],l.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0),t.__decorate([i.property()],l.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0),t.__decorate([i.property()],l.prototype,"LINE_WIREFRAMES",void 0),l=t.__decorate([a.subclass("esri.views.3d.support.debugFlags")],l);const c=new l;e.debugFlags=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/FontMetrics":function(){define(["exports","./TextHelperCanvas"],function(e,t){"use strict";const r=new Map;class i{get maxHeight(){return this.maxAscent+this.maxDescent}constructor(e,t){this.maxAscent=e,this.maxDescent=t}}const o={canvas:null},s=(()=>{let e="";for(let t=32;t<127;t++)e+=String.fromCharCode(t);return e})();e.getFontMetrics=function(e){const{size:n}=e.definition,a=e.fontString(n);let l=r.get(a);if(!l){const c=t.getTextHelperCanvas(o,0,0).getContext("2d");e.setFontProperties(c,n);const u=c.measureText(s);l=new i(u.actualBoundingBoxAscent,u.actualBoundingBoxDescent),r.set(a,l)}return l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextHelperCanvas":function(){define(["exports"],function(e){"use strict";e.getTextHelperCanvas=function(e,t,r){return e.canvas||(e.canvas=document.createElement("canvas")),e.canvas.width=t,e.canvas.height=r,e.canvas},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/featureData/processingUtils":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../geometry/projection/projectBuffer","../../../../../../geometry/projection/projectVectorToVector","../../../../../../geometry/support/aaBoundingRect"],function(e,t,r,i,o){"use strict";function s(e){const{featureCount:t}=e;if(0===t)return new Float64Array;const r=new Float64Array(3*t);return e.getCoordinatesArray(r),r}function n(e,t){const i=e.length/3,o=t.viewSpatialReference,s=t.renderSpatialReference,n=new Float64Array(3*i);if(!r.projectBuffer(e,o,0,n,s,0,i))throw new Error("Failed to project coordinates");return n}e.computeRenderCoordinates=function(e,t){const{featureCount:r}=e;return 0===r?new Float64Array:n(s(e),t)},e.computeTileCenterRenderCoordinates=function(e,r){const s=r.viewSpatialReference,n=r.renderSpatialReference,{extent:a}=e,l=o.center(a),c=t.create();return i.projectVectorToVector([l[0],l[1],0],s,c,n),c},e.projectToRenderCoordinates=n,e.readMapCoordinates=s,e.readObjectIds=function(e){const{featureCount:t}=e;if(0===t)return new Uint32Array;const r=new Uint32Array(t);return e.getObjectIdsArray(r),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToVector":function(){define(["exports","../projectionUtils","../SpatialReference","./projectPointToVector","../../layers/graphics/dehydratedPoint"],function(e,t,r,i,o){"use strict";function s(e,t,r,o,s){return!(null==t||null==o||e.length<2)&&(n.x=e[0],n.y=e[1],n.z=e[2],n.spatialReference=t,i.projectPointToVector(n,r,o,s))}const n=o.makeDehydratedPoint(0,0,0,r.WGS84);e.projectVectorToVector=s,e.projectVectorToVectorAsync=async function(e,r,i,o,n,a){return await t.initializeProjection(r,o,null,a),s(e,r,i,o,n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projectionUtils","./projectBuffer"],function(e,t,r,i){"use strict";function o(e,t,o,n){if(r.canProjectWithoutEngine(e.spatialReference,o)){s[0]=e.x,s[1]=e.y;const r=e.z;return s[2]=r??n??0,i.projectBuffer(s,e.spatialReference,0,t,o,0)}const a=r.tryProjectWithZConversion(e,o);return!!a&&(t[0]=a?.x,t[1]=a?.y,t[2]=a?.z??n??0,!0)}const s=t.create();e.projectPointToVector=o,e.projectPointToVectorAsync=async function(e,t,i,s,n){return await r.initializeProjection(e.spatialReference,i,null,n),o(e,t,i,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/symbolization/symbolizationUtils":function(){define(["exports","../../../../../../geometry/support/Indices"],function(e,t){"use strict";e.inputAttributesToAttributesMap=function(e){const r=new Map;for(const[i,o]of e)r.set(i,{...o,indices:t.compactIndices(o.indices)});return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/Indices":function(){define(["exports","../../core/typedArrayUtil"],function(e,t){"use strict";function r(e,r){if(Array.isArray(e)){if(e.length<t.nativeArrayMaxSize)return e}else if(e.length<t.nativeArrayMaxSize)return Array.from(e);let i=!0,o=!0;return e.some((e,t)=>(i=i&&0===e,o=o&&e===t,!i&&!o)),i?c(e.length):o?n(e.length):t.isTypedArray(e)&&e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT?e:function(e,r){for(const i of e){if(i>=65536)return t.isTypedArray(e)?e:new Uint32Array(e);i>=256&&(r=!1)}return r?new Uint8Array(e):new Uint16Array(e)}(e,!r)}let i=a(131072);const o=[0],s=(()=>{const e=new Uint16Array(65536);for(let t=0;t<e.length;++t)e[t]=t;return e})();function n(e){return 1===e?o:e<t.nativeArrayMaxSize?Array.from(new Uint16Array(s.buffer,0,e)):e<s.length?new Uint16Array(s.buffer,0,e):(e>i.length&&(i=a(Math.max(2*i.length,e))),new Uint32Array(i.buffer,0,e))}function a(e){const t=new Uint32Array(e);for(let e=0;e<t.length;e++)t[e]=e;return t}let l=new Uint8Array(65536);function c(e){if(1===e)return o;if(e<t.nativeArrayMaxSize)return new Array(e).fill(0);if(e>l.length){const t=Math.max(2*l.length,e);l=new Uint8Array(t)}return new Uint8Array(l.buffer,0,e)}e.compactIndices=r,e.compactMeshIndices=function(e){return r(e,!0)},e.getContinuousIndexArray=n,e.getZeroIndexArray=c,e.newIndexArray=function(e){return e<=t.nativeArrayMaxSize?new Array(e):e<=65536?new Uint16Array(e):new Uint32Array(e)},e.newIntArray=function(e){return e<=t.nativeArrayMaxSize?new Array(e):new Uint32Array(e)},e.pruneIndexArrays=function(){i=a(131072),l=new Uint8Array(65536)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports","../../../../core/has","../../../../core/floatRGBA","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../webgl-engine/lib/Texture"],function(e,t,r,i,o){"use strict";const s=.5,n=i.freeze(.25,.25,.75,.75);function a(e,t=128,r=t*s,i=0){return{data:l(e,t,r,i),parameters:{mipmap:!1,wrap:{s:33071,t:33071},width:t,height:t,components:4,noUnpackFlip:!0,reloadable:!0}}}function l(e,t=128,r=t*s,i=0){switch(e){case"circle":default:return c(t,r);case"square":return u(t,r);case"cross":return p(t,r,i);case"x":return h(t,r,i);case"kite":return d(t,r);case"triangle":return f(t,r);case"arrow":return m(t,r)}}function c(e,t){const r=e/2-.5;return v(e,b(r,r,t/2))}function u(e,t){return y(e,t,!1)}function d(e,t){return y(e,t,!0)}function p(e,t,r=0){return g(e,t,!1,r)}function h(e,t,r=0){return g(e,t,!0,r)}function f(e,t){return v(e,_(e/2,t,t/2))}function m(e,t){const r=t,i=t/2,o=e/2,s=.8*r,n=b(o,(e-t)/2-s,Math.sqrt(s*s+i*i)),a=_(o,r,i);return v(e,(e,t)=>Math.max(a(e,t),-n(e,t)))}function y(e,t,r){return r&&(t/=Math.SQRT2),v(e,(i,o)=>{let s=i-.5*e+.25,n=.5*e-o-.75;if(r){const e=(s+n)/Math.SQRT2;n=(n-s)/Math.SQRT2,s=e}return Math.max(Math.abs(s),Math.abs(n))-.5*t})}function g(e,t,r,i=0){t-=i,r&&(t*=Math.SQRT2);const o=.5*t;return v(e,(t,s)=>{let n,a=t-.5*e,l=.5*e-s-1;if(r){const e=(a+l)/Math.SQRT2;l=(l-a)/Math.SQRT2,a=e}return a=Math.abs(a),l=Math.abs(l),n=a>l?a>o?Math.sqrt((a-o)*(a-o)+l*l):l:l>o?Math.sqrt(a*a+(l-o)*(l-o)):a,n-=i/2,n})}function b(e,t,r){return(i,o)=>{const s=i-e,n=o-t;return Math.sqrt(s*s+n*n)-r}}function _(e,t,r){const i=Math.sqrt(t*t+r*r);return(o,s)=>{const n=Math.abs(o-e)-r,a=s-e+t/2+.75,l=(t*n+r*a)/i,c=-a;return Math.max(l,c)}}function v(e,t){const i=new Uint8Array(4*e*e);for(let o=0;o<e;o++)for(let s=0;s<e;s++){const n=s+e*o;let a=t(s,o);a=a/e+.5,r.packFloatRGBA(a,i,4*n)}return i}e.createArrow=m,e.createCircle=c,e.createCross=p,e.createKite=d,e.createPrimitive=l,e.createSquare=u,e.createTexture=function(e,t=128,r=t*s,i=0){const{data:n,parameters:l}=a(e,t,r,i);return new o.Texture(n,l)},e.createTextureInfo=a,e.createTriangle=f,e.createX=h,e.defaultBoundingBox=n,e.defaultSymbolSizeRatio=s,e.defaultTexSize=128,e.requiresHalfTexelOffset=function(e){return"cross"===e||"x"===e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(e,t){"use strict";function r(e,t=0){let r=0;for(let i=0;i<4;i++)r+=e[t+i]*o[i];return r}const i=[1,256,65536,16777216],o=[1/256,1/65536,1/16777216,1/4294967296],s=r(new Uint8ClampedArray([255,255,255,255])),n=r(new Uint8ClampedArray([255,255,255,0]));function a(e){return e-Math.floor(e)}e.maxRgbFloat=n,e.maxRgbaFloat=s,e.packFloatRGB=function(e,r,o=0){const s=t.clamp(e,0,n);for(let e=0;e<3;e++)r[o+e]=Math.floor(256*a(s*i[e]))},e.packFloatRGBA=function(e,r,o=0){const n=t.clamp(e,0,s);for(let e=0;e<4;e++)r[o+e]=Math.floor(256*a(n*i[e]))},e.unpackFloatRGBA=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define(["exports","../../../../core/has","../../../../core/Error","../../../../core/Evented","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/typedArrayUtil","../../../../core/uid","../../../../core/urlUtils","../../../../layers/support/videoUtils","../../../../support/requestImageUtils","../../../../support/requestUtils","./BasisUtil","./DDSUtil","./textureUtils","./Util","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g){"use strict";function b(e){return e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e}const _={wrap:{s:10497,t:10497},mipmap:!0,noUnpackFlip:!1,preMultiplyAlpha:!1};e.Texture=class{constructor(e,t){this._data=e,this.id=a.generateUID(),this.events=new i.EventEmitter,this._parameters={..._,...t},this._startPreload(e)}dispose(){this.unload(),this._data=this.update=void 0}_startPreload(e){e instanceof HTMLVideoElement?(this.update=t=>this._update(e,t),this._startPreloadVideoElement(e)):e instanceof HTMLImageElement&&this._startPreloadImageElement(e)}_startPreloadVideoElement(e){if(!(l.isBlobProtocol(e.src)||"auto"===e.preload&&e.crossOrigin)&&(e.preload="auto",e.crossOrigin="anonymous",e.src=e.src,e.paused&&e.autoplay)){const t=[];c.whenVideoPlayable(e,e=>t.push(e)).then(()=>{e.play()}).finally(()=>t.forEach(e=>e.remove()))}}_startPreloadImageElement(e){l.isDataProtocol(e.src)||l.isBlobProtocol(e.src)||e.crossOrigin||(e.crossOrigin="anonymous",e.src=e.src)}_createDescriptor(e){const t=new g.TextureDescriptor;return t.wrapMode=this._parameters.wrap??10497,t.flipped=!this._parameters.noUnpackFlip,t.samplingMode=this._parameters.mipmap?9987:9729,t.hasMipmap=!!this._parameters.mipmap,t.preMultiplyAlpha=!!this._parameters.preMultiplyAlpha,t.maxAnisotropy=this._parameters.maxAnisotropy??(this._parameters.mipmap?e.parameters.maxMaxAnisotropy:1),t}get glTexture(){return this._glTexture??this._emptyTexture}get loaded(){return null!=this._glTexture}get usedMemory(){return this._glTexture?.usedMemory||function(e,t){if(null==e)return 0;if(n.isArrayBuffer(e)||n.isUint8Array(e))return"image/ktx2"===t.encoding?p.estimateMemoryKTX2(e,!!t.mipmap):"image/x.basis"===t.encoding?p.estimateMemoryBasis(e,!!t.mipmap):e.byteLength;const{width:r,height:i}=e instanceof Image||e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?b(e):t;return(t.mipmap?4/3:1)*r*i*(t.components||4)||0}(this._data,this._parameters)}load(e){if(this._loadingPromise)return this._loadingPromise;if(this._glTexture)return this._glTexture;const t=this._data;return null==t?(this._glTexture=new y.Texture(e,this._createDescriptor(e),null),this._glTexture):(this._emptyTexture=e.emptyTexture,this._parameters.reloadable||(this._data=void 0),"string"==typeof t?this._loadFromURL(e,t):t instanceof Image?this._loadFromImageElement(e,t):t instanceof HTMLVideoElement?this._loadFromVideoElement(e,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this._loadFromImage(e,t):n.isUint8Array(t)&&"image/vnd-ms.dds"===this._parameters.encoding?this._loadFromDDSData(e,t):n.isArrayBuffer(t)&&"image/vnd-ms.dds"===this._parameters.encoding?this._loadFromDDSData(e,new Uint8Array(t)):(n.isArrayBuffer(t)||n.isUint8Array(t))&&"image/ktx2"===this._parameters.encoding?this._loadFromKTX2(e,t):(n.isArrayBuffer(t)||n.isUint8Array(t))&&"image/x.basis"===this._parameters.encoding?this._loadFromBasis(e,t):n.isUint8Array(t)?this._loadFromPixelData(e,t):n.isArrayBuffer(t)?this._loadFromPixelData(e,new Uint8Array(t)):null)}_update(e,t){return null==this._glTexture||e.readyState<HTMLMediaElement.HAVE_CURRENT_DATA||t===e.currentTime?t:(this._glTexture.setData(e),this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap(),this._parameters.updateCallback&&this._parameters.updateCallback(),e.currentTime)}_loadFromDDSData(e,t){return this._glTexture=h.createDDSTexture(e,this._createDescriptor(e),t),this._emptyTexture=null,this._glTexture}_loadFromKTX2(e,t){return this._loadAsync(()=>p.createTextureKTX2(e,this._createDescriptor(e),t).then(e=>(this._glTexture=e,e)))}_loadFromBasis(e,t){return this._loadAsync(()=>p.createTextureBasis(e,this._createDescriptor(e),t).then(e=>(this._glTexture=e,e)))}_loadFromPixelData(e,t){m.assert(this._parameters.width>0&&this._parameters.height>0);const r=this._createDescriptor(e);return r.pixelFormat=1===this._parameters.components?6409:3===this._parameters.components?6407:6408,6407!==r.pixelFormat&&6408!==r.pixelFormat||(r.compress=this._parameters.compressionOptions),r.width=this._parameters.width??0,r.height=this._parameters.height??0,this._glTexture=new y.Texture(e,r,t),this._glTexture}_loadFromURL(e,t){return this._loadAsync(async r=>{const i=await u.requestImage(t,{signal:r});return s.throwIfAborted(r),this._loadFromImage(e,i)})}_loadFromImageElement(e,t){return t.complete?this._loadFromImage(e,t):this._loadAsync(async r=>{const i=await d.loadImageAsync(t,t.src,!1,r);return s.throwIfAborted(r),this._loadFromImage(e,i)})}_loadFromVideoElement(e,t){return t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?this._loadFromImage(e,t):this._loadFromVideoElementAsync(e,t)}_loadFromVideoElementAsync(e,t){return this._loadAsync(i=>new Promise((n,a)=>{const l=()=>{t.removeEventListener("loadeddata",c),t.removeEventListener("error",u),o.removeMaybe(d)},c=()=>{t.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA&&(l(),n(this._loadFromImage(e,t)))},u=e=>{l(),a(e||new r("texture:load-error","Failed to load video"))};t.addEventListener("loadeddata",c),t.addEventListener("error",u);const d=s.onAbort(i,()=>u(s.createAbortError()))}))}_loadFromImage(e,t){let r=t;r instanceof HTMLVideoElement||(r=f.ensureImageMaxSize(r,e.parameters));const i=b(r);this._parameters.width=i.width,this._parameters.height=i.height;const o=this._createDescriptor(e);return o.pixelFormat=3===this._parameters.components?6407:6408,o.width=i.width,o.height=i.height,o.compress=this._parameters.compressionOptions,this._glTexture=new y.Texture(e,o,r),this._emptyTexture=null,this.events.emit("loaded"),this._glTexture}_loadAsync(e){const t=new AbortController;this._loadingController=t;const r=e(t.signal);this._loadingPromise=r;const i=()=>{this._loadingController===t&&(this._loadingController=null),this._loadingPromise===r&&(this._loadingPromise=null),this._emptyTexture=null};return r.then(i,i),r}unload(){if(this._glTexture=o.disposeMaybe(this._glTexture),this._emptyTexture=null,null!=this._loadingController){const e=this._loadingController;this._loadingController=null,this._loadingPromise=null,e.abort()}this.events.emit("unloaded")}get parameters(){return this._parameters}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/videoUtils":function(){define(["exports","../../core/events"],function(e,t){"use strict";e.whenVideoPlayable=function(e,r){return new Promise((i,o)=>{e.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?i():(r(t.once(e,"canplay",i)),r(t.once(e,"error",o)))})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(e,t){"use strict";e.requestImage=async function(e,r){const{data:i}=await t(e,{responseType:"image",...r});return i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define(["exports","../../../../libs/basisu/BasisUTranscoder","../../../webgl/enums","../../../webgl/Texture","../../../webgl/Util"],function(e,t,r,i,o){"use strict";let s=null,n=null;async function a(){return null==n&&(n=t.getBasisTranscoder(),s=await n),n}function l(e,t,i,s,n){const a=o.getBytesPerElementFormat(t?r.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:r.CompressedTextureFormat.COMPRESSED_RGB8_ETC2),l=n&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(i*s*a*l)}function c(e){return e.getNumImages()>=1&&!e.isUASTC()}function u(e){return e.getFaces()>=1&&e.isETC1S()}function d(e,t,o,s,n,a,l,c){const{compressedTextureETC:u,compressedTextureS3TC:d}=e.capabilities,[p,h]=u?s?[1,r.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[0,r.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:d?s?[3,r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[2,r.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[13,6408],f=t.hasMipmap?o:Math.min(1,o),m=[];for(let e=0;e<f;e++)m.push(new Uint8Array(l(e,p))),c(e,p,m[e]);return t.internalFormat=h,t.hasMipmap=m.length>1,t.samplingMode=t.hasMipmap?9987:9729,t.width=n,t.height=a,new i.Texture(e,t,{type:"compressed",levels:m})}e.checkKTX2=u,e.createTextureBasis=async function(e,t,r){null==s&&(s=await a());const i=new s.BasisFile(new Uint8Array(r));if(!c(i))return null;i.startTranscoding();const o=d(e,t,i.getNumLevels(0),i.getHasAlpha(),i.getImageWidth(0,0),i.getImageHeight(0,0),(e,t)=>i.getImageTranscodedSizeInBytes(0,e,t),(e,t,r)=>i.transcodeImage(r,0,e,t,0,0));return i.close(),i.delete(),o},e.createTextureKTX2=async function(e,t,r){null==s&&(s=await a());const i=new s.KTX2File(new Uint8Array(r));if(!u(i))return null;i.startTranscoding();const o=d(e,t,i.getLevels(),i.getHasAlpha(),i.getWidth(),i.getHeight(),(e,t)=>i.getImageTranscodedSizeInBytes(e,0,0,t),(e,t,r)=>i.transcodeImage(r,e,0,0,t,0,-1,-1));return i.close(),i.delete(),o},e.estimateMemoryBasis=function(e,t){if(null==s)return e.byteLength;const r=new s.BasisFile(new Uint8Array(e)),i=c(r)?l(r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),t):0;return r.close(),r.delete(),i},e.estimateMemoryKTX2=function(e,t){if(null==s)return e.byteLength;const r=new s.KTX2File(new Uint8Array(e)),i=u(r)?l(r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),t):0;return r.close(),r.delete(),i},e.loadBasisTranscoder=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/BasisUTranscoder":function(){define(["require","exports","../../assets"],function(e,t,r){"use strict";let i;t.getBasisTranscoder=function(){return i??=(async()=>{const t=await new Promise((t,r)=>e(["../../chunks/basis_transcoder"],t,r)),i=await t.default({locateFile:e=>r.getAssetUrl(`esri/libs/basisu/${e}`)});return i.initializeBasis(),i})(),i},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger","../../core/maybe","../../core/object","../../core/promiseUtils","./checkWebGLError","./enums","./TextureDescriptor","./textureUtils","./ValidatedTextureDescriptor"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";const p=!!r("esri-tests-disable-gpu-memory-measurements"),h=()=>i.getLogger("esri/views/webgl/Texture");let f=class e{static{this.TEXTURE_UNIT_FOR_UPDATES=0}static{this.compressionWorkerHandle=null}constructor(e,r=null,i=null){if(this.type=1,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._shadowFilterDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const i=d.ValidatedTextureDescriptor.validate(e,r);if(!i)throw new t("texture:invalid-descriptor","Texture descriptor invalid");this._descriptor=i}34067===this._descriptor.target?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return p?0:c.estimateMemory(this._descriptor)}get cachedMemory(){return this.usedMemory}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty||this._shadowFilterDirty}get hasWebGLTextureObject(){return!!this._glName}dispose(){this.abortCompression(),this.hasWebGLTextureObject&&this._descriptor.context?.gl&&(this._descriptor.context.instanceCounter.decrement(l.ResourceType.Texture,this),this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor=null)}release(){this.dispose()}[Symbol.dispose](){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new t("texture:immutable-resize","Immutable textures can't be resized!");i.width=e,i.height=r,34067===this._descriptor.target?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.compress=e}disableCompression(){this._descriptor.compress=void 0}setData(e){this.abortCompression(),!u.isCompressedData(e)&&this._descriptor.internalFormat&&s.hasValue(l.CompressedTextureFormat,this._descriptor.internalFormat)&&(this._descriptor.internalFormat=void 0),this._setData(e),!u.isCompressedData(e)&&this._descriptor.compress&&this._compressOnWorker(e)}updateData(r,i,o,s,n,a,l=0){a||h().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||h().error("An attempt to update uninitialized texture!");const c=this._descriptor;c.internalFormat=u.deriveInternalFormat(c);const{context:d,pixelFormat:p,dataType:f,target:m,isImmutable:y}=c;if(y&&!this._wasImmutablyAllocated)throw new t("texture:uninitialized","Cannot update immutable texture before allocation!");const g=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||o<0||i+s>c.width||o+n>c.height)&&h().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:b}=d;l&&(s&&n||h().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),b.pixelStorei(b.UNPACK_SKIP_ROWS,l)),u.isTexImageSource(a)?b.texSubImage2D(m,r,i,o,s,n,p,f,a):u.isCompressedData(a)?b.compressedTexSubImage2D(m,r,i,o,s,n,c.internalFormat,a.levels[r]):b.texSubImage2D(m,r,i,o,s,n,p,f,a),l&&b.pixelStorei(b.UNPACK_SKIP_ROWS,0),d.bindTexture(g,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(r,i,o,s,n,a,l,c){c||h().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||h().error("An attempt to update an uninitialized texture!");const d=this._descriptor;d.internalFormat=u.deriveInternalFormat(d);const{context:p,pixelFormat:f,dataType:m,isImmutable:y,target:g}=d;if(y&&!this._wasImmutablyAllocated)throw new t("texture:uninitialized","Cannot update immutable texture before allocation!");u.is3DTarget(g)||h().warn("Attempting to set 3D texture data on a non-3D texture");const b=p.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);p.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(i<0||o<0||s<0||i+n>d.width||o+a>d.height||s+l>d.depth)&&h().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:_}=p;if(u.isCompressedData(c))c=c.levels[r],_.compressedTexSubImage3D(g,r,i,o,s,n,a,l,d.internalFormat,c);else{const e=c;_.texSubImage3D(g,r,i,o,s,n,a,l,f,m,e)}p.bindTexture(b,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const r=this._descriptor;if(0===r.width||0===r.height)return;if(!r.hasMipmap){if(this._wasImmutablyAllocated)throw new t("texture:immutable-change","Cannot add mipmaps to immutable texture after allocation");r.hasMipmap=!0,this._samplingModeDirty=!0,u.validateTexture(r)}9729===r.samplingMode?(this._samplingModeDirty=!0,r.samplingMode=9985):9728===r.samplingMode&&(this._samplingModeDirty=!0,r.samplingMode=9984);const i=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(r.target),this._descriptor.context.bindTexture(i,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new t("texture:immutable-change","Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,u.validateTexture(e)}9985===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9729):9984===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9728)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,u.validateTexture(this._descriptor),this._wrapModeDirty=!0)}setShadowFiltering(e){e!==this._descriptor.linearFilterDepth&&(this._descriptor.linearFilterDepth=this._descriptor.compareEnabled=e,this.setSamplingMode(e?9729:9728),u.validateTexture(this._descriptor),this._shadowFilterDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1),this._shadowFilterDirty&&(this._applyShadowMode(),this._shadowFilterDirty=!1)}abortCompression(){this._compressionAbortController=o.abortMaybe(this._compressionAbortController)}_setData(r,i){const o=this._descriptor,s=o.context?.gl;if(!s)return;a.checkWebGLError(s),this.hasWebGLTextureObject||(this._glName=s.createTexture(),o.context.instanceCounter.increment(l.ResourceType.Texture,this)),u.validateTexture(o);const n=o.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);o.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),a.checkWebGLError(s);const c=i??o.target,d=u.is3DTarget(c);if(u.isTexImageSource(r))this._setDataFromTexImageSource(r,c);else{const{width:e,height:i,depth:n}=o;if(null==e||null==i)throw new t("texture:missing-size","Width and height must be specified!");if(d&&null==n)throw new t("texture:missing-depth","Depth must be specified!");if(o.internalFormat=u.deriveInternalFormat(o),o.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(c,o.internalFormat,o.hasMipmap,e,i,n),u.isCompressedData(r)){if(!u.isCompressedFormat(o.internalFormat))throw new t("texture:format-mismatch","Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(r,o.internalFormat,c)}else this._texImage(c,0,o.internalFormat,e,i,n,r),a.checkWebGLError(s),o.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),this._applyShadowMode(),a.checkWebGLError(s),o.context.bindTexture(n,e.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let t=34069;t<=34074;t++)this._setData(e,t)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_setDataFromTexImageSource(e,t){const{gl:r}=this._descriptor.context,i=this._descriptor;i.internalFormat=u.deriveInternalFormat(i);const o=u.is3DTarget(t),{width:s,height:n,depth:l}=u.getDimensions(e);i.width&&i.height,i.width||(i.width=s),i.height||(i.height=n),o&&i.depth,o&&(i.depth=l),i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,i.internalFormat,i.hasMipmap,s,n,l),this._texImage(t,0,i.internalFormat,s,n,l,e),a.checkWebGLError(r),i.hasMipmap&&(this.generateMipmap(),a.checkWebGLError(r))}_setDataFromCompressedSource(e,t,r){const i=this._descriptor,{width:o,height:s,depth:n}=i,a=e.levels,l=u.calcMipmapLevels(r,o,s,n),c=Math.min(l,a.length)-1;this._descriptor.context.gl.texParameteri(i.target,33085,c),this._forEachMipmapLevel((e,i,o,s)=>{const n=a[Math.min(e,a.length-1)];this._compressedTexImage(r,e,t,i,o,s,n)},c)}_texStorage(e,r,i,o,s,n){const{gl:a}=this._descriptor.context;if(!u.isSizedPixelFormat(r)&&!u.isSizedDepthFormat(r)&&!u.isSizedDepthStencilFormat(r))throw new t("texture:missing-format","Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const l=i?u.calcMipmapLevels(e,o,s,n):1;if(u.is3DTarget(e)){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");a.texStorage3D(e,l,r,o,s,n)}else a.texStorage2D(e,l,r,o,s);this._wasImmutablyAllocated=!0}_texImage(e,r,i,o,s,n,a){const l=this._descriptor.context.gl,c=u.is3DTarget(e),{isImmutable:d,pixelFormat:p,dataType:h}=this._descriptor;if(d){if(null!=a){const i=a;if(c){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");l.texSubImage3D(e,r,0,0,0,o,s,n,p,h,i)}else l.texSubImage2D(e,r,0,0,o,s,p,h,i)}}else{const u=a;if(c){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");l.texImage3D(e,r,i,o,s,n,0,p,h,u)}else l.texImage2D(e,r,i,o,s,0,p,h,u)}}_compressedTexImage(e,r,i,o,s,n,a){const l=this._descriptor.context.gl,c=u.is3DTarget(e);if(this._descriptor.isImmutable){if(null!=a)if(c){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");l.compressedTexSubImage3D(e,r,0,0,0,o,s,n,i,a)}else l.compressedTexSubImage2D(e,r,0,0,o,s,i,a)}else if(c){if(null==n)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");l.compressedTexImage3D(e,r,i,o,s,n,0,a)}else l.compressedTexImage2D(e,r,i,o,s,0,a)}async _compressOnWorker(t){const{width:r,height:i,context:o,flipped:s,preMultiplyAlpha:a,hasMipmap:l}=this._descriptor,c=this._descriptor.compress?.compressionTracker,u=this._descriptor.compress?.compressionCallback,{compressedTextureETC:d,compressedTextureS3TC:p}=o.capabilities;if(!e.compressionWorkerHandle?.isCompressible(t,this._descriptor)||!d&&!p)return;this.abortCompression();const f=new AbortController;this._compressionAbortController=f,c?.increment();try{let o;t instanceof Uint8Array?o=t.buffer:(o=await createImageBitmap(t,{imageOrientation:s?"flipY":"none"}),n.throwIfAborted(f));const c={data:o,width:r,height:i,needsFlip:t instanceof Uint8Array&&this.descriptor.flipped,components:6408===this._descriptor.pixelFormat?4:3,preMultiplyAlpha:a,hasMipmap:l,hasETC:!!d,hasS3TC:!!p},h=await e.compressionWorkerHandle.invoke(c,f.signal,"low");if(n.throwIfAborted(f),h.compressedTexture&&this.hasWebGLTextureObject){const e=this.usedMemory;this._descriptor.internalFormat=h.internalFormat,this._setData(h.compressedTexture),u?.(e-this.usedMemory)}}catch(e){n.isAbortError(e)||h().error("Texture compression failed!")}finally{c?.decrement(),this._compressionAbortController?.signal.aborted&&(this._compressionAbortController=null)}}_forEachMipmapLevel(e,r=1/0){let{width:i,height:o,depth:s,hasMipmap:n,target:a}=this._descriptor;const l=32879===a;if(null==i||null==o||l&&null==s)throw new t("texture:missing-size","Missing texture dimensions for mipmap calculation");for(let t=0;e(t,i,o,s),n&&(1!==i||1!==o||l&&1!==s)&&!(t>=r);++t)i=Math.max(1,i>>1),o=Math.max(1,o>>1),l&&(s=Math.max(1,s>>1))}_applySamplingMode(){const e=this._descriptor,t=e.context?.gl;let r=e.samplingMode,i=e.samplingMode;9985===r||9987===r?(r=9729,e.hasMipmap||(i=9729)):9984!==r&&9986!==r||(r=9728,e.hasMipmap||(i=9728)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}_applyWrapMode(){const e=this._descriptor,t=e.context?.gl;"number"==typeof e.wrapMode?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}_applyShadowMode(){const e=this._descriptor,t=e.context?.gl,r=e.compareEnabled?t.COMPARE_REF_TO_TEXTURE:t.NONE;t.texParameteri(e.target,t.TEXTURE_COMPARE_MODE,r),e.compareEnabled&&t.texParameteri(e.target,t.TEXTURE_COMPARE_FUNC,t.GREATER),a.checkWebGLError(t)}_applyAnisotropicFilteringParameters(){const e=this._descriptor,t=e.context.capabilities.textureFilterAnisotropic;t&&e.context.gl.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}};e.Texture=f,e.tracer=null,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(e,t,r,i){"use strict";function o(e){switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const s=!!r("enable-feature:webgl-debug");function n(){return s}e.checkWebGLError=function(e,r=n()){if(r){const r=o(e);if(r){const e=(new Error).stack;i.getLogger("esri.views.webgl.checkWebGLError").error(new t("webgl-error","WebGL error occurred",{message:r,stack:e}))}}},e.getErrorMessage=o,e.hasFeatureFlagWebGLDebug=s,e.webglDebugEnabled=n,e.webglValidateShadersEnabled=function(){return s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(e,t,r){"use strict";e.TextureDescriptor=class{constructor(e=0,r=e){this.width=e,this.height=r,this.type=0,this.target=3553,this.pixelFormat=6408,this.dataType=t.PixelType.UNSIGNED_BYTE,this.samplingMode=9729,this.wrapMode=10497,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.compareEnabled=!1,this.linearFilterDepth=!1,this.depth=1,this.isImmutable=!1}},e.estimateMemory=function(e){return e.width<=0||e.height<=0||e.depth<=0?0:Math.round(e.width*e.height*e.depth*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:r.getBytesPerElementFormat(e.internalFormat))*(34067===e.target?6:1))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./checkWebGLError","./enums"],function(e,t,r,i){"use strict";e.bindVertexBufferLayout=function(e,t,i,o=0){const s=e.gl;e.bindBuffer(i);for(const n of i.layout){const i=t.get(n.name);if(null==i){console.warn(`There is no location for vertex attribute '${n.name}' defined.`);continue}const a=o*n.stride;if(n.count<=4)s.vertexAttribPointer(i,n.count,n.type,n.normalized,n.stride,n.offset+a),s.enableVertexAttribArray(i),n.divisor>0&&s.vertexAttribDivisor(i,n.divisor);else if(9===n.count)for(let e=0;e<3;e++)s.vertexAttribPointer(i+e,3,n.type,n.normalized,n.stride,n.offset+12*e+a),s.enableVertexAttribArray(i+e),n.divisor>0&&s.vertexAttribDivisor(i+e,n.divisor);else if(16===n.count)for(let e=0;e<4;e++)s.vertexAttribPointer(i+e,4,n.type,n.normalized,n.stride,n.offset+16*e+a),s.enableVertexAttribArray(i+e),n.divisor>0&&s.vertexAttribDivisor(i+e,n.divisor);else console.error("Unsupported vertex attribute element count: "+n.count);if(r.webglDebugEnabled()){const t=r.getErrorMessage(e.gl);t&&console.error(`Unable to bind vertex attribute "${n.name}" with baseInstanceOffset ${a}:`,t,n)}}},e.getBytesPerElementFormat=function(e){switch(e){case 6406:case 6409:case 6403:case 36244:case i.SizedPixelFormat.R8:case i.SizedPixelFormat.R8I:case i.SizedPixelFormat.R8UI:case i.SizedPixelFormat.R8_SNORM:case 36168:return 1;case 6410:case 33319:case 33320:case i.SizedPixelFormat.RGBA4:case i.SizedPixelFormat.R16F:case i.SizedPixelFormat.R16I:case i.SizedPixelFormat.R16UI:case i.SizedPixelFormat.RG8:case i.SizedPixelFormat.RG8I:case i.SizedPixelFormat.RG8UI:case i.SizedPixelFormat.RG8_SNORM:case i.SizedPixelFormat.RGB565:case i.SizedPixelFormat.RGB5_A1:case i.SizedDepthFormat.DEPTH_COMPONENT16:return 2;case 6407:case 36248:case i.SizedPixelFormat.RGB8:case i.SizedPixelFormat.RGB8I:case i.SizedPixelFormat.RGB8UI:case i.SizedPixelFormat.RGB8_SNORM:case i.SizedPixelFormat.SRGB8:case i.SizedDepthFormat.DEPTH_COMPONENT24:return 3;case 6408:case 36249:case i.SizedPixelFormat.RGBA8:case i.SizedPixelFormat.R32F:case i.SizedPixelFormat.R11F_G11F_B10F:case i.SizedPixelFormat.RG16F:case i.SizedPixelFormat.R32I:case i.SizedPixelFormat.R32UI:case i.SizedPixelFormat.RG16I:case i.SizedPixelFormat.RG16UI:case i.SizedPixelFormat.RGBA8I:case i.SizedPixelFormat.RGBA8UI:case i.SizedPixelFormat.RGBA8_SNORM:case i.SizedPixelFormat.SRGB8_ALPHA8:case i.SizedPixelFormat.RGB9_E5:case i.SizedPixelFormat.RGB10_A2UI:case i.SizedPixelFormat.RGB10_A2:case i.SizedDepthFormat.DEPTH_COMPONENT32F:case i.SizedDepthStencilFormat.DEPTH24_STENCIL8:return 4;case i.SizedDepthStencilFormat.DEPTH32F_STENCIL8:return 5;case i.SizedPixelFormat.RGB16F:case i.SizedPixelFormat.RGB16I:case i.SizedPixelFormat.RGB16UI:return 6;case i.SizedPixelFormat.RG32F:case i.SizedPixelFormat.RG32I:case i.SizedPixelFormat.RG32UI:case i.SizedPixelFormat.RGBA16F:case i.SizedPixelFormat.RGBA16I:case i.SizedPixelFormat.RGBA16UI:return 8;case i.SizedPixelFormat.RGB32F:case i.SizedPixelFormat.RGB32I:case i.SizedPixelFormat.RGB32UI:return 12;case i.SizedPixelFormat.RGBA32F:case i.SizedPixelFormat.RGBA32I:case i.SizedPixelFormat.RGBA32UI:return 16;case i.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case i.CompressedTextureFormat.COMPRESSED_R11_EAC:case i.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case i.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case i.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case i.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case i.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case i.CompressedTextureFormat.COMPRESSED_RG11_EAC:case i.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case i.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case i.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/textureUtils":function(){define(["exports","../../core/Error","../../core/Logger","../../core/object","./enums"],function(e,t,r,i,o){"use strict";const s=()=>r.getLogger("esri/views/webgl/textureUtils");function n(e){return i.hasValue(o.SizedDepthFormat,e)}function a(e){return i.hasValue(o.SizedDepthStencilFormat,e)}function l(e){return null!=e&&i.hasValue(o.CompressedTextureFormat,e)}function c(e){return null!=e&&"type"in e&&"compressed"===e.type}function u(e){return null!=e&&"byteLength"in e}e.calcMipmapLevels=function(e,t,r,i=1){let o=Math.max(t,r);return 32879===e&&(o=Math.max(o,i)),Math.floor(Math.log2(o))+1},e.deriveInternalFormat=function(e){if(null!=e.internalFormat)return e.internalFormat;switch(e.dataType){case o.PixelType.FLOAT:switch(e.pixelFormat){case 6408:return o.SizedPixelFormat.RGBA32F;case 6407:return o.SizedPixelFormat.RGB32F;default:throw new t("texture:unknown-format","Unable to derive format")}case o.PixelType.UNSIGNED_BYTE:switch(e.pixelFormat){case 6408:return o.SizedPixelFormat.RGBA8;case 6407:return o.SizedPixelFormat.RGB8}}const{pixelFormat:r}=e;return e.internalFormat=34041===r?o.SizedDepthStencilFormat.DEPTH24_STENCIL8:6402===r?o.SizedDepthFormat.DEPTH_COMPONENT24:r,e.internalFormat},e.getDimensions=function(e){let t="width"in e?e.width:e.codedWidth,r="height"in e?e.height:e.codedHeight;return e instanceof HTMLVideoElement&&(t=e.videoWidth,r=e.videoHeight),{width:t,height:r,depth:1}},e.is3DTarget=function(e){return 32879===e||35866===e},e.isArrayBufferView=u,e.isCompressedData=c,e.isCompressedFormat=l,e.isCompressedTexture=function(e){return l(e.descriptor.internalFormat)},e.isSizedDepthFormat=n,e.isSizedDepthStencilFormat=a,e.isSizedPixelFormat=function(e){return o.sizedPixelFormatValues.includes(e)},e.isTexImageSource=function(e){return null!=e&&!c(e)&&!u(e)},e.validateTexture=function(e){const{width:t,height:r,depth:i}=e;(null!=t&&t<0||null!=r&&r<0||null!=i&&i<0)&&s().error("Negative dimension parameters are not allowed!");const{internalFormat:o}=e;if(o&&(n(o)||a(o))){const{linearFilterDepth:t,compareEnabled:r,samplingMode:i,hasMipmap:o}=e;o&&s().error("Depth textures cannot have mipmaps"),t?9729!==i&&9728!==i&&s().error("Depth textures cannot sample mipmaps"):(9728!==i&&s().error("Depth textures without filtering must use NEAREST filtering"),r&&s().error("Depth textures without filtering cannot use compare function"))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(e,t,r){"use strict";class i extends r.TextureDescriptor{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case t.SizedPixelFormat.R16F:case t.SizedPixelFormat.R32F:case t.SizedPixelFormat.R8_SNORM:case t.SizedPixelFormat.R8:this.pixelFormat=6403;break;case t.SizedPixelFormat.R8I:case t.SizedPixelFormat.R8UI:case t.SizedPixelFormat.R16I:case t.SizedPixelFormat.R16UI:case t.SizedPixelFormat.R32I:case t.SizedPixelFormat.R32UI:this.pixelFormat=36244}}static validate(e,t){return new i(e,t)}}e.ValidatedTextureDescriptor=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports","../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],function(e,t,r,i){"use strict";const o=()=>t.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function s(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const n=s("DXT1"),a=s("DXT3"),l=s("DXT5");function c(e,t){const i=new Int32Array(e.buffer,e.byteOffset,31);if(542327876!==i[0])return o().error("Invalid magic number in DDS header"),null;if(!(4&i[20]))return o().error("Unsupported format, must contain a FourCC code"),null;const s=i[21];let c,u;switch(s){case n:c=8,u=r.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case a:c=16,u=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case l:c=16,u=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return o().error("Unsupported FourCC code:",(d=s,String.fromCharCode(255&d,d>>8&255,d>>16&255,d>>24&255))),null}var d;let p=1,h=i[4],f=i[3];(3&h||3&f)&&(o().warn("Rounding up compressed texture size to nearest multiple of 4."),h=h+3&-4,f=f+3&-4);const m=h,y=f;let g,b;131072&i[2]&&!1!==t&&(p=Math.max(1,i[7]));let _=e.byteOffset+i[1]+4;const v=[];for(let t=0;t<p;++t)b=(h+3>>2)*(f+3>>2)*c,g=new Uint8Array(e.buffer,_,b),v.push(g),_+=b,h=Math.max(1,h>>1),f=Math.max(1,f>>1);return{textureData:{type:"compressed",levels:v},internalFormat:u,width:m,height:y}}e.createDDSTexture=function(e,t,r){const o=c(r,t.hasMipmap??!1);if(null==o)throw new Error("DDS texture data is null");const{textureData:s,internalFormat:n,width:a,height:l}=o;return t.samplingMode=s.levels.length>1?9987:9729,t.hasMipmap=s.levels.length>1,t.internalFormat=n,t.width=a,t.height=l,new i.Texture(e,t,s)},e.createDDSTextureData=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/textureUtils":function(){define(["exports","../../../../core/Error"],function(e,t){"use strict";const r=16;function i(e,t){return t=Math.floor(t/r)*r,Math.min(Math.round(e/r)*r,t)}function o({width:e,height:t},{maxPreferredTexturePixels:r,maxTextureSize:o}){const s=Math.max(e,t),n=e*t;if(s<=o&&n<=r)return[e,t];const a=Math.min(Math.sqrt(r/n),o/s);return[i(Math.round(e*a),o),i(Math.round(t*a),o)]}function s(e,r,i){if(e instanceof ImageData)return s(function(e){const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const i=r.getContext("2d");if(null==i)throw new t("texture:context-failed","Failed to create 2d context from HTMLCanvasElement");return i.putImageData(e,0,0),r}(e),r,i);const o=document.createElement("canvas");return o.width=r,o.height=i,o.getContext("2d").drawImage(e,0,0,o.width,o.height),o}e.applyTextureResizeModulo=i,e.applyTextureResizeModuloCeil=function(e,t){return t=Math.floor(t/r)*r,Math.min(Math.ceil(e/r)*r,t)},e.ensureImageMaxSize=function(e,t){const[r,i]=o(e,t);return e.width===r&&e.height===i?e:s(e,r,i)},e.ensureTextureSize=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64"],function(e,t,r,i){"use strict";const o=i.create();class s{constructor(e){this.message=e}toString(){return`AssertException: ${this.message}`}}function n(e,t="Assertion"){if(!e){const e=new Error(t).stack;throw new s(`${t} at ${e}`)}}e.assert=n,e.isTranslationMatrix=function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&1===e[15]},e.logWithBase=function(e,t){return Math.log(e)/Math.log(t)},e.project=function(e,t,i,s,a){o[0]=e[0],o[1]=e[1],o[2]=e[2],o[3]=1,r.transformMat4(o,o,t),a.length>2&&(a[2]=-o[2]),r.transformMat4(o,o,i),n(0!==o[3]),a[0]=o[0]/o[3],a[1]=o[1]/o[3],a[2]=o[2]/o[3],a[0]=(.5*a[0]+.5)*s[2]+s[0],a[1]=(.5*a[1]+.5)*s[3]+s[1]},e.rayBoxTest=function(e,t,r,i){let o,s=(r[0]-e[0])/t[0],n=(i[0]-e[0])/t[0];s>n&&(o=s,s=n,n=o);let a=(r[1]-e[1])/t[1],l=(i[1]-e[1])/t[1];if(a>l&&(o=a,a=l,l=o),s>l||a>n)return!1;a>s&&(s=a),l<n&&(n=l);let c=(r[2]-e[2])/t[2],u=(i[2]-e[2])/t[2];return c>u&&(o=c,c=u,u=o),!(s>u||c>n||(u<n&&(n=u),n<0))},e.rayRay2D=function(e,r,i,o,s,n=t.create()){const a=(o[s]-i[s])*(r[0]-e[0])-(o[0]-i[0])*(r[s]-e[s]),l=(o[0]-i[0])*(e[s]-i[s])-(o[s]-i[s])*(e[0]-i[0]);if(0===a)return!1;const c=l/a;return n[0]=e[0]+c*(r[0]-e[0]),n[1]=e[s]+c*(r[s]-e[s]),!0},e.setMatrixTranslation3=function(e,t,r,i){e[12]=t,e[13]=r,e[14]=i},e.verify=function(e,t){e||(t=t||"",console.warn("Verify failed: "+t+"\n"+new Error("verify").stack))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports"],function(e){"use strict";class t{constructor(e,t,r=t){this.data=e,this.size=t,this.stride=r}}e.Attribute=class extends t{constructor(e,t,r,i=!1,o=r){super(e,r,o),this.indices=t,this.exclusive=i}},e.Vertices=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/symbolization/Point3DSymbolRenderer":function(){define(["exports"],function(e){"use strict";e.Point3DSymbolRenderer=class{constructor(e,t){this._loaded=!1,this._loadingPromise=null,this._context=null,this._symbol=null,this._symbolLayerRenderers=[],this._context=t,this._symbol=e}_destroy(){}get loaded(){return this._loaded}load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}async _load(){const{_context:e,_symbol:t,_symbolLayerRenderers:r}=this,i=[];for(const o of t.symbolLayers){const t=e.symbolRendererFactory.createSymbolRendererFromSymbolLayer(o);null!=t&&(i.push(t.load()),r.push(t))}await Promise.all(i),this._loaded=!0}async createDestroyCommand(){const{_context:e,_symbolLayerRenderers:t}=this,r=[];for(const e of t)r.push(e.createDestroyCommand());const i=e.joinPipelineCommands(await Promise.all(r));return i.appendPipelineStateCommand(()=>this._destroy()),i}async createAddCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createAddCommand(e));return t.joinPipelineCommands(await Promise.all(i))}async createRemoveCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createRemoveCommand(e));return t.joinPipelineCommands(await Promise.all(i))}async createUpdateVisibilityCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createUpdateVisibilityCommand(e));return t.joinPipelineCommands(await Promise.all(i))}async createUpdateLayerViewOpacityCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createUpdateLayerViewOpacityCommand(e));return t.joinPipelineCommands(await Promise.all(i))}async createUpdateElevationCommand(e){const{_context:t,_symbolLayerRenderers:r}=this,i=[];for(const t of r)i.push(t.createUpdateElevationCommand(e));return t.joinPipelineCommands(await Promise.all(i))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/symbolization/SimpleFeatureRenderer":function(){define(["exports"],function(e){"use strict";e.SimpleFeatureRenderer=class{constructor(e,t){this._symbol=null,this._featureData=new Map,this._loaded=!1,this._loadingPromise=null,this._renderer=null,this._context=t,this._renderer=e}async load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}async _load(){const{_renderer:e,_context:t}=this;this._symbol=t.symbolRendererFactory.createSymbolRendererFromSymbol(e.symbol),this._loaded=!0}get loaded(){return this._loaded}async createAddCommand(e){const t=this._context,r=await this._provisionSymbol(),i=null==r?t.createPipelineCommand():await r.createAddCommand(e);return i.appendPipelineStateCommand(()=>this._featureData.set(e.id,e)),i}async createRemoveCommand(e){const t=this._context,r=await this._provisionSymbol(),i=null==r?t.createPipelineCommand():await r.createRemoveCommand(e);return i.appendPipelineStateCommand(()=>this._featureData.delete(e)),i}async createUpdateVisibilityCommand(e){const t=this._context,r=await this._provisionSymbol();return null==r?t.createPipelineCommand():await r.createUpdateVisibilityCommand(e)}async createUpdateLayerViewOpacityCommand(e){const t=this._context,r=await this._provisionSymbol();return null==r?t.createPipelineCommand():await r.createUpdateLayerViewOpacityCommand(e)}async createUpdateElevationCommand(){const{_featureData:e,_context:t}=this,r=await this._provisionSymbol();if(null==r)return t.createPipelineCommand();const i=[];for(const t of e.values())i.push(r.createUpdateElevationCommand(t));const o=await Promise.all(i);return t.joinPipelineCommands(o)}async createDestroyCommand(){const{_symbol:e,_context:t,_featureData:r}=this;if(!e)return t.createPipelineCommand();const i=[];for(const e of r.keys())i.push(this.createRemoveCommand(e));i.push(e.createDestroyCommand());const o=await Promise.all(i);return t.joinPipelineCommands(o)}async _provisionSymbol(){const e=this._symbol;return e?(e.loaded||await e.load(),e):null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/symbolization/UniqueValueFeatureRenderer":function(){define(["exports","../PipelineCommand","../featureData/processingUtils","./factoryUtils","./IconSymbolLayerRenderer","./ObjectSymbolLayerRenderer"],function(e,t,r,i,o,s){"use strict";class n{constructor(e,t){this.index=e,this.features=t}}e.UniqueValueFeatureRenderer=class{constructor(e,t){this._symbols=new Array,this._featureDataPartitioning=new Map,this._loaded=!1,this._loadingPromise=null,this._renderer=null,this._context=t,this._renderer=e}async load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}async _load(){this._symbols[0]=new o.IconSymbolLayerRenderer(i.createDefaultIconSymbolLayer(),this._context),this._symbols[1]=new s.ObjectSymbolLayerRenderer(i.createDefaultObjectSymbolLayer(),this._context),this._loaded=!0}get loaded(){return this._loaded}async createAddCommand(e){const t=this._context,r=this._partition(e),i=await Promise.all(r.map(async({index:e,features:t})=>{const r=await this._provisionSymbol(e);return await(r?.createAddCommand(t))})),o=t.joinPipelineCommands(i);return o.appendPipelineStateCommand(()=>this._featureDataPartitioning.set(e.id,r)),o}async createRemoveCommand(e){const{_featureDataPartitioning:r,_context:i}=this,o=i.renderCommandContext,s=r.get(e);if(null==s)return new t.PipelineCommand(o,o.createRenderCommandBuffer(),[]);const n=await Promise.all(s.map(async({index:e,features:t})=>{const r=this._getLoadedSymbol(e);return await(r?.createRemoveCommand(t.id))})),a=i.joinPipelineCommands(n);return a.appendPipelineStateCommand(()=>r.delete(e)),a}async createUpdateVisibilityCommand(e){const{_featureDataPartitioning:r,_context:i}=this,o=i.renderCommandContext,s=r.get(e.id);if(null==s)return new t.PipelineCommand(o,o.createRenderCommandBuffer(),[]);const n=await Promise.all(s.map(async({index:e,features:t})=>{const r=this._getLoadedSymbol(e);return await(r?.createUpdateVisibilityCommand(t))}));return i.joinPipelineCommands(n)}async createUpdateLayerViewOpacityCommand(e){const t=this._context,r=[];for(let t=0;t<this._symbols.length;++t){const i=this._symbols[t];null!=i&&i.loaded&&r.push(i.createUpdateLayerViewOpacityCommand(e))}const i=await Promise.all(r);return t.joinPipelineCommands(i)}async createUpdateElevationCommand(){const{_featureDataPartitioning:e,_context:t}=this,r=[];for(const t of e.values()){const e=t.map(async({index:e,features:t})=>{const r=this._getLoadedSymbol(e);return await(r?.createUpdateElevationCommand(t))});r.push(...e)}const i=await Promise.all(r);return t.joinPipelineCommands(i)}async createDestroyCommand(){const{_featureDataPartitioning:e,_context:t}=this,r=[];for(const t of e.keys())r.push(this.createRemoveCommand(t));for(const e of this._symbols)r.push(e.createDestroyCommand());const i=await Promise.all(r);return t.joinPipelineCommands(i)}async _provisionSymbol(e){if(null==e)return null;const t=this._symbols[e];return t?(t.loaded||await t.load(),t):null}_getLoadedSymbol(e){if(null==e)return null;const t=this._symbols[e];return null!=t&&t.loaded?t:null}_partition(e){const t=r.readObjectIds(e);if(null==t)throw new Error("unable to fetch objectIds");const{featureCount:i}=e,o=[[],[]];for(let e=0;e<i;++e)o[t[e]%2].push(e);return o.map((t,r)=>new n(r,e.subset(new Uint32Array(t)))).filter(e=>e.features.featureCount>0)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/symbolization/ObjectSymbolLayerRenderer":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../../../geometry/projection/computeTranslationToOriginAndRotation","../../../../../../geometry/support/aaBoundingBox","../../../../../../symbols/support/ObjectSymbol3DLayerResource","../../../../../../symbols/support/symbolLayerUtils3D","../../graphicUtils","../../primitiveObjectSymbolUtils","../PipelineCommand","../featureData/processingUtils","./primitiveObjectUtils","../../../../webgl-engine/materials/DefaultMaterial","../../../../webgl-engine/materials/pbrUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";function y(e){return e?0:2}const g=i.create(),b=r.create(),_=r.create();e.ObjectSymbolLayerRenderer=class{constructor(e,t){this._loaded=!1,this._loadingPromise=null,this._primitiveMaterialId=null,this._lodRendererId=null,this._context=null,this._symbolLayer=null,this._primitive=null,this._context=t,this._symbolLayer=e}_destroy(){this._lodRendererId=null,this._primitiveMaterialId=null}get loaded(){return this._loaded}get _isPrimitive(){return null!=this._primitive}load(){return null==this._loadingPromise&&(this._loadingPromise=this._load()),this._loadingPromise}async _load(){const e=this._context.renderCommandContext,t=this._getLayerOpacity();let r={usePBR:!0,isSchematic:!0,mrrFactors:m.schematicMRRFactors,ambient:i.ONES,diffuse:i.ONES,hasSlicePlane:!1,castShadows:!0,layerOpacity:t,offsetTransparentBackfaces:!1,screenSizePerspective:{}};if(r.externalColor=o.ONES,r.instanced=!0,this._isPrimitive){const e=new f.DefaultMaterialParameters;e.layerOpacity=t,r={...r,cullFace:y(f.isTransparent(e))}}const s=await e.createMaterial({type:"default",parameters:r}),n=this._symbolLayer.resource;this._primitive=n&&u.isValidPrimitive(n?.primitive)?n.primitive:a.defaultPrimitive;const l=h.createPrimitiveGeometry(this._primitive,s);this._lodRendererId=await e.createLodRenderer(l),this._primitiveMaterialId=s,this._loaded=!0}async createDestroyCommand(){const{_lodRendererId:e,_primitiveMaterialId:t,_context:r}=this,i=r.renderCommandContext,o=[];return null!=e&&o.push(i.destroyLodRenderer(e)),null!=t&&o.push(i.destroyMaterial(t)),new d.PipelineCommand(i,i.mergeRenderCommandBuffers(o),[()=>this._destroy()])}async createAddCommand(e){const t=this._context,{renderCommandContext:r,mainThreadDelegate:o}=t;if(null==this._lodRendererId)throw new Error("expected lod renderer id to not be null");const{featureCount:s}=e;if(0===s)return t.createPipelineCommand();const c=this._isPrimitive,u=this._primitive||a.defaultPrimitive,d=n.create(l.objectSymbolLayerPrimitiveBoundingBox(u)),h=i.fromArray(n.size(d)),f={isPrimitive:c,width:100,depth:null,height:null},m=i.fromArray(l.objectSymbolLayerSizeWithResourceSize(h,f)),y=new Float64Array(16*s),g=new Float64Array(16*s),v=p.readMapCoordinates(e),S=await o.applyElevationAlignmentTo(v);for(let e=0;e<s;++e){const t=e,r=S[3*e+0],i=S[3*e+1],o=S[3*e+2],s=this._computeGlobalTransform(r,i,o,this._context.viewSpatialReference,_),n=this._computeLocalTransform(m,h,b);this._writeMatrixToTypedBuffer(y,t,n),this._writeMatrixToTypedBuffer(g,t,s)}const x=p.readObjectIds(e),w=new Uint8Array(s);e.getVisibilityArray(w);const M={featureIds:new Uint32Array(x),visibility:w,localTransforms:y,globalTransforms:g};return t.createPipelineCommand(r.addLodInstances(this._lodRendererId,e.id,M))}async createRemoveCommand(e){const{_context:t,_lodRendererId:r}=this,i=t.renderCommandContext;return null==r?t.createPipelineCommand():t.createPipelineCommand(i.removeLodInstances(r,e))}async createUpdateVisibilityCommand(e){const{_lodRendererId:t,_context:r}=this,i=r.renderCommandContext;if(null==t)return r.createPipelineCommand();const o=new Uint8Array(e.featureCount);return e.getVisibilityArray(o),r.createPipelineCommand(i.updateVisibility(t,e.id,o))}async createUpdateLayerViewOpacityCommand(e){const{_context:t}=this,r=t.renderCommandContext,i=this._primitiveMaterialId;if(null==i)return t.createPipelineCommand();const o=this._getLayerOpacity();let s={layerOpacity:o};if(this._isPrimitive){const e=new f.DefaultMaterialParameters;e.layerOpacity=o,s={...s,cullFace:y(f.isTransparent(e))}}return t.createPipelineCommand(r.updateMaterial({type:"default",materialId:i,parameters:s}))}async createUpdateElevationCommand(e){const{_context:t,_lodRendererId:r}=this,{renderCommandContext:i,mainThreadDelegate:o}=t,{featureCount:s,id:n}=e;if(null==r||0===s)return t.createPipelineCommand();const a=new Float64Array(16*s),l=p.readMapCoordinates(e),c=await o.applyElevationAlignmentTo(l);for(let e=0;e<s;++e){const t=e,r=c[3*e+0],i=c[3*e+1],o=c[3*e+2],s=this._computeGlobalTransform(r,i,o,this._context.viewSpatialReference,_);this._writeMatrixToTypedBuffer(a,t,s)}return t.createPipelineCommand(i.updateLodInstancesData(r,n,a))}_writeMatrixToTypedBuffer(e,t,r){let i=16*t;for(let t=0;t<16;t++)e[i++]=r[t]}_computeGlobalTransform(e,t,r,i,o){return g[0]=e,g[1]=t,g[2]=r,s.computeTranslationToOriginAndRotation(i,g,o,this._context.renderSpatialReference),o}_computeLocalTransform(e,r,i){return t.identity(i),this._applyObjectScale(e,r,i),i}_applyObjectScale(e,r,i){const o=e,s=c.computeObjectScale(o,e,r,this._context.renderCoordsHelper.unitInMeters);1===s[0]&&1===s[1]&&1===s[2]||t.scale(i,i,s)}_getLayerOpacity(){return this._context.layerViewInfo.fullOpacity}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/computeTranslationToOriginAndRotation":function(){define(["exports","../../core/mathUtils","../../core/libs/gl-matrix-2/math/mat4","../../core/libs/gl-matrix-2/factories/vec3f64","./localRotationUtils","./projectors","../support/spatialReferenceUtils"],function(e,t,r,i,o,s,n){"use strict";function a(e){return 1===e||6===e||8===e||4===e}const l=t.deg2rad(1),c=i.create(),u=i.create();e.computeTranslationToOriginAndRotation=function(e,t,i,d){const p=s.getProjectorClassification(e,d);if(null==p)return!1;const h=p.source.spatialReferenceId,f=p.dest.spatialReferenceId;if(h===f&&!a(f)&&(0!==h||n.equals(e,d)))return r.fromTranslation(i,t),!0;if(a(f)){const e=s.projectionTable[h][10],r=s.projectionTable[10][f];return null!=e&&null!=r&&(e(t,0,c,0),r(c,0,u,0),o.computeENUToPCPFLocalRotation(l*c[0],l*c[1],i),i[12]=u[0],i[13]=u[1],i[14]=u[2],!0)}const m=a(h);if((3===f||11===f||2===f||5===f)&&(2===h||m||3===h||5===h)){const e=s.projectionTable[h][10],n=s.projectionTable[10][f];return null!=e&&null!=n&&(e(t,0,c,0),n(c,0,u,0),m?o.computePCPFToENULocalRotation(l*c[0],l*c[1],i):r.identity(i),i[12]=u[0],i[13]=u[1],i[14]=u[2],!0)}return!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/localRotationUtils":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(e,t){"use strict";function r(e,t,r){const i=Math.sin(e),o=Math.cos(e),s=Math.sin(t),n=Math.cos(t),a=r;return a[0]=-i,a[4]=-s*o,a[8]=n*o,a[12]=0,a[1]=o,a[5]=-s*i,a[9]=n*i,a[13]=0,a[2]=0,a[6]=n,a[10]=s,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,a}e.computeENUToPCPFLocalRotation=r,e.computePCPFToENULocalRotation=function(e,i,o){return r(e,i,o),t.transpose(o,o),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],function(e,t,r,i){"use strict";const o=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];e.isValidPrimitive=function(e){switch(e){case"sphere":case"cube":case"diamond":case"cylinder":case"cone":case"inverted-cone":case"tetrahedron":return!0}return!1},e.primitiveLodResources=function(e,t){const s=(e,t,o=!1)=>new i.LodResources(e.map(e=>{const s=t(e.tesselation);return o&&r.cgToGIS(s),new i.LodLevelResources([new i.LodComponentResources(new i.LodComponentEngineGeometry(s))],e.minScreenSpaceRadius)}));switch(e){case"sphere":return s([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],e=>r.createPolySphereGeometry(t,.5,e,!0));case"cube":return s([{tesselation:0,minScreenSpaceRadius:0}],()=>r.createBoxGeometry(t,1));case"cone":return s(o,e=>r.createConeGeometry(t,1,.5,e,!1),!0);case"inverted-cone":return s(o,e=>r.createConeGeometry(t,1,.5,e,!0),!0);case"cylinder":return s(o,e=>r.createCylinderGeometry(t,1,.5,e,[0,0,1],[0,0,.5]));case"tetrahedron":return s([{tesselation:0,minScreenSpaceRadius:0}],()=>r.createTetrahedronGeometry(t,1),!0);case"diamond":return s([{tesselation:0,minScreenSpaceRadius:0}],()=>r.createDiamondGeometry(t,1),!0);default:return}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices","../../../../geometry/support/plane","../../../../geometry/support/ray","../../support/engineContent/line","./Attribute","./bufferVectorMath","./Geometry","./Util"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";const f=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],m=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],y=[0,0,1,0,1,1,0,1],g=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],b=new Array(36);for(let e=0;e<6;e++)for(let t=0;t<6;t++)b[6*e+t]=e;const _=new Array(36);for(let e=0;e<6;e++)_[6*e]=0,_[6*e+1]=1,_[6*e+2]=2,_[6*e+3]=2,_[6*e+4]=3,_[6*e+5]=0;const v=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],S=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],x=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],w=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7],M=r.fromValues(-.5,0,-.5),T=r.fromValues(.5,0,-.5),P=r.fromValues(0,0,.5),I=r.fromValues(0,.5,0),C=r.create(),O=r.create(),F=r.create(),A=r.create(),R=r.create();t.subtract(C,M,I),t.subtract(O,M,T),t.cross(F,C,O),t.normalize(F,F),t.subtract(C,T,I),t.subtract(O,T,P),t.cross(A,C,O),t.normalize(A,A),t.subtract(C,P,I),t.subtract(O,P,M),t.cross(R,C,O),t.normalize(R,R);const D=[M,T,P,I],E=[0,-1,0,F[0],F[1],F[2],A[0],A[1],A[2],R[0],R[1],R[2]],V=[0,1,2,3,1,0,3,2,1,3,0,2],L=[0,0,0,1,1,1,2,2,2,3,3,3];function z(e,t,r){const i=e;let o,n;if(r)o=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],n=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const e=i*(1+Math.sqrt(5))/2;o=[-i,e,0,i,e,0,-i,-e,0,i,-e,0,0,-i,e,0,i,e,0,-i,-e,0,i,-e,e,0,-i,e,0,i,-e,0,-i,-e,0,i],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let t=0;t<o.length;t+=3)d.scale(o,t,e/d.length(o,t));let a={};function l(t,r){t>r&&([t,r]=[r,t]);const i=t.toString()+"."+r.toString();if(a[i])return a[i];let s=o.length;return o.length+=3,d.add(o,3*t,o,3*r,o,s),d.scale(o,s,e/d.length(o,s)),s/=3,a[i]=s,s}for(let e=0;e<t;e++){const e=n.length,t=new Array(4*e);for(let r=0;r<e;r+=3){const e=n[r],i=n[r+1],o=n[r+2],s=l(e,i),a=l(i,o),c=l(o,e),u=4*r;t[u]=e,t[u+1]=s,t[u+2]=c,t[u+3]=i,t[u+4]=a,t[u+5]=s,t[u+6]=o,t[u+7]=c,t[u+8]=a,t[u+9]=s,t[u+10]=a,t[u+11]=c}n=t,a={}}const c=s.floatArrayFrom(o);for(let e=0;e<c.length;e+=3)d.normalize(c,e);return[["position",new u.Attribute(s.floatArrayFrom(o),n,3,!0)],["normal",new u.Attribute(c,n,3,!0)]]}const U=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function j(e,t,i,o,n=!0,a=!0){let l=0;const c=t,d=e;let p=r.fromValues(0,l,0),h=r.fromValues(0,l+d,0),f=r.fromValues(0,-1,0),m=r.fromValues(0,1,0);o&&(l=d,h=r.fromValues(0,0,0),p=r.fromValues(0,l,0),f=r.fromValues(0,1,0),m=r.fromValues(0,-1,0));const y=[h,p],g=[f,m],b=i+2,_=Math.sqrt(d*d+c*c);if(o)for(let e=i-1;e>=0;e--){const t=e*(2*Math.PI/i),o=r.fromValues(Math.cos(t)*c,l,Math.sin(t)*c);y.push(o);const s=r.fromValues(d*Math.cos(t)/_,-c/_,d*Math.sin(t)/_);g.push(s)}else for(let e=0;e<i;e++){const t=e*(2*Math.PI/i),o=r.fromValues(Math.cos(t)*c,l,Math.sin(t)*c);y.push(o);const s=r.fromValues(d*Math.cos(t)/_,c/_,d*Math.sin(t)/_);g.push(s)}const v=new Array,S=new Array;if(n){for(let e=3;e<y.length;e++)v.push(1),v.push(e-1),v.push(e),S.push(0),S.push(0),S.push(0);v.push(y.length-1),v.push(2),v.push(1),S.push(0),S.push(0),S.push(0)}if(a){for(let e=3;e<y.length;e++)v.push(e),v.push(e-1),v.push(0),S.push(e),S.push(e-1),S.push(1);v.push(0),v.push(2),v.push(y.length-1),S.push(1),S.push(2),S.push(g.length-1)}const x=s.newFloatArray(3*b);for(let e=0;e<b;e++)x[3*e]=y[e][0],x[3*e+1]=y[e][1],x[3*e+2]=y[e][2];const w=s.newFloatArray(3*b);for(let e=0;e<b;e++)w[3*e]=g[e][0],w[3*e+1]=g[e][1],w[3*e+2]=g[e][2];return[["position",new u.Attribute(x,v,3,!0)],["normal",new u.Attribute(w,S,3,!0)]]}function B(e,o,n,c,d,h,f=r.fromValues(0,0,0)){const m=o.length,y=s.newFloatArray(n.length*m*3+(6*c.length||0)),g=s.newFloatArray(n.length*m*3+(c?6:0)),b=new Array,_=new Array;let v=0,S=0;const x=i.create(),w=i.create(),M=i.create(),T=i.create(),P=i.create(),I=i.create(),C=i.create(),O=i.create(),F=i.create(),A=i.create(),R=i.create(),D=i.create(),E=i.create(),V=a.create();t.set(F,0,1,0),t.subtract(w,n[1],n[0]),t.normalize(w,w),h?(t.add(O,n[0],f),t.normalize(M,O)):t.set(M,0,0,1),k(w,M,F,F,P,M,q),t.copy(T,M),t.copy(D,P);for(let e=0;e<c.length;e++)t.scale(I,P,c[e][0]),t.scale(O,M,c[e][2]),t.add(I,I,O),t.add(I,I,n[0]),y[v++]=I[0],y[v++]=I[1],y[v++]=I[2];g[S++]=-w[0],g[S++]=-w[1],g[S++]=-w[2];for(let e=0;e<d.length;e++)b.push(d[e][0]>0?d[e][0]:-d[e][0]-1+c.length),b.push(d[e][1]>0?d[e][1]:-d[e][1]-1+c.length),b.push(d[e][2]>0?d[e][2]:-d[e][2]-1+c.length),_.push(0),_.push(0),_.push(0);let L=c.length;const z=c.length-1;for(let e=0;e<n.length;e++){let r=!1;e>0&&(t.copy(x,w),e<n.length-1?(t.subtract(w,n[e+1],n[e]),t.normalize(w,w)):r=!0,t.add(A,x,w),t.normalize(A,A),t.add(R,n[e-1],T),a.fromPositionAndNormal(n[e],A,V),a.intersectRay(V,l.wrap(R,x),O)?(t.subtract(O,O,n[e]),t.normalize(M,O),t.cross(P,A,M),t.normalize(P,P)):k(A,T,D,F,P,M,q),t.copy(T,M),t.copy(D,P)),h&&(t.add(O,n[e],f),t.normalize(E,O));for(let i=0;i<m;i++)if(t.scale(I,P,o[i][0]),t.scale(O,M,o[i][1]),t.add(I,I,O),t.normalize(C,I),g[S++]=C[0],g[S++]=C[1],g[S++]=C[2],t.add(I,I,n[e]),y[v++]=I[0],y[v++]=I[1],y[v++]=I[2],!r){const e=(i+1)%m;b.push(L+i),b.push(L+m+i),b.push(L+e),b.push(L+e),b.push(L+m+i),b.push(L+m+e);for(let e=0;e<6;e++){const t=b.length-6;_.push(b[t+e]-z)}}L+=m}const U=n[n.length-1];for(let e=0;e<c.length;e++)t.scale(I,P,c[e][0]),t.scale(O,M,c[e][1]),t.add(I,I,O),t.add(I,I,U),y[v++]=I[0],y[v++]=I[1],y[v++]=I[2];const j=S/3;g[S++]=w[0],g[S++]=w[1],g[S++]=w[2];const B=L-m;for(let e=0;e<d.length;e++)b.push(d[e][0]>=0?L+d[e][0]:-d[e][0]-1+B),b.push(d[e][2]>=0?L+d[e][2]:-d[e][2]-1+B),b.push(d[e][1]>=0?L+d[e][1]:-d[e][1]-1+B),_.push(j),_.push(j),_.push(j);const N=[["position",new u.Attribute(y,b,3,!0)],["normal",new u.Attribute(g,_,3,!0)]];return new p.Geometry(e,N)}function N(e,r,i,o,s){return!(Math.abs(t.dot(r,e))>s||(t.cross(i,e,r),t.normalize(i,i),t.cross(o,i,e),t.normalize(o,o),0))}function k(e,t,r,i,o,s,n){return N(e,t,o,s,n)||N(e,r,o,s,n)||N(e,i,o,s,n)}const q=.99619469809,G=i.create();e.cgToGIS=function(e,t=e){const r=e.attributes,i=r.get("position").data,o=r.get("normal").data;if(o){const e=t.getMutableAttribute("normal").data;for(let t=0;t<o.length;t+=3){const r=o[t+1];e[t+1]=-o[t+2],e[t+2]=r}}if(i){const e=t.getMutableAttribute("position").data;for(let t=0;t<i.length;t+=3){const r=i[t+1];e[t+1]=-i[t+2],e[t+2]=r}}},e.createBoxGeometry=function(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(24);for(let e=0;e<8;e++)r[3*e]=f[e][0]*t[0],r[3*e+1]=f[e][1]*t[1],r[3*e+2]=f[e][2]*t[2];return new p.Geometry(e,[["position",new u.Attribute(r,g,3,!0)],["normal",new u.Attribute(m,b,3)],["uv0",new u.Attribute(y,_,2)]])},e.createConeGeometry=function(e,t,r,i,o,s=!0,n=!0){return new p.Geometry(e,j(t,r,i,o,s,n))},e.createConeGeometryData=j,e.createCylinderGeometry=function(e,i,o,n,a,l,c){const d=a?r.clone(a):r.fromValues(1,0,0),h=l?r.clone(l):r.fromValues(0,0,0);c??=!0;const f=r.create();t.normalize(f,d);const m=r.create();t.scale(m,f,Math.abs(i));const y=r.create();t.scale(y,m,-.5),t.add(y,y,h);const g=r.fromValues(0,1,0);Math.abs(1-t.dot(f,g))<.2&&t.set(g,0,0,1);const b=r.create();t.cross(b,f,g),t.normalize(b,b),t.cross(g,b,f);const _=2*n+(c?2:0),v=n+(c?2:0),S=s.newFloatArray(3*_),x=s.newFloatArray(3*v),w=s.newFloatArray(2*_),M=new Array(3*n*(c?4:2)),T=new Array(3*n*(c?4:2));c&&(S[3*(_-2)]=y[0],S[3*(_-2)+1]=y[1],S[3*(_-2)+2]=y[2],w[2*(_-2)]=0,w[2*(_-2)+1]=0,S[3*(_-1)]=S[3*(_-2)]+m[0],S[3*(_-1)+1]=S[3*(_-2)+1]+m[1],S[3*(_-1)+2]=S[3*(_-2)+2]+m[2],w[2*(_-1)]=1,w[2*(_-1)+1]=1,x[3*(v-2)]=-f[0],x[3*(v-2)+1]=-f[1],x[3*(v-2)+2]=-f[2],x[3*(v-1)]=f[0],x[3*(v-1)+1]=f[1],x[3*(v-1)+2]=f[2]);const P=(e,t,r)=>{M[e]=t,T[e]=r};let I=0;const C=r.create(),O=r.create();for(let e=0;e<n;e++){const r=e*(2*Math.PI/n);t.scale(C,g,Math.sin(r)),t.scale(O,b,Math.cos(r)),t.add(C,C,O),x[3*e]=C[0],x[3*e+1]=C[1],x[3*e+2]=C[2],t.scale(C,C,o),t.add(C,C,y),S[3*e]=C[0],S[3*e+1]=C[1],S[3*e+2]=C[2],w[2*e]=e/n,w[2*e+1]=0,S[3*(e+n)]=S[3*e]+m[0],S[3*(e+n)+1]=S[3*e+1]+m[1],S[3*(e+n)+2]=S[3*e+2]+m[2],w[2*(e+n)]=e/n,w[2*e+1]=1;const i=(e+1)%n;P(I++,e,e),P(I++,e+n,e),P(I++,i,i),P(I++,i,i),P(I++,e+n,e),P(I++,i+n,i)}if(c){for(let e=0;e<n;e++){const t=(e+1)%n;P(I++,_-2,v-2),P(I++,e,v-2),P(I++,t,v-2)}for(let e=0;e<n;e++){const t=(e+1)%n;P(I++,e+n,v-1),P(I++,_-1,v-1),P(I++,t+n,v-1)}}const F=[["position",new u.Attribute(S,M,3,!0)],["normal",new u.Attribute(x,T,3,!0)],["uv0",new u.Attribute(w,M,2,!0)]];return new p.Geometry(e,F)},e.createDiamondGeometry=function(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(18);for(let e=0;e<6;e++)r[3*e]=v[e][0]*t[0],r[3*e+1]=v[e][1]*t[1],r[3*e+2]=v[e][2]*t[2];return new p.Geometry(e,[["position",new u.Attribute(r,x,3,!0)],["normal",new u.Attribute(S,w,3)]])},e.createExtrudedTriangle=function(e,t,r,i,o,s=0){const n=new Array(18),a=[[-r,s,o/2],[i,s,o/2],[0,t+s,o/2],[-r,s,-o/2],[i,s,-o/2],[0,t+s,-o/2]];for(let e=0;e<6;e++)n[3*e]=a[e][0],n[3*e+1]=a[e][1],n[3*e+2]=a[e][2];return new p.Geometry(e,[["position",new u.Attribute(n,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])},e.createPathExtrusionGeometry=B,e.createPointGeometry=function(e,{normal:t,position:r,color:o,rotation:s,size:a,centerOffsetAndDistance:l,uvi:c,featureAttribute:d,olidColor:h=null}={}){const f=r?i.clone(r):i.create(),m=t?i.clone(t):i.fromValues(0,0,1),y=o?[o[0],o[1],o[2],o.length>3?o[3]:255]:[255,255,255,255],g=null!=a&&2===a.length?a:[1,1],b=null!=s?[s]:[0],_=n.getZeroIndexArray(1),v=[["position",new u.Attribute(f,_,3,!0)],["normal",new u.Attribute(m,_,3,!0)],["color",new u.Attribute(y,_,4,!0)],["size",new u.Attribute(g,_,2)],["rotation",new u.Attribute(b,_,1,!0)]];if(c&&v.push(["uvi",new u.Attribute(c,_,c.length)]),null!=l){const e=[l[0],l[1],l[2],l[3]];v.push(["centerOffsetAndDistance",new u.Attribute(e,_,4)])}if(d){const e=[d[0],d[1],d[2],d[3]];v.push(["featureAttribute",new u.Attribute(e,_,4)])}return new p.Geometry(e,v,null,1,h)},e.createPolySphereData=z,e.createPolySphereGeometry=function(e,t,r,i){const o=z(t,r,i);return new p.Geometry(e,o)},e.createPolylineGeometry=function(e,t,r,i,a){const l=o.newDoubleArray(3*t.length),d=new Array(2*(t.length-1));let h=0,f=0;for(let e=0;e<t.length;e++){for(let r=0;r<3;r++)l[h++]=t[e][r];e>0&&(d[f++]=e-1,d[f++]=e)}const m=[["position",new u.Attribute(l,d,3,!0)]];if(r&&r.length===t.length&&3===r[0].length){const e=s.newFloatArray(3*r.length);let i=0;for(let o=0;o<t.length;o++)for(let t=0;t<3;t++)e[i++]=r[o][t];m.push(["normal",new u.Attribute(e,d,3,!0)])}if(i&&m.push(["color",new u.Attribute(i,n.getContinuousIndexArray(i.length/4),4)]),a&&a.length===t.length){const e=c.timeStampsToAttribute(a);m.push(["timeStamps",new u.Attribute(e,d,3,!0)])}return new p.Geometry(e,m,null,2)},e.createSphereGeometry=function(e,t,r,i,o={uv:!0}){const a=-Math.PI,l=2*Math.PI,c=-Math.PI/2,d=Math.PI,h=Math.max(3,Math.floor(r)),f=Math.max(2,Math.floor(i)),m=(h+1)*(f+1),y=s.newFloatArray(3*m),g=s.newFloatArray(3*m),b=s.newFloatArray(2*m),_=[];let v=0;for(let e=0;e<=f;e++){const r=[],i=e/f,o=c+i*d,s=Math.cos(o);for(let e=0;e<=h;e++){const n=e/h,c=a+n*l,u=Math.cos(c)*s,d=Math.sin(o),p=-Math.sin(c)*s;y[3*v]=u*t,y[3*v+1]=d*t,y[3*v+2]=p*t,g[3*v]=u,g[3*v+1]=d,g[3*v+2]=p,b[2*v]=n,b[2*v+1]=i,r.push(v),++v}_.push(r)}const S=new Array;for(let e=0;e<f;e++)for(let t=0;t<h;t++){const r=_[e][t],i=_[e][t+1],o=_[e+1][t+1],s=_[e+1][t];0===e?(S.push(r),S.push(o),S.push(s)):e===f-1?(S.push(r),S.push(i),S.push(o)):(S.push(r),S.push(i),S.push(o),S.push(o),S.push(s),S.push(r))}const x=[["position",new u.Attribute(y,S,3,!0)],["normal",new u.Attribute(g,S,3,!0)]];return o.uv&&x.push(["uv0",new u.Attribute(b,S,2,!0)]),o.offset&&(x[0][0]="offset",x.push(["position",new u.Attribute(Float64Array.from(o.offset),n.getZeroIndexArray(S.length),3,!0)])),new p.Geometry(e,x)},e.createSquareGeometry=function(e,t=U){const r=new Array(12);for(let e=0;e<4;e++)for(let i=0;i<3;i++)r[3*e+i]=t[e][i];const i=[0,1,2,2,3,0],o=[0,0,0,0,0,0],s=[["position",new u.Attribute(r,i,3,!0)],["normal",new u.Attribute([0,0,1],o,3,!0)],["uv0",new u.Attribute([0,0,1,0,1,1,0,1],i,2,!0)],["color",new u.Attribute([255,255,255,255],o,4,!0)]];return new p.Geometry(e,s)},e.createTetrahedronGeometry=function(e,t){Array.isArray(t)||(t=[t,t,t]);const r=new Array(12);for(let e=0;e<4;e++)r[3*e]=D[e][0]*t[0],r[3*e+1]=D[e][1]*t[1],r[3*e+2]=D[e][2]*t[2];return new p.Geometry(e,[["position",new u.Attribute(r,V,3,!0)],["normal",new u.Attribute(E,L,3)]])},e.createTubeGeometry=function(e,t,r,i,o,s){i=i||10,o=null==o||o,h.assert(t.length>1);const n=[],a=[];for(let e=0;e<i;e++){n.push([0,-e-1,-(e+1)%i-1]);const t=e/i*2*Math.PI;a.push([Math.cos(t)*r,Math.sin(t)*r])}return B(e,a,t,[[0,0,0]],n,o,s)},e.makeOrthoBasisDirUpFallback=k,e.transformInPlace=function(e,r){const i=e.getMutableAttribute("position").data;for(let e=0;e<i.length;e+=3){const o=i[e],s=i[e+1],n=i[e+2];t.set(G,o,s,n),t.transformMat4(G,G,r),i[e]=G[0],i[e+1]=G[1],i[e+2]=G[2]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["exports"],function(e){"use strict";function t(){return new Float32Array(3)}function r(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function i(e,t,r){const i=new Float32Array(3);return i[0]=e,i[1]=t,i[2]=r,i}function o(){return t()}function s(){return i(1,1,1)}function n(){return i(1,0,0)}function a(){return i(0,1,0)}function l(){return i(0,0,1)}const c=o(),u=s(),d=n(),p=a(),h=l(),f=Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:d,UNIT_Y:p,UNIT_Z:h,ZEROS:c,clone:r,create:t,fromValues:i,ones:s,unitX:n,unitY:a,unitZ:l,zeros:o},Symbol.toStringTag,{value:"Module"}));e.ONES=u,e.UNIT_X=d,e.UNIT_Y=p,e.UNIT_Z=h,e.ZEROS=c,e.clone=r,e.create=t,e.fromValues=i,e.ones=s,e.unitX=n,e.unitY=a,e.unitZ=l,e.vec3f32=f,e.zeros=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/FloatArray":function(){define(["exports","../../core/typedArrayUtil"],function(e,t){"use strict";e.compactFloatArray=function(e){return Array.isArray(e)?e.length<t.nativeArrayMaxSize?e:new Float32Array(e):e.length<t.nativeArrayMaxSize?Array.from(e):e},e.floatArrayFrom=function(e){return(Array.isArray(e)?e.length:e.byteLength/8)<=t.nativeArrayMaxSize?Array.from(e):new Float32Array(e)},e.floatSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},e.newFloatArray=function(e,r=!1){return e<=t.nativeArrayMaxSize?r?new Array(e).fill(0):new Array(e):new Float32Array(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/plane":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../chunks/vec42","./vector","./vectorStacks","../../views/3d/support/mathUtils"],function(e,t,r,i,o,s,n,a){"use strict";function l(e=P){return[e[0],e[1],e[2],e[3]]}const c=o.exactEquals,u=o.equals;function d(e,t){return p(t[0],t[1],t[2],t[3],e)}function p(e,t,r,i,o=l()){return o[0]=e,o[1]=t,o[2]=r,o[3]=i,o}function h(e,t,r){const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],o=Math.abs(i-1)>1e-5&&i>1e-12?1/Math.sqrt(i):1;return r[0]=t[0]*o,r[1]=t[1]*o,r[2]=t[2]*o,r[3]=-(r[0]*e[0]+r[1]*e[1]+r[2]*e[2]),r}function f(e,t,r,i=l()){const o=r[0]-t[0],s=r[1]-t[1],n=r[2]-t[2],a=e[0]-t[0],c=e[1]-t[1],u=e[2]-t[2],d=s*u-n*c,p=n*a-o*u,h=o*c-s*a,f=d*d+p*p+h*h,m=Math.abs(f-1)>1e-5&&f>1e-12?1/Math.sqrt(f):1;return i[0]=d*m,i[1]=p*m,i[2]=h*m,i[3]=-(i[0]*e[0]+i[1]*e[1]+i[2]*e[2]),i}function m(e,t,i,o=0,s=Math.floor(i*(1/3)),n=Math.floor(i*(2/3))){if(i<3)return!1;t(g,o);let a=s,l=!1;for(;a<i-1&&!l;)t(b,a),a++,l=!r.exactEquals(g,b);if(!l)return!1;for(a=Math.max(a,n),l=!1;a<i&&!l;)t(_,a),a++,r.subtract(v,g,b),r.normalize(v,v),r.subtract(S,b,_),r.normalize(S,S),l=!r.exactEquals(g,_)&&!r.exactEquals(b,_)&&Math.abs(r.dot(v,S))<y;return l?(f(g,b,_,e),!0):(0!==o||1!==s||2!==n)&&m(e,t,i,0,1,2)}const y=.99619469809,g=i.create(),b=i.create(),_=i.create(),v=i.create(),S=i.create();function x(e,t,i){const o=r.scale(n.sv3d.get(),e,r.dot(e,t));return r.subtract(i,t,o),i}function w(e,t){return r.dot(e,t)+e[3]}function M(e){return 0===e||1===e}function T(e,i,o,s,n){const a=r.dot(e,o),l=w(e,i);if(0===a)return l>=0?2:3;let c=-l/a;return 1&s&&(c=t.clamp(c,0,1)),!(4&s)&&c<0||!(8&s)&&c>1?l>=0?2:3:(r.add(n,i,r.scale(n,o,c)),l>=0?0:1)}const P=[0,0,1,0];e.clip=function(e,t){const i=r.dot(e,t.ray.direction),o=-w(e,t.ray.origin);if(o<0&&i>=0)return!1;if(i>-1e-6&&i<1e-6)return o>0;if((o<0||i<0)&&!(o<0&&i<0))return!0;const s=o/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1},e.clipInfinite=function(e,t){const i=r.dot(e,t.ray.direction),o=-w(e,t.ray.origin);if(i>-1e-6&&i<1e-6)return o>0;const s=o/i;return i>0?s<t.c1&&(t.c1=s):s>t.c0&&(t.c0=s),t.c0<=t.c1},e.copy=d,e.create=l,e.distance=function(e,t){return Math.abs(w(e,t))},e.equals=u,e.exactEquals=c,e.fromArray=function(e,t,i=!0){const o=t.length/3;return m(e,(e,i)=>r.set(e,t[3*i+0],t[3*i+1],t[3*i+2]),i?o-1:o)},e.fromManyPoints=m,e.fromNormalAndOffset=function(e,t,i){return r.copy(i,e),i[3]=t,i},e.fromPoints=f,e.fromPositionAndNormal=h,e.fromValues=p,e.fromVectorsAndPoint=function(e,t,i,o){return r.cross(_,t,e),h(i,_,o)},e.getNormal=function(e){return e},e.intersectLine=function(e,t,i,o){return M(T(e,t,r.subtract(n.sv3d.get(),i,t),12,o))},e.intersectLineOrRay=T,e.intersectLineSegment=function(e,t,r){return M(T(e,t.origin,t.vector,0,r))},e.intersectLineSegmentClamp=function(e,t,r){return M(T(e,t.origin,t.vector,1,r))},e.intersectRay=function(e,t,r){return null!=t&&M(T(e,t.origin,t.direction,8,r))},e.isPointInside=function(e,t){return w(e,t)>=0},e.negate=function(e,t){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},e.projectPoint=function(e,t,i){const o=r.scale(n.sv3d.get(),e,-e[3]),s=x(e,r.subtract(n.sv3d.get(),t,o),n.sv3d.get());return r.add(i,s,o),i},e.projectPointLocal=function(e,t,i,o){const l=e,c=n.sv3d.get(),u=n.sv3d.get();a.tangentFrame(l,c,u);const d=r.subtract(n.sv3d.get(),i,t),p=s.projectPointSignedLength(c,d),h=s.projectPointSignedLength(u,d),f=s.projectPointSignedLength(l,d);return r.set(o,p,h,f)},e.projectVector=x,e.setOffsetFromPoint=function(e,t,i){return t!==e&&d(e,t),e[3]=-r.dot(e,i),e},e.signedDistance=w,e.up=P,e.wrap=function(e=P[0],t=P[1],r=P[2],i=P[3]){return p(e,t,r,i,n.sv4d.get())},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,r,i){"use strict";const o=i.create(),s=i.create();e.angle=function(e,i){const o=r.dot(e,i)/(r.length(e)*r.length(i));return-t.acosClamped(o)},e.angleAroundAxis=function(e,i,n){r.normalize(o,e),r.normalize(s,i);const a=r.dot(o,s),l=t.acosClamped(a),c=r.cross(o,o,s);return r.dot(c,n)<0?2*Math.PI-l:l},e.projectPoint=function(e,t,i){const o=r.dot(e,t)/r.dot(e,e);return r.scale(i,e,o)},e.projectPointSignedLength=function(e,t){return r.dot(e,t)/r.length(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(e,t){"use strict";const r=t.VectorStack.createVec2f64(),i=t.VectorStack.createVec3f64(),o=t.VectorStack.createVec4f64(),s=t.VectorStack.createMat3f64(),n=t.VectorStack.createMat4f64(),a=t.VectorStack.createQuatf64();e.sm3d=s,e.sm4d=n,e.sq4d=a,e.sv2d=r,e.sv3d=i,e.sv4d=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define(["exports","./has","./nextTick","./libs/gl-matrix-2/factories/mat3f64","./libs/gl-matrix-2/factories/mat4f64","./libs/gl-matrix-2/factories/quatf64","./libs/gl-matrix-2/factories/vec2f64","./libs/gl-matrix-2/factories/vec3f64","./libs/gl-matrix-2/factories/vec4f64"],function(e,t,r,i,o,s,n,a,l){"use strict";class c{constructor(e){this._create=e,this._items=new Array,this._itemsPtr=0}get(){return 0===this._itemsPtr&&r.nextTick(()=>this._reset()),this._itemsPtr>=this._items.length&&this._items.push(this._create()),this._items[this._itemsPtr++]}_reset(){const e=2*this._itemsPtr;this._items.length>e&&(this._items.length=e),this._itemsPtr=0}static createVec2f64(){return new c(n.create)}static createVec3f64(){return new c(a.create)}static createVec4f64(){return new c(l.create)}static createMat3f64(){return new c(i.create)}static createMat4f64(){return new c(o.create)}static createQuatf64(){return new c(s.create)}get test(){}}e.VectorStack=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["exports"],function(e){"use strict";function t(){return[1,0,0,0,1,0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]}function i(e,t,r,i,o,s,n,a,l){return[e,t,r,i,o,s,n,a,l]}const o=[1,0,0,0,1,0,0,0,1],s=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:i},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=i,e.mat3f64=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["exports"],function(e){"use strict";function t(){return[0,0,0,1]}function r(e){return[e[0],e[1],e[2],e[3]]}function i(e,t,r,i){return[e,t,r,i]}const o=[0,0,0,1],s=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:o,clone:r,create:t,fromValues:i},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=o,e.clone=r,e.create=t,e.fromValues=i,e.quatf64=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,r,i){"use strict";const o=i.create(),s=i.create(),n=i.create(),a=i.create(),l=i.create();e.angle=function(e,i,o){e=r.normalize(a,e),i=r.normalize(l,i);const s=t.acosClamped(r.dot(e,i));if(o){const t=r.cross(n,e,i);if(r.dot(t,o)<0)return-s}return s},e.bilerp=function(e,t,r,i,o,s){const n=e+(t-e)*o;return n+(r+(i-r)*o-n)*s},e.cosCapped=function(e,t){return e>t?Math.cos(t):Math.cos(e)},e.fovx2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/t)},e.fovy2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/r)},e.makeOrthonormal=function(e,t,i){i=i||e;const o=r.dot(e,t);r.set(i,e[0]-o*t[0],e[1]-o*t[1],e[2]-o*t[2]),r.normalize(i,i)},e.makePiecewiseLinearFunction=function(e){const t=e.length;return r=>{if(r<=e[0][0])return e[0][1];if(r>=e[t-1][0])return e[t-1][1];let i=1;for(;r>e[i][0];)i++;const o=e[i-1][0],s=e[i][0],n=(s-r)/(s-o);return n*e[i-1][1]+(1-n)*e[i][1]}},e.maxScale=function(e){const t=e[0]*e[0]+e[4]*e[4]+e[8]*e[8],r=e[1]*e[1]+e[5]*e[5]+e[9]*e[9],i=e[2]*e[2]+e[6]*e[6]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},e.midpoint3d=function(e,t){if(r.set(t,0,0,0),e.length>0){for(let i=0;i<e.length;++i)r.add(t,t,e[i]);r.scale(t,t,1/e.length)}},e.planeFromPoints=function(e,t,i,n){r.subtract(o,t,e),r.subtract(s,i,e),r.cross(n,o,s),r.normalize(n,n),n[3]=-r.dot(e,n)},e.scaleFromMatrix=function(e,t){const i=Math.sqrt(t[0]*t[0]+t[4]*t[4]+t[8]*t[8]),o=Math.sqrt(t[1]*t[1]+t[5]*t[5]+t[9]*t[9]),s=Math.sqrt(t[2]*t[2]+t[6]*t[6]+t[10]*t[10]);return r.set(e,i,o,s),e},e.slerp=function(e,t,o,s=i.create()){const n=r.length(e),c=r.length(t),u=r.dot(e,t)/(n*c);if(u<.9999999999999999){const i=Math.acos(u),d=((1-o)*n+o*c)/Math.sin(i),p=d/n*Math.sin((1-o)*i),h=d/c*Math.sin(o*i);return r.scale(a,e,p),r.scale(l,t,h),r.add(s,a,l)}return r.lerp(s,e,t,o)},e.slerpTangent=function(e,t,o,s=i.create(),n=i.create()){const c=r.length(e),u=r.length(t),d=r.dot(e,t)/(c*u);if(d<.9999999999999999){const i=Math.acos(d),p=Math.sin(i),h=Math.sin(o*i),f=Math.sin((1-o)*i),m=(1-o)*c+o*u;{const i=m/p,o=i/c*f,n=i/u*h;r.scale(a,e,o),r.scale(l,t,n),r.add(s,a,l)}{const s=1/c*(-Math.cos((1-o)*i)*i*m+f*(-c+u));r.scale(a,e,s);const d=1/u*(Math.cos(o*i)*i*m+h*(-c+u));r.scale(l,t,d),r.add(n,a,l),r.scale(n,n,1/p)}return n}return r.lerp(s,e,t,o),r.subtract(n,t,e),r.normalize(n,n),n},e.tangentFrame=function(e,t,i){Math.abs(e[0])>Math.abs(e[1])?r.set(t,0,1,0):r.set(t,1,0,0),r.cross(i,e,t),r.cross(t,i,e),r.normalize(i,i),r.normalize(t,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/ray":function(){define(["exports","../../core/arrayUtils","../../core/ObjectStack","../../core/libs/gl-matrix-2/math/mat3","../../core/libs/gl-matrix-2/factories/mat3f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],function(e,t,r,i,o,s,n,a){"use strict";function l(e){return e?c(n.clone(e.origin),n.clone(e.direction)):c(n.create(),n.create())}function c(e,t){return{origin:e,direction:t}}function u(e,t,r=l()){return s.copy(r.origin,e),s.copy(r.direction,t),r}const d=new r.ObjectStack(()=>l()),p=n.create(),h=n.create(),f=n.create(),m=o.create();e.closestPoint=function(e,t,r){const i=s.dot(e.direction,s.subtract(r,t,e.origin));return s.add(r,e.origin,s.scale(r,e.direction,i)),r},e.closestPoints=function(e,t,r,o){const n=e.origin,a=t.origin,l=e.direction,c=t.direction,u=s.dot(s.normalize(h,l),s.normalize(f,c));if(Math.abs(u)>=1)return null;const d=s.cross(h,l,c),y=s.sub(p,a,n),g=i.set(m,l[0],l[1],l[2],-c[0],-c[1],-c[2],d[0],d[1],d[2]),b=i.invert(m,g);if(null==b)return[r,o];const _=s.dot(s.set(h,b[0],b[3],b[6]),y),v=s.dot(s.set(f,b[1],b[4],b[7]),y);return s.add(r,n,s.scale(p,l,_)),s.add(o,a,s.scale(p,c,v)),[r,o]},e.copy=function(e,t=l()){return u(e.origin,e.direction,t)},e.create=l,e.distance2=function(e,t){const r=s.cross(a.sv3d.get(),s.normalize(a.sv3d.get(),e.direction),s.subtract(a.sv3d.get(),t,e.origin));return s.dot(r,r)},e.equals=function(e,r){return t.equals(e.origin,r.origin)&&t.equals(e.direction,r.direction)},e.fromPoints=function(e,t,r=l()){return s.copy(r.origin,e),s.subtract(r.direction,t,e),r},e.fromValues=u,e.wrap=function(e,t){const r=d.get();return r.origin=e,r.direction=t,r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(e,t){"use strict";e.ObjectStack=class{constructor(e){this._allocator=e,this._items=[],this._itemsPtr=0,this._grow()}get(){return 0===this._itemsPtr&&t.nextTick(()=>this._reset()),this._itemsPtr===this._items.length&&this._grow(),this._items[this._itemsPtr++]}_reset(){const e=Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072);this._items.length=Math.min(e,this._items.length),this._itemsPtr=0}_grow(){for(let e=0;e<Math.max(8,Math.min(this._items.length,1024));e++)this._items.push(this._allocator())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["exports","./common"],function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function i(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function o(e,t,r,i,o,s,n,a,l,c){return e[0]=t,e[1]=r,e[2]=i,e[3]=o,e[4]=s,e[5]=n,e[6]=a,e[7]=l,e[8]=c,e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function n(e,t){if(e===t){const r=t[1],i=t[2],o=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=o}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function a(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=u*n-a*c,p=-u*s+a*l,h=c*s-n*l;let f=r*d+i*p+o*h;return f?(f=1/f,e[0]=d*f,e[1]=(-u*i+o*c)*f,e[2]=(a*i-o*n)*f,e[3]=p*f,e[4]=(u*r-o*l)*f,e[5]=(-a*r+o*s)*f,e[6]=h*f,e[7]=(-c*r+i*l)*f,e[8]=(n*r-i*s)*f,e):null}function l(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=n*u-a*c,e[1]=o*c-i*u,e[2]=i*a-o*n,e[3]=a*l-s*u,e[4]=r*u-o*l,e[5]=o*s-r*a,e[6]=s*c-n*l,e[7]=i*l-r*c,e[8]=r*n-i*s,e}function c(e){const t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],n=e[5],a=e[6],l=e[7],c=e[8];return t*(c*s-n*l)+r*(-c*o+n*a)+i*(l*o-s*a)}function u(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=r[0],h=r[1],f=r[2],m=r[3],y=r[4],g=r[5],b=r[6],_=r[7],v=r[8];return e[0]=p*i+h*n+f*c,e[1]=p*o+h*a+f*u,e[2]=p*s+h*l+f*d,e[3]=m*i+y*n+g*c,e[4]=m*o+y*a+g*u,e[5]=m*s+y*l+g*d,e[6]=b*i+_*n+v*c,e[7]=b*o+_*a+v*u,e[8]=b*s+_*l+v*d,e}function d(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=r[0],h=r[1];return e[0]=i,e[1]=o,e[2]=s,e[3]=n,e[4]=a,e[5]=l,e[6]=p*i+h*n+c,e[7]=p*o+h*a+u,e[8]=p*s+h*l+d,e}function p(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],p=Math.sin(r),h=Math.cos(r);return e[0]=h*i+p*n,e[1]=h*o+p*a,e[2]=h*s+p*l,e[3]=h*n-p*i,e[4]=h*a-p*o,e[5]=h*l-p*s,e[6]=c,e[7]=u,e[8]=d,e}function h(e,t,r){const i=r[0],o=r[1],s=r[2];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e[6]=s*t[6],e[7]=s*t[7],e[8]=s*t[8],e}function f(e,t,r){const i=r[0],o=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=o*t[3],e[4]=o*t[4],e[5]=o*t[5],e}function m(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function y(e,t){const r=Math.sin(t),i=Math.cos(t);return e[0]=i,e[1]=r,e[2]=0,e[3]=-r,e[4]=i,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function b(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function _(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=r+r,a=i+i,l=o+o,c=r*n,u=i*n,d=i*a,p=o*n,h=o*a,f=o*l,m=s*n,y=s*a,g=s*l;return e[0]=1-d-f,e[3]=u-g,e[6]=p+y,e[1]=u+g,e[4]=1-c-f,e[7]=h-m,e[2]=p-y,e[5]=h+m,e[8]=1-c-d,e}function v(e,t){const r=t[0],i=t[1],o=t[2],s=t[4],n=t[5],a=t[6],l=t[8],c=t[9],u=t[10],d=u*n-a*c,p=-u*s+a*l,h=c*s-n*l,f=r*d+i*p+o*h;if(!f)return null;const m=1/f;return e[0]=d*m,e[1]=(-u*i+o*c)*m,e[2]=(a*i-o*n)*m,e[3]=p*m,e[4]=(u*r-o*l)*m,e[5]=(-a*r+o*s)*m,e[6]=h*m,e[7]=(-c*r+i*l)*m,e[8]=(n*r-i*s)*m,e}function S(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],p=t[10],h=t[11],f=t[12],m=t[13],y=t[14],g=t[15],b=r*a-i*n,_=r*l-o*n,v=r*c-s*n,S=i*l-o*a,x=i*c-s*a,w=o*c-s*l,M=u*m-d*f,T=u*y-p*f,P=u*g-h*f,I=d*y-p*m,C=d*g-h*m,O=p*g-h*y;let F=b*O-_*C+v*I+S*P-x*T+w*M;return F?(F=1/F,e[0]=(a*O-l*C+c*I)*F,e[1]=(l*P-n*O-c*T)*F,e[2]=(n*C-a*P+c*M)*F,e[3]=(o*C-i*O-s*I)*F,e[4]=(r*O-o*P+s*T)*F,e[5]=(i*P-r*C-s*M)*F,e[6]=(m*w-y*x+g*S)*F,e[7]=(y*v-f*w-g*_)*F,e[8]=(f*x-m*v+g*b)*F,e):null}function x(e,t,r){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/r,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function w(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function M(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2)}function T(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e}function P(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}function I(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e}function C(e,t,r,i){return e[0]=t[0]+r[0]*i,e[1]=t[1]+r[1]*i,e[2]=t[2]+r[2]*i,e[3]=t[3]+r[3]*i,e[4]=t[4]+r[4]*i,e[5]=t[5]+r[5]*i,e[6]=t[6]+r[6]*i,e[7]=t[7]+r[7]*i,e[8]=t[8]+r[8]*i,e}function O(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function F(e,r){const i=e[0],o=e[1],s=e[2],n=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8],p=r[0],h=r[1],f=r[2],m=r[3],y=r[4],g=r[5],b=r[6],_=r[7],v=r[8],S=t.getEpsilon();return Math.abs(i-p)<=S*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(o-h)<=S*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-f)<=S*Math.max(1,Math.abs(s),Math.abs(f))&&Math.abs(n-m)<=S*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-y)<=S*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(l-g)<=S*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(c-b)<=S*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(u-_)<=S*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(d-v)<=S*Math.max(1,Math.abs(d),Math.abs(v))}function A(e){const r=t.getEpsilon(),i=e[0],o=e[1],s=e[2],n=e[3],a=e[4],l=e[5],c=e[6],u=e[7],d=e[8];return Math.abs(1-(i*i+n*n+c*c))<=r&&Math.abs(1-(o*o+a*a+u*u))<=r&&Math.abs(1-(s*s+l*l+d*d))<=r}const R=u,D=P,E=Object.freeze(Object.defineProperty({__proto__:null,add:T,adjoint:l,copy:i,determinant:c,equals:F,exactEquals:O,frob:M,fromMat2d:b,fromMat4:r,fromQuat:_,fromRotation:y,fromScaling:g,fromTranslation:m,identity:s,invert:a,isOrthoNormal:A,mul:R,multiply:u,multiplyScalar:I,multiplyScalarAndAdd:C,normalFromMat4:S,normalFromMat4Legacy:v,projection:x,rotate:p,scale:h,scaleByVec2:f,set:o,str:w,sub:D,subtract:P,translate:d,transpose:n},Symbol.toStringTag,{value:"Module"}));e.add=T,e.adjoint=l,e.copy=i,e.determinant=c,e.equals=F,e.exactEquals=O,e.frob=M,e.fromMat2d=b,e.fromMat4=r,e.fromQuat=_,e.fromRotation=y,e.fromScaling=g,e.fromTranslation=m,e.identity=s,e.invert=a,e.isOrthoNormal=A,e.mat3=E,e.mul=R,e.multiply=u,e.multiplyScalar=I,e.multiplyScalarAndAdd=C,e.normalFromMat4=S,e.normalFromMat4Legacy=v,e.projection=x,e.rotate=p,e.scale=h,e.scaleByVec2=f,e.set=o,e.str=w,e.sub=D,e.subtract=P,e.translate=d,e.transpose=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/line":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/projectors","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../../../geometry/support/HalfFloatArray","../../../../geometry/support/Indices","../../webgl-engine/lib/Attribute","../../webgl-engine/lib/Geometry"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";const p=r.create(),h=r.create();function f(e){const t=l.newHalfFloatArray(3*e.length),r=e[0],i=e[e.length-1];for(let o=0;o<e.length;o++)t[3*o]=e[o],t[3*o+1]=r,t[3*o+2]=i;return t}e.createGeometry=function(e,r,l=null){const f=[],m=r.mapPositions;!function(e,t){const{attributeData:{position:r},removeDuplicateStartEnd:i}=e,o=function(e){const t=e.length;return e[0]===e[t-3]&&e[1]===e[t-2]&&e[2]===e[t-1]}(r)&&i,s=r.length/3-(o?1:0),n=new Array(2*(s-1)),a=o?r.slice(0,-3):r;let l=0;for(let e=0;e<s-1;e++)n[l++]=e,n[l++]=e+1;t.push(["position",new u.Attribute(a,n,3,o)])}(r,f);const y=f[0][1].data,g=f[0][1].indices.length,b=c.getZeroIndexArray(g);return function(e,t,r){if(null!=e.attributeData.colorFeature)return;const o=e.attributeData.color;t.push(["color",new u.Attribute(o??i.ONES,r,4)])}(r,f,b),function(e,t,r){null==e.attributeData.sizeFeature&&t.push(["size",new u.Attribute([e.attributeData.size??1],r,1,!0)])}(r,f,b),function(e,t,r){e.attributeData.normal&&t.push(["normal",new u.Attribute(e.attributeData.normal,r,3)])}(r,f,b),function(e,t,r){null!=e.attributeData.colorFeature&&t.push(["colorFeatureAttribute",new u.Attribute([e.attributeData.colorFeature],r,1,!0)])}(r,f,b),function(e,t,r){null!=e.attributeData.sizeFeature&&t.push(["sizeFeatureAttribute",new u.Attribute([e.attributeData.sizeFeature],r,1,!0)])}(r,f,b),function(e,t){const{attributeData:{position:r,timeStamps:i}}=e;if(!i)return;const o=r.length/3,s=new Array(2*(o-1));let n=0;for(let e=0;e<o-1;e++)s[n++]=e,s[n++]=e+1;t.push(["timeStamps",new u.Attribute(i,s,3)])}(r,f),function(e,t,r){null!=e.attributeData.opacityFeature&&t.push(["opacityFeatureAttribute",new u.Attribute([e.attributeData.opacityFeature],r,1,!0)])}(r,f,b),function(e,r,i){if(null==e.overlayInfo||1!==e.overlayInfo.renderCoordsHelper.viewingMode||!e.overlayInfo.spatialReference.isGeographic)return;const l=n.newDoubleArray(i.length),c=o.getReferenceEllipsoid(e.overlayInfo.spatialReference);for(let e=0;e<l.length;e+=3)s.lonLatToWebMercatorComparable(i,e,l,e,c);const d=i.length/3,f=a.newFloatArray(d+1);let m=p,y=h,g=0,b=0;t.set(m,l[b++],l[b++]),b++,f[0]=0;for(let e=1;e<d+1;++e)e===d&&(b=0),t.set(y,l[b++],l[b++]),b++,g+=t.dist(m,y),f[e]=g,[m,y]=[y,m];r.push(["distanceToStart",new u.Attribute(f,r[0][1].indices,1,!0)])}(r,f,y),new d.Geometry(e,f,m,2,l)},e.getLinearTimeStamps=function(e,t=0,r=.01){const i=l.newHalfFloatArray(e.length);i[0]=0;for(let t=1;t<e.length;t++){const r=e[t-1],o=e[t],s=Math.sqrt((o[0]-r[0])**2+(o[1]-r[1])**2+(o[2]-r[2])**2);i[t]=i[t-1]+s}const o=i.map(e=>e*r);if(0!==t&&t<o.length){const e=o[t];for(let t=0;t<o.length;t++)o[t]-=e}return o},e.lineStripsToParameters=function(e,t,r){if(null==e||0===e.length)return[];const i=[];return e.forEach((e,o)=>{const s=e.length,a=n.newDoubleArray(3*s);e.forEach((e,t)=>{a[3*t]=e[0],a[3*t+1]=e[1],a[3*t+2]=e[2]});const l=null!=r?f(r[o]):void 0,c={attributeData:{position:a,normal:t,timeStamps:l},removeDuplicateStartEnd:!1};i.push(c)}),i},e.timeStampsToAttribute=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/HalfFloatArray":function(){define(["exports","../../core/typedArrayUtil","./float16"],function(e,t,r){"use strict";e.compactHalfFloatArray=function(e){return Array.isArray(e)?e.length<t.nativeArrayMaxSize?e:r.makeFloat16Array(e):e.length<t.nativeArrayMaxSize?Array.from(e):e},e.halfFloatSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},e.newHalfFloatArray=function(e,i=!1){return e<=t.nativeArrayMaxSize?i?new Array(e).fill(0):new Array(e):r.makeFloat16Array(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/float16":function(){define(["exports"],function(e){"use strict";let t=globalThis.Float16Array;e.hasNativeFloat16Array=!!t,e.disableNativeF16Array=function(){t=null,e.hasNativeFloat16Array=!1},e.getFloat16ArrayConstructor=function(){return t},e.makeFloat16Array=function(...e){return new(t??Float32Array)(...e)},e.resetNativeF16Array=function(){t=globalThis.Float16Array,e.hasNativeFloat16Array=!!t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define(["exports","../../../../core/uid","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../geometry/support/Indices","./AttributeArray","./BoundingInfo","./geometryDataUtils","./Object3DStateID","./Util","../../../webgl/checkWebGLError"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";class d{constructor(e,r,i=null,s=0,n=null,a=-1){this.material=e,this.mapPositions=i,this.type=s,this.olidColor=n,this.edgeIndicesLength=a,this._highlights=null,this._highlightOptionsCounts=null,this.id=t.generateUID(),this.visible=!0,this._attributes=new Map,this._boundingInfo=null;for(const[e,t]of r)this._attributes.set(e,{...t,indices:o.compactIndices(t.indices)}),"position"===e&&(this.edgeIndicesLength=this.edgeIndicesLength<0?this._attributes.get(e).indices.length:this.edgeIndicesLength)}instantiate(e={}){const t=new d(e.material||this.material,[],this.mapPositions,this.type,this.olidColor,this.edgeIndicesLength);return this._attributes.forEach((e,r)=>{e.exclusive=!1,t._attributes.set(r,e)}),t._boundingInfo=this._boundingInfo,t.transformation=e.transformation||this.transformation,t}get attributes(){return this._attributes}getMutableAttribute(e){let t=this._attributes.get(e);return t&&!t.exclusive&&(t={...t,exclusive:!0,data:s.cloneAttributeData(t.data)},this._attributes.set(e,t)),t}setAttributeData(e,t){const r=this._attributes.get(e);r?this._attributes.set(e,{...r,exclusive:!0,data:t}):u.webglDebugEnabled()&&console.warn(`Setting undefined attribute ${e} data`)}get indexCount(){const e=this._attributes.values().next().value?.indices;return e?.length??0}get faceCount(){return this.indexCount/3}get boundingInfo(){return this._boundingInfo??=this._calculateBoundingInfo(),this._boundingInfo}computeAttachmentOrigin(e){return!!(0===this.type?this._computeAttachmentOriginTriangles(e):2===this.type?this._computeAttachmentOriginLines(e):this._computeAttachmentOriginPoints(e))&&(null!=this._transformation&&i.transformMat4(e,e,this._transformation),!0)}_computeAttachmentOriginTriangles(e){const t=this.attributes.get("position");return a.computeAttachmentOriginTriangles(t,e)}_computeAttachmentOriginLines(e){const t=this.attributes.get("position");return a.computeAttachmentOriginLines(t,function(e,t){return!(!("isClosed"in e)||!e.isClosed)&&t.indices.length>2}(this.material.parameters,t),e)}_computeAttachmentOriginPoints(e){const t=this.attributes.get("position");return a.computeAttachmentOriginPoints(t,e)}invalidateBoundingInfo(){this._boundingInfo=null}_calculateBoundingInfo(){const e=this.attributes.get("position");if(!e||0===e.indices.length)return null;const t=0===this.type?3:1;c.assert(e.indices.length%t===0,"Indexing error: "+e.indices.length+" not divisible by "+t);const r=o.getContinuousIndexArray(e.indices.length/t);return new n.BoundingInfo(r,t,e)}get transformation(){return this._transformation??r.IDENTITY}set transformation(e){this._transformation=e&&e!==r.IDENTITY?r.clone(e):null}get highlights(){return this._highlights||p}get hasHighlights(){return(this._highlightOptionsCounts?.size??0)>0}foreachHighlightOptions(e){this._highlightOptionsCounts?.forEach((t,r)=>e(r))}allocateIdAndHighlight(e){const t=new l.Object3DHighlightStateID(e);return this.addHighlight(t)}addHighlight(e){this._ensureHighlights().add(e);const{highlightName:t}=e,r=(this._highlightOptionsCounts?.get(t)??0)+1;return this._ensureHighlightOptionsCounts().set(t,r),e}_ensureHighlights(){let e=this._highlights;return e||(e=new Set,this._highlights=e),e}_ensureHighlightOptionsCounts(){let e=this._highlightOptionsCounts;return e||(e=new Map,this._highlightOptionsCounts=e),e}removeHighlight(e){if(this._highlights?.delete(e)){const{highlightName:t}=e,r=this._highlightOptionsCounts?.get(t)??0;r<=1?this._highlightOptionsCounts?.delete(t):this._ensureHighlightOptionsCounts().set(t,r-1)}}}const p=new Set;e.Geometry=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports","../../../../core/typedArrayUtil","../../../../geometry/support/float16"],function(e,t,r){"use strict";e.cloneAttributeData=function(e){if(e.length<t.nativeArrayMaxSize)return Array.from(e);if(Array.isArray(e))return Float64Array.from(e);if(!("BYTES_PER_ELEMENT"in e))return Array.from(e);switch(e.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(e);case 2:return t.isFloat16Array(e)?r.getFloat16ArrayConstructor().from(e):t.isUint16Array(e)?Uint16Array.from(e):Int16Array.from(e);case 4:return Float32Array.from(e);default:return Float64Array.from(e)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./Util"],function(e,t,r,i,o){"use strict";class s{get center(){return i.fromValues(this._data[0],this._data[1],this._data[2])}get radius(){return this._data[3]}get bbMin(){return i.fromValues(this._data[4],this._data[5],this._data[6])}get bbMax(){return i.fromValues(this._data[7],this._data[8],this._data[9])}constructor(e,t,s){this.primitiveIndices=e,this._numIndexPerPrimitive=t,this.position=s,this._data=[.1,0,0,0,0,0,0,0,0,0],this._children=void 0,o.assert(e.length>=1),o.assert(3===s.size||4===s.size);const{data:a,size:l,indices:c}=s;o.assert(c.length%this._numIndexPerPrimitive===0),o.assert(c.length>=e.length*this._numIndexPerPrimitive);const u=e.length;let d=l*c[this._numIndexPerPrimitive*e[0]];n.clear(),n.push(d);const p=i.fromValues(a[d],a[d+1],a[d+2]),h=i.clone(p);for(let t=0;t<u;++t){const r=this._numIndexPerPrimitive*e[t];for(let e=0;e<this._numIndexPerPrimitive;++e){d=l*c[r+e],n.push(d);let t=a[d];p[0]=Math.min(t,p[0]),h[0]=Math.max(t,h[0]),t=a[d+1],p[1]=Math.min(t,p[1]),h[1]=Math.max(t,h[1]),t=a[d+2],p[2]=Math.min(t,p[2]),h[2]=Math.max(t,h[2])}}for(let e=0;e<3;++e)this._data[4+e]=p[e],this._data[7+e]=h[e];const f=r.lerp(i.create(),this.bbMin,this.bbMax,.5);let m=.5*Math.max(Math.max(h[0]-p[0],h[1]-p[1]),h[2]-p[2]),y=m*m;for(let e=0;e<n.length;++e){d=n.at(e);const t=a[d]-f[0],r=a[d+1]-f[1],i=a[d+2]-f[2],o=t*t+r*r+i*i;if(o<=y)continue;const s=Math.sqrt(o),l=.5*(s-m);m+=l,y=m*m;const c=l/s;f[0]+=t*c,f[1]+=r*c,f[2]+=i*c}this._data[3]=m;for(let e=0;e<3;++e)this._data[0+e]=f[e];n.clear()}getChildren(){if(this._children||r.squaredDistance(this.bbMin,this.bbMax)<=1)return this._children;const e=r.lerp(i.create(),this.bbMin,this.bbMax,.5),t=this.primitiveIndices.length,o=new Uint8Array(t),n=new Array(8);for(let e=0;e<8;++e)n[e]=0;const{data:a,size:l,indices:c}=this.position;for(let r=0;r<t;++r){let t=0;const i=this._numIndexPerPrimitive*this.primitiveIndices[r];let s=l*c[i],u=a[s],d=a[s+1],p=a[s+2];for(let e=1;e<this._numIndexPerPrimitive;++e){s=l*c[i+e];const t=a[s],r=a[s+1],o=a[s+2];t<u&&(u=t),r<d&&(d=r),o<p&&(p=o)}u<e[0]&&(t|=1),d<e[1]&&(t|=2),p<e[2]&&(t|=4),o[r]=t,++n[t]}let u=0;for(let e=0;e<8;++e)n[e]>0&&++u;if(u<2)return;const d=new Array(8);for(let e=0;e<8;++e)d[e]=n[e]>0?new Uint32Array(n[e]):void 0;for(let e=0;e<8;++e)n[e]=0;for(let e=0;e<t;++e){const t=o[e];d[t][n[t]++]=this.primitiveIndices[e]}this._children=new Array;for(let e=0;e<8;++e)void 0!==d[e]&&this._children.push(new s(d[e],this._numIndexPerPrimitive,this.position));return this._children}static prune(){n.prune()}}const n=new t({deallocator:null});e.BoundingInfo=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/triangle"],function(e,t,r,i){"use strict";const o=r.create(),s=r.create(),n=r.create(),a=r.create();e.computeAttachmentOriginLines=function(e,r,i){if(!e)return!1;t.set(i,0,0,0),t.set(a,0,0,0);let n=0,l=0;const{size:c,data:u,indices:d}=e,p=d.length-1,h=p+(r?2:0);for(let e=0;e<h;e+=2){const r=e<p?e+1:0,h=d[e<p?e:p]*c,f=d[r]*c;o[0]=u[h],o[1]=u[h+1],o[2]=u[h+2],s[0]=u[f],s[1]=u[f+1],s[2]=u[f+2],t.scale(o,t.add(o,o,s),.5);const m=t.dist(o,s);m>0?(t.add(i,i,t.scale(o,o,m)),n+=m):0===n&&(t.add(a,a,o),l++)}return 0!==n?(t.scale(i,i,1/n),!0):0!==l&&(t.scale(i,a,1/l),!0)},e.computeAttachmentOriginPoints=function(e,r){if(!e)return!1;const{size:i,data:o,indices:s}=e;t.set(r,0,0,0);let n=-1,a=0;for(let e=0;e<s.length;e++){const t=s[e]*i;n!==t&&(r[0]+=o[t],r[1]+=o[t+1],r[2]+=o[t+2],a++),n=t}return a>1&&t.scale(r,r,1/a),a>0},e.computeAttachmentOriginTriangles=function(e,r){if(!e)return!1;const{size:l,data:c,indices:u}=e;t.set(r,0,0,0),t.set(a,0,0,0);let d=0,p=0;for(let e=0;e<u.length-2;e+=3){const h=u[e]*l,f=u[e+1]*l,m=u[e+2]*l;t.set(o,c[h],c[h+1],c[h+2]),t.set(s,c[f],c[f+1],c[f+2]),t.set(n,c[m],c[m+1],c[m+2]);const y=i.areaPoints3d(o,s,n);y?(t.add(o,o,s),t.add(o,o,n),t.scale(o,o,1/3*y),t.add(r,r,o),d+=y):(t.add(a,a,o),t.add(a,a,s),t.add(a,a,n),p+=3)}return!(0===p&&0===d||(0!==d?(t.scale(r,r,1/d),0):0===p||(t.scale(r,a,1/p),0)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define(["exports","../../core/ObjectStack","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./lineSegment","./vectorStacks"],function(e,t,r,i,o,s){"use strict";function n(e){return e?{p0:i.clone(e.p0),p1:i.clone(e.p1),p2:i.clone(e.p2)}:{p0:i.create(),p1:i.create(),p2:i.create()}}function a(e,t,i,o=n()){return r.copy(o.p0,e),r.copy(o.p1,t),r.copy(o.p2,i),o}const l=new t.ObjectStack(o.create),c=new t.ObjectStack(()=>n()),u=i.create(),d=i.create();e.areaPoints2d=function(e,t,r){const i=t[0]-e[0],o=t[1]-e[1],s=r[0]-e[0],n=r[1]-e[1];return.5*Math.abs(i*n-o*s)},e.areaPoints3d=function(e,t,i){return r.subtract(u,t,e),r.subtract(d,i,e),.5*r.length(r.cross(u,u,d))},e.copy=function(e,t=n()){return a(e.p0,e.p1,e.p2,t)},e.create=n,e.distance2=function(e,t){const i=e.p0,n=e.p1,a=e.p2,c=r.subtract(s.sv3d.get(),n,i),u=r.subtract(s.sv3d.get(),a,n),d=r.subtract(s.sv3d.get(),i,a),p=r.subtract(s.sv3d.get(),t,i),h=r.subtract(s.sv3d.get(),t,n),f=r.subtract(s.sv3d.get(),t,a),m=r.cross(c,c,d),y=r.dot(r.cross(s.sv3d.get(),c,m),p),g=r.dot(r.cross(s.sv3d.get(),u,m),h),b=r.dot(r.cross(s.sv3d.get(),d,m),f);if(y>0&&g>0&&b>0){const e=r.dot(m,p);return e*e/r.dot(m,m)}const _=o.distance2(o.fromValues(i,c,l.get()),t),v=o.distance2(o.fromValues(n,u,l.get()),t),S=o.distance2(o.fromValues(a,d,l.get()),t);return Math.min(_,v,S)},e.fromValues=a,e.intersectRay=function(e,t,i){const o=1e-5,{direction:s,origin:n}=t,{p0:a,p1:l,p2:c}=e,u=l[0]-a[0],d=l[1]-a[1],p=l[2]-a[2],h=c[0]-a[0],f=c[1]-a[1],m=c[2]-a[2],y=s[1]*m-f*s[2],g=s[2]*h-m*s[0],b=s[0]*f-h*s[1],_=u*y+d*g+p*b;if(_>-o&&_<o)return!1;const v=1/_,S=n[0]-a[0],x=n[1]-a[1],w=n[2]-a[2],M=v*(S*y+x*g+w*b);if(M<0||M>1)return!1;const T=x*p-d*w,P=w*u-p*S,I=S*d-u*x,C=v*(s[0]*T+s[1]*P+s[2]*I);if(C<0||M+C>1)return!1;if(i){const e=v*(h*T+f*P+m*I);r.scale(i,s,e),r.add(i,n,i)}return!0},e.wrap=function(e,t,r){const i=c.get();return i.p0=e,i.p1=t,i.p2=r,i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/lineSegment":function(){define(["exports","../../core/mathUtils","../../core/ObjectStack","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./vectorStacks"],function(e,t,r,i,o,s){"use strict";function n(e){return e?{origin:o.clone(e.origin),vector:o.clone(e.vector)}:{origin:o.create(),vector:o.create()}}function a(e,t){const r=p.get();return r.origin=e,r.vector=t,r}function l(e,t,r=n()){return i.copy(r.origin,e),i.copy(r.vector,t),r}function c(e,r,o,n,a){const{vector:l,origin:c}=e,u=i.subtract(s.sv3d.get(),r,c),d=i.dot(l,u)/i.squaredLength(l);return i.scale(a,l,t.clamp(d,o,n)),i.add(a,a,e.origin)}function u(e,r,o,n){const a=1e-6,l=e.origin,c=i.add(s.sv3d.get(),l,e.vector),u=r.origin,d=i.add(s.sv3d.get(),u,r.vector),p=s.sv3d.get(),h=s.sv3d.get();if(p[0]=l[0]-u[0],p[1]=l[1]-u[1],p[2]=l[2]-u[2],h[0]=d[0]-u[0],h[1]=d[1]-u[1],h[2]=d[2]-u[2],Math.abs(h[0])<a&&Math.abs(h[1])<a&&Math.abs(h[2])<a)return!1;const f=s.sv3d.get();if(f[0]=c[0]-l[0],f[1]=c[1]-l[1],f[2]=c[2]-l[2],Math.abs(f[0])<a&&Math.abs(f[1])<a&&Math.abs(f[2])<a)return!1;const m=p[0]*h[0]+p[1]*h[1]+p[2]*h[2],y=h[0]*f[0]+h[1]*f[1]+h[2]*f[2],g=p[0]*f[0]+p[1]*f[1]+p[2]*f[2],b=h[0]*h[0]+h[1]*h[1]+h[2]*h[2],_=(f[0]*f[0]+f[1]*f[1]+f[2]*f[2])*b-y*y;if(Math.abs(_)<a)return!1;let v=(m*y-g*b)/_,S=(m+y*v)/b;o&&(v=t.clamp(v,0,1),S=t.clamp(S,0,1));const x=s.sv3d.get(),w=s.sv3d.get();return x[0]=l[0]+v*f[0],x[1]=l[1]+v*f[1],x[2]=l[2]+v*f[2],w[0]=u[0]+S*h[0],w[1]=u[1]+S*h[1],w[2]=u[2]+S*h[2],n.tA=v,n.tB=S,n.pA=x,n.pB=w,n.distance2=i.squaredDistance(x,w),!0}const d={tA:0,tB:0,pA:o.create(),pB:o.create(),distance2:0},p=new r.ObjectStack(()=>n());e.closestLineSegmentPoint=function(e,t,r){return!!u(e,t,!0,d)&&(i.copy(r,d.pA),!0)},e.closestRayDistance2=function(e,t){if(u(e,a(t.origin,t.direction),!1,d)){const{tA:t,pB:r,distance2:o}=d;if(t>=0&&t<=1)return o;if(t<0)return i.squaredDistance(e.origin,r);if(t>1)return i.squaredDistance(i.add(s.sv3d.get(),e.origin,e.vector),r)}return null},e.copy=function(e,t=n()){return l(e.origin,e.vector,t)},e.create=n,e.distance2=function(e,r){const o=i.subtract(s.sv3d.get(),r,e.origin),n=i.dot(e.vector,o),a=i.dot(e.vector,e.vector),l=t.clamp(n/a,0,1),c=i.subtract(s.sv3d.get(),i.scale(s.sv3d.get(),e.vector,l),o);return i.dot(c,c)},e.fromPoints=function(e,t,r=n()){return i.copy(r.origin,e),i.subtract(r.vector,t,e),r},e.fromValues=l,e.pointAt=function(e,t,r){return i.add(r,e.origin,i.scale(r,e.vector,t))},e.projectPoint=function(e,t,r){return c(e,t,0,1,r)},e.projectPointClamp=c,e.wrap=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(e,t){"use strict";class r{constructor(){this.uid=t.generateUID()}}e.Object3DHighlightStateID=class extends r{constructor(e){super(),this.highlightName=e,this.channel=0}},e.Object3DOccludeeStateID=class extends r{constructor(){super(...arguments),this.channel=1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/bufferVectorMath":function(){define(["exports"],function(e){"use strict";e.add=function(e,t,r,i,o,s=t){(o=o||e)[s]=e[t]+r[i],o[s+1]=e[t+1]+r[i+1],o[s+2]=e[t+2]+r[i+2]},e.length=function(e,t){const r=e[t],i=e[t+1],o=e[t+2];return Math.sqrt(r*r+i*i+o*o)},e.normalize=function(e,t){const r=e[t],i=e[t+1],o=e[t+2],s=1/Math.sqrt(r*r+i*i+o*o);e[t]*=s,e[t+1]*=s,e[t+2]*=s},e.scale=function(e,t,r){e[t]*=r,e[t+1]*=r,e[t+2]*=r},e.subtract=function(e,t,r,i,o,s=t){(o=o||e)[s]=e[t]-r[i],o[s+1]=e[t+1]-r[i+1],o[s+2]=e[t+2]-r[i+2]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/memoryEstimations","../IntersectorResult","./Intersector"],function(e,t,r,i,o){"use strict";class s{constructor(e,t,r,i){this.material=e,this.buffer=t,this.numVertices=r,this.boundingInfo=i,this.bufferWriter=e.createBufferWriter()}get layout(){return this.bufferWriter.layout}get numTriangles(){return this.numVertices/3}computeUsedMemory(){return this.buffer.byteLength+r.baseTypedArrayMemory}get renderGeometry(){return this}intersect(e,t,r,i,o,s,a,l){const c=this.bufferWriter,u=this.buffer;c.intersect(u,this.material.parameters,null,e,r,i,(r,i,c)=>n(r,i,c,e,t,s,a,o,l))}}function n(e,t,r,s,n,a,l,c,u){if(e<0)return;if(n&&!n(s.rayBegin,s.rayEnd,e))return;const d=new o.LodTarget(a.layerViewUid,a.graphicUid(c),r,l,u);if((null==s.results.min.distance||e<s.results.min.distance)&&s.results.min.set(6,d,e,t,s.transform.transform),(null==s.results.max.distance||e>s.results.max.distance)&&s.results.max.set(6,d,e,t,s.transform.transform),2===s.options.store){const r=new i.IntersectorResult(s.results.min.ray);r.set(6,d,e,t,s.transform.transform),s.results.all.push(r)}}e.LodComponentEngineGeometry=class{constructor(e){this.engineGeometry=e;const t=this.material,r=this.engineGeometry,i=r.attributes,o=r.boundingInfo,n=t.createBufferWriter(),a=n.layout,l=n.elementCount(i),c=a.createBuffer(l);n.write(null,null,i,null,c,0),this.renderGeometry=new s(t,c.buffer,l,o)}get material(){return this.engineGeometry.material}get numVertices(){return this.engineGeometry.indexCount}get numTriangles(){return this.numVertices/3}get boundingInfo(){return this.engineGeometry.boundingInfo}computeUsedMemory(){return Array.from(this.engineGeometry.attributes.values()).reduce((e,t)=>e+r.estimateNumberArrayMemory(t.data,t.indices),0)}intersect(e,t,r,i,o,s,a,l){const c=this.engineGeometry;this.material.intersect(c,e.transform.transform,e,r,i,(r,i,c)=>n(r,i,c,e,t,s,a,o,l))}},e.LodComponentRenderGeometry=s,e.LodComponentResources=class{constructor(e,t=null){this.geometry=e,this.textures=t}get material(){return this.geometry.material}get numTriangles(){return this.geometry.numTriangles}},e.LodLevelResources=class{constructor(e,r,i){this.components=e,this.minScreenSpaceRadius=r,this.pivotOffset=i;const o=t.unique(this.components.map(e=>e.geometry));this.numVertices=o.reduce((e,t)=>e+t.numVertices,0)}},e.LodResources=class{constructor(e){this.levels=e,this.levels.sort((e,t)=>e.minScreenSpaceRadius===t.minScreenSpaceRadius?e.numVertices-t.numVertices:e.minScreenSpaceRadius-t.minScreenSpaceRadius)}get materialParameters(){return this.levels[0].components[0].geometry.material.parameters}getMaterials(){const e=[];return this.levels.forEach(t=>t.components.forEach(t=>e.push(t.geometry.material))),t.unique(e)}getTextures(){const e=new Array;return this.levels.forEach(t=>t.components.forEach(t=>{null!=t.textures&&e.push(...t.textures)})),t.unique(e)}getGeometries(){const e=new Array;return this.levels.forEach(t=>t.components.forEach(t=>{e.push(t.geometry)})),t.unique(e)}getEngineGeometries(){return this.getGeometries().map(e=>e.engineGeometry).filter(e=>null!=e)}computeUsedMemory(){const e=this.getGeometries(),t=this.getTextures(),r=e.reduce((e,t)=>e+t.computeUsedMemory(),0);return t.reduce((e,t)=>e+t.usedMemory,0)+r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorResult":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/ray"],function(e,t,r,i,o,s,n,a){"use strict";function l(e){return null!=e?.distance}const c=o.create(),u=n.create();e.IntersectorResult=class{get ray(){return this._ray}get distanceInRenderSpace(){return null==this.distance?null:(i.scale(c,this.ray.direction,this.distance),i.length(c))}withinDistance(e){return!!l(this)&&this.distanceInRenderSpace<=e}getIntersectionPoint(e){return!!l(this)&&(i.scale(c,this.ray.direction,this.distance),i.add(e,this.ray.origin,c),!0)}getTransformedNormal(e){return i.copy(u,this.normal),u[3]=0,s.transformMat4(u,u,this.transformation),i.copy(e,u),i.normalize(e,e)}constructor(e){this.intersector=0,this.normal=o.create(),this.transformation=r.create(),this._ray=a.create(),this.init(e)}init(e){this.distance=this.target=this.drapedLayerOrder=this.renderPriority=null,this.intersector=0,a.copy(e,this._ray)}set(e,s,n,a,l,c,u){this.intersector=e,this.distance=n,i.copy(this.normal,a??o.UNIT_Z),t.copy(this.transformation,l??r.IDENTITY),this.target=s,this.drapedLayerOrder=c,this.renderPriority=u}copy(e){a.copy(e.ray,this._ray),this.intersector=e.intersector,this.distance=e.distance,this.target=e.target,this.drapedLayerOrder=e.drapedLayerOrder,this.renderPriority=e.renderPriority,i.copy(this.normal,e.normal),t.copy(this.transformation,e.transformation)}},e.isValidIntersectorResult=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorResult","../IntersectorTarget"],function(e,t,r){"use strict";class i extends r.Graphic3DTarget{constructor(e,t,r,i,o){super(e,t),this.layerViewUid=e,this.graphicUid=t,this.triangleNr=r,this.baseBoundingSphere=i,this.numLodLevels=o}}e.LodTarget=i,e.isLodIntersectorResult=function(e){return t.isValidIntersectorResult(e)&&6===e.intersector&&!!e.target},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorTarget":function(){define(["exports"],function(e){"use strict";class t{constructor(e){this.layerViewUid=e}}e.Graphic3DTarget=class extends t{constructor(e,t){super(e),this.graphicUid=t}},e.LayerTarget=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/symbolization/primitiveObjectUtils":function(){define(["exports","../../../../../../core/has","./symbolizationUtils","../../../../webgl-engine/lib/AttributeArray","../../../../webgl-engine/lib/GeometryUtil"],function(e,t,r,i,o){"use strict";function s(e,t){let r=e.get(t);return r&&!r.exclusive&&(r={...r,exclusive:!0,data:i.cloneAttributeData(r.data)},e.set(t,r)),r}const n=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];e.createPrimitiveGeometry=function(e,t){const i=(e,i,o=!1)=>({levels:e.map(e=>{const n=r.inputAttributesToAttributesMap(i(e.tesselation));return o&&function(e){const t=e,r=t.get("position").data,i=t.get("normal").data;if(i){const t=s(e,"normal").data;for(let e=0;e<i.length;e+=3){const r=i[e+1];t[e+1]=-i[e+2],t[e+2]=r}}if(r){const t=s(e,"position").data;for(let e=0;e<r.length;e+=3){const i=r[e+1];t[e+1]=-r[e+2],t[e+2]=i}}}(n),{components:[{attributes:n,olidColor:void 0,transformation:null,materialId:t,visibilities:new Uint8Array([1]),objectIds:new Uint32Array([-1])}],minScreenSpaceRadius:e.minScreenSpaceRadius}})});switch(e){case"cone":return i(n,e=>o.createConeGeometryData(1,.5,e,!1),!0);case"sphere":return i([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],e=>o.createPolySphereData(.5,e,!0));case"cube":case"inverted-cone":case"cylinder":case"tetrahedron":case"diamond":throw new Error("not implemented");default:return}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../core/shaderLibrary/ShaderOutput","../lib/GLTextureMaterial","../lib/Material","../lib/OrderIndependentTransparency","../lib/RayIntersections","../lib/verticalOffsetUtils","./DefaultBufferWriter","./internal/MaterialUtil","../shaders/DefaultMaterialTechnique","../shaders/DefaultMaterialTechniqueConfiguration","../shaders/RealisticTreeTechnique","../../../../webscene/support/AlphaCutoff"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";class m extends s.Material{constructor(e,t){super(e,g),this.materialType="default",this.supportsEdges=!0,this.intersectDraped=void 0,this.produces=new Map([[2,e=>(i.is3DGeometryOutputMRT(e)||i.isShadowRelatedOutput(e))&&!this.transparent],[4,e=>(i.is3DGeometryOutputMRT(e)||i.isShadowRelatedOutput(e))&&this.transparent&&this.parameters.writeDepth],[8,e=>(i.is3DGeometryOutputMRT(e)||i.isShadowRelatedOutput(e))&&this.transparent&&!this.parameters.writeDepth]]),this._layout=d.getLayout(this.parameters),this._configuration=new p.DefaultMaterialTechniqueConfiguration(t.spherical)}isVisibleForOutput(e){return 4!==e&&6!==e&&5!==e||this.parameters.castShadows}get visible(){const{layerOpacity:e,colorMixMode:t,opacity:r,externalColor:i}=this.parameters;return e*("replace"===t?1:r)*("ignore"===t||isNaN(i[3])?1:i[3])>=f.alphaCutoff}get _hasEmissiveBase(){return!!this.parameters.emissiveTextureId||!t.exactEquals(this.parameters.emissiveBaseColor,r.ZEROS)}get hasEmissions(){return this.parameters.emissiveStrength>0&&(0===this.parameters.emissiveSource&&this._hasEmissiveBase||1===this.parameters.emissiveSource)}getConfiguration(e,t){const{parameters:r,_configuration:o}=this,{treeRendering:s,doubleSided:a,doubleSidedType:l}=r;return super.getConfiguration(e,t,this._configuration),o.hasNormalTexture=r.hasNormalTexture,o.hasColorTexture=r.hasColorTexture,o.hasMetallicRoughnessTexture=r.hasMetallicRoughnessTexture,o.hasOcclusionTexture=r.hasOcclusionTexture,o.hasVertexTangents=!s&&r.hasVertexTangents,o.instanced=r.instanced,o.instancedDoublePrecision=r.instancedDoublePrecision,o.hasVVColor=!!r.vvColor,o.hasVVSize=!!r.vvSize,o.hasVerticalOffset=null!=r.verticalOffset,o.hasScreenSizePerspective=null!=r.screenSizePerspective,o.hasSlicePlane=r.hasSlicePlane,o.alphaDiscardMode=r.textureAlphaMode,o.normalType=s?0:r.normalType,o.transparent=this.transparent,o.writeDepth=r.writeDepth,o.customDepthTest=r.customDepthTest??0,o.hasOccludees=t.hasOccludees,o.cullFace=r.hasSlicePlane?0:r.cullFace,o.cullAboveTerrain=t.cullAboveTerrain,o.hasModelTransformation=!s&&null!=r.modelTransformation,o.hasVertexColors=r.hasVertexColors,o.hasSymbolColors=r.hasSymbolColors,o.doubleSidedMode=s?2:a&&"normal"===l?1:a&&"winding-order"===l?2:0,o.instancedFeatureAttribute=r.instancedFeatureAttribute,o.instancedColor=r.instancedColor,i.isColorOrColorEmission(e)?(o.terrainDepthTest=t.terrainDepthTest,o.receiveShadows=r.receiveShadows,o.receiveAmbientOcclusion=r.receiveAmbientOcclusion&&null!=t.ssao):(o.terrainDepthTest=!1,o.receiveShadows=o.receiveAmbientOcclusion=!1),o.textureAlphaPremultiplied=!!r.textureAlphaPremultiplied,o.pbrMode=r.usePBR?r.isSchematic?2:1:0,o.emissionSource=r.emissionSource,o.offsetBackfaces=!(!this.transparent||!r.offsetTransparentBackfaces),o.oitPass=t.oitPass,o.enableOffset=t.camera.relativeElevation<n.OITPolygonOffsetLimit,o.snowCover=t.snowCover,o.hasBloom=i.isColorEmission(e),o.hasColorTextureTransform=!!r.colorTextureTransformMatrix,o.hasNormalTextureTransform=!!r.normalTextureTransformMatrix,o.hasEmissionTextureTransform=!!r.emissiveTextureTransformMatrix,o.hasOcclusionTextureTransform=!!r.occlusionTextureTransformMatrix,o.hasMetallicRoughnessTextureTransform=!!r.metallicRoughnessTextureTransformMatrix,o}intersect(e,r,i,o,s,n){if(null!=this.parameters.verticalOffset){const e=i.camera;t.set(M,r[12],r[13],r[14]);let n=null;switch(i.viewingMode){case 1:n=t.normalize(x,M);break;case 2:n=t.copy(x,S)}let a=0;const l=t.subtract(T,M,e.eye),c=t.length(l),d=t.scale(l,l,1/c);let p=null;this.parameters.screenSizePerspective&&(p=t.dot(n,d)),a+=u.verticalOffsetAtDistance(e,c,this.parameters.verticalOffset,p??0,this.parameters.screenSizePerspective),t.scale(n,n,a),t.transformMat3(w,n,i.transform.inverseRotation),o=t.subtract(_,o,w),s=t.subtract(v,s,w)}a.intersectTriangleGeometry(e,i,o,s,l.getVerticalOffsetObject3D(i.verticalOffset),n)}createGLMaterial(e){return new y(e)}createBufferWriter(){return new c.DefaultBufferWriter(this._layout)}get transparent(){return b(this.parameters)}}class y extends o.GLTextureMaterial{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){this._material.setParameters({receiveShadows:e.shadowMap.enabled});const r=this._material.parameters;this.updateTexture(r.textureId);const i=e.camera.viewInverseTransposeMatrix;return t.set(r.origin,i[3],i[7],i[11]),this._material.setParameters(this.textureBindParameters),this.getTechnique(r.treeRendering?h.RealisticTreeTechnique:d.DefaultMaterialTechnique,e)}}class g extends d.DefaultMaterialPassParameters{constructor(){super(...arguments),this.treeRendering=!1,this.hasVertexTangents=!1}get hasNormalTexture(){return!this.treeRendering&&!!this.normalTextureId}get hasColorTexture(){return!!this.textureId}get hasMetallicRoughnessTexture(){return!this.treeRendering&&!!this.metallicRoughnessTextureId}get hasOcclusionTexture(){return!this.treeRendering&&!!this.occlusionTextureId}get emissionSource(){return this.treeRendering?0:null!=this.emissiveTextureId&&0===this.emissiveSource?3:this.usePBR?0===this.emissiveSource?2:1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||3===this.emissionSource||this.hasOcclusionTexture}}function b(e){const{drivenOpacity:t,opacity:r,externalColor:i,layerOpacity:o,texture:s,textureId:n,textureAlphaMode:a,colorMixMode:l}=e,c=i[3];return t||r<1&&"replace"!==l||c<1&&"ignore"!==l||o<1||(null!=s||null!=n)&&1!==a&&2!==a&&"replace"!==l}const _=r.create(),v=r.create(),S=r.fromValues(0,0,1),x=r.create(),w=r.create(),M=r.create(),T=r.create();e.DefaultGLMaterial=y,e.DefaultMaterial=m,e.DefaultMaterialParameters=g,e.isTransparent=b,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(e){"use strict";function t(e){return 8===e||9===e}function r(e){return 0===e}function i(e){return r(e)||l(e)}function o(e){return r(e)||8===e}function s(e){return i(e)||t(e)}function n(e){return s(e)||a(e)}function a(e){return 2===e}function l(e){return 1===e}e.is2DGeometryOutput=function(e){return r(e)||t(e)},e.is3DGeometryOutputMRT=function(e){return n(e)||3===e},e.isColor=r,e.isColorEmission=l,e.isColorEmissionHighlightOIDOrDepth=n,e.isColorEmissionHighlightOrOID=s,e.isColorHighlightOrDepth=function(e){return o(e)||a(e)},e.isColorOrColorEmission=i,e.isColorOrColorEmissionOrOID=function(e){return i(e)||9===e},e.isColorOrHighlight=o,e.isColorOrOID=function(e){return r(e)||9===e},e.isDepth=a,e.isDepthOnlyOutput=function(e){switch(e){case 2:case 4:case 5:case 6:case 7:return!0}return!1},e.isHighlightOrOID=t,e.isShadowRelatedOutput=function(e){return 4===e||5===e||6===e||7===e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils","./GLMaterial","../../../webgl/NoParameters"],function(e,t,r,i,o){"use strict";class s extends o.NoParameters{constructor(e=null){super(),this.textureEmissive=e}}class n extends s{constructor(e,t,r,i,o,s,n){super(r),this.texture=e,this.textureNormal=t,this.textureOcclusion=i,this.textureMetallicRoughness=o,this.scale=s,this.normalTextureTransformMatrix=n}}e.GLEmissiveTexturePassParameters=s,e.GLTextureMaterial=class extends i{constructor(e){super(e),this._numLoading=0,this._disposed=!1,this._textures=e.textures,this.updateTexture(e.textureId),this._acquire(e.normalTextureId,e=>this._textureNormal=e),this._acquire(e.emissiveTextureId,e=>this._textureEmissive=e),this._acquire(e.occlusionTextureId,e=>this._textureOcclusion=e),this._acquire(e.metallicRoughnessTextureId,e=>this._textureMetallicRoughness=e)}dispose(){super.dispose(),this._texture=t.releaseMaybe(this._texture),this._textureNormal=t.releaseMaybe(this._textureNormal),this._textureEmissive=t.releaseMaybe(this._textureEmissive),this._textureOcclusion=t.releaseMaybe(this._textureOcclusion),this._textureMetallicRoughness=t.releaseMaybe(this._textureMetallicRoughness),this._disposed=!0}ensureResources(e){return 0===this._numLoading?2:1}get textureBindParameters(){return new n(this._texture?.glTexture??null,this._textureNormal?.glTexture??null,this._textureEmissive?.glTexture??null,this._textureOcclusion?.glTexture??null,this._textureMetallicRoughness?.glTexture??null)}updateTexture(e){null!=this._texture&&e===this._texture.id||(this._texture=t.releaseMaybe(this._texture),this._acquire(e,e=>this._texture=e))}_acquire(e,i){if(null==e)return void i(null);const o=this._textures.acquire(e);if(r.isPromiseLike(o))return++this._numLoading,void o.then(e=>{if(this._disposed)return t.releaseMaybe(e),void i(null);i(e)}).finally(()=>--this._numLoading);i(o)}},e.GLTextureMaterialBindParameters=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(function(){"use strict";return class{constructor(e){this._material=e.material,this._techniques=e.techniques,this._output=e.output}dispose(){}get _stippleTextures(){return this._techniques.context?.stippleTextures}get _markerTextures(){return this._techniques.context?.markerTextures}getTechnique(e,t){return this._techniques.get(e,this._material.getConfiguration(this._output,t))}ensureResources(e){return 2}}})},"esri/views/webgl/NoParameters":function(){define(["exports"],function(e){"use strict";const t=class{},r=new t;e.NoParameters=t,e.noParameters=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["exports","../../../../core/uid","../materials/DefaultTechniqueConfiguration","../materials/internal/MaterialUtil","../../../webgl/NoParameters"],function(e,t,r,i,o){"use strict";class s extends o.NoParameters{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}}e.Material=class{constructor(e,r){this.id=t.generateUID(),this.supportsEdges=!1,this._renderPriority=0,this._parameters=new r,i.updateParameters(this._parameters,e),this.validateParameters(this._parameters)}get parameters(){return this._parameters}update(e){return!1}setParameters(e,t=!0){i.updateParameters(this._parameters,e)&&(this.validateParameters(this._parameters),t&&this._parametersChanged())}validateParameters(e){}shouldRender(e){return this.visible&&this.isVisibleForOutput(e.output)&&(!this.parameters.isDecoration||e.bind.decorations)&&0!==(this.parameters.renderOccluded&e.renderOccludedMask)}isVisibleForOutput(e){return!0}get renderPriority(){return this._renderPriority}set renderPriority(e){e!==this._renderPriority&&(this._renderPriority=e,this._parametersChanged())}_parametersChanged(){this.repository?.materialChanged(this)}get renderOccludedFlags(){return this.visible?this.parameters.renderOccluded:0}get hasEmissions(){return!1}getConfiguration(e,t,i=new r.DefaultTechniqueConfiguration){return i.output=e,i.hasHighlightMixTexture=8===e&&null!=t.highlightMixTexture,i}},e.MaterialParameters=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderLibrary/attributes/InstancedDoubleConfiguration","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(e,t,r,i){"use strict";class o extends r.InstancedDoubleConfiguration{constructor(){super(...arguments),this.output=0,this.oitPass=0,this.hasSlicePlane=!1,this.hasHighlightMixTexture=!1,this.bindType=1,this.instanced=!1,this.writeDepth=!0}}t.__decorate([i.parameter({count:10})],o.prototype,"output",void 0),t.__decorate([i.parameter({count:3})],o.prototype,"oitPass",void 0),t.__decorate([i.parameter()],o.prototype,"hasSlicePlane",void 0),t.__decorate([i.parameter()],o.prototype,"hasHighlightMixTexture",void 0),e.DefaultTechniqueConfiguration=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoubleConfiguration":function(){define(["exports","../../shaderTechnique/ShaderTechniqueConfiguration"],function(e,t){"use strict";class r extends t.ShaderTechniqueConfiguration{constructor(){super(...arguments),this.instancedDoublePrecision=!1,this.hasModelTransformation=!1}}e.InstancedDoubleConfiguration=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../core/Error","./ShaderTechniqueConfigurationKey","../../../../webgl/NoParameters"],function(e,t,r,i){"use strict";class o extends i.NoParameters{constructor(){super(),this._parameterBits=this._parameterBits?.map(()=>0)??[],this._parameterNames??=[]}get key(){return this._key??=new r.ShaderTechniqueConfigurationKey(this._parameterBits),this._key}decode(e=this.key){const t=this._parameterBits;this._parameterBits=[...e.bits];const r=this._parameterNames.map(e=>`    ${e}: ${this[e]}`).join("\n");return this._parameterBits=t,r}}e.ShaderTechniqueConfiguration=o,e.parameter=function(e={}){return(r,i)=>{r.hasOwnProperty("_parameterNames")||Object.defineProperty(r,"_parameterNames",{value:r._parameterNames?.slice()??[],configurable:!0,writable:!0}),r.hasOwnProperty("_parameterBits")||Object.defineProperty(r,"_parameterBits",{value:r._parameterBits?.slice()??[0],configurable:!0,writable:!0}),r._parameterNames.push(i);const o=e.count||2,s=Math.ceil(Math.log2(o)),n=r._parameterBits;let a=0;for(;n[a]+s>16;)a++,a>=n.length&&n.push(0);const l=n[a],c=(1<<s)-1<<l;n[a]+=s,e.count?Object.defineProperty(r,i,{get(){return(this._parameterBits[a]&c)>>l},set(r){if(this[i]!==r){if(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+r<<l&c,"number"!=typeof r)throw new t("internal:invalid-shader-configuration",`Configuration value for ${i} must be a number, got ${typeof r}`);if(null==e.count)throw new t("internal:invalid-shader-configuration",`Configuration value for ${i} must provide a count option`)}}}):Object.defineProperty(r,i,{get(){return!!((this._parameterBits[a]&c)>>l)},set(e){if(this[i]!==e&&(this._key=null,this._parameterBits[a]=this._parameterBits[a]&~c|+e<<l&c,"boolean"!=typeof e))throw new t("internal:invalid-shader-configuration",`Configuration value for ${i} must be boolean, got ${typeof e}`)}})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfigurationKey":function(){define(["exports","../../../../../core/arrayUtils"],function(e,t){"use strict";e.ShaderTechniqueConfigurationKey=class{constructor(e){this._bits=[...e]}equals(e){return t.equals(this._bits,e.bits)}get code(){return this._code??=String.fromCharCode(...this._bits),this._code}get bits(){return this._bits}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../lib/screenSizePerspectiveUtils"],function(e,t,r,i){"use strict";e.colorMixModes={multiply:1,ignore:2,replace:3,tint:4},e.updateParameters=function(e,r){let i=!1;for(const o in r){const s=r[o];void 0!==s&&(Array.isArray(s)?Array.isArray(e[o])&&t.equals(s,e[o])||(e[o]=s.slice(),i=!0):e[o]!==s&&(i=!0,e[o]=s))}return i},e.verticalOffsetAtDistance=function(e,t,o,s,n){let a=o.screenLength*e.pixelRatio;null!=n&&(a=i.scale(a,s,t,n));const l=a*Math.tan(.5*e.fovY)/(.5*e.fullHeight);return r.clamp(l*t,o.minWorldLength,o.maxWorldLength)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/boundedPlane","../../../../chunks/sphere"],function(e,t,r,i){"use strict";function o(e,t,r){const i=r.parameters;return u.scale=Math.min(i.divisor/(t-i.offset),1),u.factor=function(e){return Math.abs(e*e*e)}(e),u}function s(e,r){return t.lerp(e*Math.max(r.scale,r.minScaleFactor),e,r.factor)}class n{get minScaleFactor(){return null!=this._fontHeight?Math.min(this._description.minPixelSize/this._fontHeight,1):0}constructor(e,t,r,i={camera:{distance:0,fovY:0},divisor:0,offset:0},o){this._viewingMode=e,this._description=t,this._ellipsoidRadius=r,this.parameters=i,this._fontHeight=o,2===this._viewingMode?(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}update(e){return!(this.parameters&&this.parameters.camera.fovY===e.fovY&&this.parameters.camera.distance===e.distance||(this._calculateParameters(e,this._ellipsoidRadius,this.parameters),0))}overrideFontHeight(e){return e!==this._fontHeight?new n(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,e):this}_calculateParameters(e,t,r){const{scaleStart:i,scaleFallOffRange:o}=this._description,{fovY:s,distance:n}=e,a=this._calculateCurvatureDependentParameters(e,t),l=this._coverageCompensation(e,t,a),{tiltAngle:c,scaleFallOffFactor:u}=a,d=Math.sin(c)*n,p=.5*Math.PI-c-s*(.5-i*l),h=d/Math.cos(p),f=p+s*o*l,m=(h-u*(d/Math.cos(f)))/(1-u);return r.camera.fovY=e.fovY,r.camera.distance=e.distance,r.offset=m,r.divisor=h-m,r}_calculateCurvatureDependentParametersLocal(e,t,r=d){return r.tiltAngle=this._description.curvatureDependent.min.tiltAngle,r.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor,r}_calculateCurvatureDependentParametersGlobal(e,r,i=d){const o=this._description.curvatureDependent,s=1+e.distance/r,n=Math.sqrt(s*s-1),[a,l]=[o.min.curvature,o.max.curvature],c=t.clamp((n-a)/(l-a),0,1),[u,p]=[o.min,o.max];return i.tiltAngle=t.lerp(u.tiltAngle,p.tiltAngle,c),i.scaleFallOffFactor=t.lerp(u.scaleFallOffFactor,p.scaleFallOffFactor,c),i}_surfaceCoverageCompensationLocal(e,t,i){return r.cameraFrustumCoverage(i.tiltAngle,e.fovY)}_surfaceCoverageCompensationGlobal(e,t,r){return i.fromRadius(p,t),i.cameraFrustumCoverage(p,r.tiltAngle,e.distance,e.fovY)}}const a={curvatureDependent:{min:{curvature:t.deg2rad(10),tiltAngle:t.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:t.deg2rad(70),tiltAngle:t.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},l={scaleFallOffFactor:.7},c={scaleFallOffFactor:.95},u={scale:0,factor:0,minScaleFactor:0},d={tiltAngle:0,scaleFallOffFactor:0},p=i.create();e.applyPrecomputedScaleFactor=function(e,t,r=[0,0]){const i=Math.min(Math.max(t.scale,t.minScaleFactor),1);return r[0]=e[0]*i,r[1]=e[1]*i,r},e.applyScaleFactor=s,e.getLabelSettings=function(e,t){const{curvatureDependent:r,scaleStart:i,scaleFallOffRange:o}=a;return new n(e,{curvatureDependent:{min:{curvature:r.min.curvature,tiltAngle:r.min.tiltAngle,scaleFallOffFactor:l.scaleFallOffFactor},max:{curvature:r.max.curvature,tiltAngle:r.max.tiltAngle,scaleFallOffFactor:c.scaleFallOffFactor}},scaleStart:i,scaleFallOffRange:o,minPixelSize:14},t)},e.getSettings=function(e,t){return new n(e,a,t)},e.precomputeScaleFactor=function(e,t,r,i){i.scale=function(e,t,r){const i=o(e,t,r);return i.minScaleFactor=0,s(1,i)}(e,t,r),i.factor=0,i.minScaleFactor=r.minScaleFactor},e.scale=function(e,t,r,i){return s(e,o(t,r,i))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/boundedPlane":function(){define(["exports","../core/has","../core/Logger","../core/mathUtils","../core/ObjectStack","../core/libs/gl-matrix-2/math/mat4","../core/libs/gl-matrix-2/factories/mat4f64","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","../geometry/support/aaBoundingRect","../geometry/support/lineSegment","../geometry/support/plane","../geometry/support/ray","../geometry/support/vector","../geometry/support/vectorStacks"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";const m=()=>r.getLogger("esri.views.3d.support.geometryUtils.boundedPlane"),y=class{constructor(){this.plane=d.create(),this.origin=l.create(),this.basis1=l.create(),this.basis2=l.create()}};function g(e=Y){return{plane:d.create(e.plane),origin:l.clone(e.origin),basis1:l.clone(e.basis1),basis2:l.clone(e.basis2)}}function b(e,t,r){const i=K.get();return i.origin=e,i.basis1=t,i.basis2=r,i.plane=d.wrap(0,0,0,0),x(i),i}function _(e,t=g()){return S(e.origin,e.basis1,e.basis2,t)}function v(e,t){a.copy(t.origin,e.origin),a.copy(t.basis1,e.basis1),a.copy(t.basis2,e.basis2),d.copy(t.plane,e.plane)}function S(e,t,r,i=g()){return a.copy(i.origin,e),a.copy(i.basis1,t),a.copy(i.basis2,r),x(i),o=i,s="fromValues()",Math.abs(a.dot(o.basis1,o.basis2)/(a.length(o.basis1)*a.length(o.basis2)))>1e-6&&m().warn(s,"Provided basis vectors are not perpendicular"),Math.abs(a.dot(o.basis1,G(o)))>1e-6&&m().warn(s,"Basis vectors and plane normal are not perpendicular"),Math.abs(-a.dot(G(o),o.origin)-o.plane[3])>1e-6&&m().warn(s,"Plane offset is not consistent with plane origin"),i;var o,s}function x(e){d.fromVectorsAndPoint(e.basis2,e.basis1,e.origin,e.plane)}function w(e,t,r){e!==r&&_(e,r);const i=a.scale(f.sv3d.get(),G(e),t);return a.add(r.origin,r.origin,i),r.plane[3]-=t,r}function M(e,t,r){return P(t,r),w(r,j(e,e.origin),r),r}function T(e,t){const r=e.basis1[0],i=e.basis2[1],[o,s]=e.origin;return c.fromValues(o-r,s-i,o+r,s+i,t)}function P(e,t=g()){const r=(e[2]-e[0])/2,i=(e[3]-e[1])/2;return a.set(t.origin,e[0]+r,e[1]+i,0),a.set(t.basis1,r,0,0),a.set(t.basis2,0,i,0),d.fromValues(0,0,1,0,t.plane),t}function I(e,t,r){return!!d.intersectRay(e.plane,t,r)&&H(e,r)}function C(e,t,r){if(I(e,t,r))return r;const i=O(e,t,f.sv3d.get());return a.add(r,t.origin,a.scale(f.sv3d.get(),t.direction,a.distance(t.origin,i)/a.length(t.direction))),r}function O(e,t,r){const o=Z.get();J(e,t,o,Z.get());let s=Number.POSITIVE_INFINITY;for(const n of ee){const l=$(e,n,Q.get()),c=f.sv3d.get();if(d.intersectLineSegment(o,l,c)){const e=a.direction(f.sv3d.get(),t.origin,c),o=Math.abs(i.acosClamped(a.dot(t.direction,e)));o<s&&(s=o,a.copy(r,c))}}return s===Number.POSITIVE_INFINITY?A(e,t,r):r}function F(e,t){return(t-e)/t}function A(e,t,r){if(I(e,t,r))return r;const i=Z.get(),o=Z.get();J(e,t,i,o);let s=Number.POSITIVE_INFINITY;for(const n of ee){const l=$(e,n,Q.get()),c=f.sv3d.get();if(d.intersectLineSegmentClamp(i,l,c)){const e=p.distance2(t,c);if(!d.isPointInside(o,c))continue;e<s&&(s=e,a.copy(r,c))}}return E(e,t.origin)<s&&R(e,t.origin,r),r}function R(e,t,r){const i=d.projectPoint(e.plane,t,f.sv3d.get()),o=u.projectPointClamp(W(e,e.basis1),i,-1,1,f.sv3d.get()),s=u.projectPointClamp(W(e,e.basis2),i,-1,1,f.sv3d.get());return a.subtract(r,a.add(f.sv3d.get(),o,s),e.origin),r}function D(e,t,r){const{origin:i,basis1:o,basis2:s}=e,n=a.subtract(f.sv3d.get(),t,i),l=h.projectPointSignedLength(o,n),c=h.projectPointSignedLength(s,n),u=h.projectPointSignedLength(G(e),n);return a.set(r,l,c,u)}function E(e,t){const r=D(e,t,f.sv3d.get()),{basis1:i,basis2:o}=e,s=a.length(i),n=a.length(o),l=Math.max(Math.abs(r[0])-s,0),c=Math.max(Math.abs(r[1])-n,0),u=r[2];return l*l+c*c+u*u}function V(e,t){return Math.sqrt(E(e,t))}function L(e,t){let r=Number.NEGATIVE_INFINITY;for(const i of ee){const o=$(e,i,Q.get()),s=u.distance2(o,t);s>r&&(r=s)}return Math.sqrt(r)}function z(e,t){return d.isPointInside(e.plane,t)&&H(e,t)}function U(e,t,r,i){return function(e,t,r){switch(t){case 0:a.copy(r,e.basis1),a.normalize(r,r);break;case 1:a.copy(r,e.basis2),a.normalize(r,r);break;case 2:a.copy(r,G(e))}return r}(e,r,i)}function j(e,t){const r=-e.plane[3];return h.projectPointSignedLength(G(e),t)-r}function B(e,t,r,i){const o=j(e,t),s=a.scale(X,G(e),r-o);return a.add(i,t,s),i}function N(e,t){return a.exactEquals(e.basis1,t.basis1)&&a.exactEquals(e.basis2,t.basis2)&&a.exactEquals(e.origin,t.origin)}function k(e,t,r){return e!==r&&_(e,r),s.invert(te,t),s.transpose(te,te),a.transformMat4(r.basis1,e.basis1,te),a.transformMat4(r.basis2,e.basis2,te),a.transformMat4(d.getNormal(r.plane),d.getNormal(e.plane),te),a.transformMat4(r.origin,e.origin,t),d.setOffsetFromPoint(r.plane,r.plane,r.origin),r}function q(e,t,r,i){return e!==i&&_(e,i),s.fromRotation(re,t,r),a.transformMat4(i.basis1,e.basis1,re),a.transformMat4(i.basis2,e.basis2,re),x(i),i}function G(e){return d.getNormal(e.plane)}function H(e,t){const r=a.subtract(f.sv3d.get(),t,e.origin),i=a.squaredLength(e.basis1),o=a.squaredLength(e.basis2),s=a.dot(e.basis1,r),n=a.dot(e.basis2,r);return-s-i<0&&s-i<0&&-n-o<0&&n-o<0}function W(e,t){const r=Q.get();return a.copy(r.origin,e.origin),a.copy(r.vector,t),r}function $(e,t,r){const{basis1:i,basis2:o,origin:s}=e,n=a.scale(f.sv3d.get(),i,t.origin[0]),l=a.scale(f.sv3d.get(),o,t.origin[1]);a.add(r.origin,n,l),a.add(r.origin,r.origin,s);const c=a.scale(f.sv3d.get(),i,t.direction[0]),u=a.scale(f.sv3d.get(),o,t.direction[1]);return a.scale(r.vector,a.add(c,c,u),2),r}function J(e,t,r,i){const o=G(e);d.fromVectorsAndPoint(o,t.direction,t.origin,r),d.fromVectorsAndPoint(d.getNormal(r),o,t.origin,i)}const Y={plane:d.create(),origin:l.fromValues(0,0,0),basis1:l.fromValues(1,0,0),basis2:l.fromValues(0,1,0)},Z=new o.ObjectStack(d.create),Q=new o.ObjectStack(u.create),X=l.create(),K=new o.ObjectStack(()=>g()),ee=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],te=n.create(),re=n.create(),ie=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:y,altitudeAt:j,axisAt:U,cameraFrustumCoverage:F,closestPoint:A,closestPointOnSilhouette:O,copy:_,copyWithoutVerify:v,create:g,distance:V,distance2:E,distanceToSilhouette:L,elevate:w,equals:N,extrusionContainsPoint:z,fromAABoundingRect:P,fromValues:S,getExtent:T,intersectRay:I,intersectRayClosestSilhouette:C,normal:G,projectPoint:R,projectPointLocal:D,rotate:q,setAltitudeAt:B,setExtent:M,transform:k,up:Y,updateUnboundedPlane:x,wrap:b},Symbol.toStringTag,{value:"Module"}));e.BoundedPlaneClass=y,e.altitudeAt=j,e.axisAt=U,e.boundedPlane=ie,e.cameraFrustumCoverage=F,e.closestPoint=A,e.closestPointOnSilhouette=O,e.copy=_,e.copyWithoutVerify=v,e.create=g,e.distance=V,e.distance2=E,e.distanceToSilhouette=L,e.elevate=w,e.equals=N,e.extrusionContainsPoint=z,e.fromAABoundingRect=P,e.fromValues=S,e.getExtent=T,e.intersectRay=I,e.intersectRayClosestSilhouette=C,e.normal=G,e.projectPoint=R,e.projectPointLocal=D,e.rotate=q,e.setAltitudeAt=B,e.setExtent=M,e.transform=k,e.up=Y,e.updateUnboundedPlane=x,e.wrap=b})},"esri/chunks/sphere":function(){define(["exports","../core/has","../core/Logger","../core/mathUtils","../core/libs/gl-matrix-2/math/mat4","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","./vec42","../core/libs/gl-matrix-2/factories/vec4f64","../core/libs/gl-matrix-2/math/common","../geometry/support/ray","../geometry/support/sphereUtils","../geometry/support/vector","../geometry/support/vectorStacks"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";const f=m();function m(){return l.create()}const y=a.equals,g=a.equals;function b(e,t){return a.copy(t,e)}function _(e,t){return l.fromValues(e[0],e[1],e[2],t)}function v(e){return e}function S(e){e[0]=e[1]=e[2]=e[3]=0}function x(e,t){return e[0]=e[1]=e[2]=0,e[3]=t,e}function w(e){return e[3]}function M(e){return e}function T(e,t,r,i){return l.fromValues(e,t,r,i)}function P(e,t,r){return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=e[3]+t,r}function I(e,t,r){return e!==r&&b(e,r),r}function C(e,t){return t}function O(e,t,r){if(null==t)return!1;if(!R(e,t,A))return!1;let{t0:i,t1:o}=A;if((i<0||o<i&&o>0)&&(i=o),i<0)return!1;if(r){const{origin:e,direction:o}=t;r[0]=e[0]+o[0]*i,r[1]=e[1]+o[1]*i,r[2]=e[2]+o[2]*i}return!0}function F(e,t,r){const i=u.fromPoints(t,r);if(!R(e,i,A))return[];const{origin:o,direction:a}=i,{t0:l,t1:d}=A,p=t=>{const r=n.create();return s.scaleAndAdd(r,o,a,t),j(e,r,r)};return Math.abs(l-d)<c.getEpsilon()?[p(l)]:[p(l),p(d)]}const A={t0:0,t1:0};function R(e,t,r){const{origin:i,direction:o}=t,s=D;s[0]=i[0]-e[0],s[1]=i[1]-e[1],s[2]=i[2]-e[2];const n=o[0]*o[0]+o[1]*o[1]+o[2]*o[2];if(0===n)return!1;const a=2*(o[0]*s[0]+o[1]*s[1]+o[2]*s[2]),l=a*a-4*n*(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]-e[3]*e[3]);if(l<0)return!1;const c=Math.sqrt(l);return r.t0=(-a-c)/(2*n),r.t1=(-a+c)/(2*n),!0}const D=n.create();function E(e,t){return O(e,t,null)}function V(e,t,r){if(O(e,t,r))return r;const i=L(e,t,h.sv3d.get());return s.add(r,t.origin,s.scale(h.sv3d.get(),t.direction,s.distance(t.origin,i)/s.length(t.direction))),r}function L(e,t,r){const i=h.sv3d.get(),n=h.sm4d.get();s.cross(i,t.origin,t.direction);const a=w(e);s.cross(r,i,t.origin),s.scale(r,r,1/s.length(r)*a);const l=N(e,t.origin),c=p.angle(t.origin,r);return o.fromRotation(n,c+l,i),s.transformMat4(r,r,n),r}function z(e,t,r,i){const o=w(e),s=o*o,n=t+.5*Math.PI,a=r*r+s-2*Math.cos(n)*r*o,l=Math.sqrt(a),c=a-s;if(c<=0)return.5;const u=Math.sqrt(c),d=Math.acos(u/l)-Math.asin(o/(l/Math.sin(n)));return Math.min(1,(d+.5*i)/i)}function U(e,t,r){return O(e,t,r)?r:(u.closestPoint(t,e,r),j(e,r,r))}function j(e,t,r){const i=s.subtract(h.sv3d.get(),t,e),o=s.scale(h.sv3d.get(),i,e[3]/s.length(i));return s.add(r,o,e)}function B(e,t){const r=s.subtract(h.sv3d.get(),t,e),i=s.squaredLength(r),o=e[3]*e[3];return Math.sqrt(Math.abs(i-o))}function N(e,t){const r=s.subtract(h.sv3d.get(),t,e),o=s.length(r),n=w(e),a=n+Math.abs(n-o);return i.acosClamped(n/a)}const k=n.create();function q(e,t,r,i){const o=s.subtract(k,t,e);switch(r){case 0:{const e=d.cartesianToSpherical(o,k)[2];return s.set(i,-Math.sin(e),Math.cos(e),0)}case 1:{const e=d.cartesianToSpherical(o,k),t=e[1],r=e[2],n=Math.sin(t);return s.set(i,-n*Math.cos(r),-n*Math.sin(r),Math.cos(t))}case 2:return s.normalize(i,o);default:return}}function G(e,t){const r=s.subtract(J,t,e);return s.length(r)-e[3]}function H(e,t,r,i){const o=G(e,t),n=q(e,t,2,J),a=s.scale(J,n,r-o);return s.add(i,t,a)}function W(e,t){const r=s.squaredDistance(e,t),i=w(e);return r<=i*i}function $(e,t,r=l.create()){const i=s.distance(e,t),o=e[3],n=t[3];return i+n<o?(a.copy(r,e),r):i+o<n?(a.copy(r,t),r):(s.lerp(r,e,t,(i+n-o)/(2*i)),r[3]=(i+o+n)/2,r)}const J=n.create(),Y=m(),Z=Object.freeze(Object.defineProperty({__proto__:null,NullSphere:f,altitudeAt:G,angleToSilhouette:N,axisAt:q,cameraFrustumCoverage:z,clear:S,closestPoint:U,closestPointOnSilhouette:L,containsPoint:W,copy:b,create:m,distanceToSilhouette:B,elevate:P,equals:g,exactEquals:y,fromCenterAndRadius:_,fromRadius:x,fromValues:T,getCenter:M,getExtent:C,getRadius:w,intersectLine:F,intersectRay:O,intersectRayClosestSilhouette:V,intersectsRay:E,projectPoint:j,setAltitudeAt:H,setExtent:I,tmpSphere:Y,union:$,wrap:v},Symbol.toStringTag,{value:"Module"}));e.NullSphere=f,e.altitudeAt=G,e.angleToSilhouette=N,e.axisAt=q,e.cameraFrustumCoverage=z,e.clear=S,e.closestPoint=U,e.closestPointOnSilhouette=L,e.containsPoint=W,e.copy=b,e.create=m,e.distanceToSilhouette=B,e.elevate=P,e.equals=g,e.exactEquals=y,e.fromCenterAndRadius=_,e.fromRadius=x,e.fromValues=T,e.getCenter=M,e.getExtent=C,e.getRadius=w,e.intersectLine=F,e.intersectRay=O,e.intersectRayClosestSilhouette=V,e.intersectsRay=E,e.projectPoint=j,e.setAltitudeAt=H,e.setExtent=I,e.sphere=Z,e.tmpSphere=Y,e.union=$,e.wrap=v})},"esri/geometry/support/sphereUtils":function(){define(["exports","../../core/mathUtils","../../chunks/vec32"],function(e,t,r){"use strict";e.cartesianToSpherical=function(e,i){const o=r.length(e),s=t.asinClamped(e[2]/o),n=Math.atan2(e[1]/o,e[0]/o);return r.set(i,o,s,n),i},e.sphericalToCartesian=function(e,t){const i=e[0],o=e[1],s=e[2],n=Math.cos(o);r.set(t,i*n*Math.cos(s),i*n*Math.sin(s),i*Math.sin(o))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","../core/shaderLibrary/ShaderOutput","../../../webgl/enums","../../../webgl/renderState"],function(e,t,r,i){"use strict";const o=i.separateBlendingParams(1,0,1,771),s={factor:-1,units:-2};e.OITPolygonOffset=s,e.OITPolygonOffsetLimit=5e5,e.blending=function(e){switch(e){case 0:return i.unpremultipliedAlphaToPremultipliedAlpha;case 1:return o;case 2:case 3:return null}},e.blendingColorAlpha=o,e.depthWrite=function(e){if(e.draped)return null;switch(e.oitPass){case 0:case 2:return e.writeDepth?i.defaultDepthWrite:null;case 1:case 3:return null}},e.getDrawBuffers=function(e,i){const o=t.isColorEmission(i);return 1===e?o?{buffers:[r.ColorAttachment0,r.ColorAttachment1,r.ColorAttachment2]}:{buffers:[r.ColorAttachment0,r.ColorAttachment1]}:o?{buffers:[r.ColorAttachment0,r.ColorAttachment1]}:null},e.oitBlending=function(e){return 2===e?null:o},e.oitDepthTest=function(e,t=513){return 0===e||2===e?t:515},e.oitPolygonOffset=function({oitPass:e,enableOffset:t}){return t&&1===e?s:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports"],function(e){"use strict";function t(e,t,r=32774,i=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:r,opAlpha:r,color:{r:i[0],g:i[1],b:i[2],a:i[3]}}}function r(e,t,r,i,o=32774,s=32774,n=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:r,dstAlpha:i,opRgb:o,opAlpha:s,color:{r:n[0],g:n[1],b:n[2],a:n[3]}}}const i=t(0,771),o=t(1,0),s=t(1,1),n=t(1,771),a=r(770,1,771,771),l={face:1029,mode:2305},c={face:1028,mode:2305};function u(e){return S.intern(e)}function d(e){return w.intern(e)}function p(e){return T.intern(e)}function h(e){return I.intern(e)}function f(e){return O.intern(e)}function m(e){return A.intern(e)}function y(e){return D.intern(e)}function g(e){return V.intern(e)}function b(e){return z.intern(e)}class _{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),r=this._interns;return r.has(t)||r.set(t,this._makeRef(e)),r.get(t)??null}}function v(e){return"["+e.join(",")+"]"}const S=new _(x,e=>({__tag:"Blending",...e}));function x(e){return e?v([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const w=new _(M,e=>({__tag:"Culling",...e}));function M(e){return e?v([e.face,e.mode]):null}const T=new _(P,e=>({__tag:"PolygonOffset",...e}));function P(e){return e?v([e.factor,e.units]):null}const I=new _(C,e=>({__tag:"DepthTest",...e}));function C(e){return e?v([e.func]):null}const O=new _(F,e=>({__tag:"StencilTest",...e}));function F(e){return e?v([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const A=new _(R,e=>({__tag:"DepthWrite",...e}));function R(e){return e?v([e.zNear,e.zFar]):null}const D=new _(E,e=>({__tag:"ColorWrite",...e}));function E(e){return e?v([e.r,e.g,e.b,e.a]):null}const V=new _(L,e=>({__tag:"StencilWrite",...e}));function L(e){return e?v([e.mask]):null}const z=new _(U,e=>({__tag:"DrawBuffers",...e}));function U(e){return e?v(e.buffers):null}const j=new _(function(e){return e?v([x(e.blending),M(e.culling),P(e.polygonOffset),C(e.depthTest),F(e.stencilTest),R(e.depthWrite),E(e.colorWrite),L(e.stencilWrite),U(e.drawBuffers)]):null},e=>({blending:u(e.blending),culling:d(e.culling),polygonOffset:p(e.polygonOffset),depthTest:h(e.depthTest),stencilTest:f(e.stencilTest),depthWrite:m(e.depthWrite),colorWrite:y(e.colorWrite),stencilWrite:g(e.stencilWrite),drawBuffers:b(e.drawBuffers)}));e.StateTracker=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,r,i){return(r||e!==t)&&(i(e),this._pipelineInvalid=!0),e}},e.add=s,e.backFaceCullingParams=l,e.copySource=o,e.cullingParams=e=>2===e?l:1===e?c:null,e.defaultColorWrite={r:!0,g:!0,b:!0,a:!0},e.defaultDepthWrite={zNear:0,zFar:1},e.destinationTimesOneMinusSourceAlpha=i,e.frontFaceCullingParams=c,e.makeBlending=u,e.makeColorWrite=y,e.makeCulling=d,e.makeDepthTest=h,e.makeDepthWrite=m,e.makeDrawBuffers=b,e.makePipelineState=function(e){return j.intern(e)},e.makePolygonOffset=p,e.makeStencilTest=f,e.makeStencilWrite=g,e.premultipliedAlpha=n,e.separateBlendingParams=r,e.simpleBlendingParams=t,e.unpremultipliedAlphaToPremultipliedAlpha=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RayIntersections":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/aaBoundingBox","./Util"],function(e,t,r,i,o){"use strict";class s{constructor(e=!1,t=!0){this.isVerticalRay=e,this.normalRequired=t}}const n=i.create(),a=r.create();function l(e,t,r,o,s,u,d){if(null==e)return;const p=b(r,a);if(i.setMin(n,e.bbMin),i.setMax(n,e.bbMax),null!=s&&s.applyToAabb(n),_(n,t,p,o)){const{primitiveIndices:i,position:n}=e,a=i?i.length:n.indices.length/3;if(a>S){const i=e.getChildren();if(void 0!==i){for(const e of i)l(e,t,r,o,s,u,d);return}}!function(e,t,r,i,o,s,n,a,l,u,d){const p=e[0],h=e[1],m=e[2],y=t[0],g=t[1],b=t[2],{normalRequired:_}=u;for(let e=0;e<i;++e){const t=a[e],r=3*t,i=n*o[r];let u=s[i],v=s[i+1],S=s[i+2];const w=n*o[r+1];let M=s[w],T=s[w+1],P=s[w+2];const I=n*o[r+2];let C=s[I],O=s[I+1],F=s[I+2];null!=l&&([u,v,S]=l.applyToVertex(u,v,S,e),[M,T,P]=l.applyToVertex(M,T,P,e),[C,O,F]=l.applyToVertex(C,O,F,e));const A=M-u,R=T-v,D=P-S,E=C-u,V=O-v,L=F-S,z=g*L-V*b,U=b*E-L*y,j=y*V-E*g,B=A*z+R*U+D*j;if(Math.abs(B)<=x)continue;const N=p-u,k=h-v,q=m-S,G=N*z+k*U+q*j;if(B>0){if(G<0||G>B)continue}else if(G>0||G<B)continue;const H=k*D-R*q,W=q*A-D*N,$=N*R-A*k,J=y*H+g*W+b*$;if(B>0){if(J<0||G+J>B)continue}else if(J>0||G+J<B)continue;const Y=(E*H+V*W+L*$)/B;Y>=0&&d(Y,t,_?f(A,R,D,E,V,L,c):null)}}(t,r,0,a,n.indices,n.data,n.stride,i,s,u,d)}}const c=r.create();function u(e,r,i,o,s,n,a,l,c,u){const f=r,y=M,g=Math.abs(f[0]),b=Math.abs(f[1]),_=Math.abs(f[2]),v=g>=b?g>=_?0:2:b>=_?1:2,S=v,x=f[S]<0?2:1,w=(v+x)%3,T=(v+(3-x))%3,P=f[w]/f[S],I=f[T]/f[S],C=1/f[S],O=d,F=p,A=h,{normalRequired:R}=c;for(let r=i;r<o;++r){const i=3*r,o=a*s[i];t.set(y[0],n[o+0],n[o+1],n[o+2]);const c=a*s[i+1];t.set(y[1],n[c+0],n[c+1],n[c+2]);const d=a*s[i+2];t.set(y[2],n[d+0],n[d+1],n[d+2]),l&&(t.copy(y[0],l.applyToVertex(y[0][0],y[0][1],y[0][2],r)),t.copy(y[1],l.applyToVertex(y[1][0],y[1][1],y[1][2],r)),t.copy(y[2],l.applyToVertex(y[2][0],y[2][1],y[2][2],r))),t.sub(O,y[0],e),t.sub(F,y[1],e),t.sub(A,y[2],e);const p=O[w]-P*O[S],h=O[T]-I*O[S],f=F[w]-P*F[S],g=F[T]-I*F[S],b=A[w]-P*A[S],_=A[T]-I*A[S],v=b*g-_*f,x=p*_-h*b,M=f*h-g*p;if((v<0||x<0||M<0)&&(v>0||x>0||M>0))continue;const D=v+x+M;if(0===D)continue;const E=v*(C*O[S])+x*(C*F[S])+M*(C*A[S]);if(E*Math.sign(D)<0)continue;const V=E/D;V>=0&&u(V,r,R?m(y):null)}}const d=r.create(),p=r.create(),h=r.create();function f(e,r,i,o,s,n,a){return t.set(y,e,r,i),t.set(g,o,s,n),t.cross(a,y,g),t.normalize(a,a),a}function m(e){return t.sub(y,e[1],e[0]),t.sub(g,e[2],e[0]),t.cross(c,y,g),t.normalize(c,c),c}const y=r.create(),g=r.create();function b(e,r){return t.set(r,1/e[0],1/e[1],1/e[2])}function _(e,t,r,i){return v(e,t,r,i,1/0)}function v(e,t,r,i,o){const s=(e[0]-i-t[0])*r[0],n=(e[3]+i-t[0])*r[0];let a=Math.min(s,n),l=Math.max(s,n);const c=(e[1]-i-t[1])*r[1],u=(e[4]+i-t[1])*r[1];if(l=Math.min(l,Math.max(c,u)),l<0)return!1;if(a=Math.max(a,Math.min(c,u)),a>l)return!1;const d=(e[2]-i-t[2])*r[2],p=(e[5]+i-t[2])*r[2];return l=Math.min(l,Math.max(d,p)),!(l<0)&&(a=Math.max(a,Math.min(d,p)),!(a>l)&&a<o)}const S=1e3,x=1e-7,w=r.create(),M=[r.create(),r.create(),r.create()];e.MeshIntersectionOptions=s,e.computeInvDir=function(e,r,i){return t.set(i,1/(r[0]-e[0]),1/(r[1]-e[1]),1/(r[2]-e[2]))},e.computeInvDirFromDirection=b,e.computeNormalFromBarycentric=f,e.intersectAabbInvDir=_,e.intersectAabbInvDirBefore=v,e.intersectRayTriangles=function(e,t,r,i,o,s,n,a,l,u=null,d=0){const p=e[0],h=e[1],m=e[2],y=t[0],g=t[1],b=t[2];for(let e=r;e<i;++e){const t=d+(u?u[e]:e),r=3*t,i=n*o[r],_=s[i],v=s[i+1],S=s[i+2],w=n*o[r+1],M=s[w],T=s[w+1],P=s[w+2],I=n*o[r+2],C=M-_,O=T-v,F=P-S,A=s[I]-_,R=s[I+1]-v,D=s[I+2]-S,E=g*D-R*b,V=b*A-D*y,L=y*R-A*g,z=C*E+O*V+F*L;if(Math.abs(z)<=x)continue;const U=p-_,j=h-v,B=m-S,N=U*E+j*V+B*L;if(z>0){if(N<0||N>z)continue}else if(N>0||N<z)continue;const k=j*F-O*B,q=B*C-F*U,G=U*O-C*j,H=y*k+g*q+b*G;if(z>0){if(H<0||N+H>z)continue}else if(H>0||N+H<z)continue;const W=(A*k+R*q+D*G)/z;W>=0&&l(W,t,a?f(C,O,F,A,R,D,c):null)}},e.intersectRayTrianglesWithDisplacementWatertight=u,e.intersectRayTrianglesWithVerticalOffsetENUGlobal=function(e,t,r,i,o,s,n,a,l,u,d,p=null,h=0){const m=e[0],y=e[1],g=e[2],b=t[0],_=t[1],v=t[2];for(let e=r;e<i;++e){const t=h+(p?p[e]:e),r=3*t,i=n*o[r],S=s[i],w=s[i+1],M=s[i+2],T=n*o[r+1],P=s[T],I=s[T+1],C=s[T+2],O=n*o[r+2],F=s[O],A=s[O+1],R=s[O+2],D=M-l,E=a/Math.sqrt(S*S+w*w+D*D),V=S+S*E,L=w+w*E,z=M+D*E,U=C-l,j=a/Math.sqrt(P*P+I*I+U*U),B=P+P*j,N=I+I*j,k=C+U*j,q=R-l,G=a/Math.sqrt(F*F+A*A+q*q),H=B-V,W=N-L,$=k-z,J=F+F*G-V,Y=A+A*G-L,Z=R+q*G-z,Q=_*Z-Y*v,X=v*J-Z*b,K=b*Y-J*_,ee=H*Q+W*X+$*K;if(Math.abs(ee)<=x)continue;const te=m-V,re=y-L,ie=g-z,oe=te*Q+re*X+ie*K;if(ee>0){if(oe<0||oe>ee)continue}else if(oe>0||oe<ee)continue;const se=re*$-W*ie,ne=ie*H-$*te,ae=te*W-H*re,le=b*se+_*ne+v*ae;if(ee>0){if(le<0||oe+le>ee)continue}else if(le>0||oe+le<ee)continue;const ce=(J*se+Y*ne+Z*ae)/ee;ce>=0&&d(ce,t,u?f(H,W,$,J,Y,Z,c):null)}},e.intersectRenderGeometryTriangles=function(e,t,r,i,o,s,n,a){const l=e[0],u=e[1],d=e[2],p=t[0],h=t[1],m=t[2];for(let e=r;e<i;++e){const t=3*e,r=t+1,i=t+2,y=s*t,g=o[y],b=o[y+1],_=o[y+2],v=s*r,S=s*i,w=o[v]-g,M=o[v+1]-b,T=o[v+2]-_,P=o[S]-g,I=o[S+1]-b,C=o[S+2]-_,O=h*C-I*m,F=m*P-C*p,A=p*I-P*h,R=w*O+M*F+T*A;if(Math.abs(R)<=x)continue;const D=l-g,E=u-b,V=d-_,L=D*O+E*F+V*A;if(R>0){if(L<0||L>R)continue}else if(L>0||L<R)continue;const z=E*T-M*V,U=V*w-T*D,j=D*M-w*E,B=p*z+h*U+m*j;if(R>0){if(B<0||L+B>R)continue}else if(B>0||L+B<R)continue;const N=(P*z+I*U+C*j)/R;N>=0&&a(N,e,n?f(w,M,T,P,I,C,c):null)}},e.intersectTriangleGeometry=function(e,r,i,n,a,c){if(!e.visible)return;const d=t.sub(w,n,i),p=(e,t,r)=>{c(e,r,t)},h=new s(!1,r.options.normalRequired);if(e.boundingInfo){o.assert(0===e.type);const t=r.tolerance;l(e.boundingInfo,i,d,t,a,h,p)}else{const t=e.attributes.get("position"),r=t.indices;u(i,d,0,r.length/3,r,t.data,t.stride,a,h,p)}},e.intersectTriangles=function(e,r,i,o,s,n,a,l,c){const{data:d,stride:p}=n;u(e,t.sub(w,r,e),i,o,s,d,p,a,l,c)},e.triangleRayParallelTolerance=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/sphere","../../support/orientedBoundingBox"],function(e,t,r,i,o,s,n,a,l){"use strict";class c{constructor(e,t,r){this._original=e,this._update=t,this._dirty=!0,this._transform=r()}invalidate(){this._dirty=!0}get value(){return this._dirty&&(this._update(this._transform,this._original.value),this._dirty=!1),this._transform}}class u{constructor(e=0){this.offset=e,this.tmpVertex=n.create()}applyToVertex(e,t,r){const i=s.set(y,e,t,r),o=s.add(g,i,this.localOrigin),n=this.offset/s.length(o);return s.scaleAndAdd(this.tmpVertex,i,o,n),this.tmpVertex}applyToAabb(e){const t=b,r=_,i=v;for(let o=0;o<3;++o)t[o]=e[0+o]+this.localOrigin[o],r[o]=e[3+o]+this.localOrigin[o],i[o]=t[o];const o=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=o[t],e[t+3]=o[t];const s=t=>{const r=this.applyToVertex(t[0],t[1],t[2]);for(let t=0;t<3;++t)e[t]=Math.min(e[t],r[t]),e[t+3]=Math.max(e[t+3],r[t])};for(let e=1;e<8;++e){for(let o=0;o<3;++o)i[o]=e&1<<o?r[o]:t[o];s(i)}let n=0;for(let e=0;e<3;++e)t[e]*r[e]<0&&(n|=1<<e);if(0!==n&&7!==n)for(let e=0;e<8;++e)if(0===(n&e)){for(let o=0;o<3;++o)i[o]=n&1<<o?0:e&1<<o?t[o]:r[o];s(i)}for(let t=0;t<3;++t)e[t]-=this.localOrigin[t],e[t+3]-=this.localOrigin[t];return e}}class d{constructor(e=0){this.componentLocalOriginLength=0,this._totalOffset=0,this._offset=0,this._tmpVertex=n.create(),this._tmpMbs=a.create(),this._tmpObb=new l.Obb,this._resetOffset(e)}_resetOffset(e){this._offset=e,this._totalOffset=e}set offset(e){this._resetOffset(e)}get offset(){return this._offset}set componentOffset(e){this._totalOffset=this._offset+e}set localOrigin(e){this.componentLocalOriginLength=s.length(e)}applyToVertex(e,t,r){const i=s.set(y,e,t,r),o=s.set(g,e,t,r+this.componentLocalOriginLength),n=this._totalOffset/s.length(o);return s.scaleAndAdd(this._tmpVertex,i,o,n),this._tmpVertex}applyToAabb(e){const t=this.componentLocalOriginLength,r=e[0],i=e[1],o=e[2]+t,s=e[3],n=e[4],a=e[5]+t,l=Math.abs(r),c=Math.abs(i),u=Math.abs(o),d=Math.abs(s),p=Math.abs(n),h=Math.abs(a),f=.5*(1+Math.sign(r*s))*Math.min(l,d),m=.5*(1+Math.sign(i*n))*Math.min(c,p),y=.5*(1+Math.sign(o*a))*Math.min(u,h),g=Math.max(l,d),b=Math.max(c,p),_=Math.max(u,h),v=Math.sqrt(f*f+m*m+y*y),S=Math.sign(l+r),x=Math.sign(c+i),w=Math.sign(u+o),M=Math.sign(d+s),T=Math.sign(p+n),P=Math.sign(h+a),I=this._totalOffset;if(v<I)return e[0]-=(1-S)*I,e[1]-=(1-x)*I,e[2]-=(1-w)*I,e[3]+=M*I,e[4]+=T*I,e[5]+=P*I,e;const C=I/Math.sqrt(g*g+b*b+_*_),O=I/v,F=O-C,A=-F;return e[0]+=r*(S*A+O),e[1]+=i*(x*A+O),e[2]+=o*(w*A+O),e[3]+=s*(M*F+C),e[4]+=n*(T*F+C),e[5]+=a*(P*F+C),e}applyToMbs(e){const t=s.length(a.getCenter(e)),r=this._totalOffset/t;return s.scaleAndAdd(a.getCenter(this._tmpMbs),a.getCenter(e),a.getCenter(e),r),this._tmpMbs[3]=e[3]+e[3]*this._totalOffset/t,this._tmpMbs}applyToObb(e){return l.computeOffsetObb(e,this._totalOffset,this._totalOffset,1,this._tmpObb),this._tmpObb}}class p{constructor(e=0){this.offset=e,this.sphere=a.create(),this.tmpVertex=n.create()}applyToVertex(e,t,r){const i=this.objectTransform.transform,o=s.set(y,e,t,r),n=s.transformMat4(o,o,i),a=this.offset/s.length(n);s.scaleAndAdd(n,n,n,a);const l=this.objectTransform.inverse;return s.transformMat4(this.tmpVertex,n,l),this.tmpVertex}applyToMinMax(e,t){const r=this.offset/s.length(e);s.scaleAndAdd(e,e,e,r);const i=this.offset/s.length(t);s.scaleAndAdd(t,t,t,i)}applyToAabb(e){const t=this.offset/Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]+=e[0]*t,e[1]+=e[1]*t,e[2]+=e[2]*t;const r=this.offset/Math.sqrt(e[3]*e[3]+e[4]*e[4]+e[5]*e[5]);return e[3]+=e[3]*r,e[4]+=e[4]*r,e[5]+=e[5]*r,e}applyToBoundingSphere(e){const t=s.length(a.getCenter(e)),r=this.offset/t;return s.scaleAndAdd(a.getCenter(this.sphere),a.getCenter(e),a.getCenter(e),r),this.sphere[3]=e[3]+e[3]*this.offset/t,this.sphere}}const h=new p,f=new d,m=new u,y=n.create(),g=n.create(),b=n.create(),_=n.create(),v=n.create();e.I3SVerticalOffsetGlobalViewingMode=d,e.IntersectorTransform=class{constructor(){this._transform=o.create(),this._transformInverse=new c({value:this._transform},i.invert,o.create),this._transformInverseTranspose=new c(this._transformInverse,i.transpose,o.create),this._transformTranspose=new c({value:this._transform},i.transpose,o.create),this._transformInverseRotation=new c({value:this._transform},t.normalFromMat4Legacy,r.create)}_invalidateLazyTransforms(){this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate()}get transform(){return this._transform}get inverse(){return this._transformInverse.value}get inverseTranspose(){return this._transformInverseTranspose.value}get inverseRotation(){return this._transformInverseRotation.value}get transpose(){return this._transformTranspose.value}setTransformMatrix(e){i.copy(this._transform,e)}multiplyTransform(e){i.multiply(this._transform,this._transform,e)}set(e){i.copy(this._transform,e),this._invalidateLazyTransforms()}setAndInvalidateLazyTransforms(e,t){this.setTransformMatrix(e),this.multiplyTransform(t),this._invalidateLazyTransforms()}},e.Object3DVerticalOffsetGlobalViewingMode=p,e.TerrainVerticalOffsetGlobalViewingMode=u,e.getVerticalOffsetI3S=function(e){return null!=e?(f.offset=e,f):null},e.getVerticalOffsetObject3D=function(e){return null!=e?(h.offset=e,h):null},e.getVerticalOffsetTerrain=function(e){return null!=e?(m.offset=e,m):null},e.terrainId="terrain",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/orientedBoundingBox":function(){define(["exports","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/factories/mat4f64","../../../core/libs/gl-matrix-2/math/quat","../../../core/libs/gl-matrix-2/factories/quatf64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../chunks/vec42","../../../core/libs/gl-matrix-2/factories/vec4f64","../../../geometry/ellipsoidUtils","../../../geometry/spatialReferenceEllipsoidUtils","../../../geometry/projection/computeTranslationToOriginAndRotation","../../../geometry/projection/projectBuffer","../../../geometry/projection/projectors","../../../geometry/support/plane","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/vectorStacks","./dito","../webgl-engine/lib/Attribute"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_){"use strict";class v{constructor(e=a.ZEROS,t=q,r=s.IDENTITY){this._data=[e[0],e[1],e[2],t[0],t[1],t[2],r[0],r[1],r[2],r[3]]}clone(){const e=new v;return e._data=this._data.slice(),e}invalidate(){this._data[3]=-1}get isValid(){return this._data[3]>=0}static fromData(e){const t=new v;return t._data=e.slice(),t}static fromJSON(e){return new v(e.center,e.halfSize,e.quaternion)}copy(e){this._data=e.data.slice()}get center(){return n.set(g.sv3d.get(),this._data[0],this._data[1],this._data[2])}get centerX(){return this._data[0]}get centerY(){return this._data[1]}get centerZ(){return this._data[2]}getCenter(e){return e[0]=this._data[0],e[1]=this._data[1],e[2]=this._data[2],e}set center(e){this._data[0]=e[0],this._data[1]=e[1],this._data[2]=e[2]}setCenter(e,t,r){this._data[0]=e,this._data[1]=t,this._data[2]=r}get halfSize(){return n.set(g.sv3d.get(),this._data[3],this._data[4],this._data[5])}get halfSizeX(){return this._data[3]}get halfSizeY(){return this._data[4]}get halfSizeZ(){return this._data[5]}getHalfSize(e){return e[0]=this._data[3],e[1]=this._data[4],e[2]=this._data[5],e}set halfSize(e){this._data[3]=e[0],this._data[4]=e[1],this._data[5]=e[2]}get quaternion(){return o.set(g.sq4d.get(),this._data[6],this._data[7],this._data[8],this._data[9])}getQuaternion(e){return e[0]=this._data[6],e[1]=this._data[7],e[2]=this._data[8],e[3]=this._data[9],e}set quaternion(e){this._data[6]=e[0],this._data[7]=e[1],this._data[8]=e[2],this._data[9]=e[3]}get data(){return this._data}getCorners(e){const t=S,r=this._data;t[0]=r[6],t[1]=r[7],t[2]=r[8],t[3]=r[9];for(let i=0;i<8;++i){const o=e[i];o[0]=(1&i?-1:1)*r[3],o[1]=(2&i?-1:1)*r[4],o[2]=(4&i?-1:1)*r[5],n.transformQuat(o,o,t),o[0]+=r[0],o[1]+=r[1],o[2]+=r[2]}}doesIntersectFrustumConservativeApproximation(e){return this.intersectPlane(e[0])<=0&&this.intersectPlane(e[1])<=0&&this.intersectPlane(e[2])<=0&&this.intersectPlane(e[3])<=0&&this.intersectPlane(e[4])<=0&&this.intersectPlane(e[5])<=0}get radius(){const e=this._data[3],t=this._data[4],r=this._data[5];return Math.sqrt(e*e+t*t+r*r)}intersectSphere(e){M[0]=this._data[0]-e[0],M[1]=this._data[1]-e[1],M[2]=this._data[2]-e[2];const t=this.getQuaternion(x);return o.conjugate(S,t),n.transformQuat(M,M,S),n.abs(M,M),T[0]=Math.min(M[0],this._data[3]),T[1]=Math.min(M[1],this._data[4]),T[2]=Math.min(M[2],this._data[5]),n.sqrDist(T,M)<e[3]*e[3]}intersectSphereWithMBS(e,t=this.radius){const r=this._data;M[0]=r[0]-e[0],M[1]=r[1]-e[1],M[2]=r[2]-e[2];const i=e[3],o=i+t;return!(n.sqrLen(M)>o*o)&&(S[0]=-r[6],S[1]=-r[7],S[2]=-r[8],S[3]=r[9],n.transformQuat(M,M,S),n.abs(M,M),T[0]=Math.min(M[0],r[3]),T[1]=Math.min(M[1],r[4]),T[2]=Math.min(M[2],r[5]),n.sqrDist(T,M)<i*i)}intersectPlane(e){const t=e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3],r=this.projectedRadius(m.getNormal(e));return t>r?1:t<-r?-1:0}intersectRay(e,t,r=0){const i=this._data,o=S;o[0]=-i[6],o[1]=-i[7],o[2]=-i[8],o[3]=i[9],M[0]=e[0]-i[0],M[1]=e[1]-i[1],M[2]=e[2]-i[2];const s=n.transformQuat(M,M,S),a=n.transformQuat(T,t,S);let l=-1/0,c=1/0;const u=this.getHalfSize(L);for(let e=0;e<3;e++){const t=s[e],i=a[e],o=u[e]+r;if(Math.abs(i)>1e-6){const e=(o-t)/i,r=(-o-t)/i;l=Math.max(l,Math.min(e,r)),c=Math.min(c,Math.max(e,r))}else if(t>o||t<-o)return!1}return l<=c}projectedArea(e,r,i,s){const a=this.getQuaternion(x);o.conjugate(S,a),M[0]=e[0]-this._data[0],M[1]=e[1]-this._data[1],M[2]=e[2]-this._data[2],n.transformQuat(M,M,S);const c=this.getHalfSize(L),u=M[0]<-c[0]?-1:M[0]>c[0]?1:0,d=M[1]<-c[1]?-1:M[1]>c[1]?1:0,p=M[2]<-c[2]?-1:M[2]>c[2]?1:0,h=Math.abs(u)+Math.abs(d)+Math.abs(p);if(0===h)return 1/0;const f=1===h?4:6,m=6*(u+3*d+9*p+13);t.fromQuat(z,a),t.scale(z,z,c);const y=this.getCenter(E);for(let e=0;e<f;e++){const t=O[m+e];n.set(M,((1&t)<<1)-1,(2&t)-1,((4&t)>>1)-1),n.transformMat3(M,M,z),n.add(P,y,M),P[3]=1,l.transformMat4(P,P,r);const i=1/Math.max(1e-6,P[3]);C[2*e]=P[0]*i,C[2*e+1]=P[1]*i}const g=2*f-2;let b=C[0]*(C[3]-C[g+1])+C[g]*(C[1]-C[g-1]);for(let e=2;e<g;e+=2)b+=C[e]*(C[e+3]-C[e-1]);return Math.abs(b)*i*s*.125}projectedRadius(e){const t=this.getQuaternion(x);return o.conjugate(S,t),n.transformQuat(M,e,S),Math.abs(M[0]*this._data[3])+Math.abs(M[1]*this._data[4])+Math.abs(M[2]*this._data[5])}minimumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]-this.projectedRadius(m.getNormal(e))}maximumDistancePlane(e){return e[0]*this._data[0]+e[1]*this._data[1]+e[2]*this._data[2]+e[3]+this.projectedRadius(m.getNormal(e))}toAaBoundingBox(e){const r=this.getQuaternion(x),i=t.fromQuat(z,r),o=this._data[3]*Math.abs(i[0])+this._data[4]*Math.abs(i[3])+this._data[5]*Math.abs(i[6]),s=this._data[3]*Math.abs(i[1])+this._data[4]*Math.abs(i[4])+this._data[5]*Math.abs(i[7]),n=this._data[3]*Math.abs(i[2])+this._data[4]*Math.abs(i[5])+this._data[5]*Math.abs(i[8]);e[0]=this._data[0]-o,e[1]=this._data[1]-s,e[2]=this._data[2]-n,e[3]=this._data[0]+o,e[4]=this._data[1]+s,e[5]=this._data[2]+n}transform(e,t,r,i=0,s=d.getSphericalPCPF(r),a=d.getSphericalPCPF(t),l=f.getProjector(t,a)){if(r===s)t.isGeographic?function(e,t,r,i,s=d.getSphericalPCPF(r)){const a=u.getReferenceEllipsoid(r),l=1+Math.max(0,i)/(a.radius+e.centerZ);e.getCenter(D),D[2]+=i,h.projectBuffer(D,r,0,D,s,0),t.center=D;const c=e.getQuaternion(x);t.quaternion=c,o.conjugate(S,c),n.set(B,0,0,1),n.transformQuat(B,B,S);const p=e.getHalfSize(L);n.set(B,p[0]*Math.abs(B[0]),p[1]*Math.abs(B[1]),p[2]*Math.abs(B[2])),n.scale(B,B,a.inverseFlattening),n.add(B,p,B),t.halfSize=n.scale(B,B,l)}(this,e,t,i,a):function(e,t,r,i,s=d.getSphericalPCPF(r),a=f.getProjector(r,s)){e.getCorners(j),e.getCenter(D),D[2]+=i,p.computeTranslationToOriginAndRotation(r,D,U,s),t.setCenter(U[12],U[13],U[14]);const l=2*Math.sqrt(1+U[0]+U[5]+U[10]);S[0]=(U[6]-U[9])/l,S[1]=(U[8]-U[2])/l,S[2]=(U[1]-U[4])/l,S[3]=.25*l;const c=e.getQuaternion(x);t.quaternion=o.multiply(S,S,c),o.conjugate(S,S),n.set(N,0,0,0);const u=t.getCenter(V);for(const e of j)e[2]+=i,a(e,0,e,0),n.sub(B,e,u),n.transformQuat(B,B,S),n.abs(B,B),n.max(N,N,B);t.halfSize=N}(this,e,t,i,a,l);else if(t.isWGS84&&(r.isWebMercator||y.isPlateCarree(r)))!function(e,t,r,i,o){t.getCenter(E),E[2]+=o;const s=d.getSphericalPCPF(r);h.projectBuffer(E,e,0,E,s,0),F(s,t,E,r,i)}(t,this,r,e,i);else if(t.isWebMercator&&y.isPlateCarree(r))!function(e,t,r,i,o){t.getCenter(E),E[2]+=o,F(e,t,E,r,i)}(t,this,r,e,i);else{const o=this.getCenter(E);o[2]+=i,h.projectBuffer(o,t,0,o,r,0),e.center=o,this!==e&&(e.quaternion=this.getQuaternion(x),e.halfSize=this.getHalfSize(L))}}}const S=s.create(),x=s.create(),w=s.create(),M=a.create(),T=a.create(),P=c.create();function I(e,t=new v){return b.computeOBB(e,t),t}const C=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],O=(()=>{const e=new Int8Array(162);let t=0;const r=r=>{for(let i=0;i<r.length;i++)e[t+i]=r[i];t+=6};return r([6,2,3,1,5,4]),r([0,2,3,1,5,4]),r([0,2,3,7,5,4]),r([0,1,3,2,6,4]),r([0,1,3,2,0,0]),r([0,1,5,7,3,2]),r([0,1,3,7,6,4]),r([0,1,3,7,6,2]),r([0,1,5,7,6,2]),r([0,1,5,4,6,2]),r([0,1,5,4,0,0]),r([0,1,3,7,5,4]),r([0,2,6,4,0,0]),r([0,0,0,0,0,0]),r([1,3,7,5,0,0]),r([2,3,7,6,4,0]),r([2,3,7,6,0,0]),r([2,3,1,5,7,6]),r([0,1,5,7,6,2]),r([0,1,5,7,6,4]),r([0,1,3,7,6,4]),r([4,5,7,6,2,0]),r([4,5,7,6,0,0]),r([4,5,1,3,7,6]),r([0,2,3,7,5,4]),r([6,2,3,7,5,4]),r([6,2,3,1,5,4]),e})();function F(e,r,i,o,s){const n=r.getQuaternion(x),a=t.fromQuat(z,n),l=r.getHalfSize(L);for(let e=0;e<8;++e){for(let t=0;t<3;++t)D[t]=l[t]*(e&1<<t?-1:1);for(let t=0;t<3;++t){let r=i[t];for(let e=0;e<3;++e)r+=D[e]*a[3*e+t];A[3*e+t]=r}}h.projectBuffer(A,e,0,A,o,0,8),I(R,s)}const A=new Array(24),R=new _.Vertices(A,3),D=a.create(),E=a.create(),V=a.create(),L=a.create(),z=r.create(),U=i.create(),j=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],B=a.create(),N=a.create(),k=a.create(),q=a.freeze(-1,-1,-1);e.Obb=v,e.compute=I,e.computeOffsetObb=function(e,t,r,i,s){const l=e.getQuaternion(x);s.quaternion=l,o.conjugate(S,l);const c=e.getCenter(E),u=e.getHalfSize(L);if(1===i){n.transformQuat(B,c,S),n.abs(N,B),n.min(k,N,u),n.sub(k,N,k);const i=n.length(k);n.add(k,N,u);const o=n.length(k);if(i<r)s.center=c,n.set(B,r,r,r),s.halfSize=n.add(B,u,B);else{const a=o>0?1+t/o:1,l=i>0?1+r/i:1,c=(l+a)/2,d=(l-a)/2;n.scale(k,N,d),s.halfSize=n.scaleAndAdd(k,k,u,c),n.scale(k,N,c),n.scaleAndAdd(k,k,u,d),n.sign(B,B),n.multiply(B,k,B);const p=e.getQuaternion(w);s.center=n.transformQuat(B,B,p)}}else{s.center=n.scaleAndAdd(B,c,a.UNIT_Z,(r+t)/2);const e=n.transformQuat(B,a.UNIT_Z,S);n.abs(e,e),s.halfSize=n.scaleAndAdd(N,u,e,(r-t)/2)}return s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/quat":function(){define(["exports","../factories/mat3f64","../factories/quatf64","../factories/vec3f64","./common","../../../../chunks/vec32","../../../../chunks/vec42"],function(e,t,r,i,o,s,n){"use strict";function a(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function l(e,t,r){r*=.5;const i=Math.sin(r);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function c(e,t){const r=2*Math.acos(t[3]),i=Math.sin(r/2);return i>o.getEpsilon()?(e[0]=t[0]/i,e[1]=t[1]/i,e[2]=t[2]/i):(e[0]=1,e[1]=0,e[2]=0),r}function u(e,t,r){const i=t[0],o=t[1],s=t[2],n=t[3],a=r[0],l=r[1],c=r[2],u=r[3];return e[0]=i*u+n*a+o*c-s*l,e[1]=o*u+n*l+s*a-i*c,e[2]=s*u+n*c+i*l-o*a,e[3]=n*u-i*a-o*l-s*c,e}function d(e,t,r){r*=.5;const i=t[0],o=t[1],s=t[2],n=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+n*a,e[1]=o*l+s*a,e[2]=s*l-o*a,e[3]=n*l-i*a,e}function p(e,t,r){r*=.5;const i=t[0],o=t[1],s=t[2],n=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l-s*a,e[1]=o*l+n*a,e[2]=s*l+i*a,e[3]=n*l-o*a,e}function h(e,t,r){r*=.5;const i=t[0],o=t[1],s=t[2],n=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=i*l+o*a,e[1]=o*l-i*a,e[2]=s*l+n*a,e[3]=n*l-s*a,e}function f(e,t){const r=t[0],i=t[1],o=t[2];return e[0]=r,e[1]=i,e[2]=o,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-o*o)),e}function m(e,t,r,i){const s=t[0],n=t[1],a=t[2],l=t[3];let c,u,d,p,h,f=r[0],m=r[1],y=r[2],g=r[3];return u=s*f+n*m+a*y+l*g,u<0&&(u=-u,f=-f,m=-m,y=-y,g=-g),1-u>o.getEpsilon()?(c=Math.acos(u),d=Math.sin(c),p=Math.sin((1-i)*c)/d,h=Math.sin(i*c)/d):(p=1-i,h=i),e[0]=p*s+h*f,e[1]=p*n+h*m,e[2]=p*a+h*y,e[3]=p*l+h*g,e}function y(e){const t=o.RANDOM,r=t(),i=t(),s=t(),n=Math.sqrt(1-r),a=Math.sqrt(r);return e[0]=n*Math.sin(2*Math.PI*i),e[1]=n*Math.cos(2*Math.PI*i),e[2]=a*Math.sin(2*Math.PI*s),e[3]=a*Math.cos(2*Math.PI*s),e}function g(e,t){const r=t[0],i=t[1],o=t[2],s=t[3],n=r*r+i*i+o*o+s*s,a=n?1/n:0;return e[0]=-r*a,e[1]=-i*a,e[2]=-o*a,e[3]=s*a,e}function b(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function _(e,t){const r=t[0]+t[4]+t[8];let i;if(r>0)i=Math.sqrt(r+1),e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*s+s]+1),e[r]=.5*i,i=.5/i,e[3]=(t[3*o+s]-t[3*s+o])*i,e[o]=(t[3*o+r]+t[3*r+o])*i,e[s]=(t[3*s+r]+t[3*r+s])*i}return e}function v(e,t,r,i){const o=.5*Math.PI/180;t*=o,r*=o,i*=o;const s=Math.sin(t),n=Math.cos(t),a=Math.sin(r),l=Math.cos(r),c=Math.sin(i),u=Math.cos(i);return e[0]=s*l*u-n*a*c,e[1]=n*a*u+s*l*c,e[2]=n*l*c-s*a*u,e[3]=n*l*u+s*a*c,e}function S(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}const x=n.copy,w=n.set,M=n.add,T=u,P=n.scale,I=n.dot,C=n.lerp,O=n.length,F=O,A=n.squaredLength,R=A,D=n.normalize,E=n.exactEquals,V=n.equals;function L(e,t,r){const i=s.dot(t,r);return i<-.999999?(s.cross(z,U,t),s.len(z)<1e-6&&s.cross(z,j,t),s.normalize(z,z),l(e,z,Math.PI),e):i>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(s.cross(z,t,r),e[0]=z[0],e[1]=z[1],e[2]=z[2],e[3]=1+i,D(e,e))}const z=i.create(),U=i.fromValues(1,0,0),j=i.fromValues(0,1,0);function B(e,t,r,i,o,s){return m(N,t,o,s),m(k,r,i,s),m(e,N,k,2*s*(1-s)),e}const N=r.create(),k=r.create();function q(e,t,r,i){const o=G;return o[0]=r[0],o[3]=r[1],o[6]=r[2],o[1]=i[0],o[4]=i[1],o[7]=i[2],o[2]=-t[0],o[5]=-t[1],o[8]=-t[2],D(e,_(e,o))}const G=t.create(),H=Object.freeze(Object.defineProperty({__proto__:null,add:M,calculateW:f,conjugate:b,copy:x,dot:I,equals:V,exactEquals:E,fromEuler:v,fromMat3:_,getAxisAngle:c,identity:a,invert:g,len:F,length:O,lerp:C,mul:T,multiply:u,normalize:D,random:y,rotateX:d,rotateY:p,rotateZ:h,rotationTo:L,scale:P,set:w,setAxes:q,setAxisAngle:l,slerp:m,sqlerp:B,sqrLen:R,squaredLength:A,str:S},Symbol.toStringTag,{value:"Module"}));e.add=M,e.calculateW=f,e.conjugate=b,e.copy=x,e.dot=I,e.equals=V,e.exactEquals=E,e.fromEuler=v,e.fromMat3=_,e.getAxisAngle=c,e.identity=a,e.invert=g,e.len=F,e.length=O,e.lerp=C,e.mul=T,e.multiply=u,e.normalize=D,e.quat=H,e.random=y,e.rotateX=d,e.rotateY=p,e.rotateZ=h,e.rotationTo=L,e.scale=P,e.set=w,e.setAxes=q,e.setAxisAngle=l,e.slerp=m,e.sqlerp=B,e.sqrLen=R,e.squaredLength=A,e.str=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],function(e,t,r,i){"use strict";const o=new r(t.SphericalECEFSpatialReferenceLike),s=new r(t.SphericalPCPFMarsLike),n=new r(t.SphericalPCPFMoonLike),a=new r(t.WGS84ECEFSpatialReferenceLike),l=new Map,c=s.wkt.toUpperCase(),u=n.wkt.toUpperCase();e.SphericalECEFSpatialReference=o,e.SphericalPCPFMars=s,e.SphericalPCPFMoon=n,e.WGS84ECEFSpatialReference=a,e.cleanupSpatialReferenceEllipsoidUtils=function(){l.clear()},e.getSphericalPCPF=function(e){const t=l.get(e);if(t)return t;let r=o;if(e)if(e===s)r=s;else if(e===n)r=n;else{const t=e.wkid,o=e.latestWkid;if(null!=t||null!=o)i.isWKIDFromMars(t)||i.isWKIDFromMars(o)?r=s:(i.isWKIDFromMoon(t)||i.isWKIDFromMoon(o))&&(r=n);else{const t=e.wkt2??e.wkt;if(t){const e=t.toUpperCase();e===c?r=s:e===u&&(r=n)}}}return l.set(e,r),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/dito":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/factories/quatf64","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../webgl-engine/lib/Attribute"],function(e,t,r,i,o,s,n){"use strict";const a=1e-6,l=s.create(),c=s.create(),u=s.create(),d=s.create(),p=s.create(),h=s.create(),f=s.create(),m=s.create(),y=s.create(),g=s.create(),b=[0,0,0],_=i.create(),v=s.create(),S=s.create(),x=s.create(),w=s.create(),M=s.create(),T=s.create();function P(e,t,r,i,o,s){if(K(t)<a)return;Q(v,r,t),Q(S,i,t),Q(x,o,t),C(e,t,_),M[1]=_[0],w[1]=_[1],T[1]=w[1]-M[1];const n=[r,i,o],l=[v,S,x];for(let r=0;r<3;++r){C(e,n[r],_),M[0]=_[0],w[0]=_[1],C(e,l[r],_),M[2]=_[0],w[2]=_[1],T[0]=w[0]-M[0],T[2]=w[2]-M[2];const i=W(T);i<s.quality&&(Z(s.b0,n[r]),Z(s.b1,t),Z(s.b2,l[r]),s.quality=i)}}const I=s.create();function C(e,t,r){const{data:i,size:o}=e;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(let e=0;e<i.length;e+=o){const o=i[e]*t[0]+i[e+1]*t[1]+i[e+2]*t[2];r[0]=Math.min(r[0],o),r[1]=Math.max(r[1],o)}}function O(e,t,i){i.center=e,i.halfSize=o.scale(t,t,.5),i.quaternion=r.IDENTITY}const F=s.create(),A=s.create(),R=s.create(),D=s.create(),E=s.create(),V=s.create();function L(e,t,r){Z(F,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?F[0]=0:Math.abs(t[1])>Math.abs(t[2])?F[1]=0:F[2]=0,K(F)<a&&(F[0]=F[1]=F[2]=1),Q(A,t,F),X(A,A),Q(R,t,A),X(R,R),z(e,t,A,R,D,E),J(V,E,D),q(t,A,R,D,E,V,r)}function z(e,t,r,i,o,s){C(e,t,_),o[0]=_[0],s[0]=_[1],C(e,r,_),o[1]=_[0],s[1]=_[1],C(e,i,_),o[2]=_[0],s[2]=_[1]}const U=s.create(),j=s.create(),B=s.create(),N=t.fromValues(1,0,0,0,1,0,0,0,1),k=r.create();function q(e,t,r,i,s,n,a){N[0]=e[0],N[1]=e[1],N[2]=e[2],N[3]=t[0],N[4]=t[1],N[5]=t[2],N[6]=r[0],N[7]=r[1],N[8]=r[2],a.quaternion=function(e,t){const r=t[0]+t[4]+t[8];if(r>0){let i=Math.sqrt(r+1);e[3]=.5*i,i=.5/i,e[0]=(t[5]-t[7])*i,e[1]=(t[6]-t[2])*i,e[2]=(t[1]-t[3])*i}else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);const i=(r+1)%3,o=(r+2)%3;let s=Math.sqrt(t[3*r+r]-t[3*i+i]-t[3*o+o]+1);e[r]=.5*s,s=.5/s,e[3]=(t[3*i+o]-t[3*o+i])*s,e[i]=(t[3*i+r]+t[3*r+i])*s,e[o]=(t[3*o+r]+t[3*r+o])*s}return e}(k,N),$(U,i,s),Y(U,U,.5),Y(j,e,U[0]),Y(B,t,U[1]),$(j,j,B),Y(B,r,U[2]),a.center=o.add(j,j,B),a.halfSize=o.scale(U,n,.5)}class G{constructor(e){this.minVert=new Array(7),this.maxVert=new Array(7),this.buffer=new ArrayBuffer(448);let t=0;this.minProj=new Float64Array(this.buffer,t,7),t+=56,this.maxProj=new Float64Array(this.buffer,t,7),t+=56;for(let e=0;e<7;++e)this.minVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.maxVert[e]=new Float64Array(this.buffer,t,3),t+=24;for(let e=0;e<7;++e)this.minProj[e]=Number.POSITIVE_INFINITY,this.maxProj[e]=Number.NEGATIVE_INFINITY;const r=new Array(7),i=new Array(7),{data:o,size:s}=e;for(let e=0;e<o.length;e+=s){let t=o[e];t<this.minProj[0]&&(this.minProj[0]=t,r[0]=e),t>this.maxProj[0]&&(this.maxProj[0]=t,i[0]=e),t=o[e+1],t<this.minProj[1]&&(this.minProj[1]=t,r[1]=e),t>this.maxProj[1]&&(this.maxProj[1]=t,i[1]=e),t=o[e+2],t<this.minProj[2]&&(this.minProj[2]=t,r[2]=e),t>this.maxProj[2]&&(this.maxProj[2]=t,i[2]=e),t=o[e]+o[e+1]+o[e+2],t<this.minProj[3]&&(this.minProj[3]=t,r[3]=e),t>this.maxProj[3]&&(this.maxProj[3]=t,i[3]=e),t=o[e]+o[e+1]-o[e+2],t<this.minProj[4]&&(this.minProj[4]=t,r[4]=e),t>this.maxProj[4]&&(this.maxProj[4]=t,i[4]=e),t=o[e]-o[e+1]+o[e+2],t<this.minProj[5]&&(this.minProj[5]=t,r[5]=e),t>this.maxProj[5]&&(this.maxProj[5]=t,i[5]=e),t=o[e]-o[e+1]-o[e+2],t<this.minProj[6]&&(this.minProj[6]=t,r[6]=e),t>this.maxProj[6]&&(this.maxProj[6]=t,i[6]=e)}for(let e=0;e<7;++e){let t=r[e];Z(this.minVert[e],o,t),t=i[e],Z(this.maxVert[e],o,t)}}}class H{constructor(){this.b0=s.fromValues(1,0,0),this.b1=s.fromValues(0,1,0),this.b2=s.fromValues(0,0,1),this.quality=0}}function W(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}function $(e,t,r){e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2]}function J(e,t,r){e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2]}function Y(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r}function Z(e,t,r=0){e[0]=t[r],e[1]=t[r+1],e[2]=t[r+2]}function Q(e,t,r){const i=t[0],o=t[1],s=t[2],n=r[0],a=r[1],l=r[2];e[0]=o*l-s*a,e[1]=s*n-i*l,e[2]=i*a-o*n}function X(e,t){const r=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(r>0){const i=1/Math.sqrt(r);e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i}}function K(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]}function ee(e,t){const r=t[0]-e[0],i=t[1]-e[1],o=t[2]-e[2];return r*r+i*i+o*o}function te(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}e.computeOBB=function(e,t){const{data:r,size:i}=e,o=r.length/i;if(o<=0)return;const v=new G(e);$(l,v.minProj,v.maxProj),Y(l,l,.5),J(c,v.maxProj,v.minProj);const S=W(c),x=new H;x.quality=S,o<14&&(e=new n.Vertices(new Float64Array(v.buffer,112,42),3));const w=s.create(),M=s.create(),T=s.create(),C=s.create(),F=s.create(),A=s.create(),R=s.create();switch(function(e,t,r,i,o,s,n,l,c,u){if(function(e,t,r){let i=ee(e.maxVert[0],e.minVert[0]),o=0;for(let t=1;t<7;++t){const r=ee(e.maxVert[t],e.minVert[t]);r>i&&(i=r,o=t)}Z(t,e.minVert[o]),Z(r,e.maxVert[o])}(e,i,o),ee(i,o)<a)return 1;J(n,i,o),X(n,n);const d=function(e,t,r,i){const{data:o,size:s}=e;let n=Number.NEGATIVE_INFINITY,a=0;for(let e=0;e<o.length;e+=s){b[0]=o[e]-t[0],b[1]=o[e+1]-t[1],b[2]=o[e+2]-t[2];const i=r[0]*b[0]+r[1]*b[1]+r[2]*b[2],s=r[0]*r[0]+r[1]*r[1]+r[2]*r[2],l=b[0]*b[0]+b[1]*b[1]+b[2]*b[2]-i*i/s;l>n&&(n=l,a=e)}return Z(i,o,a),n}(t,i,n,s);return d<a?2:(J(l,o,s),X(l,l),J(c,s,i),X(c,c),Q(r,l,n),X(r,r),P(t,r,n,l,c,u),0)}(v,e,R,w,M,T,C,F,A,x)){case 1:return void O(l,c,t);case 2:return void L(e,C,t)}!function(e,t,r,i,o,s,n,l,c){(function(e,t,r,i,o){!function(e,t,r,i,o){const{data:s,size:n}=e;Z(i,s),Z(o,i),r[0]=te(I,t),r[1]=r[0];for(let e=n;e<s.length;e+=n){const n=s[e]*t[0]+s[e+1]*t[1]+s[e+2]*t[2];n<r[0]&&(r[0]=n,Z(i,s,e)),n>r[1]&&(r[1]=n,Z(o,s,e))}}(e,t,_,o,i);const s=te(r,t);_[1]-a<=s&&(i[0]=void 0),_[0]+a>=s&&(o[0]=void 0)})(e,t,r,u,d),void 0!==u[0]&&(J(p,u,r),X(p,p),J(h,u,i),X(h,h),J(f,u,o),X(f,f),Q(m,h,s),X(m,m),Q(y,f,n),X(y,y),Q(g,p,l),X(g,g),P(e,m,s,h,p,c),P(e,y,n,f,h,c),P(e,g,l,p,f,c)),void 0!==d[0]&&(J(p,d,r),X(p,p),J(h,d,i),X(h,h),J(f,d,o),X(f,f),Q(m,h,s),X(m,m),Q(y,f,n),X(y,y),Q(g,p,l),X(g,g),P(e,m,s,h,p,c),P(e,y,n,f,h,c),P(e,g,l,p,f,c))}(e,R,w,M,T,C,F,A,x),z(e,x.b0,x.b1,x.b2,D,E);const V=s.create();J(V,E,D),x.quality=W(V),x.quality<S?q(x.b0,x.b1,x.b2,D,E,V,t):O(l,c,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/buffer/BufferView","../lib/RayIntersections","./internal/bufferWriterUtils"],function(e,t,r,i,o,s){"use strict";const n=r.create();e.DefaultBufferWriter=class{constructor(e){this.layout=e}elementCount(e){return e.get("position").indices.length}write(e,t,r,i,o,n){return s.writeAttributes(r,i,this.layout,e,t,o,n)}intersect(e,r,s,a,l,c,u){const d=this.layout.createView(e).getField("position",i.BufferViewVec3f);if(null==d)return;const p=t.sub(n,c,l),h=d.count/3,f=a.options.normalRequired;o.intersectRenderGeometryTriangles(l,p,0,h,d.typedBuffer,d.typedBufferStride,f,(e,t,r)=>u(e,r,t))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferView":function(){define(["exports","../float16","./internals/Mat3","./internals/Mat4","./internals/Scalar","./internals/Vec2","./internals/Vec3","./internals/Vec4","../../../views/3d/webgl-engine/lib/Util"],function(e,t,r,i,o,s,n,a,l){"use strict";class c extends o.BufferViewScalarImpl{constructor(e,r=0,i,o){l.assert(t.hasNativeFloat16Array),super(t.getFloat16ArrayConstructor(),e,r,i,o),this.elementType="f16"}static{this.ElementType="f16"}}class u extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}static{this.ElementType="f32"}}class d extends s.BufferViewVec2Impl{constructor(e,r=0,i,o){l.assert(t.hasNativeFloat16Array),super(t.getFloat16ArrayConstructor(),e,r,i,o),this.elementType="f16"}slice(e,t){return this.sliceBuffer(d,e,t)}static{this.ElementType="f16"}}class p extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(p,e,t)}static{this.ElementType="f32"}}class h extends n.BufferViewVec3Impl{constructor(e,r=0,i,o){l.assert(t.hasNativeFloat16Array),super(t.getFloat16ArrayConstructor(),e,r,i,o),this.elementType="f16"}slice(e,t){return this.sliceBuffer(h,e,t)}static{this.ElementType="f16"}}class f extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(f,e,t)}static fromTypedArray(e,t){return new f(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}static{this.ElementType="f32"}}class m extends a.BufferViewVec4Impl{constructor(e,r=0,i,o){l.assert(t.hasNativeFloat16Array),super(t.getFloat16ArrayConstructor(),e,r,i,o),this.elementType="f16"}slice(e,t){return this.sliceBuffer(m,e,t)}static{this.ElementType="f16"}}class y extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(y,e,t)}static{this.ElementType="f32"}}class g extends r.BufferViewMat3Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(g,e,t)}static{this.ElementType="f32"}}class b extends r.BufferViewMat3Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(b,e,t)}static{this.ElementType="f64"}}class _ extends i.BufferViewMat4Impl{constructor(e,t=0,r,i){super(Float32Array,e,t,r,i),this.elementType="f32"}slice(e,t){return this.sliceBuffer(_,e,t)}static{this.ElementType="f32"}}class v extends i.BufferViewMat4Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(v,e,t)}static{this.ElementType="f64"}}class S extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(S,e,t)}static{this.ElementType="f64"}}class x extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(x,e,t)}static{this.ElementType="f64"}}class w extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(w,e,t)}static fromTypedArray(e,t){return new w(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}static{this.ElementType="f64"}}class M extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Float64Array,e,t,r,i),this.elementType="f64"}slice(e,t){return this.sliceBuffer(M,e,t)}static{this.ElementType="f64"}}class T extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(T,e,t)}static{this.ElementType="u8"}}class P extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(P,e,t)}static{this.ElementType="u8"}}class I extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(I,e,t)}static fromTypedArray(e,t){return new I(e.buffer,e.byteOffset,t,e.byteOffset+e.byteLength)}static{this.ElementType="u8"}}class C extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Uint8Array,e,t,r,i),this.elementType="u8"}slice(e,t){return this.sliceBuffer(C,e,t)}static{this.ElementType="u8"}}class O extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(O,e,t)}static{this.ElementType="u16"}}class F extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(F,e,t)}static{this.ElementType="u16"}}class A extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(A,e,t)}static{this.ElementType="u16"}}class R extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Uint16Array,e,t,r,i),this.elementType="u16"}slice(e,t){return this.sliceBuffer(R,e,t)}static{this.ElementType="u16"}}class D extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(D,e,t)}static{this.ElementType="u32"}}class E extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(E,e,t)}static{this.ElementType="u32"}}class V extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(V,e,t)}static{this.ElementType="u32"}}class L extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Uint32Array,e,t,r,i),this.elementType="u32"}slice(e,t){return this.sliceBuffer(L,e,t)}static{this.ElementType="u32"}}class z extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(z,e,t)}static{this.ElementType="i8"}}class U extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(U,e,t)}static{this.ElementType="i8"}}class j extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(j,e,t)}static{this.ElementType="i8"}}class B extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Int8Array,e,t,r,i),this.elementType="i8"}slice(e,t){return this.sliceBuffer(B,e,t)}static{this.ElementType="i8"}}class N extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(N,e,t)}static{this.ElementType="i16"}}class k extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(k,e,t)}static{this.ElementType="i16"}}class q extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(q,e,t)}static{this.ElementType="i16"}}class G extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Int16Array,e,t,r,i),this.elementType="i16"}slice(e,t){return this.sliceBuffer(G,e,t)}static{this.ElementType="i16"}}class H extends o.BufferViewScalarImpl{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(H,e,t)}static{this.ElementType="i32"}}class W extends s.BufferViewVec2Impl{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(W,e,t)}static{this.ElementType="i32"}}class $ extends n.BufferViewVec3Impl{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer($,e,t)}static{this.ElementType="i32"}}class J extends a.BufferViewVec4Impl{constructor(e,t=0,r,i){super(Int32Array,e,t,r,i),this.elementType="i32"}slice(e,t){return this.sliceBuffer(J,e,t)}static{this.ElementType="i32"}}e.BufferViewFloat=u,e.BufferViewFloat16=c,e.BufferViewFloat64=S,e.BufferViewInt16=N,e.BufferViewInt32=H,e.BufferViewInt8=z,e.BufferViewMat3f=g,e.BufferViewMat3f64=b,e.BufferViewMat4f=_,e.BufferViewMat4f64=v,e.BufferViewUint16=O,e.BufferViewUint32=D,e.BufferViewUint8=T,e.BufferViewVec2f=p,e.BufferViewVec2f16=d,e.BufferViewVec2f64=x,e.BufferViewVec2i16=k,e.BufferViewVec2i32=W,e.BufferViewVec2i8=U,e.BufferViewVec2u16=F,e.BufferViewVec2u32=E,e.BufferViewVec2u8=P,e.BufferViewVec3f=f,e.BufferViewVec3f16=h,e.BufferViewVec3f64=w,e.BufferViewVec3i16=q,e.BufferViewVec3i32=$,e.BufferViewVec3i8=j,e.BufferViewVec3u16=A,e.BufferViewVec3u32=V,e.BufferViewVec3u8=I,e.BufferViewVec4f=y,e.BufferViewVec4f16=m,e.BufferViewVec4f64=M,e.BufferViewVec4i16=G,e.BufferViewVec4i32=J,e.BufferViewVec4i8=B,e.BufferViewVec4u16=R,e.BufferViewVec4u32=L,e.BufferViewVec4u8=C,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports"],function(e){"use strict";class t{static{this.ElementCount=9}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.elementCount=9;const s=this.TypedArrayConstructor;void 0===i&&(i=9*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<9;e++)t[e]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<9;e++)this.typedBuffer[r++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){const i=this.typedBuffer,o=t.typedBuffer;let s=e*this.typedBufferStride,n=r*t.typedBufferStride;for(let e=0;e<9;++e)i[s++]=o[n++]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewMat3Impl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports"],function(e){"use strict";class t{static{this.ElementCount=16}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.elementCount=16;const s=this.TypedArrayConstructor;void 0===i&&(i=16*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<16;e++)t[e]=this.typedBuffer[r++];return t}setMat(e,t){let r=e*this.typedBufferStride;for(let e=0;e<16;e++)this.typedBuffer[r++]=t[e]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}copyFrom(e,t,r){this.copyFromTypedBuffer(e,t.typedBuffer,r*t.typedBufferStride)}copyFromTypedBuffer(e,t,r){const i=this.typedBuffer;let o=e*this.typedBufferStride;for(let e=0;e<16;++e)i[o++]=t[r++]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewMat4Impl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports"],function(e){"use strict";class t{static{this.ElementCount=1}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.elementCount=1;const s=this.TypedArrayConstructor;void 0===i&&(i=s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.stride=i,this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}get(e){return this.typedBuffer[e*this.typedBufferStride]}set(e,t){this.typedBuffer[e*this.typedBufferStride]=t}get buffer(){return this.typedBuffer.buffer}}e.BufferViewScalarImpl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/vec2"],function(e,t){"use strict";class r{static{this.ElementCount=2}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.start=r,this.elementCount=2;const s=this.TypedArrayConstructor;void 0===i&&(i=2*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,r){return e*=this.typedBufferStride,t.set(r,this.typedBuffer[e],this.typedBuffer[e+1])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e]=t[1]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e]=r}copyFrom(e,t,r){const i=this.typedBuffer,o=t.typedBuffer;let s=e*this.typedBufferStride,n=r*t.typedBufferStride;i[s++]=o[n++],i[s]=o[n]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewVec2Impl=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/vec32"],function(e,t){"use strict";class r{static{this.ElementCount=3}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.elementCount=3;const s=this.TypedArrayConstructor;void 0===i&&(i=3*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,r){return e*=this.typedBufferStride,t.set(r,this.typedBuffer[e],this.typedBuffer[e+1],this.typedBuffer[e+2])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e]=t[2]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e]=i}copyFrom(e,t,r){const i=this.typedBuffer,o=t.typedBuffer;let s=e*this.typedBufferStride,n=r*t.typedBufferStride;i[s++]=o[n++],i[s++]=o[n++],i[s]=o[n]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewVec3Impl=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/vec42"],function(e,t){"use strict";class r{static{this.ElementCount=4}constructor(e,t,r=0,i,o){this.TypedArrayConstructor=e,this.start=r,this.elementCount=4;const s=this.TypedArrayConstructor;void 0===i&&(i=4*s.BYTES_PER_ELEMENT);const n=0===t.byteLength?0:r;this.typedBuffer=null==o?new s(t,n):new s(t,n,(o-r)/s.BYTES_PER_ELEMENT),this.typedBufferStride=i/s.BYTES_PER_ELEMENT,this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride),this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}sliceBuffer(e,t,r=this.count-t){const i=this.typedBuffer.byteOffset+t*this.stride;return new e(this.buffer,i,this.stride,i+r*this.stride)}getVec(e,r){return e*=this.typedBufferStride,t.set(r,this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e++],this.typedBuffer[e])}setVec(e,t){e*=this.typedBufferStride,this.typedBuffer[e++]=t[0],this.typedBuffer[e++]=t[1],this.typedBuffer[e++]=t[2],this.typedBuffer[e]=t[3]}get(e,t){return this.typedBuffer[e*this.typedBufferStride+t]}set(e,t,r){this.typedBuffer[e*this.typedBufferStride+t]=r}setValues(e,t,r,i,o){e*=this.typedBufferStride,this.typedBuffer[e++]=t,this.typedBuffer[e++]=r,this.typedBuffer[e++]=i,this.typedBuffer[e]=o}copyFrom(e,t,r){const i=this.typedBuffer,o=t.typedBuffer;let s=e*this.typedBufferStride,n=r*t.typedBufferStride;i[s++]=o[n++],i[s++]=o[n++],i[s++]=o[n++],i[s]=o[n]}get buffer(){return this.typedBuffer.buffer}}e.BufferViewVec4Impl=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util"],function(e,t,r,i,o,s){"use strict";function n(e,t,r){const{data:i,indices:o}=e,s=t.typedBuffer,n=t.typedBufferStride,a=o.length;r*=n;for(let e=0;e<a;++e){const t=2*o[e];s[r]=i[t],s[r+1]=i[t+1],r+=n}}function a(e,t,r,i=1){const{data:o,indices:s}=e,n=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let e=0;e<l;++e){const t=3*s[e];n[r]=o[t],n[r+1]=o[t+1],n[r+2]=o[t+2],r+=a}else for(let e=0;e<l;++e){const t=3*s[e];for(let e=0;e<i;++e)n[r]=o[t],n[r+1]=o[t+1],n[r+2]=o[t+2],r+=a}}function l(e,t,r,i=1){const{data:o,indices:s}=e,n=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let e=0;e<l;++e){const t=4*s[e];n[r]=o[t],n[r+1]=o[t+1],n[r+2]=o[t+2],n[r+3]=o[t+3],r+=a}else for(let e=0;e<l;++e){const t=4*s[e];for(let e=0;e<i;++e)n[r]=o[t],n[r+1]=o[t+1],n[r+2]=o[t+2],n[r+3]=o[t+3],r+=a}}function c(e,t,r,o,s=1){if(!t)return void a(e,r,o,s);const{data:n,indices:l}=e,c=r.typedBuffer,u=r.typedBufferStride,d=l.length,p=t[0],h=t[1],f=t[2],m=t[4],y=t[5],g=t[6],b=t[8],_=t[9],v=t[10],S=t[12],x=t[13],w=t[14];o*=u;let M=0,T=0,P=0;const I=i.hasIdentityRotation(t)?e=>{M=n[e]+S,T=n[e+1]+x,P=n[e+2]+w}:e=>{const t=n[e],r=n[e+1],i=n[e+2];M=p*t+m*r+b*i+S,T=h*t+y*r+_*i+x,P=f*t+g*r+v*i+w};if(1===s)for(let e=0;e<d;++e)I(3*l[e]),c[o]=M,c[o+1]=T,c[o+2]=P,o+=u;else for(let e=0;e<d;++e){I(3*l[e]);for(let e=0;e<s;++e)c[o]=M,c[o+1]=T,c[o+2]=P,o+=u}}function u(e,t,r,o,s=1){if(!t)return void a(e,r,o,s);const{data:n,indices:l}=e,c=t,u=r.typedBuffer,d=r.typedBufferStride,p=l.length,h=c[0],f=c[1],m=c[2],y=c[4],g=c[5],b=c[6],_=c[8],v=c[9],S=c[10],x=!i.isOrthoNormal(c),w=1e-6,M=.999999;o*=d;let T=0,P=0,I=0;const C=i.hasIdentityRotation(c)?e=>{T=n[e],P=n[e+1],I=n[e+2]}:e=>{const t=n[e],r=n[e+1],i=n[e+2];T=h*t+y*r+_*i,P=f*t+g*r+v*i,I=m*t+b*r+S*i};if(1===s)if(x)for(let e=0;e<p;++e){C(3*l[e]);const t=T*T+P*P+I*I;if(t<M&&t>w){const e=1/Math.sqrt(t);u[o]=T*e,u[o+1]=P*e,u[o+2]=I*e}else u[o]=T,u[o+1]=P,u[o+2]=I;o+=d}else for(let e=0;e<p;++e)C(3*l[e]),u[o]=T,u[o+1]=P,u[o+2]=I,o+=d;else for(let e=0;e<p;++e){if(C(3*l[e]),x){const e=T*T+P*P+I*I;if(e<M&&e>w){const t=1/Math.sqrt(e);T*=t,P*=t,I*=t}}for(let e=0;e<s;++e)u[o]=T,u[o+1]=P,u[o+2]=I,o+=d}}function d(e,t,r,o,s=1){if(!t)return void l(e,r,o,s);const{data:n,indices:a}=e,c=t,u=r.typedBuffer,d=r.typedBufferStride,p=a.length,h=c[0],f=c[1],m=c[2],y=c[4],g=c[5],b=c[6],_=c[8],v=c[9],S=c[10],x=!i.isOrthoNormal(c),w=1e-6,M=.999999;if(o*=d,1===s)for(let e=0;e<p;++e){const t=4*a[e],r=n[t],i=n[t+1],s=n[t+2],l=n[t+3];let c=h*r+y*i+_*s,p=f*r+g*i+v*s,T=m*r+b*i+S*s;if(x){const e=c*c+p*p+T*T;if(e<M&&e>w){const t=1/Math.sqrt(e);c*=t,p*=t,T*=t}}u[o]=c,u[o+1]=p,u[o+2]=T,u[o+3]=l,o+=d}else for(let e=0;e<p;++e){const t=4*a[e],r=n[t],i=n[t+1],l=n[t+2],c=n[t+3];let p=h*r+y*i+_*l,T=f*r+g*i+v*l,P=m*r+b*i+S*l;if(x){const e=p*p+T*T+P*P;if(e<M&&e>w){const t=1/Math.sqrt(e);p*=t,T*=t,P*=t}}for(let e=0;e<s;++e)u[o]=p,u[o+1]=T,u[o+2]=P,u[o+3]=c,o+=d}}function p(e,t,r,i,o=1){const{data:s,indices:n}=e,a=r.typedBuffer,l=r.typedBufferStride,c=n.length;if(i*=l,t===s.length&&4===t){a[i]=s[0],a[i+1]=s[1],a[i+2]=s[2],a[i+3]=s[3];const e=new Uint32Array(r.typedBuffer.buffer,r.start),t=l/4,n=e[i/=4];i+=t;const u=c*o;for(let r=1;r<u;++r)e[i]=n,i+=t;return}if(1!==o)if(4!==t)for(let e=0;e<c;++e){const t=3*n[e];for(let e=0;e<o;++e)a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=255,i+=l}else for(let e=0;e<c;++e){const t=4*n[e];for(let e=0;e<o;++e)a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=s[t+3],i+=l}else{if(4===t){for(let e=0;e<c;++e){const t=4*n[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=s[t+3],i+=l}return}for(let e=0;e<c;++e){const t=3*n[e];a[i]=s[t],a[i+1]=s[t+1],a[i+2]=s[t+2],a[i+3]=255,i+=l}}}function h(e,t,r){const{data:i,indices:o}=e,s=t.typedBuffer,n=t.typedBufferStride,a=o.length,l=i[0];r*=n;for(let e=0;e<a;++e)s[r]=l,r+=n}const f=r.create();function m(e,t,r,i,o=1){const s=t.typedBuffer,n=t.typedBufferStride;if(i*=n,1===o)for(let t=0;t<r;++t)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=n;else for(let t=0;t<r;++t)for(let t=0;t<o;++t)s[i]=e[0],s[i+1]=e[1],s[i+2]=e[2],s[i+3]=e[3],i+=n}function y(e,t,r,i,f,m){switch(e){case"position":{s.assert(3===t.size);const i=f.getField(e,o.BufferViewVec3f);s.assert(!!i,`No buffer view for ${e}`),c(t,r,i,m);break}case"normal":{s.assert(3===t.size);const r=f.getField(e,o.BufferViewVec3f);s.assert(!!r,`No buffer view for ${e}`),u(t,i,r,m);break}case"normalCompressed":case"profileRight":case"profileUp":{s.assert(2===t.size);const r=f.getField(e,o.BufferViewVec2i16);s.assert(!!r,`No buffer view for ${e}`),n(t,r,m);break}case"uv0":{s.assert(2===t.size);const r=f.getField(e,o.BufferViewVec2f16)??f.getField(e,o.BufferViewVec2f);s.assert(!!r,`No buffer view for ${e}`),n(t,r,m);break}case"uvi":{s.assert(2===t.size);const r=f.getField(e,o.BufferViewVec2i16);s.assert(!!r,`No buffer view for ${e}`),n(t,r,m);break}case"color":case"symbolColor":{const r=f.getField(e,o.BufferViewVec4u8);s.assert(!!r,`No buffer view for ${e}`),s.assert(3===t.size||4===t.size),p(t,t.size,r,m);break}case"colorFeatureAttribute":case"opacityFeatureAttribute":case"sizeFeatureAttribute":{const r=f.getField(e,o.BufferViewFloat)??f.getField(e,o.BufferViewFloat);s.assert(!!r,`No buffer view for ${e}`),s.assert(1===t.size),h(t,r,m);break}case"tangent":{s.assert(4===t.size);const i=f.getField(e,o.BufferViewVec4f);s.assert(!!i,`No buffer view for ${e}`),d(t,r,i,m);break}case"profileVertexAndNormal":{s.assert(4===t.size);const r=f.getField(e,o.BufferViewVec4f16)??f.getField(e,o.BufferViewVec4f);s.assert(!!r,`No buffer view for ${e}`),l(t,r,m);break}case"profileAuxData":{s.assert(3===t.size);const r=f.getField(e,o.BufferViewVec3f16)??f.getField(e,o.BufferViewVec3f);s.assert(!!r,`No buffer view for ${e}`),a(t,r,m);break}}}e.writeAttribute=y,e.writeAttributes=function(e,t,r,i,s,n,a){let l={numItems:0,numVerticesPerItem:0};for(const c of r.fields.keys()){const r=e.get(c),u=r?.indices;if(r&&u)"position"===c&&(l={numItems:1,numVerticesPerItem:u.length}),y(c,r,i,s,n,a);else if("olidColor"===c&&null!=t){const r=e.get("position")?.indices;if(r){const e=r.length;m(t,n.getField(c,o.BufferViewVec4u8),e,a)}}}return l},e.writeBufferFloat=function(e,t,r,i=1){const{data:o,indices:s}=e,n=t.typedBuffer,a=t.typedBufferStride,l=s.length;if(r*=a,1===i)for(let e=0;e<l;++e)n[r]=o[s[e]],r+=a;else for(let e=0;e<l;++e){const t=o[s[e]];for(let e=0;e<i;e++)n[r]=t,r+=a}},e.writeBufferMat3f=function(e,t,r){const{data:i,indices:o}=e,s=t.typedBuffer,n=t.typedBufferStride,a=o.length;r*=n;for(let e=0;e<a;++e){const t=9*o[e];for(let e=0;e<9;++e)s[r+e]=i[t+e];r+=n}},e.writeBufferMat4f=function(e,t,r){const{data:i,indices:o}=e,s=t.typedBuffer,n=t.typedBufferStride,a=o.length;r*=n;for(let e=0;e<a;++e){const t=16*o[e];for(let e=0;e<16;++e)s[r+e]=i[t+e];r+=n}},e.writeBufferVec2=n,e.writeBufferVec3=a,e.writeBufferVec4=l,e.writeBufferVec4Zeros=function(e,t,r){const i=e.typedBuffer,o=e.typedBufferStride;t*=o;for(let e=0;e<r;++e)i[t]=0,i[t+1]=0,i[t+2]=0,i[t+3]=0,t+=o},e.writeColor=p,e.writeDeltaF16Vector=function(e,r,i,o){t.subtract(f,e,r);const s=Math.max(Math.sqrt(t.length(f)),1e-4);t.scale(f,f,1/s),i[o++]=f[0],i[o++]=f[1],i[o++]=f[2],i[o++]=s},e.writeNormal=u,e.writeOlidColor=m,e.writePosition=c,e.writeTangent=d,e.writeVVFeatureAttribute=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../support/buffer/glUtil","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/attributes/VertexNormal.glsl","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../effects/geometry/olidUtils","../lib/OrderIndependentTransparency","../lib/StencilUtils","../lib/lodRendering/RenderInstanceData","../materials/pbrUtils","../../../../chunks/DefaultMaterial.glsl","../../../webgl/renderState","../../../webgl/VertexAttributeLocations","../../../../webscene/support/AlphaCutoff"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b){"use strict";class _ extends a.VertexNormalPassParameters{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=f.advancedMRRFactors,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=2,this.instanced=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.instanceColorEncodesAlphaIgnore=!1,this.emissiveStrength=0,this.emissiveSource=1,this.emissiveBaseColor=r.ZEROS,this.instancedDoublePrecision=!1,this.normalType=0,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=r.freeze(.2,.2,.2),this.diffuse=r.freeze(.8,.8,.8),this.externalColor=i.fromValues(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=r.create(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.drivenOpacity=!1,this.writeDepth=!0,this.customDepthTest=0,this.textureAlphaMode=0,this.textureAlphaCutoff=b.alphaCutoff,this.textureAlphaPremultiplied=!1,this.renderOccluded=1,this.isDecoration=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}}class v extends a.VertexNormalDrawParameters{constructor(){super(...arguments),this.origin=r.create(),this.slicePlaneLocalOrigin=this.origin}}class S extends c.ShaderTechnique{constructor(t,r,i=new l.ReloadableShaderModule(m.DefaultMaterial,()=>new Promise((t,r)=>e(["./DefaultMaterial.glsl"],t,r)))){const s=[o.glLayout(x(r))];r.instanced&&r.instancedDoublePrecision&&s.push(o.glLayout(h.getRenderInstanceDataLayout(r))),super(t,r,i,g.fromLayouts(s))}_makePipeline(e,t){const{oitPass:r,output:i,transparent:o,cullFace:s,customDepthTest:a,hasOccludees:l}=e;return y.makePipelineState({blending:n.isColorOrColorEmission(i)&&o?d.blending(r):null,culling:(u=e,0===u.cullFace&&(u.hasSlicePlane||u.transparent||u.doubleSidedMode)?null:y.cullingParams(s)),depthTest:{func:d.oitDepthTest(r,(h=a,1===h?515:513))},depthWrite:d.depthWrite(e),drawBuffers:c.depthOnlyOutputBuffersOr(i,d.getDrawBuffers(r,i)),colorWrite:y.defaultColorWrite,stencilWrite:l?p.stencilWriteMaskOn:null,stencilTest:l?t?p.stencilToolMaskBaseParams:p.stencilBaseAllZerosParams:null,polygonOffset:d.oitPolygonOffset(e)});var u,h}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}function x(e){const t=s.newLayout().vec3f("position");return 1===e.normalType?t.vec2i16("normalCompressed",{glNormalized:!0}):t.vec3f("normal"),e.hasVertexTangents&&t.vec4f("tangent"),e.hasTextures&&t.vec2f16("uv0"),e.hasVertexColors&&t.vec4u8("color"),e.hasSymbolColors&&t.vec4u8("symbolColor"),!e.instanced&&u.olidEnabled()&&t.vec4u8("olidColor"),t}t.DefaultMaterialDrawParameters=v,t.DefaultMaterialPassParameters=_,t.DefaultMaterialTechnique=S,t.getLayout=x,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../../core/has","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(e,t,r,i){"use strict";e.glLayout=function(e,t=0){const o=e.stride;return Array.from(e.fields.keys()).map(s=>{const n=e.fields.get(s),a=n.constructor.ElementCount,l=function(e){switch(e){case"u8":return r.DataType.UNSIGNED_BYTE;case"u16":return r.DataType.UNSIGNED_SHORT;case"u32":return r.DataType.UNSIGNED_INT;case"i8":return r.DataType.BYTE;case"i16":return r.DataType.SHORT;case"i32":return r.DataType.INT;case"f16":return r.DataType.HALF_FLOAT;case"f32":return r.DataType.FLOAT;default:throw new Error("BufferType not supported in WebGL")}}(n.constructor.ElementType),c=n.offset,u=n.optional?.glNormalized??!1;return new i.VertexElementDescriptor(s,a,l,c,o,u,t)})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../geometry/support/float16","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types","./glUtil","../../webgl-engine/lib/Util","../../../webgl/VertexAttributeLocations"],function(e,t,r,i,o,s,n){"use strict";class a{constructor(e,t){this.layout=e,this.buffer="number"==typeof t?new ArrayBuffer(t*e.stride):t;for(const t of e.fields.keys()){const r=e.fields.get(t);this[t]=new r.constructor(this.buffer,r.offset,this.stride)}}get stride(){return this.layout.stride}get count(){return this.buffer.byteLength/this.stride}get byteLength(){return this.buffer.byteLength}getField(e,t){const r=this[e];return r&&r.elementCount===t.ElementCount&&r.elementType===t.ElementType?r:null}slice(e,t){return new a(this.layout,this.buffer.slice(e*this.stride,t*this.stride))}copyFrom(e,t=0,r=0,i=e.count){const o=this.stride;if(o%4==0){const s=new Uint32Array(e.buffer,t*o,i*o/4);new Uint32Array(this.buffer,r*o,i*o/4).set(s)}else{const s=new Uint8Array(e.buffer,t*o,i*o);new Uint8Array(this.buffer,r*o,i*o).set(s)}return this}get cachedMemory(){return this.byteLength}dispose(){}}class l{constructor(e){this._stride=0,this._fields=new Map,e&&(this._stride=e.stride,e.fields.forEach(e=>{return this._fields.set(e[0],{...e[1],constructor:(t=e[1].constructor,d.get(t))});var t}))}freeze(){return this}get locations(){return n.fromLayout(o.glLayout(this))}vec2f16(e,i){return this._appendField(e,t.hasNativeFloat16Array?r.BufferViewVec2f16:r.BufferViewVec2f,i),this}vec2f(e,t){return this._appendField(e,r.BufferViewVec2f,t),this}vec2f64(e,t){return this._appendField(e,r.BufferViewVec2f64,t),this}vec3f16(e,i){return this._appendField(e,t.hasNativeFloat16Array?r.BufferViewVec3f16:r.BufferViewVec3f,i),this}vec3f(e,t){return this._appendField(e,r.BufferViewVec3f,t),this}vec3f64(e,t){return this._appendField(e,r.BufferViewVec3f64,t),this}vec4f16(e,i){return this._appendField(e,t.hasNativeFloat16Array?r.BufferViewVec4f16:r.BufferViewVec4f,i),this}vec4f(e,t){return this._appendField(e,r.BufferViewVec4f,t),this}vec4f64(e,t){return this._appendField(e,r.BufferViewVec4f64,t),this}mat3f(e,t){return this._appendField(e,r.BufferViewMat3f,t),this}mat3f64(e,t){return this._appendField(e,r.BufferViewMat3f64,t),this}mat4f(e,t){return this._appendField(e,r.BufferViewMat4f,t),this}mat4f64(e,t){return this._appendField(e,r.BufferViewMat4f64,t),this}vec4u8(e,t){return this._appendField(e,r.BufferViewVec4u8,t),this}f16(e,i){return this._appendField(e,t.hasNativeFloat16Array?r.BufferViewFloat16:r.BufferViewFloat,i),this}f32(e,t){return this._appendField(e,r.BufferViewFloat,t),this}f64(e,t){return this._appendField(e,r.BufferViewFloat64,t),this}u8(e,t){return this._appendField(e,r.BufferViewUint8,t),this}u16(e,t){return this._appendField(e,r.BufferViewUint16,t),this}i8(e,t){return this._appendField(e,r.BufferViewInt8,t),this}vec2i8(e,t){return this._appendField(e,r.BufferViewVec2i8,t),this}vec2i16(e,t){return this._appendField(e,r.BufferViewVec2i16,t),this}vec2u8(e,t){return this._appendField(e,r.BufferViewVec2u8,t),this}vec2u16(e,t){return this._appendField(e,r.BufferViewVec2u16,t),this}vec4u16(e,t){return this._appendField(e,r.BufferViewVec4u16,t),this}u32(e,t){return this._appendField(e,r.BufferViewUint32,t),this}_appendField(e,t,r){this._fields.has(e)&&s.assert(!1,`${e} already added to vertex buffer layout`);const o=t.ElementCount*i.elementTypeSize(t.ElementType),n=this._stride;this._fields.set(e,{constructor:t,size:o,offset:n,optional:r}),this._alignFields()}_alignFields(){let e=0,t=1;this._fields.forEach(r=>{const o=i.elementTypeSize(r.constructor.ElementType);e=Math.floor((e+o-1)/o)*o,r.offset=e,e+=r.size,t=Math.max(t,o)}),e=Math.floor((e+t-1)/t)*t,this._stride=e}createBuffer(e){return new a(this,e)}createView(e){return new a(this,e)}clone(){const e=new l;return e._stride=this._stride,e._fields=new Map,this._fields.forEach((t,r)=>e._fields.set(r,t)),e.BufferType=this.BufferType,e}get stride(){return this._stride}get fields(){return this._fields}}const c=[r.BufferViewFloat,r.BufferViewVec2f,r.BufferViewVec3f,r.BufferViewVec4f,r.BufferViewMat3f,r.BufferViewMat4f,r.BufferViewFloat64,r.BufferViewVec2f64,r.BufferViewVec3f64,r.BufferViewVec4f64,r.BufferViewMat3f64,r.BufferViewMat4f64,r.BufferViewUint8,r.BufferViewVec2u8,r.BufferViewVec3u8,r.BufferViewVec4u8,r.BufferViewUint16,r.BufferViewVec2u16,r.BufferViewVec3u16,r.BufferViewVec4u16,r.BufferViewUint32,r.BufferViewVec2u32,r.BufferViewVec3u32,r.BufferViewVec4u32,r.BufferViewInt8,r.BufferViewVec2i8,r.BufferViewVec3i8,r.BufferViewVec4i8,r.BufferViewInt16,r.BufferViewVec2i16,r.BufferViewVec3i16,r.BufferViewVec4i16,r.BufferViewInt32,r.BufferViewVec2i32,r.BufferViewVec3i32,r.BufferViewVec4i32];function u(e){return`${e.ElementType}_${e.ElementCount}`}const d=new Map;c.forEach(e=>d.set(u(e),e)),e.InterleavedBuffer=a,e.InterleavedLayout=l,e.PackedLayout=class{constructor(e){this.fields=new Array,e.fields.forEach((e,t)=>{const r={...e,constructor:u(e.constructor)};this.fields.push([t,r])}),this.stride=e.stride}},e.newLayout=function(){return new l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(e){"use strict";e.elementTypeSize=function(e){switch(e){case"u8":case"i8":return 1;case"u16":case"i16":case"f16":return 2;case"u32":case"i32":case"f32":return 4;case"f64":return 8}},e.isInteger=function(e){switch(e){case"u8":case"u16":case"u32":case"i8":case"i16":case"i32":return!0;case"f16":case"f32":case"f64":return!1}},e.isSigned=function(e){switch(e){case"u8":case"u16":case"u32":return!1;case"i8":case"i16":case"i32":case"f16":case"f32":case"f64":return!0}},e.maximumValue=function(e){switch(e){case"u8":return 255;case"u16":return 65535;case"u32":return 4294967295;case"i8":return 127;case"i16":return 32767;case"i32":return 2147483647;case"f16":return 65504;case"f32":return 3402823e32;case"f64":return 179769e303}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","./NormalAttribute.glsl","./VertexPosition.glsl","../../shaderModules/glsl","../../shaderModules/Matrix3DrawUniform","../../shaderModules/Matrix3PassUniform"],function(e,t,r,i,o,s,n,a,l){"use strict";class c extends s.VertexPositionPassParameters{constructor(){super(...arguments),this.transformNormalViewFromGlobal=r.create()}}class u extends s.VertexPositionDrawParameters{constructor(){super(...arguments),this.transformNormalGlobalFromModel=r.create(),this.toMapSpace=i.create()}}e.VertexNormal=function(e,r){switch(r.normalType){case 0:case 1:e.include(o.NormalAttribute,r),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView","vec3"),e.vertex.uniforms.add(new a.Matrix3DrawUniform("transformNormalGlobalFromModel",e=>e.transformNormalGlobalFromModel),new l.Matrix3PassUniform("transformNormalViewFromGlobal",e=>e.transformNormalViewFromGlobal)).code.add(n.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case 2:e.vertex.code.add(n.glsl`void forwardNormal() {}`);break;default:t.neverReached(r.normalType);case 3:}},e.VertexNormalDrawParameters=u,e.VertexNormalPassParameters=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/glsl"],function(e,t,r){"use strict";e.NormalAttribute=function(e,i){switch(i.normalType){case 1:e.attributes.add("normalCompressed","vec2"),e.vertex.code.add(r.glsl`vec3 decompressNormal(vec2 normal) {
float z = 1.0 - abs(normal.x) - abs(normal.y);
return vec3(normal + sign(normal) * min(z, 0.0), z);
}
vec3 normalModel() {
return decompressNormal(normalCompressed);
}`);break;case 0:e.attributes.add("normal","vec3"),e.vertex.code.add(r.glsl`vec3 normalModel() {
return normal;
}`);break;case 2:e.fragment.code.add(r.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:t.neverReached(i.normalType);case 3:}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/glsl":function(){define(["exports"],function(e){"use strict";const t=(e,...t)=>{let r="";for(let i=0;i<t.length;i++)r+=e[i]+t[i];return r+=e[e.length-1],r};t.int=e=>Math.round(e).toString(),t.float=e=>e.toPrecision(8),e.If=function(e,t,r=""){return e?t:r},e.glsl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../util/DoublePrecision.glsl","../../shaderModules/Float3DrawUniform","../../shaderModules/Float3PassUniform","../../shaderModules/glsl","../../shaderModules/Matrix3DrawUniform","../../shaderModules/Matrix3PassUniform","../../shaderModules/Matrix4PassUniform","../../../../../webgl/NoParameters"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";class p extends d.NoParameters{constructor(){super(...arguments),this.transformWorldFromViewTH=i.create(),this.transformWorldFromViewTL=i.create(),this.transformViewFromCameraRelativeRS=t.create(),this.transformProjFromView=r.create()}}class h extends d.NoParameters{constructor(){super(...arguments),this.transformWorldFromModelRS=t.create(),this.transformWorldFromModelTH=i.create(),this.transformWorldFromModelTL=i.create()}}e.VertexPosition=function(e,t){const{attributes:r,vertex:i,varyings:d,fragment:p}=e;i.include(o.DoublePrecision,t),r.add("position","vec3"),d.add("vPositionWorldCameraRelative","vec3"),d.add("vPosition_view","vec3",{invariant:!0}),i.uniforms.add(new n.Float3PassUniform("transformWorldFromViewTH",e=>e.transformWorldFromViewTH),new n.Float3PassUniform("transformWorldFromViewTL",e=>e.transformWorldFromViewTL),new c.Matrix3PassUniform("transformViewFromCameraRelativeRS",e=>e.transformViewFromCameraRelativeRS),new u.Matrix4PassUniform("transformProjFromView",e=>e.transformProjFromView),new l.Matrix3DrawUniform("transformWorldFromModelRS",e=>e.transformWorldFromModelRS),new s.Float3DrawUniform("transformWorldFromModelTH",e=>e.transformWorldFromModelTH),new s.Float3DrawUniform("transformWorldFromModelTL",e=>e.transformWorldFromModelTL)),i.code.add(a.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * position;
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`),i.code.add(a.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${t.spherical?a.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:a.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `),p.uniforms.add(new n.Float3PassUniform("transformWorldFromViewTL",e=>e.transformWorldFromViewTL)),i.code.add(a.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`),p.code.add(a.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)},e.VertexPositionDrawParameters=h,e.VertexPositionPassParameters=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/FloatBindUniform","../../shaderModules/glsl"],function(e,t,r){"use strict";e.DoublePrecision=function({code:e,uniforms:i},o){i.add(new t.FloatBindUniform("dpDummy",()=>1)),e.add(r.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 hiD = hiA + hiB;
vec3 loD = loA + loB;
return  dpDummy * hiD + loD;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatBindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"float",0,(i,o)=>i.setUniform1f(e,t(o),r))}}e.FloatBindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Uniform":function(){define(["exports","../../core/has"],function(e,t){"use strict";e.Uniform=class{constructor(e,t,r,i,o=null){if(this.name=e,this.type=t,this.arraySize=o,this.bind={0:null,1:null,2:null},i)switch(r){case void 0:break;case 0:this.bind[0]=i;break;case 1:this.bind[1]=i;break;case 2:this.bind[2]=i}}equals(e){return this.type===e.type&&this.name===e.name&&this.arraySize===e.arraySize}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"vec3",2,(i,o,s,n)=>i.setUniform3fv(e,t(o,s,n),r))}}e.Float3DrawUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"vec3",1,(i,o,s)=>i.setUniform3fv(e,t(o,s),r))}}e.Float3PassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"mat3",2,(i,o,s)=>i.setUniformMatrix3fv(e,t(o,s),r))}}e.Matrix3DrawUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"mat3",1,(i,o,s)=>i.setUniformMatrix3fv(e,t(o,s),r))}}e.Matrix3PassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"mat4",1,(i,o,s)=>i.setUniformMatrix4fv(e,t(o,s),r))}}e.Matrix4PassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports"],function(e){"use strict";e.ReloadableShaderModule=class{constructor(e,t){this._module=e,this._load=t}get(){return this._module}async reload(){return this._module=await this._load(),this._module}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../core/Logger","../../../../../core/maybe","../shaderLibrary/ShaderOutput","../../lib/Program","../../../../webgl/enums","../../../../webgl/renderState"],function(e,t,r,i,o,s,n){"use strict";e.ShaderTechnique=class{constructor(e,i,n,a){this.primitiveType=s.PrimitiveType.TRIANGLES,this.key=i.key,this._program=new o.Program(e.rctx,n.get().build(i),a),this._pipeline=this.initializePipeline(i),this.reload=async s=>{s&&await n.reload(),this.key.equals(i.key)||t.getLogger("esri.views.3d.webgl.ShaderTechnique").warn("Configuration was changed after construction, cannot reload shader.",n),r.disposeMaybe(this._program),this._program=new o.Program(e.rctx,n.get().build(i),a),this._pipeline=this.initializePipeline(i)}}destroy(){this._program=r.disposeMaybe(this._program),this._pipeline=null}get program(){return this._program}get compiled(){return this.program.compiled}ensureAttributeLocations(e){this.program.assertCompatibleVertexAttributeLocations(e)}getPipeline(e,t){return this._pipeline}initializePipeline(e){return n.makePipelineState({blending:n.premultipliedAlpha,colorWrite:n.defaultColorWrite})}},e.depthOnlyOutputBuffersOr=function(e,t){return i.isDepthOnlyOutput(e)?{buffers:[0]}:t??null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Program":function(){define(["exports","../../../../core/has","../../../webgl/checkWebGLError"],function(e,t,r){"use strict";e.Program=class{constructor(e,t,i){this._context=e,this.locations=i,this._textures=new Map,this.source=r.webglDebugEnabled()?t:null,t.attributeNames.forEach(e=>{i.has(e)||console.error(`Missing VertexAttributeLocation for ${e} used in shader`)}),this._glProgram=e.programCache.acquire(t.generate("vertex",!0),t.generate("fragment",!0),i),this._glProgram.stop=()=>{throw new Error("Wrapped _glProgram used directly")},this.bind=t.generateBind(this),this.bindPass=t.generateBindPass(this),this.bindDraw=t.generateBindDraw(this)}dispose(){this._glProgram.dispose()}get glName(){return this._glProgram.glName}get hasTransformFeedbackVaryings(){return this._glProgram.hasTransformFeedbackVaryings}get compiled(){return this._glProgram.compiled}setUniform1b(e,t){this._glProgram.setUniform1i(e,t?1:0)}setUniform1i(e,t){this._glProgram.setUniform1i(e,t)}setUniform1f(e,t,r){this._glProgram.setUniform1f(e,t,r)}setUniform2fv(e,t,r){this._glProgram.setUniform2fv(e,t,r)}setUniform3fv(e,t,r){this._glProgram.setUniform3fv(e,t,r)}setUniform4fv(e,t,r){this._glProgram.setUniform4fv(e,t,r)}setUniformMatrix3fv(e,t,r){this._glProgram.setUniformMatrix3fv(e,t,!1,r)}setUniformMatrix4fv(e,t,r){this._glProgram.setUniformMatrix4fv(e,t,!1,r)}setUniform1fv(e,t,r){this._glProgram.setUniform1fv(e,t,r)}setUniform1iv(e,t){this._glProgram.setUniform1iv(e,t)}setUniform2iv(e,t){this._glProgram.setUniform2iv(e,t)}setUniform3iv(e,t){this._glProgram.setUniform3iv(e,t)}setUniform4iv(e,t){this._glProgram.setUniform4iv(e,t)}assertCompatibleVertexAttributeLocations(e,t){let r=e.locations;if(t){const e=new Map(r);t.forEach((t,i)=>e.set(i,r.size+t)),r=e}r.size!==this.locations.size&&console.error(`VertexAttributeLocations are incompatible: ${r}, ${this.locations}`),this.locations.forEach((e,t)=>{r.get(t)!==e&&console.error(`VertexAttributeLocations are incompatible: Program has ${t} at position ${e}, VAO has it at position ${r.get(t)}.`)})}stop(){this._textures.clear()}bindTexture(e,t){t?.glName||(r.webglDebugEnabled()&&console.error(`Texture sampler ${e} has no given Texture in ${(new Error).stack} `),t=this._context.emptyTexture);const i=this._ensureTextureUnit(e,t);this._context.useProgram(this),this.setUniform1i(e,i.unit),this._context.bindTexture(t,i.unit)}_ensureTextureUnit(e,t){let r=this._textures.get(e);return null==r?(r={texture:t,unit:this._textures.size},this._textures.set(e,r)):r.texture=t,r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/geometry/olidUtils":function(){define(["exports","../../../../../core/has"],function(e,t){"use strict";e.olidEnabled=function(){return!!t("enable-feature:objectAndLayerId-rendering")},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports"],function(e){"use strict";e.depthCompareAlways={func:519},e.depthCompareLess={func:513},e.renderWhenBitIsNotSet=e=>({function:{func:517,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7680}}),e.replaceBitWhenDepthTestPasses=e=>({function:{func:519,ref:e,mask:e},operation:{fail:7680,zFail:7680,zPass:7681}}),e.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}},e.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}},e.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},e.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}},e.stencilWriteMaskOff={mask:0},e.stencilWriteMaskOn={mask:255},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["exports","../../../../../core/arrayUtils","../../../../../geometry/support/buffer/BufferView","../../../support/buffer/InterleavedLayout","../Util","./BackedBufferObject","./InstanceData"],function(e,t,r,i,o,s,n){"use strict";class a{constructor(e){this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelOriginHi=e.instanceModelOriginHi,this.modelOriginLo=e.instanceModelOriginLo,this.featureAttribute=e.getField("instanceFeatureAttribute",r.BufferViewVec4f),this.color=e.getField("instanceColor",r.BufferViewVec4u8),this.olidColor=e.getField("instanceOlidColor",r.BufferViewVec4u8)}}const l=i.newLayout().vec3f("instanceModelOriginHi").vec3f("instanceModelOriginLo").mat3f("instanceModel").mat3f("instanceModelNormal");e.RenderInstanceData=class{constructor(e,t){this._rctx=e,this._layout=t,this._headIndex=0,this._tailIndex=0,this._firstIndex=null,this._captureFirstIndex=!0,this._updating=!1,this._prevHeadIndex=0,this._resized=!1,this._capacity=1}destroy(){this._buffer&&this._buffer.destroy()}get buffer(){return this._buffer.buffer}get view(){return this._view}get capacity(){return this._capacity}get size(){const e=this._headIndex,t=this._tailIndex;return e>=t?e-t:e+this._capacity-t}get isEmpty(){return this._headIndex===this._tailIndex}get isFull(){return this._tailIndex===(this._headIndex+1)%this._capacity}get headIndex(){return this._headIndex}get tailIndex(){return this._tailIndex}get firstIndex(){return this._firstIndex}get usedMemory(){return this._buffer?.usedMemory??0}reset(){this._headIndex=0,this._tailIndex=0,this._firstIndex=null}startUpdateCycle(){this._captureFirstIndex=!0}beginUpdate(){o.assert(!this._updating,"already updating"),this._updating=!0,this._prevHeadIndex=this._headIndex}endUpdate(){o.assert(this._updating,"not updating"),this.size<t.reallocShrinkThreshold*this.capacity&&this._shrink(),this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex),this._updating=!1}allocateHead(){o.assert(this._updating,"not updating"),this.isFull&&this._grow();const e=this.headIndex;return this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1),this._incrementHead(),o.assert(this._headIndex!==this._tailIndex,"invalid pointers"),e}freeTail(){o.assert(this._updating,"not updating"),o.assert(this.size>0,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail(),e&&(this._firstIndex=this._tailIndex)}_grow(){const e=Math.max(n.initialCapacity,Math.floor(this._capacity*t.reallocGrowthFactor));this._resize(e)}_shrink(){const e=Math.max(n.initialCapacity,Math.floor(this._capacity*t.reallocShrinkFactor));this._resize(e)}_resize(e){if(o.assert(this._updating,"not updating"),e===this._capacity)return;const t=new s.BackedBufferObject(this._rctx,this._layout,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const e=this.size,r=this._compactInstances(t);o.assert(r===e,"invalid compaction"),this._buffer.destroy(),this._tailIndex=0,this._headIndex=r,this._prevHeadIndex=0}this._resized=!0,this._capacity=e,this._buffer=t,this._view=new a(this._layout.createView(this._buffer.array))}_compactInstances(e){const t=this._headIndex,r=this._tailIndex;return r<t?(this._buffer.copyRange(r,t,e),t-r):r>t?(this._buffer.copyRange(r,this._capacity,e),t>0&&this._buffer.copyRange(0,t,e,this._capacity-r),t+(this._capacity-r)):0}_incrementHead(e=1){this._headIndex=(this._headIndex+e)%this._capacity}_incrementTail(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity}_transferRange(e,t){e<t?this._buffer.transferRange(e,t):e>t&&(t>0&&this._buffer.transferRange(0,t),this._buffer.transferRange(e,this._capacity))}},e.RenderInstanceDataView=a,e.getRenderInstanceDataLayout=function(e){return n.addOptionalLayoutFields(l.clone(),e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["exports","../../../support/buffer/glUtil","../../../../webgl/VertexBuffer"],function(e,t,r){"use strict";e.BackedBufferObject=class{constructor(e,i,o){this.elementSize=i.stride,this._buffer=new r.VertexBuffer(e,t.glLayout(i,1)),this.resize(o)}destroy(){this._buffer.dispose()}get capacity(){return this._capacity}get array(){return this._array}get buffer(){return this._buffer}get usedMemory(){return this._array.byteLength+this._buffer.usedMemory}copyRange(e,t,r,i=0){const o=new Uint8Array(this.array,e*this.elementSize,(t-e)*this.elementSize);new Uint8Array(r.array,i*this.elementSize).set(o)}transferAll(){this._buffer.setData(this._array)}transferRange(e,t){const r=e*this.elementSize,i=t*this.elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,i)}resize(e){const t=e*this.elementSize,r=new ArrayBuffer(t);this._array&&(e>=this._capacity?new Uint8Array(r).set(new Uint8Array(this._array)):new Uint8Array(r).set(new Uint8Array(this._array).subarray(0,e*this.elementSize))),this._array=r,this._buffer.setSize(t),this._capacity=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexBuffer":function(){define(["exports","./BufferObject"],function(e,t){"use strict";class r extends t.BufferObject{constructor(e,t,r,i=35044){super(e,34962,i,r),this.layout=t}}e.VertexBuffer=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define(["exports","../../core/arrayUtils","../../core/has","../../core/Logger","../../core/typedArrayUtil","./checkWebGLError","./enums"],function(e,t,r,i,o,s,n){"use strict";const a=()=>i.getLogger("esri.views.webgl.BufferObject"),l=!!r("esri-tests-disable-gpu-memory-measurements");class c{static createIndex(e,t,r){return new c(e,34963,t,r)}static createUniform(e,t,r){return new c(e,35345,t,r)}static createPixelPack(e,t=35041,r){const i=new c(e,35051,t);return r&&i.setSize(r),i}static createPixelUnpack(e,t=35040,r){return new c(e,35052,t,r)}static createTransformFeedback(e,t=35044,r){const i=new c(e,35982,t);return i.setSize(r),i}constructor(e,t,r,i){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(n.ResourceType.BufferObject,this),this._glName=this._context.gl.createBuffer(),s.checkWebGLError(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get sizeBytes(){if(34963===this.bufferType){if(this._indexType===n.DataType.UNSIGNED_INT)return 4*this._size;if(this._indexType===n.DataType.UNSIGNED_SHORT)return 2*this._size}return this._size}get usedMemory(){return l?0:this.sizeBytes}get _isVAOAware(){return 34963===this.bufferType||34962===this.bufferType}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(n.ResourceType.BufferObject,this),this._context=null):this._glName&&a().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(34963===this.bufferType&&null!=t)switch(this._indexType=t,t){case n.DataType.UNSIGNED_SHORT:e*=2;break;case n.DataType.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;34963===this.bufferType&&(o.isUint8Array(e)?this._indexType=n.DataType.UNSIGNED_BYTE:o.isUint16Array(e)?(t/=2,this._indexType=n.DataType.UNSIGNED_SHORT):o.isUint32Array(e)&&(t/=4,this._indexType=n.DataType.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),s.checkWebGLError(i),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,i){if(!e)return;const o=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:n}=this._context;n.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,i-r),s.checkWebGLError(n),this._isVAOAware&&this._context.bindVAO(o)}getSubData(e,r=0,i,o){if(i<0||o<0)return;const s=(n=e,t.isArrayLike(n)?e.BYTES_PER_ELEMENT:1);var n;if(s*((i??0)+(o??0))>e.byteLength)return;r+s*(o??0)>this.usedMemory&&a().warn("Potential problem getting subdata: requested data exceeds buffer size!");const l=this._context.gl;35982===this.bufferType?(this._context.bindBuffer(this,35982),l.getBufferSubData(35982,r,e,i,o),this._context.unbindBuffer(35982)):(this._context.bindBuffer(this,36662),l.getBufferSubData(36662,r,e,i,o),this._context.unbindBuffer(36662))}async getSubDataAsync(e,t=0,r,i){await this._context.clientWaitAsync(),this.getSubData(e,t,r,i)}}e.BufferObject=c,e.tracer=null,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/arrayUtils","../../../../../core/Evented","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/libs/gl-matrix-2/math/mat3","../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/support/buffer/BufferView","../../../support/mathUtils","../../../support/buffer/InterleavedLayout","../../effects/geometry/olidUtils","../Util"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_){"use strict";class v{constructor(e){this.localTransform=e.localTransform,this.globalTransform=e.globalTransform,this.modelOrigin=e.modelOrigin,this.model=e.instanceModel,this.modelNormal=e.instanceModelNormal,this.modelScaleFactors=e.modelScaleFactors,this.boundingSphere=e.boundingSphere,this.featureAttribute=e.getField("instanceFeatureAttribute",m.BufferViewVec4f),this.color=e.getField("instanceColor",m.BufferViewVec4u8),this.olidColor=e.getField("instanceOlidColor",m.BufferViewVec4u8),this.state=e.getField("state",m.BufferViewUint8),this.lodLevel=e.getField("lodLevel",m.BufferViewUint8)}}e.InstanceData=class extends r{constructor(e,t){super(e),this.events=new o.EventEmitter,this._capacity=0,this._size=0,this._next=0,this._highlightOptionsMap=new Map,this._highlightOptionsMapPrev=new Map,this._layout=function(e){return x(S.clone(),e).u8("state").u8("lodLevel")}(t),this._capacity=I,this._buffer=this._layout.createBuffer(this._capacity),this._view=new v(this._buffer)}get capacity(){return this._capacity}get size(){return this._size}get view(){return this._view}addInstance(){this._size+1>this._capacity&&this._grow();const e=this._findSlot();return this._view.state.set(e,1),this._size++,this.events.emit("instances-changed"),e}removeInstance(e){const t=this._view.state;_.assert(e>=0&&e<this._capacity&&!!(1&t.get(e)),"invalid instance handle"),this._getStateFlag(e,18)?this._setStateFlags(e,32):this.freeInstance(e),this.events.emit("instances-changed")}freeInstance(e){const t=this._view.state;_.assert(e>=0&&e<this._capacity&&!!(1&t.get(e)),"invalid instance handle"),t.set(e,0),this._size--}setLocalTransform(e,t,r=!0){this._view.localTransform.setMat(e,t),r&&this.updateModelTransform(e)}getLocalTransform(e,t){this._view.localTransform.getMat(e,t)}setGlobalTransform(e,t,r=!0){this._view.globalTransform.setMat(e,t),r&&this.updateModelTransform(e)}getGlobalTransform(e,t){this._view.globalTransform.getMat(e,t)}updateModelTransform(e){const t=this._view,r=w,i=M;t.localTransform.getMat(e,T),t.globalTransform.getMat(e,P);const o=d.multiply(P,P,T);h.set(r,o[12],o[13],o[14]),t.modelOrigin.setVec(e,r),c.fromMat4(i,o),t.model.setMat(e,i);const s=y.scaleFromMatrix(w,o);s.sort(),t.modelScaleFactors.set(e,0,s[1]),t.modelScaleFactors.set(e,1,s[2]),c.invert(i,i),c.transpose(i,i),t.modelNormal.setMat(e,i),this._setStateFlags(e,64),this.events.emit("instance-transform-changed",{index:e})}getModelTransform(e,t){const r=this._view;r.model.getMat(e,M),r.modelOrigin.getVec(e,w),t[0]=M[0],t[1]=M[1],t[2]=M[2],t[3]=0,t[4]=M[3],t[5]=M[4],t[6]=M[5],t[7]=0,t[8]=M[6],t[9]=M[7],t[10]=M[8],t[11]=0,t[12]=w[0],t[13]=w[1],t[14]=w[2],t[15]=1}applyShaderTransformation(e,t){null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedModelTransform(e,t){return this.getModelTransform(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t),t}getCombinedLocalTransform(e,t){this._view.localTransform.getMat(e,t),null!=this.shaderTransformation&&this.shaderTransformation.applyTransform(this,e,t)}getCombinedMaxScaleFactor(e){let t=this._view.modelScaleFactors.get(e,1);return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(w,this,e),t*=Math.max(w[0],w[1],w[2])),t}getCombinedMedianScaleFactor(e){let t=this._view.modelScaleFactors.get(e,0);var r,i,o;return null!=this.shaderTransformation&&(this.shaderTransformation.scaleFactor(w,this,e),t*=(r=w[0],i=w[1],o=w[2],Math.max(Math.min(r,i),Math.min(Math.max(r,i),o)))),t}getModel(e,t){this._view.model.getMat(e,t)}setFeatureAttribute(e,t){this._view.featureAttribute?.setVec(e,t)}getFeatureAttribute(e,t){this._view.featureAttribute?.getVec(e,t)}setColor(e,t){this._view.color?.setVec(e,t)}setObjectAndLayerIdColor(e,t){this._view.olidColor?.setVec(e,t)}setVisible(e,t){t!==this.getVisible(e)&&(this._setStateFlag(e,4,t),this.events.emit("instance-visibility-changed",{index:e}))}getVisible(e){return this._getStateFlag(e,4)}setHighlight(e,t){const{_highlightOptionsMap:r}=this,i=r.get(e);t?t!==i&&(r.set(e,t),this._setStateFlag(e,8,!0),this.events.emit("instance-highlight-changed")):i&&(r.delete(e),this._setStateFlag(e,8,!1),this.events.emit("instance-highlight-changed"))}get highlightOptionsMap(){return this._highlightOptionsMap}getHighlightStateFlag(e){return this._getStateFlag(e,8)}geHighlightOptionsPrev(e){const t=this._highlightOptionsMapPrev.get(e)??null;return this._highlightOptionsMapPrev.delete(e),t}getHighlightName(e){const t=this.highlightOptionsMap.get(e)??null;return t?this._highlightOptionsMapPrev.set(e,t):this._highlightOptionsMapPrev.delete(e),t}getState(e){return this._view.state.get(e)}getLodLevel(e){return this._view.lodLevel.get(e)}countFlags(e){let t=0;for(let r=0;r<this._capacity;++r)this.getState(r)&e&&++t;return t}_setStateFlags(e,t){const r=this._view.state;t=r.get(e)|t,r.set(e,t)}_clearStateFlags(e,t){const r=this._view.state;t=r.get(e)&~t,r.set(e,t)}_setStateFlag(e,t,r){r?this._setStateFlags(e,t):this._clearStateFlags(e,t)}_getStateFlag(e,t){return!!(this._view.state.get(e)&t)}_grow(){this._capacity=Math.max(I,Math.floor(this._capacity*i.reallocGrowthFactor)),this._buffer=this._layout.createBuffer(this._capacity).copyFrom(this._buffer),this._view=new v(this._buffer)}_findSlot(){const e=this._view.state;let t=this._next;for(;1&e.get(t);)t=t+1===this._capacity?0:t+1;return this._next=t+1===this._capacity?0:t+1,t}},t.__decorate([s.property({constructOnly:!0})],e.InstanceData.prototype,"shaderTransformation",void 0),t.__decorate([s.property()],e.InstanceData.prototype,"_size",void 0),t.__decorate([s.property({readOnly:!0})],e.InstanceData.prototype,"size",null),e.InstanceData=t.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],e.InstanceData);const S=g.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("instanceModel").mat3f("instanceModelNormal").vec2f("modelScaleFactors");function x(e,t){return t.instancedFeatureAttribute&&e.vec4f("instanceFeatureAttribute"),t.instancedColor&&e.vec4u8("instanceColor"),b.olidEnabled()&&e.vec4u8("instanceOlidColor"),e}const w=f.create(),M=u.create(),T=p.create(),P=p.create(),I=64;e.InstanceDataView=v,e.addOptionalLayoutFields=x,e.initialCapacity=I,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/pbrUtils":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,r){"use strict";const i=r.freeze(1,1,.5),o=r.freeze(0,.6,.2),s=r.freeze(0,1,.2);e.advancedMRRFactors=i,e.esriSymbologyMRRFactors=s,e.schematicMRRFactors=o,e.useSchematicPBR=function({normalTexture:e,metallicRoughnessTexture:i,metallicFactor:o,roughnessFactor:s,emissiveTexture:n,emissiveFactor:a,occlusionTexture:l}){return null==e&&null==i&&null==n&&(null==a||t.exactEquals(a,r.ZEROS))&&null==l&&(null==s||1===s)&&(null==o||1===o)},e.useSchematicPBRI3S=function({normalTexture:e,metallicRoughnessTexture:i,metallicFactor:o,roughnessFactor:s,emissiveTexture:n,emissiveFactor:a,occlusionTexture:l}){return null==e&&null==i&&null==n&&(null==a||t.exactEquals(a,r.ZEROS))&&null==l&&(null==s||1===s)&&(null==o||1===o||0===o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/DefaultMaterial.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl","../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput","../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/InstanceColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/MaskedColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl","../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/Float3PassUniform","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/3d/webgl-engine/effects/weather/SnowCover.glsl","../views/3d/webgl-engine/materials/internal/MaterialUtil","../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl","../views/webgl/ShaderBuilder","../webscene/support/AlphaCutoff"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M,T,P,I,C,O,F,A,R,D,E,V,L,z,U){"use strict";function j(e){const j=new z.ShaderBuilder,{attributes:B,vertex:N,fragment:k,varyings:q}=j,{output:G,normalType:H,offsetBackfaces:W,spherical:$,snowCover:J,pbrMode:Y,textureAlphaPremultiplied:Z,instancedDoublePrecision:Q,hasVertexColors:X,hasVertexTangents:K,hasColorTexture:ee,hasNormalTexture:te,hasNormalTextureTransform:re,hasColorTextureTransform:ie,hasBloom:oe}=e;if(C.addProjViewLocalOrigin(N,e),B.add("position","vec3"),q.add("vpos","vec3",{invariant:!0}),j.include(T.VisualVariables,e),j.include(n.InstancedDoublePrecision,e),j.include(h.VerticalOffset,e),j.include(M.colorTextureUV,e),!r.isColorOrColorEmission(G))return j.include(f.DefaultMaterialAuxiliaryPasses,e),j;j.include(M.normalTextureUV,e),j.include(M.emissiveTextureUV,e),j.include(M.occlusionTextureUV,e),j.include(M.metallicRoughnessTextureUV,e),C.addCameraPosition(N,e),j.include(l.NormalAttribute,e),j.include(o.Transform,e);const se=0===H||1===H;return se&&W&&j.include(t.Offset),j.include(m.ComputeNormalTexture,e),j.include(p.VertexNormal,e),j.include(s.InstanceColor,e),q.add("vPositionLocal","vec3"),j.include(u.TextureCoordinateAttribute,e),j.include(c.SymbolColor,e),j.include(d.VertexColor,e),N.uniforms.add(new F.Float4PassUniform("externalColor",e=>e.externalColor,{supportsNaN:!0})),q.add("vcolorExt","vec4"),j.include(w.terrainDepthTest,e),N.include(a.MaskedColorDefinition),N.include(a.CreateMaskedFromNaNColor),j.include(Q?x.ReadShadowMapPass:x.ReadShadowMapDraw,e),N.main.add(R.glsl`
    forwardNormalizedVertexColor();

    MaskedColor maskedColor =
      applySymbolColor(applyVVColor(applyInstanceColor(createMaskedFromNaNColor(externalColor))));

    vcolorExt = maskedColor.color;
    forwardColorMixMode(maskedColor.mask);

    vpos = getVertexInLocalOriginSpace();
    vPositionLocal = vpos - view[3].xyz;
    vpos = subtractOrigin(vpos);
    ${R.If(se,"vNormalWorld = dpNormal(vvLocalNormal(normalModel()));")}
    vpos = addVerticalOffset(vpos, localOrigin);
    ${R.If(K,"vTangent = dpTransformVertexTangent(tangent);")}
    gl_Position = transformPosition(proj, view, vpos);
    ${R.If(se&&W,"gl_Position = offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);")}

    forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
    forwardTextureCoordinates();
    forwardColorUV();
    forwardNormalUV();
    forwardEmissiveUV();
    forwardOcclusionUV();
    forwardMetallicRoughnessUV();

    if (opacityMixMode != ${R.glsl.int(V.colorMixModes.ignore)} && vcolorExt.a < ${R.glsl.float(U.alphaCutoff)}) {
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
    }
    forwardLinearDepthToReadShadowMap();
  `),j.include(g.EvaluateSceneLighting,e),k.include(y.EvaluateAmbientOcclusion,e),j.include(P.DiscardOrAdjustAlphaPass,e),k.include(i.SliceDraw,e),j.include(L.outputColorHighlightOID,e),C.addCameraPosition(k,e),k.uniforms.add(N.uniforms.get("localOrigin"),new O.Float3PassUniform("ambient",e=>e.ambient),new O.Float3PassUniform("diffuse",e=>e.diffuse),new A.FloatPassUniform("opacity",e=>e.opacity),new A.FloatPassUniform("layerOpacity",e=>e.layerOpacity)),ee&&k.uniforms.add(new D.Texture2DPassUniform("tex",e=>e.texture)),j.include(S.PhysicallyBasedRenderingParameters,e),k.include(v.PhysicallyBasedRendering,e),k.include(I.MixExternalColor),j.include(_.Normals,e),k.include(E.SnowCover,e),g.addAmbientBoostFactor(k),g.addLightingGlobalFactor(k),b.addMainLightIntensity(k),k.main.add(R.glsl`
    discardBySlice(vpos);
    discardByTerrainDepth();
    ${ee?R.glsl`
            vec4 texColor = texture(tex, ${ie?"colorUV":"vuv0"});
            ${R.If(Z,"texColor.rgb /= texColor.a;")}
            discardOrAdjustAlpha(texColor);`:R.glsl`vec4 texColor = vec4(1.0);`}
    shadingParams.viewDirection = normalize(vpos - cameraPosition);
    ${2===H?R.glsl`vec3 normal = screenDerivativeNormal(vPositionLocal);`:R.glsl`shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
    applyPBRFactors();
    float ssao = evaluateAmbientOcclusionInverse() * getBakedOcclusion();

    vec3 posWorld = vpos + localOrigin;

    float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
    float shadow = readShadow(additionalAmbientScale, vpos);

    vec3 matColor = max(ambient, diffuse);
    vec3 albedo = mixExternalColor(${R.If(X,"vColor.rgb *")} matColor, texColor.rgb, vcolorExt.rgb, colorMixMode);
    float opacity_ = layerOpacity * mixExternalOpacity(${R.If(X,"vColor.a * ")} opacity, texColor.a, vcolorExt.a, opacityMixMode);

    ${te?`mat3 tangentSpace = computeTangentSpace(${K?"normal":"normal, vpos, vuv0"});\n            vec3 shadingNormal = computeTextureNormal(tangentSpace, ${re?"normalUV":"vuv0"});`:"vec3 shadingNormal = normal;"}
    vec3 normalGround = ${$?"normalize(posWorld);":"vec3(0.0, 0.0, 1.0);"}

    ${R.If(J,R.glsl`
          float snow = getSnow(normal, normalGround);
          albedo = mix(albedo, vec3(1), snow);
          shadingNormal = mix(shadingNormal, normal, snow);
          ssao = mix(ssao, 1.0, snow);`)}

    vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

    ${1===Y||2===Y?R.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
            vec4 emission = ${oe?"vec4(0.0)":"getEmissions(albedo)"};
            ${R.If(J,"mrr = applySnowToMRR(mrr, snow);\n               emission = snowCoverForEmissions(emission, snow);")}
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:R.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
    vec4 finalColor = vec4(shadedColor, opacity_);
    outputColorHighlightOID(finalColor, vpos, albedo ${R.If(J,", snow")});
  `),j}const B=Object.freeze(Object.defineProperty({__proto__:null,build:j},Symbol.toStringTag,{value:"Module"}));e.DefaultMaterial=B,e.build=j})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/glsl"],function(e,t){"use strict";e.Offset=function(e){e.vertex.code.add(t.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define(["exports","../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../shaderModules/Float3DrawUniform","../shaderModules/Float3PassUniform","../shaderModules/glsl","../../../../webgl/NoParameters"],function(e,t,r,i,o,s,n,a,l){"use strict";class c extends l.NoParameters{constructor(e){super(),this.slicePlaneLocalOrigin=e}}const u=a.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
bool rejectBySlice(vec3 pos) {
return sliceByPlane(pos);
}`;function d(e,t,...r){t.hasSlicePlane?(e.uniforms.add(...r),e.code.add(u)):e.code.add("bool rejectBySlice(vec3 pos) { return false; }")}function p(e,t,...r){d(e,t,...r),t.hasSlicePlane?e.code.add("\n    void discardBySlice(vec3 pos) {\n      if (sliceByPlane(pos)) {\n        discard;\n      }\n    }\n\n    vec4 applySliceOutline(vec4 color, vec3 pos) {\n      SliceFactors factors = calculateSliceFactors(pos);\n\n      factors.front /= 2.0 * fwidth(factors.front);\n      factors.side0 /= 2.0 * fwidth(factors.side0);\n      factors.side1 /= 2.0 * fwidth(factors.side1);\n      factors.side2 /= 2.0 * fwidth(factors.side2);\n      factors.side3 /= 2.0 * fwidth(factors.side3);\n\n      // return after calling fwidth, to avoid aliasing caused by discontinuities in the input to fwidth\n      if (sliceByFactors(factors)) {\n        return color;\n      }\n\n      float outlineFactor = (1.0 - step(0.5, factors.front))\n        * (1.0 - step(0.5, factors.side0))\n        * (1.0 - step(0.5, factors.side1))\n        * (1.0 - step(0.5, factors.side2))\n        * (1.0 - step(0.5, factors.side3));\n\n      return mix(color, vec4(vec3(0.0), color.a), outlineFactor * 0.3);\n    }\n\n    vec4 applySlice(vec4 color, vec3 pos) {\n      return sliceEnabled() ? applySliceOutline(color, pos) : color;\n    }\n  "):e.code.add(a.glsl`void discardBySlice(vec3 pos) { }
vec4 applySlice(vec4 color, vec3 pos) { return color; }`)}function h(e,t,r){return e.instancedDoublePrecision?i.set(b,r.camera.viewInverseTransposeMatrix[3],r.camera.viewInverseTransposeMatrix[7],r.camera.viewInverseTransposeMatrix[11]):t.slicePlaneLocalOrigin}function f(e,t){return null!=e?i.subtract(_,t.origin,e):t.origin}function m(e,r,i){return e.hasSliceTranslatedView?null!=r?t.translate(S,i.camera.viewMatrix,r):i.camera.viewMatrix:null}function y(e,t,r){if(null==r.slicePlane)return o.ZEROS;const s=h(e,t,r),n=f(s,r.slicePlane),a=m(e,s,r);return null!=a?i.transformMat4(_,n,a):n}function g(e,t,r,s){if(null==s||null==r.slicePlane)return o.ZEROS;const n=h(e,t,r),a=f(n,r.slicePlane),l=m(e,n,r);return null!=l?(i.add(v,s,a),i.transformMat4(_,a,l),i.transformMat4(v,v,l),i.subtract(v,v,_)):s}const b=o.create(),_=o.create(),v=o.create(),S=r.create();e.RejectBySlice=function(e,t){d(e,t,new s.Float3DrawUniform("slicePlaneOrigin",(e,r)=>y(t,e,r)),new s.Float3DrawUniform("slicePlaneBasis1",(e,r)=>g(t,e,r,r.slicePlane?.basis1)),new s.Float3DrawUniform("slicePlaneBasis2",(e,r)=>g(t,e,r,r.slicePlane?.basis2)))},e.SliceDraw=function(e,t){p(e,t,new s.Float3DrawUniform("slicePlaneOrigin",(e,r)=>y(t,e,r)),new s.Float3DrawUniform("slicePlaneBasis1",(e,r)=>g(t,e,r,r.slicePlane?.basis1)),new s.Float3DrawUniform("slicePlaneBasis2",(e,r)=>g(t,e,r,r.slicePlane?.basis2)))},e.SlicePass=function(e,t){p(e,t,new n.Float3PassUniform("slicePlaneOrigin",(e,r)=>y(t,e,r)),new n.Float3PassUniform("slicePlaneBasis1",(e,r)=>g(t,e,r,r.slicePlane?.basis1)),new n.Float3PassUniform("slicePlaneBasis2",(e,r)=>g(t,e,r,r.slicePlane?.basis2)))},e.SlicePlaneParameters=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepthToWriteShadowMap.glsl","../shaderModules/glsl"],function(e,t,r){"use strict";e.Transform=function(e){t.addCalculateLinearDepth(e),e.vertex.code.add(r.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),e.vertex.code.add(r.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepthToWriteShadowMap.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2BindUniform","../shaderModules/glsl"],function(e,t,r,i,o,s){"use strict";function n(e){e.vertex.uniforms.add(new o.Float2BindUniform("nearFar",e=>e.camera.nearFar))}function a(e){e.vertex.code.add(s.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}e.ForwardLinearDepthToWriteShadowMap=function(e,o){const{vertex:l}=e,c=r.isShadowRelatedOutput(o.output);c&&(e.include(i.VertexPosition,o),t.ForwardLinearDepth(e,!0),n(e),a(e)),l.code.add(s.glsl`
    void forwardLinearDepthToWriteShadowMap() {
      ${s.If(c,"forwardLinearDepth(calculateLinearDepth(nearFar, vPosition_view.z));")}
    }
  `)},e.addCalculateLinearDepth=a,e.addNearFar=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","../shaderModules/glsl"],function(e,t){"use strict";function r(e){e.varyings.add("linearDepth","float",{invariant:!0})}e.ForwardLinearDepth=function(e,i){i&&r(e),e.vertex.code.add(t.glsl`
    void forwardLinearDepth(float _linearDepth) { ${t.If(i,"linearDepth = _linearDepth;")} }
  `)},e.addLinearDepth=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2BindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"vec2",0,(i,o)=>i.setUniform2fv(e,t(o),r))}}e.Float2BindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstanceColor.glsl":function(){define(["exports","./MaskedColor.glsl","../../shaderModules/glsl"],function(e,t,r){"use strict";e.InstanceColor=function(e,i){i.instancedColor?(e.attributes.add("instanceColor","vec4"),e.vertex.include(t.MaskedColorDefinition),e.vertex.include(t.CreateMaskedFromUInt8NaNColor),e.vertex.include(t.MultiplyMaskedColors),e.vertex.code.add(r.glsl`
      MaskedColor applyInstanceColor(MaskedColor color) {
        return multiplyMaskedColors( color, createMaskedFromUInt8NaNColor(${"instanceColor"}));
      }
    `)):e.vertex.code.add(r.glsl`MaskedColor applyInstanceColor(MaskedColor color) {
return color;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/MaskedColor.glsl":function(){define(["exports","../../shaderModules/glsl"],function(e,t){"use strict";function r(e){e.code.add(t.glsl`struct MaskedColor {
vec4 color;
bvec4 mask;
};`)}e.CreateMaskedFromNaNColor=function(e){e.include(r),e.code.add(t.glsl`MaskedColor createMaskedFromNaNColor(vec4 color) {
return MaskedColor(color, isnan(color));
}`)},e.CreateMaskedFromUInt8NaNColor=function(e){e.include(r),e.code.add(t.glsl`
    MaskedColor createMaskedFromUInt8NaNColor(vec4 color) {
      return MaskedColor(color * ${t.glsl.float(1/254)}, equal(color, vec4(255)));
    }
  `)},e.MaskedColorDefinition=r,e.MultiplyMaskedColors=function(e){e.include(r),e.code.add(t.glsl`MaskedColor multiplyMaskedColors(MaskedColor color1, MaskedColor color2) {
vec4 masked1 = mix(color1.color, vec4(1), color1.mask);
vec4 masked2 = mix(color2.color, vec4(1), color2.mask);
return MaskedColor(masked1 * masked2, bvec4(ivec4(color1.mask) & ivec4(color2.mask)));
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat3","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../util/DoublePrecision.glsl","../util/View.glsl","../../shaderModules/Float3BindUniform","../../shaderModules/glsl","../../shaderModules/Matrix3PassUniform","../../shaderModules/Matrix4PassUniform","../../../../../webgl/doublePrecisionUtils","../../../../../webgl/NoParameters"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";class f extends h.NoParameters{constructor(){super(...arguments),this.modelTransformation=null}}const m=r.create(),y=s.create();e.InstancedDoublePassParameters=f,e.InstancedDoublePrecision=function(e,r){const{hasModelTransformation:s,instancedDoublePrecision:h,instanced:f,output:g,hasVertexTangents:b}=r;s&&(e.vertex.uniforms.add(new d.Matrix4PassUniform("model",e=>e.modelTransformation??i.IDENTITY)),e.vertex.uniforms.add(new u.Matrix3PassUniform("normalLocalOriginFromModel",e=>(t.normalFromMat4(m,e.modelTransformation??i.IDENTITY),m)))),f&&h&&(e.attributes.add("instanceModelOriginHi","vec3"),e.attributes.add("instanceModelOriginLo","vec3"),e.attributes.add("instanceModel","mat3"),e.attributes.add("instanceModelNormal","mat3"));const _=e.vertex;h&&(_.include(n.DoublePrecision,r),_.uniforms.add(new l.Float3BindUniform("viewOriginHi",e=>p.encodeDoubleHi(o.set(y,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]),y)),new l.Float3BindUniform("viewOriginLo",e=>p.encodeDoubleLo(o.set(y,e.camera.viewInverseTransposeMatrix[3],e.camera.viewInverseTransposeMatrix[7],e.camera.viewInverseTransposeMatrix[11]),y)))),_.code.add(c.glsl`
    vec3 getVertexInLocalOriginSpace() {
      return ${s?h?"(model * vec4(instanceModel * localPosition().xyz, 1.0)).xyz":"(model * localPosition()).xyz":h?"instanceModel * localPosition().xyz":"localPosition().xyz"};
    }

    vec3 subtractOrigin(vec3 _pos) {
      ${h?c.glsl`
          // Issue: (should be resolved now with invariant position) https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/56280
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -instanceModelOriginHi, -instanceModelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `),_.code.add(c.glsl`
    vec3 dpNormal(vec4 _normal) {
      return normalize(${s?h?"normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz)":"normalLocalOriginFromModel * _normal.xyz":h?"instanceModelNormal * _normal.xyz":"_normal.xyz"});
    }
    `),3===g&&(a.addViewNormal(_),_.code.add(c.glsl`
    vec3 dpNormalView(vec4 _normal) {
      return normalize((viewNormal * ${s?h?"vec4(normalLocalOriginFromModel * (instanceModelNormal * _normal.xyz), 1.0)":"vec4(normalLocalOriginFromModel * _normal.xyz, 1.0)":h?"vec4(instanceModelNormal * _normal.xyz, 1.0)":"_normal"}).xyz);
    }
    `)),b&&_.code.add(c.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${s?h?"return vec4(normalLocalOriginFromModel * (instanceModelNormal * _tangent.xyz), _tangent.w);":"return vec4(normalLocalOriginFromModel * _tangent.xyz, _tangent.w);":h?"return vec4(instanceModelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}
    }`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../shaderModules/Float3BindUniform","../../shaderModules/Float3DrawUniform","../../shaderModules/FloatBindUniform","../../shaderModules/Matrix4BindUniform","../../shaderModules/Matrix4DrawUniform"],function(e,t,r,i,o,s,n,a,l,c){"use strict";const u=r.create(),d=o.create();e.addCameraPosition=function(e,t){t.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",o.ZEROS):e.uniforms.add(new n.Float3DrawUniform("cameraPosition",(e,t)=>i.set(d,t.camera.viewInverseTransposeMatrix[3]-e.origin[0],t.camera.viewInverseTransposeMatrix[7]-e.origin[1],t.camera.viewInverseTransposeMatrix[11]-e.origin[2])))},e.addPixelRatio=function(e){e.uniforms.add(new a.FloatBindUniform("pixelRatio",e=>e.camera.pixelRatio/e.overlayStretch))},e.addProjViewLocalOrigin=function(e,r){if(!r.instancedDoublePrecision)return void e.uniforms.add(new l.Matrix4BindUniform("proj",e=>e.camera.projectionMatrix),new c.Matrix4DrawUniform("view",(e,r)=>t.translate(u,r.camera.viewMatrix,e.origin)),new n.Float3DrawUniform("localOrigin",e=>e.origin));const o=({camera:e})=>i.set(d,e.viewInverseTransposeMatrix[3],e.viewInverseTransposeMatrix[7],e.viewInverseTransposeMatrix[11]);e.uniforms.add(new l.Matrix4BindUniform("proj",e=>e.camera.projectionMatrix),new l.Matrix4BindUniform("view",e=>t.translate(u,e.camera.viewMatrix,o(e))),new s.Float3BindUniform("localOrigin",e=>o(e)))},e.addViewNormal=function(e){e.uniforms.add(new l.Matrix4BindUniform("viewNormal",e=>e.camera.viewInverseTransposeMatrix))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3BindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"vec3",0,(i,o)=>i.setUniform3fv(e,t(o),r))}}e.Float3BindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4BindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"mat4",0,(i,o)=>i.setUniformMatrix4fv(e,t(o),r))}}e.Matrix4BindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"mat4",2,(i,o,s)=>i.setUniformMatrix4fv(e,t(o,s),r))}}e.Matrix4DrawUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(e){"use strict";const t=new Float32Array(2);e.decodeDoubleArray=function(e,t,r){for(let i=0;i<r;++i)t[i]=e[2*i]+e[2*i+1]},e.encodeDoubleArray=function(e,t,r){for(let i=0;i<r;++i)t[2*i]=e[i],t[2*i+1]=e[i]-t[2*i]},e.encodeDoubleHi=function(e,r){const i=e.length;for(let o=0;o<i;++o)t[0]=e[o],r[o]=t[0];return r},e.encodeDoubleLo=function(e,r){const i=e.length;for(let o=0;o<i;++o)t[0]=e[o],t[1]=e[o]-t[0],r[o]=t[1];return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["exports","./MaskedColor.glsl","../../shaderModules/glsl","../../shaderModules/IntegerPassUniform","../../../materials/internal/MaterialUtil"],function(e,t,r,i,o){"use strict";e.SymbolColor=function(e,s){e.varyings.add("colorMixMode","int"),e.varyings.add("opacityMixMode","int"),e.vertex.uniforms.add(new i.IntegerPassUniform("symbolColorMixMode",e=>o.colorMixModes[e.colorMixMode])),s.hasSymbolColors?(e.vertex.include(t.MaskedColorDefinition),e.vertex.include(t.CreateMaskedFromUInt8NaNColor),e.vertex.include(t.MultiplyMaskedColors),e.attributes.add("symbolColor","vec4"),e.vertex.code.add(r.glsl`
    MaskedColor applySymbolColor(MaskedColor color) {
      return multiplyMaskedColors(color, createMaskedFromUInt8NaNColor(${"symbolColor"}));
    }
  `)):e.vertex.code.add(r.glsl`MaskedColor applySymbolColor(MaskedColor color) {
return color;
}`),e.vertex.code.add(r.glsl`
    void forwardColorMixMode(bvec4 mask) {
      colorMixMode = mask.r ? ${r.glsl.int(o.colorMixModes.ignore)} : symbolColorMixMode;
      opacityMixMode = mask.a ? ${r.glsl.int(o.colorMixModes.ignore)} : symbolColorMixMode;
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t){super(e,"int",1,(r,i,o)=>r.setUniform1i(e,t(i,o)))}}e.IntegerPassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/glsl"],function(e,t,r){"use strict";e.TextureCoordinateAttribute=function(e,i){switch(i.textureCoordinateType){case 1:return e.attributes.add("uv0","vec2"),e.varyings.add("vuv0","vec2"),void e.vertex.code.add(r.glsl`void forwardTextureCoordinates() { vuv0 = uv0; }`);case 2:return e.attributes.add("uv0","vec2"),e.attributes.add("uvRegion","vec4"),e.varyings.add("vuv0","vec2"),e.varyings.add("vuvRegion","vec4"),void e.vertex.code.add(r.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);default:t.neverReached(i.textureCoordinateType);case 0:return void e.vertex.code.add(r.glsl`void forwardTextureCoordinates() {}`);case 3:return}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/glsl"],function(e,t){"use strict";e.VertexColor=function(e,r){r.hasVertexColors?(e.attributes.add("color","vec4"),e.varyings.add("vColor","vec4"),e.vertex.code.add(t.glsl`void forwardVertexColor() { vColor = color; }`),e.vertex.code.add(t.glsl`
      void forwardNormalizedVertexColor() { vColor = color * ${t.glsl.float(1/255)}; }
    `)):e.vertex.code.add(t.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["exports","../../../../../../core/screenUtils","../../../../../../chunks/vec42","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../util/ScreenSizePerspective.glsl","../util/View.glsl","../../shaderModules/Float4PassUniform","../../shaderModules/glsl"],function(e,t,r,i,o,s,n,a){"use strict";const l=i.create();function c(e){e.uniforms.add(new n.Float4PassUniform("verticalOffset",(e,t)=>{const{minWorldLength:i,maxWorldLength:o,screenLength:s}=e.verticalOffset,n=Math.tan(.5*t.camera.fovY)/(.5*t.camera.fullViewport[3]),a=t.camera.pixelRatio||1;return r.set(l,s*a,n,i,o)}))}e.VerticalOffset=function(e,t){const r=e.vertex;t.hasVerticalOffset?(c(r),t.hasScreenSizePerspective&&(e.include(o.ScreenSizePerspective),o.addScreenSizePerspectiveAlignment(r),s.addCameraPosition(e.vertex,t)),r.code.add(a.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${t.spherical?a.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:a.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${t.hasScreenSizePerspective?a.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:a.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):r.code.add(a.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)},e.VerticalOffsetParameters=class{constructor(e){this.screenLength=t.pt2px(e.screenLength),this.minWorldLength=e.minWorldLength??0,this.maxWorldLength=e.maxWorldLength??1/0}},e.addVerticalOffset=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../shaderModules/Float3PassUniform","../../shaderModules/glsl"],function(e,t,r,i,o){"use strict";function s(e){return t.set(n,e.parameters.divisor,e.parameters.offset,e.minScaleFactor)}const n=r.create();e.ScreenSizePerspective=function(e){e.vertex.code.add(o.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`),e.vertex.code.add(o.glsl`vec3 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec3 params) {
return vec3(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z
);
}`),e.vertex.code.add(o.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`),e.vertex.code.add(o.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec3 factor) {
return mix(size * clamp(factor.x, factor.z, 1.0), size, factor.y);
}`),e.vertex.code.add(o.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec3 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)},e.addScreenSizePerspective=function(e){e.uniforms.add(new i.Float3PassUniform("screenSizePerspective",e=>s(e.screenSizePerspective)))},e.addScreenSizePerspectiveAlignment=function(e){e.uniforms.add(new i.Float3PassUniform("screenSizePerspectiveAlignment",e=>s(e.screenSizePerspectiveAlignment||e.screenSizePerspective)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"vec4",1,(i,o,s)=>i.setUniform4fv(e,t(o,s),r))}}e.Float4PassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define(["exports","../ForwardLinearDepthToWriteShadowMap.glsl","../Slice.glsl","../Transform.glsl","../attributes/NormalAttribute.glsl","../attributes/ObjectAndLayerIdColor.glsl","../attributes/TextureCoordinateAttribute.glsl","../attributes/VertexNormal.glsl","../output/OutputDepth.glsl","../output/OutputHighlight.glsl","../shading/VisualVariables.glsl","../util/DiscardOrAdjustAlpha.glsl","../util/View.glsl","../../shaderModules/glsl","../../shaderModules/Texture2DPassUniform"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";e.DefaultMaterialAuxiliaryPasses=function(e,m){const{vertex:y,fragment:g,varyings:b}=e,{hasColorTexture:_,alphaDiscardMode:v}=m,S=_&&1!==v,{output:x,normalType:w,hasColorTextureTransform:M}=m;switch(x){case 2:p.addProjViewLocalOrigin(y,m),e.include(i.Transform,m),g.include(r.SliceDraw,m),e.include(n.TextureCoordinateAttribute,m),S&&g.uniforms.add(new f.Texture2DPassUniform("tex",e=>e.texture)),y.main.add(h.glsl`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),e.include(d.DiscardOrAdjustAlphaPass,m),g.main.add(h.glsl`
        discardBySlice(vpos);
        ${h.If(S,h.glsl`vec4 texColor = texture(tex, ${M?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}`);break;case 4:case 5:case 6:case 7:case 9:p.addProjViewLocalOrigin(y,m),e.include(i.Transform,m),e.include(n.TextureCoordinateAttribute,m),e.include(u.VisualVariables,m),e.include(l.OutputDepth,m),g.include(r.SliceDraw,m),e.include(s.ObjectAndLayerIdColor,m),t.addNearFar(e),b.add("depth","float",{invariant:!0}),S&&g.uniforms.add(new f.Texture2DPassUniform("tex",e=>e.texture)),y.main.add(h.glsl`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
forwardTextureCoordinates();
forwardObjectAndLayerIdColor();`),e.include(d.DiscardOrAdjustAlphaPass,m),g.main.add(h.glsl`
        discardBySlice(vpos);
        ${h.If(S,h.glsl`vec4 texColor = texture(tex, ${M?"colorUV":"vuv0"});
               discardOrAdjustAlpha(texColor);`)}
        ${9===x?h.glsl`outputObjectAndLayerIdColor();`:h.glsl`outputDepth(depth);`}`);break;case 3:{p.addProjViewLocalOrigin(y,m),e.include(i.Transform,m),e.include(o.NormalAttribute,m),e.include(a.VertexNormal,m),e.include(n.TextureCoordinateAttribute,m),e.include(u.VisualVariables,m),S&&g.uniforms.add(new f.Texture2DPassUniform("tex",e=>e.texture)),2===w&&b.add("vPositionView","vec3",{invariant:!0});const t=0===w||1===w;y.main.add(h.glsl`
        vpos = getVertexInLocalOriginSpace();
        ${t?h.glsl`vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:h.glsl`vPositionView = (view * vec4(vpos, 1.0)).xyz;`}
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();`),g.include(r.SliceDraw,m),e.include(d.DiscardOrAdjustAlphaPass,m),g.main.add(h.glsl`
        discardBySlice(vpos);
        ${h.If(S,h.glsl`vec4 texColor = texture(tex, ${M?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}

        ${2===w?h.glsl`vec3 normal = screenDerivativeNormal(vPositionView);`:h.glsl`vec3 normal = normalize(vNormalWorld);
                    if (gl_FrontFacing == false){
                      normal = -normal;
                    }`}
        fragColor = vec4(0.5 + 0.5 * normal, 1.0);`);break}case 8:p.addProjViewLocalOrigin(y,m),e.include(i.Transform,m),e.include(n.TextureCoordinateAttribute,m),e.include(u.VisualVariables,m),S&&g.uniforms.add(new f.Texture2DPassUniform("tex",e=>e.texture)),y.main.add(h.glsl`vpos = getVertexInLocalOriginSpace();
vpos = subtractOrigin(vpos);
vpos = addVerticalOffset(vpos, localOrigin);
gl_Position = transformPosition(proj, view, vpos);
forwardTextureCoordinates();`),g.include(r.SliceDraw,m),e.include(d.DiscardOrAdjustAlphaPass,m),e.include(c.OutputHighlight,m),g.main.add(h.glsl`
        discardBySlice(vpos);
        ${h.If(S,h.glsl`vec4 texColor = texture(tex, ${M?"colorUV":"vuv0"});
                discardOrAdjustAlpha(texColor);`)}
        calculateOcclusionAndOutputHighlight();`)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../../shaderModules/glsl"],function(e,t){"use strict";e.ObjectAndLayerIdColor=function(e,r){if(9!==r.output)return e.vertex.code.add(t.glsl`void forwardObjectAndLayerIdColor() {}`),void e.fragment.code.add(t.glsl`void outputObjectAndLayerIdColor() {}`);const i=r.instanced;e.varyings.add("objectAndLayerIdColorVarying","vec4");const o=i?"instanceOlidColor":"olidColor";e.attributes.add(o,"vec4"),e.vertex.code.add(t.glsl`
    void forwardObjectAndLayerIdColor() {
      objectAndLayerIdColorVarying = ${o} * 0.003921568627451;
    }`),e.fragment.code.add(t.glsl`void outputObjectAndLayerIdColor() {
fragColor = objectAndLayerIdColorVarying;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../../shaderModules/glsl"],function(e,t){"use strict";e.OutputDepth=function(e,r){switch(r.output){case 4:case 5:case 6:case 7:e.fragment.code.add(t.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
return depth + SLOPE_SCALE * m + BIAS;
}
void outputDepth(float _linearDepth){
float fragDepth = _calculateFragDepth(_linearDepth);
gl_FragDepth = fragDepth;
}`)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../HighlightReadBitmap.glsl","../../shaderModules/glsl","../../shaderModules/Integer2BindUniform","../../shaderModules/IntegerBindUniform","../../shaderModules/Texture2DBindUniform","../../shaderModules/Texture2DUintBindUniform"],function(e,t,r,i,o,s,n){"use strict";e.OutputHighlight=function(e,a){const{fragment:l}=e,{output:c,draped:u,hasHighlightMixTexture:d}=a;8===c?(l.uniforms.add(new o.IntegerBindUniform("highlightLevel",e=>e.highlightLevel??0),new i.Integer2BindUniform("highlightMixOrigin",e=>e.highlightMixOrigin)),e.outputs.add("fragHighlight","uvec2",0),e.include(t.HighlightReadBitmap),d?l.uniforms.add(new n.Texture2DUintBindUniform("highlightMixTexture",e=>e.highlightMixTexture)).code.add(r.glsl`uvec2 getAccumulatedHighlight() {
return texelFetch(highlightMixTexture, ivec2(gl_FragCoord.xy) - highlightMixOrigin, 0).rg;
}
void outputHighlight(bool occluded) {
if (highlightLevel == 0) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
} else {
int ll = (highlightLevel & 3) << 1;
int li = (highlightLevel >> 2) & 3;
uint bits;
if (occluded) {
bits = 3u << ll;
} else {
bits = 1u << ll;
}
uvec2 combinedHighlight = getAccumulatedHighlight();
combinedHighlight[li] |= bits;
fragHighlight = combinedHighlight;
}
}`):l.code.add(r.glsl`void outputHighlight(bool occluded) {
uint bits = occluded ? 3u : 1u;
fragHighlight = uvec2(bits, 0);
}`),u?l.code.add(r.glsl`bool isHighlightOccluded() {
return false;
}`):l.uniforms.add(new s.Texture2DBindUniform("depthTexture",e=>e.mainDepth)).code.add(r.glsl`bool isHighlightOccluded() {
float sceneDepth = texelFetch(depthTexture, ivec2(gl_FragCoord.xy), 0).x;
return gl_FragCoord.z > sceneDepth + 5e-7;
}`),l.code.add(r.glsl`void calculateOcclusionAndOutputHighlight() {
outputHighlight(isHighlightOccluded());
}`)):l.code.add(r.glsl`void calculateOcclusionAndOutputHighlight() {}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/HighlightReadBitmap.glsl":function(){define(["exports","../shaderModules/glsl"],function(e,t){"use strict";e.HighlightReadBitmap=function(e){const{fragment:r}=e;r.code.add(t.glsl`uint readChannelBits(uint channel, int highlightLevel) {
int llc = (highlightLevel & 3) << 1;
return (channel >> llc) & 3u;
}
uint readChannel(uvec2 texel, int highlightLevel) {
int lic = (highlightLevel >> 2) & 1;
return texel[lic];
}
uint readLevelBits(uvec2 texel, int highlightLevel) {
return readChannelBits(readChannel(texel, highlightLevel), highlightLevel);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Integer2BindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t){super(e,"ivec2",0,(r,i)=>r.setUniform2iv(e,t(i)))}}e.Integer2BindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerBindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t){super(e,"int",0,(r,i)=>r.setUniform1i(e,t(i)))}}e.IntegerBindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DBindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t){super(e,"sampler2D",0,(r,i)=>r.bindTexture(e,t(i)))}}e.Texture2DBindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DUintBindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t){super(e,"usampler2D",0,(r,i)=>r.bindTexture(e,t(i)))}}e.Texture2DUintBindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["exports","../attributes/MaskedColor.glsl","../../shaderModules/Float3PassUniform","../../shaderModules/Float4PassUniform","../../shaderModules/Float4sPassUniform","../../shaderModules/FloatsPassUniform","../../shaderModules/glsl","../../shaderModules/Matrix3PassUniform","../../../materials/VisualVariablePassParameters"],function(e,t,r,i,o,s,n,a,l){"use strict";e.VisualVariables=function(e,c){const{vertex:u,attributes:d}=e;c.hasVVInstancing&&(c.hasVVSize||c.hasVVColor)&&d.add("instanceFeatureAttribute","vec4"),c.hasVVSize?(u.uniforms.add(new r.Float3PassUniform("vvSizeMinSize",e=>e.vvSize.minSize)),u.uniforms.add(new r.Float3PassUniform("vvSizeMaxSize",e=>e.vvSize.maxSize)),u.uniforms.add(new r.Float3PassUniform("vvSizeOffset",e=>e.vvSize.offset)),u.uniforms.add(new r.Float3PassUniform("vvSizeFactor",e=>e.vvSize.factor)),u.uniforms.add(new r.Float3PassUniform("vvSizeFallback",e=>e.vvSize.fallback)),u.uniforms.add(new a.Matrix3PassUniform("vvSymbolRotationMatrix",e=>e.vvSymbolRotationMatrix)),u.uniforms.add(new r.Float3PassUniform("vvSymbolAnchor",e=>e.vvSymbolAnchor)),u.code.add(n.glsl`vec3 vvScale(vec4 _featureAttribute) {
if (isnan(_featureAttribute.x)) {
return vvSizeFallback;
}
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),u.code.add(n.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 scale = max(vvScale(_featureAttribute), eps);
        return vec4(vvSymbolRotationMatrix * _normal / scale, 1.0);
      }

      ${c.hasVVInstancing?n.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):u.code.add(n.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`),e.vertex.include(t.MaskedColorDefinition),c.hasVVColor?(u.constants.add("vvColorNumber","int",l.vvColorNumber),u.uniforms.add(new s.FloatsPassUniform("vvColorValues",e=>e.vvColor.values,l.vvColorNumber),new o.Float4sPassUniform("vvColorColors",e=>e.vvColor.colors,l.vvColorNumber),new i.Float4PassUniform("vvColorFallback",e=>e.vvColor.fallback,{supportsNaN:!0})),c.hasVVInstancing&&(e.vertex.include(t.MultiplyMaskedColors),e.vertex.include(t.CreateMaskedFromNaNColor)),u.code.add(n.glsl`
      vec4 interpolateVVColor(float value) {
        if (isnan(value)) {
          return vvColorFallback;
        }

        if (value <= vvColorValues[0]) {
          return vvColorColors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (vvColorValues[i] >= value) {
            float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
            return mix(vvColorColors[i-1], vvColorColors[i], f);
          }
        }
        return vvColorColors[vvColorNumber - 1];
      }

      vec4 vvGetColor(vec4 featureAttribute) {
        return interpolateVVColor(featureAttribute.y);
      }

      ${c.hasVVInstancing?n.glsl`
            vec4 vvColor() {
              return vvGetColor(instanceFeatureAttribute);
            }

            MaskedColor applyVVColor(MaskedColor color) {
              return multiplyMaskedColors(color, createMaskedFromNaNColor(vvColor()));
            }
            `:n.glsl`
            vec4 vvColor() {
              return vec4(1.0);
            }

            MaskedColor applyVVColor(MaskedColor color) {
              return color;
            }
            `}
    `)):u.code.add(n.glsl`vec4 vvColor() {
return vec4(1.0);
}
MaskedColor applyVVColor(MaskedColor color) {
return color;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r,i){super(e,"vec4",1,(r,o,s)=>r.setUniform4fv(e,t(o,s),i),r)}}e.Float4sPassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r,i){super(e,"float",1,(r,o,s)=>r.setUniform1fv(e,t(o,s),i),r)}}e.FloatsPassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../layers/support/FastSymbolUpdates"],function(e,t){"use strict";class r extends t.VisualVariablesParameters{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1}}e.VisualVariablePassParameters=r,e.vvColorNumber=8,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["exports","../../../../core/has","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../renderers/support/lengthUtils","../../../../support/guards","../../support/debugFlags","../../webgl-engine/effects/geometry/olidUtils","../../../webgl/NoParameters"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";class y{constructor(e){this.field=e}}class g extends y{constructor(e){super(e),this.minSize=[0,0,0],this.maxSize=[0,0,0],this.offset=[0,0,0],this.factor=[0,0,0],this.type=[0,0,0],this.fallback=[0,0,0]}}class b extends y{constructor(e){super(e),this.colors=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.values=[0,0,0,0,0,0,0,0],this.fallback=[0,0,0,0]}}class _ extends y{constructor(e,t=0){super(e),this.fallback=t,this.values=[0,0,0,0,0,0,0,0],this.opacityValues=[0,0,0,0,0,0,0,0]}}class v{}function S(e){return null!=e}function x(e,t){e&&e.push(t)}function w(e,t,r,i,o){const s=e.minSize,n=e.maxSize;if(e.useSymbolValue){const e=i.symbolSize[r];return t.minSize[r]=e,t.maxSize[r]=e,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0}if(S(e.field))return S(e.stops)?2===e.stops.length&&p.isNumber(e.stops[0].size)&&p.isNumber(e.stops[1].size)?(M(e.stops[0].size,e.stops[1].size,e.stops[0].value,e.stops[1].value,t,r),t.type[r]=1,!0):(x(o,"Could not convert size info: stops only supported with 2 elements"),!1):p.isNumber(s)&&p.isNumber(n)&&S(e.minDataValue)&&S(e.maxDataValue)?(M(s,n,e.minDataValue,e.maxDataValue,t,r),t.type[r]=1,!0):"unknown"===e.valueUnit?(x(o,"Could not convert size info: proportional size not supported"),!1):null!=d.meterIn[e.valueUnit]?(t.minSize[r]=-1/0,t.maxSize[r]=1/0,t.offset[r]=0,t.factor[r]=1/d.meterIn[e.valueUnit],t.type[r]=1,!0):(x(o,"Could not convert size info: scale-dependent size not supported"),!1);if(!S(e.field)){if(e.stops?.[0]&&p.isNumber(e.stops[0].size))return t.minSize[r]=e.stops[0].size,t.maxSize[r]=e.stops[0].size,t.offset[r]=t.minSize[r],t.factor[r]=0,t.type[r]=1,!0;if(p.isNumber(s))return t.minSize[r]=s,t.maxSize[r]=s,t.offset[r]=s,t.factor[r]=0,t.type[r]=1,!0}return x(o,"Could not convert size info: unsupported variant of sizeInfo"),!1}function M(e,t,r,i,o,s){const n=Math.abs(i-r)>0?(t-e)/(i-r):0;o.minSize[s]=n>0?e:t,o.maxSize[s]=n>0?t:e,o.offset[s]=e-r*n,o.factor[s]=n}function T(e,t,r){e[4*t]=r.r/255,e[4*t+1]=r.g/255,e[4*t+2]=r.b/255,e[4*t+3]=r.a}function P(e,t,r){const i=2===r&&"arithmetic"===e.rotationType;t.offset[r]=i?90:0,t.factor[r]=i?-1:1,t.type[r]=1}function I(e,t,r){if(!e)return null;const i=e.reduce((e,i)=>{if(!e)return e;if(i.valueExpression)return x(r,"Could not convert visual variables: arcade expressions not supported"),null;switch(i.type){case"size":return t.supports.size?function(e,t,r,i){if(e.normalizationField||e.valueRepresentation)return x(i,"Could not convert size info: unsupported property"),null;if(!p.isStringOrNull(e.field))return x(i,"Could not convert size info: field is not a string"),null;if(t.size){if(e.field)if(t.size.field){if(e.field!==t.size.field)return x(i,"Could not convert size info: multiple fields in use"),null}else t.size.field=e.field}else t.size=new g(e.field),a.copy(t.size.fallback,r.fallbackSize);let o;switch(e.axis){case"width":return o=w(e,t.size,0,r,i),o?t:null;case"height":return o=w(e,t.size,2,r,i),o?t:null;case"depth":return o=w(e,t.size,1,r,i),o?t:null;case"width-and-depth":return o=w(e,t.size,0,r,i),o&&w(e,t.size,1,r,i),o?t:null;case null:case void 0:case"all":return o=w(e,t.size,0,r,i),o=o&&w(e,t.size,1,r,i),o=o&&w(e,t.size,2,r,i),o?t:null;default:return x(i,`Could not convert size info: unknown axis "${e.axis}""`),null}}(i,e,t,r):e;case"color":return t.supports.color?function(e,t,r,i){if(e.normalizationField)return x(i,"Could not convert color info: unsupported property"),null;if(p.isString(e.field)){if(!e.stops)return x(i,"Could not convert color info: missing stops or colors"),null;{if(e.stops.length>8)return x(i,"Could not convert color info: too many color stops"),null;t.color=new b(e.field);const o=e.stops;for(let e=0;e<8;++e){const r=o[Math.min(e,o.length-1)];t.color.values[e]=r.value,T(t.color.colors,e,r.color)}c.copy(t.color.fallback,r.fallbackColor)}}else{if(!(e.stops&&e.stops.length>=0))return x(i,"Could not convert color info: no field and no colors/stops"),null;{const i=e.stops&&e.stops.length>=0&&e.stops[0].color;t.color=new b(null);for(let e=0;e<8;e++)t.color.values[e]=1/0,T(t.color.colors,e,i);c.copy(t.color.fallback,r.fallbackColor)}}return t}(i,e,t,r):e;case"opacity":return t.supports.opacity?function(e,t,r,i){if(e.normalizationField)return x(i,"Could not convert opacity info: unsupported property"),null;if(p.isString(e.field)){if(!e.stops)return x(i,"Could not convert opacity info: missing stops or opacities"),null;{if(e.stops.length>8)return x(i,"Could not convert opacity info: too many opacity stops"),null;t.opacity=new _(e.field,r.fallbackColor[3]);const o=e.stops;for(let e=0;e<8;++e){const r=o[Math.min(e,o.length-1)];t.opacity.values[e]=r.value,t.opacity.opacityValues[e]=r.opacity}}}else{if(!(e.stops&&e.stops.length>=0))return x(i,"Could not convert opacity info: no field and no opacities/stops"),null;{const i=e.stops&&e.stops.length>=0?e.stops[0].opacity:0;t.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0],fallback:r.fallbackColor[3]};for(let e=0;e<8;e++)t.opacity.values[e]=1/0,t.opacity.opacityValues[e]=i}}return t}(i,e,t,r):null;case"rotation":return t.supports.rotation?function(e,t,r){if(!p.isString(e.field))return x(r,"Could not convert rotation info: field is not a string"),null;if(t.rotation){if(e.field)if(t.rotation.field){if(e.field!==t.rotation.field)return x(r,"Could not convert rotation info: multiple fields in use"),null}else t.rotation.field=e.field}else t.rotation={field:e.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};switch(e.axis){case"tilt":return P(e,t.rotation,0),t;case"roll":return P(e,t.rotation,1),t;case null:case void 0:case"heading":return P(e,t.rotation,2),t;default:return x(r,`Could not convert rotation info: unknown axis "${e.axis}""`),null}}(i,e,r):e;default:return null}},new v);return!(e.length>0&&i)||i.size||i.color||i.opacity||i.rotation?i?.size&&!function(e,t,r){for(let r=0;r<3;++r){let i=t.unitInMeters;1===e.type[r]&&(i*=t.modelSize[r],e.type[r]=2),e.minSize[r]=e.minSize[r]/i,e.maxSize[r]=e.maxSize[r]/i,e.offset[r]=e.offset[r]/i,e.factor[r]=e.factor[r]/i}let i;if(0!==e.type[0])i=0;else if(0!==e.type[1])i=1;else{if(0===e.type[2])return x(r,"No size axis contains a valid size or scale"),!1;i=2}for(let t=0;t<3;++t)0===e.type[t]&&(e.minSize[t]=e.minSize[i],e.maxSize[t]=e.maxSize[i],e.offset[t]=e.offset[i],e.factor[t]=e.factor[i],e.type[t]=e.type[i]);return!0}(i.size,t,r)?null:i:null}class C{constructor(e,t,r){this.visualVariables=e,this.materialParameters=t,this.requiresShaderTransformation=r}}function O(e,t,r){if(!!e!=!!t)return!1;if(e&&e.field!==t?.field)return!1;if(e&&"rotation"===r){const r=e,i=t;for(let e=0;e<3;e++)if(r.type[e]!==i.type[e]||r.offset[e]!==i.offset[e]||r.factor[e]!==i.factor[e])return!1}return!0}class F extends m.NoParameters{constructor(e){super(),this.vvSize=e?.size??null,this.vvColor=e?.color??null,this.vvOpacity=e?.opacity??null}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}}function A(e,t){const r=new F(e);return r.vvSize&&(r.vvSymbolAnchor=t.anchor,s.identity(V),function(e,t,r,i=n.create()){const o=e||0,a=t||0,l=r||0;0!==o&&s.rotateZ(i,i,-o/180*Math.PI),0!==a&&s.rotateX(i,i,a/180*Math.PI),0!==l&&s.rotateY(i,i,l/180*Math.PI)}(t.rotation[2],t.rotation[0],t.rotation[1],V),r.vvSymbolRotationMatrix=r.vvSymbolRotationMatrix||o.create(),i.fromMat4(r.vvSymbolRotationMatrix,V)),r}function R(e,t,i){if(!t.vvSize)return a.set(e,1,1,1),e;if(Number.isNaN(i[0]))return a.copy(e,t.vvSize.fallback);for(let o=0;o<3;++o){const s=t.vvSize.offset[o]+i[0]*t.vvSize.factor[o];e[o]=r.clamp(s,t.vvSize.minSize[o],t.vvSize.maxSize[o])}return e}const D=n.create(),E=l.create(),V=n.create();e.ConvertOptions=class{constructor({supports:e,modelSize:t,symbolSize:r,unitInMeters:i,anchor:o,scale:s,rotation:n,fallbackColor:a,fallbackSize:c}){this.supports=e,this.modelSize=t??l.ones(),this.symbolSize=r??l.ones(),this.unitInMeters=i??1,this.anchor=o??l.zeros(),this.scale=s??l.ones(),this.rotation=n??l.zeros(),this.fallbackColor=a??u.ones(),this.fallbackSize=c??l.ones()}},e.FastColorInfo=b,e.FastOpacityInfo=_,e.FastRotationInfo=class extends y{constructor(e){super(e),this.offset=[0,0,0],this.factor=[1,1,1],this.type=[0,0,0]}},e.FastSizeInfo=g,e.FastSymbolUpdatesState=C,e.FastVisualVariables=v,e.VisualVariablesParameters=F,e.convertVisualVariables=I,e.evaluateModelTransform=function(e,t,r){if(!e.vvSize)return r;s.copy(D,r);const i=e.vvSymbolRotationMatrix;return s.set(V,i[0],i[1],i[2],0,i[3],i[4],i[5],0,i[6],i[7],i[8],0,0,0,0,1),s.multiply(D,D,V),R(E,e,t),s.scale(D,D,E),s.translate(D,D,e.vvSymbolAnchor),D},e.evaluateModelTransformScale=R,e.getAttributeValue=function(e,t){const r=null==e?0:t.attributes[e];return"number"==typeof r&&isFinite(r)?r:NaN},e.getMaterialParameters=A,e.initFastSymbolUpdatesState=function(e,t){if(!e)return null;if(f.olidEnabled())return null;if(h.debugFlags.TESTS_DISABLE_FAST_UPDATES)return null;const r=I(e.visualVariables,t);return r?new C(r,A(r,t),!!r.size):null},e.updateFastSymbolUpdatesState=function(e,t,r){if(!t||!e)return!1;const i=e.visualVariables,o=I(t.visualVariables,r);return!!o&&!!(O(i.size,o.size,"size")&&O(i.color,o.color,"color")&&O(i.rotation,o.rotation,"rotation")&&O(i.opacity,o.opacity,"opacity"))&&(e.visualVariables=o,e.materialParameters=A(o,r),e.requiresShaderTransformation=!!o.size,!0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl":function(){define(["exports","../../shaderModules/FloatDrawUniform","../../shaderModules/FloatPassUniform","../../shaderModules/glsl","../../../../../../webscene/support/AlphaCutoff"],function(e,t,r,i,o){"use strict";function s(e,t,r){const s=e.fragment,n=t.alphaDiscardMode,a=0===n;2!==n&&3!==n||s.uniforms.add(r),s.code.add(i.glsl`
    void discardOrAdjustAlpha(inout vec4 color) {
      ${1===n?"color.a = 1.0;":`if (color.a < ${a?i.glsl.float(o.alphaCutoff):"textureAlphaCutoff"}) {\n              discard;\n             } ${i.If(2===n,"else { color.a = 1.0; }")}`}
    }
  `)}e.DiscardOrAdjustAlphaDraw=function(e,r){s(e,r,new t.FloatDrawUniform("textureAlphaCutoff",e=>e.textureAlphaCutoff))},e.DiscardOrAdjustAlphaPass=function(e,t){s(e,t,new r.FloatPassUniform("textureAlphaCutoff",e=>e.textureAlphaCutoff))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"float",2,(i,o,s)=>i.setUniform1f(e,t(o,s),r))}}e.FloatDrawUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"float",1,(i,o,s)=>i.setUniform1f(e,t(o,s),r))}}e.FloatPassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/support/AlphaCutoff":function(){define(["exports"],function(e){"use strict";e.alphaCutoff=1/255.5,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t){super(e,"sampler2D",1,(r,i,o)=>r.bindTexture(e,t(i,o)))}}e.Texture2DPassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/glsl","../../shaderModules/Matrix3PassUniform","../../shaderModules/Texture2DDrawUniform","../../shaderModules/Texture2DPassUniform"],function(e,t,r,i,o,s,n,a,l){"use strict";e.ComputeNormalTexture=function(e,c){const u=e.fragment,{hasVertexTangents:d,doubleSidedMode:p,hasNormalTexture:h,textureCoordinateType:f,bindType:m,hasNormalTextureTransform:y}=c;d?(e.attributes.add("tangent","vec4"),e.varyings.add("vTangent","vec4"),2===p?u.code.add(s.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):u.code.add(s.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):u.code.add(s.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`),h&&0!==f&&(e.include(i.VertexTextureCoordinates,c),u.uniforms.add(1===m?new l.Texture2DPassUniform("normalTexture",e=>e.textureNormal):new a.Texture2DDrawUniform("normalTexture",e=>e.textureNormal)),y&&(u.uniforms.add(new o.Float2PassUniform("scale",e=>e.scale??r.ONES)),u.uniforms.add(new n.Matrix3PassUniform("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix??t.IDENTITY))),u.code.add(s.glsl`vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
vec3 rawNormal = textureLookup(normalTexture, uv).rgb * 2.0 - 1.0;`),y&&u.code.add(s.glsl`mat3 normalRotation = mat3(normalTextureTransformMatrix[0][0]/scale[0], normalTextureTransformMatrix[0][1]/scale[1], 0.0,
normalTextureTransformMatrix[1][0]/scale[0], normalTextureTransformMatrix[1][1]/scale[1], 0.0,
0.0, 0.0, 0.0 );
rawNormal.xy = (normalRotation * vec3(rawNormal.x, rawNormal.y, 1.0)).xy;`),u.code.add(s.glsl`return tangentSpace * rawNormal;
}`))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/glsl"],function(e,t,r,i){"use strict";e.VertexTextureCoordinates=function(e,o){const{textureCoordinateType:s}=o;if(0===s||3===s)return;e.include(t.TextureCoordinateAttribute,o);const n=2===s;n&&e.include(r.TextureAtlasLookup),e.fragment.code.add(i.glsl`
    vec4 textureLookup(sampler2D tex, vec2 uv) {
      return ${n?"textureAtlasLookup(tex, uv, vuvRegion)":"texture(tex, uv)"};
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/glsl"],function(e,t){"use strict";e.TextureAtlasLookup=function(e){e.fragment.code.add(t.glsl`vec4 textureAtlasLookup(sampler2D tex, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
return textureGrad(tex, uvAtlas, dUVdx, dUVdy);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"vec2",1,(i,o,s)=>i.setUniform2fv(e,t(o,s),r))}}e.Float2PassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t){super(e,"sampler2D",2,(r,i,o)=>r.bindTexture(e,t(i,o)))}}e.Texture2DDrawUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/glsl","../../shaderModules/Texture2DBindUniform","../../../effects/ssao/SSAO"],function(e,t,r,i){"use strict";e.EvaluateAmbientOcclusion=function(e,o){o.receiveAmbientOcclusion?(e.uniforms.add(new r.Texture2DBindUniform("ssaoTex",e=>e.ssao?.getTexture())),e.constants.add("blurSizePixelsInverse","float",1/i.blurSizePixels),e.code.add(t.glsl`float evaluateAmbientOcclusionInverse() {
vec2 ssaoTextureSizeInverse = 1.0 / vec2(textureSize(ssaoTex, 0));
return texture(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).r;
}
float evaluateAmbientOcclusion() {
return 1.0 - evaluateAmbientOcclusionInverse();
}`)):e.code.add(t.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAO":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/time","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/libs/gl-matrix-2/math/vec2","../../../webgl","../../../webgl/RenderNode","../../core/shaderLibrary/shading/ScreenSpaceConstants","./SSAOBlurTechnique","./SSAONoiseData","./SSAOParameters","./SSAOTechnique","../../../../../chunks/SSAO.glsl","../../../../webgl/enums","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x){"use strict";e.SSAO=class extends h{constructor(e){super(e),this.consumes={required:["normals"]},this.produces=p.InternalRenderCategory.SSAO,this.isEnabled=()=>!1,this._enableTime=s.Milliseconds(0),this._passParameters=new g.SSAOPassParameters,this._drawParameters=new g.BlurDrawParameters}initialize(){const e=Uint8Array.from(atob(y.noiseData),e=>e.charCodeAt(0)),t=new x.TextureDescriptor(32);t.wrapMode=33071,t.pixelFormat=6407,t.wrapMode=10497,t.hasMipmap=!0,this._passParameters.noiseTexture=new S.Texture(this.renderingContext,t,e),this.techniques.precompile(b.SSAOTechnique),this.techniques.precompile(m.SSAOBlurTechnique),this.addHandles(o.watch(()=>this.isEnabled(),()=>this._enableTime=s.Milliseconds(0)))}destroy(){this._passParameters.noiseTexture=i.disposeMaybe(this._passParameters.noiseTexture)}render(e){const t=e.find(({name:e})=>"normals"===e),i=t?.getTexture(),o=t?.getTexture(v.DepthStencilAttachment);if(!i||!o)return;const n=this.techniques.get(b.SSAOTechnique),a=this.techniques.get(m.SSAOBlurTechnique);if(!n.compiled||!a.compiled)return this._enableTime=s.Milliseconds(performance.now()),void this.requestRender(1);0===this._enableTime&&(this._enableTime=s.Milliseconds(performance.now()));const l=this.renderingContext,c=this.view.qualitySettings.fadeDuration,u=this.bindParameters,h=u.camera,y=h.relativeElevation,g=r.clamp((f.distanceFadeEnd-y)/(f.distanceFadeEnd-f.distanceFadeStart),0,1),S=c>0?Math.min(c,performance.now()-this._enableTime)/c:1,x=S*g;this._passParameters.normalTexture=i,this._passParameters.depthTexture=o,this._passParameters.projScale=1/h.computeScreenPixelSizeAtDist(1),this._passParameters.intensity=4*w/_.getRadius(h)**6*x;const M=h.fullViewport[2],T=h.fullViewport[3],P=this.fboCache.acquire(M,T,"ssao input",2);l.bindFramebuffer(P.fbo),l.setViewport(0,0,M,T),l.bindTechnique(n,u,this._passParameters,this._drawParameters),l.screen.draw();const I=Math.round(M/2),C=Math.round(T/2),O=this.fboCache.acquire(I,C,"ssao blur",0);l.bindFramebuffer(O.fbo),this._drawParameters.colorTexture=P.getTexture(),d.set(this._drawParameters.blurSize,0,2/T),l.bindTechnique(a,u,this._passParameters,this._drawParameters),l.setViewport(0,0,I,C),l.screen.draw(),P.release();const F=this.fboCache.acquire(I,C,p.InternalRenderCategory.SSAO,0);return l.bindFramebuffer(F.fbo),l.setViewport(0,0,M,T),l.setClearColor(1,1,1,0),l.clear(16384),this._drawParameters.colorTexture=O.getTexture(),d.set(this._drawParameters.blurSize,2/M,0),l.bindTechnique(a,u,this._passParameters,this._drawParameters),l.setViewport(0,0,I,C),l.screen.draw(),l.setViewport4fv(h.fullViewport),O.release(),S<1&&this.requestRender(1),F}},t.__decorate([n.property()],e.SSAO.prototype,"consumes",void 0),t.__decorate([n.property()],e.SSAO.prototype,"produces",void 0),t.__decorate([n.property({constructOnly:!0})],e.SSAO.prototype,"isEnabled",void 0),e.SSAO=t.__decorate([u.subclass("esri.views.3d.webgl-engine.effects.ssao.SSAO")],e.SSAO);const w=.5;e.blurSizePixels=2,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl":function(){define(["exports","../../Camera","../../core/mathUtils","../../core/libs/gl-matrix-2/factories/mat4f64","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../geometry/Point","../../geometry/SpatialReference","../../geometry/projection/computeTranslationToOriginAndRotation","../../geometry/projection/projectBuffer","../../geometry/projection/projectPointToVector","../../geometry/projection/projectVectorToVector","./camera/intersectionUtils","./support/viewingModeUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";const f=s.create(),m={heading:0,tilt:0};e.InternalRenderCategory={SSAO:"ssao",LASERLINES:"laserline-color",ANTIALIASING:"aa-color",HIGHLIGHTS:"highlight-color",MAGNIFIER:"magnifier-color",OCCLUDED:"occluded-color",VIEWSHED:"viewshed-color",OPAQUE_TERRAIN:"opaque-terrain-color",OPAQUE_ENVIRONMENT:"opaque-environment-color",TRANSPARENT_ENVIRONMENT:"transparent-environment-color",FOCUSAREA:"focusarea",FOCUSAREA_COLOR:"focusarea-color"},e.RenderCategory={OPAQUE:"opaque-color",TRANSPARENT:"transparent-color",COMPOSITE:"composite-color",FINAL:"final-color"},e.fromRenderCamera=function(e,i,o){const s=e.renderSpatialReference,l=h.directionToHeadingTilt(e,i.eye,i.viewForward,i.up,m);let c=e.spatialReference;return d.projectVectorToVector(i.eye,s,f,c)||(c=a.WGS84,d.projectVectorToVector(i.eye,s,f,c)),null==o?o=new t(new n(f,c),l.heading,l.tilt,r.rad2deg(i.fov)):(o.position.x=f[0],o.position.y=f[1],o.position.z=f[2],o.position.spatialReference=c,o.heading=l.heading,o.tilt=l.tilt,o.fov=r.rad2deg(i.fov)),o.layout.row=i.row,o.layout.rows=i.rows,o.layout.column=i.column,o.layout.columns=i.columns,o},e.fromRenderCoordinates=function(e,t,r,i,o,s,n){return s=s||e.spatialReference,c.projectBuffer(t,e.renderCoordsHelper.spatialReference,r,i,s,o,n)?i:null},e.renderCoordinateTransformAt=function(e,t,r,o){return o||(o=i.create()),r=r||e.spatialReference,l.computeTranslationToOriginAndRotation(r,t,o,e.renderCoordsHelper.spatialReference)?o:null},e.toRenderCamera=function(e,t){if(!t)return null;const i=e.renderSpatialReference,n=h.viewModeDependentUtil(e).headingTiltToDirectionUp,a=s.create();if(!u.projectPointToVector(t.position,a,i))return null;const l=n(a,t.heading,t.tilt);o.scale(l.direction,l.direction,e.state.camera.distance),o.add(l.direction,l.direction,a);const c=p.cameraOnContentAlongViewDirection(e,a,l.direction,l.up);return c.fov=r.deg2rad(t.fov),c.row=t.layout.row,c.rows=t.layout.rows,c.column=t.layout.column,c.columns=t.layout.columns,c},e.toRenderCoordinates=function(e,t,r,i,o,s,n){return i=i||e.spatialReference,c.projectBuffer(t,i,r,o,e.renderCoordsHelper.spatialReference,s,n)?o:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/Camera":function(){define(["./chunks/tslib.es6","./CameraLayout","./core/Clonable","./core/Cyclical","./core/JSONSupport","./core/mathUtils","./core/accessorSupport/decorators/property","./core/accessorSupport/decorators/cast","./core/has","./core/RandomLCG","./core/accessorSupport/decorators/reader","./core/accessorSupport/decorators/subclass","./core/accessorSupport/decorators/writer","./core/accessorSupport/ensureType","./geometry/Point"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";let m=class extends(r.ClonableMixin(o.JSONSupport)){constructor(...e){super(...e),this.position=new f([0,0,0]),this.heading=0,this.tilt=0,this.fov=55,this.layout=new t}normalizeCtorArgs(e,t,r,i){if(e&&"object"==typeof e&&("x"in e||Array.isArray(e))){const o={position:e};return null!=t&&(o.heading=t),null!=r&&(o.tilt=r),null!=i&&(o.fov=i),o}return e}writePosition(e,t,r,i){const o=e.clone();o.x=h.ensureNumber(e.x||0),o.y=h.ensureNumber(e.y||0),o.z=e.hasZ?h.ensureNumber(e.z||0):e.z,t[r]=o.write({},i)}readPosition(e,t){const r=new f;return r.read(e,t),r.x=h.ensureNumber(r.x||0),r.y=h.ensureNumber(r.y||0),r.z=r.hasZ?h.ensureNumber(r.z||0):r.z,r}equals(e){return null!=e&&this.tilt===e.tilt&&this.heading===e.heading&&this.fov===e.fov&&this.position.equals(e.position)&&this.layout.equals(e.layout)}};return e.__decorate([n.property({type:f,json:{write:{isRequired:!0}}})],m.prototype,"position",void 0),e.__decorate([p.writer("position")],m.prototype,"writePosition",null),e.__decorate([u.reader("position")],m.prototype,"readPosition",null),e.__decorate([n.property({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),a.cast(e=>i.cyclicalDegrees.normalize(h.ensureNumber(e)))],m.prototype,"heading",void 0),e.__decorate([n.property({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),a.cast(e=>s.clamp(h.ensureNumber(e),-180,180))],m.prototype,"tilt",void 0),e.__decorate([n.property({type:Number,nonNullable:!0,json:{default:55,write:!0}}),a.cast(e=>s.clamp(h.ensureNumber(e,55),1,170))],m.prototype,"fov",void 0),e.__decorate([n.property({type:t,nonNullable:!0,json:{read:!1,write:!1}})],m.prototype,"layout",void 0),m=e.__decorate([d.subclass("esri.Camera")],m),m})},"esri/CameraLayout":function(){define(["./chunks/tslib.es6","./core/Clonable","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/RandomLCG","./core/accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";let a=class extends t.Clonable{constructor(e){super(e),this.row=0,this.column=0,this.rows=1,this.columns=1}equals(e){return null!=e&&this.row===e.row&&this.rows===e.rows&&this.column===e.column&&this.columns===e.columns}};return e.__decorate([r.property({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"row",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"column",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"rows",void 0),e.__decorate([r.property({type:Number,nonNullable:!0,json:{read:!1,write:!1}})],a.prototype,"columns",void 0),a=e.__decorate([n.subclass("esri.CameraLayout")],a),a})},"esri/core/Cyclical":function(){define(["exports","./mathUtils"],function(e,t){"use strict";class r{constructor(e,t){this.min=e,this.max=t,this.range=t-e}normalize(e,t=0,r=!1){return i(this.range,this.min,this.max,e,t,r)}clamp(e,r=0){return t.clamp(e-r,this.min,this.max)+r}monotonic(e,t,r){return e<t?t:t+o(this.range,e-t,r)}minimalMonotonic(e,t,r){return i(this.range,e,e+this.range,t,r)}center(e,t,r){return t=this.monotonic(e,t,r),this.normalize((e+t)/2,r)}diff(e,t,r){return this.monotonic(e,t,r)-e}shortestSignedDiff(e,t){e=this.normalize(e);const r=(t=this.normalize(t))-e,i=t<e?this.minimalMonotonic(e,t)-e:t-this.minimalMonotonic(t,e);return Math.abs(r)<Math.abs(i)?r:i}contains(e,t,r){return t=this.minimalMonotonic(e,t),(r=this.minimalMonotonic(e,r))>e&&r<t}}function i(e,t,r,i,s=0,n=!1){return(i-=s)<t?i+=o(e,t-i):i>r&&(i-=o(e,i-r)),n&&i===r&&(i=t),i+s}function o(e,t,r=0){return Math.ceil((t-r)/e)*e+r}const s=new r(0,2*Math.PI),n=new r(-Math.PI,Math.PI),a=new r(0,360);e.Cyclical=r,e.cyclical2PI=s,e.cyclicalDegrees=a,e.cyclicalPI=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/intersectionUtils":function(){define(["exports","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/ellipsoidUtils","../../../geometry/support/aaBoundingRect","../webgl/RenderCamera","../webgl-engine/lib/DepthRange","../webgl-engine/lib/Intersector"],function(e,t,r,i,o,s,n,a){"use strict";function l(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function c(e,r,i){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const o=l(e,r),a=e.stateManager.constraintsManager.nearFarHeuristic;let c=f.get(e);void 0===c&&(c=new s,f.set(e,c)),c.eye=r,c.center=i;const{far:u}=a.compute(c,e.renderDataExtent,n.DepthRange.infinite,o),d=u*u;return t.squaredDistance(r,i)>d}let u={};const d=r.create(),p=r.create(),h=r.create(),f=new WeakMap;e.cameraOnContentAlongViewDirection=function(e,r,o,s){const n=e.state.camera.clone();r&&o&&s&&(n.eye=r,n.center=o,n.up=s),function(e,r,o){let s=u[e.viewingMode];s||(s=new a.Intersector(e.state.viewingMode),s.options.backfacesTerrain=!e.state.isGlobal,s.options.invisibleTerrain=!0,u[e.viewingMode]=s);const{isGlobal:n}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(r,s,o)||c(e,r.origin,o))||!(!e.renderCoordsHelper.intersectManifold(r,0,o)||c(e,r.origin,o))||!!n&&function(e,r,i){const o=t.dot(e.origin,e.origin)-i*i,s=o>0?Math.sqrt(o)/3:1;return t.scale(r,e.direction,s/t.length(e.direction)),t.add(r,r,e.origin),!0}(r,o,i.getReferenceEllipsoid(e.spatialReference).radius)}(e,n.ray,p)||t.copy(p,n.center);const l=e.state.constraints,f=l.minimumPoiDistance;if(t.squaredDistance(n.eye,p)<f){const r=l.collision.enabled;t.copy(h,n.viewForward),t.scale(h,h,f),r?n.eye=t.subtract(d,p,h):t.add(p,n.eye,h);const i=e.renderCoordsHelper,o=i.getAltitude(n.eye),s=l.collision.elevationMargin;r&&o<s&&(t.subtract(h,p,n.eye),n.eye=i.setAltitude(d,s,n.eye),t.add(p,n.eye,h))}return n.center=p,n},e.cleanupIntersectionUtils=function(){u={}},e.eyeWithinExtent=function(e,t,r,i){return null!=e.renderCoordsHelper.fromRenderCoords(t.eye,d,i)&&o.containsPoint(r,d)},e.surfaceElevationBelowRenderLocation=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/RenderCamera":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Logger","../../../core/mathUtils","../../../core/screenUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../core/libs/gl-matrix-2/math/mat4","../../../core/libs/gl-matrix-2/factories/mat4f64","../../../core/libs/gl-matrix-2/math/vec2","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../chunks/vec42","../../../core/libs/gl-matrix-2/factories/vec4f64","../../../geometry/support/frustum","../../../geometry/support/ray","../../../geometry/support/vector","../webgl-engine/lib/fov"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v){"use strict";var S;let x=S=class extends t{constructor(e){super(e),this._ray=b.create(),this._viewport=y.fromValues(0,0,1,1),this._padding=y.fromValues(0,0,0,0),this._fov=55/180*Math.PI,this._nearFar=p.fromValues(1,1e3),this._viewDirty=!0,this._viewMatrix=u.create(),this._viewProjectionDirty=!0,this._viewProjectionMatrix=u.create(),this._viewInverseTransposeMatrixDirty=!0,this._viewInverseTransposeMatrix=u.create(),this._frustumDirty=!0,this._frustum=g.create(),this._fullViewport=y.create(),this._pixelRatio=1,this.row=0,this.column=0,this._rows=1,this._columns=1,this._center=f.create(),this._up=f.create(),this.relativeElevation=0}get pixelRatio(){return this._pixelRatio}set pixelRatio(e){this._pixelRatio=e>0?e:1}get rows(){return this._rows}set rows(e){this._rows=Math.max(1,e)}get columns(){return this._columns}set columns(e){this._columns=Math.max(1,e)}get eye(){return this._ray.origin}set eye(e){this._compareAndSetView(e,this._ray.origin)}get center(){return this._center}set center(e){this._compareAndSetView(e,this._center,"_center")}get ray(){return h.subtract(this._ray.direction,this.center,this.eye),this._ray}get up(){return this._up}set up(e){this._compareAndSetView(e,this._up,"_up")}get viewMatrix(){return this._ensureViewClean(),this._viewMatrix}set viewMatrix(e){c.copy(this._viewMatrix,e),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0,this._viewProjectionDirty=!0,this._frustumDirty=!0}get viewForward(){return this._ensureViewClean(),h.set(f.create(),-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10])}get viewUp(){return this._ensureViewClean(),h.set(f.create(),this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9])}get viewRight(){return this._ensureViewClean(),h.set(f.create(),this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8])}get nearFar(){return this._nearFar}get near(){return this._nearFar[0]}set near(e){this._nearFar[0]!==e&&(this._nearFar[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get far(){return this._nearFar[1]}set far(e){this._nearFar[1]!==e&&(this._nearFar[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_nearFar"))}get viewport(){return this._viewport}set viewport(e){this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]}get screenViewport(){if(1===this.pixelRatio)return this._viewport;const e=m.scale(y.create(),this._viewport,1/this.pixelRatio),t=this._get("screenViewport");return t&&m.equals(e,t)?t:e}get screenPadding(){if(1===this.pixelRatio)return this._padding;const e=m.scale(y.create(),this._padding,1/this.pixelRatio),t=this._get("screenPadding");return t&&m.equals(e,t)?t:e}get x(){return this._viewport[0]}set x(e){e+=this._padding[3],this._viewport[0]!==e&&(this._viewport[0]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get y(){return this._viewport[1]}set y(e){e+=this._padding[2],this._viewport[1]!==e&&(this._viewport[1]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get width(){return this._viewport[2]}set width(e){this._viewport[2]!==e&&(this._viewport[2]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get height(){return this._viewport[3]}set height(e){this._viewport[3]!==e&&(this._viewport[3]=e,this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_viewport"))}get fullWidth(){return this._viewport[2]+this._padding[1]+this._padding[3]}set fullWidth(e){this.width=e-(this._padding[1]+this._padding[3])}get fullHeight(){return this._viewport[3]+this._padding[0]+this._padding[2]}set fullHeight(e){this.height=e-(this._padding[0]+this._padding[2])}get fullViewport(){return this._fullViewport[0]=this._viewport[0]-this._padding[3],this._fullViewport[1]=this._viewport[1]-this._padding[2],this._fullViewport[2]=this.fullWidth,this._fullViewport[3]=this.fullHeight,this._fullViewport}get _aspect(){return this.width/this.height}get padding(){return this._padding}set padding(e){m.exactEquals(this._padding,e)||(this._viewport[0]+=e[3]-this._padding[3],this._viewport[1]+=e[2]-this._padding[2],this._viewport[2]-=e[1]+e[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=e[0]+e[2]-(this._padding[0]+this._padding[2]),m.copy(this._padding,e),this._viewProjectionDirty=!0,this._frustumDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}get viewProjectionMatrix(){return this._viewProjectionDirty&&(c.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1),this._viewProjectionMatrix}get projectionMatrix(){return this._projectionMatrixInternal}get inverseProjectionMatrix(){return c.invert(u.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||u.create()}get fov(){return this._fov}set fov(e){this._fov=e,this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovX(){return v.fovd2fovx(this._fov,this.width,this.height)}set fovX(e){this._fov=v.fovx2fovd(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get fovY(){return v.fovd2fovy(this._fov,this.width,this.height)}set fovY(e){this._fov=v.fovy2fovd(e,this.width,this.height),this._viewProjectionDirty=!0,this._frustumDirty=!0}get distance(){return h.distance(this.center,this.eye)}get frustum(){return this._recomputeFrustum(),this._frustum}get viewInverseTransposeMatrix(){return(this._viewInverseTransposeMatrixDirty||this._viewDirty)&&(c.invert(this._viewInverseTransposeMatrix,this.viewMatrix),c.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),this._viewInverseTransposeMatrix}depthNDCToWorld(e){const{near:t,far:r}=this;return 2*t*r/(r+t-e*(r-t))}get perRenderPixelRatio(){return Math.tan(this.fovX/2)/(this.width/2)}get perScreenPixelRatio(){return this.perRenderPixelRatio*this.pixelRatio}get aboveGround(){return null!=this.relativeElevation&&this.relativeElevation>=0}get _projectionMatrixInternal(){const e=this.width,t=this.height,r=this.near*Math.tan(this.fovY/2)*2,i=r*this._aspect,o=r/this.rows,s=i/this.columns,n=-i/2+this.column*s,a=n+s,l=-r/2+this.row*o,d=l+o,p=c.frustum(u.create(),n*(1+2*this._padding[3]/e),a*(1+2*this._padding[1]/e),l*(1+2*this._padding[2]/t),d*(1+2*this._padding[0]/t),this.near,this.far),h=this._get("projectionMatrix");return h&&c.equals(h,p)?h:p}copyFrom(e){h.copy(this._ray.origin,e.eye),this.center=e.center,this.up=e.up,m.copy(this._viewport,e.viewport),this.notifyChange("_viewport"),m.copy(this._padding,e.padding),this.notifyChange("_padding"),d.copy(this._nearFar,e.nearFar),this.notifyChange("_nearFar"),this._fov=e.fov,this.row=e.row,this.column=e.column,this.rows=e.rows,this.columns=e.columns,this.relativeElevation=e.relativeElevation;const t=e;return this._viewDirty=t._viewDirty,this._viewDirty||(c.copy(this._viewMatrix,e.viewMatrix),this.notifyChange("_viewMatrix")),this._viewProjectionDirty=!0,this._frustumDirty=t._frustumDirty,this._frustumDirty||(g.copy(this._frustum,e.frustum),this._frustumDirty=!1),t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(c.copy(this._viewInverseTransposeMatrix,e.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1),m.copy(this._fullViewport,e.fullViewport),this.pixelRatio=e.pixelRatio,this}copyViewFrom(e){this.eye=e.eye,this.center=e.center,this.up=e.up,this.fov=e.fov}clone(){return(new S).copyFrom(this)}equals(e){return h.exactEquals(this.eye,e.eye)&&h.exactEquals(this.center,e.center)&&h.exactEquals(this.up,e.up)&&m.exactEquals(this._viewport,e.viewport)&&m.exactEquals(this._padding,e.padding)&&d.exactEquals(this.nearFar,e.nearFar)&&this._fov===e.fov&&this.pixelRatio===e.pixelRatio&&this.relativeElevation===e.relativeElevation&&this.row===e.row&&this.column===e.column&&this.rows===e.rows&&this.columns===e.columns}almostEquals(e){const t=Math.max(1,1/this.pixelRatio,1/e.pixelRatio);if(Math.abs(e.fov-this._fov)>=.001||m.squaredDistance(e.screenPadding,this.screenPadding)>=t||m.squaredDistance(this.screenViewport,e.screenViewport)>=t||this.row!==e.row||this.column!==e.column||this.rows!==e.rows||this.columns!==e.columns)return!1;h.sub(P,e.eye,e.center),h.sub(I,this.eye,this.center);const r=h.dot(P,I),i=h.sqrLen(P),o=h.sqrLen(I),s=5e-4;return r*r>=(1-1e-10)*i*o&&h.sqrDist(e.eye,this.eye)<Math.max(i,o)*s*s}computeRenderPixelSizeAt(e){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(e))}computeRenderPixelSizeAtDist(e){return e*this.perRenderPixelRatio}computeScreenPixelSizeAt(e){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(e))}_viewDirectionDistance(e){return Math.abs(_.projectPointSignedLength(this.viewForward,h.subtract(P,e,this.eye)))}computeScreenPixelSizeAtDist(e){return e*this.perScreenPixelRatio}computeDistanceFromRadius(e,t){return e/Math.tan(Math.min(this.fovX,this.fovY)/(2*(t||1)))}getScreenCenter(e=o.createScreenPointArray()){return e[0]=(this.padding[3]+this.width/2)/this.pixelRatio,e[1]=(this.padding[0]+this.height/2)/this.pixelRatio,e}getRenderCenter(e,t=.5,r=.5){return e[0]=this.padding[3]+this.width*t,e[1]=this.padding[2]+this.height*r,e[2]=.5,e}setGLViewport(e){const t=this.viewport,r=this.padding;e.setViewport(t[0]-r[3],t[1]-r[2],t[2]+r[1]+r[3],t[3]+r[0]+r[2])}applyProjection(e,t){e!==M&&h.copy(M,e),M[3]=1,m.transformMat4(M,M,this.projectionMatrix);const r=Math.abs(M[3]);h.scale(M,M,1/r);const o=this.fullViewport;t[0]=i.lerp(0,o[0]+o[2],.5+.5*M[0]),t[1]=i.lerp(0,o[1]+o[3],.5+.5*M[1]),t[2]=.5*(M[2]+1),t[3]=r}unapplyProjection(e,t){const r=this.fullViewport;M[0]=(e[0]/(r[0]+r[2])*2-1)*e[3],M[1]=(e[1]/(r[1]+r[3])*2-1)*e[3],M[2]=(2*e[2]-1)*e[3],M[3]=e[3],null!=this.inverseProjectionMatrix&&(m.transformMat4(M,M,this.inverseProjectionMatrix),t[0]=M[0],t[1]=M[1],t[2]=M[2])}projectToScreen(e,t){return this.projectToRenderScreen(e,C),this.renderToScreen(C,t),t}projectToRenderScreen(e,t){if(M[0]=e[0],M[1]=e[1],M[2]=e[2],M[3]=1,m.transformMat4(M,M,this.viewProjectionMatrix),0===M[3])return null;const r=M;h.scale(r,r,1/Math.abs(M[3]));const o=this.fullViewport,s=i.lerp(0,o[0]+o[2],.5+.5*r[0]),n=i.lerp(0,o[1]+o[3],.5+.5*r[1]);return"x"in t?(t.x=s,t.y=n):(t[0]=s,t[1]=n,t.length>2&&(t[2]=.5*(r[2]+1))),t}unprojectFromScreen(e,t){return this.unprojectFromRenderScreen(this.screenToRender(e,C),t)}unprojectFromRenderScreen(e,t){if(c.multiply(T,this.projectionMatrix,this.viewMatrix),!c.invert(T,T))return null;const r=this.fullViewport;return M[0]=2*(e[0]-r[0])/r[2]-1,M[1]=2*(e[1]-r[1])/r[3]-1,M[2]=2*e[2]-1,M[3]=1,m.transformMat4(M,M,T),0===M[3]?null:(t[0]=M[0]/M[3],t[1]=M[1]/M[3],t[2]=M[2]/M[3],t)}constrainWindowSize(e,t,r,i){const o=e*this.pixelRatio,s=t*this.pixelRatio,n=Math.max(o-r/2,0),a=Math.max(this.fullHeight-s-i/2,0),l=-Math.min(o-r/2,0),c=-Math.min(this.fullHeight-s-i/2,0),u=r-l- -Math.min(this.fullWidth-o-r/2,0),d=i-c- -Math.min(s-i/2,0);return[Math.round(n),Math.round(a),Math.round(u),Math.round(d)]}computeUp(e){1===e?this._computeUpGlobal():this._computeUpLocal()}screenToRender(e,t){const r=e[0]*this.pixelRatio,i=this.fullHeight-e[1]*this.pixelRatio;return t[0]=r,t[1]=i,t}renderToScreen(e,t){const r=e[0]/this.pixelRatio,i=(this.fullHeight-e[1])/this.pixelRatio;t[0]=r,t[1]=i}_computeUpGlobal(){h.subtract(P,this.center,this.eye);const e=h.length(this.center);e<1?(h.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(h.dot(P,this.center))>.9999*h.length(P)*e||(h.cross(this._up,P,this.center),h.cross(this._up,this._up,P),h.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_computeUpLocal(){h.direction(P,this.eye,this.center),Math.abs(P[2])<=.9999&&(h.scale(P,P,P[2]),h.set(this._up,-P[0],-P[1],1-P[2]),h.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())}_compareAndSetView(e,t,i=""){"number"==typeof e[0]&&isFinite(e[0])&&"number"==typeof e[1]&&isFinite(e[1])&&"number"==typeof e[2]&&isFinite(e[2])?h.exactEquals(e,t)||(h.copy(t,e),this._markViewDirty(),i.length&&this.notifyChange(i)):r.getLogger("esri.views.3d.webgl-engine.lib.RenderCamera").warn("RenderCamera vector contains invalid number, ignoring value")}_markViewDirty(){this._viewDirty=!0,this._frustumDirty=!0,this._viewProjectionDirty=!0}_recomputeFrustum(){this._frustumDirty&&(g.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)}_ensureViewClean(){this._viewDirty&&(c.lookAt(this._viewMatrix,this.eye,this.center,this.up),this.notifyChange("_viewMatrix"),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)}};e.__decorate([s.property()],x.prototype,"_viewport",void 0),e.__decorate([s.property()],x.prototype,"_padding",void 0),e.__decorate([s.property()],x.prototype,"_fov",void 0),e.__decorate([s.property()],x.prototype,"_nearFar",void 0),e.__decorate([s.property()],x.prototype,"_viewDirty",void 0),e.__decorate([s.property()],x.prototype,"_viewMatrix",void 0),e.__decorate([s.property()],x.prototype,"_pixelRatio",void 0),e.__decorate([s.property()],x.prototype,"pixelRatio",null),e.__decorate([s.property()],x.prototype,"row",void 0),e.__decorate([s.property()],x.prototype,"column",void 0),e.__decorate([s.property()],x.prototype,"_rows",void 0),e.__decorate([s.property()],x.prototype,"rows",null),e.__decorate([s.property()],x.prototype,"_columns",void 0),e.__decorate([s.property()],x.prototype,"columns",null),e.__decorate([s.property()],x.prototype,"eye",null),e.__decorate([s.property()],x.prototype,"center",null),e.__decorate([s.property()],x.prototype,"_center",void 0),e.__decorate([s.property()],x.prototype,"up",null),e.__decorate([s.property()],x.prototype,"_up",void 0),e.__decorate([s.property()],x.prototype,"viewMatrix",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"viewForward",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"viewUp",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"viewRight",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"nearFar",null),e.__decorate([s.property()],x.prototype,"near",null),e.__decorate([s.property()],x.prototype,"far",null),e.__decorate([s.property()],x.prototype,"viewport",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"screenViewport",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"screenPadding",null),e.__decorate([s.property()],x.prototype,"x",null),e.__decorate([s.property()],x.prototype,"y",null),e.__decorate([s.property()],x.prototype,"width",null),e.__decorate([s.property()],x.prototype,"height",null),e.__decorate([s.property()],x.prototype,"fullWidth",null),e.__decorate([s.property()],x.prototype,"fullHeight",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"_aspect",null),e.__decorate([s.property()],x.prototype,"padding",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"projectionMatrix",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"inverseProjectionMatrix",null),e.__decorate([s.property()],x.prototype,"fov",null),e.__decorate([s.property()],x.prototype,"fovX",null),e.__decorate([s.property()],x.prototype,"fovY",null),e.__decorate([s.property()],x.prototype,"viewInverseTransposeMatrix",null),e.__decorate([s.property({readOnly:!0})],x.prototype,"_projectionMatrixInternal",null),e.__decorate([s.property()],x.prototype,"relativeElevation",void 0),x=S=e.__decorate([l.subclass("esri.views.3d.webgl.RenderCamera")],x);const w=x,M=y.create(),T=u.create(),P=f.create(),I=f.create(),C=o.createRenderScreenPointArray3();return w})},"esri/geometry/support/frustum":function(){define(["exports","../../core/ObjectStack","../../core/libs/gl-matrix-2/math/mat4","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64","./clipRay","./plane","./vectorStacks"],function(e,t,r,i,o,s,n,a,l,c){"use strict";function u(){return[o.create(),o.create(),o.create(),o.create(),o.create(),o.create(),o.create(),o.create()]}function d(e,t){l.fromPoints(t[4],t[0],t[3],e[0]),l.fromPoints(t[1],t[5],t[6],e[1]),l.fromPoints(t[4],t[5],t[1],e[2]),l.fromPoints(t[3],t[2],t[6],e[3]),l.fromPoints(t[0],t[1],t[2],e[4]),l.fromPoints(t[5],t[4],t[7],e[5])}function p(e,t){for(let r=0;r<h;r++)if(!l.clip(e[r],t))return!1;return!0}const h=6,f=[n.fromValues(-1,-1,-1,1),n.fromValues(1,-1,-1,1),n.fromValues(1,1,-1,1),n.fromValues(-1,1,-1,1),n.fromValues(-1,-1,1,1),n.fromValues(1,-1,1,1),n.fromValues(1,1,1,1),n.fromValues(-1,1,1,1)],m=new t.ObjectStack(a.create),y=u();e.computePlanes=d,e.copy=function(e,t){for(let r=0;r<h;r++)l.copy(e[r],t[r]);return e},e.create=function(e){return e?[l.create(e[0]),l.create(e[1]),l.create(e[2]),l.create(e[3]),l.create(e[4]),l.create(e[5])]:[l.create(),l.create(),l.create(),l.create(),l.create(),l.create()]},e.createPoints=u,e.fromMatrix=function(e,t,o,n=y){const a=r.multiply(c.sm4d.get(),t,e);r.invert(a,a);for(let e=0;e<8;++e){const t=s.transformMat4(c.sv4d.get(),f[e],a);i.set(n[e],t[0]/t[3],t[1]/t[3],t[2]/t[3])}d(o,n)},e.intersectClipRay=function(e,t){for(let r=0;r<h;r++){const i=e[r];if(!l.clipInfinite(i,t))return!1}return!0},e.intersectsLineSegment=function(e,t,r){return p(e,a.fromLineSegmentAndDirection(t,r,m.get()))},e.intersectsPoint=function(e,t){for(let r=0;r<h;r++)if(l.signedDistance(e[r],t)>0)return!1;return!0},e.intersectsRay=function(e,t){return p(e,a.fromRay(t,m.get()))},e.intersectsSphere=function(e,t){for(let r=0;r<h;r++){const i=e[r];if(i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]>=t[3])return!1}return!0},e.numPlanes=h,e.numPoints=8,e.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec32","./ray"],function(e,t,r,i){"use strict";function o(e){return e?{ray:i.create(e.ray),c0:e.c0,c1:e.c1}:{ray:i.create(),c0:0,c1:Number.MAX_VALUE}}function s(e,t,r,s=o()){return i.copy(e,s.ray),s.c0=t,s.c1=r,s}function n(e,t,i){return r.add(i,e.ray.origin,r.scale(i,e.ray.direction,t))}const a=new t.ObjectStack(()=>o());e.copy=function(e,t=o()){return s(e.ray,e.c0,e.c1,t)},e.create=o,e.fromLineSegmentAndDirection=function(e,t,s=o()){const n=r.length(e.vector);return i.fromValues(e.origin,t,s.ray),s.c0=0,s.c1=n,s},e.fromRay=function(e,t=o()){return i.copy(e,t.ray),t.c0=0,t.c1=Number.MAX_VALUE,t},e.fromValues=s,e.getAt=n,e.getEnd=function(e,t){return n(e,e.c1,t)},e.getStart=function(e,t){return n(e,e.c0,t)},e.wrap=function(e,t,r){const i=a.get();return i.ray=e,i.c0=t,i.c1=r,i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/fov":function(){define(["exports"],function(e){"use strict";e.fovd2fovx=function(e,t,r){return 2*Math.atan(t*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},e.fovd2fovy=function(e,t,r){return 2*Math.atan(r*Math.tan(.5*e)/Math.sqrt(t*t+r*r))},e.fovx2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/t)},e.fovy2fovd=function(e,t,r){return 2*Math.atan(Math.sqrt(t*t+r*r)*Math.tan(.5*e)/r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DepthRange":function(){define(["exports"],function(e){"use strict";class t{constructor(e=1/0,t=-1/0){this.near=e,this.far=t}set(e,t){this.near=e,this.far=t}union(e){null!=e&&(this.near=Math.min(this.near,e.near),this.far=Math.max(this.far,e.far))}within(e){return this.near<=e&&e<=this.far}equals(e){return this.near===e.near&&this.far===e.far}static{this.zero=new t(0,0)}static{this.infinite=new t}}e.DepthRange=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/ray","../../webgl/RenderCamera","./HUDIntersectorResult","./IntersectorInterfaces","./IntersectorResult","./verticalOffsetUtils"],function(e,t,r,i,o,s,n,a,l){"use strict";const c=1e-5;function u(e,t){return(t??-Number.MAX_VALUE)-(e??-Number.MAX_VALUE)}class d{constructor(){this.min=new a.IntersectorResult(i.create()),this.max=new a.IntersectorResult(i.create()),this.hud={min:new s.HUDIntersectorResult(i.create()),max:new s.HUDIntersectorResult(i.create()),all:new Array},this.ground=new a.IntersectorResult(i.create()),this.all=[]}init(e){this.min.init(e),this.max.init(e),this.ground.init(e),this.all.length=0,this.hud.min.init(e),this.hud.max.init(e),this.hud.all.length=0}}e.Intersector=class{constructor(e){this.options=new n.IntersectorOptions,this._results=new d,this.transform=new l.IntersectorTransform,this.camera=new o,this.tolerance=c,this.verticalOffset=null,this._ray=i.create(),this._rayEnd=r.create(),this._rayBeginTransformed=r.create(),this._rayEndTransformed=r.create(),this.viewingMode=e??1}get results(){return this._results}get ray(){return this._ray}get rayBegin(){return this._ray.origin}get rayEnd(){return this._rayEnd}reset(e,t,r){this.resetWithRay(i.fromPoints(e,t,this._ray),r)}resetWithRay(e,r){this.camera=r,e!==this._ray&&i.copy(e,this._ray),0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null,t.add(this._rayEnd,this._ray.origin,this._ray.direction),this._results.init(this._ray)}intersect(e=null,t,r,i,o){this.point=t,this.filterPredicate=i,this.tolerance=r??c;const s=l.getVerticalOffsetObject3D(this.verticalOffset);if(e&&e.length>0){const t=o?e=>{o(e)&&this.intersectObject(e)}:e=>{this.intersectObject(e)};for(const r of e){const e=r.getSpatialQueryAccelerator?.();null!=e?(null!=s?e.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,t,s):e.forEachAlongRay(this._ray.origin,this._ray.direction,t),this.options.selectionMode&&this.options.hud&&e.forEachDegenerateObject(t)):r.objects.forEach(e=>t(e))}}this.sortResults()}intersectObject(e){const r=e.geometries;if(!r)return;const i=e.effectiveTransformation,o=l.getVerticalOffsetObject3D(this.verticalOffset);for(const s of r){if(!s.visible)continue;const{material:r,id:n}=s;if(!r.visible)continue;this.transform.setAndInvalidateLazyTransforms(i,s.transformation),t.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse),t.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const a=this.transform.transform;null!=o&&(o.objectTransform=this.transform),r.intersect(s,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(t,r,i,o)=>this.handleObjectIntersection({object:e,geometryId:n,primitiveIndex:i},t,r,a,o))}}handleObjectIntersection(e,t,r,i,o){if(t<0||null!=this.filterPredicate&&!this.filterPredicate(this._ray.origin,this._rayEnd,t))return;const n=o?this._results.hud:this._results;e=o?new s.HUDTarget(e,o):e;const l=o?i=>i.set(1,e,t,r):o=>o.set(0,e,t,r,i);if((null==n.min.distance||t<n.min.distance)&&l(n.min),0!==this.options.store&&(null==n.max.distance||t>n.max.distance)&&l(n.max),2===this.options.store)if(o){const e=new s.HUDIntersectorResult(this._ray);l(e),this._results.hud.all.push(e)}else{const e=new a.IntersectorResult(this._ray);l(e),this._results.all.push(e)}}sortResults(e=this._results.all){e.sort((e,t)=>e.distance!==t.distance?(e.distance??0)-(t.distance??0):e.drapedLayerOrder!==t.drapedLayerOrder?u(e.drapedLayerOrder,t.drapedLayerOrder):u(e.renderPriority,t.renderPriority))}},e.defaultTolerance=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/HUDIntersectorResult":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64","./IntersectorResult","./ObjectTarget"],function(e,t,r,i){"use strict";class o extends r.IntersectorResult{constructor(){super(...arguments),this.intersector=1}}class s extends i.ObjectTarget{constructor(e,r){super(e.object,e.geometryId,e.primitiveIndex),this.center=t.clone(r)}}e.HUDIntersectorResult=o,e.HUDTarget=s,e.isHUDIntersectorResult=function(e){return r.isValidIntersectorResult(e)&&1===e.intersector&&!!e.target&&"center"in e.target},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ObjectTarget":function(){define(["exports"],function(e){"use strict";e.ObjectTarget=class{constructor(e,t,r){this.object=e,this.geometryId=t,this.primitiveIndex=r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(e){"use strict";e.IntersectorOptions=class{constructor(){this.verticalOffset=0,this.selectionMode=!1,this.hud=!0,this.selectOpaqueTerrainOnly=!0,this.invisibleTerrain=!1,this.backfacesTerrain=!0,this.isFiltered=!1,this.filteredLayerViewUids=[],this.store=2,this.normalRequired=!0,this.excludeLabels=!1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/viewingModeUtils":function(){define(["exports","../../../chunks/cameraUtilsPlanar","../../../chunks/cameraUtilsSpherical"],function(e,t,r){"use strict";function i({state:e}){return e.isGlobal?r.cameraUtilsSpherical:t.cameraUtilsPlanar}e.directionToHeadingTilt=function(e,t,r,o,s){return i(e).directionToHeadingTilt(t,r,o,s)},e.viewModeDependentUtil=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsPlanar":function(){define(["exports","../core/mathUtils","../core/libs/gl-matrix-2/math/mat4","../core/libs/gl-matrix-2/factories/mat4f64","../core/libs/gl-matrix-2/factories/vec2f64","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","../geometry/Extent","../geometry/Polygon","../geometry/projection/projectPointToVector","../geometry/projection/projectVectorToVector","../geometry/support/coordsUtils","../geometry/support/polygonExtentClipping","../geometry/support/ray","../views/3d/support/cameraUtilsInternal"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f){"use strict";const m=n.fromValues(0,1,0),y=n.fromValues(0,0,1),g=i.create(),b=n.create(),_=n.create();function v(e,i,o,n=f.createDirectionUp()){const{direction:a,up:l}=n;return r.fromZRotation(g,-t.deg2rad(i)),r.rotateX(g,g,t.deg2rad(o)),s.transformMat4(a,y,g),s.scale(a,a,-1),s.transformMat4(l,m,g),n}function S(e,t,r,i){return f.directionToHeadingTilt(t,r,i,y,m)}function x(e,t,r,i){const o=v(0,r,i),a=n.create();return s.scale(a,o.direction,-t),s.add(a,a,e),{up:o.up,eye:a,heading:r,tilt:i}}function w(e){return t.rad2deg(e)}function M(e){return t.deg2rad(e)}function T(e,t,r,i,o){const s=e.renderSpatialReference,n=e.spatialReference??t.spatialReference;return c.projectPointToVector(t,b,s),c.projectPointToVector(t,_,s),b[0]-=r/2,_[0]+=r/2,b[1]-=i/2,_[1]+=i/2,u.projectVectorToVector(b,s,b,n),u.projectVectorToVector(_,s,_,n),o?(o.xmin=b[0],o.ymin=b[1],o.xmax=_[0],o.ymax=_[1],o.spatialReference=n):o=new a(b[0],b[1],_[0],_[1],n),o}function P(e,t){const r=e.frustum,{renderCoordsHelper:i}=e,n=i.getAltitude(t),a=e.spatialReference,c=e.state.camera.eye,u=[],m=r.planes[5];for(let e=0;e<4;e++){const t=r.lines[e];i.intersectInfiniteManifold(h.wrap(t.origin,t.direction),n,C)||I(C,r,i,t.endpoint,n),f.clampLineSegmentToPlane(C,c,C,m),u.push(o.fromValues(C[0],C[1]))}return function(e,t,r){const i=e.map(e=>(s.set(C,e[0],e[1],0),t.fromRenderCoords(C,C,r),[C[0],C[1]]));return i.length<=2?new l({spatialReference:r}):(i.push(i[0].slice()),d.isClockwise(i)||i.reverse(),new l({rings:[i],spatialReference:r}))}(p.clipPolygonToExtent(u,i.extent),i,a)}function I(e,t,r,i,o){const n=t.lines[11].direction,a=(o-r.getAltitude(i))/n[2];s.scaleAndAdd(e,i,n,a)}const C=n.create(),O=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:S,eyeForCenterWithHeadingTilt:x,eyeTiltToLookAtTilt:M,headingTiltToDirectionUp:v,lookAtTiltToEyeTilt:w,toArea:P,toExtent:T},Symbol.toStringTag,{value:"Module"}));e.cameraUtilsPlanar=O,e.directionToHeadingTilt=S,e.eyeForCenterWithHeadingTilt=x,e.eyeTiltToLookAtTilt=M,e.headingTiltToDirectionUp=v,e.lookAtTiltToEyeTilt=w,e.toArea=P,e.toExtent=T})},"esri/geometry/support/polygonExtentClipping":function(){define(["exports","../../core/libs/gl-matrix-2/math/vec2","../../core/libs/gl-matrix-2/factories/vec2f64"],function(e,t,r){"use strict";function i(e,t,i,n){const a=function(e,t){const r=0===t||2===t?0:1,i=e[t],o=0===t||1===t?1:-1,s=0===r?1:0;return(e,t,n)=>{if(t[r]<i&&n[r]<i)return 1===o?0:1;if(t[r]>i&&n[r]>i)return 1===o?1:0;const a=(n[s]-t[s])/(n[r]-t[r]),l=t[s]+a*(i-t[r]);return e[r]=i,e[s]=l,(t[r]<i?1:-1)*o>0?2:3}}(i,n);if(e.length=0,t.length){1===a(s,t[0],t[0])&&o(e,t[0]);for(let i=0;i<t.length;i++){const n=t[i===t.length-1?0:i+1];switch(a(s,t[i],n)){case 1:o(e,n);break;case 3:o(e,r.clone(s));break;case 2:o(e,r.clone(s)),o(e,n)}}}}function o(e,r){0!==e.length&&t.equals(e.at(-1),r)||e.push(r)}const s=r.create();e.clipPolygonToExtent=function(e,t){const r=[],o=[];return i(r,e,t,0),i(o,r,t,1),i(r,o,t,2),i(o,r,t,3),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/lineSegment","../../../geometry/support/plane"],function(e,t,r,i,o,s){"use strict";const n=i.create(),a=i.create(),l=i.create();e.clampLineSegmentToPlane=function(e,t,i,n){r.subtract(l,i,t),s.intersectLineSegment(n,o.wrap(t,l),e)||e===i||r.copy(e,i)},e.createDirectionUp=function(){return{direction:i.create(),up:i.create()}},e.directionToHeadingTilt=function(e,i,o,s,l){let c=r.normalize(n,e),u=r.dot(c,s);const d=u>0;u=Math.abs(u),u>.99&&(u=Math.abs(r.dot(i,s)),u<.99?(r.copy(c,i),d&&r.scale(c,c,-1)):c=null);let p=0;if(c){r.scale(a,s,r.dot(s,c)),r.subtract(c,c,a);const e=r.dot(c,l)/(r.length(c)*r.length(l));r.cross(a,c,l),p=(r.dot(a,s)>0?1:-1)*t.rad2deg(t.acosClamped(e))}const h=t.rad2deg(t.acosClamped(-r.dot(s,e)/r.length(e)));return o?(o.heading=p,o.tilt=h,o):{heading:p,tilt:h}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsSpherical":function(){define(["exports","../core/Cyclical","../core/mathUtils","../core/libs/gl-matrix-2/math/mat4","../core/libs/gl-matrix-2/factories/mat4f64","./vec32","../core/libs/gl-matrix-2/factories/vec3f64","./vec42","../core/libs/gl-matrix-2/factories/vec4f64","../core/libs/gl-matrix-2/math/common","../geometry/ellipsoidUtils","../geometry/Extent","../geometry/Polygon","../geometry/SpatialReference","../geometry/support/coordsUtils","../geometry/support/lineSegment","../geometry/support/plane","../geometry/support/ray","./sphere","../geometry/support/webMercatorUtils","../views/3d/state/Frustum","../views/3d/state/NearFarHeuristic","../views/3d/state/utils/viewUtils","../views/3d/support/cameraUtilsInternal","../views/3d/support/earthUtils","../views/3d/support/mathUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M,T){"use strict";const P=n.fromValues(0,0,1),I=s.normalize(n.create(),n.fromValues(1,1,1)),C=new t.Cyclical(-180,180),O=o.create(),F=n.create(),A=n.create();function R(e,t,o,n=w.createDirectionUp()){s.cross(F,e,P),0===s.dot(F,F)&&s.cross(F,e,I),i.fromRotation(O,-r.deg2rad(t),e),i.rotate(O,O,-r.deg2rad(o),F);const{up:a,direction:l}=n;return s.cross(a,F,e),s.normalize(a,a),s.transformMat4(a,a,O),s.normalize(l,e),s.negate(l,l),s.transformMat4(l,l,O),n}function D(e,t,r,i){const o=F,n=A;return s.normalize(o,e),s.cross(A,o,P),0===s.dot(A,A)&&s.cross(A,o,I),s.cross(n,A,o),w.directionToHeadingTilt(t,r,i,o,n)}function E(e,t,i,o){const a={eye:n.create(),up:null,tilt:o,heading:i},l=F;l[0]=e[0],l[1]=e[2],l[2]=-e[1];const c=t,u=r.deg2rad(i),d=r.deg2rad(o),p=Math.sin(u),h=Math.cos(u),f=Math.sin(d),m=Math.cos(d),y=s.length(l);let g;if(Math.abs(d)<1e-8)g=c+y;else{const e=y/f,t=r.asinClamped(c/e),i=Math.PI-d-t;g=e*Math.sin(i)}const b=m*c,_=c*c*(f*f),v=h*h*_,S=g-b,x=S*S,w=v*(v+x-l[1]*l[1]);if(w<0)return s.scale(a.eye,l,g/y),a.tilt=0,L(a,e);const M=Math.sqrt(w),T=l[1]*S,P=v+x;let I;if(I=h>0?-M+T:M+T,Math.abs(P)<1e-8)return y<1e-8?(a.eye[0]=0,a.eye[1]=0,a.eye[2]=c):s.scale(a.eye,l,g/y),a.tilt=0,V(a.eye),L(a,e);a.eye[1]=I/P;const C=p*p*_,O=f*c,A=h*O*a.eye[1],R=a.eye[1]*a.eye[1],D=1-R,E=Math.sqrt(D),z=v*R+C-2*A*E*S+D*x;return Math.abs(z)<1e-8?(s.scale(a.eye,l,g/y),a.tilt=0,V(a.eye),L(a,e)):(a.eye[0]=(D*(g*l[0]-b*l[0])-O*E*(l[0]*a.eye[1]*h+l[2]*p))/z,a.eye[2]=(D*(g*l[2]-b*l[2])-O*E*(l[2]*a.eye[1]*h-l[0]*p))/z,s.scale(a.eye,a.eye,g),V(a.eye),L(a,e))}function V(e){const t=e[1];e[1]=-e[2],e[2]=t}function L(e,t){const r=R(t,e.heading,e.tilt);return e.up=r.up,e}function z(e,t,i){const o=s.length(t),n=Math.sqrt(i*i+o*o-2*i*o*Math.cos(Math.PI-e)),a=r.asinClamped(i/(n/Math.sin(e)));return r.rad2deg(e-a)}function U(e,t,i){const o=r.deg2rad(e),n=s.length(t);return r.asinClamped(i/(n/Math.sin(o)))+o}function j(e,i,o,s,n){let a,l,c,p;const f=i.latitude,m=u.getReferenceEllipsoid(e.spatialReference).radius,y=i.longitude,g=M.getLonDeltaForDistance(f,o,m)/2;a=y-g,l=y+g;const b=r.deg2rad(f),v=(1+Math.sin(b))/(1-Math.sin(b)),S=(v+1)*Math.tan(s/m/2),x=S*S;function w(e){const r=Math.PI/2;return(e=t.cyclical2PI.normalize(e,-r))>r&&(e=Math.PI-e),e}if(c=1.5*Math.PI-2*Math.atan(.5*(S+Math.sqrt(4*v+x))),p=c+s/m,c=w(c),p=w(p),p<c){const e=p;p=c,c=e}if(c=Math.max(r.rad2deg(c),-90),p=Math.min(r.rad2deg(p),90),l=C.monotonic(a,l),l-a>180){const e=(l-a-180)/2;a+=e,l-=e}const T=e.spatialReference&&e.spatialReference.isGeographic?e.spatialReference:h.WGS84;return n?(n.xmin=a,n.ymin=c,n.xmax=l,n.ymax=p,n.spatialReference=T):n=new d(a,c,l,p,T),e.spatialReference&&e.spatialReference.isWebMercator&&_.geographicToWebMercator(n,!1,n),n}function B(e,t){const{renderCoordsHelper:i}=e,o=e.state.camera.clone(),l=new v.Frustum(i);o.near=S.minNearDistanceInMeters,l.update(o);const u=i.getAltitude(t),d=e.spatialReference,h=i.referenceEllipsoid.radius,m=o.eye,_=1+s.distance(m,t)/(h+u),M=Math.sqrt(_*_-1),{minCurvature:P,maxCurvature:I,minSamples:C,maxSamples:O}=k,F=function(e){const{renderCoordsHelper:t,state:{camera:r}}=e,{center:i,eye:o}=r,s=Math.abs(t.getAltitude(i)),n=Math.abs(Math.PI/2-x.viewAngle(t,i,o));return b.fromRadius(J,t.referenceEllipsoid.radius+s),b.cameraFrustumCoverage(J,n,r.distance,r.fovY)}(e),A=r.clamp((M-P)/(I-P),0,1),R=Math.round(r.lerp(C,O,A)),D=o.aboveGround,E=l.planes[5],V=[],L=y.fromPositionAndNormal(n.ZEROS,q,y.create()),z=y.fromPositionAndNormal(n.ZEROS,G,y.create());a.set(Z,0,0,0,0);const U=e=>{};for(let e=0;e<4;e++){const t=1===e&&!D||3===e&&D?1-F:0,o=1===e&&D||3===e&&!D?F:1,a=l.lines[e],c=l.lines[3===e?0:e+1];for(let l=0;l<R;l++){const d=l/R,p=1===e?1-(1-d)**2:3===e?d**2:d,h=0===l?0:r.lerp(t,o,p),f=s.lerp(W,a.origin,c.origin,h),b=T.slerp(a.direction,c.direction,h,H);i.intersectManifoldClosestSilhouette(g.wrap(f,b),u,$),w.clampLineSegmentToPlane($,m,$,E),V.push(n.clone($)),0!==V.length&&U(s.sqrDist(V.at(-1),$));const _=(y.isPointInside(L,$)?1:0)|(y.isPointInside(z,$)?2:0);Z[_]=1}}V.length>2&&s.sqrDist(V[0],V.at(-1));const j=a.squaredLength(Z)>1?function(e,t){const r=[];for(const i of e)r.push(...N(i,t));return r}(N(V,L),z):[V],B=function(e,t,r){const i=2*c.getEpsilon();return e.map(e=>{const o=[];let s=!1;for(const n of e)t.fromRenderCoords(n,$,r),Math.abs(n[0])<i&&Math.abs(n[1])<i?(o.push([null,$[1]]),o.push([null,$[1]]),s=!0):o.push([$[0],$[1]]);if(s)for(let e=0;e<o.length;e++){const t=o[e];if(null!=t[0])continue;const r=o[e+1],i=o.at(0===e?-1:e-1);t[0]=i[0],e++;const s=o.at(e===o.length-1?0:e+1);r[0]=s[0]}return o.push(o[0]),f.isClockwise(o)||o.reverse(),o})}(j,i,d);return new p({rings:B,spatialReference:d})}function N(e,t){const r=[],i=[],o=c.getEpsilon();for(let a=0;a<e.length;a++){const l=e[a],c=a===e.length-1?e[0]:e[a+1],u=m.fromPoints(l,c,Y),d=y.intersectLineOrRay(t,u.origin,u.vector,0,$);switch(d){case 2:r.push(l);break;case 3:i.push(l);break;case 0:case 1:{const[e,a,c]=0===d?[1,r,i]:[-1,i,r],u=y.getNormal(t),p=s.scaleAndAdd(n.create(),$,u,e*o),h=s.scaleAndAdd(n.create(),$,u,e*-o);a.push(l),a.push(p),c.push(h)}}}const a=[];return r.length&&a.push(r),i.length&&a.push(i),a}const k={minCurvature:r.deg2rad(5),maxCurvature:r.deg2rad(50),minSamples:1,maxSamples:6},q=n.fromValues(1,0,0),G=n.fromValues(0,1,0),H=n.create(),W=n.create(),$=n.create(),J=b.create(),Y=m.create(),Z=l.create(),Q=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:D,eyeForCenterWithHeadingTilt:E,eyeTiltToLookAtTilt:U,headingTiltToDirectionUp:R,lookAtTiltToEyeTilt:z,toArea:B,toExtent:j},Symbol.toStringTag,{value:"Module"}));e.cameraUtilsSpherical=Q,e.directionToHeadingTilt=D,e.eyeForCenterWithHeadingTilt=E,e.eyeTiltToLookAtTilt=U,e.headingTiltToDirectionUp=R,e.lookAtTiltToEyeTilt=z,e.toArea=B,e.toExtent=j})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/support/frustum"],function(e,t,r,i){"use strict";class o{get planes(){return this.frustum}get points(){return this._points}get mutablePoints(){return this._points}get direction(){return this._direction}get origin(){return this._origin}constructor(e){this.renderCoordsHelper=e,this.frustum=i.create(),this._points=i.createPoints(),this.lines=new Array(12),this._origin=r.create(),this._direction=r.create(),this._altitude=null;for(let e=0;e<12;e++)this.lines[e]={origin:null,direction:r.create(),endpoint:null}}update(e){i.fromMatrix(e.viewMatrix,e.projectionMatrix,this.frustum,this._points),t.copy(this._origin,e.eye),t.copy(this._direction,e.viewForward),this._altitude=this.renderCoordsHelper.getAltitude(this._origin),this._updateLines()}updatePoints(e){for(let r=0;r<this._points.length;r++)t.copy(this._points[r],e[r]);i.computePlanes(this.frustum,this._points),this._updateLines()}get altitude(){return this._altitude}intersectsSphere(e){return i.intersectsSphere(this.frustum,e)}intersectsRay(e){return i.intersectsRay(this.frustum,e)}intersectsLineSegment(e,t){return i.intersectsLineSegment(this.frustum,e,t)}intersectsPoint(e){return i.intersectsPoint(this.frustum,e)}_updateLines(){const e=this._points;for(let t=0;t<4;t++){const r=t+4;s(this.lines[t],e[t],e[r]),s(this.lines[t+4],e[t],3===t?e[0]:e[t+1]),s(this.lines[t+8],e[r],3===t?e[4]:e[r+1])}}static{this.planePointIndices=i.planePointIndices}static{this.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]]}}function s(e,r,i){e.origin=r,e.endpoint=i,t.direction(e.direction,r,i)}e.Frustum=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/NearFarHeuristic":function(){define(["exports","../../../core/mathUtils","../../../core/unitUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/ellipsoidUtils","../../../geometry/Extent","../../../geometry/support/ray","../../../chunks/sphere","../environment/atmosphereUtils","../webgl-engine/lib/DepthRange"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";class d{constructor(e,t){this._elevationProvider=e,this._referenceEllipsoid=s.getReferenceEllipsoid(t),this._unitInMeters=r.getMetersPerUnitForSR(t,this._referenceEllipsoid.metersPerDegree)}compute(e,r,o,s){const{eye:a,center:l}=e;let c=a[2]*this._unitInMeters;const u=c,d=c-s,p=this._elevationProvider?.visibleElevationBounds;p&&(c=d>=0?u-this._unitInMeters*p.min:this._unitInMeters*p.max-u),r??=new n({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});const f={x:r.xmax-r.xmin,y:r.ymax-r.ymin,z:4*Math.max(r.xmax-r.xmin,r.ymax-r.ymin)},m=Math.max(f.x,f.y,f.z);i.subtract(x,l,a),S[0]=x[0]>0?r.xmax:r.xmin,S[1]=x[1]>0?r.ymax:r.ymin,S[2]=x[2]>0?m/2:-m/2,i.subtract(S,S,a),i.normalize(x,x);const g=1.1*i.dot(S,x)*this._unitInMeters,b=Math.sqrt(c*(c+2*this._referenceEllipsoid.radius)),M=Math.max(r.xmax-r.xmin,r.ymax-r.ymin),T=M*_*this._unitInMeters,P=M*v*this._unitInMeters,I=t.clamp((c-P)/(T-P),0,1)**3,C=Math.min(t.lerp(b,g,I),b)*Math.max(Math.log(Math.abs(d)),1);return h(Math.min(C,Math.max(34064e4,m))/this._unitInMeters,y,this._unitInMeters,w)}}class p{constructor(e,t){this._elevationProvider=e,this._referenceEllipsoid=s.getReferenceEllipsoid(t)}compute(e,r,o,s){const{eye:n}=e,d=i.length(n),p=d-this._referenceEllipsoid.radius,_=this._referenceEllipsoid.radius+Math.min(0,s),v=Math.abs(p-s),P=Math.max(v,Math.abs(p)),I=this._elevationProvider?.visibleElevationBounds.max??0,C=c.computeInnerAltitudeFade(P),O=Math.sqrt(P*(P+2*_)),F=d+this._referenceEllipsoid.radius,A=1.2*t.lerp(O,F,C),R=(Math.log(P)-f)/(m-f);h(A,t.clamp(y-R*(y-g),g,y),1,w);const D=this._referenceEllipsoid.radius+I,E=this._referenceEllipsoid.radius+this._referenceEllipsoid.atmosphereHeight,V=Math.max(D,E),L=d-V;if(C>0&&L>b){const r=i.normalize(S,i.scale(S,e.eye,-1)),s=i.normalize(x,e.viewForward),n=t.acosClamped(i.dot(r,s)),c=.5*e.fovY,d=Math.cos(c);let p=u.DepthRange.infinite.near;if(n<=c)p=L*d;else{const t=i.normalize(S,e.viewUp),r=Math.tan(c),o=i.scale(S,t,r),n=i.normalize(S,i.subtract(S,s,o)),u=a.fromValues(e.eye,n,T),h=l.fromRadius(M,V);if(l.intersectRay(h,u,S)){const t=i.subtract(S,S,e.eye);p=i.length(t)*d}}const h=.99*Math.min(o.near,p);if(h<u.DepthRange.infinite.near&&h>w.near){const e=t.lerp(w.near,h,C);w.near=e}}return w}}function h(e,t,r,i){const o=b/r,s=e/t;return s>o?(i.far=e,i.near=s):(i.near=o,i.far=i.near*t),i}const f=7.983,m=16.994,y=2e4,g=100,b=2,_=.001,v=1e-4,S=o.create(),x=o.create(),w={near:0,far:0},M=l.create(),T=a.create();e.createNearFarHeuristic=function(e,t,r){return 1===e?new p(t,r):new d(t,r)},e.minNearDistanceInMeters=b,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,r){"use strict";const i=1e5,o=r.fromValues(parseFloat(Number(5802e-9).toFixed(6)),parseFloat(Number(13558e-9).toFixed(6)),parseFloat(Number(331e-7).toFixed(6))),s=r.fromValues(3*parseFloat(Number(65e-8).toFixed(6)),3*parseFloat(Number(1881e-9).toFixed(6)),3*parseFloat(Number(85e-9).toFixed(6))),n=r.fromValues(parseFloat(Number(o[0]+s[0]).toFixed(6)),parseFloat(Number(o[1]+s[1]).toFixed(6)),parseFloat(Number(o[2]+s[2]).toFixed(6)));e.betaCombined=n,e.betaMie=3996e-9,e.betaOzone=s,e.betaRayleigh=o,e.computeInnerAltitudeFade=function(e){return t.clamp((e-i)/9e5,0,1)},e.innerAtmosphereDepth=1e4,e.innerAtmosphereFadeStart=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,r,i){"use strict";const o=i.create(),s=i.create();e.viewAngle=function(e,i,n){e.worldUpAtPosition(i,o),r.subtract(s,n,i);const a=r.length(s);return 0===a?0:t.acosClamped(r.dot(s,o)/a)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/ellipsoidUtils","../../../geometry/Point"],function(e,t,r,i){"use strict";function o(e,t,r){if(null==t.longitude||null==t.latitude||null==r.longitude||null==r.latitude)throw new Error("Invalid points: no lon/lat");return s(e,t.longitude,t.latitude,r.longitude,r.latitude)}function s(e,r,i,o,s){const n=t.deg2rad(i),a=t.deg2rad(s),l=n-a,c=t.deg2rad(r)-t.deg2rad(o),u=Math.sin(l/2),d=Math.sin(c/2),p=2*t.asinClamped(Math.sqrt(u*u+Math.cos(n)*Math.cos(a)*d*d))*e;return Math.round(1e4*p)/1e4}function n(e,t){let r=e/15;return t||(r=Math.round(r)),r}e.getGreatCircleDistance=s,e.getGreatCircleDistanceFromPoints=o,e.getGreatCircleSpanAt=function(e,t,s){const n=t.spatialReference,a=r.getReferenceEllipsoid(n),l=new i(t.x,e.y,n),c=new i(s.x,e.y,n),u=new i(e.x,t.y,n),d=new i(e.x,s.y,n);return{lon:o(a.radius,l,c),lat:o(a.radius,u,d)}},e.getLonDeltaForDistance=function(e,r,i){const o=r/i,s=t.deg2rad(e),n=Math.sin(o/2),a=Math.cos(s),l=2*t.asinClamped(Math.sqrt(n*n/(a*a)));return t.rad2deg(l)},e.longitudeToTimezone=n,e.positionToTimezoneInfo=function(e,t){const r=e?.[0];if(null==r)return null;t||(t={hours:0,minutes:0,seconds:0}),t.hours=n(r,!0);const i=t.hours%1;t.hours-=i,t.minutes=60*i;const o=t.minutes%1;return t.minutes-=o,t.seconds=Math.round(60*o),t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl/RenderNode":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../webgl"],function(e,t,r,i,o,s,n,a){"use strict";return e.default=class extends r{constructor(e){super(e),this.view=null,this.consumes={required:[]},this.produces=a.RenderCategory.COMPOSITE,this.requireGeometryDepth=!1,this._dirty=!0}initialize(){this.addHandles([o.watch(()=>this.view.ready,e=>{e&&this.view.stage?.renderer.addRenderNode(this)},o.initial)])}destroy(){this.view.stage?.renderer?.removeRenderNode(this)}precompile(){}render(){throw new i("RenderNode:render-function-not-implemented","render() is not implemented.")}get camera(){return this.view.state.camera.clone()}get sunLight(){return this.bindParameters.lighting.legacy}get gl(){return this.view.stage.renderView.renderingContext.gl}get techniques(){return this.view.stage.renderView.techniques}acquireOutputFramebuffer(){const e=this._frameBuffer?.getTexture()?.descriptor,t=this.view.stage.renderer.fboCache.acquire(e?.width??640,e?.height??480,this.produces);return t.fbo?.initializeAndBind(),t}bindRenderTarget(){return this._frameBuffer?.fbo?.initializeAndBind(),this._frameBuffer}requestRender(e){1===e&&this.view.stage?.renderView.requestRender(e),this._dirty=!0}resetWebGLState(){this.renderingContext.resetState(),this.renderingContext.bindFramebuffer(this._frameBuffer?.fbo)}get fboCache(){return this.view.stage.renderer.fboCache}get bindParameters(){return this.renderContext.bind}get renderingContext(){return this.view.stage.renderView.renderingContext}get renderContext(){return this.view.stage?.renderer.renderContext}updateAnimation(e){return!!this._dirty&&(this._dirty=!1,!0)}doRender(e){this._frameBuffer=e.find(({name:e})=>e===this.produces);try{return this.render(e)}finally{this._frameBuffer=null}}},t.__decorate([s.property({constructOnly:!0})],e.default.prototype,"view",void 0),t.__decorate([s.property({constructOnly:!0})],e.default.prototype,"consumes",void 0),t.__decorate([s.property()],e.default.prototype,"produces",void 0),t.__decorate([s.property({readOnly:!0})],e.default.prototype,"techniques",null),e.default=t.__decorate([n.subclass("esri.views.3d.webgl.RenderNode")],e.default),e.default})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceConstants":function(){define(["exports"],function(e){"use strict";e.distanceFadeEnd=5e5,e.distanceFadeStart=3e5,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOBlurTechnique":function(){define(["require","exports","../../core/shaderTechnique/ReloadableShaderModule","../../core/shaderTechnique/ShaderTechnique","../../lib/DefaultVertexBufferLayouts","../../../../../chunks/SSAOBlur.glsl","../../../../webgl/renderState"],function(e,t,r,i,o,s,n){"use strict";class a extends i.ShaderTechnique{constructor(t,i){super(t,i,new r.ReloadableShaderModule(s.SSAOBlur,()=>new Promise((t,r)=>e(["../../shaders/SSAOBlur.glsl"],t,r))),o.Pos2Locations)}initializePipeline(){return n.makePipelineState({colorWrite:n.defaultColorWrite})}}t.SSAOBlurTechnique=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexAttributeLocations","../../../webgl/VertexElementDescriptor"],function(e,t,r,i){"use strict";const o=[new i.VertexElementDescriptor("position",3,t.DataType.FLOAT,0,12)],s=[new i.VertexElementDescriptor("position",2,t.DataType.FLOAT,0,8)],n=r.fromLayout(s),a=[new i.VertexElementDescriptor("position",2,t.DataType.FLOAT,0,12),new i.VertexElementDescriptor("uv0",2,t.DataType.HALF_FLOAT,8,12)],l=[new i.VertexElementDescriptor("position",2,t.DataType.FLOAT,0,16),new i.VertexElementDescriptor("uv0",2,t.DataType.FLOAT,8,16)];e.NoVertex=[],e.Pos2=s,e.Pos2Locations=n,e.Pos2TexF16=a,e.Pos2TexF32=l,e.Pos3=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAOBlur.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl","../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/webgl/ShaderBuilder"],function(e,t,r,i,o,s,n,a,l){"use strict";function c(){const e=new l.ShaderBuilder,c=e.fragment;return e.include(t.ScreenSpacePass),c.include(r.ReadDepth),c.uniforms.add(new a.Texture2DPassUniform("depthMap",e=>e.depthTexture),new n.Texture2DDrawUniform("tex",e=>e.colorTexture),new i.Float2DrawUniform("blurSize",e=>e.blurSize),new o.FloatPassUniform("projScale",(e,t)=>{const r=t.camera.distance;return r>5e4?Math.max(0,e.projScale-(r-5e4)):e.projScale})),c.code.add(s.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${s.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `),e.outputs.add("fragBlur","float"),c.main.add(s.glsl`
    float b = 0.0;
    float w_total = 0.0;

    float center_d = linearDepthFromTexture(depthMap, uv);

    float sharpness = -0.05 * projScale / center_d;
    for (int r = -${s.glsl.int(4)}; r <= ${s.glsl.int(4)}; ++r) {
      float rf = float(r);
      vec2 uvOffset = uv + rf * blurSize;
      blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
    }
    fragBlur = b / w_total;`),e}const u=Object.freeze(Object.defineProperty({__proto__:null,build:c},Symbol.toStringTag,{value:"Module"}));e.SSAOBlur=u,e.build=c})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports","../shaderModules/glsl"],function(e,t){"use strict";e.ScreenSpacePass=function(e,r=!0){e.attributes.add("position","vec2"),r&&e.varyings.add("uv","vec2"),e.vertex.main.add(t.glsl`
      gl_Position = vec4(position, 0.0, 1.0);
      ${r?t.glsl`uv = position * 0.5 + vec2(0.5);`:""}
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../shaderModules/Float2BindUniform","../../shaderModules/glsl"],function(e,t,r,i,o){"use strict";const s=r.create();e.ReadDepth=function(e){e.uniforms.add(new i.Float2BindUniform("zProjectionMap",e=>function(e){const r=e.projectionMatrix;return t.set(s,r[14],r[10])}(e.camera))),e.code.add(o.glsl`float linearizeDepth(float depth) {
float depthNdc = depth * 2.0 - 1.0;
float c1 = zProjectionMap[0];
float c2 = zProjectionMap[1];
return -(c1 / (depthNdc + c2 + 1e-7));
}`),e.code.add(o.glsl`float depthFromTexture(sampler2D depthTexture, vec2 uv) {
ivec2 iuv = ivec2(uv * vec2(textureSize(depthTexture, 0)));
float depth = texelFetch(depthTexture, iuv, 0).r;
return depth;
}`),e.code.add(o.glsl`float linearDepthFromTexture(sampler2D depthTexture, vec2 uv) {
return linearizeDepth(depthFromTexture(depthTexture, uv));
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"vec2",2,(i,o,s,n)=>i.setUniform2fv(e,t(o,s,n),r))}}e.Float2DrawUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderBuilder":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(e,t,r,i){"use strict";const o=()=>i.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class s{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class n{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const t of e)this._add(t);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new t("shaderbuilder:duplicate-uniform",`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else o().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map(({name:e,arraySize:t,type:r})=>null!=t?`uniform ${r} ${e}[${t}];`:`uniform ${r} ${e};`)}get entries(){return Array.from(this._entries.values())}}class a{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];if(e)throw new t("shaderbuilder:missing-main","Shader does not contain main function body.");return[]}}class l{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class c extends s{constructor(){super(...arguments),this.uniforms=new n(this),this.main=new a(this),this.code=new l(this),this.constants=new f(this)}get builder(){return this}}class u{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map(e=>`in ${e[1]} ${e[0]};`)}get names(){return this._entries.map(([e])=>e)}}class d{constructor(){this._entries=new Map}add(e,t,r){this._entries.has(e)?o().warn(`Ignoring duplicate varying ${t} ${e}`):this._entries.set(e,{type:t,invariant:r?.invariant??!1,flat:r?.flat??!1})}generateSource(e){const t=new Array;return this._entries.forEach((r,i)=>t.push((r.invariant&&"vertex"===e?"invariant ":"")+(r.flat||"int"===r.type?"flat ":"")+("vertex"===e?"out":"in")+` ${r.type} ${i};`)),t}}class p{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?p.ALLOWLIST_VERTEX:p.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(e=>t.includes(e)).map(e=>`#extension ${e} : enable`)}static{this.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"]}static{this.ALLOWLIST_VERTEX=[]}}class h{constructor(){this._entries=new Map}add(e,t,r=0){const i=this._entries.get(r);i?.name!==e||i?.type!==t?this._entries.set(r,{name:e,type:t}):o().warn(`Fragment shader output location ${r} occupied`)}static{this.DEFAULT_TYPE="vec4"}static{this.DEFAULT_NAME="fragColor"}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:h.DEFAULT_NAME,type:h.DEFAULT_TYPE});const t=new Array;return this._entries.forEach((e,r)=>t.push(`layout(location = ${r}) out ${e.type} ${e.name};`)),t}}class f{constructor(e){this._stage=e,this._entries=new Set}add(e,t,r){let i="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":i=f._numberToFloatStr(r);break;case"int":i=f._numberToIntStr(r);break;case"bool":i=r.toString();break;case"vec2":i=`vec2(${f._numberToFloatStr(r[0])},                            ${f._numberToFloatStr(r[1])})`;break;case"vec3":i=`vec3(${f._numberToFloatStr(r[0])},                            ${f._numberToFloatStr(r[1])},                            ${f._numberToFloatStr(r[2])})`;break;case"vec4":i=`vec4(${f._numberToFloatStr(r[0])},                            ${f._numberToFloatStr(r[1])},                            ${f._numberToFloatStr(r[2])},                            ${f._numberToFloatStr(r[3])})`;break;case"ivec2":i=`ivec2(${f._numberToIntStr(r[0])},                             ${f._numberToIntStr(r[1])})`;break;case"ivec3":i=`ivec3(${f._numberToIntStr(r[0])},                             ${f._numberToIntStr(r[1])},                             ${f._numberToIntStr(r[2])})`;break;case"ivec4":i=`ivec4(${f._numberToIntStr(r[0])},                             ${f._numberToIntStr(r[1])},                             ${f._numberToIntStr(r[2])},                             ${f._numberToIntStr(r[3])})`;break;case"uvec2":i=`uvec2(${f._numberToIntStr(r[0])},                             ${f._numberToIntStr(r[1])})`;break;case"uvec3":i=`uvec3(${f._numberToIntStr(r[0])},                             ${f._numberToIntStr(r[1])},                             ${f._numberToIntStr(r[2])})`;break;case"uvec4":i=`uvec4(${f._numberToIntStr(r[0])},                             ${f._numberToIntStr(r[1])},                             ${f._numberToIntStr(r[2])},                             ${f._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":i=`${t}(${Array.prototype.map.call(r,e=>f._numberToFloatStr(e)).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${i};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}e.Code=l,e.Includes=s,e.Main=a,e.ShaderBuilder=class extends s{constructor(){super(...arguments),this.vertex=new c,this.fragment=new c,this.attributes=new u,this.varyings=new d,this.extensions=new p,this.outputs=new h}get fragmentUniforms(){return this.fragment.uniforms.entries}get attributeNames(){return this.attributes.names}get builder(){return this}generate(e,t=!1){const r=this.extensions.generateSource(e),i=this.attributes.generateSource(e),o=this.varyings.generateSource(e),s="vertex"===e?this.vertex:this.fragment,n=s.uniforms.generateSource(),a=s.code.generateSource(),l=s.main.generateSource(t),c="vertex"===e?"precision highp float;\n precision highp sampler2D;\n precision highp usampler2D;\n precision highp sampler2DArray;\n precision highp sampler2DShadow;\n\n\n invariant gl_Position;\n ":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n  precision highp usampler2D;\n  precision highp sampler2DArray;\n  precision highp sampler2DShadow;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n  precision mediump usampler2D;\n  precision mediump sampler2DArray;\n  precision mediump sampler2DShadow;\n#endif",u=s.constants.generateSource(),d=this.outputs.generateSource(e);return`#version 300 es\n${r.join("\n")}\n${c}\n${u.join("\n")}\n${n.join("\n")}\n${i.join("\n")}\n${o.join("\n")}\n${d.join("\n")}\n${a.join("\n")}\n${l.join("\n")}`}generateBind(e){const t=new Map;this.vertex.uniforms.entries.forEach(e=>{const r=e.bind[0];r&&t.set(e.name,r)}),this.fragment.uniforms.entries.forEach(e=>{const r=e.bind[0];r&&t.set(e.name,r)});const r=Array.from(t.values()),i=r.length;return t=>{for(let o=0;o<i;++o)r[o](e,t)}}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach(e=>{const r=e.bind[1];r&&t.set(e.name,r)}),this.fragment.uniforms.entries.forEach(e=>{const r=e.bind[1];r&&t.set(e.name,r)});const r=Array.from(t.values()),i=r.length;return(t,o)=>{for(let s=0;s<i;++s)r[s](e,t,o)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach(e=>{const r=e.bind[2];r&&t.set(e.name,r)}),this.fragment.uniforms.entries.forEach(e=>{const r=e.bind[2];r&&t.set(e.name,r)});const r=Array.from(t.values()),i=r.length;return(t,o,s)=>{for(let n=0;n<i;++n)r[n](e,s,t,o)}}},e.Stage=c,e.Uniforms=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAONoiseData":function(){define(["exports"],function(e){"use strict";e.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOParameters":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../webgl/NoParameters"],function(e,t,r){"use strict";class i extends r.NoParameters{constructor(){super(...arguments),this.projScale=1}}class o extends r.NoParameters{}e.BlurDrawParameters=class extends o{constructor(){super(...arguments),this.blurSize=t.create()}},e.BlurPassParameters=i,e.SSAODrawParameters=o,e.SSAOPassParameters=class extends i{constructor(){super(...arguments),this.intensity=1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/ssao/SSAOTechnique":function(){define(["require","exports","../../core/shaderTechnique/ReloadableShaderModule","../../core/shaderTechnique/ShaderTechnique","../../lib/DefaultVertexBufferLayouts","../../../../../chunks/SSAO.glsl","../../../../webgl/renderState"],function(e,t,r,i,o,s,n){"use strict";class a extends i.ShaderTechnique{constructor(t,i){super(t,i,new r.ReloadableShaderModule(s.SSAO,()=>new Promise((t,r)=>e(["../../shaders/SSAO.glsl"],t,r))),o.Pos2Locations)}initializePipeline(){return n.makePipelineState({colorWrite:n.defaultColorWrite})}}t.SSAOTechnique=a,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAO.glsl":function(){define(["exports","../core/libs/gl-matrix-2/math/vec2","../core/libs/gl-matrix-2/factories/vec2f64","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl","../views/3d/webgl-engine/core/shaderLibrary/output/ReadDepth.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl","../views/3d/webgl-engine/core/shaderModules/Float2BindUniform","../views/3d/webgl-engine/core/shaderModules/Float2PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatBindUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/webgl/ShaderBuilder"],function(e,t,r,i,o,s,n,a,l,c,u,d,p){"use strict";function h(){const e=new p.ShaderBuilder,r=e.fragment;return e.include(i.ScreenSpacePass),e.include(s.CameraSpace),r.include(o.ReadDepth),r.uniforms.add(new l.FloatBindUniform("radius",e=>f(e.camera))).code.add(u.glsl`vec3 sphere[16] = vec3[16](
vec3(0.186937, 0.0, 0.0),
vec3(0.700542, 0.0, 0.0),
vec3(-0.864858, -0.481795, -0.111713),
vec3(-0.624773, 0.102853, -0.730153),
vec3(-0.387172, 0.260319, 0.007229),
vec3(-0.222367, -0.642631, -0.707697),
vec3(-0.01336, -0.014956, 0.169662),
vec3(0.122575, 0.1544, -0.456944),
vec3(-0.177141, 0.85997, -0.42346),
vec3(-0.131631, 0.814545, 0.524355),
vec3(-0.779469, 0.007991, 0.624833),
vec3(0.308092, 0.209288,0.35969),
vec3(0.359331, -0.184533, -0.377458),
vec3(0.192633, -0.482999, -0.065284),
vec3(0.233538, 0.293706, -0.055139),
vec3(0.417709, -0.386701, 0.442449)
);
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn - bias, 0.0);
}`),r.code.add(u.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),e.outputs.add("fragOcclusion","float"),r.uniforms.add(new d.Texture2DPassUniform("normalMap",e=>e.normalTexture),new d.Texture2DPassUniform("depthMap",e=>e.depthTexture),new c.FloatPassUniform("projScale",e=>e.projScale),new d.Texture2DPassUniform("rnm",e=>e.noiseTexture),new a.Float2PassUniform("rnmScale",(e,r)=>t.set(m,r.camera.fullWidth/e.noiseTexture.descriptor.width,r.camera.fullHeight/e.noiseTexture.descriptor.height)),new c.FloatPassUniform("intensity",e=>e.intensity),new n.Float2BindUniform("screenSize",e=>t.set(m,e.camera.fullWidth,e.camera.fullHeight))).main.add(u.glsl`
    float depth = depthFromTexture(depthMap, uv);

    // Early out if depth is out of range, such as in the sky
    if (depth >= 1.0 || depth <= 0.0) {
      fragOcclusion = 1.0;
      return;
    }

    // get the normal of current fragment
    ivec2 iuv = ivec2(uv * vec2(textureSize(normalMap, 0)));
    vec4 norm4 = texelFetch(normalMap, iuv, 0);
    if(norm4.a != 1.0) {
      fragOcclusion = 1.0;
      return;
    }
    vec3 norm = normalize(norm4.xyz * 2.0 - 1.0);

    float currentPixelDepth = linearizeDepth(depth);
    vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy, currentPixelDepth);

    float sum = 0.0;
    vec3 tapPixelPos;

    vec3 fres = normalize(2.0 * texture(rnm, uv * rnmScale).xyz - 1.0);

    // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
    // bug or deviation from CE somewhere else?
    float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

    for(int i = 0; i < ${u.glsl.int(16)}; ++i) {
      vec2 unitOffset = reflect(sphere[i], fres).xy;
      vec2 offset = vec2(-unitOffset * radius * ps);

      // don't use current or very nearby samples
      if( abs(offset.x) < 2.0 || abs(offset.y) < 2.0){
        continue;
      }

      vec2 tc = vec2(gl_FragCoord.xy + offset);
      if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
      vec2 tcTap = tc / screenSize;
      float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap);

      tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

      sum += aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
    }

    // output the result
    float A = max(1.0 - sum * intensity / float(${u.glsl.int(16)}), 0.0);

    // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4) / 2.2
    A = (pow(A, 0.2) + 1.2 * A * A * A * A) / 2.2;

    fragOcclusion = A;
  `),e}function f(e){return Math.max(10,20*e.computeScreenPixelSizeAtDist(Math.abs(4*e.relativeElevation)))}const m=r.create(),y=Object.freeze(Object.defineProperty({__proto__:null,build:h,getRadius:f},Symbol.toStringTag,{value:"Module"}));e.SSAO=y,e.build=h,e.getRadius=f})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../../../chunks/vec42","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../shaderModules/Float2BindUniform","../../shaderModules/Float4BindUniform","../../shaderModules/glsl"],function(e,t,r,i,o,s,n,a){"use strict";function l(e){const t=e.projectionMatrix;return 0===t[11]?i.set(c,2/(e.fullWidth*t[0]),2/(e.fullHeight*t[5]),(1+t[12])/t[0],(1+t[13])/t[5]):i.set(c,-2/(e.fullWidth*t[0]),-2/(e.fullHeight*t[5]),(1-t[8])/t[0],(1-t[9])/t[5])}const c=o.create();function u(e){return 0===e.projectionMatrix[11]?t.set(d,0,1):t.set(d,1,0)}const d=r.create();e.CameraSpace=function(e){e.fragment.uniforms.add(new n.Float4BindUniform("projInfo",e=>l(e.camera))),e.fragment.uniforms.add(new s.Float2BindUniform("zScale",e=>u(e.camera))),e.fragment.code.add(a.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)},e.getProjectionInfo=l,e.getZScale=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4BindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"vec4",0,(i,o)=>i.setUniform4fv(e,t(o),r))}}e.Float4BindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define(["exports","../../../../../../colorUtils","../../../../../../core/has","./EvaluateAmbientLighting.glsl","./EvaluateAmbientOcclusion.glsl","./MainLighting.glsl","./PhysicallyBasedRendering.glsl","./PiUtils.glsl","../../shaderModules/BooleanBindUniform","../../shaderModules/FloatBindUniform","../../shaderModules/glsl","../../../lighting/SceneLighting","../../../shaders/BlackLevelLightSoftCompression.glsl","../../../shaders/ToneMapping.glsl"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h){"use strict";function f(e){e.constants.add("ambientBoostFactor","float",d.ambientBoost)}function m(e){e.uniforms.add(new c.FloatBindUniform("lightingGlobalFactor",e=>e.lighting.globalFactor))}e.EvaluateSceneLighting=function(e,r){const d=e.fragment,{pbrMode:y,spherical:g,hasColorTexture:b}=r;d.include(o.EvaluateAmbientOcclusion,r),0!==y&&d.include(n.PhysicallyBasedRendering,r),e.include(i.EvaluateAmbientLighting,r),d.include(a.PiUtils),d.include(h.ToneMapping,r);const _=!(2===y&&!b);switch(_&&d.include(p.BlackLevelLightSoftCompression),d.code.add(u.glsl`
    const float GAMMA_SRGB = ${u.glsl.float(t.colorGamma)};
    const float INV_GAMMA_SRGB = 0.4761904;
    ${u.If(0!==y,"const float GROUND_REFLECTANCE = 0.2;")}
  `),f(d),m(d),s.addMainLightDirection(d),d.code.add(u.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${g?u.glsl`normalize(vPosWorld)`:u.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `),s.addMainLightIntensity(d),d.code.add(u.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`),y){case 0:case 4:case 3:e.include(s.applyShading),d.code.add(u.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
vec3 mainLighting = applyShading(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case 1:case 2:d.code.add(u.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight,
vec3 viewDir, vec3 groundNormal, vec3 mrr, vec4 _emission,
float additionalAmbientIrradiance) {
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotNG = clamp(dot(normal, groundNormal), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, groundNormal), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),d.code.add(u.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),r.useFillLights?d.uniforms.add(new l.BooleanBindUniform("hasFillLights",e=>e.enableFillLights)):d.constants.add("hasFillLights","bool",!1),d.code.add(u.glsl`vec3 ambientDir = vec3(5.0 * groundNormal[1] - groundNormal[0] * groundNormal[2], - 5.0 * groundNormal[0] - groundNormal[2] * groundNormal[1], groundNormal[1] * groundNormal[1] + groundNormal[0] * groundNormal[0]);
ambientDir = ambientDir != vec3(0.0) ? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
float NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
vec3 mainLightIrradianceComponent = NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),d.uniforms.add(new c.FloatBindUniform("lightingSpecularStrength",e=>e.lighting.mainLight.specularStrength),new c.FloatBindUniform("lightingEnvironmentStrength",e=>e.lighting.mainLight.environmentStrength)).code.add(u.glsl`vec3 horizonRingDir = inputs.RdotNG * groundNormal - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
float NdotH = clamp(dot(normal, h), 0.0, 1.0);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
float normalDirectionModifier = mix(1., min(mix(0.1, 2.0, (inputs.NdotNG + 1.) * 0.5), 1.0), clamp(inputs.roughness * 5.0, 0.0 , 1.0));
inputs.skyRadianceToSurface = (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.groundRadianceToSurface = 0.5 * GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) * normalDirectionModifier + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE);`),d.code.add(u.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = _emission.rgb == vec3(0.0) ? _emission.rgb : tonemapACES(pow(_emission.rgb, vec3(GAMMA_SRGB)));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${_?u.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:u.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case 5:case 6:s.addMainLightDirection(d),s.addMainLightIntensity(d),d.code.add(u.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluatePBRSimplifiedLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`)}},e.addAmbientBoostFactor=f,e.addLightingGlobalFactor=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["exports","../../../../../../chunks/vec32","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../chunks/vec42","../../../../../../core/libs/gl-matrix-2/factories/vec4f64","../../shaderModules/Float3BindUniform","../../shaderModules/Float4BindUniform","../../shaderModules/glsl"],function(e,t,r,i,o,s,n,a){"use strict";const l=r.create(),c=o.create();e.EvaluateAmbientLighting=function(e,r){const o=e.fragment,u=void 0!==r.lightingSphericalHarmonicsOrder?r.lightingSphericalHarmonicsOrder:2;0===u?(o.uniforms.add(new s.Float3BindUniform("lightingAmbientSH0",({lighting:e})=>t.set(l,e.sh.r[0],e.sh.g[0],e.sh.b[0]))),o.code.add(a.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===u?(o.uniforms.add(new n.Float4BindUniform("lightingAmbientSH_R",({lighting:e})=>i.set(c,e.sh.r[0],e.sh.r[1],e.sh.r[2],e.sh.r[3])),new n.Float4BindUniform("lightingAmbientSH_G",({lighting:e})=>i.set(c,e.sh.g[0],e.sh.g[1],e.sh.g[2],e.sh.g[3])),new n.Float4BindUniform("lightingAmbientSH_B",({lighting:e})=>i.set(c,e.sh.b[0],e.sh.b[1],e.sh.b[2],e.sh.b[3]))),o.code.add(a.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===u&&(o.uniforms.add(new s.Float3BindUniform("lightingAmbientSH0",({lighting:e})=>t.set(l,e.sh.r[0],e.sh.g[0],e.sh.b[0])),new n.Float4BindUniform("lightingAmbientSH_R1",({lighting:e})=>i.set(c,e.sh.r[1],e.sh.r[2],e.sh.r[3],e.sh.r[4])),new n.Float4BindUniform("lightingAmbientSH_G1",({lighting:e})=>i.set(c,e.sh.g[1],e.sh.g[2],e.sh.g[3],e.sh.g[4])),new n.Float4BindUniform("lightingAmbientSH_B1",({lighting:e})=>i.set(c,e.sh.b[1],e.sh.b[2],e.sh.b[3],e.sh.b[4])),new n.Float4BindUniform("lightingAmbientSH_R2",({lighting:e})=>i.set(c,e.sh.r[5],e.sh.r[6],e.sh.r[7],e.sh.r[8])),new n.Float4BindUniform("lightingAmbientSH_G2",({lighting:e})=>i.set(c,e.sh.g[5],e.sh.g[6],e.sh.g[7],e.sh.g[8])),new n.Float4BindUniform("lightingAmbientSH_B2",({lighting:e})=>i.set(c,e.sh.b[5],e.sh.b[6],e.sh.b[7],e.sh.b[8]))),o.code.add(a.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),1!==r.pbrMode&&2!==r.pbrMode||o.code.add(a.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3BindUniform","../../shaderModules/glsl"],function(e,t,r){"use strict";function i(e){e.uniforms.add(new t.Float3BindUniform("mainLightDirection",e=>e.lighting.mainLight.direction))}function o(e){e.uniforms.add(new t.Float3BindUniform("mainLightIntensity",e=>e.lighting.mainLight.intensity))}e.addMainLightDirection=i,e.addMainLightIntensity=o,e.applyShading=function(e){i(e.fragment),o(e.fragment),e.fragment.code.add(r.glsl`vec3 applyShading(vec3 shadingNormal, float shadow) {
float dotVal = clamp(dot(shadingNormal, mainLightDirection), 0.0, 1.0);
return mainLightIntensity * ((1.0 - shadow) * dotVal);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PiUtils.glsl","../../shaderModules/glsl"],function(e,t,r,i){"use strict";e.PhysicallyBasedRendering=function(e,o){e.include(r.PiUtils),1!==o.pbrMode&&2!==o.pbrMode&&5!==o.pbrMode&&6!==o.pbrMode||(e.code.add(i.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),e.code.add(i.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`)),1!==o.pbrMode&&2!==o.pbrMode||(e.include(t.AnalyticalSkyModel),e.code.add(i.glsl`struct PBRShadingInfo
{
float NdotV;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),e.code.add(i.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`))},e.PhysicallyBasedRenderingWater=function(e,t){e.include(r.PiUtils),e.code.add(i.glsl`
  struct PBRShadingWater {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${t.useCustomDTRExponentForWater?"2.2":"2.0"};
  `),e.code.add(i.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),e.code.add(i.glsl`float normalDistributionWater(float NdotH, float roughness) {
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),e.code.add(i.glsl`float geometricOcclusionKelemen(float LoH) {
return 0.25 / (LoH * LoH);
}`),e.code.add(i.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max) {
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze) * strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/glsl"],function(e,t){"use strict";e.AnalyticalSkyModel=function(e){e.code.add(t.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG) {
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`),e.code.add(t.glsl`float integratedRadiance(float cosTheta2, float roughness) {
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`),e.code.add(t.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness) {
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports"],function(e){"use strict";e.PiUtils=function(e){const t=.3183098861837907;e.constants.add("PI","float",3.141592653589793),e.constants.add("LIGHT_NORMALIZATION","float",t),e.constants.add("INV_PI","float",t),e.constants.add("HALF_PI","float",1.570796326794897),e.constants.add("TWO_PI","float",6.28318530717958)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanBindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t){super(e,"bool",0,(r,i)=>r.setUniform1b(e,t(i)))}}e.BooleanBindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./Lightsources","./SphericalHarmonics"],function(e,t,r,i,o,s){"use strict";class n{constructor(){this.color=i.create(),this.intensity=1}}class a{constructor(){this.direction=i.create(),this.ambient=new n,this.diffuse=new n}}const l=i.create();e.SceneLighting=class{constructor(){this._shOrder=2,this._legacy=new a,this.globalFactor=.5,this.noonFactor=.5,this._sphericalHarmonics=new o.SphericalHarmonicsAmbientLight,this._mainLight=new o.MainLight(i.create(),i.fromValues(1,0,0),!1)}get legacy(){return this._legacy}get sh(){return this._sphericalHarmonics}get mainLight(){return this._mainLight}set(e){s.combineLights(e,this._shOrder,this._mainLight,this._sphericalHarmonics),r.copy(this._legacy.direction,this._mainLight.direction);const t=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*t,this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*t,this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*t,r.scale(this._legacy.diffuse.color,this._mainLight.intensity,t),r.copy(l,this._legacy.diffuse.color),r.scale(l,l,.4*this.globalFactor),r.add(this._legacy.ambient.color,this._legacy.ambient.color,l)}copyFrom(e){this._sphericalHarmonics.r=Array.from(e.sh.r),this._sphericalHarmonics.g=Array.from(e.sh.g),this._sphericalHarmonics.b=Array.from(e.sh.b),r.copy(this._mainLight.direction,e.mainLight.direction),r.copy(this._mainLight.intensity,e.mainLight.intensity),this._mainLight.castShadows=e.mainLight.castShadows,this._mainLight.specularStrength=e.mainLight.specularStrength,this._mainLight.environmentStrength=e.mainLight.environmentStrength,this.globalFactor=e.globalFactor,this.noonFactor=e.noonFactor}lerpLighting(e,i,o){if(r.lerp(this._mainLight.intensity,e.mainLight.intensity,i.mainLight.intensity,o),this._mainLight.environmentStrength=t.lerp(e.mainLight.environmentStrength,i.mainLight.environmentStrength,o),this._mainLight.specularStrength=t.lerp(e.mainLight.specularStrength,i.mainLight.specularStrength,o),r.copy(this._mainLight.direction,i.mainLight.direction),this._mainLight.castShadows=i.mainLight.castShadows,this.globalFactor=t.lerp(e.globalFactor,i.globalFactor,o),this.noonFactor=t.lerp(e.noonFactor,i.noonFactor,o),e.sh.r.length===i.sh.r.length)for(let r=0;r<i.sh.r.length;r++)this._sphericalHarmonics.r[r]=t.lerp(e.sh.r[r],i.sh.r[r],o),this._sphericalHarmonics.g[r]=t.lerp(e.sh.g[r],i.sh.g[r],o),this._sphericalHarmonics.b[r]=t.lerp(e.sh.b[r],i.sh.b[r],o);else for(let e=0;e<i.sh.r.length;e++)this._sphericalHarmonics.r[e]=i.sh.r[e],this._sphericalHarmonics.g[e]=i.sh.g[e],this._sphericalHarmonics.b[e]=i.sh.b[e]}},e.SunLight=a,e.ambientBoost=.4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t){"use strict";e.AmbientLight=class{constructor(e=t.zeros()){this.intensity=e}},e.FillLight=class{constructor(e=t.zeros(),r=t.fromValues(.57735,.57735,.57735)){this.intensity=e,this.direction=r}},e.MainLight=class{constructor(e=t.zeros(),r=t.fromValues(.57735,.57735,.57735),i=!0,o=1,s=1){this.intensity=e,this.direction=r,this.castShadows=i,this.specularStrength=o,this.environmentStrength=s}},e.SphericalHarmonicsAmbientLight=class{constructor(){this.r=[0],this.g=[0],this.b=[0]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../lib/LongVectorMath","./Lightsources"],function(e,t,r,i,o,s){"use strict";function n(e){return(e+1)*(e+1)}function a(e){return t.clamp(Math.floor(Math.sqrt(e)-1),0,2)}function l(e,t,r){const i=e[0],o=e[1],s=e[2],a=r||[];return a.length=n(t),t>=0&&(a[0]=.28209479177),t>=1&&(a[1]=.4886025119*i,a[2]=.4886025119*s,a[3]=.4886025119*o),t>=2&&(a[4]=1.09254843059*i*o,a[5]=1.09254843059*o*s,a[6]=.31539156525*(3*s*s-1),a[7]=1.09254843059*i*s,a[8]=.54627421529*(i*i-o*o)),a}function c(e,t){const r=n(e),i=t||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=r;for(let e=0;e<r;e++)i.r[e]=i.g[e]=i.b[e]=0;return i}function u(e,t){const i=a(t.r.length);for(const s of e)r.negate(g,s.direction),l(g,i,m),o.elementwiseProduct(m,b),o.scalarProduct(m,s.intensity[0],y),o.add(t.r,y),o.scalarProduct(m,s.intensity[1],y),o.add(t.g,y),o.scalarProduct(m,s.intensity[2],y),o.add(t.b,y);return t}function d(e,t){l(g,0,m);for(const r of e)t.r[0]+=m[0]*b[0]*r.intensity[0]*4*Math.PI,t.g[0]+=m[0]*b[0]*r.intensity[1]*4*Math.PI,t.b[0]+=m[0]*b[0]*r.intensity[2]*4*Math.PI;return t}const p=[],h=[],f=[],m=[0],y=[0],g=i.create(),b=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];e.combineLights=function(e,t,i,n){c(t,n),r.set(i.intensity,0,0,0);let a=!1;const l=p,m=h,y=f;l.length=0,m.length=0,y.length=0;for(const t of e)t instanceof s.MainLight&&!a?(r.copy(i.direction,t.direction),r.copy(i.intensity,t.intensity),i.specularStrength=t.specularStrength,i.environmentStrength=t.environmentStrength,i.castShadows=t.castShadows,a=!0):t instanceof s.MainLight||t instanceof s.FillLight?l.push(t):t instanceof s.AmbientLight?m.push(t):t instanceof s.SphericalHarmonicsAmbientLight&&y.push(t);u(l,n),d(m,n);for(const e of y)o.add(n.r,e.r),o.add(n.g,e.g),o.add(n.b,e.b)},e.computeCoefficients=l,e.initSHCoefficients=c,e.numberOfCoefficients=n,e.orderFromNumberOfCoefficients=a,e.projectAmbientLights=d,e.projectFillLights=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(e){"use strict";e.add=function(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]+t[i];return r},e.dotProduct=function(e,t){let r=0;for(let i=0;i<e.length;i++)r+=e[i]*t[i];return r},e.elementwiseProduct=function(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t[i];return r},e.scalarProduct=function(e,t,r){(r=r||e).length=e.length;for(let i=0;i<e.length;i++)r[i]=e[i]*t;return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/BlackLevelLightSoftCompression.glsl":function(){define(["exports","../core/shaderModules/glsl"],function(e,t){"use strict";e.BlackLevelLightSoftCompression=function(e){e.code.add(t.glsl`float mapChannel(float x, vec2 p) {
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),e.code.add(t.glsl`vec3 blackLevelSoftCompression(vec3 color, float averageAmbientRadiance) {
vec2 p = vec2(0.02, 0.0075) * averageAmbientRadiance;
return vec3(mapChannel(color.x, p), mapChannel(color.y, p), mapChannel(color.z, p));
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ToneMapping.glsl":function(){define(["exports","../core/shaderModules/glsl"],function(e,t){"use strict";e.ToneMapping=function(e){e.code.add(t.glsl`vec3 tonemapACES(vec3 x) {
return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/glsl"],function(e,t,r){"use strict";e.Normals=function(e,i){const o=e.fragment;switch(o.code.add(r.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`),i.doubleSidedMode){case 0:o.code.add(r.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case 1:o.code.add(r.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case 2:o.code.add(r.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:t.neverReached(i.doubleSidedMode);case 3:}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define(["exports","../attributes/VertexTextureCoordinates.glsl","../../shaderModules/Float3DrawUniform","../../shaderModules/Float3PassUniform","../../shaderModules/glsl","../../shaderModules/Texture2DDrawUniform","../../shaderModules/Texture2DPassUniform","../../../materials/pbrUtils","../../../../../webgl/NoParameters"],function(e,t,r,i,o,s,n,a,l){"use strict";class c extends l.NoParameters{constructor(e,t){super(),this.textureOcclusion=e,this.textureMetallicRoughness=t,this.mrrFactors=a.schematicMRRFactors}}e.PBRRenderingParameters=c,e.PhysicallyBasedRenderingParameters=function(e,a){const l=a.pbrMode,c=e.fragment;if(2!==l&&0!==l&&1!==l)return void c.code.add(o.glsl`void applyPBRFactors() {}`);if(0===l)return void c.code.add(o.glsl`void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);if(2===l)return void c.code.add(o.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);const{hasMetallicRoughnessTexture:u,hasMetallicRoughnessTextureTransform:d,hasOcclusionTexture:p,hasOcclusionTextureTransform:h,bindType:f}=a;(u||p)&&e.include(t.VertexTextureCoordinates,a),c.code.add(o.glsl`vec3 mrr;
float occlusion;`),u&&c.uniforms.add(1===f?new n.Texture2DPassUniform("texMetallicRoughness",e=>e.textureMetallicRoughness):new s.Texture2DDrawUniform("texMetallicRoughness",e=>e.textureMetallicRoughness)),p&&c.uniforms.add(1===f?new n.Texture2DPassUniform("texOcclusion",e=>e.textureOcclusion):new s.Texture2DDrawUniform("texOcclusion",e=>e.textureOcclusion)),c.uniforms.add(1===f?new i.Float3PassUniform("mrrFactors",e=>e.mrrFactors):new r.Float3DrawUniform("mrrFactors",e=>e.mrrFactors)),c.code.add(o.glsl`
    ${o.If(u,o.glsl`void applyMetallicRoughness(vec2 uv) {
            vec3 metallicRoughness = textureLookup(texMetallicRoughness, uv).rgb;
            mrr[0] *= metallicRoughness.b;
            mrr[1] *= metallicRoughness.g;
          }`)}

    ${o.If(p,"void applyOcclusion(vec2 uv) { occlusion *= textureLookup(texOcclusion, uv).r; }")}

    float getBakedOcclusion() {
      return ${p?"occlusion":"1.0"};
    }

    void applyPBRFactors() {
      mrr = mrrFactors;
      occlusion = 1.0;

      ${o.If(u,`applyMetallicRoughness(${d?"metallicRoughnessUV":"vuv0"});`)}
      ${o.If(p,`applyOcclusion(${h?"occlusionUV":"vuv0"});`)}
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../ForwardLinearDepthToReadShadowMap.glsl","./calculateUVZShadow.glsl","./ShadowmapFiltering.glsl","../../shaderModules/FloatBindUniform","../../shaderModules/glsl","../../shaderModules/Texture2DShadowBindUniform","../../../../../webgl/NoParameters"],function(e,t,r,i,o,s,n,a,l){"use strict";class c extends i.ReadShadowMapOrigin{}class u extends l.NoParameters{constructor(){super(...arguments),this.origin=t.create()}}function d(e,t){e.fragment.uniforms.add(new s.FloatBindUniform("lightingGlobalFactor",e=>e.lighting.globalFactor));const{receiveShadows:i,spherical:l}=t;e.include(r.ForwardLinearDepthToReadShadowMap,t),i&&function(e){e.include(o.ShadowmapFiltering),e.fragment.uniforms.add(new a.Texture2DShadowBindUniform("shadowMap",({shadowMap:e})=>e.depthTexture)).code.add(n.glsl`float readShadowMap(const in vec3 _worldPos, float _linearDepth) {
vec3 uvzShadow = calculateUVZShadow(_worldPos, _linearDepth, textureSize(shadowMap,0));
if (uvzShadow.z < 0.0) {
return 0.0;
}
return readShadowMapUVZ(uvzShadow, shadowMap);
}`)}(e),e.fragment.code.add(n.glsl`
    float readShadow(float additionalAmbientScale, vec3 vpos) {
      return ${i?"max(lightingGlobalFactor * (1.0 - additionalAmbientScale), readShadowMap(vpos, linearDepth))":n.If(l,"lightingGlobalFactor * (1.0 - additionalAmbientScale)","0.0")};
    }
  `)}e.ReadShadowMapDraw=function(e,t){t.receiveShadows&&e.include(i.calculateUVZShadowDraw),d(e,t)},e.ReadShadowMapDrawParameters=c,e.ReadShadowMapPass=function(e,t){t.receiveShadows&&e.include(i.calculateUVZShadowPass),d(e,t)},e.ReadShadowMapPassParameters=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepthToReadShadowMap.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","./ShaderOutput","../shaderModules/glsl"],function(e,t,r,i){"use strict";e.ForwardLinearDepthToReadShadowMap=function(e,o){const s=r.isColorOrColorEmission(o.output)&&o.receiveShadows;s&&t.ForwardLinearDepth(e,!0),e.vertex.code.add(i.glsl`
    void forwardLinearDepthToReadShadowMap() { ${i.If(s,"forwardLinearDepth(gl_Position.w);")} }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/calculateUVZShadow.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../shaderModules/Float4BindUniform","../../shaderModules/glsl","../../shaderModules/IntegerBindUniform","../../shaderModules/Matrix4sDrawUniform","../../shaderModules/Matrix4sPassUniform","../../../../../webgl/NoParameters"],function(e,t,r,i,o,s,n,a){"use strict";class l extends a.NoParameters{constructor(){super(...arguments),this.origin=t.create()}}function c(e){const{fragment:t}=e;t.uniforms.add(new r.Float4BindUniform("cascadeDistances",e=>e.shadowMap.cascadeDistances),new o.IntegerBindUniform("numCascades",e=>e.shadowMap.numCascades)),t.code.add(i.glsl`const vec3 invalidShadowmapUVZ = vec3(0.0, 0.0, -1.0);
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, ivec2 textureSize, vec3 lvpos) {
float xScale = float(textureSize.y) / float(textureSize.x);
return vec2((float(i) + lvpos.x) * xScale, lvpos.y);
}
vec3 calculateUVZShadow(in vec3 _worldPos, in float _linearDepth, in ivec2 shadowMapSize) {
int i = _linearDepth < cascadeDistances[1] ? 0 : _linearDepth < cascadeDistances[2] ? 1 : _linearDepth < cascadeDistances[3] ? 2 : 3;
if (i >= numCascades) {
return invalidShadowmapUVZ;
}
mat4 shadowMatrix = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
vec3 lvpos = lightSpacePosition(_worldPos, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
return invalidShadowmapUVZ;
}
vec2 uvShadow = cascadeCoordinates(i, shadowMapSize, lvpos);
return vec3(uvShadow, lvpos.z);
}`)}e.ReadShadowMapOrigin=l,e.calculateUVZShadowDraw=function(e){e.fragment.uniforms.add(new s.Matrix4sDrawUniform("shadowMapMatrix",(e,t)=>t.shadowMap.getShadowMapMatrices(e.origin),4)),c(e)},e.calculateUVZShadowPass=function(e){e.fragment.uniforms.add(new n.Matrix4sPassUniform("shadowMapMatrix",(e,t)=>t.shadowMap.getShadowMapMatrices(e.origin),4)),c(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r,i){super(e,"mat4",2,(r,o,s,n)=>r.setUniformMatrix4fv(e,t(o,s,n),i),r)}}e.Matrix4sDrawUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r,i){super(e,"mat4",1,(r,o,s)=>r.setUniformMatrix4fv(e,t(o,s),i),r)}}e.Matrix4sPassUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ShadowmapFiltering.glsl":function(){define(["exports","./calculateUVZShadow.glsl","../../shaderModules/glsl"],function(e,t,r){"use strict";class i extends t.ReadShadowMapOrigin{}e.ReadShadowMapDrawParameters=i,e.ShadowmapFiltering=function(e){e.fragment.code.add(r.glsl`float readShadowMapUVZ(vec3 uvzShadow, sampler2DShadow _shadowMap) {
return texture(_shadowMap, uvzShadow);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DShadowBindUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t){super(e,"sampler2DShadow",0,(r,i)=>r.bindTexture(e,t(i)))}}e.Texture2DShadowBindUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl":function(){define(["exports","../output/ReadDepth.glsl","../../shaderModules/glsl","../../shaderModules/Texture2DBindUniform"],function(e,t,r,i){"use strict";e.terrainDepthTest=function(e,{occlusionPass:o,terrainDepthTest:s,cullAboveTerrain:n}){const{vertex:a,fragment:l,varyings:c}=e;if(!s)return a.code.add("void forwardViewPosDepth(vec3 pos) {}"),void l.code.add(`${o?"bool":"void"} discardByTerrainDepth() { ${r.If(o,"return false;")}}`);c.add("viewPosDepth","float",{invariant:!0}),a.code.add("void forwardViewPosDepth(vec3 pos) {\n    viewPosDepth = pos.z;\n  }"),l.include(t.ReadDepth),l.uniforms.add(new i.Texture2DBindUniform("terrainDepthTexture",e=>e.terrainDepth?.attachment)).code.add(r.glsl`
    ${o?"bool":"void"} discardByTerrainDepth() {
      float depth = texelFetch(terrainDepthTexture, ivec2(gl_FragCoord.xy), 0).r;
      float linearDepth = linearizeDepth(depth);
      ${o?"return viewPosDepth < linearDepth && depth < 1.0;":`if(viewPosDepth ${n?">":"<="} linearDepth) discard;`}
    }`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/factories/mat3f64","../../shaderModules/glsl","../../shaderModules/Matrix3PassUniform"],function(e,t,r,i){"use strict";e.colorTextureUV=function(e,o){o.hasColorTextureTransform?(e.varyings.add("colorUV","vec2"),e.vertex.uniforms.add(new i.Matrix3PassUniform("colorTextureTransformMatrix",e=>e.colorTextureTransformMatrix??t.IDENTITY)).code.add(r.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(r.glsl`void forwardColorUV(){}`)},e.emissiveTextureUV=function(e,o){o.hasEmissionTextureTransform&&0!==o.textureCoordinateType?(e.varyings.add("emissiveUV","vec2"),e.vertex.uniforms.add(new i.Matrix3PassUniform("emissiveTextureTransformMatrix",e=>e.emissiveTextureTransformMatrix??t.IDENTITY)).code.add(r.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(r.glsl`void forwardEmissiveUV(){}`)},e.metallicRoughnessTextureUV=function(e,o){o.hasMetallicRoughnessTextureTransform&&0!==o.textureCoordinateType?(e.varyings.add("metallicRoughnessUV","vec2"),e.vertex.uniforms.add(new i.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",e=>e.metallicRoughnessTextureTransformMatrix??t.IDENTITY)).code.add(r.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(r.glsl`void forwardMetallicRoughnessUV(){}`)},e.normalTextureUV=function(e,o){o.hasNormalTextureTransform&&0!==o.textureCoordinateType?(e.varyings.add("normalUV","vec2"),e.vertex.uniforms.add(new i.Matrix3PassUniform("normalTextureTransformMatrix",e=>e.normalTextureTransformMatrix??t.IDENTITY)).code.add(r.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(r.glsl`void forwardNormalUV(){}`)},e.occlusionTextureUV=function(e,o){o.hasOcclusionTextureTransform&&0!==o.textureCoordinateType?(e.varyings.add("occlusionUV","vec2"),e.vertex.uniforms.add(new i.Matrix3PassUniform("occlusionTextureTransformMatrix",e=>e.occlusionTextureTransformMatrix??t.IDENTITY)).code.add(r.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)):e.vertex.code.add(r.glsl`void forwardOcclusionUV(){}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","./ColorConversion.glsl","../../shaderModules/glsl"],function(e,t,r){"use strict";e.MixExternalColor=function(e){e.include(t.ColorConversion),e.code.add(r.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${r.glsl.int(1)}) {
        return allMixed;
      }
      if (mode == ${r.glsl.int(2)}) {
        return internalMixed;
      }
      if (mode == ${r.glsl.int(3)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in macOS using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${r.glsl.int(2)}) {
        return internalMixed;
      }
      if (mode == ${r.glsl.int(3)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/glsl"],function(e,t){"use strict";e.ColorConversion=function(e){e.code.add(t.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/effects/weather/SnowCover.glsl":function(){define(["exports","../../core/shaderModules/glsl"],function(e,t){"use strict";e.SnowCover=function(e,r){r.snowCover&&(e.code.add(t.glsl`float getSnow(vec3 normal, vec3 normalGround) {
return smoothstep(0.5, 0.55, dot(normal, normalGround));
}`),e.code.add(t.glsl`vec3 applySnowToMRR(vec3 mrr, float snow) {
return mix(mrr, vec3(0.0, 1.0, 0.04), snow);
}
vec4 snowCoverForEmissions(vec4 emission, float snow) {
return mix(emission, vec4(0.0), snow);
}`))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl":function(){define(["exports","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/output/Emissions.glsl","../core/shaderLibrary/output/OutputHighlight.glsl","../core/shaderLibrary/util/ColorConversion.glsl","../core/shaderModules/glsl","../../../../webscene/support/AlphaCutoff"],function(e,t,r,i,o,s,n){"use strict";e.outputColorHighlightOID=function(e,a){e.include(i.OutputHighlight,a),e.include(r.Emissions,a),e.fragment.include(o.ColorConversion);const{output:l,oitPass:c,discardInvisibleFragments:u,snowCover:d}=a,p=9===l,h=t.isColorEmission(l),f=t.isColorOrColorEmission(l)&&1===c,m=t.isColorOrColorEmission(l)&&1!==c;let y=0;(m||h||f)&&e.outputs.add("fragColor","vec4",y++),h&&e.outputs.add("fragEmission","vec4",y++),f&&e.outputs.add("fragAlpha","float",y++),e.fragment.code.add(s.glsl`
    void outputColorHighlightOID(vec4 finalColor, const in vec3 vWorldPosition, vec3 emissiveSymbolColor ${s.If(d,", float snow")}) {
      ${s.If(p,"finalColor.a = 1.0;")}

      ${s.If(u,`if (finalColor.a < ${s.glsl.float(n.alphaCutoff)}) { discard; }`)}

      finalColor = applySlice(finalColor, vWorldPosition);
      ${s.If(f,s.glsl`fragColor = premultiplyAlpha(finalColor);
             fragAlpha = finalColor.a;`)}
      ${s.If(m,"fragColor = finalColor;")}
      ${s.If(h,`fragEmission = ${s.If(d,"mix(finalColor.a * getEmissions(emissiveSymbolColor), vec4(0.0), snow);","finalColor.a * getEmissions(emissiveSymbolColor);")}`)}
      calculateOcclusionAndOutputHighlight();
      ${s.If(p,"outputObjectAndLayerIdColor();")}
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/Emissions.glsl":function(){define(["exports","../ShaderOutput","../attributes/VertexTextureCoordinates.glsl","../shading/Gamma.glsl","../../shaderModules/Float3DrawUniform","../../shaderModules/Float3PassUniform","../../shaderModules/FloatDrawUniform","../../shaderModules/FloatPassUniform","../../shaderModules/glsl","../../shaderModules/Texture2DDrawUniform","../../shaderModules/Texture2DPassUniform","../../../lib/GLTextureMaterial"],function(e,t,r,i,o,s,n,a,l,c,u,d){"use strict";class p extends d.GLEmissiveTexturePassParameters{}e.Emissions=function(e,d){if(!t.isColorOrColorEmission(d.output))return;e.fragment.include(i.Gamma);const{emissionSource:p,hasEmissiveTextureTransform:h,bindType:f}=d,m=3===p||4===p||5===p;m&&(e.include(r.VertexTextureCoordinates,d),e.fragment.uniforms.add(1===f?new u.Texture2DPassUniform("texEmission",e=>e.textureEmissive):new c.Texture2DDrawUniform("texEmission",e=>e.textureEmissive)));const y=2===p||m;y&&e.fragment.uniforms.add(1===f?new s.Float3PassUniform("emissiveBaseColor",e=>e.emissiveBaseColor):new o.Float3DrawUniform("emissiveBaseColor",e=>e.emissiveBaseColor));const g=0!==p;g&&7!==p&&6!==p&&4!==p&&5!==p&&e.fragment.uniforms.add(1===f?new a.FloatPassUniform("emissiveStrength",e=>e.emissiveStrength):new n.FloatDrawUniform("emissiveStrength",e=>e.emissiveStrength));const b=7===p,_=5===p,v=1===p||6===p||b;e.fragment.code.add(l.glsl`
    vec4 getEmissions(vec3 symbolColor) {
      vec4 emissions = ${y?_?"emissiveSource == 0 ? vec4(emissiveBaseColor, 1.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(emissiveBaseColor, 1.0)":v?b?"emissiveSource == 0 ? vec4(0.0): vec4(linearizeGamma(symbolColor), 1.0)":"vec4(linearizeGamma(symbolColor), 1.0)":"vec4(0.0)"};
      ${l.If(m,`${l.If(_,`if(emissiveSource == 0) {\n              vec4 emissiveFromTex = textureLookup(texEmission, ${h?"emissiveUV":"vuv0"});\n              emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);\n           }`,`vec4 emissiveFromTex = textureLookup(texEmission, ${h?"emissiveUV":"vuv0"});\n           emissions *= vec4(linearizeGamma(emissiveFromTex.rgb), emissiveFromTex.a);`)}\n         emissions.w = emissions.rgb == vec3(0.0) ? 0.0: emissions.w;`)}
      ${l.If(g,"emissions.rgb *= emissiveStrength;")}
      return emissions;
    }
  `)},e.EmissionsParameters=p,e.emissiveStrengthDefault=1,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../../../../../colorUtils","../../shaderModules/glsl"],function(e,t,r){"use strict";e.Gamma=function(e){e.code.add(r.glsl`
    const float GAMMA = ${r.glsl.float(t.colorGamma)};
    const float INV_GAMMA = ${r.glsl.float(1/t.colorGamma)};

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.a);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(e,t,r,i){"use strict";class o extends i.DefaultTechniqueConfiguration{constructor(e){super(),this.spherical=e,this.alphaDiscardMode=1,this.doubleSidedMode=0,this.pbrMode=0,this.cullFace=0,this.normalType=0,this.customDepthTest=0,this.emissionSource=0,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.hasVerticalOffset=!1,this.hasColorTexture=!1,this.hasMetallicRoughnessTexture=!1,this.hasOcclusionTexture=!1,this.hasNormalTexture=!1,this.hasScreenSizePerspective=!1,this.hasVertexTangents=!1,this.hasOccludees=!1,this.instanced=!1,this.instancedDoublePrecision=!1,this.hasModelTransformation=!1,this.offsetBackfaces=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.receiveShadows=!1,this.receiveAmbientOcclusion=!1,this.textureAlphaPremultiplied=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.writeDepth=!0,this.transparent=!1,this.enableOffset=!0,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.snowCover=!1,this.hasBloom=!1,this.hasColorTextureTransform=!1,this.hasEmissionTextureTransform=!1,this.hasNormalTextureTransform=!1,this.hasOcclusionTextureTransform=!1,this.hasMetallicRoughnessTextureTransform=!1,this.occlusionPass=!1,this.useCustomDTRExponentForWater=!1,this.useFillLights=!0,this.draped=!1}get textureCoordinateType(){return this.hasTextures?1:0}get hasTextures(){return this.hasColorTexture||this.hasNormalTexture||this.hasMetallicRoughnessTexture||3===this.emissionSource||this.hasOcclusionTexture}get hasVVInstancing(){return this.instanced}get discardInvisibleFragments(){return this.transparent}}t.__decorate([r.parameter({count:4})],o.prototype,"alphaDiscardMode",void 0),t.__decorate([r.parameter({count:3})],o.prototype,"doubleSidedMode",void 0),t.__decorate([r.parameter({count:7})],o.prototype,"pbrMode",void 0),t.__decorate([r.parameter({count:3})],o.prototype,"cullFace",void 0),t.__decorate([r.parameter({count:3})],o.prototype,"normalType",void 0),t.__decorate([r.parameter({count:2})],o.prototype,"customDepthTest",void 0),t.__decorate([r.parameter({count:8})],o.prototype,"emissionSource",void 0),t.__decorate([r.parameter()],o.prototype,"hasVertexColors",void 0),t.__decorate([r.parameter()],o.prototype,"hasSymbolColors",void 0),t.__decorate([r.parameter()],o.prototype,"hasVerticalOffset",void 0),t.__decorate([r.parameter()],o.prototype,"hasColorTexture",void 0),t.__decorate([r.parameter()],o.prototype,"hasMetallicRoughnessTexture",void 0),t.__decorate([r.parameter()],o.prototype,"hasOcclusionTexture",void 0),t.__decorate([r.parameter()],o.prototype,"hasNormalTexture",void 0),t.__decorate([r.parameter()],o.prototype,"hasScreenSizePerspective",void 0),t.__decorate([r.parameter()],o.prototype,"hasVertexTangents",void 0),t.__decorate([r.parameter()],o.prototype,"hasOccludees",void 0),t.__decorate([r.parameter()],o.prototype,"instanced",void 0),t.__decorate([r.parameter()],o.prototype,"instancedDoublePrecision",void 0),t.__decorate([r.parameter()],o.prototype,"hasModelTransformation",void 0),t.__decorate([r.parameter()],o.prototype,"offsetBackfaces",void 0),t.__decorate([r.parameter()],o.prototype,"hasVVSize",void 0),t.__decorate([r.parameter()],o.prototype,"hasVVColor",void 0),t.__decorate([r.parameter()],o.prototype,"receiveShadows",void 0),t.__decorate([r.parameter()],o.prototype,"receiveAmbientOcclusion",void 0),t.__decorate([r.parameter()],o.prototype,"textureAlphaPremultiplied",void 0),t.__decorate([r.parameter()],o.prototype,"instancedFeatureAttribute",void 0),t.__decorate([r.parameter()],o.prototype,"instancedColor",void 0),t.__decorate([r.parameter()],o.prototype,"writeDepth",void 0),t.__decorate([r.parameter()],o.prototype,"transparent",void 0),t.__decorate([r.parameter()],o.prototype,"enableOffset",void 0),t.__decorate([r.parameter()],o.prototype,"terrainDepthTest",void 0),t.__decorate([r.parameter()],o.prototype,"cullAboveTerrain",void 0),t.__decorate([r.parameter()],o.prototype,"snowCover",void 0),t.__decorate([r.parameter()],o.prototype,"hasBloom",void 0),t.__decorate([r.parameter()],o.prototype,"hasColorTextureTransform",void 0),t.__decorate([r.parameter()],o.prototype,"hasEmissionTextureTransform",void 0),t.__decorate([r.parameter()],o.prototype,"hasNormalTextureTransform",void 0),t.__decorate([r.parameter()],o.prototype,"hasOcclusionTextureTransform",void 0),t.__decorate([r.parameter()],o.prototype,"hasMetallicRoughnessTextureTransform",void 0),e.DefaultMaterialTechniqueConfiguration=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define(["require","exports","../core/shaderTechnique/ReloadableShaderModule","./DefaultMaterialTechnique","../../../../chunks/RealisticTree.glsl"],function(e,t,r,i,o){"use strict";class s extends i.DefaultMaterialTechnique{constructor(t,i){super(t,i,new r.ReloadableShaderModule(o.RealisticTree,()=>new Promise((t,r)=>e(["./RealisticTree.glsl"],t,r))))}}t.RealisticTreeTechnique=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RealisticTree.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl","../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput","../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/InstanceColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/MaskedColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl","../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/TerrainDepthTest.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlpha.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/Float3PassUniform","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/3d/webgl-engine/materials/internal/MaterialUtil","../views/3d/webgl-engine/shaders/OutputColorHighlightOID.glsl","../views/webgl/ShaderBuilder","../webscene/support/AlphaCutoff"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M,T,P,I,C,O,F,A,R,D){"use strict";function E(e){const E=new R.ShaderBuilder,{attributes:V,vertex:L,fragment:z,varyings:U}=E,{output:j,offsetBackfaces:B,pbrMode:N,snowCover:k,spherical:q,hasBloom:G}=e,H=1===N||2===N;if(M.addProjViewLocalOrigin(L,e),V.add("position","vec3"),U.add("vpos","vec3",{invariant:!0}),E.include(S.VisualVariables,e),E.include(n.InstancedDoublePrecision,e),E.include(p.VerticalOffset,e),E.include(v.terrainDepthTest,e),!r.isColorOrColorEmission(j))return E.include(h.DefaultMaterialAuxiliaryPasses,e),E;M.addCameraPosition(E.vertex,e),E.include(l.NormalAttribute,e),E.include(o.Transform,e),B&&E.include(t.Offset),U.add("vNormalWorld","vec3"),U.add("localvpos","vec3",{invariant:!0}),E.include(u.TextureCoordinateAttribute,e),E.include(c.SymbolColor,e),E.include(s.InstanceColor,e),E.include(d.VertexColor,e),L.include(a.MaskedColorDefinition),L.include(a.CreateMaskedFromNaNColor),L.uniforms.add(new P.Float4PassUniform("externalColor",e=>e.externalColor,{supportsNaN:!0})),U.add("vcolorExt","vec4"),E.include(e.instancedDoublePrecision?_.ReadShadowMapPass:_.ReadShadowMapDraw,e),L.main.add(C.glsl`
      forwardNormalizedVertexColor();

      MaskedColor maskedColorExt =
        applySymbolColor(applyVVColor(applyInstanceColor(createMaskedFromNaNColor(externalColor))));

      vcolorExt = maskedColorExt.color;
      forwardColorMixMode(maskedColorExt.mask);

      bool alphaCut = opacityMixMode != ${C.glsl.int(F.colorMixModes.ignore)} && vcolorExt.a < ${C.glsl.float(D.alphaCutoff)};
      vpos = getVertexInLocalOriginSpace();
      localvpos = vpos - view[3].xyz;
      vpos = subtractOrigin(vpos);
      vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
      vpos = addVerticalOffset(vpos, localOrigin);
      vec4 basePosition = transformPosition(proj, view, vpos);

      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      forwardTextureCoordinates();
      forwardLinearDepthToReadShadowMap();
      gl_Position = alphaCut ? vec4(1e38, 1e38, 1e38, 1.0) :
      ${C.If(B,"offsetBackfacingClipPosition(basePosition, vpos, vNormalWorld, cameraPosition);","basePosition;")}
    `);const{hasColorTexture:W,hasColorTextureTransform:$}=e;return E.include(m.EvaluateSceneLighting,e),z.include(f.EvaluateAmbientOcclusion,e),E.include(x.DiscardOrAdjustAlphaPass,e),z.include(i.SliceDraw,e),E.include(A.outputColorHighlightOID,e),M.addCameraPosition(z,e),y.addMainLightDirection(z),m.addAmbientBoostFactor(z),m.addLightingGlobalFactor(z),z.uniforms.add(L.uniforms.get("localOrigin"),L.uniforms.get("view"),new T.Float3PassUniform("ambient",e=>e.ambient),new T.Float3PassUniform("diffuse",e=>e.diffuse),new I.FloatPassUniform("opacity",e=>e.opacity),new I.FloatPassUniform("layerOpacity",e=>e.layerOpacity)),W&&z.uniforms.add(new O.Texture2DPassUniform("tex",e=>e.texture)),E.include(b.PhysicallyBasedRenderingParameters,e),z.include(g.PhysicallyBasedRendering,e),z.include(w.MixExternalColor),y.addMainLightIntensity(z),z.main.add(C.glsl`
      discardBySlice(vpos);
      discardByTerrainDepth();
      vec4 texColor = ${W?`texture(tex, ${$?"colorUV":"vuv0"})`:" vec4(1.0)"};
      ${C.If(W,`${C.If(e.textureAlphaPremultiplied,"texColor.rgb /= texColor.a;")}\n        discardOrAdjustAlpha(texColor);`)}
      vec3 viewDirection = normalize(vpos - cameraPosition);
      applyPBRFactors();
      float ssao = evaluateAmbientOcclusionInverse();
      ssao *= getBakedOcclusion();

      float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
      vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
      float shadow = readShadow(additionalAmbientScale, vpos);
      vec3 matColor = max(ambient, diffuse);
      ${e.hasVertexColors?C.glsl`vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, colorMixMode);
             float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, opacityMixMode);`:C.glsl`vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, colorMixMode);
             float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, opacityMixMode);`}

      ${C.If(k,"albedo = mix(albedo, vec3(1), 0.9);")}
      ${C.glsl`vec3 shadingNormal = normalize(vNormalWorld);
             albedo *= 1.2;
             vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
             float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
             float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
             float treeRadialFalloff = vColor.r;
             float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
             additionalLight += backLightFactor * mainLightIntensity;`}
      ${C.If(H,`vec3 normalGround = ${q?"normalize(vpos + localOrigin)":"vec3(0.0, 0.0, 1.0)"};`)}
      ${H?C.glsl`float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                 ${C.If(k,C.glsl`mrr = applySnowToMRR(mrr, 1.0)`)}
            vec4 emission = ${k||G?"vec4(0.0)":"getEmissions(albedo)"};
            vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:C.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
      vec4 finalColor = vec4(shadedColor, opacity_);
      outputColorHighlightOID(finalColor, vpos, albedo ${C.If(k,", 1.0")});`),E}const V=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}));e.RealisticTree=V,e.build=E})},"esri/views/3d/layers/graphics/pipeline/Tile3DManager":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/arrayUtils","../../../../../core/asyncUtils","../../../../../core/has","../../../../../core/promiseUtils","../../../../../core/ReactiveMap","../../../../../core/reactiveUtils","../../../../../core/scheduling","../../../../../core/accessorSupport/decorators/property","../../../../../core/Logger","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/support/aaBoundingRect","./PipelineCommand","./featureData/FeatureData"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";function y({lij:[e,t,r]},{lij:[i,o,s]}){const n=i-e;return n>=0&&t===o>>n&&r===s>>n}e.Tile3DManager=class extends r{constructor(e){super(e),this.extent=null,this._tileHandles=new a,this._wanted=new a,this._updateRequested=!1,this._synchronizationTask=null,this._requestedTiles=new Array}destroy(){this._tileHandles.clear(),this._wanted.clear()}get updating(){return this._updateRequested||!(this._synchronizationTask?.finished??1)}get _boundingRect(){const{extent:e}=this;return null==e?null:h.fromExtent(e)}get _missingTiles(){const e=new Array,t=this._wanted,r=this._tileHandles;for(const i of t.values())null==r.get(i.id)?.featureData&&e.push(i);return e}onTileTreeChange({tiles:e}){this._requestedTiles=e,this._scheduleTilesSync()}_scheduleTilesSync(){if(this._updateRequested)return;this._updateRequested=!0;const e=this._synchronizationTask,t=o.createTask(async()=>{try{await l.whenOnce(()=>e?.finished??!0),await c.waitTick(),this._updateRequested=!1,await this._synchronizeTiles()}finally{this._synchronizationTask===t&&(this._synchronizationTask=null)}});this._synchronizationTask=t}async _synchronizeTiles(){const e=this._requestedTiles,t=this._tileHandles,r=new Array;for(const i of e)t.has(i.id)||r.push(i);const i=new Array;for(const r of t.values()){const{id:t}=r;e.every(e=>e.id!==t)&&i.push(r.descriptor)}const o=this._tileHandles,{_boundingRect:s}=this,n=null!=s?r.filter(e=>!e.extent||h.intersects(s,e.extent)):r,a=this._wanted,l=new Array;for(const{id:e}of i)a.delete(e);for(const e of n)a.set(e.id,e);const c=this._missingTiles;for(const e of i){const{id:t}=e;if(c.some(t=>y(t,e)||y(e,t)))continue;const r=o.get(t);null!=r&&l.push(this._removeTile(r))}for(const e of n)l.push(this._addTile(e));const u=await Promise.allSettled(l);for(const e of u)"rejected"===e.status&&console.error(e.reason)}forEachTile(e){for(const t of this._tileHandles.values()){const r=t.featureData;null!=r&&e(r)}}*loadedTiles(){for(const e of this._tileHandles.values()){const t=e.featureData;null!=t&&(yield t)}}async _removeTile(e){e.loadTask.abort(),this._tileHandles.delete(e.id),this._validate();const{featureData:r}=e;if(null!=r){const e={stack:[],error:void 0,hasError:!1};try{t.__addDisposableResource(e,await this.tileLocks.lock([r.tileId]),!1);const i=await this.createRemoveCommand(r.id);await(i?.execute())}catch(t){e.error=t,e.hasError=!0}finally{t.__disposeResources(e)}}}async _addTile(e){const{_tileHandles:t}=this,r=t.get(e.id);if(null!=r){if(!b(r)||r.featureData.isFullyEnabled)return;return r.featureData.enableAll(),void await this._onTileLoad(r)}const i=new g(e,o.createTask(async t=>{const r=await this.loadTile(e,t);return n.throwIfAborted(t),new m.FeatureData(r)}));this._tileHandles.set(i.id,i);try{await i.loadTask.promise}catch(e){return void n.throwIfNotAbortError(e)}!function(e){if(!b(e))throw new Error}(i),await this._onTileLoad(i)}async _onTileLoad(e){const r={stack:[],error:void 0,hasError:!1};try{const{_wanted:o,_tileHandles:s,_missingTiles:n}=this,a=e.descriptor,l=new Array,c=new Array,u=new Array,d=new Set;for(const t of s.values()){if(t===e)continue;const{descriptor:r,id:i}=t;if(!o.has(i)&&!n.some(e=>y(e,r)||y(r,e))){s.delete(i),t.loadTask.abort();const{featureData:e}=t;null!=e&&l.push(e);continue}if(b(t)){if(y(a,r)){const e=t.featureData;for(const t of e.objectIds())d.add(t)}if(y(r,a)){const{featureData:e}=t;c.push(e)}}}d.size>0&&(e.featureData.disableObjectIds(d),this._validateRemoval(e.featureData,d)),this._validate(),u.push(e.featureData);const p=[...u,...l,...c].map(e=>e.tileId);if(t.__addDisposableResource(r,await this.tileLocks.lock(p),!1),0!==c.length){const t=e.featureData,r=new Set(t.objectIds());for(const e of c)e.disableObjectIds(r),this._validateRemoval(e,r)}const h=l.map(e=>this.createRemoveCommand(e.id)),m=u.map(e=>this.createAddCommand(e)),g=c.map(e=>this.createUpdateCommand(e)),_=await Promise.all([...h,...m,...g]),v=f.joinCommands(_.filter(i.isSome));await(v?.execute())}catch(e){r.error=e,r.hasError=!0}finally{t.__disposeResources(r)}}_validate(){if(!s("feature-pipeline-3d-test-validation"))return;const e=new Array;for(const t of this._tileHandles.values()){if(!b(t))continue;const{featureData:r}=t;e.push({featureData:r,objectIds:new Set(r.enabledObjectIds())})}for(let t=0;t<e.length;++t){const{featureData:r,objectIds:i}=e[t];for(let o=t+1;o<e.length;++o){const{featureData:t,objectIds:s}=e[o];for(const e of s)if(i.has(e))throw new Error(`${r.id} and ${t.id} both contain ${e}.`)}}}_validateRemoval(e,t){if(s("feature-pipeline-3d-test-validation"))for(const r of e.enabledObjectIds())if(t.has(r))throw new Error(`Failed to remove ${r} from ${e.id}!`)}},t.__decorate([u.property()],e.Tile3DManager.prototype,"updating",null),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"loadTile",void 0),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"createAddCommand",void 0),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"createRemoveCommand",void 0),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"createUpdateCommand",void 0),t.__decorate([u.property({constructOnly:!0})],e.Tile3DManager.prototype,"tileLocks",void 0),t.__decorate([u.property()],e.Tile3DManager.prototype,"extent",void 0),t.__decorate([u.property()],e.Tile3DManager.prototype,"_boundingRect",null),t.__decorate([u.property()],e.Tile3DManager.prototype,"_missingTiles",null),t.__decorate([u.property()],e.Tile3DManager.prototype,"_updateRequested",void 0),t.__decorate([u.property()],e.Tile3DManager.prototype,"_synchronizationTask",void 0),e.Tile3DManager=t.__decorate([p.subclass("esri.views.3d.layers.graphics.pipeline.Tile3DManager")],e.Tile3DManager);class g{constructor(e,t){this.descriptor=e,this.loadTask=t}get id(){return this.descriptor.id}get featureData(){return this.loadTask.value}}function b(e){return null!=e.featureData}Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/asyncUtils":function(){define(["exports","../chunks/tslib.es6","./Accessor","./maybe","./promiseUtils","./accessorSupport/decorators/property","./accessorSupport/decorators/subclass"],function(e,t,r,i,o,s,n){"use strict";function a(e){return{ok:!0,value:e}}function l(e){return{ok:!1,error:e}}function c(e){return null!=e&&!0===e.ok?e.value:null}function u(e){return null!=e&&!1===e.ok?e.error:null}let d=class extends r{get value(){return c(this._result)}get error(){return u(this._result)}get finished(){return null!=this._result}constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=i.abortMaybe(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(e=>{this._result=a(e),this._cleanup()},e=>{this._result=l(e),this._cleanup()}),this._abortHandle=o.onAbort(t,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=i.removeMaybe(this._abortHandle),this._abortController=null}};t.__decorate([s.property()],d.prototype,"value",null),t.__decorate([s.property()],d.prototype,"error",null),t.__decorate([s.property()],d.prototype,"finished",null),t.__decorate([s.property()],d.prototype,"promise",void 0),t.__decorate([s.property()],d.prototype,"_result",void 0),d=t.__decorate([n.subclass("esri.core.asyncUtils.ReactiveTask")],d),e.assertResult=function(e){if(!0===e.ok)return e.value;throw e.error},e.createTask=function(e,t){return new d(e,t)},e.forEach=function(e,t,r){return o.eachAlways(e.map((e,i)=>t.apply(r,[e,i])))},e.makeResultError=l,e.makeResultOk=a,e.map=async function(e,t,r){return(await o.eachAlways(e.map((e,i)=>t.apply(r,[e,i])))).map(e=>e.value)},e.result=async function(e){if(null==e)return{ok:!1,error:new Error("no promise provided")};try{return a(await e)}catch(e){return l(e)}},e.resultError=u,e.resultOrAbort=async function(e){try{return a(await e)}catch(e){return o.throwIfAbortError(e),l(e)}},e.resultValue=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/ReactiveMap":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t){"use strict";class r{constructor(e){this._observable=new t.SimpleObservable,this._map=new Map(e)}get size(){return e.trackAccess(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return e.trackAccess(this._observable),this._map.entries()}forEach(t,r){e.trackAccess(this._observable),this._map.forEach((e,i)=>t.call(r,e,i,this),r)}get(t){return e.trackAccess(this._observable),this._map.get(t)}has(t){return e.trackAccess(this._observable),this._map.has(t)}keys(){return e.trackAccess(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return e.trackAccess(this._observable),this._map.values()}[Symbol.iterator](){return e.trackAccess(this._observable),this._map[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}return r})},"esri/views/3d/layers/graphics/pipeline/featureData/FeatureData":function(){define(["exports","../../../../../../core/memoryEstimations","../utils","./FeatureDataSubset"],function(e,t,r,i){"use strict";e.FeatureData=class{constructor(e){this._tile=e,this.id=r.generateId(`featureData-${e.id}-`),this._enabled=new Array(e.featureCount).fill(!0)}get tileId(){return this._tile.id}get featureCount(){return this._tile.featureCount}get usedMemory(){return t.baseObjectMemory+t.estimateStringMemory(this.id)}get extent(){return this._tile.descriptor.extent}get isFullyEnabled(){return this._enabled.every(e=>e)}getObjectId(e){return this._tile.getObjectId(e)}getAttribute(e,t){return this._tile.getAttribute(e,t)}getAttributeAsTimestamp(e,t){return this._tile.getAttribute(e,t)}getAttributes(e){return this._tile.getAttributes(e)}getCoordinates(e,t,r){return this._tile.getCoordinates(e,t,r)}getOptimizedGeometry(e){return this._tile.getOptimizedGeometry(e)}getCentroid(e,t){return this._tile.getCentroid(e,t)}getBounds(e){return this._tile.getBounds(e)}getBoundingBox(e){return this._tile.getBoundingBox(e)}getObjectIdsArray(e,t,r){return this._tile.getObjectIdsArray(e,t,r)}getCoordinatesArray(e,t,r){return this._tile.getCoordinatesArray(e,t,r)}objectIds(e){return this._tile.objectIds(e)}subset(e){return new i.FeatureDataSubset(this,e)}disableObjectIds(e){if(0===e.size)return;const{_enabled:t}=this,r=new Array;for(const i of this._allFeatureIndices())t[i]&&e.has(this.getObjectId(i))&&r.push(i);if(0!==r.length)for(const e of r)t[e]=!1}setEnabled(e,t){this._enabled[e]=t}getEnabled(e){return this._enabled[e]}enableAll(){this._enabled.fill(!0)}getVisibilityArray(e,t=this._allFeatureIndices(),r=0){const{_enabled:i}=this;for(const o of t)e[r++]=Number(i[o]);return r}*enabledObjectIds(e=this._allFeatureIndices()){const{_enabled:t}=this;for(const r of e)t[r]&&(yield this.getObjectId(r))}*_allFeatureIndices(){const{featureCount:e}=this;for(let t=0;t<e;++t)yield t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/utils":function(){define(["exports","../../../../../core/uid","../../../../../geometry/projection/projectors"],function(e,t,r){"use strict";const i=new Float64Array(3);e.applyElevationAlignment=function(e,t,o,s,n){const a=s.spatialReference,l=r.getProjector(t,a);if(null==l)return e;let c=t=>[e[t],e[t+1],e[t+2]];l!==r.copy3&&(c=t=>(l(e,t,i,0),[i[0],i[1],i[2]]));const u=e.length/3,d=o.mode;switch(o.mode){case"on-the-ground":for(let t=0;t<u;++t){const r=3*t,[i,o]=c(r);e[r+2]=s.getElevation(i,o,0,s.spatialReference,"ground")??0}break;case"relative-to-ground":case"relative-to-scene":{const t="relative-to-ground"===d?"ground":"scene";for(let r=0;r<u;++r){const i=3*r,[a,l,u]=c(i),d=o.calculateOffsetRenderUnits(n),p=s.getElevation(a,l,0,s.spatialReference,t)??0;e[i+2]=u+d+p}}break;case"absolute-height":for(let t=0;t<u;++t){const r=3*t,i=e[r+2],s=o.calculateOffsetRenderUnits(n);e[r+2]=i+s}}return e},e.generateId=function(e=""){return`${e}${t.generateUID()}`},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/featureData/FeatureDataSubset":function(){define(["exports","../../../../../../core/memoryEstimations","../utils"],function(e,t,r){"use strict";class i{constructor(e,t){this._parent=e,this._subsetIndices=t,this.id=r.generateId(`featureDataSubset-${e.id}-`)}get tileId(){return this._parent.tileId}get extent(){return this._parent.extent}get featureCount(){return this._subsetIndices.length}get usedMemory(){return this._parent.usedMemory+t.baseObjectMemory+this._subsetIndices.byteLength}get isFullyEnabled(){for(const e of this._subsetIndices)if(!this._parent.getEnabled(e))return!1;return!0}getObjectId(e){return this._parent.getObjectId(this._subsetIndices[e])}getAttribute(e,t){return this._parent.getAttribute(this._subsetIndices[e],t)}getAttributeAsTimestamp(e,t){return this._parent.getAttribute(this._subsetIndices[e],t)}getAttributes(e){return this._parent.getAttributes(this._subsetIndices[e])}getCoordinates(e,t,r){return this._parent.getCoordinates(this._subsetIndices[e],t,r)}getOptimizedGeometry(e){return this._parent.getOptimizedGeometry(this._subsetIndices[e])}getCentroid(e,t){return this._parent.getCentroid(this._subsetIndices[e],t)}getBounds(e){return this._parent.getBounds(this._subsetIndices[e])}getBoundingBox(e){return this._parent.getBoundingBox(this._subsetIndices[e])}getObjectIdsArray(e,t,r){return this._parent.getObjectIdsArray(e,this._translatedIndices(t),r)}getCoordinatesArray(e,t,r){return this._parent.getCoordinatesArray(e,this._translatedIndices(t),r)}objectIds(e){return this._parent.objectIds(this._translatedIndices(e))}subset(e){const{_subsetIndices:t}=this,r=new Uint32Array(e.length);for(let i=0;i<r.length;++i)r[i]=t[e[i]];return new i(this._parent,r)}disableObjectIds(e){if(0===e.size)return;const{featureCount:t}=this,r=new Array;for(let i=0;i<t;++i)this.getEnabled(i)&&e.has(this.getObjectId(i))&&r.push(i);if(0!==r.length)for(const e of r)this.setEnabled(e,!1)}setEnabled(e,t){this._parent.setEnabled(this._subsetIndices[e],t)}getEnabled(e){return this._parent.getEnabled(this._subsetIndices[e])}enableAll(){const{_subsetIndices:e,_parent:t}=this;for(const r of e)t.setEnabled(r,!0)}getVisibilityArray(e,t,r){return this._parent.getVisibilityArray(e,this._translatedIndices(t),r)}enabledObjectIds(e){return this._parent.enabledObjectIds(this._translatedIndices(e))}*_translatedIndices(e){const{_subsetIndices:t}=this;if(null!=e)for(const r of e)yield t[r];else yield*t}}e.FeatureDataSubset=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/TileLocks":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/handleUtils","../../../../../core/promiseUtils"],function(e,t,r,i){"use strict";e.TileLocks=class{constructor(){this._previousActions=new Map}async lock(e){const{_previousActions:o}=this,s=e.map(e=>o.get(e)).filter(t.isSome),n=Promise.allSettled(s),a=i.createResolver(),l=r.makeHandle(()=>a.resolve()),c=a.promise.finally(()=>{for(const t of e)o.get(t)===c&&o.delete(t)});for(const t of e)o.set(t,c);return await n,r.disposable(l)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/featureSet/TiledFeatureStore":function(){define(["exports","../../../../../../core/Evented","../../../../../../core/memoryEstimations","../../../../../../core/libs/rbush/PooledRBush","../../../../../../layers/graphics/centroid","../../../../../../layers/graphics/OptimizedGeometry"],function(e,t,r,i,o,s){"use strict";class n{constructor(e,t){this._index=e,this._view=t}get usedMemory(){return r.baseObjectMemory+r.estimateNumberMemory}getObjectId(){return this._view.getObjectId(this._index)}getAttribute(e){return this._view.getAttribute(this._index,e)}getAttributeAsTimestamp(e){return this._view.getAttributeAsTimestamp(this._index,e)}getAttributes(){return this._view.getAttributes(this._index)}getOptimizedGeometry(){return this._view.getOptimizedGeometry(this._index)}getCentroid(e){return this._view.getCentroid(this._index,e)}getBounds(){return this._view.getBounds(this._index)}getBoundingBox(){return this._view.getBoundingBox(this._index)}cloneWithGeometry(e){return new a(this._index,this._view,e)}}class a extends n{constructor(e,t,r){super(e,t),this._geometryOverride=r}getOptimizedGeometry(){return this._geometryOverride}getCentroid(e){return o.getCentroidOptimizedGeometry(new s,this._geometryOverride,e.hasZ,e.hasM)}}class l{constructor(e,t){this.featureData=e,this.bounds=t}}class c{static{this.shared=new c}getObjectId(e){return e.getObjectId()}getAttribute(e,t){return e.getAttribute(t)}getAttributeAsTimestamp(e,t){return e.getAttributeAsTimestamp(t)}getAttributes(e){return e.getAttributes()}getGeometry(e){return e.getOptimizedGeometry()}getCentroid(e,t){return e.getCentroid(t)}cloneWithGeometry(e,t){return e.cloneWithGeometry(t)}}const u=new i.BBox;e.FeatureHandle=n,e.TiledFeatureStore=class{constructor(){this._tileBounds=new Map,this.events=new t.EventEmitter,this.featureAdapter=c.shared}get usedMemory(){return r.baseObjectMemory+r.baseObjectMemory*this._tileBounds.size}addTile(e){const{featureCount:t}=e;if(0===t)return;const r=new i.PooledRBush(9,t=>e.getBounds(t)),o=new Array;for(let e=0;e<t;++e)o[e]=e;r.load(o),this._tileBounds.set(e.id,new l(e,r)),this.events.emit("changed")}removeTile(e){this._tileBounds.delete(e),this.events.emit("changed")}clear(){this._tileBounds.clear(),this.events.emit("changed")}forEach(e){for(const{featureData:t,bounds:r}of this._tileBounds.values())r.all(r=>{t.getEnabled(r)&&e(new n(r,t))})}forEachInBounds(e,t){u.minX=e[0],u.minY=e[1],u.maxX=e[2],u.maxY=e[3];for(const{featureData:e,bounds:r}of this._tileBounds.values())r.search(u,r=>{e.getEnabled(r)&&t(new n(r,e))})}forEachBounds(e,t){for(const r of e)t(r.getBoundingBox())}getFullExtent(e){let t=1/0,r=1/0,i=-1/0,o=-1/0;for(const{bounds:e}of this._tileBounds.values()){const{minX:s,minY:n,maxX:a,maxY:l}=e.toJSON();t=Math.min(t,s),r=Math.min(r,n),i=Math.min(i,a),o=Math.min(o,l)}return{xmin:t,ymin:r,xmax:i,ymax:o,spatialReference:e}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../compilerUtils","../../has","../../PooledArray","../../../chunks/quickselect"],function(e,t,r,i,o,s){"use strict";function n(e,t){let i=e;for(v.clear();i;){if(!0===i.leaf)for(const e of i.children)t(r.toConst(e));else v.pushArray(i.children);i=v.pop()??null}}function a(e,t){l(e,0,e.children.length,t,e)}function l(e,t,r,i,o){o||(o=new T([])),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let s,n=t;n<r;n++)s=e.children[n],c(o,e.leaf?i(s):s);return o}function c(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function u(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function h(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function m(e,t){const r=Math.max(e.minX,t.minX),i=Math.max(e.minY,t.minY),o=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,o-r)*Math.max(0,s-i)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function b(e,t,r,i,o){const n=[t,r];for(;n.length;){const t=n.pop(),r=n.pop();if(t-r<=i)continue;const a=r+Math.ceil((t-r)/i/2)*i;s.quickselect(e,a,r,t,o),n.push(r,a,a,t)}}const _=new o,v=new o,S=new o,x=new o({deallocator:void 0});class w{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class M extends w{constructor(){super(...arguments),this.height=1,this.indexHint=new t.PositionHint}}class T extends M{constructor(e){super(),this.children=e,this.leaf=!0}}class P extends M{constructor(e){super(),this.children=e,this.leaf=!1}}e.BBox=w,e.PooledRBush=class{constructor(e=9,t){this._compareMinX=u,this._compareMinY=d,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),_.prune(),v.prune(),S.prune(),x.prune()}all(e){n(this._data,e)}search(e,t){let r=this._data;const i=this._toBBox;if(g(e,r))for(_.clear();r;){for(let o=0,s=r.children.length;o<s;o++){const s=r.children[o],a=r.leaf?i(s):s;g(e,a)&&(r.leaf?t(s):y(e,a)?n(s,t):_.push(s))}r=_.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!g(e,t))return!1;for(_.clear();t;){for(let i=0,o=t.children.length;i<o;i++){const o=t.children[i],s=t.leaf?r(o):o;if(g(e,s)){if(t.leaf||y(e,s))return!0;_.push(o)}}t=_.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new T([]),this}remove(e){if(!e)return this;let i,o=this._data,s=null,n=0,a=!1;const l=this._toBBox(e);for(S.clear(),x.clear();o||S.length>0;){if(o||(o=S.pop(),s=S.data[S.length-1],n=x.pop()??0,a=!0),o.leaf&&(i=t.indexOf(o.children,r.toConst(e),o.children.length,o.indexHint),-1!==i))return o.children.splice(i,1),S.push(o),this._condense(S),this;a||o.leaf||!y(o,l)?s?(n++,o=s.children[n],a=!1):o=null:(S.push(o),x.push(n),n=0,s=o,o=o.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,i){const o=r-t+1;let s=this._maxEntries;if(o<=s){const i=new T(e.slice(t,r+1));return a(i,this._toBBox),i}i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/s**(i-1)));const n=new P([]);n.height=i;const l=Math.ceil(o/s),c=l*Math.ceil(Math.sqrt(s));b(e,t,r,c,this._compareMinX);for(let o=t;o<=r;o+=c){const t=Math.min(o+c-1,r);b(e,o,t,l,this._compareMinY);for(let r=o;r<=t;r+=l){const o=Math.min(r+l-1,t);n.children.push(this._build(e,r,o,i-1))}}return a(n,this._toBBox),n}_insert(e,t,r){const i=this._toBBox,o=r?e:i(e);S.clear();const s=function(e,t,r,i){for(;i.push(t),!0!==t.leaf&&i.length-1!==r;){let r,i=1/0,o=1/0;for(let s=0,n=t.children.length;s<n;s++){const n=t.children[s],a=p(n),l=f(e,n)-a;l<o?(o=l,i=a<i?a:i,r=n):l===o&&a<i&&(i=a,r=n)}t=r||t.children[0]}return t}(o,this._data,t,S);for(s.children.push(e),c(s,o);t>=0&&S.data[t].children.length>this._maxEntries;)this._split(S,t),t--;!function(e,t,r){for(let i=r;i>=0;i--)c(t.data[i],e)}(o,S,t)}_split(e,t){const r=e.data[t],i=r.children.length,o=this._minEntries;this._chooseSplitAxis(r,o,i);const s=this._chooseSplitIndex(r,o,i);if(!s)return;const n=r.children.splice(s,r.children.length-s),l=r.leaf?new T(n):new P(n);l.height=r.height,a(r,this._toBBox),a(l,this._toBBox),t?e.data[t-1].children.push(l):this._splitRoot(r,l)}_splitRoot(e,t){this._data=new P([e,t]),this._data.height=e.height+1,a(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let i,o,s;i=o=1/0;for(let n=t;n<=r-t;n++){const t=l(e,0,n,this._toBBox),a=l(e,n,r,this._toBBox),c=m(t,a),u=p(t)+p(a);c<i?(i=c,s=n,o=u<o?u:o):c===i&&u<o&&(o=u,s=n)}return s}_chooseSplitAxis(e,t,r){const i=e.leaf?this._compareMinX:u,o=e.leaf?this._compareMinY:d;this._allDistMargin(e,t,r,i)<this._allDistMargin(e,t,r,o)&&e.children.sort(i)}_allDistMargin(e,t,r,i){e.children.sort(i);const o=this._toBBox,s=l(e,0,t,o),n=l(e,r-t,r,o);let a=h(s)+h(n);for(let i=t;i<r-t;i++){const t=e.children[i];c(s,e.leaf?o(t):t),a+=h(s)}for(let i=r-t-1;i>=t;i--){const t=e.children[i];c(n,e.leaf?o(t):t),a+=h(n)}return a}_condense(e){for(let r=e.length-1;r>=0;r--){const i=e.data[r];if(0===i.children.length)if(r>0){const o=e.data[r-1],s=o.children;s.splice(t.indexOf(s,i,s.length,o.indexHint),1)}else this.clear();else a(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},e.cleanupPooledRBush=function(){_.prune(),v.prune(),S.prune(),x.prune()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports"],function(e){"use strict";function t(e,i,o,s,n){for(;s>o;){if(s-o>600){var a=s-o+1,l=i-o+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(e,i,Math.max(o,Math.floor(i-l*u/a+d)),Math.min(s,Math.floor(i+(a-l)*u/a+d)),n)}var p=e[i],h=o,f=s;for(r(e,o,i),n(e[s],p)>0&&r(e,o,s);h<f;){for(r(e,h,f),h++,f--;n(e[h],p)<0;)h++;for(;n(e[f],p)>0;)f--}0===n(e[o],p)?r(e,o,f):r(e,++f,s),f<=i&&(o=f+1),i<=f&&(s=f-1)}}function r(e,t,r){var i=e[t];e[t]=e[r],e[r]=i}function i(e,t){return e<t?-1:e>t?1:0}e.quickselect=function(e,r,o,s,n){t(e,r,o||0,s||e.length-1,n||i)}})},"esri/views/3d/layers/graphics/pipeline/fetching/Tile3DFetcher":function(){define(["exports","../../../../../../core/promiseUtils","../../../../../../geometry/support/aaBoundingRect","../../../../../../rest/query/operations/query","../Tile","../featureSet/PBFPointFeatureSetView"],function(e,t,r,i,o,s){"use strict";e.Tile3DFetcher=class{constructor(e,t,r,i,o){this.spatialReference=e,this.url=r,this.objectIdField=i,this.capabilities=o;const{supportsMaxRecordCountFactor:s,maxRecordCount:n}=this.capabilities.query,a=s?4:1,l=(n??8e3)*a;this._pageSize=Math.min(8e3,l);const c=t.clone();c.cacheHint=!0,c.resultType="tile",c.outSpatialReference=e,c.returnGeometry=!0,c.returnZ=!0,c.maxRecordCountFactor=a,c.num=this._pageSize,c.outFields=[i],this._baseQuery=c}async fetch(e,i){const{spatialReference:s,_pageSize:n}=this,a=r.toExtent(e.extent,s),l=this._baseQuery.clone();l.geometry=a;const c=new Array;let u=0,d=!1,p=1;for(;!d;){const e=[];for(let t=0;t<p;++t)e.push(this._fetchPage(l,u++,i));const r=await Promise.all(e);t.throwIfAborted(i);for(const e of r){const t=0!==e.featureCount;d||=!e.exceededTransferLimit||!t,t&&c.push(e)}p=Math.min(p+1,4)}return new o.Tile(e,c,n)}async _fetchPage(e,r,o){const n=e.clone();n.start=r*this._pageSize;const a=(await i.executeQueryPBFBuffer(this.url,n,{signal:o})).data;return t.throwIfAborted(o),new s.PBFPointFeatureSetView(a)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/query":function(){define(["exports","../../../request","../../../core/urlUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","../../operations/urlUtils","./pbfQueryUtils","./queryZScale"],function(e,t,r,i,o,s,n,a,l){"use strict";const c="Layer does not support extent calculation.";function u(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function d(e,t,r){const o=e.geometry,n=e.toJSON();delete n.compactGeometryEnabled,delete n.defaultSpatialReferenceEnabled;const a=n;let l,c,d;if(o&&(c=o.spatialReference,d=s.srToRESTValue(c),a.geometryType=i.getJsonType(o),a.geometry=u(o,e.compactGeometryEnabled),a.inSR=d),n.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=n.groupByFieldsForStatistics.join(",")),n.objectIds)switch(r?.uniqueIdFields?.length){case void 0:a.objectIds=n.objectIds.join(",");break;case 1:a.uniqueIds=JSON.stringify(n.objectIds),delete a.objectIds;break;default:a.uniqueIds=JSON.stringify(n.objectIds.map(e=>JSON.parse(e))),delete a.objectIds}if(n.orderByFields&&(a.orderByFields=n.orderByFields.join(",")),!n.outFields||!n.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete a.outFields:n.outFields.includes("*")?a.outFields="*":a.outFields=n.outFields.join(","),n.outSR?(a.outSR=s.srToRESTValue(n.outSR),l=e.outSpatialReference):o&&(n.returnGeometry||n.returnCentroid)&&(a.outSR=a.inSR,l=c),n.returnGeometry&&delete n.returnGeometry,n.outStatistics&&(a.outStatistics=JSON.stringify(n.outStatistics)),n.fullText&&(a.fullText=JSON.stringify(n.fullText)),n.pixelSize&&(a.pixelSize=JSON.stringify(n.pixelSize)),n.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=c&&null!=e.quantizationParameters?.extent&&c.equals(e.quantizationParameters.extent.spatialReference)&&delete n.quantizationParameters.extent.spatialReference,a.quantizationParameters=JSON.stringify(n.quantizationParameters)),n.parameterValues&&(a.parameterValues=JSON.stringify(n.parameterValues)),n.rangeValues&&(a.rangeValues=JSON.stringify(n.rangeValues)),n.dynamicDataSource&&(a.layer=JSON.stringify({source:n.dynamicDataSource}),delete n.dynamicDataSource),n.timeExtent){const e=n.timeExtent,{start:t,end:r}=e;null==t&&null==r||(a.time=t===r?t:`${t??"null"},${r??"null"}`),delete n.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=c&&null!=l&&c.equals(l)&&(a.defaultSR=a.inSR,delete a.inSR,delete a.outSR),a}function p(e,t,r,i){return f(e,t,"pbf",r,void 0,i)}function h(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;const r={...e,returnUniqueIdsOnly:!0};return delete r.returnIdsOnly,r}async function f(e,i,s,a={},l={},c={}){const u="string"==typeof e?r.urlToObject(e):e,p=i.geometry?[i.geometry]:[],f=await o.normalizeCentralMeridian(p,null,{signal:a.signal}),m=f?.[0];null!=m&&((i=i.clone()).geometry=m);const y=n.mapParameters({...u.query,f:s,...h(l,c),...d(i,l,c)});return t(r.join(u.path,function(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}(i,l)?"query3d":"query"),{...a,responseType:"pbf"===s?"array-buffer":"json",query:{...y,...a.query}})}e.encodeGeometry=u,e.executeQuery=async function(e,t,r,i,o){const s=t.timeExtent?.isEmpty?{data:{features:[]}}:await f(e,t,"json",i,void 0,o);return l.applyFeatureSetZUnitScaling(t,r,s.data),s},e.executeQueryForCount=function(e,t,r,i){return t.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):f(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0},i)},e.executeQueryForExtent=async function(e,t,r){if(t.timeExtent?.isEmpty)return{data:{count:0,extent:null}};const i=await f(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),o=i.data;if(o.hasOwnProperty("extent"))return i;if(o.features)throw new Error(c);if(o.hasOwnProperty("count"))throw new Error(c);return i},e.executeQueryForIds=function(e,t,r,i){return t.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):f(e,t,"json",r,{returnIdsOnly:!0},i)},e.executeQueryPBF=async function(e,t,r,i,o){if(t.timeExtent?.isEmpty)return{data:r.createFeatureResult()};const s=await p(e,t,i,o),n=s;return n.data=a.parsePBFFeatureQuery(s.data,r),n},e.executeQueryPBFBuffer=p,e.queryToQueryStringParameters=d,e.runQuery=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/urlUtils":function(){define(["exports"],function(e){"use strict";e.mapParameters=function e(t){const r={};for(const i in t){if("declaredClass"===i)continue;const o=t[i];if(null!=o&&"function"!=typeof o)if(Array.isArray(o)){r[i]=[];for(let t=0;t<o.length;t++)r[i][t]=e(o[t])}else"object"==typeof o?o.toJSON&&(r[i]=JSON.stringify(o)):r[i]=o}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfQueryUtils":function(){define(["exports","./pbfFeatureServiceParser"],function(e,t){"use strict";e.parsePBFFeatureQuery=function(e,r){const i=t.parseFeatureQuery(e,r),o=i.queryResult.featureResult,s=i.queryResult.queryGeometry,n=i.queryResult.queryGeometryType;if(o&&o.features&&o.features.length&&o.objectIdFieldName){const e=o.objectIdFieldName;for(const t of o.features)t.attributes&&(t.objectId=t.attributes[e])}return o&&(o.queryGeometry=s,o.queryGeometryType=n),o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfFeatureServiceParser":function(){define(["exports","../../../core/Error","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],function(e,t,r,i,o){"use strict";const s=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],n=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],a=["upperLeft","lowerLeft"];function l(e){return e>=s.length?null:s[e]}function c(e){return e>=n.length?null:n[e]}function u(e){return e>=a.length?null:a[e]}function d(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function p(e,t,r){const i=e.asUnsafe(),o=t.createPointGeometry(r);for(;i.next();)switch(i.tag()){case 3:{const e=i.getUInt32(),r=i.pos()+e;let s=0;for(;i.pos()<r;)t.addCoordinatePoint(o,i.getSInt64(),s++);break}default:i.skip()}return o}function h(e,t,r){const i=e.asUnsafe(),o=t.createGeometry(r),s=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;i.next();)switch(i.tag()){case 2:{const e=i.getUInt32(),r=i.pos()+e;let s=0;for(;i.pos()<r;)t.addLength(o,i.getUInt32(),s++);break}case 3:{const e=i.getUInt32(),r=i.pos()+e;let n=0;for(t.allocateCoordinates(o);i.pos()<r;)t.addCoordinate(o,i.getSInt64(),n),n++,n===s&&(n=0);break}default:i.skip()}return o}function f(e){const t=e.asUnsafe(),r=new i;let s="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),i=t.pos()+e;for(;t.pos()<i;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),i=t.pos()+e;for(;t.pos()<i;)r.coords.push(t.getSInt64());break}case 1:s=o.optimizedGeometryTypes[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:s}}function m(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function y(e){const t=e.asUnsafe(),r={type:l(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=l(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=c(t.getEnum());break;case 5:default:t.skip();break;case 6:r.defaultValue=t.getString()}return r}function g(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function b(e,t,r,i){const o=t.createFeature(r);let s=0;for(;e.next();)switch(e.tag()){case 1:{const t=i[s++].name;o.attributes[t]=e.processMessage(m);break}case 2:o.geometry=e.processMessageWithArgs(h,t,r);break;case 4:o.centroid=e.processMessageWithArgs(p,t,r);break;default:e.skip()}return o}function _(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function v(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t={originPosition:u(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=u(r.getEnum());break;case 2:t.scale=r.processMessage(_);break;case 3:t.translate=r.processMessage(v);break;default:r.skip()}return t}function x(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function w(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function M(e,t){const r=t.createFeatureResult(),i=e.asUnsafe();r.geometryType=d(t,0);let o=!1;for(;i.next();)switch(i.tag()){case 1:r.objectIdFieldName=i.getString();break;case 3:r.globalIdFieldName=i.getString();break;case 4:r.geohashFieldName=i.getString();break;case 5:r.geometryProperties=i.processMessage(x);break;case 7:r.geometryType=d(t,i.getEnum());break;case 8:r.spatialReference=i.processMessageWithArgs(w,t);break;case 10:r.hasZ=i.getBool();break;case 11:r.hasM=i.getBool();break;case 12:r.transform=i.processMessage(S);break;case 9:r.exceededTransferLimit=i.getBool();break;case 13:t.addField(r,i.processMessage(y));break;case 15:o||(t.prepareFeatures(r),o=!0),t.addFeature(r,i.processMessageWithArgs(b,t,r,r.fields));break;case 2:r.uniqueIdField=i.processMessage(g);break;default:i.skip()}return t.finishFeatureResult(r),r}function T(e,t){const r={};let i=null;for(;e.next();)switch(e.tag()){case 4:i=e.processMessageWithArgs(f);break;case 1:r.featureResult=e.processMessageWithArgs(M,t);break;default:e.skip()}return null!=i&&r.featureResult&&t.addQueryGeometry(r,i),r}e.parseFeatureQuery=function(e,i){try{const t=2,o=new r(new Uint8Array(e),new DataView(e)),s={};for(;o.next();)o.tag()===t?s.queryResult=o.processMessageWithArgs(T,i):o.skip();return s}catch(e){throw new t("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}},e.parseField=y,e.parseFieldType=l,e.parseTransform=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfOptimizedFeatureSet":function(){define(["exports","../../../core/unitUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/graphics/OptimizedFeature","../../../layers/graphics/OptimizedFeatureSet","../../../layers/graphics/OptimizedGeometry"],function(e,t,r,i,o,s){"use strict";const n=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];e.OptimizedFeatureSetParserContext=class{constructor(e){this._options=e,this.geometryTypes=n,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new o}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||r.equals(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const o=t.getMetersPerVerticalUnitForSR(this._options.sourceSpatialReference)/t.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==o)for(const t of e.features){if(!i.hasGeometry(t))continue;const e=t.geometry.coords;for(let t=2;t<e.length;t+=3)e[t]*=o}}addFeature(e,t){e.features.push(t)}createFeature(){return new i.OptimizedFeature(null,{},null,0)}createSpatialReference(){return{wkid:0}}createGeometry(){return new s}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((e,t)=>e+t,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new s}},e.optimizedGeometryTypes=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/queryZScale":function(){define(["exports","../../../geometry/support/zscale"],function(e,t){"use strict";e.applyFeatureSetZUnitScaling=function(e,r,i){if(!i?.features||!i.hasZ)return;const o=t.getGeometryZScaler(i.geometryType,r,e.outSpatialReference);if(null!=o)for(const e of i.features)o(e.geometry)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/Tile":function(){define(["exports","../../../../../core/memoryEstimations"],function(e,t){"use strict";e.Tile=class{constructor(e,r,i){this.descriptor=e,this._pages=r,this._pageSize=i;const o=t.baseArrayMemory+r.reduce((e,{usedMemory:t})=>e+t,0),s=3*t.estimateNumberMemory;this.usedMemory=t.baseObjectMemory+o+s,this.featureCount=r.reduce((e,t)=>e+t.featureCount,0)}get id(){return this.descriptor.id}getObjectId(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getObjectId(r)}getAttribute(e,t){const{pageIndex:r,featurePageIndex:i}=this._translateIndex(e);return this._pages[r].getAttribute(i,t)}getAttributeAsTimestamp(e,t){const{pageIndex:r,featurePageIndex:i}=this._translateIndex(e);return this._pages[r].getAttributeAsTimestamp(i,t)}getAttributes(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getAttributes(r)}getCoordinates(e,t,r){const{pageIndex:i,featurePageIndex:o}=this._translateIndex(e);this._pages[i].getCoordinates(o,t,r)}getOptimizedGeometry(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getOptimizedGeometry(r)}getCentroid(e,t){const{pageIndex:r,featurePageIndex:i}=this._translateIndex(e);return this._pages[r].getCentroid(i,t)}getBounds(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getBounds(r)}getBoundingBox(e){const{pageIndex:t,featurePageIndex:r}=this._translateIndex(e);return this._pages[t].getBoundingBox(r)}getObjectIdsArray(e,t=this._allFeatureIndices(),r=0){let i=r;for(const{page:r,indices:o}of this._batchPageIndices(t))i=r.getObjectIdsArray(e,o,i);return i}getCoordinatesArray(e,t=this._allFeatureIndices(),r=0){let i=r;for(const{page:r,indices:o}of this._batchPageIndices(t))i=r.getCoordinatesArray(e,o,i);return i}*objectIds(e=this._allFeatureIndices()){for(const{page:t,indices:r}of this._batchPageIndices(e))for(const e of t.objectIds(r))yield e}*_allFeatureIndices(){const{featureCount:e}=this;for(let t=0;t<e;++t)yield t}_translateIndex(e){const{_pageSize:t}=this;return{pageIndex:Math.floor(e/t),featurePageIndex:e%t}}*_batchPageIndices(e){const t=new Array;{let r=0,i=new Array;for(const o of e){const{pageIndex:e,featurePageIndex:s}=this._translateIndex(o);r!==e&&(0!==i.length&&t.push({pageIndex:r,indices:i}),r=e,i=[]),i.push(s)}0!==i.length&&t.push({pageIndex:r,indices:i})}const{_pages:r}=this;for(const{pageIndex:e,indices:i}of t)yield{page:r[e],indices:i}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/featureSet/PBFPointFeatureSetView":function(){define(["exports","../../../../../../core/Error","../../../../../../core/pbf","../../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../../core/libs/rbush/PooledRBush","../../../../../../geometry/support/aaBoundingBox","../../../../../../geometry/support/quantizationUtils","../../../../../../layers/graphics/OptimizedGeometry","../../../../../../layers/support/FieldsIndex","../../../../../../rest/query/operations/pbfFeatureServiceParser"],function(e,t,r,i,o,s,n,a,l,c){"use strict";function u(e){for(;e.next();){if(1===e.tag())return d(e.getMessage());e.skip()}p()}function d(e){let t,r,i=!1,o=!1,s=0;const a=new Array,u=new Array,d=new Array;for(;e.next();)switch(e.tag()){case 1:r=e.getString();break;case 7:0!==e.getEnum()&&p();break;case 9:i=e.getBool()??!1;break;case 12:t=n.normalizeTransform(e.processMessage(c.parseTransform));break;case 13:{const t=e.processMessage(c.parseField);t.index=s++,a.push(t);break}case 15:{u.push(e.pos());const t=e.getUInt32(),r=e.pos()+t;for(;e.pos()<r&&e.next();)1===e.tag()?(d.push(e.pos()),e.skip()):e.skip();break}case 10:o=e.getBool()??!1;break;default:e.skip()}const h=new l(a);return null!=t&&o&&null!=r&&h.has(r)||p(),{transform:t,exceededTransferLimit:i,fieldsIndex:h,objectIdFieldName:r,featureIndices:u,attributeIndices:d}}function p(){const e=new t("pbf-parsing-failed","Error while parsing PBF",new Error);throw console.error(e),e}function h(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}const f=i.create();e.PBFPointFeatureSetView=class{constructor(e){this._reader=new r(new Uint8Array(e),new DataView(e)),this._index=function(e){for(;e.next();){if(2===e.tag())return u(e.getMessage());e.skip()}p()}(this._reader)}get featureCount(){return this._index.featureIndices.length}get exceededTransferLimit(){return this._index.exceededTransferLimit}get usedMemory(){return this._reader.usedMemory}getObjectId(e){return this.getAttribute(e,this._index.objectIdFieldName)}getAttribute(e,t){const{_index:{fieldsIndex:r,attributeIndices:i}}=this,o=r.get(t)?.index;if(null==o)return;const s=i[e*r.fields.length+o],n=this._reader;return n.move(s),h(n)}getAttributeAsTimestamp(e,t){const r=this.getAttribute(e,t);return"string"==typeof r?new Date(r).getTime():"number"==typeof r||null==r?r:null}getAttributes(e){const{_index:{fieldsIndex:t,attributeIndices:r}}=this,i=e*t.fields.length,o=this._reader,s={};for(const e of t.fields){const t=r[i+e.index];o.move(t),s[e.name]=h(o)}return s}getCoordinates(e,t,r=0){const i=this._reader,{transform:o,featureIndices:s}=this._index,{scale:n,translate:a}=o;i.move(s[e]),this._readCoordinates(n,a,t,r)}getOptimizedGeometry(e){const t=i.create();return this.getCoordinates(e,t),new a([],t)}getCentroid(e,{hasZ:t,hasM:r}){this.getCoordinates(e,f);const[i,o,s]=f,n=[i,o];return t&&(n[3]=s),r&&(n[t?4:3]=0),new a([],n)}getBounds(e){this.getCoordinates(e,f);const[t,r]=f,i=new o.BBox;return i.minX=t,i.minY=r,i.maxX=t,i.maxY=r,i}getBoundingBox(e){this.getCoordinates(e,f);const[t,r,i]=f;return s.fromValues(t,r,i,t,r,i)}getObjectIdsArray(e,t=this._allFeatureIndices(),r=0){const i=this._reader,{objectIdFieldName:o,attributeIndices:s,fieldsIndex:n}=this._index,a=n.get(o).index,l=n.fields.length;for(const o of t){const t=s[o*l+a];i.move(t),e[r++]=h(i)}return r}getCoordinatesArray(e,t=this._allFeatureIndices(),r=0){const i=this._reader,{transform:o,featureIndices:s}=this._index,{scale:n,translate:a}=o;for(const o of t){const t=s[o];i.move(t),r=this._readCoordinates(n,a,e,r)}return r}*objectIds(e=this._allFeatureIndices()){const t=this._reader,{objectIdFieldName:r,attributeIndices:i,fieldsIndex:o}=this._index,s=o.get(r).index,n=o.fields.length;for(const r of e){const e=i[r*n+s];t.move(e),yield h(t)}}*_allFeatureIndices(){const{featureCount:e}=this;for(let t=0;t<e;++t)yield t}_readCoordinates([e,t,r],[i,o,s],n,a){const l=this._reader,c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)switch(l.tag()){case 2:{const c=l.getLength(),u=l.pos()+c;for(;l.pos()<u&&l.next();)3===l.tag()?(l.getUInt32(),n[a++]=i+e*l.getSInt64(),n[a++]=o+t*l.getSInt64(),n[a++]=s+r*l.getSInt64()):l.skip();break}default:l.skip()}return a}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pipeline/rendering/RenderCommandContext":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat4","../../../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../../../geometry/support/Indices","../PipelineCommand","../utils","../../../../webgl-engine/lib/BoundingInfo","../../../../webgl-engine/materials/DefaultMaterial","../../../../webgl-engine/materials/HUDMaterial"],function(e,t,r,i,o,s,n,a,l){"use strict";const c=r.create(),u=r.create();e.RenderCommandContext=class{constructor(e,t){this._mainThreadDelegate=t,this._bufferWriters=new Map,this.globalViewingMode=1===e}createRenderCommandBuffer(e=[],t=[]){return{commands:e,transferList:t}}mergeRenderCommandBuffers(e){const t=this.createRenderCommandBuffer();for(const r of e)null!=r&&(t.commands.push(...r.commands),t.transferList.push(...r.transferList));return t}async createTexture(e){const{data:t,parameters:r}=e();return await this._mainThreadDelegate.createTexture(t,r)}async releaseTexture(e){const t=this._destroyTexture(e);return new o.PipelineCommand(this,t,[])}_destroyTexture(e){return{commands:[{id:"destroy-texture",textureId:e}],transferList:[]}}async createMaterial(e){const{type:t,parameters:r}=e,i=s.generateId("material");let o,n;switch(t){case"default":o=new a.DefaultMaterial(e.parameters,{spherical:this.globalViewingMode}),n={type:t,materialId:i,parameters:e.parameters};break;case"hud":o=new l.HUDMaterial(r,this.globalViewingMode),n={type:t,materialId:i,parameters:e.parameters}}return this._bufferWriters.set(i,o.createBufferWriter()),await this._mainThreadDelegate.createMaterial(n),i}destroyMaterial(e){return{commands:[{id:"destroy-material",materialId:e}],transferList:[]}}updateMaterial(e){return{commands:[{...e,id:"update-material"}],transferList:[]}}async createDirectRenderer(e){return await this._mainThreadDelegate.createDirectRenderer(e),e}async destroyDirectRenderer(e){await this._mainThreadDelegate.destroyDirectRenderer(e)}addDirectRendererGeometry(e,t,r){const{materialId:i}=t;if(null==this._bufferWriters.get(i))throw new Error(`no bufferwriter found for material ${i}`);const{renderGeometryBuffer:o,renderGeometryBufferItems:s}=this.createRenderGeometryBuffer(t,r);return this.addDirectRendererGeometryBuffer(i,e,o,s,r)}updateDirectRendererGeometry(e,t,r){const{materialId:i}=t;if(null==this._bufferWriters.get(i))throw new Error(`no bufferwriter found for material ${i}`);const{renderGeometryBuffer:o,renderGeometryBufferItems:s}=this.createRenderGeometryBuffer(t,r);return this.updateDirectRendererGeometryBuffer(i,e,o,s,r)}addDirectRendererGeometryBuffer(e,t,r,i,o){const{objectIds:s,visibilities:n}=i;return{commands:[{id:"add-direct-renderer-geometry-buffer",rendererId:e,groupId:t,renderGeometryBuffer:r,renderGeometryBufferItems:i,localOrigin:o}],transferList:[r.data,s.buffer,n.buffer]}}updateDirectRendererGeometryBuffer(e,t,r,i,o){const{objectIds:s,visibilities:n}=i;return{commands:[{id:"update-direct-renderer-geometry-buffer",rendererId:e,groupId:t,renderGeometryBuffer:r,renderGeometryBufferItems:i,localOrigin:o}],transferList:[r.data,s.buffer,n.buffer]}}removeDirectRendererGeometryBuffer(e,t){return{commands:[{id:"remove-direct-renderer-geometry-buffer",rendererId:e,groupId:t}],transferList:[]}}async createLodRenderer(e){const t=s.generateId("lod-renderer"),r=new Set,o={levels:e.levels.map(e=>({components:e.components.map(e=>{const t=e.attributes.get("position");if(!t||0===t.indices.length)throw new Error("positions attribute expected");const o=i.getContinuousIndexArray(t.indices.length/3),s=new n.BoundingInfo(o,3,t);if(null==this._bufferWriters.get(e.materialId))throw new Error("writer not found");const{renderGeometryBuffer:a}=this.createRenderGeometryBuffer(e,null);return r.add(a.data),{materialId:e.materialId,renderGeometryBuffer:a,boundingInfo:{bbMax:s.bbMax,bbMin:s.bbMin}}}),minScreenSpaceRadius:e.minScreenSpaceRadius}))};return await this._mainThreadDelegate.createLodRenderer(t,o,Array.from(r)),t}destroyLodRenderer(e){return{commands:[{id:"destroy-lod-renderer",rendererId:e}],transferList:[]}}addLodInstances(e,t,r){return{commands:[{id:"add-lod-instances",rendererId:e,groupId:t,data:r}],transferList:[r.featureIds.buffer,r.globalTransforms.buffer,r.localTransforms.buffer,r.visibility.buffer]}}removeLodInstances(e,t){return{commands:[{id:"remove-lod-instances",rendererId:e,groupId:t}],transferList:[]}}updateLodInstancesData(e,t,r){return{commands:[{id:"update-lod-instance-data",rendererId:e,groupId:t,globalTransforms:r}],transferList:[r.buffer]}}updateVisibility(e,t,r){return{commands:[{id:"update-visibility",rendererId:e,groupId:t,visibility:r}],transferList:[r.buffer]}}async dispatchRenderCommands(e){0!==e.commands.length&&await this._mainThreadDelegate.executeRenderCommands(e)}createRenderGeometryBuffer(e,r){const{materialId:i,visibilities:o,objectIds:s}=e,n=this._bufferWriters.get(i);if(null==n)throw new Error("no registered bufferWriter for material found");let a=null;if(e.transformation&&r)t.copy(c,e.transformation),c[12]-=r[0],c[13]-=r[1],c[14]-=r[2],a=c;else{if(r)throw new Error("not implemented");e.transformation&&(a=e.transformation)}let l=null;a&&(t.invert(u,c),t.transpose(u,u),l=u);const d=e.attributes,p=n.elementCount(d),h=n.layout.stride/4;p>Math.floor(4194304/h)&&console.warn("geometry with very large number of elements encountered");const f=n.layout.createBuffer(p),m=n.write(a,l,d,e.olidColor,f,0);if(null==m)throw new Error("Bufferwriter.write does not provide item information.");if(o.length!==m.numItems||s.length!==m.numItems)throw new Error("Unexpected mismatch between number of RenderGeometryBufferItems and provided objectIds/visibility flags.");return{renderGeometryBuffer:{data:f.buffer,elementCount:p},renderGeometryBufferItems:{objectIds:s,visibilities:o,ranges:{numVertices:m.numVerticesPerItem,numItems:m.numItems}}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../core/libs/gl-matrix-2/math/mat4","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../core/libs/gl-matrix-2/types/mat4","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/buffer/BufferView","../../layers/support/FastSymbolUpdates","../../support/debugFlags","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/hud/HUD.glsl","../effects/geometry/olidUtils","../lib/GLTextureMaterial","../lib/Material","../lib/screenSizePerspectiveUtils","../lib/Util","./ScaleInfo","./internal/bufferWriterUtils","./internal/MaterialUtil","../../../../chunks/HUDMaterial.glsl","../shaders/HUDMaterialTechnique","../shaders/HUDMaterialTechniqueConfiguration","../../../../webscene/support/AlphaCutoff"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M,T,P,I,C,O){"use strict";class F extends v.Material{constructor(e,t){super(e,ee),this.produces=new Map([[13,e=>y.isColorEmissionHighlightOrOID(e)&&!this.parameters.drawAsLabel],[14,e=>y.isColorEmissionHighlightOrOID(e)&&this.parameters.drawAsLabel],[12,()=>this.parameters.occlusionTest],[18,e=>this.parameters.draped&&y.isColorEmissionHighlightOrOID(e)]]),this._visible=!0,this._configuration=new C.HUDMaterialTechniqueConfiguration(t)}getConfiguration(e,t){const r=this.parameters.draped;return super.getConfiguration(e,t,this._configuration),this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset,this._configuration.hasScreenSizePerspective=!!this.parameters.screenSizePerspective,this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits,this._configuration.hasPolygonOffset=this.parameters.polygonOffset,this._configuration.draped=r,this._configuration.occlusionTestEnabled=this.parameters.occlusionTest,this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled,this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField,this._configuration.sampleSignedDistanceFieldTexelCenter=this.parameters.sampleSignedDistanceFieldTexelCenter,this._configuration.hasRotation=this.parameters.hasRotation,this._configuration.hasVVSize=!!this.parameters.vvSize,this._configuration.hasVVColor=!!this.parameters.vvColor,this._configuration.occlusionPass=12===t.slot,this._configuration.occludedFragmentFade=!r&&this.parameters.occludedFragmentFade,this._configuration.horizonCullingEnabled=this.parameters.horizonCullingEnabled,this._configuration.isFocused=this.parameters.isFocused,this._configuration.depthTestEnabled=this.parameters.depthEnabled||12===t.slot,y.isColorOrColorEmission(e)&&(this._configuration.debugDrawLabelBorder=!!m.debugFlags.LABELS_SHOW_BORDER),this._configuration.oitPass=t.oitPass,this._configuration.terrainDepthTest=t.terrainDepthTest,this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration}intersect(e,t,i,s,n,a){const{options:{selectionMode:d,hud:p,excludeLabels:h},point:f,camera:m}=i,{parameters:y}=this;if(!d||!p||h&&y.isLabel||!e.visible||!f||!m)return;const g=e.attributes.get("featureAttribute"),b=null==g?null:u.fromArray(g.data,J),{scaleX:_,scaleY:v}=re(b,y,m.pixelRatio);r.fromMat4(k,t),e.attributes.has("featureAttribute")&&function(e){const t=e[0],r=e[1],i=e[2],o=e[3],s=e[4],n=e[5],a=e[6],l=e[7],c=e[8],u=1/Math.sqrt(t*t+r*r+i*i),d=1/Math.sqrt(o*o+s*s+n*n),p=1/Math.sqrt(a*a+l*l+c*c);e[0]=t*u,e[1]=r*u,e[2]=i*u,e[3]=o*d,e[4]=s*d,e[5]=n*d,e[6]=a*p,e[7]=l*p,e[8]=c*p}(k);const w=e.attributes.get("position"),M=e.attributes.get("size"),T=e.attributes.get("normal"),I=e.attributes.get("rotation"),C=e.attributes.get("centerOffsetAndDistance");x.assert(w.size>=3);const O=P.calculateAnchorPosition(y),F="screen"===this.parameters.centerOffsetUnits;for(let e=0;e<w.data.length/w.size;e++){const r=e*w.size;l.set(V,w.data[r],w.data[r+1],w.data[r+2]),l.transformMat4(V,V,t),l.transformMat4(V,V,m.viewMatrix);const s=e*C.size;if(l.set(W,C.data[s],C.data[s+1],C.data[s+2]),!F&&(V[0]+=W[0],V[1]+=W[1],0!==W[2])){const e=W[2];l.normalize(W,V),l.subtract(V,V,l.scale(W,W,e))}const n=e*T.size;if(l.set(L,T.data[n],T.data[n+1],T.data[n+2]),R(L,k,m,Y),ie(this.parameters,V,Y,m,E),m.applyProjection(V,z),z[0]>-1){F&&(W[0]||W[1])&&(z[0]+=W[0]*m.pixelRatio,0!==W[1]&&(z[1]+=S.applyScaleFactor(W[1],E.factorAlignment)*m.pixelRatio),m.unapplyProjection(z,V)),z[0]+=this.parameters.screenOffset[0]*m.pixelRatio,z[1]+=this.parameters.screenOffset[1]*m.pixelRatio,z[0]=Math.floor(z[0]),z[1]=Math.floor(z[1]);const t=e*M.size;X[0]=M.data[t],X[1]=M.data[t+1],S.applyPrecomputedScaleFactor(X,E.factor,X);const r=Z*m.pixelRatio;let s=0;y.textureIsSignedDistanceField&&(s=Math.min(y.outlineSize,.5*X[0])*m.pixelRatio/2),X[0]*=_,X[1]*=v;const n=e*I.size,u=y.rotation+I.data[n];if(D(f,z[0],z[1],X,r,s,u,y,O)){const e=i.ray;if(l.transformMat4(j,V,o.invert(G,m.viewMatrix)),z[0]=f[0],z[1]=f[1],m.unprojectFromRenderScreen(z,V)){const t=c.create();l.copy(t,e.direction);const r=1/l.length(t);l.scale(t,t,r),a(l.distance(e.origin,V)*r,t,-1,j)}}}}}intersectDraped(e,t,r,i,o){const s=e.attributes.get("position"),n=e.attributes.get("size"),a=e.attributes.get("rotation"),l=this.parameters,c=P.calculateAnchorPosition(l),d=e.attributes.get("featureAttribute"),p=null==d?null:u.fromArray(d.data,J),{scaleX:h,scaleY:f}=re(p,l,e.screenToWorldRatio),m=Q*e.screenToWorldRatio;for(let t=0;t<s.data.length/s.size;t++){const u=t*s.size,d=s.data[u],p=s.data[u+1],y=t*n.size;X[0]=n.data[y],X[1]=n.data[y+1];let g=0;l.textureIsSignedDistanceField&&(g=Math.min(l.outlineSize,.5*X[0])*e.screenToWorldRatio/2),X[0]*=h,X[1]*=f;const b=t*a.size,_=l.rotation+a.data[b];D(r,d,p,X,m,g,_,l,c)&&i(o.distance,o.normal,-1)}}createBufferWriter(){return new te}applyShaderOffsetsView(e,t,r,i,o,s,n){const a=R(t,r,o,Y);return this._applyVerticalGroundOffsetView(e,a,o,n),ie(this.parameters,n,a,o,s),this._applyPolygonOffsetView(n,a,i[3],o,n),this._applyCenterOffsetView(n,i,n),n}applyShaderOffsetsNDC(e,t,r,i,o){return this._applyCenterOffsetNDC(e,t,r,i),null!=o&&l.copy(o,i),this._applyPolygonOffsetNDC(i,t,r,i),i}_applyPolygonOffsetView(e,r,i,o,s){const n=o.aboveGround?1:-1;let a=Math.sign(i);0===a&&(a=n);const c=n*a;if(this.parameters.shaderPolygonOffset<=0)return l.copy(s,e);const u=t.clamp(Math.abs(r.cosAngle),.01,1),d=1-Math.sqrt(1-u*u)/u/o.viewport[2];return c>0?l.scale(s,e,d):l.scale(s,e,1/d),s}_applyVerticalGroundOffsetView(e,t,r,i){const o=l.length(e),s=r.aboveGround?1:-1,n=r.computeRenderPixelSizeAtDist(o)*g.HUDVerticalPixelOffset,a=l.scale(V,t.normal,s*n);return l.add(i,e,a),i}_applyCenterOffsetView(e,t,r){const i="screen"!==this.parameters.centerOffsetUnits;return r!==e&&l.copy(r,e),i&&(r[0]+=t[0],r[1]+=t[1],t[2]&&(l.normalize(L,r),l.sub(r,r,l.scale(L,L,t[2])))),r}_applyCenterOffsetNDC(e,t,r,i){const o="screen"!==this.parameters.centerOffsetUnits;return i!==e&&l.copy(i,e),o||(i[0]+=t[0]/r.fullWidth*2,i[1]+=t[1]/r.fullHeight*2),i}_applyPolygonOffsetNDC(e,t,r,i){const o=this.parameters.shaderPolygonOffset;if(e!==i&&l.copy(i,e),o){const e=r.aboveGround?1:-1,s=e*Math.sign(t[3]);i[2]-=(s||e)*o}return i}set visible(e){this._visible=e}get visible(){const{color:e,outlineSize:t,outlineColor:r}=this.parameters,i=e[3]>=O.alphaCutoff||t>=O.alphaCutoff&&r[3]>=O.alphaCutoff;return this._visible&&i}createGLMaterial(e){return new A(e)}calculateRelativeScreenBounds(e,t,r=p.create()){return function(e,t,r,i){i[0]=e.anchorPosition[0]*-t[0]+e.screenOffset[0]*r,i[1]=e.anchorPosition[1]*-t[1]+e.screenOffset[1]*r}(this.parameters,e,t,r),r[2]=r[0]+e[0],r[3]=r[1]+e[1],r}}class A extends _.GLTextureMaterial{constructor(e){super({...e,...e.material.parameters})}beginSlot(e){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.getTechnique(I.HUDMaterialTechnique,e)}}function R(e,t,i,o){return d.isMat4(t)&&(t=r.fromMat4(q,t)),l.transformMat3(o.normal,e,t),l.transformMat4(o.normal,o.normal,i.viewInverseTransposeMatrix),o.cosAngle=l.dot(U,K),o}function D(e,r,i,o,s,a,l,c,u){let d=r-s-o[0]*u[0],p=d+o[0]+2*s,h=i-s-o[1]*u[1],f=h+o[1]+2*s;const m=c.distanceFieldBoundingBox;return c.textureIsSignedDistanceField&&null!=m&&(d+=o[0]*m[0],h+=o[1]*m[1],p-=o[0]*(1-m[2]),f-=o[1]*(1-m[3]),d-=a,p+=a,h-=a,f+=a),n.set(N,r,i),n.rotate(B,e,N,t.deg2rad(l)),B[0]>d&&B[0]<p&&B[1]>h&&B[1]<f}const E=new w.ScaleInfo,V=c.create(),L=c.create(),z=u.create(),U=c.create(),j=c.create(),B=a.create(),N=a.create(),k=i.create(),q=i.create(),G=s.create(),H=u.create(),W=c.create(),$=c.create(),J=u.create(),Y={normal:U,cosAngle:0},Z=1,Q=2,X=a.fromValues(0,0),K=c.fromValues(0,0,1);class ee extends _.GLTextureMaterialBindParameters{constructor(){super(...arguments),this.renderOccluded=1,this.isDecoration=!1,this.color=u.freeze(1,1,1,1),this.polygonOffset=!1,this.anchorPosition=a.fromValues(.5,.5),this.screenOffset=[0,0],this.shaderPolygonOffset=1e-5,this.textureIsSignedDistanceField=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.outlineColor=u.freeze(1,1,1,1),this.outlineSize=0,this.distanceFieldBoundingBox=u.create(),this.rotation=0,this.hasRotation=!1,this.vvSizeEnabled=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.hasSlicePlane=!1,this.pixelSnappingEnabled=!0,this.occlusionTest=!0,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!1,this.centerOffsetUnits="world",this.drawAsLabel=!1,this.depthEnabled=!0,this.isFocused=!0,this.focusStyle="bright",this.draped=!1,this.isLabel=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}}class te{constructor(){this.layout=b.olidEnabled()?I.olidLayout:I.layout}elementCount(e){return 6*e.get("position").indices.length}write(e,t,r,i,o,s){const{position:n,normal:a,uvi:l,color:c,size:u,rotation:d,centerOffsetAndDistance:p,featureAttribute:f}=o;M.writePosition(r.get("position"),e,n,s,6),M.writeNormal(r.get("normal"),t,a,s,6);const m=r.get("uvi")?.data;let y=0,g=0,b=-1-P.fullUV,_=-1-P.fullUV;m&&m.length>=4&&(y=m[0],g=m[1],b=-1-m[2],_=-1-m[3]);let v=r.get("position").indices.length,S=s;for(let e=0;e<v;++e)l.set(S,0,y),l.set(S,1,g),S++,l.set(S,0,b),l.set(S,1,g),S++,l.set(S,0,b),l.set(S,1,_),S++,l.set(S,0,b),l.set(S,1,_),S++,l.set(S,0,y),l.set(S,1,_),S++,l.set(S,0,y),l.set(S,1,g),S++;M.writeColor(r.get("color"),4,c,s,6);const{data:x,indices:w}=r.get("size");v=w.length,S=s;for(let e=0;e<v;++e){const t=x[2*w[e]],r=x[2*w[e]+1];for(let e=0;e<6;++e)u.set(S,0,t),u.set(S,1,r),S++}if(M.writeBufferFloat(r.get("rotation"),d,s,6),r.get("centerOffsetAndDistance")?M.writeBufferVec4(r.get("centerOffsetAndDistance"),p,s,6):M.writeBufferVec4Zeros(p,s,6*v),r.get("featureAttribute")?M.writeBufferVec4(r.get("featureAttribute"),f,s,6):M.writeBufferVec4Zeros(f,s,6*v),null!=i){const e=r.get("position")?.indices;if(e){const t=e.length,r=o.getField("olidColor",h.BufferViewVec4u8);M.writeOlidColor(i,r,t,s,6)}}return{numVerticesPerItem:6,numItems:v}}intersect(e,t,r,i,s,n,a){const{options:{selectionMode:u,hud:d,excludeLabels:p},point:f,camera:m}=i;if(!u||!d||p&&t.isLabel||!f)return;const y=this.layout.createView(e),g=y.getField("position",h.BufferViewVec3f),b=y.getField("normal",h.BufferViewVec3f),_=y.getField("rotation",h.BufferViewFloat),v=y.getField("size",h.BufferViewVec2f),x=y.getField("featureAttribute",h.BufferViewVec4f),w=y.getField("centerOffsetAndDistance",h.BufferViewVec4f),M="screen"===t.centerOffsetUnits,T=P.calculateAnchorPosition(t);if(null==g||null==b||null==_||null==v||null==w||null==m)return;const I=null==x?null:x.getVec(0,J),{scaleX:C,scaleY:O}=re(I,t,m.pixelRatio),F=g.count/6;for(let e=0;e<F;e++){const s=6*e;if(g.getVec(s,V),null!=r&&l.add(V,V,r),l.transformMat4(V,V,m.viewMatrix),w.getVec(s,H),l.set(W,H[0],H[1],H[2]),!M&&(V[0]+=W[0],V[1]+=W[1],0!==W[2])){const e=W[2];l.normalize(W,V),l.subtract(V,V,l.scale(W,W,e))}if(b.getVec(s,L),R(L,k,m,Y),ie(t,V,Y,m,E),m.applyProjection(V,z),z[0]>-1){M&&(W[0]||W[1])&&(z[0]+=W[0]*m.pixelRatio,0!==W[1]&&(z[1]+=S.applyScaleFactor(W[1],E.factorAlignment)*m.pixelRatio),m.unapplyProjection(z,V)),z[0]+=t.screenOffset[0]*m.pixelRatio,z[1]+=t.screenOffset[1]*m.pixelRatio,z[0]=Math.floor(z[0]),z[1]=Math.floor(z[1]),v.getVec(s,X),S.applyPrecomputedScaleFactor(X,E.factor,X);const r=Z*m.pixelRatio;let n=0;t.textureIsSignedDistanceField&&(n=Math.min(t.outlineSize,.5*X[0])*m.pixelRatio/2),X[0]*=C,X[1]*=O;const u=_.get(s),d=t.rotation+u;if(D(f,z[0],z[1],X,r,n,d,t,T)){const t=i.ray;if(l.transformMat4(j,V,o.invert(G,m.viewMatrix)),z[0]=f[0],z[1]=f[1],m.unprojectFromRenderScreen(z,V)){const r=c.create();l.copy(r,t.direction);const i=1/l.length(r);l.scale(r,r,i),a(l.distance(t.origin,V)*i,r,e,j)}}}}}}function re(e,t,r){return null==e||null==t.vvSize?{scaleX:r,scaleY:r}:(f.evaluateModelTransformScale($,t,e),{scaleX:$[0]*r,scaleY:$[1]*r})}function ie(e,t,r,i,o){if(!e.verticalOffset?.screenLength)return e.screenSizePerspective||e.screenSizePerspectiveAlignment?oe(e,o,l.length(t),r.cosAngle):(o.factor.scale=1,o.factorAlignment.scale=1),t;const s=l.length(t),n=e.screenSizePerspectiveAlignment??e.screenSizePerspective,a=T.verticalOffsetAtDistance(i,s,e.verticalOffset,r.cosAngle,n);return oe(e,o,s,r.cosAngle),l.scale(r.normal,r.normal,a),l.add(t,t,r.normal)}function oe(e,t,r,i){null!=e.screenSizePerspective?S.precomputeScaleFactor(i,r,e.screenSizePerspective,t.factor):(t.factor.scale=1,t.factor.factor=0,t.factor.minScaleFactor=0),null!=e.screenSizePerspectiveAlignment?S.precomputeScaleFactor(i,r,e.screenSizePerspectiveAlignment,t.factorAlignment):(t.factorAlignment.factor=t.factor.factor,t.factorAlignment.scale=t.factor.scale,t.factorAlignment.minScaleFactor=t.factor.minScaleFactor)}e.HUDMaterial=F,e.Parameters=ee,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(e){"use strict";function t(e){return e instanceof Float32Array&&e.length>=16}function r(e){return Array.isArray(e)&&e.length>=16}e.isMat4=function(e){return t(e)||r(e)},e.isMat4f32=t,e.isMat4f64=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["exports","../attributes/VerticalOffset.glsl","../util/ScreenSizePerspective.glsl","../util/View.glsl","../../shaderModules/Float4BindUniform","../../shaderModules/FloatBindUniform","../../shaderModules/FloatPassUniform","../../shaderModules/glsl"],function(e,t,r,i,o,s,n,a){"use strict";e.HUD=function(e,l){e.include(r.ScreenSizePerspective),e.attributes.add("position","vec3"),e.attributes.add("normal","vec3"),e.attributes.add("centerOffsetAndDistance","vec4");const c=e.vertex;i.addProjViewLocalOrigin(c,l),i.addCameraPosition(c,l),c.uniforms.add(new o.Float4BindUniform("viewport",e=>e.camera.fullViewport),new n.FloatPassUniform("polygonOffset",e=>e.shaderPolygonOffset),new s.FloatBindUniform("cameraGroundRelative",e=>e.camera.aboveGround?1:-1)),l.hasVerticalOffset&&t.addVerticalOffset(c),c.code.add(a.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`),c.code.add(a.glsl`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = ${l.terrainDepthTest?a.glsl.float(0):a.glsl`sign(pointGroundDistance)`};
      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation: we take the absolute value because the sign that is
      // dropped is instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `),l.draped&&!l.hasVerticalOffset||i.addViewNormal(c),l.draped||(c.uniforms.add(new s.FloatBindUniform("perDistancePixelRatio",e=>Math.tan(e.camera.fovY/2)/(e.camera.fullViewport[2]/2))),c.code.add(a.glsl`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * ${a.glsl.float(.5)};

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `)),l.screenCenterOffsetUnitsEnabled&&i.addPixelRatio(c),l.hasScreenSizePerspective&&r.addScreenSizePerspectiveAlignment(c),c.code.add(a.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      vec3 centerOffset = centerOffsetAndDistance.xyz;
      float pointGroundDistance = centerOffsetAndDistance.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${l.draped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${l.hasScreenSizePerspective&&(l.hasVerticalOffset||l.screenCenterOffsetUnitsEnabled)?"vec3 perspectiveFactor = screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":""}

      ${l.hasVerticalOffset?l.hasScreenSizePerspective?"float verticalOffsetScreenHeight = applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight = verticalOffset.x;":""}

      ${l.hasVerticalOffset?a.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${l.screenCenterOffsetUnitsEnabled?"":a.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${l.screenCenterOffsetUnitsEnabled?l.hasScreenSizePerspective?"float centerOffsetY = applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY = centerOffset.y;":""}

      ${l.screenCenterOffsetUnitsEnabled?"posProj.xy += vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `)},e.HUDVerticalPixelOffset=.5,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports"],function(e){"use strict";class t{constructor(){this.scale=0,this.factor=0,this.minScaleFactor=0}}e.ScaleFactor=t,e.ScaleInfo=class{constructor(){this.factor=new t,this.factorAlignment=new t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDMaterial.glsl":function(){define(["exports","../core/libs/gl-matrix-2/math/vec2","../core/libs/gl-matrix-2/factories/vec2f64","../core/libs/gl-matrix-2/factories/vec4f64","../geometry/support/Ellipsoid","../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl","../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl","../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl","../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl","../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl","../views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl","../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl","../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl","../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl","../views/3d/webgl-engine/core/shaderModules/Float2PassUniform","../views/3d/webgl-engine/core/shaderModules/Float4BindUniform","../views/3d/webgl-engine/core/shaderModules/Float4DrawUniform","../views/3d/webgl-engine/core/shaderModules/Float4PassUniform","../views/3d/webgl-engine/core/shaderModules/FloatBindUniform","../views/3d/webgl-engine/core/shaderModules/FloatPassUniform","../views/3d/webgl-engine/core/shaderModules/glsl","../views/3d/webgl-engine/core/shaderModules/Texture2DBindUniform","../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform","../views/webgl/ShaderBuilder","../webscene/support/AlphaCutoff"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S,x,w,M,T,P,I){"use strict";function C(e){const r=new P.ShaderBuilder,{signedDistanceFieldEnabled:C,occlusionTestEnabled:R,horizonCullingEnabled:E,pixelSnappingEnabled:V,hasScreenSizePerspective:L,debugDrawLabelBorder:z,hasVVSize:U,hasVVColor:j,hasRotation:B,occludedFragmentFade:N,sampleSignedDistanceFieldTexelCenter:k}=e;r.include(l.HUD,e),r.vertex.include(s.RejectBySlice,e);const{occlusionPass:q,output:G,oitPass:H}=e;if(q)return r.include(c.HUDOcclusionPass,e),r;const{vertex:W,fragment:$}=r;r.include(m.ScreenSizePerspective),r.include(p.VisualVariables,e),r.include(n.ObjectAndLayerIdColor,e),R&&r.include(u.HUDVisibility),$.include(f.RgbaFloatEncoding),$.include(h.ColorConversion),r.varyings.add("vcolor","vec4"),r.varyings.add("vtc","vec2"),r.varyings.add("vsize","vec2");const J=8===G,Y=J&&R;Y&&r.varyings.add("voccluded","float"),W.uniforms.add(new b.Float4BindUniform("viewport",e=>e.camera.fullViewport),new g.Float2PassUniform("screenOffset",(e,r)=>t.set(A,2*e.screenOffset[0]*r.camera.pixelRatio,2*e.screenOffset[1]*r.camera.pixelRatio)),new g.Float2PassUniform("anchorPosition",e=>F(e)),new v.Float4PassUniform("materialColor",e=>e.color),new x.FloatPassUniform("materialRotation",e=>e.rotation),new T.Texture2DPassUniform("tex",e=>e.texture)),y.addPixelRatio(W),C&&(W.uniforms.add(new v.Float4PassUniform("outlineColor",e=>e.outlineColor)),$.uniforms.add(new v.Float4PassUniform("outlineColor",e=>O(e)?e.outlineColor:i.ZEROS),new x.FloatPassUniform("outlineSize",e=>O(e)?e.outlineSize:0))),E&&W.uniforms.add(new _.Float4DrawUniform("pointDistanceSphere",(e,t)=>{const r=t.camera.eye,s=e.origin;return i.fromValues(s[0]-r[0],s[1]-r[1],s[2]-r[2],o.earth.radius)})),V&&W.include(a.AlignPixel),L&&(m.addScreenSizePerspective(W),m.addScreenSizePerspectiveAlignment(W)),z&&r.varyings.add("debugBorderCoords","vec4"),r.attributes.add("uvi","vec2"),r.attributes.add("color","vec4"),r.attributes.add("size","vec2"),r.attributes.add("rotation","float"),(U||j)&&r.attributes.add("featureAttribute","vec4"),W.code.add(E?w.glsl`bool behindHorizon(vec3 posModel) {
vec3 camToEarthCenter = pointDistanceSphere.xyz - localOrigin;
vec3 camToPos = pointDistanceSphere.xyz + posModel;
float earthRadius = pointDistanceSphere.w;
float a = dot(camToPos, camToPos);
float b = dot(camToPos, camToEarthCenter);
float c = dot(camToEarthCenter, camToEarthCenter) - earthRadius * earthRadius;
return b > 0.0 && b < a && b * b  > a * c;
}`:w.glsl`bool behindHorizon(vec3 posModel) { return false; }`),W.main.add(w.glsl`
    ProjectHUDAux projectAux;
    vec4 posProj = projectPositionHUD(projectAux);
    forwardObjectAndLayerIdColor();

    if (rejectBySlice(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    if (behindHorizon(projectAux.posModel)) {
      // Project outside of clip plane
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      return;
    }

    vec2 inputSize;
    ${w.If(L,w.glsl`
        inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
        vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);`,w.glsl`
        inputSize = size;
        vec2 screenOffsetScaled = screenOffset;`)}
    ${w.If(U,w.glsl`inputSize *= vvScale(featureAttribute).xx;`)}

    vec2 combinedSize = inputSize * pixelRatio;
    vec4 quadOffset = vec4(0.0);

    ${w.If(R,w.glsl`
    bool visible = testHUDVisibility(posProj);
    if (!visible) {
      vtc = vec2(0.0);
      ${w.If(z,"debugBorderCoords = vec4(0.5, 0.5, 1.5 / combinedSize);")}
      return;
    }`)}
    ${w.If(Y,w.glsl`voccluded = visible ? 0.0 : 1.0;`)}
  `);const Z=w.glsl`
      vec2 uvi1 = vec2(uvi.x < 0.0 ? 1.0 : 0.0, uvi.y < 0.0 ? 1.0 : 0.0);
      vec2 uv = abs(uvi + uvi1);
      vec2 texSize = vec2(textureSize(tex, 0));
      uv.x = uv.x >= ${D} ? 1.0 : uv.x / texSize.x;
      uv.y = uv.y >= ${D} ? 1.0 : uv.y / texSize.y;
      quadOffset.xy = (uvi1 - anchorPosition) * 2.0 * combinedSize;

      ${w.If(B,w.glsl`
          float angle = radians(materialRotation + rotation);
          float cosAngle = cos(angle);
          float sinAngle = sin(angle);
          mat2 rotate = mat2(cosAngle, -sinAngle, sinAngle,  cosAngle);

          quadOffset.xy = rotate * quadOffset.xy;
        `)}

      quadOffset.xy = (quadOffset.xy + screenOffsetScaled) / viewport.zw * posProj.w;
  `,Q=V?C?w.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:w.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:w.glsl`posProj += quadOffset;`;W.main.add(w.glsl`
    ${Z}
    ${j?"vcolor = interpolateVVColor(featureAttribute.y) * materialColor;":"vcolor = color / 255.0 * materialColor;"}

    ${w.If(9===G,w.glsl`vcolor.a = 1.0;`)}

    bool alphaDiscard = vcolor.a < ${w.glsl.float(I.alphaCutoff)};
    ${w.If(C,`alphaDiscard = alphaDiscard && outlineColor.a < ${w.glsl.float(I.alphaCutoff)};`)}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${Q}
      gl_Position = posProj;
    }

    vtc = uv;

    ${w.If(z,w.glsl`debugBorderCoords = vec4(uv01, 1.5 / combinedSize);`)}
    vsize = inputSize;
  `),$.uniforms.add(new T.Texture2DPassUniform("tex",e=>e.texture)),N&&!J&&$.uniforms.add(new M.Texture2DBindUniform("depthMap",e=>e.mainDepth),new S.FloatBindUniform("occludedOpacity",e=>e.hudOccludedFragmentOpacity));const X=z?w.glsl`(isBorder > 0.0 ? 0.0 : ${w.glsl.float(I.alphaCutoff)})`:w.glsl.float(I.alphaCutoff),K=w.glsl`
    ${w.If(z,w.glsl`float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`)}

    vec2 samplePos = vtc;

    ${w.If(k,w.glsl`
      float txSize = float(textureSize(tex, 0).x);
      float texelSize = 1.0 / txSize;

      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      samplePos += (vec2(1.0, -1.0) * texelSize) * scaleFactor;`)}

    ${C?w.glsl`
      vec4 fillPixelColor = vcolor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgbaTofloat(texture(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${X} ||
          fillPixelColor.a + outlinePixelColor.a < ${w.glsl.float(I.alphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        ${w.If(!J,w.glsl`fragColor = vec4(compositeColor, compositeAlpha);`)}
      } else {
        if (fillAlphaFactor < ${X}) {
          discard;
        }

        ${w.If(!J,w.glsl`fragColor = premultiplyAlpha(fillPixelColor);`)}
      }

      // visualize SDF:
      // fragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:w.glsl`
          vec4 texColor = texture(tex, samplePos, -0.5);
          if (texColor.a < ${X}) {
            discard;
          }
          ${w.If(!J,w.glsl`fragColor = texColor * premultiplyAlpha(vcolor);`)}
          `}

    ${w.If(N&&!J,w.glsl`
        float zSample = texelFetch(depthMap, ivec2(gl_FragCoord.xy), 0).x;
        if (zSample < gl_FragCoord.z) {
          fragColor *= occludedOpacity;
        }
        `)}

    ${w.If(!J&&z,w.glsl`fragColor = mix(fragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`)}
  `;switch(G){case 0:case 1:r.outputs.add("fragColor","vec4",0),1===G&&r.outputs.add("fragEmission","vec4",1),1===H&&r.outputs.add("fragAlpha","float",1===G?2:1),$.main.add(w.glsl`
        ${K}
        ${w.If(2===H,w.glsl`fragColor.rgb /= fragColor.a;`)}
        ${w.If(1===G,w.glsl`fragEmission = vec4(0.0);`)}
        ${w.If(1===H,w.glsl`fragAlpha = fragColor.a;`)}`);break;case 9:$.main.add(w.glsl`
        ${K}
        outputObjectAndLayerIdColor();`);break;case 8:r.include(d.OutputHighlight,e),$.main.add(w.glsl`
        ${K}
        outputHighlight(${w.If(Y,w.glsl`voccluded == 1.0`,w.glsl`false`)});`)}return r}function O(e){return e.outlineColor[3]>0&&e.outlineSize>0}function F(e){var r,i,o;return e.textureIsSignedDistanceField?(r=e.anchorPosition,i=e.distanceFieldBoundingBox,o=A,t.set(o,r[0]*(i[2]-i[0])+i[0],r[1]*(i[3]-i[1])+i[1])):t.copy(A,e.anchorPosition),A}const A=r.create(),R=32e3,D=w.glsl.float(R),E=Object.freeze(Object.defineProperty({__proto__:null,build:C,calculateAnchorPosition:F,fullUV:R},Symbol.toStringTag,{value:"Module"}));e.HUDMaterial=E,e.build=C,e.calculateAnchorPosition=F,e.fullUV=R})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/BooleanBindUniform","../../shaderModules/glsl"],function(e,t,r){"use strict";e.AlignPixel=function(e){e.uniforms.add(new t.BooleanBindUniform("alignPixelEnabled",e=>e.alignPixelEnabled)),e.code.add(r.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`),e.code.add(r.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
if (!alignPixelEnabled)
return clipCoord;
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","./AlignPixel.glsl","../shading/TerrainDepthTest.glsl","../../shaderModules/glsl"],function(e,t,r,i){"use strict";e.HUDOcclusionPass=function(e,o){const{vertex:s,fragment:n}=e;e.include(r.terrainDepthTest,o),s.include(t.AlignPixel),s.main.add(i.glsl`vec4 posProjCenter;
if (dot(position, position) > 0.0) {
ProjectHUDAux projectAux;
vec4 posProj = projectPositionHUD(projectAux);
posProjCenter = alignToPixelCenter(posProj, viewport.zw);
forwardViewPosDepth(projectAux.posView);
vec3 vpos = projectAux.posModel;
if (rejectBySlice(vpos)) {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
} else {
posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
}
gl_Position = posProjCenter;
gl_PointSize = 1.0;`),n.main.add(i.glsl`fragColor = vec4(1);
if(discardByTerrainDepth()) {
fragColor.g = 0.5;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDVisibility.glsl":function(){define(["exports","./AlignPixel.glsl","../../shaderModules/Float4BindUniform","../../shaderModules/FloatBindUniform","../../shaderModules/glsl","../../shaderModules/Texture2DBindUniform"],function(e,t,r,i,o,s){"use strict";e.HUDVisibility=function(e){e.vertex.uniforms.add(new i.FloatBindUniform("renderTransparentlyOccludedHUD",e=>0===e.hudRenderStyle?1:1===e.hudRenderStyle?0:.75),new r.Float4BindUniform("viewport",e=>e.camera.fullViewport),new s.Texture2DBindUniform("hudVisibilityTexture",e=>e.hudVisibility?.getTexture())),e.vertex.include(t.AlignPixel),e.vertex.code.add(o.glsl`bool testHUDVisibility(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/glsl"],function(e,t){"use strict";e.RgbaFloatEncoding=function(e){e.code.add(t.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}`),e.code.add(t.glsl`const vec4 RGBA_TO_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgbaTofloat(vec4 rgba) {
return dot(rgba, RGBA_TO_FLOAT_FACTORS);
}`),e.code.add(t.glsl`const vec4 uninterpolatedRGBAToFloatFactors = vec4(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBAToFloat(vec4 rgba) {
return (dot(round(rgba * 255.0), uninterpolatedRGBAToFloatFactors) - 0.5) * 2.0;
}`),e.code.add(t.glsl`const vec3 uninterpolatedRGBToFloatFactors = vec3(
1.0 / 256.0,
1.0 / 256.0 / 256.0,
1.0 / 256.0 / 256.0 / 256.0
);
float uninterpolatedRGBToFloat(vec3 rgb) {
return (dot(round(rgb * 255.0), uninterpolatedRGBToFloatFactors) - 0.5) * 2.0;
}`)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","../../../../webgl/Uniform"],function(e,t){"use strict";class r extends t.Uniform{constructor(e,t,r){super(e,"vec4",2,(i,o,s)=>i.setUniform4fv(e,t(o,s),r))}}e.Float4DrawUniform=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define(["require","exports","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../effects/geometry/olidUtils","../lib/OrderIndependentTransparency","../../../../chunks/HUDMaterial.glsl","../../../webgl/enums","../../../webgl/renderState"],function(e,t,r,i,o,s,n,a,l,c,u){"use strict";class d extends s.ShaderTechnique{constructor(t,r){super(t,r,new o.ReloadableShaderModule(l.HUDMaterial,()=>new Promise((t,r)=>e(["./HUDMaterial.glsl"],t,r))),(n.olidEnabled()?f:h).locations),this.primitiveType=r.occlusionPass?c.PrimitiveType.POINTS:c.PrimitiveType.TRIANGLES}initializePipeline(e){const{oitPass:t,hasPolygonOffset:r,draped:o,output:s,depthTestEnabled:n,occlusionPass:l}=e,c=0===t,d=n&&!o&&!(1===t)&&!l&&!(8===s);return u.makePipelineState({blending:i.isColorOrColorEmission(s)?c?u.premultipliedAlpha:a.oitBlending(t):null,depthTest:n&&!o?{func:515}:null,depthWrite:d?u.defaultDepthWrite:null,drawBuffers:a.getDrawBuffers(t,s),colorWrite:u.defaultColorWrite,polygonOffset:r?p:null})}}const p={factor:0,units:-4},h=r.newLayout().vec3f("position").vec3f("normal").vec2i16("uvi").vec4u8("color").vec2f("size").f32("rotation").vec4f("centerOffsetAndDistance").vec4f("featureAttribute"),f=h.clone().vec4u8("olidColor");t.HUDMaterialTechnique=d,t.layout=h,t.olidLayout=f,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define(["exports","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration","../materials/DefaultTechniqueConfiguration"],function(e,t,r,i){"use strict";class o extends i.DefaultTechniqueConfiguration{constructor(e){super(),this.spherical=e,this.screenCenterOffsetUnitsEnabled=!1,this.occlusionTestEnabled=!0,this.signedDistanceFieldEnabled=!1,this.sampleSignedDistanceFieldTexelCenter=!1,this.hasVVSize=!1,this.hasVVColor=!1,this.hasVerticalOffset=!1,this.hasScreenSizePerspective=!1,this.hasRotation=!1,this.debugDrawLabelBorder=!1,this.hasPolygonOffset=!1,this.depthTestEnabled=!0,this.pixelSnappingEnabled=!0,this.draped=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.occlusionPass=!1,this.occludedFragmentFade=!1,this.horizonCullingEnabled=!0,this.isFocused=!0,this.olidColorInstanced=!1,this.textureCoordinateType=0,this.emissionSource=0,this.discardInvisibleFragments=!0,this.hasVVInstancing=!1,this.snowCover=!1}}t.__decorate([r.parameter()],o.prototype,"screenCenterOffsetUnitsEnabled",void 0),t.__decorate([r.parameter()],o.prototype,"occlusionTestEnabled",void 0),t.__decorate([r.parameter()],o.prototype,"signedDistanceFieldEnabled",void 0),t.__decorate([r.parameter()],o.prototype,"sampleSignedDistanceFieldTexelCenter",void 0),t.__decorate([r.parameter()],o.prototype,"hasVVSize",void 0),t.__decorate([r.parameter()],o.prototype,"hasVVColor",void 0),t.__decorate([r.parameter()],o.prototype,"hasVerticalOffset",void 0),t.__decorate([r.parameter()],o.prototype,"hasScreenSizePerspective",void 0),t.__decorate([r.parameter()],o.prototype,"hasRotation",void 0),t.__decorate([r.parameter()],o.prototype,"debugDrawLabelBorder",void 0),t.__decorate([r.parameter()],o.prototype,"hasPolygonOffset",void 0),t.__decorate([r.parameter()],o.prototype,"depthTestEnabled",void 0),t.__decorate([r.parameter()],o.prototype,"pixelSnappingEnabled",void 0),t.__decorate([r.parameter()],o.prototype,"draped",void 0),t.__decorate([r.parameter()],o.prototype,"terrainDepthTest",void 0),t.__decorate([r.parameter()],o.prototype,"cullAboveTerrain",void 0),t.__decorate([r.parameter()],o.prototype,"occlusionPass",void 0),t.__decorate([r.parameter()],o.prototype,"occludedFragmentFade",void 0),t.__decorate([r.parameter()],o.prototype,"horizonCullingEnabled",void 0),t.__decorate([r.parameter()],o.prototype,"isFocused",void 0),e.HUDMaterialTechniqueConfiguration=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/RenderCoordsHelper":function(){define(["exports","../../../core/mathUtils","../../../core/unitUtils","../../../core/libs/gl-matrix-2/math/mat4","../../../chunks/vec32","../../../geometry/ellipsoidUtils","../../../geometry/spatialReferenceEllipsoidUtils","../../../geometry/projection/projectPointToVector","../../../geometry/projection/projectVectorToPoint","../../../geometry/projection/projectVectorToVector","../../../geometry/support/aaBoundingRect","../../../geometry/support/coordinateSystem","../../../geometry/support/plane","../../../geometry/support/vector","../../../geometry/support/vectorStacks","../../../layers/graphics/dehydratedFeatureUtils"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m){"use strict";class y{constructor(e,t,r,i){this.viewingMode=e,this.spatialReference=t,this.unitInMeters=r,this._coordinateSystem=i,this._tmpCoordinateSystem=d.create(i),this.referenceEllipsoid=s.getReferenceEllipsoid(t),this.sphericalPCPF=n.getSphericalPCPF(t)}set extent(e){e&&d.setExtent(this._coordinateSystem,e,this._coordinateSystem)}get extent(){return d.getExtent(this._coordinateSystem,u.create())}getAltitude(e){return d.altitudeAt(this._coordinateSystem,e)}setAltitude(e,t,r=e){return d.setAltitudeAt(this._coordinateSystem,r,t,e)}setAltitudeOfTransformation(e,t){d.setAltitudeOfTransformation(this._coordinateSystem,t,e,t)}worldUpAtPosition(e,t){return d.normalAt(this._coordinateSystem,e,t)}worldBasisAtPosition(e,t,r){return d.axisAt(this._coordinateSystem,e,t,r)}basisMatrixAtPosition(e,t){const r=this.worldBasisAtPosition(e,0,f.sv3d.get()),o=this.worldBasisAtPosition(e,1,f.sv3d.get()),s=this.worldBasisAtPosition(e,2,f.sv3d.get());return i.set(t,r[0],r[1],r[2],0,o[0],o[1],o[2],0,s[0],s[1],s[2],0,0,0,0,1),t}headingAtPosition(e,r){const i=this.worldUpAtPosition(e,f.sv3d.get()),o=this.worldBasisAtPosition(e,1,f.sv3d.get()),s=h.angleAroundAxis(r,o,i);return t.rad2deg(s)}intersectManifoldClosestSilhouette(e,t,r){return d.elevate(this._coordinateSystem,t,this._tmpCoordinateSystem),d.intersectRayClosestSilhouette(this._tmpCoordinateSystem,e,r),r}intersectManifold(e,t,r){d.elevate(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=f.sv3d.get();return d.intersectRay(this._tmpCoordinateSystem,e,i)?o.copy(r,i):null}intersectInfiniteManifold(e,t,r){if(1===this.viewingMode)return this.intersectManifold(e,t,r);d.elevate(this._coordinateSystem,t,this._tmpCoordinateSystem);const i=this._tmpCoordinateSystem.value,s=f.sv3d.get();return p.intersectRay(i.plane,e,s)?o.copy(r,s):null}toRenderCoords(e,t,r){return m.isDehydratedPoint(e)?a.projectPointToVector(e,t,this.spatialReference):c.projectVectorToVector(e,t,r,this.spatialReference)}fromRenderCoords(e,t,r=null){return m.isDehydratedPoint(t)?(null!=r&&(t.spatialReference=r),l.projectVectorToPoint(e,this.spatialReference,t)?t:null):c.projectVectorToVector(e,this.spatialReference,t,r)?t:null}static create(e,t){switch(e){case 2:return new y(2,t,r.getMetersPerUnitForSR(t),d.createLocal());case 1:return new y(1,t,1,d.createGlobal(t))}}static renderUnitScaleFactor(e,t){return r.getMetersPerCartesianUnitForSR(e)/r.getMetersPerCartesianUnitForSR(t)}}e.RenderCoordsHelper=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectVectorToPoint":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projectionUtils","./projectVectorToVector"],function(e,t,r,i){"use strict";function o(e,t,r){return!!i.projectVectorToVector(e,t,s,r.spatialReference)&&(r.x=s[0],r.y=s[1],r.z=s[2],!0)}const s=t.create();e.projectVectorToPoint=o,e.projectVectorToPointAsync=async function(e,t,i,s){return await r.initializeProjection(t,i.spatialReference,null,s),o(e,t,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/coordinateSystem":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","../ellipsoidUtils","../SpatialReference","../spatialReferenceEllipsoidUtils","../../chunks/boundedPlane","../../chunks/sphere"],function(e,t,r,i,o,s,n,a,l){"use strict";function c(e){return{operations:e,value:e.create()}}function u(e,t,r=c(e)){return r.operations=e,e.copy(t,r.value),r}const d=2**50;function p(e,t,r,i){return e.operations.setAltitudeAt(e.value,t,r,i)}const h=i.create(),f=i.create();e.altitudeAt=function(e,t){return e.operations.altitudeAt(e.value,t)},e.axisAt=function(e,t,r,i){return e.operations.axisAt(e.value,t,r,i)},e.closestPoint=function(e,t,r){return e.operations.closestPoint(e.value,t,r)},e.closestPointOnSilhouette=function(e,t,r){return e.operations.closestPointOnSilhouette(e.value,t,r)},e.coordinateSystemFromOneAxisAndNormalVector=function(e,t,i,o,s){r.copy(i,e),r.copy(f,t),r.normalize(f,f),r.cross(o,f,i),r.cross(s,o,i)},e.create=function(e){const{value:t,operations:r}=e;return{operations:r,value:r.create(t)}},e.createFromOperations=c,e.createGlobal=function(e){return u(l.sphere,l.fromValues(0,0,0,o.getReferenceEllipsoid(e).radius))},e.createLocal=function(){return u(a.boundedPlane,a.fromValues([0,0,0],[d,0,0],[0,d,0]))},e.distanceToSilhouette=function(e,t){return e.operations.distanceToSilhouette(e.value,t)},e.elevate=function(e,t,r){return e.operations.elevate(e.value,t,r.value)},e.fromValues=u,e.getExtent=function(e,t){return e.operations.getExtent(e.value,t),t},e.intersectRay=function(e,t,r){return e.operations.intersectRay(e.value,t,r)},e.intersectRayClosestSilhouette=function(e,t,r){return e.operations.intersectRayClosestSilhouette(e.value,t,r)},e.normalAt=function(e,t,r){return e.operations.axisAt(e.value,t,2,r)},e.renderSRFromViewSR=function(e,t){return e?n.getSphericalPCPF(t):t.isGeographic?s.PlateCarree:t},e.setAltitudeAt=p,e.setAltitudeOfTransformation=function(e,i,o,s){return i!==s&&t.copy(s,i),r.set(h,s[12],s[13],s[14]),p(e,h,o,h),s[12]=h[0],s[13]=h[1],s[14]=h[2],s},e.setExtent=function(e,t,r){return e.operations.setExtent(e.value,t,r.value),r},e.vectorCoordinates=function(e,t,i,o,s){return s[0]=r.dot(e,t),s[1]=r.dot(e,i),s[2]=r.dot(e,o),s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(e){"use strict";e.isDehydratedPoint=function(e){return"point"===e.type},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["../../../../../chunks/tslib.es6","../../../../../core/Evented","../../../../../core/promiseUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/Extent","../../../../../geometry/projectionUtils","../../../../../geometry/SpatialReference","../../../../../layers/graphics/data/QueryEngine","../../../../../rest/support/Query","./FeatureProcessingContext","./PipelineCommand","./Tile3DManager","./TileLocks","./featureSet/TiledFeatureStore","./fetching/Tile3DFetcher","./rendering/RenderCommandContext","../../../support/RenderCoordsHelper"],function(e,t,r,i,o,s,n,a,l,c,u,d,p,h,f,m,y,g,b,_,v,S){"use strict";let x=class extends t.EventedAccessor{constructor(){super(...arguments),this.remoteClient=null,this._featureStore=new b.TiledFeatureStore,this._tileLocks=new g.TileLocks,this._tileManager=null,this._renderer=null,this._fetcher=null,this._queryEngine=null,this._defaultQueryJSON=null,this._mainThreadDelegate=null,this._viewSpatialReference=null,this._renderCommandContext=null,this._context=null}get updating(){return this._tileManager.updating}destroy(){this._featureStore.clear(),this._tileManager?.destroy()}async setup({viewSpatialReference:e,renderSpatialReference:t,viewingMode:r,layerInfo:o,layerViewInfo:s}){const n=d.fromJSON(e);this._viewSpatialReference=n;const a=d.fromJSON(t);this._fetcher=new _.Tile3DFetcher(this._viewSpatialReference,h.fromJSON(o.baseQuery),o.url,o.objectIdField,o.capabilities),this._queryEngine=new p.QueryEngine({hasZ:!0,hasM:!1,geometryType:"esriGeometryPoint",featureIdInfo:{type:"object-id",fieldName:o.objectIdField},fieldsIndex:o.fieldIndex,availableFields:[o.objectIdField],spatialReference:e,featureStore:this._featureStore,timeInfo:o.timeInfo}),this._mainThreadDelegate={createTexture:async(e,t)=>{const r={data:e,parameters:t};return await this.remoteClient.invoke("createTexture",r,{transferList:[e.buffer]})},releaseTexture:async e=>{const t={uid:e};await this.remoteClient.invoke("releaseTexture",t)},createMaterial:async e=>{const t={materialJSON:e};await this.remoteClient.invoke("createMaterial",t)},destroyMaterial:async e=>{const t={materialId:e};await this.remoteClient.invoke("destroyMaterial",t)},createDirectRenderer:async e=>{const t={materialId:e};await this.remoteClient.invoke("createDirectRenderer",t)},destroyDirectRenderer:async e=>{const t={materialId:e};await this.remoteClient.invoke("destroyDirectRenderer",t)},createLodRenderer:async(e,t,r)=>{const i={rendererId:e,lodRenderGeometry:t};await this.remoteClient.invoke("createLoDRenderer",i,{transferList:r})},destroyLodRenderer:async e=>{const t={rendererId:e};await this.remoteClient.invoke("destroyLoDRenderer",t)},executeRenderCommands:async e=>{const t={commands:e.commands};await this.remoteClient.invoke("dispatchRenderCommands",t,{transferList:e.transferList})},applyElevationAlignmentTo:async e=>{const t={mapPoints:e};return await this.remoteClient.invoke("applyElevationAlignment",t,{transferList:[e.buffer]})}};const l=S.RenderCoordsHelper.create(r,a),m=new v.RenderCommandContext(r,this._mainThreadDelegate);this._renderCommandContext=m;const g=new f.FeatureProcessingContext(n,a,this._mainThreadDelegate,l,m,o,s);this._context=g,this._renderer=g.symbolRendererFactory.createSymbolRendererFromJSON(o.renderer),this._defaultQueryJSON=new h({outSpatialReference:n}).toJSON();let b=null;if(null!=o.fullExtent){const e=c.fromJSON(o.fullExtent);await u.initializeProjection(e.spatialReference,n),b=u.project(e,n)}return this._tileManager=new y.Tile3DManager({loadTile:(e,t)=>this._fetcher.fetch(e,t),createAddCommand:(e,t)=>this._createAddFeatureDataCommand(e,t),createRemoveCommand:e=>this._createRemoveFeatureDataCommand(e),createUpdateCommand:(e,t)=>this._createUpdateFeatureDataVisibilityCommand(e,t),tileLocks:this._tileLocks,extent:b}),this.addHandles(i.watch(()=>this.updating,e=>{this.emit("notify-updating",{updating:e})}),i.initial),null!=this._renderer&&await this._renderer.load(),w}async executeQuery(e,t){return{result:await this._queryEngine.executeQuery(this._ensureQuery(e),t)}}async executeQueryForIds(e,t){const r=await this._queryEngine.executeQueryForIdSet(this._ensureQuery(e),t);return{result:Array.from(r)}}async executeQueryForCount(e,t){return{result:await this._queryEngine.executeQueryForCount(this._ensureQuery(e),t)}}async executeQueryForExtent(e,t){return{result:await this._queryEngine.executeQueryForExtent(this._ensureQuery(e),t)}}async executeQueryForLatestObservations(e,t){return{result:await this._queryEngine.executeQueryForLatestObservations(this._ensureQuery(e),t)}}onTileTreeChange(e){return this._tileManager.onTileTreeChange(e),Promise.resolve(w)}async onElevationChange(e){return w}async onLayerViewOpacityChange(e){const{_context:t,_renderer:r}=this;if(t.layerViewInfo.fullOpacity=e,null==r)return w;const i=await r.createUpdateLayerViewOpacityCommand(e);return await i.execute(),w}async onRendererChange(t){const{_context:r}=this,i=r.symbolRendererFactory.createSymbolRendererFromJSON(t);await i.load();const o=this._renderer;this._renderer=i;const s=[...this._tileManager.loadedTiles()],n=s.map(e=>e.tileId);{const t={stack:[],error:void 0,hasError:!1};try{e.__addDisposableResource(t,await this._tileLocks.lock(n),!1);const a=s.flatMap(e=>[o.createRemoveCommand(e.id),i.createAddCommand(e)]),l=await Promise.all(a),c=r.joinPipelineCommands(l);await c.execute()}catch(e){t.error=e,t.hasError=!0}finally{e.__disposeResources(t)}}const a=await o.createDestroyCommand();return await a.execute(),w}async _createAddFeatureDataCommand(e,t){const i=this._featureStore,o=this._renderer;let s;return s=null!=o?await o.createAddCommand(e):m.PipelineCommand.create(this._renderCommandContext),r.throwIfAborted(t),s.appendPipelineStateCommand(()=>{i.addTile(e)}),s}async _createRemoveFeatureDataCommand(e){const t=this._featureStore,r=this._renderer;let i;return i=null!=r?await r.createRemoveCommand(e):m.PipelineCommand.create(this._renderCommandContext),i.appendPipelineStateCommand(()=>{t.removeTile(e)}),i}async _createUpdateFeatureDataVisibilityCommand(e,t){const i=this._renderer;let o;return o=null!=i?await i.createUpdateVisibilityCommand(e):m.PipelineCommand.create(this._renderCommandContext),r.throwIfAborted(t),o}_ensureQuery(e){return e??this._defaultQueryJSON}};e.__decorate([o.property()],x.prototype,"updating",null),x=e.__decorate([l.subclass("esri.views.3d.layers.graphics.pipeline.Feature3DPipelineWorker")],x);const w={result:void 0};return x});