// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(e,t){"use strict";e.copyInto=function(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e},e.doubleArrayFrom=function(e){return(t.isTypedArray(e)?e.byteLength/8:e.length)<=t.nativeArrayMaxSize?Array.from(e):new Float64Array(e)},e.doubleSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},e.ensurePackedArray=function(e){return[...e]},e.newDoubleArray=function(e,r=!1){return e<=t.nativeArrayMaxSize?r?new Array(e).fill(0):new Array(e):new Float64Array(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshGeoreferencedVertexSpace":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,o,n,s,i,a,l,c){"use strict";var u;return e.default=class extends(r.ClonableMixin(o.JSONSupport)){static{u=this}constructor(e){super(e),this.type="georeferenced",this.origin=null}static{this.absolute=new u}},t.__decorate([l.enumeration({georeferenced:"georeferenced"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([n.property({type:[Number],nonNullable:!1,json:{write:!0}})],e.default.prototype,"origin",void 0),e.default=u=t.__decorate([c.subclass("esri.geometry.support.MeshGeoreferencedVertexSpace")],e.default),e.default})},"esri/geometry/support/MeshLocalVertexSpace":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../core/libs/gl-matrix-2/factories/vec3f64"],function(e,t,r,o,n,s,i,a,l,c,u){"use strict";return e.default=class extends(r.ClonableMixin(o.JSONSupport)){constructor(e){super(e),this.type="local",this.origin=u.create()}},t.__decorate([l.enumeration({local:"local"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([n.property({type:[Number],nonNullable:!0,json:{write:!0}})],e.default.prototype,"origin",void 0),e.default=t.__decorate([c.subclass("esri.geometry.support.MeshLocalVertexSpace")],e.default),e.default})},"esri/chunks/vec3":function(){define(["exports","../colorUtils","../core/has","../core/Logger"],function(e,t,r,o){"use strict";function n(e,t,r){s(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function s(e,t,r,o=3,n=o){if(e.length/o!==Math.ceil(t.length/n))return e;const s=e.length/o,i=r[0],a=r[1],l=r[2],c=r[4],u=r[5],f=r[6],d=r[8],h=r[9],p=r[10],g=r[12],m=r[13],y=r[14];let b=0,w=0;for(let r=0;r<s;r++){const r=t[b],s=t[b+1],_=t[b+2];e[w]=i*r+c*s+d*_+g,e[w+1]=a*r+u*s+h*_+m,e[w+2]=l*r+f*s+p*_+y,b+=n,w+=o}return e}function i(e,t,r){a(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function a(e,t,r,o=3,n=o){if(e.length/o!==Math.ceil(t.length/n))return;const s=e.length/o,i=r[0],a=r[1],l=r[2],c=r[3],u=r[4],f=r[5],d=r[6],h=r[7],p=r[8];let g=0,m=0;for(let r=0;r<s;r++){const r=t[g],s=t[g+1],y=t[g+2];e[m]=i*r+c*s+d*y,e[m+1]=a*r+u*s+h*y,e[m+2]=l*r+f*s+p*y,g+=n,m+=o}}function l(e,t,r){c(e.typedBuffer,t.typedBuffer,r,e.typedBufferStride,t.typedBufferStride)}function c(e,t,r,o=3,n=o){const s=Math.min(e.length/o,t.length/n);let i=0,a=0;for(let l=0;l<s;l++)e[a]=r*t[i],e[a+1]=r*t[i+1],e[a+2]=r*t[i+2],i+=n,a+=o;return e}function u(e,t,r,o){f(e.typedBuffer,t.typedBuffer,r,o,e.typedBufferStride,t.typedBufferStride)}function f(e,r,o,n,s=3,i=s){const a=Math.min(e.length/s,r.length/i);let l=0,c=0;const u=1/t.colorGamma;for(let t=0;t<a;t++)e[c]=n*(o*r[l])**u,e[c+1]=n*(o*r[l+1])**u,e[c+2]=n*(o*r[l+2])**u,l+=i,c+=s}function d(e,t,r,o=3,n=o){const s=e.length/o;if(s!==Math.ceil(t.length/n))return e;let i=0,a=0;for(let l=0;l<s;l++)e[a]=t[i]+r[0],e[a+1]=t[i+1]+r[1],e[a+2]=t[i+2]+r[2],i+=n,a+=o;return e}function h(e,t){p(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function p(e,t,r=3,o=r){const n=Math.min(e.length/r,t.length/o);let s=0,i=0;for(let a=0;a<n;a++){const n=t[s],a=t[s+1],l=t[s+2],c=n*n+a*a+l*l;if(c>0){const t=1/Math.sqrt(c);e[i]=t*n,e[i+1]=t*a,e[i+2]=t*l}s+=o,i+=r}}function g(e,t,r){const o=Math.min(e.count,t.count),n=e.typedBuffer,s=e.typedBufferStride,i=t.typedBuffer,a=t.typedBufferStride;let l=0,c=0;for(let e=0;e<o;e++)n[c]=i[l]>>r,n[c+1]=i[l+1]>>r,n[c+2]=i[l+2]>>r,l+=a,c+=s}const m=Object.freeze(Object.defineProperty({__proto__:null,linearToSRGB:f,linearToSRGBView:u,normalize:p,normalizeView:h,scale:c,scaleView:l,shiftRight:g,transformMat3:a,transformMat3View:i,transformMat4:s,transformMat4View:n,translate:d},Symbol.toStringTag,{value:"Module"}));e.linearToSRGB=f,e.linearToSRGBView=u,e.normalize=p,e.normalizeView=h,e.scale=c,e.scaleView=l,e.shiftRight=g,e.transformMat3=a,e.transformMat3View=i,e.transformMat4=s,e.transformMat4View=n,e.translate=d,e.vec3=m})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(e,t,r){"use strict";let o;t.cleanup=function(){o=null},t.get=function(){return o??=(async()=>{const t=await new Promise((t,r)=>e(["../../chunks/i3s"],t,r));return await t.default({locateFile:e=>r.getAssetUrl(`esri/libs/i3s/${e}`)})})(),o},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define(["exports","../../../core/Logger","../../../core/PooledArray","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../core/workers/WorkerHandle","../../../geometry/projectionUtils","../../../geometry/projection/projectVectorToVector"],function(e,t,r,o,n,s,i){"use strict";class a extends n.WorkerHandle{constructor(e){super("SceneLayerWorker","process",{process:e=>[e.geometryBuffer],project:e=>[e.positions.buffer],transformNormals:e=>[e.normals.buffer]},e,{hasInitialize:!0})}setModifications(e,t,r){const o={context:e,modifications:t,isGeodetic:r};return this.broadcast(o,"setModifications")}setLegacySchema(e,t){const r=JSON.stringify(t);return this.broadcast({context:e,jsonSchema:r},"setLegacySchema")}destroyContext(e){return this.broadcast(e,"destroyContext")}async destroyContextAndSelf(e){await this.destroyContext(e),this.destroy()}project(e,t){return this.invokeMethod("project",e,t)}transformNormals(e,t){return this.invokeMethod("transformNormals",e,t)}}const l=new r({deallocator:null}),c=o.create();e.I3SMeshWorkerHandle=a,e.TransformedData=class{constructor(e,t,r,o,n,s,i){this.componentOffsets=e,this.featureIds=t,this.anchorIds=r,this.anchors=o,this.transformedGeometry=n,this.globalTrafo=s,this.obb=i}},e.TransformedGeometry=class{constructor(e,t,r,o,n,s){this.layout=e,this.interleavedVertexData=t,this.indices=r,this.hasColors=o,this.hasModifications=n,this.positionData=s}},e.toWasmModification=function(e,r,o){l.clear();let n=1/0,a=1/0,u=-1/0,f=-1/0,d=!1;for(const e of r){const r="clip"===e.type?2:"mask"===e.type?1:0,h=e.geometry;let p=e=>e;if(h.spatialReference){if(!s.canProjectWithoutEngine(h.spatialReference,o)){t.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("im-modification-projection-failed","Can't project modification polygon into layer spatial reference, ignoring modification",{polygon:h});continue}p=e=>(i.projectVectorToVector(e,h.spatialReference,c,o),c)}else h.hasZ||(c[2]=0,p=e=>(c[0]=e[0],c[1]=e[1],c));d=d||1===r;const g=h.rings.length,m=h.rings.some(e=>e.length<3);if(0===g||m)t.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("im-modification-invalid-polygon","Ignoring invalid modification polygon (no rings or rings with less than 3 vertices).",{polygon:h});else{l.push(r),l.push(g);for(const e of h.rings){l.push(e.length);for(const t of e){const e=p(t);l.push(e[0]),l.push(e[1]),l.push(e[2]),n=Math.min(n,e[0]),a=Math.min(a,e[1]),u=Math.max(u,e[0]),f=Math.max(f,e[1])}}}}if(null!=e)if(d){const t=1e-4;l.push(2),l.push(2),l.push(4),l.push(n-t),l.push(a-t),l.push(0),l.push(u+t),l.push(a-t),l.push(0),l.push(u+t),l.push(f+t),l.push(0),l.push(n-t),l.push(f+t),l.push(0),l.push(4),l.push(e[0]),l.push(e[1]),l.push(0),l.push(e[2]),l.push(e[1]),l.push(0),l.push(e[2]),l.push(e[3]),l.push(0),l.push(e[0]),l.push(e[3]),l.push(0)}else l.push(1),l.push(1),l.push(4),l.push(e[0]),l.push(e[1]),l.push(0),l.push(e[2]),l.push(e[1]),l.push(0),l.push(e[2]),l.push(e[3]),l.push(0),l.push(e[0]),l.push(e[3]),l.push(0);l.push(3);const h=new Float64Array(l.length);for(let e=0;e<l.length;++e)h[e]=l.at(e);return h},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerHandle":function(){define(["exports","../arrayUtils","../handleUtils","../Logger","../promiseUtils","./workers"],function(e,t,r,o,n,s){"use strict";function i(){}e.WorkerHandle=class{constructor(e,t,r,n,i={}){this._mainMethod=t,this._transferLists=r,this._listeners=[],this._promise=s.open(e,{...i,schedule:n}).then(e=>{if(void 0===this._thread){this._thread=e,this._promise=null,i.hasInitialize&&this.broadcast({},"initialize");for(const e of this._listeners)this._connectListener(e)}else e.close()}),this._promise.catch(t=>o.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${e} worker: ${t}`))}on(e,o){const n={removed:!1,eventName:e,callback:o,threadHandle:null};return this._listeners.push(n),this._connectListener(n),r.makeHandle(()=>{n.removed=!0,t.remove(this._listeners,n),this._thread&&null!=n.threadHandle&&n.threadHandle.remove()})}destroy(){this._thread&&(this._thread.close(),this._thread=null),this._promise=null,this._listeners.length=0,this._transferLists={}}invoke(e,t,r){return this.invokeMethod(this._mainMethod,e,t,r)}invokeMethod(e,t,r,o){if(this._thread){const n=this._transferLists[e],s=n?n(t):[];return this._thread.invoke(e,t,{transferList:s,signal:r,priority:o})}return this._promise?this._promise.then(()=>(n.throwIfAborted(r),this.invokeMethod(e,t,r))):Promise.reject(null)}broadcast(e,t){return this._thread?Promise.all(this._thread.broadcast(t,e)).then(i):this._promise?this._promise.then(()=>this.broadcast(e,t)):Promise.reject()}get promise(){return this._promise}_connectListener(e){this._thread&&this._thread.on(e.eventName,e.callback).then(t=>{e.removed||(e.threadHandle=t)})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/workers":function(){define(["require","exports","../Error","../has","../promiseUtils","./Connection","./connectionRegistry","./RemoteClient","./WorkerOwner"],function(e,t,r,o,n,s,i,a,l){"use strict";function c(e){if(e&&e.__esModule)return e;const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const r in e)if("default"!==r){const o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:()=>e[r]})}return t.default=e,Object.freeze(t)}const u=o("host-browser")?Math.min(navigator.hardwareConcurrency-1,o("workers-pool-size")??8):0;let f=o("esri-mobile")?Math.min(u,3):u;f||(f=o("safari")&&o("mac")?7:2);let d=0;const h=[];async function p(e,t){const r=new s,{registryTarget:o,...n}=t;return await r.open(e,n),o&&i.register(o,r),r}let g,m=null;async function y(){if(m)return m;g=new AbortController;const e=[];for(let t=0;t<f;t++){const r=l.create(t).then(e=>(h[t]=e,e));e.push(r)}return m=Promise.all(e),m}t.Connection=s,t.RemoteClient=a,t.initialize=function(){y()},t.open=async function(t,s={}){if("string"!=typeof t)throw new r("workers:undefined-module","modulePath is missing");let i=s.strategy||"distributed";if(o("host-webworker")&&!o("esri-workers")&&(i="local"),"local"===i){let r=await a.loadWorker(t);r||(r=await new Promise((r,o)=>e([t],e=>r(c(e)),o))),n.throwIfAborted(s.signal);const o=s.client||r;return p([a.connect(r,s.schedule)],{...s,client:o})}if(await y(),n.throwIfAborted(s.signal),"dedicated"===i){const e=d++%f;return p([await h[e].open(t,s)],s)}if(s.maxNumWorkers&&s.maxNumWorkers>0){const e=Math.min(s.maxNumWorkers,f);if(e<f){const r=new Array(e);for(let o=0;o<e;++o){const e=d++%f;r[o]=h[e].open(t,s)}return p(r,s)}}return p(h.map(e=>e.open(t,s)),s)},t.openWithPorts=function(e,t){return p(e,{client:t})},t.terminate=function(){m&&(g.abort(),m=null);for(let e=0;e<h.length;e++)h[e]&&h[e].terminate();h.length=0},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/Connection":function(){define(["../handleUtils","../has","../promiseUtils","../Queue","./connectionRegistry","./InvokeHandler","./RemoteClient"],function(e,t,r,o,n,s,i){"use strict";return class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new o,this._ongoingLowPriorityJobsQueue=new o}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise((o,n)=>{let s=!0;const a=e=>{r.throwIfAborted(t.signal),s&&(s=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let s=0;s<e.length;++s){const l=e[s];r.isPromiseLike(l)?this._clientPromises[s]=l.then(e=>(this._clients[s]=new i(e,t,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),a(o),this._clients[s]),()=>(a(n),null)):(this._clients[s]=new i(l,t,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),this._clientPromises[s]=Promise.resolve(this._clients[s]),a(o))}})}broadcast(e,t,r){const o=new Array(this._clientPromises.length);for(let n=0;n<this._clientPromises.length;++n){const s=this._clientPromises[n];o[n]=s.then(o=>o?.invoke(e,t,r))}return o}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(r.createAbortError(`Worker closing, aborting job calling '${e.methodName}'`));for(;e=this._ongoingLowPriorityJobsQueue.pop();)e.resolver.reject(r.createAbortError(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then(e=>e?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,n.unregister(this)}invoke(e,t,r){return this.apply(e,[t],r)}apply(e,t,o){const n=r.createResolver();("low"===o?.priority?this._ongoingLowPriorityJobsQueue:this._ongoingJobsQueue).push({methodName:e,data:t,invokeOptions:o,resolver:n});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then(e=>e?.jobAdded())}return n.promise}createInvokeProxy(e){return s.createInvokeProxy(this,e)}on(t,r){return Promise.all(this._clientPromises).then(()=>e.handlesGroup(this._clients.map(e=>e.on(t,r))))}openPorts(){return new Promise(e=>{const t=new Array(this._clientPromises.length);let r=t.length;for(let o=0;o<this._clientPromises.length;++o)this._clientPromises[o].then(n=>{n&&(t[o]=n.openPort()),0===--r&&e(t)})})}get test(){}}})},"esri/core/Queue":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t){"use strict";class r{constructor(e=e=>e.values().next().value){this._peeker=e,this._observable=new t.SimpleObservable,this._items=new Set}get length(){return e.trackAccess(this._observable),this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0===this.length)return;let e;for(e of this._items);return e}peek(){if(0!==this.length)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(t){return e.trackAccess(this._observable),this._items.has(t)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(0===this.length)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const t=this.length;return this._items.forEach(t=>{e(t)||this._items.delete(t)}),t!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){e.trackAccess(this._observable),yield*this._items}}return r})},"esri/core/workers/connectionRegistry":function(){define(["exports"],function(e){"use strict";const t=new FinalizationRegistry(e=>{e.close()});e.register=function(e,r){t.register(e,r,r)},e.unregister=function(e){t.unregister(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerOwner":function(){define(["../Error","../Logger","../maybe","../promiseUtils","./staticWorkerMessages","./utils","./workerFactory"],function(e,t,r,o,n,s,i){"use strict";const{ABORT:a,INVOKE:l,OPEN:c,OPENED:u,RESPONSE:f}=s.MessageType;class d{static async create(e){const t=await i.createWorker();return new d(t,e)}constructor(e,r){this._outJobs=new Map,this._inJobs=new Map,this.worker=e,this.id=r,e.addEventListener("message",this._onMessage.bind(this)),e.addEventListener("error",e=>{e.preventDefault(),t.getLogger("esri.core.workers.WorkerOwner").error(e)})}terminate(){this.worker.terminate()}async open(e,t={}){const{signal:r}=t,n=s.newJobId();return new Promise((t,s)=>{const i={resolve:t,reject:s,abortHandle:o.onAbortOrThrow(r,()=>{this._outJobs.delete(n),this._post({type:a,jobId:n})})};this._outJobs.set(n,i),this._post({type:c,jobId:n,modulePath:e})})}_onMessage(e){const t=s.receiveMessage(e);if(t)switch(t.type){case u:this._onOpenedMessage(t);break;case f:this._onResponseMessage(t);break;case a:this._onAbortMessage(t);break;case l:this._onInvokeMessage(t)}}_onAbortMessage(e){const t=this._inJobs,r=e.jobId,o=t.get(r);o&&(o.controller&&o.controller.abort(),t.delete(r))}_onInvokeMessage(e){const{methodName:t,jobId:r,data:i,abortable:a}=e,l=a?new AbortController:null,c=this._inJobs,u=n.staticWorkerMessages[t];let d;try{if("function"!=typeof u)throw new TypeError(`${t} is not a function`);d=u.call(null,i,{signal:l?l.signal:null})}catch(e){return void this._post({type:f,jobId:r,error:s.toInvokeError(e)})}o.isPromiseLike(d)?(c.set(r,{controller:l,promise:d}),d.then(e=>{c.has(r)&&(c.delete(r),this._post({type:f,jobId:r},e))},e=>{c.has(r)&&(c.delete(r),e||(e={message:"Error encountered at method"+t}),o.isAbortError(e)||this._post({type:f,jobId:r,error:s.toInvokeError(e||{message:`Error encountered at method ${t}`})}))})):this._post({type:f,jobId:r},d)}_onOpenedMessage(e){const{jobId:t,data:o}=e,n=this._outJobs.get(t);n&&(this._outJobs.delete(t),r.removeMaybe(n.abortHandle),n.resolve(o))}_onResponseMessage(t){const{jobId:o,error:n,data:s}=t,i=this._outJobs.get(o);i&&(this._outJobs.delete(o),r.removeMaybe(i.abortHandle),n?i.reject(e.fromJSON(JSON.parse(n))):i.resolve(s))}_post(e,t,r){return s.postMessage(this.worker,e,t,r)}}return d})},"esri/core/workers/staticWorkerMessages":function(){define(["exports","../../request","../urlUtils"],function(e,t,r){"use strict";const o={async request(e,o){const n=e.options,s=n.responseType;n.signal=o?.signal,n.responseType="native"===s||"native-request-init"===s?"native-request-init":s&&["blob","json","text"].includes(s)&&r.getInterceptor(e.url)?.after?s:"array-buffer";const i=await t(e.url,n),a={data:i.data,httpStatus:i.httpStatus,ssl:i.ssl};switch(i.requestOptions?.responseType){case"native-request-init":return delete a.data.signal,a;case"blob":a.data=await a.data.arrayBuffer();break;case"json":a.data=(new TextEncoder).encode(JSON.stringify(a.data)).buffer;break;case"text":a.data=(new TextEncoder).encode(a.data).buffer}return{result:a,transferList:[a.data]}}};e.staticWorkerMessages=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/workerFactory":function(){define(["exports","../../config","../../request","../Error","../Logger","../urlUtils","../../intl","../../kernel","../has","./loaderConfig","./utils","./WorkerFallback","../../intl/locale","../../support/revision"],function(e,t,r,o,n,s,i,a,l,c,u,f,d,h){"use strict";const p=()=>n.getLogger("esri.core.workers.workerFactory"),{HANDSHAKE:g}=u.MessageType;let m,y;const b="Failed to create Worker. Fallback to execute module in main thread";async function w(e){return new Promise(t=>{function r(n){const s=u.receiveMessage(n);s&&s.type===g&&(e.removeEventListener("message",r),e.removeEventListener("error",o),t(e))}function o(t){t.preventDefault(),e.removeEventListener("message",r),e.removeEventListener("error",o),p().warn("Failed to create Worker. Fallback to execute module in main thread",t),(e=new f).addEventListener("message",r),e.addEventListener("error",o)}e.addEventListener("message",r),e.addEventListener("error",o)})}let _=0;e.createWorker=async function(){if(!l("esri-workers"))return w(new f);if(!m&&!y)try{const e='let globalId=0;const outgoing=new Map,configuration={CONFIGURATION};self.esriConfig=configuration.esriConfig;const workerPath=self.esriConfig.workers.workerPath,HANDSHAKE=0,OPEN=1,OPENED=2,RESPONSE=3,INVOKE=4,ABORT=5;function createAbortError(){const e=new Error("Aborted");return e.name="AbortError",e}function receiveMessage(e){return e&&e.data?"string"==typeof e.data?JSON.parse(e.data):e.data:null}function invokeStaticMessage(e,o,r){const t=r&&r.signal,n=globalId++;let s=null;return new Promise(((r,i)=>{if(t){if(t.aborted)return i(createAbortError());s=()=>{outgoing.get(n)&&(outgoing.delete(n),self.postMessage({type:5,jobId:n}),i(createAbortError()))},t.addEventListener("abort",s)}outgoing.set(n,{resolve:r,reject:i}),self.postMessage({type:4,jobId:n,methodName:e,abortable:null!=t,data:o})})).finally((()=>{t&&t.removeEventListener("abort",s)}))}let workerRevisionChecked=!1;function checkWorkerRevision(e){if(!workerRevisionChecked&&e.kernelInfo){workerRevisionChecked=!0;const{revision:o,fullVersion:r}=configuration.kernelInfo,{revision:t,fullVersion:n,version:s}=e.kernelInfo;esriConfig.assetsPath!==esriConfig.defaultAssetsPath&&o!==t&&console.warn(`Version mismatch detected between ArcGIS Maps SDK for JavaScript modules and assets. For more information visit https://bit.ly/3QnsuSo.\nModules version: ${r}\nAssets version: ${n??s}\nAssets path: ${esriConfig.assetsPath}`)}}function messageHandler(e){const o=receiveMessage(e);if(!o)return;const r=o.jobId;switch(o.type){case 1:let n;function t(e){const o=n.connect(e);self.postMessage({type:2,jobId:r,data:o},[o])}"function"==typeof define&&define.amd?require([workerPath],(e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||new Promise((e=>{require([o.modulePath],e)})))).then(t)})):"System"in self&&"function"==typeof System.import?System.import(workerPath).then((e=>(n=e.default,checkWorkerRevision(n),n.loadWorker(o.modulePath)))).then((e=>e||System.import(o.modulePath))).then(t):esriConfig.workers.useDynamicImport?import(workerPath).then((e=>{n=e.default||e,checkWorkerRevision(n),n.loadWorker(o.modulePath).then((e=>e||import(o.modulePath))).then(t)})):(self.RemoteClient||importScripts(workerPath),n=self.RemoteClient.default||self.RemoteClient,checkWorkerRevision(n),n.loadWorker(o.modulePath).then(t));break;case 3:if(outgoing.has(r)){const s=outgoing.get(r);outgoing.delete(r),o.error?s.reject(JSON.parse(o.error)):s.resolve(o.data)}}}self.dojoConfig=configuration.loaderConfig,esriConfig.workers.loaderUrl&&(self.importScripts(esriConfig.workers.loaderUrl),"function"==typeof require&&"function"==typeof require.config&&require.config(configuration.loaderConfig)),self.addEventListener("message",messageHandler),self.postMessage({type:0});'.split("{CONFIGURATION}").join(function(){let e;if(null!=t.default){const r={...t};delete r.default,e=JSON.parse(JSON.stringify(r))}else e=JSON.parse(JSON.stringify(t));e.assetsPath=s.makeAbsolute(e.assetsPath),e.defaultAssetsPath=e.defaultAssetsPath?s.makeAbsolute(e.defaultAssetsPath):void 0,e.request.interceptors=[],e.log.interceptors=[],e.locale=d.getLocale(),e.has={"esri-csp-restrictions":l("esri-csp-restrictions"),"esri-2d-debug":!1,"esri-2d-update-debug":l("esri-2d-update-debug"),"esri-2d-log-updating":l("esri-2d-log-updating"),"featurelayer-pbf":l("featurelayer-pbf"),"featurelayer-fast-triangulation-enabled":l("featurelayer-fast-triangulation-enabled"),"featurelayer-simplify-thresholds":l("featurelayer-simplify-thresholds"),"featurelayer-simplify-payload-size-factors":l("featurelayer-simplify-payload-size-factors"),"featurelayer-simplify-mobile-factor":l("featurelayer-simplify-mobile-factor"),"featurelayer-query-max-depth":l("featurelayer-query-max-depth"),"featurelayer-query-tile-max-features":l("featurelayer-query-tile-max-features"),"featurelayer-query-tile-concurrency":l("featurelayer-query-tile-concurrency"),"featurelayer-query-pausing-enabled":l("featurelayer-query-pausing-enabled"),"featurelayer-snapshot-concurrency":l("featurelayer-snapshot-concurrency"),"featurelayer-snapshot-enabled":l("featurelayer-snapshot-enabled"),"esri-atomics":l("esri-atomics"),"esri-shared-array-buffer":l("esri-shared-array-buffer"),"esri-tiles-debug":l("esri-tiles-debug"),"esri-workers-arraybuffer-transfer":l("esri-workers-arraybuffer-transfer"),"feature-polyline-generalization-factor":l("feature-polyline-generalization-factor"),"host-webworker":1},e.workers.loaderUrl?e.workers.loaderUrl=s.makeAbsolute(e.workers.loaderUrl):c.defaultLoaderUrl&&(e.workers.loaderUrl=c.defaultLoaderUrl),e.workers.workerPath?e.workers.workerPath=s.makeAbsolute(e.workers.workerPath):e.workers.workerPath="esri/core/workers/RemoteClient",e.workers.useDynamicImport=!1;const r=t.workers.loaderConfig,o=c.loaderConfig({baseUrl:r?.baseUrl,locale:d.getLocale(),has:{"csp-restrictions":1,"dojo-test-sniff":0,"host-webworker":1,...r?.has},map:{...r?.map},paths:{...r?.paths},packages:r?.packages||[]}),n={buildDate:h.buildDate,fullVersion:a.fullVersion,revision:h.commitHash};return JSON.stringify({esriConfig:e,loaderConfig:o,kernelInfo:n})}());m=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))}catch(e){y=e||{}}let e;if(m)try{e=new Worker(m,{name:"esri-worker-"+_++})}catch(t){p().warn(b,y),e=new f}else p().warn(b,y),e=new f;return w(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl":function(){define(["exports","./intl/date","./intl/number","./intl/substitute","./intl/locale","./intl/messages","./intl/t9n","./assets"],function(e,t,r,o,n,s,i,a){"use strict";s.registerMessageBundleLoader(i.createJSONLoader({pattern:"esri/",location:a.getAssetUrl})),e.convertDateFormatToIntlOptions=t.convertDateFormatToIntlOptions,e.formatDate=t.formatDate,e.formatDateOnly=t.formatDateOnly,e.formatTimeOnly=t.formatTimeOnly,e.formatTimestamp=t.formatTimestamp,e.convertNumberFormatToIntlOptions=r.convertNumberFormatToIntlOptions,e.formatNumber=r.formatNumber,e.substitute=o.substitute,e.getLocale=n.getLocale,e.getLocaleLanguage=n.getLocaleLanguage,e.onLocaleChange=n.onLocaleChange,e.prefersRTL=n.prefersRTL,e.setLocale=n.setLocale,e.fetchMessageBundle=s.fetchMessageBundle,e.normalizeMessageBundleLocale=s.normalizeMessageBundleLocale,e.registerMessageBundleLoader=s.registerMessageBundleLoader,e.createJSONLoader=i.createJSONLoader,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl/number":function(){define(["exports","./locale"],function(e,t){"use strict";const r={ar:"ar-u-nu-latn",bs:"sr-Latn-CS",nn:"no-NN"};let o=new WeakMap,n={};function s(e){const s=e||n;if(!o.has(s)){const n=t.getLocaleLanguage(),i=n&&r[n]||t.normalizeLocale();o.set(s,new Intl.NumberFormat(i,e))}return o.get(s)}t.beforeLocaleChange(()=>{o=new WeakMap,n={}});const i=new Map;e.convertNumberFormatToIntlOptions=function(e={}){const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t},e.formatNumber=function(e,t){return Object.is(e,-0)&&(e=0),s(t).format(e)},e.getFormatter=s,e.parseNumber=function(e,r=t.getLocale()){if(!e)return null;let o=i.get(r);if(!o){const e=s().formatToParts(12345.6),t=[...s({useGrouping:!1}).format(9876543210)].reverse(),n=new Map(t.map((e,t)=>[e,t])),a=new RegExp(`[${e.find(e=>"group"===e.type)?.value}]`,"g"),l=new RegExp(`[${e.find(e=>"decimal"===e.type)?.value}]`),c=new RegExp(`[${t.join("")}]`,"g"),u=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,f=/[-\u2212\u2013\u2014\u2015]/g;o=e=>{if(""===(e=e.trim().replaceAll(a,"").replace(l,".").replace(c,e=>String(n.get(e))).replaceAll(u,"").replaceAll(f,"-")))return null;const t=Number(e);return isNaN(t)?null:t},i.set(r,o)}return o(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl/substitute":function(){define(["exports","../core/Logger","../core/object","../core/string","./date","./number"],function(e,t,r,o,n,s){"use strict";const i=()=>t.getLogger("esri.intl.substitute");function a(e){switch(typeof e){case"string":return e;case"number":return s.formatNumber(e);case"boolean":return""+e;default:return e instanceof Date?n.formatDate(e):""}}e.substitute=function(e,t,l={}){const{format:c={}}=l;return o.replace(e,e=>function(e,t,o){let l,c;const u=e.indexOf(":");if(-1===u?l=e.trim():(l=e.slice(0,u).trim(),c=e.slice(u+1).trim()),!l)return"";const f=r.getDeepValue(l,t);if(null==f)return"";const d=(c?o?.[c]:null)??o?.[l];return d?function(e,t){switch(t.type){case"date":return n.formatDate(e,t.intlOptions);case"number":return s.formatNumber(e,t.intlOptions);default:return i().warn("missing format descriptor for key {key}"),a(e)}}(f,d):c?function(e,t){switch(t.toLowerCase()){case"dateformat":return n.formatDate(e);case"numberformat":return s.formatNumber(e);default:return i().warn(`inline format is unsupported since 4.12: ${t}`),/^(dateformat|datestring)/i.test(t)?n.formatDate(e):/^numberformat/i.test(t)?s.formatNumber(e):a(e)}}(f,c):a(f)}(e,t,c))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl/messages":function(){define(["exports","../core/Error","../core/handleUtils","../core/promiseUtils","./locale"],function(e,t,r,o,n){"use strict";const s={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function i(e){if(function(e){return e in s}(e)){const t=s[e];return!0===t?e:t}return null}const a=[],l=new Map;function c(e){for(const t of l.keys())u(e.pattern,t)&&l.delete(t)}function u(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}n.beforeLocaleChange(()=>{l.clear()});const f=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=o.createResolver())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}},d={cache:l,loaders:a};e.fetchMessageBundle=async function(e){const r=n.getLocale();l.has(e)||l.set(e,async function(e,r){const o=[];for(const t of a)if(u(t.pattern,e))try{return await t.fetchMessageBundle(e,r)}catch(e){o.push(e)}if(o.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:o});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,r));const o=l.get(e);return o&&await f.add(o),o},e.messageBundlesLocaleMap=s,e.normalizeMessageBundleLocale=function(e){const t=n.getLocaleLanguage(e);return t?i(e)??i(t):null},e.registerMessageBundleLoader=function(e){return a.includes(e)||(c(e),a.unshift(e)),r.makeHandle(()=>{const t=a.indexOf(e);t>-1&&(a.splice(t,1),c(e))})},e.test=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl/t9n":function(){define(["exports","../request","../core/Error","./messages"],function(e,t,r,o){"use strict";async function n(e){if(null!=i.fetchBundleAsset)return i.fetchBundleAsset(e);const r=await t(e,{responseType:"text"});return JSON.parse(r.data)}class s{constructor({base:e="",pattern:t,location:r=new URL(window.location.href)}){let o;o="string"==typeof r?e=>new URL(e,new URL(r,window.location.href)).href:r instanceof URL?e=>new URL(e,r).href:r,this.pattern="string"==typeof t?new RegExp(`^${t}`):t,this.getAssetUrl=o,e=e?e.endsWith("/")?e:e+"/":"",this.matcher=new RegExp(`^${e}(?:(.*)\\/)?(.*)$`)}fetchMessageBundle(e,t){return async function(e,t,s,i){const a=t.exec(s);if(!a)throw new r("esri-intl:invalid-bundle",`Bundle id "${s}" is not compatible with the pattern "${t}"`);const l=a[1]?`${a[1]}/`:"",c=a[2],u=o.normalizeMessageBundleLocale(i),f=`${l}${c}.json`,d=u?`${l}${c}_${u}.json`:f;let h;try{h=await n(e(d))}catch(t){if(d===f)throw new r("intl:unknown-bundle",`Bundle "${s}" cannot be loaded`,{error:t});try{h=await n(e(f))}catch(e){throw new r("intl:unknown-bundle",`Bundle "${s}" cannot be loaded`,{error:e})}}return h}(this.getAssetUrl,this.matcher,e,t)}}const i={};e.JSONLoader=s,e.createJSONLoader=function(e){return new s(e)},e.test=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/loaderConfig":function(){define(["exports","../../assets","../has","../urlUtils"],function(e,t,r,o){"use strict";e.defaultLoaderUrl=null,e.defaultLoaderUrl=o.makeAbsolute(t.getAssetUrl("esri/core/workers/init.js"));const n={};n.baseUrl=o.makeAbsolute(t.getAssetUrl("dojo/")),n.packages=[{name:"esri",location:"../esri"}],e.loaderConfig=function(e){const t={async:e.async,isDebug:e.isDebug,locale:e.locale,baseUrl:e.baseUrl,has:{...e.has},map:{...e.map},packages:e.packages?.slice()||[],paths:{...n.paths,...e.paths}};return e.hasOwnProperty("async")||(t.async=!0),e.hasOwnProperty("isDebug")||(t.isDebug=!1),e.baseUrl||(t.baseUrl=n.baseUrl),n.packages?.forEach(e=>{!function(e,t){for(const r of e)if(r.name===t.name)return;e.push(t)}(t.packages??[],e)}),t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerFallback":function(){define(["require","../nextTick","./RemoteClient","./utils"],function(e,t,r,o){"use strict";function n(e){if(e&&e.__esModule)return e;const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const r in e)if("default"!==r){const o=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:()=>e[r]})}return t.default=e,Object.freeze(t)}class s{constructor(){const e=document.createDocumentFragment();["addEventListener","dispatchEvent","removeEventListener"].forEach(t=>{this[t]=(...r)=>e[t](...r)})}}return class{constructor(){this._dispatcher=new s,this._workerPostMessage({type:o.MessageType.HANDSHAKE})}terminate(){}get onmessage(){return this._onmessageHandler}set onmessage(e){this._onmessageHandler&&this.removeEventListener("message",this._onmessageHandler),this._onmessageHandler=e,e&&this.addEventListener("message",e)}get onmessageerror(){return this._onmessageerrorHandler}set onmessageerror(e){this._onmessageerrorHandler&&this.removeEventListener("messageerror",this._onmessageerrorHandler),this._onmessageerrorHandler=e,e&&this.addEventListener("messageerror",e)}get onerror(){return this._onerrorHandler}set onerror(e){this._onerrorHandler&&this.removeEventListener("error",this._onerrorHandler),this._onerrorHandler=e,e&&this.addEventListener("error",e)}postMessage(e){t.nextTick(()=>{this._workerMessageHandler(new MessageEvent("message",{data:e}))})}dispatchEvent(e){return this._dispatcher.dispatchEvent(e)}addEventListener(e,t,r){this._dispatcher.addEventListener(e,t,r)}removeEventListener(e,t,r){this._dispatcher.removeEventListener(e,t,r)}_workerPostMessage(e){t.nextTick(()=>{this.dispatchEvent(new MessageEvent("message",{data:e}))})}async _workerMessageHandler(t){const s=o.receiveMessage(t);if(s&&s.type===o.MessageType.OPEN){const{modulePath:t,jobId:i}=s;let a=await r.loadWorker(t);a||(a=await new Promise((r,o)=>e([t],e=>r(n(e)),o)));const l=r.connect(a);this._workerPostMessage({type:o.MessageType.OPENED,jobId:i,data:l})}}}})},"esri/geometry/projection/projectVectorToVector":function(){define(["exports","../projectionUtils","../SpatialReference","./projectPointToVector","../../layers/graphics/dehydratedPoint"],function(e,t,r,o,n){"use strict";function s(e,t,r,n,s){return!(null==t||null==n||e.length<2)&&(i.x=e[0],i.y=e[1],i.z=e[2],i.spatialReference=t,o.projectPointToVector(i,r,n,s))}const i=n.makeDehydratedPoint(0,0,0,r.WGS84);e.projectVectorToVector=s,e.projectVectorToVectorAsync=async function(e,r,o,n,i,a){return await t.initializeProjection(r,n,null,a),s(e,r,o,n,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/projection/projectPointToVector":function(){define(["exports","../../core/libs/gl-matrix-2/factories/vec3f64","../projectionUtils","./projectBuffer"],function(e,t,r,o){"use strict";function n(e,t,n,i){if(r.canProjectWithoutEngine(e.spatialReference,n)){s[0]=e.x,s[1]=e.y;const r=e.z;return s[2]=r??i??0,o.projectBuffer(s,e.spatialReference,0,t,n,0)}const a=r.tryProjectWithZConversion(e,n);return!!a&&(t[0]=a?.x,t[1]=a?.y,t[2]=a?.z??i??0,!0)}const s=t.create();e.projectPointToVector=n,e.projectPointToVectorAsync=async function(e,t,o,s,i){return await r.initializeProjection(e.spatialReference,o,null,i),n(e,t,o,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedPoint":function(){define(["exports"],function(e){"use strict";e.ImmutableDehydratedPoint=class{constructor(e,t,r,o,n){this.spatialReference=e,this._position=void 0!==n?[t,r,o??0,n??0]:void 0!==o?[t,r,o??0]:[t,r],this._flags=(void 0!==o?1:0)+(void 0!==n?2:0)}get hasZ(){return!(1&~this._flags)}get hasM(){return!(2&~this._flags)}get type(){return"point"}get x(){return this._position[0]}get y(){return this._position[1]}get z(){return this.hasZ?this._position[2]:void 0}get m(){return this.hasM?this._position[3]:void 0}},e.makeDehydratedPoint=function(e,t,r,o){return{x:e,y:t,z:r,hasZ:null!=r,hasM:!1,spatialReference:o,type:"point"}},e.setDehydratedPoint=function(e,t,r,o,n){e.x=t,e.y=r,e.z=o,e.hasZ=null!=o,e.spatialReference=n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["require","exports","../../../core/mathUtils","../../../geometry/SpatialReference","../../../geometry/support/DoubleArray","../../../geometry/support/MeshGeoreferencedVertexSpace","../../../geometry/support/MeshLocalVertexSpace","../../../chunks/vec3","../../../libs/i3s/I3SModule","./I3SMeshWorkerHandle"],function(e,t,r,o,n,s,i,a,l,c){"use strict";let u,f;function d(e){if(!f)return;const t=e.modifications,r=f._malloc(8*t.length),o=new Float64Array(f.HEAPU8.buffer,r,t.length);for(let e=0;e<t.length;++e)o[e]=t[e];f.setModifications(e.context,r,t.length,e.isGeodetic),f._free(r)}function h(e,t,r){const{context:o,globalTrafo:n,mbs:s,obbData:i,elevationOffset:a,geometryBuffer:l,geometryDescriptor:u,indexToVertexProjector:f,vertexToRenderProjector:d}=t,h=e._malloc(l.byteLength),p=e._malloc(33*Float64Array.BYTES_PER_ELEMENT),g=new Uint8Array(e.HEAPU8.buffer,h,l.byteLength);g.set(new Uint8Array(l));const y=new Float64Array(e.HEAPU8.buffer,p,33);m(y,[NaN,NaN,NaN]);let b=y.byteOffset+3*y.BYTES_PER_ELEMENT,w=new Float64Array(y.buffer,b);m(w,n),b+=16*y.BYTES_PER_ELEMENT,w=new Float64Array(y.buffer,b),m(w,s),b+=4*y.BYTES_PER_ELEMENT,i&&(w=new Float64Array(y.buffer,b),m(w,i));const _=u,v={isDraco:!1,isLegacy:!1,color:t.layouts.some(e=>e.some(e=>"color"===e.name)),normal:t.needNormals&&t.layouts.some(e=>e.some(e=>"normalCompressed"===e.name)),uv0:t.layouts.some(e=>e.some(e=>"uv0"===e.name)),uvRegion:t.layouts.some(e=>e.some(e=>"uvRegion"===e.name)),featureIndex:_.featureIndex},k=e.process(o,!!t.obbData,h,g.byteLength,_,v,p,a,f,d,t.normalReferenceFrame);if(e._free(p),e._free(h),k.error.length>0)throw new Error(`i3s.wasm: ${k.error}`);if(k.discarded)return null;const S=k.componentOffsets.length>0?k.componentOffsets.slice():null,M=k.featureIds.length>0?k.featureIds.slice():null,P=k.anchorIds.length>0?Array.from(k.anchorIds):null,L=k.anchors.length>0?Array.from(k.anchors):null,j=k.interleavedVertedData.slice().buffer,E=1===k.indicesType?new Uint16Array(k.indices.buffer,k.indices.byteOffset,k.indices.byteLength/2).slice():new Uint32Array(k.indices.buffer,k.indices.byteOffset,k.indices.byteLength/4).slice(),A=k.positions.slice(),{buffer:O,byteOffset:x,byteLength:N}=k.positionIndices,T=1===k.positionIndicesType?new Uint16Array(O,x,N/2).slice():new Uint32Array(O,x,N/4).slice(),R=new c.TransformedGeometry(t.layouts[0],j,E,k.hasColors,k.hasModifications,{data:A,indices:T});return M&&r.push(M.buffer),S&&r.push(S.buffer),r.push(j),r.push(E.buffer),r.push(A.buffer),r.push(T.buffer),new c.TransformedData(S,M,P,L,R,n,k.obb)}function p(e){if(!f)return;const{context:t,buffer:r}=e,o=f._malloc(r.byteLength),n=r.byteLength/Float64Array.BYTES_PER_ELEMENT,s=new Float64Array(f.HEAPU8.buffer,o,n),i=new Float64Array(r);s.set(i),f.filterOBBs(t,o,n),i.set(s),f._free(o)}function g(e){f&&0===f.destroy(e)&&(f=null,u=null,l.cleanup())}function m(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}async function y(){return f||(f=await(u??=l.get())),f}const b={transform:(e,t)=>f&&h(f,e,t),destroy:g};t.destroyContext=function(e){g(e)},t.dracoDecompressPointCloudData=async function(e){f=await y();const t=[e.geometryBuffer],{geometryBuffer:r}=e,o=r.byteLength,n=f._malloc(o),s=new Uint8Array(f.HEAPU8.buffer,n,o);s.set(new Uint8Array(r));const i=f.dracoDecompressPointCloudData(n,s.byteLength);if(f._free(n),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);const a=i.featureIds?.length>0?i.featureIds.slice():null,l=i.positions.slice();return a&&t.push(a.buffer),t.push(l.buffer),{result:{positions:l,featureIds:a},transferList:t}},t.filterObbsForModifications=async function(e){await y(),p(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}},t.filterObbsForModificationsSync=p,t.initialize=async function(){f||await y()},t.interpretObbModificationResults=function(e){return 0===e?0:1===e?1:2===e?2:3},t.process=async function(e){f=await y();const t=[e.geometryBuffer];return{result:h(f,e,t),transferList:t}},t.project=async function(t){const{localMatrix:r,origin:a,positions:l,vertexSpace:c}=t,u=o.fromJSON(t.inSpatialReference),f=o.fromJSON(t.outSpatialReference),d=r?n.ensurePackedArray(r):void 0,h=n.ensurePackedArray(a);let p;const[{projectBuffer:g},{initializeProjection:m}]=await Promise.all([new Promise((t,r)=>e(["../../../geometry/projection/projectBuffer"],t,r)),new Promise((t,r)=>e(["../../../geometry/projectionUtils"],t,r))]);await m(u,f);const y=[0,0,0];if(!g(h,u,0,y,f,0))throw new Error("Failed to project");if("georeferenced"===c.type&&null==c.origin){if(p=new Float64Array(l.length),!g(l,u,0,p,f,0,p.length/3))throw new Error("Failed to project")}else{const t="georeferenced"===c.type?s.fromJSON(c):i.fromJSON(c),{projectMeshVertexPositions:r}=await new Promise((t,r)=>e(["../../../geometry/support/meshUtils/projectMeshVertexPositions"],t,r)),o=r({vertexAttributes:{position:l},transform:d?{localMatrix:d}:void 0,vertexSpace:t,spatialReference:u},f);if(!o)throw new Error("Failed to project");p=o}const b=p.length,[w,_,v]=y;for(let e=0;e<b;e+=3)p[e]-=w,p[e+1]-=_,p[e+2]-=v;return{result:{projected:p,original:l,projectedOrigin:y},transferList:[p.buffer,l.buffer]}},t.setLegacySchema=async function(e){f=await y(),f.setLegacySchema(e.context,e.jsonSchema)},t.setModifications=async function(e){await y(),d(e)},t.setModificationsSync=d,t.test=b,t.transformNormals=async function({normalMatrix:e,normals:t}){const o=new Float32Array(t.length);return a.transformMat3(o,t,e),r.hasScaling(e)&&a.normalize(o,o),{result:{transformed:o,original:t},transferList:[o.buffer,t.buffer]}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});