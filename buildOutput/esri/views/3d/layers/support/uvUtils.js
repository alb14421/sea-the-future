// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/libs/gl-matrix-2/factories/mat4f64","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/ellipsoidUtils","../../../../geometry/projection/projectors","../../../../geometry/support/DoubleArray","../../../../geometry/support/plane"],function(e,t,r,o,a,c,s,n,l,i){"use strict";const m=c.create(),I=c.create(),d=i.create(),f=c.create(),u=c.create(),b=c.create(),g=o.create(),N=o.create(),h=c.create(),p=c.create(),T=c.create(),M=t.create(),y=c.create(),A=c.create(),E=c.create(),x=c.create();function S(e,t,r,o,c,s,n){a.set(e,t*c[0]+r*s[0]+o*n[0],t*c[1]+r*s[1]+o*n[1],t*c[2]+r*s[2]+o*n[2])}e.createMapSpaceUVCoords=function(e,t,o,c,s=1){a.set(f,1,0,0),a.set(u,0,1,0),a.set(b,0,0,1),function(e,t){a.set(x,0,0,0);for(let e=0;e<t.length-3;e+=3)x[0]+=t[e],x[1]+=t[e+1],x[2]+=t[e+2];a.scale(e,x,1/(t.length/3-1))}(m,o),i.fromArray(d,o)&&function(e,t,r,o,c,s){null!=c?(c.basisMatrixAtPosition(s,M),a.set(y,M[0],M[1],M[2]),a.set(A,M[4],M[5],M[6]),a.set(E,M[8],M[9],M[10])):(a.set(y,1,0,0),a.set(A,0,1,0),a.set(E,0,0,1));const n=i.getNormal(e);a.dot(n,E)<0&&a.scale(n,n,-1),a.copy(o,n);const l=a.dot(n,A),m=a.dot(n,y);Math.abs(l)>Math.abs(m)?(a.scaleAndAdd(t,y,n,-m),a.normalize(t,t),a.cross(r,t,n),a.normalize(r,r),a.scale(r,r,-1)):(a.scaleAndAdd(r,A,n,-l),a.normalize(r,r),a.cross(t,r,n),a.normalize(t,t))}(d,f,u,b,c,m),r.set(g,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r.set(N,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let e=0;e<o.length;e+=3){a.set(I,o[e],o[e+1],o[e+2]);const t=a.dot(f,I),r=a.dot(u,I);g[0]=Math.min(g[0],t),g[1]=Math.min(g[1],r),N[0]=Math.max(N[0],t),N[1]=Math.max(N[1],r)}const n=a.dot(b,m);S(h,g[0],g[1],n,f,u,b),S(p,N[0],g[1],n,f,u,b),S(T,g[0],N[1],n,f,u,b),a.subtract(p,p,h),a.scale(p,p,.5),a.subtract(T,T,h),a.scale(T,T,.5),a.add(h,h,p),a.add(h,h,T);const l=g[0]%s,V=g[1]%s,F=g[0]-l,P=g[1]-V;for(let r=0;r<o.length;r+=3){a.set(I,o[r],o[r+1],o[r+2]);const c=r/3,n=4*c;e[n]=(a.dot(f,I)-F)/s,e[n+1]=(a.dot(u,I)-P)/s,e[n+2]=F/s,e[n+3]=P/s;const l=9*c;for(let e=0;e<3;e++)t[l+e]=h[e],t[l+e+3]=p[e],t[l+e+6]=T[e]}},e.createMapSpaceUVCoordsDraped=function(e,t,o,a,c=1){if(o.isGeographic&&1===a){const e=l.newDoubleArray(t.length),r=t.length,a=s.getReferenceEllipsoid(o);for(let o=0;o<r;o+=3)n.lonLatToWebMercatorComparable(t,o,e,o,a);t=e}r.set(g,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let e=0;e<t.length;e+=3)g[0]=Math.min(g[0],t[e]),g[1]=Math.min(g[1],t[e+1]);const i=g[0]%c,m=g[1]%c,I=g[0]-i,d=g[1]-m;for(let r=0;r<t.length;r+=3){const o=r/3*4;e[o]=(t[r]-I)/c,e[o+1]=(t[r+1]-d)/c,e[o+2]=I/c,e[o+3]=d/c}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});