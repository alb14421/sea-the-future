// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../Graphic","../../../../graphic/IntegratedMesh3DTilesGraphicOrigin","../i3s/Intersector","../../webgl-engine/lib/IntersectorResult","../../webgl-engine/lib/RayIntersections"],function(e,i,t,r,n,s){"use strict";e.Tiles3DIntersectionHandler=class{constructor(e){this.type=8,this.slicePlaneEnabled=!1,this.isGround=!0,this.layerView=e,this.layerViewUid=e.uid,this._graphicOrigin=new t(this.layerView.layer)}intersect(e,i,t,l,a,o){if(e.options.filteredLayerViewUids.includes(this.layerView.uid))return;const c=e.results,u=2===e.options.store,d=this.layerView.view.stage.renderView.componentObjectCollection,h=new s.MeshIntersectionOptions(o,e.options.normalRequired);this.layerView.objects.forEach(s=>{s.visible&&s.intersectionGeometry&&d.intersect(s,t,l,e.tolerance,null,h,(s,a,o,d)=>{if(a>=0){if(null!=i&&!i(t,l,a))return;const s=e=>{const i=new r.Tiles3DTarget(this.layerView.layer.uid,()=>this._createTiles3DGraphic(this.layerView.layer,{}));e.set(this.type,i,a,o)};if(this.isGround&&(null==c.ground.distance||a<c.ground.distance)&&s(c.ground),e.options.isFiltered)return;if((null==c.min.distance||a<c.min.distance)&&s(c.min),(null==c.max.distance||a>c.max.distance)&&s(c.max),u){const i=new n.IntersectorResult(e.ray);s(i),e.results.all.push(i)}}})})}_createTiles3DGraphic(e,t){return new i({layer:e,sourceLayer:e,origin:this._graphicOrigin,attributes:t})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});