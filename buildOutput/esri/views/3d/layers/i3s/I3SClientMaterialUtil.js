// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../Color","../../../../core/Error","../../../../support/requestUtils","../../glTF/internal/resourceUtils","../../webgl-engine/materials/pbrUtils","../../../../webscene/support/AlphaCutoff"],function(e,t,a,o,r,s,n){"use strict";async function l(e,t,s,n){if(null==e)return-1;const l=s.length,u=e.data,i=e.url;if(null!=u){if(u instanceof HTMLImageElement||u instanceof HTMLCanvasElement)return s.push({id:l,usage:n,data:u,encoding:8}),t.push({id:l,usage:n,encodings:[{name:void 0,encoding:8}]}),l;if(u instanceof HTMLVideoElement)return-1;if(u instanceof ImageData)throw new a("scenelayer","ImageData textures not supported yet for client side I3S nodes");if(u instanceof r.EncodedMeshTexture)return s.push({id:l,usage:n,data:u.data,encoding:1}),t.push({id:l,usage:n,encodings:[{name:void 0,encoding:1}]}),l}else if(null!=i){const e=new Image;e.src=i;const a=await o.loadImageAsync(e,e.src,!1,void 0);return s.push({id:l,usage:n,data:a,encoding:8}),t.push({id:l,usage:n,encodings:[{name:void 0,encoding:8}]}),l}return-1}e.convertMeshMaterialToPBRMaterial=async function(e){const a=[],o=[];if(null==e)return{material:{alphaMode:"opaque",alphaCutoff:n.alphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[1,1,1,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6000000238418579},wrapTextures:!1,hasParametersFromSource:!0},requiredTextures:a,textureData:o};const r=function(e){return e.hasOwnProperty("metallicRoughnessTexture")}(e);"auto"===e.alphaMode&&console.warn('alphaMode "auto" not supported by I3S PBRMaterial - defaulting to "blend".');const u=s.useSchematicPBR({normalTexture:e.normalTexture,emissiveTexture:r?e.emissiveTexture:null,emissiveFactor:r?t.toUnitRGB(e.emissiveColor):null,occlusionTexture:r?e.occlusionTexture:null,metallicRoughnessTexture:r?e.metallicRoughnessTexture:null,metallicFactor:r?e.metallic:null,roughnessFactor:r?e.roughness:null}),i=u?s.schematicMRRFactors[0]:r?e.metallic:0,c=u?s.schematicMRRFactors[1]:r?e.roughness:0;return{material:{alphaMode:"auto"===e.alphaMode?"blend":e.alphaMode,alphaCutoff:e.alphaCutoff,doubleSided:e.doubleSided,cullFace:e.doubleSided?0:2,normalTextureId:await l(e.normalTexture,a,o,4),emissiveTextureId:r?await l(e.emissiveTexture,a,o,16):-1,occlusionTextureId:r?await l(e.occlusionTexture,a,o,8):-1,emissiveFactor:r&&null!=e.emissiveColor?t.toUnitRGB(e.emissiveColor):[0,0,0],metallicRoughness:{baseColorFactor:null!=e.color?t.toUnitRGBA(e.color):[1,1,1,1],baseColorTextureId:await l(e.colorTexture,a,o,1),metallicRoughnessTextureId:r?await l(e.metallicRoughnessTexture,a,o,2):-1,metallicFactor:i,roughnessFactor:c},wrapTextures:!0,hasParametersFromSource:u},requiredTextures:a,textureData:o}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});