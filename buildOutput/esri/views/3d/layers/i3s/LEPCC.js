// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/Error"],function(e,t){"use strict";const o=!0;function n(e,t,n){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,n+0,10)),version:t.getUint16(n+10,o),checksum:t.getUint32(n+12,o)}}function r(e,t,o){const n=[];t=i(e,t,n);const r=[];for(let c=0;c<n.length;c++){r.length=0,t=i(e,t,r);for(let e=0;e<r.length;e++)o.push(r[e]+n[c])}return t}function i(e,n,r){const i=new DataView(e,n),c=i.getUint8(0),d=31&c,l=!!(32&c),s=(192&c)>>6;let a=0;if(0===s)a=i.getUint32(1,o),n+=5;else if(1===s)a=i.getUint16(1,o),n+=3;else{if(2!==s)throw new t("lepcc-decode-error","Bad count type");a=i.getUint8(1),n+=2}if(l)throw new t("lepcc-decode-error","LUT not implemented");const u=Math.ceil(a*d/8),w=new Uint8Array(e,n,u);let f=0,h=0,g=0;const p=-1>>>32-d;for(let e=0;e<a;e++){for(;h<d;)f|=w[g]<<h,h+=8,g+=1;r[e]=f&p,f>>>=d,h-=d,h+d>32&&(f|=w[g-1]>>8-h)}return n+g}e.decodeIntensity=function(e){const r=new DataView(e,0);let c=0;const{identifier:d,version:l}=n(e,r,c);if(c+=16,"Intensity "!==d)throw new t("lepcc-decode-error","Bad identifier");if(l>1)throw new t("lepcc-decode-error","Unknown version");const s=function(e,t){return{sizeLo:e.getUint32(t+0,o),sizeHi:e.getUint32(t+4,o),count:e.getUint32(t+8,o),scaleFactor:e.getUint16(t+12,o),bitsPerPoint:e.getUint8(t+14),reserved:e.getUint8(t+15)}}(r,c);if(c+=16,s.sizeHi*2**32+s.sizeLo!==e.byteLength)throw new t("lepcc-decode-error","Bad size");const a=new Uint16Array(s.count);if(8===s.bitsPerPoint){if(s.count+c!==e.byteLength)throw new t("lepcc-decode-error","Bad size");const o=new Uint8Array(e,c,s.count);for(let e=0;e<s.count;e++)a[e]=o[e]*s.scaleFactor}else if(16===s.bitsPerPoint){if(2*s.count+c!==e.byteLength)throw new t("lepcc-decode-error","Bad size");const o=new Uint16Array(e,c,s.count);for(let e=0;e<s.count;e++)a[e]=o[e]*s.scaleFactor}else{const o=[];if(i(e,c,o)!==e.byteLength)throw new t("lepcc-decode-error","Bad size");for(let e=0;e<s.count;e++)a[e]=o[e]*s.scaleFactor}return a},e.decodeRGB=function(e){const r=new DataView(e,0);let i=0;const{identifier:c,version:d}=n(e,r,i);if(i+=16,"ClusterRGB"!==c)throw new t("lepcc-decode-error","Bad identifier");if(d>1)throw new t("lepcc-decode-error","Unknown version");const l=function(e,t){return{sizeLo:e.getUint32(t+0,o),sizeHi:e.getUint32(t+4,o),count:e.getUint32(t+8,o),colorMapCount:e.getUint16(t+12,o),lookupMethod:e.getUint8(t+14),compressionMethod:e.getUint8(t+15)}}(r,i);if(i+=16,l.sizeHi*2**32+l.sizeLo!==e.byteLength)throw new t("lepcc-decode-error","Bad size");if((2===l.lookupMethod||1===l.lookupMethod)&&0===l.compressionMethod){if(3*l.colorMapCount+l.count+i!==e.byteLength||l.colorMapCount>256)throw new t("lepcc-decode-error","Bad count");const o=new Uint8Array(e,i,3*l.colorMapCount),n=new Uint8Array(e,i+3*l.colorMapCount,l.count),r=new Uint8Array(3*l.count);for(let e=0;e<l.count;e++){const t=n[e];r[3*e]=o[3*t],r[3*e+1]=o[3*t+1],r[3*e+2]=o[3*t+2]}return r}if(0===l.lookupMethod&&0===l.compressionMethod){if(3*l.count+i!==e.byteLength||0!==l.colorMapCount)throw new t("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(l.lookupMethod<=2&&1===l.compressionMethod){if(i+3!==e.byteLength||1!==l.colorMapCount)throw new t("lepcc-decode-error","Bad count");const o=r.getUint8(i),n=r.getUint8(i+1),c=r.getUint8(i+2),d=new Uint8Array(3*l.count);for(let e=0;e<l.count;e++)d[3*e]=o,d[3*e+1]=n,d[3*e+2]=c;return d}throw new t("lepcc-decode-error","Bad method "+l.lookupMethod+","+l.compressionMethod)},e.decodeXYZ=function(e){const i=new DataView(e,0);let c=0;const{identifier:d,version:l}=n(e,i,c);if(c+=16,"LEPCC     "!==d)throw new t("lepcc-decode-error","Bad identifier");if(l>1)throw new t("lepcc-decode-error","Unknown version");const s=function(e,t){return{sizeLo:e.getUint32(t+0,o),sizeHi:e.getUint32(t+4,o),minX:e.getFloat64(t+8,o),minY:e.getFloat64(t+16,o),minZ:e.getFloat64(t+24,o),maxX:e.getFloat64(t+32,o),maxY:e.getFloat64(t+40,o),maxZ:e.getFloat64(t+48,o),errorX:e.getFloat64(t+56,o),errorY:e.getFloat64(t+64,o),errorZ:e.getFloat64(t+72,o),count:e.getUint32(t+80,o),reserved:e.getUint32(t+84,o)}}(i,c);if(c+=88,s.sizeHi*2**32+s.sizeLo!==e.byteLength)throw new t("lepcc-decode-error","Bad size");const a=new Float64Array(3*s.count),u=[],w=[],f=[],h=[];if(c=r(e,c,u),c=r(e,c,w),c=r(e,c,f),c=r(e,c,h),c!==e.byteLength)throw new t("lepcc-decode-error","Bad length");let g=0,p=0;for(let e=0;e<u.length;e++){p+=u[e];let t=0;for(let o=0;o<w[e];o++){t+=f[g];const e=h[g];a[3*g]=Math.min(s.maxX,s.minX+2*s.errorX*t),a[3*g+1]=Math.min(s.maxY,s.minY+2*s.errorY*p),a[3*g+2]=Math.min(s.maxZ,s.minZ+2*s.errorZ*e),g++}}return{errorX:s.errorX,errorY:s.errorY,errorZ:s.errorZ,result:a}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});