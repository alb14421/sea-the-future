// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/arrayUtils","../../../../core/handleUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/accessorSupport/decorators/subclass","../../../support/Scheduler"],function(e,r,t,s,o,n,a,l,c,i){"use strict";let d=class extends t{constructor(){super(),this.referenceCount=0,this.callbacks=new Array,this.runIndex=0}get readyToRun(){return this.callbacks.some(e=>e.running)}runTask(e){this._sort();const r=this.callbacks,t={numIndexLoading:0,numNodesLoading:0};for(let s=0;s<r.length&&!e.done;++s)r[s].priority=r[s].runTask(e,t),this.runIndex=s}_sort(){const e=this.callbacks;let r=e.length;for(let t=this.runIndex;t>0;t--){const s=e[t-1];let o=t;for(;o<e.length&&s.priority<=e[o].priority&&(o!==r||s.priority<e[o].priority);)e[o-1]=e[o],o++;e[o-1]=s,r=o-1}this.runIndex=0}add(e){this._sort(),e.priority=1/0,this.callbacks.unshift(e),this.notifyChange("readyToRun")}remove(e){s.removeUnordered(this.callbacks,e),this.runIndex=this.callbacks.length,this._sort(),this.notifyChange("readyToRun")}};r.__decorate([n.property({readOnly:!0})],d.prototype,"readyToRun",null),d=r.__decorate([c.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],d);class u{constructor(e,r){this.task=e,this.handle=r}}const h=new Map;e.addCallback=function(e,r){let t=h.get(e);if(null==t){const r=new d,s=e.registerTask(i.TaskPriority.I3S_CONTROLLER,r);t=new u(r,s),h.set(e,t)}return t.task.add(r),o.makeHandle(()=>{null!=t&&(t.task.remove(r),t.task.callbacks.length>0||(h.delete(e),t.handle.remove(),t.task.destroy()),t=null)})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});