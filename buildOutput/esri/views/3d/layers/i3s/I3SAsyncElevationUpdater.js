// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../graphics/ExtentSet","../../../support/Scheduler"],function(t,e,s,r,i,o,a,n,d,c){"use strict";t.I3SAsyncElevationUpdater=class extends s{constructor(t,e,s,r){super({}),this._updateExtent=e,this._updateNode=s,this._getElevationMode=r,this.readyToRun=!1,this._extentSet=new d.ExtentSet,this._nodeSet=new Set;const i=this._taskPriority,o=t.registerTask(this._taskPriority,this);this.addHandles(o),this._task=o,this._lastTaskPriority=i}destroy(){this._extentSet.destroy()}get _taskPriority(){const t=this._getElevationMode();return t&&1===t?c.TaskPriority.ELEVATION_ALIGNMENT_SCENE:c.TaskPriority.ELEVATION_ALIGNMENT}_updateTaskPriority(){const t=this._taskPriority;t!==this._lastTaskPriority&&(this._task.priority=t,this._lastTaskPriority=t)}addExtent(t){this._extentSet.add(t),this._updateTaskPriority(),this.readyToRun=!0}schedule(t){this._nodeSet.add(t),this._updateTaskPriority(),this.readyToRun=!0}remove(t){this._nodeSet.delete(t),this._updateRunning()}runTask(t){const e=this._extentSet;for(t.run(()=>e.merge(t));!e.empty&&!t.done;){const s=this._updateExtent(e.pop());null!=s&&s.forAll(t=>this.schedule(t)),t.madeProgress()}if(t.done)return;const s=this._nodeSet;for(const e of s)if(s.delete(e),this._updateNode(e),t.madeProgress(),t.done)break;this._updateRunning()}_updateRunning(){this.readyToRun=this._nodeSet.size>0||this._extentSet.size>0}},e.__decorate([r.property()],t.I3SAsyncElevationUpdater.prototype,"readyToRun",void 0),t.I3SAsyncElevationUpdater=e.__decorate([n.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater")],t.I3SAsyncElevationUpdater),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});