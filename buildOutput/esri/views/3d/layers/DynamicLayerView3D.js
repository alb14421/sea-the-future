// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/tslib.es6","../../../core/has","../../../core/Logger","../../../core/maybe","../../../core/promiseUtils","../../../core/accessorSupport/decorators/property","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./DrapedSubView3D","./LayerView3D","./support/LayerViewPerformanceInfo","../../layers/LayerView","../../layers/RefreshableLayerView","../../support/layerViewUtils","../../support/projectionUtils"],function(e,t,r,s,i,a,o,n,d,l,u,c,p,h,y,f){"use strict";return e.default=class extends(h.RefreshableLayerView(u.LayerView3D(p))){constructor(){super(...arguments),this.fullExtentInLocalViewSpatialReference=null,this.refreshDebounced=a.debounce(async e=>{this.destroyed||await this._doRefresh(e).catch(e=>{a.isAbortError(e)||s.getLogger(this).error(e)})},2e3),this.ignoresMemoryFactor=!1,this.unloadedMemory=0}get visibleAtCurrentScale(){const e=this.layer,t="effectiveScaleRange"in e?e.effectiveScaleRange:null;return y.isInEffectiveScaleRange(t,this.view.scale)}isUpdating(){return super.isUpdating()||this.subView?.updating}initialize(){this._initSubView(),"local"===this.view.viewingMode&&this.addResolvingPromise((async()=>this.fullExtentInLocalViewSpatialReference=await f.projectWithZConversionSilent(this.layer.fullExtent,this.view.spatialReference))()),this._updatingHandles.add(()=>this.suspended,()=>this._suspendedChangeHandler())}destroy(){this.subView=i.destroyMaybe(this.subView)}_initSubView(){this.subView=new l({layerView:this})}async doRefresh(){return this._doRefresh()}async _doRefresh(e){this.suspended||await this.subView.doRefresh(e)}getFetchOptions(){}_suspendedChangeHandler(){this.suspended?this.subView.clear():this.refreshDebounced()}get test(){}get usedMemory(){return this.subView.usedMemory}get performanceInfo(){return new c.LayerViewPerformanceInfo(this.usedMemory)}},t.__decorate([o.property()],e.default.prototype,"layer",void 0),t.__decorate([o.property()],e.default.prototype,"suspended",void 0),t.__decorate([o.property()],e.default.prototype,"fullExtentInLocalViewSpatialReference",void 0),t.__decorate([o.property({readOnly:!0})],e.default.prototype,"visibleAtCurrentScale",null),t.__decorate([o.property()],e.default.prototype,"updating",void 0),t.__decorate([o.property()],e.default.prototype,"subView",void 0),e.default=t.__decorate([d.subclass("esri.views.3d.layers.DynamicLayerView3D")],e.default),e.default});