// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["exports"],function(e){"use strict";e.SchemaHelper=class{constructor(e,t,i){this._scale=e,this._shift=t,this._levelShift=i}getLevelRowColumn(e){const t=this.getLevelShift(e[0]),i=this._shift+t;return i?[e[0]-t,e[1]>>i,e[2]>>i]:e}getLevelShift(e){return Math.min(e,this._levelShift)}getOffset(e,t){let i=0,r=0;const n=this._shift+this.getLevelShift(e[0]);if(n){const a=(1<<n)-1,s=t/(this._scale*(1<<n-1));i=(e[2]&a)*s,r=(e[1]&a)*s}return[i,r]}getScale(e){return this._scale*(1<<this._shift+this.getLevelShift(e))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/TileHandler3D":function(){define(["../../../../core/MemCache","../../../../core/promiseUtils","../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../geometry/support/aaBoundingRect","./constants","./TileHandler","./VectorTile","../../tiling/TileInfoViewPOT","../../tiling/TileKey"],function(e,t,i,r,n,a,s,o,l){"use strict";class u extends a.TileHandler{constructor(e,t,i,r){super(e,t,i,e.tileInfo.lods.length-1),this._memCache=r,this._vectorTiles=new Map,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map,this._tileInfoView=new o(e.tileInfo,e.fullExtent)}destroy(){super.destroy(),this._ongoingRequestToController.forEach(e=>e.abort()),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear(),this._vectorTiles.clear()}async getVectorTile(a,o){const u=new l(a[0],a[1],a[2],0);let c=this._vectorTiles.get(u.id)??this._memCache.get(u.id);if(c)return c.retain(),c;const h=await this._getVectorTileData(u);if(t.throwIfAborted(o),!this._layer)return null;if(c=this._vectorTiles.get(u.id)??this._memCache.get(u.id),c)return c.retain(),c;const p=this._layer.tileInfo.getTileBounds(r.create(),u),f=this._tileInfoView.getTileResolution(a[0]);return c=new s.VectorTile(u,f,p[0],p[3],n.tilePixelSize,n.tilePixelSize,this._styleRepository,this),c.setData(h),h&&(c.retain(),this._memCache.put(u.id,c,e.MinPriority),this._vectorTiles.set(u.id,c)),c.neededForCoverage=!0,c.transforms.tileUnitsToPixels=i.fromValues(1/8,0,0,0,1/8,0,0,0,1),c}updateTileSize(e){this._memCache.updateSize(e.id,e)}onDisposeTile(e){this._vectorTiles.delete(e.id)}_getVectorTileData(e){const t=e.id;if(this._ongoingTileRequests.has(t))return this._ongoingTileRequests.get(t);const i=new AbortController,r={signal:i.signal},n=this._getParsedVectorTileData(e,r).then(e=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),e)).catch(()=>(this._ongoingTileRequests.delete(t),this._ongoingRequestToController.delete(t),null));return this._ongoingTileRequests.set(t,n),this._ongoingRequestToController.set(t,i),n}_getParsedVectorTileData(e,t){return this.fetchTileData(e,t).then(i=>this.parseTileData({key:e,data:i},t))}}return u})},"esri/views/2d/engine/vectorTiles/TileHandler":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/urlUtils","../../../../core/workers/workers","./GlyphMosaic","./GlyphSource","./SpriteMosaic","../../tiling/TileKey"],function(e,t,i,r,n,a,s,o,l){"use strict";e.TileHandler=class{constructor(e,t,i,r){this._layer=e,this._styleRepository=t,this.devicePixelRatio=i,this._sourceDataMaxLOD=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._spriteSourceAbortController=null,this._startOptionsInputSignal=null,this._inputSignalEventListener=null}destroy(){this._connection?.close(),this._connection=null,this._styleRepository=null,this._layer=null,this._spriteMosaic?.destroy(),this._spriteMosaic=null,this._glyphMosaic=null,this._spriteSourceAbortController=t.abortMaybe(this._spriteSourceAbortController),this._spriteSourcePromise=null,this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,this._inputSignalEventListener=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(e){this._requestSprite(e);const t=this._layer.currentStyleInfo.glyphsUrl,o=new s(t?r.addQueryParameters(t,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new a(1024,1024,o),this._broadcastPromise=n.open("WorkerTileHandler",{client:this,schedule:e.schedule,signal:e.signal}).then(t=>{if(this._layer&&(this._connection?.close(),this._connection=t,this._layer&&!this._connection.closed)){const r=t.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},e);Promise.all(r).catch(e=>i.throwIfNotAbortError(e))}})}_requestSprite(e){this._spriteSourceAbortController?.abort();const t=new AbortController;this._spriteSourceAbortController=t;const r=e?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,r&&(this._inputSignalEventListener=function(e){return()=>e.abort()}(t),r.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const{signal:n}=t,a={...e,signal:n};this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,a),this._spriteSourcePromise.then(e=>{i.throwIfAbortError(n),this._spriteMosaic=new o(1024,1024,250),this._spriteMosaic.setSpriteSource(e)})}async updateStyle(e){const t=[];for(const i of e)4===i.type?t.push({type:4,data:{spriteSource:null}}):t.push(i);return await this._broadcastPromise,this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),this._broadcastPromise}setSpriteSource(e){const t=new o(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),this._spriteSourceAbortController=null,t}async setStyle(e,t,i){await this._broadcastPromise,this._styleRepository=e,this._sourceDataMaxLOD=i,this._requestSprite();const n=new s(this._layer.currentStyleInfo.glyphsUrl?r.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);return this._glyphMosaic=new a(1024,1024,n),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:t,sourceDataMaxLOD:this._sourceDataMaxLOD})),this._broadcastPromise}async fetchTileData(e,t){const i=await this._getRefKeys(e,t);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),i,t)}async fetchTilePBFs(e){const t=Object.keys(this._layer.sourceNameToSource),i={},r=await this._getRefKeys(e,i),n=[],a=[];for(let e=0;e<r.length;e++)if(null==r[e].value||null==t[e])a.push(null);else{const s=r[e].value,o=this._getTilePayload(s,t[e],i);o.then(e=>{n.push({...e,key:s})}),a.push(o)}return Promise.all(a).then(()=>n)}async parseTileData(e,t){const i=e&&e.data;if(!i)return null;const{sourceName2DataAndRefKey:r,transferList:n}=i;return 0===Object.keys(r).length?null:this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:r,styleLayerUIDs:e.styleLayerUIDs},{...t,transferList:n}))}async getSprites(e){return await this._spriteSourcePromise,this._spriteMosaic.getSpriteItems(e)}getGlyphs(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}async _getTilePayload(e,t,r){const n=l.pool.acquire(e.id),a=this._layer.sourceNameToSource[t],{level:s,row:o,col:u}=n;l.pool.release(n);try{return{protobuff:await a.requestTile(s,o,u,r),sourceName:t}}catch(e){if(i.isAbortError(e))throw e;return{protobuff:null,sourceName:t}}}async _getRefKeys(e,t){const r=this._layer.sourceNameToSource,n=new Array;for(const i in r){const a=r[i].getRefKey(e,t);n.push(a)}return i.eachAlways(n)}_getSourcesData(e,t,r){const n=[];for(let i=0;i<t.length;i++)if(null==t[i].value||null==e[i])n.push(null);else{const a=t[i].value,s=this._getTilePayload(a,e[i],r);n.push(s)}return i.eachAlways(n).then(e=>{const i={},r=[];for(let n=0;n<e.length;n++){const a=e[n].value;if(a&&a.protobuff&&a.protobuff.byteLength>0){const e=t[n].value.id;i[a.sourceName]={refKey:e,protobuff:a.protobuff},r.push(a.protobuff)}}return{sourceName2DataAndRefKey:i,transferList:r}})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack","../webgl/Rect","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,i,r){"use strict";return class{constructor(t,i,r){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new e(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(i,r){const n=[],a=this._glyphSource,s=new Set,o=1/256;for(const e of r){const t=Math.floor(e*o);s.add(t)}const l=[];return s.forEach(e=>{const t=i+e;if(this._rangePromises.has(t))l.push(this._rangePromises.get(t));else{const r=a.getRange(i,e).then(()=>{this._rangePromises.delete(t)},()=>{this._rangePromises.delete(t)});this._rangePromises.set(t,r),l.push(r)}}),Promise.all(l).then(()=>{let s=this._glyphIndex[i];s||(s={},this._glyphIndex[i]=s);for(const o of r){const r=s[o];if(r){n[o]={sdf:!0,rect:r.rect,metrics:r.metrics,page:r.page,code:o};continue}const l=a.getGlyph(i,o);if(!l?.metrics)continue;const u=l.metrics;let c;if(0===u.width)c=new t(0,0,0,0);else{const t=3,i=u.width+2*t,r=u.height+2*t;let n=i%4?4-i%4:4,a=r%4?4-r%4:4;1===n&&(n=5),1===a&&(a=5),c=this._binPack.allocate(i+n,r+a),c.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new e(this.width-4,this.height-4),c=this._binPack.allocate(i+n,r+a));const s=this._glyphData[this._currentPage],o=l.bitmap;let h,p;if(o)for(let e=0;e<r;e++){h=i*e,p=this.width*(c.y+e+1)+c.x;for(let e=0;e<i;e++)s[p+e+1]=o.at(h+e)}}s[o]={rect:c,metrics:u,tileIDs:null,page:this._currentPage},n[o]={sdf:!0,rect:c,metrics:u,page:this._currentPage,code:o},this._dirties[this._currentPage]=!0}return n})}removeGlyphs(e){for(const t in this._glyphIndex){const i=this._glyphIndex[t];if(!i)continue;let r;for(const t in i)if(r=i[t],r.tileIDs.delete(e),0===r.tileIDs.size){const e=this._glyphData[r.page],n=r.rect;let a,s;for(let t=0;t<n.height;t++)for(a=this.width*(n.y+t)+n.x,s=0;s<n.width;s++)e[a+s]=0;delete i[t],this._dirties[r.page]=!0}}}bind(e,t,n,a=0){if(!this._textures[n]){const t=new r.TextureDescriptor(this.width,this.height);t.pixelFormat=6406,t.wrapMode=33071,this._textures[n]=new i.Texture(e,t,new Uint8Array(this.width*this.height))}const s=this._textures[n];s.setSamplingMode(t),this._dirties[n]&&s.setData(this._glyphData[n]),e.bindTexture(s,a),this._dirties[n]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0,this._binPack=null;for(const e of this._textures)e&&e.dispose();this._textures.length=0}}})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],function(e){"use strict";return class{constructor(t,i){this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new e(0,0,t,i))}get width(){return this._width}get height(){return this._height}allocate(t,i){if(t>this._width||i>this._height)return new e;let r=null,n=-1;for(let e=0;e<this._free.length;++e){const a=this._free[e];t<=a.width&&i<=a.height&&(null===r||a.y<=r.y&&a.x<=r.x)&&(r=a,n=e)}return null===r?new e:(this._free.splice(n,1),r.width<r.height?(r.width>t&&this._free.push(new e(r.x+t,r.y,r.width-t,i)),r.height>i&&this._free.push(new e(r.x,r.y+i,r.width,r.height-i))):(r.width>t&&this._free.push(new e(r.x+t,r.y,r.width-t,r.height)),r.height>i&&this._free.push(new e(r.x,r.y+i,t,r.height-i))),new e(r.x,r.y,t,i))}release(e){for(let t=0;t<this._free.length;++t){const i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}})},"esri/views/2d/engine/webgl/Rect":function(){define(function(){"use strict";return class{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.width=i,this.height=r}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(e,t){"use strict";class i{constructor(e){if(this._metrics=[],!e)return void(this._allBitmaps=null);const t=new Map;let i=0;for(;e.next();)switch(e.tag()){case 1:{const r=e.getMessage();for(;r.next();)switch(r.tag()){case 3:{const e=r.getMessage();let n,a,s,o,l,u,c;for(;e.next();)switch(e.tag()){case 1:n=e.getUInt32();break;case 2:a=e.getBytes();break;case 3:s=e.getUInt32();break;case 4:o=e.getUInt32();break;case 5:l=e.getSInt32();break;case 6:u=e.getSInt32();break;case 7:c=e.getUInt32();break;default:e.skip()}if(e.release(),n){const e=a?.length??0;this._metrics[n]={width:s,height:o,left:l,top:u,advance:c,startOffset:i,length:e},t.set(n,a),i+=e}break}default:r.skip()}r.release();break}default:e.skip()}const r=new Uint8Array(i),n=this._metrics;for(const[e,i]of t){const{startOffset:t,length:a}=n[e];if(i)for(let e=0;e<a;++e)r[t+e]=i[e]}this._allBitmaps=r}getMetrics(e){return this._metrics[e]}getBitmap(e){if(!this._allBitmaps)return;const t=this._metrics[e];if(void 0===t)return;const{startOffset:i,length:r}=t;return 0!==r?new n(this._allBitmaps,i,r):void 0}}class r{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(e){return this._ranges[e]}addRange(e,t){this._ranges[e]=t}}class n{constructor(e,t,i){this._array=e,this._start=t,this.length=i}at(e){return 0<=e&&e<this.length?this._array[this._start+e]:void 0}}return class{constructor(e){this._glyphInfo={},this._baseURL=e}getRange(r,n){const a=this._getFontStack(r);if(a.getRange(n))return Promise.resolve();const s=256*n,o=s+255;if(this._baseURL){const l=this._baseURL.replace("{fontstack}",r).replace("{range}",s+"-"+o);return e(l,{responseType:"array-buffer"}).then(e=>{a.addRange(n,new i(new t(new Uint8Array(e.data),new DataView(e.data))))}).catch(()=>{a.addRange(n,new i)})}return a.addRange(n,new i),Promise.resolve()}getGlyph(e,t){const i=this._getFontStack(e);if(!i)return;const r=Math.floor(t/256),n=i.getRange(r);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}_getFontStack(e){let t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new r),t}}})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define(["../../../../core/has","../../../../symbols/cim/rasterizingUtils","./RectangleBinPack","../webgl/Rect","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,i,r,n,a){"use strict";class s{constructor(e,t,r=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,t<=0&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,r>0&&(this._maxItemSize=r),this._binPack=new i(e-4,t-4)}destroy(){this.dispose()}dispose(){this._binPack=null,this._mosaicsData.length=0,this._mosaicRects={};for(const e of this._textures)e&&e.dispose();this._textures.length=0}getWidth(e){return e>=this._size.length?-1:this._size[e][0]}getHeight(e){return e>=this._size.length?-1:this._size[e][1]}getPageSize(e){return e>=this._size.length?null:this._size[e]}setSpriteSource(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new i(this._pageWidth-4,this._pageHeight-4);const e=Math.floor(this._pageWidth),t=Math.floor(this._pageHeight),r=new Uint32Array(e*t);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}getSpriteItem(e,t=!1){let i,r,n=this._mosaicRects[e];if(n)return n;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith("dasharray-")?([i,r]=this._rasterizeDash(e),t=!0):i=this._sprites.getSpriteInfo(e),!i?.width||!i.height||i.width<0||i.height<0)return null;const a=i.width,s=i.height,[o,l,u]=this._allocateImage(a,s);return o.width<=0?null:(this._copy(o,i,l,u,t,r),n={type:"sprite",rect:o,width:a,height:s,sdf:i.sdf,simplePattern:!1,rasterizationScale:i.pixelRatio??1,samplingMode:"Linear",page:l},this._mosaicRects[e]=n,n)}getSpriteItems(e){const t={};for(const i of e)t[i.name]=this.getSpriteItem(i.name,i.repeat);return t}getMosaicItemPosition(e,t){const i=this.getSpriteItem(e,t),r=i?.rect;if(!r)return null;r.width=i.width,r.height=i.height;const n=i.width,a=i.height;return{tl:[r.x+2,r.y+2],br:[r.x+2+n,r.y+2+a],page:i.page}}bind(e,t,i=0,r=0){if(i>=this._size.length||i>=this._mosaicsData.length)return;if(!this._textures[i]){const t=new a.TextureDescriptor(this._size[i][0],this._size[i][1]);t.wrapMode=33071,this._textures[i]=new n.Texture(e,t,new Uint8Array(this._mosaicsData[i].buffer))}const s=this._textures[i];s.setSamplingMode(t),this._dirties[i]&&s.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(s,r),this._dirties[i]=!1}static _copyBits(e,t,i,r,n,a,s,o,l,u,c){let h=r*t+i,p=o*a+s;if(c){p-=a;for(let s=-1;s<=u;s++,h=((s+u)%u+r)*t+i,p+=a)for(let t=-1;t<=l;t++)n[p+t]=e[h+(t+l)%l]}else for(let i=0;i<u;i++){for(let t=0;t<l;t++)n[p+t]=e[h+t];h+=t,p+=a}}_copy(e,t,i,r,n,a){if(!this._sprites||"loaded"!==this._sprites.loadStatus||i>=this._mosaicsData.length)return;const o=new Uint32Array(a?a.buffer:this._sprites.image.buffer),l=this._mosaicsData[i],u=a?t.width:this._sprites.width;s._copyBits(o,u,t.x,t.y,l,r[0],e.x+2,e.y+2,t.width,t.height,n),this._dirties[i]=!0}_allocateImage(e,t){e+=2,t+=2;const n=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<n){const i=new r(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}let a=e%4?4-e%4:4,s=t%4?4-t%4:4;1===a&&(a=5),1===s&&(s=5);const o=this._binPack.allocate(e+a,t+s);return o.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new i(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[o,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(e){const i=e.match(/\[(.*?)\]/);if(!i)return null;const r=i[1].split(",").map(Number),n=e.slice(e.lastIndexOf("-")+1),[a,s,o]=t.rasterizeDash(r,n);return[{x:0,y:0,width:s,height:o,sdf:!0,pixelRatio:1},new Uint8Array(a.buffer)]}}return s})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports","../../core/floatRGBA","../../core/Logger","../../core/mathUtils","./constants","./defaultCIMValues","../../views/2d/engine/webgl/definitions"],function(e,t,i,r,n,a,s){"use strict";const o=()=>i.getLogger("esri.symbols.cim.rasterizingUtils");let l;function u(e){const t=[];switch(e.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{"CIMPolarContinuousColorRamp"===e.type&&o().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const i=e;t.push({offset:0,color:[i.fromColor[0],i.fromColor[1],i.fromColor[2],i.fromColor[3]/255]}),t.push({offset:1,color:[i.toColor[0],i.toColor[1],i.toColor[2],i.toColor[3]/255]});break}case"CIMFixedColorRamp":{const i=e,r=1/(i.colors.length-1);let n=0;for(const e of i.colors)t.push({offset:n,color:[e[0],e[1],e[2],e[3]/255]}),n+=r;break}case"CIMMultipartColorRamp":{const i=e,r=i.weights.reduce((e,t)=>e+t,0);let n=0;for(let e=0;e<i.colorRamps.length;e++){const a=i.colorRamps[e],s=i.weights[e],o=u(a);for(const e of o)t.push({offset:(n+e.offset*s)/r,color:e.color});n+=s}break}default:o().error(`Color ramp "${e.type}" currently unsupported.`)}return t}function c(e,t){const i=[],r=(e.length-1)/(t-1);for(let n=0;n<t;n++){const a=e[Math.round(n*r)].color;i.push({offset:n/t,color:a}),i.push({offset:(n+1)/t,color:a})}return i}function h(e,t,i=0){for(const{offset:r,color:n}of t)e.addColorStop(Math.min(Math.max(r,i),1-i),`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`)}function p(e,t,i,r,n){const a=i+2*n;e.width=a,e.height=r;const s=(n+1)/a,o=e.getContext("2d",{willReadFrequently:!0});if(t.length>0){const e=o.createLinearGradient(0,0,a,r);h(e,t,s),o.fillStyle=e}else o.fillStyle="rgba(128, 128, 128, 1)";o.fillRect(0,0,a,r)}function f(e){const{width:t,height:i}=e,r=e.getContext("2d").getImageData(0,0,t,i),n=new Uint8Array(r.data);for(let e=0;e<n.length;e+=4){const t=n[e+3]/255;n[e]*=t,n[e+1]*=t,n[e+2]*=t}return[n,t,i]}e.addColorStops=function(e,t){const{colorRamp:i,gradientType:r}=t,n=u(i),s="CIMFixedColorRamp"===i.type;if("Continuous"===r&&!s)return h(e,n);const o=t.interval??a.defaultCIMValues.CIMGradientFill.interval;if(s)return h(e,c(n,o));const f=[];l??=document.createElement("canvas"),p(l,n,o,1,0);const d=l.getContext("2d").getImageData(0,0,o,1).data;for(let e=0,t=0;e<o;e++,t=4*e){const i=[d[t+0],d[t+1],d[t+2],d[t+3]];f.push({offset:e/o,color:i}),f.push({offset:(e+1)/o,color:i})}return h(e,f)},e.rasterizeDash=function(e,i){null==e&&(e=[]);const r="Butt"===i,a="Square"===i,s=!r&&!a;e.length%2==1&&(e=[...e,...e]);const o=n.dashRadius,l=2*o;let u=0;for(const t of e)u+=t;const c=Math.round(u*o),h=new Float32Array(c*l),p=.5*o;let f=0,d=0,y=.5,m=!0;for(const t of e){for(f=d,d+=t*o;y<=d;){let e=.5;for(;e<l;){const t=(e-.5)*c+y-.5,i=s?(e-o)*(e-o):Math.abs(e-o);h[t]=m?r?Math.max(Math.max(f+p-y,i),Math.max(y-d+p,i)):i:s?Math.min((y-f)*(y-f)+i,(y-d)*(y-d)+i):a?Math.min(Math.max(y-f,i),Math.max(d-y,i)):Math.min(Math.max(y-f+p,i),Math.max(d+p-y,i)),e++}y++}m=!m}const g=h.length,_=new Uint8Array(4*g);for(let e=0;e<g;++e){const i=(s?Math.sqrt(h[e]):h[e])/o;t.packFloatRGBA(i,_,4*e)}return[_,c,l]},e.rasterizeDash1D=function(e){e.length%2==1&&(e=[...e,...e]);const i=e.reduce((e,t)=>e+t,0),r=Math.round(i*n.dashSdfRasterizationScale),a=new Float32Array(1*r);let s=0,o=0,l=.5,u=!0;for(const t of e){for(s=o,o+=t*n.dashSdfRasterizationScale;l<=o;){const e=l-.5,t=Math.min(Math.abs(l-s),Math.abs(l-o));a[e]=u?-t:t,l++}u=!u}const c=a.length,h=new Uint8Array(4*c);for(let e=0;e<c;++e){const i=a[e]/n.dashSdfRasterizationScale/n.dashSdfDistanceNormalization*.5+.5;t.packFloatRGBA(i,h,4*e)}return[h,r,1]},e.rasterizeFillStyle=function(e,t,i){const n=t.style,a=r.nextPowerOfTwo(Math.ceil(i)),s=(e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e)(n)?8*a:16*a,o=2*a;e.width=s,e.height=s;const l=e.getContext("2d");l.strokeStyle="#ffffff",l.lineWidth=a,l.beginPath(),"vertical"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSVertical"!==n||(l.moveTo(s/2,-o),l.lineTo(s/2,s+o)),"horizontal"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSHorizontal"!==n||(l.moveTo(-o,s/2),l.lineTo(s+o,s/2)),"backward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSDiagonalCross"!==n&&"esriSFSBackwardDiagonal"!==n||(l.moveTo(-o,-o),l.lineTo(s+o,s+o),l.moveTo(s-o,-o),l.lineTo(s+o,o),l.moveTo(-o,s-o),l.lineTo(o,s+o)),"forward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSForwardDiagonal"!==n&&"esriSFSDiagonalCross"!==n||(l.moveTo(s+o,-o),l.lineTo(-o,s+o),l.moveTo(o,-o),l.lineTo(-o,o),l.moveTo(s+o,s-o),l.lineTo(s-o,s+o)),l.stroke();const u=l.getImageData(0,0,e.width,e.height),c=new Uint8Array(u.data);let h;for(let e=0;e<c.length;e+=4)h=c[e+3]/255,c[e]=c[e]*h,c[e+1]=c[e+1]*h,c[e+2]=c[e+2]*h;return[c,e.width,e.height,a]},e.rasterizeGradient=function(e,t){const{colorRamp:i,gradientType:r}=t,n="CIMFixedColorRamp"===i.type,o=t.interval||a.defaultCIMValues.CIMGradientFill.interval;let l=u(i);return n&&(l=c(l,o)),"Discrete"===r||n?function(e,t,i){return p(e,t,i,1,s.gradientTextureExternalPadding),f(e)}(e,l,o):function(e,t){return p(e,t,32,1,s.gradientTextureExternalPadding),f(e)}(e,l)},e.scale=function(e,t){const i=function(e){const t=e[0]?.[0]?.[0]??0,i=e[0]?.[0]?.[1]??0,r={ymin:i,xmin:t,ymax:i,xmax:t,width:0,height:0};for(let t=0;t<e.length;t++){const i=e[t];for(let e=0;e<i.length;e++){const t=i[e][0],n=i[e][1];t<r.xmin&&(r.xmin=t),t>r.xmax&&(r.xmax=t),n<r.ymin&&(r.ymin=n),n>r.ymax&&(r.ymax=n)}}return r.width=Math.abs(r.xmax-r.xmin),r.height=Math.abs(r.ymax-r.ymin),r}(e),r=0===i.width?1:i.width,n=0===i.height?1:i.height,a=[];for(let s=0;s<e.length;s++){const o=e[s],l=[];for(let e=0;e<o.length;e++){let a=Math.round(o[e][0]-i.xmin),s=Math.round(o[e][1]-i.ymin);if(a=t.xmin+a*t.width/r,s=t.ymin+s*t.height/n,isNaN(a)||isNaN(s))throw new Error("Scaled shape has NaN values");l.push([a,s])}a.push(l)}return a},e.translate=function(e,t,i){const r=[];for(let n=0;n<e.length;n++){const a=e[n],s=[];for(let e=0;e<a.length;e++){const r=a[e][0]+t,n=a[e][1]+i;if(isNaN(r)||isNaN(n))throw new Error("Scaled shape has NaN values");s.push([r,n])}r.push(s)}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports","./defaultCIMValues"],function(e,t){"use strict";const i={outlineWidth:.75,referenceWidth:.75,cap:t.defaultCIMValues.CIMSolidStroke.capstyle,join:t.defaultCIMValues.CIMSolidStroke.joinstyle,miterLimit:t.defaultCIMValues.CIMSolidStroke.miterlimit};e.antialiasingOutlineFillSettings=i,e.dashRadius=15.5,e.dashSdfDistanceNormalization=64,e.dashSdfRasterizationScale=4,e.maxTileCoordValue=1024,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(e,t,i){"use strict";return class extends t{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(e){const t=i.pool.acquire(e),r=0===t.level?null:i.getId(t.level-1,t.row>>1,t.col>>1,t.world);return i.pool.release(t),r}getTileCoverage(e,t,i=!0,r){const n=super.getTileCoverage(e,t,i,r);if(!n)return n;const a=1<<n.lodInfo.level;return n.spans=n.spans.filter(e=>e.row>=0&&e.row<a),n}scaleToLevel(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];{const t=this._fullCacheLodInfos;if(e>t[0].scale)return t[0].level;let i,r;for(let n=0;n<t.length-1;n++)if(r=t[n+1],e>r.scale)return i=t[n],i.level+(i.scale-e)/(i.scale-r.scale);return t[t.length-1].level}}_initializeFullCacheLODs(t){let i;if(0===t[0].level)i=t.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale}));else{const t=this.tileInfo.size[0],r=this.tileInfo.spatialReference;i=e.create({size:t,spatialReference:r}).lods.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale}))}for(let e=0;e<i.length;e++)this._levelByScale[i[e].scale]=i[e].level;this._fullCacheLodInfos=i}}})},"esri/views/2d/engine/vectorTiles/VTLPainter3D":function(){define(["../../../../core/maybe","../vtlBrushes","./shaders/VTLMaterialManager"],function(e,t,i){"use strict";const r=1e-6,n=[null];return class{constructor(e,t){this.spriteMosaic=e,this.glyphMosaic=t,this._brushCache={vtlBackground:null,vtlFill:null,vtlLine:null,vtlCircle:null,vtlSymbol:null},this._vtlMaterialManager=new i}dispose(){this._brushCache.vtlBackground?.dispose(),this._brushCache.vtlFill?.dispose(),this._brushCache.vtlLine?.dispose(),this._brushCache.vtlCircle?.dispose(),this._brushCache.vtlSymbol?.dispose(),this._brushCache=null,this._vtlMaterialManager=e.disposeMaybe(this._vtlMaterialManager),this.spriteMosaic.dispose(),this.glyphMosaic.dispose()}get vectorTilesMaterialManager(){return this._vtlMaterialManager}drawSymbols(e,i,a){const s=a.layers;e.renderPass="translucent";let o=this._brushCache.vtlSymbol;null==o&&(o=new t.vtlBrushes.vtlSymbol,this._brushCache.vtlSymbol=o),n[0]=i;for(let t=0;t<s.length;t++){const i=s[t];if(3!==i.type)continue;const a=i.getLayoutProperty("visibility");if(a&&1===a.getValue())continue;const l=e.displayLevel;void 0!==i.minzoom&&i.minzoom>l+r||void 0!==i.maxzoom&&i.maxzoom<=l-r||(e.styleLayerUID=i.uid,e.styleLayer=i,o.drawMany(e,n))}n[0]=null}drawBackground(e,i,a){if(0===a.backgroundBucketIds.length)return;const{context:s,displayLevel:o,requiredLevel:l}=e;i.key.level=l,s.setBlendingEnabled(!0),s.setDepthTestEnabled(!1),s.setStencilTestEnabled(!1),e.renderPass="background";let u=this._brushCache.vtlBackground;null==u&&(u=new t.vtlBrushes.vtlBackground,this._brushCache.vtlBackground=u),n[0]=i,a.backgroundBucketIds.forEach(t=>{const i=a.getLayerById(t);if(0!==i.type)return;const s=i.getLayoutProperty("visibility");s&&1===s.getValue()||void 0!==i.minzoom&&i.minzoom>o+r||void 0!==i.maxzoom&&i.maxzoom<=o-r||(e.styleLayerUID=i.uid,e.styleLayer=i,u.drawMany(e,n))}),n[0]=null}drawTile(e,t,i,r){const{context:n}=e,a=i.layers;n.setBlendingEnabled(!1),n.setDepthTestEnabled(!0),n.setDepthWriteEnabled(!0),n.setDepthFunction(515);const s=a.filter(e=>{if(null!=r&&r!==e.type||!t.layerData.has(e.uid))return!1;const i=e.getLayoutProperty("visibility");return 1!==i?.getValue()});e.renderPass="opaque";for(let i=s.length-1;i>=0;--i)this._renderStyleLayer(s[i],e,t);n.setDepthWriteEnabled(!1),n.setBlendingEnabled(!0),n.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent",s.forEach(i=>this._renderStyleLayer(i,e,t)),n.setDepthTestEnabled(!1),n.bindVAO(null)}_renderStyleLayer(e,i,a){const{renderPass:s}=i;let o;switch(e.type){case 0:if("background"!==s)return;o=this._brushCache.vtlBackground,o||(o=new t.vtlBrushes.vtlBackground,this._brushCache.vtlBackground=o);break;case 1:if("opaque"!==s&&"translucent"!==i.renderPass)return;o=this._brushCache.vtlFill,null==o&&(o=new t.vtlBrushes.vtlFill,this._brushCache.vtlFill=o);break;case 2:if("translucent"!==s)return;o=this._brushCache.vtlLine,null==o&&(o=new t.vtlBrushes.vtlLine,this._brushCache.vtlLine=o);break;case 4:if("translucent"!==s)return;o=this._brushCache.vtlCircle,null==o&&(o=new t.vtlBrushes.vtlCircle,this._brushCache.vtlCircle=o);break;case 3:if("translucent"!==s)return;o=this._brushCache.vtlSymbol,null==o&&(o=new t.vtlBrushes.vtlSymbol,this._brushCache.vtlSymbol=o)}const{displayLevel:l}=i,{minzoom:u,maxzoom:c}=e;if(void 0!==u&&u>l+r||void 0!==c&&c<=l-r)return;const{context:h}=i;h.setStencilTestEnabled(!1),h.setStencilWriteMask(0),i.styleLayerUID=e.uid,i.styleLayer=e,n[0]=a,o.drawMany(i,n),n[0]=null}}})},"esri/views/2d/engine/vtlBrushes":function(){define(["exports","./webgl/brushes/WGLBrushVTLBackground","./webgl/brushes/WGLBrushVTLCircle","./webgl/brushes/WGLBrushVTLFill","./webgl/brushes/WGLBrushVTLLine","./webgl/brushes/WGLBrushVTLSymbol"],function(e,t,i,r,n,a){"use strict";const s={vtlBackground:t.WGLBrushVTLBackground,vtlFill:r.WGLBrushVTLFill,vtlLine:n.WGLBrushVTLLine,vtlCircle:i.WGLBrushVTLCircle,vtlSymbol:a.WGLBrushVTLSymbol};e.vtlBrushes=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define(["exports","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../../core/libs/gl-matrix-2/factories/vec4f32","../definitions","./WGLBrush","../../../../webgl/enums","../../../../webgl/VertexArrayObject","../../../../webgl/VertexBuffer"],function(e,t,i,r,n,a,s,o,l,u){"use strict";e.WGLBrushVTLBackground=class extends s{constructor(){super(...arguments),this._color=n.fromValues(1,0,0,1),this._patternMatrix=r.create(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao=i.disposeMaybe(this._vao)}drawMany(e,i){const{context:r,painter:n,requestRender:s,allowDelayedRender:l}=e;this._loadWGLResources(e);const u=e.displayLevel,c=e.styleLayer,h=c.backgroundMaterial,p=n.vectorTilesMaterialManager,f=c.getPaintValue("background-color",u),d=c.getPaintValue("background-opacity",u),y=c.getPaintValue("background-pattern",u),m=void 0!==y,g=1|window.devicePixelRatio,_=e.spriteMosaic;let v,b;const T=g>a.vtlHighResCutoff?2:1,w=this._programOptions;w.pattern=m;const x=p.getMaterialProgram(r,h,w);if(!l||null==s||x.compiled){if(r.bindVAO(this._vao),r.useProgram(x),m){const e=_.getMosaicItemPosition(y,!0);if(null!=e){const{tl:t,br:i,page:n}=e;v=i[0]-t[0],b=i[1]-t[1];const s=_.getPageSize(n);null!=s&&(_.bind(r,9729,n,a.vtlTextureBindingUnitSprites),x.setUniform4f("u_tlbr",t[0],t[1],i[0],i[1]),x.setUniform2fv("u_mosaicSize",s),x.setUniform1i("u_texture",a.vtlTextureBindingUnitSprites))}x.setUniform1f("u_opacity",d)}else{const e=f[3]*d;this._color[0]=e*f[0],this._color[1]=e*f[1],this._color[2]=e*f[2],this._color[3]=e,x.setUniform4fv("u_color",this._color)}x.setUniform1f("u_depth",c.z||0);for(const e of i){if(x.setUniform1f("u_coord_range",e.rangeX),x.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),m){const i=Math.max(2**(Math.round(u)-e.key.level),1),r=T*e.width*i,n=r/t.nextPowerOfTwo(v),a=r/t.nextPowerOfTwo(b);this._patternMatrix[0]=n,this._patternMatrix[4]=a,x.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}r.setStencilFunction(514,0,255),r.drawArrays(o.PrimitiveType.TRIANGLE_STRIP,0,4)}}else s()}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:i}=e,r=i.backgroundMaterial,n=new Int8Array([0,0,1,0,0,1,1,1]),a=new u.VertexBuffer(t,r.geometryLayout,n);this._vao=new l.VertexArrayObject(t,a)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(function(){"use strict";return class{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,i){}drawMany(e,t,i){for(const r of t)r.visible&&this.draw(e,r,i)}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define(["exports","./WGLBrush","../../../../webgl/enums"],function(e,t,i){"use strict";e.WGLBrushVTLCircle=class extends t{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:r,displayLevel:n,requiredLevel:a,state:s,painter:o,spriteMosaic:l,styleLayerUID:u,requestRender:c,allowDelayedRender:h}=e;if(!t.some(e=>e.layerData.get(u)?.circleIndexCount??!1))return;const p=e.styleLayer,f=p.circleMaterial,d=o.vectorTilesMaterialManager,y=p.getPaintValue("circle-translate",n),m=p.getPaintValue("circle-translate-anchor",n),g=this._programOptions,_=d.getMaterialProgram(r,f,g);if(h&&null!=c&&!_.compiled)return void c();r.useProgram(_),_.setUniformMatrix3fv("u_displayMat3",1===m?s.displayMat3:s.displayViewMat3),_.setUniform2fv("u_circleTranslation",y),_.setUniform1f("u_depth",p.z),_.setUniform1f("u_antialiasingWidth",1.2);let v=-1;for(const e of t){if(!e.layerData.has(u))continue;e.key.level!==v&&(v=e.key.level,f.setDataUniforms(_,n,p,v,l));const t=e.layerData.get(u);if(!t.circleIndexCount)continue;t.prepareForRendering(r);const s=t.vao;null!=s&&(r.bindVAO(s),_.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),a!==e.key.level?r.setStencilFunction(514,e.stencilRef,255):r.setStencilFunction(516,255,255),r.drawElements(i.PrimitiveType.TRIANGLES,t.circleIndexCount,i.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.circleIndexStart),e.triangleCount+=t.circleIndexCount/3)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define(["exports","../definitions","./WGLBrush","../../../../webgl/enums"],function(e,t,i,r){"use strict";const n=1/65536;e.WGLBrushVTLFill=class extends i{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:i,renderPass:r,spriteMosaic:n,styleLayerUID:a}=e;let s=!1;for(const e of t)if(e.layerData.has(a)){const t=e.layerData.get(a);if(t.fillIndexCount>0||t.outlineIndexCount>0){s=!0;break}}if(!s)return;const o=e.styleLayer,l=o.getPaintProperty("fill-pattern"),u=void 0!==l,c=u&&l.isDataDriven;let h;if(u&&!c){const e=l.getValue(i);h=n.getMosaicItemPosition(e,!0)}const p=!u&&o.getPaintValue("fill-antialias",i);let f=!0,d=1;if(!u){const e=o.getPaintProperty("fill-color"),t=o.getPaintProperty("fill-opacity");if(!e?.isDataDriven&&!t?.isDataDriven){const e=o.getPaintValue("fill-color",i);d=o.getPaintValue("fill-opacity",i)*e[3],d>=1&&(f=!1)}}if(f&&"opaque"===r)return;const y=o.getPaintValue("fill-translate",i),m=o.getPaintValue("fill-translate-anchor",i);(f||"translucent"!==r)&&this._drawFill(e,a,o,t,y,m,u,h,c);const g=!o.hasDataDrivenOutlineColor&&o.outlineUsesFillColor&&d<1;p&&"opaque"!==r&&!g&&this._drawOutline(e,a,o,t,y,m)}_drawFill(e,i,a,s,o,l,u,c,h){if(u&&!h&&null==c)return;const{context:p,displayLevel:f,state:d,painter:y,pixelRatio:m,spriteMosaic:g,requestRender:_,allowDelayedRender:v}=e,b=a.fillMaterial,T=y.vectorTilesMaterialManager,w=m>t.vtlHighResCutoff?2:1,x=this._fillProgramOptions;x.pattern=u;const S=T.getMaterialProgram(p,b,x);if(v&&null!=_&&!S.compiled)return void _();if(p.useProgram(S),null!=c){const{page:e}=c,i=g.getPageSize(e);null!=i&&(g.bind(p,9729,e,t.vtlTextureBindingUnitSprites),S.setUniform2fv("u_mosaicSize",i),S.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites))}S.setUniformMatrix3fv("u_displayMat3",1===l?d.displayMat3:d.displayViewMat3),S.setUniform2fv("u_fillTranslation",o),S.setUniform1f("u_depth",a.z+n);let P=-1;for(const e of s){if(!e.layerData.has(i))continue;e.key.level!==P&&(P=e.key.level,b.setDataUniforms(S,f,a,P,g));const n=e.layerData.get(i);if(!n.fillIndexCount)continue;n.prepareForRendering(p);const s=n.fillVAO;if(null!=s){if(p.bindVAO(s),S.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),p.setStencilFunction(514,e.stencilRef,255),u){const t=Math.max(2**(Math.round(f)-e.key.level),1),i=e.rangeX/(w*e.width*t);S.setUniform1f("u_patternFactor",i)}if(h){const e=n.patternMap;if(!e)continue;for(const[i,n]of e){const e=g.getPageSize(i);null!=e&&(g.bind(p,9729,i,t.vtlTextureBindingUnitSprites),S.setUniform2fv("u_mosaicSize",e),S.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites),p.drawElements(r.PrimitiveType.TRIANGLES,n[1],r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else p.drawElements(r.PrimitiveType.TRIANGLES,n.fillIndexCount,r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.fillIndexStart);e.triangleCount+=n.fillIndexCount/3}}}_drawOutline(e,t,i,a,s,o){const{context:l,displayLevel:u,state:c,painter:h,pixelRatio:p,spriteMosaic:f,requestRender:d,allowDelayedRender:y}=e,m=i.outlineMaterial,g=h.vectorTilesMaterialManager,_=.75/p,v=this._outlineProgramOptions,b=g.getMaterialProgram(l,m,v);if(y&&null!=d&&!b.compiled)return void d();l.useProgram(b),b.setUniformMatrix3fv("u_displayMat3",1===o?c.displayMat3:c.displayViewMat3),b.setUniform2fv("u_fillTranslation",s),b.setUniform1f("u_depth",i.z+n),b.setUniform1f("u_outline_width",_);let T=-1;for(const e of a){if(!e.layerData.has(t))continue;e.key.level!==T&&(T=e.key.level,m.setDataUniforms(b,u,i,T,f));const n=e.layerData.get(t);if(n.prepareForRendering(l),!n.outlineIndexCount)continue;const a=n.outlineVAO;null!=a&&(l.bindVAO(a),b.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),l.setStencilFunction(514,e.stencilRef,255),l.drawElements(r.PrimitiveType.TRIANGLES,n.outlineIndexCount,r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.outlineIndexStart),e.triangleCount+=n.outlineIndexCount/3)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define(["exports","../definitions","./WGLBrush","../../../../webgl/enums"],function(e,t,i,r){"use strict";e.WGLBrushVTLLine=class extends i{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,i){const{context:n,displayLevel:a,state:s,painter:o,pixelRatio:l,spriteMosaic:u,styleLayerUID:c,requestRender:h,allowDelayedRender:p}=e;if(!i.some(e=>e.layerData.get(c)?.lineIndexCount??!1))return;const f=e.styleLayer,d=f.lineMaterial,y=o.vectorTilesMaterialManager,m=f.getPaintValue("line-translate",a),g=f.getPaintValue("line-translate-anchor",a),_=f.getPaintProperty("line-pattern"),v=void 0!==_,b=v&&_.isDataDriven;let T,w;if(v&&!b){const e=_.getValue(a);T=u.getMosaicItemPosition(e)}let x=!1;if(!v){const e=f.getPaintProperty("line-dasharray");if(w=void 0!==e,x=w&&e.isDataDriven,w&&!x){const t=e.getValue(a),i=f.getDashKey(t,f.getLayoutValue("line-cap",a));T=u.getMosaicItemPosition(i)}}const S=1/l,P=this._programOptions;P.pattern=v,P.sdf=w;const D=y.getMaterialProgram(n,d,P);if(p&&null!=h&&!D.compiled)return void h();if(n.useProgram(D),D.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),D.setUniformMatrix3fv("u_displayMat3",1===g?s.displayMat3:s.displayViewMat3),D.setUniform2fv("u_lineTranslation",m),D.setUniform1f("u_depth",f.z),D.setUniform1f("u_antialiasing",S),T&&null!=T){const{page:e}=T,i=u.getPageSize(e);null!=i&&(u.bind(n,9729,e,t.vtlTextureBindingUnitSprites),D.setUniform2fv("u_mosaicSize",i),D.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites))}let L=-1;for(const e of i){if(!e.layerData.has(c))continue;e.key.level!==L&&(L=e.key.level,d.setDataUniforms(D,a,f,L,u));const i=2**(a-L)/l;D.setUniform1f("u_zoomFactor",i);const s=e.layerData.get(c);if(!s.lineIndexCount)continue;s.prepareForRendering(n);const o=s.vao;if(null!=o){if(n.bindVAO(o),D.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),n.setStencilFunction(514,e.stencilRef,255),b||x){const e=s.patternMap;if(!e)continue;for(const[i,a]of e){const e=u.getPageSize(i);null!=e&&(u.bind(n,9729,i,t.vtlTextureBindingUnitSprites),D.setUniform2fv("u_mosaicSize",e),D.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites),n.drawElements(r.PrimitiveType.TRIANGLES,a[1],r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*a[0]))}}else n.drawElements(r.PrimitiveType.TRIANGLES,s.lineIndexCount,r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*s.lineIndexStart);e.triangleCount+=s.lineIndexCount/3}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec2f32","../../vectorTiles/decluttering/config","../definitions","../GeometryUtils","./WGLBrush","../../../../webgl/enums"],function(e,t,i,r,n,a,s){"use strict";const o=1/65536;e.WGLBrushVTLSymbol=class extends a{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=t.create()}dispose(){}drawMany(e,t){const i=e.styleLayer;this._drawIcons(e,i,t),this._drawText(e,i,t)}_drawIcons(e,t,a){const{context:s,displayLevel:o,painter:l,spriteMosaic:u,state:c,styleLayerUID:h,requestRender:p,allowDelayedRender:f}=e,d=t.iconMaterial,y=l.vectorTilesMaterialManager;let m,g=!1;for(const e of a)if(e.layerData.has(h)&&(m=e.layerData.get(h),m.iconPerPageElementsMap.size>0)){g=!0;break}if(!g)return;const _=t.getPaintValue("icon-translate",o),v=t.getPaintValue("icon-translate-anchor",o);let b=t.getLayoutValue("icon-rotation-alignment",o);2===b&&(b=0===t.getLayoutValue("symbol-placement",o)?1:0);const T=0===b,w=t.getLayoutValue("icon-keep-upright",o)&&T,x=m.isIconSDF,S=this._iconProgramOptions;S.sdf=x;const P=y.getMaterialProgram(s,d,S);if(f&&null!=p&&!P.compiled)return void p();s.useProgram(P),P.setUniformMatrix3fv("u_displayViewMat3",0===b?c.displayViewMat3:c.displayMat3),P.setUniformMatrix3fv("u_displayMat3",1===v?c.displayMat3:c.displayViewMat3),P.setUniform2fv("u_iconTranslation",_),P.setUniform1f("u_depth",t.z),P.setUniform1f("u_mapRotation",n.degToByte(c.rotation)),P.setUniform1f("u_keepUpright",w?1:0),P.setUniform1f("u_level",10*o),P.setUniform1i("u_texture",r.vtlTextureBindingUnitSprites),P.setUniform1f("u_fadeDuration",i.fadeDuration/1e3);let D=-1;for(const i of a){if(!i.layerData.has(h))continue;if(i.key.level!==D&&(D=i.key.level,d.setDataUniforms(P,o,t,D,u)),m=i.layerData.get(h),0===m.iconPerPageElementsMap.size)continue;m.prepareForRendering(s),m.updateOpacityInfo();const r=m.iconVAO;if(null!=r){s.bindVAO(r),P.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),P.setUniform1f("u_time",(performance.now()-m.lastOpacityUpdate)/1e3);for(const[t,r]of m.iconPerPageElementsMap)this._renderIconRange(e,P,r,t,i)}}}_renderIconRange(e,t,i,n,a){const{context:o,spriteMosaic:l}=e;this._spritesTextureSize[0]=l.getWidth(n)/4,this._spritesTextureSize[1]=l.getHeight(n)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),l.bind(o,9729,n,r.vtlTextureBindingUnitSprites),this._setStencilState(e,a),o.drawElements(s.PrimitiveType.TRIANGLES,i[1],s.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),a.triangleCount+=i[1]/3}_drawText(e,a,s){const{context:l,displayLevel:u,glyphMosaic:c,painter:h,pixelRatio:p,spriteMosaic:f,state:d,styleLayerUID:y,requestRender:m,allowDelayedRender:g}=e,_=a.textMaterial,v=h.vectorTilesMaterialManager;let b,T=!1;for(const e of s)if(e.layerData.has(y)&&(b=e.layerData.get(y),b.glyphPerPageElementsMap.size>0)){T=!0;break}if(!T)return;const w=a.getPaintProperty("text-opacity");if(w&&!w.isDataDriven&&0===w.getValue(u))return;const x=a.getPaintProperty("text-color"),S=!x||x.isDataDriven||x.getValue(u)[3]>0,P=a.getPaintProperty("text-halo-width"),D=a.getPaintProperty("text-halo-color"),L=(!P||P.isDataDriven||P.getValue(u)>0)&&(!D||D.isDataDriven||D.getValue(u)[3]>0);if(!S&&!L)return;let M=a.getLayoutValue("text-rotation-alignment",u);2===M&&(M=0===a.getLayoutValue("symbol-placement",u)?1:0);const I=0===M,E=a.getLayoutValue("text-keep-upright",u)&&I,R=.8*3/p;this._glyphTextureSize||(this._glyphTextureSize=t.fromValues(c.width/4,c.height/4));const V=a.getPaintValue("text-translate",u),U=a.getPaintValue("text-translate-anchor",u),C=this._sdfProgramOptions,k=v.getMaterialProgram(l,_,C);if(g&&null!=m&&!k.compiled)return void m();l.useProgram(k),k.setUniformMatrix3fv("u_displayViewMat3",0===M?d.displayViewMat3:d.displayMat3),k.setUniformMatrix3fv("u_displayMat3",1===U?d.displayMat3:d.displayViewMat3),k.setUniform2fv("u_textTranslation",V),k.setUniform1f("u_depth",a.z+o),k.setUniform2fv("u_mosaicSize",this._glyphTextureSize),k.setUniform1f("u_mapRotation",n.degToByte(d.rotation)),k.setUniform1f("u_keepUpright",E?1:0),k.setUniform1f("u_level",10*u),k.setUniform1i("u_texture",r.vtlTextureBindingUnitGlyphs),k.setUniform1f("u_antialiasingWidth",R),k.setUniform1f("u_fadeDuration",i.fadeDuration/1e3);let A=-1;for(const t of s){if(!t.layerData.has(y))continue;if(t.key.level!==A&&(A=t.key.level,_.setDataUniforms(k,u,a,A,f)),b=t.layerData.get(y),0===b.glyphPerPageElementsMap.size)continue;b.prepareForRendering(l),b.updateOpacityInfo();const i=b.textVAO;if(null==i)continue;l.bindVAO(i),k.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),this._setStencilState(e,t);const r=(performance.now()-b.lastOpacityUpdate)/1e3;k.setUniform1f("u_time",r),b.glyphPerPageElementsMap.forEach((e,i)=>{this._renderGlyphRange(l,e,i,c,k,L,S,t)})}}_renderGlyphRange(e,t,i,n,a,o,l,u){n.bind(e,9729,i,r.vtlTextureBindingUnitGlyphs),o&&(a.setUniform1f("u_halo",1),e.drawElements(s.PrimitiveType.TRIANGLES,t[1],s.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),u.triangleCount+=t[1]/3),l&&(a.setUniform1f("u_halo",0),e.drawElements(s.PrimitiveType.TRIANGLES,t[1],s.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),u.triangleCount+=t[1]/3)}_setStencilState(e,t){const{context:i,is3D:r,stencilSymbols:n}=e;if(i.setStencilTestEnabled(!0),n)return i.setStencilWriteMask(255),void i.setStencilFunction(519,t.stencilRef,255);i.setStencilWriteMask(0),r?i.setStencilFunction(514,t.stencilRef,255):i.setStencilFunction(516,255,255)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(e){"use strict";const t=128/Math.PI,i=256/360,r=1/Math.LN2;function n(e,t){return(e%=t)>=0?e:e+t}e.between=function(e,t,i){return e>=t&&e<=i||e>=i&&e<=t},e.degToByte=function(e){return n(e*i,256)},e.interpolate=function(e,t,i){return e*(1-i)+t*i},e.log2=function(e){return Math.log(e)*r},e.positiveMod=n,e.radToByte=function(e){return n(e*t,256)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["./Programs"],function(e){"use strict";return class{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(e=>e.dispose()),this._programByKey.clear()}getMaterialProgram(e,t,i){const r=t.key<<3|this._getMaterialOptionsValue(t.type,i);if(this._programByKey.has(r))return this._programByKey.get(r);const n=this._getProgramTemplate(t.type),{shaders:a}=n,{vertexShader:s,fragmentShader:o}=a(i),l=t.getShaderHeader(),u=t.getShaderMain(),c=s.replace("#pragma header",l).replace("#pragma main",u),h=e.programCache.acquire(c,o,t.getAttributeLocations());return this._programByKey.set(r,h),h}_getMaterialOptionsValue(e,t){switch(e){case 0:case 1:return(t.pattern?1:0)<<1;case 2:case 5:case 6:default:return 0;case 3:{const e=t;return(e.sdf?1:0)<<2|(e.pattern?1:0)<<1}case 4:return(t.sdf?1:0)<<1}}_getProgramTemplate(t){switch(t){case 0:return e.background;case 5:return e.circle;case 1:return e.fill;case 4:return e.icon;case 3:return e.line;case 2:return e.outline;case 6:return e.text;default:return null}}}})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(e,t,i){"use strict";const r=e=>i.glslifyDefineMap({PATTERN:e.pattern}),n={shaders:e=>({vertexShader:r(e)+t.resolveIncludes("background/background.vert"),fragmentShader:r(e)+t.resolveIncludes("background/background.frag")})},a={shaders:e=>({vertexShader:t.resolveIncludes("circle/circle.vert"),fragmentShader:t.resolveIncludes("circle/circle.frag")})},s=e=>i.glslifyDefineMap({PATTERN:e.pattern}),o={shaders:e=>({vertexShader:s(e)+t.resolveIncludes("fill/fill.vert"),fragmentShader:s(e)+t.resolveIncludes("fill/fill.frag")})},l={shaders:e=>({vertexShader:t.resolveIncludes("outline/outline.vert"),fragmentShader:t.resolveIncludes("outline/outline.frag")})},u=e=>i.glslifyDefineMap({SDF:e.sdf}),c={shaders:e=>({vertexShader:u(e)+t.resolveIncludes("icon/icon.vert"),fragmentShader:u(e)+t.resolveIncludes("icon/icon.frag")})},h=e=>i.glslifyDefineMap({PATTERN:e.pattern,SDF:e.sdf}),p={shaders:e=>({vertexShader:h(e)+t.resolveIncludes("line/line.vert"),fragmentShader:h(e)+t.resolveIncludes("line/line.frag")})},f={shaders:e=>({vertexShader:t.resolveIncludes("text/text.vert"),fragmentShader:t.resolveIncludes("text/text.frag")})};e.background=n,e.circle=a,e.fill=o,e.icon=c,e.line=p,e.outline=l,e.text=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(e,t,i){"use strict";const r=new i.ShaderCompiler(function(e){let i=t;return e.split("/").forEach(e=>{i&&(i=i[e])}),i});e.resolveIncludes=function(e){return r.resolveIncludes(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){"use strict";return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["exports"],function(e){"use strict";e.ShaderCompiler=class{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e,t=new Map){if(t.has(e))return t.get(e);const i=this._read(e);if(!i)throw new Error(`cannot find shader file ${e}`);const r=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let n=r.exec(i);const a=[];for(;null!=n;)a.push({path:n[1],start:n.index,length:n[0].length}),n=r.exec(i);let s=0,o="";return a.forEach(e=>{o+=i.slice(s,e.start),o+=t.has(e.path)?"":this._resolve(e.path,t),s=e.start+e.length}),o+=i.slice(s),t.set(e,o),o}_read(e){return this._readFile(e)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/programUtils":function(){define(["exports"],function(e){"use strict";function t(e){const{options:t,value:i}=e;return"number"==typeof t[i]}e.glslifyDefineMap=function(e){let i="";for(const r in e){const n=e[r];if("boolean"==typeof n)n&&(i+=`#define ${r}\n`);else if("number"==typeof n)i+=`#define ${r} ${n.toFixed()}\n`;else if("object"==typeof n)if(t(n)){const{value:e,options:t,namespace:a}=n,s=a?`${a}_`:"";for(const e in t)i+=`#define ${s}${e} ${t[e].toFixed()}\n`;i+=`#define ${r} ${s}${e}\n`}else{const e=n.options;let t=0;for(const r in e)i+=`#define ${e[r]} ${(t++).toFixed()}\n`;i+=`#define ${r} ${e[n.value]}\n`}}return i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["../../../../../core/lang","./StyleLayer"],function(e,t){"use strict";class i{constructor(t,i=!0){if(this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,this._style=i?e.clone(t):t,this._style.layers||(this._style.layers=[]),this.version=parseFloat(this._style.version),this.layers=this._style.layers.map((e,t,i)=>this._create(e,t,i)).filter(e=>!!e),this.layers)for(let e=0;e<this.layers.length;e++){const t=this.layers[e];this._layerByName[t.id]=t,this._uidToLayer.set(t.uid,t),0===t.type&&this.backgroundBucketIds.push(t.id)}this._identifyRefLayers()}getLayerStyleProperties(e,t){const i=this.getStyleLayerByUID(e),r=0!==i?.getLayoutValue("symbol-placement",t);let n=i?.getLayoutValue("icon-rotation-alignment",t);2===n&&(n=r?0:1);let a=i?.getLayoutValue("text-rotation-alignment",t);2===a&&(a=r?0:1);const s=i?.getPaintValue("icon-translate",t),o=i?.getPaintValue("icon-translate-anchor",t),l=i?.getPaintValue("text-translate",t),u=i?.getPaintValue("text-translate-anchor",t);return{geometryType:null,iconAllowOverlap:i?.getLayoutValue("icon-allow-overlap",t),iconIgnorePlacement:i?.getLayoutValue("icon-ignore-placement",t),textAllowOverlap:i?.getLayoutValue("text-allow-overlap",t),textIgnorePlacement:i?.getLayoutValue("text-ignore-placement",t),iconRotationAlignment:n,textRotationAlignment:a,iconTranslateAnchor:o,iconTranslate:s,textTranslateAnchor:u,textTranslate:l}}isPainterDataDriven(e){const t=this._layerByName[e];return!!t&&t.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){return this._uidToLayer.get(e)??null}getStyleLayerIndex(e){const t=this._layerByName[e];return t?this.layers.indexOf(t):-1}setStyleLayer(e,t){if(!e?.id)return;const r=this._style;null!=t&&t>=this.layers.length&&(t=this.layers.length-1);let n,a=!0;const s=this._layerByName[e.id];if(s){const o=this.layers.indexOf(s);t||(t=o),t===o?(a=!1,n=i._recreateLayer(e,s),this.layers[t]=n,r.layers[t]=e):(this.layers.splice(o,1),r.layers.splice(o,1),n=this._create(e,t,this.layers),this.layers.splice(t,0,n),r.layers.splice(t,0,e))}else n=this._create(e,t,this.layers),!t||t>=this.layers.length?(this.layers.push(n),r.layers.push(e)):(this.layers.splice(t,0,n),r.layers.splice(t,0,e));this._layerByName[e.id]=n,this._uidToLayer.set(n.uid,n),a&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(e){const t=this._layerByName[e];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null}deleteStyleLayer(e){const t=this._layerByName[e];if(t){delete this._layerByName[e],this._uidToLayer.delete(t.uid);const i=this.layers.indexOf(t);this.layers.splice(i,1),this._style.layers.splice(i,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e]}getLayoutProperties(e){const t=this._layerByName[e];return t?t.layout:null}getPaintProperties(e){const t=this._layerByName[e];return t?t.paint:null}setPaintProperties(e,t){const r=this._layerByName[e];if(!r)return;const n={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:r.layout,paint:t},a=i._recreateLayer(n,r),s=this.layers.indexOf(r);this.layers[s]=a,this._style.layers[s].paint=t,this._layerByName[r.id]=a,this._uidToLayer.set(r.uid,a)}setLayoutProperties(e,t){const r=this._layerByName[e];if(!r)return;const n={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:t,paint:r.paint},a=i._recreateLayer(n,r),s=this.layers.indexOf(r);this.layers[s]=a,this._style.layers[s].layout=t,this._layerByName[r.id]=a,this._uidToLayer.set(r.uid,a)}setStyleLayerVisibility(e,t){const r=this._layerByName[e];if(!r)return;const n=r.layout||{};n.visibility=t;const a={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:n,paint:r.paint},s=i._recreateLayer(a,r),o=this.layers.indexOf(r);this.layers[o]=s,this._style.layers[o].layout=n,this._layerByName[r.id]=s,this._uidToLayer.set(r.uid,s)}getStyleLayerVisibility(e){const t=this._layerByName[e];if(!t)return"none";const i=t.layout;return i?.visibility??"visible"}_recomputeZValues(){const e=this.layers,t=1/(e.length+1);for(let i=0;i<e.length;i++)e[i].z=1-(1+i)*t}_identifyRefLayers(){const e=[],t=[];let i=0;for(const r of this.layers){const n=r.layout;if(1===r.type){const t=r;let a=r.source+"|"+r.sourceLayer;a+="|"+(n?.visibility??""),a+="|"+r.minzoom,a+="|"+r.maxzoom,a+="|"+JSON.stringify(r.filter),(t.hasDataDrivenFill||t.hasDataDrivenOutline)&&(a+="|"+i),e.push({key:a,layer:r})}else if(2===r.type){const e=r,a=r.paint,s=null!=a&&(null!=a["line-pattern"]||null!=a["line-dasharray"]);let o=r.source+"|"+r.sourceLayer;o+="|"+(n?.visibility??""),o+="|"+r.minzoom,o+="|"+r.maxzoom,o+="|"+JSON.stringify(r.filter),o+="|"+(void 0!==n?n["line-cap"]:""),o+="|"+(void 0!==n?n["line-join"]:""),(e.hasDataDrivenLine||s)&&(o+="|"+i),t.push({key:o,layer:r})}++i}this._assignRefLayers(e),this._assignRefLayers(t)}_assignRefLayers(e){let t,i;e.sort((e,t)=>e.key<t.key?-1:e.key>t.key?1:0);const r=e.length;for(let n=0;n<r;n++){const a=e[n];if(a.key===t)a.layer.refLayerId=i;else if(t=a.key,i=a.layer.id,1===a.layer.type){if(!a.layer.getPaintProperty("fill-outline-color"))for(let s=n+1;s<r;s++){const r=e[s];if(r.key!==t)break;if(r.layer.getPaintProperty("fill-outline-color")){e[n]=r,e[s]=a,i=r.layer.id;break}}}else if(2===a.layer.type){let s=a.layer;for(let o=n+1;o<r;o++){const r=e[o];if(r.key!==t)break;const l=r.layer;(s.canUseThinTessellation&&!l.canUseThinTessellation||!s.canUseThinTessellation&&(l.getPaintProperty("line-pattern")||l.getPaintProperty("line-dasharray")))&&(s=l,e[n]=r,e[o]=a,i=r.layer.id)}}}}_create(e,i,r){const n=1-(1+i)*(1/(r.length+1)),a=this._runningId++;switch(e.type){case"background":return new t.BackgroundStyleLayer(0,e,n,a);case"fill":return new t.FillStyleLayer(1,e,n,a);case"line":return new t.LineStyleLayer(2,e,n,a);case"symbol":return new t.SymbolStyleLayer(3,e,n,a);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new t.CircleStyleLayer(4,e,n,a)}return null}static _recreateLayer(e,i){switch(e.type){case"background":return new t.BackgroundStyleLayer(0,e,i.z,i.uid);case"fill":return new t.FillStyleLayer(1,e,i.z,i.uid);case"line":return new t.LineStyleLayer(2,e,i.z,i.uid);case"symbol":return new t.SymbolStyleLayer(3,e,i.z,i.uid);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new t.CircleStyleLayer(4,e,i.z,i.uid)}return null}}return i})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define(["exports","../../../../../geometry/support/aaBoundingRect","../constants","../GeometryUtils","../shaders/VTLBackgroundMaterial","../shaders/VTLCircleMaterial","../shaders/VTLFillMaterial","../shaders/VTLLineMaterial","../shaders/VTLSymbolMaterial","./Filter","./StyleDefinition","./StyleProperty","../../webgl/definitions"],function(e,t,i,r,n,a,s,o,l,u,c,h,p){"use strict";class f{constructor(e,t,i,r){switch(this.type=e,this.typeName=t.type,this.id=t.id,this.source=t.source,this.sourceLayer=t["source-layer"],this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.filter=t.filter,this.layout=t.layout,this.paint=t.paint,this.z=i,this.uid=r,e){case 0:this._layoutDefinition=c.StyleDefinition.backgroundLayoutDefinition,this._paintDefinition=c.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=c.StyleDefinition.fillLayoutDefinition,this._paintDefinition=c.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=c.StyleDefinition.lineLayoutDefinition,this._paintDefinition=c.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=c.StyleDefinition.symbolLayoutDefinition,this._paintDefinition=c.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=c.StyleDefinition.circleLayoutDefinition,this._paintDefinition=c.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=u.createFilter(this.filter)}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,t,i){let r;const n=this._layoutProperties[e];return n&&(r=n.getValue(t,i)),void 0===r&&(r=this._layoutDefinition[e].default),r}getPaintValue(e,t,i){let r;const n=this._paintProperties[e];return n&&(r=n.getValue(t,i)),void 0===r&&(r=this._paintDefinition[e].default),r}isPainterDataDriven(){const e=this._paintProperties;if(e)for(const t in e)if(e[t].isDataDriven)return!0;return!1}isIntersectingFeature(e,t,i,r,n,a,s){return!1}getFeatureInflatedBounds(e,t,i,r){return null}_parseLayout(e){const t={};for(const i in e){const r=this._layoutDefinition[i];r&&(t[i]=new h(r,e[i]))}return t}_parsePaint(e){const t={};for(const i in e){const r=this._paintDefinition[i];r&&(t[i]=new h(r,e[i]))}return t}computeAttributesKey(e,t,i,r){let n=0,a=0;for(const e of t){let t=3;if(!e||e!==r){const r=i[e],{isLayout:n,isOptional:a}=r,s=n?this.getLayoutProperty(e):this.getPaintProperty(e);t=s?.interpolator?2:s?.isDataDriven?1:a&&!s?3:0}a|=t<<n,n+=2}return a<<3|e}}function d(e){const i=e?.getGeometry();if(null==i)return null;let r=1/0,n=1/0,a=-1/0,s=-1/0;for(const e of i)if(e)for(const t of e)r=Math.min(r,t.x),n=Math.min(n,t.y),a=Math.max(a,t.x),s=Math.max(s,t.y);return t.fromValues(r,n,a,s)}e.BackgroundStyleLayer=class extends f{constructor(e,t,i,r){super(e,t,i,r),this.backgroundMaterial=new n.VTLBackgroundMaterial(this.computeAttributesKey(0,n.VTLBackgroundMaterial.ATTRIBUTES,n.VTLBackgroundMaterial.ATTRIBUTES_INFO))}},e.CircleStyleLayer=class extends f{constructor(e,t,i,r){super(e,t,i,r),this.circleMaterial=new a.VTLCircleMaterial(this.computeAttributesKey(5,a.VTLCircleMaterial.ATTRIBUTES,a.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(e,t,r,n){const a=d(e);if(!a)return null;const s=this.getPaintValue("circle-translate",t,e),o=Math.max(s[0],s[1]);a[0]-=o,a[2]-=o,a[1]+=o,a[3]+=o;const l=n*(i.tilePixelRatio*(this.getPaintValue("circle-radius",t,e)+this.getPaintValue("circle-stroke-width",t,e))/2);return a[0]-=l,a[1]-=l,a[2]+=l,a[3]+=l,a}isIntersectingFeature(e,t,n,a,s,o,l){const u=a.getGeometry();if(!u)return!1;const c=i.tilePixelRatio/l.normalizationRatio;e=e/l.normalizationRatio+l.normalizationOffsetX,t=t/l.normalizationRatio+l.normalizationOffsetY,n*=c;const h=r.translateAnchor(this.getPaintValue("circle-translate",s,a),this.getPaintValue("circle-translate-anchor",s,a),o,c),p=c*(this.getPaintValue("circle-radius",s,a)+this.getPaintValue("circle-stroke-width",s,a));let f,d;for(const i of u)if(i)for(const r of i)if(f=r.x+h.x,d=r.y+h.y,Math.sqrt((e-f)*(e-f)+(t-d)*(t-d))-n<=p)return!0;return!1}},e.FillStyleLayer=class extends f{constructor(e,t,i,r){super(e,t,i,r);const n=this.getPaintProperty("fill-color"),a=this.getPaintProperty("fill-opacity"),o=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=n?.isDataDriven,this.hasDataDrivenOpacity=a?.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||o?.isDataDriven;const l=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!l,this.hasDataDrivenOutlineColor=l?.isDataDriven,this.hasDataDrivenOutline=l?l.isDataDriven:!!n&&n.isDataDriven,this.hasDataDrivenOutline=(l?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new s.VTLFillMaterial(this.computeAttributesKey(1,s.VTLFillMaterial.ATTRIBUTES,s.VTLFillMaterial.ATTRIBUTES_INFO)),this.outlineMaterial=new s.VTLOutlineMaterial(this.computeAttributesKey(2,this.outlineUsesFillColor?s.VTLOutlineMaterial.ATTRIBUTES_FILL:s.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?s.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:s.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(e,t,i,r){const n=d(e);if(!n)return null;const a=this.getPaintValue("fill-translate",t,e),s=r*Math.max(a[0],a[1]);return n[0]-=s,n[2]-=s,n[1]+=s,n[3]+=s,n}isIntersectingFeature(e,t,n,a,s,o,l){const u=a.getGeometry();if(!u)return!1;const c=i.tilePixelRatio/l.normalizationRatio;e=e/l.normalizationRatio+l.normalizationOffsetX,t=t/l.normalizationRatio+l.normalizationOffsetY;const h=r.translateAnchor(this.getPaintValue("fill-translate",s,a),this.getPaintValue("fill-translate-anchor",s,a),o,i.tilePixelRatio);return e-=c*h.x,t-=c*h.y,!!r.pointInPolygon(e,t,u)||r.distanceFromToPolylineWithinThreshold(e,t,u,c*n)}},e.IconLayout=class{constructor(e,t,i){let r;this.allowOverlap=e.getLayoutValue("icon-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",t),this.keepUpright=e.getLayoutValue("icon-keep-upright",t),this.optional=e.getLayoutValue("icon-optional",t),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=i?0:1),r=e.getLayoutProperty("icon-anchor"),r?.isDataDriven?this._anchorProp=r:this.anchor=e.getLayoutValue("icon-anchor",t),r=e.getLayoutProperty("icon-offset"),r?.isDataDriven?this._offsetProp=r:this.offset=e.getLayoutValue("icon-offset",t),r=e.getLayoutProperty("icon-padding"),r?.isDataDriven?this._paddingProp=r:this.padding=e.getLayoutValue("icon-padding",t),r=e.getLayoutProperty("icon-rotate"),r?.isDataDriven?this._rotateProp=r:this.rotate=e.getLayoutValue("icon-rotate",t),r=e.getLayoutProperty("icon-size"),r?.isDataDriven?this._sizeProp=r:this.size=e.getLayoutValue("icon-size",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t))}},e.IndexItem=class{constructor(e,t,i,r,n,a){this.layer=e,this.feature=t,this.bounds=i,this.normalizationRatio=r,this.normalizationOffsetX=n,this.normalizationOffsetY=a}},e.LineStyleLayer=class extends f{constructor(e,t,i,r){super(e,t,i,r);const n=this.getPaintProperty("line-pattern");if(this.lineMaterial=new o.VTLLineMaterial(this.computeAttributesKey(3,o.VTLLineMaterial.ATTRIBUTES,o.VTLLineMaterial.ATTRIBUTES_INFO,n?"line-dasharray":"")),this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven,this.canUseThinTessellation=!1,!this.hasDataDrivenLine){const e=this.getPaintProperty("line-width");if(!e||"number"==typeof e&&.5*e<p.thinLineHalfWidthThreshold){const e=this.getPaintProperty("line-offset");(!e||"number"==typeof e&&0===e)&&(this.canUseThinTessellation=!0)}}}getDashKey(e,t){let i;switch(t){case 0:default:i="Butt";break;case 1:i="Round";break;case 2:i="Square"}return`dasharray-[${e.toString()}]-${i}`}getFeatureInflatedBounds(e,t,i,r){const n=d(e);if(!n)return null;const a=this.getPaintValue("line-translate",t,e),s=r*Math.max(a[0],a[1]);n[0]-=s,n[2]-=s,n[1]+=s,n[3]+=s;const o=r*Math.abs(this.getPaintValue("line-offset",t,e)||0),l=r*(this.getPaintValue("line-width",t,e)/2);return n[0]-=o+l,n[1]-=o+l,n[2]+=o+l,n[3]+=o+l,n}isIntersectingFeature(e,t,n,a,s,o,l){let u=a.getGeometry();if(!u)return!1;const c=i.tilePixelRatio/l.normalizationRatio;e=e/l.normalizationRatio+l.normalizationOffsetX,t=t/l.normalizationRatio+l.normalizationOffsetY;const h=r.translateAnchor(this.getPaintValue("line-translate",s,a),this.getPaintValue("line-translate-anchor",s,a),o,i.tilePixelRatio);e-=c*h.x,t-=c*h.y;const p=c*this.getPaintValue("line-offset",s,a)||0;0!==p&&(u=r.offsetLine(u,-p));const f=this.getPaintValue("line-width",s,a)/2;return r.distanceFromToPolylineWithinThreshold(e,t,u,c*(n+f))}},e.StyleLayer=f,e.SymbolStyleLayer=class extends f{constructor(e,t,i,r){super(e,t,i,r),this.iconMaterial=new l.VTLIconMaterial(this.computeAttributesKey(4,l.VTLIconMaterial.ATTRIBUTES,l.VTLIconMaterial.ATTRIBUTES_INFO)),this.textMaterial=new l.VTLTextMaterial(this.computeAttributesKey(6,l.VTLTextMaterial.ATTRIBUTES,l.VTLTextMaterial.ATTRIBUTES_INFO)),this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven,this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}},e.TextLayout=class{constructor(e,t,i){let r;this.allowOverlap=e.getLayoutValue("text-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",t),this.keepUpright=e.getLayoutValue("text-keep-upright",t),this.optional=e.getLayoutValue("text-optional",t),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=i?0:1),r=e.getLayoutProperty("text-anchor"),r?.isDataDriven?this._anchorProp=r:this.anchor=e.getLayoutValue("text-anchor",t),r=e.getLayoutProperty("text-justify"),r?.isDataDriven?this._justifyProp=r:this.justify=e.getLayoutValue("text-justify",t),r=e.getLayoutProperty("text-letter-spacing"),r?.isDataDriven?this._letterSpacingProp=r:this.letterSpacing=e.getLayoutValue("text-letter-spacing",t),r=e.getLayoutProperty("text-line-height"),r?.isDataDriven?this._lineHeightProp=r:this.lineHeight=e.getLayoutValue("text-line-height",t),r=e.getLayoutProperty("text-max-angle"),r?.isDataDriven?this._maxAngleProp=r:this.maxAngle=e.getLayoutValue("text-max-angle",t),r=e.getLayoutProperty("text-max-width"),r?.isDataDriven?this._maxWidthProp=r:this.maxWidth=e.getLayoutValue("text-max-width",t),r=e.getLayoutProperty("text-offset"),r?.isDataDriven?this._offsetProp=r:this.offset=e.getLayoutValue("text-offset",t),r=e.getLayoutProperty("text-padding"),r?.isDataDriven?this._paddingProp=r:this.padding=e.getLayoutValue("text-padding",t),r=e.getLayoutProperty("text-rotate"),r?.isDataDriven?this._rotateProp=r:this.rotate=e.getLayoutValue("text-rotate",t),r=e.getLayoutProperty("text-size"),r?.isDataDriven?this._sizeProp=r:this.size=e.getLayoutValue("text-size",t),r=e.getLayoutProperty("text-writing-mode"),r?.isDataDriven?this._writingModeProp=r:this.writingMode=e.getLayoutValue("text-writing-mode",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,t)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,t)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,t)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,t)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,t))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";class n extends t.VTLMaterial{static{this.ATTRIBUTES=[]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.BYTE,0,2)]}static{this.ATTRIBUTES_INFO={}}constructor(e){super(e),this.baseGeometryLayout=n.GEOMETRY_LAYOUT,this.attributes=n.ATTRIBUTES,this.attributesInfo=n.ATTRIBUTES_INFO}}e.VTLBackgroundMaterial=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports","../MemoryBuffer","../../../../webgl/enums","../../../../webgl/VertexAttributeLocations","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r,n){"use strict";class a{constructor(e){this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._geometryLayout||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return this._geometryLayout||this._buildAttributesInfo(),this._locations}get geometryLayout(){return this._geometryLayout||this._buildAttributesInfo(),this._geometryLayout}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,t,i,r,n){const a=this.getUniforms();for(const s of a){const{name:a,type:o,getValue:l}=s,u=l(i,t,r,n);if(null!==u)switch(o){case"float":e.setUniform1f(a,u);break;case"vec2":e.setUniform2fv(a,u);break;case"vec4":e.setUniform4fv(a,u)}}}encodeAttributes(e,t,i,r){const n=this.attributesInfo,a=this.getEncodingInfos(),s=[];let o=0,l=0;for(const u of Object.keys(a)){const c=a[u],{type:h,precisionFactor:p,isLayout:f}=n[u],d=f?i.getLayoutProperty(u):i.getPaintProperty(u),y=d.interpolator?.getInterpolationRange(t);let m=0;for(const i of c){const{offset:n,bufferElementsToAdd:a}=i;if(a>0){for(let e=0;e<a;e++)s.push(0);o+=l,l=i.bufferElementsToAdd}const u=r??d.getValue(y?y[m]:t,e);switch(h){case 0:case 1:s[o]|=this._encodeByte(u*(p||1),8*n);break;case 2:case 3:s[o]|=this._encodeShort(u*(p||1),8*n);break;case 4:case 5:s[o]|=this._encodeByte(u*(p||1),8*n),s[o]|=this._encodeByte(u*(p||1),8*n+8);break;case 6:case 7:s[o]|=this._encodeShort(u*(p||1),8*n),s[o]|=this._encodeShort(u*(p||1),8*n+16);break;case 8:case 9:s[o]|=this._encodeByte(u*(p||1),8*n),s[o]|=this._encodeByte(u*(p||1),8*n+8),s[o]|=this._encodeByte(u*(p||1),8*n+16),s[o]|=this._encodeByte(u*(p||1),8*n+24);break;case 10:s[o]=this._encodeColor(u);break;case 11:case 12:this._encodePattern(o,s,u);break;default:throw new Error("Unsupported encoding type")}m++}}return s}getAtributeState(e){let t=0;const i=3+2*e;return t|=this._bit(i),t|=this._bit(i+1)<<1,t}static{this._encodingInfo={0:{dataType:i.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},1:{dataType:i.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},2:{dataType:i.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},3:{dataType:i.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},4:{dataType:i.DataType.BYTE,bytesPerElement:1,count:2,normalized:!1},5:{dataType:i.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},6:{dataType:i.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},7:{dataType:i.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},8:{dataType:i.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},9:{dataType:i.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},10:{dataType:i.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},11:{dataType:i.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},12:{dataType:i.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}}}_buildAttributesInfo(){const e=[],t={},{attributesInfo:r,attributes:n}=this,s={};let o=-1,l=-1;for(const i of n){l++;const n=this.getAtributeState(l);if(0===n||3===n)continue;const u=r[i],c=[];t[i]=c;const h=u.type;for(let t=0;t<n;t++){const{dataType:t,bytesPerElement:i,count:r,normalized:n}=a._encodingInfo[h],l=i*r,u=`${t}-${!0===n}`;let p=s[u],f=0;if(!p||p.count+r>4)o++,p={dataIndex:o,count:0,offset:0},4!==r&&(s[u]=p),e.push({location:-1,name:"a_data_"+o,count:r,type:t,normalized:n}),f=Math.ceil(Math.max(l/4,1));else{const t=e[p.dataIndex];t.count+=r,f=Math.ceil(Math.max(t.count*i/4,1))-Math.ceil(Math.max(p.offset/4,1))}c.push({dataIndex:p.dataIndex,offset:p.offset,bufferElementsToAdd:f}),p.offset+=l,p.count+=r}}for(const t of e)switch(t.type){case i.DataType.BYTE:case i.DataType.UNSIGNED_BYTE:t.count=4;break;case i.DataType.SHORT:case i.DataType.UNSIGNED_SHORT:t.count+=t.count%2}this._buildVertexBufferLayout(e),this._buildShaderInfo(e,t),this._propertyEncodingInfo=t}_buildVertexBufferLayout(e){const t=this.baseGeometryLayout;let i=t[0].stride;if(0===e.length)this._geometryLayout=t;else{const r=[];let a=i;for(const t of e)i+=s(t.type)*t.count;for(const e of t)r.push(new n.VertexElementDescriptor(e.name,e.count,e.type,e.offset,i,e.normalized));for(const t of e)r.push(new n.VertexElementDescriptor(t.name,t.count,t.type,a,i,t.normalized)),a+=s(t.type)*t.count;this._geometryLayout=r}this.opacityLayout?this._locations=r.fromLayouts([this._geometryLayout,this.opacityLayout]):this._locations=r.fromLayout(this._geometryLayout),this._stride=i}_buildShaderInfo(e,t){let i="\n",r="\n";const n=[];for(const t of e)i+=`attribute ${this._getType(t.count)} ${t.name};\n`;const{attributesInfo:s,attributes:l}=this;let u=-1;for(const e of l){u++;const{name:l,type:c,precisionFactor:h,isLayout:p}=s[e],f=h&&1!==h?" * "+1/h:"",{bytesPerElement:d,count:y}=a._encodingInfo[c],m=e=>`a_data_${e.dataIndex}${o(y,e.offset,d)}`;switch(this.getAtributeState(u)){case 0:{const t=this._getType(y),a=`u_${l}`;n.push({name:a,type:t,getValue:(t,i,r,n)=>{const a=p?t.getLayoutValue(e,i):t.getPaintValue(e,i);if(11===c){const e=t.getDashKey(a,t.getLayoutValue("line-cap",i)),r=n.getMosaicItemPosition(e,!1);if(null==r)return null;const{tl:s,br:o}=r;return[s[0],o[1],o[0],s[1]]}if(12===c){const t=n.getMosaicItemPosition(a,!e.includes("line-"));if(null==t)return null;const{tl:i,br:r}=t;return[i[0],r[1],r[0],i[1]]}if(10===c){const e=a[3];return[e*a[0],e*a[1],e*a[2],e]}return a}}),i+=`uniform ${t} ${a};\n`,r+=`${t} ${l} = ${a};\n`}break;case 1:{const i=m(t[e][0]);r+=`${this._getType(y)} ${l} = ${i}${f};\n`}break;case 2:{const a=`u_t_${l}`;n.push({name:a,type:"float",getValue:(t,i,r,n)=>(p?t.getLayoutProperty(e):t.getPaintProperty(e)).interpolator.interpolationUniformValue(r,i)}),i+=`uniform float ${a};\n`;const s=m(t[e][0]),o=m(t[e][1]);r+=`${this._getType(y)} ${l} = mix(${s}${f}, ${o}${f}, ${a});\n`}}}this._shaderHeader=i,this._shaderMain=r,this._uniforms=n}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(e){const i=255*e[3];return t.i8888to32(e[0]*i,e[1]*i,e[2]*i,i)}_encodePattern(e,t,i){if(!i?.rect)return;const r=i.rect,n=i.width,a=i.height;t[e]=this._encodeShort(r.x+2,0),t[e]|=this._encodeShort(r.y+2+a,16),t[e+1]=this._encodeShort(r.x+2+n,0),t[e+1]|=this._encodeShort(r.y+2,16)}_encodeByte(e,t){return(255&e)<<t}_encodeShort(e,t){return(65535&e)<<t}}const s=e=>{switch(e){case i.DataType.FLOAT:case i.DataType.INT:case i.DataType.UNSIGNED_INT:return 4;case i.DataType.SHORT:case i.DataType.UNSIGNED_SHORT:case i.DataType.HALF_FLOAT:return 2;case i.DataType.BYTE:case i.DataType.UNSIGNED_BYTE:return 1}},o=(e,t,i)=>{const r=t/i;if(1===e)switch(r){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===e)switch(r){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===e)switch(r){case 0:return".xyz";case 1:return".yzw"}return""};e.VTLMaterial=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../core/has"],function(e){"use strict";return class{constructor(e){this._array=[],this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,t){return 65535&e|t<<16}static i8888to32(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24}static i8816to32(e,t,i){return 255&e|(255&t)<<8|i<<16}}})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";class n extends t.VTLMaterial{static{this.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,4)]}static{this.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:1},"circle-color":{name:"color",type:10},"circle-opacity":{name:"opacity",type:1,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:1,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:10},"circle-stroke-opacity":{name:"stroke_opacity",type:1,precisionFactor:100},"circle-blur":{name:"blur",type:1,precisionFactor:32}}}constructor(e){super(e),this.baseGeometryLayout=n.GEOMETRY_LAYOUT,this.attributes=n.ATTRIBUTES,this.attributesInfo=n.ATTRIBUTES_INFO}}e.VTLCircleMaterial=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";class n extends t.VTLMaterial{static{this.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,4)]}static{this.ATTRIBUTES_INFO={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100},"fill-pattern":{name:"tlbr",type:12,isOptional:!0}}}constructor(e){super(e),this.baseGeometryLayout=n.GEOMETRY_LAYOUT,this.attributes=n.ATTRIBUTES,this.attributesInfo=n.ATTRIBUTES_INFO}}class a extends t.VTLMaterial{static{this.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"]}static{this.ATTRIBUTES_FILL=["fill-color","fill-opacity"]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,8),new r.VertexElementDescriptor("a_offset",2,i.DataType.BYTE,4,8),new r.VertexElementDescriptor("a_xnormal",2,i.DataType.BYTE,6,8)]}static{this.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}}}static{this.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}}}constructor(e,t){super(e),this.baseGeometryLayout=a.GEOMETRY_LAYOUT,this.attributes=t?a.ATTRIBUTES_FILL:a.ATTRIBUTES_OUTLINE,this.attributesInfo=t?a.ATTRIBUTES_INFO_FILL:a.ATTRIBUTES_INFO_OUTLINE}}e.VTLFillMaterial=n,e.VTLOutlineMaterial=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";class n extends t.VTLMaterial{static{this.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width","line-pattern","line-dasharray"]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,16),new r.VertexElementDescriptor("a_extrude_offset",4,i.DataType.BYTE,4,16),new r.VertexElementDescriptor("a_dir_normal",4,i.DataType.BYTE,8,16),new r.VertexElementDescriptor("a_accumulatedDistance",2,i.DataType.UNSIGNED_SHORT,12,16)]}static{this.ATTRIBUTES_INFO={"line-width":{name:"width",type:1,precisionFactor:2},"line-gap-width":{name:"gap_width",type:1,precisionFactor:2},"line-offset":{name:"offset",type:0,precisionFactor:2},"line-color":{name:"color",type:10},"line-opacity":{name:"opacity",type:1,precisionFactor:100},"line-blur":{name:"blur",type:1,precisionFactor:4},"line-pattern":{name:"tlbr",type:12,isOptional:!0},"line-dasharray":{name:"tlbr",type:11,isOptional:!0}}}constructor(e){super(e),this.baseGeometryLayout=n.GEOMETRY_LAYOUT,this.attributes=n.ATTRIBUTES,this.attributesInfo=n.ATTRIBUTES_INFO}}e.VTLLineMaterial=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";const n=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,16),new r.VertexElementDescriptor("a_vertexOffset",2,i.DataType.SHORT,4,16),new r.VertexElementDescriptor("a_texAngleRange",4,i.DataType.UNSIGNED_BYTE,8,16),new r.VertexElementDescriptor("a_levelInfo",4,i.DataType.UNSIGNED_BYTE,12,16)],a=[new r.VertexElementDescriptor("a_opacityInfo",1,i.DataType.UNSIGNED_BYTE,0,1)];class s extends t.VTLMaterial{static{this.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"]}static{this.ATTRIBUTES_INFO={"icon-color":{name:"color",type:10},"icon-opacity":{name:"opacity",type:1,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:10},"icon-halo-width":{name:"halo_width",type:1,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"icon-size":{name:"size",type:1,precisionFactor:32,isLayout:!0}}}constructor(e){super(e),this.baseGeometryLayout=n,this.opacityLayout=a,this.attributes=s.ATTRIBUTES,this.attributesInfo=s.ATTRIBUTES_INFO}}class o extends t.VTLMaterial{static{this.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"]}static{this.ATTRIBUTES_INFO={"text-color":{name:"color",type:10},"text-opacity":{name:"opacity",type:1,precisionFactor:100},"text-halo-color":{name:"halo_color",type:10},"text-halo-width":{name:"halo_width",type:1,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"text-size":{name:"size",type:1,isLayout:!0}}}constructor(e){super(e),this.baseGeometryLayout=n,this.opacityLayout=a,this.attributes=o.ATTRIBUTES,this.attributesInfo=o.ATTRIBUTES_INFO}}e.VTLIconMaterial=s,e.VTLTextMaterial=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(e,t){"use strict";class i{constructor(e){this._expression=e}filter(e,t){if(!this._expression)return!0;try{return this._expression.evaluate(e,t)}catch(e){return console.log(e.message),!0}}static createFilter(r){if(!r)return null;this.isLegacyFilter(r)&&(r=this.convertLegacyFilter(r));try{const n=e.createExpression(r,null,t.booleanType);return new i(n)}catch(e){return console.log(e.message),null}}static isLegacyFilter(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":case"none":case"!has":return!0;case"any":case"all":for(let t=1;t<e.length;t++)if(this.isLegacyFilter(e[t]))return!0;return!1;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||0===e.length)return!0;const t=e[0];if(1===e.length)return"any"!==t;switch(t){case"==":return i.convertComparison("==",e[1],e[2]);case"!=":return i.negate(i.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return i.convertComparison(t,e[1],e[2]);case"in":return i.convertIn(e[1],e.slice(2));case"!in":return i.negate(i.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return i.convertCombining(t,e.slice(1));case"has":return i.convertHas(e[1]);case"!has":return i.negate(i.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(e,t,i){switch(t){case"$type":return[e,["geometry-type"],i];case"$id":return[e,["id"],i];default:return[e,["get",t],i]}}static convertIn(e,t){switch(e){case"$type":return["in",["geometry-type"],["literal",t]];case"$id":return["in",["id"],["literal",t]];default:return["in",["get",e],["literal",t]]}}static convertHas(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}static convertCombining(e,t){return[e].concat(t.map(this.convertLegacyFilter))}static negate(e){return["!",e]}}return i})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define(["exports","../../../../../Color","../../../../../core/colorUtils","../../../unitBezier","../GeometryUtils","./types"],function(e,t,i,r,n,a){"use strict";class s{constructor(e){this._parent=e,this._vars={}}add(e,t){this._vars[e]=t}get(e){return this._vars[e]?this._vars[e]:this._parent?this._parent.get(e):null}}class o{constructor(){this.type=a.valueType}static parse(e){if(e.length>1)throw new Error('"id" does not expect arguments');return new o}evaluate(e,t){return e?.id}}class l{constructor(){this.type=a.stringType}static parse(e){if(e.length>1)throw new Error('"geometry-type" does not expect arguments');return new l}evaluate(e,t){if(!e)return null;switch(e.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}}}class u{constructor(){this.type=a.objectType}static parse(e){if(e.length>1)throw new Error('"properties" does not expect arguments');return new u}evaluate(e,t){return e?.values}}class c{constructor(){this.type=a.numberType}static parse(e){if(e.length>1)throw new Error('"zoom" does not expect arguments');return new c}evaluate(e,t){return t}}class h{constructor(e,t,i){this._lhs=e,this._rhs=t,this._compare=i,this.type=a.booleanType}static parse(e,t,i){if(3!==e.length&&4!==e.length)throw new Error(`"${e[0]}" expects 2 or 3 arguments`);if(4===e.length)throw new Error(`"${e[0]}" collator not supported`);return new h(ee(e[1],t),ee(e[2],t),i)}evaluate(e,t){return this._compare(this._lhs.evaluate(e,t),this._rhs.evaluate(e,t))}}class p extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e===t)}}class f extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e!==t)}}class d extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e<t)}}class y extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e<=t)}}class m extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e>t)}}class g extends h{static parse(e,t){return h.parse(e,t,(e,t)=>e>=t)}}class _{constructor(e){this._arg=e,this.type=a.booleanType}static parse(e,t){if(2!==e.length)throw new Error('"!" expects 1 argument');return new _(ee(e[1],t))}evaluate(e,t){return!this._arg.evaluate(e,t)}}class v{constructor(e){this._args=e,this.type=a.booleanType}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(ee(e[r],t));return new v(i)}evaluate(e,t){for(const i of this._args)if(!i.evaluate(e,t))return!1;return!0}}class b{constructor(e){this._args=e,this.type=a.booleanType}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(ee(e[r],t));return new b(i)}evaluate(e,t){for(const i of this._args)if(i.evaluate(e,t))return!0;return!1}}class T{constructor(e){this._args=e,this.type=a.booleanType}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(ee(e[r],t));return new T(i)}evaluate(e,t){for(const i of this._args)if(i.evaluate(e,t))return!1;return!0}}class w{constructor(e,t,i){this.type=e,this._args=t,this._fallback=i}static parse(e,t,i){if(e.length<4)throw new Error('"case" expects at least 3 arguments');if(e.length%2==1)throw new Error('"case" expects an odd number of arguments');let r;const n=[];for(let a=1;a<e.length-1;a+=2){const s=ee(e[a],t),o=ee(e[a+1],t,i);r||(r=o.type),n.push({condition:s,output:o})}const a=ee(e[e.length-1],t,i);return r||(r=a.type),new w(r,n,a)}evaluate(e,t){for(const i of this._args)if(i.condition.evaluate(e,t))return i.output.evaluate(e,t);return this._fallback.evaluate(e,t)}}class x{constructor(e,t){this.type=e,this._args=t}static parse(e,t){if(e.length<2)throw new Error('"coalesce" expects at least 1 argument');let i;const r=[];for(let n=1;n<e.length;n++){const a=ee(e[n],t);i||(i=a.type),r.push(a)}return new x(i,r)}evaluate(e,t){for(const i of this._args){const r=i.evaluate(e,t);if(null!==r)return r}return null}}class S{constructor(e,t,i,r,n){this.type=e,this._input=t,this._labels=i,this._outputs=r,this._fallback=n}static parse(e,t){if(e.length<3)throw new Error('"match" expects at least 3 arguments');if(e.length%2==0)throw new Error('"case" expects an even number of arguments');let i;const r=ee(e[1],t),n=[],a={};let s;for(let r=2;r<e.length-1;r+=2){let o=e[r];Array.isArray(o)||(o=[o]);for(const e of o){const t=typeof e;if("string"!==t&&"number"!==t)throw new Error('"match" requires string or number literal as labels');if(s){if(t!==s)throw new Error('"match" requires labels to have the same type')}else s=t;a[e]=n.length}const l=ee(e[r+1],t);i||(i=l.type),n.push(l)}return new S(i,r,a,n,ee(e[e.length-1],t))}evaluate(e,t){const i=this._input.evaluate(e,t);return(this._outputs[this._labels[i]]||this._fallback).evaluate(e,t)}}class P{constructor(e,t,i,r,n){this._operator=e,this.type=t,this.interpolation=i,this.input=r,this._stops=n}static parse(e,t,i){const r=e[0];if(e.length<5)throw new Error(`"${r}" expects at least 4 arguments`);const n=e[1];if(!Array.isArray(n)||0===n.length)throw new Error(`"${n}" is not a valid interpolation`);switch(n[0]){case"linear":if(1!==n.length)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(2!==n.length||"number"!=typeof n[1])throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(5!==n.length)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(let e=1;e<5;e++){const t=n[e];if("number"!=typeof t||t<0||t>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error(`"${e[0]}" unknown interpolation type "${n[0]}"`)}if(e.length%2!=1)throw new Error(`"${r}" expects an even number of arguments`);const s=ee(e[2],t,a.numberType);let o;"interpolate-hcl"===r||"interpolate-lab"===r?o=a.colorType:i&&"value"!==i.kind&&(o=i);const l=[];for(let i=3;i<e.length;i+=2){const n=e[i];if("number"!=typeof n)throw new Error(`"${r}" requires stop inputs as literal numbers`);if(l.length&&l[l.length-1][0]>=n)throw new Error(`"${r}" requires strictly ascending stop inputs`);const a=ee(e[i+1],t,o);o||(o=a.type),l.push([n,a])}if(o&&o!==a.colorType&&o!==a.numberType&&("array"!==o.kind||o.itemType!==a.numberType))throw new Error(`"${r}" cannot interpolate type ${a.typeToString(o)}`);return new P(r,o,n,s,l)}evaluate(e,r){const s=this._stops;if(1===s.length)return s[0][1].evaluate(e,r);const o=this.input.evaluate(e,r);if(o<=s[0][0])return s[0][1].evaluate(e,r);if(o>=s[s.length-1][0])return s[s.length-1][1].evaluate(e,r);let l=0;for(;++l<s.length&&!(o<s[l][0]););const u=s[l-1][0],c=s[l][0],h=P.interpolationRatio(this.interpolation,o,u,c),p=s[l-1][1].evaluate(e,r),f=s[l][1].evaluate(e,r);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(p)&&Array.isArray(f))return p.map((e,t)=>n.interpolate(e,f[t],h));if("color"===this.type.kind&&p instanceof t&&f instanceof t){const e=new t(p),i=new t(f);return new t([n.interpolate(e.r,i.r,h),n.interpolate(e.g,i.g,h),n.interpolate(e.b,i.b,h),n.interpolate(e.a,i.a,h)])}if("number"===this.type.kind&&"number"==typeof p&&"number"==typeof f)return n.interpolate(p,f,h);throw new Error(`"${this._operator}" cannot interpolate type ${a.typeToString(this.type)}`)}if("interpolate-hcl"===this._operator){const e=i.toLCH(p),r=i.toLCH(f),a=r.h-e.h,s=i.toRGB({h:e.h+h*(a>180||a<-180?a-360*Math.round(a/360):a),c:n.interpolate(e.c,r.c,h),l:n.interpolate(e.l,r.l,h)});return new t({a:n.interpolate(p.a,f.a,h),...s})}if("interpolate-lab"===this._operator){const e=i.toLAB(p),r=i.toLAB(f),a=i.toRGB({l:n.interpolate(e.l,r.l,h),a:n.interpolate(e.a,r.a,h),b:n.interpolate(e.b,r.b,h)});return new t({a:n.interpolate(p.a,f.a,h),...a})}throw new Error(`Unexpected operator "${this._operator}"`)}interpolationUniformValue(e,t){const i=this._stops;if(1===i.length)return 0;if(e>=i[i.length-1][0])return 0;let r=0;for(;++r<i.length&&!(e<i[r][0]););const n=i[r-1][0],a=i[r][0];return P.interpolationRatio(this.interpolation,t,n,a)}getInterpolationRange(e){const t=this._stops;if(1===t.length){const e=t[0][0];return[e,e]}const i=t[t.length-1][0];if(e>=i)return[i,i];let r=0;for(;++r<t.length&&!(e<t[r][0]););return[t[r-1][0],t[r][0]]}static interpolationRatio(e,t,i,n){let a=0;return"linear"===e[0]?a=P._exponentialInterpolationRatio(t,1,i,n):"exponential"===e[0]?a=P._exponentialInterpolationRatio(t,e[1],i,n):"cubic-bezier"===e[0]&&(a=r.unitBezier(e[1],e[2],e[3],e[4])(P._exponentialInterpolationRatio(t,1,i,n),1e-5)),a<0?a=0:a>1&&(a=1),a}static _exponentialInterpolationRatio(e,t,i,r){const n=r-i;if(0===n)return 0;const a=e-i;return 1===t?a/n:(t**a-1)/(t**n-1)}}class D{constructor(e,t,i){this.type=e,this._input=t,this._stops=i}static parse(e,t){if(e.length<5)throw new Error('"step" expects at least 4 arguments');if(e.length%2!=1)throw new Error('"step" expects an even number of arguments');const i=ee(e[1],t,a.numberType);let r;const n=[];n.push([-1/0,ee(e[2],t)]);for(let i=3;i<e.length;i+=2){const a=e[i];if("number"!=typeof a)throw new Error('"step" requires stop inputs as literal numbers');if(n.length&&n[n.length-1][0]>=a)throw new Error('"step" requires strictly ascending stop inputs');const s=ee(e[i+1],t);r||(r=s.type),n.push([a,s])}return new D(r,i,n)}evaluate(e,t){const i=this._stops;if(1===i.length)return i[0][1].evaluate(e,t);const r=this._input.evaluate(e,t);let n=0;for(;++n<i.length&&!(r<i[n][0]););return this._stops[n-1][1].evaluate(e,t)}}class L{constructor(e,t){this.type=e,this._output=t}static parse(e,t,i){if(e.length<4)throw new Error('"let" expects at least 3 arguments');if(e.length%2==1)throw new Error('"let" expects an odd number of arguments');const r=new s(t);for(let i=1;i<e.length-1;i+=2){const n=e[i];if("string"!=typeof n)throw new Error(`"let" requires a string to define variable names - found ${n}`);r.add(n,ee(e[i+1],t))}const n=ee(e[e.length-1],r,i);return new L(n.type,n)}evaluate(e,t){return this._output.evaluate(e,t)}}class M{constructor(e,t){this.type=e,this.output=t}static parse(e,t,i){if(2!==e.length||"string"!=typeof e[1])throw new Error('"var" requires just one literal string argument');const r=t.get(e[1]);if(!r)throw new Error(`${e[1]} must be defined before being used in a "var" expression`);return new M(i||a.valueType,r)}evaluate(e,t){return this.output.evaluate(e,t)}}class I{constructor(e,t,i){this.type=e,this._index=t,this._array=i}static parse(e,t){if(3!==e.length)throw new Error('"at" expects 2 arguments');const i=ee(e[1],t,a.numberType),r=ee(e[2],t);return new I(r.type.itemType,i,r)}evaluate(e,t){const i=this._index.evaluate(e,t),r=this._array.evaluate(e,t);if(i<0||i>=r.length)throw new Error('"at" index out of bounds');if(i!==Math.floor(i))throw new Error('"at" index must be an integer');return r[i]}}class E{constructor(e,t){this._key=e,this._obj=t,this.type=a.valueType}static parse(e,t){let i,r;switch(e.length){case 2:return i=ee(e[1],t),new E(i);case 3:return i=ee(e[1],t),r=ee(e[2],t),new E(i,r);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(e,t){const i=this._key.evaluate(e,t);return this._obj?this._obj.evaluate(e,t)[i]:e?.values[i]}}class R{constructor(e,t){this._key=e,this._obj=t,this.type=a.booleanType}static parse(e,t){let i,r;switch(e.length){case 2:return i=ee(e[1],t),new R(i);case 3:return i=ee(e[1],t),r=ee(e[2],t),new R(i,r);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(e,t){const i=this._key.evaluate(e,t);return this._obj?i in this._obj.evaluate(e,t):!!e?.values[i]}}class V{constructor(e,t){this._key=e,this._vals=t,this.type=a.booleanType}static parse(e,t){if(3!==e.length)throw new Error('"in" expects 2 arguments');return new V(ee(e[1],t),ee(e[2],t))}evaluate(e,t){const i=this._key.evaluate(e,t);return this._vals.evaluate(e,t).includes(i)}}class U{constructor(e,t,i){this._item=e,this._array=t,this._from=i,this.type=a.numberType}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"index-of" expects 3 or 4 arguments');const i=ee(e[1],t),r=ee(e[2],t);if(4===e.length){const n=ee(e[3],t,a.numberType);return new U(i,r,n)}return new U(i,r)}evaluate(e,t){const i=this._item.evaluate(e,t),r=this._array.evaluate(e,t);if(this._from){const n=this._from.evaluate(e,t);if(n!==Math.floor(n))throw new Error('"index-of" index must be an integer');return r.indexOf(i,n)}return r.indexOf(i)}}class C{constructor(e){this._arg=e,this.type=a.numberType}static parse(e,t){if(2!==e.length)throw new Error('"length" expects 2 arguments');const i=ee(e[1],t);return new C(i)}evaluate(e,t){const i=this._arg.evaluate(e,t);if("string"==typeof i)return i.length;if(Array.isArray(i))return i.length;throw new Error('"length" expects string or array')}}class k{constructor(e,t,i,r){this.type=e,this._array=t,this._from=i,this._to=r}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"slice" expects 2 or 3 arguments');const i=ee(e[1],t),r=ee(e[2],t,a.numberType);if(r.type!==a.numberType)throw new Error('"slice" index must return a number');if(4===e.length){const n=ee(e[3],t,a.numberType);if(n.type!==a.numberType)throw new Error('"slice" index must return a number');return new k(i.type,i,r,n)}return new k(i.type,i,r)}evaluate(e,t){const i=this._array.evaluate(e,t);if(!Array.isArray(i)&&"string"!=typeof i)throw new Error('"slice" input must be an array or a string');const r=this._from.evaluate(e,t);if(r<0||r>=i.length)throw new Error('"slice" index out of bounds');if(r!==Math.floor(r))throw new Error('"slice" index must be an integer');if(this._to){const n=this._to.evaluate(e,t);if(n<0||n>=i.length)throw new Error('"slice" index out of bounds');if(n!==Math.floor(n))throw new Error('"slice" index must be an integer');return i.slice(r,n)}return i.slice(r)}}class A{constructor(){this.type=a.booleanType}static parse(e){if(1!==e.length)throw new Error('"has-id" expects no arguments');return new A}evaluate(e,t){return void 0!==e?.id}}class z{constructor(e,t){this._args=e,this._calculate=t,this.type=a.numberType}static parse(e,t,i){const r=e.slice(1).map(e=>ee(e,t));return new z(r,i)}evaluate(e,t){let i;return this._args&&(i=this._args.map(i=>i.evaluate(e,t))),this._calculate(i)}}class B extends z{static parse(e,t){switch(e.length){case 2:return z.parse(e,t,e=>-e[0]);case 3:return z.parse(e,t,e=>e[0]-e[1]);default:throw new Error('"-" expects 1 or 2 arguments')}}}class O extends z{static parse(e,t){return z.parse(e,t,e=>{let t=1;for(const i of e)t*=i;return t})}}class F extends z{static parse(e,t){if(3===e.length)return z.parse(e,t,e=>e[0]/e[1]);throw new Error('"/" expects 2 arguments')}}class N extends z{static parse(e,t){if(3===e.length)return z.parse(e,t,e=>e[0]%e[1]);throw new Error('"%" expects 2 arguments')}}class G extends z{static parse(e,t){if(3===e.length)return z.parse(e,t,e=>e[0]**e[1]);throw new Error('"^" expects 1 or 2 arguments')}}class H extends z{static parse(e,t){return z.parse(e,t,e=>{let t=0;for(const i of e)t+=i;return t})}}class ${constructor(e,t){this._args=e,this._calculate=t,this.type=a.numberType}static{this.ops={abs:e=>Math.abs(e[0]),acos:e=>Math.acos(e[0]),asin:e=>Math.asin(e[0]),atan:e=>Math.atan(e[0]),ceil:e=>Math.ceil(e[0]),cos:e=>Math.cos(e[0]),e:()=>Math.E,floor:e=>Math.floor(e[0]),ln:e=>Math.log(e[0]),ln2:()=>Math.LN2,log10:e=>Math.log(e[0])/Math.LN10,log2:e=>Math.log(e[0])/Math.LN2,max:e=>Math.max(...e),min:e=>Math.min(...e),pi:()=>Math.PI,round:e=>Math.round(e[0]),sin:e=>Math.sin(e[0]),sqrt:e=>Math.sqrt(e[0]),tan:e=>Math.tan(e[0])}}static parse(e,t){const i=e.slice(1).map(e=>ee(e,t));return new $(i,$.ops[e[0]])}evaluate(e,t){let i;return this._args&&(i=this._args.map(i=>i.evaluate(e,t))),this._calculate(i)}}class W{constructor(e){this._args=e,this.type=a.stringType}static parse(e,t){return new W(e.slice(1).map(e=>ee(e,t)))}evaluate(e,t){return this._args.map(i=>i.evaluate(e,t)).join("")}}class j{constructor(e,t){this._arg=e,this._calculate=t,this.type=a.stringType}static{this.ops={downcase:e=>e.toLowerCase(),upcase:e=>e.toUpperCase()}}static parse(e,t){if(2!==e.length)throw new Error(`${e[0]} expects 1 argument`);const i=ee(e[1],t);return new j(i,j.ops[e[0]])}evaluate(e,t){return this._calculate(this._arg.evaluate(e,t))}}class Y{constructor(e){this._args=e,this.type=a.colorType}static parse(e,t){if(4!==e.length)throw new Error('"rgb" expects 3 arguments');const i=e.slice(1).map(e=>ee(e,t));return new Y(i)}evaluate(e,i){const r=this._validate(this._args[0].evaluate(e,i)),n=this._validate(this._args[1].evaluate(e,i)),a=this._validate(this._args[2].evaluate(e,i));return new t({r,g:n,b:a})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}}class q{constructor(e){this._args=e,this.type=a.colorType}static parse(e,t){if(5!==e.length)throw new Error('"rgba" expects 4 arguments');const i=e.slice(1).map(e=>ee(e,t));return new q(i)}evaluate(e,i){const r=this._validate(this._args[0].evaluate(e,i)),n=this._validate(this._args[1].evaluate(e,i)),a=this._validate(this._args[2].evaluate(e,i)),s=this._validateAlpha(this._args[3].evaluate(e,i));return new t({r,g:n,b:a,a:s})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}_validateAlpha(e){if("number"!=typeof e||e<0||e>1)throw new Error(`${e}: invalid alpha color component`);return e}}class K{constructor(e){this._color=e,this.type=a.arrayType(a.numberType,4)}static parse(e,t){if(2!==e.length)throw new Error('"to-rgba" expects 1 argument');const i=ee(e[1],t);return new K(i)}evaluate(e,i){return new t(this._color.evaluate(e,i)).toRgba()}}class X{constructor(e,t){this.type=e,this._args=t}static parse(e,t){const i=e[0];if(e.length<2)throw new Error(`${i} expects at least one argument`);let r,n=1;if("array"===i){if(e.length>2){switch(e[1]){case"string":r=a.stringType;break;case"number":r=a.numberType;break;case"boolean":r=a.booleanType;break;default:throw new Error('"array" type argument must be string, number or boolean')}n++}else r=a.valueType;let t;if(e.length>3){if(t=e[2],null!==t&&("number"!=typeof t||t<0||t!==Math.floor(t)))throw new Error('"array" length argument must be a positive integer literal');n++}r=a.arrayType(r,t)}else switch(i){case"string":r=a.stringType;break;case"number":r=a.numberType;break;case"boolean":r=a.booleanType;break;case"object":r=a.objectType}const s=[];for(;n<e.length;n++){const i=ee(e[n],t);s.push(i)}return new X(r,s)}evaluate(e,t){let i;for(const r of this._args){const n=r.evaluate(e,t);if(i=a.getType(n),a.matchType(i,this.type))return n}throw new Error(`Expected ${a.typeToString(this.type)} but got ${a.typeToString(i)}`)}}class Z{static{this.types={"to-boolean":a.booleanType,"to-color":a.colorType,"to-number":a.numberType,"to-string":a.stringType}}constructor(e,t){this.type=e,this._args=t}static parse(e,t){const i=e[0],r=Z.types[i];if(r===a.booleanType||r===a.stringType){if(2!==e.length)throw new Error(`${i} expects one argument`)}else if(e.length<2)throw new Error(`${i} expects at least one argument`);const n=[];for(let i=1;i<e.length;i++){const r=ee(e[i],t);n.push(r)}return new Z(r,n)}evaluate(e,i){if(this.type===a.booleanType)return Boolean(this._args[0].evaluate(e,i));if(this.type===a.stringType)return a.valueToString(this._args[0].evaluate(e,i));if(this.type===a.numberType){for(const t of this._args){const r=Number(t.evaluate(e,i));if(!isNaN(r))return r}return null}if(this.type===a.colorType){for(const r of this._args)try{const n=Z.toColor(r.evaluate(e,i));if(n instanceof t)return n}catch{}return null}}static toBoolean(e){return Boolean(e)}static toString(e){return a.valueToString(e)}static toNumber(e){const t=Number(e);if(isNaN(t))throw new Error(`"${e}" is not a number`);return t}static toColor(e){if(e instanceof t)return e;if("string"==typeof e){const i=t.fromString(e);if(i)return i;throw new Error(`"${e}" is not a color`)}if(Array.isArray(e))return t.fromArray(e);throw new Error(`"${e}" is not a color`)}}class J{constructor(e){this._val=e,this.type=a.getType(e)}static parse(e){if(2!==e.length)throw new Error('"literal" expects 1 argument');return new J(e[1])}evaluate(e,t){return this._val}}class Q{constructor(e){this._arg=e,this.type=a.stringType}static parse(e,t){if(2!==e.length)throw new Error('"typeof" expects 1 argument');return new Q(ee(e[1],t))}evaluate(e,t){return a.typeToString(a.getType(this._arg.evaluate(e,t)))}}function ee(e,t,i){const r=typeof e;if("string"===r||"boolean"===r||"number"===r||null===e){if(i)switch(i.kind){case"string":"string"!==r&&(e=Z.toString(e));break;case"number":"number"!==r&&(e=Z.toNumber(e));break;case"color":e=Z.toColor(e)}e=["literal",e]}if(!Array.isArray(e)||0===e.length)throw new Error("Expression must be a non empty array");const n=e[0];if("string"!=typeof n)throw new Error("First element of expression must be a string");const a=te[n];if(void 0===a)throw new Error(`Invalid expression operator "${n}"`);if(!a)throw new Error(`Unimplemented expression operator "${n}"`);return a.parse(e,t,i)}const te={array:X,boolean:X,collator:null,format:null,image:null,literal:J,number:X,"number-format":null,object:X,string:X,"to-boolean":Z,"to-color":Z,"to-number":Z,"to-string":Z,typeof:Q,accumulated:null,"feature-state":null,"geometry-type":l,id:o,"line-progress":null,properties:u,at:I,get:E,has:R,in:V,"index-of":U,length:C,slice:k,"!":_,"!=":f,"<":d,"<=":y,"==":p,">":m,">=":g,all:v,any:b,case:w,coalesce:x,match:S,within:null,interpolate:P,"interpolate-hcl":P,"interpolate-lab":P,step:D,let:L,var:M,concat:W,downcase:j,"is-supported-script":null,"resolved-locale":null,upcase:j,rgb:Y,rgba:q,"to-rgba":K,"-":B,"*":O,"/":F,"%":N,"^":G,"+":H,abs:$,acos:$,asin:$,atan:$,ceil:$,cos:$,e:$,floor:$,ln:$,ln2:$,log10:$,log2:$,max:$,min:$,pi:$,round:$,sin:$,sqrt:$,tan:$,zoom:c,"heatmap-density":null,"has-id":A,none:T};e.ALL=v,e.ANY=b,e.Add=H,e.Assert=X,e.At=I,e.Calculate=$,e.Case=w,e.Coalesce=x,e.Coerce=Z,e.Concat=W,e.Div=F,e.EQ=p,e.GE=g,e.GT=m,e.GeomType=l,e.Get=E,e.Has=R,e.HasID=A,e.ID=o,e.In=V,e.IndexOf=U,e.Interpolate=P,e.LE=y,e.LT=d,e.Length=C,e.Let=L,e.Literal=J,e.Match=S,e.Mod=N,e.Mul=O,e.NE=f,e.NONE=T,e.NOT=_,e.Pow=G,e.Properties=u,e.Rgb=Y,e.Rgba=q,e.Slice=k,e.Step=D,e.String=j,e.Sub=B,e.ToRgba=K,e.TypeOf=Q,e.Var=M,e.Zoom=c,e.createExpression=ee,e.ops=te,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(e,t){"use strict";const i={kind:"null"},r={kind:"number"},n={kind:"string"},a={kind:"boolean"},s={kind:"color"},o={kind:"object"},l={kind:"value"};function u(e,t){return{kind:"array",itemType:e,n:t}}const c=[i,r,n,a,s,o,u(l)];e.arrayType=u,e.booleanType=a,e.colorType=s,e.getType=function e(c){if(null===c)return i;if("string"==typeof c)return n;if("boolean"==typeof c)return a;if("number"==typeof c)return r;if(c instanceof t)return s;if(Array.isArray(c)){let t;for(const i of c){const r=e(i);if(t){if(t!==r){t=l;break}}else t=r}return u(t||l,c.length)}return"object"==typeof c?o:l},e.matchType=function e(t,i){if("array"===i.kind)return"array"===t.kind&&(0===t.n&&"value"===t.itemType.kind||e(t.itemType,i.itemType))&&("number"!=typeof i.n||i.n===t.n);if("value"===i.kind)for(const i of c)if(e(t,i))return!0;return i.kind===t.kind},e.nullType=i,e.numberType=r,e.objectType=o,e.stringType=n,e.typeToString=function e(t){if("array"===t.kind){const i=e(t.itemType);return"number"==typeof t.n?`array<${i}, ${t.n}>`:"value"===t.itemType.kind?"array":`array<${i}>`}return t.kind},e.valueToString=function(e){if(null===e)return"";const i=typeof e;return"string"===i?e:"number"===i||"boolean"===i?String(e):e instanceof t?e.toString():JSON.stringify(e)},e.valueType=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports"],function(e){"use strict";class t{static{this.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}}}static{this.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}}}static{this.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}}}static{this.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[0]}}}static{this.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}}}static{this.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}}}static{this.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}}}static{this.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}}}static{this.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:0}}}static{this.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}}}static{this.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:0}}}}e.StyleDefinition=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../../../../../colorUtils","../GeometryUtils","../expression/expression","../expression/types"],function(e,t,i,r,n){"use strict";class a{constructor(e,t){let i;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case"number":case"color":i=!0;break;case"array":i="number"===e.value;break;default:i=!1}if((null==t||""===t&&"color"===e.type)&&(t=e.default),Array.isArray(t)&&t.length>0&&r.ops[t[0]]){const i={number:n.numberType,color:n.colorType,string:n.stringType,boolean:n.booleanType,enum:n.stringType};try{const a="array"===e.type?n.arrayType(i[e.value]||n.valueType,e.length):i[e.type],s=r.createExpression(t,null,a);this.getValue=this._buildExpression(s,e),this.isDataDriven=!0,s instanceof r.Interpolate&&s.input instanceof r.Zoom&&(this.interpolator=s)}catch(t){console.log(t.message),this.getValue=this._buildSimple(e.default)}return}i&&"interval"===t.type&&(i=!1);const a=t?.stops&&t.stops.length>0;if(a)for(const i of t.stops)i[1]=this._validate(i[1],e);if(this.isDataDriven=!!t&&!!t.property,this.isDataDriven)if(void 0!==t.default&&(t.default=this._validate(t.default,e)),a)switch(t.type){case"identity":this.getValue=this._buildIdentity(t,e);break;case"categorical":this.getValue=this._buildCategorical(t,e);break;default:this.getValue=i?this._buildInterpolate(t,e):this._buildInterval(t,e)}else this.getValue=this._buildIdentity(t,e);else a?this.getValue=i?this._buildZoomInterpolate(t):this._buildZoomInterval(t):(t=this._validate(t,e),this.getValue=this._buildSimple(t))}_validate(e,t){if("number"===t.type){if(null!=t.minimum&&e<t.minimum)return t.minimum;if(null!=t.maximum&&e>t.maximum)return t.maximum}else"color"===t.type?e=a._parseColor(e):"enum"===t.type?"string"==typeof e&&(e=t.values.indexOf(e)):"array"===t.type&&"enum"===t.value?e=e.map(e=>"string"==typeof e?t.values.indexOf(e):e):"string"===t.type&&(e=n.valueToString(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,t){return(i,r)=>{try{const n=e.evaluate(r,i);return void 0===n?t.default:this._validate(n,t)}catch(e){return console.log(e.message),t.default}}}_buildIdentity(e,t){return(i,r)=>{let n;return r&&(n=r.values[e.property]),void 0!==n&&(n=this._validate(n,t)),null!=n?n:void 0!==e.default?e.default:t.default}}_buildCategorical(e,t){return(i,r)=>{let n;return r&&(n=r.values[e.property]),n=this._categorical(n,e.stops),void 0!==n?n:void 0!==e.default?e.default:t.default}}_buildInterval(e,t){return(i,r)=>{let n;return r&&(n=r.values[e.property]),"number"==typeof n?this._interval(n,e.stops):void 0!==e.default?e.default:t.default}}_buildInterpolate(e,t){return(i,r)=>{let n;return r&&(n=r.values[e.property]),"number"==typeof n?this._interpolate(n,e.stops,e.base||1):void 0!==e.default?e.default:t.default}}_buildZoomInterpolate(e){return t=>this._interpolate(t,e.stops,e.base||1)}_buildZoomInterval(e){return t=>this._interval(t,e.stops)}_categorical(e,t){const i=t.length;for(let r=0;r<i;r++)if(t[r][0]===e)return t[r][1]}_interval(e,t){const i=t.length;let r=0;for(let n=0;n<i&&t[n][0]<=e;n++)r=n;return t[r][1]}_interpolate(e,t,r){let n,a;const s=t.length;for(let i=0;i<s;i++){const r=t[i];if(!(r[0]<=e)){a=r;break}n=r}if(n&&a){const t=a[0]-n[0],s=e-n[0],o=1===r?s/t:(r**s-1)/(r**t-1);if(Array.isArray(n[1])){const e=n[1],t=a[1],r=[];for(let n=0;n<e.length;n++)r.push(i.interpolate(e[n],t[n],o));return r}return i.interpolate(n[1],a[1],o)}return n?n[1]:a?a[1]:void 0}static _isEmpty(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}static _parseColor(i){return Array.isArray(i)?i:"string"==typeof i?t.parseToUnitRgba(i)??void 0:i instanceof e&&!this._isEmpty(i)?e.toUnitRGBA(i):void 0}}return a})},"*noref":1}}),define(["../../../chunks/tslib.es6","../../../core/Error","../../../core/has","../../../core/maybe","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../2d/engine/vectorTiles/SchemaHelper","../../2d/engine/vectorTiles/TileHandler3D","../../2d/engine/vectorTiles/VTLPainter3D","../../2d/engine/vectorTiles/style/StyleRepository","./LayerView3D","./TiledLayerView3D","../terrain/terrainUtils","../../layers/LayerView"],function(e,t,i,r,n,a,s,o,l,u,c,h,p,f,d,y,m,g){"use strict";let _=class extends(y.TiledLayerView3D(d.LayerView3D(g))){constructor(){super(...arguments),this._tileHandlerController=null,this.type="vector-tile-3d",this.levelShift=i("disable-feature:vtl-level-shift")?0:1}initialize(){if(null==this.layer.fullExtent)return void this.addResolvingPromise(Promise.reject(new t("vectortilelayerview:full-extent-undefined","This layer view's layer does not define a fullExtent.")));const{basemapTerrain:e,spatialReference:i,state:r,viewingMode:s}=this.view,o="local"===s&&!m.vtlAssumes256PixelSizeAsDefault(i)||m.test.force512VTL?this.layer.tileInfo:this.layer.tileInfo.getCompatibleForVTL(256),l=this._getTileInfoSupportError(o,this.layer.fullExtent);if(null!=l)return this.addResolvingPromise(Promise.reject(l));const u=a.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const t=e.tilingScheme,i=t.pixelSize,r=256===i?1:2,n=e.spatialReference?.isGeographic&&256===i?1:0,a=e.spatialReference?.isGeographic||256!==i?0:1;let s;this.schemaHelper=new c.SchemaHelper(r,n,this.levelShift+a),s=256===i||512===i?this.layer.tileInfo.getCompatibleForVTL(i):this.layer.tileInfo;const o=this._getTileInfoCompatibilityError(s,t);if(o)throw o;this.tileInfo=s});this._tileHandlerController=new AbortController;const d=this.view.resourceController;this._memCache=d.memoryController.newCache(`vtl-${this.layer.uid}`,e=>e.release()),this.addHandles(a.watch(()=>this.view.qualitySettings.memoryLimit,e=>this._memCache.maxSize=Math.ceil(e/10*1048576),a.syncAndInitial));const y=new f(this.layer.currentStyleInfo.style);this._tileHandler=new h(this.layer,y,r.contentPixelRatio,this._memCache);const g=this._tileHandlerController.signal,_=function(e){return t=>e.immediate.schedule(t)}(d),v=this._tileHandler.start({signal:g,schedule:_}),b=this._tileHandler.spriteMosaic;b.then(e=>{!n.isAborted(g)&&this._tileHandler&&(this.painter=new p(e,this._tileHandler.glyphMosaic))}),v.then(()=>this._tileHandlerController=null);const T=()=>{this._tileHandlerController&&this._tileHandlerController.abort(),this._tileHandlerController=new AbortController,this._memCache.clear();const e=this.layer.currentStyleInfo.style,t=this.view.state?.contentPixelRatio??1,i=new f(e),r=new h(this.layer,i,t,this._memCache),n=r.start({signal:this._tileHandlerController.signal,schedule:_}),a=r.spriteMosaic;n.then(()=>this._tileHandlerController=null),this._updatingHandles.addPromise(Promise.all([n,a]).then(([,e])=>{const t=this._tileHandler,i=this.painter;this.painter=new p(e,r.glyphMosaic),this._tileHandler=r,this.emit("data-changed"),t.destroy(),i&&i.dispose()}))};this._updatingHandles.add(()=>({style:this.layer.currentStyleInfo.style,pixelRatio:this.view.state?.contentPixelRatio}),T),this.addHandles([this.layer.on("paint-change",()=>this.emit("data-changed")),this.layer.on("style-layer-change",T),this.layer.on("delete-style-layer",T),this.layer.on("spriteSource-change",()=>this.emit("data-changed")),this.layer.on("layout-change",()=>this.emit("data-changed")),this.layer.on("style-layer-visibility-change",()=>this.emit("data-changed"))]);const w=Promise.all([u,v,b]);this.addResolvingPromise(w)}destroy(){this.painter=r.disposeMaybe(this.painter),this._tileHandlerController=r.abortMaybe(this._tileHandlerController),this._tileHandler=r.destroyMaybe(this._tileHandler),this._memCache=r.destroyMaybe(this._memCache)}get contentZoom(){return i("disable-feature:vtl-level-shift")?1:this.view.qualitySettings.tiledSurface.vtlContentZoom}get displayLevelRange(){const e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,i=this.layer.maxScale||e[e.length-1].scale,r=this.levelRangeFromScaleRange(t,i);return this.layer.maxScale?r.maxLevel++:r.maxLevel+=this.levelShift,r}get dataScaleRange(){const e=this.tileInfo.lods;return{minScale:e[0].scale,maxScale:e[e.length-1].scale}}get dataLevelRange(){const{minScale:e,maxScale:t}=this.dataScaleRange,i=this.levelRangeFromScaleRange(e,t);return 1===i.minLevel&&256===this.tileInfo.size[0]&&(i.minLevel=0),i.maxLevel+=this.levelShift,i}async fetchTile(e,t){const i=this.schemaHelper.getLevelRowColumn(e);return this._tileHandler.getVectorTile(i,t)}get hasVisibleFeatures(){return!0}};return e.__decorate([s.property()],_.prototype,"layer",void 0),e.__decorate([s.property()],_.prototype,"levelShift",void 0),e.__decorate([s.property()],_.prototype,"contentZoom",null),e.__decorate([s.property()],_.prototype,"displayLevelRange",null),e.__decorate([s.property()],_.prototype,"tileInfo",void 0),e.__decorate([s.property()],_.prototype,"dataScaleRange",null),e.__decorate([s.property()],_.prototype,"dataLevelRange",null),e.__decorate([s.property()],_.prototype,"updatingProgressValue",void 0),_=e.__decorate([u.subclass("esri.views.3d.layers.VectorTileLayerView3D")],_),_});