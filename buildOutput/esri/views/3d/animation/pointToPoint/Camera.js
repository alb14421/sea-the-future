// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../support/mathUtils"],function(t,e,i,s,a,c,o){"use strict";const n=c.create(),r=c.create(),h=c.create(),_=c.create(),l=c.create(),p=c.create(),d=c.UNIT_Z,m=c.UNIT_Y,f=c.UNIT_X,M=s.create();t.Camera=class{get pitch(){return this._pitch}get yaw(){return this._yaw}get distance(){return this._distance}get fov(){return this._fov}get size(){return this._size}constructor(t){this.viewingMode=t,this.center=c.create(),this._pitch=0,this._yaw=0,this._distance=0,this.direction=c.clone(m),this._fov=55,this._size=1}pixelsPerPanAtZoom(t){return this._size/2/(this._zoomToPanScale*t)}zoomAtPixelsPerPan(t){return this._size/2/(this._zoomToPanScale*t)}pixelsPerRotate(){const t=Math.max(Math.cos(Math.abs(this._pitch)),.5);return this._size/2/t}compareTo(t,e){if(1===this.viewingMode){const i=(a.length(this.center)+a.length(t.center))/2;e.pan=o.angle(this.center,t.center)*i}else e.pan=a.distance(this.center,t.center);let i=Math.abs(t._yaw-this._yaw);i>=Math.PI&&(i=2*Math.PI-i);const s=Math.abs(t._pitch-this._pitch);e.rotate=Math.max(i,s),e.fov=t.fov-this.fov,e.sourceZoom=this._distance,e.targetZoom=t._distance}interpolate(t,i,s){1===this.viewingMode?o.slerp(t.center,i.center,s.pan,this.center):a.lerp(this.center,t.center,i.center,s.pan),this._distance=isFinite(i.distance)?e.lerp(t.distance,i.distance+s.zoomOffset,s.zoom):t.distance,this._pitch=e.lerp(t.pitch,i.pitch,s.rotate);let c=t._yaw;const n=i._yaw;Math.abs(n-c)>=Math.PI&&(c+=2*(c<n?1:-1)*Math.PI),this._yaw=e.lerp(c,n,s.rotate),this._fov=e.lerp(t.fov,i.fov,s.fov)}copyFrom(t){a.copy(this.center,t.center),this._pitch=t.pitch,this._yaw=t.yaw,this._distance=t.distance,a.copy(this.direction,t.direction),this._size=t.size,this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov),this.viewingMode=t.viewingMode}copyFromRenderCamera(t){const e=this._lookAtOrientation(t.center,M);var i;a.copy(this.center,t.center),a.subtract(_,t.center,t.eye),a.transformMat3(_,_,e),a.transformMat3(l,t.up,e),this._distance=a.length(_),0!==this._distance&&(_[0]/=this._distance,_[1]/=this._distance,_[2]/=this._distance),this._pitch=(i=_,Math.PI-o.angle(d,i)),this._yaw=function(t,e){const i=p;return Math.abs(e[2])<.5?(a.copy(i,e),t[2]>0&&a.scale(i,i,-1)):a.copy(i,t),a.cross(r,i,d),a.normalize(r,r),o.angle(f,r,d)}(_,l),this._size=Math.sqrt(t.width*t.width+t.height*t.height),this._fov=t.fov,this._zoomToPanScale=Math.atan(.5*this._fov)}copyToRenderCamera(t){const e=this._lookAtOrientation(this.center,M);i.transpose(e,e),this._axisAngleVec3(f,this._pitch-Math.PI/2,m,_),this._axisAngleVec3(d,this._yaw,_,_),this._axisAngleVec3(f,this._pitch-Math.PI/2,d,l),this._axisAngleVec3(d,this._yaw,l,l),a.scale(_,_,this._distance),a.transformMat3(_,_,e),a.transformMat3(l,l,e),t.center=this.center,t.eye=a.subtract(_,this.center,_),t.up=l,t.fov=this._fov}_axisAngleVec3(t,e,i,s){const c=Math.cos(e),o=Math.sin(e);return a.scale(n,i,c),a.cross(r,t,i),a.scale(r,r,o),a.scale(h,t,(1-c)*a.dot(t,i)),a.add(s,a.add(s,n,r),h)}_lookAtOrientation(t,e=s.create()){return this._upAtLookAt(t,h),a.cross(n,this.direction,h),a.normalize(n,n),0===n[0]&&0===n[1]&&0===n[2]&&a.copy(n,f),a.cross(r,h,n),a.normalize(r,r),e[0]=n[0],e[1]=r[0],e[2]=h[0],e[3]=n[1],e[4]=r[1],e[5]=h[1],e[6]=n[2],e[7]=r[2],e[8]=h[2],e}_upAtLookAt(t,e){return 2===this.viewingMode?a.copy(e,d):a.normalize(e,t)}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});