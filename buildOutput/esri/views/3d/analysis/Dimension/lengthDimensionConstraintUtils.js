// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/has","../../../../chunks/vec32","../../../../geometry/Point","../../../../geometry/support/vectorStacks","./lengthDimensionManipulatorUtils","./lengthDimensionUtils","./settings"],function(e,n,t,i,o,r,a,s){"use strict";function l(e,n,t){const{constraint:i,elevationAlignedStartPoint:o,elevationAlignedEndPoint:a,unconstrainedGeometry:s,view:l}=t,{dimension:d,previousConstraint:c,preConstraintProperties:u}=e;if(null==o||null==a)return;const P=()=>{"startPoint"in n?d.startPoint=n.startPoint:"endPoint"in n&&(d.endPoint=n.endPoint)};if(null==i)P(),null!=c&&null!=u&&(d.measureType=u.measureType,d.orientation=u.orientation);else switch(d.measureType="direct",i){case 0:if(i!==c&&(d.orientation=0),"startPoint"in n){const e=n.startPoint;null!=e&&(e.z=a.z),d.startPoint=e}else if("endPoint"in n){const e=n.endPoint;null!=e&&(e.z=o.z),d.endPoint=e}break;case 1:if(i!==c&&(d.orientation=r.automaticHeadingFromCamera(s,l)),"startPoint"in n){const e=n.startPoint;null!=e&&(e.x=a.x,e.y=a.y),d.startPoint=e}else if("endPoint"in n){const e=n.endPoint;null!=e&&(e.x=o.x,e.y=o.y),d.endPoint=e}break;case 2:i!==c&&null!=u&&(d.orientation=u.orientation),P()}e.previousConstraint=i,e.unconstrainedGeometry=s}e.applyConstraint=l,e.computeConstraint=function(e,n){if(a.isGeodesicDimension(e))return 2;if(!e.enabled)return null;const{geometry:i}=e;if(null==i||t.exactEquals(i.directSegment.startRenderSpace,i.directSegment.endRenderSpace))return null;const{camera:r}=n.state,l=a.directUp(o.sv3d.get(),i,n.renderCoordsHelper),d=a.directStartToEnd(o.sv3d.get(),i),c=t.scale(o.sv3d.get(),l,t.dot(d,l)),u=t.subtract(o.sv3d.get(),d,c),P=t.squaredLength(u),p=t.squaredLength(c),{startRenderSpace:g,endRenderSpace:m}=i.directSegment,f=Math.max(r.computeScreenPixelSizeAt(g)*s.constraintThresholdPx,r.computeScreenPixelSizeAt(m)*s.constraintThresholdPx)**2;return P<f?1:p<f?0:null},e.constraintDependencies=function(e,n){return{enabled:n.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}},e.reapplyConstraint=function(e,n,{constraint:t,view:o}){const{unconstrainedGeometry:r}=e;if(null==r)return;const{renderCoordsHelper:a,spatialReference:s}=o,{startRenderSpace:d,endRenderSpace:c}=r.directSegment,u=a.fromRenderCoords(d,new i({spatialReference:s})),P=a.fromRenderCoords(c,new i({spatialReference:s}));let p;p="start"===n?{startPoint:u}:{endPoint:P},l(e,p,{constraint:t,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:r,view:o})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});