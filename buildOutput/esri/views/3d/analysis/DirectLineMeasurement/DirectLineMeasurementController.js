// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Logger","../../../../core/quantityUtils","../../../../core/reactiveUtils","../../../../core/unitUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../support/projectionUtils","../../../support/euclideanLengthMeasurementUtils"],function(e,t,n,i,r,o,a,l,s,c,u,d,p){"use strict";e.DirectLineMeasurementController=class extends n{constructor(e){super(e)}initialize(){this.addHandles([o.watch(()=>({viewData:this.viewData,startPoint:this.analysis.startPoint}),({viewData:e,startPoint:t})=>{e.elevationAlignedStartPoint=this._applyProjectionAndElevationAlignment(t)},o.syncAndInitial),o.watch(()=>({viewData:this.viewData,endPoint:this.analysis.endPoint}),({viewData:e,endPoint:t})=>{e.elevationAlignedEndPoint=this._applyProjectionAndElevationAlignment(t)},o.syncAndInitial),o.watch(()=>({result:this._computedResult,viewData:this.viewData}),({result:e,viewData:t})=>{t.result=e},o.syncAndInitial)])}_applyProjectionAndElevationAlignment(e){if(null==e)return e;const{spatialReference:t,elevationProvider:n}=this.view;return d.applyProjectionAndElevationAlignment(e,t,n)??(d.logFailedGeometryProjectionError(this.analysis,e.spatialReference,i.getLogger(this)),null)}get _computedResult(){const{elevationAlignedStartPoint:e,elevationAlignedEndPoint:t,measurementMode:n,unit:i}=this.viewData;if(null==e||null==t)return null;const o=p.euclideanDistanceBetweenPoints(e,t),l=this.geodesicLengthMeasurementUtils.geodesicDistanceBetweenPoints(e,t);if(null==o)return null;let s,c;switch(n){case 0:c=null!=l?"geodesic":"euclidean",s=l??o.horizontal;break;case 2:if(null==l)return null;c="geodesic",s=l;break;case 1:c="euclidean",s=o.horizontal}let u=o.direct,d=o.vertical;const v=a.adaptiveLengthUnit(u.value,u.unit,i),y=a.adaptiveLengthUnit(s.value,s.unit,i),h=a.adaptiveVerticalLengthUnit(d.value,d.unit,i);return u=r.toUnit(u,v),s=r.toUnit(s,y),d=r.toUnit(d,h),{mode:c,directDistance:u,horizontalDistance:s,verticalDistance:d}}},t.__decorate([l.property({constructOnly:!0})],e.DirectLineMeasurementController.prototype,"view",void 0),t.__decorate([l.property({constructOnly:!0})],e.DirectLineMeasurementController.prototype,"analysis",void 0),t.__decorate([l.property({constructOnly:!0})],e.DirectLineMeasurementController.prototype,"viewData",void 0),t.__decorate([l.property({constructOnly:!0})],e.DirectLineMeasurementController.prototype,"geodesicLengthMeasurementUtils",void 0),t.__decorate([l.property()],e.DirectLineMeasurementController.prototype,"_computedResult",null),e.DirectLineMeasurementController=t.__decorate([u.subclass("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementController")],e.DirectLineMeasurementController),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});