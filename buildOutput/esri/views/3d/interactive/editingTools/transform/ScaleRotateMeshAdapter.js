// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/mathUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/support/axisAngleDegrees","../manipulatedObjectUtils"],function(e,t,r,a,o,n,s,i,l,c,p,d){"use strict";e.ScaleRotateMeshAdapter=class extends r{constructor(e){super(e),this._interactionState=null}initialize(){this.addHandles([o.when(()=>{const e=this._interactionState;return e&&e.angle!==e.previousAngle?{interactionState:e,angle:e.state.angle}:null},({interactionState:e})=>{this._updateMeshRotation(e)},o.sync),o.when(()=>{const e=this._interactionState;return e&&e.scale!==e.previousScale?{interactionState:e,scale:e.state.scale}:null},({interactionState:e})=>{this._updateMeshSize(e)},o.sync)])}get geometry(){const e=d.manipulatedObjectGeometry(this.object);return"mesh"===e?.type?e:null}get initialAngle(){return this._interactionState?.initialAngle??0}get angle(){const e=this.geometry?.transform;if(null==e)return this._interactionState?.angle??0;const t=p.axis(e.rotation)[2];return Math.abs(t)>.999999?a.deg2rad(p.angle(e.rotation))*Math.sign(t):0}get angleClockwise(){return-this.angle}get relativeAngle(){return this.angle-this.initialAngle}get relativeAngleClockwise(){return-this.relativeAngle}get scale(){return this._interactionState?.scale??1}startInteraction(){const e=new g({angle:this.angle});this._interactionState=e;const t=()=>{this._interactionState=null};return{state:e,done:t,cancel:()=>{e.cancel(),t()}}}createUndoRecord(){return this.object.createUndoRecord()}_updateMeshRotation(e){const{geometry:t}=this;if(null==t)return;const{angle:r,previousAngle:o}=e;e.previousAngle=r;const n=a.rad2deg(r-o);t.rotate(0,0,n)}_updateMeshSize(e){const{geometry:t}=this;if(null==t)return;const{scale:r,previousScale:a}=e;e.previousScale=r;const o=r/a;t.scale(o)}},t.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"object",void 0),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"geometry",null),t.__decorate([n.property({constructOnly:!0})],e.ScaleRotateMeshAdapter.prototype,"viewingMode",void 0),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"initialAngle",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"angle",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"angleClockwise",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngle",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"relativeAngleClockwise",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"scale",null),t.__decorate([n.property()],e.ScaleRotateMeshAdapter.prototype,"_interactionState",void 0),e.ScaleRotateMeshAdapter=t.__decorate([c.subclass("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter")],e.ScaleRotateMeshAdapter);let g=class extends r{get state(){const{angle:e,scale:t}=this;return{angle:e,scale:t}}constructor(e){super(e),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=e.angle,this.previousAngle=e.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};t.__decorate([n.property()],g.prototype,"angle",void 0),t.__decorate([n.property()],g.prototype,"initialAngle",void 0),t.__decorate([n.property()],g.prototype,"previousAngle",void 0),t.__decorate([n.property()],g.prototype,"previousScale",void 0),t.__decorate([n.property()],g.prototype,"scale",void 0),t.__decorate([n.property()],g.prototype,"state",null),g=t.__decorate([c.subclass("esri.views.3d.interactive.editingTools.transform.ScaleRotateMeshAdapter.InteractionState")],g),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});