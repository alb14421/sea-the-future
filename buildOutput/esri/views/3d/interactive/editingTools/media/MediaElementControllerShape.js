// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/handleUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/support/UpdatingHandles","../../../../../geometry/projectionUtils","../../../../interactive/editGeometry/EditGeometryOperations"],function(e,t,o,r,n,i,a,s,d,l,p,c,h){"use strict";e.MediaElementControllerShape=class extends o{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}constructor(e){super(e),this._updatingHandles=new p.UpdatingHandles}initialize(){this.addHandles([r.destroyHandle(this._updatingHandles),this._updatingHandles.add(()=>this.element.georeference?.coords,e=>this._elementCoordinatesChanged(e),n.initial)])}_elementCoordinatesChanged(e){this._updatedElementCoordinates!==e&&this._updatingHandles.addPromise(this._whenProjected(e,this.view.spatialReference,e=>{if(!e)return void this._replaceOperations(null);const{_operations:t}=this;t?.trySetGeometry(e)?this.onModifiedExternally():this._replaceOperations(h.EditGeometryOperations.fromGeometry(e,this.view.state.viewingMode))}))}_operationsGeometryChanged(){const{element:{georeference:e},_operations:t}=this;if(!t||!e)return;const o=t.data.geometry;if(!e.coords)return void this._updateElementCoordinates(o);const r=e.coords.spatialReference;this._updatingHandles.addPromise(this._whenProjected(o,r,e=>this._updateElementCoordinates(e)))}_updateElementCoordinates(e){const{georeference:t}=this.element;t&&(t.coords=e,this._updatedElementCoordinates=t.coords)}async _whenProjected(e,t,o){if(!e)return void o(e);const{_operations:r,element:{georeference:n}}=this,i=await c.projectWithZConversion(e,t);r===this._operations&&n===this.element.georeference&&o(i)}_replaceOperations(e){this._operations&&(this.removeHandles(this._operations),this._operations.destroy()),this._operations=e,e&&this.addHandles(e.data.on("change",()=>this._operationsGeometryChanged()),e),this.onModifiedExternally()}},t.__decorate([i.property({constructOnly:!0})],e.MediaElementControllerShape.prototype,"view",void 0),t.__decorate([i.property({constructOnly:!0})],e.MediaElementControllerShape.prototype,"layer",void 0),t.__decorate([i.property({constructOnly:!0})],e.MediaElementControllerShape.prototype,"element",void 0),t.__decorate([i.property({constructOnly:!0})],e.MediaElementControllerShape.prototype,"onModifiedExternally",void 0),t.__decorate([i.property()],e.MediaElementControllerShape.prototype,"_operations",void 0),t.__decorate([i.property()],e.MediaElementControllerShape.prototype,"operations",null),t.__decorate([i.property()],e.MediaElementControllerShape.prototype,"updating",null),e.MediaElementControllerShape=t.__decorate([l.subclass("esri.views.3d.interactive.editingTools.media.MediaElementControllerShape")],e.MediaElementControllerShape),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});