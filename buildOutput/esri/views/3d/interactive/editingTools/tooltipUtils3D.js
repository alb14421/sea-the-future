// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/handleUtils","../../../../core/quantityUtils","../../../../core/reactiveUtils","./manipulatedObjectUtils","../../../interactive/tooltip/tooltipCommonUtils","../../../support/euclideanLengthMeasurementUtils"],function(t,e,o,n,i,a,r){"use strict";function s(t,{activeTooltipInfo:e,callbacks:o}){if(!e)return;o.onBeforeUpdate();const n=i.manipulatedObjectGeometry(t);switch(n?.type){case"mesh":l(e,n.origin,t,o),"orientation"in e&&"scale"in e&&a.updateMeshTransformFromTooltipInfo(e,n,o);break;case"point":l(e,n,t,o)}}function l(t,e,o,n){const{dx:i,dy:r,dz:s}=a.getXYZDeltasFromTooltipInfo(t,e);0===i&&0===r&&0===s||(n.onMoveStart(),o.operations?.move(i,r,s,0),n.onMove(i,r,s),n.onMoveStop())}function c(t,e){const o=i.manipulatedObjectGeometry(e),n=o?.type;if(!t||!o||"mesh"!==n&&"point"!==n)return;const r="mesh"===n,s=r?o.origin:o;t.setLocationFromPoint(s),u(t,s,e),"transform-mesh"===t.type&&r&&a.updateTooltipInfoFromMeshTransform(t,o),t.clearInputValues()}function u(t,e,o){t.elevation.actual=r.elevationFromPoint(e),t.elevation.visible=!!o.operations?.data.coordinateHelper.hasZ(),t.elevation.readOnly=!1,t.elevation.showAsZ=!0}function p(t){switch(t){case"integer":case"long":return 0;default:return null}}t.connectTooltipToManipulatedObject=function(t,r,l){function u(){const t=l(),e=t.sketchOptions.tooltips.effectiveEnabled?t.activeTooltipInfo:null;return{...t,activeTooltipInfo:e}}let f=!1;function d(t){f||(f=!0,t(),f=!1)}function m({activeTooltipInfo:e,sketchOptions:n,scaleRotateTransform:i}){d(()=>{e&&(e.sketchOptions=n,c(e,r),function(t,e){if("transform-point"!==t?.type)return;if(!e)return t.orientation.actual=void 0,t.size.actual=void 0,t.orientation.visible=!1,void(t.size.visible=!1);const n=e.mode,{size:i,orientationClockwise:a}=e.adapter,{visualVariables:r}=t.sketchOptions.tooltips,s=r?.rotation,l=null!=a&&(null==n||"rotate"===n);t.orientation.actual=l?o.createAngle(a,"radians","geographic"):void 0,t.orientation.precision=p(s?.valueType),t.orientation.visible=l;const c=r?.size,u=null!=i&&(null==n||"scale"===n);t.size.actual=u?o.createLength(i,c?.unit??"meters"):void 0,t.size.precision=p(c?.valueType),t.size.visible=u}(e,i)),t.info=e})}return e.handlesGroup([n.watch(u,m,n.syncAndInitial),n.watch(()=>{const t=u(),{activeTooltipInfo:e}=t;if(e)return{context:t,activeTooltipInfo:e,key:e.key,geometry:i.manipulatedObjectGeometry(r)}},(t,e)=>{t&&e&&e.key!==t.key&&d(()=>s(r,t.context))},n.sync),r.on("committed",()=>{queueMicrotask(()=>m(u()))}),a.connectPasteEvent(t,{onBeforePaste:()=>{f=!0},onAfterPaste:()=>{s(r,u()),f=!1}})])},t.updateElevationFromPoint=u,t.updateTooltipInfoFromManipulatedObject=c,t.updateXYZFromTooltipInfo=l,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});