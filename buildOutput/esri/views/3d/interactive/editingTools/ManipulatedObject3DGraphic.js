// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../core/Evented","../../../../core/maybe","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/support/UpdatingHandles","../../../../support/elevationInfoUtils","../manipulatorUtils","./undoRecords","../../layers/graphics/GraphicState","../../../interactive/GraphicManipulator","../../../interactive/editGeometry/EditGeometryOperations"],function(t,e,i,r,a,o,s,n,p,c,d,h,l,g,u,y,m){"use strict";const _=Symbol();t.ManipulatedObject3DGraphic=class extends i.EventedAccessor{get operations(){return this._operations}get updating(){return this._updatingHandles.updating}get elevationInfo(){return h.getGraphicEffectiveElevationInfo(this.graphic)}get visible(){return this._graphicState.displaying}get isDraped(){return this._graphicState.isDraped}get origin(){return l.getGraphicAttachmentOrigin(this.view,this.graphic)}constructor(t){super(t),this._updatingHandles=new d.UpdatingHandles}destroy(){this._operations=r.destroyMaybe(this._operations),this._updatingHandles.destroy()}initialize(){this._graphicState=new u.GraphicState({graphic:this.graphic}),this._graphicState.on("changed",()=>this.emit("committed")),this.addHandles(this.view.trackGraphicState(this._graphicState)),this.addHandles(this._updatingHandles.add(()=>this.graphic.geometry,t=>{const e=this._operations?.data.geometry;if(t!==e){if(!t||"multipoint"===t?.type||"extent"===t?.type)return r.destroyMaybe(this._operations),this.removeHandles(_),void(this._operations=null);if(this._operations?.trySetGeometry(t))this.emit("modified-externally");else{r.destroyMaybe(this._operations),this.removeHandles(_);const e=m.EditGeometryOperations.fromGeometry(t,this.view.state.viewingMode);this._operations=e,this.addHandles(e.data.on("change",()=>this.graphic.geometry=e.data.geometry),_)}}},a.syncAndInitial))}createManipulator(t){return new y.GraphicManipulator({view:this.view,graphic:this.graphic,...t})}maskOccludee(){return this.view.maskOccludee(this.graphic)}endInteraction(){const t=this.graphic.geometry;"mesh"===t?.type&&this.graphic.notifyMeshTransformChanged({action:2})}toMap(t){return this.view.toMap(t,{include:[this.graphic]})}createUndoRecord(){const{graphic:{geometry:t}}=this;return g.createGraphicGeometryUndoRecord(t)}},e.__decorate([o.property({constructOnly:!0})],t.ManipulatedObject3DGraphic.prototype,"view",void 0),e.__decorate([o.property({constructOnly:!0})],t.ManipulatedObject3DGraphic.prototype,"graphic",void 0),e.__decorate([o.property()],t.ManipulatedObject3DGraphic.prototype,"_operations",void 0),e.__decorate([o.property()],t.ManipulatedObject3DGraphic.prototype,"operations",null),e.__decorate([o.property()],t.ManipulatedObject3DGraphic.prototype,"updating",null),t.ManipulatedObject3DGraphic=e.__decorate([c.subclass("esri.views.3d.interactive.editingTools.ManipulatedObject3DGraphic")],t.ManipulatedObject3DGraphic),Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});