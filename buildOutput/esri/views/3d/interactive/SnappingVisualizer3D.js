// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../Color","../../../core/colorUtils","../../../core/has","../../../core/handleUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/projection/projectVectorToVector","../../../support/elevationInfoUtils","./support/viewUtils","./visualElements/ExtendedLineVisualElement","./visualElements/ParallelLineVisualElement","./visualElements/PointVisualElement","./visualElements/RightAngleQuadVisualElement","../../interactive/sketch/normalizedPoint","../../interactive/snapping/Settings","../../interactive/snapping/SnappingVisualizer","../../interactive/snapping/hints/LineSnappingHint"],function(e,n,i,t,o,l,r,a,s,d,c,u,p,g,f,h,v,m){"use strict";class E extends v.SnappingVisualizer{sortUniqueHints(e){return e.sort((e,n)=>(n instanceof m.LineSnappingHint?n.length:0)-(e instanceof m.LineSnappingHint?e.length:0))}visualizeIntersectionPoint(e,n){const{spatialReference:i,view:t}=n,l=C(n);return o.destroyHandle(new p.PointVisualElement({view:t,primitive:"circle",geometry:f.toDehydratedPoint(e.intersectionPoint,i),elevationInfo:e.isDraped?s.onTheGroundElevationInfo:s.absoluteHeightElevationInfo,size:20,outlineSize:2,color:l.intersectionPointColor,outlineColor:l.intersectionPointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizePoint(e,n){const{view:i,spatialReference:t}=n,l=C(n),r=w(e.point,e.domain,n);return o.destroyHandle(new p.PointVisualElement({view:i,primitive:"circle",geometry:f.toDehydratedPoint(r,t),elevationInfo:S(e),size:20,outlineSize:2,color:l.pointColor,outlineColor:l.pointOutlineColor,pixelSnappingEnabled:!1,isDecoration:!0,attached:!0}))}visualizeLine(e,n){const{view:i,spatialReference:t}=n,l=C(n),r=w(e.lineStart,e.domain,n),a=w(e.lineEnd,e.domain,n);return o.destroyHandle(function(e,n,i,t,o,l,r,a=!1,s=!0,d=!0){const u=H(n,t,o,l,a),p=H(i,t,o,l,a),g=new c.ExtendedLineVisualElement({view:l,extensionType:3,start:u,end:p,isDraped:a,color:r.lineColor,renderOccluded:a?4:16,renderGroup:3,isDecoration:!0});switch(e){case 0:g.width=h.defaults.lineHintWidthTarget,g.fadedExtensions={start:0,end:h.defaults.lineHintFadedExtensions};break;case 2:g.width=h.defaults.lineHintWidthReference,g.fadedExtensions={start:0,end:0};break;case 1:g.width=h.defaults.lineHintWidthReference,g.fadedExtensions={start:s?h.defaults.lineHintFadedExtensions:0,end:d?h.defaults.lineHintFadedExtensions:0}}return g.attached=!0,g}(e.type,r,a,t,S(e),i,l,e.isDraped,e.fadeLeft,e.fadeRight))}visualizeParallelSign(e,n){const{view:i,spatialReference:t}=n,r=C(n),{isDraped:a}=e,s=S(e),d=w(e.lineStart,e.domain,n),c=w(e.lineEnd,e.domain,n),p=H(d,t,s,i,a),g=H(c,t,s,i,a),f=l.lerp(g,p,g,.5),v=new u.ParallelLineVisualElement({view:i,attached:!1,offset:h.defaults.parallelLineHintOffset,length:h.defaults.parallelLineHintLength,width:h.defaults.parallelLineHintWidth,color:r.parallelSignColor,location:f,renderOccluded:a?4:16,isDraped:a,renderGroup:3,isDecoration:!0});return v.setDirectionFromPoints(p,f),v.attached=!0,o.destroyHandle(v)}visualizeRightAngleQuad(e,n){const{view:i,spatialReference:t}=n,l=C(n),r=S(e),{isDraped:a}=e,s=w(e.previousVertex,e.domain,n),d=w(e.centerVertex,e.domain,n),c=w(e.nextVertex,e.domain,n),u=H(s,t,r,i,a),p=H(d,t,r,i,a),f=H(c,t,r,i,a);return o.destroyHandle(new g.RightAngleQuadVisualElement({view:i,attached:!0,color:a?l.rightAngleColorDraped:l.rightAngleColor,renderOccluded:a?4:2,outlineRenderOccluded:a?4:16,outlineColor:l.rightAngleOutlineColor,outlineSize:h.defaults.rightAngleHintOutlineSize,size:h.defaults.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:p,next:f},renderGroup:3,isDecoration:!0}))}}function C(e){const{effectiveTheme:t}=e.view,o=n.toUnitRGBA(t.accentColor),l=[0,0,0,0];return{intersectionPointColor:l,intersectionPointOutlineColor:o,pointColor:l,pointOutlineColor:o,lineColor:o,lineOutlineColor:void 0,parallelSignColor:o,rightAngleColor:o,rightAngleColorDraped:n.toUnitRGBA(i.multiplyOpacity(t.accentColor,.5)),rightAngleOutlineColor:o}}function w(e,n,{selfSnappingZ:i,view:t,spatialReference:o}){return 2&n&&f.isTarget(e)&&null!=i?f.withSelfSnappingZ(e,i,t,o):e}function S(e){return e.isDraped?s.onTheGroundElevationInfo:s.absoluteHeightElevationInfo}function H(e,n,i,t,o){const l=r.create();if(o){const i=t.basemapTerrain.overlayManager.renderer.spatialReference;a.projectVectorToVector(e,n,l,i)}else d.vectorToRender(e,n,i,t,l);return l}e.SnappingVisualizer3D=E,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});