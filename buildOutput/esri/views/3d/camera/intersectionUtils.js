// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/ellipsoidUtils","../../../geometry/support/aaBoundingRect","../webgl/RenderCamera","../webgl-engine/lib/DepthRange","../webgl-engine/lib/Intersector"],function(e,t,n,r,i,o,a,s){"use strict";function c(e,t){return e.elevationProvider?e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground")??0:0}function l(e,n,r){if(!e.state.isGlobal||!e.stateManager.constraintsManager)return!1;const i=c(e,n),s=e.stateManager.constraintsManager.nearFarHeuristic;let l=p.get(e);void 0===l&&(l=new o,p.set(e,l)),l.eye=n,l.center=r;const{far:d}=s.compute(l,e.renderDataExtent,a.DepthRange.infinite,i),u=d*d;return t.squaredDistance(n,r)>u}let d={};const u=n.create(),g=n.create(),f=n.create(),p=new WeakMap;e.cameraOnContentAlongViewDirection=function(e,n,i,o){const a=e.state.camera.clone();n&&i&&o&&(a.eye=n,a.center=i,a.up=o),function(e,n,i){let o=d[e.viewingMode];o||(o=new s.Intersector(e.state.viewingMode),o.options.backfacesTerrain=!e.state.isGlobal,o.options.invisibleTerrain=!0,d[e.viewingMode]=o);const{isGlobal:a}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(n,o,i)||l(e,n.origin,i))||!(!e.renderCoordsHelper.intersectManifold(n,0,i)||l(e,n.origin,i))||!!a&&function(e,n,r){const i=t.dot(e.origin,e.origin)-r*r,o=i>0?Math.sqrt(i)/3:1;return t.scale(n,e.direction,o/t.length(e.direction)),t.add(n,n,e.origin),!0}(n,i,r.getReferenceEllipsoid(e.spatialReference).radius)}(e,a.ray,g)||t.copy(g,a.center);const c=e.state.constraints,p=c.minimumPoiDistance;if(t.squaredDistance(a.eye,g)<p){const n=c.collision.enabled;t.copy(f,a.viewForward),t.scale(f,f,p),n?a.eye=t.subtract(u,g,f):t.add(g,a.eye,f);const r=e.renderCoordsHelper,i=r.getAltitude(a.eye),o=c.collision.elevationMargin;n&&i<o&&(t.subtract(f,g,a.eye),a.eye=r.setAltitude(u,o,a.eye),t.add(g,a.eye,f))}return a.center=g,a},e.cleanupIntersectionUtils=function(){d={}},e.eyeWithinExtent=function(e,t,n,r){return null!=e.renderCoordsHelper.fromRenderCoords(t.eye,u,r)&&i.containsPoint(n,u)},e.surfaceElevationBelowRenderLocation=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});