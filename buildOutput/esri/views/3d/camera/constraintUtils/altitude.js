// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/ray","./common","../../support/intersectionUtils"],function(t,e,n,r,i,o,a){"use strict";function s(t,n,r=o.defaultConstraintOptions){if(!function(t,e){const n=t.state.constraints.altitude;return!(!t.state.isGlobal||!n||2===e.interactionType&&o.hasConstraintType(e.selection,1))}(t,r)||!t.state.constraints.altitude)return 0;const i=function(t,e){return e.min=t.min,e.max=t.max,e}(t.state.constraints.altitude,c);!function(t,e,n){const r=e.interactionType;if(0===r)return;const{min:i,max:a}=n,{interactionStartCamera:c,interactionFactor:u}=e;if(!c)return;const l=2===r||1===r,d=s(t,c),m=0===d?0:t.renderCoordsHelper.getAltitude(c.eye);n.min=i,n.max=a;const p=.05*m;o.adjustRangeForInteraction(d,m,l,u,p,n)}(t,r,i);const a=t.renderCoordsHelper.getAltitude(n.eye),u=e.clamp(a,i.min,i.max)-a;return Math.abs(u)<=1e-6?0:u}const c={min:0,max:0},u=r.create(),l=r.create(),d=r.create(),m=r.create();t.applyAltitudeConstraint=function(t,e,r=o.defaultConstraintOptions){const c=s(t,e,r);if(0===c)return!1;const p=t.renderCoordsHelper,f=p.getAltitude(e.eye)+c,y=o.interactionDirectionTowardsConstraintMinimization(e,r.interactionDirection,function(t,e,r,i){return t.renderCoordsHelper.worldUpAtPosition(e.eye,i),n.scale(i,i,r),i}(t,e,Math.sign(c),l),u),C=n.copy(d,e.viewForward),g=p.intersectInfiniteManifold(i.wrap(e.eye,y),f,m);return e.eye=null!=g?g:p.setAltitude(m,f,e.eye),e.center=a.closestPointOnRay(m,e.eye,C,e.center),!0},t.getAltitudeConstraintError=s,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});