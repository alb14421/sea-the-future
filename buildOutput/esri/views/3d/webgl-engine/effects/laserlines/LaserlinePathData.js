// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../../geometry/support/DoubleArray","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../../lib/VertexArrayObject","../../../../webgl/enums","../../../../webgl/VertexBuffer"],function(e,t,r,s,i,o,n,u,f){"use strict";function a(e){return 2*(e.length/3-1)*3}const c=r.create(),l=r.create(),h=o.newLayout().vec3f("start").vec3f("end").vec2f("extrude").vec3f("startUp").vec3f("endUp"),d=o.newLayout().vec3f("start").vec3f("end").vec2f("extrude");e.LaserlinePathData=class{constructor(e){this._renderCoordsHelper=e,this._origin=r.create(),this._dirty=!1,this._count=0}set vertices(e){const t=s.newDoubleArray(3*e.length);let r=0;for(const s of e)t[r++]=s[0],t[r++]=s[1],t[r++]=s[2];this.buffers=[t]}set buffers(e){if(this._buffers=e,this._buffers.length>0){const e=this._buffers[0],r=3*Math.floor(e.length/3/2);t.set(this._origin,e[r],e[r+1],e[r+2])}else t.set(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(e){const t=this._ensureVAO(e);null!=t&&(e.bindVAO(t),e.drawArrays(u.PrimitiveType.TRIANGLES,0,this._count))}dispose(){null!=this._vao&&this._vao.dispose()}get _layout(){return 1===this._renderCoordsHelper.viewingMode?h:d}_ensureVAO(e){return null==this._buffers?null:(this._vao??=this._createVAO(e,this._buffers),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(e,t){const r=this._createDataBuffer(t);return this._dirty=!1,new n.VertexArrayObject(e,new f.VertexBuffer(e,i.glLayout(this._layout),r))}_ensureVertexData(e,t){if(!this._dirty)return;const r=this._createDataBuffer(t);e.buffer()?.setData(r),this._dirty=!1}_createDataBuffer(e){const r=e.reduce((e,t)=>e+a(t),0);this._count=r;const s=this._layout.createBuffer(r),i=this._origin;let o=0,n=0;const u="startUp"in s?this._setUpVectors.bind(this,s):void 0;for(const r of e){for(let e=0;e<r.length;e+=3){const f=t.set(l,r[e],r[e+1],r[e+2]);0===e?n=this._renderCoordsHelper.getAltitude(f):this._renderCoordsHelper.setAltitude(f,n);const a=o+2*e;u?.(e,a,r,f);const c=t.subtract(l,f,i);if(e<r.length-3){for(let e=0;e<6;e++)s.start.setVec(a+e,c);s.extrude.setValues(a,0,-1),s.extrude.setValues(a+1,1,-1),s.extrude.setValues(a+2,1,1),s.extrude.setValues(a+3,0,-1),s.extrude.setValues(a+4,1,1),s.extrude.setValues(a+5,0,1)}if(e>0)for(let e=-6;e<0;e++)s.end.setVec(a+e,c)}o+=a(r)}return s.buffer}_setUpVectors(e,t,r,s,i){const o=this._renderCoordsHelper.worldUpAtPosition(i,c);if(t<s.length-3)for(let t=0;t<6;t++)e.startUp.setVec(r+t,o);if(t>0)for(let t=-6;t<0;t++)e.endUp.setVec(r+t,o)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});