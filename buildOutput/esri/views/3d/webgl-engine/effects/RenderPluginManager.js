// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/arrayUtils","../../../../core/has","../../../../core/promiseUtils","../../../../core/signal","../lib/DepthRange"],function(e,t,r,n,s,i){"use strict";const o=[2,4,18,13,14];e.RenderPluginManager=class{constructor(e){this.context=e,this._renderPlugins=new Array,this._slots=new Array,this._version=s.signal(0);for(let e=0;e<21;++e)this._slots[e]=[]}destroy(){this._renderPlugins.forEach(e=>e.destroy()),this._renderPlugins.length=0}get plugins(){return this._renderPlugins}add(e,t){const r=()=>{if(t?.aborted)throw e.uninitializeRenderContext(),n.createAbortError();this._renderPlugins.push(e),e.produces.forEach((t,r)=>this._slots[r].push(e)),this.context.requestRender(),this._version.value++},s=e.initializeRenderContext(this.context,t);if(n.isPromiseLike(s))return s.then(r);r()}remove(e){t.removeUnordered(this._renderPlugins,e),e.uninitializeRenderContext();for(let t=0;t<this._slots.length;++t)this._slots[t]=this._slots[t].filter(t=>t!==e);this.context.requestRender(),this._version.value++}prepareRender(){this._renderPlugins.forEach(e=>{e.prepareRender&&e.prepareRender(this.context.renderContext)})}updateAnimation(e){let t=!1;return this._renderPlugins.forEach(r=>t=r.updateAnimation?.(e)||t),t}precompile(...e){++this.context.techniques.precompiling;const t=this.context.renderContext.bind.slot;for(const t of e)this.context.renderContext.bind.slot=t,this._forEachRender(()=>{});this.context.renderContext.bind.slot=t,--this.context.techniques.precompiling}render(...e){for(const t of e)this.context.renderContext.bind.slot=t,this._forEachRender((e,t)=>e.render(this.context.renderContext,t))}_forEachRender(e){const t=this.context.renderContext.bind.slot,r=this.context.renderContext.output;this._slots[t].forEach(n=>{const s=n.produces.get(t);if(!s?.(r)||n.isDecoration&&!this.context.renderContext.bind.decorations)return;const i=n.acquireTechniques(this.context.renderContext);i&&e(n,i)})}queryDepthRange(e){const t=new i.DepthRange;return this._renderPlugins.forEach(r=>{const n=r.queryDepthRange?.(e);t.union(n)}),t}get updating(){return this._version.value>=0&&this._renderPlugins.some(e=>e.readyToRun)}produces(e,...t){return t.some(t=>this._slots[t].some(r=>{const n=r.produces.get(t);return!!n&&n(e)}))}consumes(e){return this._renderPlugins.some(t=>t.consumes().required.includes(e))}hasHighlight(e){return o.some(t=>this._slots[t].some(t=>t.hasHighlight(e)))}get hasDecorations(){return this._renderPlugins.some(e=>e.isDecoration)}get hasOccludees(){return this._renderPlugins.some(e=>e.hasOccludees)}get hasEmissions(){return this._renderPlugins.some(e=>e.hasEmissions)}get renderOccludedFlags(){return this._renderPlugins.reduce((e,t)=>e|(t.renderOccludedFlags??0),0)}get usedMemory(){return this._renderPlugins.reduce((e,t)=>t.material?e:e+(t.usedMemory??0),0)}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});