// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../libs/basisu/BasisUTranscoder","../../../webgl/enums","../../../webgl/Texture","../../../webgl/Util"],function(e,t,n,r,s){"use strict";let a=null,i=null;async function o(){return null==i&&(i=t.getBasisTranscoder(),a=await i),i}function l(e,t,r,a,i){const o=s.getBytesPerElementFormat(t?n.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:n.CompressedTextureFormat.COMPRESSED_RGB8_ETC2),l=i&&e>1?(4**e-1)/(3*4**(e-1)):1;return Math.ceil(r*a*o*l)}function u(e){return e.getNumImages()>=1&&!e.isUASTC()}function g(e){return e.getFaces()>=1&&e.isETC1S()}function c(e,t,s,a,i,o,l,u){const{compressedTextureETC:g,compressedTextureS3TC:c}=e.capabilities,[m,T]=g?a?[1,n.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[0,n.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:c?a?[3,n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[2,n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[13,6408],d=t.hasMipmap?s:Math.min(1,s),h=[];for(let e=0;e<d;e++)h.push(new Uint8Array(l(e,m))),u(e,m,h[e]);return t.internalFormat=T,t.hasMipmap=h.length>1,t.samplingMode=t.hasMipmap?9987:9729,t.width=i,t.height=o,new r.Texture(e,t,{type:"compressed",levels:h})}e.checkKTX2=g,e.createTextureBasis=async function(e,t,n){null==a&&(a=await o());const r=new a.BasisFile(new Uint8Array(n));if(!u(r))return null;r.startTranscoding();const s=c(e,t,r.getNumLevels(0),r.getHasAlpha(),r.getImageWidth(0,0),r.getImageHeight(0,0),(e,t)=>r.getImageTranscodedSizeInBytes(0,e,t),(e,t,n)=>r.transcodeImage(n,0,e,t,0,0));return r.close(),r.delete(),s},e.createTextureKTX2=async function(e,t,n){null==a&&(a=await o());const r=new a.KTX2File(new Uint8Array(n));if(!g(r))return null;r.startTranscoding();const s=c(e,t,r.getLevels(),r.getHasAlpha(),r.getWidth(),r.getHeight(),(e,t)=>r.getImageTranscodedSizeInBytes(e,0,0,t),(e,t,n)=>r.transcodeImage(n,e,0,0,t,0,-1,-1));return r.close(),r.delete(),s},e.estimateMemoryBasis=function(e,t){if(null==a)return e.byteLength;const n=new a.BasisFile(new Uint8Array(e)),r=u(n)?l(n.getNumLevels(0),n.getHasAlpha(),n.getImageWidth(0,0),n.getImageHeight(0,0),t):0;return n.close(),n.delete(),r},e.estimateMemoryKTX2=function(e,t){if(null==a)return e.byteLength;const n=new a.KTX2File(new Uint8Array(e)),r=g(n)?l(n.getLevels(),n.getHasAlpha(),n.getWidth(),n.getHeight(),t):0;return n.close(),n.delete(),r},e.loadBasisTranscoder=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});