// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/has","../../../../core/NestedMap","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/support/buffer/BufferView"],function(e,r,t,i,o){"use strict";e.ObjectAndLayerIdRenderHelper=class{constructor(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper",this.colorZero=new o.BufferViewVec4u8(new ArrayBuffer(4)),this._layerToOidToColor=new t.NestedMap,this._colorToUID=new Map,this._layerViewUidToGraphicsUidToObjectId=new t.NestedMap,this._layerViewUidToLayerId=new Map,this._layerViewUidToPopupEnabled=new Map}setUidToObjectAndLayerId(e,r,t,i,o,d=null,a=null,s=null){e&&r&&t&&i&&(this._layerViewUidToLayerId.set(i,t),this._layerViewUidToPopupEnabled.set(i,o),o&&this._layerViewUidToGraphicsUidToObjectId.set(i,r,{objectId:e,attributeNodeId:d,attributeIndex:a,subLayerId:s}))}getObjectAndLayerIdColor(e){const r=this.getObjectAndLayerIdColorArray(e);return i.fromValues(r.get(0,1),r.get(0,2),r.get(0,3),255)}getObjectAndLayerIdColorArray(e){if(!e.layerViewUid||!e.graphicUid)return this.colorZero;const t=this._layerViewUidToPopupEnabled.get(e.layerViewUid);if(void 0===t)return this.colorZero;if(!1===t)return this.colorZero;const i=this._layerViewUidToGraphicsUidToObjectId.get(e.layerViewUid,e.graphicUid)?.objectId;if(!i)return this.colorZero;let d=this._layerToOidToColor.get(e.layerViewUid,i);if(!d){if(r("enable-feature:objectAndLayerId-screenshot-testing"))d=i;else for(;!d;){const e=Math.floor(16777214*Math.random())+1;this._colorToUID.has(e)||(d=e)}if(d>16777215)throw new Error("Object ID Overflow");this._layerToOidToColor.set(e.layerViewUid,i,d),this._colorToUID.set(d,e)}const a=new ArrayBuffer(4);return new DataView(a).setUint32(0,d,!1),new o.BufferViewVec4u8(a)}getColorToObjectAndLayerIdMapping(){const e=new Map;for(const[r,t]of this._colorToUID.entries()){const i=this._layerViewUidToGraphicsUidToObjectId.get(t.layerViewUid,t.graphicUid),o=this._layerViewUidToLayerId.get(t.layerViewUid);i&&o&&e.set(r,i.attributeNodeId?{type:"object-and-layer-and-i3s-id",olid:i.objectId,lid:o,attrId:i.attributeNodeId,attrIdx:i.attributeIndex,subLayerId:i.subLayerId}:{type:"object-and-layer-id",olid:i.objectId,lid:o})}return e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});