// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/maybe","../../../../chunks/vec42","../../../../core/libs/gl-matrix-2/factories/vec4f32","../../../../core/libs/gl-matrix-2/factories/vec4f64","./BindParameters","../../../webgl/enums","../../../webgl/FramebufferObject"],function(e,t,i,s,r,o,h,c){"use strict";e.MainFramebuffer=class{constructor(e){this._fbos=e,this._requiresEmission=!1,this._size=new o.ViewportSize(0,0),this._clearColor=r.create()}dispose(){this._color=t.releaseMaybe(this._color),this.releaseDepth()}initialize(e,t,s,r){this._size.width=e,this._size.height=t,c.ensureAttachmentMaxSize(this._size,this._fbos.rctx.parameters.maxTextureSize);const o=this._color;return this._color=null,this.releaseDepth(),this._requiresEmission=r,i.copy(this._clearColor,s),o}releaseDepth(){this._color?.detachDepth(),this._depth=t.releaseMaybe(this._depth)}update(e){const t=this._ensureColor();t.attachDepth(this.depth),this._color=e(t)}bind(){const{rctx:e}=this._fbos,t=null==this._color;this.color.attachDepth(this.depth),e.bindFramebuffer(this.color.fbo),t&&(e.setClearStencil(0),e.setClearColor(this._clearColor[0],this._clearColor[1],this._clearColor[2],this._clearColor[3]),e.clear(17664),this._requiresEmission&&e.clearBuffer(1,s.ZEROS))}_acquireColor(){return this._requiresEmission?this._fbos.acquire(this._size.width,this._size.height,"acquired-color").acquireColor(h.ColorAttachment1,8,"emissive"):this._fbos.acquire(this._size.width,this._size.height,"acquired-color")}_acquireDepth(){return this._fbos.acquireDepth(11,this._size.width,this._size.height,"depth")}get size(){return this._size}get color(){return this._ensureColor()}get depth(){return this._depth??=this._acquireDepth(),this._depth}_ensureColor(){return this._color??=this._acquireColor(),this._color}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});