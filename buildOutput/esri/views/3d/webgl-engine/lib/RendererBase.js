// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./rendererUtils","../materials/renderers/MergedRenderer"],function(e,r,t,s,i,a,d,n,o,h,c){"use strict";e.RendererBase=class extends t{constructor(e){super(e),this._renderers=new Map}destroy(){this._renderers.forEach(e=>!e.destroyed&&e.destroy()),this._renderers.clear()}initialize(){this.addHandles(s.watch(()=>this.stage.view.state.highlights,()=>this.updateHighlights()))}getMaterialRenderer(e){return this._renderers.get(e)}updateHighlights(){this._renderers.forEach(e=>e.updateHighlights(this.stage.view.state.highlightOrderMap))}commit(e,r,t){const{adds:s,removes:i,updates:a}=e;if(0===s.length&&0===i.length&&0===a.length)return!1;h.splitRenderGeometryChangeSetByMaterial(e).forEach((e,s)=>{if(r.done)return;let i=this._renderers.get(s);null==i&&e.adds.length>0&&(i=new c.MergedRenderer({material:s,highlightOrderMap:this.stage.view.state.highlightOrderMap}),i.initializeRenderContext(t),this.rendererAdded(i),this._renderers.set(s,i)),i?(i.modify(e,r),i.updateHighlights(this.stage.view.state.highlightOrderMap),0===i.numGeometries&&(this._renderers.delete(i.material),this.rendererRemoved(i),i.destroy())):(e.clear(),r.madeProgress())});let d=0;for(const e of this._renderers.values())e.drapedPriority=d++;return!0}get canCompact(){for(const e of this._renderers.values())if(e.canCompact)return!0;return!1}compact(e){let r=!1;for(const t of this._renderers.values()){if(e.done)return r;r=t.compact(e)||r}return r}get renderers(){return this._renderers}},r.__decorate([i.property({constructOnly:!0})],e.RendererBase.prototype,"stage",void 0),e.RendererBase=r.__decorate([o.subclass("esri.views.3d.webgl-engine.lib.RendererBase")],e.RendererBase),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});