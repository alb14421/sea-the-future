// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/maybe","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../chunks/vec42","./glUtil3D","../../../../chunks/ShadowCastVisualize.glsl","../shaders/ShadowCastVisualizeTechnique","../shaders/ShadowCastVisualizeTechniqueConfiguration"],function(e,s,t,a,i,r,o,n,h,d,l,_,c,u){"use strict";const p=1/512;e.ShadowCastRenderer=class extends t{constructor(e,s,t,a){super({}),this._techniques=e,this._rctx=s,this._data=t,this._requestRender=a,this._passParameters=new _.ShadowCastVisualizePassParameters(this._data),this._configuration=new u.ShadowCastVisualizeTechniqueConfiguration,this._enabled=!1,this._vao=l.createQuadVAO(s)}dispose(){this._stop(),this._vao=a.disposeMaybe(this._vao)}precompile(){this._showVisualization&&this._techniques.precompile(c.ShadowCastVisualizeTechnique,this._configuration)}render(e){if(!this._showVisualization)return;const[s,t]=this._data.computedSamples;this._passParameters.sampleScale=[s?1/s:0,t?1/t:0];const a=this._techniques.get(c.ShadowCastVisualizeTechnique,this._configuration);this._rctx.bindVAO(this._vao),this._rctx.bindTechnique(a,e,this._passParameters),this._rctx.drawArrays(a.primitiveType,0,this._vao.vertexCount("geometry"))}setOptions(e){void 0!==e.enabled&&this._setEnabled(e.enabled),void 0!==e.thresholdColor&&this._setThresholdColor(e.thresholdColor),void 0!==e.gradientColor&&this._setGradientColor(e.gradientColor),void 0!==e.bandedGradientColor&&this._setBandedGradientColor(e.bandedGradientColor),void 0!==e.threshold&&(this._threshold=e.threshold),void 0!==e.visualization&&(this._visualization=e.visualization),void 0!==e.bandSize&&(this._bandSize=e.bandSize)}get opacityFromElevation(){return this._passParameters.opacityFromElevation}set opacityFromElevation(e){this._passParameters.opacityFromElevation!==e&&(this._passParameters.opacityFromElevation=e,this.notifyChange("opacityFromElevation"))}get _showVisualization(){return this._enabled&&(this._data.computedSamples[0]>0||this._data.computedSamples[1]>0)&&this.opacityFromElevation>p}get _threshold(){return this._passParameters.threshold}set _threshold(e){this._threshold!==e&&(this._passParameters.threshold=e,this._requestRenderIfEnabled())}get _visualization(){return this._configuration.visualization}set _visualization(e){e!==this._visualization&&(this._configuration.visualization=e,this._requestRenderIfEnabled())}get _bandSize(){return this._passParameters.bandSize}set _bandSize(e){e!==this._bandSize&&(this._passParameters.bandSize=e,this._requestRenderIfEnabled())}_setThresholdColor(e){const s=this._passParameters.thresholdColor;d.exactEquals(e,s)||(d.copy(this._passParameters.thresholdColor,e),this._requestRenderIfEnabled())}_setGradientColor(e){const s=this._passParameters.gradientColor;d.exactEquals(e,s)||(d.copy(this._passParameters.gradientColor,e),this._requestRenderIfEnabled())}_setBandedGradientColor(e){const s=this._passParameters.bandedGradientColor;d.exactEquals(e,s)||(d.copy(this._passParameters.bandedGradientColor,e),this._requestRenderIfEnabled())}_setEnabled(e){e!==this._enabled&&(e?this._start():this._stop())}_requestRenderIfEnabled(){this._enabled&&this._requestRender()}_start(){this._enabled=!0,this._requestRender()}_stop(){this._enabled=!1,this._requestRender()}},s.__decorate([i.property()],e.ShadowCastRenderer.prototype,"opacityFromElevation",null),e.ShadowCastRenderer=s.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],e.ShadowCastRenderer),e.shadowCastDisableElevationMax=5e4,e.shadowCastDisableElevationMin=4e4,e.shadowCastDisabledElevationThreshold=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});