// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/mathUtils","../../../../../core/PooledArray","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","./Edge"],function(e,t,n,o,a,s){"use strict";class c{constructor(){this.index=0,this.length=0}}const r=new n({allocator:e=>e||new c,deallocator:null}),l=new n({deallocator:null}),i=new n({deallocator:null}),d=new s.Edge,g=a.create(),u=a.create(),h=a.create(),p=a.create(),f=a.create(),m=t.deg2rad(4),A=Math.cos(m),w=t.deg2rad(35),v=Math.cos(w);e.cleanupEdgeProcessing=function(){r.prune(),l.prune(),i.prune()},e.extractEdges=function(e,n,a){const s=e.vertices.position,c=e.vertices.componentIndex,w=d.position0,y=d.position1,x=d.faceNormal0,V=d.faceNormal1,{edges:b,normals:E}=function(e){const t=e.faces.length/3,n=e.faces,a=e.neighbors,s=e.vertices.position;l.length=i.length=0;for(let e=0;e<t;e++){const t=3*e,c=a[t],r=a[t+1],d=a[t+2],g=n[t],u=n[t+1],m=n[t+2];s.getVec(g,h),s.getVec(u,p),s.getVec(m,f),o.subtract(p,p,h),o.subtract(f,f,h),o.cross(h,p,f),o.normalize(h,h),i.pushArray(h),(-1===c||g<u)&&(l.push(g),l.push(u),l.push(e),l.push(c)),(-1===r||u<m)&&(l.push(u),l.push(m),l.push(e),l.push(r)),(-1===d||m<g)&&(l.push(m),l.push(g),l.push(e),l.push(d))}return{edges:l,normals:i}}(e),I=b.length/4,N=n.allocate(I);let M=0;const P=I,D=a?.allocate(P);let F=0,S=0,j=0;r.length=0;for(let e=0;e<I;++e){const t=4*e;s.getVec(b.data[t],w),s.getVec(b.data[t+1],y);const n=r.pushNew();n.index=4*e,n.length=o.distance(w,y)}r.sort((e,t)=>t.length-e.length);const k=new Array,z=new Array;r.forAll(({length:e,index:r})=>{const l=b.data[r],i=b.data[r+1],h=b.data[r+2],p=b.data[r+3],f=-1===p;if(s.getVec(l,w),s.getVec(i,y),f){const e=3*h;o.set(x,E.data[e],E.data[e+1],E.data[e+2]),o.copy(V,x),d.componentIndex=c.get(l),d.cosAngle=o.dot(x,V)}else{let e=3*h;if(o.set(x,E.data[e],E.data[e+1],E.data[e+2]),e=3*p,o.set(V,E.data[e],E.data[e+1],E.data[e+2]),d.componentIndex=c.get(l),d.cosAngle=o.dot(x,V),I=A,d.cosAngle>I)return;d.cosAngle<-.9999&&o.copy(V,x)}var I,P;S+=e,j++,f||(P=v,d.cosAngle<P)?(n.write(N,M++,d),k.push(e)):function(e,n){const a=t.acosClamped(e.cosAngle);return o.direction(u,e.position1,e.position0),a*(o.dot(o.cross(g,e.faceNormal0,e.faceNormal1),u)>0?-1:1)>n}(d,m)&&(D&&a&&a.write(D,F++,d),z.push(e))});const C=new Float32Array(k.reverse()),L=new Float32Array(z.reverse()),O=D&&a?{instancesData:D.slice(0,F),lodInfo:{lengths:L}}:void 0;return{regular:{instancesData:N.slice(0,M),lodInfo:{lengths:C}},silhouette:O,averageEdgeLength:S/j}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});