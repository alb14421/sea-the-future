// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/PooledArray","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./Util"],function(t,i,e,r,s){"use strict";class n{get center(){return r.fromValues(this._data[0],this._data[1],this._data[2])}get radius(){return this._data[3]}get bbMin(){return r.fromValues(this._data[4],this._data[5],this._data[6])}get bbMax(){return r.fromValues(this._data[7],this._data[8],this._data[9])}constructor(t,i,n){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.position=n,this._data=[.1,0,0,0,0,0,0,0,0,0],this._children=void 0,s.assert(t.length>=1),s.assert(3===n.size||4===n.size);const{data:h,size:o,indices:l}=n;s.assert(l.length%this._numIndexPerPrimitive===0),s.assert(l.length>=t.length*this._numIndexPerPrimitive);const d=t.length;let c=o*l[this._numIndexPerPrimitive*t[0]];a.clear(),a.push(c);const m=r.fromValues(h[c],h[c+1],h[c+2]),u=r.clone(m);for(let i=0;i<d;++i){const e=this._numIndexPerPrimitive*t[i];for(let t=0;t<this._numIndexPerPrimitive;++t){c=o*l[e+t],a.push(c);let i=h[c];m[0]=Math.min(i,m[0]),u[0]=Math.max(i,u[0]),i=h[c+1],m[1]=Math.min(i,m[1]),u[1]=Math.max(i,u[1]),i=h[c+2],m[2]=Math.min(i,m[2]),u[2]=Math.max(i,u[2])}}for(let t=0;t<3;++t)this._data[4+t]=m[t],this._data[7+t]=u[t];const _=e.lerp(r.create(),this.bbMin,this.bbMax,.5);let f=.5*Math.max(Math.max(u[0]-m[0],u[1]-m[1]),u[2]-m[2]),x=f*f;for(let t=0;t<a.length;++t){c=a.at(t);const i=h[c]-_[0],e=h[c+1]-_[1],r=h[c+2]-_[2],s=i*i+e*e+r*r;if(s<=x)continue;const n=Math.sqrt(s),o=.5*(n-f);f+=o,x=f*f;const l=o/n;_[0]+=i*l,_[1]+=e*l,_[2]+=r*l}this._data[3]=f;for(let t=0;t<3;++t)this._data[0+t]=_[t];a.clear()}getChildren(){if(this._children||e.squaredDistance(this.bbMin,this.bbMax)<=1)return this._children;const t=e.lerp(r.create(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,s=new Uint8Array(i),a=new Array(8);for(let t=0;t<8;++t)a[t]=0;const{data:h,size:o,indices:l}=this.position;for(let e=0;e<i;++e){let i=0;const r=this._numIndexPerPrimitive*this.primitiveIndices[e];let n=o*l[r],d=h[n],c=h[n+1],m=h[n+2];for(let t=1;t<this._numIndexPerPrimitive;++t){n=o*l[r+t];const i=h[n],e=h[n+1],s=h[n+2];i<d&&(d=i),e<c&&(c=e),s<m&&(m=s)}d<t[0]&&(i|=1),c<t[1]&&(i|=2),m<t[2]&&(i|=4),s[e]=i,++a[i]}let d=0;for(let t=0;t<8;++t)a[t]>0&&++d;if(d<2)return;const c=new Array(8);for(let t=0;t<8;++t)c[t]=a[t]>0?new Uint32Array(a[t]):void 0;for(let t=0;t<8;++t)a[t]=0;for(let t=0;t<i;++t){const i=s[t];c[i][a[i]++]=this.primitiveIndices[t]}this._children=new Array;for(let t=0;t<8;++t)void 0!==c[t]&&this._children.push(new n(c[t],this._numIndexPerPrimitive,this.position));return this._children}static prune(){a.prune()}}const a=new i({deallocator:null});t.BoundingInfo=n,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});