// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/has","../../../../core/uid","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../../../geometry/projection/projectBuffer","./Attribute","./Geometry","./LocalOriginFactory","./Object3D","./testUtils","./WebGLLayer","../materials/RibbonLineMaterial"],function(t,i,r,e,o,s,n,a,c,h,g,l,d,u){"use strict";const b=o.create();t.GridLocalOriginFactory=class{constructor(t){this._originSR=t,this._rootOriginId="root/"+r.generateUID(),this._origins=new Map,this._objects=new Map,this._gridSize=5e5}getOrigin(t){const i=this._origins.get(this._rootOriginId);if(null==i){const i=l.gridLocalOriginFactory.rootOrigin;if(null!=i)return this._origins.set(this._rootOriginId,h.fromValues(i[0],i[1],i[2],this._rootOriginId)),this.getOrigin(t);const r=h.fromValues(t[0]+Math.random()-.5,t[1]+Math.random()-.5,t[2]+Math.random()-.5,this._rootOriginId);return this._origins.set(this._rootOriginId,r),r}const r=this._gridSize,o=Math.round(t[0]/r),s=Math.round(t[1]/r),n=Math.round(t[2]/r),a=`${o}/${s}/${n}`;let c=this._origins.get(a);const g=.5*r;if(e.subtract(b,t,i.vec3),b[0]=Math.abs(b[0]),b[1]=Math.abs(b[1]),b[2]=Math.abs(b[2]),b[0]<g&&b[1]<g&&b[2]<g){if(c){const i=Math.max(...b);if(e.subtract(b,t,c.vec3),b[0]=Math.abs(b[0]),b[1]=Math.abs(b[1]),b[2]=Math.abs(b[2]),Math.max(...b)<i)return c}return i}return c||(c=h.fromValues(o*r,s*r,n*r,a),this._origins.set(a,c)),c}_drawOriginBox(t,i=s.fromValues(1,1,0,1)){const r=window.view,e=r.stage,o=i.toString();if(!this._objects.has(o)){this._material=new u.RibbonLineMaterial({width:2,color:i});const t=new d.WebGLLayer(e,{pickable:!1}),r=new g.Object3D({castShadow:!1});t.add(r),this._objects.set(o,r)}const h=this._objects.get(o),l=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],b=l.length,_=new Array(3*b),f=new Array,m=.5*this._gridSize;for(let i=0;i<b;i++)_[3*i]=t[0]+(1&l[i]?m:-m),_[3*i+1]=t[1]+(2&l[i]?m:-m),_[3*i+2]=t[2]+(4&l[i]?m:-m),i>0&&f.push(i-1,i);n.projectBuffer(_,this._originSR,0,_,r.renderSpatialReference,0,b);const M=new c.Geometry(this._material,[["position",new a.Attribute(_,f,3,!0)]],null,2);h.addGeometry(M)}get test(){}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});