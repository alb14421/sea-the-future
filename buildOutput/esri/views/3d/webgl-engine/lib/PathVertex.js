// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/mathUtils","../../../../core/libs/gl-matrix-2/math/mat2","../../../../core/libs/gl-matrix-2/factories/mat2f64","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./PathExtruder"],function(t,e,r,a,i,s,h,o,n){"use strict";class c{constructor(){this.vLeft=o.create(),this.vRight=o.create(),this.vMinSiblingLength=0,this.frame=new n.Frame2D}setFrameFromUpVector(t){h.copy(this.frame.up,t),h.add(x,this.vLeft,this.vRight),h.normalize(x,x),h.scale(b,this.frame.up,h.dot(x,this.frame.up)),h.subtract(R,x,b),h.normalize(R,R),h.cross(this.frame.right,R,this.frame.up)}get foldingAngle(){return Math.PI-this.rotationAngle}}class g extends c{get rotationFrameUp(){return this.frame.up}get rotationRight(){return s.UNIT_X}get rotationAngle(){return h.scale(v,this.frame.up,h.dot(this.frame.up,this.vLeft)),h.subtract(v,this.vLeft,v),h.negate(v,v),h.normalize(v,v),h.scale(M,this.frame.up,h.dot(this.frame.up,this.vRight)),h.subtract(M,this.vRight,M),h.normalize(M,M),h.cross(d,this.rotationFrameUp,this.vLeft),Math.sign(h.dot(d,this.vRight))*(Math.PI-e.acosClamped(h.dot(v,M)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength/Math.cos(.5*this.foldingAngle))}applyMiterStretch(t,r){const a=this.rotationAngle;if(Math.abs(a)<=0)return r;const s=e.reciprocalClamped(Math.cos(.5*a));return i.set(t,(s-1+1)*r[0],r[1])}}class l extends c{get rotationFrameUp(){const t=Math.sign(h.dot(this.frame.right,this.vRight));return h.cross(m,this.vRight,this.vLeft),h.scale(m,m,t),h.normalize(m,m)}get rotationRight(){const t=this.rotationFrameUp,e=h.dot(t,this.frame.up),r=h.dot(t,this.frame.right);var a,s,o;return h.scale(u,this.frame.up,-r),h.scale(p,this.frame.right,e),h.add(u,u,p),h.normalize(u,u),a=f,s=this.frame,o=u,i.set(a,h.dot(o,s.right),h.dot(o,s.up)),f}get rotationAngle(){const t=Math.sign(h.dot(this.frame.right,this.vRight));return h.negate(d,this.vLeft),-t*(Math.PI-e.acosClamped(h.dot(d,this.vRight)))}get maxStretchDistance(){return Math.abs(this.vMinSiblingLength*e.reciprocalClamped(Math.cos(.5*this.foldingAngle)))}applyMiterStretch(t,a){const s=this.rotationAngle;if(0===Math.abs(s))return a;const h=e.reciprocalClamped(Math.cos(.5*s)),o=this.rotationRight,n=r.set(L,1+(h-1)*o[0]*o[0],(h-1)*o[0]*o[1],(h-1)*o[0]*o[1],1+(h-1)*o[1]*o[1]);return i.transformMat2(t,a,n)}}const m=o.create(),f=s.create(),u=o.create(),p=o.create(),d=o.create(),v=o.create(),M=o.create(),b=o.create(),x=o.create(),R=o.create(),L=a.create();t.PathVertex=c,t.newPathVertex=function(t){switch(t){case 0:return new g;case 1:return new l}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});