// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/support/DoubleArray","../../../../geometry/support/FloatArray","../../../../geometry/support/Indices","../../../../geometry/support/plane","../../../../geometry/support/ray","../../support/engineContent/line","./Attribute","./bufferVectorMath","./Geometry","./Util"],function(t,e,r,n,o,s,a,l,u,c,i,h,f,p){"use strict";const m=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],A=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],y=[0,0,1,0,1,1,0,1],w=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],g=new Array(36);for(let t=0;t<6;t++)for(let e=0;e<6;e++)g[6*t+e]=t;const b=new Array(36);for(let t=0;t<6;t++)b[6*t]=0,b[6*t+1]=1,b[6*t+2]=2,b[6*t+3]=2,b[6*t+4]=3,b[6*t+5]=0;const d=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],M=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],G=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],V=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7],z=r.fromValues(-.5,0,-.5),F=r.fromValues(.5,0,-.5),P=r.fromValues(0,0,.5),I=r.fromValues(0,.5,0),v=r.create(),x=r.create(),S=r.create(),D=r.create(),C=r.create();e.subtract(v,z,I),e.subtract(x,z,F),e.cross(S,v,x),e.normalize(S,S),e.subtract(v,F,I),e.subtract(x,F,P),e.cross(D,v,x),e.normalize(D,D),e.subtract(v,P,I),e.subtract(x,P,z),e.cross(C,v,x),e.normalize(C,C);const T=[z,F,P,I],O=[0,-1,0,S[0],S[1],S[2],D[0],D[1],D[2],C[0],C[1],C[2]],k=[0,1,2,3,1,0,3,2,1,3,0,2],q=[0,0,0,1,1,1,2,2,2,3,3,3];function B(t,e,r){const n=t;let o,a;if(r)o=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],a=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1];else{const t=n*(1+Math.sqrt(5))/2;o=[-n,t,0,n,t,0,-n,-t,0,n,-t,0,0,-n,t,0,n,t,0,-n,-t,0,n,-t,t,0,-n,t,0,n,-t,0,-n,-t,0,n],a=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]}for(let e=0;e<o.length;e+=3)h.scale(o,e,t/h.length(o,e));let l={};function u(e,r){e>r&&([e,r]=[r,e]);const n=e.toString()+"."+r.toString();if(l[n])return l[n];let s=o.length;return o.length+=3,h.add(o,3*e,o,3*r,o,s),h.scale(o,s,t/h.length(o,s)),s/=3,l[n]=s,s}for(let t=0;t<e;t++){const t=a.length,e=new Array(4*t);for(let r=0;r<t;r+=3){const t=a[r],n=a[r+1],o=a[r+2],s=u(t,n),l=u(n,o),c=u(o,t),i=4*r;e[i]=t,e[i+1]=s,e[i+2]=c,e[i+3]=n,e[i+4]=l,e[i+5]=s,e[i+6]=o,e[i+7]=c,e[i+8]=l,e[i+9]=s,e[i+10]=l,e[i+11]=c}a=e,l={}}const c=s.floatArrayFrom(o);for(let t=0;t<c.length;t+=3)h.normalize(c,t);return[["position",new i.Attribute(s.floatArrayFrom(o),a,3,!0)],["normal",new i.Attribute(c,a,3,!0)]]}const E=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];function U(t,e,n,o,a=!0,l=!0){let u=0;const c=e,h=t;let f=r.fromValues(0,u,0),p=r.fromValues(0,u+h,0),m=r.fromValues(0,-1,0),A=r.fromValues(0,1,0);o&&(u=h,p=r.fromValues(0,0,0),f=r.fromValues(0,u,0),m=r.fromValues(0,1,0),A=r.fromValues(0,-1,0));const y=[p,f],w=[m,A],g=n+2,b=Math.sqrt(h*h+c*c);if(o)for(let t=n-1;t>=0;t--){const e=t*(2*Math.PI/n),o=r.fromValues(Math.cos(e)*c,u,Math.sin(e)*c);y.push(o);const s=r.fromValues(h*Math.cos(e)/b,-c/b,h*Math.sin(e)/b);w.push(s)}else for(let t=0;t<n;t++){const e=t*(2*Math.PI/n),o=r.fromValues(Math.cos(e)*c,u,Math.sin(e)*c);y.push(o);const s=r.fromValues(h*Math.cos(e)/b,c/b,h*Math.sin(e)/b);w.push(s)}const d=new Array,M=new Array;if(a){for(let t=3;t<y.length;t++)d.push(1),d.push(t-1),d.push(t),M.push(0),M.push(0),M.push(0);d.push(y.length-1),d.push(2),d.push(1),M.push(0),M.push(0),M.push(0)}if(l){for(let t=3;t<y.length;t++)d.push(t),d.push(t-1),d.push(0),M.push(t),M.push(t-1),M.push(1);d.push(0),d.push(2),d.push(y.length-1),M.push(1),M.push(2),M.push(w.length-1)}const G=s.newFloatArray(3*g);for(let t=0;t<g;t++)G[3*t]=y[t][0],G[3*t+1]=y[t][1],G[3*t+2]=y[t][2];const V=s.newFloatArray(3*g);for(let t=0;t<g;t++)V[3*t]=w[t][0],V[3*t+1]=w[t][1],V[3*t+2]=w[t][2];return[["position",new i.Attribute(G,d,3,!0)],["normal",new i.Attribute(V,M,3,!0)]]}function Z(t,o,a,c,h,p,m=r.fromValues(0,0,0)){const A=o.length,y=s.newFloatArray(a.length*A*3+(6*c.length||0)),w=s.newFloatArray(a.length*A*3+(c?6:0)),g=new Array,b=new Array;let d=0,M=0;const G=n.create(),V=n.create(),z=n.create(),F=n.create(),P=n.create(),I=n.create(),v=n.create(),x=n.create(),S=n.create(),D=n.create(),C=n.create(),T=n.create(),O=n.create(),k=l.create();e.set(S,0,1,0),e.subtract(V,a[1],a[0]),e.normalize(V,V),p?(e.add(x,a[0],m),e.normalize(z,x)):e.set(z,0,0,1),N(V,z,S,S,P,z,R),e.copy(F,z),e.copy(T,P);for(let t=0;t<c.length;t++)e.scale(I,P,c[t][0]),e.scale(x,z,c[t][2]),e.add(I,I,x),e.add(I,I,a[0]),y[d++]=I[0],y[d++]=I[1],y[d++]=I[2];w[M++]=-V[0],w[M++]=-V[1],w[M++]=-V[2];for(let t=0;t<h.length;t++)g.push(h[t][0]>0?h[t][0]:-h[t][0]-1+c.length),g.push(h[t][1]>0?h[t][1]:-h[t][1]-1+c.length),g.push(h[t][2]>0?h[t][2]:-h[t][2]-1+c.length),b.push(0),b.push(0),b.push(0);let q=c.length;const B=c.length-1;for(let t=0;t<a.length;t++){let r=!1;t>0&&(e.copy(G,V),t<a.length-1?(e.subtract(V,a[t+1],a[t]),e.normalize(V,V)):r=!0,e.add(D,G,V),e.normalize(D,D),e.add(C,a[t-1],F),l.fromPositionAndNormal(a[t],D,k),l.intersectRay(k,u.wrap(C,G),x)?(e.subtract(x,x,a[t]),e.normalize(z,x),e.cross(P,D,z),e.normalize(P,P)):N(D,F,T,S,P,z,R),e.copy(F,z),e.copy(T,P)),p&&(e.add(x,a[t],m),e.normalize(O,x));for(let n=0;n<A;n++)if(e.scale(I,P,o[n][0]),e.scale(x,z,o[n][1]),e.add(I,I,x),e.normalize(v,I),w[M++]=v[0],w[M++]=v[1],w[M++]=v[2],e.add(I,I,a[t]),y[d++]=I[0],y[d++]=I[1],y[d++]=I[2],!r){const t=(n+1)%A;g.push(q+n),g.push(q+A+n),g.push(q+t),g.push(q+t),g.push(q+A+n),g.push(q+A+t);for(let t=0;t<6;t++){const e=g.length-6;b.push(g[e+t]-B)}}q+=A}const E=a[a.length-1];for(let t=0;t<c.length;t++)e.scale(I,P,c[t][0]),e.scale(x,z,c[t][1]),e.add(I,I,x),e.add(I,I,E),y[d++]=I[0],y[d++]=I[1],y[d++]=I[2];const U=M/3;w[M++]=V[0],w[M++]=V[1],w[M++]=V[2];const Z=q-A;for(let t=0;t<h.length;t++)g.push(h[t][0]>=0?q+h[t][0]:-h[t][0]-1+Z),g.push(h[t][2]>=0?q+h[t][2]:-h[t][2]-1+Z),g.push(h[t][1]>=0?q+h[t][1]:-h[t][1]-1+Z),b.push(U),b.push(U),b.push(U);const j=[["position",new i.Attribute(y,g,3,!0)],["normal",new i.Attribute(w,b,3,!0)]];return new f.Geometry(t,j)}function j(t,r,n,o,s){return!(Math.abs(e.dot(r,t))>s||(e.cross(n,t,r),e.normalize(n,n),e.cross(o,n,t),e.normalize(o,o),0))}function N(t,e,r,n,o,s,a){return j(t,e,o,s,a)||j(t,r,o,s,a)||j(t,n,o,s,a)}const R=.99619469809,H=n.create();t.cgToGIS=function(t,e=t){const r=t.attributes,n=r.get("position").data,o=r.get("normal").data;if(o){const t=e.getMutableAttribute("normal").data;for(let e=0;e<o.length;e+=3){const r=o[e+1];t[e+1]=-o[e+2],t[e+2]=r}}if(n){const t=e.getMutableAttribute("position").data;for(let e=0;e<n.length;e+=3){const r=n[e+1];t[e+1]=-n[e+2],t[e+2]=r}}},t.createBoxGeometry=function(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(24);for(let t=0;t<8;t++)r[3*t]=m[t][0]*e[0],r[3*t+1]=m[t][1]*e[1],r[3*t+2]=m[t][2]*e[2];return new f.Geometry(t,[["position",new i.Attribute(r,w,3,!0)],["normal",new i.Attribute(A,g,3)],["uv0",new i.Attribute(y,b,2)]])},t.createConeGeometry=function(t,e,r,n,o,s=!0,a=!0){return new f.Geometry(t,U(e,r,n,o,s,a))},t.createConeGeometryData=U,t.createCylinderGeometry=function(t,n,o,a,l,u,c){const h=l?r.clone(l):r.fromValues(1,0,0),p=u?r.clone(u):r.fromValues(0,0,0);c??=!0;const m=r.create();e.normalize(m,h);const A=r.create();e.scale(A,m,Math.abs(n));const y=r.create();e.scale(y,A,-.5),e.add(y,y,p);const w=r.fromValues(0,1,0);Math.abs(1-e.dot(m,w))<.2&&e.set(w,0,0,1);const g=r.create();e.cross(g,m,w),e.normalize(g,g),e.cross(w,g,m);const b=2*a+(c?2:0),d=a+(c?2:0),M=s.newFloatArray(3*b),G=s.newFloatArray(3*d),V=s.newFloatArray(2*b),z=new Array(3*a*(c?4:2)),F=new Array(3*a*(c?4:2));c&&(M[3*(b-2)]=y[0],M[3*(b-2)+1]=y[1],M[3*(b-2)+2]=y[2],V[2*(b-2)]=0,V[2*(b-2)+1]=0,M[3*(b-1)]=M[3*(b-2)]+A[0],M[3*(b-1)+1]=M[3*(b-2)+1]+A[1],M[3*(b-1)+2]=M[3*(b-2)+2]+A[2],V[2*(b-1)]=1,V[2*(b-1)+1]=1,G[3*(d-2)]=-m[0],G[3*(d-2)+1]=-m[1],G[3*(d-2)+2]=-m[2],G[3*(d-1)]=m[0],G[3*(d-1)+1]=m[1],G[3*(d-1)+2]=m[2]);const P=(t,e,r)=>{z[t]=e,F[t]=r};let I=0;const v=r.create(),x=r.create();for(let t=0;t<a;t++){const r=t*(2*Math.PI/a);e.scale(v,w,Math.sin(r)),e.scale(x,g,Math.cos(r)),e.add(v,v,x),G[3*t]=v[0],G[3*t+1]=v[1],G[3*t+2]=v[2],e.scale(v,v,o),e.add(v,v,y),M[3*t]=v[0],M[3*t+1]=v[1],M[3*t+2]=v[2],V[2*t]=t/a,V[2*t+1]=0,M[3*(t+a)]=M[3*t]+A[0],M[3*(t+a)+1]=M[3*t+1]+A[1],M[3*(t+a)+2]=M[3*t+2]+A[2],V[2*(t+a)]=t/a,V[2*t+1]=1;const n=(t+1)%a;P(I++,t,t),P(I++,t+a,t),P(I++,n,n),P(I++,n,n),P(I++,t+a,t),P(I++,n+a,n)}if(c){for(let t=0;t<a;t++){const e=(t+1)%a;P(I++,b-2,d-2),P(I++,t,d-2),P(I++,e,d-2)}for(let t=0;t<a;t++){const e=(t+1)%a;P(I++,t+a,d-1),P(I++,b-1,d-1),P(I++,e+a,d-1)}}const S=[["position",new i.Attribute(M,z,3,!0)],["normal",new i.Attribute(G,F,3,!0)],["uv0",new i.Attribute(V,z,2,!0)]];return new f.Geometry(t,S)},t.createDiamondGeometry=function(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(18);for(let t=0;t<6;t++)r[3*t]=d[t][0]*e[0],r[3*t+1]=d[t][1]*e[1],r[3*t+2]=d[t][2]*e[2];return new f.Geometry(t,[["position",new i.Attribute(r,G,3,!0)],["normal",new i.Attribute(M,V,3)]])},t.createExtrudedTriangle=function(t,e,r,n,o,s=0){const a=new Array(18),l=[[-r,s,o/2],[n,s,o/2],[0,e+s,o/2],[-r,s,-o/2],[n,s,-o/2],[0,e+s,-o/2]];for(let t=0;t<6;t++)a[3*t]=l[t][0],a[3*t+1]=l[t][1],a[3*t+2]=l[t][2];return new f.Geometry(t,[["position",new i.Attribute(a,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5],3,!0)]])},t.createPathExtrusionGeometry=Z,t.createPointGeometry=function(t,{normal:e,position:r,color:o,rotation:s,size:l,centerOffsetAndDistance:u,uvi:c,featureAttribute:h,olidColor:p=null}={}){const m=r?n.clone(r):n.create(),A=e?n.clone(e):n.fromValues(0,0,1),y=o?[o[0],o[1],o[2],o.length>3?o[3]:255]:[255,255,255,255],w=null!=l&&2===l.length?l:[1,1],g=null!=s?[s]:[0],b=a.getZeroIndexArray(1),d=[["position",new i.Attribute(m,b,3,!0)],["normal",new i.Attribute(A,b,3,!0)],["color",new i.Attribute(y,b,4,!0)],["size",new i.Attribute(w,b,2)],["rotation",new i.Attribute(g,b,1,!0)]];if(c&&d.push(["uvi",new i.Attribute(c,b,c.length)]),null!=u){const t=[u[0],u[1],u[2],u[3]];d.push(["centerOffsetAndDistance",new i.Attribute(t,b,4)])}if(h){const t=[h[0],h[1],h[2],h[3]];d.push(["featureAttribute",new i.Attribute(t,b,4)])}return new f.Geometry(t,d,null,1,p)},t.createPolySphereData=B,t.createPolySphereGeometry=function(t,e,r,n){const o=B(e,r,n);return new f.Geometry(t,o)},t.createPolylineGeometry=function(t,e,r,n,l){const u=o.newDoubleArray(3*e.length),h=new Array(2*(e.length-1));let p=0,m=0;for(let t=0;t<e.length;t++){for(let r=0;r<3;r++)u[p++]=e[t][r];t>0&&(h[m++]=t-1,h[m++]=t)}const A=[["position",new i.Attribute(u,h,3,!0)]];if(r&&r.length===e.length&&3===r[0].length){const t=s.newFloatArray(3*r.length);let n=0;for(let o=0;o<e.length;o++)for(let e=0;e<3;e++)t[n++]=r[o][e];A.push(["normal",new i.Attribute(t,h,3,!0)])}if(n&&A.push(["color",new i.Attribute(n,a.getContinuousIndexArray(n.length/4),4)]),l&&l.length===e.length){const t=c.timeStampsToAttribute(l);A.push(["timeStamps",new i.Attribute(t,h,3,!0)])}return new f.Geometry(t,A,null,2)},t.createSphereGeometry=function(t,e,r,n,o={uv:!0}){const l=-Math.PI,u=2*Math.PI,c=-Math.PI/2,h=Math.PI,p=Math.max(3,Math.floor(r)),m=Math.max(2,Math.floor(n)),A=(p+1)*(m+1),y=s.newFloatArray(3*A),w=s.newFloatArray(3*A),g=s.newFloatArray(2*A),b=[];let d=0;for(let t=0;t<=m;t++){const r=[],n=t/m,o=c+n*h,s=Math.cos(o);for(let t=0;t<=p;t++){const a=t/p,c=l+a*u,i=Math.cos(c)*s,h=Math.sin(o),f=-Math.sin(c)*s;y[3*d]=i*e,y[3*d+1]=h*e,y[3*d+2]=f*e,w[3*d]=i,w[3*d+1]=h,w[3*d+2]=f,g[2*d]=a,g[2*d+1]=n,r.push(d),++d}b.push(r)}const M=new Array;for(let t=0;t<m;t++)for(let e=0;e<p;e++){const r=b[t][e],n=b[t][e+1],o=b[t+1][e+1],s=b[t+1][e];0===t?(M.push(r),M.push(o),M.push(s)):t===m-1?(M.push(r),M.push(n),M.push(o)):(M.push(r),M.push(n),M.push(o),M.push(o),M.push(s),M.push(r))}const G=[["position",new i.Attribute(y,M,3,!0)],["normal",new i.Attribute(w,M,3,!0)]];return o.uv&&G.push(["uv0",new i.Attribute(g,M,2,!0)]),o.offset&&(G[0][0]="offset",G.push(["position",new i.Attribute(Float64Array.from(o.offset),a.getZeroIndexArray(M.length),3,!0)])),new f.Geometry(t,G)},t.createSquareGeometry=function(t,e=E){const r=new Array(12);for(let t=0;t<4;t++)for(let n=0;n<3;n++)r[3*t+n]=e[t][n];const n=[0,1,2,2,3,0],o=[0,0,0,0,0,0],s=[["position",new i.Attribute(r,n,3,!0)],["normal",new i.Attribute([0,0,1],o,3,!0)],["uv0",new i.Attribute([0,0,1,0,1,1,0,1],n,2,!0)],["color",new i.Attribute([255,255,255,255],o,4,!0)]];return new f.Geometry(t,s)},t.createTetrahedronGeometry=function(t,e){Array.isArray(e)||(e=[e,e,e]);const r=new Array(12);for(let t=0;t<4;t++)r[3*t]=T[t][0]*e[0],r[3*t+1]=T[t][1]*e[1],r[3*t+2]=T[t][2]*e[2];return new f.Geometry(t,[["position",new i.Attribute(r,k,3,!0)],["normal",new i.Attribute(O,q,3)]])},t.createTubeGeometry=function(t,e,r,n,o,s){n=n||10,o=null==o||o,p.assert(e.length>1);const a=[],l=[];for(let t=0;t<n;t++){a.push([0,-t-1,-(t+1)%n-1]);const e=t/n*2*Math.PI;l.push([Math.cos(e)*r,Math.sin(e)*r])}return Z(t,l,e,[[0,0,0]],a,o,s)},t.makeOrthoBasisDirUpFallback=N,t.transformInPlace=function(t,r){const n=t.getMutableAttribute("position").data;for(let t=0;t<n.length;t+=3){const o=n[t],s=n[t+1],a=n[t+2];e.set(H,o,s,a),e.transformMat4(H,H,r),n[t]=H[0],n[t+1]=H[1],n[t+2]=H[2]}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});