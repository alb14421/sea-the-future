// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/arrayUtils","../../../../core/compilerUtils","../../../../core/Evented","../../../../core/Handles","../../../../core/has","../../../../core/maybe","../../../../core/uid","./DirtyEvents","./Octree"],function(e,t,s,i,r,o,d,c,h,l){"use strict";e.WebGLLayer=class{constructor(e,t,s=""){this.stage=e,this.apiLayerViewUid=s,this.id=c.generateUID(),this.events=new i.EventEmitter,this.visible=!0,this.sliceable=!1,this._objectsAdded=new Array,this._handles=new r,this._objects=new Map,this._pickable=!0,this.visible=t?.visible??!0,this._pickable=t?.pickable??!0,this.updatePolicy=t?.updatePolicy??0,e.addLayer(this);for(const t of h.DirtyEventNames)this._handles.add(this.events.on(t,s=>e.handleEvent(t,s)))}destroy(){this._handles.size&&(this._handles.destroy(),this.stage.removeLayer(this),this.invalidateSpatialQueryAccelerator())}get objects(){return this._objects}getObject(e){return s.toConst(this._objects.get(e))}set pickable(e){this._pickable=e}get pickable(){return this._pickable&&this.visible}add(e){this._objects.set(e.id,e),e.layer=this,this.events.emit("layerObjectAdded",e),null!=this._octree&&this._objectsAdded.push(e)}remove(e){this._objects.delete(e.id)&&(this.events.emit("layerObjectRemoved",e),e.layer=null,null!=this._octree&&(t.removeUnordered(this._objectsAdded,e)||this._octree.remove([e])))}addMany(e){for(const t of e)this._objects.set(t.id,t),t.layer=this;this.events.emit("layerObjectsAdded",e),null!=this._octree&&this._objectsAdded.push(...e)}removeMany(e){const s=new Array;for(const t of e)this._objects.delete(t.id)&&s.push(t);if(0!==s.length&&(this.events.emit("layerObjectsRemoved",s),s.forEach(e=>e.layer=null),null!=this._octree)){for(let e=0;e<s.length;)t.removeUnordered(this._objectsAdded,s[e])?(s[e]=s[s.length-1],s.length-=1):++e;this._octree.remove(s)}}sync(){1!==this.updatePolicy&&this.stage.syncLayer(this.id)}notifyObjectBBChanged(e,t){null==this._octree||this._objectsAdded.includes(e)||this._octree.update(e,t)}getSpatialQueryAccelerator(){return null==this._octree&&this._objects.size>50?(this._octree=new l.Octree(e=>e.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.values())):null!=this._octree&&this._objectsAdded.length>0&&(this._octree.add(this._objectsAdded),this._objectsAdded.length=0),this._octree}invalidateSpatialQueryAccelerator(){this._octree=d.destroyMaybe(this._octree),this._objectsAdded.length=0}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});