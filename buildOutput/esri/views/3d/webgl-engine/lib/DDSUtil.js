// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/Logger","../../../webgl/enums","../../../webgl/Texture"],function(e,t,r,n){"use strict";const a=()=>t.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil");function o(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}const s=o("DXT1"),u=o("DXT3"),i=o("DXT5");function l(e,t){const n=new Int32Array(e.buffer,e.byteOffset,31);if(542327876!==n[0])return a().error("Invalid magic number in DDS header"),null;if(!(4&n[20]))return a().error("Unsupported format, must contain a FourCC code"),null;const o=n[21];let l,c;switch(o){case s:l=8,c=r.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case u:l=16,c=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case i:l=16,c=r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return a().error("Unsupported FourCC code:",(d=o,String.fromCharCode(255&d,d>>8&255,d>>16&255,d>>24&255))),null}var d;let h=1,m=n[4],f=n[3];(3&m||3&f)&&(a().warn("Rounding up compressed texture size to nearest multiple of 4."),m=m+3&-4,f=f+3&-4);const D=m,g=f;let p,T;131072&n[2]&&!1!==t&&(h=Math.max(1,n[7]));let C=e.byteOffset+n[1]+4;const S=[];for(let t=0;t<h;++t)T=(m+3>>2)*(f+3>>2)*l,p=new Uint8Array(e.buffer,C,T),S.push(p),C+=T,m=Math.max(1,m>>1),f=Math.max(1,f>>1);return{textureData:{type:"compressed",levels:S},internalFormat:c,width:D,height:g}}e.createDDSTexture=function(e,t,r){const a=l(r,t.hasMipmap??!1);if(null==a)throw new Error("DDS texture data is null");const{textureData:o,internalFormat:s,width:u,height:i}=a;return t.samplingMode=o.levels.length>1?9987:9729,t.hasMipmap=o.levels.length>1,t.internalFormat=s,t.width=u,t.height=i,new n.Texture(e,t,o)},e.createDDSTextureData=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});