// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../core/libs/gl-matrix-2/factories/vec4f64","../../support/buffer/glUtil","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../core/shaderLibrary/attributes/VertexNormal.glsl","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../effects/geometry/olidUtils","../lib/OrderIndependentTransparency","../lib/StencilUtils","../lib/lodRendering/RenderInstanceData","../materials/pbrUtils","../../../../chunks/DefaultMaterial.glsl","../../../webgl/renderState","../../../webgl/VertexAttributeLocations","../../../../webscene/support/AlphaCutoff"],function(e,t,i,s,r,a,l,o,n,c,u,h,d,p,f,m,g,v,b){"use strict";class y extends o.VertexNormalPassParameters{constructor(){super(...arguments),this.isSchematic=!1,this.usePBR=!1,this.mrrFactors=f.advancedMRRFactors,this.hasVertexColors=!1,this.hasSymbolColors=!1,this.doubleSided=!1,this.doubleSidedType="normal",this.cullFace=2,this.instanced=!1,this.instancedFeatureAttribute=!1,this.instancedColor=!1,this.instanceColorEncodesAlphaIgnore=!1,this.emissiveStrength=0,this.emissiveSource=1,this.emissiveBaseColor=i.ZEROS,this.instancedDoublePrecision=!1,this.normalType=0,this.receiveShadows=!0,this.receiveAmbientOcclusion=!0,this.castShadows=!0,this.ambient=i.freeze(.2,.2,.2),this.diffuse=i.freeze(.8,.8,.8),this.externalColor=s.fromValues(1,1,1,1),this.colorMixMode="multiply",this.opacity=1,this.layerOpacity=1,this.origin=i.create(),this.hasSlicePlane=!1,this.offsetTransparentBackfaces=!1,this.vvSize=null,this.vvColor=null,this.vvOpacity=null,this.vvSymbolAnchor=null,this.vvSymbolRotationMatrix=null,this.modelTransformation=null,this.drivenOpacity=!1,this.writeDepth=!0,this.customDepthTest=0,this.textureAlphaMode=0,this.textureAlphaCutoff=b.alphaCutoff,this.textureAlphaPremultiplied=!1,this.renderOccluded=1,this.isDecoration=!1}get hasVVSize(){return!!this.vvSize}get hasVVColor(){return!!this.vvColor}get hasVVOpacity(){return!!this.vvOpacity}}class S extends o.VertexNormalDrawParameters{constructor(){super(...arguments),this.origin=i.create(),this.slicePlaneLocalOrigin=this.origin}}class P extends c.ShaderTechnique{constructor(t,i,s=new n.ReloadableShaderModule(m.DefaultMaterial,()=>new Promise((t,i)=>e(["./DefaultMaterial.glsl"],t,i)))){const a=[r.glLayout(x(i))];i.instanced&&i.instancedDoublePrecision&&a.push(r.glLayout(p.getRenderInstanceDataLayout(i))),super(t,i,s,v.fromLayouts(a))}_makePipeline(e,t){const{oitPass:i,output:s,transparent:r,cullFace:a,customDepthTest:o,hasOccludees:n}=e;return g.makePipelineState({blending:l.isColorOrColorEmission(s)&&r?h.blending(i):null,culling:(u=e,0===u.cullFace&&(u.hasSlicePlane||u.transparent||u.doubleSidedMode)?null:g.cullingParams(a)),depthTest:{func:h.oitDepthTest(i,(p=o,1===p?515:513))},depthWrite:h.depthWrite(e),drawBuffers:c.depthOnlyOutputBuffersOr(s,h.getDrawBuffers(i,s)),colorWrite:g.defaultColorWrite,stencilWrite:n?d.stencilWriteMaskOn:null,stencilTest:n?t?d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null,polygonOffset:h.oitPolygonOffset(e)});var u,p}initializePipeline(e){return this._occludeePipelineState=this._makePipeline(e,!0),this._makePipeline(e,!1)}getPipeline(e){return e?this._occludeePipelineState:super.getPipeline()}}function x(e){const t=a.newLayout().vec3f("position");return 1===e.normalType?t.vec2i16("normalCompressed",{glNormalized:!0}):t.vec3f("normal"),e.hasVertexTangents&&t.vec4f("tangent"),e.hasTextures&&t.vec2f16("uv0"),e.hasVertexColors&&t.vec4u8("color"),e.hasSymbolColors&&t.vec4u8("symbolColor"),!e.instanced&&u.olidEnabled()&&t.vec4u8("olidColor"),t}t.DefaultMaterialDrawParameters=S,t.DefaultMaterialPassParameters=y,t.DefaultMaterialTechnique=P,t.getLayout=x,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});