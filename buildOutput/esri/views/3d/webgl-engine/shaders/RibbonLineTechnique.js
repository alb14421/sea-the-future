// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/has","../../support/buffer/InterleavedLayout","../core/shaderLibrary/ShaderOutput","../core/shaderTechnique/ReloadableShaderModule","../core/shaderTechnique/ShaderTechnique","../effects/geometry/olidUtils","../lib/OrderIndependentTransparency","../lib/StencilUtils","../../../../chunks/RibbonLine.glsl","../../../webgl/enums","../../../webgl/renderState"],function(e,t,i,l,r,n,s,a,o,u,c,p,d){"use strict";class f extends s.ShaderTechnique{constructor(t,i){super(t,i,new n.ReloadableShaderModule(c.RibbonLine,()=>new Promise((t,i)=>e(["./RibbonLine.glsl"],t,i))),P(i).locations),this.primitiveType=i.wireframe?p.PrimitiveType.LINES:p.PrimitiveType.TRIANGLE_STRIP}_makePipelineState(e,t){const{oitPass:i,output:l,hasOccludees:n,hasPolygonOffset:a}=e,c=0===i,p=2===i;return d.makePipelineState({blending:r.isColorOrColorEmission(l)?o.blending(i):null,depthTest:{func:o.oitDepthTest(i)},depthWrite:o.depthWrite(e),drawBuffers:s.depthOnlyOutputBuffersOr(l,o.getDrawBuffers(i,l)),colorWrite:d.defaultColorWrite,stencilWrite:n?u.stencilWriteMaskOn:null,stencilTest:n?t?u.stencilToolMaskBaseParams:u.stencilBaseAllZerosParams:null,polygonOffset:c||p?a?h:null:o.OITPolygonOffset})}initializePipeline(e){if(e.occluder){const t=e.hasPolygonOffset?h:null,{output:i,hasOccludees:l}=e;this._occluderPipelineTransparent=d.makePipelineState({blending:d.unpremultipliedAlphaToPremultipliedAlpha,polygonOffset:t,depthTest:u.depthCompareAlways,depthWrite:null,colorWrite:d.defaultColorWrite,stencilWrite:null,stencilTest:l?u.stencilToolTransparentOccluderParams:null,drawBuffers:s.depthOnlyOutputBuffersOr(i)}),this._occluderPipelineOpaque=d.makePipelineState({blending:d.unpremultipliedAlphaToPremultipliedAlpha,polygonOffset:t,depthTest:l?u.depthCompareAlways:u.depthCompareLess,depthWrite:null,colorWrite:d.defaultColorWrite,stencilWrite:l?u.stencilWriteMaskOff:null,stencilTest:l?u.stencilToolMaskOccluderParams:null,drawBuffers:s.depthOnlyOutputBuffersOr(i)}),this._occluderPipelineMaskWrite=d.makePipelineState({blending:null,polygonOffset:t,depthTest:u.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:l?u.stencilWriteMaskOn:null,stencilTest:l?u.stencilToolMaskBaseParams:null,drawBuffers:s.depthOnlyOutputBuffersOr(i)})}return this._occludeePipeline=this._makePipelineState(e,!0),this._makePipelineState(e,!1)}getPipeline(e,t){if(e)return this._occludeePipeline;switch(t){case 11:return this._occluderPipelineTransparent??super.getPipeline();case 10:return this._occluderPipelineOpaque??super.getPipeline();default:return this._occluderPipelineMaskWrite??super.getPipeline()}}}const h={factor:0,units:-4};function P(e){const t=l.newLayout().vec3f("position").vec4f16("previousDelta").vec4f16("nextDelta").f32("u0").vec2f16("lineParameters");return e.hasVVColor?t.f32("colorFeatureAttribute"):t.vec4u8("color",{glNormalized:!0}),e.hasVVSize?t.f32("sizeFeatureAttribute"):t.f32("size"),e.hasVVOpacity&&t.f32("opacityFeatureAttribute"),a.olidEnabled()&&t.vec4u8("olidColor"),e.hasAnimation&&t.vec3f16("timeStamps"),t}t.RibbonLineTechnique=f,t.getLayout=P,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});