// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/PooledArray","../../../../webgl/enums"],function(e,t,i){"use strict";const r=new Map;r.set(i.DataType.UNSIGNED_BYTE,1),r.set(i.DataType.UNSIGNED_SHORT,2),r.set(i.DataType.UNSIGNED_INT,4),e.RenderPass=class{constructor(e,i,r=0){this._rctx=e,this._techniques=i,this._sorting=r,this._draws=new t({allocator:e=>e??{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}}),this._previouslyBoundDraw=new Map}submitDraw(e,t,i,r,s){const a=this._draws.pushNew();a.geometry=t,a.geometryRanges=i,a.material=e,a.depthSquaredHint=r,a.indexType=(t.indexed?t.vao.indexBuffer.indexType:null)??0,a.highlightName=s}acquire(e,t){return this._draws.map(i=>i.material.acquireTechnique(this._techniques,e,t,i.geometry.parameters))}dispatch(e,t,i){const s=this._rctx;this._previouslyBoundDraw.clear();let a=null;const n=this._draws.length,o=t.highlight?.name;for(let h=0;h<n;h++){const n=this._draws.data[h];if(2===e.identifier){const e=n.highlightName;if(e){if(e!==o)continue}else if(!o||!t.overlay?.hasHighlight(o))continue}const l=i[h];l===a&&0===t.oitPass||(s.bindTechnique(l,t,e),a=l);const{geometryRanges:d,indexType:u,geometry:c,material:g}=n;s.bindVAO(c.vao),this._previouslyBoundDraw.get(l)!==g&&(l.program.bindDraw(t,e,g),this._previouslyBoundDraw.set(l,g));const m=d.length,{primitiveType:p}=c;for(let e=0;e<m;e+=2){const t=d[e],i=d[e+1];if(0!==u){const e=r.get(u);s.drawElements(p,i,u,t*e)}else s.drawArrays(p,t,i)}}}prepareSubmit(){this._draws.clear()}finishSubmit(){const e=0===this._sorting?1:-1;this._draws.sort((t,i)=>e*(t.depthSquaredHint-i.depthSquaredHint)||t.geometry.vao.usedMemory-i.geometry.vao.usedMemory)}get count(){return this._draws.length}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});