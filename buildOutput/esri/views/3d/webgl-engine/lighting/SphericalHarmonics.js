// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/mathUtils","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../lib/LongVectorMath","./Lightsources"],function(t,n,e,i,o,r){"use strict";function c(t){return(t+1)*(t+1)}function s(t){return n.clamp(Math.floor(Math.sqrt(t)-1),0,2)}function a(t,n,e){const i=t[0],o=t[1],r=t[2],s=e||[];return s.length=c(n),n>=0&&(s[0]=.28209479177),n>=1&&(s[1]=.4886025119*i,s[2]=.4886025119*r,s[3]=.4886025119*o),n>=2&&(s[4]=1.09254843059*i*o,s[5]=1.09254843059*o*r,s[6]=.31539156525*(3*r*r-1),s[7]=1.09254843059*i*r,s[8]=.54627421529*(i*i-o*o)),s}function f(t,n){const e=c(t),i=n||{r:[],g:[],b:[]};i.r.length=i.g.length=i.b.length=e;for(let t=0;t<e;t++)i.r[t]=i.g[t]=i.b[t]=0;return i}function h(t,n){const i=s(n.r.length);for(const r of t)e.negate(p,r.direction),a(p,i,b),o.elementwiseProduct(b,y),o.scalarProduct(b,r.intensity[0],m),o.add(n.r,m),o.scalarProduct(b,r.intensity[1],m),o.add(n.g,m),o.scalarProduct(b,r.intensity[2],m),o.add(n.b,m);return n}function g(t,n){a(p,0,b);for(const e of t)n.r[0]+=b[0]*y[0]*e.intensity[0]*4*Math.PI,n.g[0]+=b[0]*y[0]*e.intensity[1]*4*Math.PI,n.b[0]+=b[0]*y[0]*e.intensity[2]*4*Math.PI;return n}const u=[],l=[],d=[],b=[0],m=[0],p=i.create(),y=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];t.combineLights=function(t,n,i,c){f(n,c),e.set(i.intensity,0,0,0);let s=!1;const a=u,b=l,m=d;a.length=0,b.length=0,m.length=0;for(const n of t)n instanceof r.MainLight&&!s?(e.copy(i.direction,n.direction),e.copy(i.intensity,n.intensity),i.specularStrength=n.specularStrength,i.environmentStrength=n.environmentStrength,i.castShadows=n.castShadows,s=!0):n instanceof r.MainLight||n instanceof r.FillLight?a.push(n):n instanceof r.AmbientLight?b.push(n):n instanceof r.SphericalHarmonicsAmbientLight&&m.push(n);h(a,c),g(b,c);for(const t of m)o.add(c.r,t.r),o.add(c.g,t.g),o.add(c.b,t.b)},t.computeCoefficients=a,t.initSHCoefficients=f,t.numberOfCoefficients=c,t.orderFromNumberOfCoefficients=s,t.projectAmbientLights=g,t.projectFillLights=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});