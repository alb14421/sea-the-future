// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/tslib.es6","../../../../../assets","../../../../../core/Accessor","../../../../../core/asyncUtils","../../../../../core/Logger","../../../../../core/maybe","../../../../../core/promiseUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../support/requestImageUtils","../../../../webgl/NoParameters","../../../../webgl/Texture","../../../../webgl/TextureDescriptor"],function(e,r,s,t,a,o,i,c,u,p,l,n,m,d,g,h){"use strict";e.WaterTextureRepository=class extends t{constructor(){super(...arguments),this._passParameters=new _,this._resourcesTask=null}get passParameters(){return this._passParameters}destroy(){this._resourcesTask=i.abortMaybe(this._resourcesTask),this._passParameters.waveNormal=i.disposeMaybe(this._passParameters.waveNormal),this._passParameters.wavePerturbation=i.disposeMaybe(this._passParameters.wavePerturbation)}get updating(){return!!this._resourcesTask&&!this._resourcesTask.finished}ensureResources(e){return this._resourcesTask||(this._resourcesTask=a.createTask(async r=>{await Promise.allSettled([this._loadImageResource(e,s.getAssetUrl("esri/images/materials/water/normals.jpg"),e=>this._passParameters.waveNormal=e,r),this._loadImageResource(e,s.getAssetUrl("esri/images/materials/water/perturbation.jpg"),e=>this._passParameters.wavePerturbation=e,r)])})),this._resourcesTask.finished?2:1}async _loadImageResource(e,r,s,t){try{const a=await m.requestImage(r,{signal:t});c.throwIfAborted(t);const o=new h.TextureDescriptor(a.width,a.height);o.pixelFormat=6407,o.samplingMode=9987,o.hasMipmap=!0,o.maxAnisotropy=8,s(new g.Texture(e,o,a))}catch(e){o.getLogger(this).error("Failed to load water material normal texture.",e)}}},r.__decorate([u.property()],e.WaterTextureRepository.prototype,"_resourcesTask",void 0),r.__decorate([u.property({type:Boolean,readOnly:!0})],e.WaterTextureRepository.prototype,"updating",null),e.WaterTextureRepository=r.__decorate([n.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],e.WaterTextureRepository);class _ extends d.NoParameters{}e.WaterTexturePassParameters=_,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});