// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/libs/gl-matrix-2/factories/vec4f64","../core/shaderLibrary/ShaderOutput","../lib/GLMaterial","../lib/OrderIndependentTransparency","./DefaultBufferWriter","./TriangleMaterial","./VisualVariablePassParameters","../shaders/ColorMaterialTechnique","../shaders/ColorMaterialTechniqueConfiguration","../../../../webscene/support/AlphaCutoff"],function(e,t,r,s,i,a,o,n,h,l,u){"use strict";class p extends o.TriangleMaterial{constructor(e){super(e,f),this._configuration=new l.ColorMaterialTechniqueConfiguration,this.supportsEdges=!0,this.produces=new Map([[2,e=>this._isOpaqueMaterialPass(e)],[3,e=>this._isOpaqueNoSSAODepthPass(e)],[4,e=>r.isColorOrColorEmissionOrOID(e)&&this._transparent&&this.parameters.writeDepth],[5,e=>r.isDepth(e)&&this._transparent&&this.parameters.writeDepth],[8,e=>r.isColorOrColorEmissionOrOID(e)&&this._transparent&&!this.parameters.writeDepth],[18,e=>r.is2DGeometryOutput(e)]])}getConfiguration(e,t){return super.getConfiguration(e,t,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(e)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=t.hasOccludees,this._configuration.oitPass=t.oitPass,this._configuration.enableOffset=t.camera.relativeElevation<i.OITPolygonOffsetLimit,this._configuration.terrainDepthTest=t.terrainDepthTest&&r.isColorOrColorEmission(e),this._configuration.cullAboveTerrain=t.cullAboveTerrain,this._configuration.hasVVColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=u.alphaCutoff}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(e){return this._isOpaqueMaterialPass(e)||this._isOpaqueNoSSAODepthPass(e)}_isOpaqueMaterialPass(e){return 8===e||r.isColorOrColorEmissionOrOID(e)&&!this._transparent}_isOpaqueNoSSAODepthPass(e){return r.isDepth(e)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(e){return new c(e)}createBufferWriter(){return new a.DefaultBufferWriter(h.getLayout(this.parameters))}}class c extends s{beginSlot(e){return this.getTechnique(h.ColorMaterialTechnique,e)}}class f extends n.VisualVariablePassParameters{constructor(){super(...arguments),this.color=t.ZEROS,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=0,this.draped=!1,this.discardInvisibleFragments=!1}}e.ColorMaterial=p,e.Parameters=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});