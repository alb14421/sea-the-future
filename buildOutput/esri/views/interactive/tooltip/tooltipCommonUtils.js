// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/asyncUtils","../../../core/handleUtils","../../../core/mathUtils","../../../core/quantityUtils","../../../core/reactiveUtils","../../../core/unitUtils","../../../chunks/vec32","../../../core/libs/gl-matrix-2/factories/vec3f64","../../../geometry/coordinateFormatter","../../../geometry/support/MeshTransform","../../../geometry/support/meshVertexSpaceUtils","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils","../keybindings","../Tooltip","./fields/parsingAndFormattingUtils","../../support/angularMeasurementUtils"],function(e,t,n,a,o,l,r,i,s,u,c,p,f,g,d,m,v,y){"use strict";const h=[0,0];function x(e){return i.equals(e,s.UNIT_Z)?1:i.equals(e,U)?-1:null}const U=i.negate(s.create(),s.UNIT_Z);function b(e){return e?Math.max(...e.scale):1}function S(e,t,n){if(!t||!("geographic"in t))return;const a=e.clipboardData?.getData("text");if(!a)return;const o=t=>{e.stopPropagation(),e.preventDefault(),n?.onBeforePaste(),t(),n?.onAfterPaste()};if(t.geographic){const e=v.parseLatitudeLongitude(a);e&&o(()=>{t.longitude.applyValue(e.longitude),t.latitude.applyValue(e.latitude)})}else{const e=v.parseXY(a);e&&o(()=>{t.x.applyValue(e.x),t.y.applyValue(e.y)})}}e.connectPasteEvent=function(e,a){let o=null;return n.handlesGroup([e.on("paste",n=>{o?.abort(),o=t.createTask(async()=>{u.isLoaded()||await u.load(),S(n,e.info,a)})}),t.createTask(()=>u.load()),n.makeHandle(()=>o?.abort())])},e.enterInputModeIfAvailable=function(e,t){return!("key-down"!==e.type||e.key!==d.tooltipKeys.enterInputMode||!t||!function(e){const t=e?.sketchOptions;if(!t)return!1;const{inputEnabled:n,visibleElements:a}=t.tooltips;return n&&!0===e.editableFields.some(({name:e})=>"x"===e||"y"===e?a.coordinates:a[e])}(t.info)||(t.enterInputMode(),e.preventDefault(),e.stopPropagation(),0))},e.getXYZDeltasFromTooltipInfo=function(e,t){const{x:n,y:l,z:i}=t,{x:s,y:u,z:c}=function(e,t){let n,a;e.geographic?(n=y.getDegreesGeographic(e.longitude.actual),a=y.getDegreesGeographic(e.latitude.actual),f.isWebMercator(t)&&(null!=n&&null!=a?[n,a]=g.lngLatToXY(n,a,h):null!=n?n=g.lngLatToXY(n,0,h)[0]:null!=a&&(a=g.lngLatToXY(0,a,h)[1]))):(n=e.x.actual?.value,a=e.y.actual?.value);const l=e.elevation.actual,i=r.verticalLengthUnitFromSpatialReference(t);return{x:n,y:a,z:null!=i&&null!=l?o.valueInUnit(l,i):void 0}}(e,t.spatialReference);return{dx:null==s||a.floatEqualUlp(s,n)?0:s-n,dy:null==u||a.floatEqualUlp(u,l)?0:u-l,dz:null==c||null==i||a.floatEqualUlp(c,i)?0:c-i}},e.makeTooltip=function(e){const t=new m(e());return t.addHandles(l.watch(()=>e(),({view:e,options:n,info:a})=>{t.view=e,void 0!==n&&(t.options=n),void 0!==a&&(t.info=a)})),t},e.pasteLocation=S,e.updateMeshTransformFromTooltipInfo=function(e,t,n){if(!t||!p.isRelativeVertexSpace(t.vertexSpace))return;const a=t.transform??=new c;!function(e,t,n){const a=y.getDegreesArithmetic(e.orientation.actual),o=x(t.rotationAxis);if(null==a||null==o)return;const l=t.rotationAngle,r=a*o,i=(a-l)*o;l!==r&&(n?.onRotateStart(0),t.rotationAngle=r,n?.onRotate(i),n?.onRotateStop(i))}(e,a,n),function(e,t,n){const a=e.scale.actual?.value,o=b(t);if(null==a||a===o)return;const{scale:l}=t;let r;if(0===o)r=s.clone(s.ONES);else{const e=a/o;r=i.scale(s.create(),l,e)}n?.onScaleStart(l[0],l[1],l[2]),t.scale=r,n?.onScale(r[0],r[1],r[2]),n?.onScaleStop(r[0],r[1],r[2])}(e,a,n)},e.updateTooltipInfoFromMeshTransform=function(e,t){const n=p.isRelativeVertexSpace(t.vertexSpace),{scale:a,orientation:l}=e,{transform:r}=t,i=function(e){if(!e)return 0;const t=x(e.rotationAxis);return null!=t?t*e.rotationAngle:null}(r);n&&null!=i?(l.actual=o.createAngle(i,"degrees","arithmetic"),l.visible=!0):(l.actual=null,l.visible=!1),n?(a.actual=o.createScalar(b(r)),a.visible=!0):(a.actual=null,a.visible=!1)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});