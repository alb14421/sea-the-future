// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/reactiveUtils","../../../core/SetUtils","../../../core/sql","../../../core/timeUtils","../../../chunks/vec32","../../../layers/graphics/dehydratedPoint","../../../rest/support/Query","../../input/InputManager","../keybindings","../sketch/normalizedPoint","../../../webmap/utils"],function(e,t,n,i,r,o,s,a,c,l,d,p){"use strict";const g=Symbol("grid-placement-graphic");function u(e,t){const n=e.x-t.x,i=e.y-t.y;return n*n+i*i}const y=Symbol("snapping-toggle");e.editEdgeToSnappingEdge=function(e,t,n){return{left:d.fromAnyMapPoint(e.leftVertex.pos,t,n),right:d.fromAnyMapPoint(e.rightVertex.pos,t,n)}},e.gridPlacementGraphicSymbol=g,e.isUtilityNetworkWebMap=function(e){return p.isWebMap(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length},e.makeSnappingQuery=function({parameters:{point:e,distance:t,returnEdge:o,vertexMode:c,coordinateHelper:{spatialReference:l},filter:d},mode:p,returnZ:g,filter:u}){const y=u?.clone()??new a({where:"1=1"});return y.returnZ=g??"3d"===p,d&&(y.geometry=d.geometry,y.distance=d.distance,y.spatialRelationship=d.spatialRelationship,y.where=i.sqlAnd(y.where,d.where),y.timeExtent=r.mergeTimeExtents(y.timeExtent,d.timeExtent),y.objectIds=(m=y.objectIds,h=d.objectIds,m||h?h?m?Array.from(n.intersection(new Set(m),new Set(h))):h:m:null)),{point:s.makeDehydratedPoint(e[0],e[1],e[2],l.toJSON()),mode:p,distance:t,returnEdge:o,vertexMode:c,query:y.toJSON()};var m,h},e.objectEqual=function(e,t){const n=e.length===t.length&&e[0]===t[0]&&e[1]===t[1];switch(e.length){case 2:return n;case 3:return n&&e[2]===t[2];case 4:return n&&e[2]===t[2]&&e[3]===t[3]}return!1},e.screenDistance=function(e,t){return Math.sqrt(u(e,t))},e.setupSnappingToggleHandles=function(e,n=()=>{}){const i=t.watch(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:t,snappingOptions:i})=>{if(e.removeHandles(y),!t||!i)return;const r=c.ViewEventPriorities.TOOL,o=[t.on("key-down",e=>{e.key!==l.snappingKeys.toggle||e.repeat||(i.enabledToggled=!0,n())},r),t.on("key-up",e=>{e.key===l.snappingKeys.toggle&&(i.enabledToggled=!1,n())},r),t.on("pointer-move",e=>{const t=e.native.ctrlKey;i.enabledToggled!==t&&(i.enabledToggled=t,n())},r)];e.addHandles(o,y)},t.syncAndInitial);e.addHandles(i)},e.sortCandidatesInPlace=function(e,t){t.sort((t,n)=>o.squaredDistance(t.targetPoint,e)-o.squaredDistance(n.targetPoint,e))},e.squaredScreenDistance=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});