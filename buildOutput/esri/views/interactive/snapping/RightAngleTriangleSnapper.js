// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/libs/gl-matrix-2/math/vec2","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../support/elevationInfoUtils","../sketch/normalizedPoint","./SnappingAlgorithm","./snappingUtils","./candidates/RightAngleTriangleSnappingCandidate","../support/viewUtils","../../support/geometry2dUtils"],function(e,t,i,n,r,o,s,a,p,l){"use strict";class c extends o.SnappingAlgorithm{snapNewVertex(e,t){const i=t.editGeometryOperations.data.parts[0],n=[],o=i.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||o<2)return n;const{view:s}=this,a=i.vertices[0],p=i.vertices[o-1],l=r.fromAnyMapPoint(a.pos,s,t),c=r.fromAnyMapPoint(p.pos,s,t);return this._processCandidateProposal(l,c,e,t,n),n}snapExistingVertex(e,t){const i=[],n=t.vertexHandle,o=n.part;if(o.segments.length<2)return i;if("polyline"===t.editGeometryOperations.data.type&&(0===n.index||n.index===o.vertices.length-1))return i;const{view:s}=this,a=r.fromAnyMapPoint(n.leftSegment.leftVertex.pos,s,t),p=r.fromAnyMapPoint(n.rightSegment.rightVertex.pos,s,t);return this._processCandidateProposal(a,p,e,t,i),i}_processCandidateProposal(e,i,o,c,g){if(!this.exceedsShortLineThreshold(e,i,c))return;const h=t.lerp(d,r.asVec2(e),r.asVec2(i),.5),f=.5*t.distance(r.asVec2(e),r.asVec2(i)),m=l.projectPointToCircle(d,r.asVec2(o),h,f),u=r.markAsTarget(r.fromValues(m[0],m[1],o[2])),{spatialReference:v,pointer:y}=c,x=p.vectorToScreenPoint(o,v,n.absoluteHeightElevationInfo,this.view);if(s.squaredScreenDistance(x,p.vectorToScreenPoint(u,v,n.absoluteHeightElevationInfo,this.view))<this.squaredProximityThreshold(y)){if(this.isVertical(e,u,c)||this.isVertical(u,i,c))return;g.push(new a.RightAngleTriangleSnappingCandidate({targetPoint:u,point1:e,point2:i,isDraped:"on-the-ground"===c.elevationInfo?.mode}))}}}const d=i.create();e.RightAngleTriangleSnapper=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});