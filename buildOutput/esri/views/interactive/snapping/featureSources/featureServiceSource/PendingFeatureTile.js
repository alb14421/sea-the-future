// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/asyncUtils","../../../../../geometry/support/aaBoundingRect"],function(t,e,s){"use strict";const a=s.create();t.PendingFeatureTile=class{constructor(t,e){this.data=t,this.resolution=e,this.state={type:0},this.alive=!0}process(t){switch(this.state.type){case 0:return this.state=this._gotoFetchCount(this.state,t),this.state.task.promise.then(t.resume,t.resume);case 1:case 3:break;case 2:return this.state=this._gotoFetchFeatures(this.state,t),this.state.task.promise.then(t.resume,t.resume);case 4:this.state=this._goToDone(this.state,t)}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case 0:case 1:return 0;case 2:return this.state.featureCount;case 3:return this.state.previous.featureCount;case 4:return this.state.features.length;case 5:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case 0:return"created";case 1:return"fetch-count";case 2:return"fetched-count";case 3:return"fetch-features";case 4:return"fetched-features";case 5:return"done"}}_gotoFetchCount(t,s){return{type:1,previous:t,task:e.createTask(async t=>{const a=await e.resultOrAbort(s.fetchCount(this,t));1===this.state.type&&(this.state=function(t,e){return{type:2,featureCount:e,previous:t}}(this.state,a.ok?a.value:1/0))})}}_gotoFetchFeatures(t,s){return{type:3,previous:t,task:e.createTask(async a=>{const r=await e.resultOrAbort(s.fetchFeatures(this,t.featureCount,a));3===this.state.type&&(this.state=function(t,e){return{type:4,previous:t,features:e}}(this.state,r.ok?r.value:[]))})}}_goToDone(t,e){return e.finish(this,t.features),{type:5,previous:t}}reset(){const t=this.state;switch(this.state={type:0},t.type){case 0:case 2:case 4:case 5:break;case 1:case 3:t.task.abort()}}intersects(t){return null==t||!this.data.extent||(s.fromExtent(t,a),s.intersects(this.data.extent,a))}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});