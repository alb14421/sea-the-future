// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/Evented":function(){define(["exports","./Accessor","./handleUtils"],function(e,t,r){"use strict";const s=e=>{const t=e;return class extends t{constructor(){super(...arguments),this._listenersMap=null}clearEvents(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clearEvents()}emit(e,t){let r=this._listenersMap?.get(e);if(!r)return!1;let s=!1;for(const e of r.slice()){const r="deref"in e?e.deref():e;r?r?.call(this,t):s=!0}return s&&(r=r.filter(e=>!("deref"in e)||null!=e.deref()),this._listenersMap.set(e,r)),r.length>0}on(e,t){if(Array.isArray(e)){const s=e.map(e=>this.on(e,t));return r.handlesGroup(s)}if(e.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const s=this._listenersMap.get(e)||[];return s.push(t),this._listenersMap.set(e,s),r.makeHandle(()=>{const r=this._listenersMap?.get(e),s=r?.indexOf(t)??-1;s>=0&&r.splice(s,1)})}once(e,t){const r=this.on(e,e=>{r.remove();const s="deref"in t?t.deref():t;s?.call(null,e)});return r}hasEventListener(e){const t=this._listenersMap?.get(e);return null!=t&&t.length>0}}},i=s(class{}),n=i,o=s(t);e.EventEmitter=n,e.Evented=i,e.EventedAccessor=o,e.EventedMixin=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/support/UpdatingHandles":function(){define(["exports","../../chunks/tslib.es6","../Accessor","../handleUtils","../reactiveUtils","../scheduling","../accessorSupport/decorators/property","../accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a){"use strict";e.UpdatingHandles=class extends r{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,t,r={}){return this._installWatch(e,t,r,i.watch)}addWhen(e,t,r={}){return this._installWatch(e,t,r,i.when)}addOnCollectionChange(e,t,{initial:r=!1,final:n=!1}={}){const o=++this._handleId;return this.addHandles([i.on(e,"after-changes",this._createSyncUpdatingCallback(),i.sync),i.on(e,"change",t,{onListenerAdd:r?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:n?e=>t({added:[],removed:e.toArray()}):void 0})],o),s.makeHandle(()=>this.removeHandles(o))}addPromise(e){if(null==e)return e;const t=++this._handleId;this.addHandles(s.makeHandle(()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(l)||this._set("updating",!1))}),t),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(t);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,t,r={},i){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=i(e,t,r);return this.addHandles(o,n),s.makeHandle(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),s=i.watch(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,t),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(l),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(n.schedule(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(l))}),l)}}},t.__decorate([o.property({readOnly:!0})],e.UpdatingHandles.prototype,"updating",void 0),e.UpdatingHandles=t.__decorate([a.subclass("esri.core.support.UpdatingHandles")],e.UpdatingHandles);const l=-42;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/executeQueryForSnapping":function(){define(["exports","../../../core/lang","../../../core/promiseUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","./projectionSupport","./QueryEngine","./QueryEngineResult","./queryUtils","./queryValidationUtils","./spatialQuerySupport"],function(e,t,r,s,i,n,o,a,l,u,c,d){"use strict";e.executeQueryForSnapping=async function(e,h,p){const f=r.signalFromSignalOrOptions(p),{point:m,distance:y,returnEdge:g,vertexMode:_}=h;if(!g&&"none"===_)return{candidates:[]};let b=t.clone(h.query);b=await e.schedule(()=>u.normalizeQueryLike(b,e.definitionExpression,e.spatialReference),f),b=await e.reschedule(()=>c.validateQuery(b,{availableFields:e.availableFields,fieldsIndex:e.fieldsIndex,geometryType:e.geometryType,spatialReference:e.spatialReference}),f);const S=!n.equals(m.spatialReference,e.spatialReference);S&&await o.checkProjectionSupport(m.spatialReference,e.spatialReference);const v="number"==typeof y?y:y.x,x="number"==typeof y?y:y.y,T={xmin:m.x-v,xmax:m.x+v,ymin:m.y-x,ymax:m.y+x,spatialReference:m.spatialReference},F=S?o.project(T,e.spatialReference):T;if(!F)return{candidates:[]};const I=(await i.normalizeCentralMeridian(s.fromJSON(m),null,{signal:f}))[0],M=(await i.normalizeCentralMeridian(s.fromJSON(F),null,{signal:f}))[0];if(null==I||null==M)return{candidates:[]};const w=new l.QueryEngineResult(await e.reschedule(()=>e.searchFeatures(a.getQueryBBoxes(M.toJSON())),f),b,e);await e.reschedule(()=>e.executeObjectIdsQuery(w),f),await e.reschedule(()=>e.executeTimeQuery(w),f),await e.reschedule(()=>e.executeAttributesQuery(w),f),await e.reschedule(()=>async function(e,t,r){const{query:s}=t,{spatialRel:i}=s;if(!t?.items?.length||!s.geometry||!i)return;const n=await d.getSpatialQueryOperator(i,s.geometry,e.geometryType,e.hasZ,e.hasM),o=await e.runSpatialFilter(t.items,e=>n(e.geometry),r);t.items=o}(e,w,f),f);const R=I.toJSON(),E=S?o.project(R,e.spatialReference):R,O=S?Math.max(F.xmax-F.xmin,F.ymax-F.ymin)/2:y;return w.createSnappingResponse({...h,point:E,distance:O},b.returnZ,m.spatialReference)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtils":function(){define(["exports","../../config","../../core/Error","../../core/Logger","../Polygon","../Polyline","./normalizeUtilsCommon","./spatialReferenceUtils","./webMercatorUtils","../../rest/geometryService/cut","../../rest/geometryService/simplify"],function(e,t,r,s,i,n,o,a,l,u,c){"use strict";const d=()=>s.getLogger("esri.geometry.support.normalizeUtils");function h(e){return"polygon"===e[0].type}function p(e){return"polyline"===e[0].type}function f(e){const t=[];let r=0,s=0;for(let i=0;i<e.length;i++){const n=e[i];let o=null;for(let e=0;e<n.length;e++)o=n[e],t.push(o),0===e?(r=o[0],s=r):(r=Math.min(r,o[0]),s=Math.max(s,o[0]));o&&t.push([(r+s)/2,0])}return t}function m(e,t){if(!(e instanceof n||e instanceof i)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw d().error(e),new r("internal:geometry",e)}const s=o.getGeometryParts(e),a=[];for(const e of s){const r=[];a.push(r),r.push([e[0][0],e[0][1]]);for(let s=0;s<e.length-1;s++){const i=e[s][0],n=e[s][1],o=e[s+1][0],a=e[s+1][1],l=Math.sqrt((o-i)*(o-i)+(a-n)*(a-n)),u=(a-n)/l,c=(o-i)/l,d=l/t;if(d>1){for(let e=1;e<=d-1;e++){const s=e*t,o=c*s+i,a=u*s+n;r.push([o,a])}const e=(l+Math.floor(d-1)*t)/2,s=c*e+i,o=u*e+n;r.push([s,o])}r.push([o,a])}}return function(e){return"polygon"===e.type}(e)?new i({rings:a,spatialReference:e.spatialReference}):new n({paths:a,spatialReference:e.spatialReference})}function y(e,t,r){if(t){const t=m(e,1e6);e=l.webMercatorToGeographic(t,!0)}return r&&(e=o.updatePolyGeometry(e,r)),e}function g(e,t,r){if(Array.isArray(e)){const s=e[0];if(s>t){const r=o.offsetMagnitude(s,t);e[0]=s+r*(-2*t)}else if(s<r){const t=o.offsetMagnitude(s,r);e[0]=s+t*(-2*r)}}else{const s=e.x;if(s>t){const r=o.offsetMagnitude(s,t);e=e.clone().offset(r*(-2*t),0)}else if(s<r){const t=o.offsetMagnitude(s,r);e=e.clone().offset(t*(-2*r),0)}}return e}e.getClosestDenormalizedXToReference=function(e,t,r){const s=a.getInfo(r);if(null==s)return e;const[i,n]=s.valid,o=2*n;let l=0,u=0;t>n?l=Math.ceil(Math.abs(t-n)/o):t<i&&(l=-Math.ceil(Math.abs(t-i)/o)),e>n?u=Math.ceil(Math.abs(e-n)/o):e<i&&(u=-Math.ceil(Math.abs(e-i)/o));let c=e+(l-u)*o;const d=c-t;return d>n?c-=o:d<i&&(c+=o),c},e.getDenormalizedExtent=function(e){if(!e)return null;const t=e.extent;if(!t)return null;const r=e.spatialReference&&a.getInfo(e.spatialReference);if(!r)return t;const[s,i]=r.valid,n=2*i,{width:o}=t;let l,{xmin:u,xmax:c}=t;if([u,c]=[c,u],"extent"===e.type||0===o||o<=i||o>n||u<s||c>i)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;l=f(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;l=f(e.paths);break;case"multipoint":l=e.points}const d=t.clone();for(let e=0;e<l.length;e++){let t=l[e][0];t<0?(t+=i,c=Math.max(t,c)):(t-=i,u=Math.min(t,u))}return d.xmin=u,d.xmax=c,d.width<o?(d.xmin-=i,d.xmax-=i,d):t},e.normalizeCentralMeridian=async function e(r,s,f){if(!Array.isArray(r))return e([r],s);s&&"string"!=typeof s&&d().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const m="string"==typeof s?s:s?.url??t.geometryServiceUrl;let _,b,S,v,x,T,F,I,M=0;const w=[],R=[];for(const e of r)if(null!=e)if(_||(_=e.spatialReference,b=a.getInfo(_),S=_.isWebMercator,T=S?102100:4326,v=o.cutParams[T].maxX,x=o.cutParams[T].minX,F=o.cutParams[T].plus180Line,I=o.cutParams[T].minus180Line),b)if("mesh"===e.type)R.push(e);else if("point"===e.type)R.push(g(e.clone(),v,x));else if("multipoint"===e.type){const t=e.clone();t.points=t.points.map(e=>g(e,v,x)),R.push(t)}else if("extent"===e.type){const t=e.clone()._normalize(!1,!1,b);R.push(t.rings?new i(t):t)}else if(e.extent){const t=e.extent,r=o.offsetMagnitude(t.xmin,x)*(2*v);let s=0===r?e.clone():o.updatePolyGeometry(e.clone(),r);t.offset(r,0);let{xmin:i,xmax:n}=t;i=Number(i.toFixed(9)),n=Number(n.toFixed(9)),t.intersects(F)&&n!==v?(M=n>M?n:M,s=y(s,S),w.push(s),R.push("cut")):t.intersects(I)&&i!==x?(M=n*(2*v)>M?n*(2*v):M,s=y(s,S,360),w.push(s),R.push("cut")):R.push(s)}else R.push(e.clone());else R.push(e);else R.push(e);let E=o.offsetMagnitude(M,v),O=-90;const A=E,P=new n;for(;E>0;){const e=360*E-180;P.addPath([[e,O],[e,-1*O]]),O*=-1,E--}if(w.length>0&&A>0){const e=function(e,t){let r=-1;for(let s=0;s<t.cutIndexes.length;s++){const i=t.cutIndexes[s],n=t.geometries[s],a=o.getGeometryParts(n);for(let e=0;e<a.length;e++){const t=a[e];t.some(r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const s=t[e][0];r=s>r?s:r}r=Number(r.toFixed(9));const s=-360*o.offsetMagnitude(r,180);for(let r=0;r<t.length;r++){const t=n.getPoint(e,r);n.setPoint(e,r,t.clone().offset(s,0))}return!0}})}if(i===r){if(h(e))for(const t of o.getGeometryParts(n))e[i]=e[i].addRing(t);else if(p(e))for(const t of o.getGeometryParts(n))e[i]=e[i].addPath(t)}else r=i,e[i]=n}return e}(w,await u.cut(m,w,P,f)),t=[],s=[];for(let i=0;i<R.length;i++){const n=R[i];if("cut"!==n)s.push(n);else{const n=e.shift(),o=r[i];null!=o&&"polygon"===o.type&&o.rings&&o.rings.length>1&&n.rings.length>=o.rings.length?(t.push(n),s.push("simplify")):s.push(S?l.geographicToWebMercator(n):n)}}if(!t.length)return s;const i=await c.simplify(m,t,f),n=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?n.push(t):n.push(S?l.geographicToWebMercator(i.shift()):i.shift())}return n}const C=[];for(let e=0;e<R.length;e++){const t=R[e];if("cut"!==t)C.push(t);else{const e=w.shift();C.push(!0===S?l.geographicToWebMercator(e):e)}}return C},e.normalizeMapX=function(e,t){const r=a.getInfo(t);if(r){const[t,s]=r.valid,i=s-t;if(e<t)for(;e<t;)e+=i;if(e>s)for(;e>s;)e-=i}return e},e.straightLineDensify=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsCommon":function(){define(["exports","../Polyline","../SpatialReference","./jsonUtils"],function(e,t,r,s){"use strict";const i={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new t({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator}),minus180Line:new t({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new t({paths:[[[180,-180],[180,180]]],spatialReference:r.WGS84}),minus180Line:new t({paths:[[[-180,-180],[-180,180]]],spatialReference:r.WGS84})}};function n(e){return s.isPolygon(e)?e.rings:e.paths}e.cutParams=i,e.getGeometryParts=n,e.offsetMagnitude=function(e,t){return Math.ceil((e-t)/(2*t))},e.updatePolyGeometry=function(e,t){const r=n(e);for(const e of r)for(const r of e)r[0]+=t;return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/cut":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","../utils"],function(e,t,r,s,i){"use strict";e.cut=async function(e,n,o,a){const l=i.parseUrl(e),u=n[0].spatialReference,c={...a,responseType:"json",query:{...l.query,f:"json",sr:s.srToRESTValue(u),target:JSON.stringify({geometryType:r.getJsonType(n[0]),geometries:n}),cutter:JSON.stringify(o)}},d=await t(l.path+"/cut",c),{cutIndexes:h,geometries:p=[]}=d.data;return{cutIndexes:h,geometries:p.map(e=>{const t=r.fromJSON(e);return t.spatialReference=u,t})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/utils":function(){define(["require","exports","../config","../kernel","../core/lang","../core/urlUtils","../support/apiKeyUtils"],function(e,t,r,s,i,n,o){"use strict";const a=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));function l(e,t){return e?t&&o.supportsApiKey(e)?t:o.getApiKey(e)??s.id?.findCredential(e)?.token:null}t.asValidOptions=function(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}},t.encode=function e(t,r,s){const i={};for(const n in t){if("declaredClass"===n)continue;const o=t[n];if(null!=o&&"function"!=typeof o)if(Array.isArray(o))i[n]=o.map(t=>e(t));else if("object"==typeof o)if(o.toJSON){const e=o.toJSON(s?.[n]);i[n]=r?e:JSON.stringify(e)}else i[n]=r?o:JSON.stringify(o);else i[n]=o}return i},t.findToken=l,t.getToken=async function(t,i,n){const o=l(t,i);if(o)return o;!s.id&&r.request.useIdentity&&await new Promise((t,r)=>e(["../identity/IdentityManager"],e=>t(a(e)),r));const u=await s.id.getCredential(t,n);return u?.token},t.parseUrl=function(e){return"string"==typeof e?n.urlToObject(e):i.clone(e)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/simplify":function(){define(["exports","../../request","../../core/urlUtils","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","./utils"],function(e,t,r,s,i,n){"use strict";e.simplify=async function(e,o,a){const l="string"==typeof e?r.urlToObject(e):e,u=o[0].spatialReference,c=s.getJsonType(o[0]),d={...a,query:{...l.query,f:"json",sr:i.srToRESTValue(u),geometries:JSON.stringify(n.encodeGeometries(o))}},{data:h}=await t(l.path+"/simplify",d);return n.decodeGeometries(h.geometries,c,u)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],function(e,t){"use strict";e.decodeGeometries=function(e,r,s){const i=t.getGeometryType(r);return e.map(e=>{const t=i.fromJSON(e);return t.spatialReference=s,t})},e.encodeGeometries=function(e){return{geometryType:t.getJsonType(e[0]),geometries:e.map(e=>e.toJSON())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define(["exports","../../../core/arrayUtils","../../../core/promiseUtils","../../../geometry/projectionUtils","../../../geometry/geometryAdapters/json","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils"],function(e,t,r,s,i,n,o){"use strict";const a=[0,0];function l(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,a),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,a),[r.xmax,r.ymax]=e(t.xmax,t.ymax,a),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:u(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:u(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:c(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function u(e,t){const r=[];for(const s of e)r.push(c(s,t));return r}function c(e,t){const r=[];for(const s of e){const e=t(s[0],s[1],[0,0]);r.push(e),s.length>2&&e.push(s[2]),s.length>3&&e.push(s[3])}return r}const d=l.bind(null,o.lngLatToXY),h=l.bind(null,o.xyToLngLat),p=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,s,i){if(!e?.length||!t||!s||n.equals(t,s))return e;const o={geometries:e,inSpatialReference:t,outSpatialReference:s,geographicTransformation:i,resolve:r.createResolver()};return this._jobs.push(o),this._timer??=setTimeout(this._process,10),o.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:a,resolve:l,geographicTransformation:u}=e;o.canProject(r,a)?n.isWebMercator(a)?l(t.map(d)):l(t.map(h)):l(s.projectMany(i.jsonAdapter,t,r,a,u,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};e.checkProjectionSupport=async function(e,r){if(!e||!r)return;const i=Array.isArray(e)?e.map(e=>null!=e.geometry?e.geometry.spatialReference:null).filter(t.isSome):[e];await s.initializeProjection(i.map(e=>({source:e,dest:r})))},e.project=function(e,t,r,a){if(!e)return null;if(r||(r=t,t=e.spatialReference),!n.isValid(t)||!n.isValid(r)||n.equals(t,r))return e;if(o.canProject(t,r)){const t=n.isWebMercator(r)?d(e):h(e);return t.spatialReference=r,t}return s.projectMany(i.jsonAdapter,[e],t,r,null,a)[0]},e.projectMany=function(e,t,r,s){return p.push(e,t,r,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(e){"use strict";const t={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,s){const i=new r(e.getPointX(t),e.getPointY(t),s),n=e.hasZ(t),o=e.hasM(t);return n&&(i.z=e.getPointZ(t)),o&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new s(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new i(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new n(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const s=e.hasZ(t),i=e.hasM(t),n=new o(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(s){const r=e.getZExtent(t);n.zmin=r.vmin,n.zmax=r.vmax}if(i){const r=e.getMExtent(t);n.mmin=r.vmin,n.mmax=r.vmax}return n}};class r{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class s{constructor(e,t,r,s){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class i{constructor(e,t,r,s){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class n{constructor(e,t,r,s){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class o{constructor(e,t,r,s,i){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=s,this.spatialReference=i,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}e.jsonAdapter=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define(["exports","../../../core/arrayUtils","../../../core/compilerUtils","../../../core/Error","../../../core/has","../../../core/lang","../../../core/maybe","../../../core/promiseUtils","../../../core/unitUtils","../../../core/support/jsonUtils","../../../geometry/projectionUtils","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../../../geometry/support/boundsUtils","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../featureConversionUtils","./attributeSupport","./geometryUtils","./projectionSupport","./QueryEngineCache","./QueryEngineCapabilities","./QueryEngineResult","./queryUtils","./queryValidationUtils","./spatialQuerySupport","./timeSupport","../../support/FieldsIndex","../../../views/support/Scheduler"],function(e,t,r,s,i,n,o,a,l,u,c,d,h,p,f,m,y,g,_,b,S,v,x,T,F,I,M,w,R){"use strict";function E(e){if(I.canQueryWithRBush(e)){if(f.isExtent(e))return[h.fromValues(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if(f.isPolygon(e))return e.rings.map(e=>h.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1])))}return[p.getBoundsXY(h.create(),e)]}function O(e,t,r,s,i){const n={xmin:e[0],ymin:e[1],xmax:e[3],ymax:e[4],spatialReference:_.cleanFromGeometryEngine(s)};i&&isFinite(e[2])&&isFinite(e[5])&&(n.zmin=e[2],n.zmax=e[5],n.hasZ=!0);const o=b.project(n,t,r);if(o.spatialReference=_.cleanFromGeometryEngine(r),o.xmax-o.xmin===0){const e=l.getMetersPerUnitForSR(o.spatialReference);o.xmin-=e,o.xmax+=e}if(o.ymax-o.ymin===0){const e=l.getMetersPerUnitForSR(o.spatialReference);o.ymin-=e,o.ymax+=e}if(i&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin===0){const e=l.getMetersPerUnitForSR(o.spatialReference);o.zmin-=e,o.zmax+=e}return o}e.Feature=class{constructor(e,t=null,r,s,i){this.attributes=e,this.geometry=r,this.centroid=s,this.filterFlags=i,this.groupId=-1,this.displayId=t}},e.QueryEngine=class{constructor(e){this._changeHandle=null,this.capabilities={query:v.queryCapabilities},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._cache=e.cache??new S.QueryEngineCache,this.timeInfo=e.timeInfo,this.featureIdInfo=e.featureIdInfo,"object-id"===e.featureIdInfo.type&&(this.objectIdField=e.featureIdInfo.fieldName),this._changeHandle=this.featureStore.events.on("changed",()=>this._clearCache()),this.fieldsIndex=u.isSerializable(e.fieldsIndex)?e.fieldsIndex:w.fromJSON(e.fieldsIndex),!e.availableFields||1===e.availableFields.length&&"*"===e.availableFields[0]?this.availableFields=new Set(this.fieldsIndex.fields.map(e=>e.name)):this.availableFields=new Set(e.availableFields.map(e=>this.fieldsIndex.get(e)?.name).filter(e=>null!=e)),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._changeHandle=o.removeMaybe(this._changeHandle),this._frameTask=o.removeMaybe(this._frameTask),this._clearCache(),o.destroyMaybe(this._cache)}get featureAdapter(){return this.featureStore.featureAdapter}_clearCache(){this._cache.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}async executeQuery(e,t){const r=a.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{},r);return await t.createQueryResponse()}catch(t){if(t!==T.queryEngineEmptyResult)throw t;return new x.QueryEngineResult([],e,this).createQueryResponse()}}async executeQueryForCount(e={},t){const r=a.signalFromSignalOrOptions(t);try{return(await this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},r)).createQueryResponseForCount()}catch(e){if(e!==T.queryEngineEmptyResult)throw e;return 0}}async executeQueryForExtent(e,t){const r=a.signalFromSignalOrOptions(t),s=e.outSR;try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),i=t.size;return i?{count:i,extent:await this._getBounds(t.items,t.spatialReference,s||this.spatialReference)}:{count:0,extent:null}}catch(e){if(e===T.queryEngineEmptyResult)return{count:0,extent:null};throw e}}async executeQueryForIds(e,t){return this.executeQueryForIdSet(e,t).then(e=>Array.from(e))}async executeQueryForIdSet(e,t){const r=a.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),s=t.items,i=new Set;return await this.reschedule(()=>{for(const e of s)i.add(t.featureAdapter.getObjectId(e))},r),i}catch(e){if(e===T.queryEngineEmptyResult)return new Set;throw e}}async executeQueryForLatestObservations(e,t){const r=a.signalFromSignalOrOptions(t);if(!this.timeInfo?.trackIdField)throw new s("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const t=await this._executeQuery(e,{},r);return await this.reschedule(()=>this._filterLatest(t),r),await t.createQueryResponse()}catch(t){if(t!==T.queryEngineEmptyResult)throw t;return new x.QueryEngineResult([],e,this).createQueryResponse()}}async executeQueryForOpaqueFeatures(e,t){const r=a.signalFromSignalOrOptions(t);return(await this._executeQuery(e,{},r)).items}async executeAttributeBinsQuery(e,t){const r=a.signalFromSignalOrOptions(t);let s;e=n.clone(e);try{e=await this.schedule(()=>T.normalizeAttributeBinsQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>F.validateAttributeBinsQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r);const t=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r);s=await this.reschedule(()=>this._executeGeometryQuery(e,t,r),r),await this.reschedule(()=>this._executeAggregateIdsQuery(s),r),await this.reschedule(()=>this.executeObjectIdsQuery(s),r),await this.reschedule(()=>this.executeTimeQuery(s),r),await this.reschedule(()=>this.executeAttributesQuery(s),r)}catch(t){if(t!==T.queryEngineEmptyResult)throw t;s=new x.QueryEngineResult([],e,this)}return s.createQueryBinsResponse(e)}async executeQueryForSummaryStatistics(e={},t,r){const s=a.signalFromSignalOrOptions(r),{field:i,normalizationField:n,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:n,valueExpression:o},s)).createSummaryStatisticsResponse(t)}async executeQueryForUniqueValues(e={},t,r){const s=a.signalFromSignalOrOptions(r),{field:i,field2:n,field3:o,valueExpression:l}=t;return(await this._executeQueryForStatistics(e,{field:i,field2:n,field3:o,valueExpression:l},s)).createUniqueValuesResponse(t)}async executeQueryForClassBreaks(e={},t,r){const s=a.signalFromSignalOrOptions(r),{field:i,normalizationField:n,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:n,valueExpression:o},s)).createClassBreaksResponse(t)}async executeQueryForHistogram(e={},t,r){const s=a.signalFromSignalOrOptions(r),{field:i,normalizationField:n,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:n,valueExpression:o},s)).createHistogramResponse(t)}async fetchRecomputedExtents(e){const t=a.signalFromSignalOrOptions(e);this._timeExtentPromise||=M.getTimeExtent(this.timeInfo,this.featureStore);const[r,s]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);return a.throwIfAborted(t),{fullExtent:r,timeExtent:s}}async _getBounds(e,t,r){const s=d.set(d.create(),d.negativeInfinity);return await this.featureStore.forEachBounds(e,e=>d.expandWithAABB(s,e)),O(s,t,r,this.spatialReference,this.hasZ)}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(e=>this._getBounds(e,this.spatialReference,this.spatialReference)),this._fullExtentPromise}async schedule(e,t){return this._frameTask?.schedule(e,t)??e(R.noBudget)}async reschedule(e,t){return this._frameTask?.reschedule(e,t)??e(R.noBudget)}async _getAllFeaturesQueryEngineResult(e){return new x.QueryEngineResult(await this._getAllFeatures(),e,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const e=[];this._allFeaturesPromise=(async()=>await this.featureStore.forEach(t=>e.push(t)))().then(()=>r.toConst(e))}const e=this._allFeaturesPromise,t=await e;return e===this._allFeaturesPromise?t.slice():this._getAllFeatures()}async _executeQuery(e,t,r){e=n.clone(e),e=await this.schedule(()=>T.normalizeQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>F.validateQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r),e={...e,...t};const s=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r),i=await this.reschedule(()=>this._executeGeometryQuery(e,s,r),r);return await this.reschedule(()=>this._executeAggregateIdsQuery(i),r),await this.reschedule(()=>this.executeObjectIdsQuery(i),r),await this.reschedule(()=>this.executeTimeQuery(i),r),await this.reschedule(()=>this.executeAttributesQuery(i),r),i}async _executeSceneFilterQuery(e,t){if(null==e.sceneFilter)return null;const{outSR:r,returnGeometry:s,returnCentroid:i}=e,n=this.featureStore.featureSpatialReference,o=e.sceneFilter.geometry,a=null==n||m.equals(n,o.spatialReference)?o:b.project(o,n);if(!a)return null;const l=s||i,u=m.isValid(r)&&!m.equals(this.spatialReference,r)&&l?async e=>this._project(e,r):e=>e,c=this.featureAdapter,d=await this.reschedule(()=>this.searchFeatures(E(a)),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!d.length)return null;const r=new Set;for(const e of d)r.add(c.getObjectId(e));const s=await this.reschedule(()=>this._getAllFeatures(),t);return u(await this.reschedule(async()=>{const i=await I.getSpatialQueryOperator("esriSpatialRelDisjoint",a,this.geometryType,this.hasZ,this.hasM),n=await this.runSpatialFilter(s,e=>!r.has(c.getObjectId(e))||i(c.getGeometry(e)),t);return new x.QueryEngineResult(n,e,this)},t))}if(!d.length)return new x.QueryEngineResult([],e,this);if(this._canExecuteSinglePass(a,e))return u(new x.QueryEngineResult(d,e,this));const h=await I.getSpatialQueryOperator("esriSpatialRelContains",a,this.geometryType,this.hasZ,this.hasM),p=await this.runSpatialFilter(d,e=>h(c.getGeometry(e)),t);return u(new x.QueryEngineResult(p,e,this))}async _executeGeometryQuery(e,r,s){if(null!=r&&0===r.items.length)return r;const{geometry:i,outSR:n,returnGeometry:o,returnCentroid:a}=e,l=r?null:this._getCacheKey(e),u=l?this._cache.get(l):null;if(u)return new x.QueryEngineResult(u,e,this);const c=m.isValid(n)&&!m.equals(this.spatialReference,n),d=o||a,h=async e=>(c&&d&&await this._project(e,n),l&&this._cache.put(l,e.items),e),p=this.featureStore.featureSpatialReference,f=!i||null==p||m.equals(p,i.spatialReference)?i:b.project(i,p);if(!f)return h(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const y=this.featureAdapter;let g=await this.reschedule(()=>this.searchFeatures(E(i)),s);const _=e.spatialRel??"esriSpatialRelIntersects";if("esriSpatialRelDisjoint"===_){if(!g.length)return h(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const t=new Set;for(const e of g)t.add(y.getObjectId(e));const i=null!=r?r.items:await this.reschedule(()=>this._getAllFeatures(),s);return h(await this.reschedule(async()=>{const r=await I.getSpatialQueryOperator(_,f,this.geometryType,this.hasZ,this.hasM),n=await this.runSpatialFilter(i,e=>!t.has(y.getObjectId(e))||r(y.getGeometry(e)),s);return new x.QueryEngineResult(n,e,this)},s))}if(null!=r){const e=new t.PositionHint;g=g.filter(s=>t.indexOf(r.items,s,r.items.length,e)>=0)}if(!g.length){const t=new x.QueryEngineResult([],e,this);return l&&this._cache.put(l,t.items),t}if(this._canExecuteSinglePass(f,e))return h(new x.QueryEngineResult(g,e,this));const S=await I.getSpatialQueryOperator(_,f,this.geometryType,this.hasZ,this.hasM),v=await this.runSpatialFilter(g,e=>S(y.getGeometry(e)),s);return h(new x.QueryEngineResult(v,e,this))}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const r of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach(e=>t.add(e));const r=this.featureAdapter.getObjectId;e.items=e.items.filter(e=>t.has(r(e)))}executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter(e=>t.has(r(e)))}executeTimeQuery(e){if(0===e.items.length)return;const t=M.getTimeOperator(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}executeAttributesQuery(e){if(0===e.items.length)return;const t=g.getWhereClause(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter(e=>t.testFeature(e,this.featureAdapter))}}async runSpatialFilter(e,t,r){if(!t)return e;if(null==this._frameTask)return e.filter(e=>t(e));let s=0;const i=new Array,n=async o=>{for(;s<e.length;){const a=e[s++];t(a)&&(i.push(a),o.madeProgress()),o.done&&await this.reschedule(e=>n(e),r)}};return this.reschedule(e=>n(e),r).then(()=>i)}_filterLatest(e){const{trackIdField:t,startTimeField:r,endTimeField:s}=this.timeInfo,i=s||r,n=new Map,o=this.featureAdapter.getAttribute;for(const r of e.items){const e=o(r,t),s=o(r,i),a=n.get(e);(!a||s>o(a,i))&&n.set(e,r)}e.items=Array.from(n.values())}_getCacheKey(e){const{geometry:t,spatialRel:r,returnGeometry:s,returnCentroid:i,outSR:n,resultType:o,cacheHint:a}=e;if("tile"!==o&&!a)return null;const l=s||i;return m.isValid(n)&&!m.equals(this.spatialReference,n)&&l?JSON.stringify([t,r,n]):JSON.stringify([t,r])}_canExecuteSinglePass(e,t){const{spatialRel:r}=t;return I.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}async _project(e,t){if(!t||m.equals(this.spatialReference,t))return e;const s=this.featureAdapter;let i;try{const e=await this._getFullExtent();i=c.getTransformation(this.spatialReference,t,e)}catch{}const n=await b.projectMany(e.items.map(e=>_.getGeometry(this.geometryType,this.hasZ,this.hasM,s.getGeometry(e))),this.spatialReference,t,i);return e.items=r.toConst(n.map((t,r)=>s.cloneWithGeometry(e.items[r],y.convertFromGeometry(t,this.hasZ,this.hasM)))),e}async searchFeatures(e){const t=new Set;await Promise.all(e.map(e=>this.featureStore.forEachInBounds(e,e=>t.add(e))));const r=Array.from(t.values());return t.clear(),r}async _executeQueryForStatistics(e,t,r){e=n.clone(e);try{e=await this.schedule(()=>T.normalizeQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>F.validateStatisticsQuery(e,t,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r);const s=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r),i=await this.reschedule(()=>this._executeGeometryQuery(e,s,r),r);return await this.reschedule(()=>this._executeAggregateIdsQuery(i),r),await this.reschedule(()=>this.executeObjectIdsQuery(i),r),await this.reschedule(()=>this.executeTimeQuery(i),r),await this.reschedule(()=>this.executeAttributesQuery(i),r),i}catch(t){if(t!==T.queryEngineEmptyResult)throw t;return new x.QueryEngineResult([],e,this)}}get test(){}},e.getQueryBBoxes=E,e.getQueryResultExtent=O,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../Extent","./aaBoundingRect","./DoubleArray"],function(e,t,r,s){"use strict";function i(e=m){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function n(e,t,r,s,n,o,a=i()){return a[0]=e,a[1]=t,a[2]=r,a[3]=s,a[4]=n,a[5]=o,a}function o(e,t,r,s=i()){return h(s,f),a(s,e,t,r),s}function a(e,t,r=0,s=t.length/3){let i=e[0],n=e[1],o=e[2],a=e[3],l=e[4],u=e[5];for(let e=0;e<s;e++)i=Math.min(i,t[r+3*e]),n=Math.min(n,t[r+3*e+1]),o=Math.min(o,t[r+3*e+2]),a=Math.max(a,t[r+3*e]),l=Math.max(l,t[r+3*e+1]),u=Math.max(u,t[r+3*e+2]);e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=u}function l(e){return e[0]>=e[3]?0:e[3]-e[0]}function u(e){return e[1]>=e[4]?0:e[4]-e[1]}function c(e){return e[2]>=e[5]?0:e[5]-e[2]}function d(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function h(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function p(e){return 6===e.length}const f=[1/0,1/0,1/0,-1/0,-1/0,-1/0],m=[0,0,0,0,0,0],y=i();e.allFinite=function(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0},e.center=function(e,t=[0,0,0]){return t[0]=e[0]+l(e)/2,t[1]=e[1]+u(e)/2,t[2]=e[2]+c(e)/2,t},e.contains=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]},e.containsPoint=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]},e.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[2]>=e[2]-r&&t[0]<=e[3]+r&&t[1]<=e[4]+r&&t[2]<=e[5]+r},e.create=i,e.depth=u,e.diameter=function(e){const t=l(e),r=c(e),s=u(e);return Math.sqrt(t*t+r*r+s*s)},e.empty=function(e){return e?h(e,f):i(f)},e.equals=function(e,t,r){if(null==e||null==t)return e===t;if(!p(e)||!p(t))return!1;if(r){for(let s=0;s<e.length;s++)if(!r(e[s],t[s]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},e.expandWithAABB=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])},e.expandWithBuffer=a,e.expandWithNestedArray=function(e,t,r){const s=t.length;let i=e[0],n=e[1],o=e[2],a=e[3],l=e[4],u=e[5];if(r)for(let e=0;e<s;e++){const r=t[e];i=Math.min(i,r[0]),n=Math.min(n,r[1]),o=Math.min(o,r[2]),a=Math.max(a,r[0]),l=Math.max(l,r[1]),u=Math.max(u,r[2])}else for(let e=0;e<s;e++){const r=t[e];i=Math.min(i,r[0]),n=Math.min(n,r[1]),a=Math.max(a,r[0]),l=Math.max(l,r[1])}e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=u},e.expandWithOffset=function(e,t,r,s){e[0]=Math.min(e[0],e[0]+t),e[3]=Math.max(e[3],e[3]+t),e[1]=Math.min(e[1],e[1]+r),e[4]=Math.max(e[4],e[4]+r),e[2]=Math.min(e[2],e[2]+s),e[5]=Math.max(e[5],e[5]+s)},e.expandWithRect=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])},e.expandWithVec3=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])},e.fromBuffer=function(e,t=i()){return o(e,0,e.length/3,t)},e.fromExtent=function(e,t=i()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.hasZ?e.zmin:-1/0,t[3]=e.xmax,t[4]=e.ymax,t[5]=e.hasZ?e.zmax:1/0,t},e.fromMinMax=function(e,t,r=i()){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},e.fromRect=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e},e.fromRectValues=function(e,t,r,s,i){return e[0]=t,e[1]=r,e[2]=Number.NEGATIVE_INFINITY,e[3]=s,e[4]=i,e[5]=Number.POSITIVE_INFINITY,e},e.fromSubBuffer=o,e.fromValues=n,e.getMax=function(e,t){return t[0]=e[3],t[1]=e[4],t[2]=e[5],t},e.getMin=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.height=c,e.intersects=d,e.intersectsClippingArea=function(e,t){return null==t||d(e,t)},e.intersectsSegment=function(e,t,r){let s=0,i=1;for(let n=0;n<3;++n){const o=e[n],a=e[n+3],l=t[n],u=r[n],c=u<l,d=c?u:l,h=c?l:u,p=Math.max(o,d),f=Math.min(a,h);if(p>f)return!1;if(h===d)break;const m=h-d,y=(p-d)/m,g=(f-d)/m;if(s=Math.max(s,c?1-g:y),i=Math.min(i,c?1-y:g),s>i)return!1}return!0},e.is=p,e.isPoint=function(e){return 0===l(e)&&0===u(e)&&0===c(e)},e.maximumDimension=function(e){return Math.max(l(e),c(e),u(e))},e.negativeInfinity=f,e.offset=function(e,t,r,s,i=e){return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+s,i[3]=e[3]+t,i[4]=e[4]+r,i[5]=e[5]+s,i},e.positiveInfinity=[-1/0,-1/0,-1/0,1/0,1/0,1/0],e.scale=function(e,t,r=e){const s=e[0]+l(e)/2,i=e[1]+u(e)/2,n=e[2]+c(e)/2;return r[0]=s+(e[0]-s)*t,r[1]=i+(e[1]-i)*t,r[2]=n+(e[2]-n)*t,r[3]=s+(e[3]-s)*t,r[4]=i+(e[4]-i)*t,r[5]=n+(e[5]-n)*t,r},e.set=h,e.setMax=function(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e},e.setMin=function(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r},e.size=function(e,t=[0,0,0]){return t[0]=l(e),t[1]=u(e),t[2]=c(e),t},e.toCorners=function(e,t=s.newDoubleArray(24)){const[r,i,n,o,a,l]=e;return t[0]=r,t[1]=i,t[2]=n,t[3]=r,t[4]=i,t[5]=l,t[6]=r,t[7]=a,t[8]=n,t[9]=r,t[10]=a,t[11]=l,t[12]=o,t[13]=i,t[14]=n,t[15]=o,t[16]=i,t[17]=l,t[18]=o,t[19]=a,t[20]=n,t[21]=o,t[22]=a,t[23]=l,t},e.toExtent=function(e,r){const s=isFinite(e[2])||isFinite(e[5]);return new t(s?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:r}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:r})},e.toRect=function(e,t){return t||(t=r.create()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t},e.width=l,e.wrap=function(e,t,r,s,i,o){return n(e,t,r,s,i,o,y)},e.zero=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(e,t){"use strict";e.copyInto=function(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e},e.doubleArrayFrom=function(e){return(t.isTypedArray(e)?e.byteLength/8:e.length)<=t.nativeArrayMaxSize?Array.from(e):new Float64Array(e)},e.doubleSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},e.ensurePackedArray=function(e){return[...e]},e.newDoubleArray=function(e,r=!1){return e<=t.nativeArrayMaxSize?r?new Array(e).fill(0):new Array(e):new Float64Array(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/featureConversionUtils":function(){define(["exports","../../core/Error","../../core/Logger","../../core/maybe","../../geometry/support/aaBoundingBox","../../geometry/support/aaBoundingRect","../../geometry/support/jsonUtils","./OptimizedFeature","./OptimizedFeatureSet","./OptimizedGeometry","./data/createFeatureId"],function(e,t,r,s,i,n,o,a,l,u,c){"use strict";function d(e,t){return e?t?4:3:t?3:2}const h=()=>r.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},f=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n},m=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[s+2]},y=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[s+3]},g=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[s+2],e[r+3]=t[s+3]};function _(e,t,r,s){if(e){if(r)return t&&s?g:m;if(t&&s)return y}else if(t&&s)return m;return f}function b({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function S({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function v({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function x({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function T({scale:e,translate:t},r,s){return r*e[s]+t[s]}function F(e){const t=e.coords;return{x:t[0],y:t[1]}}function I(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function M(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function w(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function R(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function E(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function O(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function A(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function P(e,t){return e&&t?A:e?w:t?E:I}function C(e,t,r,s,i){const n=P(r,s);for(const r of t){const t=null!=r.geometry?n(new u,r.geometry):null;e.push(new a.OptimizedFeature(t,r.attributes,null,c.createFeatureId(r,i)))}return e}function z(e,t,r=P(null!=t.z,null!=t.m)){return r(e,t)}function N(e,t,r,s){for(const{geometry:i,attributes:n}of t)e.push({attributes:n,geometry:null!=i?B(i,r,s):null});return e}function B(e,t,r){if(null==e)return null;const s=d(t,r),i=[];for(let t=0;t<e.coords.length;t+=s){const r=[];for(let i=0;i<s;i++)r.push(e.coords[t+i]);i.push(r)}return t?r?{points:i,hasZ:t,hasM:r}:{points:i,hasZ:t}:r?{points:i,hasM:r}:{points:i}}function k(e,t,r,s,i){const n=d(r,s);for(const r of t){const t=null!=r.geometry?U(new u,r.geometry,n):null;e.push(new a.OptimizedFeature(t,r.attributes,null,c.createFeatureId(r,i)))}return e}function U(e,t,r=d(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const s=e.coords;let i=0;for(const e of t.points)for(let t=0;t<r;t++)s[i++]=e[t];return e}function L(e,t,r){if(!e)return null;const s=d(t,r),{coords:i,lengths:n}=e,o=[];let a=0;for(const e of n){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(i[a++]);t.push(e)}o.push(t)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function q(e,t,r,s,i){const n=d(r,s);for(const r of t){const t=null!=r.geometry?j(new u,r.geometry,n):null,s=null!=r.centroid?z(new u,r.centroid):null;e.push(new a.OptimizedFeature(t,r.attributes,s,c.createFeatureId(r,i)))}return e}function j(e,t,r=d(t.hasZ,t.hasM)){const{lengths:s,coords:i}=e;let n=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)i[n++]=t[e];s.push(e.length)}return e}function D(e,t,r){if(!e)return null;const s=d(t,r),{coords:i,lengths:n}=e,o=[];let a=0;for(const e of n){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(i[a++]);t.push(e)}o.push(t)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function G(e,t,r=t.hasZ,s=t.hasM){return V(e,t.rings,r,s)}function V(e,t,r,s){const i=d(r,s),{lengths:n,coords:o}=e;let a=0;re(e);for(const e of t){for(const t of e)for(let e=0;e<i;e++)o[a++]=t[e];n.push(e.length)}return e}const Q=[],Z=[];function H(e,r,s,i,n,o){if(se(e),!s){for(const t of r){const r=c.createFeatureId(t,o);e.push(new a.OptimizedFeature(null,t.attributes,null,r))}return e}switch(s){case"esriGeometryPoint":return C(e,r,i,n,o);case"esriGeometryMultipoint":return k(e,r,i,n,o);case"esriGeometryPolyline":return q(e,r,i,n,o);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,r,s,i){for(const n of t){const t=null!=n.geometry?G(new u,n.geometry,r,s):null,o=c.createFeatureId(n,i);null!=n.centroid?e.push(new a.OptimizedFeature(t,n.attributes,I(new u,n.centroid),o)):e.push(new a.OptimizedFeature(t,n.attributes,null,o))}return e}(e,r,i,n,o);default:h().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${s}'`)),se(e)}return e}function Y(e,r,s,i){const n=e&&("coords"in e?e:e.geometry);if(null==n)return null;switch(r){case"esriGeometryPoint":{let e=F;return s&&i?e=O:s?e=M:i&&(e=R),e(n)}case"esriGeometryMultipoint":return B(n,s,i);case"esriGeometryPolyline":return L(n,s,i);case"esriGeometryPolygon":return D(n,s,i);default:return h().error("convertToGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${r}'`)),null}}function W(e,r,s,i,n){if(se(e),null==s)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,r);switch(s){case"esriGeometryPoint":return function(e,t,r,s){let i=F;r&&s?i=O:r?i=M:s&&(i=R);for(const r of t){const{geometry:t,attributes:s}=r,n=null!=t?i(t):null;e.push({attributes:s,geometry:n})}return e}(e,r,i,n);case"esriGeometryMultipoint":return N(e,r,i,n);case"esriGeometryPolyline":return function(e,t,r,s){for(const{geometry:i,attributes:n}of t)e.push({attributes:n,geometry:null!=i?L(i,r,s):null});return e}(e,r,i,n);case"esriGeometryPolygon":return function(e,t,r,s){for(const{geometry:i,attributes:n,centroid:o}of t){const t=null!=i?D(i,r,s):null;if(null!=o){const r=F(o);e.push({attributes:n,centroid:r,geometry:t})}else e.push({attributes:n,geometry:t})}return e}(e,r,i,n);default:h().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${s}'`))}return e}function $(e,t,r,s,i,n,o=r,a=s){if(re(e),!t?.coords.length)return null;const l=p[i],{coords:u,lengths:c}=t,h=d(r,s),f=d(r&&o,s&&a),m=_(r,s,o,a);if(!c.length)return m(e.coords,u,0,0,b(n,u[0]),S(n,u[1])),re(e,h,0),e;let y,g,v,x,T=0,F=0,I=F;for(const t of c){if(t<l)continue;let r=0;F=I,v=y=b(n,u[T]),x=g=S(n,u[T+1]),m(e.coords,u,F,T,v,x),r++,T+=h,F+=f;for(let s=1;s<t;s++,T+=h)v=b(n,u[T]),x=S(n,u[T+1]),v===y&&x===g||(m(e.coords,u,F,T,v-y,x-g),F+=f,r++,y=v,g=x);r>=l&&(e.lengths.push(r),I=F)}return se(e.coords,I),e.coords.length?e:null}function J(e,t,r,s){const i=e[t],n=e[t+1],o=e[r],a=e[r+1],l=e[s],u=e[s+1];let c=o,d=a,h=l-c,p=u-d;if(0!==h||0!==p){const e=((i-c)*h+(n-d)*p)/(h*h+p*p);e>1?(c=l,d=u):e>0&&(c+=h*e,d+=p*e)}return h=i-c,p=n-d,h*h+p*p}function X(e,t,r,s,i,n,o){let a,l=s,u=0;for(let e=n+r;e<o;e+=r)a=J(t,e,n,o),a>l&&(u=e,l=a);l>s&&(u-n>r&&X(e,t,r,s,i,n,u),i(e,t,e.length,u,t[u],t[u+1]),o-u>r&&X(e,t,r,s,i,u,o))}function K(e,t,r,i,n){const{coords:o,lengths:a}=t,l=d(r,i);if(!o.length)return e!==t&&re(e),e;s.assertIsSome(n);const{originPosition:u,scale:c,translate:h}=n,p=ie;p.originPosition=u;const f=p.scale;f[0]=c[0]??1,f[1]=-(c[1]??1),f[2]=c[2]??1,f[3]=c[3]??1;const m=p.translate;if(m[0]=h[0]??0,m[1]=h[1]??0,m[2]=h[2]??0,m[3]=h[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=T(p,o[t],t);return e!==t&&re(e,l,0),e}let y=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[y+t]=T(p,o[y+t],t);let s=e.coords[y],i=e.coords[y+1];y+=l;for(let t=1;t<r;t++,y+=l){s+=o[y]*f[0],i+=o[y+1]*f[1],e.coords[y]=s,e.coords[y+1]=i;for(let t=2;t<l;++t)e.coords[y+t]=T(p,o[y+t],t)}}return e!==t&&re(e,o.length,a.length),e}function ee(e,t,r,s){let i=0,n=e[s*t],o=e[s*(t+1)];for(let a=1;a<r;a++){const r=n+e[s*(t+a)],l=o+e[s*(t+a)+1],u=(r-n)*(l+o);n=r,o=l,i+=u}return.5*i}function te(e,t,r,s){return 0===e*s-r*t&&e*r+t*s>0}function re(e,t=0,r=0){se(e.lengths,r),se(e.coords,t)}function se(e,t=0){e.length!==t&&(e.length=t)}const ie={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};e.convertFromFeature=function(e,t,r,s,i){Q[0]=e;const[n]=H(Z,Q,t,r,s,i);return se(Q),se(Z),n},e.convertFromFeatureSet=function(e,t){const r=new l,{hasM:s,hasZ:i,features:n,spatialReference:o,geometryType:a,exceededTransferLimit:u,transform:c,fields:d}=e;return d&&(r.fields=d),r.geometryType=a??null,r.spatialReference=o??null,n&&H(r.features,n,a,i,s,t),u&&(r.exceededTransferLimit=u),s&&(r.hasM=s),i&&(r.hasZ=i),c&&(r.transform=c),r},e.convertFromFeatures=H,e.convertFromGeometry=function(e,r,s){if(null==e)return null;const i=new u;return"hasZ"in e&&null==r&&(r=e.hasZ),"hasM"in e&&null==s&&(s=e.hasM),o.isPoint(e)?P(null!=r?r:null!=e.z,null!=s?s:null!=e.m)(i,e):o.isPolygon(e)?G(i,e,r,s):o.isPolyline(e)?j(i,e,d(r,s)):o.isMultipoint(e)?U(i,e,d(r,s)):void h().error("convertFromGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${e}'`))},e.convertFromMultipoint=U,e.convertFromMultipointFeatures=k,e.convertFromNestedArray=V,e.convertFromPoint=z,e.convertFromPointFeatures=C,e.convertFromPolygon=G,e.convertFromPolyline=j,e.convertFromPolylineFeatures=q,e.convertToFeature=function(e,t,r,s){Z[0]=e,W(Q,Z,t,r,s);const i=Q[0];return se(Q),se(Z),i},e.convertToFeatureSet=function(e){const{spatialReference:t,transform:r,fields:s,hasM:i,hasZ:n,features:o,geometryType:a,exceededTransferLimit:l,queryGeometry:u,queryGeometryType:c}=e,d={features:W([],o,a,n,i),fields:s,geometryType:a,spatialReference:t,queryGeometry:Y(u,c,!1,!1)};return r&&(d.transform=r),l&&(d.exceededTransferLimit=l),i&&(d.hasM=i),n&&(d.hasZ=n),d},e.convertToFeatures=W,e.convertToGeometry=Y,e.convertToMultipoint=B,e.convertToMultipointFeatures=N,e.convertToPoint=function(e,t,r){return e?t?r?O(e):M(e):r?R(e):F(e):null},e.convertToPolygon=D,e.convertToPolyline=L,e.generalizeOptimizedGeometry=function(e,t,r,s,i,n,o=r,a=s){if(re(e),!t?.coords.length)return null;const l=p[i],{coords:u,lengths:c}=t,h=d(r,s),f=d(r&&o,s&&a),m=_(r,s,o,a);if(!c.length)return m(e.coords,u,0,0,u[0],u[1]),re(e,h,0),e;let y=0;const g=n*n;for(const t of c){if(t<l){y+=t*h;continue}const r=e.coords.length/f,s=y,i=y+(t-1)*h;m(e.coords,u,e.coords.length,s,u[s],u[s+1]),X(e.coords,u,h,g,m,s,i),m(e.coords,u,e.coords.length,i,u[i],u[i+1]);const n=e.coords.length/f-r;n>=l?e.lengths.push(n):se(e.coords,r*f),y+=t*h}return e.coords.length?e:null},e.getBoundsOptimizedGeometry=function(e,t,r,s){if(!t?.coords?.length)return null;const o=d(r,s);let a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=o){const r=e[t],s=e[t+1];a=Math.min(a,r),u=Math.max(u,r),l=Math.min(l,s),c=Math.max(c,s)}}return i.is(e)?i.fromRectValues(e,a,l,u,c):n.fromValues(a,l,u,c,e),e},e.getQuantizedArea=function(e,t){const{coords:r,lengths:s}=e;let i=0,n=0;for(let e=0;e<s.length;e++){const o=s[e];n+=ee(r,i,o,t),i+=o}return Math.abs(n)},e.getQuantizedBoundsOptimizedGeometry=function(e,t,r,s){const i=d(r,s),{lengths:n,coords:o}=t;let a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,h=0;for(const e of n){let t=o[h],r=o[h+1];a=Math.min(t,a),l=Math.min(r,l),u=Math.max(t,u),c=Math.max(r,c),h+=i;for(let s=1;s<e;s++,h+=i){const e=o[h],s=o[h+1];t+=e,r+=s,e<0&&(a=Math.min(a,t)),e>0&&(u=Math.max(u,t)),s<0?l=Math.min(l,r):s>0&&(c=Math.max(c,r))}}return e[0]=a,e[1]=l,e[2]=u,e[3]=c,e},e.getSignedQuantizedRingArea=ee,e.quantizeForDisplay=function(e,t,r,s,i){const n=d(s,i);if(!e.lengths.length){if(e.coords.length<2)return null;const[r,s]=e.coords,i=v(t,r),n=x(t,s);return new u([],[i,n])}const o=new u([],[0,0]),a=p[r],l="esriGeometryPolygon"===r||"esriGeometryPolyline"===r;let c=0,h=0;for(let r=0;r<e.lengths.length;r++){const s=e.lengths[r],i=h;let u=v(t,e.coords[n*c]),d=x(t,e.coords[n*c+1]);o.coords[h++]=u,o.coords[h++]=d;let p=0,f=0,m=1;for(let r=1;r<s;r++){const s=v(t,e.coords[n*(r+c)]),i=x(t,e.coords[n*(r+c)+1]);if(s!==u||i!==d){const e=s-u,t=i-d;l&&te(p,f,e,t)?(o.coords[h-2]+=e,o.coords[h-1]+=t,u+=e,d+=t):(o.coords[h++]=s,o.coords[h++]=i,u=s,d=i,p=e,f=t,m+=1)}}m<a?h=i:o.lengths.push(m),c+=s}return 0===o.lengths.length?null:o},e.quantizeOptimizedFeatureSet=function(e,t){const{geometryType:r,features:s,hasM:i,hasZ:n}=t;if(!e)return t;for(let t=0;t<s.length;t++){const o=s[t],a=o.weakClone();a.geometry=new u,$(a.geometry,o.geometry,i,n,r,e),o.centroid&&(a.centroid=new u,$(a.centroid,o.centroid,i,n,"esriGeometryPoint",e)),s[t]=a}return t.transform=e,t},e.quantizeOptimizedGeometry=$,e.quantizeX=b,e.quantizeY=S,e.removeCollinearVertices=function(e,t,r,s,i){if(!t?.coords?.length)return null;const n=p[r],{coords:o,lengths:a}=t,l=_(s,i,s,i),u=d(s,i);let c=0,h=0,f=0,m=0;for(const t of a){h=m,l(e.coords,o,h,c,o[c],o[c+1]),c+=u;let r=o[c],s=o[c+1],i=r,a=s,d=s/r;h+=u,l(e.coords,o,h,c,i,a),c+=u;for(let n=2;n<t;n++){r=o[c],s=o[c+1];const t=s/r,n=d===t||!isFinite(d)&&!isFinite(t),p=n&&isFinite(t)?d>=0&&t>=0||d<=0&&t<=0:a>=0&&s>=0||a<=0&&s<=0;n&&p?(i+=r,a+=s):(i=r,a=s,h+=u),l(e.coords,o,h,c,i,a),c+=u,d=t}h+=u;const p=(h-m)/u;p>=n&&(e.lengths[f]=p,m=h,f++)}return e.coords.length>m&&(e.coords.length=m),e.lengths.length>f&&(e.lengths.length=f),e.coords.length&&e.lengths.length?e:null},e.removeZMValues=function(e,t,r,s,i,n){if(re(e),e.lengths.push(...t.lengths),r===i&&s===n)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const o=d(r,s),a=_(r,s,i,n),l=t.coords;for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e},e.unquantizeOptimizedFeatureSet=function(e){const{transform:t,features:r,hasM:s,hasZ:i}=e;if(!t)return e;for(const e of r)null!=e.geometry&&K(e.geometry,e.geometry,s,i,t),null!=e.centroid&&K(e.centroid,e.centroid,s,i,t);return e.transform=null,e},e.unquantizeOptimizedGeometry=K,e.unquantizeValue=T,e.unquantizeX=function(e,t){return T(e,t,0)},e.unquantizeY=function(e,t){return T(e,-t,1)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeature":function(){define(["exports","../../core/memoryEstimations","./centroid","./OptimizedGeometry"],function(e,t,r,s){"use strict";class i{constructor(e=null,t={},r,s,i=0){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=s,this.displayId=i}static fromJSON(e){const t=e.geometry?s.fromJSON(e.geometry):null,r=e.centroid?s.fromJSON(e.centroid):null,n=e.objectId;return new i(t,e.attributes,r,n)}weakClone(){const e=new i(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),t=new i(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t}ensureCentroid(e){return this.centroid??=r.getCentroidOptimizedGeometry(new s,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+t.estimateAttributesMemory(this.attributes)+(this.geometry?.usedMemory??0)}}e.OptimizedFeature=i,e.OptimizedFeatureWithGeometry=class extends i{},e.hasGeometry=function(e){return!!e.geometry?.coords?.length},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,s,i,n,o){const a=t(n,o);let l=s,u=s+a,c=0,d=0,h=0,p=0,f=0;for(let t=0,s=i-1;t<s;t++,l+=a,u+=a){const t=r[l],s=r[l+1],i=r[l+2],o=r[u],a=r[u+1],m=r[u+2];let y=t*a-o*s;p+=y,c+=(t+o)*y,d+=(s+a)*y,n&&(y=t*m-o*i,h+=(i+m)*y,f+=y),t<e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),s<e[2]&&(e[2]=s),s>e[3]&&(e[3]=s),n&&(i<e[4]&&(e[4]=i),i>e[5]&&(e[5]=i))}if(p>0&&(p*=-1),f>0&&(f*=-1),!p)return null;const m=[c,d,.5*p];return n&&(m[3]=h,m[4]=.5*f),m}function s(e,r,s,l,u){const c=t(l,u);let d=r,h=r+c,p=0,f=0,m=0,y=0;for(let t=0,r=s-1;t<r;t++,d+=c,h+=c){const t=e[d],r=e[d+1],s=e[d+2],u=e[h],c=e[h+1],g=e[h+2],_=l?n(t,r,s,u,c,g):i(t,r,u,c);if(_)if(p+=_,l){const e=a(t,r,s,u,c,g);f+=_*e[0],m+=_*e[1],y+=_*e[2]}else{const e=o(t,r,u,c);f+=_*e[0],m+=_*e[1]}}return p>0?l?[f/p,m/p,y/p]:[f/p,m/p]:s>0?l?[e[r],e[r+1],e[r+2]]:[e[r],e[r+1]]:null}function i(e,t,r,s){const i=r-e,n=s-t;return Math.sqrt(i*i+n*n)}function n(e,t,r,s,i,n){const o=s-e,a=i-t,l=n-r;return Math.sqrt(o*o+a*a+l*l)}function o(e,t,r,s){return[e+.5*(r-e),t+.5*(s-t)]}function a(e,t,r,s,i,n){return[e+.5*(s-e),t+.5*(i-t),r+.5*(n-r)]}e.getCentroidOptimizedGeometry=function(e,i,n,o){if(!i?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],u=n?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:d}=i,h=t(n,o);let p=0;for(const e of c){const t=r(u,d,p,e,n,o);t&&l.push(t),p+=e*h}if(l.sort((e,t)=>{let r=e[2]-t[2];return 0===r&&n&&(r=e[4]-t[4]),r}),l.length){let e=6*l[0][2];a[0]=l[0][0]/e,a[1]=l[0][1]/e,n&&(e=6*l[0][4],a[2]=0!==e?l[0][3]/e:0),(a[0]<u[0]||a[0]>u[1]||a[1]<u[2]||a[1]>u[3]||n&&(a[2]<u[4]||a[2]>u[5]))&&(a.length=0)}if(!a.length){const e=i.lengths[0]?s(d,0,c[0],n,o):null;if(!e)return null;a[0]=e[0],a[1]=e[1],n&&e.length>2&&(a[2]=e[2])}return e},e.lineCentroid=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedGeometry":function(){define(["../../core/memoryEstimations"],function(e){"use strict";class t{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new t(e.lengths,e.coords)}static fromRect(e){const[r,s,i,n]=e,o=i-r,a=n-s;return new t([5],[r,s,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,t)=>e+t)}get usedMemory(){return 64+e.estimateNumberArrayMemory(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];if(s<3)continue;let i=this.coords[2*t],n=this.coords[2*t+1];for(let r=1;r<s;r+=1){const s=this.coords[2*(r+t)],o=this.coords[2*(r+t)+1];e+=-.5*(s-i)*(o+n),i=s,n=o}t+=s}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let r=0;r<s;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=s}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let s=0;for(const e of r){for(let r=1;r<e;r++)t[2*(s+r)]+=t[2*(s+r)-2],t[2*(s+r)+1]+=t[2*(s+r)-1];s+=e}return e}clone(e){if(0===this.lengths.length)return new t([],[this.coords[0],this.coords[1]]);const r=2*(0===this.lengths.length?1:this.lengths.reduce((e,t)=>e+t)),s=this.coords.slice(0,r);return e?(e.set(s),new t(this.lengths,e)):new t(Array.from(this.lengths),Array.from(s))}}return t})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(function(){"use strict";class e{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new e;return t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}return e})},"esri/layers/graphics/data/createFeatureId":function(){define(["exports"],function(e){"use strict";e.createFeatureId=function(e,t){switch(t.type){case"object-id":case"unique-id-simple":return e.attributes[t.fieldName];case"unique-id-composite":{const r=[];for(const s of t.fieldNames)r.push(e.attributes[s]??null);return JSON.stringify(r)}}},e.createFeatureIdFromLayer=function(e,t){if("uniqueIdFields"in t&&t.uniqueIdFields?.length){if(1===t.uniqueIdFields.length)return e.attributes?.[t.uniqueIdFields[0]];const r=t.uniqueIdFields.map(t=>e.attributes?.[t]);return JSON.stringify(r)}return"objectIdField"in t&&t.objectIdField?e.attributes?.[t.objectIdField]:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(e,t,r,s){"use strict";const i=new r.WhereClauseCache(50,500),n="unsupported-query",o=" as ",a=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),l=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),u=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...a,...l]);function c(e,r,s={}){const o=d(r,e);if(!o){const s=i.getError(r,e);throw new t(n,"invalid SQL expression",{expression:r,error:s})}const a=s.expressionName||"expression";if(s.validateStandardized&&!o.isStandardized)throw new t(n,`${a} is not standard`,{expression:r});if(s.validateAggregate&&!o.isAggregate)throw new t(n,`${a} does not contain a valid aggregate function`,{expression:r});return o.fieldNames}function d(e,t){return e?i.get(e,t):null}function h(e){return/\((.*?)\)/.test(e)?e:e.split(o)[0]}function p(e,r,s,i={}){const o=new Map;if(function(e,t,r,s,i){const n=i.includes("*")?[...r,...i.filter(e=>"*"!==e)]:i;for(const i of n)if(t.get(i))f(e,t,r,s,i);else try{const n=c(t,h(i),{validateStandardized:!0});for(const i of n)f(e,t,r,s,i)}catch(t){e.set(i,{type:"expression-error",expression:i,error:t})}}(o,e,r,i.allowedFieldTypes??u,s),o.size){const e=i.expressionName??"expression";throw new t(n,`${e} contains invalid or missing fields`,{errors:Array.from(o.values()),query:i.query})}}function f(e,t,r,i,n){const o=t.get(n);o?r.has(o.name)?"all"!==i&&!1===i?.has(o.type)&&e.set(n,{type:"invalid-type",fieldName:o.name,fieldType:s.kebabDict.fromJSON(o.type),allowedFieldTypes:Array.from(i,e=>s.kebabDict.fromJSON(e))}):e.set(n,{type:"missing-field",fieldName:o.name}):e.set(n,{type:"invalid-field",fieldName:n})}e.allDateAndTimeFieldTypes=l,e.getAliasFromFieldName=function(e){return e.split(o)[1]},e.getExpressionFromFieldName=h,e.getWhereClause=d,e.numericFieldTypes=a,e.validateFields=p,e.validateHaving=function(e,r,s,i,o){if(!s)return!0;const a="having clause",l=c(e,s,{validateAggregate:!0,expressionName:a});p(e,r,l,{expressionName:a,query:o});const u=d(s,e),h=u?.getExpressions().every(t=>{const{aggregateType:r,field:s}=t,n=e.get(s)?.name;return i.some(t=>{const{onStatisticField:s,statisticType:i}=t,o=e.get(s)?.name;return o===n&&i.toLowerCase().trim()===r})});if(!h)throw new t(n,"expressions in having clause should also exist in outStatistics",{having:s});return!0},e.validateWhere=function(e,t,r,s){if(!r)return!0;const i="where clause";return p(e,t,c(e,r,{validateStandardized:!0,expressionName:i}),{expressionName:i,query:s}),!0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],function(e,t,r){"use strict";e.WhereClauseCache=class{constructor(e,r){this._cache=new t.LRUCache(e),this._invalidCache=new t.LRUCache(r)}get(e,t){const s=`${t?.uid}:${e}`,i=this._cache.get(s);if(i)return i;if(null!=this._invalidCache.get(s))return null;try{const i=r.create(e,{fieldsIndex:t});return this._cache.put(s,i),i}catch(e){return this._invalidCache.put(s,e),null}}getError(e,t){const r=`${t?.uid}:${e}`;return this._invalidCache.get(r)??null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/LRUCache":function(){define(["exports","./MemCache"],function(e,t){"use strict";e.LRUCache=class{constructor(e,r){this.removeFunc=r,this._storage=new t.MemCacheStorage,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy(),this._storage=null}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCache":function(){define(["exports","./has"],function(e,t){"use strict";const r=!!t("esri-tests-disable-gpu-memory-measurements");class s{constructor(e,t,r,s=0){this.name=e,this._storage=t,this.removeFunc=r,this._defaultPriority=s,this.id=`${i++}${o}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}set maxSize(e){this._storage.setMaxSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,r=this._defaultPriority){this._storage.put(this,e,t,t.cachedMemory,r)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t){this._storage.updateSize(this,e,t,t.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}let i=0;class n{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}const o=":";e.MemCache=s,e.MemCacheStorage=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear(),this._db=null}register(e){this._users.set(e.id.slice(0,-1),e)}deregister(e){this.clear(e),this._sizeLimits.delete(e),this._users.delete(e.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,s,i,o){t=e.id+t;const a=this._db.get(t);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(t),a.entry!==s&&this._notifyRemove(t,a.entry,a.size,0)),i>this._maxSize)return void this._notifyRemove(t,s,i,0);if(void 0===s)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return r||console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,s,0,0);const l=1+Math.max(o,-4)- -3;this._db.set(t,new n(s,i,l)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,r,s){t=e.id+t;const i=this._db.get(t);if(i&&i.entry===r){for(this._size-=i.size,e.size-=i.size;s>this._maxSize;){const e=this._notifyRemove(t,r,s,1);if(!(null!=e&&e>0))return void this._db.delete(t);s=e}i.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach((e,s)=>{const i=e.lifetime;r[i]=(r[i]||0)+e.size,this._users.forEach(r=>{const{id:i,name:n}=r;if(s.startsWith(i)){const r=t[n]||0;t[n]=r+e.size}})});const s={};this._users.forEach(e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const i=t[r]||0;t[r]=i,s[r]=Math.round(100*e.hitRate)+"%"}else s[r]="0%"});const i=Object.keys(t);i.sort((e,r)=>t[r]-t[e]),i.forEach(r=>e[r]=Math.round(t[r]/2**20)+"MB / "+s[r]);for(let t=r.length-1;t>=0;--t){const s=r[t];s&&(e["Priority "+(t+-3-1)]=Math.round(s/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEach(e=>e.resetHitRate())}clear(e){const t=e.id;this._db.forEach((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,0))}),e.size=0}clearAll(){this._db.forEach((e,t)=>this._notifyRemove(t,e.entry,e.size,0)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}*values(e){for(const[t,r]of this._db)t.startsWith(e.id)&&(yield r.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,s){const i=this._users.get(e.split(o)[0])?.removeFunc,n=i?.(t,s,r);return"number"==typeof n?n:null}_checkSize(){this._sizeLimits.forEach((e,t)=>this._checkSizeLimits(e,t)),this._checkSizeLimits(this.maxSize)}setMaxSize(e,t){null==t||t<=0?this._sizeLimits.delete(e):this._sizeLimits.set(e,t)}_checkSizeLimits(e,t){const r=t??this;if(r.size<=e)return;const s=t?.id;let i=!0;for(;i;){i=!1;for(const[n,a]of this._db)if(0===a.lifetime&&(!s||n.startsWith(s))){const s=t??this._users.get(n.split(o)[0]);if(this._purgeItem(n,a,s),r.size<=.9*e)return;i||=this._db.has(n)}}for(const[i,n]of this._db)if(!s||i.startsWith(s)){const s=t??this._users.get(i.split(o)[0]);if(this._purgeItem(i,n,s),r.size<=.9*e)return}}_purgeItem(e,t,r){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const s=this._notifyRemove(e,t.entry,t.size,1);null!=s&&s>0&&(this._size+=s,r&&(r.size+=s),t.lives=t.lifetime,t.size=s,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}},e.MinPriority=-3,e.NoPriority=-4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(e,t,r){"use strict";const s=new r,i=new r,n=new r,o={esriGeometryPoint:t.convertToPoint,esriGeometryPolyline:t.convertToPolyline,esriGeometryPolygon:t.convertToPolygon,esriGeometryMultipoint:t.convertToMultipoint},a="_geVersion",l=(e,t)=>e===a?void 0:t;e.cleanFromGeometryEngine=function(e){return e&&a in e?JSON.parse(JSON.stringify(e,l)):e},e.getGeometry=function(e,r,a,l,u,c,d=r,h=a){const p=r&&d,f=a&&h,m=null!=l?"coords"in l?l:l.geometry:null;if(null==m)return null;if(u){let s=t.generalizeOptimizedGeometry(i,m,r,a,e,u,d,h);return c&&(s=t.quantizeOptimizedGeometry(n,s,p,f,e,c)),o[e]?.(s,p,f)??null}if(c){const s=t.quantizeOptimizedGeometry(n,m,r,a,e,c,d,h);return o[e]?.(s,p,f)??null}return t.removeZMValues(s,m,r,a,d,h),o[e]?.(s,p,f)??null},e.transformCentroid=function(e,r,s,i=e.hasZ,o=e.hasM){if(null==r)return null;const a=e.hasZ&&i,l=e.hasM&&o;if(s){const u=t.quantizeOptimizedGeometry(n,r,e.hasZ,e.hasM,"esriGeometryPoint",s,i,o);return t.convertToPoint(u,a,l)}return t.convertToPoint(r,a,l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCache":function(){define(["exports","../../../core/has"],function(e,t){"use strict";let r=0;class s{constructor(e){this.items=e,this.time=performance.now(),this.id=r++}}e.QueryEngineCache=class{constructor(){this._storage=new Map,this._purgeInterval=5,this._sweep=()=>{if(this._timer=void 0,!this._storage)return;const e=1e3*this._purgeInterval,t=performance.now()-e;for(const[r,s]of this._storage){if(!(s.time<t))return void(this._storage.size>0&&(this._timer=setTimeout(this._sweep,e)));this._storage.delete(r)}}}destroy(){this._storage?.clear(),this._storage=null,clearTimeout(this._timer)}put(e,t){this._storage?.set(e,new s(t)),this._scheduleSweep()}get(e){const t=this._storage?.get(e);if(t)return this._storage?.delete(e),t.time=performance.now(),this._storage?.set(e,t),t.items}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??=setTimeout(this._sweep,1e3*this._purgeInterval))}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(e){"use strict";e.queryBinsCapabilities={supportsDate:!0,supportsFixedInterval:!0,supportsAutoInterval:!0,supportsFixedBoundaries:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!0,supportedStatistics:{count:!0,sum:!0,avg:!0,var:!0,stddev:!0,min:!0,max:!0,percentileContinuous:!0,percentileDiscrete:!0,envelope:!0,centroid:!0,convexHull:!0},supportedNormalizationTypes:{field:!0,log:!0,naturalLog:!0,percentOfTotal:!0,squareRoot:!0}},e.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsCurrentUser:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsPaginationOnAggregatedQueries:!1,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsReturnMesh:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0,supportsTrueCurve:!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define(["require","exports","../../../core/lang","../../../geometry/support/centroid","../../../geometry/support/extentUtils","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","./AttributesBuilder","./geometryUtils","./projectionSupport","./queryUtils","./SnappingCandidate","../../support/fieldUtils","../../../rest/support/AutoIntervalBinParameters","../../../rest/support/DateBinParameters","../../../rest/support/DateBinUtils","../../../rest/support/FixedBoundariesBinParameters","../../../rest/support/FixedIntervalBinParameters","../../../statistics/utils","../../../time/constants","../../../chunks/datetime"],function(e,t,r,s,i,n,o,a,l,u,c,d,h,p,f,m,y,g,_,b,S){"use strict";const v="bin";function x(e,t,r,s){const i=s.x-r.x,n=s.y-r.y,o=t.x-r.x,a=t.y-r.y,l=i*i+n*n;if(0===l)return!1;const u=o*i+a*n,c=Math.min(1,Math.max(0,u/l));return e.x=r.x+i*c,e.y=r.y+n*c,!0}function T(e,t){return e?t?4:3:t?3:2}class F{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}const I=[1];t.QueryEngineResult=class{constructor(e,t,r){this.items=e,this.query=t,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new a(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:r,outStatistics:s}=this.query,i=t?.length;if(!i)return 1;const n=new Map,o=new Map,l=new Set;for(const i of s){const{statisticType:s}=i,a="exceedslimit"!==s?i.onStatisticField:void 0;if(!o.has(a)){const r=[];for(const s of t){const t=this._getAttributeValues(e,s,this.items,n);r.push(t)}o.set(a,this._calculateUniqueValues(r,this.items,e.returnDistinctValues))}const u=o.get(a);for(const t in u){const{data:s,items:i}=u[t],n=s.join(",");r&&!e.validateItems(i,r)||l.add(n)}}return l.size}async createQueryResponse(){let e;if(e=this.query.outStatistics?this.query.outStatistics.some(e=>"exceedslimit"===e.statisticType)?this._createExceedsLimitQueryResponse():await this._createStatisticsQueryResponse(this.query,this.items):this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry){const t=this.query.geometry;o.isValid(this.query.outSR)&&!o.equals(t.spatialReference,this.query.outSR)?e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...u.project(t,t.spatialReference,this.query.outSR)}):e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...t})}return e}createSnappingResponse(e,t,r){const s=this.featureAdapter,i=T(this.hasZ,this.hasM),{point:n,mode:o}=e,a="number"==typeof e.distance?e.distance:e.distance.x,l="number"==typeof e.distance?e.distance:e.distance.y,u={candidates:[]},c="esriGeometryPolygon"===this.geometryType,h="esriGeometryPolyline"===this.geometryType||"esriGeometryPoint"===this.geometryType,p=this._getPointCreator(o,t,this.spatialReference,r),f=new F(null,0),m=new F(null,0),y={x:0,y:0,z:0};for(const t of this.items){const r=s.getGeometry(t);if(null==r)continue;const{coords:o}=r,g=r.isPoint?I:r.lengths;if(f.coords=o,m.coords=o,e.returnEdge){let e=0;for(let r=0;r<g.length;r++){const o=g[r],h=e;for(let r=0;r<o;r++,e+=i){if(!c&&r===o-1)continue;const g=f;g.coordsIndex=e;const _=m;_.coordsIndex=r===o-1?h:e+i;const b=y;if(!x(y,n,g,_))continue;const S=(n.x-b.x)/a,v=(n.y-b.y)/l,T=S*S+v*v;T<=1&&u.candidates.push(d.makeEdgeCandidate(s.getObjectId(t),p(b),Math.sqrt(T),p(g),p(_)))}}}if("all"===e.vertexMode){let e=0;for(let r=0;r<g.length;r++){const o=g[r],h=e,y=m;y.coordsIndex=h;for(let r=0;r<o;r++,e+=i){const i=f;if(i.coordsIndex=e,c&&r===o-1&&i.x===y.x&&i.y===y.y)continue;const h=(n.x-i.x)/a,m=(n.y-i.y)/l,g=h*h+m*m;g<=1&&u.candidates.push(d.makeVertexCandidate(s.getObjectId(t),p(i),Math.sqrt(g)))}}}else if(h&&"ends"===e.vertexMode){let e=0;const r=[];for(let t=0;t<g.length;t++){r.push(e);const s=g[t];e+=s*i,!c&&s>1&&r.push(e-i)}for(const e of r){const r=f;r.coordsIndex=e;const i=(n.x-r.x)/a,o=(n.y-r.y)/l,c=i*i+o*o;c<=1&&u.candidates.push(d.makeVertexCandidate(s.getObjectId(t),p(r),Math.sqrt(c)))}}}return u.candidates.sort((e,t)=>e.distance-t.distance),u}_getPointCreator(e,t,r,s){const i=null==s||o.equals(r,s)?e=>e:e=>u.project(e,r,s),{hasZ:n}=this;return"3d"===e?n&&t?({x:e,y:t,z:r})=>i({x:e,y:t,z:r}):({x:e,y:t})=>i({x:e,y:t,z:0}):({x:e,y:t})=>i({x:e,y:t})}async createSummaryStatisticsResponse(e){const{field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,minValue:o,maxValue:a,scale:l,timeZone:u,outStatisticTypes:c}=e,d=this.fieldsIndex.get(t),p=h.isDateField(d)||h.isDateOnlyField(d)||h.isTimestampOffsetField(d),f=await this._getDataValues({field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,scale:l,timeZone:u},this.items),m=_.isNullCountSupported({normalizationType:i,normalizationField:s,minValue:o,maxValue:a}),y={value:.5,fieldType:d?.type},g=h.isStringField(d)?_.calculateStringStatistics({values:f,supportsNullCount:m,percentileParams:y,outStatisticTypes:c}):_.calculateStatistics({values:f,minValue:o,maxValue:a,useSampleStdDev:!i,supportsNullCount:m,percentileParams:y,outStatisticTypes:c});return _.processSummaryStatisticsResult(g,c,p)}async createUniqueValuesResponse(e){const{field:t,valueExpression:r,domains:s,returnAllCodedValues:i,scale:n,timeZone:o}=e,a=await this._getDataValues({field:t,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:r,scale:n,timeZone:o},this.items,!1),l=_.calculateUniqueValuesCount(a);return _.createUVResult(l,s,i,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:u,numClasses:c,scale:d,timeZone:h}=e,p=await this._getDataValues({field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,scale:d,timeZone:h},this.items),f=_.calculateClassBreaks(p,{field:t,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:u,numClasses:c});return _.resolveCBResult(f,o)}async createHistogramResponse(e){const{field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:u,numBins:c,scale:d,timeZone:h}=e,p=await this._getDataValues({field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,scale:d,timeZone:h},this.items);return _.calculateHistogram(p,{field:t,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:u,numBins:c})}_sortFeatures(e,t,r){if(e.length>1&&t?.length)for(const s of t.slice().reverse()){const t=s.split(" "),i=t[0],n=this.fieldsIndex.get(i),o=!!t[1]&&"desc"===t[1].toLowerCase(),a=_.getAttributeComparator(n?.type,o);e.sort((e,t)=>{const s=r(e,i,n),o=r(t,i,n);return a(s,o)})}}_createFeatureQueryResponse(e){const{items:t,geometryType:r,hasM:s,hasZ:i,objectIdField:o,spatialReference:a}=this,{outFields:u,outSR:c,quantizationParameters:d,resultRecordCount:h,resultOffset:p,returnZ:f,returnM:m}=e,y=null!=h&&t.length>(p||0)+h,g=u&&(u.includes("*")?[...this.fieldsIndex.fields]:u.map(e=>this.fieldsIndex.get(e)));return{exceededTransferLimit:y,features:this._createFeatures(e,t),fields:g,geometryType:r,hasM:s&&m,hasZ:i&&f,objectIdFieldName:o,spatialReference:l.cleanFromGeometryEngine(c||a),transform:d&&n.toQuantizationTransform(d)||null}}_createFeatures(e,t){const r=new a(e,this.featureAdapter,this.fieldsIndex),{hasM:s,hasZ:i}=this,{orderByFields:o,quantizationParameters:u,returnGeometry:c,returnCentroid:d,maxAllowableOffset:h,resultOffset:p,resultRecordCount:f,returnZ:m=!1,returnM:y=!1}=e,g=i&&m,_=s&&y;let b=[],S=0;const v=[...t];if(this._sortFeatures(v,o,(e,t,s)=>r.getFieldValue(e,t,s)),this.geometryType&&(c||d)){const e=n.toQuantizationTransform(u)??void 0,t="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(c&&!d)for(const s of v){const i=this.featureAdapter.getGeometry(s),n={attributes:r.getAttributes(s),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,i,h,e,g,_),metadata:this.featureAdapter.getMetadata?.(s)};t&&i&&!n.geometry&&(n.centroid=l.transformCentroid(this,this.featureAdapter.getCentroid(s,this),e)),b[S++]=n}else if(!c&&d)for(const t of v)b[S++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of v)b[S++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),h,e,g,_),metadata:this.featureAdapter.getMetadata?.(t)}}else for(const e of v){const t=r.getAttributes(e);t&&(b[S++]={attributes:t})}const x=p||0;if(null!=f){const e=x+f;b=b.slice(x,Math.min(b.length,e))}return b}_createExceedsLimitQueryResponse(){let e=!1,t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(const e of this.query.outStatistics??[])if("exceedslimit"===e.statisticType){t=null!=e.maxPointCount?e.maxPointCount:Number.POSITIVE_INFINITY,r=null!=e.maxRecordCount?e.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=e.maxVertexCount?e.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)e=this.items.length>t;else if(this.items.length>r)e=!0;else{const t=T(this.hasZ,this.hasM),r=this.featureAdapter;e=this.items.reduce((e,t)=>{const s=r.getGeometry(t);return e+(null!=s&&s.coords.length||0)},0)/t>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(e)}}]}}async _createStatisticsQueryResponse(e,t,r={attributes:{}}){const s=[],i=new Map,n=new Map,o=new Map,l=new Map,u=new a(e,this.featureAdapter,this.fieldsIndex),c=e.outStatistics,{groupByFieldsForStatistics:d,having:p,orderByFields:f,resultRecordCount:m}=e,y=d?.length,g=!!y,_=g?d[0]:null,b=g&&!this.fieldsIndex.get(_);for(const e of c??[]){const{outStatisticFieldName:a,statisticType:c}=e,f=e,m="exceedslimit"!==c?e.onStatisticField:void 0,S="percentile_disc"===c||"percentile_cont"===c,v="EnvelopeAggregate"===c||"CentroidAggregate"===c||"ConvexHullAggregate"===c,x=g&&1===y&&(m===_||b)&&"count"===c;if(g){if(!o.has(m)){const e=[];for(const r of d){const s=this._getAttributeValues(u,r,t,i);e.push(s)}o.set(m,this._calculateUniqueValues(e,t,!v&&u.returnDistinctValues))}const e=o.get(m);if(!e)continue;const r=Object.keys(e);for(const s of r){const{count:r,data:n,items:o,itemPositions:c}=e[s],h=n.join(",");if(!p||u.validateItems(o,p)){const e=l.get(h)||{attributes:{}};if(v){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:t,outStatisticFieldName:r}=await this._getAggregateGeometry(f,o);e.aggregateGeometries[r]=t}else{let s=null;if(x)s=r;else{const e=this._getAttributeValues(u,m,t,i),r=c.map(t=>e[t]);s=S&&"statisticParameters"in f?this._getPercentileValue(f,r):this._getStatisticValue(f,r,null,u.returnDistinctValues)}e.attributes[a]=s}let s=0;d.forEach((t,r)=>e.attributes[this.fieldsIndex.get(t)?t:"EXPR_"+ ++s]=n[r]),l.set(h,e)}}}else if(v){r.aggregateGeometries||(r.aggregateGeometries={});const{aggregateGeometries:e,outStatisticFieldName:s}=await this._getAggregateGeometry(f,t);r.aggregateGeometries[s]=e}else{const e=this._getAttributeValues(u,m,t,i);r.attributes[a]=S&&"statisticParameters"in f?this._getPercentileValue(f,e):this._getStatisticValue(f,e,n,u.returnDistinctValues)}const T="min"!==c&&"max"!==c||!h.isStringField(this.fieldsIndex.get(m))&&!this._isAnyDateField(m)?null:this.fieldsIndex.get(m)?.type;s.push({name:a,alias:a,type:T||"esriFieldTypeDouble"})}const S=g?Array.from(l.values()):[r];return this._sortFeatures(S,f,(e,t)=>e.attributes[t]),m&&(S.length=Math.min(m,S.length)),{fields:s,features:S}}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return h.isDateField(t)||h.isDateOnlyField(t)||h.isTimestampOffsetField(t)||h.isTimeOnlyField(t)}async _getAggregateGeometry(t,r){const{convexHull:n,union:o}=await new Promise((t,r)=>e(["../../../geometry/geometryEngineJSON"],t,r)),{statisticType:a,outStatisticFieldName:u}=t,{featureAdapter:c,spatialReference:d,geometryType:h,hasZ:p,hasM:f}=this,m=r.map(e=>l.getGeometry(h,p,f,c.getGeometry(e))),y=n(d,m,!0)[0],g={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===a){const e=y?i.getPolygonExtent(y):i.getGeometryExtent(o(d,m));g.aggregateGeometries={...e,spatialReference:d},g.outStatisticFieldName=u||"extent"}else if("CentroidAggregate"===a){const e=y?s.polygonCentroid(y):s.extentCentroid(i.getGeometryExtent(o(d,m)));g.aggregateGeometries={x:e[0],y:e[1],spatialReference:d},g.outStatisticFieldName=u||"centroid"}else"ConvexHullAggregate"===a&&(g.aggregateGeometries=y,g.outStatisticFieldName=u||"convexHull");return g}_getStatisticValue(e,t,r,s){const{onStatisticField:i,statisticType:n}=e;let o=null;return o=r?.has(i)?r.get(i):h.isStringField(this.fieldsIndex.get(i))||this._isAnyDateField(i)?_.calculateStringStatistics({values:t,returnDistinct:s}):_.calculateStatistics({values:s?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(i,o),o["var"===n?"variance":n]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:s,statisticType:i}=e,{value:n,orderBy:o}=s,a=this.fieldsIndex.get(r),l={value:n,orderBy:o,fieldType:a?.type,isDiscrete:"percentile_disc"===i};return _.calculatePercentile(t,l)}_getAttributeValues(e,t,r,s){if(s.has(t))return s.get(t);const i=this.fieldsIndex.get(t),n=r.map(r=>e.getFieldValue(r,t,i));return s.set(t,n),n}_calculateUniqueValues(e,t,r){const s={},i=t.length;for(let n=0;n<i;n++){const i=t[n],o=[];for(const t of e)o.push(t[n]);const a=o.join(",");null==s[a]?s[a]={count:1,data:o,items:[i],itemPositions:[n]}:(r||s[a].count++,s[a].items.push(i),s[a].itemPositions.push(n))}return s}async _getDataValues(e,t,s=!0){const i=new a(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:n,scale:o,timeZone:l}=e;return n?i.getExpressionValues(t,n,{viewingMode:"map",scale:o,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},l):i.getDataValues(t,r.clone(e),s)}_calculateHistogramBins(e,t,r){if(null==t.min&&null==t.max)return[];const s=t.intervals,i=t.min??0,n=t.max??0,o=s.map(([e,t])=>({minValue:e,maxValue:t,count:0,items:[]}));for(let t=0;t<e.length;t++){const a=e[t],l=r[t];if(null!=a&&a>=i&&a<=n){const e=_.binIndex(s,a);e>-1&&(o[e].count++,o[e].items.push(l))}}return o}async createQueryBinsResponse(e){const t=e.bin?.splitBy;if(!t)return this._createBinsResponse(e);const{value:r,outAlias:s,valueType:i}=t,n=[],o=[{name:s??r,alias:s??r,type:i??"esriFieldTypeString"},{name:v,alias:v,type:"esriFieldTypeInteger"}],l=new a(e,this.featureAdapter,this.fieldsIndex),u=new Map,c=[...this.items];this._sortFeatures(c,[r],(e,t,r)=>l.getFieldValue(e,t,r));const d=this._getAttributeValues(l,r,c,u),h=this._calculateUniqueValues([d],c,l.returnDistinctValues);for(const t in h){const{items:i}=h[t],a=await this._createBinsResponse(e,i);if(n.push(...a.features.map(e=>({...e,attributes:{...e.attributes,[s??r]:t}}))),a.fields)for(const e of a.fields)o.some(t=>t.name===e.name)||o.push(e)}return{fields:o,features:n}}async _createBinsResponse(e,t){const r=e.bin;switch(t=t??this.items,r.type){case"autoIntervalBin":return this._createAutoIntervalBinsResponse(p.fromJSON(r),e,t);case"dateBin":return this._createDateBinsResponse(f.fromJSON(r),e,t);case"fixedBoundariesBin":return this._createFixedBoundariesBinsResponse(y.fromJSON(r),e,t);case"fixedIntervalBin":return this._createFixedIntervalBinsResponse(g.fromJSON(r),e,t)}}async _createAutoIntervalBinsResponse(e,t,r){const{field:s,normalizationField:i,numBins:n,normalizationType:o,normalizationTotal:a,start:l,end:u}=e,d=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),h=_.getBinParams(d,{field:s,normalizationField:i,normalizationType:o,normalizationTotal:a,numBins:n,minValue:c.getDateInNumber(l,!1),maxValue:c.getDateInNumber(u,!1)}),p=this._calculateHistogramBins(d,h,r);return this._createFeaturesFromHistogramBins(p,t)}async _createDateBinsResponse(e,t,r){const{field:s,interval:i,start:n,end:o,snapToData:a,returnFullIntervalBin:l}=e,u=i.unit,d=await this._getDataValues({field:e.field,timeZone:t.outTimeReference?.ianaTimeZone},r),p=h.isTimeOnlyField(this.fieldsIndex.get(s)),f=m.unitsDict.toJSON(u),y=d.filter(Boolean).sort((e,t)=>e-t),g=null!=n?c.getDateInNumber(n,p):y[0],_=null!=o?c.getDateInNumber(o,p):y[y.length-1],v={zone:t.outTimeReference?.ianaTimeZone??b.utc},x=S.DateTime.fromMillis(g,v),T=S.DateTime.fromMillis(_,v),F=[];if("last"===a){let e=T;for(;e>x;){const t=e.minus({[f]:i.value});if(t<x){F.unshift([l?t.toMillis():x.toMillis(),e.toMillis()]);break}F.unshift([t.toMillis(),e.toMillis()]),e=t}}else{let e="first"===a?x:x.startOf(f);for(;e<=T;){const t=e.plus({[f]:i.value});if(t>T){F.push([e.toMillis(),l?t.toMillis():T.toMillis()]);break}F.push([e.toMillis(),t.toMillis()]),e=t}}const I=this._calculateHistogramBins(d,{intervals:F,min:g,max:_},r);return this._createFeaturesFromHistogramBins(I,t)}async _createFixedBoundariesBinsResponse(e,t,r){const{field:s}=e,i=await this._getDataValues({field:s,timeZone:t.outTimeReference?.ianaTimeZone},r),n=h.isTimeOnlyField(this.fieldsIndex.get(s)),o=e.boundaries.map(e=>c.getDateInNumber(e,n)).sort((e,t)=>e-t),a=[];for(let e=0;e<o.length-1;e++)a.push([o[e],o[e+1]]);const l={intervals:a,min:o.at(0),max:o.at(-1)},u=this._calculateHistogramBins(i,l,r);return this._createFeaturesFromHistogramBins(u,t)}async _createFixedIntervalBinsResponse(e,t,r){const{field:s,interval:i,start:n,end:o}=e,a=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),l=h.isTimeOnlyField(this.fieldsIndex.get(s)),u=_.getBinParams(a,{field:s,classificationMethod:"defined-interval",definedInterval:i,minValue:c.getDateInNumber(n,l),maxValue:c.getDateInNumber(o,l)},!0),d=this._calculateHistogramBins(a,u,r);return this._createFeaturesFromHistogramBins(d,t)}async _createFeaturesFromHistogramBins(e,t){const{upperBoundaryAlias:r,lowerBoundaryAlias:s}=t,i=s||"lowerBoundary",n=r||"upperBoundary",o=[],a=[{name:i,alias:i,type:"esriFieldTypeDouble"},{name:n,alias:n,type:"esriFieldTypeDouble"}],l=t.bin?.stackBy?.value,u=t.bin?.stackBy?.outAlias;l&&a.push({name:v,alias:v,type:"esriFieldTypeInteger"},{name:u??l,alias:u??l,type:"esriFieldTypeString"});let c=0;const d="dateBin"===t.bin.type,h=t.outTimeReference?.ianaTimeZone;for(const r of e){const{minValue:e,maxValue:s,items:p}=r,f={attributes:{}};let m;if(f.attributes[i]=d&&h&&null!=e?S.DateTime.fromMillis(e,{zone:h}).toISO():e,f.attributes[n]=d&&h&&null!=s?S.DateTime.fromMillis(s,{zone:h}).toISO():s,l?(m=await this._createStatisticsQueryResponse({...t,groupByFieldsForStatistics:[l],orderByFields:[l]},p),f.attributes[v]=++c,"flat"===t.bin.jsonStyle?o.push(...m.features.map(({attributes:{EXPR_1:e,...t},...r})=>({...r,attributes:u??e?{...t,[u??e]:e,...f.attributes}:{...t,...f.attributes}}))):(f.stackedAttributes=m.features.map(({attributes:{EXPR_1:e,...t}})=>u??e?{...t,[u??e]:e}:t),o.push(f))):(t.bin?.splitBy&&(f.attributes[v]=++c),m=await this._createStatisticsQueryResponse(t,p,f),o.push(f)),m.fields)for(const e of m.fields)a.some(t=>t.name===e.name)||a.push(e)}return"desc"===t.binOrder&&o.reverse(),{fields:a,features:o}}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(e,t){"use strict";function r(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:s}=e,i=r[0]??1,n=r[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===t?n:-n,r[2]??1,r[3]??1],translate:[s[0]??0,s[1]??0,s[2]??0,s[3]??0]}}function s({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function i({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function n({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}function o({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}function a(e,t){return e&&t?d:e&&!t?u:!e&&t?c:l}const l=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let o=s(e,n[0]),a=i(e,n[1]);r.push([o,a]);for(let n=1;n<t.length;n++){const[l,u]=t[n],c=s(e,l),d=i(e,u);c===o&&d===a||r.push([c-o,d-a]),o=c,a=d}return r},u=(e,t)=>{const r=[];if(!t.length)return null;const o=t[0];let a=s(e,o[0]),l=i(e,o[1]),u=n(e,o[2]);r.push([a,l,u]);for(let o=1;o<t.length;o++){const[c,d,h]=t[o],p=s(e,c),f=i(e,d),m=n(e,h);p===a&&f===l&&m===u||r.push([p-a,f-l,m]),a=p,l=f,u=m}return r},c=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let a=s(e,n[0]),l=i(e,n[1]),u=o(e,n[2]);r.push([a,l,u]);for(let n=1;n<t.length;n++){const[c,d,h]=t[n],p=s(e,c),f=i(e,d),m=o(e,h);p===a&&f===l&&m===u||r.push([p-a,f-l,m]),a=p,l=f,u=m}return r},d=(e,t)=>{const r=[];if(!t.length)return null;const a=t[0];let l=s(e,a[0]),u=i(e,a[1]),c=n(e,a[2]),d=o(e,a[3]);r.push([l,u,c,d]);for(let a=1;a<t.length;a++){const[h,p,f,m]=t[a],y=s(e,h),g=i(e,p),_=n(e,f),b=o(e,m);y===l&&g===u&&_===c&&b===d||r.push([y-l,g-u,_,b]),l=y,u=g,c=_,d=b}return r};function h({scale:e,translate:t},r){return r*e[0]+t[0]}function p({scale:e,translate:t},r){return r*e[1]+t[1]}function f({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function m({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function y(e,t){return e&&t?S:e&&!t?_:!e&&t?b:g}const g=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=h(e,s[0]),n=p(e,s[1]);r[0]=[i,n];const{scale:o,originPosition:a}=e,l=o[0],u="lowerLeft"===a?o[1]:-o[1];for(let e=1;e<t.length;e++){const[s,o]=t[e];i+=l*s,n+=u*o,r[e]=[i,n]}return r},_=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=h(e,s[0]),n=p(e,s[1]);r[0]=[i,n,f(e,s[2])];const{scale:o,originPosition:a}=e,l=o[0],u="lowerLeft"===a?o[1]:-o[1];for(let s=1;s<t.length;s++){const[o,a,c]=t[s];i+=l*o,n+=u*a,r[s]=[i,n,f(e,c)]}return r},b=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=h(e,s[0]),n=p(e,s[1]);r[0]=[i,n,m(e,s[2])];const{scale:o,originPosition:a}=e,l=o[0],u="lowerLeft"===a?o[1]:-o[1];for(let s=1;s<t.length;s++){const[o,a,c]=t[s];i+=l*o,n+=u*a,r[s]=[i,n,m(e,c)]}return r},S=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=h(e,s[0]),n=p(e,s[1]);r[0]=[i,n,f(e,s[2]),m(e,s[3])];const{scale:o,originPosition:a}=e,l=o[0],u="lowerLeft"===a?o[1]:-o[1];for(let s=1;s<t.length;s++){const[o,a,c,d]=t[s];i+=l*o,n+=u*a,r[s]=[i,n,f(e,c),m(e,d)]}return r};function v(e,t,r){const s=new Array(r.length);for(let i=0;i<r.length;i++)s[i]=t(e,r[i]);return s}function x(e,t,r){let[s,i]=r[0],n=Math.min(s,t[0]),o=Math.min(i,t[1]),a=Math.max(s,t[2]),l=Math.max(i,t[3]);for(let e=1;e<r.length;e++){const[t,u]=r[e];s+=t,i+=u,t<0&&(n=Math.min(n,s)),t>0&&(a=Math.max(a,s)),u<0?o=Math.min(o,i):u>0&&(l=Math.max(l,i))}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function T(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++)x(e,e,t[r]);return e}function F(e,t,a){const l=r(e);return t.xmin=s(l,a.xmin),t.ymin=i(l,a.ymin),t.xmax=s(l,a.xmax),t.ymax=i(l,a.ymax),a.hasZ&&(t.zmin=n(l,a.zmin),t.zmax=n(l,a.zmax)),a.hasM&&(t.mmin=o(l,a.mmin),t.mmax=o(l,a.mmax)),t.hasZ=a.hasZ??!1,t.hasM=a.hasM??!1,t}function I(e,t,s){const i=r(e);return t.points=a(s.hasZ,s.hasM)(i,s.points)??[],t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t}function M(e,t,a){const l=r(e);return t.x=s(l,a.x),t.y=i(l,a.y),null!=a.z&&(t.z=n(l,a.z)),null!=a.m&&(t.m=o(l,a.m)),t}function w(e,t,s){const i=function(e,t,r,s){const i=[],n=a(r,s);for(let r=0;r<t.length;r++){const s=n(e,t[r]);s&&s.length>=3&&i.push(s)}return i.length?i:null}(r(e),s.rings,s.hasZ,s.hasM);return i?(t.rings=i,t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t):null}function R(e,t,s){const i=function(e,t,r,s){const i=[],n=a(r,s);for(let r=0;r<t.length;r++){const s=n(e,t[r]);s&&s.length>=2&&i.push(s)}return i.length?i:null}(r(e),s.paths,s.hasZ,s.hasM);return i?(t.paths=i,t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t):null}e.getQuantizedBoundsCoordsArray=x,e.getQuantizedBoundsCoordsArrayArray=T,e.getQuantizedBoundsPaths=function(e){return T([0,0,0,0],e)},e.getQuantizedBoundsPoints=function(e){const t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return x(t,t,e)},e.getQuantizedBoundsRings=function(e){return T([0,0,0,0],e)},e.normalizeTransform=r,e.quantizeBounds=function(e,t,n){const o=r(e);return t[0]=s(o,n[0]),t[3]=i(o,n[1]),t[2]=s(o,n[2]),t[1]=i(o,n[3]),t},e.quantizeCoordsArrayXY=l,e.quantizeCoordsArrayXYM=c,e.quantizeCoordsArrayXYZ=u,e.quantizeCoordsArrayXYZM=d,e.quantizeExtent=F,e.quantizeGeometry=function(e,r){return e&&r?t.isPoint(r)?M(e,{},r):t.isPolyline(r)?R(e,{},r):t.isPolygon(r)?w(e,{},r):t.isMultipoint(r)?I(e,{},r):t.isExtent(r)?F(e,{},r):null:null},e.quantizeM=o,e.quantizeMultipoint=I,e.quantizePoint=M,e.quantizePolygon=w,e.quantizePolyline=R,e.quantizeX=s,e.quantizeY=i,e.quantizeZ=n,e.toQuantizationTransform=function(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null},e.unquantizeBounds=function(e,t,s){const i=r(e);return s?(t[0]=h(i,s[0]),t[1]=p(i,s[3]),t[2]=h(i,s[2]),t[3]=p(i,s[1]),t):[h(i,t[0]),p(i,t[3]),h(i,t[2]),p(i,t[1])]},e.unquantizeCoordsArrayArray=v,e.unquantizeCoordsArrayXY=g,e.unquantizeCoordsArrayXYM=b,e.unquantizeCoordsArrayXYZ=_,e.unquantizeCoordsArrayXYZM=S,e.unquantizeExtent=function(e,t,s,i=s.hasZ??!1,n=s.hasM??!1){const o=r(e);return t.xmin=h(o,s.xmin),t.xmax=h(o,s.xmax),t.ymin=p(o,s.ymin),t.ymax=p(o,s.ymax),i&&(t.zmin=f(o,s.zmin),t.zmax=f(o,s.zmax)),n&&(t.mmin=m(o,s.mmin),t.mmax=m(o,s.mmax)),t.hasZ=i,t.hasM=n,t},e.unquantizeM=m,e.unquantizeMultipoint=function(e,t,s,i=s?.hasZ??!1,n=s?.hasM??!1){if(null!=s){const o=r(e);t.points=y(i,n)(o,s.points),t.hasZ=i,t.hasM=n}return t},e.unquantizePoint=function(e,t,s,i=null!=s?.z,n=null!=s?.m){if(null==s)return t;const o=r(e);return t.x=h(o,s.x),t.y=p(o,s.y),i&&(t.z=f(o,s.z)),n&&(t.m=m(o,s.m)),t},e.unquantizePolygon=function(e,t,s,i=s?.hasZ??!1,n=s?.hasM??!1){if(null!=s){const o=r(e);t.rings=v(o,y(i,n),s.rings),t.hasZ=i,t.hasM=n}return t},e.unquantizePolyline=function(e,t,s,i=s?.hasZ??!1,n=s?.hasM??!1){if(null!=s){const o=r(e);t.paths=v(o,y(i,n),s.paths),t.hasZ=i,t.hasM=n}return t},e.unquantizeX=h,e.unquantizeY=p,e.unquantizeZ=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["./attributeSupport","./geometryUtils","../../support/fieldUtils","../../../smartMapping/statistics/support/utils","../../../statistics/utils","../../../support/loadArcade"],function(e,t,r,s,i,n){"use strict";return class{constructor(t,r,s){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues??!1,this.fieldsIndex=s,this.featureAdapter=r;const i=t.outFields;if(i&&!i.includes("*")){this.outFields=i;let t=0;for(const r of i){const i=e.getExpressionFromFieldName(r),n=this.fieldsIndex.get(i),o=n?null:e.getWhereClause(i,s),a=n?n.name:e.getAliasFromFieldName(r)||"FIELD_EXP_"+t++;this._fieldDataCache.set(r,{alias:a,clause:o})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach(e=>this.getAttributes(e)),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(t,r,s){const i=s?s.name:r;let n=null;return this._fieldDataCache.has(i)?n=this._fieldDataCache.get(i)?.clause:s||(n=e.getWhereClause(r,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:n})),s?this.featureAdapter.getAttribute(t,i):n?.calculateValue(t,this.featureAdapter)}getDataValues(e,t,n=!0){const o=t.normalizationType,a=t.normalizationTotal,l=this.fieldsIndex.get(t.field),u=r.isDateOnlyField(l)||r.isTimestampOffsetField(l),c=r.isTimeOnlyField(l);return e.map(e=>{let r=t.field&&this.getFieldValue(e,t.field,this.fieldsIndex.get(t.field));if(t.field2?(r=`${i.processNullValue(r)}${t.fieldDelimiter}${i.processNullValue(this.getFieldValue(e,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(r=`${r}${t.fieldDelimiter}${i.processNullValue(this.getFieldValue(e,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof r&&n&&(u?r=r?new Date(r).getTime():null:c&&(r=r?s.timeOnlyToMilliseconds(r):null)),o&&Number.isFinite(r)){const s="field"===o&&t.normalizationField?this.getFieldValue(e,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;r=i.getNormalizedValue(r,o,s,a)}return r})}async getExpressionValues(e,r,s,i,o){const{arcadeUtils:a}=await n.loadArcade(),l=a.hasGeometryOperations(r);l&&await a.enableGeometryOperations();const u=a.createFunction(r),c=a.getViewInfo(s),d={fields:this.fieldsIndex.fields};return e.map(e=>{const r={attributes:this.featureAdapter.getAttributes(e),layer:d,geometry:l?{...t.getGeometry(i.geometryType,i.hasZ,i.hasM,this.featureAdapter.getGeometry(e)),spatialReference:s?.spatialReference}:null},n=a.createExecContext(r,c,o);return a.executeFunction(u,n)})}validateItem(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testFeature(t,this.featureAdapter)??!1}validateItems(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testSet(t,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const r={};for(const s of t){const{alias:t,clause:i}=this._fieldDataCache.get(s);r[t]=i?i.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const s of t){const{alias:t}=this._fieldDataCache.get(s);r.push(e[t])}else for(const t in e)r.push(e[t]);const s=`${(t||["*"]).join(",")}=${r.join(",")}`;let i=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++i),i>1?null:e}}})},"esri/smartMapping/statistics/support/utils":function(){define(["exports","../../../core/Error","../../../core/screenUtils","../../../core/timeUtils","../../../geometry/Point","../../../geometry/SpatialReference","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/support/fieldUtils","../../../renderers/support/heatmapUtils","../../support/utils","../../../statistics/utils","../../../support/loadArcade"],function(e,t,r,s,i,n,o,a,l,u,c,d,h){"use strict";let p=null;const f=/^(?<hh>([01][0-9])|(2[0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?(\.(?<ms>\d+))?$/;function m(e){const t=f.exec(e);if(!t)return null;const{hh:r,mm:i,ss:n,ms:o}=t.groups;return Number(r)*s.millisecondsPerTimeUnit.hours+Number(i)*s.millisecondsPerTimeUnit.minutes+Number(n)*s.millisecondsPerTimeUnit.seconds+Number(o||0)}function y(e,t){let r=null!=e?e:"";return null!=t&&t&&(r=r?"("+r+") AND ("+t+")":t),r}e.calculateHeatmapStats=function(e,t=18,s,i,n){const o=new Float64Array(i*n);t=Math.round(r.pt2px(t));let a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const c=u.createValueFunction(s);for(const{geometry:r,attributes:s}of e){const{x:e,y:d}=r,h=Math.max(0,e-t),p=Math.max(0,d-t),f=Math.min(n,d+t),m=Math.min(i,e+t),y=+c(s);for(let r=p;r<f;r++)for(let s=h;s<m;s++){const n=r*i+s,c=u.evaluateDensityKernel(s-e,r-d,t)*y,h=o[n]+=c;a=Math.min(a,h),l=Math.max(l,h)}}return{min:a,max:l}},e.getDataValues=async function(e,t,r=!0){if(!t)return[];const{field:s,field2:i,field3:o,fieldDelimiter:a,fieldInfos:u,timeZone:f}=e,y=s&&u?.find(e=>e.name.toLowerCase()===s.toLowerCase()),g=!!y&&l.isTimeOnlyField(y),_=!!y&&c.isAnyDateField(y),b=e.valueExpression,S=e.normalizationType,v=e.normalizationField,x=e.normalizationTotal,T=[],F=e.viewInfoParams;let I=null,M=null;if(b){if(!p){const{arcadeUtils:e}=await h.loadArcade();p=e}p.hasGeometryOperations(b)&&await p.enableGeometryOperations(),I=p.createFunction(b),M=F?p.getViewInfo({viewingMode:F.viewingMode,scale:F.scale,spatialReference:new n(F.spatialReference)}):null}const w=e.fieldInfos,R=t[0]&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass||!w?null:{fields:w};return t.forEach(e=>{const t=e.attributes;let n;if(b){const t=R?Object.assign({},e,{layer:R}):e,r=p.createExecContext(t,M,f);n=p.executeFunction(I,r)}else t&&(n=t[s],i?(n=`${d.processNullValue(n)}${a}${d.processNullValue(t[i])}`,o&&(n=`${n}${a}${d.processNullValue(t[o])}`)):"string"==typeof n&&r&&(_?n=n?new Date(n).getTime():null:g&&(n=n?m(n):null)));if(S&&"number"==typeof n&&isFinite(n)){const e=t&&parseFloat(t[v]);n=d.getNormalizedValue(n,S,e,x)}T.push(n)}),T},e.getRangeExpr=function(e,t,r){const s=null!=t?e+" >= "+t:"",i=null!=r?e+" <= "+r:"";let n="";return n=s&&i?y(s,i):s||i,n?"("+n+")":""},e.getSQLFilterForNormalization=function(e){const t=e.field,r=e.normalizationType,s=e.normalizationField;let i;return"field"===r?i="(NOT "+s+" = 0)":"log"!==r&&"natural-log"!==r&&"square-root"!==r||(i=`(${t} > 0)`),i},e.getSumOfAttributesExpr=function(e,t,r){const s=[],i=[],n=[],o=[],a=[];e.forEach((e,t)=>{const l=e.field?"field":"expression",u=e.field||e.valueExpression;e.field?(a.push(u),i.push(`var ${l}${t} = Number($feature["${u}"]);`)):(s.push(`function getValueForExpr${t}() {\n  ${u} \n}`),i.push(`var ${l}${t} = Number(getValueForExpr${t}());`)),r||n.push(`${l}${t} = IIf(${l}${t} < 0, 0, ${l}${t});`),o.push(`${l}${t}`)});const l=s.length?null:a.reduce((e,t)=>`${e} + ${t}`);let u=null;return t||r?t?r||l&&(u=`(( ${l} ) >= 0)`):l&&(u=`(( ${l} ) <> 0)`):l&&(u=`(( ${l} ) > 0)`),{valueExpression:[s.length?s.join("\n"):"",i.join("\n"),n.join("\n"),`var total = ${o.join(" + ")};`,"return total;"].filter(Boolean).join("\n\n"),sqlExpression:l,sqlWhere:u}},e.mergeWhereClauses=y,e.quantizeFeatures=function(e,t,r,s){const n=a.isWrappable(r)?a.getInfo(r):null,l=n?Math.round((n.valid[1]-n.valid[0])/t.scale[0]):null;return e.map(e=>{const r=new i(e.geometry);return o.quantizePoint(t,r,r),e.geometry=n?function(e,t,r){return e.x<0?e.x+=t:e.x>r&&(e.x-=t),e}(r,l??0,s[0]):r,e})},e.timeOnlyToMilliseconds=m,e.verifyBasicFieldValidity=function(e,r,s){const i=function(e){const t=e.layer;return e.fields.filter(e=>!t.getField(e))}({layer:e,fields:r});if(i.length)return new t(s,"Unknown fields: "+i.join(", ")+". You can only use fields defined in the layer schema");const n=function(e){const t=e.layer;return e.fields.filter(e=>{const r=t.getFieldUsageInfo(e);return!r||!r.supportsStatistics})}({layer:e,fields:r});return n.length?new t(s,"Unsupported fields: "+n.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0},e.verifyFieldType=function(e,r,s,i){let n;return r?r.name!==e.objectIdField&&i.includes(r.type)||(n=new t(s,"'field' should be one of these types: "+i.join(","))):n=new t(s,"'field' is not defined in the layer schema"),n},e.verifyFilterValidity=function(e,r){if(e&&"intersects"!==e.spatialRelationship)return new t(r,"Only 'intersects' spatialRelationship is supported for featureFilter")},e.verifyNumericField=function(e,r,s){let i;return r?r.name!==e.objectIdField&&l.isNumericField(r)||(i=new t(s,"'field' should be one of these numeric types: "+l.numericTypes.join(","))):i=new t(s,"'field' is not defined in the layer schema"),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/screenUtils":function(){define(["exports"],function(e){"use strict";const t=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function r(e){return e?72*e/96:0}function s(e=0,t=0){return{x:e,y:t}}e.castRenderScreenPointArray=function(e){return e},e.castRenderScreenPointArray3=function(e){return e},e.castScreenPointArray=function(e){return e},e.cloneScreenPoint=function(e){return e?s(e.x,e.y):null},e.createRenderScreenPoint=function(e=0,t=0){return{x:e,y:t}},e.createRenderScreenPointArray=function(e=0,t=0){return[e,t]},e.createRenderScreenPointArray3=function(e=0,t=0,r=0){return[e,t,r]},e.createScreenPoint=s,e.createScreenPointArray=function(e=0,t=0){return[e,t]},e.pt2px=function(e){return e?e/72*96:0},e.px2pt=r,e.screenPointArrayToObject=function(e,t){return t?(t.x=e[0],t.y=e[1],t):{x:e[0],y:e[1]}},e.screenPointObjectToArray=function(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]},e.toPt=function(e){if("string"==typeof e){const s=e.match(t);if(s){const t=Number(s[1]),i=s[3]&&s[3].toLowerCase(),n=e.startsWith("-"),o="px"===i?r(t):t;return n?-o:o}return console.warn("screenUtils.toPt: input not recognized!"),null}return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64"],function(e,t,r,s,i){"use strict";function n(e,r,i,n){let{color:o,ratio:a}=r,{color:l,ratio:u}=i;if(u===a){const e=1e-6;1===u?a-=e:u+=e}const c=t.clamp((n-a)/(u-a),0,1);s.lerp(e,o.toArray(),l.toArray(),c)}e.createValueFunction=function(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1},e.evaluateDensityKernel=function(e,t,r){const s=Math.sqrt(e**2+t**2)/r;return s>1?0:3/(Math.PI*r**2)*(1-s**2)**2},e.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(e){return r.px2pt(2.4*e)},e.generateGradient=function(e){const t=new Uint8ClampedArray(2048);if((e=e.filter(({ratio:e})=>e>=0&&e<=1).sort((e,t)=>e.ratio-t.ratio).map(({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)}))).length<1)return t;let r=e[0],s=e[0],o=1;const a=i.create();for(let i=0;i<512;i++){const l=(i+.5)/512;for(;l>s.ratio&&o<e.length;)r=s,s=e[o++];n(a,r,s,l),t.set(a,4*i)}return t},e.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(e){return r.pt2px(e)/2.4},e.magicKernelDensityRadiusInflationFactor=2.4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define(["exports","../../intl/date","../../layers/support/fieldUtils","../../support/basemapUtils","../../support/loadArcade","../../time/constants","../../time/timeZoneUtils"],function(e,t,r,s,i,n,o){"use strict";const a={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},u=new Set(["integer","small-integer"]);let c=null;function d(e){return String(e).padStart(2,"0")}function h(e,t,r){let s;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),s=`TIMESTAMP'${r?e.getFullYear():e.getUTCFullYear()}-${d((r?e.getMonth():e.getUTCMonth())+1)}-${d(r?e.getDate():e.getUTCDate())} ${d(r?e.getHours():e.getUTCHours())}:${d(r?e.getMinutes():e.getUTCMinutes())}:${d(r?e.getSeconds():e.getUTCSeconds())}'`):s=e,s}function p(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const s=e.getField(t);if("<now>"===t.toLowerCase())return;if(r.isDateField(s))return"field"}}e.castIntegerFieldToFloat=function(e){return`cast(${e} as float)`},e.dateTypes=["date","date-only","timestamp-offset"],e.defaultBasemapGroups=a,e.defaultStatisticTypes={exclude:["median"]},e.fieldDelimiter=",",e.formatAnyDate=function(e,r){const{format:s,timeZoneOptions:i,fieldType:a}=r??{};let l,u;if(i&&({timeZone:l,timeZoneName:u}=o.getTimeZoneFormattingOptions(i.layerTimeZone,i.datesInUnknownTimezone,i.viewTimeZone,t.convertDateFormatToIntlOptions(s||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const r=t.convertDateFormatToIntlOptions(s||"short-date");return"string"==typeof e?t.formatDateOnly(e,{...r}):t.formatDate(e,{...r,timeZone:n.utc})}case"time-only":{const r=t.convertDateFormatToIntlOptions(s||"short-time");return"string"==typeof e?t.formatTimeOnly(e,r):t.formatDate(e,{...r,timeZone:n.utc})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const r=s||i?t.convertDateFormatToIntlOptions(s||"short-date-short-time"):void 0,n=r?{...r,timeZone:l,timeZoneName:u}:void 0;return"string"==typeof e?t.formatTimestamp(e,n):t.formatDate(e,n)}default:{const r=s||i?t.convertDateFormatToIntlOptions(s||"short-date-short-time"):void 0;return t.formatDate("string"==typeof e?new Date(e):e,r?{...r,timeZone:l,timeZoneName:u}:void 0)}}},e.getBasemapGroup=function(e,t=a){for(const r in t)if(t[r].includes(e))return r},e.getBasemapId=function(e,t,r=!0){let i=null;return e&&("string"==typeof e?t.includes(e)&&(i=e):i=s.getWellKnownBasemapId(e)),r?i||"gray":i},e.getDateDiffSQL=function(e,t,r,s){const{hasQueryEngine:i}=e,n=`(${h(r,p(e,r),i)} - ${h(t,p(e,t),i)})`;let o=l[s],a="/";return o<1&&(o=1/o,a="*"),{sqlExpression:1===o?n:`(${n} ${a} ${o})`,sqlWhere:null}},e.getDateType=p,e.getFieldsList=async function(e){const{field:t,field2:r,field3:s,normalizationField:n,valueExpression:o}=e;let a=[];if(o){if(!c){const{arcadeUtils:e}=await i.loadArcade();c=e}a=c.extractFieldNames(o)}return t&&a.push(t),r&&a.push(r),s&&a.push(s),n&&a.push(n),a},e.getNormalizationType=function(e){let t=e.normalizationType;return t||(e.normalizationField?t="field":null!=e.normalizationTotal&&(t="percent-of-total")),t??void 0},e.isAnyDateField=function(e){return r.isDateField(e)||r.isDateOnlyField(e)||r.isTimestampOffsetField(e)},e.isIntegerField=function(e,t){const r=t&&e.getField(t);return!!r&&u.has(r.type)},e.unitValueInDays=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapUtils":function(){define(["exports","../core/Collection","../core/maybe","../core/urlUtils","../layers/effects/utils","./basemapDefinitions"],function(e,t,r,s,i,n){"use strict";let o;function a(e){if(o)return o(e);let t=null;const r=d(e),s=!r?.baseLayers.length;for(const e in n.esriBasemapDefinitions){const i=g(r,m(n.esriBasemapDefinitions[e]),{mustMatchReferences:s});if("equal"===i){t=e;break}"base-layers-equal"===i&&(t=e)}return t}function l(e){if(c(e.url))return!0;if("vector-tile"===e.type)for(const t in e.sourceNameToSource){const r=e.sourceNameToSource[t];if(c(r?.sourceUrl))return!0}return!1}const u=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function c(e){if(!e)return!1;const t=new s.Url(s.makeAbsolute(e));return!!t.authority&&u.test(t.authority)}function d(e){return e?!e.loaded&&e.resourceInfo?m(e.resourceInfo.data):{baseLayers:h(e.baseLayers),referenceLayers:h(e.referenceLayers)}:null}function h(e){return(t.isCollection(e)?e.toArray():e).map(p)}function p(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:S("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers?void 0:e.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function f(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function m(e){return e?{baseLayers:y((e.baseMapLayers??[]).filter(e=>!f(e))),referenceLayers:y((e.baseMapLayers??[]).filter(e=>f(e)))}:null}function y(e){return e.map(e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:S(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e))}function g(e,t,r){return null!=e!=(null!=t)?"not-equal":e&&t?_(e.baseLayers,t.baseLayers)?_(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function _(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!b(e[r],t[r]))return!1;return!0}function b(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(!i.effectEquals(e.effect,t.effect))return!1;if(null!=e.activeLayerId||null!=t.activeLayerId)return e.activeLayerId===t.activeLayerId;if(null!=e.sublayers||null!=t.sublayers){if(null==e.sublayers||null==t.sublayers||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const s=e.sublayers.at(r),i=t.sublayers.at(r);if(s?.id!==i?.id||s?.visible!==i?.visible)return!1}}return!0}function S(e){return e?s.normalize(e).replace(/^\s*https?:/i,"").toLowerCase():""}function v(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}e.contentEquals=function(e,t){return e===t||null!=e?.portalItem?.id&&e.portalItem.id===t?.portalItem?.id||"equal"===g(d(e),d(t),{mustMatchReferences:!0})},e.findSpatialReference=function(e,t){if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};const r=t.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const s=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),i=e.spatialReference;return i?{spatialReference:s.find(e=>i.equals(e))??s[0]??null,updating:!1}:{spatialReference:s[0],updating:!1}},e.getBasemapThumbnailUrl=function(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const s=a(e);return s?n.esriBasemapDefinitions[s].thumbnailUrl:r.mappedFind(e.baseLayers,v)},e.getWellKnownBasemapId=a,e.hasDeveloperBasemapLayer=function(e){return!!e?.baseLayers.concat(e.referenceLayers).some(l)},e.isBasemap3D=function(e){return"Web Scene"===e.portalItem?.type||e.referenceLayers.some(e=>"scene"===e.type)},e.isBasemapInBeta=function(e){return!!e?.portalItem?.tags?.some(e=>"beta"===e.toLowerCase())},e.isBasemapLayerView=function(e,t){const r=e.allLayerViews.find(e=>e.uid===t);return r?.layer.parent===e.map?.basemap},e.isDeveloperBasemapLayer=l,e.layerDefinitionEquals=b,e.layerToDefinition=p,e.overrideGetWellKnownBasemapId=function(e){o=e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/Collection":function(){define(["../chunks/tslib.es6","./ArrayPool","./Evented","./handleUtils","./lang","./ObjectPool","./scheduling","./accessorSupport/ensureType","./accessorSupport/tracking","./accessorSupport/decorators/property","./accessorSupport/decorators/shared","./accessorSupport/decorators/subclass","./accessorSupport/tracking/SimpleObservable","./support/jsonUtils"],function(e,t,r,s,i,n,o,a,l,u,c,d,h,p){"use strict";var f;class m{constructor(e,t,r,s,i){this.target=e,this.added=t,this.removed=r,this.start=s,this.deleteCount=i}}const y=new n(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1});function g(e){e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy&&e.destroy()}function _(e){return e?e instanceof w?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function b(e){if(e?.length)return e[0]}function S(e,t,r,s){const i=Math.min(e.length-r,t.length-s);let n=0;for(;n<i&&e[r+n]===t[s+n];)n++;return n}function v(e,t,r,s){t&&t.forEach((t,i,n)=>{e.push(t),v(e,r.call(s,t,i,n),r,s)})}const x=new Set,T=new Set,F=new Set,I=new Map;let M=0,w=class extends r.EventedAccessor{static{f=this}static{this.ofType=t=>{if(!t)return f;if(I.has(t))return I.get(t);let r=null;if("function"==typeof t)r=t.prototype.declaredClass;else if(t.base)r=t.base.prototype.declaredClass;else for(const e in t.typeMap){const s=t.typeMap[e].prototype.declaredClass;r?r+=` | ${s}`:r=s}let s=class extends f{};return e.__decorate([c.shared({Type:t,ensureType:"function"==typeof t?a.ensureType(t):a.ensureOneOfType(t)})],s.prototype,"itemType",void 0),s=e.__decorate([d.subclass(`esri.core.Collection<${r}>`)],s),I.set(t,s),s}}static isCollection(e){return null!=e&&e instanceof f}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new h.SimpleObservable,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:M++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof f?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),super.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return l.trackAccess(this._observable),this._items}set items(e){this._emitBeforeChanges(1)||(this._splice(0,this.length,_(e)),this._emitAfterChanges(1))}hasEventListener(e){return!this.destroyed&&("change"===e?this._chgListeners.length>0:super.hasEventListener(e))}on(e,t){if(this.destroyed)return s.makeHandle();if("change"===e){const e=this._chgListeners,r={removed:!1,callback:t};return e.push(r),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),s.makeHandle(()=>{r.removed=!0,e.splice(e.indexOf(r),1)})}return super.on(e,t)}once(e,t){const r="deref"in t?()=>t.deref():()=>t,s=this.on(e,e=>{r()?.call(null,e),s.remove()});return s}add(e,t){if(l.trackAccess(this._observable),this._emitBeforeChanges(1))return this;const r=this.getNextIndex(t??null);return this._splice(r,0,[e]),this._emitAfterChanges(1),this}addMany(e,t=this._items.length){if(l.trackAccess(this._observable),!e?.length)return this;if(this._emitBeforeChanges(1))return this;const r=this.getNextIndex(t);return this._splice(r,0,_(e)),this._emitAfterChanges(1),this}at(e){if(l.trackAccess(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return[];const e=this._removeAllRaw();return this._emitAfterChanges(2),e}_removeAllRaw(){return 0===this.length?[]:this._splice(0,this.length)||[]}clone(){return l.trackAccess(this._observable),this._createNewInstance({items:this._items.map(i.clone)})}concat(...e){l.trackAccess(this._observable);const t=e.map(_);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const r=this._splice(0,this.length),s=r.length;for(let i=0;i<s;i++)e.call(t,r[i],i,r);this._emitAfterChanges(2)}destroyAll(){this.drain(g)}destroyMany(e){const t=this.removeMany(e);return t.forEach(g),t}every(e,t){return l.trackAccess(this._observable),this._items.every(e,t)}filter(e,t){l.trackAccess(this._observable);const r=2===arguments.length?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:r})}find(e,t){return l.trackAccess(this._observable),this._items.find(e,t)}findIndex(e,t){return l.trackAccess(this._observable),this._items.findIndex(e,t)}flatten(e,t){l.trackAccess(this._observable);const r=[];return v(r,this,e,t),new f(r)}forEach(e,t){return l.trackAccess(this._observable),this._items.forEach(e,t)}getItemAt(e){return l.trackAccess(this._observable),this._items[e]}getNextIndex(e){l.trackAccess(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return l.trackAccess(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return l.trackAccess(this._observable),this._items.indexOf(e,t)}join(e=","){return l.trackAccess(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return l.trackAccess(this._observable),this._items.lastIndexOf(e,t)}map(e,t){l.trackAccess(this._observable);const r=this._items.map(e,t);return new f({items:r})}reorder(e,t=this.length-1){l.trackAccess(this._observable);const r=this.indexOf(e);if(-1!==r){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(4))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(4)}return e}}pop(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=b(this._splice(this.length-1,1));return this._emitAfterChanges(2),e}push(...e){return l.trackAccess(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,e),this._emitAfterChanges(1)),this.length}reduce(e,t){l.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){l.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return l.trackAccess(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(l.trackAccess(this._observable),e<0||e>=this.length||this._emitBeforeChanges(2))return;const t=b(this._splice(e,1));return this._emitAfterChanges(2),t}removeMany(e){if(l.trackAccess(this._observable),!e?.length||this._emitBeforeChanges(2))return[];const t=e instanceof f?e.toArray():e,r=this._items,s=[],i=t.length;for(let e=0;e<i;e++){const i=t[e],n=r.indexOf(i);if(n>-1){const i=1+S(t,r,e+1,n+1),o=this._splice(n,i);o&&o.length>0&&s.push.apply(s,o),e+=i-1}}return this._emitAfterChanges(2),s}reverse(){if(l.trackAccess(this._observable),this._emitBeforeChanges(4))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(4),this}shift(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=b(this._splice(0,1));return this._emitAfterChanges(2),e}slice(e=0,t=this.length){return l.trackAccess(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return l.trackAccess(this._observable),this._items.some(e,t)}sort(e){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(4)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(4),this}_requiresSort(e=(e,t)=>e===t?0:e<t?-1:1){const t=this.length-1;for(let r=0;r<t;r++)if(e(this.items[r],this.items[r+1])>0)return!0;return!1}splice(e,t,...r){l.trackAccess(this._observable),1===arguments.length&&(t=this.length),t??=0;const s=(t?2:0)|(r.length?1:0);if(this._emitBeforeChanges(s))return[];const i=this._splice(e,t,r)||[];return this._emitAfterChanges(s),i}toArray(){return l.trackAccess(this._observable),this._items.slice()}toJSON(e){return l.trackAccess(this._observable),this.toArray().map(t=>p.isSerializable(t)?t.toJSON(e):t)}toLocaleString(){return l.trackAccess(this._observable),this._items.toLocaleString()}toString(){return l.trackAccess(this._observable),this._items.toString()}unshift(...e){return l.trackAccess(this._observable),!e.length||this._emitBeforeChanges(1)||(this._splice(0,0,e),this._emitAfterChanges(1)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const s=this._items,i=this.itemType;let n,a;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=o.schedule(()=>this._dispatchChange())),e<0&&(e+=this.length),t){if(a=s.splice(e,t),this.hasEventListener("before-remove")){const t=y.acquire();t.target=this,t.cancellable=!0;for(let r=0,i=a.length;r<i;r++)n=a[r],t.reset(n),this.emit("before-remove",t),t.defaultPrevented&&(a.splice(r,1),s.splice(e,0,n),e+=1,r-=1,i-=1);y.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=y.acquire();e.target=this,e.cancellable=!1;const t=a.length;for(let r=0;r<t;r++)e.reset(a[r]),this.emit("after-remove",e);y.release(e)}}if(r?.length){if(i){const e=[];for(const t of r){const r=i.ensureType(t);null==r&&null!=t||e.push(r)}r=e}const t=this.hasEventListener("before-add"),n=this.hasEventListener("after-add"),o=e===this.length;if(t||n){const i=y.acquire();i.target=this,i.cancellable=!0;const a=y.acquire();a.target=this,a.cancellable=!1;for(const l of r)t?(i.reset(l),this.emit("before-add",i),i.defaultPrevented||(o?s.push(l):s.splice(e++,0,l),this._set("length",s.length),n&&(a.reset(l),this.emit("after-add",a)))):(o?s.push(l):s.splice(e++,0,l),this._set("length",s.length),a.reset(l),this.emit("after-add",a));y.release(a),y.release(i)}else{if(o)for(const e of r)s.push(e);else s.splice(e,0,...r);this._set("length",s.length)}}if((r?.length||a?.length)&&this._notifyChangeEvent(r,a),this.hasEventListener("after-splice")){const s=new m(this,r,a,e,t);this.emit("after-splice",s)}return a}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=y.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,y.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=y.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),y.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const r of e){const e=r.changes;x.clear(),T.clear(),F.clear();for(const{added:t,removed:r}of e){if(t)if(0===F.size&&0===T.size)for(const e of t)x.add(e);else for(const e of t)T.has(e)?(F.add(e),T.delete(e)):F.has(e)||x.add(e);if(r)if(0===F.size&&0===x.size)for(const e of r)T.add(e);else for(const e of r)x.has(e)?x.delete(e):(F.delete(e),T.add(e))}const s=t.acquire();x.forEach(e=>{s.push(e)});const i=t.acquire();T.forEach(e=>{i.push(e)});const n=this._items,o=r.items,a=t.acquire();if(F.forEach(e=>{o.indexOf(e)!==n.indexOf(e)&&a.push(e)}),r.listeners&&(s.length||i.length||a.length)){const e={target:this,added:s,removed:i,moved:a},t=r.listeners.length;for(let s=0;s<t;s++){const t=r.listeners[s];t.removed||t.callback.call(this,e)}}t.release(s),t.release(i),t.release(a)}x.clear(),T.clear(),F.clear()}};return e.__decorate([u.property()],w.prototype,"_updating",void 0),e.__decorate([u.property()],w.prototype,"length",void 0),e.__decorate([u.property()],w.prototype,"items",null),e.__decorate([u.property({readOnly:!0})],w.prototype,"updating",null),w=f=e.__decorate([d.subclass("esri.core.Collection")],w),w})},"esri/core/accessorSupport/decorators/shared":function(){define(["exports"],function(e){"use strict";e.shared=function(e){return(t,r)=>{t[r]=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/utils":function(){define(["exports","./effects"],function(e,t){"use strict";e.canInterpolateEffects=function(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every((e,t)=>e.type===r[t].type)},e.effectEquals=function(e,t){return JSON.stringify(e??null)===JSON.stringify(t??null)},e.isEffectFunctions=function(e){const t=e[0];return!!t&&"type"in t},e.normalizeEffects=function(e,r){const s=e.length>r.length?e:r,i=e.length>r.length?r:e;for(let e=i.length;e<s.length;e++)i.push(t.createEffectWithInitialValues(s[e]))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/effects":function(){define(["exports","../../colorUtils","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/mat4f32","./colorMatrixFunctions"],function(e,t,r,s,i){"use strict";class n{constructor(e,t,r){this.strength=e,this.radius=t,this.threshold=r,this.type="bloom"}interpolate(e,t,r){this.strength=d(e.strength,t.strength,r),this.radius=d(e.radius,t.radius,r),this.threshold=d(e.threshold,t.threshold,r)}clone(){return new n(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:h(this.radius),strength:this.strength,threshold:this.threshold}}}class o{constructor(e){this.radius=e,this.type="blur"}interpolate(e,t,r){this.radius=Math.round(d(e.radius,t.radius,r))}clone(){return new o(this.radius)}toJSON(){return{type:"blur",radius:h(this.radius)}}}class a{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.amount=d(e.amount,t.amount,r),this._updateMatrix()}clone(){return new a(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||s.create();switch(this.type){case"brightness":this._colorMatrix=i.brightness(e,this.amount);break;case"contrast":this._colorMatrix=i.contrast(e,this.amount);break;case"grayscale":this._colorMatrix=i.grayscale(e,this.amount);break;case"invert":this._colorMatrix=i.invert(e,this.amount);break;case"saturate":this._colorMatrix=i.saturate(e,this.amount);break;case"sepia":this._colorMatrix=i.sepia(e,this.amount)}}}class l{constructor(e,t,r,s){this.offsetX=e,this.offsetY=t,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,t,r){this.offsetX=d(e.offsetX,t.offsetX,r),this.offsetY=d(e.offsetY,t.offsetY,r),this.blurRadius=d(e.blurRadius,t.blurRadius,r),this.color[0]=Math.round(d(e.color[0],t.color[0],r)),this.color[1]=Math.round(d(e.color[1],t.color[1],r)),this.color[2]=Math.round(d(e.color[2],t.color[2],r)),this.color[3]=d(e.color[3],t.color[3],r)}clone(){return new l(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:h(this.offsetX),yoffset:h(this.offsetY),blurRadius:h(this.blurRadius),color:e}}}class u{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.angle=d(e.angle,t.angle,r),this._updateMatrix()}clone(){return new u(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||s.create();this._colorMatrix=i.rotateHue(e,this.angle)}}class c{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,r){this.amount=d(e.amount,t.amount,r)}clone(){return new c(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function d(e,t,r){return e+(t-e)*r}function h(e){return Math.round(1e3*r.px2pt(e))/1e3}e.BloomEffect=n,e.BlurEffect=o,e.ColorMatrixEffect=a,e.DropShadowEffect=l,e.HueRotateEffect=u,e.OpacityEffect=c,e.createEffectWithInitialValues=function(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new a(e.type,0);case"saturate":case"brightness":case"contrast":return new a(e.type,1);case"opacity":return new c(1);case"hue-rotate":return new u(0);case"blur":return new o(0);case"drop-shadow":return new l(0,0,0,[...t.getNamedColor("transparent")]);case"bloom":return new n(0,0,1)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["exports"],function(e){"use strict";function t(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function r(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function s(e,t,r,s,i,n,o,a,l,u,c,d,h,p,f,m){const y=new Float32Array(16);return y[0]=e,y[1]=t,y[2]=r,y[3]=s,y[4]=i,y[5]=n,y[6]=o,y[7]=a,y[8]=l,y[9]=u,y[10]=c,y[11]=d,y[12]=h,y[13]=p,y[14]=f,y[15]=m,y}const i=t(),n=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:i,clone:r,create:t,fromValues:s},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=i,e.clone=r,e.create=t,e.fromValues=s,e.mat4f32=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/colorMatrixFunctions":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(e,t){"use strict";e.brightness=(e,r)=>{const s=t.set(e,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return t.transpose(s,s)},e.contrast=(e,r)=>{const s=t.set(e,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return t.transpose(s,s)},e.grayscale=(e,r)=>{const s=1-r,i=t.set(e,.2126+.7874*s,.7152-.7152*s,.0722-.0722*s,0,.2126-.2126*s,.7152+.2848*s,.0722-.0722*s,0,.2126-.2126*s,.7152-.7152*s,.0722+.9278*s,0,0,0,0,1);return t.transpose(i,i)},e.invert=(e,r)=>{const s=1-2*r,i=r,n=t.set(e,s,0,0,i,0,s,0,i,0,0,s,i,0,0,0,1);return t.transpose(n,n)},e.rotateHue=(e,r)=>{const s=Math.sin(r*Math.PI/180),i=Math.cos(r*Math.PI/180),n=t.set(e,.213+.787*i-.213*s,.715-.715*i-.715*s,.072-.072*i+.928*s,0,.213-.213*i+.143*s,.715+.285*i+.14*s,.072-.072*i-.283*s,0,.213-.213*i-.787*s,.715-.715*i+.715*s,.072+.928*i+.072*s,0,0,0,0,1);return t.transpose(n,n)},e.saturate=(e,r)=>{const s=r,i=t.set(e,.213+.787*s,.715-.715*s,.072-.072*s,0,.213-.213*s,.715+.285*s,.072-.072*s,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,1);return t.transpose(i,i)},e.sepia=(e,r)=>{const s=1-r,i=t.set(e,.393+.607*s,.769-.769*s,.189-.189*s,0,.349-.349*s,.686+.314*s,.168-.168*s,0,.272-.272*s,.534-.534*s,.131+.869*s,0,0,0,0,1);return t.transpose(i,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["exports","../factories/vec3f64","./common"],function(e,t,r){"use strict";function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function i(e,t,r,s,i,n,o,a,l,u,c,d,h,p,f,m,y){return e[0]=t,e[1]=r,e[2]=s,e[3]=i,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=u,e[9]=c,e[10]=d,e[11]=h,e[12]=p,e[13]=f,e[14]=m,e[15]=y,e}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(e,t){if(e===t){const r=t[1],s=t[2],i=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=n,e[11]=t[14],e[12]=i,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function a(e,t){return l(e,t)||n(e),e}function l(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],f=t[12],m=t[13],y=t[14],g=t[15],_=r*a-s*o,b=r*l-i*o,S=r*u-n*o,v=s*l-i*a,x=s*u-n*a,T=i*u-n*l,F=c*m-d*f,I=c*y-h*f,M=c*g-p*f,w=d*y-h*m,R=d*g-p*m,E=h*g-p*y;let O=_*E-b*R+S*w+v*M-x*I+T*F;return O?(O=1/O,e[0]=(a*E-l*R+u*w)*O,e[1]=(i*R-s*E-n*w)*O,e[2]=(m*T-y*x+g*v)*O,e[3]=(h*x-d*T-p*v)*O,e[4]=(l*M-o*E-u*I)*O,e[5]=(r*E-i*M+n*I)*O,e[6]=(y*S-f*T-g*b)*O,e[7]=(c*T-h*S+p*b)*O,e[8]=(o*R-a*M+u*F)*O,e[9]=(s*M-r*R-n*F)*O,e[10]=(f*x-m*S+g*_)*O,e[11]=(d*S-c*x-p*_)*O,e[12]=(a*I-o*w-l*F)*O,e[13]=(r*w-s*I+i*F)*O,e[14]=(m*b-f*v-y*_)*O,e[15]=(c*v-d*b+h*_)*O,e):null}function u(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],l=t[6],u=t[7],c=t[8],d=t[9],h=t[10],p=t[11],f=t[12],m=t[13],y=t[14],g=t[15];return e[0]=a*(h*g-p*y)-d*(l*g-u*y)+m*(l*p-u*h),e[1]=-(s*(h*g-p*y)-d*(i*g-n*y)+m*(i*p-n*h)),e[2]=s*(l*g-u*y)-a*(i*g-n*y)+m*(i*u-n*l),e[3]=-(s*(l*p-u*h)-a*(i*p-n*h)+d*(i*u-n*l)),e[4]=-(o*(h*g-p*y)-c*(l*g-u*y)+f*(l*p-u*h)),e[5]=r*(h*g-p*y)-c*(i*g-n*y)+f*(i*p-n*h),e[6]=-(r*(l*g-u*y)-o*(i*g-n*y)+f*(i*u-n*l)),e[7]=r*(l*p-u*h)-o*(i*p-n*h)+c*(i*u-n*l),e[8]=o*(d*g-p*m)-c*(a*g-u*m)+f*(a*p-u*d),e[9]=-(r*(d*g-p*m)-c*(s*g-n*m)+f*(s*p-n*d)),e[10]=r*(a*g-u*m)-o*(s*g-n*m)+f*(s*u-n*a),e[11]=-(r*(a*p-u*d)-o*(s*p-n*d)+c*(s*u-n*a)),e[12]=-(o*(d*y-h*m)-c*(a*y-l*m)+f*(a*h-l*d)),e[13]=r*(d*y-h*m)-c*(s*y-i*m)+f*(s*h-i*d),e[14]=-(r*(a*y-l*m)-o*(s*y-i*m)+f*(s*l-i*a)),e[15]=r*(a*h-l*d)-o*(s*h-i*d)+c*(s*l-i*a),e}function c(e){const t=e[0],r=e[1],s=e[2],i=e[3],n=e[4],o=e[5],a=e[6],l=e[7],u=e[8],c=e[9],d=e[10],h=e[11],p=e[12],f=e[13],m=e[14],y=e[15];return(t*o-r*n)*(d*y-h*m)-(t*a-s*n)*(c*y-h*f)+(t*l-i*n)*(c*m-d*f)+(r*a-s*o)*(u*y-h*p)-(r*l-i*o)*(u*m-d*p)+(s*l-i*a)*(u*f-c*p)}function d(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3],a=t[4],l=t[5],u=t[6],c=t[7],d=t[8],h=t[9],p=t[10],f=t[11],m=t[12],y=t[13],g=t[14],_=t[15];let b=r[0],S=r[1],v=r[2],x=r[3];return e[0]=b*s+S*a+v*d+x*m,e[1]=b*i+S*l+v*h+x*y,e[2]=b*n+S*u+v*p+x*g,e[3]=b*o+S*c+v*f+x*_,b=r[4],S=r[5],v=r[6],x=r[7],e[4]=b*s+S*a+v*d+x*m,e[5]=b*i+S*l+v*h+x*y,e[6]=b*n+S*u+v*p+x*g,e[7]=b*o+S*c+v*f+x*_,b=r[8],S=r[9],v=r[10],x=r[11],e[8]=b*s+S*a+v*d+x*m,e[9]=b*i+S*l+v*h+x*y,e[10]=b*n+S*u+v*p+x*g,e[11]=b*o+S*c+v*f+x*_,b=r[12],S=r[13],v=r[14],x=r[15],e[12]=b*s+S*a+v*d+x*m,e[13]=b*i+S*l+v*h+x*y,e[14]=b*n+S*u+v*p+x*g,e[15]=b*o+S*c+v*f+x*_,e}function h(e,t,r){const s=r[0],i=r[1],n=r[2];if(t===e)e[12]=t[0]*s+t[4]*i+t[8]*n+t[12],e[13]=t[1]*s+t[5]*i+t[9]*n+t[13],e[14]=t[2]*s+t[6]*i+t[10]*n+t[14],e[15]=t[3]*s+t[7]*i+t[11]*n+t[15];else{const r=t[0],o=t[1],a=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7],p=t[8],f=t[9],m=t[10],y=t[11];e[0]=r,e[1]=o,e[2]=a,e[3]=l,e[4]=u,e[5]=c,e[6]=d,e[7]=h,e[8]=p,e[9]=f,e[10]=m,e[11]=y,e[12]=r*s+u*i+p*n+t[12],e[13]=o*s+c*i+f*n+t[13],e[14]=a*s+d*i+m*n+t[14],e[15]=l*s+h*i+y*n+t[15]}return e}function p(e,t,r){const s=r[0],i=r[1],n=r[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,i,n){let o=n[0],a=n[1],l=n[2],u=Math.sqrt(o*o+a*a+l*l);if(u<=r.getEpsilon())return void s(e,t);u=1/u,o*=u,a*=u,l*=u;const c=Math.sin(i),d=Math.cos(i),h=1-d,p=t[0],f=t[1],m=t[2],y=t[3],g=t[4],_=t[5],b=t[6],S=t[7],v=t[8],x=t[9],T=t[10],F=t[11],I=o*o*h+d,M=a*o*h+l*c,w=l*o*h-a*c,R=o*a*h-l*c,E=a*a*h+d,O=l*a*h+o*c,A=o*l*h+a*c,P=a*l*h-o*c,C=l*l*h+d;e[0]=p*I+g*M+v*w,e[1]=f*I+_*M+x*w,e[2]=m*I+b*M+T*w,e[3]=y*I+S*M+F*w,e[4]=p*R+g*E+v*O,e[5]=f*R+_*E+x*O,e[6]=m*R+b*E+T*O,e[7]=y*R+S*E+F*O,e[8]=p*A+g*P+v*C,e[9]=f*A+_*P+x*C,e[10]=m*A+b*P+T*C,e[11]=y*A+S*P+F*C,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}function m(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[4],o=t[5],a=t[6],l=t[7],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*i+u*s,e[5]=o*i+c*s,e[6]=a*i+d*s,e[7]=l*i+h*s,e[8]=u*i-n*s,e[9]=c*i-o*s,e[10]=d*i-a*s,e[11]=h*i-l*s,e}function y(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],u=t[8],c=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i-u*s,e[1]=o*i-c*s,e[2]=a*i-d*s,e[3]=l*i-h*s,e[8]=n*s+u*i,e[9]=o*s+c*i,e[10]=a*s+d*i,e[11]=l*s+h*i,e}function g(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],u=t[4],c=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i+u*s,e[1]=o*i+c*s,e[2]=a*i+d*s,e[3]=l*i+h*s,e[4]=u*i-n*s,e[5]=c*i-o*s,e[6]=d*i-a*s,e[7]=h*i-l*s,e}function _(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function b(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t,s){if(0===t)return n(e);let i=s[0],o=s[1],a=s[2],l=Math.sqrt(i*i+o*o+a*a);if(l<=r.getEpsilon())return null;l=1/l,i*=l,o*=l,a*=l;const u=Math.sin(t),c=Math.cos(t),d=1-c;return e[0]=i*i*d+c,e[1]=o*i*d+a*u,e[2]=a*i*d-o*u,e[3]=0,e[4]=i*o*d-a*u,e[5]=o*o*d+c,e[6]=a*o*d+i*u,e[7]=0,e[8]=i*a*d+o*u,e[9]=o*a*d-i*u,e[10]=a*a*d+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function F(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3],a=s+s,l=i+i,u=n+n,c=s*a,d=s*l,h=s*u,p=i*l,f=i*u,m=n*u,y=o*a,g=o*l,_=o*u;return e[0]=1-(p+m),e[1]=d+_,e[2]=h-g,e[3]=0,e[4]=d-_,e[5]=1-(c+m),e[6]=f+y,e[7]=0,e[8]=h+g,e[9]=f-y,e[10]=1-(c+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function I(e,t){const r=M,s=-t[0],i=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],u=t[6],c=t[7],d=s*s+i*i+n*n+o*o;return d>0?(r[0]=2*(a*o+c*s+l*n-u*i)/d,r[1]=2*(l*o+c*i+u*s-a*n)/d,r[2]=2*(u*o+c*n+a*i-l*s)/d):(r[0]=2*(a*o+c*s+l*n-u*i),r[1]=2*(l*o+c*i+u*s-a*n),r[2]=2*(u*o+c*n+a*i-l*s)),F(e,t,r),e}const M=t.create();function w(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function R(e,t){const r=t[0],s=t[1],i=t[2],n=t[4],o=t[5],a=t[6],l=t[8],u=t[9],c=t[10];return e[0]=Math.sqrt(r*r+s*s+i*i),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+u*u+c*c),e}function E(e,t){const r=t[0]+t[5]+t[10];let s=0;return r>0?(s=2*Math.sqrt(r+1),e[3]=.25*s,e[0]=(t[6]-t[9])/s,e[1]=(t[8]-t[2])/s,e[2]=(t[1]-t[4])/s):t[0]>t[5]&&t[0]>t[10]?(s=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/s,e[0]=.25*s,e[1]=(t[1]+t[4])/s,e[2]=(t[8]+t[2])/s):t[5]>t[10]?(s=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/s,e[0]=(t[1]+t[4])/s,e[1]=.25*s,e[2]=(t[6]+t[9])/s):(s=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/s,e[0]=(t[8]+t[2])/s,e[1]=(t[6]+t[9])/s,e[2]=.25*s),e}function O(e,t,r,s){const i=t[0],n=t[1],o=t[2],a=t[3],l=i+i,u=n+n,c=o+o,d=i*l,h=i*u,p=i*c,f=n*u,m=n*c,y=o*c,g=a*l,_=a*u,b=a*c,S=s[0],v=s[1],x=s[2];return e[0]=(1-(f+y))*S,e[1]=(h+b)*S,e[2]=(p-_)*S,e[3]=0,e[4]=(h-b)*v,e[5]=(1-(d+y))*v,e[6]=(m+g)*v,e[7]=0,e[8]=(p+_)*x,e[9]=(m-g)*x,e[10]=(1-(d+f))*x,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function A(e,t,r,s,i){const n=t[0],o=t[1],a=t[2],l=t[3],u=n+n,c=o+o,d=a+a,h=n*u,p=n*c,f=n*d,m=o*c,y=o*d,g=a*d,_=l*u,b=l*c,S=l*d,v=s[0],x=s[1],T=s[2],F=i[0],I=i[1],M=i[2],w=(1-(m+g))*v,R=(p+S)*v,E=(f-b)*v,O=(p-S)*x,A=(1-(h+g))*x,P=(y+_)*x,C=(f+b)*T,z=(y-_)*T,N=(1-(h+m))*T;return e[0]=w,e[1]=R,e[2]=E,e[3]=0,e[4]=O,e[5]=A,e[6]=P,e[7]=0,e[8]=C,e[9]=z,e[10]=N,e[11]=0,e[12]=r[0]+F-(w*F+O*I+C*M),e[13]=r[1]+I-(R*F+A*I+z*M),e[14]=r[2]+M-(E*F+P*I+N*M),e[15]=1,e}function P(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],o=r+r,a=s+s,l=i+i,u=r*o,c=s*o,d=s*a,h=i*o,p=i*a,f=i*l,m=n*o,y=n*a,g=n*l;return e[0]=1-d-f,e[1]=c+g,e[2]=h-y,e[3]=0,e[4]=c-g,e[5]=1-u-f,e[6]=p+m,e[7]=0,e[8]=h+y,e[9]=p-m,e[10]=1-u-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function C(e,t,r,s,i,n,o){const a=1/(r-t),l=1/(i-s),u=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(i+s)*l,e[10]=(o+n)*u,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*u,e[15]=0,e}function z(e,t,r,s,i){const n=1/Math.tan(t/2);let o;return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(s-i),e[10]=(i+s)*o,e[14]=2*i*s*o):(e[10]=-1,e[14]=-2*s),e}function N(e,t,r,s){const i=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),u=2/(i+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(i-n)*u*.5,e[10]=s/(r-s),e[11]=-1,e[12]=0,e[13]=0,e[14]=s*r/(r-s),e[15]=0,e}function B(e,t,r,s,i,n,o){const a=1/(t-r),l=1/(s-i),u=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+r)*a,e[13]=(i+s)*l,e[14]=(o+n)*u,e[15]=1,e}function k(e,t,s,i){const o=t[0],a=t[1],l=t[2];let u=o-s[0],c=a-s[1],d=l-s[2];const h=r.getEpsilon();if(Math.abs(u)<h&&Math.abs(c)<h&&Math.abs(d)<h)return void n(e);let p=1/Math.sqrt(u*u+c*c+d*d);u*=p,c*=p,d*=p;const f=i[0],m=i[1],y=i[2];let g=m*d-y*c,_=y*u-f*d,b=f*c-m*u;p=Math.sqrt(g*g+_*_+b*b),p?(p=1/p,g*=p,_*=p,b*=p):(g=0,_=0,b=0);let S=c*b-d*_,v=d*g-u*b,x=u*_-c*g;p=Math.sqrt(S*S+v*v+x*x),p?(p=1/p,S*=p,v*=p,x*=p):(S=0,v=0,x=0),e[0]=g,e[1]=S,e[2]=u,e[3]=0,e[4]=_,e[5]=v,e[6]=c,e[7]=0,e[8]=b,e[9]=x,e[10]=d,e[11]=0,e[12]=-(g*o+_*a+b*l),e[13]=-(S*o+v*a+x*l),e[14]=-(u*o+c*a+d*l),e[15]=1}function U(e,t,r,s){const i=t[0],n=t[1],o=t[2],a=s[0],l=s[1],u=s[2];let c=i-r[0],d=n-r[1],h=o-r[2],p=c*c+d*d+h*h;p>0&&(p=1/Math.sqrt(p),c*=p,d*=p,h*=p);let f=l*h-u*d,m=u*c-a*h,y=a*d-l*c;return p=f*f+m*m+y*y,p>0&&(p=1/Math.sqrt(p),f*=p,m*=p,y*=p),e[0]=f,e[1]=m,e[2]=y,e[3]=0,e[4]=d*y-h*m,e[5]=h*f-c*y,e[6]=c*m-d*f,e[7]=0,e[8]=c,e[9]=d,e[10]=h,e[11]=0,e[12]=i,e[13]=n,e[14]=o,e[15]=1,e}function L(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function q(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function j(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function D(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function G(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function V(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e[6]=t[6]+r[6]*s,e[7]=t[7]+r[7]*s,e[8]=t[8]+r[8]*s,e[9]=t[9]+r[9]*s,e[10]=t[10]+r[10]*s,e[11]=t[11]+r[11]*s,e[12]=t[12]+r[12]*s,e[13]=t[13]+r[13]*s,e[14]=t[14]+r[14]*s,e[15]=t[15]+r[15]*s,e}function Q(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Z(e,t){if(e===t)return!0;const s=e[0],i=e[1],n=e[2],o=e[3],a=e[4],l=e[5],u=e[6],c=e[7],d=e[8],h=e[9],p=e[10],f=e[11],m=e[12],y=e[13],g=e[14],_=e[15],b=t[0],S=t[1],v=t[2],x=t[3],T=t[4],F=t[5],I=t[6],M=t[7],w=t[8],R=t[9],E=t[10],O=t[11],A=t[12],P=t[13],C=t[14],z=t[15],N=r.getEpsilon();return Math.abs(s-b)<=N*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(i-S)<=N*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(n-v)<=N*Math.max(1,Math.abs(n),Math.abs(v))&&Math.abs(o-x)<=N*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-T)<=N*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(l-F)<=N*Math.max(1,Math.abs(l),Math.abs(F))&&Math.abs(u-I)<=N*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(c-M)<=N*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(d-w)<=N*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(h-R)<=N*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(p-E)<=N*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(f-O)<=N*Math.max(1,Math.abs(f),Math.abs(O))&&Math.abs(m-A)<=N*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(y-P)<=N*Math.max(1,Math.abs(y),Math.abs(P))&&Math.abs(g-C)<=N*Math.max(1,Math.abs(g),Math.abs(C))&&Math.abs(_-z)<=N*Math.max(1,Math.abs(_),Math.abs(z))}function H(e){const t=r.getEpsilon(),s=e[0],i=e[1],n=e[2],o=e[4],a=e[5],l=e[6],u=e[8],c=e[9],d=e[10];return Math.abs(1-(s*s+o*o+u*u))<=t&&Math.abs(1-(i*i+a*a+c*c))<=t&&Math.abs(1-(n*n+l*l+d*d))<=t}function Y(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}const W=d,$=D,J=Object.freeze(Object.defineProperty({__proto__:null,add:j,adjoint:u,copy:s,determinant:c,equals:Z,exactEquals:Q,frob:q,fromQuat:P,fromQuat2:I,fromRotation:S,fromRotationTranslation:F,fromRotationTranslationScale:O,fromRotationTranslationScaleOrigin:A,fromScaling:b,fromTranslation:_,fromXRotation:v,fromYRotation:x,fromZRotation:T,frustum:C,getRotation:E,getScale:R,getTranslation:w,hasIdentityRotation:Y,identity:n,invert:l,invertOrIdentity:a,isOrthoNormal:H,lookAt:k,mul:W,multiply:d,multiplyScalar:G,multiplyScalarAndAdd:V,ortho:B,perspective:z,perspectiveFromFieldOfView:N,rotate:f,rotateX:m,rotateY:y,rotateZ:g,scale:p,set:i,str:L,sub:$,subtract:D,targetTo:U,translate:h,transpose:o},Symbol.toStringTag,{value:"Module"}));e.add=j,e.adjoint=u,e.copy=s,e.determinant=c,e.equals=Z,e.exactEquals=Q,e.frob=q,e.fromQuat=P,e.fromQuat2=I,e.fromRotation=S,e.fromRotationTranslation=F,e.fromRotationTranslationScale=O,e.fromRotationTranslationScaleOrigin=A,e.fromScaling=b,e.fromTranslation=_,e.fromXRotation=v,e.fromYRotation=x,e.fromZRotation=T,e.frustum=C,e.getRotation=E,e.getScale=R,e.getTranslation=w,e.hasIdentityRotation=Y,e.identity=n,e.invert=l,e.invertOrIdentity=a,e.isOrthoNormal=H,e.lookAt=k,e.mat4=J,e.mul=W,e.multiply=d,e.multiplyScalar=G,e.multiplyScalarAndAdd=V,e.ortho=B,e.perspective=z,e.perspectiveFromFieldOfView=N,e.rotate=f,e.rotateX=m,e.rotateY=y,e.rotateZ=g,e.scale=p,e.set=i,e.str=L,e.sub=$,e.subtract=D,e.targetTo=U,e.translate=h,e.transpose=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapDefinitions":function(){define(["exports","../assets","../intl/messages"],function(e,t,r){"use strict";const s={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}};e.esriBasemapDefinitions=s,e.getBasemapTitle=async function(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,s=await r.fetchMessageBundle("esri/t9n/basemaps");return s[e]||s[t]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl/messages":function(){define(["exports","../core/Error","../core/handleUtils","../core/promiseUtils","./locale"],function(e,t,r,s,i){"use strict";const n={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function o(e){if(function(e){return e in n}(e)){const t=n[e];return!0===t?e:t}return null}const a=[],l=new Map;function u(e){for(const t of l.keys())c(e.pattern,t)&&l.delete(t)}function c(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}i.beforeLocaleChange(()=>{l.clear()});const d=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=s.createResolver())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}},h={cache:l,loaders:a};e.fetchMessageBundle=async function(e){const r=i.getLocale();l.has(e)||l.set(e,async function(e,r){const s=[];for(const t of a)if(c(t.pattern,e))try{return await t.fetchMessageBundle(e,r)}catch(e){s.push(e)}if(s.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:s});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,r));const s=l.get(e);return s&&await d.add(s),s},e.messageBundlesLocaleMap=n,e.normalizeMessageBundleLocale=function(e){const t=i.getLocaleLanguage(e);return t?o(e)??o(t):null},e.registerMessageBundleLoader=function(e){return a.includes(e)||(u(e),a.unshift(e)),r.makeHandle(()=>{const t=a.indexOf(e);t>-1&&(a.splice(t,1),u(e))})},e.test=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(e,t,r){"use strict";const s=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,i=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),n=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),o=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function a(e){return null==e||"string"==typeof e&&!e?"<Null>":e}function l(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,s=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!s}function u(e){const{values:t,useSampleStdDev:r,supportsNullCount:s,outStatisticTypes:i}=e;let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=null,l=null,u=null,d=null,h=0;const p=null==e.minValue?-1/0:e.minValue,f=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=p&&e<=f&&(a=null===a?e:a+e,n=Math.min(n,e),o=Math.max(o,e),h++):"string"==typeof e&&h++;if(h&&null!=a){l=a/h;let e=0;for(const r of t)Number.isFinite(r)&&r>=p&&r<=f&&(e+=(r-l)**2);d=r?h>1?e/(h-1):0:h>0?e/h:0,u=Math.sqrt(d)}else n=null,o=null;const m={avg:l,count:h,max:o,min:n,stddev:u,sum:a,variance:d};return s&&(m.nullcount=t.length-h),!e.percentileParams||i?.include?.length&&!i.include.includes("median")||i?.exclude?.length&&i.exclude.includes("median")||(m.median=c(t,e.percentileParams)),m}function c(e,t){const{fieldType:r,value:s,orderBy:i,isDiscrete:n}=t,o=d(r,"desc"===i);if(0===(e=[...e].filter(e=>null!=e).sort((e,t)=>o(e,t))).length)return null;if(s<=0)return e[0];if(s>=1)return e[e.length-1];const a=(e.length-1)*s,l=Math.floor(a),u=l+1,c=a%1,h=e[l],p=e[u];return u>=e.length||n||"string"==typeof h||"string"==typeof p?h:h*(1-c)+p*c}function d(e,t){if(e){if(i.has(e))return x(t);if(n.has(e))return b(t,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?y:m}(t);const r=b(t,!0);if("esriFieldTypeString"===e)return r;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,t)=>r(T(e),T(t))}const r=t?1:-1,s=x(t),o=b(t,!0),a=f(t);return(e,t)=>"number"==typeof e&&"number"==typeof t?s(e,t):"string"==typeof e&&"string"==typeof t?o(e,t):a(e,t)??r}const h=(e,t)=>null==e?null==t?0:1:null==t?-1:null,p=(e,t)=>null==e?null==t?0:-1:null==t?1:null;function f(e){return e?h:p}const m=(e,t)=>p(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),y=(e,t)=>h(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime()),g=(e,t)=>p(e,t)??(e===t?0:e<t?-1:1),_=(e,t)=>h(e,t)??(e===t?0:e<t?1:-1);function b(e,t){if(!t)return e?_:g;const r=f(e);return e?(e,t)=>{const s=r(e,t);return null!=s?s:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const s=r(e,t);return null!=s?s:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}const S=(e,t)=>h(e,t)??t-e,v=(e,t)=>p(e,t)??e-t;function x(e){return e?S:v}function T(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function F(e){return"coded-value"!==e?.type?[]:e.codedValues.map(e=>e.code)}function I(e,t,s){const i=M({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,definedInterval:t.definedInterval,breakCount:t.numClasses||5});return e=function(e,t,r){const s=t??-1/0,i=r??1/0;return e.filter(e=>Number.isFinite(e)&&e>=s&&e<=i)}(e,t.minValue,t.maxValue),r.createGenerateRendererClassBreaks({definition:i,values:e,normalizationTotal:t.normalizationTotal},s)}function M(e){const{breakCount:r,field:s,normalizationField:i,normalizationType:n}=e,o=e.classificationMethod||"equal-interval",a="standard-deviation"===o?e.standardDeviationInterval||1:void 0,l="defined-interval"===o?e.definedInterval:void 0;return new t({breakCount:r,classificationField:s,classificationMethod:o,normalizationField:"field"===n?i:void 0,normalizationType:n,standardDeviationInterval:a,definedInterval:l})}function w(e,t,r=!1){const{field:s,classificationMethod:i,standardDeviationInterval:n,definedInterval:o,normalizationType:a,normalizationField:c,normalizationTotal:d,minValue:h,maxValue:p}=t,f=t.numBins||10;let m=null,y=null,g=null;if(i&&"equal-interval"!==i||a){const{classBreaks:t}=I(e,{field:s,normalizationType:a,normalizationField:c,normalizationTotal:d,classificationMethod:i,standardDeviationInterval:n,definedInterval:o,minValue:h,maxValue:p,numClasses:f},null!=h&&null!=p?[h,p]:void 0);m=t[0]?.minValue,y=t[t.length-1]?.maxValue,g=t.map(e=>[e.minValue,e.maxValue])}else{if(null!=h&&null!=p)m=h,y=p;else{const t=u({values:e,minValue:h,maxValue:p,useSampleStdDev:!a,supportsNullCount:l({normalizationType:a,normalizationField:c,minValue:h,maxValue:p})});m=t.min??null,y=t.max??null}g=E(m??0,y??0,f)}if(r&&g.length){const e=g.at(-1)[1];g.push([e,e])}return{min:m,max:y,intervals:g}}function R(e,t){let r=-1;for(let s=e.length-1;s>=0;s--)if(t>=e[s][0]){r=s;break}return r}function E(e,t,r){const s=(t-e)/r,i=[];let n,o=e;for(let e=1;e<=r;e++)n=o+s,n=Number(n.toFixed(16)),i.push([o,e===r?t:n]),o=n;return i}e.binIndex=R,e.calculateClassBreaks=I,e.calculateHistogram=function(e,t){const r=w(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};const s=r.intervals,i=r.min??0,n=r.max??0,o=s.map((e,t)=>({minValue:s[t][0],maxValue:s[t][1],count:0}));for(const t of e)if(null!=t&&t>=i&&t<=n){const e=R(s,t);e>-1&&o[e].count++}return{bins:o,minValue:i,maxValue:n,normalizationTotal:t.normalizationTotal}},e.calculatePercentile=c,e.calculateStatistics=u,e.calculateStringStatistics=function(e){const{outStatisticTypes:t}=e,r=e.returnDistinct?[...new Set(e.values)]:e.values,s=r.filter(e=>null!=e).sort(),i=s.length,n={count:i,min:s[0],max:s[i-1]};return e.supportsNullCount&&(n.nullcount=r.length-i),!e.percentileParams||t?.include?.length&&!t.include.includes("median")||t?.exclude?.length&&t.exclude.includes("median")||(n.median=c(r,e.percentileParams)),n},e.calculateUniqueValuesCount=function(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}},e.createClassBreaksDefinition=M,e.createUVResult=function(e,t,r,s){const i=e.count,n=[];if(r&&t){const e=[],r=F(t[0]);for(const i of r)if(t[1]){const r=F(t[1]);for(const n of r)if(t[2]){const r=F(t[2]);for(const t of r)e.push(`${a(i)}${s}${a(n)}${s}${a(t)}`)}else e.push(`${a(i)}${s}${a(n)}`)}else e.push(i);for(const t of e)i.hasOwnProperty(t)||(i[t]={data:t,count:0})}for(const e in i){const t=i[e];n.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:n}},e.getAttributeComparator=d,e.getBinParams=w,e.getEqualIntervalBins=E,e.getNormalizedValue=function(e,t,r,s){let i=null;switch(t){case"log":0!==e&&(i=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(s)&&0!==s&&(i=e/s*100);break;case"field":Number.isFinite(r)&&0!==r&&(i=e/r);break;case"natural-log":e>0&&(i=Math.log(e));break;case"square-root":e>0&&(i=e**.5)}return i},e.isNullCountSupported=l,e.processNullValue=a,e.processSummaryStatisticsResult=function(e,t,r){let s;for(s in e)t?.include?.length&&!t.include.includes(s)||t?.exclude?.length&&t.exclude.includes(s)?delete e[s]:o.includes(s)&&(Number.isFinite(e[s])||(e[s]=null));return r?(["avg","stddev","variance"].forEach(t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]??0))}),e):e},e.resolveCBResult=function(e,t){let r=e.classBreaks;const i=r.length,n=r[0]?.minValue,o=r[i-1]?.maxValue,a="standard-deviation"===t,l=s;return r=r.map(e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(a&&t){const e=t.match(l),s=e?.map(e=>+e.trim())??[];2===s.length?(r.minStdDev=s[0],r.maxStdDev=s[1],s[0]<0&&s[1]>0&&(r.hasAvg=!0)):1===s.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=s[0]):t.includes(">")&&(r.minStdDev=s[0],r.maxStdDev=null))}return r}),{minValue:n,maxValue:o,classBreakInfos:r,normalizationTotal:e.normalizationTotal}},e.statisticTypes=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a,l,u){"use strict";const c=new r.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),d=new r.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});return e.default=class extends s.JSONSupport{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}},t.__decorate([l.enumeration({classBreaksDef:"class-breaks-definition"})],e.default.prototype,"type",void 0),t.__decorate([i.property({json:{write:!0}})],e.default.prototype,"breakCount",void 0),t.__decorate([i.property({json:{write:!0}})],e.default.prototype,"classificationField",void 0),t.__decorate([i.property({type:String,json:{read:c.read,write:c.write}})],e.default.prototype,"classificationMethod",void 0),t.__decorate([i.property({json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([i.property({json:{read:d.read,write:d.write}})],e.default.prototype,"normalizationType",void 0),t.__decorate([i.property({value:null,json:{write:!0}})],e.default.prototype,"standardDeviationInterval",null),t.__decorate([i.property({value:null,json:{write:!0}})],e.default.prototype,"definedInterval",null),e.default=t.__decorate([u.subclass("esri.rest.support.ClassBreaksDefinition")],e.default),e.default})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(e,t){"use strict";function r(e,t){return Number(e.toFixed(t))}function s(e,t,r){let s=null;return s=e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t,s}function i(e){const t=[],r=[];let s=Number.MIN_VALUE,i=1,n=-1;for(let o=0;o<e.length;o++){const a=e[o];a===s?(i++,r[n]=i):null!==a&&(t.push(a),s=a,i=1,r.push(i),n++)}return{uniqueValues:t,valueFrequency:r}}function n(e,t,r,s){let i=[],n=[],a=[],l=0;const u=[],c=[];for(let i=0;i<s;i++){const s=o(i,e,t,r);u.push(s.sbMean),c.push(s.sbSdcm),l+=c[i]}let d,h=l,p=!0;for(;p||l<h;){p=!1,i=[];for(let t=0;t<s;t++)i.push(e[t]);for(let r=0;r<s;r++)for(let i=e[r]+1;i<=e[r+1];i++)if(d=t[i],r>0&&i!==e[r+1]&&Math.abs(d-u[r])>Math.abs(d-u[r-1]))e[r]=i;else if(r<s-1&&e[r]!==i-1&&Math.abs(d-u[r])>Math.abs(d-u[r+1])){e[r+1]=i-1;break}h=l,l=0,n=[],a=[];for(let i=0;i<s;i++){n.push(u[i]),a.push(c[i]);const s=o(i,e,t,r);u[i]=s.sbMean,c[i]=s.sbSdcm,l+=c[i]}}if(l>h){for(let t=0;t<s;t++)e[t]=i[t],u[t]=n[t],c[t]=a[t];l=h}return{mean:u,sdcm:c}}function o(e,r,s,i){let n=0,o=0;for(let t=r[e]+1;t<=r[e+1];t++){const e=i[t];n+=s[t]*e,o+=e}o<=0&&t.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");const a=n/o;let l=0;for(let t=r[e]+1;t<=r[e+1];t++)l+=i[t]*(s[t]-a)**2;return{sbMean:a,sbSdcm:l}}e.createGenerateRendererClassBreaks=function(e,t){const{normalizationTotal:a}=e;return{classBreaks:function(e,t){const a=e.definition,{classificationMethod:l,normalizationType:u,definedInterval:c}=a,d=a.breakCount??1,h=[];let p=e.values;if(0===p.length)return[];p=p.sort((e,t)=>e-t);const[f,m]=t??[p.at(0),p.at(-1)];if("equal-interval"===l)if(p.length>=d){const e=(m-f)/d;let t=f;for(let i=1;i<d;i++){const n=r(f+i*e,6);h.push({minValue:t,maxValue:n,label:s(t,n,u)}),t=n}h.push({minValue:t,maxValue:m,label:s(t,m,u)})}else p.forEach(e=>{h.push({minValue:e,maxValue:e,label:s(e,e,u)})});else if("natural-breaks"===l){const t=i(p),a=e.valueFrequency||t.valueFrequency,l=function(e,t,r){const s=e.length,i=[];r>s&&(r=s);for(let e=0;e<r;e++)i.push(Math.round(e*s/r-1));i.push(s-1);let a=n(i,e,t,r);return function(e,t,r,s,i,n){let a=0,l=0,u=0,c=0,d=!0;for(let h=0;h<2&&d;h++){0===h&&(d=!1);for(let h=0;h<n-1;h++)for(;r[h+1]+1!==r[h+2];){r[h+1]=r[h+1]+1;const n=o(h,r,s,i);u=n.sbMean,a=n.sbSdcm;const p=o(h+1,r,s,i);if(c=p.sbMean,l=p.sbSdcm,!(a+l<t[h]+t[h+1])){r[h+1]=r[h+1]-1;break}t[h]=a,t[h+1]=l,e[h]=u,e[h+1]=c,d=!0}for(let h=n-1;h>0;h--)for(;r[h]!==r[h-1]+1;){r[h]=r[h]-1;const n=o(h-1,r,s,i);u=n.sbMean,a=n.sbSdcm;const p=o(h,r,s,i);if(c=p.sbMean,l=p.sbSdcm,!(a+l<t[h-1]+t[h])){r[h]=r[h]+1;break}t[h-1]=a,t[h]=l,e[h-1]=u,e[h]=c,d=!0}}return d}(a.mean,a.sdcm,i,e,t,r)&&(a=n(i,e,t,r)),i}(t.uniqueValues,a,d);let c=f;for(let e=1;e<d;e++)if(t.uniqueValues.length>e){const i=r(t.uniqueValues[l[e]],6);h.push({minValue:c,maxValue:i,label:s(c,i,u)}),c=i}h.push({minValue:c,maxValue:m,label:s(c,m,u)})}else if("quantile"===l)if(p.length>=d&&f!==m){let e=f,t=Math.ceil(p.length/d),r=0;for(let i=1;i<d;i++){let n=t+r-1;n>p.length&&(n=p.length-1),n<0&&(n=0),h.push({minValue:e,maxValue:p[n],label:s(e,p[n],u)}),e=p[n],r+=t,t=Math.ceil((p.length-r)/(d-i))}h.push({minValue:e,maxValue:m,label:s(e,m,u)})}else{let e=-1;for(let t=0;t<p.length;t++){const r=p[t];r!==e&&(e=r,h.push({minValue:e,maxValue:r,label:s(e,r,u)}),e=r)}}else if("standard-deviation"===l){const e=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(p),t=function(e,t){let r=0;for(let s=0;s<e.length;s++){const i=e[s];r+=(i-t)*(i-t)}return r/=e.length,Math.sqrt(r)}(p,e);if(0===t)h.push({minValue:p[0],maxValue:p[0],label:s(p[0],p[0],u)});else{const i=function(e,t,r,s,i){let n=Math.max(s-e,t-s)/i/r;return n=n>=1?1:n>=.5?.5:.25,n}(f,m,d,e,t),n=i*t;let o=0,a=f;for(let t=d;t>=1;t--){const i=r(e-(t-.5)*n,6);h.push({minValue:a,maxValue:i,label:s(a,i,u)}),a=i,o++}let l=r(e+.5*n,6);h.push({minValue:a,maxValue:l,label:s(a,l,u)}),a=l,o++;for(let t=1;t<=d;t++)l=o===2*d?m:r(e+(t+.5)*n,6),h.push({minValue:a,maxValue:l,label:s(a,l,u)}),a=l,o++}}else if("defined-interval"===l){if(!c)return h;const[e,i]=t??[p.at(0),p.at(-1)],n=Math.ceil((i-e)/c);let o=e;for(let t=1;t<n;t++){const i=r(e+t*c,6);h.push({minValue:o,maxValue:i,label:s(o,i,u)}),o=i}h.push({minValue:o,maxValue:i,label:s(o,i,u)})}return h}(e,t),normalizationTotal:a}},e.createGenerateRendererUniqueValues=function(e){const t=i(e),r=[],s=t.uniqueValues.length;for(let e=0;e<s;e++){const s=t.uniqueValues[e],i=t.valueFrequency[e],n=s.toString();r.push({value:s,count:i,label:n})}return{uniqueValues:r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define(["require","exports","../../../core/Error","../../../core/jsonMap","../../../core/unitUtils","../../../geometry/projectionUtils","../../../geometry/support/extentUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","./projectionSupport"],function(e,t,r,s,i,n,o,a,l,u,c){"use strict";const d=new s.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),h=Object.freeze({});async function p(e,t,r){const{outFields:s,orderByFields:i,groupByFieldsForStatistics:n,outStatistics:o}=e;if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(o)for(let e=0;e<o.length;e++)o[e].onStatisticField&&(o[e].onStatisticField=o[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),f(e,t,r)}async function f(t,s,n){if(!t)return null;let{where:p}=t;if(t.where=p=p?.trim(),(!p||/^1 *= *1$/.test(p)||s&&s===p)&&(t.where=null),!t.geometry)return t;let f=await async function(t){const{distance:s,units:n}=t,o=t.geometry;if(null==s||"vertexAttributes"in o)return o;const l=o.spatialReference,h=n?d.fromJSON(n):i.getUnitString(l),p=l&&(u.isGeographic(l)||u.isWebMercator(l))?o:await c.checkProjectionSupport(l,u.wgs84).then(()=>c.project(o,u.wgs84)),f=await new Promise((t,r)=>e(["../../../geometry/operators/json/geodesicBufferOperator"],t,r));await f.load();const m=f.execute(p,s||1,{unit:h})??void 0;if(!m||!a.isPolygon(m)||0===m.rings.length)throw new r("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return m}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;f=o.getGeometryExtent(f),f.spatialReference=e}if(f){await c.checkProjectionSupport(f.spatialReference,n),f=function(e,t){const r=e.spatialReference;return m(e,t)&&a.isExtent(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(f,n);const e=(await l.normalizeCentralMeridian(a.fromJSON(f)))[0];if(null==e)throw h;const r="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,s=r&&m(f,n)?{densificationStep:8*r}:void 0,i=e.toJSON(),o=c.project(i,i.spatialReference,n,s);if(!o)throw h;o.spatialReference=n,t.geometry=o}return t}function m(e,t){if(!e)return!1;const r=e.spatialReference;return(a.isExtent(e)||a.isPolygon(e)||a.isPolyline(e))&&!u.equals(r,t)&&!n.canProjectWithoutEngine(r,t)}t.getDateInNumber=function(e,t){return null==e?null:"string"==typeof e?t?new Date(`1970-01-01T${e}Z`).getTime():new Date(e).getTime():e instanceof Date?e.getTime():e},t.normalizeAttributeBinsQuery=async function(e,t,r){const s=e.bin;return s.onField&&(s.onField=s.onField.trim()),s.onExpression?.value&&(s.onExpression.value=s.onExpression.value.trim()),s.splitBy&&(s.splitBy.value&&(s.splitBy.value=s.splitBy.value.trim()),s.splitBy.outAlias&&(s.splitBy.outAlias=s.splitBy.outAlias.trim())),s.stackBy&&(s.stackBy.value&&(s.stackBy.value=s.stackBy.value.trim()),s.stackBy.outAlias&&(s.stackBy.outAlias=s.stackBy.outAlias.trim())),"normalizationField"in s.parameters&&s.parameters.normalizationField&&(s.parameters.normalizationField=s.parameters.normalizationField.trim()),e.outStatistics?.length||(e.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:"frequency"}]),p(e,t,r)},t.normalizeQuery=p,t.normalizeQueryLike=f,t.queryEngineEmptyResult=h,t.unitsKebabDict=d,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(e){"use strict";e.makeEdgeCandidate=function(e,t,r,s,i,n=!1){return{objectId:e,target:t,distance:r,type:"edge",start:s,end:i,draped:n}},e.makeVertexCandidate=function(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/AutoIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,s,i,n,o,a,l,u,c){"use strict";function d(e,t,s){r.setDeepValue(s,e instanceof Date?e.getTime():e,t)}return e.default=class extends(c.NormalizationBinParametersMixin(u)){constructor(e){super(e),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}},t.__decorate([s.property({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],e.default.prototype,"numBins",void 0),t.__decorate([s.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([s.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([a.enumeration({autoIntervalBin:"auto-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.AutoIntervalBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/rest/support/BinParametersBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./AttributeBinsGrouping"],function(e,t,r,s,i,n,o,a,l,u,c,d){"use strict";const h=new s.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),p=new s.JSONMap({naturalLog:"natural-log",squareRoot:"square-root"});return e.default=class extends(r.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}},t.__decorate([n.property({type:String,json:{name:"onExpression.value",write:!0}})],e.default.prototype,"expression",void 0),t.__decorate([u.enumeration(h,{name:"onExpression.valueType"})],e.default.prototype,"expressionValueType",void 0),t.__decorate([n.property({type:String,json:{name:"onField",write:!0}})],e.default.prototype,"field",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"firstDayOfWeek",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"hideUpperBound",void 0),t.__decorate([n.property({type:d,json:{write:{overridePolicy(){return{enabled:null!=this.splitBy?.value||null!=this.splitBy?.type}}}}})],e.default.prototype,"splitBy",void 0),t.__decorate([n.property({type:d,json:{write:{target:{stackBy:{type:d},jsonStyle:{type:String}},writer:(e,t)=>{e&&(t.stackBy=e.toJSON(),null!=e.responseType&&(t.jsonStyle=e.responseType))},overridePolicy(){return{enabled:null!=this.stackBy?.value||null!=this.stackBy?.type}}},read:{source:["stackBy","jsonStyle"],reader:(e,t)=>d.fromJSON({...t.stackBy,responseType:t.jsonStyle})}}})],e.default.prototype,"stackBy",void 0),t.__decorate([u.enumeration(p)],e.default.prototype,"transformation",void 0),e.default=t.__decorate([c.subclass("esri.rest.support.BinParametersBase")],e.default),e.default})},"esri/rest/support/AttributeBinsGrouping":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a,l,u){"use strict";const c=new r.JSONMap({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let d=class extends(t.ClonableMixin(s.JSONSupport)){constructor(e){super(e),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};e.__decorate([i.property({type:String,json:{name:"outAlias",write:!0}})],d.prototype,"alias",void 0),e.__decorate([i.property({type:String})],d.prototype,"responseType",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"type",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],d.prototype,"value",void 0),e.__decorate([l.enumeration(c)],d.prototype,"valueType",void 0),d=e.__decorate([u.subclass("esri.rest.support.AttributeBinsGrouping")],d);const h=d;return d.from=n.ensureType(d),h})},"esri/rest/support/NormalizationBinParametersMixin":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a,l){"use strict";const u=r.strict()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),c="percent-of-total",d="field";e.NormalizationBinParametersMixin=e=>{const r=e;let n=class extends r{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&d||r&&c||null,t&&r&&s.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==d&&e!==c||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}};return t.__decorate([i.property({type:String,json:{name:"parameters.normalizationField",write:!0}})],n.prototype,"normalizationField",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],n.prototype,"normalizationMaxValue",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],n.prototype,"normalizationMinValue",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],n.prototype,"normalizationTotal",void 0),t.__decorate([a.enumeration(u,{name:"parameters.normalizationType"})],n.prototype,"normalizationType",null),n=t.__decorate([l.subclass("esri.rest.support.NormalizationBinParametersMixin")],n),n},e.normalizationTypeJsonMap=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/DateBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./DateBinTimeInterval"],function(e,t,r,s,i,n,o,a,l,u,c){"use strict";function d(e,t,s){r.setDeepValue(s,"string"==typeof e?e:e?.getTime(),t)}function h(e,t){const r=e.parameters[t];return r?"string"==typeof r?r:new Date(r):null}return e.default=class extends u{constructor(e){super(e),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=!1,this.start=null,this.snapToData=null,this.type="date"}},t.__decorate([s.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.end",read:{reader:(e,t)=>h(t,"end")},write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([s.property({type:c,json:{name:"parameters",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([s.property({type:c,json:{name:"parameters.offset",write:!0}})],e.default.prototype,"offset",void 0),t.__decorate([s.property({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],e.default.prototype,"returnFullIntervalBin",void 0),t.__decorate([s.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.start",read:{reader:(e,t)=>h(t,"start")},write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([s.property({type:String,json:{name:"parameters.snapToData",write:!0}})],e.default.prototype,"snapToData",void 0),t.__decorate([a.enumeration({dateBin:"date"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.DateBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/rest/support/DateBinTimeInterval":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./DateBinUtils"],function(e,t,r,s,i,n,o,a,l,u){"use strict";let c=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.value=null,this.unit=null}};e.__decorate([s.property({type:Number,json:{name:"number",write:!0}})],c.prototype,"value",void 0),e.__decorate([a.enumeration(u.unitsDict)],c.prototype,"unit",void 0),c=e.__decorate([l.subclass("esri.rest.support.DateBinTimeInterval")],c);const d=c;return c.from=i.ensureType(c),d})},"esri/rest/support/DateBinUtils":function(){define(["exports","../../core/jsonMap"],function(e,t){"use strict";const r=t.strict()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"});e.unitsDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/FixedBoundariesBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase"],function(e,t,r,s,i,n,o,a,l,u){"use strict";return e.default=class extends u{constructor(e){super(e),this.boundaries=[],this.type="fixed-boundaries"}},t.__decorate([s.property({json:{name:"parameters.boundaries",write:{writer:function(e,t,s){r.setDeepValue(s,e&&e[0]instanceof Date?e.map(e=>e.getTime()):e,t)}}}})],e.default.prototype,"boundaries",void 0),t.__decorate([a.enumeration({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedBoundariesBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/rest/support/FixedIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,s,i,n,o,a,l,u,c){"use strict";function d(e,t,s){r.setDeepValue(s,e instanceof Date?e.getTime():e,t)}return e.default=class extends(c.NormalizationBinParametersMixin(u)){constructor(e){super(e),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}},t.__decorate([s.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([s.property({type:Number,json:{name:"parameters.interval",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([s.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([a.enumeration({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedIntervalBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/layers/graphics/data/queryValidationUtils":function(){define(["exports","../../../core/Error","./attributeSupport","./projectionSupport","./spatialQuerySupport","../../../support/loadArcade"],function(e,t,r,s,i,n){"use strict";const o="unsupported-query";async function a(e,{fieldsIndex:n,geometryType:a,spatialReference:c,availableFields:d}){if(null!=e.geometryPrecision||e.multipatchOption&&"xyFootprint"!==e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new t(o,"Unsupported query options",{query:e});return l(n,d,e),function(e,s,i){const{outStatistics:n,groupByFieldsForStatistics:a,having:l}=i,c=a?.length,d=n?.length;if(l){if(!c||!d)throw new t(o,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:i});r.validateHaving(e,s,l,n,i)}if(d){if(!function(e){return null!=e&&e.every(e=>"exceedslimit"!==e.statisticType)}(n))return;const l=n.map(e=>e.onStatisticField).filter(Boolean);r.validateFields(e,s,l,{expressionName:"onStatisticFields",query:i}),c&&r.validateFields(e,s,a,{expressionName:"groupByFieldsForStatistics",query:i});for(const a of n){const{onStatisticField:n,statisticType:l}=a;if("percentile_disc"!==l&&"percentile_cont"!==l||!("statisticParameters"in a))e.get(n)&&"count"!==l&&"min"!==l&&"max"!==l&&r.validateFields(e,s,[n],{expressionName:`outStatistics with '${l}' statistic type`,allowedFieldTypes:u,query:i});else{const{statisticParameters:e}=a;if(!e)throw new t(o,"statisticParameters should be set for percentile type",{definition:a,query:i})}}}}(n,d,e),Promise.all([i.checkSpatialQuerySupport(e,a,c),s.checkProjectionSupport(c,e.outSR)]).then(()=>e)}function l(e,s,i){const{returnDistinctValues:n,outStatistics:a}=i,l=a?a.map(e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if("orderByFields"in i&&i.orderByFields&&i.orderByFields.length>0){const t=" asc",n=" desc",o=i.orderByFields.map(e=>{const r=e.toLowerCase();return r.includes(t)?r.split(t)[0]:r.includes(n)?r.split(n)[0]:e}).filter(e=>!l.includes(e));r.validateFields(e,s,o,{expressionName:"orderByFields",query:i})}if("outFields"in i)if(i.outFields?.length)r.validateFields(e,s,i.outFields,{expressionName:"outFields",query:i,allowedFieldTypes:"all"});else if(n)throw new t(o,"outFields should be specified for returnDistinctValues",{query:i});r.validateWhere(e,s,i.where,i)}const u=new Set([...r.numericFieldTypes,...r.allDateAndTimeFieldTypes]);async function c(e,s,i,a){let l=[];if(i.valueExpression){const{arcadeUtils:e}=await n.loadArcade();l=e.extractFieldNames(i.valueExpression)}if(i.field&&l.push(i.field),i.field2&&l.push(i.field2),i.field3&&l.push(i.field3),i.normalizationField&&l.push(i.normalizationField),!l.length&&!i.valueExpression)throw new t(o,"field or valueExpression is required",{params:i});r.validateFields(e,s,l,{expressionName:"statistics",query:a})}e.validateAttributeBinsQuery=async function(e,r){const s=e.bin;if(!s.onField&&!s.onExpression?.value||"autoIntervalBin"===s.type&&null==s.parameters.numberOfBins||"dateBin"===s.type&&(null==s.parameters.number||null==s.parameters.unit)||"fixedBoundariesBin"===s.type&&null==s.parameters.boundaries||"fixedIntervalBin"===s.type&&null==s.parameters.interval)throw new t(o,"Unsupported query options",{query:e});return a(e,r)},e.validateQuery=a,e.validateStatisticsQuery=async function(e,r,{fieldsIndex:n,geometryType:a,spatialReference:u,availableFields:d}){if(null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new t(o,"Unsupported query options",{query:e});return l(n,d,e),Promise.all([c(n,d,r,e),i.checkSpatialQuerySupport(e,a,u),s.checkProjectionSupport(u,e.outSR)]).then(()=>e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define(["require","exports","../../../core/Error","../../../geometry/support/contains","../../../geometry/support/intersects","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../contains","../featureConversionUtils","../OptimizedGeometry","./geometryUtils","./projectionSupport"],function(e,t,r,s,i,n,o,a,l,u,c,d){"use strict";const h="unsupported-query",p={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},f={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1},y={esriSpatialRelIntersects:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/intersectsOperator"],t,r)),esriSpatialRelContains:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/containsOperator"],t,r)),esriSpatialRelCrosses:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/crossesOperator"],t,r)),esriSpatialRelDisjoint:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/disjointOperator"],t,r)),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/overlapsOperator"],t,r)),esriSpatialRelTouches:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/touchesOperator"],t,r)),esriSpatialRelWithin:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/withinOperator"],t,r)),esriSpatialRelRelation:null};t.canQueryWithRBush=function(e){if(n.isExtent(e))return!0;if(n.isPolygon(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1},t.checkSpatialQuerySupport=async function(e,t,s){const{spatialRel:i,geometry:a}=e;if(a){if(null==(l=i)||!0!==p[l])throw new r(h,"Unsupported query spatial relationship",{query:e});var l;if(o.isValid(a.spatialReference)&&o.isValid(s)){if(!function(e){return null!=e&&!0===f[n.getJsonType(e)]}(a))throw new r(h,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===m[e]}(t))throw new r(h,"Unsupported layer geometry type",{query:e});if(e.outSR)return d.checkProjectionSupport(e.geometry?.spatialReference,e.outSR)}}},t.getSpatialQueryOperator=async function(e,t,r,o,d){if(n.isPolygon(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=l.convertFromPolygon(new u,t,!1,!1);return t=>a.polygonContainsPoint(e,!1,!1,t)}if("esriGeometryMultipoint"===r){const r=l.convertFromPolygon(new u,t,!1,!1);if("esriSpatialRelContains"===e)return e=>a.polygonContainsMultipoint(r,!1,!1,e,o,d)}}if(n.isExtent(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return e=>s.extentContainsPoint(t,c.getGeometry(r,o,d,e));if("esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return e=>s.extentContainsMultipoint(t,c.getGeometry(r,o,d,e));if("esriSpatialRelIntersects"===e){const e=i.getExtentIntersector(r);return s=>e(t,c.getGeometry(r,o,d,s))}}"esriSpatialRelEnvelopeIntersects"===e&&(e="esriSpatialRelIntersects");const h=await function(e){const t=y[e];if(null==t)throw new Error(`Cannot load unsupported spatial operator: ${e}`);return t()}(e);return e=>h.execute(t,c.getGeometry(r,o,d,e))},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(e,t){"use strict";e.extentIntersectsExtent=t.extentIntersectsExtent,e.extentIntersectsMultipoint=t.extentIntersectsMultipoint,e.extentIntersectsPoint=t.extentIntersectsPoint,e.extentIntersectsPolygon=t.extentIntersectsPolygon,e.extentIntersectsPolyline=t.extentIntersectsPolyline,e.getFeatureExtentIntersector=t.getFeatureExtentIntersector,e.isSelfIntersecting=t.isSelfIntersecting,e.segmentIntersects=t.segmentIntersects,e.getExtentIntersector=function(e){return"mesh"===e?t.extentIntersectsExtent:t.getFeatureExtentIntersector(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,i,n,o){if(!e)return!1;const a=t(r,i),{coords:l,lengths:u}=e;let c=!1,d=0;for(const e of u)c=s(c,l,a,d,e,n,o),d+=e*a;return c}function s(e,t,r,s,i,n,o){let a=e,l=s;for(let e=s,u=s+i*r;e<u;e+=r){l=e+r,l===u&&(l=s);const i=t[e],c=t[e+1],d=t[l],h=t[l+1];(c<o&&h>=o||h<o&&c>=o)&&i+(o-c)/(h-c)*(d-i)<n&&(a=!a)}return a}e.polygonContainsCoords=r,e.polygonContainsMultipoint=function(e,s,i,n,o,a){const l=t(o,a),{coords:u,lengths:c}=n;if(!c)return!1;for(let t=0,n=0;t<c.length;t++,n+=l)if(!r(e,s,i,u[n],u[n+1]))return!1;return!0},e.polygonContainsPoint=function(e,t,s,i){return r(e,t,s,i.coords[0],i.coords[1])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports","../../../core/compilerUtils"],function(e,t){"use strict";e.getTimeExtent=async function(e,r){if(!e)return null;const s=r.featureAdapter,{startTimeField:i,endTimeField:n}=e;let o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(i&&n)await r.forEach(e=>{const r=s.getAttribute(t.toConst(e),i),l=s.getAttribute(t.toConst(e),n);null==r||isNaN(r)||(o=Math.min(o,r)),null==l||isNaN(l)||(a=Math.max(a,l))});else{const e=i||n;await r.forEach(r=>{const i=s.getAttribute(t.toConst(r),e);null==i||isNaN(i)||(o=Math.min(o,i),a=Math.max(a,i))})}return{start:o,end:a}},e.getTimeOperator=function(e,t,r){if(!t||!e)return null;const{startTimeField:s,endTimeField:i}=e;if(!s&&!i)return null;const{start:n,end:o}=t;if(null===n&&null===o)return null;if(void 0===n&&void 0===o)return()=>!1;const a=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return s&&i?function(e,t,r,s,i){return null!=s&&null!=i?n=>{const o=e(n,t),a=e(n,r);return(null==o||o<=i)&&(null==a||a>=s)}:null!=s?t=>{const i=e(t,r);return null==i||i>=s}:null!=i?r=>{const s=e(r,t);return null==s||s<=i}:void 0}(a,s,i,n,o):function(e,t,r,s){return null!=r&&null!=s&&r===s?s=>e(s,t)===r:null!=r&&null!=s?i=>{const n=e(i,t);return null!=n&&n>=r&&n<=s}:null!=r?s=>{const i=e(s,t);return null!=i&&i>=r}:null!=s?r=>{const i=e(r,t);return null!=i&&i<=s}:void 0}(a,s||i,n,o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FieldsIndex":function(){define(["../../core/Error","../../core/Logger","../../core/MapUtils","../../core/sql/UnknownTimeZone","../../core/support/jsonUtils","./fieldUtils","../../time/constants","../../time/timeZoneUtils","../../chunks/datetime"],function(e,t,r,s,i,n,o,a,l){"use strict";const u=new Map;class c{static fromJSON(e){return new c(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new c(e.fields??[],f(e))}static fromLayerJSON(e){return new c(e.fields??[],f(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const e of this.fields){const t=e?.name,s=h(t);if(t&&s){const i=d(t);this._fieldsMap.set(t,e),this._fieldsMap.set(i,e),this._normalizedFieldsMap.set(s,e),r.push(`${i}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),n.isDateField(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):n.isNumericField(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),n.isObjectIDField(e)||n.isGlobalIDField(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)n.isObjectIDField(e)||n.isGlobalIDField(e)||e.nullable||void 0!==n.getFieldDefaultValue(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(d(e))??this._normalizedFieldsMap.get(h(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(r){const s=this.get(r&&"string"!=typeof r?r.name:r);return s?this._timeZoneByFieldName?this._timeZoneByFieldName.get(s.name):"date"===s.type||"esriFieldTypeDate"===s.type?(t.getLogger("esri.layers.support.FieldsIndex").errorOnce(new e("getTimeZone:no-timezone-information",`no time zone information for field '${s.name}'`)),o.utc):p.has(s.type)?o.unknown:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===o.unknown?s.UnknownTimeZone.instance:t===o.utc?l.FixedOffsetZone.utcInstance:r.getOrCreateMapValue(u,t,()=>l.IANAZone.create(t)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return n.isTimeOnlyField(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>i.isSerializable(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function d(e){return e.trim().toLowerCase()}function h(e){return n.normalizeFieldName(e)?.toLowerCase()??""}const p=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function f(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:s,editFieldsInfo:i}=e,n=(s?"startField"in s?s.startField:s.startTimeField:"")??"",l=(s?"endField"in s?s.endField:s.endTimeField:"")??"",u="dateFieldsTimeZone"in e?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?a.fromTimeReference(e.dateFieldsTimeReference):null,c=i?"timeZone"in i?i.timeZone??u:i.dateFieldsTimeReference?a.fromTimeReference(i.dateFieldsTimeReference):u??o.utc:null,h=s?"timeZone"in s?s.timeZone??u:s.timeReference?a.fromTimeReference(s.timeReference):u:null,f=new Map([[d(i?.creationDateField??""),c],[d(i?.editDateField??""),c],[d(n),h],[d(l),h]]);for(const{name:s,type:i}of e.fields)if(p.has(i))t.set(s,o.unknown);else if("date"!==i&&"esriFieldTypeDate"!==i)t.set(s,null);else if(r)t.set(s,o.unknown);else{const e=f.get(d(s??""))??u;t.set(s,e)}return t}return c})},"esri/views/support/Scheduler":function(){define(["exports","../../core/arrayUtils","../../core/Handles","../../core/has","../../core/Logger","../../core/maybe","../../core/PerformanceSampler","../../core/promiseUtils","../../core/reactiveUtils","../../core/signal","../../core/time","../../layers/support/PromiseQueue","./debugFlags","./Yield"],function(e,t,r,s,i,n,o,a,l,u,c,d,h,p){"use strict";const f={RESOURCE_CONTROLLER_IMMEDIATE:"immediate",RESOURCE_CONTROLLER:"schedule",SLIDE:"slide",STREAM_DATA_LOADER:"stream loader",ELEVATION_QUERY:"elevation query",TERRAIN_SURFACE:"terrain",SURFACE_GEOMETRY_UPDATES:"surface geometry updates",LOD_RENDERER:"LoD renderer",GRAPHICS_CORE:"Graphics3D",I3S_CONTROLLER:"I3S",POINT_CLOUD_LAYER:"point cloud",FEATURE_TILE_FETCHER:"feature fetcher",STREAM_CONTROLLER:"stream controller",OVERLAY:"overlay",OVERLAY_RENDERER:"overlay renderer",STAGE:"stage",GRAPHICS_DECONFLICTOR:"graphics deconflictor",FILTER_VISIBILITY:"Graphics3D filter visibility",SCALE_VISIBILITY:"Graphics3D scale visibility",FRUSTUM_VISIBILITY:"Graphics3D frustum visibility",POINT_OF_INTEREST_FREQUENT:"POI frequent",POINT_OF_INTEREST_INFREQUENT:"POI infrequent",LABELER:"labeler",FEATURE_QUERY_ENGINE:"feature query",FEATURE_TILE_TREE:"feature tile tree",FEATURE_TILE_TREE_ACTIVE:"fast feature tile tree",ELEVATION_ALIGNMENT:"elevation alignment",ELEVATION_ALIGNMENT_SCENE:"elevation alignment scene",TEXT_TEXTURE_ATLAS:"text texture atlas",TEXTURE_UNLOAD:"texture unload",LINE_OF_SIGHT_TOOL:"line of sight tool",LINE_OF_SIGHT_TOOL_INTERACTIVE:"interactive line of sight tool",ELEVATION_PROFILE:"elevation profile",SNAPPING:"snapping",SHADOW_ACCUMULATOR:"shadow accumulator",CLOUDS_GENERATOR:"clouds generator",FLOW_GENERATOR:"flow generator",MAPVIEW_FETCH_QUEUE:"mapview fetch queue",MAPVIEW_LAYERVIEW_UPDATE:"mapview layerview update",MAPVIEW_VECTOR_TILE_PARSING_QUEUE:"mapview vector tile parsing queue",NONE:0,TEST_PRIO:1},m=new Map([[f.RESOURCE_CONTROLLER_IMMEDIATE,0],[f.RESOURCE_CONTROLLER,4],[f.SLIDE,0],[f.STREAM_DATA_LOADER,0],[f.ELEVATION_QUERY,0],[f.TERRAIN_SURFACE,1],[f.SURFACE_GEOMETRY_UPDATES,1],[f.LOD_RENDERER,2],[f.GRAPHICS_CORE,2],[f.I3S_CONTROLLER,2],[f.POINT_CLOUD_LAYER,2],[f.FEATURE_TILE_FETCHER,2],[f.STREAM_CONTROLLER,2],[f.CLOUDS_GENERATOR,2],[f.OVERLAY,4],[f.OVERLAY_RENDERER,4],[f.STAGE,4],[f.GRAPHICS_DECONFLICTOR,4],[f.FILTER_VISIBILITY,4],[f.SCALE_VISIBILITY,4],[f.FRUSTUM_VISIBILITY,4],[f.POINT_OF_INTEREST_FREQUENT,6],[f.POINT_OF_INTEREST_INFREQUENT,30],[f.LABELER,8],[f.FEATURE_QUERY_ENGINE,8],[f.FEATURE_TILE_TREE,16],[f.FEATURE_TILE_TREE_ACTIVE,0],[f.ELEVATION_ALIGNMENT,12],[f.ELEVATION_ALIGNMENT_SCENE,14],[f.TEXT_TEXTURE_ATLAS,12],[f.TEXTURE_UNLOAD,12],[f.LINE_OF_SIGHT_TOOL,16],[f.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[f.SNAPPING,0],[f.SHADOW_ACCUMULATOR,30],[f.FLOW_GENERATOR,12],[f.MAPVIEW_FETCH_QUEUE,0],[f.MAPVIEW_LAYERVIEW_UPDATE,2],[f.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function y(e){return m.has(e)?m.get(e):"number"==typeof e?e:1}const g=c.Milliseconds(6.5),_=c.Milliseconds(1),b=c.Milliseconds(30),S=c.Milliseconds(1e3/30),v=c.Milliseconds(100);class x{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(e=>e.needsUpdate)}constructor(){this._updating=u.signal(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new o("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new F,this._state=1,this._tasks=new Array,this._runQueue=new Array,this._load=0,this._idleStateCallbacks=new Array,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=l.watch(()=>h.SCHEDULER_LOG_SLOW_TASKS,e=>this._debug=e,l.initial);for(const e of Object.keys(f))this.performanceInfo.tasks.set(f[e],new o(String(f[e])))}destroy(){this._tasks.forEach(e=>e.remove()),this._tasks.length=0,this._idleStateCallbacks.length=0,this._runQueue.length=0,n.removeMaybe(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())}))}registerTask(e,t){const r=new T(this,e,t);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new o(e)),r}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),2===this.state&&this._idleUpdatesStartFired&&r.idleBegin();const s=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){s._idleUpdatesStartFired&&(r.idleEnd(),2===s._state&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forEach(e=>e.idleEnd())))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=g,r=e.frameDuration,s=_;switch(this.state){case 2:t=c.Milliseconds(0),r=c.Milliseconds(Math.max(v,e.frameDuration)),s=b;break;case 1:r=c.Milliseconds(Math.max(S,e.frameDuration))}return r=c.Milliseconds(r-e.elapsedFrameTime-t),2!==this.state&&r<_&&!this._forceTask?(this._forceTask=!0,!1):(r=c.Milliseconds(Math.max(r,s)),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forEach(e=>e.idleBegin())),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(c.Milliseconds(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),t.removeUnordered(this._idleStateCallbacks,e)}removeTask(e){t.removeUnordered(this._tasks,e),t.removeUnordered(this._runQueue,e),this._updatingChanged()}_updateTask(e){this._tasks.forEach(t=>{t.name===e&&t.setPriority(e)})}_getState(e){if(this._runQueue.some(t=>t.name===e))return"s";let t="i";return this._tasks.forEach(r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t="r":"r"!==t&&(t="w"))}),t}_getRuntime(e){let t=0;return this._tasks.forEach(r=>{r.name===e&&(t+=r.runtime)}),t}_resetRuntimes(){this._tasks.forEach(e=>e.runtime=0)}_getRunning(){const e=new Map;if(this._tasks.forEach(t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)}),0===e.size)return null;let t="";return e.forEach((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`}),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce((e,t)=>t.needsUpdate?++e:e,0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(t.filterInPlace(this._runQueue,e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)),this._tasks.forEach(e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)});0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forEach(r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)}),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const e=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.task.runTask(this._budget)===p.Yield&&(t.blockFrame=this._frameNumber)}catch(e){i.getLogger("esri.views.support.Scheduler").error(`Exception in task "${t.name}"`,e),t.blockFrame=this._frameNumber}!this._budget.hasProgressed&&t.blockFrame!==this._frameNumber&&t.needsUpdate&&(t.name,t.blockFrame=this._frameNumber),t.schedulePriority=t.basePriority;const r=this._budget.now()-e;if(t.runtime+=r,this._frameTaskTimes.set(t.priority,this._frameTaskTimes.get(t.priority)+r),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(f))this._frameTaskTimes.set(f[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach((e,t)=>this.performanceInfo.tasks.get(t).push(e)),this.performanceInfo.total.push(e)}get test(){return this._test}}class T{get task(){return this._task.value}get readyToRun(){return this._queue.readyToRun}get updating(){return this._queue.updating}constructor(e,t,s){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new d.PromiseQueue,this._handles=new r,this._basePriority=y(t),this.schedulePriority=this._basePriority,this._task=u.signal(null!=s?s:this._queue),this._handles.add(l.when(()=>this.task.readyToRun,t=>e.taskRunningChanged(t)))}remove(){this.processQueue(I),this._scheduler.removeTask(this),this.schedule=M.schedule,this.reschedule=M.reschedule,this.scheduleGenerator=M.scheduleGenerator,this.rescheduleGenerator=M.rescheduleGenerator,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=y(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.readyToRun||!this.task.destroyed&&this.task.readyToRun}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}scheduleGenerator(e,t,r){return this._queue.pushGenerator(e,t,r)}rescheduleGenerator(e,t,r){return this._queue.unshiftGenerator(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class F{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}const I=new F;I.enabled=!1;const M=new class{remove(){}processQueue(){}schedule(e,t,r){try{if(a.isAborted(t)){const e=a.createAbortError();return r?Promise.resolve(r(e)):Promise.reject(e)}return a.when(e(I))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}async scheduleGenerator(e,t,r){if(a.isAborted(t)){const e=a.createAbortError();if(r)return r(e);throw e}const s=e(I);for(;;){const e=s.next(I),i=a.isPromiseLike(e)?await e:e;if(a.isAborted(t)){const e=a.createAbortError();if(r)return r(e);throw e}if(i.done)return i.value}}rescheduleGenerator(e,t,r){return this.rescheduleGenerator(e,t,r)}};e.ImmediateTask=M,e.TaskPriority=f,e.getTaskPriority=y,e.makeBudget=function(e){const t=new F;return t.reset(e),t},e.newScheduler=function(){return new x},e.noBudget=I,e.taskPriorities=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/signal":function(){define(["exports","./lang","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t,r,s){"use strict";class i{constructor(e,t){this._observable=new s.SimpleObservable,this._value=e,this._equalityFunction=t}get value(){return r.trackAccess(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}}e.signal=function(e,r=t.equalsShallow){return new i(e,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/compilerUtils","../../core/Logger","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(e,t,r,s,i,n){"use strict";function o(e){s.isPromiseLike(e)?e.then(a):a(e)}function a(e){e.done||r.getLogger("esri.layers.support.PromiseQueue").warn("Generator iterator was aborted, but it is not done.")}class l{constructor(e,t,r=void 0,s=void 0){this.resolve=e,this.reject=t,this.signal=r,this.abortCallback=s}}class u extends l{constructor(e,t,r,s,i){super(e,t,s,i),this.callback=r,this.type=0}}class c extends l{constructor(e,t,r,s,i,n){super(e,t,s,i),this.generatorFunction=r,this.scheduleFunction=n,this.type=1}}class d extends l{constructor(e,t,r,s,i,n){super(e,t,s,i),this.iterator=r,this.scheduleFunction=n,this.type=2}}e.PromiseQueue=class{constructor(){this._tasks=new Array,this._numPendingTasks=i.signal(0),this._readyToRun=i.signal(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get readyToRun(){return this._readyToRun.value}_updateReadyToRun(){this._readyToRun.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return n.Yield;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return this._addTask((s,i)=>new u(s,i,e,t,r),Array.prototype.push)}unshift(e,t,r){return this._addTask((s,i)=>new u(s,i,e,t,r),Array.prototype.unshift)}pushGenerator(e,t,r){const s=Array.prototype.push;return this._addTask((i,n)=>new c(i,n,e,t,r,s),s)}unshiftGenerator(e,t,r){const s=Array.prototype.unshift;return this._addTask((i,n)=>new c(i,n,e,t,r,s),s)}_process(e){if(0===this._tasks.length)return!1;const r=this._tasks.shift();this._updateReadyToRun();try{if(s.isAborted(r.signal))this._cancelTask(r,s.createAbortError());else switch(r.type){case 0:this._processSimple(r,e);break;case 1:this._processGenerator(r,e);break;case 2:this._processIterator(r,e);break;default:t.neverReached(r)}}catch(e){r.reject(e)}return!0}cancelAll(){const e=s.createAbortError();for(const t of this._tasks)this._cancelTask(t,e);this._tasks.length=0,this._updateReadyToRun()}_cancelTask(e,t){if(e.abortCallback){const r=e.abortCallback(t);2===e.type&&e.iterator.return&&o(e.iterator.return()),s.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}else 2===e.type&&e.iterator.throw&&o(e.iterator.throw(t)),e.reject(t)}_onIteratorResult(e,t){t.done?e.resolve(t.value):(e.scheduleFunction.call(this._tasks,e),this._updateReadyToRun())}_processSimple(e,t){const r=e.callback(t);s.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}_processGenerator(e,t){const r=e.generatorFunction(t),s=new d(e.resolve,e.reject,r,e.signal,e.abortCallback,e.scheduleFunction);this._processIterator(s,t)}_processIterator(e,t){const r=e.iterator.next(t);s.isPromiseLike(r)?r.then(t=>this._onIteratorResult(e,t),e.reject):this._onIteratorResult(e,r)}_addTask(e,t){return new Promise((r,s)=>{const i=e(r,s);t.call(this._tasks,i),++this._numPendingTasks.value,this._updateReadyToRun()}).finally(()=>--this._numPendingTasks.value)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Yield":function(){define(["exports"],function(e){"use strict";const t=Symbol("Yield");e.Yield=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o){"use strict";let a=class extends t{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};return e.__decorate([r.property()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),e.__decorate([r.property()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=e.__decorate([o.subclass("esri.views.support.debugFlags")],a),new a})},"esri/layers/graphics/data/FeatureStore":function(){define(["../../../core/arrayUtils","../../../core/Error","../../../core/Evented","../../../core/Logger","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../featureConversionUtils","./BoundsStore","./geometryUtils","./optimizedFeatureQueryEngineAdapter"],function(e,t,r,s,i,n,o,a,l,u){"use strict";const c=i.create();return class{constructor(e){this.geometryInfo=e,this._boundsStore=new a.BoundsStore,this._featuresById=new Map,this._usedMemory=0,this.events=new r.EventEmitter,this.featureAdapter=u.optimizedFeatureQueryEngineAdapter}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach(t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,r,s,i]=this.fullBounds;return{xmin:t,ymin:r,xmax:s,ymax:i,spatialReference:l.cleanFromGeometryEngine(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(t){const r=t.map(e=>this._upsert(e));return this._emitChanged(),r.filter(e.isSome)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const r of e){const e=this._boundsStore.get(r.objectId);e&&t(i.fromRect(c,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach(t=>e(t))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,e=>{t(this._featuresById.get(e))})}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const r=e.objectId;if(null==r)return void s.getLogger("esri.layers.graphics.data.FeatureStore").error(new t("featurestore:invalid-feature","feature id is missing",{feature:e}));const i=this._featuresById.get(r);let a;if(i?(e.displayId=i.displayId,a=this._boundsStore.get(r),this._boundsStore.delete(r),this._usedMemory-=this.estimateFeatureUsedMemory?.(i)??0):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(r,null),void this._featuresById.set(r,e);a=o.getBoundsOptimizedGeometry(null!=a?a:n.create(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=a&&this._boundsStore.set(r,a),this._featuresById.set(r,e),this._usedMemory+=this.estimateFeatureUsedMemory?.(e)??0}_upsert(e){const r=e?.objectId;if(null==r)return s.getLogger("esri.layers.graphics.data.FeatureStore").error(new t("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const i=this._featuresById.get(r);if(!i)return this._add(e),e;this._usedMemory-=this.estimateFeatureUsedMemory?.(i)??0;const{geometry:a,attributes:l}=e;for(const e in l)i.attributes[e]=l[e];return a&&(i.geometry=a,this._boundsStore.set(r,o.getBoundsOptimizedGeometry(n.create(),a,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),this._usedMemory+=this.estimateFeatureUsedMemory?.(i)??0,i}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(e)??0,e}}})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(e,t,r,s){"use strict";const i={minX:0,minY:0,maxX:0,maxY:0};e.BoundsStore=class{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new r.PooledRBush(9,t("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach((r,s)=>{e[t++]=s}),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(e=>this._idByBounds.has(e))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=s.empty();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),function(e,t,r){!function(e){i.minX=e[0],i.minY=e[1],i.maxX=e[2],i.maxY=e[3]}(t),e.search(i,r)}(this._index,e,e=>t(this._idByBounds.get(e)))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../compilerUtils","../../has","../../PooledArray","../../../chunks/quickselect"],function(e,t,r,s,i,n){"use strict";function o(e,t){let s=e;for(S.clear();s;){if(!0===s.leaf)for(const e of s.children)t(r.toConst(e));else S.pushArray(s.children);s=S.pop()??null}}function a(e,t){l(e,0,e.children.length,t,e)}function l(e,t,r,s,i){i||(i=new I([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let n,o=t;o<r;o++)n=e.children[o],u(i,e.leaf?s(n):n);return i}function u(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function c(e,t){return e.minX-t.minX}function d(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function p(e){return e.maxX-e.minX+(e.maxY-e.minY)}function f(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function m(e,t){const r=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,n-s)}function y(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function g(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function _(e,t,r,s,i){const o=[t,r];for(;o.length;){const t=o.pop(),r=o.pop();if(t-r<=s)continue;const a=r+Math.ceil((t-r)/s/2)*s;n.quickselect(e,a,r,t,i),o.push(r,a,a,t)}}const b=new i,S=new i,v=new i,x=new i({deallocator:void 0});class T{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class F extends T{constructor(){super(...arguments),this.height=1,this.indexHint=new t.PositionHint}}class I extends F{constructor(e){super(),this.children=e,this.leaf=!0}}class M extends F{constructor(e){super(),this.children=e,this.leaf=!1}}e.BBox=T,e.PooledRBush=class{constructor(e=9,t){this._compareMinX=c,this._compareMinY=d,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),S.prune(),v.prune(),x.prune()}all(e){o(this._data,e)}search(e,t){let r=this._data;const s=this._toBBox;if(g(e,r))for(b.clear();r;){for(let i=0,n=r.children.length;i<n;i++){const n=r.children[i],a=r.leaf?s(n):n;g(e,a)&&(r.leaf?t(n):y(e,a)?o(n,t):b.push(n))}r=b.pop()}}collides(e){let t=this._data;const r=this._toBBox;if(!g(e,t))return!1;for(b.clear();t;){for(let s=0,i=t.children.length;s<i;s++){const i=t.children[s],n=t.leaf?r(i):i;if(g(e,n)){if(t.leaf||y(e,n))return!0;b.push(i)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new I([]),this}remove(e){if(!e)return this;let s,i=this._data,n=null,o=0,a=!1;const l=this._toBBox(e);for(v.clear(),x.clear();i||v.length>0;){if(i||(i=v.pop(),n=v.data[v.length-1],o=x.pop()??0,a=!0),i.leaf&&(s=t.indexOf(i.children,r.toConst(e),i.children.length,i.indexHint),-1!==s))return i.children.splice(s,1),v.push(i),this._condense(v),this;a||i.leaf||!y(i,l)?n?(o++,i=n.children[o],a=!1):i=null:(v.push(i),x.push(o),o=0,n=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,r,s){const i=r-t+1;let n=this._maxEntries;if(i<=n){const s=new I(e.slice(t,r+1));return a(s,this._toBBox),s}s||(s=Math.ceil(Math.log(i)/Math.log(n)),n=Math.ceil(i/n**(s-1)));const o=new M([]);o.height=s;const l=Math.ceil(i/n),u=l*Math.ceil(Math.sqrt(n));_(e,t,r,u,this._compareMinX);for(let i=t;i<=r;i+=u){const t=Math.min(i+u-1,r);_(e,i,t,l,this._compareMinY);for(let r=i;r<=t;r+=l){const i=Math.min(r+l-1,t);o.children.push(this._build(e,r,i,s-1))}}return a(o,this._toBBox),o}_insert(e,t,r){const s=this._toBBox,i=r?e:s(e);v.clear();const n=function(e,t,r,s){for(;s.push(t),!0!==t.leaf&&s.length-1!==r;){let r,s=1/0,i=1/0;for(let n=0,o=t.children.length;n<o;n++){const o=t.children[n],a=h(o),l=f(e,o)-a;l<i?(i=l,s=a<s?a:s,r=o):l===i&&a<s&&(s=a,r=o)}t=r||t.children[0]}return t}(i,this._data,t,v);for(n.children.push(e),u(n,i);t>=0&&v.data[t].children.length>this._maxEntries;)this._split(v,t),t--;!function(e,t,r){for(let s=r;s>=0;s--)u(t.data[s],e)}(i,v,t)}_split(e,t){const r=e.data[t],s=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,s);const n=this._chooseSplitIndex(r,i,s);if(!n)return;const o=r.children.splice(n,r.children.length-n),l=r.leaf?new I(o):new M(o);l.height=r.height,a(r,this._toBBox),a(l,this._toBBox),t?e.data[t-1].children.push(l):this._splitRoot(r,l)}_splitRoot(e,t){this._data=new M([e,t]),this._data.height=e.height+1,a(this._data,this._toBBox)}_chooseSplitIndex(e,t,r){let s,i,n;s=i=1/0;for(let o=t;o<=r-t;o++){const t=l(e,0,o,this._toBBox),a=l(e,o,r,this._toBBox),u=m(t,a),c=h(t)+h(a);u<s?(s=u,n=o,i=c<i?c:i):u===s&&c<i&&(i=c,n=o)}return n}_chooseSplitAxis(e,t,r){const s=e.leaf?this._compareMinX:c,i=e.leaf?this._compareMinY:d;this._allDistMargin(e,t,r,s)<this._allDistMargin(e,t,r,i)&&e.children.sort(s)}_allDistMargin(e,t,r,s){e.children.sort(s);const i=this._toBBox,n=l(e,0,t,i),o=l(e,r-t,r,i);let a=p(n)+p(o);for(let s=t;s<r-t;s++){const t=e.children[s];u(n,e.leaf?i(t):t),a+=p(n)}for(let s=r-t-1;s>=t;s--){const t=e.children[s];u(o,e.leaf?i(t):t),a+=p(o)}return a}_condense(e){for(let r=e.length-1;r>=0;r--){const s=e.data[r];if(0===s.children.length)if(r>0){const i=e.data[r-1],n=i.children;n.splice(t.indexOf(n,s,n.length,i.indexHint),1)}else this.clear();else a(s,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},e.cleanupPooledRBush=function(){b.prune(),S.prune(),v.prune(),x.prune()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports"],function(e){"use strict";function t(e,s,i,n,o){for(;n>i;){if(n-i>600){var a=n-i+1,l=s-i+1,u=Math.log(a),c=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*c*(a-c)/a)*(l-a/2<0?-1:1);t(e,s,Math.max(i,Math.floor(s-l*c/a+d)),Math.min(n,Math.floor(s+(a-l)*c/a+d)),o)}var h=e[s],p=i,f=n;for(r(e,i,s),o(e[n],h)>0&&r(e,i,n);p<f;){for(r(e,p,f),p++,f--;o(e[p],h)<0;)p++;for(;o(e[f],h)>0;)f--}0===o(e[i],h)?r(e,i,f):r(e,++f,n),f<=s&&(i=f+1),s<=f&&(n=f-1)}}function r(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function s(e,t){return e<t?-1:e>t?1:0}e.quickselect=function(e,r,i,n,o){t(e,r,i||0,n||e.length-1,o||s)}})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../OptimizedFeature"],function(e,t){"use strict";const r={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,r)=>new t.OptimizedFeature(r,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)};e.optimizedFeatureQueryEngineAdapter=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/unitUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../geometry/Point","../../geometry/SpatialReference","../../geometry/support/aaBoundingRect","../../geometry/support/spatialReferenceUtils","../../geometry/support/webMercatorUtils","./LOD","./TileKey"],function(e,t,r,s,i,n,o,a,l,u,c,d,h,p,f,m,y,g,_){"use strict";var b;const S=new r.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return e.default=class extends s.JSONSupport{static{b=this}static create(e={}){const{resolutionFactor:t=1,scales:r,size:s=256,spatialReference:n=p.WebMercator,numLODs:o=24}=e;if(!m.isValid(n)){const e=[];if(r)for(let t=0;t<r.length;t++){const s=r[t];e.push(new g({level:t,scale:s,resolution:s}))}else{let t=5e-4;for(let r=o-1;r>=0;r--)e.unshift(new g({level:r,scale:t,resolution:t})),t*=2}return new b({dpi:96,lods:e,origin:new h(0,0,n),size:[s,s],spatialReference:n})}const a=m.getInfo(n),l=e.origin?new h({x:e.origin.x,y:e.origin.y,spatialReference:n}):new h(a?{x:a.origin[0],y:a.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),u=1/(39.37*i.getMetersPerUnitForSR(n)*96),c=[];if(r)for(let e=0;e<r.length;e++){const t=r[e],s=t*u;c.push(new g({level:e,scale:t,resolution:s}))}else{let e=m.isGeographic(n)?512/s*591657527.5917094:256/s*591657527.591555;const r=Math.ceil(o/t);c.push(new g({level:0,scale:e,resolution:e*u}));for(let s=1;s<r;s++){const r=e/2**t,i=r*u;c.push(new g({level:s,scale:r,resolution:i})),e=r}}return new b({dpi:96,lods:c,origin:l,size:[s,s],spatialReference:n})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=m.getInfo(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return h.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const s=[],i=this._levelToLOD={};e&&(t=-1/0,r=1/0,e.forEach(e=>{s.push(e.scale),t=e.scale>t?e.scale:t,r=e.scale<r?e.scale:r,i[e.level]=e})),this._set("scales",s),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const r=Math.floor(e),s=r+1;return t[r]/(t[r]/t[s])**(e-r)}scaleToZoom(e){const t=this.scales,r=t.length-1;let s=0;for(;s<r;s++){const r=t[s],i=t[s+1];if(r<=e)return s;if(i===e)return s+1;if(r>e&&i<e)return s+Math.log(r/e)/Math.log(r/i)}return s}tileAt(e,t,r,s){const i=this.lodAt(e);if(!i)return null;let n,o;if("number"==typeof t)n=t,o=r;else if(m.equals(t.spatialReference,this.spatialReference))n=t.x,o=t.y,s=r;else{const e=y.project(t,this.spatialReference);if(null==e)return null;n=e.x,o=e.y,s=r}const a=i.resolution*this.size[0],l=i.resolution*this.size[1];return s||(s=new _.TileKey(null,0,0,0,f.create())),s.level=e,s.row=Math.floor((this.origin.y-o)/l+.001),s.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(s),s}updateTileInfo(e,t=0){let r=this.lodAt(e.level);if(!r&&1===t){const t=this.lods[this.lods.length-1];t.level<e.level&&(r=t)}if(!r)return;const s=e.level-r.level,i=r.resolution*this.size[0]/2**s,n=r.resolution*this.size[1]/2**s;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=f.create()),e.extent[0]=this.origin.x+e.col*i,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+i,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const r=this.lodAt(t.level);if(null==r)return null;const{resolution:s}=r,i=s*this.size[0],n=s*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+i,e[3]=e[1]+n,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return b.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const r=[],s=this.lods.length-t;for(let e=0;e<s;e++){const s=e+t,{scale:i,resolution:n}=s>=0?this.lods[s]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};r.push(new g({level:e,scale:i,resolution:n}))}return new b({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const s=e[r];this._upsampleLevels[s.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/s.resolution:0},t=s}}},t.__decorate([n.property({type:Number,json:{write:!0}})],e.default.prototype,"compressionQuality",void 0),t.__decorate([n.property({type:Number,json:{write:!0}})],e.default.prototype,"dpi",void 0),t.__decorate([n.property({type:String,json:{read:S.read,write:S.write,origins:{"web-scene":{read:!1,write:!1}}}})],e.default.prototype,"format",void 0),t.__decorate([n.property({readOnly:!0})],e.default.prototype,"isWrappable",null),t.__decorate([n.property({type:h,json:{write:!0}})],e.default.prototype,"origin",void 0),t.__decorate([u.reader("origin")],e.default.prototype,"readOrigin",null),t.__decorate([n.property({type:[g],value:null,json:{write:!0}})],e.default.prototype,"lods",null),t.__decorate([n.property({readOnly:!0})],e.default.prototype,"scales",void 0),t.__decorate([n.property({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],e.default.prototype,"size",void 0),t.__decorate([u.reader("size",["rows","cols"])],e.default.prototype,"readSize",null),t.__decorate([d.writer("size",{cols:{type:o.Integer},rows:{type:o.Integer}})],e.default.prototype,"writeSize",null),t.__decorate([n.property({type:p,json:{write:!0}})],e.default.prototype,"spatialReference",void 0),e.default=b=t.__decorate([c.subclass("esri.layers.support.TileInfo")],e.default),e.default})},"esri/layers/support/LOD":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a){"use strict";var l;return e.default=class extends r.JSONSupport{static{l=this}constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new l({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}},t.__decorate([s.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.default.prototype,"cols",void 0),t.__decorate([s.property({type:i.Integer,json:{write:!0}})],e.default.prototype,"level",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"levelValue",void 0),t.__decorate([s.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.default.prototype,"origin",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"resolution",void 0),t.__decorate([s.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.default.prototype,"rows",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"scale",void 0),e.default=l=t.__decorate([a.subclass("esri.layers.support.LOD")],e.default),e.default})},"esri/layers/support/TileKey":function(){define(["exports"],function(e){"use strict";e.TileKey=class{constructor(e,t,r,s,i=void 0){this.id=e,this.level=t,this.row=r,this.col=s,this.extent=i}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/ElevationInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/maybe","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","./FeatureExpressionInfo","./unitConversionUtils"],function(e,t,r,s,i,n,o,a,l,u,c,d,h,p,f){"use strict";const m=s.strict()({onTheGround:"on-the-ground",relativeToGround:"relative-to-ground",relativeToScene:"relative-to-scene",absoluteHeight:"absolute-height"}),y=new s.JSONMap({foot:"feet",kilometer:"kilometers",meter:"meters",mile:"miles","us-foot":"us-feet",yard:"yards"});return e.default=class extends(r.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.featureExpressionInfo=void 0,this.offset=null}readFeatureExpressionInfo(e,t){return null!=e?e.expression?e:void 0:t.featureExpression&&0===t.featureExpression.value?{expression:"0"}:void 0}writeFeatureExpressionInfo(e,t,r,s){t[r]=e.write({},s),"0"===e.expression&&(t.featureExpression={value:0})}get mode(){const{offset:e,featureExpressionInfo:t}=this;return this._isOverridden("mode")?this._get("mode"):null!=e||t?"relative-to-ground":"on-the-ground"}set mode(e){this._override("mode",e)}set unit(e){this._set("unit",e)}write(e,t){return this.offset||this.mode||this.featureExpressionInfo||this.unit?super.write(e,t):null}equals(e){return this.mode===e.mode&&this.offset===e.offset&&this.unit===e.unit&&n.equalsMaybe(this.featureExpressionInfo,e.featureExpressionInfo)}},t.__decorate([o.property({type:p,json:{write:!0}})],e.default.prototype,"featureExpressionInfo",void 0),t.__decorate([c.reader("featureExpressionInfo",["featureExpressionInfo","featureExpression"])],e.default.prototype,"readFeatureExpressionInfo",null),t.__decorate([h.writer("featureExpressionInfo",{featureExpressionInfo:{type:p},"featureExpression.value":{type:[0]}})],e.default.prototype,"writeFeatureExpressionInfo",null),t.__decorate([o.property({type:m.apiValues,nonNullable:!0,json:{type:m.jsonValues,read:m.read,write:{writer:m.write,isRequired:!0}}})],e.default.prototype,"mode",null),t.__decorate([o.property({type:Number,json:{write:!0}})],e.default.prototype,"offset",void 0),t.__decorate([o.property({type:f.supportedUnits,json:{type:String,read:y.read,write:y.write}})],e.default.prototype,"unit",null),e.default=t.__decorate([d.subclass("esri.symbols.support.ElevationInfo")],e.default),e.default})},"esri/symbols/support/FeatureExpressionInfo":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../layers/support/fieldUtils"],function(e,t,r,s,i,n,o,a){"use strict";var l;let u=l=class extends t.JSONSupport{constructor(e){super(e),this.expression=void 0,this.title=void 0}async collectRequiredFields(e,t){return a.collectArcadeFieldNames(e,t,this.expression)}clone(){return new l({expression:this.expression,title:this.title})}equals(e){return this.expression===e.expression&&this.title===e.title}};return e.__decorate([r.property({type:String,json:{write:{isRequired:!0}}})],u.prototype,"expression",void 0),e.__decorate([r.property({type:String,json:{write:!0}})],u.prototype,"title",void 0),u=l=e.__decorate([o.subclass("esri.symbols.support.FeatureExpressionInfo")],u),u})},"esri/symbols/support/unitConversionUtils":function(){define(["exports","../../core/arrayUtils","../../renderers/support/lengthUtils"],function(e,t,r){"use strict";const s=function(){const e=Object.keys(r.meterIn);return t.remove(e,"decimal-degrees"),e.sort(),e}();e.getMetersPerUnit=function(e){return 1/(r.meterIn[e]||1)},e.supportedUnits=s,e.supportsUnit=function(e){return!!e&&null!=r.meterIn[e]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/lengthUtils":function(){define(["exports","../../core/unitUtils","../../geometry/support/Ellipsoid"],function(e,t,r){"use strict";const s={unknown:1,inches:t.convertUnit(1,"meters","inches"),feet:t.convertUnit(1,"meters","feet"),"us-feet":t.convertUnit(1,"meters","us-feet"),yards:t.convertUnit(1,"meters","yards"),miles:t.convertUnit(1,"meters","miles"),"nautical-miles":t.convertUnit(1,"meters","nautical-miles"),millimeters:t.convertUnit(1,"meters","millimeters"),centimeters:t.convertUnit(1,"meters","centimeters"),decimeters:t.convertUnit(1,"meters","decimeters"),meters:t.convertUnit(1,"meters","meters"),kilometers:t.convertUnit(1,"meters","kilometers"),"decimal-degrees":1/t.lengthToDegrees(1,"meters",r.earth.radius)};e.meterIn=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/featureSources/snappingCandidateElevationAlignment":function(){define(["exports","../../../../core/has","../../../../core/LRUCache","../../../../core/MapUtils","../../../../core/promiseUtils","../../../../core/unitUtils","../../../../symbols/support/unitConversionUtils"],function(e,t,r,s,i,n,o){"use strict";class a{async alignCandidates(e,t,r){return e}notifyElevationSourceChange(){}}class l{constructor(e,t){this._elevationInfo=e,this._alignPointsInFeatures=t,this._alignmentsCache=new r.LRUCache(1024),this._cacheVersion=0}async alignCandidates(e,t,r){const s=this._elevationInfo;return null==s||"absolute-height"!==s.mode||s.featureExpressionInfo?this._alignComputedElevationCandidates(e,t,r):(function(e,t,r){const{offset:s,unit:i}=r;if(null==s)return;const a=n.getMetersPerVerticalUnitForSR(t),l=i??"meters",u=s*(o.getMetersPerUnit(l)/a);for(const t of e)switch(t.type){case"edge":t.start.z+=u,t.end.z+=u;continue;case"vertex":t.target.z+=u;continue}}(e,t,s),e)}notifyElevationSourceChange(){this._alignmentsCache.clear(),this._cacheVersion++}async _alignComputedElevationCandidates(e,t,r){const n=new Map;for(const t of e)s.getOrCreateMapValue(n,t.objectId,d).push(t);const[o,a,l]=this._prepareQuery(n,t),u=await this._alignPointsInFeatures(o,r);if(i.throwIfAborted(r),l!==this._cacheVersion)return this._alignComputedElevationCandidates(e,t,r);this._applyCacheAndResponse(o,u,a);const{drapedObjectIds:c,failedObjectIds:h}=u,p=[];for(const t of e){const{objectId:e}=t;c.has(e)&&"edge"===t.type&&(t.draped=!0),h.has(e)||p.push(t)}return p}_prepareQuery(e,t){const r=[],s=[];for(const[t,i]of e){const e=[];for(const r of i)this._addToQueriesOrCachedResult(t,r.target,e,s),"edge"===r.type&&(this._addToQueriesOrCachedResult(t,r.start,e,s),this._addToQueriesOrCachedResult(t,r.end,e,s));0!==e.length&&r.push({objectId:t,points:e})}return[{spatialReference:t.toJSON(),pointsInFeatures:r},s,this._cacheVersion]}_addToQueriesOrCachedResult(e,t,r,s){const i=c(e,t),n=this._alignmentsCache.get(i);null==n?r.push(t):s.push(new u(t,n))}_applyCacheAndResponse(e,{elevations:t,drapedObjectIds:r,failedObjectIds:s},i){for(const e of i)e.apply();let n=0;const o=this._alignmentsCache;for(const{objectId:i,points:a}of e.pointsInFeatures){if(s.has(i)){n+=a.length;continue}const e=!r.has(i);for(const r of a){const s=c(i,r),a=t[n++];r.z=a,e&&o.put(s,a,1)}}}}class u{constructor(e,t){this.point=e,this.z=t}apply(){this.point.z=this.z}}function c(e,{x:t,y:r,z:s,spatialReference:i}){return`${e}-${t}-${r}-${s??0}}-wkid:${i?.wkid}`}function d(){return[]}e.getSnappingCandidateElevationAligner=function(e=!1,t){if(e){const{elevationInfo:e,alignPointsInFeatures:r}=t;return new l(e,r)}return new a},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/featureSources/snappingCandidateElevationFilter":function(){define(["exports","../../../../core/has"],function(e,t){"use strict";class r{filter(e,t){return t}notifyElevationSourceChange(){}}class s{filter(e,t){const{point:r,distance:s}=e,{z:n}=r;if(null==n)return t;if(0===t.length)return t;const o=function(e){return"number"==typeof e?{x:e,y:e,z:e}:e}(s),l=this._updateCandidatesTo3D(t,r,o).filter(i);return l.sort(a),l}_updateCandidatesTo3D(e,t,r){for(const s of e)switch(s.type){case"edge":n(s,t,r);continue;case"vertex":o(s,t,r);continue}return e}}function i(e){return e.distance<=1}function n(e,t,{x:r,y:s,z:i}){const{start:n,end:o,target:a}=e;e.draped||function(e,t,r,s){const i=s.x-r.x,n=s.y-r.y,o=s.z-r.z,a=i*i+n*n+o*o,l=(t.x-r.x)*i+(t.y-r.y)*n+o*(t.z-r.z),u=Math.min(1,Math.max(0,l/a)),c=r.x+i*u,d=r.y+n*u,h=r.z+o*u;e.x=c,e.y=d,e.z=h}(a,t,n,o);const l=(t.x-a.x)/r,u=(t.y-a.y)/s,c=(t.z-a.z)/i;e.distance=Math.sqrt(l*l+u*u+c*c)}function o(e,t,{x:r,y:s,z:i}){const{target:n}=e,o=(t.x-n.x)/r,a=(t.y-n.y)/s,l=(t.z-n.z)/i,u=Math.sqrt(o*o+a*a+l*l);e.distance=u}function a(e,t){return e.distance-t.distance}e.getSnappingCandidateElevationFilter=function(e=!1){return e?new s:new r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/featureSources/symbologySnappingCandidates":function(){define(["exports","../../../../core/has","../../../../core/lang","../../../../core/LRUCache","../../../../core/promiseUtils","../../../../core/string"],function(e,t,r,s,i,n){"use strict";class o{async fetch(){return[]}notifySymbologyChange(){}}class a{constructor(e){this._getSymbologyCandidates=e,this._candidatesCache=new s.LRUCache(1024),this._cacheVersion=0}async fetch(e,t){if(0===e.length)return[];const s=[],n=[],o=this._candidatesCache;for(const t of e){const e=l(t),i=o.get(e);if(i)for(const e of i)n.push(r.clone(e));else s.push(t),o.put(e,[],1)}if(0===s.length)return n;const a=this._cacheVersion,{candidates:u,sourceCandidateIndices:c}=await this._getSymbologyCandidates(s,t);if(i.throwIfAborted(t),a!==this._cacheVersion)return this.fetch(e,t);const d=[],{length:h}=u;for(let e=0;e<h;++e){const t=u[e],i=l(s[c[e]]),n=o.get(i);n.push(t),o.put(i,n,n.length),d.push(r.clone(t))}return n.concat(d)}notifySymbologyChange(){this._candidatesCache.clear(),this._cacheVersion++}}function l(e){switch(e.type){case"vertex":{const{objectId:t,target:r}=e,s=`${t}-vertex-${r.x}-${r.y}-${r.z??0}`;return n.numericHash(s).toString()}case"edge":{const{objectId:t,start:r,end:s}=e,i=`${t}-edge-${r.x}-${r.y}-${r.z??0}-to-${s.x}-${s.y}-${s.z??0}`;return n.numericHash(i).toString()}default:return""}}e.getSymbologySnappingCandidatesFetcher=function(e=!1,t){return e?new a(t):new o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTiledFetcher":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/arrayUtils","../../../../../core/asyncUtils","../../../../../core/Logger","../../../../../core/promiseUtils","../../../../../core/reactiveUtils","../../../../../core/SetUtils","../../../../../core/uuid","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/support/UpdatingHandles","../../../../../geometry/Extent","../../../../../geometry/support/aaBoundingRect","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/support/arcgisLayerUrl","../../../../../rest/query/operations/pbfOptimizedFeatureSet","../../../../../rest/query/operations/query","../../../../../rest/support/Query","./PendingFeatureTile"],function(e,t,r,s,i,n,o,a,l,u,c,d,h,p,f,m,y,g,_,b,S,v){"use strict";e.FeatureServiceTiledFetcher=class extends r{get _minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}get _mandatoryOutFields(){const e=new Set;return this.objectIdField&&e.add(this.objectIdField),this.globalIdField&&e.add(this.globalIdField),e}set outFields(e){const t=this._get("outFields"),r=l.union(e,this._mandatoryOutFields);l.equals(r,t)||(this._set("outFields",r),l.isSubsetOf(r,t)||this.refresh())}get outFields(){return this._get("outFields")??this._mandatoryOutFields}set filter(e){const t=this._get("filter"),r=this._filterProperties(e);JSON.stringify(t)!==JSON.stringify(r)&&this._set("filter",r)}set customParameters(e){const t=this._get("customParameters");JSON.stringify(t)!==JSON.stringify(e)&&this._set("customParameters",e)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(e){const t=this._get("tileInfo");t!==e&&(null!=e&&null!=t&&JSON.stringify(e)===JSON.stringify(t)||(this._set("tileInfo",e),this.store.tileInfo=e))}set tileSize(e){this._get("tileSize")!==e&&this._set("tileSize",e)}get updating(){return this._updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}constructor(e){super(e),this.suspended=!0,this._historicMoment=null,this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._updatingHandles=new p.UpdatingHandles}initialize(){this._initializeFetchExtent(),this._updatingHandles.add(()=>this._configuration,()=>this.refresh()),this._updatingHandles.add(()=>this.tilesOfInterest,()=>{this._updatePriorities(),this._process()},{sync:!0,initial:!0,equals:(e,t)=>s.equals(e,t,({id:e},{id:t})=>e===t)}),this.addHandles(a.when(()=>!this.suspended,()=>this._process()))}_updatePriorities(){this.store.setPriorityOrderByKey(this.tilesOfInterest.map(e=>e.id??"")??[])}destroy(){this._pendingTiles.forEach(e=>this._deletePendingTile(e)),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._updatingHandles.destroy()}refresh(){this.store.refresh(),this._pendingTiles.forEach(e=>this._deletePendingTile(e)),this._process()}async handleEdits(e){if(e.historicMoment&&(this._historicMoment=e.historicMoment),!e.addedFeatures.length&&!e.updatedFeatures.length&&!e.deletedFeatures.length)return;for(const e of this._pendingTiles.values())e.reset();const t={...e,deletedFeatures:e.deletedFeatures.map(({objectId:e,globalId:t})=>e&&-1!==e?e:this._lookupObjectIdByGlobalId(t))},r=i.createTask(async e=>{try{await this.store.processEdits(t,(e,t)=>this._queryFeaturesById(e,t),e),this._processPendingTiles()}catch(e){o.throwIfAbortError(e),n.getLogger(this).warn("Failed to apply edits",e)}});this.addHandles(r),await this._updatingHandles.addPromise(r.promise)}setHistoricMoment(e){e?.getTime()!==this._historicMoment?.getTime()&&(this._historicMoment=e,this.refresh())}_initializeFetchExtent(){if(!this.capabilities.query.supportsExtent||!g.isHostedAgolService(this.url))return;const e=i.createTask(async e=>{try{const t=await b.executeQueryForExtent(this.url,new S({where:"1=1",outSpatialReference:this.spatialReference,cacheHint:this.capabilities.query.supportsCacheHint??void 0}),{query:this._configuration.customParameters,signal:e});this.store.extent=f.fromJSON(t.data?.extent)}catch(e){o.throwIfAbortError(e),n.getLogger(this).warn("Failed to fetch data extent",e)}});this._updatingHandles.addPromise(e.promise.then(()=>this._process())),this.addHandles(e)}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map(e=>e.debugInfo),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const e of this._pendingTiles.values())e.alive=!1}_createPendingTiles(){if(this.suspended)return;const e=this._collectMissingTilesInfo();if(this._setAvailability(null==e?1:e.coveredArea/e.fullArea),null!=e)for(const{data:t,resolution:r}of e.missingTiles){const e=this._pendingTiles.get(t.id);e?(e.resolution=r,e.alive=!0):this._createPendingTile(t,r)}}_collectMissingTilesInfo(){let e=null;for(const t of this.tilesOfInterest){const r=this.store.process(t,(e,t)=>this._verifyTileComplexity(e,t),this.outFields);null==e?e=r:e.prepend(r)}return e}_deletePendingTiles(){for(const e of this._pendingTiles.values())e.alive||this._deletePendingTile(e)}_processPendingTiles(){const e={fetchCount:(e,t)=>this._fetchCount(e,t),fetchFeatures:(e,t,r)=>this._fetchFeatures(e,t,r),finish:(e,t)=>this._finishPendingTile(e,t),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(e))for(const t of this._pendingTiles.values())this._verifyTileComplexity(this.store.getFeatureCount(t.data),t.resolution)&&this._updatingHandles.addPromise(t.process(e))}_verifyTileComplexity(e,t){return this._verifyVertexComplexity(e)&&this._verifyFeatureDensity(e,t)}_verifyVertexComplexity(e){return e*this._minimumVerticesPerFeature<F}_verifyFeatureDensity(e,t){if(null==this.tileInfo)return!1;const r=this.tileSize*t;return e*(I/(r*r))<M}_ensureFetchAllCounts(e){let t=!0;for(const r of this._pendingTiles.values())r.state.type<2&&this._updatingHandles.addPromise(r.process(e)),r.state.type<=1&&(t=!1);return t}_finishPendingTile(e,t){this.store.add(e.data,t),this._deletePendingTile(e),this._updateAvailability()}_updateAvailability(){const e=this._collectMissingTilesInfo();this._setAvailability(null==e?1:e.coveredArea/e.fullArea)}_setAvailability(e){this._set("availability",e)}_createPendingTile(e,t){const r=new v.PendingFeatureTile(e,t);return this._pendingTiles.set(e.id,r),r}_deletePendingTile(e){e.reset(),this._pendingTiles.delete(e.data.id)}async _fetchCount(e,t){return this.store.fetchCount(e.data,this.url,this._createCountQuery(e),{query:this.customParameters,timeout:T,signal:t})}async _fetchFeatures(e,t,r){let s=0;const i=[];let n=0,o=t;for(;;){const a=this._createFeaturesQuery(e),l=this._setPagingParameters(a,s,o),{features:u,exceededTransferLimit:c}=await this._queryFeatures(a,r);l&&(s+=a.num),n+=u.length;for(const e of u)i.push(e);if(o=t-n,!l||!c||o<=0)return i}}_filterProperties(e){return null==e?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:e.where||"1=1",timeExtent:e.timeExtent,gdbVersion:e.gdbVersion}}_lookupObjectIdByGlobalId(e){const t=this.globalIdField,r=this.objectIdField;if(null==t)throw new Error("Expected globalIdField to be defined");let s=null;const i=e?u.normalizeGlobalID(e):e;if(this.store.featureStore.forEach(e=>{i===u.normalizeGlobalID(e.attributes[t])&&(s=e.objectId??e.attributes[r])}),null==s)throw new Error(`Expected to find a feature with globalId ${e}`);return s}_queryFeaturesById(e,t){const r=this._createFeaturesQuery();return r.objectIds=e,this._queryFeatures(r,t)}_queryFeatures(e,t){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(e,t):this._queryFeaturesJSON(e,t)}async _queryFeaturesPBF(e,t){const{sourceSpatialReference:r}=this,{data:s}=await b.executeQueryPBF(this.url,e,new _.OptimizedFeatureSetParserContext({sourceSpatialReference:r}),{query:this._configuration.customParameters,timeout:T,signal:t});return y.unquantizeOptimizedFeatureSet(s)}async _queryFeaturesJSON(e,t){const{sourceSpatialReference:r}=this,{data:s}=await b.executeQuery(this.url,e,r,{query:this._configuration.customParameters,timeout:T,signal:t});return y.convertFromFeatureSet(s,{type:"object-id",fieldName:this.objectIdField})}_createCountQuery(e){const t=this._createBaseQuery(e);return this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t}_createFeaturesQuery(e=null){const t=this._createBaseQuery(e),r=null!=e?.data?this.store.getAttributesForTile(e?.data?.id):null,s=l.union(l.difference(this.outFields,r??new Set),this._mandatoryOutFields);return t.outFields=Array.from(s),t.returnGeometry=!0,null!=e&&(this.capabilities.query.supportsResultType?t.resultType="tile":this.capabilities.query.supportsCacheHint&&(t.cacheHint=!0)),t}_createBaseQuery(e){const t=new S({returnZ:this.hasZ,returnM:!1,historicMoment:this._historicMoment,geometry:null!=this.tileInfo&&null!=e?m.toExtent(e.data.extent,this.tileInfo.spatialReference):void 0}),r=this._configuration.filter;return null!=r&&(t.where=r.where,t.gdbVersion=r.gdbVersion,t.timeExtent=r.timeExtent),t.outSpatialReference=this.spatialReference,t}_setPagingParameters(e,t,r){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:s,supportsCacheHint:i,tileMaxRecordCount:n,maxRecordCount:o,supportsResultType:a}=this.capabilities.query,l=s?S.MAX_MAX_RECORD_COUNT_FACTOR:1,u=l*((a||i)&&n?n:o||x);return e.start=t,s?(e.maxRecordCountFactor=Math.min(l,Math.ceil(r/u)),e.num=Math.min(r,e.maxRecordCountFactor*u)):e.num=Math.min(r,u),!0}},t.__decorate([c.property({constructOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"url",void 0),t.__decorate([c.property({constructOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"objectIdField",void 0),t.__decorate([c.property({constructOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"globalIdField",void 0),t.__decorate([c.property({constructOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"capabilities",void 0),t.__decorate([c.property({constructOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"sourceSpatialReference",void 0),t.__decorate([c.property({constructOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"spatialReference",void 0),t.__decorate([c.property({constructOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"store",void 0),t.__decorate([c.property({readOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"_minimumVerticesPerFeature",null),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"_mandatoryOutFields",null),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"outFields",null),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"suspended",void 0),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"_historicMoment",void 0),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"filter",null),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"customParameters",null),t.__decorate([c.property({readOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"_configuration",null),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"tileInfo",null),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"tileSize",null),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"tilesOfInterest",void 0),t.__decorate([c.property({readOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"updating",null),t.__decorate([c.property({readOnly:!0})],e.FeatureServiceTiledFetcher.prototype,"availability",void 0),t.__decorate([c.property()],e.FeatureServiceTiledFetcher.prototype,"hasZ",null),e.FeatureServiceTiledFetcher=t.__decorate([h.subclass("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],e.FeatureServiceTiledFetcher);const x=2e3,T=6e5,F=1e6,I=25,M=1;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/asyncUtils":function(){define(["exports","../chunks/tslib.es6","./Accessor","./maybe","./promiseUtils","./accessorSupport/decorators/property","./accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o){"use strict";function a(e){return{ok:!0,value:e}}function l(e){return{ok:!1,error:e}}function u(e){return null!=e&&!0===e.ok?e.value:null}function c(e){return null!=e&&!1===e.ok?e.error:null}let d=class extends r{get value(){return u(this._result)}get error(){return c(this._result)}get finished(){return null!=this._result}constructor(e,t){super({}),this._result=null,this._abortHandle=null,this.abort=()=>{this._abortController=s.abortMaybe(this._abortController)},this.remove=this.abort,this._abortController=new AbortController;const{signal:r}=this._abortController;this.promise=e(r),this.promise.then(e=>{this._result=a(e),this._cleanup()},e=>{this._result=l(e),this._cleanup()}),this._abortHandle=i.onAbort(t,this.abort)}normalizeCtorArgs(){return{}}destroy(){this.abort()}_cleanup(){this._abortHandle=s.removeMaybe(this._abortHandle),this._abortController=null}};t.__decorate([n.property()],d.prototype,"value",null),t.__decorate([n.property()],d.prototype,"error",null),t.__decorate([n.property()],d.prototype,"finished",null),t.__decorate([n.property()],d.prototype,"promise",void 0),t.__decorate([n.property()],d.prototype,"_result",void 0),d=t.__decorate([o.subclass("esri.core.asyncUtils.ReactiveTask")],d),e.assertResult=function(e){if(!0===e.ok)return e.value;throw e.error},e.createTask=function(e,t){return new d(e,t)},e.forEach=function(e,t,r){return i.eachAlways(e.map((e,s)=>t.apply(r,[e,s])))},e.makeResultError=l,e.makeResultOk=a,e.map=async function(e,t,r){return(await i.eachAlways(e.map((e,s)=>t.apply(r,[e,s])))).map(e=>e.value)},e.result=async function(e){if(null==e)return{ok:!1,error:new Error("no promise provided")};try{return a(await e)}catch(e){return l(e)}},e.resultError=c,e.resultOrAbort=async function(e){try{return a(await e)}catch(e){return i.throwIfAbortError(e),l(e)}},e.resultValue=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/uuid":function(){define(["exports"],function(e){"use strict";const t="randomUUID"in crypto;function r(){if(t)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const r=t=>e[t].toString(16).padStart(4,"0");return r(0)+r(1)+"-"+r(2)+"-"+r(3)+"-"+r(4)+"-"+r(5)+r(6)+r(7)}e.generateBracedUUID=function(){return`{${r().toUpperCase()}}`},e.generateLowercaseBracedUUID=function(){return`{${r()}}`},e.generateUUID=r,e.normalizeGlobalID=function(e){const t=e.toUpperCase();return e.startsWith("{")?t:`{${t}}`},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfOptimizedFeatureSet":function(){define(["exports","../../../core/unitUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/graphics/OptimizedFeature","../../../layers/graphics/OptimizedFeatureSet","../../../layers/graphics/OptimizedGeometry"],function(e,t,r,s,i,n){"use strict";const o=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];e.OptimizedFeatureSetParserContext=class{constructor(e){this._options=e,this.geometryTypes=o,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new i}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||r.equals(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const i=t.getMetersPerVerticalUnitForSR(this._options.sourceSpatialReference)/t.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==i)for(const t of e.features){if(!s.hasGeometry(t))continue;const e=t.geometry.coords;for(let t=2;t<e.length;t+=3)e[t]*=i}}addFeature(e,t){e.features.push(t)}createFeature(){return new s.OptimizedFeature(null,{},null,0)}createSpatialReference(){return{wkid:0}}createGeometry(){return new n}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((e,t)=>e+t,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new n}},e.optimizedGeometryTypes=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/query":function(){define(["exports","../../../request","../../../core/urlUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","../../operations/urlUtils","./pbfQueryUtils","./queryZScale"],function(e,t,r,s,i,n,o,a,l){"use strict";const u="Layer does not support extent calculation.";function c(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function d(e,t,r){const i=e.geometry,o=e.toJSON();delete o.compactGeometryEnabled,delete o.defaultSpatialReferenceEnabled;const a=o;let l,u,d;if(i&&(u=i.spatialReference,d=n.srToRESTValue(u),a.geometryType=s.getJsonType(i),a.geometry=c(i,e.compactGeometryEnabled),a.inSR=d),o.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=o.groupByFieldsForStatistics.join(",")),o.objectIds)switch(r?.uniqueIdFields?.length){case void 0:a.objectIds=o.objectIds.join(",");break;case 1:a.uniqueIds=JSON.stringify(o.objectIds),delete a.objectIds;break;default:a.uniqueIds=JSON.stringify(o.objectIds.map(e=>JSON.parse(e))),delete a.objectIds}if(o.orderByFields&&(a.orderByFields=o.orderByFields.join(",")),!o.outFields||!o.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete a.outFields:o.outFields.includes("*")?a.outFields="*":a.outFields=o.outFields.join(","),o.outSR?(a.outSR=n.srToRESTValue(o.outSR),l=e.outSpatialReference):i&&(o.returnGeometry||o.returnCentroid)&&(a.outSR=a.inSR,l=u),o.returnGeometry&&delete o.returnGeometry,o.outStatistics&&(a.outStatistics=JSON.stringify(o.outStatistics)),o.fullText&&(a.fullText=JSON.stringify(o.fullText)),o.pixelSize&&(a.pixelSize=JSON.stringify(o.pixelSize)),o.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=u&&null!=e.quantizationParameters?.extent&&u.equals(e.quantizationParameters.extent.spatialReference)&&delete o.quantizationParameters.extent.spatialReference,a.quantizationParameters=JSON.stringify(o.quantizationParameters)),o.parameterValues&&(a.parameterValues=JSON.stringify(o.parameterValues)),o.rangeValues&&(a.rangeValues=JSON.stringify(o.rangeValues)),o.dynamicDataSource&&(a.layer=JSON.stringify({source:o.dynamicDataSource}),delete o.dynamicDataSource),o.timeExtent){const e=o.timeExtent,{start:t,end:r}=e;null==t&&null==r||(a.time=t===r?t:`${t??"null"},${r??"null"}`),delete o.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=u&&null!=l&&u.equals(l)&&(a.defaultSR=a.inSR,delete a.inSR,delete a.outSR),a}function h(e,t,r,s){return f(e,t,"pbf",r,void 0,s)}function p(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;const r={...e,returnUniqueIdsOnly:!0};return delete r.returnIdsOnly,r}async function f(e,s,n,a={},l={},u={}){const c="string"==typeof e?r.urlToObject(e):e,h=s.geometry?[s.geometry]:[],f=await i.normalizeCentralMeridian(h,null,{signal:a.signal}),m=f?.[0];null!=m&&((s=s.clone()).geometry=m);const y=o.mapParameters({...c.query,f:n,...p(l,u),...d(s,l,u)});return t(r.join(c.path,function(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}(s,l)?"query3d":"query"),{...a,responseType:"pbf"===n?"array-buffer":"json",query:{...y,...a.query}})}e.encodeGeometry=c,e.executeQuery=async function(e,t,r,s,i){const n=t.timeExtent?.isEmpty?{data:{features:[]}}:await f(e,t,"json",s,void 0,i);return l.applyFeatureSetZUnitScaling(t,r,n.data),n},e.executeQueryForCount=function(e,t,r,s){return t.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):f(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0},s)},e.executeQueryForExtent=async function(e,t,r){if(t.timeExtent?.isEmpty)return{data:{count:0,extent:null}};const s=await f(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),i=s.data;if(i.hasOwnProperty("extent"))return s;if(i.features)throw new Error(u);if(i.hasOwnProperty("count"))throw new Error(u);return s},e.executeQueryForIds=function(e,t,r,s){return t.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):f(e,t,"json",r,{returnIdsOnly:!0},s)},e.executeQueryPBF=async function(e,t,r,s,i){if(t.timeExtent?.isEmpty)return{data:r.createFeatureResult()};const n=await h(e,t,s,i),o=n;return o.data=a.parsePBFFeatureQuery(n.data,r),o},e.executeQueryPBFBuffer=h,e.queryToQueryStringParameters=d,e.runQuery=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/urlUtils":function(){define(["exports"],function(e){"use strict";e.mapParameters=function e(t){const r={};for(const s in t){if("declaredClass"===s)continue;const i=t[s];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){r[s]=[];for(let t=0;t<i.length;t++)r[s][t]=e(i[t])}else"object"==typeof i?i.toJSON&&(r[s]=JSON.stringify(i)):r[s]=i}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfQueryUtils":function(){define(["exports","./pbfFeatureServiceParser"],function(e,t){"use strict";e.parsePBFFeatureQuery=function(e,r){const s=t.parseFeatureQuery(e,r),i=s.queryResult.featureResult,n=s.queryResult.queryGeometry,o=s.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const e=i.objectIdFieldName;for(const t of i.features)t.attributes&&(t.objectId=t.attributes[e])}return i&&(i.queryGeometry=n,i.queryGeometryType=o),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfFeatureServiceParser":function(){define(["exports","../../../core/Error","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],function(e,t,r,s,i){"use strict";const n=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],o=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],a=["upperLeft","lowerLeft"];function l(e){return e>=n.length?null:n[e]}function u(e){return e>=o.length?null:o[e]}function c(e){return e>=a.length?null:a[e]}function d(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function h(e,t,r){const s=e.asUnsafe(),i=t.createPointGeometry(r);for(;s.next();)switch(s.tag()){case 3:{const e=s.getUInt32(),r=s.pos()+e;let n=0;for(;s.pos()<r;)t.addCoordinatePoint(i,s.getSInt64(),n++);break}default:s.skip()}return i}function p(e,t,r){const s=e.asUnsafe(),i=t.createGeometry(r),n=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;s.next();)switch(s.tag()){case 2:{const e=s.getUInt32(),r=s.pos()+e;let n=0;for(;s.pos()<r;)t.addLength(i,s.getUInt32(),n++);break}case 3:{const e=s.getUInt32(),r=s.pos()+e;let o=0;for(t.allocateCoordinates(i);s.pos()<r;)t.addCoordinate(i,s.getSInt64(),o),o++,o===n&&(o=0);break}default:s.skip()}return i}function f(e){const t=e.asUnsafe(),r=new s;let n="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),s=t.pos()+e;for(;t.pos()<s;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),s=t.pos()+e;for(;t.pos()<s;)r.coords.push(t.getSInt64());break}case 1:n=i.optimizedGeometryTypes[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:n}}function m(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function y(e){const t=e.asUnsafe(),r={type:l(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=l(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=u(t.getEnum());break;case 5:default:t.skip();break;case 6:r.defaultValue=t.getString()}return r}function g(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function _(e,t,r,s){const i=t.createFeature(r);let n=0;for(;e.next();)switch(e.tag()){case 1:{const t=s[n++].name;i.attributes[t]=e.processMessage(m);break}case 2:i.geometry=e.processMessageWithArgs(p,t,r);break;case 4:i.centroid=e.processMessageWithArgs(h,t,r);break;default:e.skip()}return i}function b(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function v(e){const t={originPosition:c(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=c(r.getEnum());break;case 2:t.scale=r.processMessage(b);break;case 3:t.translate=r.processMessage(S);break;default:r.skip()}return t}function x(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function T(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function F(e,t){const r=t.createFeatureResult(),s=e.asUnsafe();r.geometryType=d(t,0);let i=!1;for(;s.next();)switch(s.tag()){case 1:r.objectIdFieldName=s.getString();break;case 3:r.globalIdFieldName=s.getString();break;case 4:r.geohashFieldName=s.getString();break;case 5:r.geometryProperties=s.processMessage(x);break;case 7:r.geometryType=d(t,s.getEnum());break;case 8:r.spatialReference=s.processMessageWithArgs(T,t);break;case 10:r.hasZ=s.getBool();break;case 11:r.hasM=s.getBool();break;case 12:r.transform=s.processMessage(v);break;case 9:r.exceededTransferLimit=s.getBool();break;case 13:t.addField(r,s.processMessage(y));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,s.processMessageWithArgs(_,t,r,r.fields));break;case 2:r.uniqueIdField=s.processMessage(g);break;default:s.skip()}return t.finishFeatureResult(r),r}function I(e,t){const r={};let s=null;for(;e.next();)switch(e.tag()){case 4:s=e.processMessageWithArgs(f);break;case 1:r.featureResult=e.processMessageWithArgs(F,t);break;default:e.skip()}return null!=s&&r.featureResult&&t.addQueryGeometry(r,s),r}e.parseFeatureQuery=function(e,s){try{const t=2,i=new r(new Uint8Array(e),new DataView(e)),n={};for(;i.next();)i.tag()===t?n.queryResult=i.processMessageWithArgs(I,s):i.skip();return n}catch(e){throw new t("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}},e.parseField=y,e.parseFieldType=l,e.parseTransform=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/queryZScale":function(){define(["exports","../../../geometry/support/zscale"],function(e,t){"use strict";e.applyFeatureSetZUnitScaling=function(e,r,s){if(!s?.features||!s.hasZ)return;const i=t.getGeometryZScaler(s.geometryType,r,e.outSpatialReference);if(null!=i)for(const e of s.features)i(e.geometry)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/featureSources/featureServiceSource/PendingFeatureTile":function(){define(["exports","../../../../../core/asyncUtils","../../../../../geometry/support/aaBoundingRect"],function(e,t,r){"use strict";const s=r.create();e.PendingFeatureTile=class{constructor(e,t){this.data=e,this.resolution=t,this.state={type:0},this.alive=!0}process(e){switch(this.state.type){case 0:return this.state=this._gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case 1:case 3:break;case 2:return this.state=this._gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case 4:this.state=this._goToDone(this.state,e)}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case 0:case 1:return 0;case 2:return this.state.featureCount;case 3:return this.state.previous.featureCount;case 4:return this.state.features.length;case 5:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case 0:return"created";case 1:return"fetch-count";case 2:return"fetched-count";case 3:return"fetch-features";case 4:return"fetched-features";case 5:return"done"}}_gotoFetchCount(e,r){return{type:1,previous:e,task:t.createTask(async e=>{const s=await t.resultOrAbort(r.fetchCount(this,e));1===this.state.type&&(this.state=function(e,t){return{type:2,featureCount:t,previous:e}}(this.state,s.ok?s.value:1/0))})}}_gotoFetchFeatures(e,r){return{type:3,previous:e,task:t.createTask(async s=>{const i=await t.resultOrAbort(r.fetchFeatures(this,e.featureCount,s));3===this.state.type&&(this.state=function(e,t){return{type:4,previous:e,features:t}}(this.state,i.ok?i.value:[]))})}}_goToDone(e,t){return t.finish(this,e.features),{type:5,previous:e}}reset(){const e=this.state;switch(this.state={type:0},e.type){case 0:case 2:case 4:case 5:break;case 1:case 3:e.task.abort()}}intersects(e){return null==e||!this.data.extent||(r.fromExtent(e,s),r.intersects(this.data.extent,s))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTileStore":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/has","../../../../../core/SetUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/support/aaBoundingRect","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/data/BoundsStore","../../../../../layers/support/TileKey","../../../../../rest/query/operations/query","./FeatureServiceTileCache"],function(e,t,r,s,i,n,o,a,l,u,c,d,h,p,f){"use strict";e.FeatureServiceTileStore=class extends r{setPriorityOrderByKey(e){this._tiles.setPriorityOrderByKey(e)}get _memoryLimitExceeded(){return this.featureStore.usedMemory>=this.maximumByteSize}constructor(e){super(e),this.tileInfo=null,this.extent=null,this.maximumByteSize=10485760,this._tileBounds=new d.BoundsStore,this._tiles=new f.FeatureServiceTileCache,this._refCounts=new Map,this._tileFeatureCounts=new Map,this._tmpBoundingRect=u.create()}add(e,t){for(const e of t)this._referenceFeature(e.objectId);const r=this.featureStore.upsertMany(t),s=r.map(e=>new Set(Object.keys(e.attributes))).reduce((e,t)=>i.intersection(e,t),new Set(Object.keys(r[0]?.attributes??[]))),n=this._memoryLimitExceeded;this._addTileStorage(e,new Set(r.map(e=>e.objectId)),s),n&&this._applyCacheMemoryLimits()}_applyCacheMemoryLimits(){if(!this._memoryLimitExceeded)return;const{_tiles:e,featureStore:t,maximumByteSize:r}=this;e.someFromLowestToHighestPriority(e=>!this._memoryLimitExceeded||t.usedMemory-this._estimateRemoveTileMemoryReduction(e)<r||(this._removeTileStorage(e),!1))}_estimateRemoveTileMemoryReduction(e){let t=0;for(const r of e.objectIds)if(1===this._refCounts.get(r)){const e=this.featureStore.getFeature(r);e&&(t+=this.featureStore.estimateFeatureUsedMemory?.(e)??0)}return t}getAttributesForTile(e){return e?this._tiles.get(e)?.attributeKeys:null}destroy(){this.clear(),this._tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this._tileBounds.clear(),this._tiles.clear(),this._refCounts.clear()}refresh(){this.clear(),this._tileFeatureCounts.clear()}processEdits(e,t,r){return this._processEditsDelete(e.deletedFeatures.concat(e.updatedFeatures)),this._processEditsRefetch(e.addedFeatures.concat(e.updatedFeatures),t,r)}_addTileStorage(e,t,r){const s=e.id;this._tiles.set(s,new m(e,t,r)),this._tileBounds.set(s,e.extent),this._tileFeatureCounts.set(s,t.size)}_remove({id:e}){const t=this._tiles.get(e);t&&this._removeTileStorage(t)}_removeTileStorage(e){const t=[];for(const r of e.objectIds)1===this._unreferenceFeature(r)&&t.push(r);this.featureStore.removeManyById(t);const r=e.data.id;this._tiles.delete(r),this._tileBounds.delete(r)}_processEditsDelete(e){this.featureStore.removeManyById(e);for(const t of this._tiles.values()){for(const r of e)t.objectIds.delete(r);this._tileFeatureCounts.set(t.data.id,t.objectIds.size)}for(const t of e)this._refCounts.delete(t)}async _processEditsRefetch(e,t,r){if(!e.length)return;const s=(await t(e,r)).features,{hasZ:i,hasM:n}=this.featureStore;for(const e of s){const t=c.getBoundsOptimizedGeometry(this._tmpBoundingRect,e.geometry,i,n);null!=t&&this._tileBounds.forEachInBounds(t,t=>{const r=this._tiles.get(t);this.featureStore.add(e);const s=e.objectId;r.objectIds.has(s)||(r.objectIds.add(s),this._referenceFeature(s),this._tileFeatureCounts.set(r.data.id,r.objectIds.size))})}}process(e,t=()=>!0,r){if(null==this.tileInfo||!e.extent||null!=this.extent&&!u.intersects(u.fromExtent(this.extent,this._tmpBoundingRect),e.extent))return new g(e);if(this._memoryLimitExceeded&&!this._tiles.hasLowerPriority(e.id??""))return new g(e);const s=this.getAttributesForTile(e.id);if(i.isSubsetOf(r,s))return new g(e);const n=this._createTileTree(e,this.tileInfo);return this._simplify(n,t,null,0,1),this._collectMissingTiles(e,n,this.tileInfo,r)}get debugInfo(){return Array.from(this._tiles.values()).map(({data:e})=>({data:e,featureCount:this._tileFeatureCounts.get(e.id)||0}))}getFeatureCount(e){return this._tileFeatureCounts.get(e.id)??0}async fetchCount(e,t,r,s){const i=this._tileFeatureCounts.get(e.id);if(null!=i)return i;const n=await p.executeQueryForCount(t,r,s);return this._tileFeatureCounts.set(e.id,n.data.count),n.data.count}_createTileTree(e,t){const r=new y(e.level,e.row,e.col);return t.updateTileInfo(r,1),this._tileBounds.forEachInBounds(e.extent,s=>{const i=this._tiles.get(s)?.data;i&&function(e,t){if(!e||!t)return!1;if(e.level===t.level)return e.row===t.row&&e.col===t.col;const r=e.level<t.level,s=r?e:t,i=r?t:e,n=1<<i.level-s.level;return Math.floor(i.row/n)===s.row&&Math.floor(i.col/n)===s.col}(e,i)&&this._populateChildren(r,i,t,this._tileFeatureCounts.get(i.id)||0)}),r}_populateChildren(e,t,r,s){const i=t.level-e.level-1;if(i<0)return void(e.isLeaf=!0);const n=t.row>>i,o=t.col>>i,a=e.row<<1,l=o-(e.col<<1)+(n-a<<1),u=e.children[l];if(null!=u)this._populateChildren(u,t,r,s);else{const i=new y(e.level+1,n,o);r.updateTileInfo(i,1),e.children[l]=i,this._populateChildren(i,t,r,s)}}_simplify(e,t,r,s,i){const n=i*i;if(e.isLeaf)return t(this.getFeatureCount(e),i)?0:(this._remove(e),null!=r&&(r.children[s]=null),n);const o=i/2,a=o*o;let l=0;for(let r=0;r<e.children.length;r++){const s=e.children[r];l+=null!=s?this._simplify(s,t,e,r,o):a}return 0===l?this._mergeChildren(e):1-l/n<b&&(this._purge(e),null!=r&&(r.children[s]=null),l=n),l}_mergeChildren(e){const t=new Set;let r;this._forEachLeaf(e,e=>{const s=this._tiles.get(e.id);if(s){r=r?i.intersection(r,s.attributeKeys):new Set(s.attributeKeys);for(const e of s.objectIds)t.has(e)||(t.add(e),this._referenceFeature(e));this._remove(e)}}),this._addTileStorage(e,t,r??new Set),e.isLeaf=!0,e.children[0]=e.children[1]=e.children[2]=e.children[3]=null,this._tileFeatureCounts.set(e.id,t.size)}_forEachLeaf(e,t){for(const r of e.children)null!=r&&(r.isLeaf?t(r):this._forEachLeaf(r,t))}_purge(e){if(null!=e)if(e.isLeaf)this._remove(e);else for(let t=0;t<e.children.length;t++){const r=e.children[t];this._purge(r),e.children[t]=null}}_collectMissingTiles(e,t,r,s){const i=new _(r,e,this.extent);return this._collectMissingTilesRecurse(t,i,1,s),i.info}_collectMissingTilesRecurse(e,t,r,s){const n=this.getAttributesForTile(e.id),o=n&&!i.isSubsetOf(s,n);if(o&&t.addMissing(e.level,e.row,e.col,r),e.isLeaf)return;if(!e.hasChildren)return void(o||t.addMissing(e.level,e.row,e.col,r));const a=r/2;for(let r=0;r<e.children.length;r++){const i=e.children[r];null==i?t.addMissing(e.level+1,(e.row<<1)+((2&r)>>1),(e.col<<1)+(1&r),a):this._collectMissingTilesRecurse(i,t,a,s)}}_referenceFeature(e){const t=(this._refCounts.get(e)||0)+1;return this._refCounts.set(e,t),1===t?0:2}_unreferenceFeature(e){const t=(this._refCounts.get(e)||0)-1;return 0===t?(this._refCounts.delete(e),1):(t>0&&this._refCounts.set(e,t),2)}get test(){}},t.__decorate([n.property({constructOnly:!0})],e.FeatureServiceTileStore.prototype,"featureStore",void 0),t.__decorate([n.property()],e.FeatureServiceTileStore.prototype,"tileInfo",void 0),t.__decorate([n.property()],e.FeatureServiceTileStore.prototype,"extent",void 0),t.__decorate([n.property()],e.FeatureServiceTileStore.prototype,"maximumByteSize",void 0),e.FeatureServiceTileStore=t.__decorate([l.subclass("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],e.FeatureServiceTileStore);class m{constructor(e,t,r){this.data=e,this.objectIds=t,this.attributeKeys=r}}class y{constructor(e,t,r){this.level=e,this.row=t,this.col=r,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&(null!=this.children[0]||null!=this.children[1]||null!=this.children[2]||null!=this.children[3])}}class g{constructor(e,t=[]){this.missingTiles=t,this.fullArea=0,this.coveredArea=0,this.fullArea=u.area(e.extent),this.coveredArea=this.fullArea}prepend(e){this.missingTiles=e.missingTiles.concat(this.missingTiles),this.coveredArea+=e.coveredArea,this.fullArea+=e.fullArea}}class _{constructor(e,t,r){this._tileInfo=e,this._extent=null,this.info=new g(t),null!=r&&(this._extent=u.fromExtent(r))}addMissing(e,t,r,s){const i=new h.TileKey(null,e,t,r);this._tileInfo.updateTileInfo(i,1),null==i.extent||null!=this._extent&&!u.intersects(this._extent,i.extent)||(this.info.missingTiles.push({data:i,resolution:s}),this.info.coveredArea-=u.area(i.extent))}}const b=.18751;e.ProcessResult=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/interactive/snapping/featureSources/featureServiceSource/FeatureServiceTileCache":function(){define(["exports"],function(e){"use strict";class t{constructor(){this._store=new Map,this._priorities=new Map}get size(){return this._store.size}setPriorityOrderByKey(e){this._priorities.clear();for(let t=e.length-1;t>=0;t--)this._priorities.set(e[t],e.length-t)}hasLowerPriority(e){const t=this._priorities.get(e);if(null==t)return!0;for(const[e]of this._store){const r=this._priorities.get(e);if(null==r||r<t)return!0}return!1}someFromLowestToHighestPriority(e){const{_priorities:t}=this;for(const[r,s]of this._store)if(!t.has(r)&&e(s,r))return!0;for(const[r]of t){const t=this._store.get(r);if(t&&e(t,r))return!0}return!1}set(e,t){this._store.set(e,t)}delete(e){return this._store.delete(e)}get(e){return this._store.get(e)}has(e){return this._store.has(e)}clear(){this._store.clear()}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}}e.FeatureServiceTileCache=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["../../../../../chunks/tslib.es6","../../../../../core/Evented","../../../../../core/promiseUtils","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../core/support/UpdatingHandles","../../../../../geometry/SpatialReference","../../../../../geometry/support/jsonUtils","../../../../../layers/graphics/data/executeQueryForSnapping","../../../../../layers/graphics/data/FeatureStore","../../../../../layers/graphics/data/QueryEngine","../../../../../layers/support/TileInfo","../../../../../rest/support/Query","../../../../../symbols/support/ElevationInfo","../snappingCandidateElevationAlignment","../snappingCandidateElevationFilter","../symbologySnappingCandidates","./FeatureServiceTiledFetcher","./FeatureServiceTileStore"],function(e,t,r,s,i,n,o,a,l,u,c,d,h,p,f,m,y,g,_,b,S,v,x){"use strict";let T=class extends t.EventedAccessor{constructor(){super(...arguments),this._isInitializing=!0,this.remoteClient=null,this._whenSetup=r.createResolver(),this._elevationAligner=_.getSnappingCandidateElevationAligner(),this._elevationFilter=b.getSnappingCandidateElevationFilter(),this._symbologyCandidatesFetcher=S.getSymbologySnappingCandidatesFetcher(),this._updatingHandles=new u.UpdatingHandles,this._alignPointsInFeatures=async(e,t)=>{const s={query:e},i=await this.remoteClient.invoke("alignElevation",s,{signal:t});return r.throwIfAborted(t),i},this._getSymbologyCandidates=async(e,t)=>{const s={candidates:e,spatialReference:this._spatialReference.toJSON()},i=await this.remoteClient.invoke("getSymbologyCandidates",s,{signal:t});return r.throwIfAborted(t),i}}get updating(){return this._isInitializing||this._updatingHandles.updating||this._featureFetcher.updating}destroy(){this._featureFetcher?.destroy(),this._queryEngine?.destroy(),this._featureStore?.clear()}async setup(e){if(this.destroyed)return{result:{}};const{geometryType:t,objectIdField:r,timeInfo:i,fieldsIndex:n}=e.serviceInfo,{hasZ:o}=e,a=c.fromJSON(e.spatialReference);this._spatialReference=a,this._featureStore=new p({...e.serviceInfo,hasZ:o,hasM:!1}),this._featureStore.estimateFeatureUsedMemory=e=>e.usedMemory,this._queryEngine=new f.QueryEngine({spatialReference:e.spatialReference,featureStore:this._featureStore,geometryType:t,fieldsIndex:n,hasZ:o,hasM:!1,featureIdInfo:{type:"object-id",fieldName:r},timeInfo:i}),this._featureFetcher=new v.FeatureServiceTiledFetcher({store:new x.FeatureServiceTileStore({featureStore:this._featureStore}),url:e.serviceInfo.url,objectIdField:e.serviceInfo.objectIdField,globalIdField:e.serviceInfo.globalIdField,capabilities:e.serviceInfo.capabilities,spatialReference:a,sourceSpatialReference:c.fromJSON(e.serviceInfo.spatialReference),customParameters:e.configuration.customParameters});const l="3d"===e.configuration.viewType;return this._elevationAligner=_.getSnappingCandidateElevationAligner(l,{elevationInfo:null!=e.elevationInfo?g.fromJSON(e.elevationInfo):null,alignPointsInFeatures:this._alignPointsInFeatures}),this._elevationFilter=b.getSnappingCandidateElevationFilter(l),this.addHandles([s.watch(()=>this._featureFetcher.availability,e=>this.emit("notify-availability",{availability:e}),s.sync),s.watch(()=>this.updating,()=>this._notifyUpdating())]),this._whenSetup.resolve(),this._isInitializing=!1,this.configure(e.configuration)}async configure(e){return await this._updatingHandles.addPromise(this._whenSetup.promise),this._updateFeatureFetcherConfiguration(e),F}async setSuspended(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),r.throwIfAborted(t),this._featureFetcher.suspended=e,F}async updateOutFields(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),r.throwIfAborted(t),this._featureFetcher.outFields=new Set(e??[]),F}async fetchCandidates(e,t){await this._whenSetup.promise,r.throwIfAborted(t);const s=function(e,t){const r=!!t||void 0;if(!e.filter)return{...e,query:{where:"1=1",returnZ:r}};const{distance:s,units:i,spatialRel:n,where:o,timeExtent:a,objectIds:l}=e.filter,u={geometry:e.filter.geometry?d.fromJSON(e.filter.geometry):void 0,distance:s,units:i,spatialRel:n,timeExtent:a,objectIds:l,returnZ:r,where:o??"1=1"};return{...e,query:u}}(e,this._featureStore.hasZ),i=t?.signal,n=await h.executeQueryForSnapping(this._queryEngine,s,i);r.throwIfAborted(i);const o=await this._elevationAligner.alignCandidates(n.candidates,c.fromJSON(e.point.spatialReference)??c.WGS84,i);r.throwIfAborted(i);const a=await this._symbologyCandidatesFetcher.fetch(o,i);r.throwIfAborted(i);const l=0===a.length?o:o.concat(a);return{result:{candidates:this._elevationFilter.filter(s,l)}}}async updateTiles(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),r.throwIfAborted(t),this._featureFetcher.tileSize=e.tileSize,this._featureFetcher.tilesOfInterest=e.tiles,this._featureFetcher.tileInfo=null!=e.tileInfo?m.fromJSON(e.tileInfo):null,F}async refresh(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),r.throwIfAborted(t),this._featureFetcher.refresh(),F}async whenNotUpdating(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),r.throwIfAborted(t),await s.whenOnce(()=>!this.updating,t),r.throwIfAborted(t),F}async getDebugInfo(e,t){return r.throwIfAborted(t),{result:this._featureFetcher.debugInfo}}async handleEdits(e,t){return await this._updatingHandles.addPromise(this._whenSetup.promise),r.throwIfAborted(t),await this._updatingHandles.addPromise(this._featureFetcher.handleEdits(e)),r.throwIfAborted(t),F}async setHistoricMoment(e,t){return this._featureFetcher.setHistoricMoment(e.moment),F}async notifyElevationSourceChange(e,t){return this._elevationAligner.notifyElevationSourceChange(),F}async notifySymbologyChange(e,t){return this._symbologyCandidatesFetcher.notifySymbologyChange(),F}async setSymbologySnappingSupported(e){return this._symbologyCandidatesFetcher=S.getSymbologySnappingCandidatesFetcher(e,this._getSymbologyCandidates),F}_updateFeatureFetcherConfiguration(e){this._featureFetcher.filter=null!=e.filter?y.fromJSON(e.filter):null,this._featureFetcher.customParameters=e.customParameters}_notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};e.__decorate([i.property({readOnly:!0})],T.prototype,"updating",null),e.__decorate([i.property()],T.prototype,"_isInitializing",void 0),T=e.__decorate([l.subclass("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],T);const F={result:{}};return T});