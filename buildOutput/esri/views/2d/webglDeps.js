// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/webgl/BufferObject":function(){define(["exports","../../core/arrayUtils","../../core/has","../../core/Logger","../../core/typedArrayUtil","./checkWebGLError","./enums"],function(e,t,r,i,s,o,a){"use strict";const n=()=>i.getLogger("esri.views.webgl.BufferObject"),c=!!r("esri-tests-disable-gpu-memory-measurements");class l{static createIndex(e,t,r){return new l(e,34963,t,r)}static createUniform(e,t,r){return new l(e,35345,t,r)}static createPixelPack(e,t=35041,r){const i=new l(e,35051,t);return r&&i.setSize(r),i}static createPixelUnpack(e,t=35040,r){return new l(e,35052,t,r)}static createTransformFeedback(e,t=35044,r){const i=new l(e,35982,t);return i.setSize(r),i}constructor(e,t,r,i){this._context=e,this.bufferType=t,this.usage=r,this._glName=null,this._size=-1,this._indexType=void 0,e.instanceCounter.increment(a.ResourceType.BufferObject,this),this._glName=this._context.gl.createBuffer(),o.checkWebGLError(this._context.gl),i&&this.setData(i)}get glName(){return this._glName}get size(){return this._size}get indexType(){return this._indexType}get sizeBytes(){if(34963===this.bufferType){if(this._indexType===a.DataType.UNSIGNED_INT)return 4*this._size;if(this._indexType===a.DataType.UNSIGNED_SHORT)return 2*this._size}return this._size}get usedMemory(){return c?0:this.sizeBytes}get _isVAOAware(){return 34963===this.bufferType||34962===this.bufferType}dispose(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(a.ResourceType.BufferObject,this),this._context=null):this._glName&&n().warn("Leaked WebGL buffer object")}setSize(e,t=null){if(34963===this.bufferType&&null!=t)switch(this._indexType=t,t){case a.DataType.UNSIGNED_SHORT:e*=2;break;case a.DataType.UNSIGNED_INT:e*=4}this._setBufferData(e)}setData(e){if(!e)return;let t=e.byteLength;34963===this.bufferType&&(s.isUint8Array(e)?this._indexType=a.DataType.UNSIGNED_BYTE:s.isUint16Array(e)?(t/=2,this._indexType=a.DataType.UNSIGNED_SHORT):s.isUint32Array(e)&&(t/=4,this._indexType=a.DataType.UNSIGNED_INT)),this._setBufferData(t,e)}_setBufferData(e,t=null){this._size=e;const r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const i=this._context.gl;null!=t?i.bufferData(this.bufferType,t,this.usage):i.bufferData(this.bufferType,e,this.usage),o.checkWebGLError(i),this._isVAOAware&&this._context.bindVAO(r)}setSubData(e,t,r,i){if(!e)return;const s=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null),this._context.bindBuffer(this);const{gl:a}=this._context;a.bufferSubData(this.bufferType,t*e.BYTES_PER_ELEMENT,e,r,i-r),o.checkWebGLError(a),this._isVAOAware&&this._context.bindVAO(s)}getSubData(e,r=0,i,s){if(i<0||s<0)return;const o=(a=e,t.isArrayLike(a)?e.BYTES_PER_ELEMENT:1);var a;if(o*((i??0)+(s??0))>e.byteLength)return;r+o*(s??0)>this.usedMemory&&n().warn("Potential problem getting subdata: requested data exceeds buffer size!");const c=this._context.gl;35982===this.bufferType?(this._context.bindBuffer(this,35982),c.getBufferSubData(35982,r,e,i,s),this._context.unbindBuffer(35982)):(this._context.bindBuffer(this,36662),c.getBufferSubData(36662,r,e,i,s),this._context.unbindBuffer(36662))}async getSubDataAsync(e,t=0,r,i){await this._context.clientWaitAsync(),this.getSubData(e,t,r,i)}}e.BufferObject=l,e.tracer=null,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(e,t,r,i){"use strict";function s(e){switch(e.getError()){case e.NO_ERROR:return null;case e.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case e.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case e.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case e.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case e.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case e.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const o=!!r("enable-feature:webgl-debug");function a(){return o}e.checkWebGLError=function(e,r=a()){if(r){const r=s(e);if(r){const e=(new Error).stack;i.getLogger("esri.views.webgl.checkWebGLError").error(new t("webgl-error","WebGL error occurred",{message:r,stack:e}))}}},e.getErrorMessage=s,e.hasFeatureFlagWebGLDebug=o,e.webglDebugEnabled=a,e.webglValidateShadersEnabled=function(){return o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/enums":function(){define(["exports"],function(e){"use strict";const t={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,HALF_FLOAT:5131},r={RGBA4:32854,R16F:33325,RG16F:33327,RGB32F:34837,RGBA16F:34842,R32F:33326,RG32F:33328,RGBA32F:34836,R11F_G11F_B10F:35898,RGB8:32849,RGBA8:32856,RGB5_A1:32855,R8:33321,RG8:33323,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,RGB16F:34843,RGB9_E5:35901,SRGB8:35905,SRGB8_ALPHA8:35907,RGB565:36194,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,RGB10_A2:32857,RGB10_A2UI:36975},i=Object.values(r),s={FLOAT:t.FLOAT,UNSIGNED_BYTE:t.UNSIGNED_BYTE,UNSIGNED_INT_24_8:34042,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,BYTE:t.BYTE,UNSIGNED_SHORT:t.UNSIGNED_SHORT,SHORT:t.SHORT,UNSIGNED_INT:t.UNSIGNED_INT,INT:t.INT,HALF_FLOAT:5131,UNSIGNED_INT_2_10_10_10_REV:33640,UNSIGNED_INT_10F_11F_11F_REV:35899,UNSIGNED_INT_5_9_9_9_REV:35902,FLOAT_32_UNSIGNED_INT_24_8_REV:36269};e.ColorAttachment0=36064,e.ColorAttachment1=36065,e.ColorAttachment10=36074,e.ColorAttachment11=36075,e.ColorAttachment12=36076,e.ColorAttachment13=36077,e.ColorAttachment14=36078,e.ColorAttachment15=36079,e.ColorAttachment2=36066,e.ColorAttachment3=36067,e.ColorAttachment4=36068,e.ColorAttachment5=36069,e.ColorAttachment6=36070,e.ColorAttachment7=36071,e.ColorAttachment8=36072,e.ColorAttachment9=36073,e.CompressedTextureFormat={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497},e.DataType=t,e.DepthAttachment=36096,e.DepthStencilAttachment=33306,e.PixelType=s,e.PrimitiveType={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},e.ResourceType={Texture:0,TileTexture:1,BufferObject:2,VertexArrayObject:3,Shader:4,Program:5,FramebufferObject:6,Renderbuffer:7,TransformFeedback:8,Sync:9,UNCOUNTED:10,LinesOfCode:10,Uniform:11,COUNT:12},e.SizedDepthFormat={DEPTH_COMPONENT16:33189,DEPTH_COMPONENT24:33190,DEPTH_COMPONENT32F:36012},e.SizedDepthStencilFormat={DEPTH24_STENCIL8:35056,DEPTH32F_STENCIL8:36013},e.SizedPixelFormat=r,e.StencilAttachment=36128,e.baseTextureUnit=33984,e.sizedPixelFormatValues=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define(["exports","../../core/has","../../core/Logger","../../core/maybe","./BufferObject","./checkWebGLError","./enums","./Renderbuffer","./Texture"],function(e,t,r,i,s,o,a,n,c){"use strict";class l{constructor(e,t,r){if(this._context=e,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,e.instanceCounter.increment(a.ResourceType.FramebufferObject,this),null!=t){const r=function(e,t){return h(t)||u(t)?t:d(t)?new c.Texture(e,t):function(e){return 3===m(e)||null!=e&&"samples"in e}(t)?new n.Renderbuffer(e,t):null}(e,t);null!=r&&(this._colorAttachments.set(a.ColorAttachment0,r),h(r)?this._validateTextureDescriptor(r.descriptor):this._validateRenderbufferDescriptor(r.descriptor)),this._validateColorAttachmentPoint(a.ColorAttachment0)}var i;if(null!=r)if(h(i=r)||d(i))this._depthStencilTexture=h(r)?r:new c.Texture(e,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const t=u(r)?r:new n.Renderbuffer(e,r);this._depthStencilBuffer=t,this._validateRenderbufferDescriptor(t.descriptor)}}dispose(){const{_colorAttachments:e,_glName:t}=this;if(0===e.size&&!this._depthStencilBuffer&&!this._depthStencilTexture&&!t)return;const{_context:r}=this,i=r.getBoundFramebufferObject();e.forEach((e,t)=>this.detachColorTexture(t)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),r.gl.deleteFramebuffer(t),this._glName=null,r.bindFramebuffer(i===this?null:i),r.instanceCounter.decrement(a.ResourceType.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){const e=this._colorAttachments.get(a.ColorAttachment0);return h(e)?e:null}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const e=this._colorAttachments.get(a.ColorAttachment0)??this._depthStencilTexture??this._depthStencilBuffer;return e?.descriptor?.width??0}get height(){const e=this._colorAttachments.get(a.ColorAttachment0)??this._depthStencilTexture??this._depthStencilBuffer;return e?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((e,[t,r])=>e+r.usedMemory,this.depthStencil?.usedMemory??0)}static{this._MAX_COLOR_ATTACHMENTS=-1}getColorTexture(e){const t=this._colorAttachments.get(e);return t&&h(t)?t:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(e,t=a.ColorAttachment0){if(!e)return;this._validateColorAttachmentPoint(t);const{descriptor:r}=e;this._validateTextureDescriptor(r),this.detachColorTexture(t)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,t)),this._colorAttachments.set(t,e)}detachColorTexture(e=a.ColorAttachment0){const t=this._colorAttachments.get(e);if(!t)return;const r=h(t);return this._initialized&&this._context.temporaryBindFramebufferObject(this,()=>{if(r)this._framebufferTexture2D(null,e);else{const t=this._context.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,e,t.RENDERBUFFER,null)}}),this._colorAttachments.delete(e),r?t:void 0}setColorTextureTarget(e,t=a.ColorAttachment0,r=0){const i=this._colorAttachments.get(t);i&&(35866===e?this._framebufferTextureLayer(i.glName,t,36160,0,r):this._framebufferTexture2D(i.glName,t,e,36160,0))}attachDepthStencil(e){if(e)switch(e.type){case 1:return this._attachDepthStencilTexture(e);case 2:return this._attachDepthStencilBuffer(e)}}_attachDepthStencilTexture(e){if(null==e)return;const{descriptor:t}=e,{pixelFormat:r,dataType:i}=t;34041===r||6402===r?34041!==r||i===a.PixelType.UNSIGNED_INT_24_8?6402!==r||i===a.PixelType.UNSIGNED_INT||i===a.PixelType.UNSIGNED_SHORT?(this._validateTextureDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(e.glName,_(r))),this._depthStencilTexture?.dispose(),this._depthStencilTexture=e):console.error("Depth texture must have data type of UNSIGNED_INT or UNSIGNED_SHORT!"):console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"):console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!")}detachDepthStencilTexture(){const e=this._depthStencilTexture;return e&&this._initialized&&this._context.temporaryBindFramebufferObject(this,()=>{this._framebufferTexture2D(null,_(e.descriptor.pixelFormat))}),this._depthStencilTexture=null,e}_attachDepthStencilBuffer(e){if(null==e)return;const t=e.descriptor;if(this._validateRenderbufferDescriptor(t),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const{gl:r}=this._context,i=this._getGLAttachmentPoint(t);r.framebufferRenderbuffer(36160,i,r.RENDERBUFFER,e.glName)}this._depthStencilBuffer=e}detachDepthStencilBuffer(){const e=this._depthStencilBuffer;if(e&&this._initialized){const{_context:t}=this,r=t.getBoundFramebufferObject();t.bindFramebuffer(this);const{gl:i}=t,s=this._getGLAttachmentPoint(e.descriptor);i.framebufferRenderbuffer(36160,s,i.RENDERBUFFER,null),t.bindFramebuffer(r)}return this._depthStencilBuffer=null,e}invalidateAttachments(e){const{_context:t}=this;t.temporaryBindFramebufferObject(this,()=>t.gl.invalidateFramebuffer(36160,e),!0)}copyToTexture(e,t,r,i,s,o,a){(e<0||t<0||s<0||o<0)&&console.error("Offsets cannot be negative!"),(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!");const n=a.descriptor;3553!==a.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(null==n?.width||null==n?.height||e+r>this.width||t+i>this.height||s+r>n.width||o+i>n.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const l=this._context,h=l.bindTexture(a,c.Texture.TEXTURE_UNIT_FOR_UPDATES);l.setActiveTexture(c.Texture.TEXTURE_UNIT_FOR_UPDATES),l.bindFramebuffer(this),l.gl.copyTexSubImage2D(3553,0,s,o,e,t,r,i),l.bindTexture(h,c.Texture.TEXTURE_UNIT_FOR_UPDATES)}readPixels(e,t,r,i,s,o,a){(r<=0||i<=0)&&console.error("Copy width and height must be greater than zero!"),a||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(e,t,r,i,s,o,a)}async readPixelsAsync(e,t,r,i,o,a,n){const{gl:c}=this._context,l=s.BufferObject.createPixelPack(this._context,35041,n.byteLength);this._context.bindBuffer(l);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),c.readPixels(e,t,r,i,o,a,0),this._context.unbindBuffer(35051),this._context.bindFramebuffer(h),await l.getSubDataAsync(n),l.dispose()}resize(e,t){if(this.width===e&&this.height===t)return;const r={width:e,height:t};f(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(e=>e.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(f(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1)}initializeAndBind(e=36160){const{gl:t}=this._context;if(this._initialized)return void t.bindFramebuffer(e,this.glName);this._glName&&t.deleteFramebuffer(this._glName);const r=t.createFramebuffer();if(t.bindFramebuffer(e,r),this._colorAttachments.forEach((t,r)=>{if(h(t)){const i=p(t);35866===i?this._framebufferTextureLayer(t.glName,r,e,0,0):this._framebufferTexture2D(t.glName,r,i,e)}else if(u(t)){const i=this._context.gl;i.framebufferRenderbuffer(e,r,i.RENDERBUFFER,t.glName)}}),this._depthStencilBuffer){const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(e,r,t.RENDERBUFFER,this._depthStencilBuffer.glName)}else if(this._depthStencilTexture){const t=_(this._depthStencilTexture.descriptor.pixelFormat);this._framebufferTexture2D(this._depthStencilTexture.glName,t,p(this._depthStencilTexture),e)}o.webglDebugEnabled()&&t.checkFramebufferStatus(e)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(e,t=a.ColorAttachment0,r=3553,i=36160,s=0){this._context.gl.framebufferTexture2D(i,t,r,e,s)}_framebufferTextureLayer(e,t=a.ColorAttachment0,r=36160,i=0,s=0){this._context.gl.framebufferTextureLayer(r,t,e,i,s)}_disposeDepthStencilAttachments(){const e=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const t=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(36160,t,e.RENDERBUFFER,null)}this._depthStencilBuffer=i.disposeMaybe(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,_(this._depthStencilTexture.descriptor.pixelFormat))),this._depthStencilTexture=i.disposeMaybe(this._depthStencilTexture))}_validateTextureDescriptor(e){3553!==e.target&&34067!==e.target&&35866!==e.target&&console.error("Texture type must be TEXTURE_2D, TEXTURE_2D_ARRAY or TEXTURE_CUBE_MAP!"),f(e,this._context.parameters.maxTextureSize),this._validateBufferDimensions(e)}_validateRenderbufferDescriptor(e){f(e,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(e)}_validateBufferDimensions(e){e.width<=0&&(e.width=this.width),e.height<=0&&(e.height=this.height),this.width>0&&this.height>0&&(this.width===e.width&&this.height===e.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(e){switch(e.internalFormat){case a.SizedDepthFormat.DEPTH_COMPONENT16:case a.SizedDepthFormat.DEPTH_COMPONENT24:case a.SizedDepthFormat.DEPTH_COMPONENT32F:return a.DepthAttachment;case a.SizedDepthStencilFormat.DEPTH24_STENCIL8:case a.SizedDepthStencilFormat.DEPTH32F_STENCIL8:return a.DepthStencilAttachment;case 36168:return a.StencilAttachment;default:return a.ColorAttachment0}}_validateColorAttachmentPoint(e){if(-1===l._MAX_COLOR_ATTACHMENTS){const{gl:e}=this._context;l._MAX_COLOR_ATTACHMENTS=e.getParameter(e.MAX_COLOR_ATTACHMENTS)}const t=e-a.ColorAttachment0;t+1>l._MAX_COLOR_ATTACHMENTS&&r.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${t+1}. Implementation supports up to ${l._MAX_COLOR_ATTACHMENTS} color attachments`)}}function h(e){return 1===m(e)}function u(e){return 2===m(e)}function d(e){return 0===m(e)}function m(e){return null!=e&&"type"in e?e.type:null}function f(e,t){const i=Math.max(e.width,e.height);if(i>t){r.getLogger("esri.views.webgl.FramebufferObject").warnOnce(`Resizing FBO attachment size ${e.width}x${e.height} to device limit ${t}`);const s=t/i;return e.width=Math.round(e.width*s),e.height=Math.round(e.height*s),!1}return!0}function p(e){return 34067===e.descriptor.target?34069:35866===e.descriptor.target?35866:3553}function _(e){return 6402===e?a.DepthAttachment:a.DepthStencilAttachment}e.FramebufferObject=l,e.ensureAttachmentMaxSize=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","../../core/has","./enums","./RenderbufferDescriptor"],function(e,t,r,i){"use strict";const s=!!t("esri-tests-disable-gpu-memory-measurements");e.Renderbuffer=class{constructor(e,t){this._context=e,this._descriptor=t,this.type=2,this._context.instanceCounter.increment(r.ResourceType.Renderbuffer,this);const i=this._context.gl;this.glName=i.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:s,height:o,internalFormat:a,multisampled:n}=t;n?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,a,s,o):i.renderbufferStorage(i.RENDERBUFFER,a,s,o),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const e=this._descriptor.samples,t=this._context.parameters.maxSamples;return e?Math.min(e,t):t}get usedMemory(){return s?0:i.estimateMemory(this._descriptor)}resize(e,t){const r=this._descriptor;if(r.width===e&&r.height===t)return;r.width=e,r.height=t;const i=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?i.renderbufferStorageMultisample(i.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):i.renderbufferStorage(i.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(r.ResourceType.Renderbuffer,this),this._context=null)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderbufferDescriptor":function(){define(["exports","./Util"],function(e,t){"use strict";e.RenderbufferDescriptor=class{constructor(e,t=0,r=t,i=!1,s=1){this.internalFormat=e,this.width=t,this.height=r,this.multisampled=i,this.samples=s}},e.estimateMemory=function(e){return e.width<=0||e.height<=0||null==e.internalFormat?0:e.width*e.height*t.getBytesPerElementFormat(e.internalFormat)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","./checkWebGLError","./enums"],function(e,t,r,i){"use strict";e.bindVertexBufferLayout=function(e,t,i,s=0){const o=e.gl;e.bindBuffer(i);for(const a of i.layout){const i=t.get(a.name);if(null==i){console.warn(`There is no location for vertex attribute '${a.name}' defined.`);continue}const n=s*a.stride;if(a.count<=4)o.vertexAttribPointer(i,a.count,a.type,a.normalized,a.stride,a.offset+n),o.enableVertexAttribArray(i),a.divisor>0&&o.vertexAttribDivisor(i,a.divisor);else if(9===a.count)for(let e=0;e<3;e++)o.vertexAttribPointer(i+e,3,a.type,a.normalized,a.stride,a.offset+12*e+n),o.enableVertexAttribArray(i+e),a.divisor>0&&o.vertexAttribDivisor(i+e,a.divisor);else if(16===a.count)for(let e=0;e<4;e++)o.vertexAttribPointer(i+e,4,a.type,a.normalized,a.stride,a.offset+16*e+n),o.enableVertexAttribArray(i+e),a.divisor>0&&o.vertexAttribDivisor(i+e,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count);if(r.webglDebugEnabled()){const t=r.getErrorMessage(e.gl);t&&console.error(`Unable to bind vertex attribute "${a.name}" with baseInstanceOffset ${n}:`,t,a)}}},e.getBytesPerElementFormat=function(e){switch(e){case 6406:case 6409:case 6403:case 36244:case i.SizedPixelFormat.R8:case i.SizedPixelFormat.R8I:case i.SizedPixelFormat.R8UI:case i.SizedPixelFormat.R8_SNORM:case 36168:return 1;case 6410:case 33319:case 33320:case i.SizedPixelFormat.RGBA4:case i.SizedPixelFormat.R16F:case i.SizedPixelFormat.R16I:case i.SizedPixelFormat.R16UI:case i.SizedPixelFormat.RG8:case i.SizedPixelFormat.RG8I:case i.SizedPixelFormat.RG8UI:case i.SizedPixelFormat.RG8_SNORM:case i.SizedPixelFormat.RGB565:case i.SizedPixelFormat.RGB5_A1:case i.SizedDepthFormat.DEPTH_COMPONENT16:return 2;case 6407:case 36248:case i.SizedPixelFormat.RGB8:case i.SizedPixelFormat.RGB8I:case i.SizedPixelFormat.RGB8UI:case i.SizedPixelFormat.RGB8_SNORM:case i.SizedPixelFormat.SRGB8:case i.SizedDepthFormat.DEPTH_COMPONENT24:return 3;case 6408:case 36249:case i.SizedPixelFormat.RGBA8:case i.SizedPixelFormat.R32F:case i.SizedPixelFormat.R11F_G11F_B10F:case i.SizedPixelFormat.RG16F:case i.SizedPixelFormat.R32I:case i.SizedPixelFormat.R32UI:case i.SizedPixelFormat.RG16I:case i.SizedPixelFormat.RG16UI:case i.SizedPixelFormat.RGBA8I:case i.SizedPixelFormat.RGBA8UI:case i.SizedPixelFormat.RGBA8_SNORM:case i.SizedPixelFormat.SRGB8_ALPHA8:case i.SizedPixelFormat.RGB9_E5:case i.SizedPixelFormat.RGB10_A2UI:case i.SizedPixelFormat.RGB10_A2:case i.SizedDepthFormat.DEPTH_COMPONENT32F:case i.SizedDepthStencilFormat.DEPTH24_STENCIL8:return 4;case i.SizedDepthStencilFormat.DEPTH32F_STENCIL8:return 5;case i.SizedPixelFormat.RGB16F:case i.SizedPixelFormat.RGB16I:case i.SizedPixelFormat.RGB16UI:return 6;case i.SizedPixelFormat.RG32F:case i.SizedPixelFormat.RG32I:case i.SizedPixelFormat.RG32UI:case i.SizedPixelFormat.RGBA16F:case i.SizedPixelFormat.RGBA16I:case i.SizedPixelFormat.RGBA16UI:return 8;case i.SizedPixelFormat.RGB32F:case i.SizedPixelFormat.RGB32I:case i.SizedPixelFormat.RGB32UI:return 12;case i.SizedPixelFormat.RGBA32F:case i.SizedPixelFormat.RGBA32I:case i.SizedPixelFormat.RGBA32UI:return 16;case i.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case i.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case i.CompressedTextureFormat.COMPRESSED_R11_EAC:case i.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case i.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case i.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case i.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case i.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;case i.CompressedTextureFormat.COMPRESSED_RG11_EAC:case i.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case i.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case i.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger","../../core/maybe","../../core/object","../../core/promiseUtils","./checkWebGLError","./enums","./TextureDescriptor","./textureUtils","./ValidatedTextureDescriptor"],function(e,t,r,i,s,o,a,n,c,l,h,u){"use strict";const d=!!r("esri-tests-disable-gpu-memory-measurements"),m=()=>i.getLogger("esri/views/webgl/Texture");let f=class e{static{this.TEXTURE_UNIT_FOR_UPDATES=0}static{this.compressionWorkerHandle=null}constructor(e,r=null,i=null){if(this.type=1,this._glName=null,this._samplingModeDirty=!1,this._wrapModeDirty=!1,this._shadowFilterDirty=!1,this._wasImmutablyAllocated=!1,"context"in e)this._descriptor=e,i=r;else{const i=u.ValidatedTextureDescriptor.validate(e,r);if(!i)throw new t("texture:invalid-descriptor","Texture descriptor invalid");this._descriptor=i}34067===this._descriptor.target?this._setDataCubeMap(i):this.setData(i)}get glName(){return this._glName}get descriptor(){return this._descriptor}get usedMemory(){return d?0:l.estimateMemory(this._descriptor)}get cachedMemory(){return this.usedMemory}get isDirty(){return this._samplingModeDirty||this._wrapModeDirty||this._shadowFilterDirty}get hasWebGLTextureObject(){return!!this._glName}dispose(){this.abortCompression(),this.hasWebGLTextureObject&&this._descriptor.context?.gl&&(this._descriptor.context.instanceCounter.decrement(c.ResourceType.Texture,this),this._descriptor.context.unbindTexture(this),this._descriptor.context.gl.deleteTexture(this._glName),this._glName=null,this._descriptor=null)}release(){this.dispose()}[Symbol.dispose](){this.dispose()}resize(e,r){const i=this._descriptor;if(i.width!==e||i.height!==r){if(this._wasImmutablyAllocated)throw new t("texture:immutable-resize","Immutable textures can't be resized!");i.width=e,i.height=r,34067===this._descriptor.target?this._setDataCubeMap(null):this.setData(null)}}enableCompression(e){this._descriptor.compress=e}disableCompression(){this._descriptor.compress=void 0}setData(e){this.abortCompression(),!h.isCompressedData(e)&&this._descriptor.internalFormat&&o.hasValue(c.CompressedTextureFormat,this._descriptor.internalFormat)&&(this._descriptor.internalFormat=void 0),this._setData(e),!h.isCompressedData(e)&&this._descriptor.compress&&this._compressOnWorker(e)}updateData(r,i,s,o,a,n,c=0){n||m().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||m().error("An attempt to update uninitialized texture!");const l=this._descriptor;l.internalFormat=h.deriveInternalFormat(l);const{context:u,pixelFormat:d,dataType:f,target:p,isImmutable:_}=l;if(_&&!this._wasImmutablyAllocated)throw new t("texture:uninitialized","Cannot update immutable texture before allocation!");const g=u.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES,!0);(i<0||s<0||i+o>l.width||s+a>l.height)&&m().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:x}=u;c&&(o&&a||m().warn("Must pass width and height if `UNPACK_SKIP_ROWS` is used"),x.pixelStorei(x.UNPACK_SKIP_ROWS,c)),h.isTexImageSource(n)?x.texSubImage2D(p,r,i,s,o,a,d,f,n):h.isCompressedData(n)?x.compressedTexSubImage2D(p,r,i,s,o,a,l.internalFormat,n.levels[r]):x.texSubImage2D(p,r,i,s,o,a,d,f,n),c&&x.pixelStorei(x.UNPACK_SKIP_ROWS,0),u.bindTexture(g,e.TEXTURE_UNIT_FOR_UPDATES)}updateData3D(r,i,s,o,a,n,c,l){l||m().error("An attempt to use uninitialized data!"),this.hasWebGLTextureObject||m().error("An attempt to update an uninitialized texture!");const u=this._descriptor;u.internalFormat=h.deriveInternalFormat(u);const{context:d,pixelFormat:f,dataType:p,isImmutable:_,target:g}=u;if(_&&!this._wasImmutablyAllocated)throw new t("texture:uninitialized","Cannot update immutable texture before allocation!");h.is3DTarget(g)||m().warn("Attempting to set 3D texture data on a non-3D texture");const x=d.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);d.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),(i<0||s<0||o<0||i+a>u.width||s+n>u.height||o+c>u.depth)&&m().error("An attempt to update out of bounds of the texture!"),this._configurePixelStorage();const{gl:T}=d;if(h.isCompressedData(l))l=l.levels[r],T.compressedTexSubImage3D(g,r,i,s,o,a,n,c,u.internalFormat,l);else{const e=l;T.texSubImage3D(g,r,i,s,o,a,n,c,f,p,e)}d.bindTexture(x,e.TEXTURE_UNIT_FOR_UPDATES)}generateMipmap(){const r=this._descriptor;if(0===r.width||0===r.height)return;if(!r.hasMipmap){if(this._wasImmutablyAllocated)throw new t("texture:immutable-change","Cannot add mipmaps to immutable texture after allocation");r.hasMipmap=!0,this._samplingModeDirty=!0,h.validateTexture(r)}9729===r.samplingMode?(this._samplingModeDirty=!0,r.samplingMode=9985):9728===r.samplingMode&&(this._samplingModeDirty=!0,r.samplingMode=9984);const i=this._descriptor.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);this._descriptor.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._descriptor.context.gl.generateMipmap(r.target),this._descriptor.context.bindTexture(i,e.TEXTURE_UNIT_FOR_UPDATES)}clearMipmap(){const e=this._descriptor;if(e.hasMipmap){if(this._wasImmutablyAllocated)throw new t("texture:immutable-change","Cannot delete mipmaps to immutable texture after allocation");e.hasMipmap=!1,this._samplingModeDirty=!0,h.validateTexture(e)}9985===e.samplingMode?(this._samplingModeDirty=!0,e.samplingMode=9729):9984===e.samplingMode&&(this._samplingModeDirty=!0,e.samplingMode=9728)}setSamplingMode(e){e!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=e,this._samplingModeDirty=!0)}setWrapMode(e){e!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=e,h.validateTexture(this._descriptor),this._wrapModeDirty=!0)}setShadowFiltering(e){e!==this._descriptor.linearFilterDepth&&(this._descriptor.linearFilterDepth=this._descriptor.compareEnabled=e,this.setSamplingMode(e?9729:9728),h.validateTexture(this._descriptor),this._shadowFilterDirty=!0)}applyChanges(){this._samplingModeDirty&&(this._applySamplingMode(),this._samplingModeDirty=!1),this._wrapModeDirty&&(this._applyWrapMode(),this._wrapModeDirty=!1),this._shadowFilterDirty&&(this._applyShadowMode(),this._shadowFilterDirty=!1)}abortCompression(){this._compressionAbortController=s.abortMaybe(this._compressionAbortController)}_setData(r,i){const s=this._descriptor,o=s.context?.gl;if(!o)return;n.checkWebGLError(o),this.hasWebGLTextureObject||(this._glName=o.createTexture(),s.context.instanceCounter.increment(c.ResourceType.Texture,this)),h.validateTexture(s);const a=s.context.bindTexture(this,e.TEXTURE_UNIT_FOR_UPDATES);s.context.setActiveTexture(e.TEXTURE_UNIT_FOR_UPDATES),this._configurePixelStorage(),n.checkWebGLError(o);const l=i??s.target,u=h.is3DTarget(l);if(h.isTexImageSource(r))this._setDataFromTexImageSource(r,l);else{const{width:e,height:i,depth:a}=s;if(null==e||null==i)throw new t("texture:missing-size","Width and height must be specified!");if(u&&null==a)throw new t("texture:missing-depth","Depth must be specified!");if(s.internalFormat=h.deriveInternalFormat(s),s.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(l,s.internalFormat,s.hasMipmap,e,i,a),h.isCompressedData(r)){if(!h.isCompressedFormat(s.internalFormat))throw new t("texture:format-mismatch","Attempting to use compressed data with an uncompressed format!");this._setDataFromCompressedSource(r,s.internalFormat,l)}else this._texImage(l,0,s.internalFormat,e,i,a,r),n.checkWebGLError(o),s.hasMipmap&&this.generateMipmap()}this._applySamplingMode(),this._applyWrapMode(),this._applyAnisotropicFilteringParameters(),this._applyShadowMode(),n.checkWebGLError(o),s.context.bindTexture(a,e.TEXTURE_UNIT_FOR_UPDATES)}_setDataCubeMap(e=null){for(let t=34069;t<=34074;t++)this._setData(e,t)}_configurePixelStorage(){const e=this._descriptor.context.gl,{unpackAlignment:t,flipped:r,preMultiplyAlpha:i}=this._descriptor;e.pixelStorei(e.UNPACK_ALIGNMENT,t),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r?1:0),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i?1:0)}_setDataFromTexImageSource(e,t){const{gl:r}=this._descriptor.context,i=this._descriptor;i.internalFormat=h.deriveInternalFormat(i);const s=h.is3DTarget(t),{width:o,height:a,depth:c}=h.getDimensions(e);i.width&&i.height,i.width||(i.width=o),i.height||(i.height=a),s&&i.depth,s&&(i.depth=c),i.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(t,i.internalFormat,i.hasMipmap,o,a,c),this._texImage(t,0,i.internalFormat,o,a,c,e),n.checkWebGLError(r),i.hasMipmap&&(this.generateMipmap(),n.checkWebGLError(r))}_setDataFromCompressedSource(e,t,r){const i=this._descriptor,{width:s,height:o,depth:a}=i,n=e.levels,c=h.calcMipmapLevels(r,s,o,a),l=Math.min(c,n.length)-1;this._descriptor.context.gl.texParameteri(i.target,33085,l),this._forEachMipmapLevel((e,i,s,o)=>{const a=n[Math.min(e,n.length-1)];this._compressedTexImage(r,e,t,i,s,o,a)},l)}_texStorage(e,r,i,s,o,a){const{gl:n}=this._descriptor.context;if(!h.isSizedPixelFormat(r)&&!h.isSizedDepthFormat(r)&&!h.isSizedDepthStencilFormat(r))throw new t("texture:missing-format","Immutable textures must have a sized internal format");if(!this._descriptor.isImmutable)return;const c=i?h.calcMipmapLevels(e,s,o,a):1;if(h.is3DTarget(e)){if(null==a)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");n.texStorage3D(e,c,r,s,o,a)}else n.texStorage2D(e,c,r,s,o);this._wasImmutablyAllocated=!0}_texImage(e,r,i,s,o,a,n){const c=this._descriptor.context.gl,l=h.is3DTarget(e),{isImmutable:u,pixelFormat:d,dataType:m}=this._descriptor;if(u){if(null!=n){const i=n;if(l){if(null==a)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");c.texSubImage3D(e,r,0,0,0,s,o,a,d,m,i)}else c.texSubImage2D(e,r,0,0,s,o,d,m,i)}}else{const h=n;if(l){if(null==a)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");c.texImage3D(e,r,i,s,o,a,0,d,m,h)}else c.texImage2D(e,r,i,s,o,0,d,m,h)}}_compressedTexImage(e,r,i,s,o,a,n){const c=this._descriptor.context.gl,l=h.is3DTarget(e);if(this._descriptor.isImmutable){if(null!=n)if(l){if(null==a)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");c.compressedTexSubImage3D(e,r,0,0,0,s,o,a,i,n)}else c.compressedTexSubImage2D(e,r,0,0,s,o,i,n)}else if(l){if(null==a)throw new t("texture:missing-depth","Missing depth dimension for 3D texture upload");c.compressedTexImage3D(e,r,i,s,o,a,0,n)}else c.compressedTexImage2D(e,r,i,s,o,0,n)}async _compressOnWorker(t){const{width:r,height:i,context:s,flipped:o,preMultiplyAlpha:n,hasMipmap:c}=this._descriptor,l=this._descriptor.compress?.compressionTracker,h=this._descriptor.compress?.compressionCallback,{compressedTextureETC:u,compressedTextureS3TC:d}=s.capabilities;if(!e.compressionWorkerHandle?.isCompressible(t,this._descriptor)||!u&&!d)return;this.abortCompression();const f=new AbortController;this._compressionAbortController=f,l?.increment();try{let s;t instanceof Uint8Array?s=t.buffer:(s=await createImageBitmap(t,{imageOrientation:o?"flipY":"none"}),a.throwIfAborted(f));const l={data:s,width:r,height:i,needsFlip:t instanceof Uint8Array&&this.descriptor.flipped,components:6408===this._descriptor.pixelFormat?4:3,preMultiplyAlpha:n,hasMipmap:c,hasETC:!!u,hasS3TC:!!d},m=await e.compressionWorkerHandle.invoke(l,f.signal,"low");if(a.throwIfAborted(f),m.compressedTexture&&this.hasWebGLTextureObject){const e=this.usedMemory;this._descriptor.internalFormat=m.internalFormat,this._setData(m.compressedTexture),h?.(e-this.usedMemory)}}catch(e){a.isAbortError(e)||m().error("Texture compression failed!")}finally{l?.decrement(),this._compressionAbortController?.signal.aborted&&(this._compressionAbortController=null)}}_forEachMipmapLevel(e,r=1/0){let{width:i,height:s,depth:o,hasMipmap:a,target:n}=this._descriptor;const c=32879===n;if(null==i||null==s||c&&null==o)throw new t("texture:missing-size","Missing texture dimensions for mipmap calculation");for(let t=0;e(t,i,s,o),a&&(1!==i||1!==s||c&&1!==o)&&!(t>=r);++t)i=Math.max(1,i>>1),s=Math.max(1,s>>1),c&&(o=Math.max(1,o>>1))}_applySamplingMode(){const e=this._descriptor,t=e.context?.gl;let r=e.samplingMode,i=e.samplingMode;9985===r||9987===r?(r=9729,e.hasMipmap||(i=9729)):9984!==r&&9986!==r||(r=9728,e.hasMipmap||(i=9728)),t.texParameteri(e.target,t.TEXTURE_MAG_FILTER,r),t.texParameteri(e.target,t.TEXTURE_MIN_FILTER,i)}_applyWrapMode(){const e=this._descriptor,t=e.context?.gl;"number"==typeof e.wrapMode?(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode)):(t.texParameteri(e.target,t.TEXTURE_WRAP_S,e.wrapMode.s),t.texParameteri(e.target,t.TEXTURE_WRAP_T,e.wrapMode.t))}_applyShadowMode(){const e=this._descriptor,t=e.context?.gl,r=e.compareEnabled?t.COMPARE_REF_TO_TEXTURE:t.NONE;t.texParameteri(e.target,t.TEXTURE_COMPARE_MODE,r),e.compareEnabled&&t.texParameteri(e.target,t.TEXTURE_COMPARE_FUNC,t.GREATER),n.checkWebGLError(t)}_applyAnisotropicFilteringParameters(){const e=this._descriptor,t=e.context.capabilities.textureFilterAnisotropic;t&&e.context.gl.texParameterf(e.target,t.TEXTURE_MAX_ANISOTROPY,e.maxAnisotropy??1)}};e.Texture=f,e.tracer=null,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TextureDescriptor":function(){define(["exports","./enums","./Util"],function(e,t,r){"use strict";e.TextureDescriptor=class{constructor(e=0,r=e){this.width=e,this.height=r,this.type=0,this.target=3553,this.pixelFormat=6408,this.dataType=t.PixelType.UNSIGNED_BYTE,this.samplingMode=9729,this.wrapMode=10497,this.maxAnisotropy=1,this.flipped=!1,this.hasMipmap=!1,this.isOpaque=!1,this.unpackAlignment=4,this.preMultiplyAlpha=!1,this.compareEnabled=!1,this.linearFilterDepth=!1,this.depth=1,this.isImmutable=!1}},e.estimateMemory=function(e){return e.width<=0||e.height<=0||e.depth<=0?0:Math.round(e.width*e.height*e.depth*(e.hasMipmap?4/3:1)*(null==e.internalFormat?4:r.getBytesPerElementFormat(e.internalFormat))*(34067===e.target?6:1))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/textureUtils":function(){define(["exports","../../core/Error","../../core/Logger","../../core/object","./enums"],function(e,t,r,i,s){"use strict";const o=()=>r.getLogger("esri/views/webgl/textureUtils");function a(e){return i.hasValue(s.SizedDepthFormat,e)}function n(e){return i.hasValue(s.SizedDepthStencilFormat,e)}function c(e){return null!=e&&i.hasValue(s.CompressedTextureFormat,e)}function l(e){return null!=e&&"type"in e&&"compressed"===e.type}function h(e){return null!=e&&"byteLength"in e}e.calcMipmapLevels=function(e,t,r,i=1){let s=Math.max(t,r);return 32879===e&&(s=Math.max(s,i)),Math.floor(Math.log2(s))+1},e.deriveInternalFormat=function(e){if(null!=e.internalFormat)return e.internalFormat;switch(e.dataType){case s.PixelType.FLOAT:switch(e.pixelFormat){case 6408:return s.SizedPixelFormat.RGBA32F;case 6407:return s.SizedPixelFormat.RGB32F;default:throw new t("texture:unknown-format","Unable to derive format")}case s.PixelType.UNSIGNED_BYTE:switch(e.pixelFormat){case 6408:return s.SizedPixelFormat.RGBA8;case 6407:return s.SizedPixelFormat.RGB8}}const{pixelFormat:r}=e;return e.internalFormat=34041===r?s.SizedDepthStencilFormat.DEPTH24_STENCIL8:6402===r?s.SizedDepthFormat.DEPTH_COMPONENT24:r,e.internalFormat},e.getDimensions=function(e){let t="width"in e?e.width:e.codedWidth,r="height"in e?e.height:e.codedHeight;return e instanceof HTMLVideoElement&&(t=e.videoWidth,r=e.videoHeight),{width:t,height:r,depth:1}},e.is3DTarget=function(e){return 32879===e||35866===e},e.isArrayBufferView=h,e.isCompressedData=l,e.isCompressedFormat=c,e.isCompressedTexture=function(e){return c(e.descriptor.internalFormat)},e.isSizedDepthFormat=a,e.isSizedDepthStencilFormat=n,e.isSizedPixelFormat=function(e){return s.sizedPixelFormatValues.includes(e)},e.isTexImageSource=function(e){return null!=e&&!l(e)&&!h(e)},e.validateTexture=function(e){const{width:t,height:r,depth:i}=e;(null!=t&&t<0||null!=r&&r<0||null!=i&&i<0)&&o().error("Negative dimension parameters are not allowed!");const{internalFormat:s}=e;if(s&&(a(s)||n(s))){const{linearFilterDepth:t,compareEnabled:r,samplingMode:i,hasMipmap:s}=e;s&&o().error("Depth textures cannot have mipmaps"),t?9729!==i&&9728!==i&&o().error("Depth textures cannot sample mipmaps"):(9728!==i&&o().error("Depth textures without filtering must use NEAREST filtering"),r&&o().error("Depth textures without filtering cannot use compare function"))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ValidatedTextureDescriptor":function(){define(["exports","./enums","./TextureDescriptor"],function(e,t,r){"use strict";class i extends r.TextureDescriptor{constructor(e,r){switch(super(),this.context=e,Object.assign(this,r),this.internalFormat){case t.SizedPixelFormat.R16F:case t.SizedPixelFormat.R32F:case t.SizedPixelFormat.R8_SNORM:case t.SizedPixelFormat.R8:this.pixelFormat=6403;break;case t.SizedPixelFormat.R8I:case t.SizedPixelFormat.R8UI:case t.SizedPixelFormat.R16I:case t.SizedPixelFormat.R16UI:case t.SizedPixelFormat.R32I:case t.SizedPixelFormat.R32UI:this.pixelFormat=36244}}static validate(e,t){return new i(e,t)}}e.ValidatedTextureDescriptor=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define(["exports","../../core/has","./checkWebGLError","./enums","./ShaderTranspiler"],function(e,t,r,i,s){"use strict";const o=!!t("esri-tests-disable-gpu-memory-measurements");function a(e,t,i){const s=e.gl,o=s.createShader(t);return s.shaderSource(o,i),s.compileShader(o),r.webglValidateShadersEnabled()&&!s.getShaderParameter(o,s.COMPILE_STATUS)&&(console.error("Compile error in ".concat(35633===t?"vertex":"fragment"," shader")),console.error(s.getShaderInfoLog(o)),console.error(function(e){let t=2;return e.replaceAll("\n",()=>{return"\n"+((e=t++)>=1e3?e.toString():("  "+e).slice(-3))+":";var e})}(i))),o}function n(e,t,r){const i=e.get(t);if(!i)return e.set(t,Array.from(r)),!0;const s=r.length;if(i.length!==s)return e.set(t,Array.from(r)),!0;for(let e=0;e<s;++e){const t=r[e];if(i[e]!==t){for(i[e]=t;e<s;++e)i[e]=r[e];return!0}}return!1}const c={enabled:!1},l=r.webglDebugEnabled()?(e,...t)=>h(e,t):()=>{},h=r.webglDebugEnabled()?(e,t)=>{if(e?.supportsNaN)return;const r=t.length;for(let e=0;e<r;++e){const r=t[e];Number.isNaN(r)&&console.error(`Got ${r} as uniform value from ${(new Error).stack}`)}}:()=>{};e.Program=class{constructor(e,t,n,l,h=new Map,u=[]){this._context=e,this._refCount=1,this._compiled=!1,this._linesOfCode=0,this._nameToUniformLocation=new Map,this._nameToUniform1=new Map,this._nameToUniform1v=new Map,this._nameToUniform2=new Map,this._nameToUniform3=new Map,this._nameToUniform4=new Map,this._nameToUniformMatrix3=new Map,this._nameToUniformMatrix4=new Map,e||console.error("RenderingContext isn't initialized!"),0===t.length&&console.error("Shaders source should not be empty!"),t=s.transpileShader(t,35633),n=s.transpileShader(n,35632),this._vShader=a(this._context,35633,t),this._fShader=a(this._context,35632,n),c.enabled&&(this._linesOfCode=t.match(/\n/g).length+n.match(/\n/g).length+2,e.instanceCounter.increment(i.ResourceType.LinesOfCode,this._vShader,this._linesOfCode)),this._vShader&&this._fShader||console.error("Error loading shaders!"),e.instanceCounter.increment(i.ResourceType.Shader,this),r.webglValidateShadersEnabled()&&(this.vertexShader=t,this.fragmentShader=n),this.usedMemory=o?0:t.length+n.length;const d=this._context.gl,m=d.createProgram();d.attachShader(m,this._vShader),d.attachShader(m,this._fShader),l.forEach((e,t)=>d.bindAttribLocation(m,e,t)),this.hasTransformFeedbackVaryings=!!u?.length,this.hasTransformFeedbackVaryings&&d.transformFeedbackVaryings(m,u,d.SEPARATE_ATTRIBS),d.linkProgram(m),r.webglValidateShadersEnabled()&&!d.getProgramParameter(m,d.LINK_STATUS)&&console.error(`Could not link shader\nvalidated: ${d.getProgramParameter(m,d.VALIDATE_STATUS)}, gl error ${d.getError()}, vertex: ${d.getShaderParameter(this._vShader,d.COMPILE_STATUS)}, fragment: ${d.getShaderParameter(this._fShader,d.COMPILE_STATUS)}, info log: ${d.getProgramInfoLog(m)}, vertex source: ${this.vertexShader}, fragment source: ${this.fragmentShader}`);for(const[e,t]of h){const r=d.getUniformBlockIndex(m,e);r<4294967295&&d.uniformBlockBinding(m,r,t)}this._glName=m,e.instanceCounter.increment(i.ResourceType.Program,this)}get glName(){return this._glName}get hasGLName(){return null!=this._glName}get compiled(){return!!this._compiled||(this._context.capabilities.parallelShaderCompile&&null!=this.glName?(this._compiled=!!this._context.gl.getProgramParameter(this.glName,37297),this._compiled):(this._compiled=!0,!0))}dispose(){if(--this._refCount>0)return;const e=this._context.gl,t=this._context.instanceCounter;this._nameToUniformLocation.forEach(e=>e&&t.decrement(i.ResourceType.Uniform,e)),this._nameToUniformLocation.clear(),this._vShader&&(this._linesOfCode>0&&(t.decrement(i.ResourceType.LinesOfCode,this._vShader,this._linesOfCode),this._linesOfCode=0),e.deleteShader(this._vShader),this._vShader=null,t.decrement(i.ResourceType.Shader,this)),this._fShader&&(e.deleteShader(this._fShader),this._fShader=null),this._glName&&(e.deleteProgram(this._glName),this._glName=null,t.decrement(i.ResourceType.Program,this))}ref(){++this._refCount}_getUniformLocation(e){const t=this._nameToUniformLocation.get(e);if(void 0!==t)return t;if(this.glName){const t=this._context.gl.getUniformLocation(this.glName,e);return this._nameToUniformLocation.set(e,t),t&&this._context.instanceCounter.increment(i.ResourceType.Uniform,t),t}return null}hasUniform(e){return null!=this._getUniformLocation(e)}setUniform1i(e,t,r){l(r,t);const i=this._nameToUniform1.get(e);void 0!==i&&t===i||(this._context.gl.uniform1i(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1iv(e,t,r){h(r,t),n(this._nameToUniform1v,e,t)&&this._context.gl.uniform1iv(this._getUniformLocation(e),t)}setUniform2iv(e,t,r){h(r,t),n(this._nameToUniform2,e,t)&&this._context.gl.uniform2iv(this._getUniformLocation(e),t)}setUniform3iv(e,t,r){h(r,t),n(this._nameToUniform3,e,t)&&this._context.gl.uniform3iv(this._getUniformLocation(e),t)}setUniform4iv(e,t,r){h(r,t),n(this._nameToUniform4,e,t)&&this._context.gl.uniform4iv(this._getUniformLocation(e),t)}setUniform1f(e,t,r){l(r,t);const i=this._nameToUniform1.get(e);void 0!==i&&t===i||(this._context.gl.uniform1f(this._getUniformLocation(e),t),this._nameToUniform1.set(e,t))}setUniform1fv(e,t,r){h(r,t),n(this._nameToUniform1v,e,t)&&this._context.gl.uniform1fv(this._getUniformLocation(e),t)}setUniform2f(e,t,r,i){l(i,t,r);const s=this._nameToUniform2.get(e);void 0===s?(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),this._nameToUniform2.set(e,[t,r])):t===s[0]&&r===s[1]||(this._context.gl.uniform2f(this._getUniformLocation(e),t,r),s[0]=t,s[1]=r)}setUniform2fv(e,t,r){h(r,t),n(this._nameToUniform2,e,t)&&this._context.gl.uniform2fv(this._getUniformLocation(e),t)}setUniform3f(e,t,r,i,s){l(s,t,r,i);const o=this._nameToUniform3.get(e);void 0===o?(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,i),this._nameToUniform3.set(e,[t,r,i])):t===o[0]&&r===o[1]&&i===o[2]||(this._context.gl.uniform3f(this._getUniformLocation(e),t,r,i),o[0]=t,o[1]=r,o[2]=i)}setUniform3fv(e,t,r){h(r,t);const i=this._getUniformLocation(e);null!=i&&n(this._nameToUniform3,e,t)&&this._context.gl.uniform3fv(i,t)}setUniform4f(e,t,r,i,s,o){l(o,t,r,i,s);const a=this._nameToUniform4.get(e);void 0===a?(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,i,s),this._nameToUniform4.set(e,[t,r,i,s])):void 0!==a&&t===a[0]&&r===a[1]&&i===a[2]&&s===a[3]||(this._context.gl.uniform4f(this._getUniformLocation(e),t,r,i,s),a[0]=t,a[1]=r,a[2]=i,a[3]=s)}setUniform4fv(e,t,r){h(r,t);const i=this._getUniformLocation(e);null!=i&&n(this._nameToUniform4,e,t)&&this._context.gl.uniform4fv(i,t)}setUniformMatrix3fv(e,t,r=!1,i){h(i,t);const s=this._getUniformLocation(e);null!=s&&n(this._nameToUniformMatrix3,e,t)&&this._context.gl.uniformMatrix3fv(s,r,t)}setUniformMatrix4fv(e,t,r=!1,i){h(i,t);const s=this._getUniformLocation(e);null!=s&&n(this._nameToUniformMatrix4,e,t)&&this._context.gl.uniformMatrix4fv(s,r,t)}stop(){}},e.test=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define(["exports","../../core/has","./reservedWordsGLSL3","./testUtils"],function(e,t,r,i){"use strict";const s=["precision","highp","mediump","lowp","attribute","const","uniform","varying","break","continue","do","for","while","if","else","in","out","inout","float","int","void","bool","true","false","discard","return","mat2","mat3","mat4","vec2","vec3","vec4","ivec2","ivec3","ivec4","uvec2","uvec3","uvec4","bvec2","bvec3","bvec4","sampler1D","sampler2D","sampler3D","usampler1D","usampler2D","usampler3D","samplerCube","sampler1DShadow","sampler2DShadow","struct","asm","class","union","enum","typedef","template","this","packed","goto","switch","default","inline","noinline","volatile","public","static","extern","external","interface","long","short","double","half","fixed","unsigned","input","output","hvec2","hvec3","hvec4","dvec2","dvec3","dvec4","fvec2","fvec3","fvec4","sampler2DRect","sampler3DRect","sampler2DRectShadow","sizeof","cast","namespace","using"],o=["<<=",">>=","++","--","<<",">>","<=",">=","==","!=","&&","||","+=","-=","*=","/=","%=","&=","^^","^=","|=","(",")","[","]",".","!","~","*","/","%","+","-","<",">","&","^","|","?",":","=",",",";","{","}"],a=["abs","acos","all","any","asin","atan","ceil","clamp","cos","cross","dFdx","dFdy","degrees","distance","dot","equal","exp","exp2","faceforward","floor","fract","gl_BackColor","gl_BackLightModelProduct","gl_BackLightProduct","gl_BackMaterial","gl_BackSecondaryColor","gl_ClipPlane","gl_ClipVertex","gl_Color","gl_DepthRange","gl_DepthRangeParameters","gl_EyePlaneQ","gl_EyePlaneR","gl_EyePlaneS","gl_EyePlaneT","gl_Fog","gl_FogCoord","gl_FogFragCoord","gl_FogParameters","gl_FragColor","gl_FragCoord","gl_FragData","gl_FragDepth","gl_FragDepthEXT","gl_FrontColor","gl_FrontFacing","gl_FrontLightModelProduct","gl_FrontLightProduct","gl_FrontMaterial","gl_FrontSecondaryColor","gl_LightModel","gl_LightModelParameters","gl_LightModelProducts","gl_LightProducts","gl_LightSource","gl_LightSourceParameters","gl_MaterialParameters","gl_MaxClipPlanes","gl_MaxCombinedTextureImageUnits","gl_MaxDrawBuffers","gl_MaxFragmentUniformComponents","gl_MaxLights","gl_MaxTextureCoords","gl_MaxTextureImageUnits","gl_MaxTextureUnits","gl_MaxVaryingFloats","gl_MaxVertexAttribs","gl_MaxVertexTextureImageUnits","gl_MaxVertexUniformComponents","gl_ModelViewMatrix","gl_ModelViewMatrixInverse","gl_ModelViewMatrixInverseTranspose","gl_ModelViewMatrixTranspose","gl_ModelViewProjectionMatrix","gl_ModelViewProjectionMatrixInverse","gl_ModelViewProjectionMatrixInverseTranspose","gl_ModelViewProjectionMatrixTranspose","gl_MultiTexCoord0","gl_MultiTexCoord1","gl_MultiTexCoord2","gl_MultiTexCoord3","gl_MultiTexCoord4","gl_MultiTexCoord5","gl_MultiTexCoord6","gl_MultiTexCoord7","gl_Normal","gl_NormalMatrix","gl_NormalScale","gl_ObjectPlaneQ","gl_ObjectPlaneR","gl_ObjectPlaneS","gl_ObjectPlaneT","gl_Point","gl_PointCoord","gl_PointParameters","gl_PointSize","gl_Position","gl_ProjectionMatrix","gl_ProjectionMatrixInverse","gl_ProjectionMatrixInverseTranspose","gl_ProjectionMatrixTranspose","gl_SecondaryColor","gl_TexCoord","gl_TextureEnvColor","gl_TextureMatrix","gl_TextureMatrixInverse","gl_TextureMatrixInverseTranspose","gl_TextureMatrixTranspose","gl_Vertex","greaterThan","greaterThanEqual","inversesqrt","length","lessThan","lessThanEqual","log","log2","matrixCompMult","max","min","mix","mod","normalize","not","notEqual","pow","radians","reflect","refract","sign","sin","smoothstep","sqrt","step","tan","texture2D","texture2DLod","texture2DProj","texture2DProjLod","textureCube","textureCubeLod","texture2DLodEXT","texture2DProjLodEXT","textureCubeLodEXT","texture2DGradEXT","texture2DProjGradEXT","textureCubeGradEXT","textureSize","texelFetch"];var n=999,c=["block-comment","line-comment","preprocessor","operator","integer","float","ident","builtin","keyword","whitespace","eof","integer"];const l=new Set(["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"]);function h(e,t){for(let r=t-1;r>=0;r--){const t=e[r];if("whitespace"!==t.type&&"block-comment"!==t.type){if("keyword"!==t.type)break;if("attribute"===t.data||"in"===t.data)return!0}}return!1}function u(e,t,r,i){i=i||r;for(const s of e)if("ident"===s.type&&s.data===r)return i in t?t[i]++:t[i]=0,u(e,t,i+"_"+t[i],i);return r}function d(e,t,r="afterVersion"){function i(e,t){for(let r=t;r<e.length;r++){const t=e[r];if("operator"===t.type&&";"===t.data)return r}return null}const s={data:"\n",type:"whitespace"},o=t=>t<e.length&&/[^\r\n]$/.test(e[t].data);let a=function(e){let t=-1,s=0,o=-1;for(let a=0;a<e.length;a++){const n=e[a];if("preprocessor"===n.type&&(/#(if|ifdef|ifndef)\s+.+/.test(n.data)?++s:/#endif\s*.*/.test(n.data)&&--s),"afterVersion"!==r&&"afterPrecision"!==r||"preprocessor"===n.type&&n.data.startsWith("#version")&&(o=Math.max(o,a)),"afterPrecision"===r&&"keyword"===n.type&&"precision"===n.data){const t=i(e,a);if(null===t)throw new Error("precision statement not followed by any semicolons!");o=Math.max(o,t)}t<o&&0===s&&(t=a)}return t+1}(e);o(a-1)&&e.splice(a++,0,s);for(const r of t)e.splice(a++,0,r);o(a-1)&&o(a)&&e.splice(a,0,s)}function m(e,t,r,i="lowp"){d(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:i},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function f(e,t,r,i,s="lowp"){d(e,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"="},{type:"whitespace",data:" "},{type:"integer",data:i.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:s},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"ident",data:t},{type:"operator",data:";"}],"afterPrecision")}function p(e,t){let r,i,s=-1;for(let o=t;o<e.length;o++){const t=e[o];if("operator"===t.type&&("["===t.data&&(r=o),"]"===t.data)){i=o;break}"integer"===t.type&&(s=parseInt(t.data,10))}return r&&i&&e.splice(r,i-r+1),s}const _=new Map;e.transpileShader=function(e,t){if(e.startsWith("#version 300"))return e;const d=function(e){return i.shaderTranspiler.enableCache?_.get(e):null}(e);if(null!=d)return d;const g=function(e){return t=e,r=function(){var e,t,r,i=0,l=0,h=n,u=[],d=[],m=1,f=0,p=0,_=!1,g=!1,x="";return function(t){return d=[],null!==t?function(t){var s;for(i=0,r=(x+=t).length;e=x[i],i<r;){switch(s=i,h){case 0:i=D();break;case 1:i=y();break;case 2:i=E();break;case 3:i=R();break;case 4:i=P();break;case 11:i=F();break;case 5:i=w();break;case 9999:i=M();break;case 9:i=S();break;case n:i=b()}s!==i&&("\n"===x[s]?(f=0,++m):++f)}return l+=i,x=x.slice(i),d}(t.replace?t.replace(/\r\n/g,"\n"):t):(u.length&&T(u.join("")),h=10,T("(eof)"),d)};function T(e){e.length&&d.push({type:c[h],data:e,position:p,line:m,column:f})}function b(){return u=u.length?[]:u,"/"===t&&"*"===e?(p=l+i-1,h=0,t=e,i+1):"/"===t&&"/"===e?(p=l+i-1,h=1,t=e,i+1):"#"===e?(h=2,p=l+i,i):/\s/.test(e)?(h=9,p=l+i,i):(_=/\d/.test(e),g=/[^\w_]/.test(e),p=l+i,h=_?4:g?3:9999,i)}function S(){return/[^\s]/g.test(e)?(T(u.join("")),h=n,i):(u.push(e),t=e,i+1)}function E(){return"\r"!==e&&"\n"!==e||"\\"===t?(u.push(e),t=e,i+1):(T(u.join("")),h=n,i)}function y(){return E()}function D(){return"/"===e&&"*"===t?(u.push(e),T(u.join("")),h=n,i+1):(u.push(e),t=e,i+1)}function R(){if("."===t&&/\d/.test(e))return h=5,i;if("/"===t&&"*"===e)return h=0,i;if("/"===t&&"/"===e)return h=1,i;if("."===e&&u.length){for(;A(u););return h=5,i}if(";"===e||")"===e||"("===e){if(u.length)for(;A(u););return T(e),h=n,i+1}var r=2===u.length&&"="!==e;if(/[\w_\d\s]/.test(e)||r){for(;A(u););return h=n,i}return u.push(e),t=e,i+1}function A(e){for(var t,r,i=0;;){if(t=o.indexOf(e.slice(0,e.length+i).join("")),r=o[t],-1===t){if(i--+e.length>0)continue;r=e.slice(0,1).join("")}return T(r),p+=r.length,(u=u.slice(r.length)).length}}function F(){return/[^a-fA-F0-9]/.test(e)?(T(u.join("")),h=n,i):(u.push(e),t=e,i+1)}function P(){return"."===e||/[eE]/.test(e)?(u.push(e),h=5,t=e,i+1):"x"===e&&1===u.length&&"0"===u[0]?(h=11,u.push(e),t=e,i+1):/[^\d]/.test(e)?(T(u.join("")),h=n,i):(u.push(e),t=e,i+1)}function w(){return"f"===e&&(u.push(e),t=e,i+=1),/[eE]/.test(e)||"-"===e&&/[eE]/.test(t)?(u.push(e),t=e,i+1):/[^\d]/.test(e)?(T(u.join("")),h=n,i):(u.push(e),t=e,i+1)}function M(){if(/[^\d\w_]/.test(e)){var r=u.join("");return h=s.indexOf(r)>-1?8:a.indexOf(r)>-1?7:6,T(u.join("")),h=n,i}return u.push(e),t=e,i+1}}(),[].concat(r(t)).concat(r(null));var t,r}(e);if("300 es"===function(e,t="100",r="300 es"){const i=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const s of e)if("preprocessor"===s.type){const e=i.exec(s.data);if(e){const i=e[1].replaceAll(/\s{2,}/g," ");if(i===r)return i;if(i===t)return s.data="#version "+r,t;throw new Error("unknown glsl version: "+i)}}return e.splice(0,0,{type:"preprocessor",data:"#version "+r},{type:"whitespace",data:"\n"}),null}(g,"100","300 es"))return e;let x=null,T=null;const b={},S={};for(let e=0;e<g.length;++e){const i=g[e];switch(i.type){case"keyword":35633===t&&"attribute"===i.data?i.data="in":"varying"===i.data&&(i.data=35633===t?"out":"in");break;case"builtin":if(/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(i.data.trim())&&(i.data=i.data.replaceAll(/(2D|Cube|EXT)/g,"")),35632===t&&"gl_FragColor"===i.data&&(x||(x=u(g,b,"fragColor"),m(g,x,"vec4")),i.data=x),35632===t&&"gl_FragData"===i.data){const t=p(g,e+1),r=u(g,b,"fragData");f(g,r,"vec4",t,"mediump"),i.data=r}else 35632===t&&"gl_FragDepthEXT"===i.data&&(T||(T=u(g,b,"gl_FragDepth")),i.data=T);break;case"ident":if(r.includes(i.data)){if(35633===t&&h(g,e))throw new Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");i.data in S||(S[i.data]=u(g,b,i.data)),i.data=S[i.data]}}}for(let e=g.length-1;e>=0;--e){const t=g[e];if("preprocessor"===t.type){const r=t.data.match(/#extension\s+(.*):/);if(r?.[1]&&l.has(r[1].trim())){const t=g[e+1];g.splice(e,t&&"whitespace"===t.type?2:1)}const i=t.data.match(/#ifdef\s+(.*)/);i?.[1]&&l.has(i[1].trim())&&(t.data="#if 1");const s=t.data.match(/#ifndef\s+(.*)/);s?.[1]&&l.has(s[1].trim())&&(t.data="#if 0")}}return function(e,t){return i.shaderTranspiler.enableCache&&_.set(e,t),t}(e,function(e){return e.map(e=>"eof"!==e.type?e.data:"").join("")}(g))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){"use strict";return["layout","centroid","smooth","case","mat2x2","mat2x3","mat2x4","mat3x2","mat3x3","mat3x4","mat4x2","mat4x3","mat4x4","uint","uvec2","uvec3","uvec4","samplerCubeShadow","sampler2DArray","sampler2DArrayShadow","isampler2D","isampler3D","isamplerCube","isampler2DArray","usampler2D","usampler3D","usamplerCube","usampler2DArray","coherent","restrict","readonly","writeonly","resource","atomic_uint","noperspective","patch","sample","subroutine","common","partition","active","filter","image1D","image2D","image3D","imageCube","iimage1D","iimage2D","iimage3D","iimageCube","uimage1D","uimage2D","uimage3D","uimageCube","image1DArray","image2DArray","iimage1DArray","iimage2DArray","uimage1DArray","uimage2DArray","image1DShadow","image2DShadow","image1DArrayShadow","image2DArrayShadow","imageBuffer","iimageBuffer","uimageBuffer","sampler1DArray","sampler1DArrayShadow","isampler1D","isampler1DArray","usampler1D","usampler1DArray","isampler2DRect","usampler2DRect","samplerBuffer","isamplerBuffer","usamplerBuffer","sampler2DMS","isampler2DMS","usampler2DMS","sampler2DMSArray","isampler2DMSArray","usampler2DMSArray","trunc","round","roundEven","isnan","isinf","floatBitsToInt","floatBitsToUint","intBitsToFloat","uintBitsToFloat","packSnorm2x16","unpackSnorm2x16","packUnorm2x16","unpackUnorm2x16","packHalf2x16","unpackHalf2x16","outerProduct","transpose","determinant","inverse","texture","textureSize","textureProj","textureLod","textureOffset","texelFetch","texelFetchOffset","textureProjOffset","textureLodOffset","textureProjLod","textureProjLodOffset","textureGrad","textureGradOffset","textureProjGrad","textureProjGradOffset"]})},"esri/views/webgl/testUtils":function(){define(["exports"],function(e){"use strict";e.shaderTranspiler={enableCache:!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../core/has","./Program"],function(e,t,r){"use strict";e.ProgramCache=class{constructor(e){this._rctx=e,this._store=new Map}dispose(){this._store.forEach(e=>e.dispose()),this._store.clear()}acquire(e,t,i,s){const o=e+t+JSON.stringify(Array.from(i.entries())),a=this._store.get(o);if(null!=a)return a.ref(),a;const n=new r.Program(this._rctx,e,t,i,s);return n.ref(),this._store.set(o,n),n}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderCompiler":function(){define(["exports"],function(e){"use strict";e.ShaderCompiler=class{constructor(e){this._readFile=e}resolveIncludes(e){return this._resolve(e)}_resolve(e,t=new Map){if(t.has(e))return t.get(e);const r=this._read(e);if(!r)throw new Error(`cannot find shader file ${e}`);const i=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let s=i.exec(r);const o=[];for(;null!=s;)o.push({path:s[1],start:s.index,length:s[0].length}),s=i.exec(r);let a=0,n="";return o.forEach(e=>{n+=r.slice(a,e.start),n+=t.has(e.path)?"":this._resolve(e.path,t),a=e.start+e.length}),n+=r.slice(a),t.set(e,n),n}_read(e){return this._readFile(e)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexArrayObject":function(){define(["exports","../../core/compilerUtils","../../core/Logger","../../core/maybe","../../core/memoryEstimations","./enums","./Util","./VertexAttributeLocations"],function(e,t,r,i,s,o,a,n){"use strict";const c=()=>r.getLogger("esri.views.webgl.VertexArrayObject");e.VertexArrayObject=class{constructor(e,r,i){this._context=e,this._indexBuffer=i,this._buffers=r instanceof Map?r:new Map([["geometry",r]]),this.locations=t.toConst(n.fromBuffers(this._buffers))}get glName(){return this._glName}get context(){return this._context}get buffers(){return t.toConst(this._buffers)}buffer(e="geometry"){return this.buffers.get(e)}get indexBuffer(){return this._indexBuffer}getByteLength(e){return this.buffer(e)?.sizeBytes??0}vertexCount(e){const t=this.buffer(e);return t?t.sizeBytes/t.layout[0].stride:0}get usedMemory(){return Array.from(this._buffers.values()).reduce((e,t)=>e+t.usedMemory,this._indexBuffer?.usedMemory??0+(this._buffers.size+(this._indexBuffer?1:0))*s.baseTypedArrayMemory)}get cachedMemory(){return this.usedMemory}dispose(){this._context?(this._context.getBoundVAO()===this&&this._context.bindVAO(null),this._buffers.forEach(e=>e.dispose()),this._buffers.clear(),this._indexBuffer=i.disposeMaybe(this._indexBuffer),this.disposeVAOOnly()):(this._glName||this._buffers.size>0)&&c().warn("Leaked WebGL VAO")}disposeVAOOnly(){this._glName&&(this._context.gl.deleteVertexArray(this._glName),this._glName=null,this._context.instanceCounter.decrement(o.ResourceType.VertexArrayObject,this)),this._context=null}bind(e=this.locations){const t=this._context.gl;this._glName?t.bindVertexArray(this._glName):(this._context.instanceCounter.increment(o.ResourceType.VertexArrayObject,this),this._glName=t.createVertexArray(),t.bindVertexArray(this._glName),this._bindLayout(e))}_bindLayout(e){const{_buffers:t,_indexBuffer:r}=this;if(t||c().error("Vertex buffer dictionary is empty!"),t.forEach(t=>a.bindVertexBufferLayout(this._context,e,t)),null!=r){const e=this._context.gl;this._context.gl.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.glName)}}unbind(){this._context.gl.bindVertexArray(null)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexAttributeLocations":function(){define(["exports"],function(e){"use strict";function t(e){const t=new Map;let r=0;return e.forEach(e=>e.forEach(({name:e,count:i})=>{t.set(e,r),16===i?r+=4:9===i?r+=3:++r})),t}e.fromBuffers=function(e){return t(Array.from(e.values()).map(({layout:e})=>e))},e.fromLayout=function(e){let t=0;return new Map(e.map(({name:e,count:r})=>{const i=[e,t];return 16===r?t+=4:9===r?t+=3:++t,i}))},e.fromLayouts=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/programUtils":function(){define(["exports"],function(e){"use strict";function t(e){const{options:t,value:r}=e;return"number"==typeof t[r]}e.glslifyDefineMap=function(e){let r="";for(const i in e){const s=e[i];if("boolean"==typeof s)s&&(r+=`#define ${i}\n`);else if("number"==typeof s)r+=`#define ${i} ${s.toFixed()}\n`;else if("object"==typeof s)if(t(s)){const{value:e,options:t,namespace:o}=s,a=o?`${o}_`:"";for(const e in t)r+=`#define ${a}${e} ${t[e].toFixed()}\n`;r+=`#define ${i} ${a}${e}\n`}else{const e=s.options;let t=0;for(const i in e)r+=`#define ${e[i]} ${(t++).toFixed()}\n`;r+=`#define ${i} ${e[s.value]}\n`}}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramTemplate":function(){define(["exports","./Program"],function(e,t){"use strict";e.createProgram=function(e,r,i,s=""){return new t.Program(e,s+r.vertexShader,s+r.fragmentShader,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["exports","../webgl/BufferObject","../webgl/FramebufferObject","../webgl/Program","../webgl/ProgramCache","../webgl/Renderbuffer","../webgl/ShaderCompiler","../webgl/Texture","../webgl/VertexArrayObject","../webgl/programUtils","../webgl/ProgramTemplate"],function(e,t,r,i,s,o,a,n,c,l,h){"use strict";e.BufferObject=t.BufferObject,e.FramebufferObject=r.FramebufferObject,e.Program=i.Program,e.ProgramCache=s.ProgramCache,e.Renderbuffer=o.Renderbuffer,e.ShaderCompiler=a.ShaderCompiler,e.Texture=n.Texture,e.VertexArrayObject=c.VertexArrayObject,e.glslifyDefineMap=l.glslifyDefineMap,e.createProgram=h.createProgram,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});