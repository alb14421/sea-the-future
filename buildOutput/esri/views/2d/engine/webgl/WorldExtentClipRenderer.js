// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/maybe","../../../../core/libs/gl-matrix-2/math/common","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./definitions","./VertexStream","./shaders/StencilPrograms","../../../webgl/ProgramTemplate"],function(t,e,i,s,r,a,n,o,l,c,d,h){"use strict";const m=a.fromValues(-.5,-.5);t.WorldExtentRenderer=class{constructor(){this._centerNdc=o.create(),this._pxToNdc=o.create(),this._worldDimensionsPx=o.create(),this._mat3=r.create(),this._initialized=!1}dispose(){this._program=e.disposeMaybe(this._program),this._quad=e.disposeMaybe(this._quad)}render(t,e,i){const{context:s}=t,r=this._updateGeometry(t,i);if(null!=e){const{r:t,g:i,b:r,a}=e;s.setClearColor(a*t/255,a*i/255,a*r/255,a)}else s.setClearColor(0,0,0,0);if(s.setStencilFunction(519,0,255),s.setStencilWriteMask(255),!r)return s.setClearStencil(l.backbufferStencilVisible),void s.clear(17408);s.setClearStencil(l.backbufferStencilClipped),s.clear(17408),this._initialized||this._initialize(s),s.setDepthWriteEnabled(!1),s.setDepthTestEnabled(!1),s.setColorMask(!1,!1,!1,!1),s.setBlendingEnabled(!1),s.setStencilOp(7680,7680,7681),s.setStencilFunction(519,l.backbufferStencilVisible,255),s.setStencilTestEnabled(!0),s.useProgram(this._program),this._program.setUniformMatrix3fv("u_worldExtent",this._mat3),this._quad.bind(),this._quad.draw(),this._quad.unbind()}_initialize(t){this._initialized||(this._quad=new c(t,[0,0,1,0,0,1,1,1]),this._program=h.createProgram(t,d.stencil,this._quad.locations),this._initialized=!0)}_updateGeometry(t,e){const{state:r,pixelRatio:a}=t,{size:o,rotation:l}=r,c=Math.round(o[0]*a),d=Math.round(o[1]*a);if(!r.spatialReference.isWrappable)return!1;const h=i.toRadian(l),u=Math.abs(Math.cos(h)),_=Math.abs(Math.sin(h)),b=Math.round(c*u+d*_),f=Math.round(a*r.worldScreenWidth);if(b<=f)return!1;const p=c*_+d*u,g=(e.left-e.right)*a/c,x=(e.bottom-e.top)*a/d;n.set(this._worldDimensionsPx,f,p,1),n.set(this._pxToNdc,2/c,-2/d,1),n.set(this._centerNdc,g,x,1);const S=this._mat3;return s.fromTranslation(S,this._centerNdc),s.scale(S,S,this._pxToNdc),0!==l&&s.rotate(S,S,h),s.scale(S,S,this._worldDimensionsPx),s.translate(S,S,m),!0}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});