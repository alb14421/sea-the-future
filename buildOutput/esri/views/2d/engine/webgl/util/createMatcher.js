// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../layers/support/streamLayerUtils","./DictionaryMatcher","./IntervalMatcher","./LabelMatcher","./MapMatcher","./Matcher"],function(e,t,r,a,c,s,n){"use strict";async function h(e,t){switch(t.type){case"simple":case"heatmap":case"dot-density":case"pie-chart":return n.FeatureMatcher.from(e,t);case"interval":return a.IntervalMatcher.fromIntervalSchema(e,t);case"dictionary":return r.DictionaryMatcher.fromDictionaryRenderer(e,t);case"label":return c.LabelMatcher.fromLabelSchema(e,t);case"map":return s.MapMatcher.fromMatcherSchema(e,t);case"subtype":return i.fromSubtypes(e,t);case"cluster":return u.fromClusterSchema(e,t);case"track":return o.fromTrackSchema(e,t);default:throw new Error("Impl")}}class i extends n.FeatureMatcher{constructor(e,t){super(),this._subMatchers=e,this._subtypeField=t}static async fromSubtypes(e,t){const r=new Map,a=[];for(const c in t.renderers){const s=parseInt(c,10),n=h(e,t.renderers[c]).then(e=>r.set(s,e));a.push(n)}return await Promise.all(a),new i(r,t.subtypeField)}match(e,t,r){const a=e.readAttribute(this._subtypeField),c=this._subMatchers.get(a);return c?c.match(e,t,r):null}hasArcadeDependency(e){for(const t of this._subMatchers.values())if(t.hasArcadeDependency(e))return!0;return!1}}class u extends n.FeatureMatcher{static async fromClusterSchema(e,t){const[r,a]=await Promise.all([h(e,t.feature),h(e,t.cluster)]);return new u(r,a)}constructor(e,t){super(),this._featureMatcher=e,this._clusterMatcher=t}match(e,t,r){return 1===e.readAttribute("cluster_count")?this._featureMatcher.match(e,t,r):this._clusterMatcher.match(e,t,r)}hasArcadeDependency(e){return this._featureMatcher.hasArcadeDependency(e)||this._clusterMatcher.hasArcadeDependency(e)}}class o extends n.FeatureMatcher{static async fromTrackSchema(e,t){const[r,a,c]=await Promise.all([h(e,t.previousObservation),h(e,t.latestObservation),h(e,t.trackLine)]);return new o(r,a,c)}constructor(e,t,r){super(),this._previousObservationMatcher=e,this._latestObservationMatcher=t,this._trackLineMatcher=r}match(e,r,a){switch(e.readAttribute(t.internalTrackPartField)){case 0:return this._trackLineMatcher.match(e,r,a);case 1:return this._latestObservationMatcher.match(e,r,a);case 2:return this._previousObservationMatcher.match(e,r,a)}return null}hasArcadeDependency(e){return this._trackLineMatcher.hasArcadeDependency(e)||this._latestObservationMatcher.hasArcadeDependency(e)||this._previousObservationMatcher.hasArcadeDependency(e)}}e.ClusterMatcher=u,e.SubtypeMatcher=i,e.createMatcher=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});