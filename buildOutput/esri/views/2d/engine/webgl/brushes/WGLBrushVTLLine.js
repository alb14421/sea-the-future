// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../definitions","./WGLBrush","../../../../webgl/enums"],function(e,t,i,n){"use strict";e.WGLBrushVTLLine=class extends i{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,i){const{context:a,displayLevel:r,state:s,painter:o,pixelRatio:l,spriteMosaic:u,styleLayerUID:f,requestRender:d,allowDelayedRender:c}=e;if(!i.some(e=>e.layerData.get(f)?.lineIndexCount??!1))return;const p=e.styleLayer,g=p.lineMaterial,y=o.vectorTilesMaterialManager,m=p.getPaintValue("line-translate",r),v=p.getPaintValue("line-translate-anchor",r),M=p.getPaintProperty("line-pattern"),U=void 0!==M,T=U&&M.isDataDriven;let S,_;if(U&&!T){const e=M.getValue(r);S=u.getMosaicItemPosition(e)}let x=!1;if(!U){const e=p.getPaintProperty("line-dasharray");if(_=void 0!==e,x=_&&e.isDataDriven,_&&!x){const t=e.getValue(r),i=p.getDashKey(t,p.getLayoutValue("line-cap",r));S=u.getMosaicItemPosition(i)}}const P=1/l,E=this._programOptions;E.pattern=U,E.sdf=_;const D=y.getMaterialProgram(a,g,E);if(c&&null!=d&&!D.compiled)return void d();if(a.useProgram(D),D.setUniformMatrix3fv("u_displayViewMat3",s.displayViewMat3),D.setUniformMatrix3fv("u_displayMat3",1===v?s.displayMat3:s.displayViewMat3),D.setUniform2fv("u_lineTranslation",m),D.setUniform1f("u_depth",p.z),D.setUniform1f("u_antialiasing",P),S&&null!=S){const{page:e}=S,i=u.getPageSize(e);null!=i&&(u.bind(a,9729,e,t.vtlTextureBindingUnitSprites),D.setUniform2fv("u_mosaicSize",i),D.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites))}let I=-1;for(const e of i){if(!e.layerData.has(f))continue;e.key.level!==I&&(I=e.key.level,g.setDataUniforms(D,r,p,I,u));const i=2**(r-I)/l;D.setUniform1f("u_zoomFactor",i);const s=e.layerData.get(f);if(!s.lineIndexCount)continue;s.prepareForRendering(a);const o=s.vao;if(null!=o){if(a.bindVAO(o),D.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),a.setStencilFunction(514,e.stencilRef,255),T||x){const e=s.patternMap;if(!e)continue;for(const[i,r]of e){const e=u.getPageSize(i);null!=e&&(u.bind(a,9729,i,t.vtlTextureBindingUnitSprites),D.setUniform2fv("u_mosaicSize",e),D.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites),a.drawElements(n.PrimitiveType.TRIANGLES,r[1],n.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r[0]))}}else a.drawElements(n.PrimitiveType.TRIANGLES,s.lineIndexCount,n.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*s.lineIndexStart);e.triangleCount+=s.lineIndexCount/3}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});