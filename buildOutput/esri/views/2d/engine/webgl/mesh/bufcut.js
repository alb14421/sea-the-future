// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/has"],function(e,n){"use strict";function t(e,n,t,x,r,i,u){let f;if(u===function(e,n,t,x,r,i){let u=0;for(let t=x,o=r-i;t<r;t+=i)u+=(e[o+n*i]-e[t+n*i])*(e[t+1+n*i]+e[o+1+n*i]),o=t;return u}(e,n,0,x,r,i)>0)for(let t=x;t<r;t+=i)f=o(t+n*i,e[t+n*i],e[t+1+n*i],f);else for(let t=r-i;t>=x;t-=i)f=o(t+n*i,e[t+n*i],e[t+1+n*i],f);return f&&Z(f,f.next)&&(l(f),f=f.next),f}function x(e,n=e){if(!e)return e;let t,x=e;do{if(t=!1,x.steiner||!Z(x,x.next)&&0!==c(x.prev,x,x.next))x=x.next;else{if(l(x),x=n=x.prev,x===x.next)break;t=!0}}while(t||x!==n);return n}function r(e,n,t,o,f,y,c,v){if(!e)return;!v&&y&&(e=p(e,o,f,y));let s=e;for(;e.prev!==e.next;){const p=e.prev,d=e.next;if(y?u(e,o,f,y):i(e))n.push(p.index/t+c),n.push(e.index/t+c),n.push(d.index/t+c),l(e),e=d.next,s=d.next;else if((e=d)===s){v?1===v?r(e=w(e,n,t,c),n,t,o,f,y,c,2):2===v&&z(e,n,t,o,f,y,c):r(x(e),n,t,o,f,y,c,1);break}}}function i(e){const n=e.prev,t=e,x=e.next;if(c(n,t,x)>=0)return!1;let r=e.next.next;const i=r;let u=0;for(;r!==e.prev&&(0===u||r!==i);){if(u++,s(n.x,n.y,t.x,t.y,x.x,x.y,r.x,r.y)&&c(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function u(e,n,t,x){const r=e.prev,i=e,u=e.next;if(c(r,i,u)>=0)return!1;const o=r.x<i.x?r.x<u.x?r.x:u.x:i.x<u.x?i.x:u.x,l=r.y<i.y?r.y<u.y?r.y:u.y:i.y<u.y?i.y:u.y,f=r.x>i.x?r.x>u.x?r.x:u.x:i.x>u.x?i.x:u.x,y=r.y>i.y?r.y>u.y?r.y:u.y:i.y>u.y?i.y:u.y,p=h(o,l,n,t,x),v=h(f,y,n,t,x);let d=e.prevZ,Z=e.nextZ;for(;d&&d.z>=p&&Z&&Z.z<=v;){if(d!==e.prev&&d!==e.next&&s(r.x,r.y,i.x,i.y,u.x,u.y,d.x,d.y)&&c(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,Z!==e.prev&&Z!==e.next&&s(r.x,r.y,i.x,i.y,u.x,u.y,Z.x,Z.y)&&c(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}for(;d&&d.z>=p;){if(d!==e.prev&&d!==e.next&&s(r.x,r.y,i.x,i.y,u.x,u.y,d.x,d.y)&&c(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;Z&&Z.z<=v;){if(Z!==e.prev&&Z!==e.next&&s(r.x,r.y,i.x,i.y,u.x,u.y,Z.x,Z.y)&&c(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}return!0}function o(e,n,t,x){const r=m.create(e,n,t);return x?(r.next=x.next,r.prev=x,x.next.prev=r,x.next=r):(r.prev=r,r.next=r),r}function l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function f(e){let n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function y(e,n){const t=function(e,n){let t=n;const x=e.x,r=e.y;let i,u=-1/0;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const e=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(e<=x&&e>u){if(u=e,e===x){if(r===t.y)return t;if(r===t.next.y)return t.next}i=t.x<t.next.x?t:t.next}}t=t.next}while(t!==n);if(!i)return null;if(x===u)return i.prev;const o=i,l=i.x,f=i.y;let y,p=1/0;for(t=i.next;t!==o;)x>=t.x&&t.x>=l&&x!==t.x&&s(r<f?x:u,r,l,f,r<f?u:x,r,t.x,t.y)&&(y=Math.abs(r-t.y)/(x-t.x),(y<p||y===p&&t.x>i.x)&&d(t,e)&&(i=t,p=y)),t=t.next;return i}(e,n);if(!t)return n;const r=b(t,e);return x(r,r.next),x(t,t.next)}function p(e,n,t,x){let r;for(;r!==e;r=r.next){if(r=r||e,null===r.z&&(r.z=h(r.x,r.y,n,t,x)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,p(e,n,t,x);r.prevZ=r.prev,r.nextZ=r.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){let n,t=1;for(;;){let x,r=e;e=null,n=null;let i=0;for(;r;){i++,x=r;let u=0;for(;u<t&&x;u++)x=x.nextZ;let o=t;for(;u>0||o>0&&x;){let t;0===u?(t=x,x=x.nextZ,o--):0!==o&&x?r.z<=x.z?(t=r,r=r.nextZ,u--):(t=x,x=x.nextZ,o--):(t=r,r=r.nextZ,u--),n?n.nextZ=t:e=t,t.prevZ=n,n=t}r=x}if(n.nextZ=null,t*=2,i<2)return e}}(e)}function c(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function v(e,n,t,x){return!!(Z(e,n)&&Z(t,x)||Z(e,x)&&Z(t,n))||c(e,n,t)>0!=c(e,n,x)>0&&c(t,x,e)>0!=c(t,x,n)>0}function s(e,n,t,x,r,i,u,o){return(r-u)*(n-o)-(e-u)*(i-o)>=0&&(e-u)*(x-o)-(t-u)*(n-o)>=0&&(t-u)*(i-o)-(r-u)*(x-o)>=0}function d(e,n){return c(e.prev,e,e.next)<0?c(e,n,e.next)>=0&&c(e,e.prev,n)>=0:c(e,n,e.prev)<0||c(e,e.next,n)<0}function h(e,n,t,x,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-t)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-x)*r)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Z(e,n){return e.x===n.x&&e.y===n.y}function a(e,n){return e.x-n.x}function w(e,n,t,x){let r=e;do{const i=r.prev,u=r.next.next;!Z(i,u)&&v(i,r,r.next,u)&&d(i,u)&&d(u,i)&&(n.push(i.index/t+x),n.push(r.index/t+x),n.push(u.index/t+x),l(r),l(r.next),r=e=u),r=r.next}while(r!==e);return r}function z(e,n,t,i,u,o,l){let f=e;do{let e=f.next.next;for(;e!==f.prev;){if(f.index!==e.index&&M(f,e)){let y=b(f,e);return f=x(f,f.next),y=x(y,y.next),r(f,n,t,i,u,o,l,0),void r(y,n,t,i,u,o,l,0)}e=e.next}f=f.next}while(f!==e)}function M(e,n){return e.next.index!==n.index&&e.prev.index!==n.index&&!function(e,n){let t=e;do{if(t.index!==e.index&&t.next.index!==e.index&&t.index!==n.index&&t.next.index!==n.index&&v(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}(e,n)&&d(e,n)&&d(n,e)&&function(e,n){let t=e,x=!1;const r=(e.x+n.x)/2,i=(e.y+n.y)/2;do{t.y>i!=t.next.y>i&&t.next.y!==t.y&&r<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(x=!x),t=t.next}while(t!==e);return x}(e,n)}function b(e,n){const t=m.create(e.index,e.x,e.y),x=m.create(n.index,n.x,n.y),r=e.next,i=n.prev;return e.next=n,n.prev=e,t.next=r,r.prev=t,x.next=t,t.prev=x,i.next=x,x.prev=i,x}class m{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(e,n,t){const x=k<g.length?g[k++]:new m;return x.index=e,x.x=n,x.y=t,x.prev=null,x.next=null,x.z=null,x.prevZ=null,x.nextZ=null,x.steiner=!1,x}}const g=[];let k=0;for(let e=0;e<8096;e++)g.push(new m);e.bufcut=function(e,n,x,i,u,o,l){k=0;const p=(i-x)*o,c=u&&u.length,v=c?(u[0]-x)*o:p;let s,d,h,Z,w,z=t(n,x,0,0,v,o,!0);if(z&&z.next!==z.prev){if(c&&(z=function(e,n,x,r,i,u){const o=new Array;for(let i=0,l=r.length;i<l;i++){const y=t(e,n,0,r[i]*u,i<l-1?r[i+1]*u:x*u,u,!1);y===y.next&&(y.steiner=!0),o.push(f(y))}o.sort(a);for(const e of o)i=y(e,i);return i}(n,x,i,u,z,o)),p>80*o){s=h=n[0+x*o],d=Z=n[1+x*o];for(let e=o;e<v;e+=o){const t=n[e+x*o],r=n[e+1+x*o];s=Math.min(s,t),d=Math.min(d,r),h=Math.max(h,t),Z=Math.max(Z,r)}w=Math.max(h-s,Z-d),w=0!==w?1/w:0}r(z,e,o,s,d,w,l,0)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});