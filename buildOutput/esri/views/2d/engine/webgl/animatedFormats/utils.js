// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/handleUtils","../../../../../core/time","../grouping"],function(e,t,i,r){"use strict";function n(e){return i.Milliseconds(e.frameDurations.reduce((e,t)=>e+t,0))}function a(e){const{width:t,height:i}=e,r=e.frameDurations.reverse();return{frameCount:e.frameCount,duration:e.duration,frameDurations:r,getFrame:t=>{const i=e.frameDurations.length-1-t;return e.getFrame(i)},width:t,height:i}}function o(e,t){const{width:r,height:n,getFrame:a}=e,o=t/e.duration,s=e.frameDurations.map(e=>i.Milliseconds(e*o));return{frameCount:e.frameCount,duration:e.duration,frameDurations:s,getFrame:a,width:r,height:n}}function s(e,t){const{width:r,height:n,getFrame:a}=e,o=e.frameDurations.slice(),s=o.shift();return o.unshift(i.Milliseconds(s+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:o,getFrame:a,width:r,height:n}}function m(e,t){const{width:r,height:n,getFrame:a}=e,o=e.frameDurations.slice(),s=o.pop();return o.push(i.Milliseconds(s+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:o,getFrame:a,width:r,height:n}}class u{constructor(e,t,i,r){this._animation=e,this._repeatType=i,this._onFrameData=r,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let n=0;for(;t>n;)n+=this.timeToFrame,this.nextFrame();const a=this._animation.getFrame(this._currentFrame);this._onFrameData(a)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case"None":this._currentFrame-=this._direction;break;case"Loop":this._currentFrame=0;break;case"Oscillate":this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case"None":this._currentFrame-=this._direction;break;case"Loop":this._currentFrame=this._animation.frameDurations.length-1;break;case"Oscillate":this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const e=this._animation.getFrame(this._currentFrame);this._onFrameData(e)}}function c(e,t,c,h){let l,{repeatType:d}=t;if(null==d&&(d="Loop"),!0===t.reverseAnimation&&(e=a(e)),null!=t.duration&&(e=o(e,i.Milliseconds(1e3*t.duration))),null!=t.repeatDelay){const r=1e3*t.repeatDelay;"Loop"===d?e=m(e,i.Milliseconds(r)):"Oscillate"===d&&(e=s(m(e,i.Milliseconds(r/2)),i.Milliseconds(r/2)))}if(null!=t.startTimeOffset)l=i.Milliseconds(1e3*t.startTimeOffset);else if(null!=t.randomizeStartTime){const a=82749913,o=null!=t.randomizeStartSeed?t.randomizeStartSeed:a,s=r.getRandomValue(c,o);l=i.Milliseconds(s*n(e))}else l=i.Milliseconds(0);return new u(e,l,d,h)}e.Player=u,e.adjustDuration=o,e.appendDelay=m,e.createPlayer=c,e.getDuration=n,e.play=function(e,i,r,n){const a=null==i.playAnimation||i.playAnimation,o=c(e,i,r,n);let s,m=o.timeToFrame;return function e(){s=a?setTimeout(()=>{o.nextFrame(),m=o.timeToFrame,e()},m):void 0}(),t.makeHandle(()=>a&&clearTimeout(s))},e.prependDelay=s,e.reverse=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});