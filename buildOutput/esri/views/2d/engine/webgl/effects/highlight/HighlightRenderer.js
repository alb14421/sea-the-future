// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../definitions","./parameters","../../shaders/HighlightPrograms","../../../../../webgl/enums","../../../../../webgl/ProgramTemplate","../../../../../webgl/VertexArrayObject","../../../../../webgl/VertexBuffer","../../../../../webgl/VertexElementDescriptor"],function(e,r,i,t,s,o,h,u){"use strict";return class{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(i,s){i.bindTexture(s,e.textureBindingHighlight0),i.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",r.alphaToRgbaChannelSelectorMatrix),i.bindVAO(this._resources.quadVAO),i.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,4),i.bindVAO(null)}finalBlur(i,s){i.bindTexture(s,e.textureBindingHighlight0),i.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",r.rgbaToRgbaChannelSelectorMatrix),i.bindVAO(this._resources.quadVAO),i.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,4),i.bindVAO(null)}renderHighlight(r,i,s){r.bindTexture(i,e.textureBindingHighlight0),r.useProgram(this._resources.highlightProgram),s.applyHighlightOptions(r,this._resources.highlightProgram),r.bindVAO(this._resources.quadVAO),r.setBlendingEnabled(!0),r.setBlendFunction(1,771),r.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,4),r.bindVAO(null)}_initialize(n,a,g){this._width=a,this._height=g;const l=new h.VertexBuffer(n,[new u.VertexElementDescriptor("a_position",2,t.DataType.BYTE,0,4),new u.VertexElementDescriptor("a_texcoord",2,t.DataType.BYTE,2,4)],new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),d=new o.VertexArrayObject(n,l),c=s.createProgram(n,i.highlight,d.locations),m=s.createProgram(n,i.blur,d.locations);n.useProgram(c),c.setUniform1i("u_texture",e.textureBindingHighlight0),c.setUniform1i("u_shade",e.textureBindingHighlight1),c.setUniform1f("u_sigma",r.sigma),n.useProgram(m),m.setUniform1i("u_texture",e.textureBindingHighlight0),m.setUniform1f("u_sigma",r.sigma),this._resources={quadGeometry:l,quadVAO:d,highlightProgram:c,blurProgram:m}}setup(e,r,i){this._resources?(this._width=r,this._height=i):this._initialize(e,r,i)}}});