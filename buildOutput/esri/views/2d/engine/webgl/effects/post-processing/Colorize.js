// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../core/maybe","../../VertexStream","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],function(e,t,s,r,i){"use strict";e.Colorize=class{constructor(){this._layerFBOTexture=null,this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",locations:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture=t.disposeMaybe(this._layerFBOTexture)}draw(e,t,s){const{width:r,height:i}=t;this._createOrResizeResources(e,r,i);const{context:o,painter:n}=e,{materialManager:a}=n,c=this._programDesc,l=this._quad,u=s.colorMatrix;l.bind();const h=this._layerFBOTexture;o.bindFramebuffer(t),t.copyToTexture(0,0,r,i,0,0,h),o.setBlendingEnabled(!1),o.setStencilTestEnabled(!1);const d=a.getProgram(c);o.useProgram(d),o.bindTexture(h,2),d.setUniformMatrix4fv("u_coefficients",u),d.setUniform1i("u_colorTexture",2),l.draw(),o.setBlendingEnabled(!0),o.setBlendFunction(1,771),o.setStencilTestEnabled(!0),l.unbind()}_createOrResizeResources(e,t,o){const{context:n}=e;if(!this._layerFBOTexture||this._size[0]!==t||this._size[1]!==o){if(this._size[0]=t,this._size[1]=o,this._layerFBOTexture)this._layerFBOTexture.resize(t,o);else{const e=new i.TextureDescriptor(t,o);e.internalFormat=6408,e.wrapMode=33071,this._layerFBOTexture=new r.Texture(n,e)}this._quad||(this._quad=new s(n,[-1,-1,1,-1,-1,1,1,1]))}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});