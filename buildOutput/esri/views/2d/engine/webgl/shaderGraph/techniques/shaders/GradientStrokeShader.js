// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../chunks/tslib.es6","../../../../../../../core/has","../../GraphShaderModule","../../graph/glsl","../line/gradientStrokeConstants","./AFeatureShader","./LineShader","./MosaicInfo","./utils"],function(t,e,i,o,a,n,r,s,l,d){"use strict";class c extends s.LineVertexInput{}e.__decorate([o.location(9,a.Float)],c.prototype,"accumulatedDistance",void 0),e.__decorate([o.location(10,a.Float)],c.prototype,"totalLength",void 0),e.__decorate([o.location(11,a.Float)],c.prototype,"gradientSize",void 0),e.__decorate([o.location(12,a.Vec2)],c.prototype,"segmentDirection",void 0),e.__decorate([o.location(13,a.Vec4)],c.prototype,"tlbr",void 0);class p extends s.LineFragmentInput{}class u extends o.UniformGroup{}e.__decorate([o.uniform(a.Float)],u.prototype,"isColorPass",void 0);class g extends s.LineShader{constructor(){super(...arguments),this.type="GradientStrokeShader"}vertex(t,e){const{totalLength:i,gradientSize:o,segmentDirection:r,tlbr:l}=t,c=s.getLineVertexData(this,t),p=d.getBit(t.bitset,n.bitset.isAlongLine),u=i.divide(this.view.displayZoomFactor),g=a.ifElse(d.getBitBool(t.bitset,n.bitset.isAbsoluteSize),()=>{const t=a.ifElse(a.greaterThan(p,new a.Float(.5)),u,c.halfWidth);return o.divide(t)},o),h=t.accumulatedDistance.add(a.dot(r,c.scaledOffset).divide(u)),m=l.divide(this.mosaicInfo.size.xyxy);return{...c,tlbr:m,relativePositionAlongLine:h,relativeGradientSize:g,isAlongLine:d.getBit(t.bitset,n.bitset.isAlongLine),isDiscrete:d.getBit(t.bitset,n.bitset.isDiscrete),...this.maybeRunHittest(t,e,c.halfWidth)}}fragment(t){const{isAlongLine:e,isDiscrete:o,relativePositionAlongLine:n,relativeGradientSize:r,normal:l,tlbr:c}=t,p=s.getLineAntialiasing(t,this.antialiasingControls.blur),u=(g=l.y,a.step(new a.Float(0),g).multiply(2).subtract(1)).multiply(a.min(a.length(l),new a.Float(1)));var g;const h=new a.Float(.5).multiply(u).add(new a.Float(.5)),m=a.ifElse(a.greaterThan(e,new a.Float(.5)),n,h),y=a.ifElse(a.greaterThan(o,new a.Float(.5)),r.subtract(1),new a.Float(0)),F=d.oneMinus(m.add(y).divide(r)),b=a.mix(c.xy,c.zw,new a.Vec2(a.clamp(F,new a.Float(0),new a.Float(1)),.5)),v=a.texture2D(this.mosaicInfo.texture,b),_=t.opacity.multiply(p),f=this.getFragmentOutput(v.multiply(_),t),w=a.step(new a.Float(.5),this.technique.isColorPass).multiply(i("gradient-depth-epsilon")),S=a.step(new a.Float(0),l.y).multiply(new a.Float(i("gradient-depth-bias")).subtract(w));return f.glFragDepth=a.clamp(a.length(l).add(S),new a.Float(0),new a.Float(1)),f}}e.__decorate([o.uniform(l.MosaicInfo)],g.prototype,"mosaicInfo",void 0),e.__decorate([o.uniform(u)],g.prototype,"technique",void 0),e.__decorate([e.__param(0,o.input(c)),e.__param(1,o.input(r.BaseHittestVertexInput))],g.prototype,"vertex",null),t.GradientStrokeFragmentInput=p,t.GradientStrokeShader=g,t.GradientStrokeVertexInput=c,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});