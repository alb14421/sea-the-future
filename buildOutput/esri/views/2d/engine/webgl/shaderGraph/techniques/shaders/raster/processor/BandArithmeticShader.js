// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../../../chunks/tslib.es6","../../../../GraphShaderModule","../../../../graph/glsl","../../utils","./BaseRasterProcessorShader","./math"],function(t,e,u,r,a,l,i){"use strict";class s extends u.UniformGroup{}e.__decorate([u.uniform(r.Mat3)],s.prototype,"bandIndexMat3",void 0);class n extends u.UniformGroup{}e.__decorate([u.uniform(r.Vec3)],n.prototype,"adjustments",void 0);class d extends l.BaseRasterProcessorShader{constructor(){super(...arguments),this.type="BandArithmeticShader",this.isOutputRounded=!1}_process(t){const e=this._getPixel(t),u=this.bandArithmeticConfig.bandIndexMat3.multiply(e.rgb),a=this._processIndex(u),l=new r.Vec4(a,a,a,e.a);return this.isOutputRounded?i.roundOutput(l):l}_processIndex(t){const{r:e,g:u}=t,l=this.adjustmentConfig?.adjustments;switch(this.indexType){case"ndxi":{const t=e.subtract(u),r=e.add(u);return t.multiply(i.invertValue(r))}case"sr":return e.multiply(i.invertValue(u));case"ci":return e.multiply(i.invertValue(u)).subtract(1);case"savi":{const{x:t}=l,r=e.subtract(u),a=e.add(u).add(t);return r.multiply(i.invertValue(a)).multiply(t.add(1))}case"tsavi":{const{x:t,y:r,z:a}=l,s=a.multiply(t.multiply(t).add(1)).subtract(r.multiply(t)),n=t.multiply(e.subtract(t.multiply(u)).subtract(r)),d=r.multiply(e).add(u).add(s);return n.multiply(i.invertValue(d))}case"msavi":{const t=e.multiply(2).add(1),a=t.multiply(t).subtract(e.subtract(u).multiply(8));return t.subtract(r.sqrt(a)).multiply(.5)}case"gemi":{const t=e.multiply(e).subtract(u.multiply(u)).multiply(2).add(e.multiply(1.5)).add(u.multiply(.5)),r=e.add(u).add(.5),l=t.multiply(i.invertValue(r)),s=l.multiply(a.oneMinus(l.multiply(.25))),n=u.subtract(.125).multiply(i.invertValue(a.oneMinus(u)));return s.subtract(n)}case"pvi":{const{x:t,y:a}=l,s=r.sqrt(t.multiply(t).add(1));return e.subtract(u.multiply(t)).subtract(a).multiply(i.invertValue(s))}case"vari":{const e=t.g.subtract(t.r),u=t.g.add(t.r).subtract(t.b);return e.multiply(i.invertValue(u))}case"rtvicore":return e.subtract(u).multiply(100).subtract(e.subtract(t.b).multiply(10));case"bai":{const t=r.pow(new r.Float(.1).subtract(u),new r.Float(2)),a=r.pow(new r.Float(.06).subtract(e),new r.Float(2));return i.invertValue(t.add(a))}case"evi":{const r=t.b,a=e.add(u.multiply(6)).subtract(r.multiply(7.5)).add(1);return e.subtract(u).multiply(2.5).multiply(i.invertValue(a))}case"wndwi":{const{r:e,g:u,b:r}=t,a=l.x,s=a.multiply(u),n=a.multiply(r),d=e.add(s).add(r).subtract(n);return e.subtract(s).subtract(r).add(n).multiply(i.invertValue(d))}case"mtvi":{const a=t.b,l=r.pow(e.multiply(2).add(1),new r.Float(2)),s=e.multiply(6).subtract(r.sqrt(u).multiply(5)),n=r.sqrt(l.subtract(s).subtract(.5)),d=e.subtract(a).multiply(1.2),c=u.subtract(a).multiply(2.5);return d.subtract(c).multiply(1.5).multiply(i.invertValue(n))}default:return e}}}e.__decorate([u.define],d.prototype,"indexType",void 0),e.__decorate([u.define],d.prototype,"isOutputRounded",void 0),e.__decorate([u.uniform(s)],d.prototype,"bandArithmeticConfig",void 0),e.__decorate([u.option(n)],d.prototype,"adjustmentConfig",void 0),t.BandArithmeticShader=d,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});