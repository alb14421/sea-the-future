// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./heatmapUtils","./hittestUtils"],function(t,e,i,a,o,s,l){"use strict";class r extends o.FeatureVertexInput{}e.__decorate([i.location(5,a.Vec2)],r.prototype,"offset",void 0);class n extends o.FeatureFragmentInput{}class u extends i.UniformGroup{}e.__decorate([i.uniform(a.Float)],u.prototype,"radius",void 0),e.__decorate([i.uniform(a.Float)],u.prototype,"isFieldActive",void 0);class p extends o.AFeatureShader{constructor(){super(...arguments),this.type="HeatmapAccumulateShader",this.usesHalfFloatPrecision=!1}vertex(t){const{radius:e,isFieldActive:i}=this.kernelControls,o=t.offset,s=i.multiply(this.storage.getVVData(t.id).x).add(new a.Float(1).subtract(i)),l=this.view.displayViewScreenMat3.multiply(new a.Vec3(t.pos,1)).add(this.view.displayViewMat3.multiply(new a.Vec3(o,0)).multiply(e)),r=this.clip(t.id);return{glPosition:new a.Vec4(l.xy,r,1),offset:o,fieldValue:s,color:new a.Vec4(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:e,fieldValue:i}=t,o=a.length(e),l=a.step(o,new a.Float(1)),r=new a.Float(1).subtract(o.multiply(o)),n=r.multiply(r),u=l.multiply(n).multiply(i).multiply(new a.Float(s.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new a.Vec4(u),t)}hittest(t){const{viewMat3:e,tileMat3:i}=this.view,o=e.multiply(i).multiply(new a.Vec3(t.pos,1));return l.hittestMarker(o.xy,this.kernelControls.radius,this.hittestRequest.position)}}e.__decorate([i.define],p.prototype,"usesHalfFloatPrecision",void 0),e.__decorate([i.uniform(u)],p.prototype,"kernelControls",void 0),e.__decorate([e.__param(0,i.input(r))],p.prototype,"vertex",null),e.__decorate([e.__param(0,i.input(n))],p.prototype,"fragment",null),t.HeatmapAccumulateFragmentInput=n,t.HeatmapAccumulateShader=p,t.HeatmapAccumulateVertexInput=r,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});