// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,t,l,n,o){"use strict";class a extends l.VertexInput{}t.__decorate([l.location(0,n.Vec2)],a.prototype,"position",void 0);class i extends l.FragmentInput{}class r extends l.UniformGroup{}t.__decorate([l.uniform(n.Sampler2D)],r.prototype,"layerTexture",void 0),t.__decorate([l.uniform(n.Sampler2D)],r.prototype,"backbufferTexture",void 0),t.__decorate([l.uniform(n.Float)],r.prototype,"opacity",void 0),t.__decorate([l.uniform(n.Float)],r.prototype,"inFadeOpacity",void 0);class u extends l.GraphShaderModule{constructor(){super(...arguments),this.type="BlendShader"}vertex(e){return{uv:e.position,glPosition:new n.Vec4(o.uvToClip(e.position),0,1)}}fragment(e){const t=new l.FragmentOutput,a=n.texture2D(this.config.layerTexture,e.uv),i=n.texture2D(this.config.backbufferTexture,e.uv),r=n.ifElse(n.equal(a.a,new n.Float(0)),a.rgb,a.rgb.divide(a.a)),u=n.ifElse(n.equal(i.a,new n.Float(0)),i.rgb,i.rgb.divide(i.a)),b=this.config.opacity.multiply(a.a),f=i.a;switch(this.blendMode){case"destination-over":t.fragColor=new n.Vec4(r.multiply(b).multiply(o.oneMinus(f)).add(u.multiply(f)),b.add(f).subtract(b.multiply(f)));break;case"source-in":{const e=new n.Vec4(r.multiply(b).multiply(f),b.multiply(f)),l=new n.Vec4(u.multiply(f),f).multiply(o.oneMinus(this.config.opacity)).multiply(this.config.inFadeOpacity);t.fragColor=e.add(l)}break;case"destination-in":{const e=new n.Vec4(u.multiply(f).multiply(b),f.multiply(b)),l=new n.Vec4(u.multiply(f),f).multiply(new n.Vec4(o.oneMinus(this.config.opacity).multiply(this.config.inFadeOpacity)));t.fragColor=e.add(l)}break;case"source-out":t.fragColor=new n.Vec4(r.multiply(b).multiply(o.oneMinus(f)),b.multiply(o.oneMinus(f)));break;case"destination-out":t.fragColor=new n.Vec4(u.multiply(f).multiply(o.oneMinus(b)),f.multiply(o.oneMinus(b)));break;case"source-atop":t.fragColor=new n.Vec4(r.multiply(b).multiply(f).add(u.multiply(f.multiply(o.oneMinus(b)))),f);break;case"destination-atop":t.fragColor=new n.Vec4(r.multiply(b.multiply(o.oneMinus(f))).add(u.multiply(f).multiply(b)),b);break;case"xor":t.fragColor=new n.Vec4(r.multiply(b.multiply(o.oneMinus(f))).add(u.multiply(f.multiply(o.oneMinus(b)))),b.multiply(o.oneMinus(f)).add(f.multiply(o.oneMinus(b))));break;case"multiply":t.fragColor=new n.Vec4(r.multiply(b).multiply(u.multiply(f)).add(r.multiply(b).multiply(o.oneMinus(f))).add(u.multiply(f).multiply(o.oneMinus(b))),b.add(f.multiply(o.oneMinus(b))));break;case"screen":t.fragColor=new n.Vec4(r.add(u).subtract(r.multiply(u)).multiply(b.multiply(f)).add(r.multiply(b).multiply(o.oneMinus(f))).add(u.multiply(f).multiply(o.oneMinus(b))),b.add(f.multiply(o.oneMinus(b))));break;case"overlay":{const e=new n.Vec3(s(u.r,r.r),s(u.g,r.g),s(u.b,r.b));t.fragColor=c(e,r,u,b,f)}break;case"darken":{const e=n.min(r,u);t.fragColor=c(e,r,u,b,f)}break;case"lighter":t.fragColor=new n.Vec4(r.multiply(b).add(u.multiply(f)),b.add(f));break;case"lighten":{const e=n.max(r,u);t.fragColor=c(e,r,u,b,f)}break;case"color-dodge":{const e=n.clamp(new n.Vec3(p(u.r,r.r),p(u.g,r.g),p(u.b,r.b)),new n.Vec3(0),new n.Vec3(1));t.fragColor=c(e,r,u,b,f)}break;case"color-burn":{const e=new n.Vec3(d(u.r,r.r),d(u.g,r.g),d(u.b,r.b));t.fragColor=c(e,r,u,b,f)}break;case"hard-light":{const e=new n.Vec3(m(u.r,r.r),m(u.g,r.g),m(u.b,r.b));t.fragColor=c(e,r,u,b,f)}break;case"soft-light":{const e=new n.Vec3(y(u.r,r.r),y(u.g,r.g),y(u.b,r.b));t.fragColor=c(e,r,u,b,f)}break;case"difference":{const e=n.abs(u.subtract(r));t.fragColor=c(e,r,u,b,f)}break;case"exclusion":{const e=r.add(u).subtract(new n.Float(2).multiply(r).multiply(u));t.fragColor=c(e,r,u,b,f)}break;case"invert":t.fragColor=new n.Vec4(new n.Vec3(1).subtract(u).multiply(b).multiply(f).add(u.multiply(f).multiply(o.oneMinus(b))),f);break;case"vivid-light":{const e=new n.Vec3(n.clamp(w(u.r,r.r),new n.Float(0),new n.Float(1)),n.clamp(w(u.g,r.g),new n.Float(0),new n.Float(1)),n.clamp(w(u.b,r.b),new n.Float(0),new n.Float(1)));t.fragColor=c(e,r,u,b,f)}break;case"hue":{const e=V(r,u,u);t.fragColor=c(e,r,u,b,f)}break;case"saturation":{const e=V(u,r,u);t.fragColor=c(e,r,u,b,f)}break;case"color":{const e=M(r,u);t.fragColor=c(e,r,u,b,f)}break;case"luminosity":{const e=M(u,r);t.fragColor=c(e,r,u,b,f)}break;case"plus":t.fragColor=n.clamp(new n.Vec4(a.r.add(u.r),a.g.add(u.g),a.b.add(u.b),b.add(f)),new n.Vec4(0),new n.Vec4(1));break;case"minus":t.fragColor=new n.Vec4(n.clamp(new n.Vec3(u.r.subtract(a.r),u.g.subtract(a.g),u.b.subtract(a.b)),new n.Vec3(0),new n.Vec3(1)),f.multiply(b));break;case"average":{const e=u.add(r).divide(2);t.fragColor=c(e,r,u,b,f)}break;case"reflect":{const e=n.clamp(new n.Vec3(k(u.r,r.r),k(u.g,r.g),k(u.b,r.b)),new n.Vec3(0),new n.Vec3(1));t.fragColor=c(e,r,u,b,f)}break;default:t.fragColor=a.multiply(this.config.opacity)}return t}}function c(e,t,l,a,i){return new n.Vec4(e.multiply(a).multiply(i).add(t.multiply(a).multiply(o.oneMinus(i))).add(l.multiply(i).multiply(o.oneMinus(a))),a.add(i.multiply(o.oneMinus(a))))}function s(e,t){return new n.Float(1).subtract(n.step(new n.Float(.5),t)).multiply(o.oneMinus(new n.Float(2).multiply(o.oneMinus(t).multiply(o.oneMinus(e))))).add(n.step(new n.Float(.5),t).multiply(new n.Float(2).multiply(t).multiply(e)))}function p(e,t){return n.ifElse(n.equal(e,new n.Float(0)),new n.Float(0),n.ifElse(n.equal(t,new n.Float(1)),new n.Float(1),n.min(new n.Float(1),e.divide(new n.Float(1).subtract(t)))))}function d(e,t){return n.ifElse(n.equal(e,new n.Float(1)),new n.Float(1),n.ifElse(n.equal(t,new n.Float(0)),new n.Float(0),o.oneMinus(n.min(new n.Float(1),o.oneMinus(e).divide(t)))))}function m(e,t){return new n.Float(1).subtract(n.step(new n.Float(.5),t)).multiply(new n.Float(2).multiply(t).multiply(e)).add(n.step(new n.Float(.5),t).multiply(o.oneMinus(new n.Float(2).multiply(o.oneMinus(t).multiply(o.oneMinus(e))))))}function y(e,t){return n.cond([n.lessThanEqual(t,new n.Float(.5)),()=>{const l=new n.Float(2).multiply(t),a=o.oneMinus(l),i=o.oneMinus(e);return e.subtract(a.multiply(e).multiply(i))}],[n.lessThanEqual(e,new n.Float(.25)),()=>{const l=new n.Float(2).multiply(t),a=o.minusOne(l).multiply(e),i=new n.Float(16).multiply(e).subtract(new n.Float(12)).multiply(e).add(new n.Float(3));return e.add(a.multiply(i))}],[!0,()=>{const l=new n.Float(2).multiply(t),a=o.minusOne(l),i=n.sqrt(e).subtract(e);return e.add(a.multiply(i))}])}function w(e,t){const l=o.oneMinus(n.step(new n.Float(.5),t)).multiply(d(e,new n.Float(2).multiply(t))),a=n.step(new n.Float(.5),t).multiply(p(e,new n.Float(2).multiply(o.minusScalar(t,.5))));return l.add(a)}function b(e){return n.min(n.min(e.r,e.g),e.b)}function f(e){return n.max(n.max(e.r,e.g),e.b)}function g(e){return n.dot(e,new n.Vec3(.3,.59,.11))}function F(e){return f(e).subtract(b(e))}function M(e,t){const l=g(e),a=g(t).subtract(l);return function(e){const t=g(e),l=b(e),a=f(e);return n.cond([n.lessThan(l,new n.Float(0)),()=>{const n=e.subtract(t).multiply(t),o=t.subtract(l);return t.add(n.divide(o))}],[n.greaterThan(a,new n.Float(1)),()=>{const l=e.subtract(t),n=o.oneMinus(t),i=l.multiply(n),r=a.subtract(t);return t.add(i.divide(r))}],[!0,e])}(e.add(new n.Vec3(a)))}function V(e,t,l){const o=b(e),a=F(e),i=F(t);return M(n.ifElse(n.greaterThan(a,new n.Float(0)),()=>e.subtract(o).multiply(i).divide(a),new n.Vec3(0)),l)}function k(e,t){return n.ifElse(n.equal(t,new n.Float(1)),t,()=>{const l=o.oneMinus(t),a=e.multiply(e).divide(l);return n.min(a,new n.Float(1))})}t.__decorate([l.define],u.prototype,"blendMode",void 0),t.__decorate([l.uniform(r)],u.prototype,"config",void 0),t.__decorate([t.__param(0,l.input(a))],u.prototype,"vertex",null),t.__decorate([t.__param(0,l.input(i))],u.prototype,"fragment",null),e.BlendShader=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});