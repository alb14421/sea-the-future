// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../core/has","./utils","../../../../../../webgl/enums"],function(t,e,s,a){"use strict";function n(t){switch(t){case a.DataType.BYTE:case a.DataType.UNSIGNED_BYTE:return 1;case a.DataType.SHORT:case a.DataType.UNSIGNED_SHORT:case a.DataType.HALF_FLOAT:return 2;case a.DataType.FLOAT:case a.DataType.INT:case a.DataType.UNSIGNED_INT:return 4}}function o(t){const e=[],s=[],a=[];for(const o of t){const t=n(o.type)*o.count;switch(t%2||t%4||4){case 4:e.push(o);continue;case 2:s.push(o);continue;case 1:a.push(o);continue;default:throw new Error("Found unexpected dataType byte count")}}return e.push(...s),e.push(...a),e}class i{static fromVertexSpec(t,e){const{attributes:s,optionalAttributes:a}=t;let c,r,u;const p=[];for(const t in s){if(s[t].otherSource)continue;const e=s[t];"position"===e.pack?c={...e,name:t,offset:0}:"id"===e.pack?r={...e,name:t,offset:4}:"bitset"===t?u={...e,name:t,offset:7}:p.push({...e,name:t})}for(const t in a)if(!0===e[t]){const e=a[t];p.push({...e,name:t})}const h=o(p),f=[];let y=8,T=1;for(const t of h)f.push({...t,offset:y}),y+=n(t.type)*t.count,t.packAlternating&&(T=Math.max(t.packAlternating.count,T));const b=Uint32Array.BYTES_PER_ELEMENT,d=y%b;return new i(c,r,u,f,y+(d?b-d:0),T)}constructor(t,e,s,a,n,o){this.position=t,this.id=e,this.bitset=s,this.standardAttributes=a,this.stride=n,this.packVertexCount=o,a.push(s),this._attributes=[t,e,s,...a]}get attributeLayout(){if(!this._attributeLayout){const t=s.vertexLayoutHash(this._attributes),e=this._attributes.map(t=>({name:t.name,count:t.count,offset:t.offset,type:t.type,packPrecisionFactor:t.packPrecisionFactor,normalized:t.normalized??!1}));this._attributeLayout={attributes:e,hash:t,stride:this.stride}}return this._attributeLayout}}t.AlignedVertexSpec=i,t.sortByAlignment=o,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});