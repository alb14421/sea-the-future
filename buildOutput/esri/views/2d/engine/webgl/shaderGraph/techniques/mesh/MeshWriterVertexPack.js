// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../number","./AlignedVertexSpec","./dataViewUtils"],function(t,e,s,i){"use strict";class c{static fromVertexSpec(t,e){const i=s.AlignedVertexSpec.fromVertexSpec(t,e);return new c(i)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,e,s,i,c,a){for(let t=0;t<this._spec.packVertexCount;t++){const p=t*this._spec.stride;this._packPosition(s,i,p),this._packId(e,p);const r=this._spec.bitset;if(a){if(r.packTessellation){const t=r.packTessellation(a,c,s,i);this._pack(t,r,p)}for(const t of this._spec.standardAttributes)if(null!=t.packTessellation){const e=t.packTessellation(a,c,s,i);this._pack(e,t,p)}else if(t.packAlternating?.packTessellation){const e=t.packAlternating.packTessellation(a,c,s,i);for(let s=0;s<this._spec.packVertexCount;s++){const i=e[s];this._pack(i,t,s*this._spec.stride)}}}}t.vertexWriteRegion(this._packedU32View)}pack(t,e){for(const s of this._spec.standardAttributes)if(s.pack&&"string"!=typeof s.pack){const i=s.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++)this._pack(i,s,t*this._spec.stride)}else if(s.packAlternating?.pack){const i=s.packAlternating.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++){const e=i[t];this._pack(e,s,t*this._spec.stride)}}}_packPosition(t,s,i){const{offset:c}=this._spec.position,a=this._spec.position.packPrecisionFactor??1,p=e.i1616to32(t*a,s*a);this._dataView.setUint32(i+c,p,!0)}_packId(t,e){const s=t*(this._spec.id.packPrecisionFactor??1),i=4278190080&this._dataView.getUint32(e+this._spec.id.offset,!0);this._dataView.setUint32(e+this._spec.id.offset,s|i,!0)}_pack(t,e,s){i.packDataView(this._dataView,t,e,s)}}t.MeshWriterVertexPack=c,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});