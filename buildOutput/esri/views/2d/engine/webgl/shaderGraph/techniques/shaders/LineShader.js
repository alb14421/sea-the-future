// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./constants","./hittestUtils","./VisualVariableColor","./VisualVariableOpacity","./VisualVariableSizeMinMaxValue","./VisualVariableSizeScaleStops","./VisualVariableSizeStops","./VisualVariableSizeUnitValue","./vvUtils"],function(t,e,i,a,o,l,n,r,s,p,u,c,d,V){"use strict";class y extends o.FeatureVertexInput{}e.__decorate([i.location(3,a.Vec4)],y.prototype,"color",void 0),e.__decorate([i.location(4,a.Vec2)],y.prototype,"offset",void 0),e.__decorate([i.location(5,a.Vec2)],y.prototype,"normal",void 0),e.__decorate([i.location(6,a.Float)],y.prototype,"halfWidth",void 0),e.__decorate([i.location(7,a.Float)],y.prototype,"referenceHalfWidth",void 0),e.__decorate([i.location(8,a.Vec2)],y.prototype,"zoomRange",void 0);class m extends o.FeatureFragmentInput{}class h extends i.UniformGroup{}function _(t){return a.max(new a.Float(l.thinLineWidthFactor).multiply(a.step(t,new a.Float(l.thinLineHalfWidth))),new a.Float(1))}function S(t,e){const{halfWidth:i,normal:o}=t,l=_(i),n=a.length(o).multiply(i);return a.clamp(l.multiply(i.subtract(n)).divide(e.add(l).subtract(new a.Float(1))),new a.Float(0),new a.Float(1))}function b(t,e){const{id:i,offset:o,pos:n,normal:r,zoomRange:s}=e,{displayViewScreenMat3:p,displayViewMat3:u}=t.view,c=V.getVisualVariableColor(t,i,e.color),d=V.getVisualVariableOpacity(t,i),y=function(t,e){const{id:i,halfWidth:o,referenceHalfWidth:n}=e;if(V.hasVisualVariableSize(t)){const e=new a.Float(2).multiply(n),r=V.getVisualVariableSize(t,i,e);return new a.Float(.5).multiply(o.divide(a.max(n,new a.Float(l.epsilon)))).multiply(r)}return o}(t,e),m=new a.Float(.5).multiply(t.antialiasingControls.antialiasing),h=a.max(y.add(m),new a.Float(.45)).add(new a.Float(.1).multiply(m)),S=_(h).multiply(h).multiply(o),b=u.multiply(new a.Vec3(S,new a.Float(0))),f=p.multiply(new a.Vec3(n,new a.Float(1))).add(b),g=new a.Float(2).multiply(a.step(y,new a.Float(0))).add(t.clip(i,s)),v=new a.Vec4(f.xy,g,1);return{color:c,opacity:d,halfWidth:h,normal:r,scaledOffset:S,scaledHalfWidth:y,glPosition:new a.Vec4(v.xy,g,1)}}function f(t,e){const{opacity:i,color:a}=t,o=S(t,e);return i.multiply(a).multiply(o)}e.__decorate([i.uniform(a.Float)],h.prototype,"antialiasing",void 0),e.__decorate([i.uniform(a.Float)],h.prototype,"blur",void 0);class g extends o.AFeatureShader{constructor(){super(...arguments),this.type="LineShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(t,e){const i=b(this,t);return{...i,...this.maybeRunHittest(t,e,i.halfWidth)}}fragment(t){const e=f(t,this.antialiasingControls.blur);return this.getFragmentOutput(e,t)}hittest(t,e,i){const{viewMat3:o,tileMat3:l}=this.view,r=o.multiply(l),s=r.multiply(new a.Vec3(t.pos,1)),p=r.multiply(new a.Vec3(e.nextPos1,1)),u=r.multiply(new a.Vec3(e.nextPos2,1)),{distance:c,smallSymbolDistance:d,smallSymbolSizeThreshold:V}=this.hittestRequest,y=a.step(i,V.multiply(.5)).multiply(c.subtract(d)),m=this.hittestRequest.position;return a.min(n.distPointSegment(m,s.xy,p.xy),n.distPointSegment(m,s.xy,u.xy)).subtract(i).add(y)}}e.__decorate([i.uniform(h)],g.prototype,"antialiasingControls",void 0),e.__decorate([i.option(r.VisualVariableColor)],g.prototype,"visualVariableColor",void 0),e.__decorate([i.option(s.VisualVariableOpacity)],g.prototype,"visualVariableOpacity",void 0),e.__decorate([i.option(p.VisualVariableSizeMinMaxValue)],g.prototype,"visualVariableSizeMinMaxValue",void 0),e.__decorate([i.option(u.VisualVariableSizeScaleStops)],g.prototype,"visualVariableSizeScaleStops",void 0),e.__decorate([i.option(c.VisualVariableSizeStops)],g.prototype,"visualVariableSizeStops",void 0),e.__decorate([i.option(d.VisualVariableSizeUnitValue)],g.prototype,"visualVariableSizeUnitValue",void 0),e.__decorate([e.__param(0,i.input(y)),e.__param(1,i.input(o.BaseHittestVertexInput))],g.prototype,"vertex",null),e.__decorate([e.__param(0,i.input(m))],g.prototype,"fragment",null),t.AntialiasingControls=h,t.LineFragmentInput=m,t.LineShader=g,t.LineVertexInput=y,t.getLineAntialiasing=S,t.getLineFragmentColor=f,t.getLineThinFactor=_,t.getLineVertexData=b,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});