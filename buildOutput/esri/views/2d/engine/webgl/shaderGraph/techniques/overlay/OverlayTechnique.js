// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../core/maybe","../../../meshing/Mesh","../../utils","../Technique","../shaders/OverlayShader","../../../../../../webgl/enums","../../../../../../webgl/VertexElementDescriptor"],function(e,t,s,i,n,r,o,a){"use strict";class l extends n.Technique{constructor(){super(...arguments),this.type=20,this._mesh=null,this.shaders={overlay:new r.OverlayShader}}render(e,t){const{context:s,painter:n}=e,r=this._getMesh(e,t);n.setPipelineState(i.simplePipelineState);const{isWrapAround:o,wrapAroundShift:a}=t.config,l={...t.config,wrapAroundShift:0},u={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:l},defines:null,optionalAttributes:null,useComputeBuffer:!1};n.setPipelineState({...i.simplePipelineState,stencil:{write:!1,test:{compare:514,op:{fail:7680,zFail:7680,zPass:7681},ref:0,mask:255}}}),n.submitDrawMeshUntyped(s,u,r),o&&(l.wrapAroundShift=a,n.submitDrawMeshUntyped(s,u,r))}shutdown(){t.destroyMaybe(this._mesh)}_getMesh(e,t){const{context:i}=e;if(this._mesh){const e=this._mesh.vertexBuffers.get("positions");if(!e)throw new Error("Buffer not found");e.setData(t.position)}else{const e=null!=t.index?t.index.length:t.position.length/2;this._mesh=new s.Mesh(i,{vertex:{positions:{data:t.position,layout:[new a.VertexElementDescriptor("pos",2,o.DataType.FLOAT,0,8)]},uvs:{data:t.tex,layout:[new a.VertexElementDescriptor("uv",2,o.DataType.UNSIGNED_SHORT,0,4)]}},index:null!=t.index?{index:{data:t.index}}:void 0,groups:[{index:null!=t.index?"index":void 0,primitive:o.PrimitiveType.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:e}]})}return this._mesh}}e.OverlayTechnique=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});