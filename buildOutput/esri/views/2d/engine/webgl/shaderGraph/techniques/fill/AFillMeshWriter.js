// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../core/has","../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils","../mesh/MeshWriter"],function(e,t,r,s,i){"use strict";const n=t("featurelayer-fast-triangulation-enabled");class o extends i.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),r.loadLibtess()])}_write(e,t,r){const s=r?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(s);i&&(e.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(e,t,i),e.recordEnd())}_clip(e){if(!e)return null;const t=this.hasEffects?256:8;return s.clipMarshall(e,t)}_writeGeometry(e,t,r){const i=r.maxLength>100,o=[],a=this.createTesselationParams(t);if(!i&&n&&s.triangulate(o,r))return void(o.length&&this._writeVertices(e,t,r.coords,a,o));const l=s.triangulateLibtess(r);this._writeVertices(e,t,l,a)}_writeVertices(e,t,r,s,i){const n=t.getDisplayId(),o=e.vertexCount(),a=this.hasEffects;let l=0;if(i)for(const t of i){const i=r[2*t],o=r[2*t+1];a&&e.recordBounds(i,o,0,0),this._writeVertex(e,n,i,o,s),l++}else for(let t=0;t<r.length;t+=2){const i=Math.round(r[t]),o=Math.round(r[t+1]);a&&e.recordBounds(i,o,0,0),this._writeVertex(e,n,i,o,s),l++}e.indexEnsureSize(l);for(let t=0;t<l;t++)e.indexWrite(t+o)}}e.AFillMeshWriter=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});