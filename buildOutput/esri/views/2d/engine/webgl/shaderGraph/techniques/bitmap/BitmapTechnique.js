// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../definitions","../Technique","../shaders/BitmapShader"],function(e,i,t,n){"use strict";const s={nearest:{samplingMode:9728,mips:!1},bilinear:{samplingMode:9729,mips:!1},bicubic:{samplingMode:9729,mips:!1},trilinear:{samplingMode:9987,mips:!0}},a=(e,i,t)=>{if("dynamic"===t.samplingMode){const{state:t}=e,n=i.resolution/i.pixelRatio/t.resolution,a=Math.round(e.pixelRatio)!==e.pixelRatio,o=n>1.05||n<.95;return t.rotation||o||a||i.isSourceScaled||i.rotation?s.bilinear:s.nearest}return s[t.samplingMode]};class o extends t.Technique{constructor(){super(...arguments),this.name="BrushBitmap",this.type=4,this.shaders={bitmap:new n.BitmapShader}}render(e,t){const{context:n,renderingOptions:o,painter:r}=e;for(const c of t.bitmaps){const t=c.texture;if(!c.source||!c.isReady||null==t)continue;const d=a(e,c,o);e.timeline.begin(this.name),r.setPipelineState({depth:!1,stencil:{test:{mask:255,ref:c.stencilRef,compare:514,op:{fail:7680,zFail:7680,zPass:7680}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"additive"===c.blendFunction?"additive":"composite"}}),c.setSamplingProfile(d);const{coordScale:l,computedOpacity:p,transforms:u}=c,m={texture:{texture:t,unit:i.textureBindingBitmap},dvsMat3:u.displayViewScreenMat3,coordScale:l,opacity:p};r.submitDrawMesh(n,{shader:this.shaders.bitmap,uniforms:{config:m},defines:{bicubic:d===s.bicubic},optionalAttributes:null,useComputeBuffer:!1},r.quadMesh),e.timeline.end(this.name)}}}e.BitmapTechnique=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});