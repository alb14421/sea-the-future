// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../utils","../Technique","../shaders/BlendShader","../shaders/OpacityShader","../../../../../../webgl/Texture","../../../../../../webgl/TextureDescriptor"],function(e,t,r,u,s,i,n){"use strict";class a extends r.Technique{constructor(){super(...arguments),this.type=5,this._backBufferTexture=null,this.shaders={blend:new u.BlendShader,opacity:new s.OpacityShader}}shutdown(){super.shutdown(),null!==this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null)}render(e,r){const{context:u,state:s,pixelRatio:i,inFadeTransition:n,painter:a}=e,{size:o}=s,c=u.getBoundFramebufferObject();let l,d;null!=c?(l=c.width,d=c.height):(l=Math.round(i*o[0]),d=Math.round(i*o[1]));const{blendMode:h}=r;if("normal"===h){const e={shader:this.shaders.opacity,uniforms:{config:{layerTexture:{texture:r.colorTexture,unit:0},opacity:r.config.opacity}},defines:null,optionalAttributes:null,useComputeBuffer:!1};return a.setPipelineState(t.simplePipelineState),void a.submitDrawMesh(u,e,a.quadMesh)}const f=this._createOrResizeTexture(e,l,d);c.copyToTexture(0,0,l,d,0,0,f),a.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"custom",blendParameters:{srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0}},depth:!1,stencil:!1});const p={backbufferTexture:{texture:f,unit:0},layerTexture:{texture:r.colorTexture,unit:1},inFadeOpacity:n?1:0,...r.config},x={shader:this.shaders.blend,uniforms:{config:p},defines:{blendMode:h},optionalAttributes:null,useComputeBuffer:!1};a.submitDrawMesh(u,x,a.quadMesh)}_createOrResizeTexture(e,t,r){const{context:u}=e;if(null!==this._backBufferTexture&&this._backBufferTexture.descriptor?.width===t&&this._backBufferTexture.descriptor?.height===r)return this._backBufferTexture;if(null===this._backBufferTexture){const e=new n.TextureDescriptor(t,r);e.internalFormat=6408,e.wrapMode=33071,this._backBufferTexture=new i.Texture(u,e)}else this._backBufferTexture.resize(t,r);return this._backBufferTexture}}e.BlendTechnique=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});