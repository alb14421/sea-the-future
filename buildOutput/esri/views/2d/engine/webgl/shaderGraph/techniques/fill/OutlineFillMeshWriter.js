// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../../geometry/GeometryCursor","../../../mesh/templates/templateUtils","./FillMeshWriter","./meshWriterUtils","../line/LineMeshWriter","../mesh/utils","../shaders/constants","../../../../../../webgl/enums"],function(e,t,i,r,s,l,n,o,a){"use strict";const u={createComputedParams:e=>e,optionalAttributes:l.LineVertexSpec.optionalAttributes,attributes:{...l.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:e=>0},color:{type:a.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>s.processColorInput(e)}}},c={createComputedParams:e=>e,optionalAttributes:l.LineVertexSpec.optionalAttributes,attributes:{...l.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:e=>s.packBitset([[o.bitsetTypeFillOutline,!0],[o.bitsetOutlineUsesColorVV,e.outlineUsesColorVV]])},color:{type:a.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>s.processColorInput(e)}}};class p extends l.LineMeshWriter{constructor(){super(...arguments),this.vertexSpec=c}}class h extends r.FillMeshWriter{constructor(e,t,i,r){super(e,t,i,r),this.vertexSpec=u,this._lineMeshWriter=this._createOutlineWriter(e,t,i,r)}_createOutlineWriter(e,t,i,r){return new p(e,t,i,r)}_write(e,t){const i=this.evaluatedMeshParams.effects,r=this.evaluatedMeshParams.outlineEffects;if(i?.length||r?.length){if(i?.length){const r=this.getEffectCursor(e,t,i);if(r){let i;for(;i=r?.next();)i.invertY(),this._writeFill(e,t,i)}}else this._writeFill(e,t);if(r?.length){const i=this.getEffectCursor(e,t,r);if(i){let r;for(;r=i?.next();)r.invertY(),this._writeOutline(e,t,r)}}else this._writeOutline(e,t)}else this._writeSimpleOutlineFill(e,t)}_writeSimpleOutlineFill(e,i){const r=i.readGeometryForDisplay(),s=this._clip(r);s&&(this._writeGeometry(e,i,s),this._lineMeshWriter.writeLineVertices(e,t.GeometryCursor.fromOptimizedCIM(s,"esriGeometryPolyline"),i))}_writeFill(e,t,i){const r=i?.asOptimized()??t.readGeometryForDisplay(),s=this._clip(r);s&&this._writeGeometry(e,t,s)}_writeOutline(e,i,r){const s=r?.asOptimized()??i.readGeometryForDisplay(),l=this._clip(s);l&&this._lineMeshWriter.writeLineVertices(e,t.GeometryCursor.fromOptimizedCIM(l,"esriGeometryPolyline"),i)}_clip(e){return e?i.clipMarshall(e,n.getLineClippingMargin(this.evaluatedMeshParams)):null}get effectInfos(){return[...this._evaluator.inputMeshParams.effects?.effectInfos??[],...this._evaluator.inputMeshParams.outlineEffects?.effectInfos??[]]}write(e,t,i,r,s){this.ensurePacked(t,i,r),e.recordStart(this.instanceId,this.attributeLayout),this._write(e,i),e.recordEnd()}ensurePacked(e,t,i){super.ensurePacked(e,t,i),this._lineMeshWriter.ensurePacked(e,t,i)}enqueueRequest(e,t,i){super.enqueueRequest(e,t,i),this._lineMeshWriter.enqueueRequest(e,t,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}get hasEffects(){return!!this.evaluatedMeshParams.outlineEffects}}e.OutlineFillMeshWriter=h,e.OutlineFillOutlineMeshWriter=p,e.outlineFillVertexSpec_Fill=u,e.outlineFillVertexSpec_Outline=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});