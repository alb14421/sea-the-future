// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports"],function(e){"use strict";function t(e,t,r){const i=t.split("\n");for(const t of i)if(t.trim().length){{let t="";null!=r&&(t+=`/*id:${r??"000"}*/   `),e.body+=t.padEnd(14)}e.body+=" ".repeat(e.indent)+t+"\n"}}e.GlslShaderWriter=class{write(e){for(const t of e.rootOutputNodes())e.shouldPruneOutputNode(t)||(t.variableName=this._write(e,t.node));return e}_createVarName(e,t){let r="";return"boolean"!=typeof t&&"number"!=typeof t&&t.debugInfo.name&&(r=`${t.debugInfo.name}_`),`${r}v${e.varCount++}`}_write(e,t,r=!1){if("number"==typeof t)return t.toString();if("boolean"==typeof t)return t.toString();let i=e.getEmit(t);if(i)return i;switch(t.shaderType){case"scope-node":i=this._writeScopeNode(e,t);break;case"primitive-node":i=this._writePrimitiveNode(e,t,r);break;case"function-node":i=this._writeFunctionNode(e,t);break;case"property-access-node":i=this._writePropertyAccessNode(e,t);break;case"property-access-2d-node":i=this._writePropertyAccess2DNode(e,t);break;case"text-node":i=t.text;break;case"block-node":i=this._writeBlockNode(e,t);break;case"condition-node":i=this._writeConditionNode(e,t)}return e.setEmit(t,i),i}_writeScopeNode(e,r){const i=new r.child.constructor;i.setDebugName(r.debugInfo.name);const n=this._write(e,i,!0);return t(e,`{ /*ScopeStart: ${r.uid} ${r.debugInfo.name}*/`),e.indent+=2,t(e,`${n} = ${this._write(e,r.child)};`),e.indent-=2,t(e,`} /*ScopeEnd: ${r.uid} ${r.debugInfo.name}*/`),n}_writeConditionNode(e,r){const i=new r.ifTrue.constructor,n=this._write(e,i,!0);t(e,`if (${this._write(e,r.condition)}) {`),e.indent+=2;const o=e.createSubgraphContext(),s=this._write(o,r.ifTrue);if(e.body+=o.body,s&&t(e,`${n} = ${s};`),e.indent-=2,t(e,"}"),r.ifFalse){t(e,"else {"),e.indent+=2;const i=e.createSubgraphContext(),o=this._write(i,r.ifFalse);e.body+=i.body,o&&t(e,`${n} = ${o};`),e.indent-=2,t(e,"}")}return n}_writeBlockNode(e,r){const{captureList:i,generator:n,returnType:o}=r,s={};for(const t in i){if(!i[t])continue;const r=this._write(e,i[t]);s[t]=r}const d=new o,c=this._write(e,d,!0);if(s.out=c,r.subgraph){const t=e.createSubgraphContext(),i=this._write(t,r.subgraph.child),n=t.body;s.subgraph={varName:i,body:n}}const a=n(s);return t(e,"{\n"),e.indent+=2,t(e,a),e.indent-=2,t(e,"}\n"),c}_writePropertyAccessNode(e,t){const r=this._write(e,t.target);return"string"==typeof t.property&&t.property.includes("[")?`${r}${t.property}`:"string"!=typeof t.property?`${r}[${this._write(e,t.property)}]`:`${r}.${t.property}`}_writePropertyAccess2DNode(e,t){return`${this._write(e,t.target)}[${this._write(e,t.x)}][${this._write(e,t.y)}]`}_writeFunctionNode(e,r){const i=r.returnType.type;if(r.isInfix){const[n,o]=r.children.map(t=>this._write(e,t)),s=this._createVarName(e,r);return t(e,`${i.padEnd(5)} ${s} = ${n} ${r.token} ${o};`,r.uid),s}const n=r.children.map(t=>this._write(e,t)).join(", "),o=this._createVarName(e,r);return t(e,`${i.padEnd(5)} ${o} = ${r.token}(${n});`,r.uid),o}_writePrimitiveNode(e,r,i=!1){const n=e.getInput(r);if(n)return n.isUsed=!0,n.variableName;const o=1===r.children.length&&r.children[0]?.type===r.type;if(!r.isMutable&&(r.isImplicit||o))return this._write(e,r.children[0]);const s=this._createVarName(e,r);if(i)return t(e,`${r.type.padEnd(5)} ${s};`,r.uid),s;const d=!r.debugInfo.name&&!r.isMutable;if(d&&"float"===r.type&&"number"==typeof r.children[0])return Number.isInteger(r.children[0])?r.children[0].toFixed(1):r.children[0].toString();if(d&&"int"===r.type&&"number"==typeof r.children[0]&&Number.isInteger(r.children[0]))return r.children[0].toString();const c=r.children.map(t=>this._write(e,t)).join(", ");return"array"===r.type?(t(e,`${r.type.padEnd(5)} ${s} = [${c}];`,r.uid),s):d?`${r.type}(${c})`:(t(e,`${r.type.padEnd(5)} ${s} = ${r.type}(${c});`,r.uid),s)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});