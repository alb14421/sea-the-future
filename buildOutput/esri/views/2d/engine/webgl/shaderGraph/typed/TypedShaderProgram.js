// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../core/Error","../../../../../../core/Logger","../../../../../../core/maybe","../../../../../../core/object","../../../../../webgl/BufferObject","../../../../../webgl/FramebufferObject","../../../../../webgl/Program","../../../../../../core/has","../../../../../webgl/Renderbuffer","../../../../../webgl/Texture","../../../../../webgl/enums","../../../../../webgl/checkWebGLError","../../textureUtils"],function(e,r,t,o,i,a,s,n,f,m,c,u,h,l){"use strict";function d(e,o,i){const a=o.length;if(a!==i){const s=new r("Invalid Uniform",`Invalid length, expected ${i} but got ${a}`,{uniformName:e,values:o});t.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(s)}}e.TypedShaderProgram=class{constructor(e,r,t,o,i){this.vertexShader=e,this.fragmentShader=r,this._locations=t,this._uniformBindings=o,this._transformFeedbackBindings=i,this._vao=null,this._temporaryTextures=[]}destroy(){this._program=o.disposeMaybe(this._program),this.cleanupTemporaryTextures()}setUniforms(e){this._uniforms=e}cleanupTemporaryTextures(){for(const e of this._temporaryTextures)e.dispose();this._temporaryTextures=[]}bind(e){const r=this._uniforms;if(!this._program){const r=[];for(const e of this._transformFeedbackBindings??[]){const{index:t,propertyKey:o}=e;r[t]=`v_${o}`}this._program=new n.Program(e,this.vertexShader,this.fragmentShader,this._locations,new Map,r)}const t=this._program;e.useProgram(t);for(const o of this._uniformBindings){const{shaderModulePath:a,uniformName:s,uniformType:n,uniformArrayLength:f}=o,m=i.getDeepValue(a,r);if(null==m){if("sampler2D"===n)continue;throw new Error(`Failed to find uniform value for ${a}`)}switch("array"===n||"array-2d"===n?o.uniformArrayElementType:n){case"sampler2D":{const{unit:r,texture:o}=m;if(t.setUniform1i(s,r),"type"in o)e.bindTexture(o,r);else{const t=l.createTexture(e,o.descriptor,o.data);e.bindTexture(t,r)}break}case"int":if(!f){t.setUniform1i(s,m);break}d(o.uniformName,m,f),t.setUniform1iv(s,m);break;case"float":if(!f){t.setUniform1f(s,m);break}d(o.uniformName,m,f),t.setUniform1fv(s,m);break;case"vec2":if(!f){t.setUniform2f(s,m[0],m[1]);break}d(o.uniformName,m,f),t.setUniform2fv(s,m.flat());break;case"vec3":if(!f){t.setUniform3f(s,m[0],m[1],m[2]);break}d(o.uniformName,m,f),t.setUniform3fv(s,m.flat());break;case"vec4":if(!f){t.setUniform4f(s,m[0],m[1],m[2],m[3]);break}d(o.uniformName,m,f),t.setUniform4fv(s,m.flat());break;case"mat3":t.setUniformMatrix3fv(s,m);break;case"mat4":t.setUniformMatrix4fv(s,m);break;default:throw new Error(`Unable to set uniform for type ${n}`)}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});