// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../geometry/support/aaBoundingRect","../../viewpointUtils","./RasterTile","../webgl/TileContainer","../webgl/shaderGraph/techniques/raster/RasterColorizerTechnique","../webgl/shaderGraph/techniques/raster/RasterProcessorTechnique"],function(e,i,t,s,n,r,o){"use strict";e.RasterTileContainer=class extends n{constructor(){super(...arguments),this.isCustomTilingScheme=!1}get pixelHighlightOptions(){return this._pixelHighlightOptions}set pixelHighlightOptions(e){this._pixelHighlightOptions=e,this.requestRender()}createTile(e){const i=this._getTileBounds(e),[t,n]=this.tileInfoView.tileInfo.size,r=this.tileInfoView.getTileResolution(e.level);return new s.RasterTile(e,r,i[0],i[3],t,n)}onAttach(){super.onAttach(),this._colorizerTechnique=new r.RasterColorizerTechnique,this._processorTechnique=new o.RasterProcessorTechnique}onDetach(){super.onDetach(),this._colorizerTechnique?.shutdown(),this._colorizerTechnique=void 0,this._processorTechnique?.shutdown(),this._processorTechnique=void 0}doRender(e){if(!this.visible||1!==e.drawPhase||!this._colorizerTechnique)return;const{rasterFunctionChain:i}=this;if(i?.functions?.length){if(!this._processorTechnique)return;const{functions:t,hasBranches:s}=i;for(const i of t){if("Constant"===i.name||"Identity"===i.name)continue;e.rasterFunction=i,e.hasBranches=s,super.doRender(e);const t=this.children.map(e=>e.bitmap);this._processorTechnique.render(e,{bitmaps:t})}}e.rasterFunction=null,e.pixelHighlightOptions=this.pixelHighlightOptions,super.doRender(e);const t=this.children.map(e=>e.bitmap);this._colorizerTechnique.render(e,{bitmaps:t})}_getTileBounds(e){const s=this.tileInfoView.getTileBounds(i.create(),e);if(this.isCustomTilingScheme&&e.world){const{tileInfo:i}=this.tileInfoView,n=t.getWorldWidth(i.spatialReference);if(n){const t=i.lodAt(e.level);if(!t)return s;const{resolution:r}=t,o=r*i.size[0];s[0]=n*e.world+i.origin.x+e.col*o,s[2]=s[0]+o}}return s}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});