// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../GeometryUtils","./core"],function(t,e,o){"use strict";function l(t,e,o,l,s,i){const r=o-s;if(r>=0)return(e>>r)+(l-(i<<r))*(t>>r);const n=-r;return e-(i-(l<<n))*(t>>n)<<n}function s(t,e,o,l,s){const i=t.layerData.get(s);if(3===i.type){for(const e of l){const l=e.uniqueSymbol;let s;if(e.selectedForRendering){const e=l.parts[0],i=e.startOpacity,r=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===r;const n=o?Math.floor(127*i)|r<<7:r?255:0;s=n<<24|n<<16|n<<8|n}else s=0;for(const[t,o]of e.iconVertexRanges)for(let e=t;e<t+o;e+=4)i.iconOpacity[e/4]=s;if(e.selectedForRendering){const e=l.parts[1],i=e.startOpacity,r=e.targetOpacity;t.allSymbolsFadingOut=t.allSymbolsFadingOut&&0===r;const n=o?Math.floor(127*i)|r<<7:r?255:0;s=n<<24|n<<16|n<<8|n}else s=0;for(const[t,o]of e.textVertexRanges)for(let e=t;e<t+o;e+=4)i.textOpacity[e/4]=s}i.lastOpacityUpdate=e,i.opacityChanged=!0}}t.GridIndex=class{constructor(t,e,o){this._rows=Math.ceil(e/o),this._columns=Math.ceil(t/o),this._cellSize=o,this.cells=new Array(this._rows);for(let t=0;t<this._rows;t++){this.cells[t]=new Array(this._columns);for(let e=0;e<this._columns;e++)this.cells[t][e]=[]}}getCell(t,e){const o=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._rows-1),l=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._columns-1);return this.cells[o]&&this.cells[o][l]||null}getCellSpan(t,e,o,l){return[Math.min(Math.max(Math.floor(t/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(o/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(l/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}},t.deserializeSymbols=function(t,e,l,s,i,r,n){const c=e[s++];for(let a=0;a<c;a++){const c=new o.VTLSymbol(r,n);c.xTile=e[s++],c.yTile=e[s++],c.hash=e[s++],c.priority=e[s++],c.featureIndex=e[s++];const a=e[s++],h=c.colliders();for(let t=0;t<a;t++){const t=e[s++],o=e[s++],i=e[s++],r=e[s++],n=!!e[s++],c=e[s++],a=l[s++],u=l[s++],f=e[s++],y=e[s++];h.push({xTile:t,yTile:o,dxPixels:i,dyPixels:r,hard:n,partIndex:c,width:f,height:y,minLod:a,maxLod:u})}const u=t[s++];for(let e=0;e<u;e++)c.textVertexRanges.push([t[s++],t[s++]]);const f=t[s++];for(let e=0;e<f;e++)c.iconVertexRanges.push([t[s++],t[s++]]);i.push(c)}return s},t.isSearchCircleOverlapingSymbol=function(t,o,l,s){const i=t.colliders();let r,n,c,a;for(const h of i)if(t.uniqueSymbol?.show&&t.uniqueSymbol.parts[h.partIndex].show&&(r=h.xScreen-s[0]+h.dxScreen,n=h.yScreen-s[1]+h.dyScreen,c=r+h.width,a=n+h.height,e.isCircleOverlapingRect(l,o.x,o.y,r,n,c,a)))return!0;return!1},t.tileCoordChangeX=function(t,e,o,s){return l(t,e,o.level,o.col,s.key.level,s.key.col)},t.tileCoordChangeY=function(t,e,o,s){return l(t,e,o.level,o.row,s.level,s.row)},t.writeOpacityToBuffers=function(t,e,o){for(const[l,i]of t.symbols)s(t,e,o,i,l)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});