// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/libs/gl-matrix-2/math/mat3","../../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../../core/libs/gl-matrix-2/math/common","../constants","./CollisionJob","./SymbolDeclutterer","./SymbolRepository","./util"],function(t,e,o,i,r,l,s,n,a){"use strict";const c=o.create();t.declutterSingleTile=function(t,o){const y=t.transforms.tileUnitsToPixels,m=i.toRadian(o),u=Math.cos(m),b=Math.sin(m),f=Math.ceil(512*(Math.abs(b)+Math.abs(u)));e.identity(c),e.translate(c,c,[f/2,f/2]),e.rotate(c,c,m),e.translate(c,c,[-256,-256]),e.scale(c,c,[1/8,1/8,1]),t.transforms.tileUnitsToPixels=c;const g=[],S=new n.SymbolRepository(r.tileCoordSize,g),p=new s.SymbolDeclutterer("vector-tile",g,S,null,(e,i,r)=>new l.CollisionJob(e,i,r,t.styleRepository,t.key.level,o),(t,e)=>{a.writeOpacityToBuffers(t,e,!1)},()=>0,e=>{const o=t.styleRepository.getStyleLayerByUID(e).getLayoutProperty("visibility");return!o||1!==o.getValue()});g.push(t),S.registerVectorTile(t),p.setScreenSize(f,f),p.continue(1/0),S.unregisterVectorTile(t),t.transforms.tileUnitsToPixels=y},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});