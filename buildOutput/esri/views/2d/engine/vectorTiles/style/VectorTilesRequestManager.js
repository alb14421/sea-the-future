// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../request","../../../../../core/lang","../../../../../core/MapUtils","../../../../../core/promiseUtils","../../../../../core/urlUtils"],function(t,e,r,o,s,i){"use strict";class n{constructor(t){this._tileUrl=t,this._promise=null,this._abortController=null,this._abortOptions=[]}getData(t){(null==this._promise||s.isAborted(this._abortController?.signal))&&(this._promise=this._makeRequest(this._tileUrl));const e=this._abortOptions;return e.push(t),s.onAbort(t,()=>{e.every(t=>s.isAborted(t))&&this._abortController.abort()}),this._promise.then(t=>r.clone(t))}async _makeRequest(t){this._abortController=new AbortController;const{data:r}=await e(t,{responseType:"array-buffer",signal:this._abortController.signal});return r}}const l=new Map;t.request=function(t,e,r,s,a){const c=i.urlToObject(t),u=c.query;if(u)for(const[t,o]of Object.entries(u))switch(o){case"{x}":u[t]=s.toString();break;case"{y}":u[t]=r.toString();break;case"{z}":u[t]=e.toString()}const b=c.path;return function(t,e){return o.getOrCreateMapValue(l,t,()=>new n(t)).getData(e).finally(()=>l.delete(t))}(i.addQueryParameters(b.replaceAll(/\{z\}/gi,e.toString()).replaceAll(/\{y\}/gi,r.toString()).replaceAll(/\{x\}/gi,s.toString()),{...c.query}),a)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});