// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/screenUtils","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32"],function(e,t,n,i){"use strict";function o(e){return"constant"===e.kind?e.value[0]:e.values[e.values.length-1]}function s(e){const t=e.toRgba();return[t[0]/255,t[1]/255,t[2]/255,t[3]]}function a(e){if(!e.hasVisualVariables("size"))return{kind:"constant",value:[t.pt2px(e.trailWidth)]};const n=e.getVisualVariablesForType("size")[0],i=[],o=[];let s;if(n.stops){for(const e of n.stops)i.push(e.value),o.push(t.pt2px(e.size));s=n.stops.length}else i.push(n.minDataValue,n.maxDataValue),o.push(t.pt2px(n.minSize),t.pt2px(n.maxSize)),s=2;return{kind:"ramp",stops:i,values:o,count:s}}function l(e,t,n,i){switch(t){case"int":e.setUniform1iv(n,i);break;case"float":e.setUniform1fv(n,i);break;case"vec2":e.setUniform2fv(n,i);break;case"vec3":e.setUniform3fv(n,i);break;case"vec4":e.setUniform4fv(n,i)}}function r(e,t){let n=!0;return n=n&&e.collisions===t.collisions,n=n&&e.density===t.density,n=n&&e.interpolate===t.interpolate,n=n&&e.lineCollisionWidth===t.lineCollisionWidth,n=n&&e.lineSpacing===t.lineSpacing,n=n&&e.maxTurnAngle===t.maxTurnAngle,n=n&&e.minSpeedThreshold===t.minSpeedThreshold,n=n&&e.segmentLength===t.segmentLength,n=n&&e.smoothing===t.smoothing,n=n&&e.velocityScale===t.velocityScale,n=n&&e.verticesPerLine===t.verticesPerLine,n}function u(e,t){return e===t||null!=e&&null!=t&&e.equals(t)}e.areStreamlinesCompatible=function(e,t){if(!r(e.simulationSettings,t.simulationSettings))return!1;if(!u(e.timeExtent,t.timeExtent))return!1;let n=!0;return n=n&&e.loadImagery===t.loadImagery,n=n&&e.createFlowMesh===t.createFlowMesh,n=n&&e.color.kind===t.color.kind,n=n&&e.opacity.kind===t.opacity.kind,n=n&&e.size.kind===t.size.kind,n},e.getColor=function(e){if(!e.hasVisualVariables("color"))return{kind:"constant",value:s(e.color)};const t=e.getVisualVariablesForType("color")[0],n=[],i=[];for(const e of t.stops)n.push(e.value),Array.prototype.push.apply(i,s(e.color));return{kind:"ramp",stops:n,values:i,count:t.stops.length}},e.getFlowSimulationSettings=function(e){const n=o(a(e)),i=n,s=Math.max(n/2,5),l=Math.round(t.pt2px(e.maxPathLength)/s)+1,{density:r}=e;return{smoothing:t.pt2px(e.smoothing),interpolate:!0,velocityScale:"flow-from"===e.flowRepresentation?1:-1,verticesPerLine:l,minSpeedThreshold:.001,segmentLength:s,maxTurnAngle:1,collisions:!0,lineCollisionWidth:i,lineSpacing:10,density:r,geometries:e.geometries}},e.getForegroundColor=function(e){return{kind:"constant",value:[.1,.1,.1,1]}},e.getMax=o,e.getOpacity=function(e){if(!e.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};const t=e.getVisualVariablesForType("opacity")[0],n=[],i=[];for(const e of t.stops)n.push(e.value),i.push(e.opacity);return{kind:"ramp",stops:n,values:i,count:t.stops.length}},e.getSingleTileVisualState=function(e,t,o){const s=i.create();return n.identity(s),n.translate(s,s,[-1,1]),n.scale(s,s,[2/t,-2/o,1]),{time:e,dvsMat3:s,displayViewMat3:s}},e.getSize=a,e.setUniform=l,e.setUniforms=function(e,t,n,i){"constant"===i.kind?l(e,n,`u_${t}`,i.value):(l(e,"float",`u_${t}_stops`,i.stops),l(e,n,`u_${t}_values`,i.values),e.setUniform1i(`u_${t}_count`,i.count))},e.simulationSettingsEqual=r,e.timeExtentsEqual=u,e.toRgba=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});