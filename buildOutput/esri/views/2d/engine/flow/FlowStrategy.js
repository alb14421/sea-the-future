// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Logger","../../../../core/mathUtils","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Extent","../../../../geometry/Point","./FlowDisplayData","./FlowDisplayObject"],function(t,e,a,i,o,l,s,r,n,d,c,p,u,h){"use strict";return t.default=class extends a{constructor(t){super(t),this._flowDisplayObject=new h.FlowDisplayObject,this._loading=null}initialize(){this.flowContainer.addChild(this._flowDisplayObject)}destroy(){this._clear(),this.flowContainer.removeAllChildren()}get updating(){return null!=this._loading}update(t){const{flowStyle:e}=this.flowContainer;if(null==e)return void this._clear();const{extent:a,rotation:s,resolution:r,pixelRatio:n}=t.state,d=function(t,e){const a=new p({x:(t.xmax+t.xmin)/2,y:(t.ymax+t.ymin)/2,spatialReference:t.spatialReference}),i=t.xmax-t.xmin,l=t.ymax-t.ymin,s=Math.abs(Math.cos(o.deg2rad(e))),r=Math.abs(Math.sin(o.deg2rad(e))),n=s*i+r*l,d=r*i+s*l,u=new c({xmin:a.x-n/2,ymin:a.y-d/2,xmax:a.x+n/2,ymax:a.y+d/2,spatialReference:t.spatialReference});return u.centerAt(a),u}(a,s);d.expand(1);const h=[Math.round((d.xmax-d.xmin)/r),Math.round((d.ymax-d.ymin)/r)],y=new u(e,d,h,n);if(null!=this._loading){if(this._loading.update(y))return;this._loading.detach(),this._loading=null}null!=this._flowDisplayObject.displayData&&this._flowDisplayObject.displayData.update(y)||(y.load().then(()=>{this._flowDisplayObject.clear(),this._flowDisplayObject.displayData=this._loading,this._loading=null},t=>{l.isAbortError(t)||(i.getLogger(this).error("A resource failed to load.",t),this._loading=null)}),this._loading=y)}_clear(){this._flowDisplayObject.clear(),null!=this._loading&&(this._loading.detach(),this._loading=null)}},e.__decorate([s.property()],t.default.prototype,"_loading",void 0),e.__decorate([s.property()],t.default.prototype,"flowContainer",void 0),e.__decorate([s.property()],t.default.prototype,"updating",null),t.default=e.__decorate([d.subclass("esri.views.2d.engine.flow.FlowStrategy")],t.default),t.default});