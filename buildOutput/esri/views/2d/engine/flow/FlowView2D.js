// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../Graphic","../../../../core/Accessor","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","./createFlowStyle","./dataUtils","./FlowContainer","./FlowStrategy"],function(t,e,a,r,o,i,s,n,l,d,c,p,h,u){"use strict";return t.default=class extends r{constructor(){super(...arguments),this._loadImagery=(t,e,a,r,o)=>p.loadImagery(this.layer,t,e,a,r,o),this._createFlowMesh=(t,e,a,r)=>this.layer.createFlowMesh({meshType:t,flowData:a,simulationSettings:e},{signal:r}),this.attached=!1,this.type="flow",this.timeExtent=null,this.redrawOrRefetch=async()=>{this._updateVisualization()}}get updating(){return!this.attached||this._strategy.updating}attach(){const{layer:t}=this,e=()=>{this._loadImagery=(e,a,r,o,i)=>p.loadImagery(t,e,a,r,o,i),this._updateVisualization()};"multidimensionalDefinition"in t?this.addHandles(o.watch(()=>t.multidimensionalDefinition,e)):this.addHandles([o.watch(()=>t.mosaicRule,e),o.watch(()=>t.rasterFunction,e),o.watch(()=>t.definitionExpression,e)]),this.container=new h,this._strategy=new u({flowContainer:this.container}),this._updateVisualization()}detach(){this._strategy.destroy(),this.container?.removeAllChildren(),this.container=null,this.removeHandles()}update(t){t.stationary?this._strategy.update(t):this.layerView.requestUpdate()}hitTest(t){return new a({attributes:{},geometry:t.clone(),layer:this.layer})}moveEnd(){}async doRefresh(){}_updateVisualization(){const t=this.layer.renderer;if(null==t||"flow"!==t.type)return;const e=c(t,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent});this.container.flowStyle=e,this.layerView.requestUpdate()}},e.__decorate([i.property()],t.default.prototype,"_strategy",void 0),e.__decorate([i.property()],t.default.prototype,"attached",void 0),e.__decorate([i.property()],t.default.prototype,"container",void 0),e.__decorate([i.property()],t.default.prototype,"layer",void 0),e.__decorate([i.property()],t.default.prototype,"layerView",void 0),e.__decorate([i.property()],t.default.prototype,"type",void 0),e.__decorate([i.property()],t.default.prototype,"updating",null),e.__decorate([i.property()],t.default.prototype,"timeExtent",void 0),t.default=e.__decorate([d.subclass("esri.views.2d.engine.flow.FlowView2D")],t.default),t.default});