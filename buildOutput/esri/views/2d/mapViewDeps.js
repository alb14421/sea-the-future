// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/Stage":function(){define(["require","exports","../../../core/Error","../../../core/has","../../../core/maybe","../../../core/scheduling","../../../core/signal","../../../core/libs/gl-matrix-2/factories/mat3f32","../../../symbols/cim/cimAnalyzer","./Container","./webgl/definitions","./webgl/Painter","./webgl/PooledUint32Array","./webgl/Profiler","./webgl/TileReshuffleManager","./webgl/shaderGraph/techniques/TechniqueRegistry","./webgl/shaderGraph/techniques/mesh/MeshWriterRegistry","../support/Timeline","../../webgl/enums","../../webgl/FramebufferObject","../../webgl/RenderbufferDescriptor","../../webgl/RenderingContext","../../webgl/RenderingContextOptions","../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_,y,x,b,v,S,w){"use strict";class T extends c.Container{constructor(e,t,n){super(),this.meshWriterRegistry=new g.MeshWriterRegistry,this._trash=new Set,this._renderRemainingTime=0,this._lastFrameRenderTime=0,this._renderRequested=o.signal(!1),this.stage=this,this._stationary=!0,this._reshuffleManager=new p.TileReshuffleManager,this._managedCanvas=n,this.context=new v.RenderingContext(this._managedCanvas.gl,t.contextOptions??new S.RenderingContextOptions),this.painter=new h(this.context,this),this._cimAnalyzer=new l.CIMAnalyzer(this.painter.textureManager.resourceManager),r("esri-2d-profiler")&&null!=e&&(this._debugOutput=document.createElement("div"),this._debugOutput.setAttribute("style","margin: 24px 64px; position: absolute; color: red;"),e.appendChild(this._debugOutput));const a=()=>this.highlightGradient;this._renderParameters={drawPhase:0,state:this.state,pixelRatio:window.devicePixelRatio,stationary:!1,globalOpacity:1,blendMode:null,deltaTime:-1,time:0,inFadeTransition:!1,effects:null,context:this.context,painter:this.painter,timeline:t.timeline||new _.Timeline,renderingOptions:t.renderingOptions,requestRender:()=>this.requestRender(),allowDelayedRender:!1,requireFBO:!1,profiler:new f.Profiler(this.context,this._debugOutput),dataUploadCounter:0,get highlightGradient(){return a()},reshuffleManager:this._reshuffleManager,backgroundColor:t.backgroundColor};let c=e=>this.renderFrame(e);null!=t.renderFrame&&(c=t.renderFrame),this._taskHandle=s.addFrameTask({render:e=>c(e)}),this._taskHandle.pause(),this._lostWebGLContextHandle=this._managedCanvas.events.on("webgl-context-lost",e=>this.emit("webgl-error",{error:new i("webgl-context-lost",e.statusMessage)})),this._bufferPool=new d.ArrayBufferPool,m.startup()}destroy(){super.destroy(),m.shutdown(this.context),this.removeAllChildren(),this._emptyTrash(),this._taskHandle=n.removeMaybe(this._taskHandle),this._lostWebGLContextHandle=n.removeMaybe(this._lostWebGLContextHandle),this._managedCanvas.destroy(),this._debugOutput?.parentNode?.removeChild(this._debugOutput),this._bufferPool.destroy(),this.painter.dispose(),this.context.dispose(),this._managedCanvas=null}get textureManager(){return this.painter.textureManager}get backgroundColor(){return this._renderParameters.backgroundColor}set backgroundColor(e){this._renderParameters.backgroundColor=e,this.requestRender()}get canvas(){return this._managedCanvas.canvas}get bufferPool(){return this._bufferPool}get cimAnalyzer(){return this._cimAnalyzer}get renderingOptions(){return this._renderingOptions}set renderingOptions(e){this._renderingOptions=e,this.requestRender()}get renderRequested(){return this._renderRequested.value}get state(){return this._state}set state(e){this._state=e,this.requestRender()}get stationary(){return this._stationary}set stationary(e){this._stationary!==e&&(this._stationary=e,this.requestRender())}trashDisplayObject(e){this._trash.add(e),this.requestRender()}untrashDisplayObject(e){return this._trash.delete(e)}requestRender(){this._renderRemainingTime=2e3,this.renderRequested||(this._renderRequested.value=!0,this._taskHandle.resume())}renderFrame(e){const t=this._lastFrameRenderTime?e.time-this._lastFrameRenderTime:0;this._renderRemainingTime-=t,this._renderRemainingTime<=0&&this._taskHandle.pause(),this._lastFrameRenderTime=e.time,this._renderRequested.value=!1,this._renderParameters.state=this._state,this._renderParameters.stationary=this.stationary,this._renderParameters.pixelRatio=window.devicePixelRatio,this._renderParameters.globalOpacity=1,this._renderParameters.time=e.time,this._renderParameters.deltaTime=e.deltaTime,this._renderParameters.effects=null,this.processRender(this._renderParameters),this._emptyTrash()}_createTransforms(){return{displayViewScreenMat3:a.create()}}renderChildren(e){for(const t of this.children)t.beforeRender(e);this._reshuffleManager.reshuffle(u.MAX_TILE_RESHUFFLES_PER_FRAME),this._managedCanvas.render(e,()=>this._renderChildren(this.children,e));for(const t of this.children)t.afterRender(e)}_renderChildren(e,t){const i=this.context;this.painter.textureUploadManager.upload(),i.resetInfo(),t.profiler.recordStart("drawLayers"),t.dataUploadCounter=0,this.painter.beforeRenderPhases(t,t.backgroundColor,this.state.padding),t.drawPhase=1;for(const i of e)i.processRender(t);if(this.children.some(e=>e.hasHighlight)){t.drawPhase=16;for(const i of e)i.processRender(t)}if(this.children.some(e=>e.hasLabels)){t.drawPhase=2;for(const i of e)i.processRender(t)}if(r("esri-tiles-debug")){t.drawPhase=64;for(const i of e)i.processRender(t)}this.painter.afterRenderPhases(t),t.profiler.recordEnd("drawLayers"),i.logInfo()}doRender(e){const t=this.context,{state:i,pixelRatio:r}=e;this._managedCanvas.resize(e),t.setViewport(0,0,r*i.size[0],r*i.size[1]),t.setDepthWriteEnabled(!0),t.setStencilWriteMask(255),this.renderChildren(e)}async takeScreenshot(t,i,r,n){const s=Math.round(this.state.size[0]*t.resolutionScale),o=Math.round(this.state.size[1]*t.resolutionScale),a=t.resolutionScale,l=this.context,c=this._state.clone();if(null!=n){const e=c.viewpoint;c.viewpoint.rotation=n,c.viewpoint=e}const u={...this._renderParameters,drawPhase:null,globalOpacity:1,stationary:!0,state:c,pixelRatio:a,time:performance.now(),deltaTime:0,blendMode:null,effects:null,inFadeTransition:!1,backgroundColor:r},h=new w.TextureDescriptor(s,o);h.wrapMode=33071,h.internalFormat=y.SizedPixelFormat.RGBA8,h.isImmutable=!0;const d=new x.FramebufferObject(l,h,new b.RenderbufferDescriptor(y.SizedDepthStencilFormat.DEPTH24_STENCIL8,s,o)),f=l.getBoundFramebufferObject(),p=l.getViewport();l.bindFramebuffer(d),l.setViewport(0,0,s,o),this._renderChildren(i??this.children,u);const m=this._readbackScreenshot(d,{...t.cropArea,y:o-(t.cropArea.y+t.cropArea.height)});l.bindFramebuffer(f),l.setViewport(p.x,p.y,p.width,p.height),this.requestRender();const g=await m;let _;return 1===t.outputScale?_=g:(_=new ImageData(Math.round(g.width*t.outputScale),Math.round(g.height*t.outputScale)),(await new Promise((t,i)=>e(["../../support/screenshotUtils"],t,i))).resampleHermite(g,_,!0)),d.dispose(),_}async _readbackScreenshot(t,i){const r=(await new Promise((t,i)=>e(["../../support/screenshotUtils"],t,i))).createEmptyImageData(i.width,i.height,document.createElement("canvas"));return await t.readPixelsAsync(i.x,i.y,i.width,i.height,6408,y.PixelType.UNSIGNED_BYTE,new Uint8Array(r.data.buffer)),r}_emptyTrash(){for(;this._trash.size>0;){const e=Array.from(this._trash);this._trash.clear();for(const t of e)t.processDetach()}}}t.Stage=T,t.extraRenderTime=2e3,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/cimAnalyzer":function(){define(["exports","../../core/colorUtils","../../core/fontUtils","../../core/has","../../core/lang","../../core/Logger","../../core/screenUtils","../../core/string","./animationUtils","./CIMSymbolHelper","./constants","./defaultCIMValues","./fitVectorMarker","./OverrideHelper","./SDFHelper","./utils","./effects/CIMEffectHelper","../../views/2d/engine/webgl/definitions"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_){"use strict";const y=()=>s.getLogger("esri.symbols.cim.cimAnalyzer");function x(e){const t=e.markerPlacement;return t&&t.angleToLine?1:0}function b(e){if(e?.startsWith("Level_")){const t=parseInt(e.slice(6),10);if(!isNaN(t))return t}return 0}function v(e){const t=e.symbolLayers;if(!t)return!1;const i=t.find(e=>e.effects?.find(e=>"CIMGeometricEffectDashes"===e.type&&null!=e.dashTemplate)),r=t.find(e=>e.effects?.find(e=>"CIMGeometricEffectAddControlPoints"===e.type));return!!i||!!r}function S(e){return n.clone(e).map(e=>({...e,propertyName:m.uncapitalize(e.propertyName)}))}function w(e){return l.shouldUseAnimatedPath(e)?{type:"animation-params",params:e}:null}e.CIMAnalyzer=class{constructor(e){this._cimLayers=[],this._poMap={},this._primitiveOverrides=[],this._hasTextStringTemplates=!1,e&&(this._resourceManager=e)}analyzeSymbolReference(e,i,r){if(this._cimLayers=r??[],!e)return this._cimLayers;if(this._reset(),this._hasTextStringTemplates=e.hasTextStringTemplates??!1,e.primitiveOverrides){this._primitiveOverrides=e.primitiveOverrides;for(const e of this._primitiveOverrides){const i=e.valueExpressionInfo;if(i)this._setPoMap(e.primitiveName,e.propertyName,i);else if(null!=e.value){let i=e.value;e.propertyName.includes("Color")&&(t.isRGB(i)&&(i=m.colorToArray(i)),i=m.normalizeAlpha(i)),this._setPoMap(e.primitiveName,e.propertyName,i)}}}return this._analyzeSymbol(e.symbol,i),this._cimLayers}_reset(){this._cimLayers=[],this._poMap={},this._primitiveOverrides=[]}_analyzeSymbol(e,t){switch(e?.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this._analyzeMultiLayerSymbol(e,t)}}_analyzeMultiLayerSymbol(e,t){const i=e?.symbolLayers;if(!i)return;for(let e=0;e<i.length;e++){const t=i[e];"CIMVectorMarker"===t.type&&(i[e]=d.fitVectorMarker(t))}const r=e.effects;let n=0;const s=m.getSize(e)??0;if("CIMPointSymbol"===e.type&&"Map"===e.angleAlignment&&(n=1),function(e,t){if(t?.some(e=>"CIMGeometricEffectRadial"===e.type)&&t?.some(e=>"CIMGeometricEffectTaperedPolygon"===e.type)&&2===e.length){const t=e.find(e=>"CIMSolidFill"===e.type),i=e.find(e=>"CIMSolidStroke"===e.type),r=i?.effects?.some(e=>"CIMGeometricEffectDashes"===e.type);if(null!=t&&null!=i&&!r)return!0}return!1}(i,r))return this._analyzeCompositeOutlineFill(i,r,s);let o={transform:[0,0,0,1],fromColor:[1,1,1,1],toColor:[1,1,1,1],colorMix:[0,0,0,0],toOpacity:[1,1,1,1],opacityMix:[0,0,0,0],shift:[1,1,1,1],hasAnimations:l.checkForAnimations(e),hasShiftAnimation:!1,hasMotionAnimations:!1};o=l.getAnimationParams(this._poMap,e,o);const a="CIMPolygonSymbol"===e.type;let c=i.length;for(;c--;){const l=i[c];if(!l||!1===l.enable)continue;let u;r?.length&&(u=[...r]);const h=l.effects;h?.length&&(r?u.push(...h):u=[...h]);let d=null;if(u){d=[];for(const e of u){const t=f.OverrideHelper.findEffectOverrides(e,this._primitiveOverrides);t&&d.push(t)}}const p=[];switch(f.OverrideHelper.findApplicableOverrides(l,this._primitiveOverrides,p),l.type){case"CIMSolidFill":this._analyzeSolidFill(l,d,o,m.hasStrokeLayer(i));break;case"CIMPictureFill":this._analyzePictureFill(l,d,o);break;case"CIMHatchFill":this._analyzeHatchFill(l,d);break;case"CIMGradientFill":this._analyzeGradientFill(l,d);break;case"CIMSolidStroke":this._analyzeSolidStroke(l,d,a,s,o);break;case"CIMPictureStroke":this._analyzePictureStroke(l,d,a,s,o);break;case"CIMGradientStroke":this._analyzeGradientStroke(l,d,a,s);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":{"CIMLineSymbol"!==e.type&&"CIMPolygonSymbol"!==e.type||(n=x(l));const i=[],r=l.primitiveName;r&&i.push(r);const c=a&&m.isCIMMarkerStrokePlacement(l.markerPlacement);this._analyzeMarker(l,d,null,i,n,s,t,[],o,!1,c);break}default:y().error("Cannot analyze CIM layer",l.type)}}}_analyzeSolidFill(e,t,i,r){const{primitiveName:n,type:s}=e,o=m.normalizeAlpha(e.color),a=l.getAnimationParams(this._poMap,e,i);if(!r&&t?.some(e=>"CIMGeometricEffectTaperedPolygon"===e.effect.type)){const i=this._getValueOrOverrideExpression(s,n,"Color",o);return void this._cimLayers.push({type:"outlineFill",colorLocked:!!e.colorLocked,color:i,effects:t,outlineColor:i,outlineColorLocked:!!e.colorLocked,...u.antialiasingOutlineFillSettings,outlineEffects:t})}this._cimLayers.push({type:"fill",spriteRasterizationParam:null,colorLocked:!!e.colorLocked,color:this._getValueOrOverrideExpression(s,n,"Color",o),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t,applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!1,animationParams:w(a)})}_analyzePictureFill(e,t,i){const{primitiveName:r,type:n}=e,s=m.getTintColor(e),o=m.getNumericValue(e.height,h.defaultCIMValues.CIMPictureFill.height);let a=m.getNumericValue(e.scaleX,1);if("width"in e&&"number"==typeof e.width){const t=e.width;let i=1;const r=this._resourceManager.getResource(e.url);null!=r&&(i=r.width/r.height),a/=i*(o/t)}const c={type:"sprite-rasterization-param",resource:e,overrides:this._getPrimitiveMaterialOverrides(r,n)},u=l.getAnimationParams(this._poMap,e,i);this._cimLayers.push({type:"fill",spriteRasterizationParam:c,colorLocked:!!e.colorLocked,effects:t,color:this._getValueOrOverrideExpression(n,r,"TintColor",s),height:this._getValueOrOverrideExpression(n,r,"Height",o),scaleX:this._getValueOrOverrideExpression(n,r,"ScaleX",a),angle:this._getValueOrOverrideExpression(n,r,"Rotation",m.getNumericValue(e.rotation)),offsetX:this._getValueOrOverrideExpression(n,r,"OffsetX",m.getNumericValue(e.offsetX)),offsetY:this._getValueOrOverrideExpression(n,r,"OffsetY",m.getNumericValue(e.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!1,hasUnresolvedReplacementColor:!1,animationParams:w(u)})}_analyzeHatchFill(e,t){const{primitiveName:i,type:r}=e,n=this._analyzeMaterialOverrides(i,["Rotation","OffsetX","OffsetY"]),s=m.normalizePrimitiveOverrideProps(n);let o=[255,255,255,1],a=!1;if(e.lineSymbol?.symbolLayers)for(const t of e.lineSymbol.symbolLayers){if("CIMSolidStroke"!==t.type)continue;const e=t.primitiveName??i;a||!e||t.colorLocked||null==this._poMap[e]?.Color&&null==this._poMap[e]?.StrokeColor||(o=m.normalizeAlpha(t.color),o=this._maybeGetValueOrOverrideExpression(e,"StrokeColor")??this._getValueOrOverrideExpression(r,e,"Color",o),a=!0);const n=this._maybeGetValueOrOverrideExpression(e,"StrokeWidth");if(n){let t=null,i=null;"number"==typeof n?t=n:i=n.valueExpressionInfo;let o=s.find(e=>"strokeWidth"===e.propertyName);o?o.propertyName="width":(o={type:"CIMPrimitiveOverride",primitiveName:e,propertyName:"width",valueExpressionInfo:i,value:t,defaultValue:m.getDefaultCIMValue(r,"width")},s.push(o))}}const l={type:"sprite-rasterization-param",resource:e,overrides:s};this._cimLayers.push({type:"fill",spriteRasterizationParam:l,colorLocked:!!e.colorLocked,effects:t,color:o,height:this._getValueOrOverrideExpression(r,i,"Separation",m.getNumericValue(e.separation,h.defaultCIMValues.CIMHatchFill.separation)),scaleX:1,angle:this._getValueOrOverrideExpression(r,i,"Rotation",m.getNumericValue(e.rotation)),offsetX:this._getValueOrOverrideExpression(r,i,"OffsetX",m.getNumericValue(e.offsetX)),offsetY:this._getValueOrOverrideExpression(r,i,"OffsetY",m.getNumericValue(e.offsetY)),applyRandomOffset:!1,sampleAlphaOnly:!0,hasUnresolvedReplacementColor:!a})}_analyzeGradientFill(e,t){const{angle:i,gradientMethod:r,gradientSize:n,gradientSizeUnits:s,gradientType:o,interval:a,primitiveName:l,type:c}=e,u=h.defaultCIMValues.CIMGradientFill,d=e.colorRamp;this._cimLayers.push({type:"gradientFill",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:e,overrides:this._getPrimitiveMaterialOverrides(l,c)},colorLocked:!1,effects:t,color:[255,255,255,1],gradientMethod:this._getValueOrOverrideExpression(c,l,"GradientMethod",r??"Linear"),angle:this._getValueOrOverrideExpression(c,l,"Angle",m.getNumericValue(i,u.angle)),gradientType:this._getValueOrOverrideExpression(c,l,"GradientType",o??u.gradientType),interval:this._getValueOrOverrideExpression(c,l,"Interval",m.getNumericValue(a,"CIMFixedColorRamp"===d.type?d.colors.length:u.interval)),gradientSize:this._getValueOrOverrideExpression(c,l,"GradientSize",m.getNumericValue(n,u.gradientSize)),gradientSizeUnits:"Absolute"===s?1:"Relative"===s?0:u.gradientSizeUnits})}_analyzeCompositeOutlineFill(e,t,i){const r=e.find(e=>"CIMSolidFill"===e.type),n=e.find(e=>"CIMSolidStroke"===e.type);if(null==r||null==n)return;const s=[...t??[],...r.effects??[]].map(e=>f.OverrideHelper.findEffectOverrides(e,this._primitiveOverrides)).filter(e=>null!=e),o=[...t??[],...n.effects??[]].map(e=>f.OverrideHelper.findEffectOverrides(e,this._primitiveOverrides)).filter(e=>null!=e),a=m.getNumericValue(n.width,h.defaultCIMValues.CIMSolidStroke.width),l=m.getEnum(n.capStyle,h.defaultCIMValues.CIMSolidStroke.capstyle),c=m.getEnum(n.joinStyle,h.defaultCIMValues.CIMSolidStroke.joinstyle),u=n.miterLimit;this._cimLayers.push({type:"outlineFill",colorLocked:!!r.colorLocked,color:this._getValueOrOverrideExpression(r.type,r.primitiveName,"Color",m.normalizeAlpha(r.color)),effects:s,outlineColorLocked:!!n.colorLocked,outlineColor:this._getValueOrOverrideExpression(n.type,n.primitiveName,"Color",m.normalizeAlpha(n.color)),outlineWidth:this._getValueOrOverrideExpression(n.type,n.primitiveName,"Width",a),cap:this._getValueOrOverrideExpression(n.type,n.primitiveName,"CapStyle",l),join:this._getValueOrOverrideExpression(n.type,n.primitiveName,"JoinStyle",c),miterLimit:u&&this._getValueOrOverrideExpression(n.type,n.primitiveName,"MiterLimit",u),referenceWidth:i,outlineEffects:o})}_analyzeSolidStroke(e,t,i,r,n){const{primitiveName:s,type:o}=e,a=m.normalizeAlpha(e.color),c=m.getNumericValue(e.width,h.defaultCIMValues.CIMSolidStroke.width),u=m.getEnum(e.capStyle,h.defaultCIMValues.CIMSolidStroke.capstyle),d=m.getEnum(e.joinStyle,h.defaultCIMValues.CIMSolidStroke.joinstyle),f=e.miterLimit;let p,g,_,y,x=[];if(this._analyzePrimitiveOverrides(s,t,null,null)&&(x=this._getPrimitiveMaterialOverrides(s,o)),t&&Array.isArray(t)&&t.length>0){const e=t[t.length-1].effect;e&&"CIMGeometricEffectDashes"===e.type&&"NoConstraint"===e.lineDashEnding&&(p=e.dashTemplate,g=e.scaleDash,_=e.offsetAlongLine,y=e.primitiveName,(t=[...t]).pop())}null!=y&&x.push(...this._getPrimitiveMaterialOverrides(y,o).filter(e=>"dashTemplate"===e.propertyName));const v=void 0!==p?{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:p,primitiveName:y},overrides:x}:null,S=l.getAnimationParams(this._poMap,e,n);this._cimLayers.push({type:"line",spriteRasterizationParam:v,isOutline:i,colorLocked:!!e.colorLocked,effects:t,color:this._getValueOrOverrideExpression(o,s,"Color",a),width:this._getValueOrOverrideExpression(o,s,"Width",c),cap:this._getValueOrOverrideExpression(o,s,"CapStyle",u),join:this._getValueOrOverrideExpression(o,s,"JoinStyle",d),miterLimit:f&&this._getValueOrOverrideExpression(o,s,"MiterLimit",f),referenceWidth:r,zOrder:b(e.name),dashTemplate:this._maybeGetValueOrOverrideExpression(y,"DashTemplate")??p,offsetAlongLine:this._getValueOrOverrideExpression(o,y,"OffsetAlongLine",_??0),scaleDash:g,sampleAlphaOnly:!0,animationParams:w(S)})}_analyzePictureStroke(e,t,i,r,n){const{primitiveName:s,type:o}=e,a=m.getTintColor(e),c=m.getNumericValue(e.width,h.defaultCIMValues.CIMPictureStroke.width),u=m.getEnum(e.capStyle,h.defaultCIMValues.CIMPictureStroke.capstyle),d=m.getEnum(e.joinStyle,h.defaultCIMValues.CIMPictureStroke.joinstyle),f=e.miterLimit,p={type:"sprite-rasterization-param",resource:e,overrides:this._getPrimitiveMaterialOverrides(s,o)},g=l.getAnimationParams(this._poMap,e,n);this._cimLayers.push({type:"line",spriteRasterizationParam:p,isOutline:i,colorLocked:!!e.colorLocked,effects:t,color:this._getValueOrOverrideExpression(o,s,"TintColor",a),width:this._getValueOrOverrideExpression(o,s,"Width",c),cap:this._getValueOrOverrideExpression(o,s,"CapStyle",u),join:this._getValueOrOverrideExpression(o,s,"JoinStyle",d),miterLimit:f&&this._getValueOrOverrideExpression(o,s,"MiterLimit",f),referenceWidth:r,zOrder:b(e.name),dashTemplate:null,scaleDash:!1,sampleAlphaOnly:!1,animationParams:w(g)})}_analyzeGradientStroke(e,t,i,r){const{gradientMethod:n,gradientSize:s,gradientSizeUnits:o,gradientType:a,interval:l,primitiveName:c,type:u}=e,d=h.defaultCIMValues.CIMGradientStroke,f=m.getNumericValue(e.width,d.width),p=m.getEnum(e.capStyle,d.capstyle),g=m.getEnum(e.joinStyle,d.joinstyle),_=e.miterLimit,y=e.colorRamp;this._cimLayers.push({type:"gradientStroke",spriteRasterizationParam:{type:"sprite-rasterization-param",resource:e,overrides:this._getPrimitiveMaterialOverrides(c,u)},colorLocked:!!e.colorLocked,effects:t,color:[255,255,255,1],width:this._getValueOrOverrideExpression(u,c,"Width",f),cap:this._getValueOrOverrideExpression(u,c,"CapStyle",p),join:this._getValueOrOverrideExpression(u,c,"JoinStyle",g),miterLimit:_&&this._getValueOrOverrideExpression(u,c,"MiterLimit",_),referenceWidth:r,isOutline:i,gradientMethod:this._getValueOrOverrideExpression(u,c,"GradientMethod",n??d.gradientMethod),gradientType:this._getValueOrOverrideExpression(u,c,"GradientType",a??d.gradientType),interval:this._getValueOrOverrideExpression(u,c,"Interval",m.getNumericValue(l,"CIMFixedColorRamp"===y.type?y.colors.length:d.interval)),gradientSize:this._getValueOrOverrideExpression(u,c,"GradientSize",m.getNumericValue(s,d.gradientSize)),gradientSizeUnits:"Absolute"===o?1:"Relative"===o?0:d.gradientSizeUnits})}_analyzeMarker(e,t,i,r,n,s,o,a,c,u=!1,d=!1){u||=!!e.colorLocked;let f=c;if(f=l.handleAbsoluteAnchor(e,f),f=l.handleMarker(this._poMap,e,f),f=l.handleRelativeAnchor(e,f),f=l.getAnimationParams(this._poMap,e,f),this._analyzeMarkerInsidePolygon(e,t,u,f))return;const p=m.getNumericValue(e.size,h.defaultCIMValues.CIMVectorMarker.size),g=m.getNumericValue(e.rotation),_=m.getNumericValue(e.offsetX),y=m.getNumericValue(e.offsetY),{primitiveName:x,type:b}=e,v=this._getValueOrOverrideExpression(b,x,"Size",p),S=this._getValueOrOverrideExpression(b,x,"Rotation",g),w=this._getValueOrOverrideExpression(b,x,"OffsetX",_),T=this._getValueOrOverrideExpression(b,x,"OffsetY",y);switch(e.type){case"CIMPictureMarker":this._analyzePictureMarker(e,t,i,r,n,s,v,S,w,T,a,f,u,d);break;case"CIMVectorMarker":this._analyzeVectorMarker(e,t,i,r,n,s,v,S,w,T,a,f,o,u,d)}}_analyzeMarkerInsidePolygon(e,t,i,r){const{markerPlacement:n,type:s}=e;if(!n||"CIMMarkerPlacementInsidePolygon"!==n.type||r.hasMotionAnimations)return!1;if("CIMVectorMarker"===s||"CIMPictureMarker"===s){const i=e.primitiveName;if(i&&this._analyzePrimitiveOverrides([i],t,null,null))return!1;const r=n.primitiveName;if(r&&this._analyzePrimitiveOverrides([r],t,null,null))return!1;if("CIMVectorMarker"===s){const{markerGraphics:t}=e;if(t)for(const e of t){const{symbol:t}=e;if("CIMPolygonSymbol"===t?.type&&t.symbolLayers){const{symbolLayers:e}=t;for(const t of e)if("CIMSolidStroke"===t.type)return!1}}}else{const{animatedSymbolProperties:t}=e;if(t)return!1}}const a=Math.abs(n.stepX),l=Math.abs(n.stepY);if(0===a||0===l)return!0;let c,u;if("Random"===n.gridType){const e=o.px2pt(_.randomInsidePolygonTextureSize),t=Math.max(Math.floor(e/a),1);c=l*Math.max(Math.floor(e/l),1),u=t*a/c}else n.shiftOddRows?(c=2*l,u=a/l*.5):(c=l,u=a/l);const h=m.getTintColor(e),d="CIMCharacterMarker"===e.type?null:{type:"sprite-rasterization-param",resource:e,overrides:[]};return this._cimLayers.push({type:"fill",spriteRasterizationParam:d,colorLocked:i,effects:t,color:h,height:c,scaleX:u,angle:n.gridAngle,offsetX:m.getNumericValue(n.offsetX),offsetY:m.getNumericValue(n.offsetY),applyRandomOffset:"Random"===n.gridType,sampleAlphaOnly:"CIMPictureMarker"!==e.type,hasUnresolvedReplacementColor:!0,animationParams:w(r)}),!0}_analyzePictureMarker(e,t,i,r,s,o,l,c,u,h,d,f,p,g){const{animatedSymbolProperties:_,primitiveName:y,type:x}=e;let b=m.getNumericValue(e.scaleX,1);const v=m.getTintColor(e);i||(i=this._createMarkerPlacementOverrideExpression(e.markerPlacement));const S=this._createGIFAnimatedSymbolPropertiesOverrideExpression(_),T=e.anchorPoint??{x:0,y:0};if("width"in e&&"number"==typeof e.width){const t=e.width;let i=1;const r=this._resourceManager.getResource(e.url);null!=r&&(i=r.width/r.height),b/=i*(m.getNumericValue(e.size)/t)}const M=[...r];let P;e.primitiveName&&M.push(e.primitiveName),_||S?P={type:"animated",url:e.url,urlHash:"H"+a.numericHash(e.url),playAnimation:e.animatedSymbolProperties?.playAnimation,reverseAnimation:e.animatedSymbolProperties?.reverseAnimation,randomizeStartTime:e.animatedSymbolProperties?.randomizeStartTime,randomizeStartSeed:e.animatedSymbolProperties?.randomizeStartSeed,startTimeOffset:e.animatedSymbolProperties?.startTimeOffset,duration:e.animatedSymbolProperties?.duration,repeatType:e.animatedSymbolProperties?.repeatType,repeatDelay:e.animatedSymbolProperties?.repeatDelay}:(P=n.clone(e),P.markerPlacement=null);const I={type:"sprite-rasterization-param",resource:P,overrides:this._getMaterialOverrides(M,x)};S&&I.overrides.push(...S.overrides);const C=l;this._cimLayers.push({type:"marker",spriteRasterizationParam:I,colorLocked:p,effects:t,scaleSymbolsProportionally:!1,alignment:s,size:l,scaleX:this._getValueOrOverrideExpression(x,y,"ScaleX",b),rotation:c,offsetX:u,offsetY:h,transform:{type:"cim-marker-transform-param",params:d},color:this._getValueOrOverrideExpression(x,y,"TintColor",v),anchorPoint:{x:T.x,y:T.y},isAbsoluteAnchorPoint:"Relative"!==e.anchorPointUnits,outlineColor:[0,0,0,0],outlineWidth:0,frameHeight:0,widthRatio:1,rotateClockwise:!!e.rotateClockwise,referenceSize:o,sizeRatio:1,isOutline:g,markerPlacement:i,animationParams:w(f),baseSize:C})}_analyzeVectorMarker(e,t,i,r,n,s,o,a,c,u,h,d,f,p,m){const g=e.markerGraphics;if(!g)return;const _=e.frame;let y=0;y=_?_.ymax-_.ymin:s;const x=!!e.scaleSymbolsProportionally;if(y){const t={offsetX:c,offsetY:u,rotation:a,size:o,frameHeight:y,rotateClockWise:!!e.rotateClockwise,absoluteAnchorPoint:!1,scaleSymbolsProportionally:x};h=[...h,t]}i||(i=this._createMarkerPlacementOverrideExpression(e.markerPlacement));for(const o of g)if(o){const a=o.symbol;if(!a)continue;const c=o.primitiveName;c&&r.push(c);let u,g=d;if(("CIMPointSymbol"===a.type||"CIMTextSymbol"===a.type)&&_){let t=0,i=0;const r=o.geometry;"x"in r&&"y"in r&&(t+=r.x-.5*(_.xmin+_.xmax),i+=r.y-.5*(_.ymin+_.ymax));const n=e.anchorPoint;let s=!1;n&&("Absolute"===e.anchorPointUnits?(t-=n.x,i-=n.y,s=!0):_&&(t-=(_.xmax-_.xmin)*n.x,i-=(_.ymax-_.ymin)*n.y));const a={offsetX:t,offsetY:i,rotation:0,size:0,frameHeight:0,rotateClockWise:!1,absoluteAnchorPoint:s,scaleSymbolsProportionally:x};u=[...h,a]}const b=o.geometry,[S,w]=l.getFrameTranslation(b,_);switch(0===S&&0===w||(g=l.translate(g,S,w)),"CIMPointSymbol"===a.type&&(g=l.getAnimationParams(this._poMap,a,g)),a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":f||v(a)?(g={...g,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!0,translation:l.getStaticParam([0,0]),rotation:l.getStaticParam(0),scale:l.getStaticParam(y),parent:d.transform}},this._analyzeMultiLayerGraphicNonSDF(e,t,i,o,r,n,s,u??h,g,y,p,m)):this._analyzeMultiLayerGraphic(e,t,i,o,r,n,s,u??h,g,y,p,m);break;case"CIMTextSymbol":this._analyzeTextGraphic(t,i,o,r,n,s,u??h,p)}c&&r.pop()}}_analyzeMultiLayerGraphic(e,t,i,r,n,s,o,a,c,u,h,d){const f=r.symbol.symbolLayers;f&&(!(e=>e&&2===e.length&&e[0].enable&&e[1].enable&&"CIMSolidStroke"===e[0].type&&"CIMSolidFill"===e[1].type&&null==e[0].path&&null==e[1].path&&!e[0].effects&&!e[1].effects&&!e[0].animations&&!e[1].animations)(f)||l.shouldUseAnimatedPath(c)?function(e){return e.some(e=>"CIMSolidFill"!==e.type&&"CIMSolidStroke"!==e.type&&("CIMVectorMarker"!==e.type&&"CIMPictureMarker"!==e.type||null!=e.markerPlacement))}(f)?this._analyzeMultiLayerGraphicNonSDF(e,t,i,r,n,s,o,a,c,u,!!h,d):this._analyzeMarkerGraphicSymbolLayers(e,t,i,r,n,s,o,a,c,u,h,d):this._analyzeCompositeMarkerGraphic(e,t,i,r,f,s,o,a,u,h,d))}_analyzeMarkerGraphicSymbolLayers(e,t,i,r,n,s,o,a,c,u,d,f){const _=r.symbol,x=_.symbolLayers;if(!x)return;const b=g.CIMEffectHelper.applyEffects(_.effects,r.geometry);if(!b)return;let v=x.length;for(;v--;){const _=x[v];if(!_||!1===_.enable)continue;const S=_.primitiveName;switch(S&&n.push(S),_.type){case"CIMSolidFill":case"CIMSolidStroke":{const n=g.CIMEffectHelper.applyEffects(_.effects,b),y=p.getExtent(n);if(!y)continue;const x="Relative"!==e.anchorPointUnits,v=m.getStrokeWidth(_)??0,{frameSizeRatio:T,anchorX:M,anchorY:P,widthRatio:I,sdfPaddingRatio:C}=p.getSDFMetrics(y,e.frame,e.size,e.anchorPoint,x,v,e.scaleSymbolsProportionally),F="CIMSolidFill"===_.type,O={type:"sdf",geom:n,sdfPaddingRatio:C,asFill:F},{path:A}=_,E=F?m.normalizeAlpha(m.getFillColor(_)):null==A?m.normalizeAlpha(m.getStrokeColor(_)):[0,0,0,0],z=F?[0,0,0,0]:m.normalizeAlpha(m.getStrokeColor(_));if(!F&&!v)break;const R=r.primitiveName;let V=null;F&&!_.colorLocked&&(V=this._maybeGetValueOrOverrideExpression(R,"FillColor"));let D=null;F||_.colorLocked||(D=this._maybeGetValueOrOverrideExpression(R,"StrokeColor"));const k=V??this._getValueOrOverrideExpression(_.type,S,"Color",E),L=D??this._getValueOrOverrideExpression(_.type,S,"Color",z),B=this._maybeGetValueOrOverrideExpression(R,"StrokeWidth")??this._getValueOrOverrideExpression(_.type,S,"Width",v),N=A?{type:"sprite-rasterization-param",resource:{type:"path",path:A,asFill:F},overrides:[]}:{type:"sprite-rasterization-param",resource:O,overrides:[]},G=l.getAnimationParams(this._poMap,_,c),U=m.getNumericValue(e.size,h.defaultCIMValues.CIMVectorMarker.size),q=this._getValueOrOverrideExpression(e.type,e.primitiveName,"Size",U);this._cimLayers.push({type:"marker",spriteRasterizationParam:N,colorLocked:!!_.colorLocked||!!d,effects:t,scaleSymbolsProportionally:!!e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:M,y:P},isAbsoluteAnchorPoint:x,size:u,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:a},frameHeight:u,widthRatio:I,rotateClockwise:!1,referenceSize:o,sizeRatio:T,color:k,outlineColor:L,outlineWidth:B,isOutline:f,markerPlacement:i,animationParams:w(G),isStroke:"CIMSolidFill"!==_.type,baseSize:q,...p.getSDFDimensions(n,C)});break}case"CIMPictureMarker":case"CIMVectorMarker":if(_.markerPlacement){y().error("Error analyzing CIM, got unexpected marker placement");break}this._analyzeMarker(_,t,i,n,s,o,!1,a,c,d,f)}S&&n.pop()}}_analyzeTextGraphic(e,t,r,n,s,o,a,l){f.OverrideHelper.findApplicableOverrides(r,this._primitiveOverrides,[]);const c=r.geometry;if(!("x"in c)||!("y"in c))return;const u=r.symbol,d=m.fromCIMFontDecoration(u),p=m.fromCIMFontStyle(u.fontStyleName),g=i.getFontFamily(u.fontFamilyName);u.font={family:g,decoration:d,...p};const _=m.getNumericValue(u.height,h.defaultCIMValues.CIMTextSymbol.height),y=m.getNumericValue(u.angle),x=m.getNumericValue(u.offsetX),b=m.getNumericValue(u.offsetY),{haloSymbol:v}=u,S=m.getNumericValue(u.haloSize,0);let w=[0,0,0,0];if(v?.symbolLayers?.length){const e=v.symbolLayers;for(const t of e)if(t.color){w=this._getValueOrOverrideExpression(u?.haloSymbol?.type??"CIMPolygonSymbol",t.primitiveName,"Color",m.normalizeAlpha(t.color));break}}const T=r.primitiveName;let M=[0,0,0,1],P=[0,0,0,0],I=0,C=!1;if(u.symbol?.symbolLayers)for(const e of u.symbol.symbolLayers){const t=e.primitiveName;if("CIMSolidStroke"===e.type)P=this._getValueOrOverrideExpression("CIMSolidStroke",t,"Color",m.normalizeAlpha(e.color)),I=this._getValueOrOverrideExpression("CIMSolidStroke",t,"Width",m.getStrokeWidth(e)??0);else if("CIMSolidFill"===e.type){const i=m.normalizeAlpha(e.color);C=C??!!e.colorLocked,M=this._getValueOrOverrideExpression("CIMSolidFill",t??T,"Color",i)}}let F=null,O=null,A=null,E=null,z=null;T&&(F=this._maybeGetValueOrOverrideExpression(T,"TextSize"),O=this._maybeGetValueOrOverrideExpression(T,"TextAngle"),A=this._maybeGetValueOrOverrideExpression(T,"TextOffsetX"),E=this._maybeGetValueOrOverrideExpression(T,"TextOffsetY"),C||(z=this._maybeGetValueOrOverrideExpression(T,"FillColor")));const R=z??M;let V=null,D=null,k=0;if(u.callout&&"CIMBackgroundCallout"===u.callout.type){const e=u.callout;if(e.backgroundSymbol){const t=e.backgroundSymbol.symbolLayers;if(t)for(const e of t)"CIMSolidFill"===e.type?V=m.normalizeAlpha(e.color):"CIMSolidStroke"===e.type&&(D=m.normalizeAlpha(e.color),k=m.getNumericValue(e.width,h.defaultCIMValues.CIMSolidStroke.width))}}const L=this._getValueOrOverrideExpression(u.type,r.primitiveName,"TextString",r.textString??"");if(null==L)return;const{fontStyleName:B}=u,N=g+(B?"-"+B.toLowerCase():"-regular"),G=this._getMaterialOverrides(n,u.type);G.push(...this._getPrimitiveMaterialOverrides(r.primitiveName,u.type)),this._collectDictionaryTemplateOverrides(G,r);const U={type:"text-rasterization-param",resource:{type:"text",textString:r.textString??"",font:u.font,symbol:u,primitiveName:r.primitiveName},overrides:G};this._cimLayers.push({type:"text",lineWidth:u.lineWidth,textRasterizationParam:U,colorLocked:!!l||!!C,effects:e,alignment:s,anchorPoint:{x:0,y:0},isAbsoluteAnchorPoint:!1,fontName:N,decoration:d,haloSize:S,haloColor:w,weight:p.weight,style:p.style,size:F??_,angle:O??y,offsetX:A??x,offsetY:E??b,transform:{type:"cim-marker-transform-param",params:a},horizontalAlignment:m.fromCIMHorizontalAlignment(u.horizontalAlignment),verticalAlignment:m.fromCIMVerticalAlignment(u.verticalAlignment),text:L,color:R,outlineColor:P,outlineSize:I,backgroundColor:V,borderLineColor:D,borderLineWidth:k,referenceSize:o,sizeRatio:1,markerPlacement:t})}_collectDictionaryTemplateOverrides(e,t){if(t.textString&&this._hasTextStringTemplates){const i=m.getTextCasing(t.symbol);e.push({propertyName:"textString",defaultValue:"",valueExpressionInfo:{type:"dictionary-template",textCase:i,template:t.textString},primitiveName:t.primitiveName})}}_analyzeMultiLayerGraphicNonSDF(e,t,i,r,n,s,a,l,u,d,f,p){const g=function(e,t){return{type:e.type,enable:!0,name:e.name,colorLocked:e.colorLocked,primitiveName:e.primitiveName,anchorPoint:e.anchorPoint,anchorPointUnits:e.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:e.rotateClockwise,rotation:0,size:e.size,billboardMode3D:e.billboardMode3D,depth3D:e.depth3D,frame:e.frame,markerGraphics:[t],scaleSymbolsProportionally:e.scaleSymbolsProportionally,respectFrame:e.respectFrame,clippingPath:e.clippingPath}}(e,r),y=e.primitiveName,x=this._analyzeMaterialOverrides(y,["Rotation","OffsetX","OffsetY"]),b=m.normalizePrimitiveOverrideProps(x),[v,S,T]=c.CIMSymbolHelper.getTextureAnchor(g,this._resourceManager,_.rasterizedVectorMarkerMinSize),M=this._getMaterialOverrides(n,e.type);M.push(...b);const P={type:"sprite-rasterization-param",resource:{...g,avoidSDFRasterization:!0},overrides:M},I=m.getNumericValue(e.size,h.defaultCIMValues.CIMVectorMarker.size),C=this._getValueOrOverrideExpression(e.type,y,"Size",I);this._cimLayers.push({type:"marker",spriteRasterizationParam:P,colorLocked:f,effects:t,scaleSymbolsProportionally:!!e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:v,y:S},isAbsoluteAnchorPoint:!1,size:d,rotation:0,offsetX:0,offsetY:0,transform:{type:"cim-marker-transform-param",params:l},color:[255,255,255,1],outlineColor:[0,0,0,0],outlineWidth:0,scaleX:1,frameHeight:d,widthRatio:1,rotateClockwise:!!e.rotateClockwise,referenceSize:a,sizeRatio:T/o.pt2px(e.size),isOutline:p,markerPlacement:i,animationParams:w(u),baseSize:C})}_createMarkerPlacementOverrideExpression(e){if(!e)return null;const t=[];return f.OverrideHelper.findApplicableOverrides(e,this._primitiveOverrides,t),{type:"cim-marker-placement-param",placement:e,overrides:S(t)}}_createGIFAnimatedSymbolPropertiesOverrideExpression(e){if(!e)return null;const t=[];return f.OverrideHelper.findApplicableOverrides(e,this._primitiveOverrides,t),{type:"cim-gif-animation-params",animation:e,overrides:S(t)}}_analyzeCompositeMarkerGraphic(e,t,i,r,n,s,o,a,l,c,u){const d=r.geometry,f=n[0],g=n[1],_=p.getExtent(d);if(!_)return;const y="Relative"!==e.anchorPointUnits,x=m.getNumericValue(f.width,h.defaultCIMValues.CIMSolidStroke.width),{frameSizeRatio:b,anchorX:v,anchorY:S,widthRatio:w,sdfPaddingRatio:T}=p.getSDFMetrics(_,e.frame,e.size,e.anchorPoint,y,x,e.scaleSymbolsProportionally),{path:M}=g,P=g.primitiveName,I=f.primitiveName,C=r.primitiveName;let F=null;g.colorLocked||c||(F=this._maybeGetValueOrOverrideExpression(C,"FillColor"));const O=F??this._getValueOrOverrideExpression(g.type,P,"Color",m.normalizeAlpha(g.color));let A=null;f.colorLocked||c||(A=this._maybeGetValueOrOverrideExpression(C,"StrokeColor"));const E=A??this._getValueOrOverrideExpression(f.type,I,"Color",m.normalizeAlpha(f.color)),z=this._maybeGetValueOrOverrideExpression(C,"StrokeWidth")??this._getValueOrOverrideExpression(f.type,I,"Width",x),R={type:"sprite-rasterization-param",resource:M?{type:"path",path:M,asFill:!0}:{type:"sdf",geom:d,sdfPaddingRatio:T,asFill:!0},overrides:[]};this._cimLayers.push({type:"marker",spriteRasterizationParam:R,colorLocked:c,effects:t,scaleSymbolsProportionally:!!e.scaleSymbolsProportionally,alignment:s,anchorPoint:{x:v,y:S},isAbsoluteAnchorPoint:y,size:l,rotation:0,offsetX:0,offsetY:0,scaleX:1,transform:{type:"cim-marker-transform-param",params:a},frameHeight:l,widthRatio:w,rotateClockwise:!1,referenceSize:o,sizeRatio:b,color:O,outlineColor:E,outlineWidth:z,isOutline:u,markerPlacement:i})}_setPoMap(e,t,i){let r;this._poMap[e]?r=this._poMap[e]:(r={},this._poMap[e]=r),r[t]=i}_maybeGetValueOrOverrideExpression(e,t,i){return this._getValueOrOverrideExpression("",e,t,i,!1)}_getValueOrOverrideExpression(e,t,i,r,n=!0){if(n&&!m.isValidCIMValue(r)&&(r=m.getDefaultCIMValue(e,i.toLowerCase())),null==t)return r;const s=this._poMap[t];if(null==s)return r;const o=s[i];return"string"==typeof o||"number"==typeof o||Array.isArray(o)?o:o?{valueExpressionInfo:o,defaultValue:r}:r}_analyzePrimitiveOverrides(e,t,i,r){if(null==e)return!1;"string"==typeof e&&(e=[e]);for(const t of this._primitiveOverrides)if(e.includes(t.primitiveName)&&t.valueExpressionInfo)return!0;if(null!=t)for(const e of t)if(e?.overrides.length>0)return!0;if(null!=i)for(const e of i)if(e?.overrides.length>0)return!0;if(null!=r)for(const e of r)if(e?.overrides.length>0)return!0;return!1}_getMaterialOverrides(e,t){if(!e)return[];const i=[];for(const r of e)i.push(...this._getPrimitiveMaterialOverrides(r,t));return i}_getPrimitiveMaterialOverrides(e,t){if(!e)return[];const i=m.normalizePrimitiveOverrideProps(this._primitiveOverrides.filter(t=>t.primitiveName===e));return i.forEach(e=>e.defaultValue=m.getDefaultCIMValue(t,e.propertyName.toLowerCase())),i}_analyzeMaterialOverrides(e,t){return this._primitiveOverrides.filter(i=>i.primitiveName!==e||!t.includes(i.propertyName))}},e.analyzeCIMResource=function(e,t){if(!t||0===t.length)return e;const i=n.clone(e);return f.OverrideHelper.applyOverrides(i,t),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define(["exports","../Color","./arrayUtils","./lang","./mathUtils","../chunks/vec42","./libs/gl-matrix-2/factories/vec4f64"],function(e,t,i,r,n,s,o){"use strict";function a(e){return"r"in e&&"g"in e&&"b"in e}function l(e){return"h"in e&&"s"in e&&"v"in e}function c(e){return"l"in e&&"a"in e&&"b"in e}function u(e){return"l"in e&&"c"in e&&"h"in e}const h=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],d=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];function f(e,t){const i=[];let r,n;if(e[0].length!==t.length)throw new Error("dimensions do not match");const s=e.length,o=e[0].length;let a=0;for(r=0;r<s;r++){for(a=0,n=0;n<o;n++)a+=e[r][n]*t[n];i.push(a)}return i}function p(e){const t=[e.r/255,e.g/255,e.b/255].map(e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4),i=f(h,t);return{x:100*i[0],y:100*i[1],z:100*i[2]}}function m(e){const t=f(d,[e.x/100,e.y/100,e.z/100]).map(e=>{const t=e<=.0031308?12.92*e:1.055*e**(1/2.4)-.055;return Math.min(1,Math.max(t,0))});return{r:Math.round(255*t[0]),g:Math.round(255*t[1]),b:Math.round(255*t[2])}}function g(e){const t=[e.x/95.047,e.y/100,e.z/108.883].map(e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29);return{l:116*t[1]-16,a:500*(t[0]-t[1]),b:200*(t[1]-t[2])}}function _(e){const t=e.l,i=[(t+16)/116+e.a/500,(t+16)/116,(t+16)/116-e.b/200].map(e=>e>6/29?e**3:3*(6/29)**2*(e-4/29));return{x:95.047*i[0],y:100*i[1],z:108.883*i[2]}}function y(e){return a(e)?e:u(e)?function(e){return m(_(function(e){const t=e.l,i=e.c,r=e.h;return{l:t,a:i*Math.cos(r),b:i*Math.sin(r)}}(e)))}(e):c(e)?function(e){return m(_(e))}(e):function(e){return"x"in e&&"y"in e&&"z"in e}(e)?m(e):l(e)?function(e){const t=(e.h+360)%360/60,i=e.s/100,r=e.v/100*255,n=r*i,s=n*(1-Math.abs(t%2-1));let o;switch(Math.floor(t)){case 0:o={r:n,g:s,b:0};break;case 1:o={r:s,g:n,b:0};break;case 2:o={r:0,g:n,b:s};break;case 3:o={r:0,g:s,b:n};break;case 4:o={r:s,g:0,b:n};break;case 5:case 6:o={r:n,g:0,b:s};break;default:o={r:0,g:0,b:0}}return o.r=Math.round(o.r+r-n),o.g=Math.round(o.g+r-n),o.b=Math.round(o.b+r-n),o}(e):e}function x(e){return l(e)?e:function(e){const t=e.r,i=e.g,r=e.b,n=Math.max(t,i,r),s=n-Math.min(t,i,r);let o=n,a=0===s?0:n===t?(i-r)/s%6:n===i?(r-t)/s+2:(t-i)/s+4,l=0===s?0:s/o;return a<0&&(a+=6),a*=60,l*=100,o*=100/255,{h:a,s:l,v:o}}(y(e))}function b(e){return c(e)?e:function(e){return g(p(e))}(y(e))}function v(e){let{r:i,g:r,b:n,a:s}=e;return s<1&&(i=Math.round(s*i+255*(1-s)),r=Math.round(s*r+255*(1-s)),n=Math.round(s*n+255*(1-s))),new t({r:i,g:r,b:n})}function S(e,t){const{r:i,g:r,b:n}=t?.ignoreAlpha?e:v(e);return.2126*i+.7152*r+.0722*n}function w(e){return e[0]??=0,e[1]??=0,e[2]??=0,e}const T=(e,t)=>{const i=Math.floor(10*t())-5;return Math.min(255,Math.max(0,e+i))};function M(e,r,n,s={}){const o=e.r,a=e.g,l=e.b,c=r.r,u=r.g,h=r.b,d=Math.round(o+(c-o)*n),f=Math.round(a+(u-a)*n),p=Math.round(l+(h-l)*n);if(!s.offset)return new t([d,f,p]);const m=i.getRandomNumberGenerator(s.seed);return new t([T(d,m),T(f,m),T(p,m)])}e.colorEquals=function(e,t){return e===t||null!=e&&e.equals(t)},e.colorVectorEquals=function(e,t){return e===t||null!=e&&null!=t&&s.equals(e,t)},e.colorVectorToColorAndOpacity=function(e){return o.fromValues(e[0],e[1],e[2],e.length>3?e[3]:1)},e.createUniqueColors=function(e,n,s={}){if(0===e.length||n<=0)return[];if(1===(e=e.map(e=>"string"==typeof e?new t(e):e)).length||1===n){const t=[],i=e[0];for(let e=0;e<n;e++)t.push(i.clone());return t}if(s.shuffle&&(e=i.shuffle(r.clone(e),s.seed)),e.length>=n){const t=[],i=(e.length-1)/(n-1);for(let r=0;r<n;r++){const n=Math.round(r*i);t.push(e[n].clone())}return t}return function(e,t,r={}){const n=[],s=e.length-1,o=Math.ceil((t-e.length)/s);e:for(let i=0;i<s;i++){const s=e[i],a=e[i+1];for(let i=1;i<=o;i++){const l=i/(o+1);if(n.push(M(s,a,l,r)),n.length+e.length===t)break e}}return[...e.map(e=>e.clone()),...i.shuffle(n,r.seed??1)]}(e,n,s)},e.darken=function(e,t){const i=b(e);i.l*=1-t;const r=y(i),n=e.clone();return n.setColor(r),n.a=e.a,n},e.desaturate=function(e,t){const i=x(e);i.s*=t;const r=y(i),n=e.clone();return n.setColor(r),n.a=e.a,n},e.getColorLuminance=S,e.getColorTheme=function(e){return v(e).isBright?"light":"dark"},e.getContrast=function(e,i=225){return S(e,{ignoreAlpha:!0})>i?new t([0,0,0,e.a]):new t([255,255,255,e.a])},e.isRGB=a,e.multiplyOpacity=function(e,t){const i=e.clone();return i.a*=t,i},e.multiplyOpacityToUnitRGBA=function(e,i){const r=t.toUnitRGBA(e);return r[3]*=i,r},e.toHSV=x,e.toLAB=b,e.toLCH=function(e){return u(e)?e:function(e){return function(e){const t=e.l,i=e.a,r=e.b,n=Math.sqrt(i*i+r*r);let s=Math.atan2(r,i);return s=s>0?s:s+2*Math.PI,{l:t,c:n,h:s}}(g(p(e)))}(y(e))},e.toRGB=y,e.unitRGBAFromColor=function(e){return t.toUnitRGBA(e)},e.validateColor=w,e.validateColorAndOpacity=function(e){return e.length=4,w(e),e[3]??=1,n.clamp(e[3],0,1),e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(e,t){"use strict";const i="arial-unicode-ms",r="woff2",n=new Map,s=new Set;class o{constructor(e,t){this.fontFace=e,this.promise=t}}function a(e){if(!e)return i;const t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}function l(e){const t=c(e)+u(e);return a(e.family)+(t.length>0?t:"-regular")}function c(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function u(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}e.clearFonts=function(){const e=document.fonts;n.forEach(t=>{e.delete(t.fontFace)}),n.clear(),s.clear()},e.defaultFontFamily=i,e.getFontFamily=a,e.getFullyQualifiedFontName=l,e.isCachedFontFace=function(e){return s.has(e)},e.loadFont=async function(e){const a=function(e){const t=c(e)+u(e);return(e.family||i)+(t.length>0?t:"-regular")}(e),h=l(e),d=n.get(a);if(d)return d.promise;const f=new FontFace(e.family,`url('${t.fontsUrl}/woff2/${h}.${r}') format('${r}')`,{style:e.style,weight:e.weight}),p=document.fonts;if(p.has(f)&&"loading"===f.status)return f.loaded;const m=f.load().then(()=>(p.add(f),f));return n.set(a,new o(f,m)),s.add(f),m},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/animationUtils":function(){define(["exports","../../core/Logger","./animationDebugFlags","./defaultCIMValues","./SDFHelper","./utils"],function(e,t,i,r,n,s){"use strict";function o(e){return!!e.animations&&e.animations.length>0}function a(e){return!!e.animations&&e.animations.some(e=>"CIMSymbolAnimationMoveAlongLine"===e.type)}const l=new Set(["CIMSymbolAnimationOffset","CIMSymbolAnimationRotation","CIMSymbolAnimationSize","CIMSymbolAnimationScale"]);function c(e){return!!e.animations&&e.animations.some(e=>l.has(e.type))}function u(e,t){let i=0,r=0;const n="Absolute"!==e.anchorPointUnits;return e.anchorPoint&&(i=-e.anchorPoint.x,r=-e.anchorPoint.y),{...t,transform:{type:"AnimatedTransform",relativeTranslation:n,absoluteScale:!1,translation:p([i,r]),rotation:p(0),scale:p(1),parent:t.transform}}}function h(e,t){switch(t.type){case"CIMPictureMarker":case"CIMVectorMarker":return s.getProcessParam(e,t,"Rotation")}return 0}function d(e,t){switch(t.type){case"CIMPointSymbol":case"CIMVectorMarker":return[1,1,1,1];case"CIMSolidStroke":case"CIMSolidFill":return s.getProcessParam(e,t,"Color");case"CIMPictureMarker":case"CIMPictureStroke":case"CIMPictureFill":return s.getProcessParam(e,t,"TintColor")}return[1,1,1,1]}function f(e,t){if(!t)return{duration:1,startTimeOffset:0,repeatDelay:0,timeOriginSelector:"Local",repeatType:"Loop",easing:"Linear",playAnimation:1,reverseAnimation:0};const i=s.getProcessParam(e,t,"Duration");let n;n=s.getProcessParam(e,t,"RandomizeStartTime")?{type:"Process",op:"Random",min:0,max:i,seed:s.getProcessParam(e,t,"RandomizeStartSeed")}:s.getProcessParam(e,t,"StartTimeOffset");const o=s.getProcessParam(e,t,"RepeatDelay"),a=s.getProcessParam(e,t,"PlayAnimation"),l=s.getProcessParam(e,t,"ReverseAnimation"),c=s.getValue(t.repeatType,r.defaultCIMValues.CIMAnimatedSymbolProperties.repeattype);return{duration:i,startTimeOffset:n,repeatDelay:o,timeOriginSelector:"None"===c?"Local":"Global",repeatType:c,easing:s.getValue(t.easing,r.defaultCIMValues.CIMAnimatedSymbolProperties.easing),playAnimation:a,reverseAnimation:l}}function p(e){return{from:e,to:e,timing:{duration:1,startTimeOffset:0,repeatDelay:0,timeOriginSelector:"Local",repeatType:"Loop",easing:"Linear",playAnimation:1,reverseAnimation:0}}}e.checkForAnimations=function e(t){if(null==t)return!1;if("object"!=typeof t)return!1;if(t.animations&&Array.isArray(t.animations)&&t.animations.length>0)return!0;for(const i in t)if(e(t[i]))return!0;return!1},e.getAnimationParams=function(e,t,i){const r=function(e,t,i){const r=function(e,t){const{animations:i}=t,r=i?.find(e=>"CIMSymbolAnimationOffset"===e.type);return r?{from:[0,0],to:[s.getProcessParam(e,r,"OffsetX"),s.getProcessParam(e,r,"OffsetY")],timing:f(e,r.animatedSymbolProperties)}:p([0,0])}(e,t),n=function(e,t){const{animations:i}=t,r=function(e,t){switch(t.type){case"CIMPictureMarker":case"CIMVectorMarker":return s.getProcessParam(e,t,"RotateClockwise")}return 0}(e,t),n={type:"Process",op:"Divide",left:h(e,t),right:{type:"Process",op:"Cond",condition:r,ifTrue:-1,ifFalse:1}},o=i?.find(e=>"CIMSymbolAnimationRotation"===e.type);if(!o)return p(n);const a={type:"Process",op:"Add",left:s.getProcessParam(e,o,"ToRotation"),right:{type:"Process",op:"Divide",left:n,right:-1}};return{from:n,to:{type:"Process",op:"Add",left:n,right:{type:"Process",op:"Cond",condition:s.getProcessParam(e,o,"RotateClockwise"),ifTrue:{type:"Process",op:"MatchWinding",sign:-1,angle:a},ifFalse:{type:"Process",op:"MatchWinding",sign:1,angle:a}}},timing:f(e,o.animatedSymbolProperties)}}(e,t),o=function(e,t){const{animations:i}=t;let r;r="CIMPictureMarker"===t.type||"CIMVectorMarker"===t.type?s.getProcessParam(e,t,"Size"):"CIMSolidStroke"===t.type||"CIMPictureStroke"===t.type?s.getProcessParam(e,t,"Width"):s.getSize(t)||10;const n=i?.find(e=>"CIMSymbolAnimationScale"===e.type);if(!n){const t=i?.find(e=>"CIMSymbolAnimationSize"===e.type);return t?{from:1,to:{type:"Process",op:"Divide",left:s.getProcessParam(e,t,"ToSize"),right:r},timing:f(e,t.animatedSymbolProperties)}:p(1)}return{from:1,to:s.getProcessParam(e,n,"ScaleFactor"),timing:f(e,n.animatedSymbolProperties)}}(e,t);return{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:r,rotation:n,scale:o,parent:i}}(e,t,i.transform),n=function(e,t,i){return{type:"AnimatedColor",color:p(d(e,t)),opacity:p(1),parent:i}}(e,t,i.fromColor),l=function(e,t,i){const{animations:r}=t;let n=d(e,t);const o=r?.find(e=>"CIMSymbolAnimationColor"===e.type);return o&&(n=s.getProcessParam(e,o,"ToColor")),{type:"AnimatedColor",color:p(n),opacity:p(1),parent:i}}(e,t,i.toColor),u=function(e,t,i){const{animations:r}=t,n=r?.find(e=>"CIMSymbolAnimationColor"===e.type);return n?{type:"AnimatedColor",color:p([1,1,1,1]),opacity:{from:0,to:1,timing:f(e,n?.animatedSymbolProperties)},parent:[1,1,1,1]}:i}(e,t,i.colorMix),m=function(e,t,i){const{animations:r}=t;let n=p(1);const o=r?.find(e=>"CIMSymbolAnimationTransparency"===e.type);return o&&(n=p({type:"Process",op:"Transparency",value:s.getProcessParam(e,o,"ToTransparency")})),{type:"AnimatedColor",color:p([1,1,1,1]),opacity:n,parent:i}}(e,t,i.toOpacity),g=function(e,t,i){const{animations:r}=t,n=r?.find(e=>"CIMSymbolAnimationTransparency"===e.type);return n?{type:"AnimatedColor",color:p([1,1,1,1]),opacity:{from:0,to:1,timing:f(e,n?.animatedSymbolProperties)},parent:[1,1,1,1]}:i}(e,t,i.opacityMix),_=function(e,t,i){const{animations:r}=t,n=r?.find(e=>"CIMSymbolAnimationMoveAlongLine"===e.type);if(!n)return i;let o,a;const l=f(e,n.animatedSymbolProperties),c=s.hasProcessParam(e,n,"DistanceAlong"),u=s.hasProcessParam(e,n,"Speed"),h=c&&s.getProcessParam(e,n,"DistanceAlong"),d=u&&s.getProcessParam(e,n,"Speed"),p=!0===n.continuous;if(!1!==h)o={type:"Process",op:"Divide",left:h,right:100},a=!0;else if(!1!==d)o={type:"Process",op:"Multiply",left:d,right:l.duration},a=!1;else{if(!p)throw new Error("Either distanceAlong, speed or continuous must be specified.");o=1,a=!0}return{type:"AnimatedShift",multiplyByLineLength:a,shift:{from:0,to:o,timing:l},parent:i}}(e,t,i.shift);return{transform:r,fromColor:n,toColor:l,colorMix:u,toOpacity:m,opacityMix:g,shift:_,hasAnimations:i.hasAnimations||o(t),hasShiftAnimation:i.hasShiftAnimation||a(t),hasMotionAnimations:i.hasMotionAnimations||c(t)}},e.getFrameTranslation=function(e,t){const i=t?.5*-(t.xmin+t.xmax):0,r=t?.5*-(t.ymin+t.ymax):0;let s=0,o=0;if("x"in e&&"y"in e)s=e.x+i,o=e.y+r;else{const t=n.getExtent(e);t&&(s=(t[0]+t[2])/2+i,o=(t[1]+t[3])/2+r)}return[s,o]},e.getStaticParam=p,e.handleAbsoluteAnchor=function(e,t){return"Absolute"!==e.anchorPointUnits?t:u(e,t)},e.handleAnchor=u,e.handleMarker=function(e,i,r){if("CIMCharacterMarker"===i.type)return t.getLogger("animationUtils").error("#handleMarker()","CIM character markers do not support animations"),r;const n=s.getProcessParam(e,i,"OffsetX"),o=s.getProcessParam(e,i,"OffsetY");if("CIMPictureMarker"===i.type)return{...r,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!0,translation:p([n,o]),rotation:p(0),scale:p(s.getProcessParam(e,i,"Size")),parent:r.transform}};const a=i.frame,l=a.ymax-a.ymin;return{...r,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:p([n,o]),rotation:p(0),scale:p({type:"Process",op:"Divide",left:s.getProcessParam(e,i,"Size"),right:l}),parent:r.transform}}},e.handleRelativeAnchor=function(e,t){return"Absolute"===e.anchorPointUnits?t:u(e,t)},e.shouldUseAnimatedPath=function(e){return!i.animationDebugFlags.forceStaticPath&&(i.animationDebugFlags.forceAnimatedPath||e.hasAnimations)},e.translate=function(e,t,i){return{...e,transform:{type:"AnimatedTransform",relativeTranslation:!1,absoluteScale:!1,translation:p([t,i]),rotation:p(0),scale:p(1),parent:e.transform}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/animationDebugFlags":function(){define(["exports","../../core/has"],function(e,t){"use strict";const i=new class{get forceStaticPath(){return"disabled"===t("esri-cim-animations-enable-status")}get forceAnimatedPath(){return"forced"===t("esri-cim-animations-enable-status")}get freezeGlobalTime(){return t("esri-cim-animations-freeze-time")??!1}get spotlightAnimatedSymbols(){return!!t("esri-cim-animations-spotlight")}get forceGlobalTimeOrigin(){return!1!==t("esri-cim-animations-freeze-time")}};e.animationDebugFlags=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/SDFHelper":function(){define(["exports","../../core/floatRGBA","../../geometry/support/jsonUtils","./Rect","../../views/2d/engine/webgl/definitions"],function(e,t,i,r,n){"use strict";function s(e){let t=1/0,i=-1/0,r=1/0,n=-1/0;for(const s of e)for(const e of s)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<r&&(r=e[1]),e[1]>n&&(n=e[1]);return[t,r,i,n]}function o(e){return e?e.rings?s(e.rings):e.paths?s(e.paths):i.isExtent(e)?[e.xmin,e.ymin,e.xmax,e.ymax]:null:null}function a(e,i){const r=2*i,n=e.length,s=new Uint8Array(4*n);for(let i=0;i<n;++i){const n=.5-e[i]/r;t.packFloatRGBA(n,s,4*i)}return s}e.buildSDF=function(e){const t=(i=e.geom)?i.rings?i.rings:i.paths?i.paths:void 0!==i.xmin&&void 0!==i.ymin&&void 0!==i.xmax&&void 0!==i.ymax?[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]:null:null;var i;const s=function(e){let t=1/0,i=-1/0,n=1/0,s=-1/0;for(const r of e)for(const e of r)e[0]<t&&(t=e[0]),e[0]>i&&(i=e[0]),e[1]<n&&(n=e[1]),e[1]>s&&(s=e[1]);return new r(t,n,i-t,s-n)}(t),o=n.defaultSdfTextureSize,l=n.spritePadding,c=Math.floor(.5*(o*e.sdfPaddingRatio-l)),u=o-2*(c+l),h=u/Math.max(s.width,s.height),d=Math.round(s.width*h)+2*c,f=Math.round(s.height*h)+2*c,p=[];for(const i of t)if(i&&i.length>1){const t=[];for(const r of i){let[i,n]=r;i-=s.x,n-=s.y,i*=h,n*=h,i+=c-.5,n+=c-.5,e.asFill?t.push([i,n]):t.push([Math.round(i),Math.round(n)])}if(e.asFill){const e=t.length-1;t[0][0]===t[e][0]&&t[0][1]===t[e][1]||t.push(t[0])}p.push(t)}const m=function(e,t,i,r){const n=t*i,s=new Array(n),o=r*r+1;for(let e=0;e<n;++e)s[e]=o;for(const n of e){const e=n.length;for(let o=1;o<e;++o){const e=n[o-1],a=n[o];let l,c,u,h;e[0]<a[0]?(l=e[0],c=a[0]):(l=a[0],c=e[0]),e[1]<a[1]?(u=e[1],h=a[1]):(u=a[1],h=e[1]);let d=Math.floor(l)-r,f=Math.floor(c)+r,p=Math.floor(u)-r,m=Math.floor(h)+r;d<0&&(d=0),f>t&&(f=t),p<0&&(p=0),m>i&&(m=i);const g=a[0]-e[0],_=a[1]-e[1],y=g*g+_*_;for(let r=d;r<f;r++)for(let n=p;n<m;n++){const o=r+.5,l=n+.5;let c,u,h=(o-e[0])*g+(l-e[1])*_;h<0?(c=e[0],u=e[1]):h>y?(c=a[0],u=a[1]):(h/=y,c=e[0]+h*g,u=e[1]+h*_);const d=(o-c)*(o-c)+(l-u)*(l-u),f=(i-n-1)*t+r;d<s[f]&&(s[f]=d)}}}for(let e=0;e<n;++e)s[e]=Math.sqrt(s[e]);return s}(p,d,f,c);return e.asFill&&function(e,t,i,r,n){for(const s of e){const e=s.length;for(let o=1;o<e;++o){const e=s[o-1],a=s[o];let l,c,u,h;e[0]<a[0]?(l=e[0],c=a[0]):(l=a[0],c=e[0]),e[1]<a[1]?(u=e[1],h=a[1]):(u=a[1],h=e[1]);let d=Math.floor(l),f=Math.floor(c)+1,p=Math.floor(u),m=Math.floor(h)+1;d<r&&(d=r),f>t-r&&(f=t-r),p<r&&(p=r),m>i-r&&(m=i-r);for(let s=p;s<m;++s){if(e[1]>s==a[1]>s)continue;const o=s+.5,l=(i-s-1)*t;for(let t=d;t<f;++t)t+.5<(a[0]-e[0])*(o-e[1])/(a[1]-e[1])+e[0]&&(n[l+t]=-n[l+t]);for(let e=r;e<d;++e)n[l+e]=-n[l+e]}}}}(p,d,f,c,m),{data:a(m,c),width:d,height:f,sdfPaddingRatio:e.sdfPaddingRatio,sdfDecodeCoeff:2*c/u}},e.getExtent=o,e.getSDFDimensions=function(e,t){const[i,r,s,a]=o(e),l=s-i,c=a-r,u=n.defaultSdfTextureSize,h=n.spritePadding,d=Math.floor(.5*(u*t-h)),f=(u-2*(d+h))/Math.max(l,c),p=Math.round(l*f),m=Math.round(c*f);return{pixelDimensions:[l,c],texelDimensions:[Math.round((p+2*d)/f),Math.round((m+2*d)/f)]}},e.getSDFInfo=function e(t,i=.5){switch(t.type){case"CIMPointSymbol":{const i=t.symbolLayers;if(!i||1!==i.length)return null;const r=i[0];return"CIMVectorMarker"!==r.type?null:e(r)}case"CIMVectorMarker":{const e=t.markerGraphics;if(!e||1!==e.length)return null;const r=e[0];if(!r)return null;const n=r.geometry;if(!n)return null;const s=r.symbol;return!s||"CIMPolygonSymbol"!==s.type&&"CIMLineSymbol"!==s.type||s.symbolLayers?.some(e=>!!e.effects)?null:{type:"sdf",geom:n,sdfPaddingRatio:i,asFill:"CIMPolygonSymbol"===s.type}}}},e.getSDFMetrics=function(e,t,i,r,s,o,a){const[l,c,u,h]=e;if(u<l||h<c)return{frameSizeRatio:0,anchorX:0,anchorY:0,widthRatio:1,sdfPaddingRatio:.5};const d=u-l,f=h-c,p=Math.max(d,f);let m=.5;if(null!=o&&null!=i){a||null==t||(o*=(t.ymax-t.ymin)/i);const e=o/(o+p),r=.1;e>.45&&e<1&&(m=Math.min(e+r,.99))}const g=n.defaultSdfTextureSize,_=n.spritePadding,y=Math.floor(.5*(g*m-_)),x=(g-2*(y+_))/p,b=Math.round(d*x)+2*y,v=Math.round(f*x)+2*y;let S=1;t&&(S=v*(1-m)/((t.ymax-t.ymin)*x));let w=0,T=0,M=1;r&&(s?t&&i&&t.ymax-t.ymin>0&&(M=(t.xmax-t.xmin)/(t.ymax-t.ymin),w=r.x/(i*M),T=r.y/i):(w=r.x,T=r.y)),t&&(w=.5*(t.xmax+t.xmin)+w*(t.xmax-t.xmin),T=.5*(t.ymax+t.ymin)+T*(t.ymax-t.ymin)),w-=l,T-=c,w*=x,T*=x,w+=y,T+=y;let P=w/b-.5,I=T/v-.5;return s&&i&&(P*=i*M,I*=i),{frameSizeRatio:S,anchorX:P,anchorY:I,widthRatio:M,sdfPaddingRatio:m}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(e,t){"use strict";function i(e,t=0){let i=0;for(let r=0;r<4;r++)i+=e[t+r]*n[r];return i}const r=[1,256,65536,16777216],n=[1/256,1/65536,1/16777216,1/4294967296],s=i(new Uint8ClampedArray([255,255,255,255])),o=i(new Uint8ClampedArray([255,255,255,0]));function a(e){return e-Math.floor(e)}e.maxRgbFloat=o,e.maxRgbaFloat=s,e.packFloatRGB=function(e,i,n=0){const s=t.clamp(e,0,o);for(let e=0;e<3;e++)i[n+e]=Math.floor(256*a(s*r[e]))},e.packFloatRGBA=function(e,i,n=0){const o=t.clamp(e,0,s);for(let e=0;e<4;e++)i[n+e]=Math.floor(256*a(o*r[e]))},e.unpackFloatRGBA=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){"use strict";class e{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.width=i,this.height=r}static fromExtent(t){return new e(t.xmin,-t.ymax,t.xmax-t.xmin,t.ymax-t.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}return e})},"esri/symbols/cim/CIMSymbolHelper":function(){define(["exports","../../core/BidiText","../../core/has","../../core/lang","../../core/Logger","../../core/RandomLCG","../../core/screenUtils","../../geometry/support/aaBoundingRect","../../geometry/support/boundsUtils","../Font","./CIMEffects","./CIMPlacements","./CIMSymbolDrawHelper","./defaultCIMValues","./utils","../support/defaults","../../views/2d/engine/vectorTiles/GeometryUtils","../../views/2d/engine/webgl/definitions","../../views/2d/engine/webgl/mesh/templates/shapingUtils","../../views/2d/layers/graphics/graphicsUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_,y,x){"use strict";const b=Math.PI,v=b/2,S=Math.PI/180,w=96/72,T=()=>n.getLogger("esri.symbols.cim.CIMSymbolHelper");function M(e,t,i){switch(t.type){case"CIMSymbolReference":return M(e,t.symbol,i);case"CIMPointSymbol":null==i&&(i={x:0,y:0}),e.drawSymbol(t,i);break;case"CIMLineSymbol":null==i&&(i={paths:[[[0,0],[10,0]]]}),e.drawSymbol(t,i);break;case"CIMPolygonSymbol":null==i&&(i={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),e.drawSymbol(t,i);break;case"CIMTextSymbol":{const i={x:0,y:0};e.drawSymbol(t,i);break}case"CIMVectorMarker":{const i=new h.Placement;e.drawMarker(t,i);break}}return e.envelope()}function P(e){if(!e)return 0;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(e.offset);default:return 0}}function I(e){if(!e)return 0;switch(e.type){case"CIMGeometricEffectArrow":return Math.abs(.5*e.width);case"CIMGeometricEffectBuffer":return Math.abs(e.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(e.length);case"CIMGeometricEffectJog":return Math.abs(.5*e.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(p.getNumericValue(e.offsetX)),Math.abs(p.getNumericValue(e.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(e.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(e.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(e.fromWidth),Math.abs(e.toWidth));case"CIMGeometricEffectWave":return Math.abs(e.amplitude);case"CIMGeometricEffectDonut":return Math.abs(e.width)}}function C(e){if(!e)return 0;let t=0;for(const i of e)t+=I(i);return t}class F{static getEnvelope(e,t,i){if(!e)return null;const r=new d.EnvDrawHelper(i);if(Array.isArray(e)){let i;for(const n of e)i?i.union(M(r,n,t)):i=M(r,n,t);return i}return M(r,e,t)}static getTextureInfo(e,t,i,r,n){const s=r??this.getEnvelope(e,null,t);if(!s)return[0,0,0,0,1];const o=Math.max(s.width,s.height)*w;let a=null!=n?Math.max(n/o,1):1;a*=w,s.x*=a,s.y*=a,s.width*=a,s.height*=a,s.width=Math.max(Math.ceil(s.x+s.width)-Math.floor(s.x),1)-1,s.height=Math.max(Math.ceil(s.y+s.height)-Math.floor(s.y),1)-1;let l=s.x+.5*s.width,c=s.y+.5*s.height;return l+=s.x-Math.floor(s.x),c+=s.y-Math.floor(s.y),r||(s.width+=i,s.height+=i,l+=i/2,c+=i/2),[s.width,s.height,l,c,a]}static getTextureAnchor(e,t,i){const[r,n,s,o,a]=this.getTextureInfo(e,t,2,null,i);return[-s/r,-o/n,n/a*w]}static rasterize(e,t,i,r,n=!0,s){const[o,a,l,c,u]=this.getTextureInfo(t,r,2,i,s);e.width=o,e.height=a;const f=e.getContext("2d",{willReadFrequently:!0}),p=d.Transformation.createScale(u,-u);p.translate(.5*o-l,.5*a+c);const m=new d.CanvasDrawHelper(f,r,p);switch(t.type){case"CIMPointSymbol":{const e={type:"point",x:0,y:0};m.drawSymbol(t,e);break}case"CIMVectorMarker":{const e=new h.Placement;m.drawMarker(t,e);break}}const g=f.getImageData(0,0,e.width,e.height),_=new Uint8Array(g.data);if(n){let e;for(let t=0;t<_.length;t+=4)e=_[t+3]/255,_[t]=_[t]*e,_[t+1]=_[t+1]*e,_[t+2]=_[t+2]*e}return[_,e.width,e.height,-l/o,-c/a]}static fromTextSymbol(e){const{text:t}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:F.createCIMTextSymbolfromTextSymbol(e),textString:t}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:t,outline:i,width:r,xoffset:n,xscale:s,yoffset:o,yscale:a}=e,l=[],c={type:"CIMPolygonSymbol",symbolLayers:l};if(i){const e=U(i);e&&l.push(e)}let u=e.url;"esriPFS"===e.type&&e.imageData&&(u=e.imageData);const h="angle"in e?e.angle??0:0,d=(r??0)*(s||1),f=(t??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture",tintColor:null,url:u,height:f,width:d,offsetX:p.getNumericValue(n),offsetY:p.getNumericValue(o),rotation:p.getNumericValue(-h),colorSubstitutions:null}),c}static fromSimpleFillSymbol(e){const{color:t,style:i,outline:n}=e,s=[],a={type:"CIMPolygonSymbol",symbolLayers:s};if(n){const e=U(n);e&&s.push(e)}if(i&&"solid"!==i&&"none"!==i&&"esriSFSSolid"!==i&&"esriSFSNull"!==i){const e={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:V(t),capStyle:"Butt",joinStyle:"Miter",width:.75}]};let n=0;const a=o.px2pt(G(i)?8:10);switch(i){case"vertical":case"esriSFSVertical":n=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":n=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":n=45;break;case"cross":case"esriSFSCross":n=0}s.push({type:"CIMHatchFill",lineSymbol:e,offsetX:0,offsetY:0,rotation:n,separation:a}),"cross"===i||"esriSFSCross"===i?s.push({type:"CIMHatchFill",lineSymbol:r.clone(e),offsetX:0,offsetY:0,rotation:90,separation:a}):"diagonal-cross"!==i&&"esriSFSDiagonalCross"!==i||s.push({type:"CIMHatchFill",lineSymbol:r.clone(e),offsetX:0,offsetY:0,rotation:45,separation:a})}else!i||"solid"!==i&&"esriSFSSolid"!==i||s.push({type:"CIMSolidFill",enable:!0,color:V(t)});return a}static fromSimpleLineSymbol(e){const{cap:t,color:i,join:r,marker:n,miterLimit:s,style:o,width:a}=e;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:B(o,t),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const c=[];if(n){let e;switch(n.placement){case"begin-end":e="Both";break;case"begin":e="JustBegin";break;case"end":e="JustEnd";break;default:e="None"}const t=F.fromSimpleMarker(n,a,i).symbolLayers[0];t.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:e,offsetAlongLine:0},c.push(t)}return c.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?V(i):[0,0,0,0],capStyle:A(t),joinStyle:E(r),miterLimit:s,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:c}}static fromPictureMarker(e){const{angle:t,height:i,width:r,xoffset:n,yoffset:s}=e;let o=e.url;return"esriPMS"===e.type&&e.imageData&&(o=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture",tintColor:null,url:o,size:i,width:r,offsetX:p.getNumericValue(n),offsetY:p.getNumericValue(s),rotation:p.getNumericValue(-t)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:i,color:r,font:n,haloColor:s,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:h,xoffset:d,yoffset:f,backgroundColor:m,borderLineColor:g,borderLineSize:_}=e;let y,x,b,v,S,w;n&&(y=n.family,x=n.style,b=n.weight,v=n.size,S=n.decoration);let T=!1;return u&&(T=t.bidiText(u)[1]),(m||_)&&(w={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:V(m)},{type:"CIMSolidStroke",color:V(g),width:_}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:i,blockProgression:2,depth3D:1,extrapolateBaselines:!0,fontEffects:0,fontEncoding:1,fontFamilyName:y||"Arial",fontStyleName:D(x,b),fontType:0,haloSize:o,height:v,hinting:1,horizontalAlignment:z(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:p.getNumericValue(d),offsetY:p.getNumericValue(f),strikethrough:"line-through"===S,underline:"underline"===S,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:V(r)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:V(s)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:T?1:0,verticalAlignment:R(h??"baseline"),verticalGlyphOrientation:0,wordSpacing:100,billboardMode3D:2,callout:w}}static createPictureMarkerRasterizationParam(e){const{angle:t,height:i,width:r,xoffset:n,yoffset:s}=e,o=e.url??e.source?.url??e.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture",tintColor:null,url:o,size:i,width:r,offsetX:p.getNumericValue(n),offsetY:p.getNumericValue(s),rotation:p.getNumericValue(-t)}}:null}static createPictureFillRasterizationParam(e){const{width:t,height:i,xoffset:r,yoffset:n,url:s}=e;return s?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:"Picture",tintColor:null,url:s,width:t,height:i,offsetX:p.getNumericValue(r),offsetY:p.getNumericValue(n),rotation:0}}:null}static fromSimpleMarker(e,t,i){const{style:r}=e,n=e.color??i;if("path"===r||"esriSMSPath"===r){const t=[];if("outline"in e&&e.outline){const i=e.outline;t.push({type:"CIMSolidStroke",enable:!0,width:i.width,color:V(i.color),path:e.path})}t.push({type:"CIMSolidFill",enable:!0,color:V(n),path:e.path});const[i,r]=N("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-p.getNumericValue(e.angle),size:p.getNumericValue(e.size||6),offsetX:p.getNumericValue(e.xoffset),offsetY:p.getNumericValue(e.yoffset),scaleSymbolsProportionally:!1,frame:i,markerGraphics:[{type:"CIMMarkerGraphic",geometry:r,symbol:{type:"CIMPolygonSymbol",symbolLayers:t}}]}]}}const s=[];let o,a,l=e.size;if("outline"in e&&e.outline&&"none"!==e.outline.style&&"esriSLSNull"!==e.outline.style){const t=e.outline,i="solid"!==t.style&&"esriSLSSolid"!==t.style;[o,a]=i?N(r,e.size):N(r);const n=t.width??m.defaultPolylineSymbol2D.width;if(i){const t=n/e.size,i=(o.xmax-o.xmin)*t/2,r=(o.ymax-o.ymin)*t/2;o.xmin-=i,o.xmax+=i,o.ymin-=r,o.ymax+=r,l&&(l+=n)}const c="cross"!==e.style&&"x"!==e.style||"dot"===e?.outline.style||"short-dot"===e?.outline.style?"HalfGap":"FullPattern",u=i?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:B(t.style,null).map(e=>t.width&&t.width>0?e*t.width:e),lineDashEnding:c,controlPointEnding:"FullPattern"}]:void 0;s.push({type:"CIMSolidStroke",capStyle:i?"Round":"Butt",enable:!0,width:n,color:V(t.color),effects:u})}else!t||"line-marker"!==e.type||"cross"!==e.style&&"x"!==e.style?[o,a]=N(r):([o,a]=N(r),s.push({type:"CIMSolidStroke",enable:!0,width:t,color:V(n)}));s.push({type:"CIMSolidFill",enable:!0,color:V(n)});const c={type:"CIMPolygonSymbol",symbolLayers:s};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:p.getNumericValue(-e.angle),size:p.getNumericValue(l||6*t),offsetX:p.getNumericValue(e.xoffset),offsetY:p.getNumericValue(e.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:c}]}]}}static fromCIMHatchFill(e,t){const i=t*(e.separation??f.defaultCIMValues.CIMHatchFill.separation),n=i/2,s=r.clone(e.lineSymbol);s.symbolLayers?.forEach(e=>{switch(e.type){case"CIMSolidStroke":null!=e.width&&(e.width*=t),e.effects?.forEach(e=>{if("CIMGeometricEffectDashes"===e.type){const i=e.dashTemplate;e.dashTemplate=i?.map(e=>e*t)}});break;case"CIMVectorMarker":{null!=e.size&&(e.size*=t);const i=e.markerPlacement;null!=i&&"placementTemplate"in i&&(i.placementTemplate=i.placementTemplate.map(e=>e*t));break}}});let o=this._getLineSymbolPeriod(s)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-n,ymax:n},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:s}],size:i}}static fetchResources(e,t,i,r=null){if(!e||!t)return i;switch(e.type){case"CIMMeshSymbol":case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":for(const t of e.effects||[])i.push(u.loadGeometryOperatorsForEffect(t))}return O(e,e=>{for(const t of e.effects||[])i.push(u.loadGeometryOperatorsForEffect(t));"url"in e&&e.url&&i.push(t.fetchResource(e.url,{signal:r}))}),i}static fetchFonts(e,t,i){if(e&&t)if("symbolLayers"in e&&e.symbolLayers){for(const r of e.symbolLayers)if("CIMVectorMarker"===r.type&&r.markerGraphics)for(const e of r.markerGraphics)e?.symbol&&F.fetchFonts(e.symbol,t,i)}else if("CIMTextSymbol"===e.type){const{fontFamilyName:r,fontStyleName:n}=e;if(!r||"calcitewebcoreicons"===r.toLowerCase())return;const{style:s,weight:o}=p.fromCIMFontStyle(n),a=p.fromCIMFontDecoration(e),l=new c({family:r,style:s,weight:o,decoration:a});i.push(t.loadFont(l).catch(()=>{T().error(`Unsupported font ${r} in CIM symbol`)}))}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const t of e.symbolLayers)if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=this._getPlacementRepeat(t.markerPlacement);if(e)return e}}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const i of e)t+=i;return 1&e.length&&(t*=2),t}break}case"CIMGeometricEffectWave":return t.period;default:T().error(`unsupported geometric effect type ${t.type}`)}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const i of t)e+=+i;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,i={...e};i.markerPlacement=null,i.anchorPoint=null;const r=Math.abs(t.stepX),n=Math.abs(t.stepY),a=(t.randomness??100)/100;let l,c,u,h;if("Random"===t.gridType){const e=o.px2pt(_.randomInsidePolygonTextureSize),i=Math.max(Math.floor(e/r),1),d=Math.max(Math.floor(e/n),1);l=i*r/2,c=d*n/2,u=2*c;const f=new s(t.seed),p=a*r/1.5,m=a*n/1.5;h=[];for(let e=0;e<i;e++)for(let t=0;t<d;t++){const i=e*r-l+p*(.5-f.getFloat()),s=t*n-c+m*(.5-f.getFloat());h.push({x:i,y:s}),0===e&&h.push({x:i+2*l,y:s}),0===t&&h.push({x:i,y:s+2*c})}}else!0===t.shiftOddRows?(l=r/2,c=n,u=2*n,h=[{x:-l,y:0},{x:l,y:0},{x:0,y:c},{x:0,y:-c}]):(l=r/2,c=n/2,u=n,h=[{x:-r,y:0},{x:0,y:-n},{x:-r,y:-n},{x:0,y:0},{x:r,y:0},{x:0,y:n},{x:r,y:n},{x:-r,y:n},{x:r,y:-n}]);return{type:"CIMVectorMarker",frame:{xmin:-l,xmax:l,ymin:-c,ymax:c},markerGraphics:h.map(e=>({type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[i]}})),size:u}}}function O(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const i=e.symbolLayers;if(!i)return;for(const e of i)if(t(e),"CIMVectorMarker"===e.type){const i=e.markerGraphics;if(!i)continue;for(const e of i)if(e){const i=e.symbol;i&&O(i,t)}}break}}}const A=e=>{if(!e)return"Butt";switch(e){case"butt":return"Butt";case"square":return"Square";case"round":return"Round"}},E=e=>{if(!e)return"Miter";switch(e){case"miter":return"Miter";case"round":return"Round";case"bevel":return"Bevel"}},z=e=>{if(null==e)return"Center";switch(e){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},R=e=>{if(null==e)return"Center";switch(e){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},V=e=>{if(!e)return[0,0,0,0];const{r:t,g:i,b:r,a:n}=e;return[t,i,r,255*n]},D=(e,t)=>{const i=k(t),r=L(e);return i&&r?`${i}-${r}`:`${i}${r}`},k=e=>{if(!e)return"";switch(e.toLowerCase()){case"bold":case"bolder":return"bold"}return""},L=e=>{if(!e)return"";switch(e.toLowerCase()){case"italic":case"oblique":return"italic"}return""},B=(e,t)=>{const r=i("safari")?.001:0,n="butt"===t;switch(e){case"dash":case"esriSLSDash":return n?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return n?[4,3,1,3]:[3,4,r,4];case"dot":case"esriSLSDot":return n?[1,3]:[r,4];case"long-dash":case"esriSLSLongDash":return n?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return n?[8,3,1,3]:[7,4,r,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return n?[8,3,1,3,1,3]:[7,4,r,4,r,4];case"short-dash":case"esriSLSShortDash":return n?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return n?[4,1,1,1]:[3,2,r,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return n?[4,1,1,1,1,1]:[3,2,r,2,r,2];case"short-dot":case"esriSLSShortDot":return n?[1,1]:[r,2];case"solid":case"esriSLSSolid":case"none":return T().error("Unexpected: style does not require rasterization"),[0,0];default:return T().error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),[0,0]}},N=(e,t=100)=>{const i=t/2;let r,n;const s=e;if("circle"===s||"esriSMSCircle"===s){const e=.25;let t=Math.acos(1-e/i),s=Math.ceil(b/t/4);0===s&&(s=1),t=v/s,s*=4;const o=[];o.push([i,0]);for(let e=1;e<s;e++)o.push([i*Math.cos(e*t),-i*Math.sin(e*t)]);o.push([i,0]),r={rings:[o]},n={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("cross"===s||"esriSMSCross"===s){const e=0;r={paths:[[[e,i],[e,-i]],[[i,e],[-i,e]]]},n={xmin:-i,ymin:-i,xmax:i,ymax:i}}else if("diamond"===s||"esriSMSDiamond"===s)r={rings:[[[-i,0],[0,i],[i,0],[0,-i],[-i,0]]]},n={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("square"===s||"esriSMSSquare"===s)r={rings:[[[-i,-i],[-i,i],[i,i],[i,-i],[-i,-i]]]},n={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("x"===s||"esriSMSX"===s)r={paths:[[[i,i],[-i,-i]],[[i,-i],[-i,i]]]},n={xmin:-i,ymin:-i,xmax:i,ymax:i};else if("triangle"===s||"esriSMSTriangle"===s){const e=.5773502691896257*t,i=-e,s=2/3*t,o=s-t;r={rings:[[[i,o],[0,s],[e,o],[i,o]]]},n={xmin:i,ymin:o,xmax:e,ymax:s}}else"arrow"===s&&(r={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},n={xmin:-i,ymin:-i,xmax:i,ymax:i});return[n,r]},G=e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e;function U(e){if(!e)return null;let t=null;const{cap:i,color:r,join:n,miterLimit:s,style:o,width:a}=e;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(t=[{type:"CIMGeometricEffectDashes",dashTemplate:B(o,i),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?V(r):[0,0,0,0],capStyle:A(i),joinStyle:E(n),miterLimit:s,width:a,effects:t}}e.CIMSymbolHelper=F,e.CIMSymbolInflatedSizeHelper=class{static getSymbolInflateSize(e,t,i,r,n){return e||(e=[0,0,0,0]),t?this._getInflateSize(e,t,i,r,n):e}static safeSize(e){const t=Math.max(Math.abs(e[0]),Math.abs(e[2])),i=Math.max(Math.abs(e[1]),Math.abs(e[3]));return Math.sqrt(t*t+i*i)}static _vectorMarkerBounds(e,t,i,r){let n=!0;const s=a.create();if(t?.markerGraphics)for(const o of t.markerGraphics){const t=[0,0,0,0];o.geometry&&(l.getBoundsXY(s,o.geometry),t[0]=0,t[1]=0,t[2]=0,t[3]=0,this.getSymbolInflateSize(t,o.symbol,i,0,r),s[0]+=t[0],s[1]+=t[1],s[2]+=t[2],s[3]+=t[3],n?(e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],n=!1):(e[0]=Math.min(e[0],s[0]),e[1]=Math.min(e[1],s[1]),e[2]=Math.max(e[2],s[2]),e[3]=Math.max(e[3],s[3])))}return e}static _getInflateSize(e,t,i,r,n){if(void 0!==t.symbolLayers){const s=this._getLayersInflateSize(e,t.symbolLayers,i,r,n),o=C(t.effects);return o>0&&(s[0]-=o,s[1]-=o,s[2]+=o,s[3]+=o),s}return this._getTextInflatedSize(e,t,n)}static _getLayersInflateSize(e,t,i,r,n){let s=!0;if(!t)return e;for(const o of t){if(!o)continue;let t=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=o;let i=e.width;null!=i&&("Square"===e.capStyle||"Miter"===e.joinStyle?i/=1.4142135623730951:i/=2,t[0]=-i,t[1]=-i,t[2]=i,t[3]=i);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const e=o;if("CIMVectorMarker"===o.type){const e=o;if(t=this._vectorMarkerBounds(t,e,i,n),e.frame){const i=(e.frame.xmin+e.frame.xmax)/2,r=(e.frame.ymin+e.frame.ymax)/2;if(t[0]-=i,t[1]-=r,t[2]-=i,t[3]-=r,null!=e.size){const i=e.size/(e.frame.ymax-e.frame.ymin);t[0]*=i,t[1]*=i,t[2]*=i,t[3]*=i}}}else if("CIMPictureMarker"===o.type){const r=o,n=i.getResource(r.url);let s=1;if(null!=n&&n.height&&(s=n.width/n.height),null!=e.size){const i=e.size/2,n=e.size*s*r.scaleX/2;t=[-n,-i,n,i]}}else if(null!=e.size){const i=e.size/2;t=[-i,-i,i,i]}if(e.anchorPoint){let i,r;"Absolute"===e.anchorPointUnits?(i=e.anchorPoint.x,r=e.anchorPoint.y):(i=e.anchorPoint.x*(t[2]-t[0]),r=e.anchorPoint.y*(t[3]-t[1]));const n=1.25*Math.sqrt(i*i+r*r);t[0]-=n,t[1]-=n,t[2]+=n,t[3]+=n}let s=p.getNumericValue(e.rotation);if(e.rotateClockwise&&(s=-s),r&&(s-=r),s){const e=S*s,i=Math.cos(e),r=Math.sin(e),n=a.create([g.cInfinity,g.cInfinity,-g.cInfinity,-g.cInfinity]);a.expandPointInPlace(n,[t[0]*i-t[1]*r,t[0]*r+t[1]*i]),a.expandPointInPlace(n,[t[0]*i-t[3]*r,t[0]*r+t[3]*i]),a.expandPointInPlace(n,[t[2]*i-t[1]*r,t[2]*r+t[1]*i]),a.expandPointInPlace(n,[t[2]*i-t[3]*r,t[2]*r+t[3]*i]),t=n}let l=p.getNumericValue(e.offsetX),c=p.getNumericValue(e.offsetY);if(r){const e=S*r,t=Math.cos(e),i=Math.sin(e),n=l*i+c*t;l=l*t-c*i,c=n}t[0]+=l,t[1]+=c,t[2]+=l,t[3]+=c;const u=P(e.markerPlacement);u>0&&(t[0]-=u,t[1]-=u,t[2]+=u,t[3]+=u);break}}const l=C(o.effects);l>0&&(t[0]-=l,t[1]-=l,t[2]+=l,t[3]+=l),s?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],s=!1):(e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[2]),e[3]=Math.max(e[3],t[3]))}return e}static _getTextInflatedSize(e,t,i){const r=x.roundPtToWholePixel(t.height??f.defaultCIMValues.CIMTextSymbol.height);if(e[0]=-r/2,e[1]=-r/2,e[2]=r/2,e[3]=r/2,!i)return e;const n=i.get(t);if(!n)return e;if(!n.glyphMosaicItems.glyphs.length)return e;const{lineGapType:s,lineGap:o}=t,a=s?d.lineGapType2LineHeight(s,o??0,r):0,l="CIMBackgroundCallout"===t.callout?.type,c=y.shapeGlyphs(n.glyphMosaicItems,{scale:r/_.glyphSize,angle:p.getNumericValue(t.angle),xOffset:p.getNumericValue(t.offsetX),yOffset:p.getNumericValue(t.offsetY),horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:x.getLineWidth(t.lineWidth),lineHeight:_.magicLabelLineHeight*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,u=Math.sqrt(c.width*c.width+c.height*c.height);return e[0]-=c.x+u,e[1]-=c.y-u,e[2]+=c.x+u,e[3]+=-c.y+u,e}},e.capTypeToEnum=A,e.getEffectsInflateSize=C,e.slsDashToTemplateArray=B,e.symbolToCIM=function(e){let t;switch(e.type){case"cim":return e.data;case"web-style":return e;case"simple-marker":{const i=F.fromSimpleMarker(e);if(!i)throw new Error("InternalError: Cannot convert symbol to CIM");t=i;break}case"picture-marker":t=F.fromPictureMarker(e);break;case"simple-line":t=F.fromSimpleLineSymbol(e);break;case"simple-fill":t=F.fromSimpleFillSymbol(e);break;case"picture-fill":t=F.fromPictureFillSymbol(e);break;case"text":t=F.fromTextSymbol(e)}return{type:"CIMSymbolReference",symbol:t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports","./BidiEngine"],function(e,t){"use strict";const i=new t;e.bidiText=function(e){if(null==e)return["",!1];if(!i.hasBidiChar(e))return[e,!1];let t;return t="rtl"===i.checkContextual(e)?"IDNNN":"ICNNN",[i.bidiTransform(e,t,"VLYSN"),!0]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiEngine":function(){define(["./bidiEngineTables"],function(e){"use strict";function t(e,n,s,a,l){const c=function(e,t,r){if(void 0===t.inFormat&&(t.inFormat=r.defInFormat),void 0===t.outFormat&&(t.outFormat=r.defOutFormat),void 0===t.swap&&(t.swap=r.defSwap),t.inFormat===t.outFormat)return t;const n=t.inFormat.slice(0,1),s=t.outFormat.slice(0,1);let o,a=t.inFormat.slice(1,4),l=t.outFormat.slice(1,4);return a.startsWith("C")&&(o=i(e),a="ltr"===o||"rtl"===o?o.toUpperCase():"L"===t.inFormat.charAt(2)?"LTR":"RTL",t.inFormat=n+a),l.startsWith("C")&&(o=i(e),"rtl"===o?l="RTL":"ltr"===o?(o=function(e){const t=e.split("");return t.reverse(),i(t.join(""))}(e),l=o.toUpperCase()):l="L"===t.outFormat.charAt(2)?"LTR":"RTL",t.outFormat=s+l),t}(e,{inFormat:n,outFormat:s,swap:a},l);if(c.inFormat===c.outFormat)return e;n=c.inFormat,s=c.outFormat,a=c.swap;const u=n.slice(0,1),h=n.slice(1,4),d=s.slice(0,1),f=s.slice(1,4);if(l.inFormat=n,l.outFormat=s,l.swap=a,"L"===u&&"VLTR"===s){if("LTR"===h)return l.dir=C,r(e,l);if("RTL"===h)return l.dir=F,r(e,l)}if("V"===u&&"V"===d)return l.dir="RTL"===h?F:C,o(e,l);if("L"===u&&"VRTL"===s)return"LTR"===h?(l.dir=C,e=r(e,l)):(l.dir=F,e=r(e,l)),o(e);if("VLTR"===n&&"LLTR"===s)return l.dir=C,r(e,l);if("V"===u&&"L"===d&&h!==f)return e=o(e),"RTL"===h?t(e,"LLTR","VLTR",a,l):t(e,"LRTL","VRTL",a,l);if("VRTL"===n&&"LRTL"===s)return t(e,"LRTL","VRTL",a,l);if("L"===u&&"L"===d){const i=l.swap;return l.swap=i.slice(0,1)+"N","RTL"===h?(l.dir=F,e=r(e,l),l.swap="N"+i.slice(1,3),l.dir=C,e=r(e,l)):(l.dir=C,e=r(e,l),l.swap="N"+i.slice(1,3),e=t(e,"VLTR","LRTL",l.swap,l)),e}return e}function i(e){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(e);return t?t[0]<="z"?"ltr":"rtl":""}function r(e,t){const i=e.split(""),r=[];return n(i,r,t),function(e,t,i){if(0!==i.hiLevel&&i.swap[0]!==i.swap[1])for(let i=0;i<e.length;i++)1===t[i]&&(e[i]=f(e[i]))}(i,r,t),h(2,i,r,t),h(1,i,r,t),T=r,i.join("")}function n(t,i,r){const n=t.length,o=r.dir?e.impTabRtl:e.impTabLtr;let a=0,l=-1;const c=[],u=[];r.hiLevel=r.dir,r.lastArabic=!1,r.hasUbatAl=!1,r.hasUbatB=!1,r.hasUbatS=!1;for(let e=0;e<n;e++)c[e]=s(t[e]);for(let s=0;s<n;s++){const n=a,h=d(t,c,u,s,r);u[s]=h,a=o[n][h];const f=240&a;a&=15;const p=o[a][P];if(i[s]=p,f>0)if(16===f){for(let e=l;e<s;e++)i[e]=1;l=-1}else l=-1;if(o[a][I])-1===l&&(l=s);else if(l>-1){for(let e=l;e<s;e++)i[e]=p;l=-1}c[s]===e.ubatB&&(i[s]=0),r.hiLevel|=p}r.hasUbatS&&function(t,i,r,n){for(let s=0;s<r;s++)if(t[s]===e.ubatS){i[s]=n.dir;for(let r=s-1;r>=0&&t[r]===e.ubatWs;r--)i[r]=n.dir}}(c,i,n,r)}function s(t){const i=t.charCodeAt(0),r=e.primaryTable[i>>8];return r<e.tbbase?r:e.unicodeTable[r-e.tbbase][255&i]}function o(e,t){const i=e.split("");if(t){const e=[];n(i,e,t),T=e}return i.reverse(),S.reverse(),i.join("")}function a(e,t,i){for(let r=0;r<t;r++)if(e[r]===i)return r;return-1}function l(t){for(let i=0;i<e.arabicAlefBetIntervalsBegine.length;i++)if(t>=e.arabicAlefBetIntervalsBegine[i]&&t<=e.arabicAlefBetIntervalsEnd[i])return!0;return!1}function c(e,t,i,r){for(;t*i<r&&_(e[t]);)t+=i;return!!(t*i<r&&l(e[t]))}function u(t,i,r,n){for(;i*r<n&&_(t[i]);)i+=r;let s=" ";if(!(i*r<n))return!1;s=t[i];for(let t=0;t<e.aLefTable.length;t++)if(e.aLefTable[t]===s)return!0;return!1}function h(e,t,i,r){if(r.hiLevel<e)return;if(1===e&&r.dir===F&&!r.hasUbatB)return t.reverse(),void S.reverse();const n=t.length;let s,o,a,l,c,u=0;for(;u<n;){if(i[u]>=e){for(s=u+1;s<n&&i[s]>=e;)s++;for(o=u,a=s-1;o<a;o++,a--)l=t[o],t[o]=t[a],t[a]=l,c=S[o],S[o]=S[a],S[a]=c;u=s}u++}}function d(t,i,r,n,s){const o=i[n];return{UBAT_L:()=>(s.lastArabic=!1,e.ubatL),UBAT_R:()=>(s.lastArabic=!1,e.ubatR),UBAT_ON:()=>e.ubatOn,UBAT_AN:()=>e.ubatAn,UBAT_EN:()=>s.lastArabic?e.ubatAn:e.ubatEn,UBAT_AL:()=>(s.lastArabic=!0,s.hasUbatAl=!0,e.ubatR),UBAT_WS:()=>e.ubatOn,UBAT_CS:()=>{let t,o;return n<1||n+1>=i.length||(t=r[n-1])!==e.ubatEn&&t!==e.ubatAn||(o=i[n+1])!==e.ubatEn&&o!==e.ubatAn?e.ubatOn:(s.lastArabic&&(o=e.ubatAn),o===t?o:e.ubatOn)},UBAT_ES:()=>(n>0?r[n-1]:e.ubatB)===e.ubatEn&&n+1<i.length&&i[n+1]===e.ubatEn?e.ubatEn:e.ubatOn,UBAT_ET:()=>{if(n>0&&r[n-1]===e.ubatEn)return e.ubatEn;if(s.lastArabic)return e.ubatOn;let t=n+1;const o=i.length;for(;t<o&&i[t]===e.ubatEt;)t++;return t<o&&i[t]===e.ubatEn?e.ubatEn:e.ubatOn},UBAT_NSM:()=>{if("VLTR"===s.inFormat){const r=i.length;let s=n+1;for(;s<r&&i[s]===e.ubatNsm;)s++;if(s<r){const r=t[n].charCodeAt(0),o=r>=1425&&r<=2303||64286===r,a=i[s];if(o&&(a===e.ubatR||a===e.ubatAl))return e.ubatR}}return n<1||i[n-1]===e.ubatB?e.ubatOn:r[n-1]},UBAT_B:()=>(s.lastArabic=!0,s.hasUbatB=!0,s.dir),UBAT_S:()=>(s.hasUbatS=!0,e.ubatOn),UBAT_LRE:()=>(s.lastArabic=!1,e.ubatOn),UBAT_RLE:()=>(s.lastArabic=!1,e.ubatOn),UBAT_LRO:()=>(s.lastArabic=!1,e.ubatOn),UBAT_RLO:()=>(s.lastArabic=!1,e.ubatOn),UBAT_PDF:()=>(s.lastArabic=!1,e.ubatOn),UBAT_BN:()=>e.ubatOn}[e.typesNames[o]]()}function f(t){let i,r=0,n=e.swapTable.length-1;for(;r<=n;)if(i=Math.floor((r+n)/2),t<e.swapTable[i][0])n=i-1;else{if(!(t>e.swapTable[i][0]))return e.swapTable[i][1];r=i+1}return t}function p(t){for(let i=0;i<e.standAlonForm.length;i++)if(e.standAlonForm[i]===t)return!0;return!1}function m(t){for(let i=0;i<e.baseForm.length;i++)if(t===e.baseForm[i])return e.medialForm[i];return t}function g(t,i){for(let r=0;r<e.baseForm.length;r++)if(t===e.baseForm[r])return i[r];return t}function _(e){return e>="ً"&&e<="ٕ"}function y(e){return"L"===e?"LTR":"R"===e?"RTL":"C"===e?"CLR":"D"===e?"CRL":""}function x(e,t,i,r){for(;t*i<r&&_(e[t]);)t+=i;return t*i<r&&(e[t]=" ",!0)}function b(t,i){for(let r=0;r<e.aLefTable.length;r++)if(t===e.aLefTable[r])return i[r];return t}function v(e,t,i,r){for(let n=0;n<e.length;n++)(e[n]>t||!i&&e[n]===t)&&(e[n]+=r)}let S=[],w=[],T=[];const M={dir:0,defInFormat:"LLTR",defSwap:"YN",inFormat:"LLTR",outFormat:"VLTR",swap:"YN",hiLevel:0,lastArabic:!1,hasUbatAl:!1,defOutFormat:""},P=5,I=6,C=0,F=1,O=/^[(I|V)][(L|RCD)][(Y|N)][(S|N)]N$/,A=/[\u0591-\u06ff\ufb1d-\ufefc]/;return class{constructor(){this.inputFormat="ILYNN",this.outputFormat="VLNNN",this.sourceToTarget=[],this.targetToSource=[],this.levels=[]}bidiTransform(i,r,n){if(this.sourceToTarget=[],this.targetToSource=[],!i)return"";if(function(e,t,i){S=[],T=[];for(let r=0;r<i;r++)e[r]=r,t[r]=r,S[r]=r}(this.sourceToTarget,this.targetToSource,i.length),!this.checkParameters(r,n))return i;r=this.inputFormat,n=this.outputFormat;let s=i;const o=M,h=y(r.charAt(1)),d=y(n.charAt(1)),f=(r.startsWith("I")?"L":r.charAt(0))+h,P=(n.startsWith("I")?"L":n.charAt(0))+d,I=r.charAt(2)+n.charAt(2);o.defInFormat=f,o.defOutFormat=P,o.defSwap=I;const C=t(i,f,P,I,o);let F=!1;return"R"===n.charAt(1)?F=!0:"C"!==n.charAt(1)&&"D"!==n.charAt(1)||(F="rtl"===this.checkContextual(C)),this.sourceToTarget=S,this.targetToSource=function(e){const t=new Array(e.length);for(let i=0;i<e.length;i++)t[e[i]]=i;return t}(this.sourceToTarget),w=this.targetToSource,s=r.charAt(3)===n.charAt(3)?C:"S"===n.charAt(3)?function(t,i){if(0===i.length)return"";void 0===t&&(t=!0);const r=(i=String(i)).split("");let n=0,s=1,o=r.length;t||(n=r.length-1,s=-1,o=1);const h=function(t,i,r,n){let s=0;const o=[];let a=0;for(let h=i;h*r<n;h+=r)if(l(t[h])||_(t[h])){if("ل"===t[h]&&u(t,h+r,r,n)){t[h]=b(t[h+r],0===s?e.lamAlefInialTableFE:e.lamAlefMedialTableFE),h+=r,x(t,h,r,n),o[a]=h,a++,s=0;continue}const i=t[h];1===s?t[h]=c(t,h+r,r,n)?m(t[h]):g(t[h],e.finalForm):!0===c(t,h+r,r,n)?t[h]=g(t[h],e.initialForm):t[h]=g(t[h],e.isolatedForm),_(i)||(s=1),!0===p(i)&&(s=0)}else s=0;return o}(r,n,s,o);let d="";for(let e=0;e<r.length;e++)a(h,h.length,e)>-1?(v(w,e,!t,-1),S.splice(e,1)):d+=r[e];return d}(F,C):function(t,i){if(0===t.length)return"";void 0===i&&(i=!0);let r="";const n=(t=String(t)).split("");for(let s=0;s<t.length;s++){let o=!1;if(n[s]>="ﹰ"&&n[s]<"\ufeff"){const a=t.charCodeAt(s);n[s]>="ﻵ"&&n[s]<="ﻼ"?(i?(s>0&&" "===n[s-1]?r=r.slice(0,-1)+"ل":(r+="ل",o=!0),r+=e.aLefTable[(a-65269)/2]):(r+=e.aLefTable[(a-65269)/2],r+="ل",s+1<t.length&&" "===n[s+1]?s++:o=!0),o&&(v(w,s,!0,1),S.splice(s,0,S[s]))):r+=e.feTo06Table[a-65136]}else r+=n[s]}return r}(C,F),this.sourceToTarget=S,this.targetToSource=w,this.levels=T,s}_inputFormatSetter(e){if(!O.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.inputFormat=e}_outputFormatSetter(e){if(!O.test(e))throw new Error("dojox/string/BidiEngine: the bidi layout string is wrong!");this.outputFormat=e}checkParameters(e,t){return e?this._inputFormatSetter(e):e=this.inputFormat,t?this._outputFormatSetter(t):t=this.outputFormat,e!==t}checkContextual(e){let t=i(e);if("ltr"!==t&&"rtl"!==t){try{t=document.dir.toLowerCase()}catch(e){}"ltr"!==t&&"rtl"!==t&&(t="ltr")}return t}hasBidiChar(e){return A.test(e)}}})},"esri/core/bidiEngineTables":function(){define(["exports"],function(e){"use strict";const t=10,i=11,r=12,n=18,s=[[n,n,n,n,n,n,n,n,n,6,5,6,8,5,n,n,n,n,n,n,n,n,n,n,n,n,n,n,5,5,5,6,8,4,4,i,i,i,4,4,4,4,4,t,9,t,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,n,n,n,n,n,n,5,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,n,9,4,i,i,i,i,4,4,4,4,0,4,4,n,4,4,i,i,2,2,4,0,4,4,4,2,0,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,4,4,4,4,4,4,4,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,1,r,1,r,r,1,r,r,1,r,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,4,4,4,4,4,1,1,1,1,1,4,4,4,4,4,4,4,4,4,4,4],[3,3,3,3,4,4,4,4,7,i,i,7,9,7,4,4,r,r,r,r,r,r,r,r,r,r,r,7,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,3,3,3,3,3,3,3,3,3,3,i,3,3,7,7,7,r,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,r,r,r,r,r,r,r,3,4,r,r,r,r,r,r,7,7,r,r,4,r,r,r,r,7,7,2,2,2,2,2,2,2,2,2,2,7,7,7,7,7,7],[7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,7,7,r,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,r,r,r,r,r,r,r,r,r,r,r,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,r,r,r,r,r,r,r,r,r,1,1,4,4,4,4,1,4,4,4,4,4],[8,8,8,8,8,8,8,8,8,8,8,n,n,n,0,1,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,5,13,14,15,16,17,9,i,i,i,i,i,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,8,n,n,n,n,n,4,4,4,4,4,n,n,n,n,n,n,2,0,4,4,2,2,2,2,2,2,t,t,4,4,4,0,2,2,2,2,2,2,2,2,2,2,t,t,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,i,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4],[0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,4,4,4,4,4,1,r,1,1,1,1,1,1,1,1,1,1,t,1,1,1,1,1,1,1,1,1,1,1,1,1,4,1,1,1,1,1,4,1,4,1,1,4,1,1,4,1,1,1,1,1,1,1,1,1,1,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],[r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,r,r,r,r,r,r,r,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,9,4,9,4,4,9,4,4,4,4,4,4,4,4,4,i,4,4,t,t,4,4,4,4,4,i,i,4,4,4,4,4,7,7,7,7,7,4,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,4,4,n],[4,4,4,i,i,i,4,4,4,4,4,t,9,t,9,9,2,2,2,2,2,2,2,2,2,2,9,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,0,0,0,4,4,0,0,0,4,4,4,i,i,4,4,4,i,i,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4]];e.aLefTable=["آ","أ","إ","ا"],e.arabicAlefBetIntervalsBegine=["ء","ف"],e.arabicAlefBetIntervalsEnd=["غ","ي"],e.baseForm=["ا","ب","ت","ث","ج","ح","خ","د","ذ","ر","ز","س","ش","ص","ض","ط","ظ","ع","غ","ف","ق","ك","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ل","م","ن","ه","و","ي","إ","أ","آ","ة","ى","ی","ئ","ؤ"],e.feTo06Table=["ً","ً","ٌ","؟","ٍ","؟","َ","َ","ُ","ُ","ِ","ِ","ّ","ّ","ْ","ْ","ء","آ","آ","أ","أ","ؤ","ؤ","إ","إ","ئ","ئ","ئ","ئ","ا","ا","ب","ب","ب","ب","ة","ة","ت","ت","ت","ت","ث","ث","ث","ث","ج","ج","ج","ج","ح","ح","ح","ح","خ","خ","خ","خ","د","د","ذ","ذ","ر","ر","ز","ز","س","س","س","س","ش","ش","ش","ش","ص","ص","ص","ص","ض","ض","ض","ض","ط","ط","ط","ط","ظ","ظ","ظ","ظ","ع","ع","ع","ع","غ","غ","غ","غ","ف","ف","ف","ف","ق","ق","ق","ق","ك","ك","ك","ك","ل","ل","ل","ل","م","م","م","م","ن","ن","ن","ن","ه","ه","ه","ه","و","و","ى","ى","ي","ي","ي","ي","ﻵ","ﻶ","ﻷ","ﻸ","ﻹ","ﻺ","ﻻ","ﻼ","؟","؟","؟"],e.finalForm=["ﺎ","ﺐ","ﺖ","ﺚ","ﺞ","ﺢ","ﺦ","ﺪ","ﺬ","ﺮ","ﺰ","ﺲ","ﺶ","ﺺ","ﺾ","ﻂ","ﻆ","ﻊ","ﻎ","ﻒ","ﻖ","ﻚ","ﻞ","ﻢ","ﻦ","ﻪ","ﻮ","ﻲ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯽ","ﺊ","ﺆ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺊ","ﺆ"],e.impTabLtr=[[0,3,0,1,0,0,0],[0,3,0,1,2,2,0],[0,3,0,17,2,0,1],[0,3,5,5,4,1,0],[0,3,21,21,4,0,1],[0,3,5,5,4,2,0]],e.impTabRtl=[[2,0,1,1,0,1,0],[2,0,1,1,0,2,0],[2,0,2,1,3,2,0],[2,0,2,33,3,1,1]],e.initialForm=["ﺍ","ﺑ","ﺗ","ﺛ","ﺟ","ﺣ","ﺧ","ﺩ","ﺫ","ﺭ","ﺯ","ﺳ","ﺷ","ﺻ","ﺿ","ﻃ","ﻇ","ﻋ","ﻏ","ﻓ","ﻗ","ﻛ","ﻟ","ﻣ","ﻧ","ﻫ","ﻭ","ﻳ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯾ","ﺋ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺋ","ﺅ"],e.isolatedForm=["ﺍ","ﺏ","ﺕ","ﺙ","ﺝ","ﺡ","ﺥ","ﺩ","ﺫ","ﺭ","ﺯ","ﺱ","ﺵ","ﺹ","ﺽ","ﻁ","ﻅ","ﻉ","ﻍ","ﻑ","ﻕ","ﻙ","ﻝ","ﻡ","ﻥ","ﻩ","ﻭ","ﻱ","ﺇ","ﺃ","ﺁ","ﺓ","ﻯ","ﯼ","ﺉ","ﺅ","ﹰ","ﹲ","ﹴ","ﹶ","ﹸ","ﹺ","ﹼ","ﹾ","ﺀ","ﺉ","ﺅ"],e.lamAlefInialTableFE=["ﻵ","ﻷ","ﻹ","ﻻ"],e.lamAlefMedialTableFE=["ﻶ","ﻸ","ﻺ","ﻼ"],e.medialForm=["ﺎ","ﺒ","ﺘ","ﺜ","ﺠ","ﺤ","ﺨ","ﺪ","ﺬ","ﺮ","ﺰ","ﺴ","ﺸ","ﺼ","ﻀ","ﻄ","ﻈ","ﻌ","ﻐ","ﻔ","ﻘ","ﻜ","ﻠ","ﻤ","ﻨ","ﻬ","ﻮ","ﻴ","ﺈ","ﺄ","ﺂ","ﺔ","ﻰ","ﯿ","ﺌ","ﺆ","ﹱ","ﹲ","ﹴ","ﹷ","ﹹ","ﹻ","ﹽ","ﹿ","ﺀ","ﺌ","ﺆ"],e.primaryTable=[100,0,0,0,0,101,102,103,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,104,4,4,4,0,4,0,4,0,4,4,4,0,0,4,4,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,4,4,0,0,4,4,0,0,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,0,0,0,105,7,7,106,107],e.standAlonForm=["ء","آ","أ","ؤ","إ","ا","ة","د","ذ","ر","ز","و","ى"],e.swapTable=[["(",")"],[")","("],["<",">"],[">","<"],["[","]"],["]","["],["{","}"],["}","{"],["«","»"],["»","«"],["‹","›"],["›","‹"],["⁽","⁾"],["⁾","⁽"],["₍","₎"],["₎","₍"],["≤","≥"],["≥","≤"],["〈","〉"],["〉","〈"],["﹙","﹚"],["﹚","﹙"],["﹛","﹜"],["﹜","﹛"],["﹝","﹞"],["﹞","﹝"],["﹤","﹥"],["﹥","﹤"]],e.tbbase=100,e.typesNames=["UBAT_L","UBAT_R","UBAT_EN","UBAT_AN","UBAT_ON","UBAT_B","UBAT_S","UBAT_AL","UBAT_WS","UBAT_CS","UBAT_ES","UBAT_ET","UBAT_NSM","UBAT_LRE","UBAT_RLE","UBAT_PDF","UBAT_LRO","UBAT_RLO","UBAT_BN"],e.ubatAl=7,e.ubatAn=3,e.ubatB=5,e.ubatBn=18,e.ubatCs=9,e.ubatEn=2,e.ubatEs=10,e.ubatEt=11,e.ubatL=0,e.ubatLre=13,e.ubatLro=16,e.ubatNsm=12,e.ubatOn=4,e.ubatPdf=15,e.ubatR=1,e.ubatRle=14,e.ubatRlo=17,e.ubatS=6,e.ubatWs=8,e.unicodeTable=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["require","exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper","./utils"],function(e,t,i,r,n){"use strict";const s=n.importLazily(()=>new Promise((t,i)=>e(["../../geometry/operators/json/bufferOperator"],t,i))),o=n.importLazily(()=>new Promise((t,i)=>e(["../../geometry/operators/json/convexHullOperator"],t,i))),a=n.importLazily(()=>new Promise((t,i)=>e(["../../geometry/operators/json/lengthOperator"],t,i))),l=n.importLazily(()=>new Promise((t,i)=>e(["../../geometry/operators/json/generalizeOperator"],t,i))),c=n.importLazily(()=>new Promise((t,i)=>e(["../../geometry/operators/json/offsetOperator"],t,i))),u=n.importLazily(()=>new Promise((t,i)=>e(["../../geometry/operators/json/simplifyOperator"],t,i)));let h;t.SimpleEffectCursor=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}},t.clipCursorToTileExtent=function(e,t,n){if(!e)return null;h||(h=new r.TileClipper(0,0,0,1));const s=n?-1:1,o="esriGeometryPolygon"===e.geometryType,a=o?3:2,l=o?3:2;let c,u;for(h.reset(a),h.setPixelMargin(t+1),h.setExtent(512);e.nextPath();)if(!(e.pathSize<l)){for(e.nextPoint(),c=e.x,u=s*e.y,h.moveTo(c,u);e.nextPoint();)c=e.x,u=s*e.y,h.lineTo(c,u);o&&h.close()}const d=h.result(!1);if(d){const t=i.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);for(const e of d){t.startPath();for(const i of e)t.pushXY(i.x,s*i.y)}return t.reset(),t}return null},t.lazyBufferOperator=s,t.lazyConvexHullOperator=o,t.lazyGeneralizeOperator=l,t.lazyLengthOperator=a,t.lazyOffsetOperator=c,t.lazySimplifyOperator=u,t.loadGeometryOperatorsForEffect=function(e){switch(e.type){case"CIMGeometricEffectDonut":case"CIMGeometricEffectBuffer":return s.getImportPromise();case"CIMGeometricEffectEnclosingPolygon":return o.getImportPromise();case"CIMGeometricEffectOffset":return c.getImportPromise();case"CIMGeometricEffectTaperedPolygon":return Promise.all([u.getImportPromise(),a.getImportPromise(),l.getImportPromise()]);default:return Promise.resolve()}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(e,t,i,r,n){"use strict";class s{static fromOptimized(e,t,i=!1,r=!1,n=1){return(new o).initialize(e,t,i,r,n)}static fromJSON(e,t=!1,i=!1){const[r,n]=l(e);return(new c).initialize(r,n,t,i,1)}static fromOptimizedCIM(e,t,i=!1,r=!1,n=1){return(new u).initialize(e,t,i,r,n)}static fromJSONCIM(e,t=!1,i=!1,r=1){const[n,s]=l(e);return(new h).initialize(n,s,t,i,r)}static fromFeatureSetReader(e){const t=e.readGeometryForDisplay(),i=e.geometryType;return t&&i?this.fromOptimized(t,i):null}static fromFeatureSetReaderCIM(e){const t=e.readGeometryForDisplay(),i=e.geometryType;return t&&i?this.fromOptimizedCIM(t,i):null}static createEmptyOptimized(e,t=!1,i=!1,r=1){return(new o).initialize(new n,e,t,i,r)}static createEmptyJSON(e,t=!1,i=!1){return(new c).initialize([],e,t,i,1)}static createEmptyOptimizedCIM(e,t=!1,i=!1,r=1){return(new u).initialize(new n,e,t,i,r)}static createEmptyJSONCIM(e,t=!1,i=!1,r=1){return(new h).initialize([],e,t,i,r)}asJSON(){const e=i.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:e.flat()}:"esriGeometryPoint"===this.geometryType?{x:e[0][0][0],y:e[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,t,i=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,t=this.y;const r=e,n=t;for(;this.nextPoint();)i+=(e-this.x)*(t+this.y),e=this.x,t=this.y;return i+=(e-r)*(t+n),-.5*i}invertY(){this.yFactor*=-1}}class o extends s{constructor(){super(...arguments),this._end=-1}initialize(e,t,i,r,n){return this.hasZ=i,this.hasM=r,this.geometryType=t,this._stride=2+Number(i)+Number(r),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=n,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const t=this._pathOffset+e*this._stride;return t>=0&&t<this._end&&(this._pointOffset=t,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}getCurrentPath(){const e=this._end,t=this._geometry.coords,i=this._pathOffset;return(new o).initialize(new n([this.pathSize],t.slice(i,e)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const e=this._end,t=this._stride,i=this._geometry.coords;let r=0;for(let n=this._pathOffset+t;n<e;n+=t){const e=i[n-t],s=i[n-t+1],o=i[n]-e,a=i[n+1]-s;r+=Math.sqrt(o*o+a*a)}return r}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,t){this._geometry.coords.push(e,t),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const t of e)for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const t=e.asOptimized();this._geometry.coords.push(...t.coords),this._geometry.lengths.push(...t.lengths)}asOptimized(){const e=this._geometry.clone();if(1!==this.yFactor)for(let t=1;t<e.coords.length;t+=this._stride)e.coords[t]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,t=this._pathOffset,i=this._end-this._stride;for(let r=0;r<this._stride;r++)if(e[t+r]!==e[i+r])return!1;return!0}clone(){return(new o).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,t)=>e+t)}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function a(e){const t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t}function l(e){return r.isPolygon(e)?[e.rings,"esriGeometryPolygon"]:r.isPolyline(e)?[e.paths,"esriGeometryPolyline"]:r.isMultipoint(e)?[[e.points],"esriGeometryMultipoint"]:r.isExtent(e)?[[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],"esriGeometryEnvelope"]:r.isPoint(e)?[[[a(e)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class c extends s{initialize(e,t,i,r,n){return this._paths=e,this.geometryType=t,this.hasZ=i,this.hasM=r,this._pathIndex=this._pointIndex=-1,this.yFactor=n,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,t=this._currentPath;let i=0;for(let r=1;r<e;r++){const e=t[r-1],n=t[r],s=e[0],o=e[1],a=n[0]-s,l=n[1]-o;i+=Math.sqrt(a*a+l*l)}return i}startPath(){this._paths.push([])}getCurrentPath(){return(new c).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,t){this._paths[this.totalSize-1].push([e,t])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const t=i.collectMultipath(e);for(const e of t)this.pushPath(e)}asOptimized(){const e=new n;if("esriGeometryPoint"===this.geometryType)e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const t of this._paths){for(const i of t)e.coords.push(i[0]),e.coords.push(i[1]*this.yFactor),this.hasZ&&e.coords.push(i[2]),this.hasM&&e.coords.push(i[this._mIndex]);e.lengths.push(t.length)}return e}isClosed(){const e=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}clone(){return(new c).initialize(t.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,t)=>e+t)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}}class u extends o{initialize(e,t,i,r,n){return super.initialize(e,t,i,r,n),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(e=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=(new u).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}}class h extends c{initialize(e,t,i,r,n){return super.initialize(e,t,i,r,n)}clone(){return(new h).initialize(t.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(e){this._paths[this.pathIndex][e][4]=1}getControlPointAt(e){return 1===this._paths[this.pathIndex][e][4]}}e.GeometryCursor=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/TileClipper":function(){define(["exports"],function(e){"use strict";class t{constructor(e,t){this.x=e,this.y=t}static fromArray(e){return new t(e[0],e[1])}clone(){return new t(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){return this.x=e,this.y=t,this}normalize(){const e=this.x,t=this.y,i=Math.sqrt(e*e+t*t);return this.x/=i,this.y/=i,this}rightPerpendicular(){const e=this.x;return this.x=this.y,this.y=-e,this}leftPerpendicular(){const e=this.x;return this.x=-this.y,this.y=e,this}move(e,t){return this.x+=e,this.y+=t,this}assign(e){return this.x=e.x,this.y=e.y,this}assignAdd(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}assignSub(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}rotate(e,t){const i=this.x,r=this.y;return this.x=i*e-r*t,this.y=i*t+r*e,this}rotateReverse(e,t){const i=this.x,r=this.y;return this.x=i*e+r*t,this.y=-i*t+r*e,this}scale(e){return this.x*=e,this.y*=e,this}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}sub(e){return this.x-=e.x,this.y-=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}static distance(e,t){const i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}static add(e,i){return new t(e.x+i.x,e.y+i.y)}static sub(e,i){return new t(e.x-i.x,e.y-i.y)}}class i{constructor(e,t,i){this.ratio=e,this.x=t,this.y=i}}class r{static simplify(e,t,i){if(!i)return;const n=-t,s=e+t,o=-t,a=e+t,l=[],c=[],u=i.length;for(let e=0;e<u;++e){const t=i[e];if(!t||t.length<2)continue;let r,u=t[0];const h=t.length;for(let i=1;i<h;++i)r=t[i],u.x===r.x&&(u.x<=n&&(u.y>r.y?(l.push(e),l.push(i),l.push(0),l.push(-1)):(c.push(e),c.push(i),c.push(0),c.push(-1))),u.x>=s&&(u.y<r.y?(l.push(e),l.push(i),l.push(1),l.push(-1)):(c.push(e),c.push(i),c.push(1),c.push(-1)))),u.y===r.y&&(u.y<=o&&(u.x<r.x?(l.push(e),l.push(i),l.push(2),l.push(-1)):(c.push(e),c.push(i),c.push(2),c.push(-1))),u.y>=a&&(u.x>r.x?(l.push(e),l.push(i),l.push(3),l.push(-1)):(c.push(e),c.push(i),c.push(3),c.push(-1)))),u=r}if(0===l.length||0===c.length)return;r.fillParent(i,c,l),r.fillParent(i,l,c);const h=[];r.calcDeltas(h,c,l),r.calcDeltas(h,l,c),r.addDeltas(h,i)}static fillParent(e,t,i){const r=i.length,s=t.length;for(let o=0;o<s;o+=4){const s=t[o],a=t[o+1],l=t[o+2],c=e[s][a-1],u=e[s][a];let h=8092,d=-1;for(let t=0;t<r;t+=4){if(i[t+2]!==l)continue;const r=i[t],s=i[t+1],o=e[r][s-1],a=e[r][s];switch(l){case 0:case 1:if(n(c.y,o.y,a.y)&&n(u.y,o.y,a.y)){const e=Math.abs(a.y-o.y);e<h&&(h=e,d=t)}break;case 2:case 3:if(n(c.x,o.x,a.x)&&n(u.x,o.x,a.x)){const e=Math.abs(a.x-o.x);e<h&&(h=e,d=t)}}}t[o+3]=d}}static calcDeltas(e,t,i){const n=t.length;for(let s=0;s<n;s+=4){const n=[],o=r.calcDelta(s,t,i,n);e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]),e.push(o)}}static calcDelta(e,t,i,n){const s=t[e+3];if(-1===s)return 0;const o=n.length;return o>1&&n[o-2]===s?0:(n.push(s),r.calcDelta(s,i,t,n)+1)}static addDeltas(e,t){const i=e.length;let r=0;for(let t=0;t<i;t+=4){const i=e[t+3];i>r&&(r=i)}for(let n=0;n<i;n+=4){const i=t[e[n]],s=e[n+1],o=r-e[n+3];switch(e[n+2]){case 0:i[s-1].x-=o,i[s].x-=o,1===s&&(i[i.length-1].x-=o),s===i.length-1&&(i[0].x-=o);break;case 1:i[s-1].x+=o,i[s].x+=o,1===s&&(i[i.length-1].x+=o),s===i.length-1&&(i[0].x+=o);break;case 2:i[s-1].y-=o,i[s].y-=o,1===s&&(i[i.length-1].y-=o),s===i.length-1&&(i[0].y-=o);break;case 3:i[s-1].y+=o,i[s].y+=o,1===s&&(i[i.length-1].y+=o),s===i.length-1&&(i[0].y+=o)}}}}const n=(e,t,i)=>e>=t&&e<=i||e>=i&&e<=t;e.Point=t,e.SimpleBuilder=class{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this._lines=[],this._line=null}moveTo(e,i){this._line&&this._lines.push(this._line),this._line=[];const r=this._ratio;this._line.push(new t(e*r,i*r))}lineTo(e,i){const r=this._ratio;this._line.push(new t(e*r,i*r))}close(){const e=this._line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this._line&&this._lines.push(this._line),0===this._lines.length?null:this._lines}},e.TileClipper=class{constructor(e,t,i,r=8,n=8){this._lines=[],this._starts=[],this.validateTessellation=!0,this._pixelRatio=r,this._pixelMargin=n,this._tileSize=512*r,this._dz=e,this._yPos=t,this._xPos=i}setPixelMargin(e){e!==this._pixelMargin&&(this._pixelMargin=e,this.setExtent(this._extent))}setExtent(e){this._extent=e,this._finalRatio=this._tileSize/e*(1<<this._dz);let t=this._pixelRatio*this._pixelMargin;t/=this._finalRatio;const i=e>>this._dz;t>i&&(t=i),this._margin=t,this._xmin=i*this._xPos-t,this._ymin=i*this._yPos-t,this._xmax=this._xmin+i+2*t,this._ymax=this._ymin+i+2*t}reset(e){this._type=e,this._lines=[],this._starts=[],this._line=null,this._start=0}moveTo(e,i){this._pushLine(),this._prevIsIn=this._isIn(e,i),this._moveTo(e,i,this._prevIsIn),this._prevPt=new t(e,i),this._firstPt=new t(e,i),this._dist=0}lineTo(e,r){const n=this._isIn(e,r),s=new t(e,r),o=t.distance(this._prevPt,s);let a,l,c,u,h,d,f,p;if(n)this._prevIsIn?this._lineTo(e,r,!0):(a=this._prevPt,l=s,c=this._intersect(l,a),this._start=this._dist+o*(1-this._r),this._lineTo(c.x,c.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,a=s,c=this._intersect(l,a),this._lineTo(c.x,c.y,!0),this._lineTo(a.x,a.y,!1);else{const e=this._prevPt,t=s;if(e.x<=this._xmin&&t.x<=this._xmin||e.x>=this._xmax&&t.x>=this._xmax||e.y<=this._ymin&&t.y<=this._ymin||e.y>=this._ymax&&t.y>=this._ymax)this._lineTo(t.x,t.y,!1);else{const r=[];if((e.x<this._xmin&&t.x>this._xmin||e.x>this._xmin&&t.x<this._xmin)&&(u=(this._xmin-e.x)/(t.x-e.x),p=e.y+u*(t.y-e.y),p<=this._ymin?d=!1:p>=this._ymax?d=!0:r.push(new i(u,this._xmin,p))),(e.x<this._xmax&&t.x>this._xmax||e.x>this._xmax&&t.x<this._xmax)&&(u=(this._xmax-e.x)/(t.x-e.x),p=e.y+u*(t.y-e.y),p<=this._ymin?d=!1:p>=this._ymax?d=!0:r.push(new i(u,this._xmax,p))),(e.y<this._ymin&&t.y>this._ymin||e.y>this._ymin&&t.y<this._ymin)&&(u=(this._ymin-e.y)/(t.y-e.y),f=e.x+u*(t.x-e.x),f<=this._xmin?h=!1:f>=this._xmax?h=!0:r.push(new i(u,f,this._ymin))),(e.y<this._ymax&&t.y>this._ymax||e.y>this._ymax&&t.y<this._ymax)&&(u=(this._ymax-e.y)/(t.y-e.y),f=e.x+u*(t.x-e.x),f<=this._xmin?h=!1:f>=this._xmax?h=!0:r.push(new i(u,f,this._ymax))),0===r.length)h?d?this._lineTo(this._xmax,this._ymax,!0):this._lineTo(this._xmax,this._ymin,!0):d?this._lineTo(this._xmin,this._ymax,!0):this._lineTo(this._xmin,this._ymin,!0);else if(r.length>1&&r[0].ratio>r[1].ratio)this._start=this._dist+o*r[1].ratio,this._lineTo(r[1].x,r[1].y,!0),this._lineTo(r[0].x,r[0].y,!0);else{this._start=this._dist+o*r[0].ratio;for(let e=0;e<r.length;e++)this._lineTo(r[e].x,r[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=o,this._prevIsIn=n,this._prevPt=s}close(){if(this._line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const i=this._line;let r=i.length;for(;r>=4&&(i[0].x===i[1].x&&i[0].x===i[r-2].x||i[0].y===i[1].y&&i[0].y===i[r-2].y);)i.pop(),i[0].x=i[r-2].x,i[0].y=i[r-2].y,--r}}result(e=!0){return this._pushLine(),0===this._lines.length?null:(3===this._type&&e&&r.simplify(this._tileSize,this._margin*this._finalRatio,this._lines),this._lines)}resultWithStarts(){if(2!==this._type)throw new Error("Only valid for lines");this._pushLine();const e=this._lines,t=e.length;if(0===t)return null;const i=[];for(let r=0;r<t;r++)i.push({line:e[r],start:this._starts[r]||0});return i}_isIn(e,t){return e>=this._xmin&&e<=this._xmax&&t>=this._ymin&&t<=this._ymax}_intersect(e,i){let r,n,s;if(i.x>=this._xmin&&i.x<=this._xmax)n=i.y<=this._ymin?this._ymin:this._ymax,s=(n-e.y)/(i.y-e.y),r=e.x+s*(i.x-e.x);else if(i.y>=this._ymin&&i.y<=this._ymax)r=i.x<=this._xmin?this._xmin:this._xmax,s=(r-e.x)/(i.x-e.x),n=e.y+s*(i.y-e.y);else{n=i.y<=this._ymin?this._ymin:this._ymax,r=i.x<=this._xmin?this._xmin:this._xmax;const t=(r-e.x)/(i.x-e.x),o=(n-e.y)/(i.y-e.y);t<o?(s=t,n=e.y+t*(i.y-e.y)):(s=o,r=e.x+o*(i.x-e.x))}return this._r=s,new t(r,n)}_pushLine(){this._line&&(1===this._type?this._line.length>0&&(this._lines.push(this._line),this._starts.push(this._start)):2===this._type?this._line.length>1&&(this._lines.push(this._line),this._starts.push(this._start)):3===this._type&&this._line.length>3&&(this._lines.push(this._line),this._starts.push(this._start))),this._line=[],this._start=0}_moveTo(e,i,r){3!==this._type?r&&(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new t(e,i))):(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.push(new t(e,i)),this._isH=!1,this._isV=!1)}_lineTo(e,i,r){let n,s;if(3!==this._type)if(r){if(e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line.length>0&&(n=this._line[this._line.length-1],n.equals(e,i)))return;this._line.push(new t(e,i))}else this._line&&this._line.length>0&&this._pushLine();else if(r||(e<this._xmin&&(e=this._xmin),e>this._xmax&&(e=this._xmax),i<this._ymin&&(i=this._ymin),i>this._ymax&&(i=this._ymax)),e=Math.round((e-(this._xmin+this._margin))*this._finalRatio),i=Math.round((i-(this._ymin+this._margin))*this._finalRatio),this._line&&this._line.length>0){n=this._line[this._line.length-1];const r=n.x===e,o=n.y===i;if(r&&o)return;this._isH&&r||this._isV&&o?(n.x=e,n.y=i,s=this._line[this._line.length-2],s.x===e&&s.y===i?(this._line.pop(),this._line.length<=1?(this._isH=!1,this._isV=!1):(s=this._line[this._line.length-2],this._isH=s.x===e,this._isV=s.y===i)):(this._isH=s.x===e,this._isV=s.y===i)):(this._line.push(new t(e,i)),this._isH=r,this._isV=o)}else this._line.push(new t(e,i))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],function(e){"use strict";e.Placement=class{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rzCos=e,this.rzSin=t}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define(["exports","../../core/fontUtils","../../core/has","../../core/lang","../../core/Logger","../../core/mathUtils","../../core/ObjectPool","../../core/screenUtils","../../geometry/GeometryCursor","../../geometry/support/aaBoundingRect","../../geometry/support/boundsUtils","../../geometry/support/centroid","../../geometry/support/jsonUtils","./CIMEffects","./CIMImageColorSubstitutionHelper","./CIMOperators","./CIMPlacements","./defaultCIMValues","./imageUtils","./mathUtils","./rasterizingUtils","./Rect","./TextRasterizer","./utils","../../views/2d/engine/svgUtils","../../views/2d/engine/webgl/definitions","../../views/2d/engine/webgl/mesh/templates/shapingUtils","../../views/2d/layers/graphics/graphicsUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_,y,x,b,v,S,w,T,M,P,I){"use strict";const C=Math.PI/180,F=()=>n.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");class O{constructor(e){this._t=e}static createIdentity(){return new O([1,0,0,0,1,0])}clone(){const e=this._t;return new O(e.slice())}transform(e){const t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(e,t){return new O([e,0,0,0,t,0])}scale(e,t){const i=this._t;return i[0]*=e,i[1]*=e,i[2]*=e,i[3]*=t,i[4]*=t,i[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,t){return new O([0,0,e,0,0,t])}translate(e,t){const i=this._t;return i[2]+=e,i[5]+=t,this}static createRotate(e){const t=Math.cos(e),i=Math.sin(e);return new O([t,-i,0,i,t,0])}rotate(e){return O.multiply(this,O.createRotate(e),this)}angle(){const e=this._t[0],t=this._t[3],i=Math.sqrt(e*e+t*t);return[e/i,t/i]}static multiply(e,t,i){const r=e._t,n=t._t,s=r[0]*n[0]+r[3]*n[1],o=r[1]*n[0]+r[4]*n[1],a=r[2]*n[0]+r[5]*n[1]+n[2],l=r[0]*n[3]+r[3]*n[4],c=r[1]*n[3]+r[4]*n[4],u=r[2]*n[3]+r[5]*n[4]+n[5],h=i._t;return h[0]=s,h[1]=o,h[2]=a,h[3]=l,h[4]=c,h[5]=u,i}invert(){const e=this._t;let t=e[0]*e[4]-e[1]*e[3];if(0===t)return new O([0,0,0,0,0,0]);t=1/t;const i=(e[1]*e[5]-e[2]*e[4])*t,r=(e[2]*e[3]-e[0]*e[5])*t,n=e[4]*t,s=-e[1]*t,o=-e[3]*t,a=e[0]*t;return new O([n,s,i,o,a,r])}}class A{constructor(e,t){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new o(g.Placement,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(t||O.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}setTransform(e,t){this._transfos=[e||O.createIdentity()],this._sizeTransfos=[t||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,t){const i=t?e.scaleRatio():1;O.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*i)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t,i){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t);break;case"CIMTextSymbol":this.drawTextSymbol(e,t,i)}}drawMultiLayerSymbol(e,t){if(!e||!t)return;const i=e.symbolLayers;if(!i)return;const r=e.effects;if(r&&r.length>0){const e=this.executeEffects(r,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayers(i,t.asJSON()),t=e.next()}}else this.drawSymbolLayers(i,t)}executeEffects(e,t){let i=new f.SimpleEffectCursor(l.GeometryCursor.fromJSONCIM(t));for(const t of e){const e=m.getEffectOperator(t);e&&(i=e.execute(i,t,this.geomUnitsPerPoint(),null))}return i}drawSymbolLayers(e,t){let i=e.length;for(;i--;){const r=e[i];if(!r||!1===r.enable)continue;const n=r.effects;if(n&&n.length>0){const e=this.executeEffects(n,t);if(e){let t=null;for(;(t=e.next())&&(this.drawSymbolLayer(r,t.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(r,t);if(this._earlyReturn)return}}drawSymbolLayer(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color,e.path);break;case"CIMHatchFill":this.drawHatchFill(t,e);break;case"CIMPictureFill":this.drawPictureFill(t,e);break;case"CIMGradientFill":this.drawGradientFill(t,e);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit,e.path);break;case"CIMPictureStroke":this.drawPictureStroke(t,e);break;case"CIMGradientStroke":this.drawGradientStroke(t,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){const i=function(e,t,i){let r=w.getNumericValue(e.separation,_.defaultCIMValues.CIMHatchFill.separation)*i,n=w.getNumericValue(e.rotation);if(0===r)return null;r<0&&(r=-r);let s=0;const o=.5*r;for(;s>o;)s-=r;for(;s<-o;)s+=r;const a=c.create();u.getBoundsXY(a,t),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;n>180;)n-=180;for(;n<0;)n+=180;const h=Math.cos(n*C),d=Math.sin(n*C),f=-r*d,p=r*h;let m,g,y,x;s=w.getNumericValue(e.offsetX)*i*d-w.getNumericValue(e.offsetY)*i*h,m=y=Number.MAX_VALUE,g=x=-Number.MAX_VALUE;for(const e of l){const t=e[0],i=e[1],r=h*t+d*i,n=-d*t+h*i;m=Math.min(m,r),y=Math.min(y,n),g=Math.max(g,r),x=Math.max(x,n)}y=Math.floor(y/r)*r;let b=h*m-d*y-f*s/r,v=d*m+h*y-p*s/r,S=h*g-d*y-f*s/r,T=d*g+h*y-p*s/r;const M=1+Math.round((x-y)/r),P=[];for(let e=0;e<M;e++)b+=f,v+=p,S+=f,T+=p,P.push([[b,v],[S,T]]);return{paths:P}}(t,e,this.geomUnitsPerPoint());i&&(this.pushClipPath(e),this.drawMultiLayerSymbol(t.lineSymbol,i),this.popClipPath())}drawPictureFill(e,t){}drawGradientFill(e,t){}drawPictureStroke(e,t){}drawGradientStroke(e,t){}drawMarkerLayer(e,t){const i=e.markerPlacement;if(i){const r=m.getPlacementOperator(i);if(r){const n="CIMMarkerPlacementInsidePolygon"===i.type||"CIMMarkerPlacementPolygonCenter"===i.type&&i.clipAtBoundary;n&&this.pushClipPath(t);const s=r.execute(l.GeometryCursor.fromJSONCIM(t),i,this.geomUnitsPerPoint(),null);if(s){let t=null;for(;(t=s.next())&&(this.drawMarker(e,t),!this._earlyReturn););}n&&this.popClipPath()}}else{const i=this._placementPool.acquire();if(d.isPoint(t))i.tx=t.x,i.ty=t.y,this.drawMarker(e,i);else if(d.isPolygon(t)){const r=h.polygonCentroid(t);r&&([i.tx,i.ty]=r,this.drawMarker(e,i))}else if(d.isPolyline(t)){for(const r of t.paths)for(const t of r)if(i.tx=t[0],i.ty=t[1],this.drawMarker(e,i),this._earlyReturn)break}else for(const r of t.points)if(i.tx=r[0],i.ty=r[1],this.drawMarker(e,i),this._earlyReturn)break;this._placementPool.release(i)}}drawMarker(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){if(!e)return;const i=this._resourceManager.getResource(e.url),r=w.getNumericValue(e.size,_.defaultCIMValues.CIMPictureMarker.size);if(null==i||r<=0)return;const n=i.width,s=i.height;if(!n||!s)return;const o=n/s,a=w.getNumericValue(e.scaleX,1),l=O.createIdentity(),c=e.anchorPoint;if(c){let t=c.x,i=c.y;"Absolute"!==e.anchorPointUnits&&(t*=r*o*a,i*=r),l.translate(-t,-i)}let u=w.getNumericValue(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*C);let h=w.getNumericValue(e.offsetX),d=w.getNumericValue(e.offsetY);if(h||d){if(this._mapRotation){const e=C*this._mapRotation,t=Math.cos(e),i=Math.sin(e),r=h*i+d*t;h=h*t-d*i,d=r}l.translate(h,d)}const f=this.geomUnitsPerPoint();1!==f&&l.scale(f,f);const p=t.getAngle();p&&l.rotate(p),l.translate(t.tx,t.ty),this.push(l,!1),this.drawImage(e,r),this.pop()}drawVectorMarker(e,t){if(!e)return;const i=e.markerGraphics;if(!i)return;const r=w.getNumericValue(e.size,_.defaultCIMValues.CIMVectorMarker.size),n=e.frame,s=n?n.ymax-n.ymin:0,o=r&&s?r/s:1,a=O.createIdentity();n&&a.translate(.5*-(n.xmax+n.xmin),.5*-(n.ymax+n.ymin));const l=e.anchorPoint;if(l){let t=l.x,i=l.y;"Absolute"!==e.anchorPointUnits?n&&(t*=n.xmax-n.xmin,i*=n.ymax-n.ymin):(t/=o,i/=o),a.translate(-t,-i)}1!==o&&a.scale(o,o);let c=w.getNumericValue(e.rotation);e.rotateClockwise&&(c=-c),this._mapRotation&&(c+=this._mapRotation),c&&a.rotate(c*C);let u=w.getNumericValue(e.offsetX),h=w.getNumericValue(e.offsetY);if(u||h){if(this._mapRotation){const e=C*this._mapRotation,t=Math.cos(e),i=Math.sin(e),r=u*i+h*t;u=u*t-h*i,h=r}a.translate(u,h)}const d=this.geomUnitsPerPoint();1!==d&&a.scale(d,d);const f=t.getAngle();f&&a.rotate(f),a.translate(t.tx,t.ty),this.push(a,e.scaleSymbolsProportionally);for(const e of i){e?.symbol&&e.geometry||F().error("Invalid marker graphic",e);let t=e.textString;if("number"==typeof t&&(t=t.toString()),this.drawSymbol(e.symbol,e.geometry,t),this._earlyReturn)break}this.pop()}drawTextSymbol(e,t,i){if(!e)return;if(!d.isPoint(t))return;if(w.getNumericValue(e.height,_.defaultCIMValues.CIMTextSymbol.height)<=0)return;const r=O.createIdentity();let n=w.getNumericValue(e.angle);n=-n,n&&r.rotate(n*C);const s=w.getNumericValue(e.offsetX),o=w.getNumericValue(e.offsetY);(s||o)&&r.translate(s,o);const a=this.geomUnitsPerPoint();1!==a&&r.scale(a,a),r.translate(t.x,t.y),this.push(r,!1),this.drawText(e,i),this.pop()}}function E(e,t,i){for(const r of t){const t=r.length;for(let n=1;n<t;n++){const t=r[n-1],s=r[n];let o=(s[0]-t[0])*(s[0]-t[0])+(s[1]-t[1])*(s[1]-t[1]);if(0===o)continue;o=Math.sqrt(o);const a=((s[0]-t[0])*(e[1]-t[1])-(s[1]-t[1])*(e[0]-t[0]))/o;if(Math.abs(a)<i){const r=((s[0]-t[0])*(e[0]-t[0])+(s[1]-t[1])*(e[1]-t[1]))/o;if(r>-i&&r<o+i)return!0}}}return!1}function z(e,t){const i=t[0]-e[0],r=t[1]-e[1];return 180/Math.PI*Math.atan2(r,i)}const R=e=>e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null,V=(e,t,i)=>{switch(e){case"ExtraLeading":return 1+t/i;case"Multiple":return t;case"Exact":return t/i}};function D(e,i=1){const r=w.fromCIMFontDecoration(e),n=w.fromCIMFontStyle(e.fontStyleName),s=e.fontFamilyName??t.defaultFontFamily,{weight:o,style:a}=n,l=i*(e.height||5),c=w.fromCIMHorizontalAlignment(e.horizontalAlignment),u=w.fromCIMVerticalAlignment(e.verticalAlignment),h=w.getFillColor(e),d=w.getFillColor(e.haloSymbol),f=null!=d?i*(e.haloSize??0):0,p=w.getStrokeColor(e.symbol),m=i*(w.getStrokeWidth(e.symbol)||0),g="CIMBackgroundCallout"===e.callout?.type?e.callout.backgroundSymbol:null,_=w.getFillColor(g),y=w.getStrokeWidth(g),x=w.getStrokeColor(g);return{color:h,size:l,horizontalAlignment:c,verticalAlignment:u,font:{family:s,style:w.getFontStyle(a),weight:w.getFontWeight(o),decoration:r},outline:{size:m||0,color:p},halo:{size:f||0,color:d,style:a},backgroundColor:_,borderLine:null!=y&&null!=x?{size:y,color:x}:null,pixelRatio:1,premultiplyColors:!0}}function k(e){let t,i,r,n,s,o=e[0],a=1;for(;a<e.length;)t=e[a][0]-o[0],i=e[a][1]-o[1],n=0!==t?i/t:Math.PI/2,void 0!==r&&Math.abs(n-r)<=1e-4?(e.splice(a-1,1),o=s):(s=o,o=e[a],a++),r=n}e.CIMSymbolDrawHelper=A,e.CanvasDrawHelper=class extends A{constructor(e,t,i,r){super(t,i),this._applyAdditionalRenderProps=r,this._colorSubstitutionHelper=new p,this._ctx=e}drawSolidFill(e,t){if(!e)return;if(d.isPolygon(e))this._buildPath(e.rings,!0);else if(d.isPolyline(e))this._buildPath(e.paths,!0);else if(d.isExtent(e))this._buildPath(R(e).rings,!0);else{if(!d.isMultipoint(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const i=this._ctx;i.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",i.fill("evenodd")}drawSolidStroke(e,t,i,r,n,s){if(!e||!t||0===i)return;if(d.isPolygon(e))this._buildPath(e.rings,!0);else if(d.isPolyline(e))this._buildPath(e.paths,!1);else{if(!d.isExtent(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(R(e).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(i),.5),this._setCapStyle(r),this._setJoinStyle(n),o.miterLimit=s,o.stroke()}pushClipPath(e){if(this._ctx.save(),d.isPolygon(e))this._buildPath(e.rings,!0);else if(d.isPolyline(e))this._buildPath(e.paths,!0);else{if(!d.isExtent(e))return;this._buildPath(R(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,t){const{colorSubstitutions:i,url:r,tintColor:n}=e,s=w.getNumericValue(e.scaleX,1),o=this._resourceManager.getResource(r);if(null==o)return;let a=t*(o.width/o.height),l=t;t||(a=o.width,l=o.height);const c=w.isSVGImage(r)||"src"in o&&w.isSVGImage(o.src);let u="getFrame"in o?y.getFirstFrame(o):o;i&&(u=this._colorSubstitutionHelper.applyColorSubstitution(u,i)),this._applyAdditionalRenderProps&&!c&&n&&(u=this._colorSubstitutionHelper.tintImageData(u,n));const h=this.transformPt([0,0]),[d,f]=this.getTransformAngle(),p=this.transformSize(1),m=this._ctx;m.save(),m.setTransform({m11:s*p*d,m12:s*p*f,m21:-p*f,m22:p*d,m41:h[0],m42:h[1]}),m.drawImage(u,-a/2,-l/2,a,l),m.restore()}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new S);const i=D(e,this.transformSize(a.px2pt(1))),r=this._textRasterizer.rasterizeText(t,i);if(!r)return;const{size:n,anchorX:s,anchorY:o,canvas:l}=r,c=n[0]*(s+.5),u=n[1]*(o-.5),h=this._ctx,d=this.transformPt([0,0]),[f,p]=this.getTransformAngle();h.save(),h.setTransform({m11:1*f,m12:1*p,m21:-1*p,m22:1*f,m41:d[0]-1*c,m42:d[1]+1*u}),h.drawImage(l,0,0),h.restore()}drawPictureFill(e,t){if(!e)return;let{colorSubstitutions:i,height:r,offsetX:n,offsetY:s,rotation:o,scaleX:a,tintColor:l,url:c}=t;const u=this._resourceManager.getResource(c);if(null==u)return;if(d.isPolygon(e))this._buildPath(e.rings,!0);else if(d.isPolyline(e))this._buildPath(e.paths,!0);else if(d.isExtent(e))this._buildPath(R(e).rings,!0);else{if(!d.isMultipoint(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const h=this._ctx,f=w.isSVGImage(c)||"src"in u&&w.isSVGImage(u.src);let p,m="getFrame"in u?y.getFirstFrame(u):u;if(i&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,i)),this._applyAdditionalRenderProps){f||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)),p=h.createPattern(m,"repeat");const e=this.transformSize(1);o||(o=0),n?n*=e:n=0,s?s*=e:s=0,r&&(r*=e);const t=r?r/u.height:1,i=a&&r?a*r/u.width:1;if(0!==o||1!==t||1!==i||0!==n||0!==s){const e=new DOMMatrix;e.rotateSelf(0,0,-o).translateSelf(n,s).scaleSelf(i,t,1),p.setTransform(e)}}else p=h.createPattern(m,"repeat");h.save(),h.fillStyle=p,h.fill("evenodd"),h.restore()}drawPictureStroke(e,t){if(!e)return;let{colorSubstitutions:i,capStyle:n,joinStyle:s,miterLimit:o,tintColor:l,url:c,width:u}=t;const h=this._resourceManager.getResource(c);if(null==h)return;let f;if(d.isPolygon(e))f=e.rings;else if(d.isPolyline(e))f=e.paths;else{if(!d.isExtent(e))return d.isMultipoint(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;f=R(e).rings}u||(u=h.width);const p=w.isSVGImage(c)||"src"in h&&w.isSVGImage(h.src);let m="getFrame"in h?y.getFirstFrame(h):h;i&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,i)),this._applyAdditionalRenderProps&&(p||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)));const g=Math.max(this.transformSize(a.pt2px(u)),.5),_=g/m.width,x=this._ctx,b=x.createPattern(m,"repeat-y");let v,S;x.save(),this._setCapStyle(n),this._setJoinStyle(s),void 0!==o&&(x.miterLimit=o),x.lineWidth=g;for(let e of f)if(e=r.clone(e),k(e),e&&!(e.length<=1)){v=this.transformPt(e[0]);for(let t=1;t<e.length;t++){S=this.transformPt(e[t]);const i=z(v,S),r=new DOMMatrix;r.translateSelf(0,v[1]-g/2).scaleSelf(_,_,1).rotateSelf(0,0,90-i),b.setTransform(r),x.strokeStyle=b,x.beginPath(),x.moveTo(v[0],v[1]),x.lineTo(S[0],S[1]),x.stroke(),v=S}}x.restore()}drawGradientFill(e,t){if(!e)return;let i;if(d.isPolygon(e))i=e.rings;else if(d.isPolyline(e))i=e.paths;else{if(!d.isExtent(e))return void F().error("Unable to draw gradient fill");i=R(e).rings}this._buildPath(i,!0);const{angle:r,gradientMethod:n,gradientSize:o,gradientSizeUnits:l}=t,u=_.defaultCIMValues.CIMGradientFill,h=t.gradientType??u.gradientType,f=-s.deg2rad(r??0),p=c.empty();for(const e of i){const t=e?e.length:0;if(t>1)for(let i=0;i<t;i++){let t=this.transformPt(e[i]);"Linear"!==n&&"Rectangular"!==n||(t=x.rotate(t,-f)),c.expandPointInPlace(p,t)}}const[m,g,y,v]=p,S=this._ctx;switch(S.save(),n){case"Buffered":F().error(`Gradient method "${n}" currently unsupported.`);break;case"Linear":{const e=(g+v)/2,i="Absolute"===l?this.transformSize(a.pt2px(o)):w.getRelativeGradientSize(o,u.gradientSize)*(y-m),[r,n]="Discrete"===h?[y,y-i]:[m+i,m],s=x.rotate([r,e],f),c=x.rotate([n,e],f),d=S.createLinearGradient(s[0],s[1],c[0],c[1]);b.addColorStops(d,t),S.fillStyle=d,S.fill("evenodd");break}case"Circular":{const e=c.center(p),i=c.diagonal(p)/2,r="Absolute"===l?this.transformSize(a.pt2px(o)):w.getRelativeGradientSize(o,u.gradientSize)*i,[n,s]="Discrete"===h?[i,i-r]:[r,0],d=S.createRadialGradient(e[0],e[1],n,e[0],e[1],s);b.addColorStops(d,t),S.fillStyle=d,S.fill("evenodd");break}case"Rectangular":{const i=c.center(p),r=i[0],n=i[1],s=x.rotate(i,f),d=(i,r,n,o,a,l,c,u)=>{S.save(),this.pushClipPath(e);const h=x.rotate([a,l],f),d=x.rotate([c,u],f);S.beginPath(),S.moveTo(s[0],s[1]),S.lineTo(h[0],h[1]),S.lineTo(d[0],d[1]),S.lineTo(s[0],s[1]),S.clip();const p=x.rotate([i,r],f),m=x.rotate([n,o],f),g=S.createLinearGradient(p[0],p[1],m[0],m[1]);b.addColorStops(g,t),S.fillStyle=g,S.fill("evenodd"),S.restore()};let _="Absolute"===l?this.transformSize(a.pt2px(o)):w.getRelativeGradientSize(o,u.gradientSize)*(c.width(p)/2),[T,M]="Discrete"===h?[y,y-_]:[r+_,r];d(T,n,M,n,y,g,y,v),[T,M]="Discrete"===h?[m,m+_]:[r-_,r],d(T,n,M,n,m,v,m,g),_="Absolute"===l?this.transformSize(a.pt2px(o)):w.getRelativeGradientSize(o,u.gradientSize)*(c.height(p)/2);let[P,I]="Discrete"===h?[v,v-_]:[n+_,n];d(r,P,r,I,y,v,m,v),[P,I]="Discrete"===h?[g,g+_]:[n-_,n],d(r,P,r,I,m,g,y,g);break}}S.restore()}drawGradientStroke(e,t){const{capStyle:i,gradientMethod:n,gradientSize:s,gradientSizeUnits:o,joinStyle:l,miterLimit:c,width:u}=t;if(!e||0===u)return;let h;if(d.isPolygon(e))h=e.rings;else if(d.isPolyline(e))h=e.paths;else{if(!d.isExtent(e))return void F().error("Unable to draw gradient stroke");h=R(e).rings}const f=t.gradientType??_.defaultCIMValues.CIMGradientStroke.gradientType,p=Math.max(this.transformSize(a.pt2px(u)),.5),m=this._ctx;let g,y;m.save(),this._setCapStyle(i),this._setJoinStyle(l),void 0!==c&&(m.miterLimit=c),m.lineWidth=p;for(let e of h){if(e=r.clone(e),k(e),!e||e.length<=1)continue;let i=0;g=this.transformPt(e[0]);for(let t=1;t<e.length;t++){y=this.transformPt(e[t]);const r=y[0]-g[0],n=y[1]-g[1];i+=Math.sqrt(r*r+n*n),g=y}const l="Absolute"===o?this.transformSize(a.pt2px(s)):w.getRelativeGradientSize(s,_.defaultCIMValues.CIMGradientStroke.gradientSize)*("AcrossLine"===n?p:i);let c=0;g=this.transformPt(e[0]);for(let r=1;r<e.length;r++){y=this.transformPt(e[r]);const s=y[0]-g[0],o=y[1]-g[1],a=Math.sqrt(s*s+o*o);let u,h,d,_;switch(n){case"AcrossLine":{const[e,t]=x.rotate([s/a,o/a],-Math.PI/2),i=p/2,r="Discrete"===f?i:l-i;u=(g[0]+y[0])/2+e*r,h=(g[1]+y[1])/2+t*r,d=u-e*l,_=h-t*l;break}case"AlongLine":{const e=s/a,t=o/a;"Discrete"===f?(u=g[0]-e*c,h=g[1]-t*c,d=u+e*l,_=h+t*l):(d=g[0]+e*(i-c),_=g[1]+t*(i-c),u=d-e*l,h=_-t*l);break}default:return F().error("Unrecognized gradient method:",n),void m.restore()}const v=m.createLinearGradient(u,h,d,_);b.addColorStops(v,t),m.strokeStyle=v,m.beginPath(),m.moveTo(g[0],g[1]),m.lineTo(y[0],y[1]),m.stroke(),c+=a,g=y}}m.restore()}_buildPath(e,t){const i=this._ctx;if(i.beginPath(),e)for(const r of e){const e=r?r.length:0;if(e>1){let n=this.transformPt(r[0]);i.moveTo(n[0],n[1]);for(let t=1;t<e;t++)n=this.transformPt(r[t]),i.lineTo(n[0],n[1]);t&&i.closePath()}}}_setCapStyle(e){switch(e){case"Butt":this._ctx.lineCap="butt";break;case"Round":this._ctx.lineCap="round";break;case"Square":this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case"Bevel":this._ctx.lineJoin="bevel";break;case"Round":this._ctx.lineJoin="round";break;case"Miter":this._ctx.lineJoin="miter"}}},e.EnvDrawHelper=class extends A{constructor(e,t){super(e,t),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new v(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return c.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(d.isPolygon(e))this._processPath(e.rings,0);else if(d.isPolyline(e))this._processPath(e.paths,0);else if(d.isExtent(e)){const t=R(e);t&&this._processPath(t.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,t,i){if(!e||this._clipCount>0||null==i||i<=0)return;const r=Math.max(.5*this.transformSize(w.getNumericValue(i,_.defaultCIMValues.CIMSolidStroke.width)),.25);if(d.isPolygon(e))this._processPath(e.rings,r);else if(d.isPolyline(e))this._processPath(e.paths,r);else if(d.isExtent(e)){const t=R(e);t&&this._processPath(t.rings,r)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,t){d.isPolygon(t)&&e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._processPath(t.rings,0):super.drawMarkerLayer(e,t)}drawHatchFill(e,t){this.drawSolidFill(e)}drawPictureFill(e,t){this.drawSolidFill(e)}drawGradientFill(e,t){this.drawSolidFill(e)}drawPictureStroke(e,t){this.drawSolidStroke(e,null,t.width)}drawGradientStroke(e,t){this.drawSolidStroke(e,null,t.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,t){const{url:i}=e,r=w.getNumericValue(e.scaleX,1);let n=r*t,s=t;const o=this._resourceManager.getResource(i);if(null!=o){const e=o.height/o.width;n=r*(t?e>1?t:t/e:o.width),s=t?e>1?t*e:t:o.height}this._merge(this.transformPt([-n/2,-s/2]),0),this._merge(this.transformPt([-n/2,s/2]),0),this._merge(this.transformPt([n/2,-s/2]),0),this._merge(this.transformPt([n/2,s/2]),0)}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new S);const i=D(e);let[r,n]=this._textRasterizer.computeTextSize(t,i);r=a.px2pt(r),n=a.px2pt(n);const s=this.transformSize(1)*this.reverseTransformScalar(1);r*=s,n*=s;let o=0;switch(e.horizontalAlignment){case"Left":o=r/2;break;case"Right":o=-r/2}let l=0;switch(e.verticalAlignment){case"Bottom":l=n/2;break;case"Top":l=-n/2;break;case"Baseline":l=n/6}this._merge(this.transformPt([-r/2+o,-n/2+l]),0),this._merge(this.transformPt([-r/2+o,n/2+l]),0),this._merge(this.transformPt([r/2+o,-n/2+l]),0),this._merge(this.transformPt([r/2+o,n/2+l]),0)}_processPath(e,t){if(e)for(const i of e){const e=i?i.length:0;if(e>1){this._merge(this.transformPt(i[0]),t);for(let r=1;r<e;r++)this._merge(this.transformPt(i[r]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}},e.HittestDrawHelper=class extends A{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=T.destroyHiddenSvg(this._svg),this._path=null,this._canvas=null}hitTest(e,t,r,n,s,o){const l=o*a.pt2px(1);this.setTransform(),this.setGeomUnitsPerPoint(l),this._searchPoint=[(e[0]+e[2])/2,(e[1]+e[3])/2],this._searchDistPoint=(e[2]-e[0])/2/l,this._textInfo=n;const c=t&&("CIMPointSymbol"===t.type&&"Map"!==t.angleAlignment||"CIMTextSymbol"===t.type);if(this._mapRotation=c?s:0,!i("esri-mobile")){const e=a.px2pt(M.hittestToleranceSmallSymbol*window.devicePixelRatio),i=a.px2pt(M.hittestSmallSymbolThreshold);("CIMLineSymbol"!==t?.type&&"CIMPolygonSymbol"!==t?.type||!t.symbolLayers?.some(w.isCIMFill))&&"CIMMeshSymbol"!==t?.type&&(w.getSize(t)??0)<i&&(this._searchDistPoint=e)}return this._earlyReturn=!1,this.drawSymbol(t,r),this._earlyReturn}executeEffects(e,t){return"CIMGeometricEffectDashes"===e.at(-1)?.type&&(e=e.slice(0,-1)),super.executeEffects(e,t)}drawSolidFill(e,t,i){null!=i?this._hittestSvgPath(e,i,!0):this._hitTestFill(e)}drawHatchFill(e,t){this._hitTestFill(e)}drawPictureFill(e,t){this._hitTestFill(e)}drawGradientFill(e,t){this._hitTestFill(e)}drawSolidStroke(e,t,i,r,n,s,o){null!=o?this._hittestSvgPath(e,o,!1,i):this._hitTestStroke(e,i)}drawPictureStroke(e,t){this._hitTestStroke(e,t.width)}drawGradientStroke(e,t){this._hitTestStroke(e,t.width)}drawMarkerLayer(e,t){e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._hitTestFill(t):super.drawMarkerLayer(e,t)}pushClipPath(e){}popClipPath(){}drawImage(e,t){const{url:i}=e,r=w.getNumericValue(e.scaleX,1),n=this._resourceManager.getResource(i);if(null==n||0===n.height||0===t)return;const s=t*this.geomUnitsPerPoint(),o=s*r*(n.width/n.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<s/2+l&&(this._earlyReturn=!0)}drawText(e,t){const i=this._textInfo;if(!i)return;const r=i.get(e);if(!r)return;if(!r.glyphMosaicItems.glyphs.length)return;const n=I.roundPtToWholePixel(w.getNumericValue(e.height,_.defaultCIMValues.CIMTextSymbol.height)),{lineGapType:s,lineGap:o}=e,a=s?V(s,w.getNumericValue(o),n):0,l="CIMBackgroundCallout"===e.callout?.type,c=P.shapeGlyphs(r.glyphMosaicItems,{scale:n/M.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:I.getLineWidth(e.lineWidth),lineHeight:M.magicLabelLineHeight*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),u=this.reverseTransformPt(this._searchPoint),h=u[0],d=u[1];for(const e of c.glyphs)if(h>e.xTopLeft&&h<e.xBottomRight&&d>-e.yBottomRight&&d<-e.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(e){let t=null;if(d.isExtent(e)){const i=e;t=[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]}else if(d.isPolygon(e))t=e.rings;else{if(!d.isPolyline(e))return;t=e.paths}const i=this.reverseTransformPt(this._searchPoint);(function(e,t){let i=0;for(const r of t){const t=r.length;for(let n=1;n<t;n++){const t=r[n-1],s=r[n];t[1]>e[1]!=s[1]>e[1]&&((s[0]-t[0])*(e[1]-t[1])-(s[1]-t[1])*(e[0]-t[0])>0?i++:i--)}}return 0!==i})(i,t)&&(this._earlyReturn=!0),this._earlyReturn||E(i,t,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return null!=this._svg&&null!=this._path||(this._svg??=T.createHiddenSvg(),this._path??=T.createSvgElement("path"),this._svg.appendChild(this._path)),this._path}_getCanvasContext(e,t){return this._canvas??=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t,this._canvas.getContext("2d",{willReadFrequently:!0})}_hittestSvgPath(e,t,i,r=0){const n=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),s=this.reverseTransformPt(this._searchPoint),o=c.create();u.getBoundsXY(o,e);const a=o[0],l=o[1],h=o[2]-o[0],d=o[3]-o[1],f=this._getSvgPath();f.setAttribute("d",t);const p=f.getBBox();let m=Math.max(p.width/h,p.height/d),g=1;const _=2*n*m;_<1&&(g=2/_,m*=g,p.x*=g,p.y*=g,p.width*=g,p.height*=g);const y=1+r*m/2,x=this._getCanvasContext(p.width+2*y,p.height+2*y);x.setTransform(g,0,0,g,-p.x+y,-p.y+y);const b=new Path2D(t);i?x.fill(b):(x.lineWidth=r*(m/g),x.stroke(b));const v=(h*m-p.width)/2,S=(d*m-p.height)/2,w=Math.floor((s[0]-a-n)*m-v+y),T=Math.floor((d-(s[1]-l)-n)*m+S+y),M=Math.ceil(2*n*m),P=Math.ceil(2*n*m),I=x.getImageData(w,T,M,P).data;for(let e=3;e<I.length;e+=4)if(I[e]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(e,t){let i=null;if(d.isExtent(e)){const t=e;i=[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}else if(d.isPolygon(e))i=e.rings;else{if(!d.isPolyline(e))return;i=e.paths}E(this.reverseTransformPt(this._searchPoint),i,w.getNumericValue(t,_.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}},e.Transformation=O,e.cDegToRad=C,e.lineGapType2LineHeight=V,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){"use strict";return class{applyColorSubstitution(e,t){if(!t)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:r}=e,n=this._rasterizationCanvas,s=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=i,n.height=r,s.drawImage(e,0,0,i,r));const o=s.getImageData(0,0,i,r).data;if(t)for(const e of t)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[t,i,r,n]=e.oldColor,[s,a,l,c]=e.newColor;if(t===s&&i===a&&r===l&&n===c)continue;for(let e=0;e<o.length;e+=4)t===o[e]&&i===o[e+1]&&r===o[e+2]&&n===o[e+3]&&(o[e]=s,o[e+1]=a,o[e+2]=l,o[e+3]=c)}const a=new ImageData(o,i,r);return s.putImageData(a,0,0),n}tintImageData(e,t){if(!t||t.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:i,height:r}=e,n=this._rasterizationCanvas,s=n.getContext("2d",{willReadFrequently:!0});e!==n&&(n.width=i,n.height=r,s.drawImage(e,0,0,i,r));const o=s.getImageData(0,0,i,r),a=new Uint8Array(o.data),l=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];for(let e=0;e<a.length;e+=4)a[e]*=l[0],a[e+1]*=l[1],a[e+2]*=l[2],a[e+3]*=l[3];const c=new ImageData(new Uint8ClampedArray(a.buffer),i,r);return s.putImageData(c,0,0),n}}})},"esri/symbols/cim/CIMOperators":function(){define(["exports","./effects/EffectAddControlPoints","./effects/EffectArrow","./effects/EffectBuffer","./effects/EffectControlMeasureLine","./effects/EffectCut","./effects/EffectDashes","./effects/EffectDonut","./effects/EffectEnclosingPolygon","./effects/EffectJog","./effects/EffectMove","./effects/EffectOffset","./effects/EffectRadial","./effects/EffectReverse","./effects/EffectRotate","./effects/EffectScale","./effects/EffectSuppress","./effects/EffectTaperedPolygon","./effects/EffectWave","./placements/PlacementAlongLineSameSize","./placements/PlacementAtExtremities","./placements/PlacementAtRatioPositions","./placements/PlacementInsidePolygon","./placements/PlacementOnLine","./placements/PlacementOnVertices","./placements/PlacementPolygonCenter"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_,y,x,b,v,S,w,T,M){"use strict";e.getEffectOperator=function(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return t.EffectAddControlPoints.local();case"CIMGeometricEffectArrow":return i.EffectArrow.local();case"CIMGeometricEffectBuffer":return r.EffectBuffer.local();case"CIMGeometricEffectControlMeasureLine":return n.EffectControlMeasureLine.local();case"CIMGeometricEffectCut":return s.EffectCut.local();case"CIMGeometricEffectDashes":return o.EffectDashes.local();case"CIMGeometricEffectDonut":return a.EffectDonut.local();case"CIMGeometricEffectJog":return c.EffectJog.local();case"CIMGeometricEffectMove":return u.EffectMove.local();case"CIMGeometricEffectOffset":return h.EffectOffset.local();case"CIMGeometricEffectRadial":return d.EffectRadial.local();case"CIMGeometricEffectReverse":return f.EffectReverse.local();case"CIMGeometricEffectRotate":return p.EffectRotate.local();case"CIMGeometricEffectScale":return m.EffectScale.local();case"CIMGeometricEffectSuppress":return g.EffectSuppress.local();case"CIMGeometricEffectTaperedPolygon":return _.EffectTaperedPolygon.local();case"CIMGeometricEffectWave":return y.EffectWave.local();case"CIMGeometricEffectEnclosingPolygon":return l.EffectEnclosingPolygon.local()}return null},e.getPlacementOperator=function(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return x.PlacementAlongLineSameSize.local();case"CIMMarkerPlacementAtExtremities":return b.PlacementAtExtremities.local();case"CIMMarkerPlacementAtRatioPositions":return v.PlacementAtRatioPositions.local();case"CIMMarkerPlacementInsidePolygon":return S.PlacementInsidePolygon.local();case"CIMMarkerPlacementOnLine":return w.PlacementOnLine.local();case"CIMMarkerPlacementOnVertices":return T.PlacementOnVertices.local();case"CIMMarkerPlacementPolygonCenter":return M.PlacementPolygonCenter.local()}return null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(e){"use strict";class t{static{this.instance=null}static local(){return null===t.instance&&(t.instance=new t),t.instance}execute(e,t){return new i(e,t)}}class i{constructor(e,t){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();if(!e)return null;for(;e;){if("esriGeometryPolygon"===e.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===e.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==e.geometryType){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const t=e.x,i=e.y;let r=t,n=i,s=e.pathSize,o=0,a=0,l=0,c=0,u=0,h=0;this._isClosed&&++s;for(let d=1;e.nextPoint()||d<s;++d){let f,p;this._isClosed&&d===s-1?(f=t,p=i):(f=e.x,p=e.y);const m=f-r,g=p-n,_=Math.sqrt(m*m+g*g);d>1&&_>0&&l>0&&(o*m+a*g)/_/l<=this._maxCosAngle&&e.setControlPointAt(d-1),1===d&&(c=m,u=g,h=_),_>0&&(r=f,n=p,o=m,a=g,l=_)}this._isClosed&&l>0&&h>0&&(o*c+a*u)/h/l<=this._maxCosAngle&&e.setControlPointAt(0)}}}e.EffectAddControlPoints=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectArrow":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../CurveHelper"],function(e,t,i,r,n){"use strict";const s=1.7320508075688772;class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i){return new a(e,t,i)}}class a extends r.PathEffectCursor{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new n.CurveHelper,this._width=(void 0!==t.width?t.width:5)*i,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:void 0!==t.arrowType?t.arrowType:"OpenEnded",this._offsetFlattenError=n.pixelTolerance*i}processPath(e){const i=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case"OpenEnded":default:this._constructSimpleArrow(i,e,!0);break;case"Block":this._constructSimpleArrow(i,e,!1);break;case"Crossed":this._constructCrossedArrow(i,e)}return i}_constructSimpleArrow(e,t,r){const n=t.pathLength();let s=this._width;n<2*s&&(s=n/2);const o=this._curveHelper.getSubCurve(t,0,n-s);if(!o||!o.nextPath())return;o.seekPathStart();const a=s/2;if(this._curveHelper.isEmpty(o))return;const l=i.collectPath(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const d=this._constructArrowBasePoint(u,a/2);if(!d)return;t.seekInPath(t.pathSize-1);const f=[t.x,t.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoint(f),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),r||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,t){const r=t.pathLength();let n=this._width;r<n*(1+s+1)&&(n=r/(1+s+1)),t.seekPathStart();const o=this._curveHelper.getSubCurve(t,0,r-n*(1+s));if(!o)return;o.nextPath();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=i.collectPath(o),c=this._constructOffset(l,a);if(!c)return;const u=this._constructOffset(l,-a);if(!u)return;const h=this._curveHelper.getSubCurve(t,0,r-n);if(!h)return;if(h.nextPath(),this._curveHelper.isEmpty(h))return;const d=i.collectPath(h),f=this._constructOffset(d,a);if(!f)return;const p=this._constructOffset(d,-a);if(!p)return;const m=f[f.length-1],g=this._constructArrowBasePoint(f,a/2);if(!g)return;const _=p[p.length-1],y=this._constructArrowBasePoint(p,-a/2);if(!y)return;t.seekInPath(t.pathSize-1);const x=[t.x,t.y];e.pushPath(c),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(x),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoints(u.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,t){return this._curveHelper.offset(e,t,"Rounded",4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;const i=e[e.length-2],r=e[e.length-1],n=[r[0]-i[0],r[1]-i[1]];return this._curveHelper.normalize(n),[r[0]+n[1]*t,r[1]-n[0]*t]}}e.EffectArrow=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(e,t){"use strict";e.PathEffectCursor=class{constructor(e,t,i,r=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=i,this.geomUnitsPerPoint=r,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===e.geometryType||"esriGeometryEnvelope"===e.geometryType,this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}},e.PathTransformationCursor=class{constructor(e,i=!0,r=!0,n=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!i&&"esriGeometryPolygon"===e.geometryType||!r&&"esriGeometryPolyline"===e.geometryType?null:e,this.geomUnitsPerPoint=n,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new t.Placement}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const t=this.processPath(e);if(t)return t}return this.iterateMultiPath=!1,null}},e.setId=function(e,t){e[4]=t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor"],function(e,t){"use strict";e.CurveHelper=class{constructor(e=0,t=!1){}isEmpty(e){if(!e.nextPoint())return!0;let t,i,r,n;for(t=e.x,i=e.y;e.nextPoint();t=i,i=n)if(r=e.x,n=e.y,r!==t||n!==i)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);0!==t&&(e[0]/=t,e[1]/=t)}getLength(e,t,i,r){const n=i-e,s=r-t;return Math.sqrt(n*n+s*s)}getSegLength(e){const[[t,i],[r,n]]=e;return this.getLength(t,i,r,n)}getCoord2D(e,t,i,r,n){return[e+(i-e)*n,t+(r-t)*n]}getSegCoord2D(e,t){const[[i,r],[n,s]]=e;return this.getCoord2D(i,r,n,s,t)}getAngle(e,t,i,r,n){const s=i-e,o=r-t;return Math.atan2(o,s)}getAngleCS(e,t,i,r,n,s){null==e&&(e=[0,0]);const o=r-t,a=n-i,l=Math.sqrt(o*o+a*a);return 0!==l?(e[0]=o/l,e[1]=a/l,e):(e[0]=1,e[1]=0,e)}getSegAngleCS(e,t,i){const[[r,n],[s,o]]=t;return this.getAngleCS(e,r,n,s,o,i)}cut(e,t,i,r,n,s){return[n<=0?[e,t]:this.getCoord2D(e,t,i,r,n),s>=1?[i,r]:this.getCoord2D(e,t,i,r,s)]}getSubCurve(e,i,r){const n=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(n,e,i,r)?n:null}appendSubCurve(e,t,i,r){e.startPath(),t.seekPathStart();let n=0,s=!0;if(!t.nextPoint())return!1;let o=t.x,a=t.y;for(;t.nextPoint();){const l=this.getLength(o,a,t.x,t.y);if(0!==l){if(s){if(n+l>i){const c=(i-n)/l;let u=1,h=!1;n+l>=r&&(u=(r-n)/l,h=!0);const d=this.cut(o,a,t.x,t.y,c,u);if(d&&e.pushPoints(d),h)break;s=!1}}else{if(n+l>r){const i=this.cut(o,a,t.x,t.y,0,(r-n)/l);i&&e.pushPoint(i[1]);break}e.pushXY(t.x,t.y)}n+=l,o=t.x,a=t.y}else o=t.x,a=t.y}return!0}getCIMPointAlong(e,t){if(!e.nextPoint())return null;let i,r,n,s,o=0;for(i=e.x,r=e.y;e.nextPoint();i=n,r=s){n=e.x,s=e.y;const a=this.getLength(i,r,n,s);if(0!==a){if(o+a>t){const e=(t-o)/a;return this.getCoord2D(i,r,n,s,e)}o+=a}}return null}offset(e,t,i,r,n){if(!e||e.length<2)return null;let s=0,o=e[s++],a=s;for(;s<e.length;){const t=e[s];t[0]===o[0]&&t[1]===o[1]||(s!==a&&(e[a]=e[s]),o=e[a++]),s++}const l=e[0][0]===e[a-1][0]&&e[0][1]===e[a-1][1];if(l&&--a,a<(l?3:2))return null;const c=[];o=l?e[a-1]:null;let u=e[0];for(let n=0;n<a;n++){const s=n===a-1?l?e[0]:null:e[n+1];if(o)if(s){const e=[s[0]-u[0],s[1]-u[1]];this.normalize(e);const n=[u[0]-o[0],u[1]-o[1]];this.normalize(n);const a=n[0]*e[1]-n[1]*e[0],l=n[0]*e[0]+n[1]*e[1];if(0===a&&1===l){u=s;continue}if(a>=0==t<=0){if(l<1){const i=[e[0]-n[0],e[1]-n[1]];this.normalize(i);const s=Math.sqrt((1+l)/2);if(s>1/r){const e=-Math.abs(t)/s;c.push([u[0]-i[0]*e,u[1]-i[1]*e])}}}else switch(i){case"Mitered":{const i=Math.sqrt((1+l)/2);if(i>0&&1/i<r){const r=[e[0]-n[0],e[1]-n[1]];this.normalize(r);const s=Math.abs(t)/i;c.push([u[0]-r[0]*s,u[1]-r[1]*s]);break}}case"Bevelled":c.push([u[0]+n[1]*t,u[1]-n[0]*t]),c.push([u[0]+e[1]*t,u[1]-e[0]*t]);break;case"Rounded":if(l<1){c.push([u[0]+n[1]*t,u[1]-n[0]*t]);const i=Math.floor(2.5*(1-l));if(i>0){const r=1/i;let s=r;for(let o=1;o<i;o++,s+=r){const i=[n[1]*(1-s)+e[1]*s,-n[0]*(1-s)-e[0]*s];this.normalize(i),c.push([u[0]+i[0]*t,u[1]+i[1]*t])}}c.push([u[0]+e[1]*t,u[1]-e[0]*t])}break;default:if(a<0)c.push([u[0]+(n[1]+n[0])*t,u[1]+(n[1]-n[0])*t]),c.push([u[0]+(e[1]-e[0])*t,u[1]-(e[0]+e[1])*t]);else{const i=Math.sqrt((1+Math.abs(l))/2),r=[e[0]-n[0],e[1]-n[1]];this.normalize(r);const s=t/i;c.push([u[0]-r[0]*s,u[1]-r[1]*s])}}}else{const e=[u[0]-o[0],u[1]-o[1]];this.normalize(e),c.push([u[0]+e[1]*t,u[1]-e[0]*t])}else{const e=[s[0]-u[0],s[1]-u[1]];this.normalize(e),c.push([u[0]+e[1]*t,u[1]-e[0]*t])}o=u,u=s}return c.length<(l?3:2)?null:(l&&c.push([c[0][0],c[0][1]]),c)}},e.pixelTolerance=.03,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/SpatialReference","../CIMEffects","../CurveHelper"],function(e,t,i,r,n,s){"use strict";class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i,r,n,s){return new a(e,t,i,r,n,s)}}class a{constructor(e,t,i,r,n,o){this._preventClipping=o,this._inputGeometries=e,this._tileKey=r,this._curveHelper=new s.CurveHelper,this._size=(void 0!==t.size?t.size:1)*i,this._maxInflateSize=n*i,this._offsetFlattenError=s.pixelTolerance*i}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===e.geometryType)if(this._size>0){const r=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType),n=i.collectMultipath(e)[0],s=this._curveHelper.offset(n,this._size,"Rounded",4,this._offsetFlattenError);if(s)return r.pushPath(s),r}else if(this._size<0){const i=e.asJSON();if(Math.min(i.xmax-i.xmin,i.ymax-i.ymin)+2*this._size>0)return t.GeometryCursor.fromJSONCIM({xmin:i.xmin-this._size,xmax:i.xmax+this._size,ymin:i.ymin-this._size,ymax:i.ymax+this._size})}const s=!this._preventClipping&&this._tileKey?n.clipCursorToTileExtent(e,this._maxInflateSize,!0):e;if(!s)continue;const o=n.lazyBufferOperator.module,a={...s.asJSON(),spatialReference:{wkid:r.WebMercator.wkid}},l=o.execute(a,this._size);return l?t.GeometryCursor.fromJSONCIM(l):null}return null}}e.EffectBuffer=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/support/coordsUtils","../CIMCursor"],function(e,t,i,r,n){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,i){return new o(e,t,i)}}class o{constructor(e,t,i){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=i,this._rule=t.rule??"FullGeometry",this._defaultSize=this._defaultPointSize*i}next(){let e;for(;e=this._inputGeometries.next();){const r=this._processGeom(i.collectMultipath(e));if(r?.length)return t.GeometryCursor.fromJSONCIM({paths:r})}return null}_clone(e){return[e[0],e[1]]}_mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}_mix(e,t,i,r){return[e[0]*t+i[0]*r,e[1]*t+i[1]*r]}_add(e,t){return[e[0]+t[0],e[1]+t[1]]}_add2(e,t,i){return[e[0]+t,e[1]+i]}_sub(e,t){return[e[0]-t[0],e[1]-t[1]]}_dist(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,t=1){const i=t/this._norm(e);e[0]*=i,e[1]*=i}_leftPerpendicular(e){const t=-e[1],i=e[0];e[0]=t,e[1]=i}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const t=e[1],i=-e[0];e[0]=t,e[1]=i}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,t){return e[0]*t[0]+e[1]*t[1]}_crossProduct(e,t){return e[0]*t[1]-e[1]*t[0]}_rotateDirect(e,t,i){const r=e[0]*t-e[1]*i,n=e[0]*i+e[1]*t;e[0]=r,e[1]=n}_makeCtrlPt(e){const t=[e[0],e[1]];return n.setId(t,1),t}_addAngledTicks(e,t,i,r){const n=this._sub(i,t);this._normalize(n);const s=this._crossProduct(n,this._sub(r,t));let o;o=s>0?this._rightPerp(n):this._leftPerp(n);const a=Math.abs(s)/2,l=[];l.push([t[0]+(o[0]-n[0])*a,t[1]+(o[1]-n[1])*a]),l.push(t),l.push(i),l.push([i[0]+(o[0]+n[0])*a,i[1]+(o[1]+n[1])*a]),e.push(l)}_addBezier2(e,t,i,r,n){if(0===n--)return void e.push(r);const s=this._mid(t,i),o=this._mid(i,r),a=this._mid(s,o);this._addBezier2(e,t,s,a,n),this._addBezier2(e,a,o,r,n)}_addBezier3(e,t,i,r,n,s){if(0===s--)return void e.push(n);const o=this._mid(t,i),a=this._mid(i,r),l=this._mid(r,n),c=this._mid(o,a),u=this._mid(a,l),h=this._mid(c,u);this._addBezier3(e,t,o,c,h,s),this._addBezier3(e,h,u,l,n,s)}_add90DegArc(e,t,i,r,n){const s=n??this._crossProduct(this._sub(i,t),this._sub(r,t))>0,o=this._mid(t,i),a=this._sub(o,t);s?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(e,t,this._mix(t,.33333,o,.66667),this._mix(i,.33333,o,.66667),i,4)}_addArrow(e,t,i){const r=t[0],n=t[1],s=t[t.length-1],o=this._sub(r,n),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(s,n)));let c=this._dotProduct(o,this._sub(s,n));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=.5*l,h=this._leftPerp(o),d=[n[0]+o[0]*c,n[1]+o[1]*c],f=t.length-1,p=[];p.push(i?[-h[0],-h[1]]:h);let m=[-o[0],-o[1]];for(let e=1;e<f-1;e++){const i=this._sub(t[e+1],t[e]);this._normalize(i);const r=this._dotProduct(i,m),n=this._crossProduct(i,m),s=Math.sqrt((1+r)/2),o=this._sub(i,m);this._normalize(o),o[0]/=s,o[1]/=s,p.push(n<0?[-o[0],-o[1]]:o),m=i}p.push(this._rightPerp(m));for(let i=p.length-1;i>0;i--)e.push([t[i][0]+p[i][0]*u,t[i][1]+p[i][1]*u]);e.push([d[0]+p[0][0]*u,d[1]+p[0][1]*u]),e.push([d[0]+p[0][0]*l,d[1]+p[0][1]*l]),e.push(r),e.push([d[0]-p[0][0]*l,d[1]-p[0][1]*l]),e.push([d[0]-p[0][0]*u,d[1]-p[0][1]*u]);for(let i=1;i<p.length;i++)e.push([t[i][0]-p[i][0]*u,t[i][1]-p[i][1]*u])}_addDash(e,t,i){const r=this._norm(i)/7;this._normalize(i);let n=[];for(let s=0;s<=7;s++)n.push([t[0]+i[0]*s*r,t[1]+i[1]*s*r]),1&s&&(e.push(n),n=[])}_cp2(e,t,i){return e.length>=2?e[1]:this._add2(e[0],t*this._defaultSize,i*this._defaultSize)}_cp3(e,t,i,r){if(e.length>=3)return e[2];const n=this._mix(e[0],1-i,t,i),s=this._sub(t,e[0]);return this._normalize(s),this._rightPerpendicular(s),[n[0]+s[0]*r*this._defaultSize,n[1]+s[1]*r*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const t=e[0],i=this._cp2(e,-4,0),r=this._sub(t,i);this._normalize(r);const n=this._rightPerp(r);return[t,i,[t[0]+(n[0]-r[0])*this._defaultSize,t[1]+(n[1]-r[1])*this._defaultSize]]}_arrowLastSeg(e){const t=e[0],i=this._cp2(e,-4,0);let r;if(e.length>=3)r=e[e.length-1];else{const e=this._sub(t,i);this._normalize(e);const n=this._rightPerp(e);r=[t[0]+(n[0]-e[0])*this._defaultSize,t[1]+(n[1]-e[1])*this._defaultSize]}return[i,r]}_processGeom(e){if(!e)return null;const t=[];for(const i of e){const e=i.length>1&&r.getPathLength(i)<this._defaultSize;if(!i||0===i.length||e)continue;const s=i.length;let o=i[0];switch(this._rule){case"PerpendicularFromFirstSegment":{const e=this._cp2(i,0,-1),r=this._cp3(i,e,.5,4),n=[];n.push(r),n.push(this._mid(o,e)),t.push(n);break}case"ReversedFirstSegment":{const e=this._cp2(i,0,-1);t.push([e,o]);break}case"PerpendicularToSecondSegment":{if(i.length<3)return[];const e=this._cp2(i,-4,1),r=this._cp3(i,e,.882353,-1.94),n=[];n.push(this._mid(e,r)),n.push(o),t.push(n);break}case"SecondSegmentWithTicks":{if(i.length<3)return[];const e=this._cp2(i,-4,1),r=this._cp3(i,e,.882353,-1.94),n=this._sub(r,e);let s;s=this._crossProduct(n,this._sub(o,e))>0?this._rightPerp(n):this._leftPerp(n);const a=[];a.push([e[0]+(s[0]-n[0])/3,e[1]+(s[1]-n[1])/3]),a.push(e),a.push(r),a.push([r[0]+(s[0]+n[0])/3,r[1]+(s[1]+n[1])/3]),t.push(a);break}case"DoublePerpendicular":{const e=this._cp2(i,0,-1),r=this._cp3(i,e,.5,3),n=this._mid(o,e),s=this._sub(n,r);this._normalize(s);const a=this._crossProduct(s,this._sub(o,r));this._leftPerpendicular(s);const l=[];l.push(o),l.push([r[0]+s[0]*a,r[1]+s[1]*a]),t.push(l);const c=[];c.push([r[0]-s[0]*a,r[1]-s[1]*a]),c.push(e),t.push(c);break}case"OppositeToFirstSegment":{const e=this._cp2(i,0,-1),r=this._cp3(i,e,.5,3),n=this._mid(o,e),s=this._sub(n,r);this._normalize(s);const a=this._crossProduct(s,this._sub(o,r));this._leftPerpendicular(s);const l=[];l.push([r[0]+s[0]*a,r[1]+s[1]*a]),l.push([r[0]-s[0]*a,r[1]-s[1]*a]),t.push(l);break}case"TriplePerpendicular":{const e=this._cp2(i,0,-1),r=this._cp3(i,e,.5,4),n=this._mid(o,e),s=this._sub(n,r);this._normalize(s);const a=this._crossProduct(s,this._sub(o,r));this._leftPerpendicular(s);const l=[];l.push([r[0]+s[0]*a*.8,r[1]+s[1]*a*.8]),l.push([n[0]+.8*(o[0]-n[0]),n[1]+.8*(o[1]-n[1])]),t.push(l),t.push([r,n]);const c=[];c.push([r[0]-s[0]*a*.8,r[1]-s[1]*a*.8]),c.push([n[0]+.8*(e[0]-n[0]),n[1]+.8*(e[1]-n[1])]),t.push(c);break}case"HalfCircleFirstSegment":{const e=this._cp2(i,0,-1),r=this._cp3(i,e,.5,4),n=this._mid(o,e);let s=this._sub(e,o);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),c=Math.sqrt((1+a)/2),u=Math.sqrt((1-a)/2),h=[];let d;this._crossProduct(s,this._sub(r,o))>0?(h.push(o),s=this._sub(o,n),d=e):(h.push(e),s=this._sub(e,n),d=o),this._rotateDirect(s,c,u),s[0]/=c,s[1]/=c;for(let e=1;e<=18;e++)h.push(this._add(n,s)),this._rotateDirect(s,a,l);h.push(d),t.push(h);break}case"HalfCircleSecondSegment":{const e=this._cp2(i,0,-1),r=this._cp3(i,e,1,-1);let n=this._sub(o,e);this._normalize(n);const s=this._crossProduct(n,this._sub(r,e))/2;this._leftPerpendicular(n);const a=[e[0]+n[0]*s,e[1]+n[1]*s];n=this._sub(e,a);const l=Math.cos(Math.PI/18);let c=Math.sin(Math.PI/18);s>0&&(c=-c);const u=[e];for(let e=1;e<=18;e++)this._rotateDirect(n,l,c),u.push(this._add(a,n));t.push(u);break}case"HalfCircleExtended":{const e=this._cp2(i,0,-2),r=this._cp3(i,e,1,-1);let n;if(s>=4)n=i[3];else{const t=this._sub(o,e);n=this._add(r,t)}const a=this._dist(e,r)/2/.75,l=this._sub(e,o);this._normalize(l,a);const c=this._sub(r,n);this._normalize(c,a);const u=[n,r];t.push(u);const h=[this._clone(r)];this._addBezier3(h,r,this._add(r,c),this._add(e,l),e,4),h.push(o),t.push(h);break}case"OpenCircle":{const e=this._cp2(i,-2,0),r=this._sub(e,o),n=Math.cos(Math.PI/18),s=-Math.sin(Math.PI/18),a=[e];for(let e=1;e<=33;e++)this._rotateDirect(r,n,s),a.push(this._add(o,r));t.push(a);break}case"CoverageEdgesWithTicks":{const e=this._cp2(i,0,-1);let r,n;if(s>=3)r=i[2];else{const t=this._sub(e,o),i=this._leftPerp(t);r=[o[0]+i[0]-.25*t[0],o[1]+i[1]-.25*t[1]]}if(s>=4)n=i[3];else{const t=this._mid(o,e),i=this._sub(o,e);this._normalize(i),this._leftPerpendicular(i);const s=this._crossProduct(i,this._sub(r,t));this._rightPerpendicular(i),n=[r[0]+i[0]*s*2,r[1]+i[1]*s*2]}const a=this._sub(e,o);let l,c;l=this._crossProduct(a,this._sub(r,o))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push(r),c.push(o),c.push([o[0]+(l[0]-a[0])/3,o[1]+(l[1]-a[1])/3]),t.push(c),l=this._crossProduct(a,this._sub(n,e))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push([e[0]+(l[0]+a[0])/3,e[1]+(l[1]+a[1])/3]),c.push(e),c.push(n),t.push(c);break}case"GapExtentWithDoubleTicks":{const e=this._cp2(i,0,2),r=this._cp3(i,e,0,1);let n;if(s>=4)n=i[3];else{const t=this._sub(e,o);n=this._add(r,t)}this._addAngledTicks(t,o,e,this._mid(r,n)),this._addAngledTicks(t,r,n,this._mid(o,e));break}case"GapExtentMidline":{const e=this._cp2(i,2,0),r=this._cp3(i,e,0,1);let n;if(s>=4)n=i[3];else{const t=this._sub(e,o);n=this._add(r,t)}const a=[];a.push(this._mid(o,r)),a.push(this._mid(e,n)),t.push(a);break}case"Chevron":{const e=this._cp2(i,-1,-1);let r;if(s>=3)r=i[2];else{const t=this._sub(e,o);this._leftPerpendicular(t),r=this._add(o,t)}t.push([e,this._makeCtrlPt(o),r]);break}case"PerpendicularWithArc":{const e=this._cp2(i,0,-2),r=this._cp3(i,e,.5,-1),n=this._sub(e,o),a=this._norm(n);n[0]/=a,n[1]/=a;const l=this._crossProduct(n,this._sub(r,o));let c=this._dotProduct(n,this._sub(r,o));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=[o[0]+n[0]*c,o[1]+n[1]*c];let h=this._leftPerp(n),d=[];if(d.push([u[0]-h[0]*l,u[1]-h[1]*l]),d.push([u[0]+h[0]*l,u[1]+h[1]*l]),t.push(d),s>=4){const e=i[3];let r=this._dotProduct(n,this._sub(e,o));r<.1*a?r=.1*a:r>.9*a&&(r=.9*a);const s=[o[0]+n[0]*r,o[1]+n[1]*r],l=this._crossProduct(n,this._sub(e,o)),c=[];c.push([s[0]-h[0]*l,s[1]-h[1]*l]),c.push([s[0]+h[0]*l,s[1]+h[1]*l]),t.push(c)}const f=[e[0]+h[0]*l,e[1]+h[1]*l];h=this._sub(e,f);const p=Math.cos(Math.PI/18);let m=Math.sin(Math.PI/18);l<0&&(m=-m),d=[o,e];for(let e=1;e<=9;e++)this._rotateDirect(h,p,m),d.push(this._add(f,h));t.push(d);break}case"ClosedHalfCircle":{const e=this._cp2(i,2,0),r=this._mid(o,e),n=this._sub(e,r),s=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[o,e];for(let e=1;e<=18;e++)this._rotateDirect(n,s,a),l.push(this._add(r,n));t.push(l);break}case"TripleParallelExtended":{const e=this._cp2(i,0,-2),r=this._cp3(i,e,1,-2),s=this._mid(o,e),a=this._sub(r,e);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(s,e)))/2,c=this._dist(e,r),u=[e,o];u.push([o[0]+a[0]*c*.5,o[1]+a[1]*c*.5]),t.push(u);const h=[];h.push([s[0]-a[0]*l,s[1]-a[1]*l]),h.push([s[0]+a[0]*c*.375,s[1]+a[1]*c*.375]),n.setId(h[h.length-1],1),h.push([s[0]+a[0]*c*.75,s[1]+a[1]*c*.75]),t.push(h);const d=[e,r];t.push(d);break}case"ParallelWithTicks":{const e=this._cp2(i,3,0),r=this._cp3(i,e,.5,-1),n=this._sub(r,e);this._normalize(n);const s=this._crossProduct(n,this._sub(r,o));this._leftPerpendicular(n),this._addAngledTicks(t,o,e,r),this._addAngledTicks(t,this._mix(o,1,n,s),this._mix(e,1,n,s),this._mid(o,e));break}case"Parallel":{const e=this._cp2(i,3,0),r=this._cp3(i,e,.5,-1),n=this._sub(e,o);this._normalize(n);const s=this._leftPerp(n),a=this._crossProduct(n,this._sub(r,o));let l=[o,e];t.push(l),l=[],l.push([o[0]+s[0]*a,o[1]+s[1]*a]),l.push([e[0]+s[0]*a,e[1]+s[1]*a]),t.push(l);break}case"PerpendicularToFirstSegment":{const e=this._cp2(i,3,0),r=this._cp3(i,e,.5,-1),n=this._mid(o,e),s=this._sub(e,o);this._normalize(s);const a=this._crossProduct(s,this._sub(r,o));this._leftPerpendicular(s);const l=[];l.push([n[0]-s[0]*a*.25,n[1]-s[1]*a*.25]),l.push([n[0]+s[0]*a*1.25,n[1]+s[1]*a*1.25]),t.push(l);break}case"ParallelOffset":{const e=this._cp2(i,3,0),r=this._cp3(i,e,.5,-1),n=this._sub(e,o);this._normalize(n);const s=this._crossProduct(n,this._sub(r,o));this._leftPerpendicular(n);const a=[];a.push([o[0]-n[0]*s,o[1]-n[1]*s]),a.push([e[0]-n[0]*s,e[1]-n[1]*s]),t.push(a);const l=[];l.push([o[0]+n[0]*s,o[1]+n[1]*s]),l.push([e[0]+n[0]*s,e[1]+n[1]*s]),t.push(l);break}case"OffsetOpposite":{const e=this._cp2(i,3,0),r=this._cp3(i,e,.5,-1),n=this._sub(e,o);this._normalize(n);const s=this._crossProduct(n,this._sub(r,o));this._leftPerpendicular(n);const a=[];a.push([o[0]-n[0]*s,o[1]-n[1]*s]),a.push([e[0]-n[0]*s,e[1]-n[1]*s]),t.push(a);break}case"OffsetSame":{const e=this._cp2(i,3,0),r=this._cp3(i,e,.5,-1),n=this._sub(e,o);this._normalize(n);const s=this._crossProduct(n,this._sub(r,o));this._leftPerpendicular(n);const a=[];a.push([o[0]+n[0]*s,o[1]+n[1]*s]),a.push([e[0]+n[0]*s,e[1]+n[1]*s]),t.push(a);break}case"CircleWithArc":{let e=this._cp2(i,3,0);const r=this._cp3(i,e,.5,-1);let a,l;if(s>=4)a=i[3],l=this._crossProduct(this._sub(a,e),this._sub(r,e))>0;else{a=e,l=this._crossProduct(this._sub(a,o),this._sub(r,o))>0;const t=24*this._geomUnitsPerPoint,i=this._sub(a,o);this._normalize(i,t);const n=Math.sqrt(2)/2;this._rotateDirect(i,n,l?n:-n),e=this._add(o,i)}const c=this._sub(e,o),u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),d=[e];for(let e=1;e<=36;e++)this._rotateDirect(c,u,h),d.push(this._add(o,c));this._add90DegArc(d,e,a,r,l),n.setId(d[d.length-8],1),t.push(d);break}case"DoubleJog":{let e,r=this._cp2(i,-3,1),n=this._cp3(i,r,-1,-.5);if(s>=4)e=i[3];else{const t=o;o=r,e=n;const i=this._dist(o,t),s=this._dist(e,t);let a=30*this._geomUnitsPerPoint;.5*i<a&&(a=.5*i),.5*s<a&&(a=.5*s),r=this._mix(o,a/i,t,(i-a)/i),n=this._mix(e,a/s,t,(s-a)/s)}const a=this._mid(o,r),l=this._mid(e,n),c=this._dist(o,r),u=this._dist(n,e);let h=Math.min(c,u)/8;h=Math.min(h,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let f=this._sub(o,r);this._normalize(f,h),this._crossProduct(f,this._sub(e,r))>0?this._rotateDirect(f,d,-d):this._rotateDirect(f,d,d);let p=[];p.push(r),p.push(this._add(a,f)),p.push(this._sub(a,f)),p.push(o),t.push(p),f=this._sub(e,n),this._normalize(f,h),this._crossProduct(f,this._sub(o,n))<0?this._rotateDirect(f,d,d):this._rotateDirect(f,d,-d),p=[],p.push(n),p.push(this._add(l,f)),p.push(this._sub(l,f)),p.push(e),t.push(p);break}case"PerpendicularOffset":{const e=this._cp2(i,-4,1),r=this._cp3(i,e,.882353,-1.94),n=this._sub(r,e);this._crossProduct(n,this._sub(o,e))>0?this._rightPerpendicular(n):this._leftPerpendicular(n);const s=[n[0]/8,n[1]/8],a=this._sub(this._mid(e,r),s);t.push([a,o]);break}case"LineExcludingLastSegment":{const e=this._arrowPath(i),r=[];let n=e.length-2;for(;n--;)r.push(e[n]);t.push(r);break}case"MultivertexArrow":{const e=this._arrowPath(i),r=[];this._addArrow(r,e,!1),t.push(r);break}case"CrossedArrow":{const e=this._arrowPath(i),r=[];this._addArrow(r,e,!0),t.push(r);break}case"ChevronArrow":{const[e,r]=this._arrowLastSeg(i),n=10*this._geomUnitsPerPoint,s=this._sub(o,e),a=this._norm(s);this._normalize(s);const l=this._crossProduct(s,this._sub(r,e));let c=this._dotProduct(s,this._sub(r,e));c<.05*a?c=.05*a:c>.95*a-n&&(c=.95*a-n);const u=[e[0]+s[0]*c,e[1]+s[1]*c],h=this._leftPerp(s),d=[];d.push([u[0]+h[0]*l+s[0]*n,u[1]+h[1]*l+s[1]*n]),d.push(o),d.push([u[0]-h[0]*l+s[0]*n,u[1]-h[1]*l+s[1]*n]),t.push(d);break}case"ChevronArrowOffset":{const[e,r]=this._arrowLastSeg(i),n=this._sub(o,e),s=this._norm(n);this._normalize(n);const a=this._crossProduct(n,this._sub(r,e));let l=this._dotProduct(n,this._sub(r,e));l<.05*s?l=.05*s:l>.95*s&&(l=.95*s);const c=[e[0]+n[0]*l,e[1]+n[1]*l];this._leftPerpendicular(n);const u=[];u.push([c[0]+n[0]*a*.5,c[1]+n[1]*a*.5]),u.push(this._mid(c,o)),u.push([c[0]-n[0]*a*.5,c[1]-n[1]*a*.5]),t.push(u);break}case"PartialFirstSegment":{const[e,r]=this._arrowLastSeg(i),n=this._sub(o,e),s=this._norm(n);this._normalize(n);let a=this._dotProduct(n,this._sub(r,e));a<.05*s?a=.05*s:a>.95*s&&(a=.95*s);const l=[e[0]+n[0]*a,e[1]+n[1]*a];t.push([e,l]);break}case"Arch":{const e=this._cp2(i,0,-1),r=this._cp3(i,e,.5,1),n=this._sub(o,e),s=this._mix(r,1,n,.55),a=this._mix(r,1,n,-.55),l=[o];this._addBezier2(l,o,s,r,4),this._addBezier2(l,r,a,e,4),t.push(l);break}case"CurvedParallelTicks":{const e=this._cp2(i,-4,1),r=this._cp3(i,e,.882353,-1.94),n=this._sub(r,e);this._crossProduct(n,this._sub(o,e))>0?this._rightPerpendicular(n):this._leftPerpendicular(n);const s=[n[0]/8,n[1]/8],a=this._sub(this._mid(e,r),s),l=this._sub(this._mix(e,.75,r,.25),s),c=this._sub(this._mix(e,.25,r,.75),s),u=[e];this._addBezier2(u,e,l,a,3),this._addBezier2(u,a,c,r,3),t.push(u);for(let e=0;e<8;e++){const i=u[2*e+1],r=[this._clone(i)];r.push(this._add(i,[n[0]/4,n[1]/4])),t.push(r)}break}case"Arc90Degrees":{const e=this._cp2(i,0,-1),r=this._cp3(i,e,.5,1),n=[e];this._add90DegArc(n,e,o,r),t.push(n);break}case"TipWithPerpendicularAndTicks":{const[e,r]=this._arrowLastSeg(i),n=10*this._geomUnitsPerPoint,s=this._sub(o,e),a=this._norm(s);this._normalize(s);let l=this._crossProduct(s,this._sub(r,e)),c=this._dotProduct(s,this._sub(r,e));c<.05*a?c=.05*a:c>.95*a-n&&(c=.95*a-n);const u=this._leftPerp(s),h=[o[0]-s[0]*n,o[1]-s[1]*n],d=.5*Math.max(a-c-n,n);l=Math.abs(l);const f=[];f.push([h[0]+u[0]*(l+d)-s[0]*d,h[1]+u[1]*(l+d)-s[1]*d]),f.push([h[0]+u[0]*l,h[1]+u[1]*l]),f.push([h[0]-u[0]*l,h[1]-u[1]*l]),f.push([h[0]-u[0]*(l+d)-s[0]*d,h[1]-u[1]*(l+d)-s[1]*d]),t.push(f),t.push([h,o]);break}case"ConcentricCircles":{const e=this._cp2(i,1,0),r=this._cp3(i,e,2,0),a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);let c=this._dist(e,o),u=[c,0],h=[];for(let e=0;e<=36;e++)h.push(this._add(o,u)),this._rotateDirect(u,a,l);if(t.push(h),s>=4){h=[];const e=i[3];c=this._dist(e,o),u=[c,0];for(let e=0;e<=36;e++)h.push(this._add(o,u)),0===e&&(h.push(this._add(o,u)),n.setId(h[1],1)),this._rotateDirect(u,a,l);t.push(h)}h=[],c=this._dist(r,o),u=[c,0];for(let e=0;e<=36;e++)h.push(this._add(o,u)),this._rotateDirect(u,a,l);t.push(h);break}case"DoubleJogArrow":{o=this._arrowPath(i)[0];const[e,r]=this._arrowLastSeg(i),n=this._sub(o,e),s=this._norm(n);this._normalize(n);const a=Math.abs(this._crossProduct(n,this._sub(r,o)));let l=Math.abs(this._dotProduct(n,this._sub(r,o)));l<.05*s?l=.05*s:l>.95*s&&(l=.95*s);const c=Math.max(a,l),u=this._leftPerp(n);let h=[];const d=[o[0]-n[0]*l*.5+u[0]*a*.5,o[1]-n[1]*l*.5+u[1]*a*.5];h.push([d[0],d[1]]),d[0]+=n[0]*c*.5+u[0]*c*.4,d[1]+=n[1]*c*.5+u[1]*c*.4,h.push([d[0],d[1]]),d[0]-=u[0]*c*.25,d[1]-=u[1]*c*.25,h.push([d[0],d[1]]),d[0]+=n[0]*c*.5+u[0]*c*.4,d[1]+=n[1]*c*.5+u[1]*c*.4,h.push([d[0],d[1]]),t.push(h),h=[],d[0]=o[0]-n[0]*l*.5-u[0]*a*.5,d[1]=o[1]-n[1]*l*.5-u[1]*a*.5,h.push([d[0],d[1]]),d[0]+=n[0]*c*.5-u[0]*c*.4,d[1]+=n[1]*c*.5-u[1]*c*.4,h.push([d[0],d[1]]),d[0]+=u[0]*c*.25,d[1]+=u[1]*c*.25,h.push([d[0],d[1]]),d[0]+=n[0]*c*.5-u[0]*c*.4,d[1]+=n[1]*c*.5-u[1]*c*.4,h.push([d[0],d[1]]),t.push(h);break}case"LinkedChevrons":{const e=this._cp2(i,-5,0),r=this._cp3(i,e,-.2,1),n=this._sub(o,e);this._normalize(n);const s=this._leftPerp(n),a=Math.abs(this._crossProduct(n,this._sub(r,e)));t.push([e,o]);const l=[];l.push([o[0]-n[0]*a+s[0]*a,o[1]-n[1]*a+s[1]*a]),l.push(o),l.push([o[0]-n[0]*a-s[0]*a,o[1]-n[1]*a-s[1]*a]),t.push(l),this._addDash(t,e,[-n[0]*a+s[0]*a,-n[1]*a+s[1]*a]),this._addDash(t,e,[-n[0]*a-s[0]*a,-n[1]*a-s[1]*a]);break}case"SegmentThenHalfCircle":{const e=this._cp2(i,2,0),r=this._cp3(i,e,1.5,0);let n;n=s>=4?i[3]:this._cp3(i,e,1.25,-.5);const a=this._sub(e,o);this._normalize(a);const l=.5*this._dist(e,r),c=this._crossProduct(a,this._sub(n,o))>0,u=Math.cos(Math.PI/18);let h=Math.sin(Math.PI/18);c&&(h=-h);const d=[o,e];a[0]*=l,a[1]*=l;const f=this._add(e,a);a[0]=-a[0],a[1]=-a[1];for(let e=1;e<=18;e++)this._rotateDirect(a,u,h),d.push(this._add(f,a));t.push(d);break}case"LineWithStraightTicks":{const e=this._cp2(i,-2,1),r=this._cp3(i,e,-1,-.5),n=this._sub(r,e);this._normalize(n);const s=this._dotProduct(n,this._sub(e,o)),a=this._dotProduct(n,this._sub(r,o));let l=[o];l.push([o[0]+n[0]*s,o[1]+n[1]*s]),l.push(e),t.push(l),l=[o],l.push([o[0]+n[0]*a,o[1]+n[1]*a]),l.push(r),t.push(l);break}case"DoubleCurve":{const e=this._cp2(i,-5,-1),r=this._cp3(i,e,2,0),s=Math.atan2(1,5),a=Math.cos(s),l=Math.sin(s),c=this._sub(e,o),u=this._dist(o,e);this._normalize(c),this._rotateDirect(c,a,-l);const h=[o];h.push([o[0]+c[0]*u*.5,o[1]+c[1]*u*.5]),n.setId(h[1],1),h.push([o[0]+c[0]*u*.8,o[1]+c[1]*u*.8]),this._addBezier2(h,h[2],[o[0]+c[0]*u,o[1]+c[1]*u],e,3);const d=this._sub(r,e),f=this._dist(e,r);this._normalize(d),this._rotateDirect(d,a,-l),this._addBezier2(h,e,[r[0]-d[0]*f,r[1]-d[1]*f],[r[0]-d[0]*f*.8,r[1]-d[1]*f*.8],3),h.push(r),t.push(h);break}case"ParallelWithTicksByWidth":{const e=this._cp2(i,0,-1),r=this._cp3(i,e,.5,3),n=this._sub(e,o);this._normalize(n);const s=this._crossProduct(n,this._sub(r,o));this._leftPerpendicular(n),s>0?(this._addAngledTicks(t,o,[o[0]+n[0]*s,o[1]+n[1]*s],e),this._addAngledTicks(t,e,[e[0]+n[0]*s,e[1]+n[1]*s],o)):(this._addAngledTicks(t,[o[0]+n[0]*s,o[1]+n[1]*s],o,e),this._addAngledTicks(t,[e[0]+n[0]*s,e[1]+n[1]*s],o,e));break}case"EnclosingRoundedRectangle":{const e=this._cp2(i,3,-2),t=[Math.min(o[0],e[0]),Math.max(o[1],e[1])],r=[Math.max(o[0],e[0]),Math.min(o[1],e[1])],n=r[0]-t[0],s=t[1]-r[1],a=Math.min(n,s)/10,l=[];l.push([t[0]+a+.75*(n-2*a),t[1]]),l.push([r[0]-a,t[1]]),this._add90DegArc(l,[r[0]-a,t[1]],[r[0],t[1]-a],[r[0],t[1]]),l.push([r[0],r[1]+a]),this._add90DegArc(l,[r[0],r[1]+a],[r[0]-a,r[1]],r),l.push([t[0]+a,r[1]]),this._add90DegArc(l,[t[0]+a,r[1]],[t[0],r[1]+a],[t[0],r[1]]),l.push([t[0],t[1]-a]),this._add90DegArc(l,[t[0],t[1]-a],[t[0]+a,t[1]],t),l.push([t[0]+a+.75*(n-2*a),t[1]]);break}default:t.push(i)}}return t}}e.EffectControlMeasureLine=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(e,t,i,r){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,i){return new s(e,t,i)}}class s extends i.PathEffectCursor{constructor(e,t,i){super(e,!0,!0),this._curveHelper=new r.CurveHelper,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*i,this._endCut=(void 0!==t.endCut?t.endCut:1)*i,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*i,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:i,_endCut:r,_middleCut:n}=this,s=e.pathLength(),o=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==i||0!==r||0!==n)if(i+r+n>=s)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,i),this._curveHelper.appendSubCurve(o,e,.5*(s-n),.5*(s+n)),this._curveHelper.appendSubCurve(o,e,s-r,r)}else if(0===i&&0===r&&0===n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else i+r+n<s&&(0===n?this._curveHelper.appendSubCurve(o,e,i,s-r):(this._curveHelper.appendSubCurve(o,e,i,.5*(s-n)),this._curveHelper.appendSubCurve(o,e,.5*(s+n),s-r)));return 0===o.totalSize?null:o}}e.EffectCut=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../GeometryWalker","../utils"],function(e,t,i,r,n,s){"use strict";class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i){return new a(e,t,i)}}class a extends r.PathEffectCursor{constructor(e,t,i){super(e,!0,!0),this._firstCurve=null,this._walker=new n.GeometryWalker,this._walker.updateTolerance(i),this._endings=t.lineDashEnding,this._customDashPos=-(t.offsetAlongLine??0)*i,this._offsetAtEnd=(t.customEndingOffset??0)*i;let r=s.normalizeDashEffectTemplate(t).dashTemplate;null==r&&(r=[]),r.length%2&&(r=[...r,...r]),this._pattern=new n.DashPattern,this._pattern.init(r,!0),this._pattern.scale(i)}processPath(e){if(0===this._pattern.length()){this.iteratePath=!1;const r=i.collectPath(e);return t.GeometryCursor.fromJSONCIM({paths:[r]})}if(!this.iteratePath){let r=!0;switch(this._endings){case"HalfPattern":case"HalfGap":default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(r=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const n=e.pathLength();if(this._pattern.isEmpty()||n<.1*this._pattern.length()){const r=i.collectPath(e);return t.GeometryCursor.fromJSONCIM({paths:[r]})}if(!this._walker.init(e,this._pattern,r)){const r=i.collectPath(e);return t.GeometryCursor.fromJSONCIM({paths:[r]})}}let r;if(this.iteratePath)r=this._pattern.nextValue();else{let e;switch(this._endings){case"HalfPattern":default:e=.5*this._pattern.firstValue();break;case"HalfGap":e=.5*-this._pattern.lastValue();break;case"FullGap":e=-this._pattern.lastValue();break;case"FullPattern":e=0;break;case"NoConstraint":case"Custom":e=-this._customDashPos}let t=e/this._pattern.length();t-=Math.floor(t),e=t*this._pattern.length(),this._pattern.reset(),r=this._pattern.nextValue();let i=!1;for(;e>=r;)e-=r,r=this._pattern.nextValue(),i=!i;r-=e,i?(this._walker.nextPosition(r),r=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(r),r=this._pattern.nextValue(),this._walker.nextPosition(r),r=this._pattern.nextValue())}let n=this._walker.nextCurve(r);if(n)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)n.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else r=this._pattern.nextValue(),!this._walker.nextPosition(r)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(n.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,n=this._firstCurve,this._firstCurve=null;return n?.reset(),n}}e.EffectDashes=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor","./CurveHelper"],function(e,t,i){"use strict";class r{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class n extends i.CurveHelper{constructor(e=0,t=!1){super(e,t),this._tempPos=new r,this._tempPt=[0,0],this._tolerance=i.pixelTolerance,this._currentPosition=new r}updateTolerance(e){this._tolerance=i.pixelTolerance*e}init(e,t,i=!0){return i?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=0){const i=new r;return!!this._nextPosition(e,i,null,t)&&(i.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[t,i]=this._getAngleCS(this._tempPt,this._currentPosition);e.ca=t,e.sa=i}nextPointAndAngle(e,t,i=0){const r=this._tempPos;if(!this._nextPosition(e,r,null,i))return!1;r.copyTo(this._currentPosition),t.pt=this._getPoint(r);const[n,s]=this._getAngleCS(this._tempPt,r);return t.ca=n,t.sa=s,!0}nextCurve(e){if(0===e)return null;const i=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");i.startPath(),i.nextPath();const n=new r;return this._nextPosition(e,n,i,1)?(n.copyTo(this._currentPosition),i):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,t,i,r){if(this._currentPosition.isPathEnd)return!1;let n=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(n/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(i){if(0===i.pathSize)if(0===n){const e=t.segment[0];i.pushXY(e[0],e[1])}else i.pushPoint(this.getSegCoord2D(t.segment,n));const e=t.segment[1];i.pushXY(e[0],e[1])}if(n=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.getSegLength(t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return 0!==r&&(t.segmentLength=this.getSegLength(t.segment),t.isPartEnd=!0,1===r?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,i){0===i.pathSize&&(0===n?i.pushPoint(t.segment[0]):i.pushPoint(this.getSegCoord2D(t.segment,n)));const e=t.abscissa/t.segmentLength;1===e?i.pushPoint(t.segment[1]):i.pushPoint(this.getSegCoord2D(t.segment,e))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,t)}_getAngleCS(e,t){const i=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(e,this._currentPosition.segment,i)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const t=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(t);let i=t+this._partSegCount+1;if(i>=this._pathCursor.pathSize&&(i=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(i),this._patternLength>0){const e=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,t=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let i=Math.round((this._partLength-(e+t))/this._patternLength);i<=0&&(i=e+t>0?0:1),this._partLengthRatio=this._partLength/(e+t+i*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}e.DashPattern=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t,i=!0){if(this._setEmpty(),!e||0===e.length)return!1;for(let t=0;t<e.length;t++){let r=Math.abs(e[t]);i&&r<1e-7&&(r=1e-7),this._values.push(r),this._length+=r}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const t=this._values?this._values.length:0;for(let i=0;i<t;++i)this._values[i]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},e.GeometryWalker=n,e.Pos=class{constructor(){this.pt=null,this.ca=0,this.sa=0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../CIMEffects"],function(e,t,i,r){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,i,r,n,o){return new s(e,t,i,r,n,o)}}class s{constructor(e,t,i,r,n,s){this._preventClipping=s,this._inputGeometries=e,this._tileKey=r,this._maxInflateSize=n*i,this._width=(void 0!==t.width?t.width:2)*i,t.method,this._option=t.option}next(){let e;for(;e=this._inputGeometries.next();){if("esriGeometryEnvelope"===e.geometryType&&this._width>0){const i=e.asJSON();return Math.min(i.xmax-i.xmin,i.ymax-i.ymin)-2*this._width<0?e:t.GeometryCursor.fromJSONCIM({paths:[[[i.xmin+this._width,i.ymin+this._width],[i.xmax-this._width,i.ymin+this._width],[i.xmax-this._width,i.ymax-this._width],[i.xmin+this._width,i.ymax-this._width],[i.xmin+this._width,i.ymin+this._width]],[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]})}if("esriGeometryPolygon"===e.geometryType){if(0===this._width)return e.clone();const t=r.lazyBufferOperator.module,n=!this._preventClipping&&this._tileKey?r.clipCursorToTileExtent(e,this._maxInflateSize,!0):e.clone();if(!n)continue;const s={...n.asJSON(),spatialReference:{wkid:i.WebMercator.wkid}},o=t.execute(s,-this._width);if(o)for(const e of o.rings)if(e){n.startPath();for(const t of e.reverse())n.pushXY(t[0],n.yFactor*t[1])}return n}}return null}}e.EffectDonut=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectEnclosingPolygon":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../../../geometry/support/boundsUtils","../CIMEffects"],function(e,t,i,r,n){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t){return new o(e,t)}}class o{constructor(e,t){this._inputGeometries=e,this._medhod=t.method}next(){let e=this._inputGeometries.next();const t=this._medhod;for(;null!=e;){if(e.totalSize>0)switch(t){case"RectangularBox":return a(e);case"ConvexHull":return this._constructConvexHull(e);default:return l(e)}e=this._inputGeometries.next()}return null}_constructConvexHull(e){switch(e.geometryType){case"esriGeometryPolyline":case"esriGeometryPolygon":{const r=n.lazyConvexHullOperator.module,s={...e.asJSON(),spatialReference:{wkid:i.WebMercator.wkid}},o=r.execute(s);return o?t.GeometryCursor.fromJSONCIM(o):null}case"esriGeometryEnvelope":return e;default:return null}}}function a(e){const i=r.getCursorBoundsXY(e),n={xmin:i[0],ymin:i[1],xmax:i[2],ymax:i[3]};return t.GeometryCursor.fromJSONCIM(n)}function l(e){switch(e.geometryType){case"esriGeometryPolyline":{const i=[];for(;e.nextPath();)c(e,i);return t.GeometryCursor.fromJSONCIM({rings:i})}case"esriGeometryPolygon":case"esriGeometryEnvelope":return e;default:return null}}function c(e,t){if(e.seekPathStart(),!e.nextPoint())return;const i=e.x,r=e.y,n=[[i,r]];for(t.push(n);e.nextPoint();)n.push([e.x,e.y]);n.push([i,r])}e.EffectEnclosingPolygon=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(e,t,i,r){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,i){return new s(e,t,i)}}class s extends i.PathEffectCursor{constructor(e,t,i){super(e,!1,!0),this._curveHelper=new r.CurveHelper,this._length=(void 0!==t.length?t.length:20)*i,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const i=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const r=e.x,n=e.y;e.seekInPath(e.pathSize-1);const s=e.x,o=e.y,a=[s-r,o-n];this._curveHelper.normalize(a);const l=r+(s-r)*this._position/100,c=n+(o-n)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const d=[l-this._length/2*u,c-this._length/2*h],f=[l+this._length/2*u,c+this._length/2*h];return i.pushPath([[r,n],d,f,[s,o]]),i}}e.EffectJog=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(e){"use strict";class t{static{this.instance=null}static local(){return null===t.instance&&(t.instance=new t),t.instance}execute(e,t,r){return new i(e,t,r)}}class i{constructor(e,t,i){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*i:0,this._offsetY=void 0!==t.offsetY?t.offsetY*i:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,t,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+t,e.y=e.y+i;return e.reset(),e}}e.EffectMove=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/SpatialReference","../../../geometry/support/jsonUtils","../CIMEffects","../CurveHelper"],function(e,t,i,r,n,s,o){"use strict";class a{static{this.instance=null}static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(e,t,i,r,n,s){return new l(e,t,i,r,n,s)}}class l{constructor(e,t,i,r,n,s){this._preventClipping=s,this._inputGeometries=e,this._tileKey=r,this._curveHelper=new o.CurveHelper,this._offset=(t.offset??1)*i,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(n*i),10),this._option=t.option,this._offsetFlattenError=o.pixelTolerance*i}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if("Rounded"===this._method&&this._offset>0){const r=i.collectPath(e),n=this._curveHelper.offset(r,-this._offset,this._method,4,this._offsetFlattenError);if(n){const i=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);return i.pushPath(n),i}return null}const r=e.asJSON();if(n.isExtent(r)&&Math.min(r.xmax-r.xmin,r.ymax-r.ymin)+2*this._offset>0)return t.GeometryCursor.fromJSONCIM({xmin:r.xmin-this._offset,xmax:r.xmax+this._offset,ymin:r.ymin-this._offset,ymax:r.ymax+this._offset})}const o=!this._preventClipping&&this._tileKey?s.clipCursorToTileExtent(e,this._maxInflateSize,!0):e.clone();if(!o)continue;const a=s.lazyOffsetOperator.module,l={...o.asJSON(),spatialReference:{wkid:r.WebMercator.wkid}},u=a.execute(l,-this._offset,{joins:c(this._method),flattenError:this._offsetFlattenError,miterLimit:4});return u?t.GeometryCursor.fromJSONCIM(u):null}return null}}function c(e){switch(e){case"Rounded":return"round";case"Bevelled":return"bevel";case"Mitered":return"miter";case"Square":return"square"}}e.EffectOffset=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRadial":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/support/centroid","../defaultCIMValues"],function(e,t,i,r){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,i){return new s(e,t,i)}}class s{constructor(e,t,i){this._inputGeometries=e,this._length=(void 0!==t.length?t.length:r.defaultCIMValues.CIMGeometricEffectRadial.length)*i,this._angle=void 0!==t.angle?t.angle*Math.PI/180:r.defaultCIMValues.CIMGeometricEffectRadial.angle,this._lx=Math.cos(this._angle)*this._length,this._ly=Math.sin(this._angle)*this._length}next(){let e=this._inputGeometries.next();for(;e;){if("esriGeometryPoint"===e.geometryType||"esriGeometryMultipoint"===e.geometryType){const i=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return e.nextPath()&&e.nextPoint()&&i.pushPath([[e.x,e.y],[e.x+this._lx,e.y+this._ly]]),i}if("esriGeometryPolygon"===e.geometryType){const r=i.ringsCentroidCursor(e);if(!r)return null;const n=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return n.pushPath([[r[0],r[1]],[r[0]+this._lx,r[1]+this._ly]]),n}e=this._inputGeometries.next()}return null}}e.EffectRadial=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(e){"use strict";class t{static{this.instance=null}static local(){return null===t.instance&&(t.instance=new t),t.instance}execute(e,t,r){return new i(e,t,r)}}class i{constructor(e,t,i){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if("esriGeometryPolyline"===e.geometryType)return r(e.clone());e=this._inputGeometries.next()}return null}}function r(e){for(;e.nextPath();)for(let t=0;t<e.pathSize/2;t++){e.seekInPath(t);const i=e.x,r=e.y;e.seekInPath(e.pathSize-t-1);const n=e.x,s=e.y;e.x=i,e.y=r,e.seekInPath(t),e.x=n,e.y=s}return e.reset(),e}e.EffectReverse=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(e,t){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,i){return new r(e,t,i)}}class r{constructor(e,t,i){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?t.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._rotateAngle||"esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const i=t.getCursorBoundsXY(e),r=(i[2]+i[0])/2,n=(i[3]+i[1])/2;return e.reset(),this._rotate(e.clone(),r,n)}e=this._inputGeometries.next()}return null}_rotate(e,t,i){const r=Math.cos(this._rotateAngle),n=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const s=e.x-t,o=e.y-i;e.x=t+s*r-o*n,e.y=i+s*n+o*r}return e.reset(),e}}e.EffectRotate=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../geometry/support/boundsUtils"],function(e,t){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,i){return new r(e,t,i)}}class r{constructor(e,t,i){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(1===this._xFactor&&1===this._yFactor)return e;if("esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const i=t.getCursorBoundsXY(e),r=(i[2]+i[0])/2,n=(i[3]+i[1])/2;return e.reset(),this._scaleCursor(e.clone(),r,n)}}return null}_scaleCursor(e,t,i){for(;e.nextPath();)for(;e.nextPoint();)e.x=t+(e.x-t)*this._xFactor,e.y=i+(e.y-i)*this._yFactor;return e.reset(),e}}e.EffectScale=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectSuppress":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/support/PolylineBuilder","../CIMCursor"],function(e,t,i,r){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,i){return new s(e,t,i)}}class s extends r.PathEffectCursor{constructor(e,t,i){super(e,!1,!0),this._suppress=void 0!==t.suppress&&t.suppress,this._invert=void 0!==t.invert&&t.invert}processPath(e){if(e.totalSize<=0)return null;if(!this._suppress){const i=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolygon",!1,!1,e.yFactor);for(e.seekPathEnd();e.nextPoint();)i.pushXY(e.x,e.y);return i}const r=[],n=new Array(e.pathSize);let s=0;for(e.seekPathStart();e.nextPoint();)n[s++]=e.getControlPoint(),r.push([e.x,e.y]);let o=!0,a=!0,l=!1,c=!this._invert;s=0;const u=new i;let h=r[0];for(;s<r.length;){const e=r[s+1],t=n[s],i=n[s+1];s++,a&&(c=t||i?this._invert:!this._invert,a=!1),c?(u.addSegment(h,e,o),o=!1):l=!0,h=e,i&&(c?(c=!1,o=!0):c=!0)}const d=u.getGeometry();if(0===d.length)return null;if(!l&&r[0][0]===r[r.length-1][0]&&r[0][1]===r[r.length-1][1]){const e=d[d.length-1];return e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]),t.GeometryCursor.fromJSONCIM({paths:d})}const f=d[d.length-1];return u.getPointCount()>1&&"esriGeometryPolygon"===e.geometryType&&f[0][0]===f[f.length-1][0]&&f[0][1]===f[f.length-1][1]&&d.length>1&&(d[d.length-1].push(...d[0]),d.splice(0,1)),t.GeometryCursor.fromJSONCIM({paths:d})}}e.EffectSuppress=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/PolylineBuilder":function(){define(function(){"use strict";return class{constructor(){this._polyline=[]}beginPath(e){this._polyline.push([e])}lineTo(e){if(0===this._polyline.length)throw new Error("No path started. Call beginPath first.");this._polyline[this._polyline.length-1].push(e)}getPointCount(){return this._polyline.reduce((e,t)=>e+t.length,0)}addSegment(e,t,i){i&&this.beginPath(e),this.lineTo(t)}getXY(e){let t=0;for(const i of this._polyline){if(e<t+i.length)return i[e-t];t+=i.length}return null}getGeometry(){return this._polyline}}})},"esri/symbols/cim/effects/EffectTaperedPolygon":function(){define(["exports","../../../core/Error","../../../core/Logger","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../../../geometry/support/jsonUtils","../../../geometry/support/PolylineBuilder","../../../geometry/support/TileClipper","../CIMCursor","../CIMEffects"],function(e,t,i,r,n,s,o,a,l,c){"use strict";const u=()=>i.getLogger("esri.symbols.cim.effects.EffectTaperedPolygon");class h{static{this.instance=null}static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(e,t,i){return new d(e,t,i)}}class d extends l.PathEffectCursor{constructor(e,t,i){super(e,!1,!0),this._slopeS=0,this._slopeC=1,this._lastTangent1=new a.Point(NaN,NaN),this._lastWidth=0,this._geomUnitsPerPoint=i,this._halfFromWidth=Math.abs(void 0!==t.fromWidth?t.fromWidth:0)*i*.5,this._halfToWidth=Math.abs(void 0!==t.toWidth?t.toWidth:1)*i*.5,this._originalLength=(void 0!==t.length?t.length:0)*i,this._length=0}processPath(e){if(e.totalSize<=0)return null;if(this._halfFromWidth<=0&&this._halfToWidth<=0){const t=r.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolygon",!1,!1,e.yFactor);for(e.seekPathEnd();e.prevPoint();)t.pushXY(e.x,e.y);for(e.seekPathStart();e.nextPoint();)t.pushXY(e.x,e.y);return t}const i=e.asJSON();e.seekPath(e.totalSize-1);const a=c.lazyGeneralizeOperator.module.execute(i,.25*this._geomUnitsPerPoint,{removeDegenerateParts:!0}),l=null==a?null:s.isPolygon(a)?a.rings:s.isPolyline(a)?a.paths:null;if(!l)return u().error(new t("mapview-bad-resource","Unable to process geometry")),null;const h=c.lazyLengthOperator.module.execute(a);if((0===this._originalLength||this._originalLength>h)&&h>0){this._length=h;const e=(this._halfToWidth-this._halfFromWidth)/this._length;if(Math.abs(e)<1){const t=e*e;this._slopeC=Math.sqrt(1/(1+t)),this._slopeS=Math.sqrt(t/(1+t)),e<0&&(this._slopeS=-this._slopeS)}else this._slopeC=this._slopeS=.7071}else this._length=this._originalLength,this._slopeC=1,this._slopeS=0;const d=[];for(const e of l){const t=new o,i=new o;let r=0;this._setFromOffset(e.slice(0,2),t,i);for(let n=0,s=3;s<=e.length;++n,++s)r=this._setOffset(e.slice(n,s),r,t,i);this._setToOffset(e.slice(-2),r,t,i);const[n]=t.getGeometry(),[s]=i.getGeometry();d.push([...n,...s.reverse()])}const f={rings:d,spatialReference:{wkid:n.WebMercator.wkid}},p=c.lazySimplifyOperator.module.execute(f);return r.GeometryCursor.fromJSONCIM(p)}_setFromOffset([[e,t],[i,r]],n,s){const o=this._halfFromWidth,l=new a.Point(i-e,r-t).normalize().scale(o);n.beginPath([e-l.y,t+l.x]),s.beginPath([e+l.y,t-l.x])}_setToOffset([[e,t],[i,r]],n,s,o){let l;l=(n+=Math.sqrt((i-e)**2+(r-t)**2))>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*n/this._length;const c=new a.Point(i-e,r-t).normalize().scale(l);s.lineTo([i-c.y,r+c.x]),o.lineTo([i+c.y,r-c.x])}_setOffset([[e,i],[r,n],[s,o]],l,c,h){const d=Math.sqrt((r-e)**2+(n-i)**2);let f;f=l+d>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*(l+d)/this._length,l+=d;const p=new a.Point(r,n),m=new a.Point(r-e,n-i).normalize(),g=new a.Point(s-r,o-n).normalize(),_=a.Point.sub(g,m),y=c.getPointCount(),x=h.getPointCount();m.leftPerpendicular(),g.leftPerpendicular();const b=m.x*g.x+m.y*g.y;if(b>.99){const e=a.Point.add(m,g).scale(f/2),t=e.clone().rotate(this._slopeC,this._slopeS);c.lineTo([p.x+t.x,p.y+t.y]);const i=e.rotateReverse(this._slopeC,this._slopeS);h.lineTo([p.x-i.x,p.y-i.y])}else{const r=m.x*g.y-m.y*g.x;if(_.scale(1/r),r<0){_.scale(-f).rotateReverse(this._slopeC,this._slopeS);const e=h.getXY(x-1);e||u().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const i=a.Point.add(p,_).sub(a.Point.fromArray(e));if(m.x*i.y-m.y*i.x>0){const e=m.clone().scale(-f).rotateReverse(this._slopeC,this._slopeS),t=g.clone().scale(-f).rotateReverse(this._slopeC,this._slopeS);h.lineTo([p.x+e.x,p.y+e.y]),h.lineTo([p.x,p.y]),h.lineTo([p.x+t.x,p.y+t.y])}else h.lineTo([p.x+_.x,p.y+_.y])}else{_.scale(f).rotate(this._slopeC,this._slopeS);const e=c.getXY(y-1);e||u().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const i=a.Point.add(p,_).sub(a.Point.fromArray(e));if(m.x*i.y-m.y*i.x>0){const e=m.clone().scale(f).rotate(this._slopeC,this._slopeS),t=g.clone().scale(f).rotate(this._slopeC,this._slopeS);c.lineTo([p.x+e.x,p.y+e.y]),c.lineTo([p.x,p.y]),c.lineTo([p.x+t.x,p.y+t.y])}else c.lineTo([p.x+_.x,p.y+_.y])}const n=Math.acos(b);let s=1;if(f>.25){const e=2*Math.acos(1-.25/f);e<n&&(s=Math.round(n/e))}const o=Math.cos(n/s),l=Math.sin(n/s),d=m.clone();if(r<0){d.rotate(this._slopeC,this._slopeS);const r=c.getXY(y-1);r||u().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const n=a.Point.add(p,d.clone().scale(this._lastWidth)),s=a.Point.sub(n,a.Point.fromArray(r)),o=m.x*s.y-m.y*s.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&o>0){const t=new a.Point(e,i),r=this._lastTangent1.clone().scale(this._lastWidth);r.rotate(this._slopeC,this._slopeS);const n=m.clone().scale(this._lastWidth);n.rotate(this._slopeC,this._slopeS),c.lineTo([t.x+r.x,t.y+r.y]),c.lineTo([t.x,t.y]),c.lineTo([t.x+n.x,t.y+n.y])}}else{d.scale(-1).rotateReverse(this._slopeC,this._slopeS);const r=h.getXY(x-1);r||u().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const n=a.Point.add(p,d.clone().scale(this._lastWidth)),s=a.Point.sub(n,a.Point.fromArray(r)),o=m.x*s.y-m.y*s.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&o>0){const t=new a.Point(e,i),r=this._lastTangent1.clone().scale(-this._lastWidth);r.rotateReverse(this._slopeC,this._slopeS);const n=m.clone().scale(-this._lastWidth);n.rotateReverse(this._slopeC,this._slopeS),h.lineTo([t.x+r.x,t.y+r.y]),h.lineTo([t.x,t.y]),h.lineTo([t.x+n.x,t.y+n.y])}}d.scale(f);for(let e=0;e<=s;e++)r<0?(c.lineTo([p.x+d.x,p.y+d.y]),d.rotateReverse(o,l)):(h.lineTo([p.x+d.x,p.y+d.y]),d.rotate(o,l))}return this._lastTangent1.setCoords(m.x,m.y),this._lastWidth=f,l}}e.EffectTaperedPolygon=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports","../../../geometry/GeometryCursor","../GeometryWalker"],function(e,t,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,i){return new n(e,t,i)}}class n{constructor(e,t,r){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*r,this._period=(void 0!==t.period?t.period:3)*r,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new i.DashPattern,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new i.GeometryWalker,this._walker.updateTolerance(r)}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._height||0===this._period)return e;const t=this._processGeom(e);if(t)return t;e=this._inputGeometries.next()}return null}_processGeom(e){const i=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){i.startPath();const t=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case"Sinus":default:this._constructCurve(i,t,!1);break;case"Square":this._constructSquare(i,t);break;case"Triangle":this._constructTriangle(i,t);break;case"Random":this._constructCurve(i,t,!0)}else for(;e.nextPoint();)i.pushXY(e.x,e.y)}return i}_constructCurve(e,t,r){let n=Math.round(t/this._period);0===n&&(n=1);const s=16*n+1,o=t/n,a=this._period/16,l=1/s,c=2*Math.PI*t/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),f=.75-Math.random()/2,p=.75-Math.random()/2,m=new i.Pos;this._walker.curPointAndAngle(m),e.pushPoint(m.pt);let g=0;for(;;){if(!this._walker.nextPointAndAngle(a,m)){e.pushPoint(this._walker.getPathEnd());break}{const t=g;let i;if(g+=l,r){const e=this._height/2*(1+.3*Math.sin(f*c*t+u));i=e*Math.sin(c*t+h),i+=e*Math.sin(p*c*t+d),i/=2}else i=.5*this._height*Math.sin(.5*c*t);e.pushXY(m.pt[0]-i*m.sa,m.pt[1]+i*m.ca)}}}_constructSquare(e,t){Math.round(t/this._period);let r=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const n=new i.Pos;this._walker.curPointAndAngle(n);const s=new i.Pos;if(this._walker.nextPointAndAngle(this._period,s)){const o=new i.Pos;this._walker.nextPointAndAngle(this._period,o)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca),e.pushXY(s.pt[0]+this._height/2*s.sa,s.pt[1]-this._height/2*s.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,t){Math.round(t/this._period);let r=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const n=new i.Pos;this._walker.curPointAndAngle(n);const s=new i.Pos;if(this._walker.nextPointAndAngle(this._period/2,s)){const o=new i.Pos;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(r?(e.pushPoint(n.pt),r=!1):e.pushPoint(n.pt),e.pushXY(s.pt[0]-this._height/2*s.sa,s.pt[1]+this._height/2*s.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}}e.EffectWave=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(e,t,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,i){return new n(e,t,i)}}class n extends t.PathTransformationCursor{constructor(e,t,r){super(e),this._geometryWalker=new i.GeometryWalker,this._geometryWalker.updateTolerance(r),this._angleToLine=t.angleToLine??!0,this._offset=(t.offset?t.offset:0)*r,this._originalEndings=t.endings,this._offsetAtEnd=(t.customEndingOffset?t.customEndingOffset:0)*r,this._position=-(t.offsetAlongLine?t.offsetAlongLine:0)*r,this._pattern=new i.DashPattern,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(r),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{"WithFullGap"===this._originalEndings&&this.isClosed?this._endings="WithMarkers":this._endings=this._originalEndings,this._pattern.extPtGap=0;let i,r=!0;switch(this._endings){case"NoConstraint":i=-this._position,i=this._adjustPosition(i),r=!1;break;case"WithHalfGap":default:i=-this._pattern.lastValue()/2;break;case"WithFullGap":i=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case"WithMarkers":i=0;break;case"Custom":i=-this._position,i=this._adjustPosition(i),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,r))return null;this._pattern.reset();let n=0;for(;i>n;)i-=n,n=this._pattern.nextValue();n-=i,t=n,this.iteratePath=!0}const r=new i.Pos;return this._geometryWalker.nextPointAndAngle(t,r)?"WithFullGap"===this._endings&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):"WithMarkers"===this._endings&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca),this._angleToLine&&this.internalPlacement.setRotateCS(r.ca,r.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}}e.PlacementAlongLineSameSize=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,t,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,i){return new n(e,t,i)}}class n extends t.PathTransformationCursor{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new i.CurveHelper,this._placePerPart=t.placePerPart??!1,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*r:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let t;switch(this._type){case"Both":default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case"JustBegin":t=this._atExtremities(e,this._position,!0);break;case"JustEnd":t=this._atExtremities(e,this._position,!1);case"None":}return t}_atExtremities(e,t,i){if(this._placePerPart||(i?e.seekPath(0):e.seekPath(e.totalSize-1)),i||e.seekPathEnd(),i?e.nextPoint():e.prevPoint()){let r=0,[n,s]=[0,0],[o,a]=[e.x,e.y];const l=[0,0];for(;i?e.nextPoint():e.prevPoint();){n=o,s=a,o=e.x,a=e.y;const i=this._curveHelper.getLength(n,s,o,a);if(r+i>t){const e=(t-r)/i,[c,u]=this._curveHelper.getAngleCS(l,n,s,o,a,e),h=this._curveHelper.getCoord2D(n,s,o,a,e);return this.internalPlacement.setTranslate(h[0]-this._offset*u,h[1]+this._offset*c),this._angleToLine&&this.internalPlacement.setRotateCS(-c,-u),this.internalPlacement}r+=i}}return null}}e.PlacementAtExtremities=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(e,t,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,i){return new n(e,t,i)}}class n extends t.PathTransformationCursor{constructor(e,t,r){super(e),this._walker=new i.GeometryWalker,this._walker.updateTolerance(r),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*r:0,this._endGap=void 0!==t.endPosition?t.endPosition*r:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new i.DashPattern,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){const e=this._pattern.nextValue()*this._subPathLen,i=this._beginGap+e;t=i-this._prevPos,this._prevPos=i}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const i=this._pattern.nextValue()*this._subPathLen,r=this._beginGap+i;t=r-this._prevPos,this._prevPos=r,this.iteratePath=!0}const r=new i.Pos;if(!this._walker.nextPointAndAngle(t,r,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(r.pt[0]-this._offset*r.sa,r.pt[1]+this._offset*r.ca);const n=this._isFirst&&this._flipFirst;let s,o;return this._angleToLine?(s=r.ca,o=r.sa):(s=1,o=0),n&&(s=-s,o=-o),this.internalPlacement.setRotateCS(s,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}e.PlacementAtRatioPositions=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports","../../../core/RandomLCG","../CIMPlacements"],function(e,t,i){"use strict";const r=512,n=24,s=1e-6;class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,i,r){return new a(e,t,i,r)}}class a{constructor(e,n,s,o){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(n.stepX??16)*s,this._stepY=Math.abs(n.stepY??16)*s,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=n.gridType??"Fixed","Random"===this._gridType){const e=n.seed??13,i=1;this._randomLCG=new t(e*i),this._randomness=(n.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=n.gridAngle??0,this._shiftOddRows=n.shiftOddRows??!1,this._offsetX=(n.offsetX??0)*s,this._offsetY=(n.offsetY??0)*s,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=o){const[e,t,i,n]=o.split("/"),s=parseFloat(e),a=parseFloat(t),l=parseFloat(i),c=parseFloat(n);this._graphicOriginX=-(c*2**s+l)*r,this._graphicOriginY=a*r,this._testInsidePolygon=!0}this._internalPlacement=new i.Placement,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!a._randValues){a._randValues=[];for(let e=0;e<n;e++)for(let e=0;e<n;e++)a._randValues.push(this._randomLCG.getFloat()),a._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let t,i,n,s,o,a,l,c,u,h,d,f,p,m;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=p=d=Number.MAX_VALUE,u=h=m=f=-Number.MAX_VALUE;const g=1!==this._cosAngle;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,t=a-this._graphicOriginX-this._offsetX,i=o-this._graphicOriginY-this._offsetY,g?(n=this._cosAngle*t-this._sinAngle*i,s=this._sinAngle*t+this._cosAngle*i):(n=t,s=i),l=Math.min(l,n),u=Math.max(u,n),c=Math.min(c,s),h=Math.max(h,s),d=Math.min(d,o),f=Math.max(f,o),p=Math.min(p,a),m=Math.max(m,a);d=d!==Number.MAX_VALUE?d:-512-this._stepY,f=f!==-Number.MAX_VALUE?f:this._stepY,p=p!==Number.MAX_VALUE?p:-this._stepX,m=m!==-Number.MAX_VALUE?m:r+this._stepX;const _=f-d,y=m-p;if(this._verticalSubdivision=_>=y,this._polygonMin=this._verticalSubdivision?d:p,this._testInsidePolygon){let e=0-this._graphicOriginX-this._offsetX-this._stepX,t=r-this._graphicOriginX-this._offsetX+this._stepX,i=-512-this._graphicOriginY-this._offsetY-this._stepY,n=0-this._graphicOriginY-this._offsetY+this._stepY;if(g){const r=[[e,i],[e,n],[t,i],[t,n]];e=i=Number.MAX_VALUE,t=n=-Number.MAX_VALUE;for(const s of r){const r=this._cosAngle*s[0]-this._sinAngle*s[1],o=this._sinAngle*s[0]+this._cosAngle*s[1];e=Math.min(e,r),t=Math.max(t,r),i=Math.min(i,o),n=Math.max(n,o)}}l=l!==Number.MAX_VALUE?Math.max(l,e):e,c=c!==Number.MAX_VALUE?Math.max(c,i):i,u=u!==-Number.MAX_VALUE?Math.min(u,t):t,h=h!==-Number.MAX_VALUE?Math.min(h,n):n}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,p,m,d,f)}_buildAccelerationMap(e,t,i,n,s){e.reset();const o=new Map,a=this._verticalSubdivision,c=a?s-n:i-t;let u=Math.ceil(c/10);if(u<=1)return;const h=Math.floor(c/u);let d,f,p,m,g,_,y,x,b,v,S;for(u++,this._delta=h,a?(b=-512-2*this._stepY,v=2*this._stepY,S=n):(b=-2*this._stepX,v=r+2*this._stepX,S=t);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(d=e.x,f=e.y;e.nextPoint();d=p,f=m){if(p=e.x,m=e.y,a){if(f===m||f<b&&m<b||f>v&&m>v)continue;g=Math.min(f,m),_=Math.max(f,m)}else{if(d===p||d<b&&p<b||d>v&&p>v)continue;g=Math.min(d,p),_=Math.max(d,p)}for(;g<_;)y=Math.floor((g-S)/h),l(y,d,f,p,m,o),g+=h;x=Math.floor((_-S)/h),x>y&&l(x,d,f,p,m,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const t=this._currentY*this._stepY+this._offsetY;let i,r;if(this._currentX++,"Random"===this._gridType){const s=(this._currentX%n+n)%n,o=(this._currentY%n+n)%n;i=this._graphicOriginX+e+this._stepX*this._randomness*(.5-a._randValues[o*n+s])*2/3,r=this._graphicOriginY+t+this._stepY*this._randomness*(.5-a._randValues[o*n+s+1])*2/3}else i=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,r=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t;if(!this._testInsidePolygon||this._isInsidePolygon(i,r,this._geometryCursor))return this._internalPlacement.setTranslate(i,r),this._internalPlacement}}_isInsidePolygon(e,t,i){if(null==this._accelerationMap)return function(e,t,i){let r,n,o,a,l=0;for(e+=s,t+=s,i.reset();i.nextPath();)if(i.nextPoint())for(r=i.x,n=i.y;i.nextPoint();r=o,n=a)o=i.x,a=i.y,n>t!=a>t&&((o-r)*(t-n)-(a-n)*(e-r)>0?l++:l--);return 0!==l}(e,t,i);e+=s,t+=s;const r=this._verticalSubdivision,n=r?t:e,o=Math.floor((n-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,h=0;for(const i of a){if(l=i[0],c=i[1],r){if(l[1]>t==c[1]>t)continue;u=(c[0]-l[0])*(t-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(t-l[1])}u>0?h++:h--}return 0!==h}}function l(e,t,i,r,n,s){let o=s.get(e);o||(o=[],s.set(e,o)),o.push([[t,i],[r,n]])}e.PlacementInsidePolygon=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,t,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,i){return new n(e,t,i)}}class n extends t.PathTransformationCursor{constructor(e,t,r){super(e),this._curveHelper=new i.CurveHelper,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*r:0,this._epsilon=.001*r}processPath(e){const t=this._position;if("SegmentMidpoint"===this._relativeTo){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[t,i]=[e.x,e.y],[r,n]=[0,0];const s=[0,0];for(;e.nextPoint();){r=e.x,n=e.y;const o=this._curveHelper.getLength(t,i,r,n);if(o<this._epsilon){t=r,i=n;continue}const a=.5+this._position/o,[l,c]=this._curveHelper.getAngleCS(s,t,i,r,n,a),u=this._curveHelper.getCoord2D(t,i,r,n,a);return this.internalPlacement.setTranslate(u[0]-this._offset*c,u[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(l,c),this.internalPlacement}}return this.iteratePath=!1,null}const i="LineEnd"===this._relativeTo;return this.onLine(e,t,i)}onLine(e,t,i){let r,n=!1;switch(this._relativeTo){case"LineMiddle":default:e.seekPathStart(),r=e.pathLength()/2+t;break;case"LineBeginning":r=t;break;case"LineEnd":r=t,n=!0}i?e.seekPathEnd():e.seekPathStart();let s=0;if(i?e.prevPoint():e.nextPoint()){let[t,o]=[e.x,e.y],[a,l]=[0,0];const c=[0,0];for(;i?e.prevPoint():e.nextPoint();){a=e.x,l=e.y;const i=this._curveHelper.getLength(t,o,a,l);if(s+i>r){const e=(r-s)/i,[u,h]=this._curveHelper.getAngleCS(c,t,o,a,l,e),d=this._curveHelper.getCoord2D(t,o,a,l,e),f=n?-this._offset:this._offset;return this.internalPlacement.setTranslate(d[0]-f*h,d[1]+f*u),this._angleToLine&&(n?this.internalPlacement.setRotateCS(-u,-h):this.internalPlacement.setRotateCS(u,h)),this.internalPlacement}t=a,o=l,s+=i}}return null}}e.PlacementOnLine=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,t,i){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,i){return new n(e,t,i)}}class n extends t.PathTransformationCursor{constructor(e,t,r){super(e),this._curveHelper=new i.CurveHelper,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*r:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let i=t[0],r=t[1];if(0!==this._offset){const e=Math.cos(t[2]),n=Math.sin(t[2]);i-=this._offset*n,r+=this._offset*e}return this.internalPlacement.setTranslate(i,r),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const t=e.isClosed();let i=0,r=!1,n=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,h=e.nextPoint();for(;h;){const d=e.x,f=e.y,p=e.getControlPoint();(this._angleToLine||0!==this._offset)&&(n=this._curveHelper.getAngle(a,l,d,f,0)),u?(u=!1,t?(i=n,r=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,n])):c?this._controlPoints&&this._tags.push([a,l,s(o,n)]):this._regularVertices&&this._tags.push([a,l,s(o,n)]),(this._angleToLine||0!==this._offset)&&(o=this._curveHelper.getAngle(a,l,d,f,1)),h=e.nextPoint(),h||(t?p||r?this._controlPoints&&this._tags.push([d,f,s(o,i)]):this._regularVertices&&this._tags.push([d,f,s(o,i)]):(this._endPoints||this._controlPoints&&p)&&this._tags.push([d,f,o])),a=d,l=f,c=p}}this._tagIterator=0}}function s(e,t){const i=Math.PI;for(;Math.abs(t-e)>i+2e-15;)t-e>i?t-=2*i:t+=2*i;return(e+t)/2}e.PlacementOnVertices=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define(["exports","../../../geometry/support/boundsUtils","../../../geometry/support/centroid","../../../geometry/support/labelPoint","../CIMPlacements"],function(e,t,i,r,n){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,i){return new o(e,t,i)}}class o{constructor(e,t,i){this._geometryCursor=e,this._offsetX=void 0!==t.offsetX?t.offsetX*i:0,this._offsetY=void 0!==t.offsetY?t.offsetY*i:0,this._method=void 0!==t.method?t.method:"OnPolygon",this._placementPerPart=void 0!==t.placePerPart&&t.placePerPart,this._internalPlacement=new n.Placement}next(){const e=this._geometryCursor;if(!e)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(e);for(;e.nextPath();)if(!(e.getCurrentRingArea()<0))return this._polygonCenter(e.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(e){let n=!1;switch(this._method){case"CenterOfMass":{const t=i.weightedAreaCentroid(e);t&&(this._internalPlacement.setTranslate(t[0]+this._offsetX,t[1]+this._offsetY),n=!0)}break;case"BoundingBoxCenter":{const i=t.getCursorBoundsXY(e);i&&(this._internalPlacement.setTranslate((i[2]+i[0])/2+this._offsetX,(i[3]+i[1])/2+this._offsetY),n=!0)}break;default:{const t=r.getLabelPoint(e);null!==t&&(this._internalPlacement.setTranslate(t[0]+this._offsetX,t[1]+this._offsetY),n=!0)}}return n?this._internalPlacement:null}}e.PlacementPolygonCenter=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define(["exports","../../core/PriorityQueue","./aaBoundingRect","./boundsUtils","./centroid","./coordsUtils","./intersectsBase"],function(e,t,i,r,n,s,o){"use strict";function a(e,t){let i,r,n,s,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(i=t.x,r=t.y;t.nextPoint();i=n,r=s)n=t.x,s=t.y,r>e[1]!=s>e[1]&&((n-i)*(e[1]-r)-(s-r)*(e[0]-i)>0?o++:o--);return 0!==o}function l(e,t,i){if(i&&a(e,t))return{coord:e,distance:0};let r=1/0,n=0,o=0,l=[0,0],c=[0,0];const u=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(l[0]=t.x,l[1]=t.y;t.nextPoint();l=c){c=[t.x,t.y],s.projectPointOnLineSeg(u,e,l,c);const i=y(e,u);i<r&&(r=i,n=u[0],o=u[1])}return{coord:[n,o],distance:Math.sqrt(r)}}function c(e,t,r,n){const s=[t,0];let a=1/0,l=1/0,c=!1,h=!1;const d=[[t,n[1]-1],[t,n[3]+1]],f=[0,0],p=[0,0],g=[0,0],_=[[0,0],[0,0]],y=i.create();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(_[0][0]=e.x,_[0][1]=e.y;e.nextPoint();_[0][0]=_[1][0],_[0][1]=_[1][1]){if(_[1][0]=e.x,_[1][1]=e.y,null===u(y,_))continue;if(p[0]=d[0][0],p[1]=d[0][1],g[0]=d[1][0],g[1]=d[1][1],0===m(y,p,g))continue;if(!o.segmentIntersects(d[0],d[1],_[0],_[1],f))continue;const t=f[1];a>l?t<a&&(a=t,c=!0):t<l&&(l=t,h=!0)}return c&&h?s[1]=(a+l)/2:s[0]=s[1]=NaN,s}function u(e,t){if(t.length<2)return null;e||(e=i.create());const[r,n]=t[0],[s,o]=t[1];return e[0]=Math.min(r,s),e[1]=Math.min(n,o),e[2]=Math.max(r,s),e[3]=Math.max(n,o),e}const h=1,d=4,f=3,p=12;function m(e,t,i){let r=g(t,e),n=g(i,e);const s=e[0],o=e[1],a=e[2],l=e[3];if(r&n)return 0;if(!(r|n))return 4;const c=(r?1:0)|(n?2:0);do{const c=i[0]-t[0],u=i[1]-t[1];if(c>u)r&f?(r&h?(t[1]+=u*(s-t[0])/c,t[0]=s):(t[1]+=u*(a-t[0])/c,t[0]=a),r=g(t,e)):n&f?(n&h?(i[1]+=u*(s-i[0])/c,i[0]=s):(i[1]+=u*(a-i[0])/c,i[0]=a),n=g(i,e)):r?(r&d?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),r=g(t,e)):(n&d?(i[0]+=c*(o-i[1])/u,i[1]=o):(i[0]+=c*(l-i[1])/u,i[1]=l),n=g(i,e));else if(r&p?(r&d?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),r=g(t,e)):n&p?(n&d?(i[0]+=c*(o-i[1])/u,i[1]=o):(i[0]+=c*(l-i[1])/u,i[1]=l),n=g(i,e)):r?(r&h?(t[1]+=u*(s-t[0])/c,t[0]=s):(t[1]+=u*(a-t[0])/c,t[0]=a),r=g(t,e)):(n&h?(i[1]+=u*(s-i[0])/c,i[0]=s):(i[1]+=u*(a-i[0])/c,i[0]=a),n=g(i,e)),r&n)return 0}while(r|n);return c}function g(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function _(e,t,i){return e+(t-e)*i}function y(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function x(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;const i=isNaN(e),r=isNaN(t);return i<r?-1:i>r?1:0}class b{constructor(e,t,i,r){this.x=e,this.y=t,this.cellSize=i,this.distancefromCellCenter=s.distanceFromPointToPolygon(e,t,r),this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}}e.getLabelPoint=function(e){if(0===e.totalSize)return null;const t=r.getCursorBoundsXY(e);if(!t)return null;const s=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*222045e-19;let o=0,u=0;e.reset();for(let t=0;e.nextPath();t++){const i=e.getCurrentRingArea();i>u&&(u=i,o=t)}if(e.seekPath(o),0===e.pathSize)return null;e.seekPathStart();const h=r.getCursorPathBounds(e);if(Math.abs(u)<=2*s*s)return[(h[0]+h[2])/2,(h[1]+h[3])/2];e.seekPathStart();const d=n.ringCentroidCursorXY(e,i.create());if(null===d)return null;if(e.totalPoints<4)return d;const f=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],p=[NaN,NaN,NaN,NaN],m=[NaN,NaN,NaN,NaN];let g=!1,b=l(d,e,!0);0===b.distance&&(g=!0,f[0][0]=d[0],f[0][1]=d[1],b=l(d,e,!1)),p[0]=b.distance,m[0]=0;const v=[NaN,NaN];let S=!1,w=.25,T=-1,M=NaN;do{if(M=NaN,f[1]=c(e,_(h[0],h[2],w),0,t),isNaN(f[1][0])||isNaN(f[1][1])||(b=l(f[1],e,!1),M=b.distance),!isNaN(M)&&M>s&&a(f[1],e))S=!0,p[1]=M,m[1]=y(f[1],d);else if(!isNaN(M)&&M>T&&(T=M,v[0]=f[1][0],v[1]=f[1][1]),w-=.01,w<.1){if(!(T>=0))break;S=!0,p[1]=T,f[1][0]=v[0],f[1][1]=v[1],m[1]=y(f[1],d)}}while(!S);S=!1,w=.5,T=-1;let P=.01,I=1;do{if(M=NaN,f[2]=c(e,_(h[0],h[2],w),0,t),isNaN(f[2][0])||isNaN(f[2][1])||(b=l(f[2],e,!1),M=b.distance),!isNaN(M)&&M>s&&a(f[2],e))S=!0,p[2]=M,m[2]=y(f[2],d);else if(!isNaN(M)&&M>T)T=M,v[0]=f[2][0],v[1]=f[2][1];else if(M>T&&(T=M,v[0]=f[2][0],v[1]=f[2][1]),w=.5+P*I,P+=.01,I*=-1,w<.3||w>.7){if(!(T>=0))break;S=!0,p[2]=T,f[2][0]=v[0],f[2][1]=v[1],m[2]=y(f[2],d)}}while(!S);S=!1,w=.75,T=-1;do{if(M=NaN,f[3]=c(e,_(h[0],h[2],w),0,t),isNaN(f[3][0])||isNaN(f[3][1])||(b=l(f[3],e,!1),M=b.distance),!isNaN(M)&&M>s&&a(f[3],e))S=!0,p[3]=M,m[3]=y(f[3],d);else if(M>T&&(T=M,v[0]=f[3][0],v[1]=f[3][1]),w+=.01,w>.9){if(!(T>=0))break;S=!0,p[3]=T,f[3][0]=v[0],f[3][1]=v[1],m[3]=y(f[3],d)}}while(!S);const C=[0,1,2,3],F=g?0:1;let O;for(let e=F;e<4;e++)for(let e=F;e<3;e++){const t=m[e],i=m[e+1];x(t,i)>0&&(O=C[e],C[e]=C[e+1],C[e+1]=O,m[e]=i,m[e+1]=t)}let A=F,E=0,z=0;for(let e=F;e<4;e++){switch(e){case 0:z=2*p[C[e]];break;case 1:z=1.66666666*p[C[e]];break;case 2:z=1.33333333*p[C[e]];break;case 3:z=p[C[e]]}z>E&&(E=z,A=C[e])}return f[A]},e.getPolylabelPoint=function(e){if(!e.nextPath()||!e.pathSize)return null;const i=r.getCursorPathBounds(e),s=i[2]-i[0],o=i[3]-i[1];if(0===s||0===o)return[i[0]+s/2,i[1]+o/2];const a=Math.max(Math.min(s,o)/100,1),l=new t((e,t)=>t.maxDistanceToPolygon-e.maxDistanceToPolygon),c=Math.min(s,o);let u=c/2,h=0,d=0;for(h=i[0];h<i[2];h+=c)for(d=i[1];d<i[3];d+=c)l.enqueue(new b(h+u,d+u,u,e));e.reset(),e.nextPath();const f=n.ringsCentroidCursor(e);if(null===f)return null;let p,m=new b(f[0],f[1],0,e);for(;l.size>0;)p=l.dequeue(),p.distancefromCellCenter>m.distancefromCellCenter&&(m=p),p.maxDistanceToPolygon-m.distancefromCellCenter<=a||(u=p.cellSize/2,l.enqueue(new b(p.x-u,p.y-u,u,e)),l.enqueue(new b(p.x+u,p.y-u,u,e)),l.enqueue(new b(p.x-u,p.y+u,u,e)),l.enqueue(new b(p.x+u,p.y+u,u,e)));return[m.x,m.y]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){"use strict";const e=(e,t)=>e<t?-1:e>t?1:0;return class{constructor(t=e){this._data=[],this._compare=t}get size(){return this._data.length}enqueue(e){if(null==e)return;const{_data:t,_compare:i}=this;t.push(e);let r=t.length-1>>>0;const n=t[r];for(;r>0;){const e=r-1>>1,s=t[e];if(!(i(s,n)<=0))break;t[e]=n,t[r]=s,r=e}}dequeue(){const{_data:e,_compare:t}=this,i=e[0],r=e.pop();if(0===e.length)return i;e[0]=r;let n=0;const s=e.length,o=e[0];let a,l,c=null;for(;;){const i=2*n+1,r=2*n+2;if(c=null,i<s&&(a=e[i],t(a,o)>0&&(c=i)),r<s&&(l=e[r],(null===c&&t(l,o)<=0||null!==c&&t(l,a)<=0)&&(c=r)),null===c)break;e[n]=e[c],e[c]=o,n=c}return i}}})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(e){"use strict";e.getFirstFrame=function(e){const t=e.getFrame(0);if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)return t;const i=document.createElement("canvas");i.width=e.width,i.height=e.height;const r=i.getContext("2d");return t instanceof ImageData?r.putImageData(t,0,0):r.drawImage(t,0,0),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/mathUtils":function(){define(["exports"],function(e){"use strict";e.rotate=function(e,t=0){if(0===t)return e;const i=Math.cos(t),r=Math.sin(t),[n,s]=e;return[n*i+s*-r,n*r+s*i]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports","../../core/floatRGBA","../../core/Logger","../../core/mathUtils","./constants","./defaultCIMValues","../../views/2d/engine/webgl/definitions"],function(e,t,i,r,n,s,o){"use strict";const a=()=>i.getLogger("esri.symbols.cim.rasterizingUtils");let l;function c(e){const t=[];switch(e.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{"CIMPolarContinuousColorRamp"===e.type&&a().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const i=e;t.push({offset:0,color:[i.fromColor[0],i.fromColor[1],i.fromColor[2],i.fromColor[3]/255]}),t.push({offset:1,color:[i.toColor[0],i.toColor[1],i.toColor[2],i.toColor[3]/255]});break}case"CIMFixedColorRamp":{const i=e,r=1/(i.colors.length-1);let n=0;for(const e of i.colors)t.push({offset:n,color:[e[0],e[1],e[2],e[3]/255]}),n+=r;break}case"CIMMultipartColorRamp":{const i=e,r=i.weights.reduce((e,t)=>e+t,0);let n=0;for(let e=0;e<i.colorRamps.length;e++){const s=i.colorRamps[e],o=i.weights[e],a=c(s);for(const e of a)t.push({offset:(n+e.offset*o)/r,color:e.color});n+=o}break}default:a().error(`Color ramp "${e.type}" currently unsupported.`)}return t}function u(e,t){const i=[],r=(e.length-1)/(t-1);for(let n=0;n<t;n++){const s=e[Math.round(n*r)].color;i.push({offset:n/t,color:s}),i.push({offset:(n+1)/t,color:s})}return i}function h(e,t,i=0){for(const{offset:r,color:n}of t)e.addColorStop(Math.min(Math.max(r,i),1-i),`rgba(${n[0]}, ${n[1]}, ${n[2]}, ${n[3]})`)}function d(e,t,i,r,n){const s=i+2*n;e.width=s,e.height=r;const o=(n+1)/s,a=e.getContext("2d",{willReadFrequently:!0});if(t.length>0){const e=a.createLinearGradient(0,0,s,r);h(e,t,o),a.fillStyle=e}else a.fillStyle="rgba(128, 128, 128, 1)";a.fillRect(0,0,s,r)}function f(e){const{width:t,height:i}=e,r=e.getContext("2d").getImageData(0,0,t,i),n=new Uint8Array(r.data);for(let e=0;e<n.length;e+=4){const t=n[e+3]/255;n[e]*=t,n[e+1]*=t,n[e+2]*=t}return[n,t,i]}e.addColorStops=function(e,t){const{colorRamp:i,gradientType:r}=t,n=c(i),o="CIMFixedColorRamp"===i.type;if("Continuous"===r&&!o)return h(e,n);const a=t.interval??s.defaultCIMValues.CIMGradientFill.interval;if(o)return h(e,u(n,a));const f=[];l??=document.createElement("canvas"),d(l,n,a,1,0);const p=l.getContext("2d").getImageData(0,0,a,1).data;for(let e=0,t=0;e<a;e++,t=4*e){const i=[p[t+0],p[t+1],p[t+2],p[t+3]];f.push({offset:e/a,color:i}),f.push({offset:(e+1)/a,color:i})}return h(e,f)},e.rasterizeDash=function(e,i){null==e&&(e=[]);const r="Butt"===i,s="Square"===i,o=!r&&!s;e.length%2==1&&(e=[...e,...e]);const a=n.dashRadius,l=2*a;let c=0;for(const t of e)c+=t;const u=Math.round(c*a),h=new Float32Array(u*l),d=.5*a;let f=0,p=0,m=.5,g=!0;for(const t of e){for(f=p,p+=t*a;m<=p;){let e=.5;for(;e<l;){const t=(e-.5)*u+m-.5,i=o?(e-a)*(e-a):Math.abs(e-a);h[t]=g?r?Math.max(Math.max(f+d-m,i),Math.max(m-p+d,i)):i:o?Math.min((m-f)*(m-f)+i,(m-p)*(m-p)+i):s?Math.min(Math.max(m-f,i),Math.max(p-m,i)):Math.min(Math.max(m-f+d,i),Math.max(p+d-m,i)),e++}m++}g=!g}const _=h.length,y=new Uint8Array(4*_);for(let e=0;e<_;++e){const i=(o?Math.sqrt(h[e]):h[e])/a;t.packFloatRGBA(i,y,4*e)}return[y,u,l]},e.rasterizeDash1D=function(e){e.length%2==1&&(e=[...e,...e]);const i=e.reduce((e,t)=>e+t,0),r=Math.round(i*n.dashSdfRasterizationScale),s=new Float32Array(1*r);let o=0,a=0,l=.5,c=!0;for(const t of e){for(o=a,a+=t*n.dashSdfRasterizationScale;l<=a;){const e=l-.5,t=Math.min(Math.abs(l-o),Math.abs(l-a));s[e]=c?-t:t,l++}c=!c}const u=s.length,h=new Uint8Array(4*u);for(let e=0;e<u;++e){const i=s[e]/n.dashSdfRasterizationScale/n.dashSdfDistanceNormalization*.5+.5;t.packFloatRGBA(i,h,4*e)}return[h,r,1]},e.rasterizeFillStyle=function(e,t,i){const n=t.style,s=r.nextPowerOfTwo(Math.ceil(i)),o=(e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e)(n)?8*s:16*s,a=2*s;e.width=o,e.height=o;const l=e.getContext("2d");l.strokeStyle="#ffffff",l.lineWidth=s,l.beginPath(),"vertical"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSVertical"!==n||(l.moveTo(o/2,-a),l.lineTo(o/2,o+a)),"horizontal"!==n&&"cross"!==n&&"esriSFSCross"!==n&&"esriSFSHorizontal"!==n||(l.moveTo(-a,o/2),l.lineTo(o+a,o/2)),"backward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSDiagonalCross"!==n&&"esriSFSBackwardDiagonal"!==n||(l.moveTo(-a,-a),l.lineTo(o+a,o+a),l.moveTo(o-a,-a),l.lineTo(o+a,a),l.moveTo(-a,o-a),l.lineTo(a,o+a)),"forward-diagonal"!==n&&"diagonal-cross"!==n&&"esriSFSForwardDiagonal"!==n&&"esriSFSDiagonalCross"!==n||(l.moveTo(o+a,-a),l.lineTo(-a,o+a),l.moveTo(a,-a),l.lineTo(-a,a),l.moveTo(o+a,o-a),l.lineTo(o-a,o+a)),l.stroke();const c=l.getImageData(0,0,e.width,e.height),u=new Uint8Array(c.data);let h;for(let e=0;e<u.length;e+=4)h=u[e+3]/255,u[e]=u[e]*h,u[e+1]=u[e+1]*h,u[e+2]=u[e+2]*h;return[u,e.width,e.height,s]},e.rasterizeGradient=function(e,t){const{colorRamp:i,gradientType:r}=t,n="CIMFixedColorRamp"===i.type,a=t.interval||s.defaultCIMValues.CIMGradientFill.interval;let l=c(i);return n&&(l=u(l,a)),"Discrete"===r||n?function(e,t,i){return d(e,t,i,1,o.gradientTextureExternalPadding),f(e)}(e,l,a):function(e,t){return d(e,t,32,1,o.gradientTextureExternalPadding),f(e)}(e,l)},e.scale=function(e,t){const i=function(e){const t=e[0]?.[0]?.[0]??0,i=e[0]?.[0]?.[1]??0,r={ymin:i,xmin:t,ymax:i,xmax:t,width:0,height:0};for(let t=0;t<e.length;t++){const i=e[t];for(let e=0;e<i.length;e++){const t=i[e][0],n=i[e][1];t<r.xmin&&(r.xmin=t),t>r.xmax&&(r.xmax=t),n<r.ymin&&(r.ymin=n),n>r.ymax&&(r.ymax=n)}}return r.width=Math.abs(r.xmax-r.xmin),r.height=Math.abs(r.ymax-r.ymin),r}(e),r=0===i.width?1:i.width,n=0===i.height?1:i.height,s=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];for(let e=0;e<a.length;e++){let s=Math.round(a[e][0]-i.xmin),o=Math.round(a[e][1]-i.ymin);if(s=t.xmin+s*t.width/r,o=t.ymin+o*t.height/n,isNaN(s)||isNaN(o))throw new Error("Scaled shape has NaN values");l.push([s,o])}s.push(l)}return s},e.translate=function(e,t,i){const r=[];for(let n=0;n<e.length;n++){const s=e[n],o=[];for(let e=0;e<s.length;e++){const r=s[e][0]+t,n=s[e][1]+i;if(isNaN(r)||isNaN(n))throw new Error("Scaled shape has NaN values");o.push([r,n])}r.push(o)}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/constants":function(){define(["exports","./defaultCIMValues"],function(e,t){"use strict";const i={outlineWidth:.75,referenceWidth:.75,cap:t.defaultCIMValues.CIMSolidStroke.capstyle,join:t.defaultCIMValues.CIMSolidStroke.joinstyle,miterLimit:t.defaultCIMValues.CIMSolidStroke.miterlimit};e.antialiasingOutlineFillSettings=i,e.dashRadius=15.5,e.dashSdfDistanceNormalization=64,e.dashSdfRasterizationScale=4,e.maxTileCoordValue=1024,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(e,t){"use strict";function i(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}function r(t,i){const r=Math.max(i.size,.5),n=i.font,s=`${n.style} ${n.weight} ${e.pt2px(r).toFixed(1)}px ${n.family}, sans-serif`;let o;switch(t.font=s,t.textBaseline="top",i.horizontalAlignment){case"left":default:o="left";break;case"right":o="right";break;case"center":o="center"}t.textAlign=o}return class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,n){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const s=this._textRasterizationCanvas,o=s.getContext("2d",{willReadFrequently:!0});r(o,n),this._parameters=n,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:a,weight:l}=n.font;this._lineThroughWidthOffset=a&&"line-through"===a?.1*this._lineHeight:0;const c=null!=n.backgroundColor||null!=n.borderLine,u=c?t.backgroundPadding:0,h=this._computeTextWidth(o,n)+2*u,d=this._lineHeight*this._textLines.length+2*u;if(s.width=h+2*this._lineThroughWidthOffset,s.height=d,0===s.width||0===s.height)return s.width=s.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:s};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(n.outline.size||0)*n.pixelRatio,this._renderedHaloSize=(n.halo.size||0)*n.pixelRatio,this._renderedWidth=h,this._renderedHeight=d,this._lineThroughWidthOffset*=n.pixelRatio;const f=(n.outline&&n.outline.color)??[0,0,0,0],p=n.color??[0,0,0,0],m=n.halo&&n.halo.color?n.halo.color:[0,0,0,0];this._fillStyle=i(p),this._outlineStyle=i(f),this._haloStyle=`rgb(${m.slice(0,3).toString()})`;const g=this._renderedLineHeight,_=this._renderedOutlineSize,y=this._renderedHaloSize;o.save(),o.clearRect(0,0,s.width,s.height),r(o,n);const x=u*n.pixelRatio,b=function(e,t,i){return"center"===e?.5*t:"right"===e?t-i:i}(o.textAlign,this._renderedWidth-2*x,this._renderedHaloSize+this._renderedOutlineSize)+x,v=y+_+x,S=y>0;let w=this._lineThroughWidthOffset,T=0;if(c){o.save();const e=n.backgroundColor??[0,0,0,0],t=n.borderLine?.color??[0,0,0,0],r=2*(n.borderLine?.size??0);o.fillStyle=i(e),o.strokeStyle=i(t),o.lineWidth=r,o.fillRect(0,0,s.width,s.height),o.strokeRect(0,0,s.width,s.height),o.restore()}S&&this._renderHalo(o,b,v,w,T,n),_>0&&this._renderOutline(o,b,v,w,T,n),T+=v,w+=b;for(const e of this._textLines)S?(o.globalCompositeOperation="destination-out",o.fillStyle="rgb(0, 0, 0)",o.fillText(e,w,T),o.globalCompositeOperation="source-over",o.fillStyle=this._fillStyle,o.fillText(e,w,T)):(o.fillStyle=this._fillStyle,o.fillText(e,w,T)),a&&"none"!==a&&this._renderDecoration(o,w,T,a,l),T+=g;o.restore();const M=this._renderedWidth+2*this._lineThroughWidthOffset,P=this._renderedHeight,I=o.getImageData(0,0,M,P),C=new Uint8Array(I.data);if(n.premultiplyColors){let e;for(let t=0;t<C.length;t+=4)e=C[t+3]/255,C[t]=C[t]*e,C[t+1]=C[t+1]*e,C[t+2]=C[t+2]*e}let F,O;switch(n.horizontalAlignment){case"left":F=-.5;break;case"right":F=.5;break;default:F=0}switch(n.verticalAlignment){case"bottom":O=-.5;break;case"top":O=.5;break;case"baseline":O=-1/6;break;default:O=0}return{size:[M,P],image:new Uint32Array(C.buffer),sdf:!1,simplePattern:!1,anchorX:F,anchorY:O,canvas:s}}_renderHalo(e,t,i,n,s,o){const a=this._renderedWidth,l=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=a,this._outlineRasterizationCanvas.height=l;const c=this._outlineRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),r(u,o);const{decoration:h,weight:d}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderOutlineNative(u,t,i,h,d,this._renderedHaloSize+this._renderedOutlineSize),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,n,s,a,l),e.globalAlpha=1}_renderOutline(e,t,i,n,s,o){const a=this._renderedWidth,l=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=a,this._outlineRasterizationCanvas.height=l;const c=this._outlineRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),r(u,o);const{decoration:h,weight:d}=o.font;u.fillStyle=this._outlineStyle,u.strokeStyle=this._outlineStyle,u.lineJoin="round",this._renderOutlineNative(u,t,i,h,d,this._renderedOutlineSize),e.globalAlpha=this._parameters.outline.color[3],e.drawImage(c,0,0,a,l,n,s,a,l),e.globalAlpha=1}_renderOutlineNative(e,t,i,r,n,s){const o=this._renderedLineHeight;for(const a of this._textLines){const l=2*s,c=5,u=.1;for(let s=0;s<c;s++){const o=(1-(c-1)*u+s*u)*l;e.lineWidth=o,e.strokeText(a,t,i),r&&"none"!==r&&this._renderDecoration(e,t,i,r,n,o)}i+=o}}computeTextSize(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const i=this._textRasterizationCanvas,n=i.getContext("2d");r(n,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const s=this._computeTextWidth(n,t),o=this._lineHeight*this._textLines.length;return i.width=s,i.height=o,[s*t.pixelRatio,o*t.pixelRatio]}_computeTextWidth(t,i){let r=0;for(const e of this._textLines)r=Math.max(r,t.measureText(e).width);const n=i.font;return("italic"===n.style||"oblique"===n.style||"string"==typeof n.weight&&("bold"===n.weight||"bolder"===n.weight)||"number"==typeof n.weight&&n.weight>600)&&(r+=.3*t.measureText("w").width),r+=2*e.pt2px(this._parameters.halo.size),Math.round(r)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let t=this._computeLineHeightBase();const i=this._parameters.font.decoration;return i&&"underline"===i&&(t*=1.3),Math.round(t+2*e.pt2px(this._parameters.halo.size))}_renderDecoration(e,t,i,r,n,s){let o=.9*this._lineHeight;const a="bold"===n?.06:"bolder"===n?.09:.04;switch(e.textAlign){case"center":t-=this._renderedWidth/2;break;case"right":t-=this._renderedWidth}const l=e.textBaseline;if("underline"===r)switch(o=.9*this._computeLineHeightBase(),l){case"top":i+=o;break;case"middle":i+=o/2}else if("line-through"===r)switch(l){case"top":i+=o/1.5;break;case"middle":i+=o/3}const c=s?1.5*s:Math.ceil(o*a);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=c,e.moveTo(t-this._lineThroughWidthOffset,i),e.lineTo(t+this._renderedWidth+2*this._lineThroughWidthOffset,i),e.stroke(),e.restore()}}})},"esri/views/2d/engine/svgUtils":function(){define(["exports"],function(e){"use strict";function t(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}e.createHiddenSvg=function(){const e=t("svg");return e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),e},e.createSvgElement=t,e.destroyHiddenSvg=function(e){return null!=e&&document.body.removeChild(e),null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat2d","../../../../../../core/libs/gl-matrix-2/factories/mat2df32","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../core/libs/gl-matrix-2/factories/vec2f32","../../alignmentUtils","../../Rect","../../collisions/BoundingBox"],function(e,t,i,r,n,s,o,a){"use strict";const l=Math.PI/180;class c{constructor(e,t,r,n){this._rotationT=i.create(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const s=r.rect,o=new Float32Array(8);e*=n,t*=n;const a=r.code?s.width*n:r.metrics.width,l=r.code?s.height*n:r.metrics.height;this.width=a,this.height=l,o[0]=e,o[1]=t,o[2]=e+a,o[3]=t,o[4]=e,o[5]=t+l,o[6]=e+a,o[7]=t+l,this._data=o,this._setTextureCoords(s),this._scale=n,this._mosaic=r,this.x=e,this.y=t,this.maxOffset=Math.max(e+a,t+l)}get mosaic(){return this._mosaic}set angle(e){this._angle=e,t.fromRotation(this._rotationT,-e),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:e,width:r}=this._mosaic.metrics,n=r*this._scale,s=Math.abs(e)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+n,o[3]=this.y,o[4]=this.x,o[5]=this.y+s,o[6]=this.x+n,o[7]=this.y+s;const l=t.multiply(i.create(),this._rotationT,this._transform);i.transformMany(o,o,l);let c=1/0,u=1/0,h=-1/0,d=-1/0;for(let e=0;e<4;e++){const t=o[2*e],i=o[2*e+1];c=Math.min(c,t),u=Math.min(u,i),h=Math.max(h,t),d=Math.max(d,i)}const f=h-c,p=d-u,m=c+f/2,g=u+p/2;this._bounds=new a(m,g,f,p)}return this._bounds}setTransform(e){this._transform=e,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const e=t.multiply(i.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],r.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,e),r.transformMat2d(this._offsets.topRight,this._offsets.topRight,e),r.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,e),r.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,e)}_setTextureCoords({x:e,y:t,width:i,height:r}){this._texcoords={topLeft:[e,t],topRight:[e+i,t],bottomLeft:[e,t+r],bottomRight:[e+i,t+r]}}}const u=(e,t)=>({code:0,page:0,sdf:!0,rect:new o(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});function h(e,t){return e.forEach(e=>r.transformMat2d(e,e,t)),{topLeft:e[0],topRight:e[1],bottomLeft:e[2],bottomRight:e[3]}}class d{constructor(e,t,i){this._rotation=0,this._decorate(e,t,i),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=0!==i.angle,this._transform=this._createGlyphTransform(this.bounds,i),this._borderLineSizePx=i.borderLineSizePx,(i.borderLineSizePx||i.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const t of e)t.setTransform(this._transform)}setRotation(e){if(0===e&&0===this._rotation)return;this._rotation=e;const r=this._transform,n=t.fromRotation(i.create(),e);t.multiply(r,n,r);for(const e of this.glyphs)e.setTransform(this._transform)}_decorate(e,t,i){if(!i.decoration||"none"===i.decoration||!e.length)return;const r=i.scale,n="underline"===i.decoration?26:16,s=e[0].textureBinding;for(const i of t){const t=i.startX*r,o=i.startY*r,a=(i.width+i.glyphWidthEnd)*r;e.push(new c(t,o+n*r,u(a,s),1))}}shapeBackground(e){const t=(1.5+(this._borderLineSizePx||0))/2,i=this._borderLineSizePx?t:0,{xmin:r,ymin:n,xmax:s,ymax:o,x:l,y:c,width:u,height:d}=this.bounds,f=[r-8,n-8],p=[s+8,n-8],m=[r-8,o+8],g=[s+8,o+8],_=h([[f[0]-t,f[1]-t],[p[0]+t,p[1]-t],[f[0]+i,f[1]+i],[p[0]-i,p[1]+i]],e),y=h([[m[0]+i,m[1]-i],[g[0]-i,g[1]-i],[m[0]-t,m[1]+t],[g[0]+t,g[1]+t]],e),x=h([[f[0]-t,f[1]-t],[f[0]+i,f[1]+i],[m[0]-t,m[1]+t],[m[0]+i,m[1]-i]],e),b=h([[p[0]-i,p[1]+i],[p[0]+t,p[1]-t],[g[0]-i,g[1]-i],[g[0]+t,g[1]+t]],e),v={main:h([f,p,m,g],e),top:_,bot:y,left:x,right:b};return[new a(l,c,u+2*t,d+2*t),v]}get boundsT(){const e=this.bounds,t=r.set(n.create(),e.x,e.y);if(r.transformMat2d(t,t,this._transform),this._hasRotation){const i=Math.max(e.width,e.height);return new a(t[0],t[1],i,i)}return new a(t[0],t[1],e.width,e.height)}_createBounds(e){let t=1/0,i=1/0,r=0,n=0;for(const s of e)t=Math.min(t,s.xTopLeft),i=Math.min(i,s.yTopLeft),r=Math.max(r,s.xBottomRight),n=Math.max(n,s.yBottomRight);const s=r-t,o=n-i;return new a(t+s/2,i+o/2,s,o)}_createGlyphTransform(e,s){const o=l*s.angle,a=i.create(),c=n.create();return t.translate(a,a,r.set(c,s.xOffset,-s.yOffset)),s.useCIMAngleBehavior?t.rotate(a,a,o):(t.translate(a,a,r.set(c,e.x,e.y)),t.rotate(a,a,o),t.translate(a,a,r.set(c,-e.x,-e.y))),a}}class f{constructor(e,t,i,r,n,s){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,i)),this.end=Math.max(0,Math.max(t,i)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=r,this.yMin=n,this.yMax=s}}const p=e=>10===e,m=e=>32===e;e.ShapedGlyph=c,e.ShapingInfo=d,e.shapeGlyphs=function(e,t){const i=t.scale,r=new Array,{glyphs:n,isRightToLeft:o}=e,a=function(e,t,i){const r=new Array,n=1/i.scale,s=i.maxLineWidth*n,o=t?e.length-1:0,a=t?-1:e.length,l=t?-1:1;let c=o,u=0,h=0,d=c,g=d,_=0,y=1/0,x=0;for(;c!==a;){const{code:t,metrics:i}=e[c],n=Math.abs(i.top);if(p(t)||m(t)||(y=Math.min(y,n),x=Math.max(x,n+i.height)),p(t))c!==o&&(r.push(new f(e,d,c-l,u,y===1/0?0:y,x)),y=1/0,x=0),u=0,d=c+l,g=c+l,h=0;else if(m(t))g=c+l,h=0,_=i.advance,u+=i.advance;else if(u>s){if(g!==d){const t=g-2*l;u-=_,r.push(new f(e,d,t,u-h,y,x)),y=1/0,x=0,d=g,u=h}else r.push(new f(e,d,c-l,u,y,x)),y=1/0,x=0,d=c,g=c,u=0;u+=i.advance,h+=i.advance}else u+=i.advance,h+=i.advance;c+=l}const b=new f(e,d,c-l,u,y,x);return b.start>=0&&b.end<e.length&&r.push(b),r}(n,o,t),l=a.length?function(e,t){let i=0;for(let t=0;t<e.length;t++){const{width:r}=e[t];i=Math.max(r,i)}const r="underline"===t.decoration?4:0,n=e[0].yMin;return{x:0,y:n,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+r-n,width:i}}(a,t):{y:0,height:0},u=s.getXAnchorDirection(t.horizontalAlignment),h=s.getYAnchorDirection(t.verticalAlignment),g=2===h?1:0,_=g?0:h-1,y=(1-g)*-l.y+_*(l.height/2)+-22*(g?1:0);for(let s=0;s<a.length;s++){const{start:o,end:l,width:h}=a[s];let d=-1*(u+1)*(h/2)-3;const f=(e.isRightToLeft?a.length-1-s:s)*t.lineHeight+y-3;a[s].startX=d,a[s].startY=f;for(let e=o;e<=l;e++){const t=n[e];if(p(t.code))continue;const s=new c(d+t.metrics.left,f-t.metrics.top,t,i);d+=t.metrics.advance,r.push(s)}}return new d(r,a,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports","../../../../core/Logger"],function(e,t){"use strict";e.getAlignmentFromPlacement=function(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${e}`),["center","middle"]}},e.getXAnchorDirection=function(e){if(!e)return 0;switch(e){case"Left":case"left":return-1;case"Right":case"right":return 1;case"Justify":return t.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),0;case"Center":case"center":return 0}},e.getXDirection=function(e){switch(e){case 1:case"right":return-1;case 0:case"center":return 0;case-1:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}},e.getYAnchorDirection=function(e){if(!e)return 0;switch(e){case"Top":case"top":return 1;case"Center":case"middle":return 0;case"Baseline":case"baseline":return 2;case"Bottom":case"bottom":return-1}},e.getYDirection=function(e){switch(e){case 1:case"top":return 1;case 0:case"middle":return 0;case-1:case 2:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Rect":function(){define(function(){"use strict";return class{constructor(e=0,t=0,i=0,r=0){this.x=e,this.y=t,this.width=i,this.height=r}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],function(e){"use strict";class t{constructor(t,i,r,n){this.transformedX=0,this.transformedY=0,this.center=e.fromValues(t,i),this.centerT=e.create(),this.halfWidth=r/2,this.halfHeight=n/2,this.width=r,this.height=n}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new t(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){const i=Math.abs(e.centerT[0]-this.centerT[0]),r=Math.abs(e.centerT[1]-this.centerT[1]),n=(e.halfWidth+this.halfWidth+t)/i,s=(e.halfHeight+this.halfHeight+t)/r,o=Math.min(n,s);return Math.log2(o)}extend(e){const t=Math.min(this.xmin,e.xmin),i=Math.min(this.ymin,e.ymin),r=Math.max(this.xmax,e.xmax)-t,n=Math.max(this.ymax,e.ymax)-i,s=t+r/2,o=i+n/2;this.width=r,this.height=n,this.halfWidth=r/2,this.halfHeight=n/2,this.x=s,this.y=o}static deserialize(e){const i=e.readF32(),r=e.readF32(),n=e.readInt32(),s=e.readInt32();return new t(i,r,n,s)}}return t})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define(["exports","../../../../core/screenUtils","../../../../geometry/Polygon","../../engine/webgl/definitions"],function(e,t,i,r){"use strict";e.getLineWidth=function(e){const i=t.px2pt(r.minTextLineWidth),n=t.px2pt(r.maxTextLineWidth);return Math.max(i,Math.min(e||n,n))},e.pixelBuffer=50,e.polygonFromExtent=function(e){if(!e)return null;const{xmin:t,ymin:r,xmax:n,ymax:s,spatialReference:o}=e;return new i({rings:[[[t,r],[t,s],[n,s],[n,r],[t,r]]],spatialReference:o})},e.roundPtToWholePixel=function(e){return t.px2pt(Math.round(t.pt2px(e)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports","../../../../geometry/support/coordsUtils","../../../../geometry/support/TileClipper"],function(e,t,i){"use strict";const r=Number.POSITIVE_INFINITY,n=Math.PI,s=2*n,o=128/n,a=256/360,l=n/180,c=1/Math.LN2;function u(e,t){return(e%=t)>=0?e:e+t}e.between=function(e,t,i){return e>=t&&e<=i||e>=i&&e<=t},e.c2pi=s,e.cDegTo256=a,e.cDegToRad=l,e.cInfinity=r,e.cPi=n,e.cRadTo256=o,e.degToByte=function(e){return u(e*a,256)},e.distanceFromToPolylineWithinThreshold=function(e,i,r,n){let s,o,a,l;const c=n*n;for(const n of r){const r=n.length;if(!(r<2)){s=n[0].x,o=n[0].y;for(let u=1;u<r;++u){if(a=n[u].x,l=n[u].y,t.distanceToSegmentSquared(e,i,s,o,a,l)<c)return!0;s=a,o=l}}}return!1},e.getTileMargins=function(e){return 8+Math.max(16*(e-14),0)},e.interpolate=function(e,t,i){return e*(1-i)+t*i},e.isCircleOverlapingRect=function(e,t,i,r,n,s,o){const a=Math.max(r,Math.min(t,s))-t,l=Math.max(n,Math.min(i,o))-i;return a*a+l*l<=e*e},e.log2=function(e){return Math.log(e)*c},e.offsetLine=function(e,t){if(0===t||Number.isNaN(t))return e;const r=[],n=new i.Point(0,0),s=new i.Point(0,0),o=new i.Point(0,0);for(let a=0;a<e.length;a++){const l=e[a],c=[];for(let e=0;e<l.length;e++){const r=l[e-1],a=l[e],u=l[e+1];0===e?n.setCoords(0,0):n.assignSub(a,r).normalize().rightPerpendicular(),e===l.length-1?s.setCoords(0,0):s.assignSub(u,a).normalize().rightPerpendicular(),o.assignAdd(n,s).normalize();const h=o.x*s.x+o.y*s.y;0!==h&&o.scale(1/h),c.push(i.Point.add(a,o.scale(t)))}r.push(c)}return r},e.pointInPolygon=function(e,t,i){let r,n,s,o=0;for(const a of i){r=a.length;for(let i=1;i<r;++i)n=a[i-1],s=a[i],n.y>t!=s.y>t&&((s.x-n.x)*(t-n.y)-(s.y-n.y)*(e-n.x)>0?o++:o--)}return 0!==o},e.positiveMod=u,e.radToByte=function(e){return u(e*o,256)},e.sqr=function(e){return e*e},e.translateAnchor=function(e,t,r,n){const s=new i.Point(e[0],e[1]);if(s.scale(n),"viewport"===t){const e=-r*(Math.PI/180),t=Math.cos(e),i=Math.sin(e);s.rotate(t,i)}return s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/fitVectorMarker":function(){define(["exports","../../core/lang","./SDFHelper","./effects/CIMEffectHelper"],function(e,t,i,r){"use strict";e.fitVectorMarker=function(e){if(!e.frame)return e;const{markerGraphics:n}=e;if(!n||0===n.length)return e;let s=0,o=0,a=0,l=0;for(const e of n){const{geometry:t,symbol:n}=e;if(!t||!n||!("symbolLayers"in n))continue;const{symbolLayers:c}=n;if(c)for(const e of c){const{effects:n}=e,c=r.CIMEffectHelper.applyEffects(n,t),u=i.getExtent(c);u&&(s=Math.min(s,u[0]),o=Math.min(o,u[1]),a=Math.max(a,u[2]),l=Math.max(l,u[3]))}}const{xmin:c,ymin:u,xmax:h,ymax:d}=e.frame,f=(h-c)/2,p=(d-u)/2,m=(h+c)/2,g=(d+u)/2;if(f<=0||p<=0)return e;const _=(m-s)/f,y=(a-m)/f,x=(g-o)/p,b=(l-g)/p,v=Math.max(Math.max(_,y),Math.max(x,b));return v<=1.01?e:(e=t.clone(e)).frame?(e.frame.xmin=(e.frame.xmin-m)*v+m,e.frame.ymin=(e.frame.ymin-g)*v+g,e.frame.xmax=(e.frame.xmax-m)*v+m,e.frame.ymax=(e.frame.ymax-g)*v+g,!1!==e.respectFrame&&(e.size*=v),e):e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMEffects","../CIMOperators","../CIMSymbolHelper"],function(e,t,i,r,n,s){"use strict";const o=96/72;e.CIMEffectHelper=class{static executeEffects(e,t,i,a){const l=o,c=s.getEffectsInflateSize(e);let u=new r.SimpleEffectCursor(t);for(const t of e){const e=n.getEffectOperator(t);e&&(u=e.execute(u,t,l,i,c,a))}return u}static applyEffects(e,o){if(!e)return o;const a=s.getEffectsInflateSize(e);let l,c=new r.SimpleEffectCursor(t.GeometryCursor.fromJSONCIM(o));for(const t of e){const e=n.getEffectOperator(t);e&&(c=e.execute(c,t,1,null,a,!1))}const u=[];let h=null;for(;l=c.next();)u.push(...i.collectMultipath(l)),h=l.geometryType;return 0===u.length||null===h?null:"esriGeometryPolygon"===h?{rings:u}:{paths:u}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/OverrideHelper":function(){define(["exports","../../Color","../../core/colorUtils","../../core/lang","../../layers/support/FieldsIndex","../../support/ArcadeExpression","./utils","../../views/2d/arcade/callExpressionWithFeature"],function(e,t,i,r,n,s,o,a){"use strict";const l=e=>{if(!e)return[0,0,0,0];const{r:t,g:i,b:r,a:n}=e;return[t,i,r,255*n]};class c{static findApplicableOverrides(e,t,i){if(e&&t){if(e.primitiveName){let r=!1;for(const t of i)if(t.primitiveName===e.primitiveName){r=!0;break}if(!r)for(const r of t)r.primitiveName===e.primitiveName&&i.push(r)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const r of e.effects)c.findApplicableOverrides(r,t,i);if(e.symbolLayers)for(const r of e.symbolLayers)c.findApplicableOverrides(r,t,i);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":case"CIMVectorMarker":case"CIMCharacterMarker":case"CIMPictureMarker":if(e.effects)for(const r of e.effects)c.findApplicableOverrides(r,t,i);if(e.markerPlacement&&c.findApplicableOverrides(e.markerPlacement,t,i),"CIMVectorMarker"===e.type){if(e.markerGraphics)for(const r of e.markerGraphics)c.findApplicableOverrides(r,t,i),c.findApplicableOverrides(r.symbol,t,i)}else"CIMCharacterMarker"===e.type?c.findApplicableOverrides(e.symbol,t,i):"CIMHatchFill"===e.type?c.findApplicableOverrides(e.lineSymbol,t,i):"CIMPictureMarker"===e.type&&c.findApplicableOverrides(e.animatedSymbolProperties,t,i)}}}static findEffectOverrides(e,t){if(!e)return null;if("CIMGeometricEffectDashes"===e.type&&o.normalizeDashEffectTemplate(e),!t||!e.primitiveName)return{type:"cim-effect-param",effect:e,overrides:[]};const i=o.toLowerCaseProps(e),r=e.primitiveName,n=[];for(const e of t)e.primitiveName===r&&n.push(o.toLowerCaseProps(e));return{type:"cim-effect-param",effect:i,overrides:o.normalizePrimitiveOverrideProps(n)}}static async resolveSymbolOverrides(e,t,i,s,a,l,u){if(!e?.symbol)return null;let{symbol:h,primitiveOverrides:d}=e;const f=!!d;if(!f&&!s)return h;h=r.clone(h),d=r.clone(d);let p=!0;if(t||(t={attributes:{}},p=!1),f){if(p||(d=d.filter(e=>!e.valueExpressionInfo?.expression.includes("$feature"))),u||(d=d.filter(e=>!e.valueExpressionInfo?.expression.includes("$view"))),d.length>0){const e=o.attributesToFields(t.attributes),r={spatialReference:i,fields:e,geometryType:a};await c.createRenderExpressions(d,r),c.evaluateOverrides(d,t,a??"esriGeometryPoint",l,u,new n(e))}c.applyOverrides(h,d)}return s&&c.applyDictionaryTextOverrides(h,t,s,null),h}static{this._expressionToRenderExpression=new Map}static async createRenderExpressions(e,t){const i=[];for(const r of e){const e=r.valueExpressionInfo;if(!e||c._expressionToRenderExpression.has(e.expression))continue;const n=s.createRendererExpression(e.expression,t.spatialReference);i.push(n),n.then(t=>c._expressionToRenderExpression.set(e.expression,t))}i.length>0&&await Promise.all(i)}static evaluateOverrides(e,t,r,n,s,o){const u={$view:{scale:s?.scale}};for(const s of e){s.value&&"object"==typeof s.value&&i.isRGB(s.value)&&("Color"===s.propertyName||"StrokeColor"===s.propertyName)&&(s.value=l(s.value));const e=s.valueExpressionInfo;if(!e)continue;const h=c._expressionToRenderExpression.get(e.expression);h&&(s.value=a(h,t,u,r,o,n))}}static applyDictionaryTextOverrides(e,t,i,r,n="Normal"){if(e?.type)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":case"CIMTextSymbol":{const s=e.symbolLayers;if(!s)return;for(const o of s)o&&"CIMVectorMarker"===o.type&&c.applyDictionaryTextOverrides(o,t,i,r,"CIMTextSymbol"===e.type?e.textCase:n)}break;case"CIMVectorMarker":{const n=e.markerGraphics;if(!n)return;for(const e of n)e&&c.applyDictionaryTextOverrides(e,t,i,r)}break;case"CIMMarkerGraphic":{const s=e.textString;if(s&&s.includes("[")){const a=o.analyzeTextParts(s,i);e.textString=o.assignTextValuesFromFeature(t,a,r,n)}}}}static applyOverrides(e,t,i,r){if(e.primitiveName)for(const n of t)if(n.primitiveName===e.primitiveName){const t=o.uncapitalize(n.propertyName);if(r&&r.push({cim:e,nocapPropertyName:t,value:e[t]}),i){let t=!1;for(const r of i)r.primitiveName===e.primitiveName&&(t=!0);t||i.push(n)}null!=n.value&&(e[t]=n.value)}switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(e.effects)for(const n of e.effects)c.applyOverrides(n,t,i,r);if(e.symbolLayers)for(const n of e.symbolLayers)c.applyOverrides(n,t,i,r);break;case"CIMTextSymbol":break;case"CIMSolidStroke":case"CIMSolidFill":case"CIMVectorMarker":if(e.effects)for(const n of e.effects)c.applyOverrides(n,t,i,r);if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const n of e.markerGraphics)c.applyOverrides(n,t,i,r),c.applyOverrides(n.symbol,t,i,r)}}static restoreOverrides(e){for(const t of e)t.cim[t.nocapPropertyName]=t.value}static buildOverrideKey(e){let t="";for(const i of e)void 0!==i.value&&(t+=`${i.primitiveName}${i.propertyName}${JSON.stringify(i.value)}`);return t}static toValue(e,i){if("DashTemplate"===e)return i.split(" ").map(e=>Number(e));if("Color"===e){const e=new t(i).toRgba();return e[3]*=255,e}return i}}e.OverrideHelper=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(e,t,i){"use strict";const r=new Map;return function(n,s,o,a,l,c){if(null==n)return null;const u=n.references("geometry")&&c?function(n,s,o){const{transform:a,hasZ:l,hasM:c}=o;r.has(s)||r.set(s,function(r){const n={};switch(r){case"esriGeometryPoint":return(e,t,r,s)=>i.unquantizePoint(t,n,e,r,s);case"esriGeometryPolygon":return(e,t,r,s)=>i.unquantizePolygon(t,n,e,r,s);case"esriGeometryPolyline":return(e,t,r,s)=>i.unquantizePolyline(t,n,e,r,s);case"esriGeometryMultipoint":return(e,t,r,s)=>i.unquantizeMultipoint(t,n,e,r,s);default:return t.getLogger("esri.views.2d.support.arcadeOnDemand").error(new e("mapview-arcade",`Unable to handle geometryType: ${r}`)),e=>e}}(s));const u=r.get(s)(n.geometry,a,l,c);return{...n,geometry:u}}(s,a,c):s,h=n.repurposeFeature(u,l);try{return n.evaluate(h,o)}catch(e){return t.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(e,t){"use strict";function i(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:i,translate:r}=e,n=i[0]??1,s=i[1]??1;return{originPosition:"lowerLeft",scale:[n,"lowerLeft"===t?s:-s,i[2]??1,i[3]??1],translate:[r[0]??0,r[1]??0,r[2]??0,r[3]??0]}}function r({scale:e,translate:t},i){return Math.round((i-t[0])/e[0])}function n({scale:e,translate:t},i){return Math.round((i-t[1])/e[1])}function s({scale:e,translate:t},i){return Math.round(((i??0)-t[2])/e[2])}function o({scale:e,translate:t},i){return i?Math.round((i-t[3])/e[3]):0}function a(e,t){return e&&t?h:e&&!t?c:!e&&t?u:l}const l=(e,t)=>{const i=[];if(!t.length)return null;const s=t[0];let o=r(e,s[0]),a=n(e,s[1]);i.push([o,a]);for(let s=1;s<t.length;s++){const[l,c]=t[s],u=r(e,l),h=n(e,c);u===o&&h===a||i.push([u-o,h-a]),o=u,a=h}return i},c=(e,t)=>{const i=[];if(!t.length)return null;const o=t[0];let a=r(e,o[0]),l=n(e,o[1]),c=s(e,o[2]);i.push([a,l,c]);for(let o=1;o<t.length;o++){const[u,h,d]=t[o],f=r(e,u),p=n(e,h),m=s(e,d);f===a&&p===l&&m===c||i.push([f-a,p-l,m]),a=f,l=p,c=m}return i},u=(e,t)=>{const i=[];if(!t.length)return null;const s=t[0];let a=r(e,s[0]),l=n(e,s[1]),c=o(e,s[2]);i.push([a,l,c]);for(let s=1;s<t.length;s++){const[u,h,d]=t[s],f=r(e,u),p=n(e,h),m=o(e,d);f===a&&p===l&&m===c||i.push([f-a,p-l,m]),a=f,l=p,c=m}return i},h=(e,t)=>{const i=[];if(!t.length)return null;const a=t[0];let l=r(e,a[0]),c=n(e,a[1]),u=s(e,a[2]),h=o(e,a[3]);i.push([l,c,u,h]);for(let a=1;a<t.length;a++){const[d,f,p,m]=t[a],g=r(e,d),_=n(e,f),y=s(e,p),x=o(e,m);g===l&&_===c&&y===u&&x===h||i.push([g-l,_-c,y,x]),l=g,c=_,u=y,h=x}return i};function d({scale:e,translate:t},i){return i*e[0]+t[0]}function f({scale:e,translate:t},i){return i*e[1]+t[1]}function p({scale:e,translate:t},i){return(i??0)*e[2]+t[2]}function m({scale:e,translate:t},i){return i?i*e[3]+t[3]:0}function g(e,t){return e&&t?b:e&&!t?y:!e&&t?x:_}const _=(e,t)=>{const i=new Array(t.length);if(!t.length)return i;const r=t[0];let n=d(e,r[0]),s=f(e,r[1]);i[0]=[n,s];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let e=1;e<t.length;e++){const[r,o]=t[e];n+=l*r,s+=c*o,i[e]=[n,s]}return i},y=(e,t)=>{const i=new Array(t.length);if(!t.length)return i;const r=t[0];let n=d(e,r[0]),s=f(e,r[1]);i[0]=[n,s,p(e,r[2])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let r=1;r<t.length;r++){const[o,a,u]=t[r];n+=l*o,s+=c*a,i[r]=[n,s,p(e,u)]}return i},x=(e,t)=>{const i=new Array(t.length);if(!t.length)return i;const r=t[0];let n=d(e,r[0]),s=f(e,r[1]);i[0]=[n,s,m(e,r[2])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let r=1;r<t.length;r++){const[o,a,u]=t[r];n+=l*o,s+=c*a,i[r]=[n,s,m(e,u)]}return i},b=(e,t)=>{const i=new Array(t.length);if(!t.length)return i;const r=t[0];let n=d(e,r[0]),s=f(e,r[1]);i[0]=[n,s,p(e,r[2]),m(e,r[3])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let r=1;r<t.length;r++){const[o,a,u,h]=t[r];n+=l*o,s+=c*a,i[r]=[n,s,p(e,u),m(e,h)]}return i};function v(e,t,i){const r=new Array(i.length);for(let n=0;n<i.length;n++)r[n]=t(e,i[n]);return r}function S(e,t,i){let[r,n]=i[0],s=Math.min(r,t[0]),o=Math.min(n,t[1]),a=Math.max(r,t[2]),l=Math.max(n,t[3]);for(let e=1;e<i.length;e++){const[t,c]=i[e];r+=t,n+=c,t<0&&(s=Math.min(s,r)),t>0&&(a=Math.max(a,r)),c<0?o=Math.min(o,n):c>0&&(l=Math.max(l,n))}return e[0]=s,e[1]=o,e[2]=a,e[3]=l,e}function w(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(let i=0;i<t.length;i++)S(e,e,t[i]);return e}function T(e,t,a){const l=i(e);return t.xmin=r(l,a.xmin),t.ymin=n(l,a.ymin),t.xmax=r(l,a.xmax),t.ymax=n(l,a.ymax),a.hasZ&&(t.zmin=s(l,a.zmin),t.zmax=s(l,a.zmax)),a.hasM&&(t.mmin=o(l,a.mmin),t.mmax=o(l,a.mmax)),t.hasZ=a.hasZ??!1,t.hasM=a.hasM??!1,t}function M(e,t,r){const n=i(e);return t.points=a(r.hasZ,r.hasM)(n,r.points)??[],t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t}function P(e,t,a){const l=i(e);return t.x=r(l,a.x),t.y=n(l,a.y),null!=a.z&&(t.z=s(l,a.z)),null!=a.m&&(t.m=o(l,a.m)),t}function I(e,t,r){const n=function(e,t,i,r){const n=[],s=a(i,r);for(let i=0;i<t.length;i++){const r=s(e,t[i]);r&&r.length>=3&&n.push(r)}return n.length?n:null}(i(e),r.rings,r.hasZ,r.hasM);return n?(t.rings=n,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}function C(e,t,r){const n=function(e,t,i,r){const n=[],s=a(i,r);for(let i=0;i<t.length;i++){const r=s(e,t[i]);r&&r.length>=2&&n.push(r)}return n.length?n:null}(i(e),r.paths,r.hasZ,r.hasM);return n?(t.paths=n,t.hasZ=r.hasZ??!1,t.hasM=r.hasM??!1,t):null}e.getQuantizedBoundsCoordsArray=S,e.getQuantizedBoundsCoordsArrayArray=w,e.getQuantizedBoundsPaths=function(e){return w([0,0,0,0],e)},e.getQuantizedBoundsPoints=function(e){const t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return S(t,t,e)},e.getQuantizedBoundsRings=function(e){return w([0,0,0,0],e)},e.normalizeTransform=i,e.quantizeBounds=function(e,t,s){const o=i(e);return t[0]=r(o,s[0]),t[3]=n(o,s[1]),t[2]=r(o,s[2]),t[1]=n(o,s[3]),t},e.quantizeCoordsArrayXY=l,e.quantizeCoordsArrayXYM=u,e.quantizeCoordsArrayXYZ=c,e.quantizeCoordsArrayXYZM=h,e.quantizeExtent=T,e.quantizeGeometry=function(e,i){return e&&i?t.isPoint(i)?P(e,{},i):t.isPolyline(i)?C(e,{},i):t.isPolygon(i)?I(e,{},i):t.isMultipoint(i)?M(e,{},i):t.isExtent(i)?T(e,{},i):null:null},e.quantizeM=o,e.quantizeMultipoint=M,e.quantizePoint=P,e.quantizePolygon=I,e.quantizePolyline=C,e.quantizeX=r,e.quantizeY=n,e.quantizeZ=s,e.toQuantizationTransform=function(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null},e.unquantizeBounds=function(e,t,r){const n=i(e);return r?(t[0]=d(n,r[0]),t[1]=f(n,r[3]),t[2]=d(n,r[2]),t[3]=f(n,r[1]),t):[d(n,t[0]),f(n,t[3]),d(n,t[2]),f(n,t[1])]},e.unquantizeCoordsArrayArray=v,e.unquantizeCoordsArrayXY=_,e.unquantizeCoordsArrayXYM=x,e.unquantizeCoordsArrayXYZ=y,e.unquantizeCoordsArrayXYZM=b,e.unquantizeExtent=function(e,t,r,n=r.hasZ??!1,s=r.hasM??!1){const o=i(e);return t.xmin=d(o,r.xmin),t.xmax=d(o,r.xmax),t.ymin=f(o,r.ymin),t.ymax=f(o,r.ymax),n&&(t.zmin=p(o,r.zmin),t.zmax=p(o,r.zmax)),s&&(t.mmin=m(o,r.mmin),t.mmax=m(o,r.mmax)),t.hasZ=n,t.hasM=s,t},e.unquantizeM=m,e.unquantizeMultipoint=function(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=i(e);t.points=g(n,s)(o,r.points),t.hasZ=n,t.hasM=s}return t},e.unquantizePoint=function(e,t,r,n=null!=r?.z,s=null!=r?.m){if(null==r)return t;const o=i(e);return t.x=d(o,r.x),t.y=f(o,r.y),n&&(t.z=p(o,r.z)),s&&(t.m=m(o,r.m)),t},e.unquantizePolygon=function(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=i(e);t.rings=v(o,g(n,s),r.rings),t.hasZ=n,t.hasM=s}return t},e.unquantizePolyline=function(e,t,r,n=r?.hasZ??!1,s=r?.hasM??!1){if(null!=r){const o=i(e);t.paths=v(o,g(n,s),r.paths),t.hasZ=n,t.hasM=s}return t},e.unquantizeX=d,e.unquantizeY=f,e.unquantizeZ=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Container":function(){define(["exports","../../../core/accessorSupport/tracking","../../../core/accessorSupport/tracking/SimpleObservable","../../../core/libs/gl-matrix-2/factories/mat3f32","../../../layers/effects/EffectView","./DisplayObject"],function(e,t,i,r,n,s){"use strict";class o extends s.DisplayObject{constructor(){super(...arguments),this._childrenSet=new Set,this._needsSort=!1,this._children=[],this._childrenObservable=new i.SimpleObservable,this._effectView=null,this._highlightGradient=null}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.requestRender()}get children(){return t.trackAccess(this._childrenObservable),this._children}get clips(){return this._clips}set clips(e){this._clips=e,this.children.forEach(t=>t.clips=e)}get computedEffects(){return this._effectView?.effects??null}get effect(){return this._effectView?.effect??""}set effect(e){(this._effectView||e)&&(this._effectView||(this._effectView=new n.EffectView,this.addTransitionable(this._effectView)),this._effectView.effect=e,this.requestRender())}get highlightGradient(){return this._highlightGradient}set highlightGradient(e){this._highlightGradient=e,this.requestRender()}get hasBlending(){return!!this.blendMode}get hasHighlight(){return this.children.some(e=>e.hasHighlight)}get hasLabels(){return this.children.some(e=>e.hasLabels)}get requiresDedicatedFBO(){return this.children.some(e=>"blendMode"in e&&e.blendMode&&"normal"!==e.blendMode)}get isReady(){return this.children.every(e=>e.isReady)}get sortFunction(){return this._sortFunction}set sortFunction(e){this._sortFunction=e,e&&(this._needsSort=!0)}doRender(e){const t=this.createRenderParams(e),{painter:i}=t;i.beforeRenderLayer(t,this._clips?.length?255:0,this.computedOpacity),this.renderChildren(t),i.afterRenderLayer(t,this.computedOpacity)}addChild(e){return this.addChildAt(e,this.children.length)}addChildAt(e,t=this.children.length){if(!e)return e;if(this.contains(e))return e;this._needsSort=!0;const i=e.parent;return i&&i!==this&&i.removeChild(e),t>=this.children.length?this.children.push(e):this.children.splice(t,0,e),this._childrenSet.add(e),e.parent=this,e.stage=this.stage,this!==this.stage&&(e.clips=this.clips),this.requestRender(),this._childrenObservable.notify(),e}contains(e){return t.trackAccess(this._childrenObservable),this._childrenSet.has(e)}removeAllChildren(){this._childrenSet.clear(),this._needsSort=!0;for(const e of this.children)this!==this.stage&&(e.clips=null),e.stage=null,e.parent=null;this.children.length=0,this._childrenObservable.notify()}removeChild(e){return this.contains(e)?this.removeChildAt(this.children.indexOf(e)):e}removeChildAt(e){if(e<0||e>=this.children.length)return null;this._needsSort=!0;const t=this.children.splice(e,1)[0];return this._childrenSet.delete(t),this!==this.stage&&(t.clips=null),t.stage=null,t.parent=null,this._childrenObservable.notify(),t}beforeRender(e){super.beforeRender(e),this.sortFunction&&this._needsSort&&(this.children.sort(this.sortFunction),this._needsSort=!1,this._childrenObservable.notify());for(const t of this.children)t.beforeRender(e)}afterRender(e){super.afterRender(e);for(const t of this.children)t.afterRender(e)}_createTransforms(){return{displayViewScreenMat3:r.create()}}onAttach(){super.onAttach();const e=this.stage;for(const t of this.children)t.stage=e}onDetach(){super.onDetach();for(const e of this.children)e.stage=null}renderChildren(e){for(const t of this.children)t.processRender(e)}createRenderParams(e){return{...e,requireFBO:this.requiresDedicatedFBO,blendMode:this.blendMode,effects:this.computedEffects,globalOpacity:e.globalOpacity*this.computedOpacity,inFadeTransition:this.inFadeTransition,highlightGradient:this._highlightGradient||e.highlightGradient}}isTransitioning(){return super.isTransitioning()||this.children.some(e=>e.transitioning)}}e.Container=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/EffectView":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/has","../../core/lang","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/decorators/subclass","./parser","./utils"],function(e,t,i,r,n,s,o,a,l,c){"use strict";function u(e){const t=l.parse(e)||[];return function(e){const t=e[0];return!!t&&"type"in t}(t)?[{scale:-1,effects:t}]:t}function h(e,t,i){return!e[0]?.effects||!t[0]?.effects||!((-1===e[0]?.scale||-1===t[0]?.scale)&&(e.length>1||t.length>1)&&i<=0)&&c.canInterpolateEffects(e[0].effects,t[0].effects)}function d(e,t,i){const r=e.length>t.length?e:t,n=e.length>t.length?t:e,s=n[n.length-1],o=s?.scale??i,a=s?.effects??[];for(let e=n.length;e<r.length;e++)n.push({scale:o,effects:[...a]});for(let e=0;e<r.length;e++)n[e].scale=-1===n[e].scale?i:n[e].scale,r[e].scale=-1===r[e].scale?i:r[e].scale,c.normalizeEffects(n[e].effects,r[e].effects)}function f(e,t,i){return e+(t-e)*i}e.EffectView=class extends i{constructor(e){super(e),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=r("mapview-transitions-duration"),this.effects=[]}set effect(e){if(this._get("effect")!==(e=e||"")){this._set("effect",e);try{this._transitionTo(u(e))}catch(t){this._transitionTo([]),s.getLogger(this).warn("Invalid Effect",{effect:e,error:t})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(e){this._updateForScale(e)}get transitioning(){return null!==this._to}canTransitionTo(e){try{return this.scale>0&&h(this._current,u(e),this.scale)}catch{return!1}}transitionStep(e,t){this._applyTimeTransition(e),this._updateForScale(t)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(e){this.scale>0&&h(this._current,e,this.scale)?(this._final=e,this._to=n.clone(e),d(this._current,this._to,this.scale),this._from=n.clone(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=e),this._set("effects",this._current[0]?n.clone(this._current[0].effects):[])}_applyTimeTransition(e){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=e;const t=Math.min(1,this._time/this.duration);for(let e=0;e<this._current.length;e++){const i=this._current[e],r=this._from[e],n=this._to[e];i.scale=f(r.scale,n.scale,t);for(let e=0;e<i.effects.length;e++){const s=i.effects[e],o=r.effects[e],a=n.effects[e];s.interpolate(o,a,t)}}1===t&&(this._current=this._final,this._set("effects",this._current[0]?n.clone(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(e){if(this._set("scale",e),0===this._current.length)return;const t=this._current,i=this._current.length-1;let r,n,s=1;if(1===t.length||e>=t[0].scale)n=r=t[0].effects;else if(e<=t[i].scale)n=r=t[i].effects;else for(let o=0;o<i;o++){const i=t[o],a=t[o+1];if(i.scale>=e&&a.scale<=e){s=(e-i.scale)/(a.scale-i.scale),r=i.effects,n=a.effects;break}}for(let e=0;e<this.effects.length;e++)this.effects[e].interpolate(r[e],n[e],s)}},t.__decorate([o.property()],e.EffectView.prototype,"_to",void 0),t.__decorate([o.property()],e.EffectView.prototype,"duration",void 0),t.__decorate([o.property({value:""})],e.EffectView.prototype,"effect",null),t.__decorate([o.property({readOnly:!0})],e.EffectView.prototype,"effects",void 0),t.__decorate([o.property({readOnly:!0})],e.EffectView.prototype,"final",null),t.__decorate([o.property({readOnly:!0})],e.EffectView.prototype,"hasEffects",null),t.__decorate([o.property({value:0})],e.EffectView.prototype,"scale",null),t.__decorate([o.property({readOnly:!0})],e.EffectView.prototype,"transitioning",null),e.EffectView=t.__decorate([a.subclass("esri.layers.effects.EffectView")],e.EffectView),e.canInterpolateEffectStops=h,e.convertEffectToStops=u,e.normalizeEffectStops=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../core/arrayUtils","../../../core/Evented","./transitions/FadeTransition"],function(e,t,i,r){"use strict";class n extends i.Evented{constructor(){super(...arguments),this._transitionables=null,this._clips=null,this._fadeTransition=null,this._isReady=!1,this._opacity=1,this.parent=null,this._stage=null,this._visible=!0}get computedOpacity(){return this._fadeTransition?.computedOpacity??this.opacity}get clips(){return this._clips}set clips(e){this._clips=e,this.requestRender()}get fadeTransitionEnabled(){return null!==this._fadeTransition}set fadeTransitionEnabled(e){!this._fadeTransition&&e?(this._fadeTransition=new r.FadeTransition({opacity:this.opacity,visible:this.visible}),this.addTransitionable(this._fadeTransition)):this._fadeTransition&&!e&&(this.removeTransitionable(this._fadeTransition),this._fadeTransition=null)}get inFadeTransition(){return this._fadeTransition?.transitioning??!1}get isReady(){return this._isReady}get opacity(){return this._opacity}set opacity(e){this._opacity!==e&&(this._opacity=Math.min(1,Math.max(e,0)),this._fadeTransition&&(this._fadeTransition.opacity=this._opacity),this.requestRender())}get stage(){return this._stage}set stage(e){if(this._stage===e)return;const t=this._stage;this._stage=e,e?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):t?.trashDisplayObject(this)}get transforms(){return null==this._transforms&&(this._transforms=this._createTransforms()),this._transforms}get transitioning(){return this.isTransitioning()}get visible(){return this._visible}set visible(e){this._visible!==e&&(this._visible=e,this._fadeTransition&&(this._fadeTransition.visible=this._visible),this.requestRender())}get hasLabels(){return!1}get hasHighlight(){return!1}get hasBlending(){return!1}addTransitionable(e){this._transitionables??=[],this._transitionables.push(e),this.requestRender()}removeTransitionable(e){e.endTransition(),this._transitionables&&t.remove(this._transitionables,e),this.requestRender()}fadeIn(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeIn();return this.opacity=1,this.requestRender(),e}fadeOut(){this.fadeTransitionEnabled=!0;const e=this._fadeTransition.fadeOut();return this.opacity=0,this.requestRender(),e}endTransitions(){if(this._transitionables){for(const e of this._transitionables)e.endTransition();this.requestRender()}}beforeRender(e){this.transitionStep(e.deltaTime,e.state.scale),this.setTransform(e.state)}afterRender(e){this.transitioning&&this.requestRender()}remove(){this.parent?.removeChild(this)}setTransform(e){}processRender(e){this.stage&&(this._fadeTransition?.computedVisible??this.visible)&&this.doRender(e)}requestRender(){this.stage&&this.stage.requestRender()}processDetach(){this.endTransitions(),this.onDetach(),this.emit("detach")}isTransitioning(){return this._transitionables?.some(e=>e.transitioning)??!1}transitionStep(e,t){if(this._transitionables)for(const i of this._transitionables)i.transitionStep(e,t)}onAttach(){}onDetach(){}doRender(e){}ready(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())}}e.DisplayObject=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/transitions/FadeTransition":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/has","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass"],function(e,t,i,r,n,s,o,a,l){"use strict";e.FadeTransition=class extends i{constructor(e){super(e),this.computedOpacity=1,this.computedVisible=!0,this.opacity=1,this.visible=!0,this._fadeOutResolver=null,this._fadeInResolver=null}get transitioning(){return(this._fadeOutResolver||!this.visible?0:this.opacity)!==this.computedOpacity}endTransition(){this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeInResolver=this._fadeOutResolver=null,this.computedOpacity=this.visible?this.opacity:0}fadeIn(){return this._fadeInResolver||(this.opacity=1,this.computedOpacity=0,this._fadeOutResolver?.(),this._fadeOutResolver=null,this._fadeInResolver=n.createResolver()),this._fadeInResolver.promise}fadeOut(){return this._fadeOutResolver||(this.opacity=0,this._fadeInResolver?.(),this._fadeInResolver=null,this._fadeOutResolver=n.createResolver()),this._fadeOutResolver.promise}transitionStep(e,t){const i=r("mapview-transitions-duration"),n=i?1/i:0;if(0===n)this.computedOpacity=this.opacity,this.computedVisible=this.visible;else{const t=this._fadeOutResolver||!this.visible?0:this.opacity,i=this.computedOpacity;if(i===t)this.computedVisible=this.visible;else{const r=e*n;this.computedOpacity=i>t?Math.max(t,i-r):Math.min(t,i+r),this.computedVisible=this.computedOpacity>0}}this.transitioning||(this._fadeInResolver?.(),this._fadeOutResolver?.(),this._fadeOutResolver=this._fadeInResolver=null)}},t.__decorate([s.property()],e.FadeTransition.prototype,"computedOpacity",void 0),t.__decorate([s.property()],e.FadeTransition.prototype,"computedVisible",void 0),t.__decorate([s.property()],e.FadeTransition.prototype,"opacity",void 0),t.__decorate([s.property()],e.FadeTransition.prototype,"visible",void 0),t.__decorate([s.property()],e.FadeTransition.prototype,"transitioning",null),t.__decorate([s.property()],e.FadeTransition.prototype,"_fadeOutResolver",void 0),t.__decorate([s.property()],e.FadeTransition.prototype,"_fadeInResolver",void 0),e.FadeTransition=t.__decorate([l.subclass("esri.views.2d.engine.transitions.FadeTransition")],e.FadeTransition),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Painter":function(){define(["../../../../core/has","../../../../core/maybe","../brushes","../vectorTiles/shaders/VTLMaterialManager","./BitBlitRenderer","./definitions","./MaterialManager","./TextureManager","./TextureUploadManager","./WorldExtentClipRenderer","./effects/BlendEffect","./effects/FeatureEffect","./effects/HighlightEffect","./effects/HittestEffect","./effects/post-processing/EffectManager","./meshing/SimpleMesh","./painter/RenderPass","./shaderGraph/techniques/TechniqueProgramCache","../../../webgl/enums","../../../webgl/FramebufferObject","../../../webgl/Renderbuffer","../../../webgl/RenderbufferDescriptor","../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_,y,x,b,v,S){"use strict";function w(e,t,i,r){return 4!==e&&2!==e&&16!==e&&(1!==r||null!=t&&"normal"!==t||null!=i&&i.length>0)}return class{constructor(e,t){this.context=e,this._currentPipelineStateNeedsUpdate=!1,this._blitRenderer=new n.BitBlitRenderer,this._worldExtentRenderer=new c.WorldExtentRenderer,this._brushCache=new Map,this._lastWidth=null,this._lastHeight=null,this._vtlMaterialManager=new r,this._blendEffect=new u.BlendEffect,this._stencilBuf=null,this._prevBeforeLayerFBOStack=[],this._fboPool=[],this.effects={highlight:new d,hittest:new f.HittestEffect,insideEffect:new h.FeatureEffect("inside"),outsideEffect:new h.FeatureEffect("outside")},this._programCache=new _.TechniqueProgramCache,this.materialManager=new o(e),this.textureManager=new a(t),this.textureUploadManager=new l.TextureUploadManager(t),this._effectsManager=new p.EffectManager,this._quadMesh=m.SimpleMesh.fromVertexStream(e,[0,0,1,0,0,1,1,1])}dispose(){if(this._programCache.destroy(),this.materialManager.dispose(),this.textureManager.dispose(),this.textureUploadManager.destroy(),this._blitRenderer=t.disposeMaybe(this._blitRenderer),this._worldExtentRenderer=t.disposeMaybe(this._worldExtentRenderer),this._quadMesh=t.destroyMaybe(this._quadMesh),this._brushCache&&(this._brushCache.forEach(e=>e.dispose()),this._brushCache.clear(),this._brushCache=null),this._fbos){let e;for(e in this._fbos)this._fbos[e]&&this._fbos[e].dispose()}for(const e of this._fboPool)e.dispose();if(this._fboPool.length=0,this.effects){let e;for(e in this.effects)this.effects[e]&&this.effects[e].dispose()}this._effectsManager.dispose(),this._blendEffect.dispose(this.context),this._vtlMaterialManager=t.disposeMaybe(this._vtlMaterialManager)}clearShaderCache(){this._programCache.destroy(),this._programCache=new _.TechniqueProgramCache}get blitRenderer(){return this._blitRenderer}get vectorTilesMaterialManager(){return this._vtlMaterialManager}get quadMesh(){return this._quadMesh}getFbos(){if(!this._fbos)throw new Error("InternalError: Painter FBOs not initialized");return this._fbos}acquireFbo(e,t){let i;if(this._fboPool.length>0)i=this._fboPool.pop();else{const r=new S.TextureDescriptor(e,t);r.samplingMode=9728,r.wrapMode=33071,i=new x.FramebufferObject(this.context,r,this._stencilBuf)}return i.width===e&&i.height===t||i.resize(e,t),i}releaseFbo(e){this._fboPool.push(e)}getSharedStencilBuffer(){return this._stencilBuf}beforeRenderPhases(e,t,i){const{context:r}=e;this._worldExtentRenderer.render(e,t,i);const{width:n,height:s}=r.getViewport();if(this.updateFBOs(n,s),this._prevFBO=r.getBoundFramebufferObject(),r.bindFramebuffer(this.getFbos().output),r.setColorMask(!0,!0,!0,!0),null!=t){const{r:e,g:i,b:n,a:s}=t;r.setClearColor(s*e/255,s*i/255,s*n/255,s)}else r.setClearColor(0,0,0,0);r.setDepthWriteEnabled(!0),r.setClearDepth(1),r.clear(16640),r.setDepthWriteEnabled(!1)}afterRenderPhases(e){const{context:t}=e;t.bindFramebuffer(this._prevFBO),t.setStencilFunction(514,s.backbufferStencilVisible,255),t.setStencilTestEnabled(!0),t.setDepthTestEnabled(!1),this.blitTexture(t,this.getFbos().output.colorTexture,9728)}beforeRenderLayer(e,t,i){const{context:r,blendMode:n,effects:s,drawPhase:o,requireFBO:a}=e;if(r.setClearColor(0,0,0,0),a||w(o,n,s,i)){const e=r.getBoundFramebufferObject();this._prevBeforeLayerFBOStack.push(e);const{width:t,height:i}=r.getViewport(),n=this.acquireFbo(t,i);r.bindFramebuffer(n),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.setDepthWriteEnabled(!0),r.setClearDepth(1),r.clear(16640),r.setDepthWriteEnabled(!1)}r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setStencilTestEnabled(!0),r.setClearStencil(t),r.setStencilWriteMask(255),r.clear(1024)}afterRenderLayer(e,t){const{context:i,blendMode:r,effects:n,requireFBO:s,drawPhase:o}=e;if(s||w(o,r,n,t)){const s=i.getBoundFramebufferObject();null!=n&&n.length>0&&1===o&&(i.setColorMask(!0,!0,!0,!0),this._applyEffects(e,n,s)),i.bindFramebuffer(this._prevBeforeLayerFBOStack.pop()),i.setStencilTestEnabled(!1),i.setStencilWriteMask(0),i.setBlendingEnabled(!0),i.setBlendFunctionSeparate(1,771,1,771),i.setColorMask(!0,!0,!0,!0);const a=null==r||16===o||2===o?"normal":r;this._blendEffect.draw(e,s.colorTexture,9728,a,t),this.releaseFbo(s)}}renderObject(e,t,r,n){const s=i.brushes[r];if(!s)return;let o=this._brushCache.get(s);void 0===o&&(o=new s,this._brushCache.set(s,o)),o.prepareState(e),o.draw(e,t,n)}renderObjects(e,t,r,n){const s=i.brushes[r];if(!s)return;let o=this._brushCache.get(s);void 0===o&&(o=new s,this._brushCache.set(s,o)),o.drawMany(e,t,n)}registerRenderPass(e){const t=e.brushes.map(e=>(this._brushCache.has(e)||this._brushCache.set(e,new e),this._brushCache.get(e)));return new g(t,e)}blitTexture(e,t,i,r=1){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),this._blitRenderer.render(e,t,i,r),this._currentPipelineStateNeedsUpdate=!0}getPostProcessingEffects(e){return this._effectsManager.getPostProcessingEffects(e)}updateFBOs(e,t){if(e!==this._lastWidth||t!==this._lastHeight){if(this._lastWidth=e,this._lastHeight=t,this._fbos){let i;for(i in this._fbos)this._fbos[i].resize(e,t);return}const i=new S.TextureDescriptor(e,t);i.samplingMode=9728,i.wrapMode=33071;const r=new v.RenderbufferDescriptor(y.SizedDepthStencilFormat.DEPTH24_STENCIL8,e,t);this._stencilBuf=new b.Renderbuffer(this.context,r),this._fbos={output:new x.FramebufferObject(this.context,i,this._stencilBuf),effect0:new x.FramebufferObject(this.context,i,this._stencilBuf)}}}_applyEffects(e,t,i){const{context:r}=e,n=this._effectsManager.getPostProcessingEffects(t);for(const{postProcessingEffect:t,effect:s}of n)r.bindFramebuffer(i),t.draw(e,i,s);this._currentPipelineStateNeedsUpdate=!0}setShader(e){return this._shaderState={shader:e.shader,uniforms:e.uniforms,defines:e.defines,optionalAttributes:e.optionalAttributes,useComputeBuffer:e.useComputeBuffer??!1},this._shaderState}setPipelineState(e){e!==this._currentPipelineState&&(this._currentPipelineState=e,this._currentPipelineStateNeedsUpdate=!0)}submitDraw(e,t){if(!this._shaderState)return null;const{shader:i,uniforms:r,defines:n,optionalAttributes:s}=this._shaderState,o=e.context,a=t.getAttributePrecisionPackFactors(),l=this._programCache.getProgram(i,a,r,n??{},s??{});return l.setUniforms(r),l.bind(o),this.updatePipelineState(o),this.setStencilRef(o,t),t.draw(e,i.locationInfo),l.cleanupTemporaryTextures(),{vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}submitDrawMesh(e,t,i,r){this.submitDrawMeshUntyped(e,t,i,r)}submitDrawMeshUntyped(e,t,i,r){const{shader:n,uniforms:s,defines:o,optionalAttributes:a}=this.setShader(t),l=this._programCache.getProgram(n,{},s,o??{},a??{});if(l.setUniforms(s),l.bind(e),this.updatePipelineState(e),r)for(const n of r)i.bind(e,t.shader.locationInfo,n),i.draw(e);else for(let r=0;r<i.parts.length;r++)i.bind(e,t.shader.locationInfo,r),i.draw(e);i.unbind(e),l.cleanupTemporaryTextures()}updatePipelineState(e){this._currentPipelineStateNeedsUpdate&&(this._currentPipelineStateNeedsUpdate=!1,this._updatePipelineState(e))}_updatePipelineState(e){if(null==this._currentPipelineState)throw new Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");const{color:t,depth:i,stencil:r}=this._currentPipelineState;if(t){const{blendMode:i,write:r}=t;switch(e.setColorMask(...r),e.setBlendingEnabled(!0),e.setBlendEquation(32774),i){case"composite":e.setBlendFunctionSeparate(1,771,1,771);break;case"additive":e.setBlendFunctionSeparate(1,1,1,1);break;case"custom":{const{blendParameters:i}=t,{dstAlpha:r,dstRGB:n,srcAlpha:s,srcRGB:o}=i;e.setBlendFunctionSeparate(o,n,s,r);break}case"delete":e.setBlendEquation(32779),e.setBlendFunctionSeparate(1,771,1,771)}}else e.setColorMask(!1,!1,!1,!1);if(i){const{test:t,write:r}=i;r?(e.setDepthWriteEnabled(!0),e.setDepthRange(r.zNear,r.zFar)):e.setDepthWriteEnabled(!1),t?(e.setDepthTestEnabled(!0),e.setDepthFunction(t)):e.setDepthTestEnabled(!1)}else e.setDepthTestEnabled(!1),e.setDepthWriteEnabled(!1);if(r){const{test:t,write:i}=r;if(t){const{compare:i,mask:r,op:n,ref:s}=t;e.setStencilTestEnabled(!0),"function"!=typeof s&&e.setStencilFunctionSeparate(1032,i,s,r),e.setStencilOpSeparate(1032,n.fail,n.zFail,n.zPass)}else e.setStencilTestEnabled(!1);if(i){const{mask:t}=i;e.setStencilWriteMask(t)}else e.setStencilWriteMask(0)}else e.setStencilTestEnabled(!1),e.setStencilWriteMask(0)}setStencilRef(e,t){if(null==this._currentPipelineState)throw new Error("Pipeline state not defined. Call setPipelineState before calling submitDraw ");const{stencil:i}=this._currentPipelineState;if(i){const{test:r}=i;if(r){const{compare:i,mask:n,ref:s}=r;let o=null;if("function"==typeof s?o=s(t):"number"==typeof s&&(o=s),null==o&&(o=t.getStencilReference()),null==o)throw new Error("InternalError: Stencil reference expected for target but not defined");e.setStencilFunctionSeparate(1032,i,o,n)}}}}})},"esri/views/2d/engine/brushes":function(){define(["exports","./webgl/brushes/BrushClip","./webgl/brushes/WGLBrushStencil","./webgl/brushes/WGLBrushTileDebugInfo","./webgl/brushes/WGLBrushVTLBackground","./webgl/brushes/WGLBrushVTLCircle","./webgl/brushes/WGLBrushVTLFill","./webgl/brushes/WGLBrushVTLLine","./webgl/brushes/WGLBrushVTLSymbol"],function(e,t,i,r,n,s,o,a,l){"use strict";const c={clip:t,stencil:i,tileDebugInfo:r,vtlBackground:n.WGLBrushVTLBackground,vtlFill:o.WGLBrushVTLFill,vtlLine:a.WGLBrushVTLLine,vtlCircle:s.WGLBrushVTLCircle,vtlSymbol:l.WGLBrushVTLSymbol};e.brushes=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/BrushClip":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec4f32","../Utils","./WGLBrush","../shaders/BackgroundPrograms","../../../../webgl/enums","../../../../webgl/ProgramTemplate"],function(e,t,i,r,n,s){"use strict";return class extends i{constructor(){super(...arguments),this._color=e.fromValues(0,1,0,1)}dispose(){this._program&&this._program.dispose()}prepareState({context:e}){e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setFaceCullingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setStencilFunction(519,0,255)}draw(e,i){const{context:o,state:a,requestRender:l,allowDelayedRender:c}=e,u=t.createProgramDescriptor("clip",[{location:0,name:"a_pos",count:2,type:n.DataType.SHORT}]),h=i.getVAO(o,a,u.bufferLayout);null!=h.indexBuffer&&(this._program??=s.createProgram(o,r.background,h.locations),!c||null==l||this._program.compiled?(o.useProgram(this._program),this._program.setUniform2fv("u_coord_range",[1,1]),this._program.setUniform4fv("u_color",this._color),this._program.setUniformMatrix3fv("u_dvsMat3",a.displayMat3),o.bindVAO(h),o.drawElements(n.PrimitiveType.TRIANGLES,h.indexBuffer.size,n.DataType.UNSIGNED_INT,0),o.bindVAO(null)):l())}}})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["exports"],function(e){"use strict";function t(){return new Float32Array(4)}function i(e){const t=new Float32Array(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function r(e,t,i,r){const n=new Float32Array(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function n(){return t()}function s(){return r(1,1,1,1)}function o(){return r(1,0,0,0)}function a(){return r(0,1,0,0)}function l(){return r(0,0,1,0)}function c(){return r(0,0,0,1)}const u=n(),h=s(),d=o(),f=a(),p=l(),m=c(),g=Object.freeze(Object.defineProperty({__proto__:null,ONES:h,UNIT_W:m,UNIT_X:d,UNIT_Y:f,UNIT_Z:p,ZEROS:u,clone:i,create:t,fromValues:r,ones:s,unitW:c,unitX:o,unitY:a,unitZ:l,zeros:n},Symbol.toStringTag,{value:"Module"}));e.ONES=h,e.UNIT_W=m,e.UNIT_X=d,e.UNIT_Y=f,e.UNIT_Z=p,e.ZEROS=u,e.clone=i,e.create=t,e.fromValues=r,e.ones=s,e.unitW=c,e.unitX=o,e.unitY=a,e.unitZ=l,e.vec4f32=g,e.zeros=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Utils":function(){define(["exports","../../../../core/Error","../../../../core/Logger","../../../webgl/enums","../../../webgl/getDataTypeBytes","../../../webgl/VertexElementDescriptor"],function(e,t,i,r,n,s){"use strict";const o=()=>i.getLogger("esri.views.2d.engine.webgl.Utils");function a(e){let t=0;const i=e.map(e=>{const i=new s.VertexElementDescriptor(e.name,e.count,e.type,t,0,e.normalized||!1);return t+=e.count*n.getDataTypeBytes(e.type),i});return i.forEach(e=>e.stride=t),i}const l=new Map;e.charCodes=function(e){const t=[];for(let i=0;i<e.length;i++)t.push(e.charCodeAt(i));return t},e.createAttributeLayout=a,e.createProgramDescriptor=(e,t)=>{if(!l.has(e)){const i={bufferLayout:a(t),attributes:(e=>{const t=new Map;for(const i of e)t.set(i.name,i.location);return t})(t)};l.set(e,i)}return l.get(e)},e.getCIMMarkerPlacementHash=function(e){if(null==e)return"";const{type:t}=e;switch(t){case"CIMMarkerPlacementAlongLineRandomSize":return`${t}-${e.seed}-${e.randomization}`;case"CIMMarkerPlacementAlongLineVariableSize":return`${t}-${e.maxRandomOffset}-${e.numberOfSizes}-${e.seed}-${e.variationMethod}`;case"CIMMarkerPlacementAtExtremities":return`${t}-${e.extremityPlacement}-${e.offsetAlongLine}`;case"CIMMarkerPlacementAtRatioPositions":return`${t}-${e.beginPosition}-${e.endPosition}-${e.flipFirst}-${JSON.stringify(e.positionArray)}`;case"CIMMarkerPlacementAtMeasuredUnits":return`${t}-${e.interval}-${e.skipMarkerRate}-${e.placeAtExtremities}`;case"CIMMarkerPlacementInsidePolygon":return`${t}-${e.stepX}-${e.stepY}-${e.randomness}-${e.gridType}-${e.seed}-${e.shiftOddRows}`;case"CIMMarkerPlacementOnLine":return`${t}-${e.relativeTo}-${e.startPointOffset}`;case"CIMMarkerPlacementOnVertices":return`${t}-${e.placeOnControlPoints}-${e.placeOnEndPoints}-${e.placeOnRegularVertices}`;case"CIMMarkerPlacementPolygonCenter":return`${t}-${e.method}`;default:return`${t}`}},e.getPixelArrayCtor=function(e){switch(e){case r.PixelType.UNSIGNED_BYTE:return Uint8Array;case r.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case r.PixelType.FLOAT:return Float32Array;default:return void o().error(new t("webgl-utils",`Unable to handle type ${e}`))}},e.getPixelBytes=function(e){switch(e){case r.PixelType.UNSIGNED_BYTE:return 1;case r.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case r.PixelType.FLOAT:return 4;default:return void o().error(new t("webgl-utils",`Unable to handle type ${e}`))}},e.getStrideFromLayout=function(e){return e[0]?.stride??0},e.isSVGImage=e=>e.includes("data:image/svg+xml"),e.isValidSVG=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4)),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/getDataTypeBytes":function(){define(["exports","./enums"],function(e,t){"use strict";e.getDataTypeBytes=function(e){switch(e){case t.DataType.BYTE:case t.DataType.UNSIGNED_BYTE:return 1;case t.DataType.SHORT:case t.DataType.UNSIGNED_SHORT:case t.DataType.HALF_FLOAT:return 2;case t.DataType.FLOAT:case t.DataType.INT:case t.DataType.UNSIGNED_INT:return 4}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(e){"use strict";e.VertexElementDescriptor=class{constructor(e,t,i,r,n,s=!1,o=0){this.name=e,this.count=t,this.type=i,this.offset=r,this.stride=n,this.normalized=s,this.divisor=o}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(function(){"use strict";return class{constructor(){this.name=this.constructor.name||"UnnamedBrush",this.brushEffect=null}prepareState(e,t){}draw(e,t,i){}drawMany(e,t,i){for(const r of t)r.visible&&this.draw(e,r,i)}}})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["exports","./sources/resolver"],function(e,t){"use strict";const i={vertexShader:t.resolveIncludes("background/background.vert"),fragmentShader:t.resolveIncludes("background/background.frag")};e.background=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(e,t,i){"use strict";const r=new i.ShaderCompiler((n=t,function(e){let t=n;return e.split("/").forEach(e=>{t&&(t=t[e])}),t}));var n;e.resolveIncludes=function(e){return r.resolveIncludes(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(function(){"use strict";return{background:{"background.frag":"uniform lowp vec4 u_color;\nvoid main() {\ngl_FragColor = u_color;\n}","background.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump vec2 u_coord_range;\nuniform mediump float u_depth;\nvoid main() {\nvec3 v_pos = u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\n}"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\nuniform lowp float u_opacity;\nvarying mediump vec2 v_uv;\nvoid main() {\nlowp vec4 color = texture2D(u_tex, v_uv);\ngl_FragColor = color * u_opacity;\n}","bitBlit.vert":"attribute vec2 a_pos;\nattribute vec2 a_tex;\nvarying mediump vec2 v_uv;\nvoid main(void) {\ngl_Position = vec4(a_pos , 0.0, 1.0);\nv_uv = a_tex;\n}"},debug:{overlay:{"overlay.frag":"precision mediump float;\nvarying vec4 v_color;\nvoid main(void) {\ngl_FragColor = v_color;\n}","overlay.vert":"attribute vec3 a_PositionAndFlags;\nuniform mat3 u_dvsMat3;\nuniform vec4 u_colors[4];\nuniform float u_opacities[4];\nvarying vec4 v_color;\nvoid main(void) {\nvec2 position = a_PositionAndFlags.xy;\nfloat flags = a_PositionAndFlags.z;\nint colorIndex = int(mod(flags, 4.0));\nvec4 color;\nfor (int i = 0; i < 4; i++) {\ncolor = u_colors[i];\nif (i == colorIndex) {\nbreak;\n}\n}\nint opacityIndex = int(mod(floor(flags / 4.0), 4.0));\nfloat opacity;\nfor (int i = 0; i < 4; i++) {\nopacity = u_opacities[i];\nif (i == opacityIndex) {\nbreak;\n}\n}\nv_color = color * opacity;\ngl_Position = vec4((u_dvsMat3 * vec3(position, 1.0)).xy, 0.0, 1.0);\n}"}},dot:{dot:{"dot.frag":"precision mediump float;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nuniform highp float u_tileZoomFactor;\nvoid main()\n{\nfloat dist = length(gl_PointCoord - vec2(.5, .5)) * 2.;\nfloat alpha = smoothstep(0., 1., v_invEdgeRatio * (dist - v_dotRatio) + 1.);\ngl_FragColor = v_color * alpha;\n}","dot.vert":"precision highp float;\nattribute vec2 a_pos;\nuniform sampler2D u_texture;\nuniform highp mat3 u_dvsMat3;\nuniform highp float u_tileZoomFactor;\nuniform highp float u_dotSize;\nuniform highp float u_pixelRatio;\nvarying vec2 v_pos;\nvarying vec4 v_color;\nvarying float v_dotRatio;\nvarying float v_invEdgeRatio;\nconst float EPSILON = 0.000001;\nvoid main()\n{\nmat3 tileToTileTexture = mat3(  1., 0., 0.,\n0., -1., 0.,\n0., 1., 1.  );\nvec3 texCoords = tileToTileTexture * vec3(a_pos.xy / 512., 1.);\nv_color = texture2D(u_texture, texCoords.xy);\nfloat smoothEdgeWidth = max(u_dotSize / 2., 1.) ;\nfloat z = 0.;\nz += 2.0 * step(v_color.a, EPSILON);\ngl_PointSize = (smoothEdgeWidth + u_dotSize);\ngl_Position = vec4((u_dvsMat3 * vec3(a_pos + .5, 1.)).xy, z, 1.);\nv_dotRatio = u_dotSize / gl_PointSize;\nv_invEdgeRatio = -1. / ( smoothEdgeWidth / gl_PointSize );\ngl_PointSize  *= (u_pixelRatio * u_tileZoomFactor);\n}"}},filtering:{"bicubic.glsl":"vec4 computeWeights(float v) {\nfloat b = 1.0 / 6.0;\nfloat v2 = v * v;\nfloat v3 = v2 * v;\nfloat w0 = b * (-v3 + 3.0 * v2 - 3.0 * v + 1.0);\nfloat w1 = b * (3.0 * v3  - 6.0 * v2 + 4.0);\nfloat w2 = b * (-3.0 * v3 + 3.0 * v2 + 3.0 * v + 1.0);\nfloat w3 = b * v3;\nreturn vec4(w0, w1, w2, w3);\n}\nvec4 bicubicOffsetsAndWeights(float v) {\nvec4 w = computeWeights(v);\nfloat g0 = w.x + w.y;\nfloat g1 = w.z + w.w;\nfloat h0 = 1.0 - (w.y / g0) + v;\nfloat h1 = 1.0 + (w.w / g1) - v;\nreturn vec4(h0, h1, g0, g1);\n}\nvec4 sampleBicubicBSpline(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 eX = vec2(1.0 / texSize.x, 0.0);\nvec2 eY = vec2(0.0, 1.0 / texSize.y);\nvec2 texel = coords * texSize - 0.5;\nvec3 hgX = bicubicOffsetsAndWeights(fract(texel).x).xyz;\nvec3 hgY = bicubicOffsetsAndWeights(fract(texel).y).xyz;\nvec2 coords10 = coords + hgX.x * eX;\nvec2 coords00 = coords - hgX.y * eX;\nvec2 coords11 = coords10 + hgY.x * eY;\nvec2 coords01 = coords00 + hgY.x * eY;\ncoords10 = coords10 - hgY.y * eY;\ncoords00 = coords00 - hgY.y * eY;\nvec4 color00 = texture2D(sampler, coords00);\nvec4 color10 = texture2D(sampler, coords10);\nvec4 color01 = texture2D(sampler, coords01);\nvec4 color11 = texture2D(sampler, coords11);\ncolor00 = mix(color00, color01, hgY.z);\ncolor10 = mix(color10, color11, hgY.z);\ncolor00 = mix(color00, color10, hgX.z);\nreturn color00;\n}","bilinear.glsl":"vec4 sampleBilinear(sampler2D sampler, vec2 coords, vec2 texSize) {\nvec2 texelStart = floor(coords * texSize);\nvec2 coord0 = texelStart / texSize;\nvec2 coord1 = (texelStart +  vec2(1.0, 0.0)) / texSize;\nvec2 coord2 = (texelStart +  vec2(0.0, 1.0)) / texSize;\nvec2 coord3 = (texelStart +  vec2(1.0, 1.0)) / texSize;\nvec4 color0 = texture2D(sampler, coord0);\nvec4 color1 = texture2D(sampler, coord1);\nvec4 color2 = texture2D(sampler, coord2);\nvec4 color3 = texture2D(sampler, coord3);\nvec2 blend = fract(coords * texSize);\nvec4 color01 = mix(color0, color1, blend.x);\nvec4 color23 = mix(color2, color3, blend.x);\nvec4 color = mix(color01, color23, blend.y);\n#ifdef NNEDGE\nfloat alpha = floor(color0.a * color1.a * color2.a * color3.a + 0.5);\ncolor = color * alpha + (1.0 - alpha) * texture2D(sampler, coords);\n#endif\nreturn color;\n}","epx.glsl":"vec4 sampleEPX(sampler2D sampler, float size, vec2 coords, vec2 texSize) {\nvec2 invSize = 1.0 / texSize;\nvec2 texel = coords * texSize;\nvec2 texel_i = floor(texel);\nvec2 texel_frac = fract(texel);\nvec4 colorP = texture2D(sampler, texel_i * invSize);\nvec4 colorP1 = vec4(colorP);\nvec4 colorP2 = vec4(colorP);\nvec4 colorP3 = vec4(colorP);\nvec4 colorP4 = vec4(colorP);\nvec4 colorA = texture2D(sampler, (texel_i - vec2(0.0, 1.0)) * invSize);\nvec4 colorB = texture2D(sampler, (texel_i + vec2(1.0, 0.0)) * invSize);\nvec4 colorC = texture2D(sampler, (texel_i - vec2(1.0, 0.0)) * invSize);\nvec4 colorD = texture2D(sampler, (texel_i + vec2(0.0, 1.0)) * invSize);\nif (colorC == colorA && colorC != colorD && colorA != colorB) {\ncolorP1 = colorA;\n}\nif (colorA == colorB && colorA != colorC && colorB != colorD) {\ncolorP2 = colorB;\n}\nif (colorD == colorC && colorD != colorB && colorC != colorA) {\ncolorP3 = colorC;\n}\nif (colorB == colorD && colorB != colorA && colorD != colorC) {\ncolorP4 = colorD;\n}\nvec4 colorP12 = mix(colorP1, colorP2, texel_frac.x);\nvec4 colorP34 = mix(colorP1, colorP2, texel_frac.x);\nreturn mix(colorP12, colorP34, texel_frac.y);\n}"},heatmap:{heatmapResolve:{"heatmapResolve.frag":"precision highp float;\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 4.0\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform sampler2D u_texture;\nuniform sampler2D u_gradient;\nuniform vec2 u_densityMinAndInvRange;\nuniform float u_densityNormalization;\nvarying vec2 v_uv;\nvoid main() {\nvec4 data = texture2D(u_texture, v_uv);\nfloat density = data.r * COMPRESSION_FACTOR;\ndensity *= u_densityNormalization;\ndensity = (density - u_densityMinAndInvRange.x) * u_densityMinAndInvRange.y;\nvec4 color = texture2D(u_gradient, vec2(density, 0.5));\ngl_FragColor = vec4(color.rgb * color.a, color.a);\n}","heatmapResolve.vert":"precision highp float;\nattribute vec2 a_pos;\nvarying vec2 v_uv;\nvoid main() {\nv_uv = a_pos;\ngl_Position = vec4(a_pos * 2.0 - 1.0, 1., 1.);\n}"}},highlight:{"blur.frag":"varying mediump vec2 v_texcoord;\nuniform mediump vec4 u_direction;\nuniform mediump mat4 u_channelSelector;\nuniform mediump float u_sigma;\nuniform sampler2D u_texture;\nmediump float gauss1(mediump vec2 dir) {\nreturn exp(-dot(dir, dir) / (2.0 * u_sigma * u_sigma));\n}\nmediump vec4 selectChannel(mediump vec4 sample) {\nreturn u_channelSelector * sample;\n}\nvoid accumGauss1(mediump float i, inout mediump float tot, inout mediump float weight) {\nmediump float w = gauss1(i * u_direction.xy);\ntot += selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw))[3] * w;\nweight += w;\n}\nvoid main(void) {\nmediump float tot = 0.0;\nmediump float weight = 0.0;\naccumGauss1(-5.0, tot, weight);\naccumGauss1(-4.0, tot, weight);\naccumGauss1(-3.0, tot, weight);\naccumGauss1(-2.0, tot, weight);\naccumGauss1(-1.0, tot, weight);\naccumGauss1(0.0, tot, weight);\naccumGauss1(1.0, tot, weight);\naccumGauss1(2.0, tot, weight);\naccumGauss1(3.0, tot, weight);\naccumGauss1(4.0, tot, weight);\naccumGauss1(5.0, tot, weight);\ngl_FragColor = vec4(0.0, 0.0, 0.0, tot / weight);\n}","highlight.frag":"varying mediump vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform mediump float u_sigma;\nuniform sampler2D u_shade;\nuniform mediump vec2 u_minMaxDistance;\nmediump float estimateDistance() {\nmediump float y = texture2D(u_texture, v_texcoord)[3];\nconst mediump float y0 = 0.5;\nmediump float m0 = 1.0 / (sqrt(2.0 * 3.1415) * u_sigma);\nmediump float d = (y - y0) / m0;\nreturn d;\n}\nmediump vec4 shade(mediump float d) {\nmediump float mappedDistance = (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\nmappedDistance = clamp(mappedDistance, 0.0, 1.0);\nreturn texture2D(u_shade, vec2(mappedDistance, 0.5));\n}\nvoid main(void) {\nmediump float d = estimateDistance();\ngl_FragColor = shade(d);\n}","textured.vert":"attribute mediump vec2 a_position;\nattribute mediump vec2 a_texcoord;\nvarying mediump vec2 v_texcoord;\nvoid main(void) {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},materials:{"attributeData.glsl":"uniform highp sampler2D filterFlags;\nuniform highp sampler2D animation;\nuniform highp sampler2D gpgpu;\nuniform highp sampler2D visualVariableData;\nuniform highp sampler2D dataDriven0;\nuniform highp sampler2D dataDriven1;\nuniform highp sampler2D dataDriven2;\nuniform float size;\nhighp vec2 getAttributeDataCoords(in highp vec3 id) {\nhighp vec3  texel = unpackDisplayIdTexel(id);\nhighp float u32 = float(int(texel.r) + int(texel.g) * 256 + int(texel.b) * 256 * 256);\nhighp float col = mod(u32, size);\nhighp float row = (u32 - col) / size;\nhighp float u = col / size;\nhighp float v = row / size;\nreturn vec2(u, v);\n}\nhighp vec2 getAttributeDataTextureCoords(in highp vec3 id) {\nreturn (getAttributeDataCoords(id) * 2.0) - 1.0 + (.5 / vec2(size));\n}\nhighp vec4 getFilterData(in highp vec3 id) {\nvec2 coords = getAttributeDataCoords(id);\nreturn texture2D(filterFlags, coords);\n}\nhighp vec4 getAnimation(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(animation, coords);\n}\nhighp vec4 getVisualVariableData(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(visualVariableData, coords);\n}\nhighp vec4 getDataDriven0(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven0, coords);\n}\nhighp vec4 getDataDriven1(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven1, coords);\n}\nhighp vec4 getGPGPU(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(gpgpu, coords);\n}\nhighp vec4 getDataDriven2(in highp vec3 id) {\nhighp vec2 coords = getAttributeDataCoords(id);\nreturn texture2D(dataDriven2, coords);\n}\nfloat u88VVToFloat(in vec2 v) {\nbool isMagic = v.x == 255.0 && v.y == 255.0;\nif (isMagic) {\nreturn NAN_MAGIC_NUMBER;\n}\nreturn (v.x + v.y * float(0x100)) - 32768.0;\n}","barycentric.glsl":"float inTriangle(vec3 bary) {\nvec3 absBary = abs(bary);\nreturn step((absBary.x + absBary.y + absBary.z), 1.05);\n}\nvec3 xyToBarycentric(in vec2 pos, in vec2 v0,  in vec2 v1, in vec2 v2) {\nmat3 xyToBarycentricMat3 = mat3(\nv1.x * v2.y - v2.x * v1.y, v2.x * v0.y - v0.x * v2.y, v0.x * v1.y - v1.x * v0.y,\nv1.y - v2.y, v2.y - v0.y, v0.y - v1.y,\nv2.x - v1.x, v0.x - v2.x, v1.x - v0.x\n);\nfloat A2 = v0.x * (v1.y - v2.y) + v1.x * (v2.y - v0.y) + v2.x * (v0.y - v1.y);\nreturn (1. / A2) * xyToBarycentricMat3 * vec3(1., pos);\n}","constants.glsl":"const float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_RAD_TO_DEG = 180.0 / 3.141592654;\nconst float POSITION_PRECISION = 1.0 / 8.0;\nconst float FILL_POSITION_PRECISION = 1.0 / 1.0;\nconst float SOFT_EDGE_RATIO = 1.0;\nconst float THIN_LINE_WIDTH_FACTOR = 1.1;\nconst float THIN_LINE_HALF_WIDTH = 1.0;\nconst float EXTRUDE_SCALE_PLACEMENT_PADDING = 1.0 / 4.0;\nconst float OFFSET_PRECISION = 1.0 / 8.0;\nconst float OUTLINE_SCALE = 1.0 / 5.0;\nconst float SDF_FONT_SIZE = 24.0;\nconst float MAX_SDF_DISTANCE = 8.0;\nconst float PLACEMENT_PADDING = 8.0;\nconst float EPSILON = 0.00001;\nconst float EPSILON_HITTEST = 0.05;\nconst int MAX_FILTER_COUNT = 2;\nconst int ATTR_VV_SIZE = 0;\nconst int ATTR_VV_COLOR = 1;\nconst int ATTR_VV_OPACITY = 2;\nconst int ATTR_VV_ROTATION = 3;\nconst highp float NAN_MAGIC_NUMBER = 1e-30;\nconst int BITSET_GENERIC_LOCK_COLOR = 1;\nconst int BITSET_GENERIC_CONSIDER_ALPHA_ONLY = 4;\nconst int BITSET_MARKER_ALIGNMENT_MAP = 0;\nconst int BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE = 2;\nconst int BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY = 3;\nconst int BITSET_TYPE_FILL_OUTLINE = 0;\nconst int BITSET_FILL_RANDOM_PATTERN_OFFSET = 2;\nconst int BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR = 3;\nconst int BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR = 5;\nconst int BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR = 6;\nconst int BITSET_LINE_SCALE_DASH = 2;",fill:{"common.glsl":"#include <materials/symbologyTypeUtils.glsl>\n#ifdef PATTERN\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform lowp vec4 u_isActive[ 2 ];\nuniform highp float u_dotValue;\nuniform highp float u_tileDotsOverArea;\nuniform highp float u_dotTextureDotCount;\nuniform mediump float u_tileZoomFactor;\n#endif\nvarying highp vec3 v_id;\nvarying lowp vec4 v_color;\nvarying lowp float v_opacity;\nvarying mediump vec4 v_aux1;\n#ifdef PATTERN\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvarying lowp float v_isOutline;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvarying highp vec2 v_dotTextureCoords;\nvarying highp vec4 v_dotThresholds[ 2 ];\n#endif","fill.frag":"precision highp float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/fill/common.glsl>\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nuniform mediump mat4 u_dotColors[ 2 ];\nuniform sampler2D u_dotTextures[ 2 ];\nuniform vec4 u_dotBackgroundColor;\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\nlowp vec4 drawLine() {\nfloat v_lineWidth = v_aux1.x;\nvec2  v_normal    = v_aux1.yz;\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineWidth,\nv_opacity,\nv_id\n);\nreturn shadeLine(inputs);\n}\n#endif\nlowp vec4 drawFill() {\nlowp vec4 out_color = vec4(0.);\n#ifdef HITTEST\nout_color = v_color;\n#elif defined(PATTERN)\nmediump vec4 v_tlbr = v_aux1;\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\nout_color = v_opacity * v_color * color;\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY && !defined(HIGHLIGHT)\nvec4 textureThresholds0 = texture2D(u_dotTextures[0], v_dotTextureCoords);\nvec4 textureThresholds1 = texture2D(u_dotTextures[1], v_dotTextureCoords);\nvec4 difference0 = v_dotThresholds[0] - textureThresholds0;\nvec4 difference1 = v_dotThresholds[1] - textureThresholds1;\n#ifdef DD_DOT_BLENDING\nvec4 isPositive0 = step(0.0, difference0);\nvec4 isPositive1 = step(0.0, difference1);\nfloat weightSum = dot(isPositive0, difference0) + dot(isPositive1, difference1);\nfloat lessThanEqZero = step(weightSum, 0.0);\nfloat greaterThanZero = 1.0 - lessThanEqZero ;\nfloat divisor = (weightSum + lessThanEqZero);\nvec4 weights0 = difference0 * isPositive0 / divisor;\nvec4 weights1 = difference1 * isPositive1 / divisor;\nvec4 dotColor = u_dotColors[0] * weights0 + u_dotColors[1] * weights1;\nvec4 preEffectColor = greaterThanZero * dotColor + lessThanEqZero * u_dotBackgroundColor;\n#else\nfloat diffMax = max(max4(difference0), max4(difference1));\nfloat lessThanZero = step(diffMax, 0.0);\nfloat greaterOrEqZero = 1.0 - lessThanZero;\nvec4 isMax0 = step(diffMax, difference0);\nvec4 isMax1 = step(diffMax, difference1);\nvec4 dotColor = u_dotColors[0] * isMax0 + u_dotColors[1] * isMax1;\nvec4 preEffectColor = greaterOrEqZero * dotColor + lessThanZero * u_dotBackgroundColor;\n#endif\nout_color = preEffectColor;\n#else\nout_color = v_opacity * v_color;\n#endif\n#ifdef HIGHLIGHT\nout_color.a = 1.0;\n#endif\nreturn out_color;\n}\nvoid main() {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (v_isOutline > 0.5) {\ngl_FragColor = drawLine();\n} else {\ngl_FragColor = drawFill();\n}\n#else\ngl_FragColor = drawFill();\n#endif\n}","fill.vert":"#include <materials/symbologyTypeUtils.glsl>\n#define PACKED_LINE\nprecision highp float;\nattribute float a_bitset;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nattribute float a_inverseArea;\nvec4 a_color = vec4(0.0, 0.0, 0.0, 1.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#else\nattribute vec4 a_color;\nattribute vec4 a_aux2;\nattribute vec4 a_aux3;\n#ifndef SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\nattribute vec4 a_aux1;\nattribute vec2 a_zoomRange;\n#else\nvec2 a_zoomRange = vec2(0.0, 10000.0);\n#endif\n#endif\nuniform vec2 u_tileOffset;\nuniform vec2 u_maxIntNumOfCrossing;\n#include <util/encoding.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/fill/common.glsl>\n#include <materials/fill/hittest.glsl>\nconst float INV_SCALE_COMPRESSION_FACTOR = 1.0 / 128.0;\nconst float MAX_REPRESENTABLE_INT = 16777216.0;\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 dotThreshold(vec4 featureAttrOverFeatureArea, float dotValue, float tileDotsOverArea) {\nreturn featureAttrOverFeatureArea * (1.0 / dotValue)  * (1.0 / tileDotsOverArea);\n}\n#endif\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\nvoid drawLine(out lowp vec4 out_color, out highp vec3 out_pos) {\nLineData outputs = buildLine(\nout_pos,\na_id,\na_pos,\na_color,\n(a_aux3.xy - 128.) / 16.,\n(a_aux3.zw - 128.) / 16.,\n0.,\na_aux2.z / 16.,\na_bitset,\nvec4(0.),\nvec2(0.),\na_aux2.w / 16.\n);\nv_id      = outputs.id;\nv_opacity = outputs.opacity;\nv_aux1    = vec4(outputs.lineHalfWidth, outputs.normal, 0.);\nout_color = outputs.color;\n}\n#endif\nvoid drawFill(out lowp vec4 out_color, out highp vec3 out_pos) {\nfloat a_bitSet = a_bitset;\nout_color = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity = getOpacity();\nv_id      = norm(a_id);\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nmat3 tileToTileNormalized = mat3(  2. / 512.,  0.,  0.,\n0., -2. / 512.,  0.,\n-1.,  1.,  1.  );\nout_pos   = tileToTileNormalized * vec3((a_pos * FILL_POSITION_PRECISION), 1.);\n#else\nout_pos   = u_dvsMat3 * vec3(a_pos * FILL_POSITION_PRECISION, 1.);\n#endif\n#ifdef PATTERN\nvec4  a_tlbr   = a_aux1;\nfloat a_width  = a_aux2.x;\nfloat a_height = a_aux2.y;\nvec2  a_offset = a_aux2.zw;\nvec2  a_scale  = a_aux3.xy;\nfloat a_angle  = a_aux3.z;\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_WIDTH_PRECISION_FACTOR) > 0.5) {\na_width *= INV_SCALE_COMPRESSION_FACTOR;\n}\nif (getBit(a_bitset, BITSET_FILL_HAS_PATTERN_HEIGHT_PRECISION_FACTOR) > 0.5) {\na_height *= INV_SCALE_COMPRESSION_FACTOR;\n}\nvec2 scale = INV_SCALE_COMPRESSION_FACTOR * a_scale;\nfloat width = u_zoomFactor * a_width * scale.x;\nfloat height = u_zoomFactor * a_height * scale.y;\nfloat angle = C_256_TO_RAD * a_angle;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nfloat dx = 0.0;\nfloat dy = 0.0;\nif (getBit(a_bitset, BITSET_FILL_RANDOM_PATTERN_OFFSET) > 0.5) {\nfloat id = rgba2float(vec4(a_id, 0.0));\ndx = rand(vec2(id, 0.0));\ndy = rand(vec2(0.0, id));\n}\nmat3 patternMatrix = mat3(cosA / width, sinA / height, 0,\n-sinA / width, cosA / height, 0,\ndx,            dy,           1);\nvec2 patternSize = vec2(a_width, a_height);\nvec2 numPatternsPerMaxInt = vec2(MAX_REPRESENTABLE_INT) / patternSize;\nvec2 maxIntCrossingOffsetCorrection = patternSize * fract(u_maxIntNumOfCrossing * numPatternsPerMaxInt);\nvec2 tileOffset = u_tileOffset + maxIntCrossingOffsetCorrection - 0.5 * patternSize;\ntileOffset = vec2(tileOffset.x * cosA - tileOffset.y * sinA, tileOffset.x * sinA + tileOffset.y * cosA);\ntileOffset = mod(tileOffset, patternSize);\nvec2 symbolOffset = u_zoomFactor * scale * vec2(a_offset - tileOffset) / vec2(width, height);\nv_tileTextureCoord = (patternMatrix * vec3(a_pos * FILL_POSITION_PRECISION, 1.0)).xy - symbolOffset;\nv_aux1 = a_tlbr / u_mosaicSize.xyxy;\nv_sampleAlphaOnly = getBit(a_bitset, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\nif (getBit(a_bitSet, BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR) > 0.5) {\n#ifdef VV_COLOR\nv_sampleAlphaOnly *= (1.0 - float(isNan(VV_ADATA[ATTR_VV_COLOR]))) * (1.0 - getBit(a_bitSet, BITSET_GENERIC_LOCK_COLOR));\n#else\nv_sampleAlphaOnly = 0.0;\n#endif\n}\n#elif SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_DOT_DENSITY\nvec4 ddAttributeData0 = getAttributeData2(a_id) * u_isActive[0] * a_inverseArea;\nvec4 ddAttributeData1 = getAttributeData3(a_id) * u_isActive[1] * a_inverseArea;\nfloat size = u_tileZoomFactor * 512.0 * 1.0 / u_pixelRatio;\nv_dotThresholds[0] = dotThreshold(ddAttributeData0, u_dotValue, u_tileDotsOverArea);\nv_dotThresholds[1] = dotThreshold(ddAttributeData1, u_dotValue, u_tileDotsOverArea);\nv_dotTextureCoords = (a_pos * FILL_POSITION_PRECISION + 0.5) / size;\n#endif\n}\n#ifdef HITTEST\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nif (getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE) > 0.5) {\nout_pos = vec3(0., 0., 2.);\nreturn;\n}\n#endif\nhittestFill(out_color, out_pos);\ngl_PointSize = 1.0;\n}\n#elif defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nvoid draw(out lowp vec4 out_color, out highp vec3 out_pos) {\nv_isOutline = getBit(a_bitset, BITSET_TYPE_FILL_OUTLINE);\nif (v_isOutline > 0.5) {\ndrawLine(out_color, out_pos);\n} else {\ndrawFill(out_color, out_pos);\n}\n}\n#else\n#define draw drawFill\n#endif\nvoid main()\n{\nINIT;\nhighp vec3 pos  = vec3(0.);\nhighp vec4 color  = vec4(0.);\ndraw(color, pos);\nv_color = color;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}","hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestFill(\nout lowp vec4 out_color,\nout highp vec3 out_pos\n) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * FILL_POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * FILL_POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * FILL_POSITION_PRECISION, 1.);\nfloat hittestDist = u_hittestDist;\nfloat dist = distPointTriangle(u_hittestPos, pos.xy, pos1.xy, pos2.xy);\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist < 0. || dist >= hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist == 0. ? (1. / 255.) : 0.);\n}\n#endif"},hittest:{"common.glsl":"#ifdef HITTEST\nuniform float hittestDist;\nuniform highp vec2 hittestPos;\nfloat projectScalar(vec2 a, vec2 b) {\nreturn dot(a, normalize(b));\n}\nfloat distPointSegment(vec2 p0, vec2 p1, vec2 p2) {\nvec2 L = p2 - p1;\nvec2 A = p0 - p1;\nfloat projAL = projectScalar(A, L);\nfloat t = clamp(projAL / length(L), 0., 1.);\nreturn distance(p0, p1 + t * (p2 - p1));\n}\nvoid hittestMarker(out lowp vec4 out_color, out highp vec3 out_pos, in highp vec3 pos, float size) {\nfloat dist = distance(pos, vec3(hittestPos, 1.));\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif ((dist - size) > hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, (dist - size) < 0. ? (1. / 255.) : 0.);\n}\nfloat intersectPointTriangleBary(vec2 p, vec2 a, vec2 b, vec2 c) {\nreturn inTriangle(xyToBarycentric(p, a, b, c));\n}\nfloat distPointTriangle(vec2 p, vec2 a, vec2 b, vec2 c) {\nvec2 ba = b - a;\nvec2 ca = c - a;\nfloat crossProduct = ba.x * ca.y - ca.x * ba.y;\nbool isParallel = crossProduct < EPSILON_HITTEST && crossProduct > -EPSILON_HITTEST;\nif (isParallel) {\nreturn -1.;\n}\nif (intersectPointTriangleBary(p.xy, a, b, c) == 1.) {\nreturn 0.;\n}\nfloat distAB = distPointSegment(p, a, b);\nfloat distBC = distPointSegment(p, b, c);\nfloat distCA = distPointSegment(p, c, a);\nreturn min(min(distAB, distBC), distCA);\n}\n#endif"},icon:{"common.glsl":"#include <util/encoding.glsl>\nuniform lowp vec2 u_mosaicSize;\nvarying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying highp vec4 v_sizeTex;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nvarying lowp vec4 v_outlineColor;\nvarying mediump float v_outlineWidth;\nvarying mediump float v_distRatio;\nvarying mediump float v_overridingOutlineColor;\nvarying mediump float v_isThin;\n#endif\n#ifdef SDF\nvec4 getColor(vec2 v_size, vec2 v_tex) {\n#ifdef HITTEST\nlowp vec4 fillPixelColor = vec4(1.0);\n#else\nlowp vec4 fillPixelColor = v_color;\n#endif\nfloat d = 0.5 - rgba2float(texture2D(u_texture, v_tex));\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * size * SOFT_EDGE_RATIO * v_distRatio;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nfloat outlineWidth = v_outlineWidth;\n#ifdef HIGHLIGHT\noutlineWidth = max(outlineWidth, 4.0 * v_isThin);\n#endif\nif (outlineWidth > 0.25) {\nlowp vec4 outlinePixelColor = v_overridingOutlineColor * v_color + (1.0 - v_overridingOutlineColor) * v_outlineColor;\nfloat clampedOutlineSize = min(outlineWidth, size);\noutlinePixelColor *= clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\nreturn v_opacity * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\n}\nreturn v_opacity * fillPixelColor;\n}\n#else\nvec4 getColor(vec2 _v_size, vec2 v_tex) {\nlowp vec4 texColor = texture2D(u_texture, v_tex);\nreturn v_opacity * texColor * v_color;\n}\n#endif",heatmapAccumulate:{"common.glsl":"varying lowp vec4 v_hittestResult;\nvarying mediump vec2 v_offsetFromCenter;\nvarying highp float v_fieldValue;","heatmapAccumulate.frag":"precision mediump float;\n#include <materials/icon/heatmapAccumulate/common.glsl>\n#ifdef HEATMAP_PRECISION_HALF_FLOAT\n#define COMPRESSION_FACTOR 0.25\n#else\n#define COMPRESSION_FACTOR 1.0\n#endif\nuniform lowp sampler2D u_texture;\nvoid main() {\n#ifdef HITTEST\ngl_FragColor = v_hittestResult;\n#else\nfloat radius = length(v_offsetFromCenter);\nfloat shapeWeight = step(radius, 1.0);\nfloat oneMinusRadiusSquared = 1.0 - radius * radius;\nfloat kernelWeight = oneMinusRadiusSquared * oneMinusRadiusSquared;\ngl_FragColor = vec4(shapeWeight * kernelWeight * v_fieldValue * COMPRESSION_FACTOR);\n#endif\n}","heatmapAccumulate.vert":"precision highp float;\nattribute vec2 a_vertexOffset;\nvec4 a_color = vec4(0.0);\nvec2 a_zoomRange = vec2(0.0, 10000.0);\nuniform float u_radius;\nuniform float u_isFieldActive;\n#include <materials/vcommon.glsl>\n#include <materials/hittest/common.glsl>\n#include <materials/icon/heatmapAccumulate/common.glsl>\nvoid main() {\nfloat filterFlags = getFilterFlags();\n#ifdef HITTEST\nhighp vec4 out_hittestResult = vec4(0.);\nhighp vec3 out_pos = vec3(0.);\nvec3 pos = u_viewMat3 * u_tileMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nhittestMarker(out_hittestResult, out_pos, pos, u_radius);\nv_hittestResult = out_hittestResult;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(a_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\nv_offsetFromCenter = sign(a_vertexOffset);\nv_fieldValue = getAttributeData2(a_id).x * u_isFieldActive + 1.0 - u_isFieldActive;\nvec3 centerPos = u_dvsMat3 * vec3(a_pos * POSITION_PRECISION, 1.0);\nvec3 vertexPos = centerPos + u_displayViewMat3 * vec3(v_offsetFromCenter, 0.0) * u_radius;\ngl_Position = vec4(clip(a_color, vertexPos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},"hittest.glsl":"#ifdef HITTEST\n#include <materials/hittest/common.glsl>\nattribute vec2 a_vertexOffset1;\nattribute vec2 a_vertexOffset2;\nattribute vec2 a_texCoords1;\nattribute vec2 a_texCoords2;\nvec2 getTextureCoords(in vec3 bary, in vec2 texCoords0, in vec2 texCoords1, in vec2 texCoords2) {\nreturn texCoords0 * bary.x + texCoords1 * bary.y + texCoords2 * bary.z;\n}\nvoid hittestIcon(\ninout lowp vec4 out_color,\nout highp vec3 out_pos,\nin vec3 pos,\nin vec3 offset,\nin vec2 size,\nin float scaleFactor,\nin float isMapAligned\n) {\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nvec3 posBase = u_viewMat3 * u_tileMat3  * pos;\nvec3 offset1 = scaleFactor * vec3(a_vertexOffset1 / 16.0, 0.);\nvec3 offset2 = scaleFactor * vec3(a_vertexOffset2 / 16.0, 0.);\nvec2 pos0    = (posBase + getMatrixNoDisplay(isMapAligned) * offset).xy;\nvec2 pos1    = (posBase + getMatrixNoDisplay(isMapAligned) * offset1).xy;\nvec2 pos2    = (posBase + getMatrixNoDisplay(isMapAligned) * offset2).xy;\nvec3 bary0 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary1 = xyToBarycentric(u_hittestPos + vec2(0., -u_hittestDist), pos0, pos1, pos2);\nvec3 bary2 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, -u_hittestDist), pos0, pos1, pos2);\nvec3 bary3 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary4 = xyToBarycentric(u_hittestPos, pos0, pos1, pos2);\nvec3 bary5 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, 0.), pos0, pos1, pos2);\nvec3 bary6 = xyToBarycentric(u_hittestPos + vec2(-u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec3 bary7 = xyToBarycentric(u_hittestPos + vec2(0., u_hittestDist), pos0, pos1, pos2);\nvec3 bary8 = xyToBarycentric(u_hittestPos + vec2(u_hittestDist, u_hittestDist), pos0, pos1, pos2);\nvec2 tex0 = a_texCoords  / u_mosaicSize;\nvec2 tex1 = a_texCoords1 / u_mosaicSize;\nvec2 tex2 = a_texCoords2 / u_mosaicSize;\nfloat alphaSum = 0.;\nalphaSum += inTriangle(bary0) * getColor(size, getTextureCoords(bary0, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary1) * getColor(size, getTextureCoords(bary1, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary2) * getColor(size, getTextureCoords(bary2, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary3) * getColor(size, getTextureCoords(bary3, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary4) * getColor(size, getTextureCoords(bary4, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary5) * getColor(size, getTextureCoords(bary5, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary6) * getColor(size, getTextureCoords(bary6, tex0, tex1, tex2)).a;\nalphaSum += inTriangle(bary7) * getColor(size, getTextureCoords(bary7, tex0, tex1, tex2)).a;\nout_pos.z += step(alphaSum, .05) * 2.0;\nout_color = vec4(1. / 255., 0., 0., alphaSum / 255.);\n}\n#endif","icon.frag":"precision mediump float;\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/icon/common.glsl>\nvoid main()\n{\n#ifdef HITTEST\nvec4 color = v_color;\n#else\nvec4 color = getColor(v_sizeTex.xy, v_sizeTex.zw);\n#endif\n#ifdef HIGHLIGHT\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","icon.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_outlineColor;\nattribute vec4 a_sizeAndOutlineWidth;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nattribute vec2 a_bitSetAndDistRatio;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/icon/common.glsl>\n#include <materials/icon/hittest.glsl>\nfloat getMarkerScaleFactor(inout vec2 size, in float referenceSize) {\n#ifdef VV_SIZE\nfloat f = getSize(size.y) / size.y;\nfloat sizeFactor = size.y / referenceSize;\nreturn getSize(referenceSize) / referenceSize;\n#else\nreturn 1.;\n#endif\n}\nvoid main()\n{\nINIT;\nfloat a_bitSet = a_bitSetAndDistRatio.x;\nvec3  pos           = vec3(a_pos * POSITION_PRECISION, 1.0);\nvec2  size          = a_sizeAndOutlineWidth.xy * a_sizeAndOutlineWidth.xy / 128.0;\nvec3  offset        = vec3(a_vertexOffset / 16.0, 0.);\nfloat outlineSize   = a_sizeAndOutlineWidth.z * a_sizeAndOutlineWidth.z / 128.0;\nfloat isMapAligned  = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nfloat referenceSize = a_sizeAndOutlineWidth.w * a_sizeAndOutlineWidth.w / 128.0;\nfloat scaleSymbolProportionally = getBit(a_bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\nfloat scaleFactor               = getMarkerScaleFactor(size, referenceSize);\nsize.xy     *= scaleFactor;\noffset.xy   *= scaleFactor;\noutlineSize *= scaleSymbolProportionally * (scaleFactor - 1.0) + 1.0;\nvec2 v_tex   = a_texCoords / u_mosaicSize;\nfloat filterFlags = getFilterFlags();\nv_color    = getColor(a_color, a_bitSet, BITSET_GENERIC_LOCK_COLOR);\nv_opacity  = getOpacity();\nv_id       = norm(a_id);\nv_pos      = u_dvsMat3 * pos + getMatrix(isMapAligned) * getRotation()  * offset;\nv_sizeTex  = vec4(size.xy, v_tex.xy);\n#ifdef SDF\nv_isThin   = getBit(a_bitSet, BITSET_MARKER_OUTLINE_ALLOW_COLOR_OVERRIDE);\n#ifdef VV_COLOR\nv_overridingOutlineColor = v_isThin;\n#else\nv_overridingOutlineColor = 0.0;\n#endif\nv_outlineWidth = min(outlineSize, max(max(size.x, size.y) - 0.99, 0.0));\nv_outlineColor = a_outlineColor;\nv_distRatio = a_bitSetAndDistRatio.y / 128.0;\n#endif\n#ifdef HITTEST\nhighp vec4 out_color = vec4(0.);\nhighp vec3 out_pos   = vec3(0.);\nhittestIcon(out_color, out_pos, pos, offset, size, scaleFactor, isMapAligned);\nv_color = out_color;\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},label:{"common.glsl":"uniform mediump float u_zoomLevel;\nuniform mediump float u_mapRotation;\nuniform mediump float u_mapAligned;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying mediump vec2 v_tex;\nvarying mediump vec4 v_color;\nvarying lowp vec4 v_animation;","label.frag":"#include <materials/text/text.frag>","label.vert":"precision highp float;\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texAndSize;\nattribute vec4 a_refSymbolAndPlacementOffset;\nattribute vec4 a_glyphData;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nuniform float u_mapRotation;\nuniform float u_mapAligned;\nfloat getZ(in float minZoom, in float maxZoom, in float angle) {\nfloat glyphAngle = angle * 360.0 / 254.0;\nfloat mapAngle = u_mapRotation * 360.0 / 254.0;\nfloat diffAngle = min(360.0 - abs(mapAngle - glyphAngle), abs(mapAngle - glyphAngle));\nfloat z = 0.0;\nz += u_mapAligned * (2.0 * (1.0 - step(minZoom, u_currentZoom)));\nz += u_mapAligned * 2.0 * step(90.0, diffAngle);\nz += 2.0 * (1.0 - step(u_currentZoom, maxZoom));\nreturn z;\n}\nvoid main()\n{\nINIT;\nfloat groupMinZoom    = getMinZoom();\nfloat glyphMinZoom    = a_glyphData.x;\nfloat glyphMaxZoom    = a_glyphData.y;\nfloat glyphAngle      = a_glyphData.z;\nfloat a_isBackground  = a_glyphData.w;\nfloat a_minZoom          = max(groupMinZoom, glyphMinZoom);\nfloat a_placementPadding = a_refSymbolAndPlacementOffset.x * EXTRUDE_SCALE_PLACEMENT_PADDING;\nvec2  a_placementDir     = unpack_u8_nf32(a_refSymbolAndPlacementOffset.zw);\nfloat a_refSymbolSize    = a_refSymbolAndPlacementOffset.y;\nfloat fontSize           = a_texAndSize.z;\nfloat haloSize           = a_texAndSize.w * OUTLINE_SCALE;\nvec2  vertexOffset = a_vertexOffset * OFFSET_PRECISION;\nvec3  pos          = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat z            = getZ(a_minZoom, glyphMaxZoom, glyphAngle);\nfloat fontScale    = fontSize / SDF_FONT_SIZE;\nfloat halfSize     = getSize(a_refSymbolSize) / 2.0;\nfloat animation    = pow(getAnimationState(), vec4(2.0)).r;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor = (isBackground + isText) * a_color;\nv_color     = animation * ((1.0 - u_isHaloPass) * nonHaloColor + (u_isHaloPass * a_haloColor));\nv_opacity   = 1.0;\nv_tex       = a_texCoords / u_mosaicSize;\nv_edgeDistanceOffset = u_isHaloPass * haloSize / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\nvec2 placementOffset = a_placementDir * (halfSize + a_placementPadding);\nvec3 glyphOffset     = u_displayMat3 * vec3(vertexOffset + placementOffset, 0.0);\nvec3 v_pos           = vec3((u_dvsMat3 * pos + glyphOffset).xy, z);\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\ngl_Position = vec4(v_pos, 1.0);\n#ifdef DEBUG\nv_color = vec4(a_color.rgb, z == 0.0 ? 1.0 : 0.645);\n#endif\n}"},line:{"common.glsl":"varying lowp vec4 v_color;\nvarying highp vec3 v_id;\nvarying mediump vec2 v_normal;\nvarying mediump float v_lineHalfWidth;\nvarying lowp float v_opacity;\n#ifdef PATTERN\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\n#endif\n#if defined(PATTERN) || defined(SDF)\nvarying highp float v_accumulatedDistance;\n#endif\n#ifdef SDF\nvarying mediump float v_lineWidthRatio;\n#endif","hittest.glsl":"#include <materials/hittest/common.glsl>\n#ifdef HITTEST\nattribute vec2 a_pos1;\nattribute vec2 a_pos2;\nvoid hittestLine(out lowp vec4 out_color, out highp vec3 out_pos, float halfWidth) {\nvec3 pos        = u_viewMat3 * u_tileMat3 * vec3(a_pos  * POSITION_PRECISION, 1.);\nvec3 pos1       = u_viewMat3 * u_tileMat3 * vec3(a_pos1 * POSITION_PRECISION, 1.);\nvec3 pos2       = u_viewMat3 * u_tileMat3 * vec3(a_pos2 * POSITION_PRECISION, 1.);\nvec3 outTextureCoords = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nfloat dist = min(distPointSegment(u_hittestPos, pos.xy, pos1.xy),\ndistPointSegment(u_hittestPos, pos.xy, pos2.xy)) - halfWidth;\nout_pos = vec3(getAttributeDataTextureCoords(a_id), 0.0);\nif (dist >= u_hittestDist) {\nout_pos.z += 2.0;\n}\nout_color = vec4(1. / 255., 0, 0, dist <= 0. ? (1. / 255.) : 0.);\n}\n#endif","line.frag":"precision lowp float;\n#include <util/encoding.glsl>\n#include <materials/constants.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.frag>\n#ifdef HITTEST\nvoid main() {\ngl_FragColor = v_color;\n}\n#else\nvoid main() {\nLineData inputs = LineData(\nv_color,\nv_normal,\nv_lineHalfWidth,\nv_opacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr,\nv_patternSize,\n#endif\n#ifdef SDF\nv_lineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance,\n#endif\n#endif\nv_id\n);\ngl_FragColor = shadeLine(inputs);\n}\n#endif","line.vert":"precision highp float;\nattribute vec4 a_color;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\nattribute vec4 a_tlbr;\nattribute vec4 a_segmentDirection;\nattribute vec2 a_aux;\nattribute vec2 a_zoomRange;\n#include <materials/vcommon.glsl>\n#include <materials/symbologyTypeUtils.glsl>\n#include <materials/line/common.glsl>\n#include <materials/line/hittest.glsl>\n#include <materials/shared/line/common.glsl>\n#include <materials/shared/line/line.vert>\n#ifdef HITTEST\nvoid draw() {\nfloat aa        = 0.5 * u_antialiasing;\nfloat a_halfWidth = a_accumulatedDistanceAndHalfWidth.y / 16.;\nfloat a_cimHalfWidth = a_aux.x / 16. ;\nvec2  a_offset = a_offsetAndNormal.xy / 16.;\nfloat baseWidth = getBaseLineHalfWidth(a_halfWidth, a_cimHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nhighp vec3 pos  = vec3(0.);\nv_color = vec4(0.);\nhittestLine(v_color, pos, halfWidth);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#else\nvoid draw()\n{\nhighp vec3 pos = vec3(0.);\nLineData outputs = buildLine(\npos,\na_id,\na_pos,\na_color,\na_offsetAndNormal.xy / 16.,\na_offsetAndNormal.zw / 16.,\na_accumulatedDistanceAndHalfWidth.x,\na_accumulatedDistanceAndHalfWidth.y / 16.,\na_segmentDirection.w,\na_tlbr,\na_segmentDirection.xy / 16.,\na_aux.x / 16.\n);\nv_id              = outputs.id;\nv_color           = outputs.color;\nv_normal          = outputs.normal;\nv_lineHalfWidth   = outputs.lineHalfWidth;\nv_opacity         = outputs.opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nv_tlbr          = outputs.tlbr;\nv_patternSize   = outputs.patternSize;\n#endif\n#ifdef SDF\nv_lineWidthRatio = outputs.lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nv_accumulatedDistance = outputs.accumulatedDistance;\n#endif\n#endif\ngl_Position = vec4(clip(outputs.color, pos, getFilterFlags(), a_zoomRange), 1.0);\n}\n#endif\nvoid main() {\nINIT;\ndraw();\n}"},pie:{"pie.common.glsl":"uniform float outlineWidth;\nuniform mediump float sectorThreshold;\nvarying vec3  v_id;\nvarying vec3  v_pos;\nvarying vec2  v_offset;\nvarying vec4  v_color;\nvarying float v_size;\nvarying float v_numOfEntries;\nvarying float v_maxSectorAngle;\nvarying vec2  v_filteredSectorToColorId[numberOfFields];\nvarying vec2  v_texCoords;\nvarying float v_outlineWidth;\nvarying float v_opacity;\nstruct FilteredChartInfo {\nfloat endSectorAngle;\nint colorId;\n};","pie.frag":"precision highp float;\n#include <util/atan2.glsl>\n#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/pie/pie.common.glsl>\nuniform lowp vec4 colors[numberOfFields];\nuniform lowp vec4 defaultColor;\nuniform lowp vec4 othersColor;\nuniform lowp vec4 outlineColor;\nuniform float donutRatio;\nlowp vec4 getSectorColor(in int index, in vec2 filteredSectorToColorId[numberOfFields]) {\nmediump int colorIndex = int(filteredSectorToColorId[index].y);\nreturn colors[colorIndex];\n}\nconst int OTHER_SECTOR_ID = 255;\n#ifdef HITTEST\nvec4 getColor() {\nfloat distanceSize = length(v_offset) * v_size;\nfloat donutSize = donutRatio * v_size;\nfloat alpha = step(donutSize, distanceSize) * (1.0 - step(v_size, distanceSize));\nreturn v_color;\n}\n#else\nvec4 getColor() {\nfloat angle = 90.0 - C_RAD_TO_DEG * atan2(v_offset.y, v_offset.x);\nif (angle < 0.0) {\nangle += 360.0;\n} else if (angle > 360.0) {\nangle = mod(angle, 360.0);\n}\nint numOfEntries = int(v_numOfEntries);\nfloat maxSectorAngle = v_maxSectorAngle;\nlowp vec4 fillColor = (maxSectorAngle > 0.0 || sectorThreshold > 0.0) ? othersColor : defaultColor;\nlowp vec4 prevColor = vec4(0.0);\nlowp vec4 nextColor = vec4(0.0);\nfloat startSectorAngle = 0.0;\nfloat endSectorAngle = 0.0;\nif (angle < maxSectorAngle) {\nfor (int index = 0; index < numberOfFields; ++index) {\nstartSectorAngle = endSectorAngle;\nendSectorAngle = v_filteredSectorToColorId[index].x;\nif (endSectorAngle > angle) {\nfillColor = getSectorColor(index, v_filteredSectorToColorId);\nprevColor = sectorThreshold != 0.0 && index == 0 && abs(360.0 - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index > 0 ? index - 1 : numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = sectorThreshold != 0.0 && abs(endSectorAngle - maxSectorAngle) < EPSILON ? othersColor :\ngetSectorColor(index < numOfEntries - 1 ? index + 1 : 0, v_filteredSectorToColorId);\nbreak;\n}\nif (index == numOfEntries - 1) {\nbreak;\n}\n}\n} else {\nprevColor = getSectorColor(numOfEntries - 1, v_filteredSectorToColorId);\nnextColor = getSectorColor(0, v_filteredSectorToColorId);\nstartSectorAngle = maxSectorAngle;\nendSectorAngle = 360.0;\n}\nlowp vec4 outlineColor = outlineColor;\nfloat offset = length(v_offset);\nfloat distanceSize = offset * v_size;\nif (startSectorAngle != 0.0 || endSectorAngle != 360.0) {\nfloat distanceToStartSector = (angle - startSectorAngle);\nfloat distanceToEndSector = (endSectorAngle - angle);\nfloat sectorThreshold = 0.6;\nfloat beginSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToStartSector * offset);\nfloat endSectorAlpha = smoothstep(0.0, sectorThreshold, distanceToEndSector * offset);\nif (endSectorAlpha > 0.0) {\nfillColor = mix(nextColor, fillColor, endSectorAlpha);\n} else if (beginSectorAlpha > 0.0) {\nfillColor = mix(prevColor, fillColor, beginSectorAlpha);\n}\n}\nfloat donutSize = donutRatio * (v_size - v_outlineWidth);\nfloat endOfDonut = donutSize - v_outlineWidth;\nfloat aaThreshold = 0.75;\nfloat innerCircleAlpha = endOfDonut - aaThreshold > 0.0 ? smoothstep(endOfDonut - aaThreshold, endOfDonut + aaThreshold, distanceSize) : 1.0;\nfloat outerCircleAlpha = 1.0 - smoothstep(v_size - aaThreshold, v_size + aaThreshold , distanceSize);\nfloat circleAlpha = innerCircleAlpha * outerCircleAlpha;\nfloat startOfOutline = v_size - v_outlineWidth;\nif (startOfOutline > 0.0 && v_outlineWidth > 0.25) {\nfloat outlineFactor = smoothstep(startOfOutline - aaThreshold, startOfOutline + aaThreshold, distanceSize);\nfloat innerLineFactor = donutSize - aaThreshold > 0.0 ? 1.0 - smoothstep(donutSize - aaThreshold, donutSize + aaThreshold , distanceSize) : 0.0;\nfillColor = mix(fillColor, outlineColor, innerLineFactor + outlineFactor);\n}\nreturn v_opacity * circleAlpha * fillColor;\n}\n#endif\nvoid main()\n{\nvec4 color = getColor();\n#ifdef highlight\ncolor.a = step(1.0 / 255.0, color.a);\n#endif\ngl_FragColor = color;\n}","pie.vert":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/barycentric.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/vv.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/pie/pie.common.glsl>\n#include <materials/hittest/common.glsl>\nattribute float a_bitSet;\nattribute vec2  a_offset;\nattribute vec2  a_texCoords;\nattribute vec2  a_size;\nattribute float a_referenceSize;\nattribute vec2  a_zoomRange;\nint filterValue(in float sectorAngle,\nin int currentIndex,\ninout FilteredChartInfo filteredInfo,\ninout vec2 filteredSectorToColorId[numberOfFields]) {\nif (sectorAngle > sectorThreshold * 360.0) {\nfilteredInfo.endSectorAngle += sectorAngle;\nfilteredSectorToColorId[filteredInfo.colorId] = vec2(filteredInfo.endSectorAngle, currentIndex);\n++filteredInfo.colorId;\n}\nreturn 0;\n}\nint filterValues(inout vec2 filteredSectorToColorId[numberOfFields],\ninout FilteredChartInfo filteredInfo,\nin float sectorAngles[numberOfFields]) {\nfor (int index = 0; index < numberOfFields; ++index) {\nfloat sectorValue = sectorAngles[index];\nfilterValue(sectorValue, index, filteredInfo, filteredSectorToColorId);\n}\nreturn filteredInfo.colorId;\n}\nvec2 getMarkerSize(inout vec2 offset, inout vec2 baseSize, inout float outlineSize, in float a_referenceSize, in float bitSet) {\nvec2 outSize = baseSize;\n#ifdef VV_SIZE\nfloat r = getSize(a_referenceSize, currentScale) / a_referenceSize;\noutSize.xy *= r;\noffset.xy *= r;\nfloat scaleSymbolProportionally = getBit(bitSet, BITSET_MARKER_SCALE_SYMBOLS_PROPORTIONALLY);\noutlineSize *= scaleSymbolProportionally * (r - 1.0) + 1.0;\n#endif\nreturn outSize;\n}\nvec3 getOffset(in vec2 in_offset, float a_bitSet) {\nfloat isMapAligned = getBit(a_bitSet, BITSET_MARKER_ALIGNMENT_MAP);\nvec3  offset       = vec3(in_offset, 0.0);\nreturn getMatrix(isMapAligned) * offset;\n}\nfloat filterNaNValues(in float value) {\nreturn value != NAN_MAGIC_NUMBER && value > 0.0 ? value : 0.0;\n}\nvoid main()\n{\nINIT;\nvec2  a_size   = a_size;\nvec2  a_offset = a_offset / 16.0;\nfloat outlineSize = outlineWidth;\nfloat a_bitSet = a_bitSet;\nfloat a_referenceSize = a_referenceSize;\nvec2 a_texCoords = a_texCoords / 4.0;\nvec2 markerSize = getMarkerSize(a_offset, a_size, outlineSize, a_referenceSize, a_bitSet);\nfloat filterFlags = getFilterFlags();\nvec3  pos         = vec3(a_pos / 10.0, 1.0);\nv_opacity      = getOpacity();\nv_id           = norm(a_id);\nv_pos          = displayViewScreenMat3 * pos + getOffset(a_offset, a_bitSet);\nv_offset       = sign(a_texCoords - 0.5);\nv_size         = max(markerSize.x, markerSize.y);\nv_outlineWidth = outlineSize;\nfloat attributeData[10];\nvec4 attributeData3 = getDataDriven0(a_id);\nattributeData[0] = filterNaNValues(attributeData3.x);\nattributeData[1] = filterNaNValues(attributeData3.y);\nattributeData[2] = filterNaNValues(attributeData3.z);\nattributeData[3] = filterNaNValues(attributeData3.w);\n#if (numberOfFields > 4)\nvec4 attributeData4 = getDataDriven1(a_id);\nattributeData[4] = filterNaNValues(attributeData4.x);\nattributeData[5] = filterNaNValues(attributeData4.y);\nattributeData[6] = filterNaNValues(attributeData4.z);\nattributeData[7] = filterNaNValues(attributeData4.w);\n#endif\n#if (numberOfFields > 8)\nvec4 attributeData5 = getDataDriven2(a_id);\nattributeData[8] = filterNaNValues(attributeData5.x);\nattributeData[9] = filterNaNValues(attributeData5.y);\n#endif\nfloat sum = 0.0;\nfor (int i = 0; i < numberOfFields; ++i) {\nsum += attributeData[i];\n}\nfloat sectorAngles[numberOfFields];\nfor (int i = 0; i < numberOfFields; ++i) {\nsectorAngles[i] = 360.0 * attributeData[i] / sum;\n}\nvec2 filteredSectorToColorId[numberOfFields];\nFilteredChartInfo filteredInfo = FilteredChartInfo(0.0, 0);\nint numOfEntries = filterValues(filteredSectorToColorId, filteredInfo, sectorAngles);\nv_numOfEntries = float(numOfEntries);\nv_maxSectorAngle = filteredInfo.endSectorAngle;\nv_filteredSectorToColorId = filteredSectorToColorId;\n#ifdef HITTEST\nhighp vec3 out_pos = vec3(0.0);\nv_color            = vec4(0.0);\nhittestMarker(v_color, out_pos, viewMat3 * tileMat3 *  pos, v_size);\ngl_PointSize = 1.0;\ngl_Position = vec4(clip(v_color, out_pos, filterFlags, a_zoomRange), 1.0);\n#else\ngl_Position = vec4(clip(v_color, v_pos, filterFlags, a_zoomRange), 1.0);\n#endif\n}"},shared:{line:{"common.glsl":"#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump float v_sampleAlphaOnly;\n#endif\nstruct LineData {\nlowp vec4 color;\nmediump vec2 normal;\nmediump float lineHalfWidth;\nlowp float opacity;\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nmediump vec4 tlbr;\nmediump vec2 patternSize;\n#endif\n#ifdef SDF\nmediump float lineWidthRatio;\n#endif\n#if defined(PATTERN) || defined(SDF)\nhighp float accumulatedDistance;\n#endif\n#endif\nhighp vec3 id;\n};","line.frag":"uniform lowp float u_blur;\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && !defined(HIGHLIGHT)\n#if defined(PATTERN) || defined(SDF)\nuniform sampler2D u_texture;\nuniform highp float u_pixelRatio;\n#endif\n#endif\n#if defined(SDF) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float adjustedPatternWidth = line.patternSize.x * 2.0 * line.lineWidthRatio;\nmediump float relativeTexX = fract(line.accumulatedDistance / adjustedPatternWidth);\nmediump float relativeTexY = 0.5 + 0.25 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * line.lineHalfWidth;\nreturn line.opacity * clamp(0.5 - dist, 0.0, 1.0) * line.color;\n}\n#elif defined(PATTERN) && !defined(HIGHLIGHT) && !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE)\nlowp vec4 getLineColor(LineData line) {\nmediump float lineHalfWidth = line.lineHalfWidth;\nmediump float adjustedPatternHeight = line.patternSize.y * 2.0 * lineHalfWidth / line.patternSize.x;\nmediump float relativeTexY = fract(line.accumulatedDistance / adjustedPatternHeight);\nmediump float relativeTexX = 0.5 + 0.5 * line.normal.y;\nmediump vec2 texCoord = mix(line.tlbr.xy, line.tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\n#ifdef VV_COLOR\nif (v_sampleAlphaOnly > 0.5) {\ncolor.rgb = vec3(color.a);\n}\n#endif\nreturn line.opacity * line.color * color;\n}\n#else\nlowp vec4 getLineColor(LineData line) {\nreturn line.opacity * line.color;\n}\n#endif\nvec4 shadeLine(LineData line)\n{\nmediump float thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(line.lineHalfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nmediump float fragDist = length(line.normal) * line.lineHalfWidth;\nlowp float alpha = clamp(thinLineFactor * (line.lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\nlowp vec4 out_color = getLineColor(line) * alpha;\n#ifdef HIGHLIGHT\nout_color.a = step(1.0 / 255.0, out_color.a);\n#endif\n#ifdef ID\nif (out_color.a < 1.0 / 255.0) {\ndiscard;\n}\nout_color = vec4(line.id, 0.0);\n#endif\nreturn out_color;\n}","line.vert":"float getBaseLineHalfWidth(in float lineHalfWidth, in float referenceHalfWidth) {\n#ifdef VV_SIZE\nfloat refLineWidth = 2.0 * referenceHalfWidth;\nreturn 0.5 * (lineHalfWidth / max(referenceHalfWidth, EPSILON)) * getSize(refLineWidth);\n#else\nreturn lineHalfWidth;\n#endif\n}\nfloat getLineHalfWidth(in float baseWidth, in float aa) {\nfloat halfWidth = max(baseWidth + aa, 0.45) + 0.1 * aa;\n#ifdef HIGHLIGHT\nhalfWidth = max(halfWidth, 2.0);\n#endif\nreturn halfWidth;\n}\nvec2 getDist(in vec2 offset, in float halfWidth) {\nfloat thinLineFactor = max(THIN_LINE_WIDTH_FACTOR * step(halfWidth, THIN_LINE_HALF_WIDTH), 1.0);\nreturn thinLineFactor * halfWidth * offset;\n}\nLineData buildLine(\nout vec3 out_pos,\nin vec3 in_id,\nin vec2 in_pos,\nin vec4 in_color,\nin vec2 in_offset,\nin vec2 in_normal,\nin float in_accumulatedDist,\nin float in_lineHalfWidth,\nin float in_bitSet,\nin vec4 in_tlbr,\nin vec2 in_segmentDirection,\nin float in_referenceHalfWidth\n)\n{\nfloat aa        = 0.5 * u_antialiasing;\nfloat baseWidth = getBaseLineHalfWidth(in_lineHalfWidth, in_referenceHalfWidth);\nfloat halfWidth = getLineHalfWidth(baseWidth, aa);\nfloat z         = 2.0 * step(baseWidth, 0.0);\nvec2  dist      = getDist(in_offset, halfWidth);\nvec3  offset    = u_displayViewMat3 * vec3(dist, 0.0);\nvec3  pos       = u_dvsMat3 * vec3(in_pos * POSITION_PRECISION, 1.0) + offset;\n#ifdef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\nvec4  color     = in_color;\nfloat opacity   = 1.0;\n#else\nvec4  color     = getColor(in_color, in_bitSet, BITSET_GENERIC_LOCK_COLOR);\nfloat opacity   = getOpacity();\n#ifdef SDF\nconst float SDF_PATTERN_HALF_WIDTH = 15.5;\nfloat scaleDash = getBit(in_bitSet, BITSET_LINE_SCALE_DASH);\nfloat lineWidthRatio = (scaleDash * max(halfWidth - 0.55 * u_antialiasing, 0.25) + (1.0 - scaleDash)) / SDF_PATTERN_HALF_WIDTH;\n#endif\n#endif\n#if !defined(SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE) && defined(PATTERN)\nv_sampleAlphaOnly = getBit(in_bitSet, BITSET_GENERIC_CONSIDER_ALPHA_ONLY);\n#endif\nout_pos = vec3(pos.xy, z);\nreturn LineData(\ncolor,\nin_normal,\nhalfWidth,\nopacity,\n#ifndef SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#ifdef PATTERN\nin_tlbr / u_mosaicSize.xyxy,\nvec2(in_tlbr.z - in_tlbr.x, in_tlbr.w - in_tlbr.y),\n#endif\n#ifdef SDF\nlineWidthRatio,\n#endif\n#if defined(PATTERN) || defined(SDF)\nin_accumulatedDist * u_zoomFactor + dot(in_segmentDirection, dist),\n#endif\n#endif\nnorm(in_id)\n);\n}"}},"symbologyTypeUtils.glsl":"#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_OUTLINE_FILL_LIKE\n#endif\n#if SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_SIMPLE || SYMBOLOGY_TYPE == SYMBOLOGY_TYPE_OUTLINE_FILL_SIMPLE\n#define SYMBOLOGY_TYPE_IS_SIMPLE_LIKE\n#endif",text:{"common.glsl":"uniform highp vec2 u_mosaicSize;\nvarying highp vec3 v_id;\nvarying mediump vec3 v_pos;\nvarying lowp float v_opacity;\nvarying lowp vec4 v_color;\nvarying highp vec2 v_tex;\nvarying mediump float v_antialiasingWidth;\nvarying mediump float v_edgeDistanceOffset;\nvarying lowp float v_transparency;","hittest.glsl":"#include <materials/hittest/common.glsl>","text.frag":"precision mediump float;\n#include <materials/text/common.glsl>\nuniform lowp sampler2D u_texture;\n#ifdef HITTEST\nvec4 getColor() {\nreturn v_color;\n}\n#else\nvec4 getColor()\n{\nfloat SDF_CUTOFF = (2.0 / 8.0);\nfloat SDF_BASE_EDGE_DIST = 1.0 - SDF_CUTOFF;\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float edge = SDF_BASE_EDGE_DIST - v_edgeDistanceOffset;\n#ifdef HIGHLIGHT\nedge /= 2.0;\n#endif\nlowp float aa = v_antialiasingWidth;\nlowp float alpha = smoothstep(edge - aa, edge + aa, dist);\nreturn alpha * v_color * v_opacity;\n}\n#endif\nvoid main()\n{\ngl_FragColor = getColor();\n}","text.vert":"precision highp float;\n#include <materials/utils.glsl>\n#include <materials/vcommon.glsl>\n#include <materials/text/common.glsl>\n#include <materials/text/hittest.glsl>\nattribute vec4 a_color;\nattribute vec4 a_haloColor;\nattribute vec4 a_texFontSize;\nattribute vec4 a_aux;\nattribute vec2 a_zoomRange;\nattribute vec2 a_vertexOffset;\nattribute vec2 a_texCoords;\nuniform float u_isHaloPass;\nuniform float u_isBackgroundPass;\nfloat getTextSize(inout vec2 offset, inout float baseSize, in float referenceSize) {\n#ifdef VV_SIZE\nfloat r = getSize(referenceSize) / referenceSize;\nbaseSize *= r;\noffset.xy *= r;\nreturn baseSize;\n#endif\nreturn baseSize;\n}\nvoid main()\n{\nINIT;\nfloat a_isBackground  = a_aux.y;\nfloat a_referenceSize = a_aux.z * a_aux.z / 256.0;\nfloat a_bitSet        = a_aux.w;\nfloat a_fontSize      = a_texFontSize.z;\nvec2  a_offset        = a_vertexOffset * OFFSET_PRECISION;\nvec3  in_pos        = vec3(a_pos * POSITION_PRECISION, 1.0);\nfloat fontSize      = getTextSize(a_offset, a_fontSize, a_referenceSize);\nfloat fontScale     = fontSize / SDF_FONT_SIZE;\nvec3  offset        = getRotation() * vec3(a_offset, 0.0);\nmat3  extrudeMatrix = getBit(a_bitSet, 0) == 1.0 ? u_displayViewMat3 : u_displayMat3;\nfloat isText = 1.0 - a_isBackground;\nfloat isBackground = u_isBackgroundPass * a_isBackground;\nvec4  nonHaloColor  = (isBackground * a_color) + (isText * getColor(a_color, a_bitSet, 1));\nv_color   = u_isHaloPass * a_haloColor + (1.0 - u_isHaloPass) * nonHaloColor;\nv_opacity = getOpacity();\nv_id      = norm(a_id);\nv_tex     = a_texCoords / u_mosaicSize;\nv_pos     = u_dvsMat3 * in_pos + extrudeMatrix * offset;\nfloat isHidden = u_isBackgroundPass * isText + (1.0 - u_isBackgroundPass) * a_isBackground;\nv_pos.z += 2.0 * isHidden;\nv_edgeDistanceOffset = u_isHaloPass * OUTLINE_SCALE * a_texFontSize.w / fontScale / MAX_SDF_DISTANCE;\nv_antialiasingWidth  = 0.105 * SDF_FONT_SIZE / fontSize / u_pixelRatio;\n#ifdef HITTEST\nhighp vec3 out_pos  = vec3(0.);\nv_color = vec4(0.);\nhittestMarker(v_color, out_pos, u_viewMat3 * u_tileMat3 *  vec3(a_pos * POSITION_PRECISION, 1.0)\n+ u_tileMat3 * offset, fontSize / 2.);\ngl_PointSize = 1.;\ngl_Position = vec4(clip(v_color, out_pos, getFilterFlags(), a_zoomRange), 1.0);\n#else\ngl_Position =  vec4(clip(v_color, v_pos, getFilterFlags(), a_zoomRange), 1.0);\n#endif\n}"},"utils.glsl":"float rshift(in float u32, in int amount) {\nreturn floor(u32 / pow(2.0, float(amount)));\n}\nfloat getBit(in float bitset, in int bitIndex) {\nfloat offset = pow(2.0, float(bitIndex));\nreturn mod(floor(bitset / offset), 2.0);\n}\nconst int maxHighlightReasons = 6;\nfloat getFilterBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex + maxHighlightReasons);\n}\nfloat getHighlightBit(in float bitset, in int bitIndex) {\nreturn getBit(bitset, bitIndex);\n}\nhighp vec3 unpackDisplayIdTexel(in highp vec3 bitset) {\nfloat isAggregate = getBit(bitset.b, 7);\nreturn (1.0 - isAggregate) * bitset + isAggregate * (vec3(bitset.rgb) - vec3(0.0, 0.0, float(0x80)));\n}\nvec4 unpack(in float u32) {\nfloat r = mod(rshift(u32, 0), 255.0);\nfloat g = mod(rshift(u32, 8), 255.0);\nfloat b = mod(rshift(u32, 16), 255.0);\nfloat a = mod(rshift(u32, 24), 255.0);\nreturn vec4(r, g, b, a);\n}\nvec3 norm(in vec3 v) {\nreturn v /= 255.0;\n}\nvec4 norm(in vec4 v) {\nreturn v /= 255.0;\n}\nfloat max4(vec4 target) {\nreturn max(max(max(target.x, target.y), target.z), target.w);\n}\nvec2 unpack_u8_nf32(vec2 bytes) {\nreturn (bytes - 127.0) / 127.0;\n}\nhighp float rand(in vec2 co) {\nhighp float a = 12.9898;\nhighp float b = 78.233;\nhighp float c = 43758.5453;\nhighp float dt = dot(co, vec2(a,b));\nhighp float sn = mod(dt, 3.14);\nreturn fract(sin(sn) * c);\n}","vcommon.glsl":"#include <materials/constants.glsl>\n#include <materials/utils.glsl>\n#include <materials/attributeData.glsl>\n#include <materials/vv.glsl>\n#include <materials/barycentric.glsl>\nattribute vec2 a_pos;\nattribute highp vec3 a_id;\nuniform highp mat3 displayViewScreenMat3;\nuniform highp mat3 displayViewMat3;\nuniform highp mat3 displayMat3;\nuniform highp mat3 tileMat3;\nuniform highp mat3 viewMat3;\nuniform highp float pixelRatio;\nuniform mediump float zoomFactor;\nuniform mediump float antialiasing;\nuniform mediump float currentScale;\nuniform mediump float currentZoom;\nuniform mediump float metersPerSRUnit;\nuniform mediump float activeReasons;\nuniform mediump float highlightAll;\nvec4 VV_ADATA = vec4(0.0);\nvoid loadVisualVariableData(inout vec4 target) {\ntarget.rgba = getVisualVariableData(a_id);\n}\n#ifdef VV\n#define INIT loadVisualVariableData(VV_ADATA)\n#else\n#define INIT\n#endif\nvec4 getColor(in vec4 a_color, in float a_bitSet, int index) {\n#ifdef VV_COLOR\nfloat isColorLocked   = getBit(a_bitSet, index);\nreturn getVVColor(VV_ADATA[ATTR_VV_COLOR], a_color, isColorLocked);\n#else\nreturn a_color;\n#endif\n}\nfloat getOpacity() {\n#ifdef VV_OPACITY\nreturn getVVOpacity(VV_ADATA[ATTR_VV_OPACITY]);\n#else\nreturn 1.0;\n#endif\n}\nfloat getSize(in float in_size, in float currentScale) {\n#ifdef VV_SIZE\nreturn getVVSize(in_size, VV_ADATA[ATTR_VV_SIZE], currentScale);\n#else\nreturn in_size;\n#endif\n}\nmat3 getRotation() {\n#ifdef VV_ROTATION\nreturn getVVRotationMat3(mod(VV_ADATA[ATTR_VV_ROTATION], 360.0));\n#else\nreturn mat3(1.0);\n#endif\n}\nfloat getFilterFlags() {\n#ifdef IGNORES_SAMPLER_PRECISION\nreturn ceil(getFilterData(a_id).x * 255.0);\n#else\nreturn getFilterData(a_id).x * 255.0;\n#endif\n}\nvec4 getAnimationState() {\nreturn getAnimation(a_id);\n}\nfloat getMinZoom() {\nvec4 data0 = getFilterData(a_id) * 255.0;\nreturn data0.g;\n}\nmat3 getMatrixNoDisplay(float isMapAligned) {\nreturn isMapAligned * viewMat3 * tileMat3 + (1.0 - isMapAligned) * tileMat3;\n}\nmat3 getMatrix(float isMapAligned) {\nreturn isMapAligned * displayViewMat3 + (1.0 - isMapAligned) * displayMat3;\n}\nfloat checkHighlightBit(float filterFlags, int index) {\nreturn getHighlightBit(filterFlags, index) * getBit(activeReasons, index);\n}\nfloat checkHighlight(float filterFlags) {\nfloat result = checkHighlightBit(filterFlags, 0);\nfor (int i = 1; i < maxHighlightReasons; i++) {\nresult = result + checkHighlightBit(filterFlags, i);\n}\nreturn step(0.1, result + highlightAll);\n}\nvec3 clip(inout vec4 color, inout vec3 pos, in float filterFlags, in vec2 minMaxZoom) {\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 0));\n#ifdef inside\npos.z += 2.0 * (1.0 - getFilterBit(filterFlags, 1));\n#elif defined(outside)\npos.z += 2.0 * getFilterBit(filterFlags, 1);\n#elif defined(highlight)\npos.z += 2.0 * (1.0 - checkHighlight(filterFlags));\n#endif\npos.z += 2.0 * (step(minMaxZoom.y, currentZoom) + (1.0 - step(minMaxZoom.x, currentZoom)));\nreturn pos;\n}","vv.glsl":"#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\n#define VV_SIZE\n#endif\n#if defined(VV_COLOR) || defined(VV_SIZE) || defined(VV_OPACITY) || defined(VV_ROTATION)\n#define VV\n#endif\n#ifdef VV_COLOR\nuniform highp float colorValues[8];\nuniform vec4 colors[8];\n#endif\n#ifdef VV_SIZE_MIN_MAX_VALUE\nuniform highp vec4 minMaxValueAndSize;\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nuniform highp float values[8];\nuniform float sizes[8];\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nuniform highp float unitMeterRatio;\n#endif\n#ifdef VV_OPACITY\nuniform highp float opacityValues[8];\nuniform float opacities[8];\n#endif\n#ifdef VV_ROTATION\nuniform lowp float rotationType;\n#endif\nbool isNan(float val) {\nreturn (val == NAN_MAGIC_NUMBER);\n}\n#ifdef VV_SIZE_MIN_MAX_VALUE\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nfloat interpolationRatio = (sizeValue  - minMaxValueAndSize.x) / (minMaxValueAndSize.y - minMaxValueAndSize.x);\ninterpolationRatio = clamp(interpolationRatio, 0.0, 1.0);\nreturn minMaxValueAndSize.z + interpolationRatio * (minMaxValueAndSize.w - minMaxValueAndSize.z);\n}\n#endif\n#ifdef VV_SIZE_SCALE_STOPS\nfloat getVVScaleStopsSize(float currentScale) {\nfloat outSize;\nif (currentScale <= values[0]) {\noutSize = sizes[0];\n} else {\nif (currentScale >= values[7]) {\noutSize = sizes[7];\n} else {\nint index;\nindex = -1;\nfor (int i = 0; i < 8; i++) {\nif (values[i] > currentScale) {\nindex = i;\nbreak;\n}\n}\nint prevIndex = index - 1;\nfloat a = currentScale - values[prevIndex];\nfloat b = values[index] - values[prevIndex];\noutSize = mix(sizes[prevIndex], sizes[index], a / b);\n}\n}\nreturn outSize;\n}\n#endif\n#ifdef VV_SIZE_FIELD_STOPS\nconst int VV_SIZE_N = 8;\nfloat getVVStopsSize(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nif (sizeValue <= values[0]) {\nreturn sizes[0];\n}\nif (sizeValue >= values[VV_SIZE_N - 1]) {\nreturn sizes[VV_SIZE_N - 1];\n}\nfor (int i = 1; i < VV_SIZE_N; ++i) {\nif (values[i] >= sizeValue) {\nfloat f = (sizeValue - values[i-1]) / (values[i] - values[i-1]);\nreturn mix(sizes[i-1], sizes[i], f);\n}\n}\nreturn sizes[VV_SIZE_N - 1];\n}\n#endif\n#ifdef VV_SIZE_UNIT_VALUE\nfloat getVVUnitValue(float sizeValue, float fallback) {\nif (isNan(sizeValue)) {\nreturn fallback;\n}\nreturn sizeValue * (metersPerSRUnit / unitMeterRatio);\n}\n#endif\n#ifdef VV_OPACITY\nconst int VV_OPACITY_N = 8;\nfloat getVVOpacity(float opacityValue) {\nif (isNan(opacityValue)) {\nreturn 1.0;\n}\nif (opacityValue <= opacityValues[0]) {\nreturn opacities[0];\n}\nfor (int i = 1; i < VV_OPACITY_N; ++i) {\nif (opacityValues[i] >= opacityValue) {\nfloat f = (opacityValue - opacityValues[i-1]) / (opacityValues[i] - opacityValues[i-1]);\nreturn mix(opacities[i-1], opacities[i], f);\n}\n}\nreturn opacities[VV_OPACITY_N - 1];\n}\n#endif\n#ifdef VV_ROTATION\nmat4 getVVRotation(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat4(1, 0, 0, 0,\n0, 1, 0, 0,\n0, 0, 1, 0,\n0, 0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat4(cosA, sinA, 0, 0,\n-sinA,  cosA, 0, 0,\n0,     0, 1, 0,\n0,     0, 0, 1);\n}\nmat3 getVVRotationMat3(float rotationValue) {\nif (isNan(rotationValue)) {\nreturn mat3(1, 0, 0,\n0, 1, 0,\n0, 0, 1);\n}\nfloat rotation = rotationValue;\nif (rotationType == 1.0) {\nrotation = 90.0 - rotation;\n}\nfloat angle = C_DEG_TO_RAD * -rotation;\nfloat sinA = sin(angle);\nfloat cosA = cos(angle);\nreturn mat3(cosA, -sinA, 0,\nsinA, cosA, 0,\n0,    0,    1);\n}\n#endif\n#ifdef VV_COLOR\nconst int VV_COLOR_N = 8;\nvec4 getVVColor(float colorValue, vec4 fallback, float isColorLocked) {\nif (isNan(colorValue) || isColorLocked == 1.0) {\nreturn fallback;\n}\nif (colorValue <= colorValues[0]) {\nreturn colors[0];\n}\nfor (int i = 1; i < VV_COLOR_N; ++i) {\nif (colorValues[i] >= colorValue) {\nfloat f = (colorValue - colorValues[i-1]) / (colorValues[i] - colorValues[i-1]);\nreturn mix(colors[i-1], colors[i], f);\n}\n}\nreturn colors[VV_COLOR_N - 1];\n}\n#endif\nfloat getVVSize(in float size, in float vvSize, in float currentScale)  {\n#ifdef VV_SIZE_MIN_MAX_VALUE\nreturn getVVMinMaxSize(vvSize, size);\n#elif defined(VV_SIZE_SCALE_STOPS)\nfloat outSize = getVVScaleStopsSize(currentScale);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_FIELD_STOPS)\nfloat outSize = getVVStopsSize(vvSize, size);\nreturn isNan(outSize) ? size : outSize;\n#elif defined(VV_SIZE_UNIT_VALUE)\nreturn getVVUnitValue(vvSize, size);\n#else\nreturn size;\n#endif\n}"},"post-processing":{blit:{"blit.frag":"precision mediump float;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\ngl_FragColor = texture2D(u_texture, v_uv);\n}"},bloom:{composite:{"composite.frag":"precision mediump float;\nvarying vec2 v_uv;\nuniform sampler2D u_blurTexture1;\nuniform sampler2D u_blurTexture2;\nuniform sampler2D u_blurTexture3;\nuniform sampler2D u_blurTexture4;\nuniform sampler2D u_blurTexture5;\nuniform float u_bloomStrength;\nuniform float u_bloomRadius;\nuniform float u_bloomFactors[NUMMIPS];\nuniform vec3 u_bloomTintColors[NUMMIPS];\nfloat lerpBloomFactor(const in float factor) {\nfloat mirrorFactor = 1.2 - factor;\nreturn mix(factor, mirrorFactor, u_bloomRadius);\n}\nvoid main() {\nvec4 color = u_bloomStrength * (\nlerpBloomFactor(u_bloomFactors[0]) * vec4(u_bloomTintColors[0], 1.0) * texture2D(u_blurTexture1, v_uv) +\nlerpBloomFactor(u_bloomFactors[1]) * vec4(u_bloomTintColors[1], 1.0) * texture2D(u_blurTexture2, v_uv) +\nlerpBloomFactor(u_bloomFactors[2]) * vec4(u_bloomTintColors[2], 1.0) * texture2D(u_blurTexture3, v_uv) +\nlerpBloomFactor(u_bloomFactors[3]) * vec4(u_bloomTintColors[3], 1.0) * texture2D(u_blurTexture4, v_uv) +\nlerpBloomFactor(u_bloomFactors[4]) * vec4(u_bloomTintColors[4], 1.0) * texture2D(u_blurTexture5, v_uv)\n);\ngl_FragColor = clamp(color, 0.0, 1.0);\n}"},gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\n#define SIGMA RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = float(SIGMA);\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},luminosityHighPass:{"luminosityHighPass.frag":"precision mediump float;\nuniform sampler2D u_texture;\nuniform vec3 u_defaultColor;\nuniform float u_defaultOpacity;\nuniform float u_luminosityThreshold;\nuniform float u_smoothWidth;\nvarying vec2 v_uv;\nvoid main() {\nvec4 texel = texture2D(u_texture, v_uv);\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat v = dot(texel.xyz, luma);\nvec4 outputColor = vec4(u_defaultColor.rgb, u_defaultOpacity);\nfloat alpha = smoothstep(u_luminosityThreshold, u_luminosityThreshold + u_smoothWidth, v);\ngl_FragColor = mix(outputColor, texel, alpha);\n}"}},blur:{gaussianBlur:{"gaussianBlur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nuniform vec2 u_direction;\nuniform float u_sigma;\nvarying vec2 v_uv;\n#define KERNEL_RADIUS RADIUS\nfloat gaussianPdf(in float x, in float sigma) {\nreturn 0.39894 * exp(-0.5 * x * x / ( sigma * sigma)) / sigma;\n}\nvoid main() {\nvec2 invSize = 1.0 / u_texSize;\nfloat fSigma = u_sigma;\nfloat weightSum = gaussianPdf(0.0, fSigma);\nvec4 pixelColorSum = texture2D(u_colorTexture, v_uv) * weightSum;\nfor (int i = 1; i < KERNEL_RADIUS; i ++) {\nfloat x = float(i);\nfloat w = gaussianPdf(x, fSigma);\nvec2 uvOffset = u_direction * invSize * x;\nvec4 sample1 = texture2D(u_colorTexture, v_uv + uvOffset);\nvec4 sample2 = texture2D(u_colorTexture, v_uv - uvOffset);\npixelColorSum += (sample1 + sample2) * w;\nweightSum += 2.0 * w;\n}\ngl_FragColor = pixelColorSum /weightSum;\n}"},"radial-blur":{"radial-blur.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nconst float sampleDist = 1.0;\nconst float sampleStrength = 2.2;\nvoid main(void) {\nfloat samples[10];\nsamples[0] = -0.08;\nsamples[1] = -0.05;\nsamples[2] = -0.03;\nsamples[3] = -0.02;\nsamples[4] = -0.01;\nsamples[5] =  0.01;\nsamples[6] =  0.02;\nsamples[7] =  0.03;\nsamples[8] =  0.05;\nsamples[9] =  0.08;\nvec2 dir = 0.5 - v_uv;\nfloat dist = sqrt(dir.x * dir.x + dir.y * dir.y);\ndir = dir / dist;\nvec4 color = texture2D(u_colorTexture,v_uv);\nvec4 sum = color;\nfor (int i = 0; i < 10; i++) {\nsum += texture2D(u_colorTexture, v_uv + dir * samples[i] * sampleDist);\n}\nsum *= 1.0 / 11.0;\nfloat t = dist * sampleStrength;\nt = clamp(t, 0.0, 1.0);\ngl_FragColor = mix(color, sum, t);\n}"}},dra:{"dra.frag":"precision mediump float;\nuniform sampler2D u_minColor;\nuniform sampler2D u_maxColor;\nuniform sampler2D u_texture;\nvarying vec2 v_uv;\nvoid main() {\nvec4 minColor = texture2D(u_minColor, vec2(0.5));\nvec4 maxColor = texture2D(u_maxColor, vec2(0.5));\nvec4 color = texture2D(u_texture, v_uv);\nvec3 minColorUnpremultiply = minColor.rgb / minColor.a;\nvec3 maxColorUnpremultiply = maxColor.rgb / maxColor.a;\nvec3 colorUnpremultiply = color.rgb / color.a;\nvec3 range = maxColorUnpremultiply - minColorUnpremultiply;\ngl_FragColor = vec4(color.a * (colorUnpremultiply - minColorUnpremultiply) / range, color.a);\n}","min-max":{"min-max.frag":"#extension GL_EXT_draw_buffers : require\nprecision mediump float;\n#define CELL_SIZE 2\nuniform sampler2D u_minTexture;\nuniform sampler2D u_maxTexture;\nuniform vec2 u_srcResolution;\nuniform vec2 u_dstResolution;\nvarying vec2 v_uv;\nvoid main() {\nvec2 srcPixel = floor(gl_FragCoord.xy) * float(CELL_SIZE);\nvec2 onePixel = vec2(1.0) / u_srcResolution;\nvec2 uv = (srcPixel + 0.5) / u_srcResolution;\nvec4 minColor = vec4(1.0);\nvec4 maxColor = vec4(0.0);\nfor (int y = 0; y < CELL_SIZE; ++y) {\nfor (int x = 0; x < CELL_SIZE; ++x) {\nvec2 offset = uv + vec2(x, y) * onePixel;\nminColor = min(minColor, texture2D(u_minTexture, offset));\nmaxColor = max(maxColor, texture2D(u_maxTexture, offset));\n}\n}\ngl_FragData[0] = minColor;\ngl_FragData[1] = maxColor;\n}"}},"drop-shadow":{composite:{"composite.frag":"precision mediump float;\nuniform sampler2D u_layerFBOTexture;\nuniform sampler2D u_blurTexture;\nuniform vec4 u_shadowColor;\nuniform vec2 u_shadowOffset;\nuniform highp mat3 u_displayViewMat3;\nvarying vec2 v_uv;\nvoid main() {\nvec3 offset = u_displayViewMat3 * vec3(u_shadowOffset, 0.0);\nvec4 layerColor = texture2D(u_layerFBOTexture, v_uv);\nvec4 blurColor = texture2D(u_blurTexture, v_uv - offset.xy / 2.0);\ngl_FragColor = ((1.0 - layerColor.a) * blurColor.a * u_shadowColor + layerColor);\n}"}},"edge-detect":{"frei-chen":{"frei-chen.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform vec2 u_texSize;\nvarying vec2 v_uv;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[9];\nconst mat3 g0 = mat3( 0.3535533845424652, 0, -0.3535533845424652, 0.5, 0, -0.5, 0.3535533845424652, 0, -0.3535533845424652 );\nconst mat3 g1 = mat3( 0.3535533845424652, 0.5, 0.3535533845424652, 0, 0, 0, -0.3535533845424652, -0.5, -0.3535533845424652 );\nconst mat3 g2 = mat3( 0, 0.3535533845424652, -0.5, -0.3535533845424652, 0, 0.3535533845424652, 0.5, -0.3535533845424652, 0 );\nconst mat3 g3 = mat3( 0.5, -0.3535533845424652, 0, -0.3535533845424652, 0, 0.3535533845424652, 0, 0.3535533845424652, -0.5 );\nconst mat3 g4 = mat3( 0, -0.5, 0, 0.5, 0, 0.5, 0, -0.5, 0 );\nconst mat3 g5 = mat3( -0.5, 0, 0.5, 0, 0, 0, 0.5, 0, -0.5 );\nconst mat3 g6 = mat3( 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.6666666865348816, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204 );\nconst mat3 g7 = mat3( -0.3333333432674408, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, 0.6666666865348816, 0.1666666716337204, -0.3333333432674408, 0.1666666716337204, -0.3333333432674408 );\nconst mat3 g8 = mat3( 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408, 0.3333333432674408 );\nvoid main() {\nG[0] = g0,\nG[1] = g1,\nG[2] = g2,\nG[3] = g3,\nG[4] = g4,\nG[5] = g5,\nG[6] = g6,\nG[7] = g7,\nG[8] = g8;\nmat3 I;\nfloat cnv[9];\nvec3 sample;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D(u_colorTexture, v_uv + texel * vec2(i - 1.0,j - 1.0)).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 9; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nfloat M = (cnv[0] + cnv[1]) + (cnv[2] + cnv[3]);\nfloat S = (cnv[4] + cnv[5]) + (cnv[6] + cnv[7]) + (cnv[8] + M);\ngl_FragColor = vec4(vec3(sqrt(M / S)), texture2D(u_colorTexture, v_uv).a);\n}"},sobel:{"sobel.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, -1.0, -2.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 0.0, -1.0, 2.0, 0.0, -2.0, 1.0, 0.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\ngl_FragColor = vec4(vec3(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1])), texture2D(u_colorTexture, v_uv).a);\n}"}},"edge-enhance":{"edge-enhance.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nvarying vec2 v_uv;\nuniform vec2 u_texSize;\nvec2 texel = vec2(1.0 / u_texSize.x, 1.0 / u_texSize.y);\nmat3 G[2];\nconst mat3 g0 = mat3( 1.0, 0.0, -1.0, 1.0, 0.0, -1.0, 1.0, 0.0, -1.0 );\nconst mat3 g1 = mat3( 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, -1.0, -1.0, -1.0 );\nvoid main() {\nmat3 I;\nfloat cnv[2];\nvec3 sample;\nG[0] = g0;\nG[1] = g1;\nfor (float i = 0.0; i < 3.0; i++) {\nfor (float j = 0.0; j < 3.0; j++) {\nsample = texture2D( u_colorTexture, v_uv + texel * vec2(i-1.0,j-1.0) ).rgb;\nI[int(i)][int(j)] = length(sample);\n}\n}\nfor (int i = 0; i < 2; i++) {\nfloat dp3 = dot(G[i][0], I[0]) + dot(G[i][1], I[1]) + dot(G[i][2], I[2]);\ncnv[i] = dp3 * dp3;\n}\nvec4 color = texture2D(u_colorTexture, v_uv);\ngl_FragColor = vec4(0.5 * sqrt(cnv[0] * cnv[0] + cnv[1] * cnv[1]) * color);\n}"},filterEffect:{"filterEffect.frag":"precision mediump float;\nuniform sampler2D u_colorTexture;\nuniform mat4 u_coefficients;\nvarying vec2 v_uv;\nvoid main() {\nvec4 color = texture2D(u_colorTexture, v_uv);\nvec4 rgbw = u_coefficients * vec4(color.a > 0.0 ? color.rgb / color.a : vec3(0.0), 1.0);\nfloat a = color.a;\ngl_FragColor = vec4(a * rgbw.rgb, a);\n}"},pp:{"pp.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying vec2 v_uv;\nvoid main() {\ngl_Position = vec4(a_position, 0.0, 1.0);\nv_uv = (a_position + 1.0) / 2.0;\n}"}},raster:{common:{"common.glsl":"uniform sampler2D u_image;\nuniform int u_bandCount;\nuniform bool u_flipY;\nuniform float u_opacity;\nuniform int u_resampling;\nuniform vec2 u_srcImageSize;\n#ifdef APPLY_PROJECTION\n#include <raster/common/projection.glsl>\n#endif\n#ifdef BICUBIC\n#include <filtering/bicubic.glsl>\n#endif\n#ifdef BILINEAR\n#include <filtering/bilinear.glsl>\n#endif\nvec2 getPixelLocation(vec2 coords) {\nvec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;\n#ifdef APPLY_PROJECTION\ntargetLocation = projectPixelLocation(targetLocation);\n#endif\nreturn targetLocation;\n}\nbool isOutside(vec2 coords){\nif (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {\nreturn true;\n} else {\nreturn false;\n}\n}\nvec4 getPixel(vec2 pixelLocation) {\n#ifdef BICUBIC\nvec4 color = sampleBicubicBSpline(u_image, pixelLocation, u_srcImageSize);\n#elif defined(BILINEAR)\nvec4 color = sampleBilinear(u_image, pixelLocation, u_srcImageSize);\n#else\nvec4 color = texture2D(u_image, pixelLocation);\n#endif\nreturn color;\n}","projection.glsl":"uniform sampler2D u_transformGrid;\nuniform vec2 u_transformSpacing;\nuniform vec2 u_transformGridSize;\nuniform vec2 u_targetImageSize;\nvec2 projectPixelLocation(vec2 coords) {\n#ifdef LOOKUP_PROJECTION\nvec4 pv = texture2D(u_transformGrid, coords);\nreturn vec2(pv.r, pv.g);\n#endif\nvec2 index_image = floor(coords * u_targetImageSize);\nvec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);\nvec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;\nvec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);\nvec2 srcLocation;\nvec2 transform_location = index_transform + oneTransformPixel * 0.5;\nif (pos.s <= pos.t) {\nvec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));\nvec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));\n} else {\nvec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));\nvec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));\nsrcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));\nsrcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));\n}\nreturn srcLocation;\n}"},flow:{"getFadeOpacity.glsl":"uniform float u_decayRate;\nuniform float u_fadeToZero;\nfloat getFadeOpacity(float x) {\nfloat cutOff = mix(0.0, exp(-u_decayRate), u_fadeToZero);\nreturn (exp(-u_decayRate * x) - cutOff) / (1.0 - cutOff);\n}","getFragmentColor.glsl":"vec4 getFragmentColor(vec4 color, float dist, float size, float featheringSize) {\nfloat featheringStart = clamp(0.5 - featheringSize / size, 0.0, 0.5);\nif (dist > featheringStart) {\ncolor *= 1.0 - (dist - featheringStart) / (0.5 - featheringStart);\n}\nreturn color;\n}",imagery:{"imagery.frag":"precision highp float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nuniform float u_Min;\nuniform float u_Max;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nfloat getIntensity(float v) {\nreturn u_Min + v * (u_Max - u_Min);\n}\nvoid main(void) {\nvec4 sampled = texture2D(u_texture, v_texcoord);\nfloat intensity = getIntensity(sampled.r);\ngl_FragColor = getColor(intensity);\ngl_FragColor.a *= getOpacity(sampled.r);\ngl_FragColor.a *= sampled.a;\ngl_FragColor.rgb *= gl_FragColor.a;\n}","imagery.vert":"attribute vec2 a_position;\nattribute vec2 a_texcoord;\nuniform mat3 u_dvsMat3;\nvarying vec2 v_texcoord;\nvoid main(void) {\nvec2 xy = (u_dvsMat3 * vec3(a_position, 1.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_texcoord = a_texcoord;\n}"},particles:{"particles.frag":"precision highp float;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/getFragmentColor.glsl>\nvoid main(void) {\ngl_FragColor = getFragmentColor(v_color, length(v_texcoord - 0.5), v_size, u_featheringSize);\n}","particles.vert":"attribute vec4 a_xyts0;\nattribute vec4 a_xyts1;\nattribute vec4 a_typeIdDurationSeed;\nattribute vec4 a_extrudeInfo;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nvarying vec4 v_color;\nvarying vec2 v_texcoord;\nvarying float v_size;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/vv.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nvec2 position0 = a_xyts0.xy;\nfloat t0 = a_xyts0.z;\nfloat speed0 = a_xyts0.w;\nvec2 position1 = a_xyts1.xy;\nfloat t1 = a_xyts1.z;\nfloat speed1 = a_xyts1.w;\nfloat type = a_typeIdDurationSeed.x;\nfloat id = a_typeIdDurationSeed.y;\nfloat duration = a_typeIdDurationSeed.z;\nfloat seed = a_typeIdDurationSeed.w;\nvec2 e0 = a_extrudeInfo.xy;\nvec2 e1 = a_extrudeInfo.zw;\nfloat animationPeriod = duration + u_trailLength;\nfloat scaledTime = u_time * u_flowSpeed;\nfloat randomizedTime = scaledTime + seed * animationPeriod;\nfloat t = mod(randomizedTime, animationPeriod);\nfloat fUnclamped = (t - t0) / (t1 - t0);\nfloat f = clamp(fUnclamped, 0.0, 1.0);\nfloat clampedTime = mix(t0, t1, f);\nfloat speed = mix(speed0, speed1, f);\nvec2 extrude;\nvec2 position;\nfloat fadeOpacity;\nfloat introOpacity;\nif (type == 2.0) {\nif (fUnclamped < 0.0 || (fUnclamped > 1.0 && t1 != duration)) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nvec2 ortho = mix(e0, e1, f);\nvec2 parallel;\nparallel = normalize(position1 - position0) * 0.5;\nif (id == 1.0) {\nextrude = ortho;\nv_texcoord = vec2(0.5, 0.0);\n} else if (id == 2.0) {\nextrude = -ortho;\nv_texcoord = vec2(0.5, 1.0);\n} else if (id == 3.0) {\nextrude = ortho + parallel;\nv_texcoord = vec2(1.0, 0.0);\n} else if (id == 4.0) {\nextrude = -ortho + parallel;\nv_texcoord = vec2(1.0, 1.0);\n}\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else {\nif (fUnclamped < 0.0) {\ngl_Position = vec4(0.0, 0.0, -2.0, 1.0);\nreturn;\n}\nif (id == 1.0) {\nextrude = e0;\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 2.0) {\nextrude = -e0;\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - t0) / u_trailLength);\nintroOpacity = 1.0 - exp(-t0);\nv_size = getSize(speed0);\nv_color = getColor(speed0);\nv_color.a *= getOpacity(speed0);\nposition = position0;\n} else if (id == 3.0) {\nextrude = mix(e0, e1, f);\nv_texcoord = vec2(0.5, 0.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n} else if (id == 4.0) {\nextrude = -mix(e0, e1, f);\nv_texcoord = vec2(0.5, 1.0);\nfadeOpacity = getFadeOpacity((t - clampedTime) / u_trailLength);\nintroOpacity = 1.0 - exp(-clampedTime);\nv_size = getSize(speed);\nv_color = getColor(speed);\nv_color.a *= getOpacity(speed);\nposition = mix(position0, position1, f);\n}\n}\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(extrude * v_size, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_color.a *= fadeOpacity;\nv_color.a *= mix(1.0, introOpacity, u_introFade);\nv_color.rgb *= v_color.a;\n}"},streamlines:{"streamlines.frag":"precision highp float;\nvarying float v_side;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_size;\nuniform float u_time;\nuniform float u_trailLength;\nuniform float u_flowSpeed;\nuniform float u_featheringSize;\nuniform float u_introFade;\n#include <raster/flow/getFragmentColor.glsl>\n#include <raster/flow/getFadeOpacity.glsl>\nvoid main(void) {\nfloat t = mod(v_timeSeed * (v_totalTime + u_trailLength) + u_time * u_flowSpeed, v_totalTime + u_trailLength) - v_time;\nvec4 color = v_color * step(0.0, t) * getFadeOpacity(t / u_trailLength);\ncolor *= mix(1.0, 1.0 - exp(-v_time), u_introFade);\ngl_FragColor = getFragmentColor(color, length((v_side + 1.0) / 2.0 - 0.5), v_size, u_featheringSize);\n}","streamlines.vert":"attribute vec3 a_positionAndSide;\nattribute vec3 a_timeInfo;\nattribute vec2 a_extrude;\nattribute float a_speed;\nattribute float a_colorTime;\nuniform mat3 u_dvsMat3;\nuniform mat3 u_displayViewMat3;\nvarying float v_time;\nvarying float v_totalTime;\nvarying float v_timeSeed;\nvarying vec4 v_color;\nvarying float v_side;\nvarying float v_size;\nuniform float u_featheringSize;\n#include <raster/flow/vv.glsl>\nvoid main(void) {\nvec4 lineColor = getColor(a_speed, a_colorTime);\nfloat lineOpacity = getOpacity(a_speed);\nfloat lineSize = getSize(a_speed);\nvec2 position = a_positionAndSide.xy;\nv_side = a_positionAndSide.z;\nvec2 xy = (u_dvsMat3 * vec3(position, 1.0) + u_displayViewMat3 * vec3(a_extrude * lineSize, 0.0)).xy;\ngl_Position = vec4(xy, 0.0, 1.0);\nv_time = a_timeInfo.x;\nv_totalTime = a_timeInfo.y;\nv_timeSeed = a_timeInfo.z;\nv_color = lineColor;\nv_color.a *= lineOpacity;\nv_color.rgb *= v_color.a;\nv_size = lineSize;\n}"},"vv.glsl":"#define MAX_STOPS 8\n#ifdef VV_COLOR\nuniform float u_color_stops[MAX_STOPS];\nuniform vec4 u_color_values[MAX_STOPS];\nuniform int u_color_count;\n#else\nuniform vec4 u_color;\n#endif\n#ifdef VV_OPACITY\nuniform float u_opacity_stops[MAX_STOPS];\nuniform float u_opacity_values[MAX_STOPS];\nuniform int u_opacity_count;\n#else\nuniform float u_opacity;\n#endif\n#ifdef VV_SIZE\nuniform float u_size_stops[MAX_STOPS];\nuniform float u_size_values[MAX_STOPS];\nuniform int u_size_count;\n#else\nuniform float u_size;\n#endif\nuniform float u_featheringOffset;\nvec4 getColor(float x, float t) {\n#ifdef VV_COLOR\nvec4 color_values[MAX_STOPS];\nfor (int i = 0; i < MAX_STOPS; i++) {\ncolor_values[i] = u_color_values[i];\ncolor_values[i].rgb = mix(color_values[i].rgb, 1.0 - color_values[i].rgb, a_colorTime);\n}\nvec4 color = color_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_color_count) {\nbreak;\n}\nfloat x1 = u_color_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_color_stops[i];\nvec4 y2 = color_values[i];\nif (x < x2) {\nvec4 y1 = color_values[i - 1];\ncolor = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\ncolor = y2;\n}\n}\n}\n#else\nvec4 color = u_color;\n#endif\nreturn color;\n}\nfloat getOpacity(float x) {\n#ifdef VV_OPACITY\nfloat opacity = u_opacity_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_opacity_count) {\nbreak;\n}\nfloat x1 = u_opacity_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_opacity_stops[i];\nfloat y2 = u_opacity_values[i];\nif (x < x2) {\nfloat y1 = u_opacity_values[i - 1];\nopacity = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nopacity = y2;\n}\n}\n}\n#else\nfloat opacity = u_opacity;\n#endif\nreturn opacity;\n}\nfloat getSize(float x) {\n#ifdef VV_SIZE\nfloat size = u_size_values[0];\n{\nfor (int i = 1; i < MAX_STOPS; i++) {\nif (i >= u_size_count) {\nbreak;\n}\nfloat x1 = u_size_stops[i - 1];\nif (x < x1) {\nbreak;\n}\nfloat x2 = u_size_stops[i];\nfloat y2 = u_size_values[i];\nif (x < x2) {\nfloat y1 = u_size_values[i - 1];\nsize = y1 + (y2 - y1) * (x - x1) / (x2 - x1);\n} else {\nsize = y2;\n}\n}\n}\n#else\nfloat size = u_size;\n#endif\nreturn size + 2.0 * u_featheringSize * u_featheringOffset;\n}"},magdir:{"magdir.frag":"precision mediump float;\nvarying vec4 v_color;\nuniform lowp float u_opacity;\nvoid main() {\ngl_FragColor = v_color * u_opacity;\n}","magdir.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nuniform float u_rotation;\nuniform vec4 u_colors[12];\nvarying vec4 v_color;\nvoid main()\n{\nfloat angle = a_offset.y + u_rotation;\n#ifndef ROTATION_GEOGRAPHIC\nangle = 3.14159265359 * 2.0 - angle - 3.14159265359 / 2.0;\n#endif\nvec2 offset = vec2(cos(angle), sin(angle)) * a_offset.x;\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 pos = a_pos + offset * sizePercentage * u_symbolSize;\nv_color = u_colors[int(a_vv.x)];\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"},reproject:{"reproject.frag":"precision mediump float;\nvarying vec2 v_texcoord;\n#include <raster/common/common.glsl>\nvoid main() {\nvec2 pixelLocation = getPixelLocation(v_texcoord);\nif (isOutside(pixelLocation)) {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\nreturn;\n}\nvec4 currentPixel = getPixel(pixelLocation);\ngl_FragColor = vec4(currentPixel.rgb, 1.0) * currentPixel.a * u_opacity;\n}","reproject.vert":"precision mediump float;\nattribute vec2 a_position;\nvarying highp vec2 v_texcoord;\nvoid main()\n{\nv_texcoord = a_position;\ngl_Position = vec4(2.0 * (a_position - 0.5), 0.0, 1.0);\n}"},scalar:{"scalar.frag":"precision mediump float;\nuniform lowp float u_opacity;\nvarying vec2 v_pos;\nconst vec4 outlineColor = vec4(0.2, 0.2, 0.2, 1.0);\nconst float outlineSize = 0.02;\nconst float innerRadius = 0.25;\nconst float outerRadius = 0.42;\nconst float innerSquareLength = 0.15;\nvoid main() {\nmediump float dist = length(v_pos);\nmediump float fillalpha1 = smoothstep(outerRadius, outerRadius + outlineSize, dist);\nfillalpha1 *= (1.0-smoothstep(outerRadius + outlineSize, outerRadius + 0.1 + outlineSize, dist));\n#ifdef INNER_CIRCLE\nmediump float fillalpha2 = smoothstep(innerRadius, innerRadius + outlineSize, dist);\nfillalpha2 *= (1.0-smoothstep(innerRadius + outlineSize, innerRadius + 0.1 + outlineSize, dist));\n#else\nmediump float fillalpha2 = (abs(v_pos.x) < innerSquareLength ? 1.0 : 0.0) * (abs(v_pos.y) < innerSquareLength ? 1.0 : 0.0);\n#endif\ngl_FragColor = (fillalpha2 + fillalpha1) * outlineColor * u_opacity;\n}","scalar.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_vv;\nuniform highp mat3 u_dvsMat3;\nuniform highp vec2 u_coordScale;\nuniform vec2 u_symbolSize;\nuniform vec2 u_symbolPercentRange;\nuniform vec2 u_dataRange;\nvarying vec2 v_pos;\nvoid main()\n{\n#ifdef DATA_RANGE\nfloat valuePercentage = clamp((a_vv.y - u_dataRange.x) / (u_dataRange.y - u_dataRange.x), 0.0, 1.0);\nfloat sizeRatio = u_symbolPercentRange.x + valuePercentage * (u_symbolPercentRange.y - u_symbolPercentRange.x);\nfloat sizePercentage = clamp(sizeRatio, u_symbolPercentRange.x, u_symbolPercentRange.y);\n#else\nfloat sizePercentage = (u_symbolPercentRange.x + u_symbolPercentRange.y) / 2.0;\n#endif\nvec2 size = u_symbolSize * sizePercentage;\nvec2 pos = a_pos + a_offset * size;\nv_pos = a_offset;\ngl_Position = vec4(u_dvsMat3 * vec3(pos * u_coordScale, 1.0), 1.0);\n}"}},stencil:{"stencil.frag":"void main() {\ngl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n}","stencil.vert":"attribute vec2 a_pos;\nuniform mat3 u_worldExtent;\nvoid main() {\ngl_Position = vec4(u_worldExtent * vec3(a_pos, 1.0), 1.0);\n}"},test:{"TestShader.common.glsl":"#ifndef RETURN_RED\nvarying    vec4      v_color;\n#endif\nvarying    vec2      v_offset;","TestShader.frag":"precision highp float;\n#include <test/TestShader.common.glsl>\nvoid main() {\nif (v_offset.x > -.5 && v_offset.y > -.5 && v_offset.x < .5 && v_offset.y < .5) {\ndiscard;\n}\n#ifdef RETURN_RED\ngl_FragColor = vec4(1., 0., 0., 1.);\n#else\ngl_FragColor = v_color;\n#endif\n}","TestShader.vert":"const float POS_PRECISION_FACTOR = 10.;\nconst float OFFSET_PRECISION_FACTOR = 10.;\nconst float SIZE_PRECISION_FACTOR = 10.;\nattribute  vec2      a_pos_packed;\nattribute  vec2      a_offset_packed;\nattribute  float     a_size_packed;\n#ifdef DATA_DRIVEN_COLOR\nconst float u_dataDrivenColor_validValues[4] = float[4](0., 0., 1., 0.);\nuniform    vec4      u_dataDrivenColor_colorFallback;\nuniform    vec4      u_dataDrivenColor_color;\n#endif\nuniform    float     u_view_zoomLevel;\n#include <test/TestShader.common.glsl>\n#ifdef DATA_DRIVEN_COLOR\nvec4 getColor(float value) {\nint index = -1;\nfor (int i = 0; i < 4; i++) {\nif (u_dataDrivenColor_validValues[i] == value) {\nindex = i;\nbreak;\n}\n}\nif (index == -1) {\nreturn u_dataDrivenColor_colorFallback;\n}\nreturn u_dataDrivenColor_color;\n}\n#endif\nvoid main() {\nvec2  a_pos = a_pos_packed / POS_PRECISION_FACTOR;\nvec2  a_offset = a_offset_packed / OFFSET_PRECISION_FACTOR;\nfloat a_size = a_size_packed / SIZE_PRECISION_FACTOR;\nvec4 color = vec4(1., 0., 0., 1.);\n#ifdef DATA_DRIVEN_COLOR\ncolor = getColor(1.);\n#endif\nvec2 offsetScaled = a_offset * a_size;\nvec4 pos = vec4(a_pos.xy + offsetScaled, 0., 1.);\ngl_Position = pos;\n#ifndef RETURN_RED\nv_color = color;\n#endif\nv_offset = a_offset;\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\nlowp vec4 color = texture2D(u_texture, v_tex);\ncolor.rgb *= color.a;\ngl_FragColor = color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\nmediump vec2 offset = u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\nvec3 v_pos = u_dvsMat3 * vec3(offset, 1.0);\ngl_Position = vec4(v_pos.xy, 0.0, 1.0);\nv_tex = a_pos;\n}"},util:{"atan2.glsl":"float atan2(in float y, in float x) {\nfloat t0, t1, t2, t3, t4;\nt3 = abs(x);\nt1 = abs(y);\nt0 = max(t3, t1);\nt1 = min(t3, t1);\nt3 = 1.0 / t0;\nt3 = t1 * t3;\nt4 = t3 * t3;\nt0 =         - 0.013480470;\nt0 = t0 * t4 + 0.057477314;\nt0 = t0 * t4 - 0.121239071;\nt0 = t0 * t4 + 0.195635925;\nt0 = t0 * t4 - 0.332994597;\nt0 = t0 * t4 + 0.999995630;\nt3 = t0 * t3;\nt3 = (abs(y) > abs(x)) ? 1.570796327 - t3 : t3;\nt3 = x < 0.0 ?  3.141592654 - t3 : t3;\nt3 = y < 0.0 ? -t3 : t3;\nreturn t3;\n}","encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}"}}})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec4f32","./WGLBrush","../shaders/BackgroundPrograms","../../../../webgl/enums","../../../../webgl/ProgramTemplate","../../../../webgl/VertexArrayObject","../../../../webgl/VertexAttributeLayouts","../../../../webgl/VertexBuffer"],function(e,t,i,r,n,s,o,a){"use strict";return class extends t{constructor(){super(...arguments),this._color=e.fromValues(1,0,0,1),this._initialized=!1}dispose(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null),this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)}prepareState({context:e}){e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255)}draw(e,t){const{context:i,requestRender:n,allowDelayedRender:s}=e;this._initialized||this._initialize(i),!s||null==n||this._solidProgram.compiled?(i.setStencilFunctionSeparate(1032,516,t.stencilRef,255),i.bindVAO(this._solidVertexArrayObject),i.useProgram(this._solidProgram),this._solidProgram.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),this._solidProgram.setUniform2fv("u_coord_range",[t.rangeX,t.rangeY]),this._solidProgram.setUniform1f("u_depth",0),this._solidProgram.setUniform4fv("u_color",this._color),i.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4),i.bindVAO(null)):n()}_initialize(e){if(this._initialized)return!0;const t=new Int8Array([0,0,1,0,0,1,1,1]),r=new a.VertexBuffer(e,o.Pos2b,t),l=new s.VertexArrayObject(e,r);return this._solidProgram=n.createProgram(e,i.background,l.locations),this._solidVertexArrayObject=l,this._initialized=!0,!0}}})},"esri/views/webgl/VertexAttributeLayouts":function(){define(["exports","./enums","./VertexAttributeLocations","./VertexElementDescriptor"],function(e,t,i,r){"use strict";const n=[new r.VertexElementDescriptor("position",2,t.DataType.UNSIGNED_SHORT,0,4)],s=[new r.VertexElementDescriptor("a_pos",2,t.DataType.BYTE,0,2)],o=[new r.VertexElementDescriptor("a_pos",2,t.DataType.BYTE,0,4),new r.VertexElementDescriptor("a_tex",2,t.DataType.BYTE,2,4)],a=i.fromLayout(n);e.Pos2b=s,e.Pos2us=n,e.Pos2usLocations=a,e.PosTex2b=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexBuffer":function(){define(["exports","./BufferObject"],function(e,t){"use strict";class i extends t.BufferObject{constructor(e,t,i,r=35044){super(e,34962,r,i),this.layout=t}}e.VertexBuffer=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushTileDebugInfo":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec4f32","../FeatureTile","./WGLBrush","../shaders/BackgroundPrograms","../shaders/TileInfoPrograms","../../../../webgl/enums","../../../../webgl/ProgramTemplate","../../../../webgl/Texture","../../../../webgl/TextureDescriptor","../../../../webgl/VertexArrayObject","../../../../webgl/VertexAttributeLayouts","../../../../webgl/VertexBuffer"],function(e,t,i,r,n,s,o,a,l,c,u,h){"use strict";const d=16;return class extends i{constructor(){super(...arguments),this._color=e.fromValues(1,0,0,1)}dispose(){this._outlineProgram?.dispose(),this._outlineProgram=null,this._tileInfoProgram?.dispose(),this._tileInfoProgram=null,this._outlineVertexArrayObject?.dispose(),this._outlineVertexArrayObject=null,this._tileInfoVertexArrayObject?.dispose(),this._tileInfoVertexArrayObject=null,this._ctx=null}prepareState({context:e}){e.setBlendingEnabled(!0),e.setBlendFunctionSeparate(1,771,1,771),e.setColorMask(!0,!0,!0,!0),e.setStencilWriteMask(0),e.setStencilTestEnabled(!1)}draw(e,i){const{context:r,requestRender:n,allowDelayedRender:o}=e;if(!i.isReady&&i instanceof t.FeatureTile&&i.hasData)return;if(this._loadWGLResources(r),o&&null!=n&&(!this._outlineProgram.compiled||!this._tileInfoProgram.compiled))return void n();r.bindVAO(this._outlineVertexArrayObject),r.useProgram(this._outlineProgram),this._outlineProgram.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),this._outlineProgram.setUniform2f("u_coord_range",i.rangeX,i.rangeY),this._outlineProgram.setUniform1f("u_depth",0),this._outlineProgram.setUniform4fv("u_color",this._color),r.drawArrays(s.PrimitiveType.LINE_STRIP,0,4);const a=this._getTexture(r,i);a?(r.bindVAO(this._tileInfoVertexArrayObject),r.useProgram(this._tileInfoProgram),r.bindTexture(a,0),this._tileInfoProgram.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform2f("u_coord_ratio",i.rangeX/i.width,i.rangeY/i.height),this._tileInfoProgram.setUniform2f("u_delta",0,0),this._tileInfoProgram.setUniform2f("u_dimensions",a.descriptor.width,a.descriptor.height),r.drawArrays(s.PrimitiveType.TRIANGLE_STRIP,0,4),r.bindVAO(null)):r.bindVAO(null)}_loadWGLResources(e){if(this._outlineProgram&&this._tileInfoProgram)return;const t=new Int8Array([0,0,1,0,1,1,0,1]),i=new h.VertexBuffer(e,u.Pos2b,t);this._outlineVertexArrayObject=new c.VertexArrayObject(e,i),this._outlineProgram=o.createProgram(e,r.background,this._outlineVertexArrayObject.locations);const s=new Int8Array([0,0,1,0,0,1,1,1]),a=new h.VertexBuffer(e,u.Pos2b,s);this._tileInfoVertexArrayObject=new c.VertexArrayObject(e,a),this._tileInfoProgram=o.createProgram(e,n.tileInfo,this._tileInfoVertexArrayObject.locations)}_getTexture(e,t){if(!this._ctx){const e=document.createElement("canvas");e.width=512,e.height=512,this._ctx=e.getContext("2d")}if(!t.tileDebugInfoTexture){const i=new l.TextureDescriptor(512,512);i.wrapMode=33071,i.samplingMode=9729,i.isImmutable=!0,t.tileDebugInfoTexture=new a.Texture(e,i)}const i=this._ctx;i.clearRect(0,0,i.canvas.width,i.canvas.height),i.textAlign="left",i.textBaseline="top",i.font="14px sans-serif",i.lineWidth=2,i.fillStyle="white",i.strokeStyle="black";const{debugSlot:r}=t;let n=8+99.2*r;const s=`${r}) ${t.key.id} (${t.constructor.name})`;i.strokeText(s,8,n),i.fillText(s,8,n),n+=d;const{debugInfo:o}=t;if(o){const{length:e,minOrderedLength:t,minUnorderedLength:r,triangleCount:s}=o.display;if(e>0){const t=`Length: ${e}`;i.strokeText(t,8,n),i.fillText(t,8,n),n+=d}if(t){const e=`Min ordered length: ${t}`;i.strokeText(e,8,n),i.fillText(e,8,n),n+=d}if(r){const e=`Min unordered length: ${r}`;i.strokeText(e,8,n),i.fillText(e,8,n),n+=d}if(s>0){s>1e5&&(i.fillStyle="red",i.strokeStyle="white");const e=`Triangle count: ${s}`;i.strokeText(e,8,n),i.fillText(e,8,n),n+=d}const{bytesUsed:a,bytesReserved:l}=o.memory;if(i.fillStyle="white",i.strokeStyle="black",a>0||l>0){const e=`Memory usage: ${a} of ${l} bytes`;i.strokeText(e,8,n),i.fillText(e,8,n),n+=d}}return t.tileDebugInfoTexture.setData(i.canvas),t.tileDebugInfoTexture}}})},"esri/views/2d/engine/webgl/FeatureTile":function(){define(["exports","../../../../core/has","../../../../core/Logger","../../../../core/libs/gl-matrix-2/factories/mat2df32","../../../../core/libs/gl-matrix-2/factories/mat3f32","./AFeatureTile","./definitions","./DisplayEntity","./FeatureDisplayList","./ReshufflePlan","./collisions/LabelMetric","./cpuMapped/MappedMesh","./mesh/meshDebugUtils","./util/Reader","./util/serializationUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p){"use strict";let m=0;class g extends s.AFeatureTile{constructor(e,t,i,s,o,a,l=!1){super(e,t,i,s),this._fader=o,this._labelInstanceId=a,this._meshes=new Map,this._entities=[],this._entityIndex=new Map,this._invalidated=!1,this._nextUploadAllowed=!1,this.tileAge=m++,this._metrics=[],this._metricsVisibility=new Set,this._entityIds=new Set,this._entityIdsFromBuffer=new Set,this._attributeEpoch=0,this._encounteredEnd=!1,this.isCoverage=!1,this.rendering=!1,this._decluttered=!1,this._objectIdMap=null,this.visible=!0,this.transforms.labelMat2d=r.create(),this.transforms.tileUnitsToPixels=n.create(),this.enableDeferredUploads=l}destroy(){super.destroy(),this.clear()}clear(){for(const e of this._meshes.values())e.destroy();this._meshes.clear(),this._entities=[],this._fader?.removeFeatureTileMetrics(this,this._metrics),this._metrics=[],this._displayList=null,this._invalidated=!0,this._entityIds.clear(),this._nextUploadAllowed=!0}beforeRender(e){super.beforeRender(e),this._needsReshuffle&&e.reshuffleManager.schedule(this)}tryReady(e){const i=this._invalidated&&!this._uploadAllowed;return!(this.isReady||i||!this._encounteredEnd||!(e>=this._attributeEpoch)||(t("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.ready [epoch=${e}]`),this.ready(),this.requestRender(),this.decluttered=!1,0))}get symbols(){const e=new Map;for(const t of this._metrics)e.get(t.labelClassId)||e.set(t.labelClassId,[]),e.get(t.labelClassId).push(t);return e}get decluttered(){return this._decluttered}set decluttered(e){this._decluttered=e,this.requestRender()}get id(){return this.key.id}get hasData(){return!!this._meshes.size}get hasAnimations(){return!!this._objectIdMap}get needsUpload(){return this._invalidated}get _uploadAllowed(){return!this.enableDeferredUploads||this._nextUploadAllowed}get _hasMetrics(){return this._metrics.length>0}upload(){this._nextUploadAllowed=!0}getDisplayList(e,t){if(this._uploadAllowed&&this._invalidated){this._entities.sort((e,t)=>{const i=t.sortKey,r=e.sortKey;return r===i?e.id-t.id:r-i}),0===t&&this.reshuffle(!0),this._displayList=l.DisplayList.fromDisplayEntities(this._entities,this,e,t);for(const e of this._meshes.values())e.upload();this.debugInfo.display.length=this._displayList.length,this.debugInfo.display.minOrderedLength=this._displayList.minOrderedLength,this.debugInfo.display.minUnorderedLength=this._displayList.minUnorderedLength,this.requestRender(),this._invalidated=!1,this._nextUploadAllowed=!1}return this._displayList}getMesh(e){if(!this._meshes.has(e))throw new Error(`InternalError: Unable to find VAO for instance: ${e}`);return this._meshes.get(e)}getSortKeys(e){const t=new Map;for(const{id:i,sortKey:r}of this._entities)if(e.has(i)&&t.set(i,r),t.size===e.size)break;return t}onMessage(e){if(e.objectIdMap)for(const t in e.objectIdMap)this._objectIdMap||(this._objectIdMap={}),this._objectIdMap[t]=e.objectIdMap[t];switch(e.type){case"append":this._onAppendMessage(e);break;case"update":this._onUpdateMessage(e)}if(this._aggregateMemoryStats(),this.requestRender(),e.end){if(t("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.end [epoch=${e.attributeEpoch}]`),!e.attributeEpoch)throw new Error("InternalError: Attribute epoch not defined.");this._attributeEpoch=e.attributeEpoch,this._encounteredEnd=!0}this._writeLabelVisibilityToMesh()}_onAppendMessage(e){if(t("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.append`,{append:d.debugMeshDataInfo(e?.append)}),e.clear&&this.clear(),!e.append)return;const i=p.deserializeList(new f(e.append.entities),a);this._insert(i,e.append.data,!1)}_onUpdateMessage(e){t("esri-2d-update-debug")&&console.debug(`Tile[${this.key.id}] FeatureTile.update`,{isPixelBuffer:e.isPixelBuffer,modify:d.debugMeshDataInfo(e.modify),remove:e.remove});const i=p.deserializeList(new f(e.modify.entities),a),r=i.map(e=>e.id),n=e.isPixelBuffer??!1,s=[...e.remove,...r];n?this._removeByIdsFromBuffer(s):this._removeByIds(s),this._insert(i,e.modify.data,n)}reshuffle(e=!1){if(this.destroyed)return;const r=new Map;for(const t of this._entities)for(const i of t.records){const t=this._meshes.get(i.instanceId);let n=r.get(t);n||(n=new c.ReshufflePlan(e),r.set(t,n)),n.copyRecord(i)}for(const[e,t]of r)e.reshuffle(t);this._invalidated=!0,this._aggregateMemoryStats(),t("esri-2d-update-debug")&&i.getLogger("esri.views.2d.engine.webgl.FeatureTile").info(`Tile ${this.key.id} was reshuffled.`)}copyPixelBufferedEntitesFrom(e,t,i,r){const n=i*o.tileSize,s=r*o.tileSize;for(const i of e._entities){let r=null;for(const o of i.records)if(o.overlaps&t){const t=e.getMesh(o.instanceId),l=this._ensureMesh(o.instanceId,t.layout,t.useVisibility).copyRecordFrom(t,o,n,s);r||(r=new a(i.id,i.sortKey),this._entityIdsFromBuffer.add(i.id),this._entityIndex.set(r.id,r),this._entities.push(r)),r.records.push(l)}}this._invalidated=!0}get metricsVisibility(){return this._metricsVisibility}copyMetricsVisibility(e){for(const t of e)this._metricsVisibility.add(t);this._writeLabelVisibilityToMesh()}updateLabelVisibility(){this._metricsVisibility.clear();for(const e of this._metrics)e.uniqueSymbol.show&&e.selectedForRendering&&this._metricsVisibility.add(e.hash);this._writeLabelVisibilityToMesh()}_writeLabelVisibilityToMesh(){const e=this._meshes.get(this._labelInstanceId);if(e&&this._hasMetrics){for(const t of this._metrics){const i=this._entityIndex.get(t.id);if(!i)continue;const r=this._metricsVisibility.has(t.hash);e.setEntityRecordRangeVisibility(i.records,t.recordStart,t.recordCount,r?0:255)}this._invalidated=!0}}_ensureMesh(e,t,i){return this._meshes.has(e)||this._meshes.set(e,new h.MappedMesh(this._stage.bufferPool,t,i)),this._meshes.get(e)}_insert(e,t,i){if(!e.length)return;this._removeDuplicatedBufferedEntites(e);const r=this._insertVertexData(t);for(const t of e){for(const e of t.records)e.updateBaseOffsets(r.get(e.instanceId));i?this._tryInsertBufferedEntity(t):this._insertEntity(t)}this._invalidated=!0}_insertMetrics(e){for(const t of e)t.tile=this;this._metrics.push(...e),this._fader?.insertFeatureTileMetrics(this,e)}_insertVertexData(e){const t=new Map;for(const i of e){const{instanceId:e,layout:r}=i,n=r.attributes.some(e=>"visibility"===e.name),s=this._ensureMesh(e,r,n).append(i);if(i.metrics){const e=p.deserializeList(new f(i.metrics),u.LabelMetric)??[];this._insertMetrics(e)}t.set(e,s)}return t}_insertEntity(e){t("esri-2d-update-debug")&&this._entityIds.has(e.id)&&console.error(`Tile ${this.key.id} insertEntity: Already have entityId ${e.id}`),this._entityIds.add(e.id),this._entityIndex.set(e.id,e),this._entities.push(e)}_tryInsertBufferedEntity(e){this._entityIds.has(e.id)?this._removeRecordsFromMesh(e.records):(this._entityIdsFromBuffer.add(e.id),this._entityIndex.set(e.id,e),this._entities.push(e))}_removeDuplicatedBufferedEntites(e){if(!this._entityIdsFromBuffer.size)return;const t=[];for(const i of e)this._entityIdsFromBuffer.has(i.id)&&t.push(i.id);this._removeByIds(t)}_removeByIdsFromBuffer(e){this._removeByIds(e.filter(e=>this._entityIdsFromBuffer.has(e)))}_removeByIds(e){if(0===e.length)return;const t=new Set(e),i=[];for(const e of this._entities)t.has(e.id)?(this._remove(e),this._entityIndex.delete(e.id)):i.push(e);this._entities=i;const r=this._metrics.filter(e=>t.has(e.displayId));this._metrics=this._metrics.filter(e=>!t.has(e.displayId)),this._fader?.removeFeatureTileMetrics(this,r),this._invalidated=!0}_remove(e){this._removeRecordsFromMesh(e.records),this._entityIds.delete(e.id),this._entityIdsFromBuffer.delete(e.id)}_removeRecordsFromMesh(e){for(const t of e){const{instanceId:e,indexStart:i,indexCount:r,vertexStart:n,vertexCount:s}=t;this._meshes.get(e)?.remove(i,r,n,s)}}_aggregateMemoryStats(){this.debugInfo.memory.bytesUsed=0,this.debugInfo.memory.bytesReserved=0;for(const e of this._meshes.values())this.debugInfo.memory.bytesUsed+=e.memoryStats.bytesUsed,this.debugInfo.memory.bytesReserved+=e.memoryStats.bytesReserved}get _needsReshuffle(){if(this.destroyed)return!1;const{bytesUsed:e,bytesReserved:t}=this.debugInfo.memory,i=e/t,{minOrderedLength:r,length:n}=this.debugInfo.display,s=r/n;return t>o.RESHUFFLING_EXEMPT_MEMORY_BYTES&&i<o.RESHUFFLING_TARGET_MEMORY_EFFICIENCY||n>o.RESHUFFLING_EXEMPT_DRAW_CALLS&&s<o.RESHUFFLING_TARGET_DRAW_EFFICIENCY}get entityIds(){return this._objectIdMap?this._entities.map(({id:e})=>({objectId:this._objectIdMap[e],displayId:e})):[]}}e.FeatureTile=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AFeatureTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat2d","../../../../core/libs/gl-matrix-2/factories/mat2df32","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f32","./definitions","./TiledDisplayObject"],function(e,t,i,r,n,s,o,a,l){"use strict";const c=n.create(),u=o.create();class h extends l.TiledDisplayObject{constructor(e,t,i,r){super(e,t,i,r,a.tileSize,a.tileSize)}destroy(){super.destroy()}setTransform(e){const n=this.resolution/e.resolution,s=this.transforms.tileMat3,[o,a]=e.toScreenNoRotation([0,0],[this.x,this.y]),l=this.width/this.rangeX*n,c=this.height/this.rangeY*n;r.set(s,l,0,0,0,c,0,o,a,1),r.multiply(this.transforms.displayViewScreenMat3,e.displayViewMat3,s);const u=t.set(i.create(),l,0,0,c,o,a);t.multiply(this.transforms.labelMat2d,e.viewMat2d,u);const h=[0,0];e.toScreen(h,[this.x,this.y]);const d=this.transforms.tileUnitsToPixels;r.identity(d),r.translate(d,d,h),r.rotate(d,d,Math.PI*e.rotation/180),r.scale(d,d,[l,c,1])}_createTransforms(){return{labelMat2d:i.create(),tileMat3:n.create(),displayViewScreenMat3:n.create(),tileUnitsToPixels:n.create()}}containsScreenPoint(e,t,i){const n=r.multiply(c,e.viewMat3,this.transforms.tileMat3),o=r.invert(c,n);if(null==o)return!0;s.set(u,...t,1);const a=s.transformMat3(u,u,o),l=i*(this.resolution/e.resolution);return a[0]>=-l&&a[0]<this.width+l&&a[1]>=-l&&a[1]<this.height+l}}e.AFeatureTile=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["exports"],function(e){"use strict";function t(){return new Float32Array(3)}function i(e){const t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function r(e,t,i){const r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=i,r}function n(){return t()}function s(){return r(1,1,1)}function o(){return r(1,0,0)}function a(){return r(0,1,0)}function l(){return r(0,0,1)}const c=n(),u=s(),h=o(),d=a(),f=l(),p=Object.freeze(Object.defineProperty({__proto__:null,ONES:u,UNIT_X:h,UNIT_Y:d,UNIT_Z:f,ZEROS:c,clone:i,create:t,fromValues:r,ones:s,unitX:o,unitY:a,unitZ:l,zeros:n},Symbol.toStringTag,{value:"Module"}));e.ONES=u,e.UNIT_X=h,e.UNIT_Y=d,e.UNIT_Z=f,e.ZEROS=c,e.clone=i,e.create=t,e.fromValues=r,e.ones=s,e.unitX=o,e.unitY=a,e.unitZ=l,e.vec3f32=p,e.zeros=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../core/libs/gl-matrix-2/math/mat3","../DisplayObject","../../tiling/TileKey"],function(e,t,i,r){"use strict";class n extends i.DisplayObject{constructor(e,t,i,n,s,o,a=s,l=o){super(),this.tileDebugInfoTexture=null,this.debugInfo={display:{length:0,minOrderedLength:0,minUnorderedLength:0,triangleCount:0},memory:{bytesUsed:0,bytesReserved:0}},this._destroyed=!1,this.key=new r(e),this.resolution=t,this.x=i,this.y=n,this.width=s,this.height=o,this.rangeX=a,this.rangeY=l}destroy(){super.destroy(),this.tileDebugInfoTexture&&(this.tileDebugInfoTexture.dispose(),this.tileDebugInfoTexture=null),this._destroyed=!0}get debugSlot(){let e=this;for(;e.parent!==this._stage;){if(!e.parent)return 0;e=e.parent}return this._stage.children.indexOf(e)}setTransform(e){const i=this.resolution/(e.resolution*e.pixelRatio),r=this.transforms.tileMat3,[n,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.width/this.rangeX*i,a=this.height/this.rangeY*i;t.set(r,o,0,0,0,a,0,n,s,1),t.multiply(this.transforms.displayViewScreenMat3,e.displayViewMat3,r)}get destroyed(){return this._destroyed}}e.TiledDisplayObject=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayEntity":function(){define(["./DisplayRecord","./util/serializationUtils"],function(e,t){"use strict";class i{static{this.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+e.byteSizeHint}constructor(e,t){this.id=e,this.sortKey=t,this.records=[]}serialize(e){return e.push(this.id),e.writeF32(this.sortKey),t.serializeList(e,this.records),e}static deserialize(r){const n=r.readInt32(),s=r.readF32(),o=new i(n,s);return o.records=t.deserializeList(r,e)??[],o}}return i})},"esri/views/2d/engine/webgl/DisplayRecord":function(){define(function(){"use strict";class e{static{this.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT}constructor(e,t,i,r,n,s,o){this.instanceId=e,this.textureKey=t,this.indexStart=i,this.indexCount=r,this.vertexStart=n,this.vertexCount=s,this.overlaps=o}updateBaseOffsets(e){this.vertexStart+=e.vertexFrom,this.indexStart+=e.indexFrom}clone(){return new e(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(e,t,i,r,n,s,o,a){e.push(t),e.push(i),e.push(r),e.push(n),e.push(s),e.push(o),e.push(a)}serialize(e){return e.push(this.instanceId),e.push(this.textureKey),e.push(this.indexStart),e.push(this.indexCount),e.push(this.vertexStart),e.push(this.vertexCount),e.push(this.overlaps),e}static deserialize(t){const i=t.readInt32(),r=t.readInt32(),n=t.readInt32(),s=t.readInt32(),o=t.readInt32(),a=t.readInt32(),l=t.readInt32();return new e(i,r,n,s,o,a,l)}}return e})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],function(e){"use strict";e.deserializeList=function(e,t,i){const r=e.readInt32(),n=new Array(r);for(let r=0;r<n.length;r++)n[r]=t.deserialize(e,i);return n},e.serializeList=function(e,t){if(null!==t){e.push(t.length);for(const i of t)i.serialize(e);return e}e.push(0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/FeatureDisplayList":function(){define(["exports","../../../../core/has","./cpuMapped/FreeList","./shaderGraph/techniques/featureTechniqueUtils","../../../webgl/enums"],function(e,t,i,r,n){"use strict";function s(e,t){return e<<16|255&t}class o{constructor(e,t,i,r,n){this.instance=e,this.materialKey=t,this.target=i,this.start=r,this.count=n}get textureKey(){return 255&this.materialKey}get indexEnd(){return this.start+this.count}extend(e){this.count+=e}render(e){this.instance.techniqueRef.render(e,this)}get key(){return this.target.key}getStencilReference(){return this.target.stencilRef}getAttributePrecisionPackFactors(){const e=this.instance.instanceId;return this.target.getMesh(e).getAttributePrecisionPackFactors()}draw(e,t){r.isHittest(e)?this.drawCompute(e.context,t):this.drawGeometry(e.context,t)}drawCompute(e,t){const i=this.instance.instanceId,r=this.target.getMesh(i).getComputeVAO(e,t),s=this.start*Uint32Array.BYTES_PER_ELEMENT/3;e.bindVAO(r,t.locations),e.drawElements(n.PrimitiveType.POINTS,this.count/3,n.DataType.UNSIGNED_INT,s),e.bindVAO(null)}drawGeometry(e,t){const i=this.instance.instanceId,r=this.target.getMesh(i).getGeometryVAO(e,t),s=this.start*Uint32Array.BYTES_PER_ELEMENT;e.bindVAO(r,t.locations),e.drawElements(n.PrimitiveType.TRIANGLES,this.count,n.DataType.UNSIGNED_INT,s),e.bindVAO(null)}}class a{constructor(){this._length=0,this._minOrderedLength=0,this._materialKeys=new Set}static fromDisplayEntities(e,t,i,r){const n=new a;for(const o of e.values())for(const e of o.records){const o=i.getInstance(e.instanceId),a=s(o.instanceId,e.textureKey);n.addRecord(o,a,e.indexStart,e.indexCount,e.vertexStart,e.vertexCount,t,r)}return n}get length(){return this._length}get minOrderedLength(){return this._minOrderedLength}get minUnorderedLength(){return this._materialKeys.size}render(e,t){const{drawPhase:i}=e;for(const r of this.infos()){const n=r.instance.techniqueRef;n.drawPhase&i&&(null==t||n.type===t)&&r.render(e)}}addRecord(e,t,r,n,s,a,l,c){let u=r,h=n;if(h||(u=s,h=a),!h)return;if(null==this._head){const r=new o(e,t,l,u,h);return this._head=new i.List(r),this._tail=this._head,this._length++,void this._minOrderedLength++}if(1===c)return this._insert(e,t,l,u,h,this._tail,null);let d=null,f=this._head;const p=e.instanceId,m=e.techniqueRef.symbologyPlane;if(2===c&&(2===m||3===m))return this._insert(e,t,l,u,h,this._tail,null);for(;f;){const i=f.data.instance,r=i.instanceId,n=i.techniqueRef.symbologyPlane,s=d?.data.instance.instanceId;if(m<n||p===s&&p!==r)return this._insert(e,t,l,u,h,d,f);d=f,f=f.next}this._insert(e,t,l,u,h,d,null)}*infos(){if(null!=this._head)for(const e of this._head.values())yield e}_insert(e,t,r,n,s,a,l){if(null==a&&null==l){const a=new o(e,t,r,n,s);return this._head=new i.List(a),this._tail=this._head,this._length++,void this._minOrderedLength++}return t!==this._tail.data.materialKey&&this._minOrderedLength++,this._materialKeys.add(t),null==a&&null!=l?this._insertAtHead(e,t,r,n,s,l):null!=a&&null==l?this._insertAtEnd(e,t,r,n,s,a):null!=a&&null!=l?this._insertAtMiddle(e,t,r,n,s,a,l):void 0}_insertAtHead(e,t,r,n,s,a){const l=n+s;if(t===a.data.materialKey&&r===a.data.target&&l===a.data.start)a.data.start=n,a.data.count+=s;else{const l=new o(e,t,r,n,s);this._head=new i.List(l),this._head.next=a,this._length++}}_insertAtEnd(e,t,r,n,s,a){if(a.data.materialKey===t&&a.data.indexEnd===n)a.data.count+=s;else{const l=new o(e,t,r,n,s);this._tail=new i.List(l),a.next=this._tail,this._length++}}_insertAtMiddle(e,t,r,n,s,a,l){const c=n+s;if(a.data.materialKey===t&&a.data.target===r&&a.data.indexEnd===n)a.data.count+=s,a.data.materialKey===l.data.materialKey&&a.data.target===l.data.target&&a.data.indexEnd===l.data.start&&(a.data.count+=l.data.count,a.next=l.next,this._length--);else if(t===l.data.materialKey&&r===l.data.target&&c===l.data.start)l.data.start=n,l.data.count+=s;else{const c=new o(e,t,r,n,s),u=new i.List(c);a.next=u,u.next=l,this._length++}}}e.DisplayList=a,e.DisplayListInfo=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/FreeList":function(){define(["exports"],function(e){"use strict";class t{constructor(e){if(this.next=null,!Array.isArray(e))return void(this.data=e);this.data=e[0];let i=this;for(let r=1;r<e.length;r++)i.next=new t([e[r]]),i=i.next}*values(){let e=this;for(;e;)yield e.data,e=e.next}forEach(e){let t=this;for(;t;)e(t.data),t=t.next}get last(){return this.next?this.next.last:this}}e.FreeList=class{constructor(e){this._head=null,null!=e&&(this._head=new t(e))}get head(){return this._head}maxAvailableSpace(){if(null==this._head)return 0;let e=0;return this._head.forEach(t=>{const i=t.end-t.start;e=Math.max(e,i)}),e}firstFit(e){if(null==this._head)return null;let t=null,i=this._head;for(;i;){const r=i.data.end-i.data.start;if(r===e)return t?t.next=i.next:this._head=i.next,i.data.start;if(r>e){const t=i.data.start;return i.data.start+=e,t}t=i,i=i.next}return null}free(e,i){const r=e+i;if(null==this._head){const i=new t({start:e,end:r});return void(this._head=i)}if(r<=this._head.data.start){if(r===this._head.data.start)return void(this._head.data.start-=i);const n=new t({start:e,end:r});return n.next=this._head,void(this._head=n)}let n=this._head,s=n.next;for(;s;){if(s.data.start>=r){if(n.data.end===e){if(n.data.end+=i,n.data.end===s.data.start){const e=s.data.end-s.data.start;return n.data.end+=e,void(n.next=s.next)}return}if(s.data.start===r)return void(s.data.start-=i);const o=new t({start:e,end:r});return o.next=n.next,void(n.next=o)}n=s,s=s.next}if(e===n.data.end)return void(n.data.end+=i);const o=new t({start:e,end:r});n.next=o}clear(){this._head=null}},e.List=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/ReshufflePlan":function(){define(["exports"],function(e){"use strict";e.ReshufflePlan=class{constructor(e){this._indexOnly=e,this.vertex={count:0,operations:[]},this.index={count:0,operations:[]}}copyRecord(e){let t=0;this._indexOnly||(t=this.vertex.count-e.vertexStart,this.vertex.operations.push({srcFrom:e.vertexStart,dstFrom:this.vertex.count,count:e.vertexCount,mutate:0}),e.vertexStart=this.vertex.count,this.vertex.count+=e.vertexCount);let i=!1;if(this._indexOnly&&this.index.operations.length>=1){const t=this.index.operations[this.index.operations.length-1];t.srcFrom+t.count===e.indexStart&&(t.count+=e.indexCount,i=!0)}i||this.index.operations.push({srcFrom:e.indexStart,dstFrom:this.index.count,count:e.indexCount,mutate:t}),e.indexStart=this.index.count,this.index.count+=e.indexCount}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/LabelMetric":function(){define(["exports","../definitions","./BoundingBox","../util/serializationUtils"],function(e,t,i,r){"use strict";class n{constructor(e,t,i,r,n,s,o,a,l,c,u,h=[],d=0,f=0){this.displayId=e,this.labelClassId=t,this.labelIdHash=i,this.hash=r,this.anchorX=n,this.anchorY=s,this.directionX=o,this.directionY=a,this.maxScale=l,this.minScale=c,this.referenceBounds=u,this.bounds=h,this.recordStart=d,this.recordCount=f,this.priority=0,this._colliders=null,this.uniqueSymbol=null,this.selectedForRendering=!1}get xTile(){return this.anchorX}get yTile(){return this.anchorY}colliders(e){if(!this._colliders){const i=e.attributeView,r=t.labelPlacementOffsetPadding;let n=this.referenceBounds?.size??0;const s=e.layerView.labelingCollisionInfos[0].vvEvaluators[0];if(null!=s){const e=s(i.getVisualVariableData(this.displayId,0));n=isNaN(e)||null==e||e===1/0?n:e}const o=this.minScale?e.layerView.view.featuresTilingScheme.scaleToZoom(this.minScale):0,a=this.maxScale?e.layerView.view.featuresTilingScheme.scaleToZoom(this.maxScale):25,l=this.directionX*(r+n/2),c=this.directionY*(r+n/2);this._colliders=this.bounds.map(e=>({labelId:this.labelIdHash,xTile:this.anchorX,yTile:this.anchorY,dxPixels:e.x-e.halfWidth+l,dyPixels:e.y-e.halfHeight+c,hard:!0,partIndex:1,width:e.width+2,height:e.height+2,angle:0,xScreen:0,yScreen:0,dxScreen:0,dyScreen:0,enabled:!0,minLod:o,maxLod:a}))}return this._colliders}get id(){return this.displayId}serialize(e){e.push(this.displayId),e.push(this.labelClassId),e.push(this.labelIdHash),e.push(this.hash),e.push(this.recordStart),e.push(this.recordCount),e.writeF32(this.anchorX),e.writeF32(this.anchorY),e.writeF32(this.directionX),e.writeF32(this.directionY),e.writeF32(this.maxScale),e.writeF32(this.minScale),this.referenceBounds?(e.writeF32(this.referenceBounds.size),e.writeF32(this.referenceBounds.offsetX),e.writeF32(this.referenceBounds.offsetY)):(e.writeF32(0),e.writeF32(0),e.writeF32(0)),r.serializeList(e,this.bounds)}static deserialize(e){const t=e.readInt32(),s=e.readInt32(),o=e.readInt32(),a=e.readInt32(),l=e.readInt32(),c=e.readInt32(),u=e.readF32(),h=e.readF32(),d=e.readF32(),f=e.readF32(),p=e.readF32(),m=e.readF32(),g=e.readF32(),_=e.readF32(),y=e.readF32(),x=r.deserializeList(e,i)??[];return new n(t,s,o,a,u,h,d,f,p,m,{size:g,offsetX:_,offsetY:y},x,l,c)}}e.LabelMetric=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/MappedMesh":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/has","../../../../../core/maybe","../number","./Buffer","../shaderGraph/techniques/mesh/dataViewUtils","../shaderGraph/techniques/mesh/utils","../../../../webgl/enums","../../../../webgl/VertexArrayObject"],function(e,t,i,r,n,s,o,a,l,c){"use strict";const u=1e3,h=[{name:"visibility",offset:0,type:l.DataType.FLOAT,count:1}],d={hash:a.vertexLayoutHash(h),attributes:h,stride:4};function f(e,i){return t.unique(e.attributes,(e,t)=>e.name===t.name).filter(e=>i.locations.has(e.name)).map(t=>({name:t.name,type:t.type,count:t.count,divisor:0,normalized:t.normalized??!1,offset:t.offset,stride:e.stride})).sort((e,t)=>i.locations.get(e.name)-i.locations.get(t.name))}function p(e,i){const r=[],n=t.unique(e.attributes,(e,t)=>e.name===t.name).filter(e=>i.locations.has(e.name));for(const t of n){r.push({name:t.name,type:t.type,count:t.count,divisor:0,normalized:t.normalized??!1,offset:t.offset,stride:e.stride});const n=i.computeAttributeMap[t.name];null!=n&&2===n.length&&(r.push({name:n[0],count:t.count,divisor:0,type:t.type,normalized:t.normalized??!1,offset:t.offset+e.stride,stride:e.stride}),r.push({name:n[1],count:t.count,divisor:0,type:t.type,normalized:t.normalized??!1,offset:t.offset+2*e.stride,stride:e.stride}))}return r.sort((e,t)=>i.locations.get(e.name)-i.locations.get(t.name))}e.MappedMesh=class{constructor(e,t,i){if(this._bufferPool=e,this._layout=t,this.useVisibility=i,this._invalidatedGeometry=!1,this._invalidatedCompute=!1,this._position=this._layout.attributes.find(e=>"pos"===e.name||"position"===e.name),!this._position)throw new Error("InternalError: Unable to find position attribute")}destroy(){this._indexBuffer=r.destroyMaybe(this._indexBuffer),this._vertexBuffer=r.destroyMaybe(this._vertexBuffer),this._visibilityBuffer=r.destroyMaybe(this._visibilityBuffer),this._computeVAO?.disposeVAOOnly(),this._geometryVAO?.disposeVAOOnly()}get layout(){return this._layout}getDrawArgs(e,t,i,r){return r?{primitive:l.PrimitiveType.POINTS,count:t/3,offset:i/3}:{primitive:e,count:t,offset:i}}getAttributePrecisionPackFactors(){const e={};for(const t of this.layout.attributes)t.packPrecisionFactor&&(e[t.name]=t.packPrecisionFactor);return e}getDebugVertexInfo(e=!1,t){if(!this._vertexBuffer)return null;const i=this._layout,r=i.stride,n=this._vertexBuffer.getView(0,this._vertexBuffer.byteSize),s=[];if(e)if(null==t)console.log("must provide location info to see compute attributes");else for(const e of i.attributes){const i=t.computeAttributeMap[e.name];null!=i&&2===i.length&&(s.push({...e,name:i[0],offset:e.offset+r}),s.push({...e,name:i[1],offset:e.offset+2*r}))}const a=new DataView(n.slice().buffer);let l=n.byteLength/r;e&&(l=this._indexBuffer.fillPointer/3);const c=this._indexBuffer.getView(0,this._indexBuffer.byteSize);let u=0;const h=[];for(let t=0;t<l;t++){e&&(u=c[3*t]*r);const n={};for(const e of[...i.attributes,...s]){let t=`${e.offset} ${e.name}`,i=o.unpackDataView(a,e,u);if(e.packPrecisionFactor)if(t+=` (precision: ${e.packPrecisionFactor})`,"number"==typeof i)i/=e.packPrecisionFactor;else for(let t=0;t<i.length;t++)i[t]/=e.packPrecisionFactor;n[t]=i}u+=r,h.push(n)}return{vertices:h,layout:i}}_ensure(e,t){if(this._vertexBuffer&&this._indexBuffer)this._indexBuffer.ensure(Math.max(e,u)),this._vertexBuffer.ensure(Math.max(t,u)),this._visibilityBuffer&&this._visibilityBuffer.ensure(Math.max(t,u));else{const i=this._layout.stride/Uint32Array.BYTES_PER_ELEMENT;this._indexBuffer=new s.MappedBuffer("index",Math.max(e,u),1,this._bufferPool),this._vertexBuffer=new s.MappedBuffer("vertex",Math.max(t,u),i,this._bufferPool),this.useVisibility&&(this._visibilityBuffer=new s.MappedBuffer("vertex",Math.max(t,u),4/Uint32Array.BYTES_PER_ELEMENT,this._bufferPool))}}append(e){const t=e.layout.stride,i=e.indices.byteLength/Uint32Array.BYTES_PER_ELEMENT,r=e.vertices.byteLength/t;this._ensure(i,r);const{vertices:n,indices:s}=e,o=this._vertexBuffer.insert(n,0,n.byteLength/t,0),a=new Uint32Array(r);return new Float32Array(a.buffer).fill(255),this._visibilityBuffer&&this._visibilityBuffer.insert(a,0,a.byteLength/4,0),{vertexFrom:o,indexFrom:this._indexBuffer.insert(s,0,s.byteLength/4,o)}}setEntityRecordRangeVisibility(e,t,i,r){if(!(t+i>e.length))for(let n=t;n<t+i;n++){const{vertexStart:t,vertexCount:i}=e[n];this._visibilityBuffer.setF32Range(t,t+i,r)}}getEntityRecordVisibility(e,t){const i=e.records[t];return this._visibilityBuffer.getF32(i.vertexStart)}copyRecordFrom(e,t,i,r){const{indexStart:s,indexCount:o,vertexStart:a,vertexCount:l}=t;this._ensure(o,l);const c=e._position,u=i*(c.packPrecisionFactor??1),h=r*(c.packPrecisionFactor??1),d=c.offset,f=n.i1616to32(u,h),p=this._vertexBuffer.copyFrom(e._vertexBuffer,a,l,f,d);this._visibilityBuffer&&e._visibilityBuffer&&this._visibilityBuffer.copyFrom(e._visibilityBuffer,a,l,0,0);const m=this._indexBuffer.copyFrom(e._indexBuffer,s,o,p-a,0),g=t.clone();return g.vertexStart=p,g.indexStart=m,g.overlaps=0,g}remove(e,t,i,r){this._indexBuffer.free(e,t),this._vertexBuffer.free(i,r),this._visibilityBuffer&&this._visibilityBuffer.free(i,r)}upload(){this._invalidatedGeometry=!0,this._invalidatedCompute=!0}getGeometryVAO(e,t){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedGeometry){if((this._vertexBuffer.invalidated||this._indexBuffer.invalidated||this._visibilityBuffer?.invalidated)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._visibilityBuffer&&this._visibilityBuffer.invalidate(),this._geometryVAO?.disposeVAOOnly(),this._geometryVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload(),this._visibilityBuffer&&this._visibilityBuffer.upload(),!this._geometryVAO){const i=this._indexBuffer.getIndexBuffer(e,!1),r=new Map([["geometry",this._vertexBuffer.getVertexBuffer(e,f(this.layout,t))]]);this._visibilityBuffer&&r.set("visibility",this._visibilityBuffer.getVertexBuffer(e,f(d,t))),this._geometryVAO=new c.VertexArrayObject(e,r,i)}this._invalidatedGeometry=!1}return this._geometryVAO}getComputeVAO(e,t){if(!this._vertexBuffer||!this._indexBuffer||!this._vertexBuffer.bufferSize)return null;if(this._invalidatedCompute&&((this._vertexBuffer.invalidated||this._indexBuffer.invalidatedComputeBuffer)&&(this._vertexBuffer.invalidate(),this._indexBuffer.invalidate(),this._visibilityBuffer?.invalidate(),this._computeVAO?.disposeVAOOnly(),this._computeVAO=null),this._vertexBuffer.upload(),this._indexBuffer.upload(),this._visibilityBuffer?.upload(),!this._computeVAO)){const i=this._indexBuffer.getIndexBuffer(e,!0),r=new Map([["geometry",this._vertexBuffer.getVertexBuffer(e,p(this.layout,t))]]);this._visibilityBuffer&&r.set("visibility",this._visibilityBuffer.getVertexBuffer(e,f(d,t))),this._computeVAO=new c.VertexArrayObject(e,r,i),this._invalidatedCompute=!1}return this._computeVAO}get memoryStats(){return{bytesUsed:this._vertexBuffer.memoryStats.bytesUsed+this._indexBuffer.memoryStats.bytesUsed,bytesReserved:this._vertexBuffer.memoryStats.bytesReserved+this._indexBuffer.memoryStats.bytesReserved,vertex:this._vertexBuffer.memoryStats,index:this._indexBuffer.memoryStats}}reshuffle(e){this._vertexBuffer&&this._vertexBuffer.reshuffle(e.vertex.count,e.vertex.operations),this._indexBuffer&&this._indexBuffer.reshuffle(e.index.count,e.index.operations),this._visibilityBuffer&&this._visibilityBuffer.reshuffle(e.vertex.count,e.vertex.operations)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(e){"use strict";const t=new Float32Array(1),i=new Uint32Array(t.buffer);function r(e,t,i){return Math.round(Math.max(Math.min(e,i),t))}function n(e){return t[0]=e,i[0]}e.fromUint16=function(e){let t=e>>>15,i=e>>10&31,r=1023&e;return t=t?-1:1,i-=15,r/=1024,i>-15?r+=1:i=-14,t*2**i*r},e.i16=function(e){return r(e,-32768,32767)},e.i1616to32=function(e,t){return 65535&e|t<<16},e.i32=function(e){return r(e,-2147483648,2147483647)},e.i8=function(e){return r(e,-128,127)},e.i8816to32=function(e,t,i){return 255&e|(255&t)<<8|i<<16},e.i8888to32=function(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24},e.numTo32=function(e){return 0|e},e.toFloat32=function(e){return i[0]=e,t[0]},e.toUint16=function(e){const t=n(e),i=t>>>31;let r=t>>>23&255,s=8388607&t;return r-=127,r>15?i<<15|31744:r<-25?0:(r<-14&&(s+=8388608,s/=2**(-14-r),r=-15),r+=15,s/=8192,s=function(e){const t=Math.floor(e),i=e-t;return t<1023&&(i>.5||.5===i&&t%2==1)?t+1:t}(s),i<<15|r<<10|s)},e.toUint32=n,e.u16=function(e){return r(e,0,65535)},e.u32=function(e){return r(e,0,4294967295)},e.u32to4Xu8=function(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]},e.u4u4to8=function(e,t){return 15&e|(15&t)<<4},e.u8=function(e){return r(e,0,255)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/cpuMapped/Buffer":function(){define(["exports","../../../../../core/has","../../../../../core/maybe","../number","../PooledUint32Array","./FreeList","../../../../webgl/BufferObject","../../../../webgl/VertexBuffer"],function(e,t,i,r,n,s,o,a){"use strict";e.MappedBuffer=class{constructor(e,t,i,r){this.bufferType=e,this.size=t,this.strideInt=i,this._pool=r,this._cpu=n.PooledUint32Array.create(t*i*Uint32Array.BYTES_PER_ELEMENT,this._pool),this.dirty={start:1/0,end:0},this.memoryStats={bytesUsed:0,bytesReserved:t*i*Uint32Array.BYTES_PER_ELEMENT},this.clear()}get elementSize(){return this._cpu.length/this.strideInt}get intSize(){return this.fillPointer*this.strideInt}get byteSize(){return this.intSize*Uint32Array.BYTES_PER_ELEMENT}get invalidated(){return this.bufferSize>0&&!this._gpu}get invalidatedComputeBuffer(){return this.bufferSize>0&&!this._gpuComputeTriangles}invalidate(){this._invalidateTriangleBuffer(),this._gpu?.dispose(),this._gpu=null}_invalidateTriangleBuffer(){this._gpuComputeTriangles?.dispose(),this._gpuComputeTriangles=null}destroy(){this._gpu?.dispose(),this._gpuComputeTriangles?.dispose(),this._cpu?.destroy()}clear(){this.dirty.start=1/0,this.dirty.end=0,this.freeList=new s.FreeList({start:0,end:this._cpu.length/this.strideInt}),this.fillPointer=0}ensure(e){if(!(this.maxAvailableSpace()>=e)&&e*this.strideInt>this._cpu.length-this.fillPointer){this.invalidate();const t=this._cpu.length/this.strideInt,i=Math.round(1.25*(t+e)),r=i*this.strideInt;this._cpu.expand(r*Uint32Array.BYTES_PER_ELEMENT),this.freeList.free(t,i-t),this.memoryStats.bytesReserved+=(i-t)*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}}setU32(e,t){this._cpu.array[e]!==t&&(this._cpu.array[e]=t,this.dirty.start=Math.min(e,this.dirty.start),this.dirty.end=Math.max(e+1,this.dirty.end))}setF32(e,t){this.setU32(e,r.toUint32(t))}setF32Range(e,t,i){const n=r.toUint32(i);this._cpu.array.fill(n,e,t),this.dirty.start=Math.min(e,this.dirty.start),this.dirty.end=Math.max(t,this.dirty.end)}getF32(e){return r.toFloat32(this._cpu.array[e])}getVertexBuffer(e,t){return"vertex"===this.bufferType?this._getGPUBuffer(e,t):null}getIndexBuffer(e,t){return"index"===this.bufferType?this._getGPUBuffer(e,null,t):null}_getGPUBuffer(e,t,i=!1){if(this.bufferSize){if(i){if("index"!==this.bufferType)throw new Error("Tried to get triangle buffer, but target is not an index buffer");return null==this._gpuComputeTriangles&&(this._gpuComputeTriangles=this._createComputeBuffer(e)),this._gpuComputeTriangles}return this._gpu??="index"===this.bufferType?o.BufferObject.createIndex(e,35048,this._cpu.array):t&&new a.VertexBuffer(e,t,this._cpu.array,35048),this._gpu}}getView(e,t){return this._cpu.getUint32View(e,t/Uint32Array.BYTES_PER_ELEMENT)}get bufferSize(){return this._cpu.length/this.strideInt}maxAvailableSpace(){return this.freeList.maxAvailableSpace()}insert(e,t,r,n){const s=r*this.strideInt;if(!s)return 0;const o=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,a=new Uint32Array(e,o,s),l=this.freeList.firstFit(r);i.assertIsSome(l,"First fit region must be defined");const c=l*this.strideInt,u=s;if(this._cpu.array.set(a,c),0!==n)for(let e=0;e<a.length;e++)this._cpu.array[e+c]+=n;return this.dirty.start=Math.min(this.dirty.start,c),this.dirty.end=Math.max(this.dirty.end,c+u),this.fillPointer=Math.max(this.fillPointer,c+u),this.memoryStats.bytesUsed+=r*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,l}copyFrom(e,t,r,n,s){const o=r*this.strideInt;if(!o)return 0;const a=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,l=e._cpu.getUint32View(a,o),c=this.freeList.firstFit(r);i.assertIsSome(c,"First fit region must be defined");const u=c*this.strideInt,h=o;if(this._cpu.array.set(l,u),0!==n)for(let e=0;e<o;e++)this._cpu.array[u+e*this.strideInt+s]+=n;return this.dirty.start=Math.min(this.dirty.start,u),this.dirty.end=Math.max(this.dirty.end,u+h),this.fillPointer=Math.max(this.fillPointer,u+h),this.memoryStats.bytesUsed+=r*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,c}free(e,t,i){const r=e*this.strideInt,n=(e+t)*this.strideInt;if(!0===i)for(let i=e;i!==e+t;i++)this._cpu.array[i*this.strideInt]=2147450879;this.dirty.start=Math.min(this.dirty.start,r),this.dirty.end=Math.max(this.dirty.end,n),this.freeList.free(e,t),this.memoryStats.bytesUsed-=t*this.strideInt*Uint32Array.BYTES_PER_ELEMENT}upload(){if(this.dirty.end){if(this._invalidateTriangleBuffer(),null==this._gpu)return this.dirty.start=1/0,void(this.dirty.end=0);this._gpu.setSubData(this._cpu.array,this.dirty.start,this.dirty.start,this.dirty.end),this.dirty.start=1/0,this.dirty.end=0}}reshuffle(e,t){if(0===t.length)return;const i=this.byteSize,r=e*this.strideInt*Uint32Array.BYTES_PER_ELEMENT,s=i>r,o=this._cpu,a=n.PooledUint32Array.create(r,this._pool);s||a.array.set(this._cpu.getUint32View(0,this.intSize));for(const e of t)if(s||e.srcFrom!==e.dstFrom||0!==e.mutate){this.dirty.start=Math.min(this.dirty.start,e.dstFrom*this.strideInt),this.dirty.end=Math.max(this.dirty.end,(e.dstFrom+e.count)*this.strideInt);for(let t=0;t<e.count;t++){const i=(e.dstFrom+t)*this.strideInt,r=(e.srcFrom+t)*this.strideInt;for(let t=0;t<this.strideInt;t++)a.array[i+t]=o.array[r+t]+e.mutate}}this._cpu.destroy(),this._cpu=a,s&&this.invalidate(),this.freeList.clear(),this.memoryStats.bytesUsed=this.memoryStats.bytesReserved=r}_createComputeBuffer(e){const t=new Uint32Array(this.fillPointer/3);for(let e=0;e<this.fillPointer;e+=3)t[e/3]=this._cpu.array[e];return o.BufferObject.createIndex(e,35048,t)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/PooledUint32Array":function(){define(["exports","../../../../core/has","../../../../core/maybe","./cpuMapped/FreeList"],function(e,t,i,r){"use strict";const n=t("esri-2d-log-allocations");class s{static create(e,t){const i=t.acquireUint32Array(e);return new s(i,t)}constructor(e,t){this._array=e,this._pool=t}get array(){return this._array}get length(){return this._array.length}getUint32View(e,t){return new Uint32Array(this._array.buffer,e+this._array.byteOffset,t)}expand(e){if(e<=this._array.byteLength)return;const t=this._pool.acquireUint32Array(e);t.set(this._array),this._pool.releaseUint32Array(this._array),this._array=t}destroy(){this._pool.releaseUint32Array(this._array)}}class o{constructor(){this._data=new ArrayBuffer(o.BYTE_LENGTH),this._freeList=new r.FreeList({start:0,end:this._data.byteLength})}static get BYTE_LENGTH(){return 16e6}get buffer(){return this._data}acquireUint32Array(e){const t=this._freeList.firstFit(e);return null==t?null:new Uint32Array(this._data,t,e/Uint32Array.BYTES_PER_ELEMENT)}releaseUint32Array(e){this._freeList.free(e.byteOffset,e.byteLength)}}e.ArrayBufferPool=class{constructor(){this._pages=[],this._pagesByBuffer=new Map,this._bytesAllocated=0}destroy(){this._pages=[],this._pagesByBuffer=null}get _bytesTotal(){return this._pages.length*o.BYTE_LENGTH}acquireUint32Array(e){if(this._bytesAllocated+=e,n&&console.log(`Allocating ${e}, (${this._bytesAllocated} / ${this._bytesTotal})`),e>=o.BYTE_LENGTH)return new Uint32Array(e/Uint32Array.BYTES_PER_ELEMENT);for(const t of this._pages){const i=t.acquireUint32Array(e);if(null!=i)return i}const t=this._addPage().acquireUint32Array(e);return i.assertIsSome(t,"Expected to allocate page"),t}releaseUint32Array(e){this._bytesAllocated-=e.byteLength,n&&console.log(`Freeing ${e.byteLength}, (${this._bytesAllocated} / ${this._bytesTotal})`);const t=this._pagesByBuffer.get(e.buffer);t&&t.releaseUint32Array(e)}_addPage(){const e=new o;return this._pages.push(e),this._pagesByBuffer.set(e.buffer,e),e}},e.PooledUint32Array=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/dataViewUtils":function(){define(["exports","../../../number","../../../../../../webgl/enums"],function(e,t,i){"use strict";e.packDataView=function(e,r,n,s){const o=n.packPrecisionFactor??1;switch(n.type){case i.DataType.BYTE:if(1===n.count)e.setInt8(s+n.offset,r*o);else for(let t=0;t<n.count;t++){const i=t*Int8Array.BYTES_PER_ELEMENT;e.setInt8(s+n.offset+i,r[t]*o)}break;case i.DataType.UNSIGNED_BYTE:if(1===n.count)e.setUint8(s+n.offset,r*o);else for(let t=0;t<n.count;t++){const i=t*Uint8Array.BYTES_PER_ELEMENT;e.setUint8(s+n.offset+i,r[t]*o)}break;case i.DataType.SHORT:if(1===n.count)e.setInt16(s+n.offset,r*o,!0);else for(let t=0;t<n.count;t++){const i=t*Int16Array.BYTES_PER_ELEMENT;e.setInt16(s+n.offset+i,r[t]*o,!0)}break;case i.DataType.UNSIGNED_SHORT:if(1===n.count)e.setUint16(s+n.offset,r*o,!0);else for(let t=0;t<n.count;t++){const i=t*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(s+n.offset+i,r[t]*o,!0)}break;case i.DataType.INT:if(1===n.count)e.setInt32(s+n.offset,r*o,!0);else for(let t=0;t<n.count;t++){const i=t*Int32Array.BYTES_PER_ELEMENT;e.setInt32(s+n.offset+i,r[t]*o,!0)}break;case i.DataType.UNSIGNED_INT:if(1===n.count)e.setUint32(s+n.offset,r*o,!0);else for(let t=0;t<n.count;t++){const i=t*Uint32Array.BYTES_PER_ELEMENT;e.setUint32(s+n.offset+i,r[t]*o,!0)}break;case i.DataType.FLOAT:if(1===n.count)e.setFloat32(s+n.offset,r*o,!0);else for(let t=0;t<n.count;t++){const i=t*Float32Array.BYTES_PER_ELEMENT;e.setFloat32(s+n.offset+i,r[t]*o,!0)}break;case i.DataType.HALF_FLOAT:if(1===n.count)e.setUint16(s+n.offset,t.toUint16(r*o),!0);else for(let i=0;i<n.count;i++){const a=i*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(s+n.offset+a,t.toUint16(r[i]*o),!0)}}},e.unpackDataView=function(e,r,n){switch(r.type){case i.DataType.BYTE:{if(1===r.count)return e.getInt8(n+r.offset);const t=[];for(let i=0;i<r.count;i++){const s=i*Int8Array.BYTES_PER_ELEMENT;t.push(e.getInt8(n+r.offset+s))}return t}case i.DataType.UNSIGNED_BYTE:{if(1===r.count)return e.getUint8(n+r.offset);const t=[];for(let i=0;i<r.count;i++){const s=i*Uint8Array.BYTES_PER_ELEMENT;t.push(e.getUint8(n+r.offset+s))}return t}case i.DataType.SHORT:{if(1===r.count)return e.getInt16(n+r.offset,!0);const t=[];for(let i=0;i<r.count;i++){const s=i*Int16Array.BYTES_PER_ELEMENT;t.push(e.getInt16(n+r.offset+s,!0))}return t}case i.DataType.UNSIGNED_SHORT:{if(1===r.count)return e.getUint16(n+r.offset,!0);const t=[];for(let i=0;i<r.count;i++){const s=i*Uint16Array.BYTES_PER_ELEMENT;t.push(e.getUint16(n+r.offset+s,!0))}return t}case i.DataType.INT:{if(1===r.count)return e.getInt32(n+r.offset,!0);const t=[];for(let i=0;i<r.count;i++){const s=i*Int32Array.BYTES_PER_ELEMENT;t.push(e.getInt32(n+r.offset+s,!0))}return t}case i.DataType.UNSIGNED_INT:{if(1===r.count)return e.getUint32(n+r.offset,!0);const t=[];for(let i=0;i<r.count;i++){const s=i*Uint32Array.BYTES_PER_ELEMENT;t.push(e.getUint32(n+r.offset+s,!0))}return t}case i.DataType.FLOAT:{if(1===r.count)return e.getFloat32(n+r.offset,!0);const t=[];for(let i=0;i<r.count;i++){const s=i*Float32Array.BYTES_PER_ELEMENT;t.push(e.getFloat32(n+r.offset+s,!0))}return t}case i.DataType.HALF_FLOAT:{if(1===r.count)return t.fromUint16(e.getUint16(n+r.offset,!0));const i=[];for(let s=0;s<r.count;s++){const o=s*Uint16Array.BYTES_PER_ELEMENT;i.push(t.fromUint16(e.getUint16(n+r.offset+o,!0)))}return i}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/utils":function(){define(["exports","../../../../../../../core/string"],function(e,t){"use strict";e.applyComputedValue=function e(t,i,r,n,s,o,a){if(t.primitiveName===i){let e=n?.readWithDefault(s,o,t[r]&&a);return"text"===t.type&&(e=e.toString()),void(t[r]=e)}if("type"in t&&null!=t.type){if(t.effects)for(const l of t.effects)e(l,i,r,n,s,o,a);switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.symbolLayers)for(const l of t.symbolLayers)e(l,i,r,n,s,o,a);break;case"CIMTextSymbol":t.symbol&&e(t.symbol,i,r,n,s,o,a);break;case"CIMHatchFill":t.lineSymbol&&e(t.lineSymbol,i,r,n,s,o,a);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(t.markerPlacement&&e(t.markerPlacement,i,r,n,s,o,a),"CIMVectorMarker"===t.type&&t.markerGraphics)for(const l of t.markerGraphics)e(l,i,r,n,s,o,a),e(l.symbol,i,r,n,s,o,a)}}},e.getLineClippingMargin=function(e){const t=Math.max(1.25*e.width,20);return null!=e.effects&&e.effects.length>0?400:t},e.vertexLayoutHash=function(e){const i=e.map(({name:e,count:t,type:i})=>`${e}.${t}.${i}`).join(",");return t.numericHash(i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/meshDebugUtils":function(){define(["exports","../DisplayEntity","../collisions/LabelMetric","../shaderGraph/techniques/mesh/dataViewUtils","../util/Reader","../util/serializationUtils"],function(e,t,i,r,n,s){"use strict";function o(e){const t=e.layout.stride,o=new DataView(e.vertices),a=[],l=e.vertices.byteLength/t;let c=0;for(let i=0;i<l;i++){const i={};for(const t of e.layout.attributes){let e=`${t.offset} ${t.name}`,n=r.unpackDataView(o,t,c);if(t.packPrecisionFactor)if(e+=` (precision: ${t.packPrecisionFactor})`,"number"==typeof n)n/=t.packPrecisionFactor;else for(let e=0;e<n.length;e++)n[e]/=t.packPrecisionFactor;i[e]=n}c+=t,a.push(i)}const u=e.metrics?s.deserializeList(new n(e.metrics),i.LabelMetric)??[]:[];return{vertices:a,layout:e.layout,metrics:u}}e.debugMeshDataInfo=function(e){return e?{entities:s.deserializeList(new n(e.entities),t),vertexData:e.data.map(o)}:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Reader":function(){define(function(){"use strict";return class{constructor(e){this._pos=0,this._buffer=e,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}}})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["exports","./sources/resolver"],function(e,t){"use strict";const i={vertexShader:t.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:t.resolveIncludes("tileInfo/tileInfo.frag")};e.tileInfo=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLBackground":function(){define(["exports","../../../../../core/mathUtils","../../../../../core/maybe","../../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../../core/libs/gl-matrix-2/factories/vec4f32","../definitions","./WGLBrush","../../../../webgl/enums","../../../../webgl/VertexArrayObject","../../../../webgl/VertexBuffer"],function(e,t,i,r,n,s,o,a,l,c){"use strict";e.WGLBrushVTLBackground=class extends o{constructor(){super(...arguments),this._color=n.fromValues(1,0,0,1),this._patternMatrix=r.create(),this._programOptions={id:!1,pattern:!1}}dispose(){this._vao=i.disposeMaybe(this._vao)}drawMany(e,i){const{context:r,painter:n,requestRender:o,allowDelayedRender:l}=e;this._loadWGLResources(e);const c=e.displayLevel,u=e.styleLayer,h=u.backgroundMaterial,d=n.vectorTilesMaterialManager,f=u.getPaintValue("background-color",c),p=u.getPaintValue("background-opacity",c),m=u.getPaintValue("background-pattern",c),g=void 0!==m,_=1|window.devicePixelRatio,y=e.spriteMosaic;let x,b;const v=_>s.vtlHighResCutoff?2:1,S=this._programOptions;S.pattern=g;const w=d.getMaterialProgram(r,h,S);if(!l||null==o||w.compiled){if(r.bindVAO(this._vao),r.useProgram(w),g){const e=y.getMosaicItemPosition(m,!0);if(null!=e){const{tl:t,br:i,page:n}=e;x=i[0]-t[0],b=i[1]-t[1];const o=y.getPageSize(n);null!=o&&(y.bind(r,9729,n,s.vtlTextureBindingUnitSprites),w.setUniform4f("u_tlbr",t[0],t[1],i[0],i[1]),w.setUniform2fv("u_mosaicSize",o),w.setUniform1i("u_texture",s.vtlTextureBindingUnitSprites))}w.setUniform1f("u_opacity",p)}else{const e=f[3]*p;this._color[0]=e*f[0],this._color[1]=e*f[1],this._color[2]=e*f[2],this._color[3]=e,w.setUniform4fv("u_color",this._color)}w.setUniform1f("u_depth",u.z||0);for(const e of i){if(w.setUniform1f("u_coord_range",e.rangeX),w.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),g){const i=Math.max(2**(Math.round(c)-e.key.level),1),r=v*e.width*i,n=r/t.nextPowerOfTwo(x),s=r/t.nextPowerOfTwo(b);this._patternMatrix[0]=n,this._patternMatrix[4]=s,w.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix)}r.setStencilFunction(514,0,255),r.drawArrays(a.PrimitiveType.TRIANGLE_STRIP,0,4)}}else o()}_loadWGLResources(e){if(this._vao)return;const{context:t,styleLayer:i}=e,r=i.backgroundMaterial,n=new Int8Array([0,0,1,0,0,1,1,1]),s=new c.VertexBuffer(t,r.geometryLayout,n);this._vao=new l.VertexArrayObject(t,s)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLCircle":function(){define(["exports","./WGLBrush","../../../../webgl/enums"],function(e,t,i){"use strict";e.WGLBrushVTLCircle=class extends t{constructor(){super(...arguments),this._programOptions={id:!1}}dispose(){}drawMany(e,t){const{context:r,displayLevel:n,requiredLevel:s,state:o,painter:a,spriteMosaic:l,styleLayerUID:c,requestRender:u,allowDelayedRender:h}=e;if(!t.some(e=>e.layerData.get(c)?.circleIndexCount??!1))return;const d=e.styleLayer,f=d.circleMaterial,p=a.vectorTilesMaterialManager,m=d.getPaintValue("circle-translate",n),g=d.getPaintValue("circle-translate-anchor",n),_=this._programOptions,y=p.getMaterialProgram(r,f,_);if(h&&null!=u&&!y.compiled)return void u();r.useProgram(y),y.setUniformMatrix3fv("u_displayMat3",1===g?o.displayMat3:o.displayViewMat3),y.setUniform2fv("u_circleTranslation",m),y.setUniform1f("u_depth",d.z),y.setUniform1f("u_antialiasingWidth",1.2);let x=-1;for(const e of t){if(!e.layerData.has(c))continue;e.key.level!==x&&(x=e.key.level,f.setDataUniforms(y,n,d,x,l));const t=e.layerData.get(c);if(!t.circleIndexCount)continue;t.prepareForRendering(r);const o=t.vao;null!=o&&(r.bindVAO(o),y.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),s!==e.key.level?r.setStencilFunction(514,e.stencilRef,255):r.setStencilFunction(516,255,255),r.drawElements(i.PrimitiveType.TRIANGLES,t.circleIndexCount,i.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t.circleIndexStart),e.triangleCount+=t.circleIndexCount/3)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLFill":function(){define(["exports","../definitions","./WGLBrush","../../../../webgl/enums"],function(e,t,i,r){"use strict";const n=1/65536;e.WGLBrushVTLFill=class extends i{constructor(){super(...arguments),this._fillProgramOptions={id:!1,pattern:!1},this._outlineProgramOptions={id:!1}}dispose(){}drawMany(e,t){const{displayLevel:i,renderPass:r,spriteMosaic:n,styleLayerUID:s}=e;let o=!1;for(const e of t)if(e.layerData.has(s)){const t=e.layerData.get(s);if(t.fillIndexCount>0||t.outlineIndexCount>0){o=!0;break}}if(!o)return;const a=e.styleLayer,l=a.getPaintProperty("fill-pattern"),c=void 0!==l,u=c&&l.isDataDriven;let h;if(c&&!u){const e=l.getValue(i);h=n.getMosaicItemPosition(e,!0)}const d=!c&&a.getPaintValue("fill-antialias",i);let f=!0,p=1;if(!c){const e=a.getPaintProperty("fill-color"),t=a.getPaintProperty("fill-opacity");if(!e?.isDataDriven&&!t?.isDataDriven){const e=a.getPaintValue("fill-color",i);p=a.getPaintValue("fill-opacity",i)*e[3],p>=1&&(f=!1)}}if(f&&"opaque"===r)return;const m=a.getPaintValue("fill-translate",i),g=a.getPaintValue("fill-translate-anchor",i);(f||"translucent"!==r)&&this._drawFill(e,s,a,t,m,g,c,h,u);const _=!a.hasDataDrivenOutlineColor&&a.outlineUsesFillColor&&p<1;d&&"opaque"!==r&&!_&&this._drawOutline(e,s,a,t,m,g)}_drawFill(e,i,s,o,a,l,c,u,h){if(c&&!h&&null==u)return;const{context:d,displayLevel:f,state:p,painter:m,pixelRatio:g,spriteMosaic:_,requestRender:y,allowDelayedRender:x}=e,b=s.fillMaterial,v=m.vectorTilesMaterialManager,S=g>t.vtlHighResCutoff?2:1,w=this._fillProgramOptions;w.pattern=c;const T=v.getMaterialProgram(d,b,w);if(x&&null!=y&&!T.compiled)return void y();if(d.useProgram(T),null!=u){const{page:e}=u,i=_.getPageSize(e);null!=i&&(_.bind(d,9729,e,t.vtlTextureBindingUnitSprites),T.setUniform2fv("u_mosaicSize",i),T.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites))}T.setUniformMatrix3fv("u_displayMat3",1===l?p.displayMat3:p.displayViewMat3),T.setUniform2fv("u_fillTranslation",a),T.setUniform1f("u_depth",s.z+n);let M=-1;for(const e of o){if(!e.layerData.has(i))continue;e.key.level!==M&&(M=e.key.level,b.setDataUniforms(T,f,s,M,_));const n=e.layerData.get(i);if(!n.fillIndexCount)continue;n.prepareForRendering(d);const o=n.fillVAO;if(null!=o){if(d.bindVAO(o),T.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),d.setStencilFunction(514,e.stencilRef,255),c){const t=Math.max(2**(Math.round(f)-e.key.level),1),i=e.rangeX/(S*e.width*t);T.setUniform1f("u_patternFactor",i)}if(h){const e=n.patternMap;if(!e)continue;for(const[i,n]of e){const e=_.getPageSize(i);null!=e&&(_.bind(d,9729,i,t.vtlTextureBindingUnitSprites),T.setUniform2fv("u_mosaicSize",e),T.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites),d.drawElements(r.PrimitiveType.TRIANGLES,n[1],r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n[0]))}}else d.drawElements(r.PrimitiveType.TRIANGLES,n.fillIndexCount,r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.fillIndexStart);e.triangleCount+=n.fillIndexCount/3}}}_drawOutline(e,t,i,s,o,a){const{context:l,displayLevel:c,state:u,painter:h,pixelRatio:d,spriteMosaic:f,requestRender:p,allowDelayedRender:m}=e,g=i.outlineMaterial,_=h.vectorTilesMaterialManager,y=.75/d,x=this._outlineProgramOptions,b=_.getMaterialProgram(l,g,x);if(m&&null!=p&&!b.compiled)return void p();l.useProgram(b),b.setUniformMatrix3fv("u_displayMat3",1===a?u.displayMat3:u.displayViewMat3),b.setUniform2fv("u_fillTranslation",o),b.setUniform1f("u_depth",i.z+n),b.setUniform1f("u_outline_width",y);let v=-1;for(const e of s){if(!e.layerData.has(t))continue;e.key.level!==v&&(v=e.key.level,g.setDataUniforms(b,c,i,v,f));const n=e.layerData.get(t);if(n.prepareForRendering(l),!n.outlineIndexCount)continue;const s=n.outlineVAO;null!=s&&(l.bindVAO(s),b.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),l.setStencilFunction(514,e.stencilRef,255),l.drawElements(r.PrimitiveType.TRIANGLES,n.outlineIndexCount,r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*n.outlineIndexStart),e.triangleCount+=n.outlineIndexCount/3)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLLine":function(){define(["exports","../definitions","./WGLBrush","../../../../webgl/enums"],function(e,t,i,r){"use strict";e.WGLBrushVTLLine=class extends i{constructor(){super(...arguments),this._programOptions={id:!1,pattern:!1,sdf:!1}}dispose(){}drawMany(e,i){const{context:n,displayLevel:s,state:o,painter:a,pixelRatio:l,spriteMosaic:c,styleLayerUID:u,requestRender:h,allowDelayedRender:d}=e;if(!i.some(e=>e.layerData.get(u)?.lineIndexCount??!1))return;const f=e.styleLayer,p=f.lineMaterial,m=a.vectorTilesMaterialManager,g=f.getPaintValue("line-translate",s),_=f.getPaintValue("line-translate-anchor",s),y=f.getPaintProperty("line-pattern"),x=void 0!==y,b=x&&y.isDataDriven;let v,S;if(x&&!b){const e=y.getValue(s);v=c.getMosaicItemPosition(e)}let w=!1;if(!x){const e=f.getPaintProperty("line-dasharray");if(S=void 0!==e,w=S&&e.isDataDriven,S&&!w){const t=e.getValue(s),i=f.getDashKey(t,f.getLayoutValue("line-cap",s));v=c.getMosaicItemPosition(i)}}const T=1/l,M=this._programOptions;M.pattern=x,M.sdf=S;const P=m.getMaterialProgram(n,p,M);if(d&&null!=h&&!P.compiled)return void h();if(n.useProgram(P),P.setUniformMatrix3fv("u_displayViewMat3",o.displayViewMat3),P.setUniformMatrix3fv("u_displayMat3",1===_?o.displayMat3:o.displayViewMat3),P.setUniform2fv("u_lineTranslation",g),P.setUniform1f("u_depth",f.z),P.setUniform1f("u_antialiasing",T),v&&null!=v){const{page:e}=v,i=c.getPageSize(e);null!=i&&(c.bind(n,9729,e,t.vtlTextureBindingUnitSprites),P.setUniform2fv("u_mosaicSize",i),P.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites))}let I=-1;for(const e of i){if(!e.layerData.has(u))continue;e.key.level!==I&&(I=e.key.level,p.setDataUniforms(P,s,f,I,c));const i=2**(s-I)/l;P.setUniform1f("u_zoomFactor",i);const o=e.layerData.get(u);if(!o.lineIndexCount)continue;o.prepareForRendering(n);const a=o.vao;if(null!=a){if(n.bindVAO(a),P.setUniformMatrix3fv("u_dvsMat3",e.transforms.displayViewScreenMat3),n.setStencilFunction(514,e.stencilRef,255),b||w){const e=o.patternMap;if(!e)continue;for(const[i,s]of e){const e=c.getPageSize(i);null!=e&&(c.bind(n,9729,i,t.vtlTextureBindingUnitSprites),P.setUniform2fv("u_mosaicSize",e),P.setUniform1i("u_texture",t.vtlTextureBindingUnitSprites),n.drawElements(r.PrimitiveType.TRIANGLES,s[1],r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*s[0]))}}else n.drawElements(r.PrimitiveType.TRIANGLES,o.lineIndexCount,r.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*o.lineIndexStart);e.triangleCount+=o.lineIndexCount/3}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/brushes/WGLBrushVTLSymbol":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/vec2f32","../../vectorTiles/decluttering/config","../definitions","../GeometryUtils","./WGLBrush","../../../../webgl/enums"],function(e,t,i,r,n,s,o){"use strict";const a=1/65536;e.WGLBrushVTLSymbol=class extends s{constructor(){super(...arguments),this._iconProgramOptions={id:!1,sdf:!1},this._sdfProgramOptions={id:!1},this._spritesTextureSize=t.create()}dispose(){}drawMany(e,t){const i=e.styleLayer;this._drawIcons(e,i,t),this._drawText(e,i,t)}_drawIcons(e,t,s){const{context:o,displayLevel:a,painter:l,spriteMosaic:c,state:u,styleLayerUID:h,requestRender:d,allowDelayedRender:f}=e,p=t.iconMaterial,m=l.vectorTilesMaterialManager;let g,_=!1;for(const e of s)if(e.layerData.has(h)&&(g=e.layerData.get(h),g.iconPerPageElementsMap.size>0)){_=!0;break}if(!_)return;const y=t.getPaintValue("icon-translate",a),x=t.getPaintValue("icon-translate-anchor",a);let b=t.getLayoutValue("icon-rotation-alignment",a);2===b&&(b=0===t.getLayoutValue("symbol-placement",a)?1:0);const v=0===b,S=t.getLayoutValue("icon-keep-upright",a)&&v,w=g.isIconSDF,T=this._iconProgramOptions;T.sdf=w;const M=m.getMaterialProgram(o,p,T);if(f&&null!=d&&!M.compiled)return void d();o.useProgram(M),M.setUniformMatrix3fv("u_displayViewMat3",0===b?u.displayViewMat3:u.displayMat3),M.setUniformMatrix3fv("u_displayMat3",1===x?u.displayMat3:u.displayViewMat3),M.setUniform2fv("u_iconTranslation",y),M.setUniform1f("u_depth",t.z),M.setUniform1f("u_mapRotation",n.degToByte(u.rotation)),M.setUniform1f("u_keepUpright",S?1:0),M.setUniform1f("u_level",10*a),M.setUniform1i("u_texture",r.vtlTextureBindingUnitSprites),M.setUniform1f("u_fadeDuration",i.fadeDuration/1e3);let P=-1;for(const i of s){if(!i.layerData.has(h))continue;if(i.key.level!==P&&(P=i.key.level,p.setDataUniforms(M,a,t,P,c)),g=i.layerData.get(h),0===g.iconPerPageElementsMap.size)continue;g.prepareForRendering(o),g.updateOpacityInfo();const r=g.iconVAO;if(null!=r){o.bindVAO(r),M.setUniformMatrix3fv("u_dvsMat3",i.transforms.displayViewScreenMat3),M.setUniform1f("u_time",(performance.now()-g.lastOpacityUpdate)/1e3);for(const[t,r]of g.iconPerPageElementsMap)this._renderIconRange(e,M,r,t,i)}}}_renderIconRange(e,t,i,n,s){const{context:a,spriteMosaic:l}=e;this._spritesTextureSize[0]=l.getWidth(n)/4,this._spritesTextureSize[1]=l.getHeight(n)/4,t.setUniform2fv("u_mosaicSize",this._spritesTextureSize),l.bind(a,9729,n,r.vtlTextureBindingUnitSprites),this._setStencilState(e,s),a.drawElements(o.PrimitiveType.TRIANGLES,i[1],o.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*i[0]),s.triangleCount+=i[1]/3}_drawText(e,s,o){const{context:l,displayLevel:c,glyphMosaic:u,painter:h,pixelRatio:d,spriteMosaic:f,state:p,styleLayerUID:m,requestRender:g,allowDelayedRender:_}=e,y=s.textMaterial,x=h.vectorTilesMaterialManager;let b,v=!1;for(const e of o)if(e.layerData.has(m)&&(b=e.layerData.get(m),b.glyphPerPageElementsMap.size>0)){v=!0;break}if(!v)return;const S=s.getPaintProperty("text-opacity");if(S&&!S.isDataDriven&&0===S.getValue(c))return;const w=s.getPaintProperty("text-color"),T=!w||w.isDataDriven||w.getValue(c)[3]>0,M=s.getPaintProperty("text-halo-width"),P=s.getPaintProperty("text-halo-color"),I=(!M||M.isDataDriven||M.getValue(c)>0)&&(!P||P.isDataDriven||P.getValue(c)[3]>0);if(!T&&!I)return;let C=s.getLayoutValue("text-rotation-alignment",c);2===C&&(C=0===s.getLayoutValue("symbol-placement",c)?1:0);const F=0===C,O=s.getLayoutValue("text-keep-upright",c)&&F,A=.8*3/d;this._glyphTextureSize||(this._glyphTextureSize=t.fromValues(u.width/4,u.height/4));const E=s.getPaintValue("text-translate",c),z=s.getPaintValue("text-translate-anchor",c),R=this._sdfProgramOptions,V=x.getMaterialProgram(l,y,R);if(_&&null!=g&&!V.compiled)return void g();l.useProgram(V),V.setUniformMatrix3fv("u_displayViewMat3",0===C?p.displayViewMat3:p.displayMat3),V.setUniformMatrix3fv("u_displayMat3",1===z?p.displayMat3:p.displayViewMat3),V.setUniform2fv("u_textTranslation",E),V.setUniform1f("u_depth",s.z+a),V.setUniform2fv("u_mosaicSize",this._glyphTextureSize),V.setUniform1f("u_mapRotation",n.degToByte(p.rotation)),V.setUniform1f("u_keepUpright",O?1:0),V.setUniform1f("u_level",10*c),V.setUniform1i("u_texture",r.vtlTextureBindingUnitGlyphs),V.setUniform1f("u_antialiasingWidth",A),V.setUniform1f("u_fadeDuration",i.fadeDuration/1e3);let D=-1;for(const t of o){if(!t.layerData.has(m))continue;if(t.key.level!==D&&(D=t.key.level,y.setDataUniforms(V,c,s,D,f)),b=t.layerData.get(m),0===b.glyphPerPageElementsMap.size)continue;b.prepareForRendering(l),b.updateOpacityInfo();const i=b.textVAO;if(null==i)continue;l.bindVAO(i),V.setUniformMatrix3fv("u_dvsMat3",t.transforms.displayViewScreenMat3),this._setStencilState(e,t);const r=(performance.now()-b.lastOpacityUpdate)/1e3;V.setUniform1f("u_time",r),b.glyphPerPageElementsMap.forEach((e,i)=>{this._renderGlyphRange(l,e,i,u,V,I,T,t)})}}_renderGlyphRange(e,t,i,n,s,a,l,c){n.bind(e,9729,i,r.vtlTextureBindingUnitGlyphs),a&&(s.setUniform1f("u_halo",1),e.drawElements(o.PrimitiveType.TRIANGLES,t[1],o.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),c.triangleCount+=t[1]/3),l&&(s.setUniform1f("u_halo",0),e.drawElements(o.PrimitiveType.TRIANGLES,t[1],o.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*t[0]),c.triangleCount+=t[1]/3)}_setStencilState(e,t){const{context:i,is3D:r,stencilSymbols:n}=e;if(i.setStencilTestEnabled(!0),n)return i.setStencilWriteMask(255),void i.setStencilFunction(519,t.stencilRef,255);i.setStencilWriteMask(0),r?i.setStencilFunction(514,t.stencilRef,255):i.setStencilFunction(516,255,255)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(e){"use strict";e.collisionGridCellSize=32,e.declutterBudget=1.5,e.declutterTiles=!0,e.fadeDuration=200,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["exports"],function(e){"use strict";const t=128/Math.PI,i=256/360,r=1/Math.LN2;function n(e,t){return(e%=t)>=0?e:e+t}e.between=function(e,t,i){return e>=t&&e<=i||e>=i&&e<=t},e.degToByte=function(e){return n(e*i,256)},e.interpolate=function(e,t,i){return e*(1-i)+t*i},e.log2=function(e){return Math.log(e)*r},e.positiveMod=n,e.radToByte=function(e){return n(e*t,256)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterialManager":function(){define(["./Programs"],function(e){"use strict";return class{constructor(){this._programByKey=new Map}dispose(){this._programByKey.forEach(e=>e.dispose()),this._programByKey.clear()}getMaterialProgram(e,t,i){const r=t.key<<3|this._getMaterialOptionsValue(t.type,i);if(this._programByKey.has(r))return this._programByKey.get(r);const n=this._getProgramTemplate(t.type),{shaders:s}=n,{vertexShader:o,fragmentShader:a}=s(i),l=t.getShaderHeader(),c=t.getShaderMain(),u=o.replace("#pragma header",l).replace("#pragma main",c),h=e.programCache.acquire(u,a,t.getAttributeLocations());return this._programByKey.set(r,h),h}_getMaterialOptionsValue(e,t){switch(e){case 0:case 1:return(t.pattern?1:0)<<1;case 2:case 5:case 6:default:return 0;case 3:{const e=t;return(e.sdf?1:0)<<2|(e.pattern?1:0)<<1}case 4:return(t.sdf?1:0)<<1}}_getProgramTemplate(t){switch(t){case 0:return e.background;case 5:return e.circle;case 1:return e.fill;case 4:return e.icon;case 3:return e.line;case 2:return e.outline;case 6:return e.text;default:return null}}}})},"esri/views/2d/engine/vectorTiles/shaders/Programs":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(e,t,i){"use strict";const r=e=>i.glslifyDefineMap({PATTERN:e.pattern}),n={shaders:e=>({vertexShader:r(e)+t.resolveIncludes("background/background.vert"),fragmentShader:r(e)+t.resolveIncludes("background/background.frag")})},s={shaders:e=>({vertexShader:t.resolveIncludes("circle/circle.vert"),fragmentShader:t.resolveIncludes("circle/circle.frag")})},o=e=>i.glslifyDefineMap({PATTERN:e.pattern}),a={shaders:e=>({vertexShader:o(e)+t.resolveIncludes("fill/fill.vert"),fragmentShader:o(e)+t.resolveIncludes("fill/fill.frag")})},l={shaders:e=>({vertexShader:t.resolveIncludes("outline/outline.vert"),fragmentShader:t.resolveIncludes("outline/outline.frag")})},c=e=>i.glslifyDefineMap({SDF:e.sdf}),u={shaders:e=>({vertexShader:c(e)+t.resolveIncludes("icon/icon.vert"),fragmentShader:c(e)+t.resolveIncludes("icon/icon.frag")})},h=e=>i.glslifyDefineMap({PATTERN:e.pattern,SDF:e.sdf}),d={shaders:e=>({vertexShader:h(e)+t.resolveIncludes("line/line.vert"),fragmentShader:h(e)+t.resolveIncludes("line/line.frag")})},f={shaders:e=>({vertexShader:t.resolveIncludes("text/text.vert"),fragmentShader:t.resolveIncludes("text/text.frag")})};e.background=n,e.circle=s,e.fill=a,e.icon=u,e.line=d,e.outline=l,e.text=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/resolver":function(){define(["exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(e,t,i){"use strict";const r=new i.ShaderCompiler(function(e){let i=t;return e.split("/").forEach(e=>{i&&(i=i[e])}),i});e.resolveIncludes=function(e){return r.resolveIncludes(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/sources/shaderRepository":function(){define(function(){"use strict";return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform lowp sampler2D u_texture;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\nvoid main() {\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = u_opacity * color;\n#else\ngl_FragColor = u_color;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat3 u_dvsMat3;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\nuniform mediump vec4 u_tlbr;\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\n#endif\nvoid main() {\ngl_Position = vec4((u_dvsMat3 * vec3(u_coord_range * a_pos, 1.0)).xy, u_depth, 1.0);\n#ifdef PATTERN\nv_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\nv_tlbr             = u_tlbr / u_mosaicSize.xyxy;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nvoid main()\n{\nmediump float dist = length(v_offset);\nmediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\nlowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\ngl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_circleTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_stroke_color = stroke_color * stroke_opacity;\nv_stroke_width = stroke_width;\nv_radius = radius;\nv_blur = max(blur, u_antialiasingWidth / (radius + stroke_width));\nmediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\nv_offset = offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos * 0.5, 1.0) + u_displayMat3 * vec3((v_radius + v_stroke_width) * offset + u_circleTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\nmediump vec2 normalizedTextureCoord = fract(v_tileTextureCoord);\nmediump vec2 samplePos = mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\nlowp vec4 color = texture2D(u_texture, samplePos);\ngl_FragColor = v_color[3] * color;\n#else\ngl_FragColor = v_color;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump float u_depth;\nuniform mediump vec2 u_fillTranslation;\n#ifdef PATTERN\n#include <util/util.glsl>\nuniform mediump vec2 u_mosaicSize;\nuniform mediump float u_patternFactor;\nvarying mediump vec2 v_tileTextureCoord;\nvarying mediump vec4 v_tlbr;\n#endif\nvarying lowp vec4 v_color;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\n#ifdef PATTERN\nfloat patternWidth = nextPOT(tlbr.z - tlbr.x);\nfloat patternHeight = nextPOT(tlbr.w - tlbr.y);\nfloat scaleX = 1.0 / (patternWidth * u_patternFactor);\nfloat scaleY = 1.0 / (patternHeight * u_patternFactor);\nmat3 patterMat = mat3(scaleX, 0.0,    0.0,\n0.0,    -scaleY, 0.0,\n0.0,    0.0,    1.0);\nv_tileTextureCoord = (patterMat * vec3(a_pos, 1.0)).xy;\nv_tlbr             = tlbr / u_mosaicSize.xyxy;\n#endif\nvec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump flaot v_halo_width;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\nfloat compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\nvec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\nreturn vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\nlowp vec4 fillPixelColor = v_color;\nfloat d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\nconst float softEdgeRatio = 0.248062016;\nfloat size = max(v_size.x, v_size.y);\nfloat dist = d * softEdgeRatio * size;\nfillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\nif (v_halo_width > 0.25) {\nlowp vec4 outlinePixelColor = u_outlineColor;\nconst float outlineLimitRatio = (16.0 / 86.0);\nfloat clampedOutlineSize = softEdgeRatio * min(v_halo_width, outlineLimitRatio * max(v_size.x, v_size.y));\noutlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\ngl_FragColor = v_opacity * mixColors(fillPixelColor, outlinePixelColor);\n}\nelse {\ngl_FragColor = v_opacity * fillPixelColor;\n}\n#else\nlowp vec4 texColor = texture2D(u_texture, v_tex);\ngl_FragColor = v_opacity * texColor;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\n#ifdef SDF\nvarying mediump float v_halo_width;\n#endif\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_iconTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying mediump vec2 v_tex;\nvarying lowp float v_opacity;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nv_color = color;\nv_opacity = opacity;\n#ifdef SDF\nv_halo_width = halo_width;\n#endif\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_opacity *= interpolatedOpacity;\nmediump float a_angle         = a_levelInfo[1];\nmediump float a_minLevel      = a_levelInfo[2];\nmediump float a_maxLevel      = a_levelInfo[3];\nmediump vec2 a_tex            = a_texAngleRange.xy;\nmediump float delta_z = 0.0;\nmediump float rotated = mod(a_angle + u_mapRotation, 256.0);\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_opacity, 0.0);\nvec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\nv_size = abs(offset);\n#ifdef SDF\noffset = (120.0 / 86.0) * offset;\n#endif\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayViewMat3 * vec3(size * offset, 0.0) + u_displayMat3 * vec3(u_iconTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\nv_tex = a_tex.xy / u_mosaicSize;\n}"},line:{"line.frag":"precision lowp float;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#if defined (PATTERN) || defined(SDF)\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\nuniform sampler2D u_texture;\nuniform mediump float u_antialiasing;\n#endif\n#ifdef SDF\n#include <util/encoding.glsl>\n#endif\nvoid main()\n{\nmediump float fragDist = length(v_normal) * v_lineHalfWidth;\nlowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\nmediump float relativeTexX = fract(v_accumulatedDistance / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY = 0.5 + v_normal.y * v_lineHalfWidth / (v_patternSize.y * v_widthRatio);\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nlowp vec4 color = texture2D(u_texture, texCoord);\ngl_FragColor = alpha * v_color[3] * color;\n#elif defined(SDF)\nmediump float relativeTexX = fract((v_accumulatedDistance * 0.5) / (v_patternSize.x * v_widthRatio));\nmediump float relativeTexY =  0.5 + 0.25 * v_normal.y;\nmediump vec2 texCoord = mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\nmediump float d = rgba2float(texture2D(u_texture, texCoord)) - 0.5;\nfloat dist = d * (v_lineHalfWidth + u_antialiasing / 2.0);\ngl_FragColor = alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\n#else\ngl_FragColor = alpha * v_color;\n#endif\n}","line.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_extrude_offset;\nattribute vec4 a_dir_normal;\nattribute vec2 a_accumulatedDistance;\n#pragma header\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump float u_zoomFactor;\nuniform mediump vec2 u_lineTranslation;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\nconst mediump float tileCoordRatio = 8.0;\n#if defined (SDF)\nconst mediump float sdfPatternHalfWidth = 15.5;\n#endif\n#if defined (PATTERN) || defined(SDF)\nuniform mediump vec2 u_mosaicSize;\nvarying mediump vec4 v_tlbr;\nvarying mediump vec2 v_patternSize;\nvarying mediump float v_widthRatio;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_blur = blur + u_antialiasing;\nv_normal = a_dir_normal.zw * scale;\n#if defined (PATTERN) || defined(SDF)\nv_tlbr          = tlbr / u_mosaicSize.xyxy;\nv_patternSize   = vec2(tlbr.z - tlbr.x, tlbr.y - tlbr.w);\n#if defined (PATTERN)\nv_widthRatio = width / v_patternSize.y;\n#else\nv_widthRatio = width / sdfPatternHalfWidth / 2.0;\n#endif\n#endif\nv_lineHalfWidth = (width + u_antialiasing) * 0.5;\nmediump vec2 dir = a_dir_normal.xy * scale;\nmediump vec2 offset_ = a_extrude_offset.zw * scale * offset;\nmediump vec2 dist = v_lineHalfWidth * scale * a_extrude_offset.xy;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos + offset_ * tileCoordRatio / u_zoomFactor, 1.0) + u_displayViewMat3 * vec3(dist, 0.0) + u_displayMat3 * vec3(u_lineTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n#if defined (PATTERN) || defined(SDF)\nv_accumulatedDistance = a_accumulatedDistance.x * u_zoomFactor / tileCoordRatio + dot(dir, dist + offset_);\n#endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\nvoid main()\n{\nlowp float dist = abs(v_normal.y);\nlowp float alpha = smoothstep(1.0, 0.0, dist);\ngl_FragColor = alpha * v_color;\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform mediump vec2 u_fillTranslation;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#pragma main\nv_color = color * opacity;\nv_normal = a_xnormal;\nmediump vec2 dist = u_outline_width * scale * a_offset;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + u_displayMat3 * vec3(dist + u_fillTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth, 1.0);\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nvarying lowp vec2 v_tex;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\nvoid main()\n{\nlowp float dist = texture2D(u_texture, v_tex).a;\nmediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist);\ngl_FragColor = alpha * v_color;\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_texAngleRange;\nattribute vec4 a_levelInfo;\nattribute float a_opacityInfo;\n#pragma header\nvarying lowp vec4 v_color;\nuniform highp mat3 u_dvsMat3;\nuniform highp mat3 u_displayMat3;\nuniform highp mat3 u_displayViewMat3;\nuniform mediump vec2 u_textTranslation;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeDuration;\nvarying lowp vec2 v_tex;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nconst float sdfFontScale = 1.0 / 24.0;\nconst float sdfPixel = 3.0;\nuniform highp float u_time;\nvoid main()\n{\n#pragma main\nif (u_halo > 0.5)\n{\nv_color = halo_color * opacity;\nhalo_width *= sdfPixel;\nhalo_blur *= sdfPixel;\n}\nelse\n{\nv_color = color * opacity;\nhalo_width = 0.0;\nhalo_blur = 0.0;\n}\nfloat modded = mod(a_opacityInfo, 128.0);\nfloat targetOpacity = (a_opacityInfo - modded) / 128.0;\nfloat startOpacity = modded / 127.0;\nfloat interpolatedOpacity = clamp(startOpacity + 2.0 * (targetOpacity - 0.5) * u_time / u_fadeDuration, 0.0, 1.0);\nv_color *= interpolatedOpacity;\nmediump float a_angle       = a_levelInfo[1];\nmediump float a_minLevel    = a_levelInfo[2];\nmediump float a_maxLevel    = a_levelInfo[3];\nmediump vec2 a_tex          = a_texAngleRange.xy;\nmediump float a_visMinAngle    = a_texAngleRange.z;\nmediump float a_visMaxAngle    = a_texAngleRange.w;\nmediump float delta_z = 0.0;\nmediump float angle = mod(a_angle + u_mapRotation, 256.0);\nif (a_visMinAngle < a_visMaxAngle)\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) + (1.0 - step(a_visMinAngle, angle)));\n}\nelse\n{\ndelta_z += (1.0 - step(u_keepUpright, 0.0)) * (step(a_visMaxAngle, angle) * (1.0 - step(a_visMinAngle, angle)));\n}\ndelta_z += 1.0 - step(a_minLevel, u_level);\ndelta_z += step(a_maxLevel, u_level);\ndelta_z += step(v_color[3], 0.0);\nv_tex = a_tex.xy / u_mosaicSize;\nv_edgeDistance = edgePos - halo_width / size;\nv_edgeWidth = (u_antialiasingWidth + halo_blur) / size;\nmediump vec3 pos = u_dvsMat3 * vec3(a_pos, 1.0) + sdfFontScale * u_displayViewMat3 * vec3(offsetPrecision * size * a_vertexOffset, 0.0) + u_displayMat3 * vec3(u_textTranslation, 0.0);\ngl_Position = vec4(pos.xy, u_depth + delta_z, 1.0);\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n255.0 / (256.0),\n255.0 / (256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0),\n255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n);\nfloat rgba2float(vec4 rgba) {\nreturn dot(rgba, rgba2float_factors);\n}","util.glsl":"float nextPOT(in float x) {\nreturn pow(2.0, ceil(log2(abs(x))));\n}"}}})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define(["exports","../../../../core/maybe","./shaders/BitBlitPrograms","../../../webgl/enums","../../../webgl/ProgramTemplate","../../../webgl/VertexArrayObject","../../../webgl/VertexAttributeLayouts","../../../webgl/VertexBuffer"],function(e,t,i,r,n,s,o,a){"use strict";e.BitBlitRenderer=class{constructor(){this._initialized=!1}dispose(){this._program=t.disposeMaybe(this._program),this._vertexArrayObject=t.disposeMaybe(this._vertexArrayObject)}render(e,t,i,n){e&&(this._initialized||this._initialize(e),e.setBlendFunctionSeparate(1,771,1,771),e.bindVAO(this._vertexArrayObject),e.useProgram(this._program),t.setSamplingMode(i),e.bindTexture(t,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",n),e.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4),e.bindTexture(null,0),e.bindVAO(null))}_initialize(e){if(this._initialized)return!0;const t=new Int8Array(16);t[0]=-1,t[1]=-1,t[2]=0,t[3]=0,t[4]=1,t[5]=-1,t[6]=1,t[7]=0,t[8]=-1,t[9]=1,t[10]=0,t[11]=1,t[12]=1,t[13]=1,t[14]=1,t[15]=1;const r=new s.VertexArrayObject(e,new a.VertexBuffer(e,o.PosTex2b,t));return this._program=n.createProgram(e,i.bitBlit,r.locations),this._vertexArrayObject=r,this._initialized=!0,!0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["exports","./sources/resolver"],function(e,t){"use strict";const i={vertexShader:t.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:t.resolveIncludes("bitBlit/bitBlit.frag")};e.bitBlit=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/MaterialManager":function(){define(["./shaders/MaterialPrograms"],function(e){"use strict";return class{constructor(e){this._rctx=e,this._programByKey=new Map}dispose(){this._programByKey.forEach(e=>e.dispose()),this._programByKey.clear()}getProgram(t,i=[]){const r=t.vsPath+"."+t.fsPath+JSON.stringify(i);if(this._programByKey.has(r))return this._programByKey.get(r);const n={...i.map(e=>"string"==typeof e?{name:e,value:!0}:e).reduce((e,t)=>({...e,[t.name]:t.value}),{})},{vsPath:s,fsPath:o,locations:a}=t,l=e.createProgramTemplate(s,o,n),c=this._rctx.programCache.acquire(l.vertexShader,l.fragmentShader,a);if(!c)throw new Error("Unable to get program for key: ${key}");return this._programByKey.set(r,c),c}}})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["exports","./sources/resolver","../../../../webgl/programUtils"],function(e,t,i){"use strict";const r=e=>{let t="";t+=e[0].toUpperCase();for(let i=1;i<e.length;i++){const r=e[i];r===r.toUpperCase()?(t+="_",t+=r):t+=r.toUpperCase()}return t};e.createProgramTemplate=function(e,n,s){const o=e+e.slice(Math.max(0,e.lastIndexOf("/"))),a=n+n.slice(Math.max(0,n.lastIndexOf("/"))),l=(e=>{const t={};for(const i in e)t[r(i)]=e[i];return i.glslifyDefineMap(t)})(s);return{vertexShader:l+t.resolveIncludes(`${o}.vert`),fragmentShader:l+t.resolveIncludes(`${a}.frag`)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureManager":function(){define(["../../../../config","../../../../request","../../../../core/BidiText","../../../../core/Error","../../../../core/fontUtils","../../../../core/has","../../../../core/Logger","../../../../core/promiseUtils","../../../../core/QueueProcessor","../../../../core/screenUtils","../../../../core/string","../../../../symbols/cim/CIMResourceManager","../../../../symbols/cim/CIMSymbolHelper","../../../../symbols/cim/Rasterizer","../../../../symbols/cim/utils","./definitions","./GlyphMosaic","./GlyphSource","./Rect","./SDFConverter","./SpriteMosaic","./urlUtils","./Utils","./animatedFormats/AnimatableTextureResource","./animations/store/AnimationStore"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_,y,x,b,v,S,w,T){"use strict";const M="arial-unicode-ms-regular",P=()=>o.getLogger("esri.views.MapView"),I=(e,t,i)=>P().error(new r(e,t,i));class C{static fromMosaic(e,t){return new C(e,t.page,t.sdf,t.samplingMode)}constructor(e,t,i,r){this.mosaicType=e,this.page=t,this.sdf=i,this.samplingMode=r}}function F(e){switch(e.type){case"CIMVectorMarker":case"CIMPictureMarker":return O(e);default:return!0}}const O=e=>e&&"markerPlacement"in e&&e.markerPlacement&&"CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type;return class{constructor(i){this._requestRender=i,this._resourceManager=new h,this._invalidFonts=new Set,this._sdfConverter=new x(m.svgSdfTextureInnerSize),this._bindingInfos=new Array,this._hashToBindingIndex=new Map,this._ongoingRasterizations=new Map,this._imageRequestQueue=new l.QueueProcessor({concurrency:10,process:async(e,i)=>{a.throwIfAborted(i);try{return await t(e,{responseType:"image",signal:i})}catch(t){if(!a.isAbortError(t))throw new r("mapview-invalid-resource",`Could not fetch requested resource at ${e}`,t);throw t}}}),this.animationStore=new T.AnimationStore,this._spriteMosaic=new b(2048,2048,500),this._glyphSource=new _(`${e.fontsUrl}/{fontstack}/{range}.pbf`),this._glyphMosaic=new g(1024,1024,this._glyphSource),this._rasterizer=new f(this.resourceManager)}dispose(){this._spriteMosaic.dispose(),this._glyphMosaic.dispose(),this._rasterizer.dispose(),this._sdfConverter.dispose(),this._spriteMosaic=null,this._glyphMosaic=null,this._sdfConverter=null,this._hashToBindingIndex.clear(),this._hashToBindingIndex=null,this._bindingInfos=null,this._ongoingRasterizations.clear(),this._ongoingRasterizations=null,this._imageRequestQueue.clear(),this._imageRequestQueue=null,this._resourceManager.destroy(),this.animationStore.destroy()}get sprites(){return this._spriteMosaic}get glyphs(){return this._glyphMosaic}get resourceManager(){return this._resourceManager}async rasterizeItem(e,t){if(null==e)return I("mapview-null-resource","Unable to rasterize null resource"),null;if("animation-info"===e.type){const{resource:t}=e,i=this.animationStore.add(t),{location:r}=i;return{rect:new y(r.column,r.row,t.length,1),page:r.page,type:"sprite",width:t.length,height:1,rasterizationScale:1,sdfPaddingRatio:.5,samplingMode:"Linear",sdfDecodeCoeff:1,simplePattern:!1}}if("cim-rasterization-info"!==e.type)return I("mapview-unexpected-resource","Unable to rasterize resource"),null;const{resource:i}=e;if("text"===i.type){const e=await this._rasterizeText(i,t);for(const t of e.glyphs)this._setTextureBinding(1,t);return e}const r=await this._rasterizeSprite(i,t);return r&&this._setTextureBinding(0,r),r}getMosaicInfo(e,t,i=!1){const r=this._getTextureBindingInfo(e,t,i);return r?{size:r.size,texture:{texture:r.texture,unit:"sprite"===r.type?m.textureBindingSpriteAtlas:m.textureBindingGlyphAtlas}}:(I("mapview-invalid-resource",`Unable to find resource for ${t}`),{size:[0,0],texture:{texture:null,unit:0}})}_getTextureBindingInfo(e,t,i){const r=this._bindingInfos[t-1],n=r.page,s="Nearest"===r.samplingMode?9728:i?9987:9729;switch(r.mosaicType){case 0:{const t=[this.sprites.getWidth(n),this.sprites.getHeight(n)],i=this._spriteMosaic.getTexture(e,n);return i.setSamplingMode(s),{type:"sprite",texture:i,size:t}}case 1:{const t=[this.glyphs.width,this.glyphs.height],i=this._glyphMosaic.getTexture(e,n);return this._glyphMosaic.bind(e,s,n,m.textureBindingGlyphAtlas),i.setSamplingMode(s),{type:"glyph",texture:i,size:t}}default:return I("mapview-texture-manager",`Cannot handle unknown type ${r.mosaicType}`),null}}_hashMosaic(e,t){return 1|e<<1|(t.sdf?1:0)<<2|("Nearest"===t.samplingMode?1:0)<<3|t.page<<4}_setTextureBinding(e,t){const i=this._hashMosaic(e,t);if(!this._hashToBindingIndex.has(i)){const r=C.fromMosaic(e,t),n=this._bindingInfos.length+1;this._hashToBindingIndex.set(i,n),this._bindingInfos.push(r)}t.textureBinding=this._hashToBindingIndex.get(i)}async _rasterizeText(e,t){const{font:r,textString:o}=e,a=n.getFullyQualifiedFontName(r),l=this._invalidFonts.has(a),[c,u]=i.bidiText(o),h=S.charCodes(c);try{const e=l?M:a;return s("esri-2d-stabilize-glyphs")&&await this._glyphMosaic.preloadASCIIGlyphCache(e),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems(e,h,t),isRightToLeft:u}}catch(e){return((e,t="")=>{P().warnOnce(e,t)})(`Font ${a} is not available on the web, using "Arial Unicode MS Regular"`),this._invalidFonts.add(a),{type:"glyphs",glyphs:await this._glyphMosaic.getGlyphItems(M,h,t),isRightToLeft:u}}}_hashSpriteResource(e){switch(e.type){case"path":return`path:${e.path}.${e.asFill?1:0}`;case"CIMPictureMarker":return`${e.type}:${e.url}:${e.size}:${S.getCIMMarkerPlacementHash(e.markerPlacement)}`;case"CIMPictureFill":return`${e.type}:${e.url}:${e.height}`;case"CIMPictureStroke":return`${e.type}:${e.url}:${e.width}`;case"dash":return`dash:${e.capStyle}.${p.normalizeDashTemplate(e.dashTemplate).join("")}`;case"sdf":return`sdf:${JSON.stringify(e.geom)}.${e.asFill?1:0}`;case"fill-style":return`fill_style:${e.style}`;case"animated":return JSON.stringify(v.discardUrlIfHasUrlHash(e));case"CIMGradientFill":case"CIMGradientStroke":return`gradient:${JSON.stringify(e.colorRamp)}.${e.gradientType}.${e.interval}`;case"CIMHatchFill":case"CIMVectorMarker":return JSON.stringify(e)}}async _rasterizeSprite(e,t){if(!e)return null;const i=u.numericHash(this._hashSpriteResource(e));if(this._spriteMosaic.has(i))return this._spriteMosaic.getSpriteItem(i);if("url"in e&&e.url||"CIMPictureFill"===e.type||"CIMPictureStroke"===e.type||"CIMPictureMarker"===e.type||"CIMVectorMarker"===e.type){const t=[];d.CIMSymbolHelper.fetchResources({type:"CIMPointSymbol",symbolLayers:[e]},this._resourceManager,t),t.length>0&&await Promise.all(t)}switch(e.type){case"CIMPictureMarker":return"CIMMarkerPlacementInsidePolygon"===e.markerPlacement?.type?this._rasterizeJSONResource(i,e):this._handleAsyncResource(i,e,t);case"animated":case"CIMPictureFill":case"CIMPictureStroke":case"path":return this._handleAsyncResource(i,e,t);case"CIMGradientFill":case"CIMGradientStroke":case"CIMHatchFill":case"CIMVectorMarker":case"dash":case"fill-style":case"sdf":return this._rasterizeJSONResource(i,e)}}_rasterizeJSONResource(e,t){const i=this._rasterizer.rasterizeJSONResource(t);if(i){const{size:r,image:n,sdf:s,simplePattern:o,rasterizationScale:a,samplingMode:l,sdfPaddingRatio:c,sdfDecodeCoeff:u}=i;return this._addItemToMosaic(e,r,{type:"static",data:n},F(t),s,o,a,l,c,u)}return null}async _handleAsyncResource(e,t,i){if(this._ongoingRasterizations.has(e))return this._ongoingRasterizations.get(e);let r;return r="path"===t.type?this._handleSVG(t,e,i):this._handleImage(t,e,i),this._ongoingRasterizations.set(e,r),r.finally(()=>this._ongoingRasterizations.delete(e)),r}async _handleSVG(e,t,i){const r=[m.svgSdfTextureInnerSize,m.svgSdfTextureInnerSize],{asFill:n}=e,s=await this._sdfConverter.draw(e.path,n,i);return this._addItemToMosaic(t,r,{type:"static",data:new Uint32Array(s.buffer)},!1,!0,!0)}_handleGIFOrPNG(e,t,i){const r=e.url,n=this.resourceManager.getResource(r);if(null==n)return null;const{width:s,height:o}=n;if(n instanceof HTMLImageElement){if("animated"===e.type)return I("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;const i="colorSubstitutions"in e?e.colorSubstitutions:void 0,{size:r,sdf:a,image:l}=this._rasterizer.rasterizeImageResource(s,o,n,i);return this._addItemToMosaic(t,r,{type:"static",data:l},F(e),a,!1)}let a,l,c;"animated"===e.type?(a=!1,l={type:"CIMAnimatedSymbolProperties",playAnimation:e.playAnimation,reverseAnimation:e.reverseAnimation,randomizeStartTime:e.randomizeStartTime,randomizeStartSeed:e.randomizeStartSeed,startTimeOffset:e.startTimeOffset,duration:e.duration,repeatType:e.repeatType,repeatDelay:e.repeatDelay},c=e.startGroup||0):(a=F(e),l={type:"CIMAnimatedSymbolProperties"},c=0);const u=new w.AnimatableTextureResource(n,this._requestRender,l,c);return this._addItemToMosaic(t,[u.width,u.height],{type:"animated",data:u},a,!1,!1)}async _handleImage(e,t,i){const n=e.url;if((e=>{return e&&(e.includes(".gif")||null!=(t=e)&&t.startsWith("data:image/gif"));var t})(n)||(e=>{return e&&(e.includes(".png")||null!=(t=e)&&t.startsWith("data:image/png"));var t})(n))return this._handleGIFOrPNG(e,t,i);if("animated"===e.type)return I("mapview-unexpected-resource","Attempt to configure animations for a non-animated image."),null;try{let r;const s=this.resourceManager.getResource(n);if(null!=s&&s instanceof HTMLImageElement)r=s;else{const{data:e}=await this._imageRequestQueue.push(n,{...i});r=e}if(S.isSVGImage(n))if("width"in e&&"height"in e)r.width=c.pt2px(e.width),r.height=c.pt2px(e.height);else if("cim"in e){const t=e;r.width=c.pt2px(t.width??t.scaleX*t.size),r.height=c.pt2px(t.size)}if(!r.width||!r.height)return null;const o=r.width,a=r.height,l="colorSubstitutions"in e?e.colorSubstitutions:void 0,{size:u,sdf:h,image:d}=this._rasterizer.rasterizeImageResource(o,a,r,l);return this._addItemToMosaic(t,u,{type:"static",data:d},F(e),h,!1)}catch(e){if(!a.isAbortError(e))throw new r("mapview-invalid-resource",`Could not fetch requested resource at ${n}. ${e.message}`);throw e}}_addItemToMosaic(e,t,i,r,n,s,o,a,l,c){return this._spriteMosaic.addSpriteItem(e,t,i,r,n,s,o,a,l,c)}}})},"esri/core/QueueProcessor":function(){define(["exports","./maybe","./promiseUtils","./Queue","./ReactiveMap","./scheduling","./signal"],function(e,t,i,r,n,s,o){"use strict";class a{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}e.QueueProcessor=class{constructor(e){this._schedule=null,this._deferreds=new n,this._controllers=new n,this._processingItems=new n,this._pausedSignal=o.signal(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new r(e.peeker),this.process=e.process}destroy(){this.clear(),this._schedule=t.removeMaybe(this._schedule)}get updating(){return this.running}get length(){return this._processingItems.size+this._queue.length}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(t=>e.push(t)),this._controllers.clear(),e.forEach(e=>e.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((t,i)=>e(i))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const r=this.get(e);if(r)return r;const n=new AbortController;let s=null;t&&(s=i.onAbort(t,()=>n.abort()));const o=()=>{a.remove(),null!=s&&s.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},a=i.onAbortOrThrow(n.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),l.reject(i.createAbortError())}),l=i.createResolver();return this._deferreds.set(e,l),this._controllers.set(e,n),l.promise.then(o,o),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject(i.createAbortError()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._pausedSignal.value||this._schedule||(this._schedule=s.schedule(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const r=new AbortController,n=new a(e,r);this._processingItems.set(e,n);try{t=this.process(e,r.signal)}catch(e){this._processError(n,e)}i.isPromiseLike(t)?(n.promise=t,t.then(e=>this._processResult(n,e),e=>this._processError(n,e))):this._processResult(n,t)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMResourceManager":function(){define(["../../core/fontUtils","../../core/imageUtils"],function(e,t){"use strict";return class{constructor(){this._resourceMap=new Map,this._inFlightResourceMap=new Map}destroy(){this._inFlightResourceMap.clear(),this._resourceMap.clear()}getResource(e){return this._resourceMap.get(e)??null}async fetchResource(e,i){const r=this._resourceMap.get(e);if(r)return{width:r.width,height:r.height};let n=this._inFlightResourceMap.get(e);return n?n.then(e=>({width:e.width,height:e.height})):(n=t.getImageData(e,i),this._inFlightResourceMap.set(e,n),n.then(t=>(this._inFlightResourceMap.delete(e),this._resourceMap.set(e,t),{width:t.width,height:t.height}),()=>({width:0,height:0})))}deleteResource(e){this._inFlightResourceMap.delete(e),this._resourceMap.delete(e)}loadFont(t){return e.loadFont(t)}}})},"esri/symbols/cim/Rasterizer":function(){define(["./CIMSymbolHelper","./rasterizingUtils","./Rect","./SDFHelper","./utils","../../views/2d/engine/webgl/definitions"],function(e,t,i,r,n,s){"use strict";function o(e){if(!e)return null;const{data:t,width:i,height:n,sdfPaddingRatio:s,sdfDecodeCoeff:o}=r.buildSDF(e);return t?{size:[i,n],image:new Uint32Array(t.buffer),sdf:!0,simplePattern:!0,sdfPaddingRatio:s,sdfDecodeCoeff:o,anchorX:0,anchorY:0}:null}return class{constructor(e){this._resourceManager=e,this._cachedRasterizationCanvas=null}dispose(){this._cachedRasterizationCanvas=null}get _canvas(){return this._cachedRasterizationCanvas||(this._cachedRasterizationCanvas=document.createElement("canvas")),this._cachedRasterizationCanvas}rasterizeJSONResource(e){switch(e.type){case"dash":{const i=n.normalizeDashTemplate(e.dashTemplate),[r,s,o]=t.rasterizeDash1D(i);return{size:[s,o],image:new Uint32Array(r.buffer),sdf:!0,simplePattern:!0,anchorX:0,anchorY:0}}case"fill-style":{const[i,r,n,o]=t.rasterizeFillStyle(this._canvas,e,s.patternFillRasterizationScale);return{size:[r,n],image:new Uint32Array(i.buffer),sdf:!1,simplePattern:!0,anchorX:0,anchorY:0,rasterizationScale:o}}case"sdf":return o(e);case"CIMGradientFill":case"CIMGradientStroke":case"CIMHatchFill":case"CIMPictureMarker":case"CIMVectorMarker":return this._rasterizeCIMJSONResource(e)}}_rasterizeCIMJSONResource(i){switch(i.type){case"CIMGradientFill":case"CIMGradientStroke":{const[e,r,n]=t.rasterizeGradient(this._canvas,i);return{size:[r,n],image:new Uint32Array(e.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,samplingMode:"Discrete"===i.gradientType||"CIMFixedColorRamp"===i.colorRamp.type?"Nearest":"Linear"}}case"CIMHatchFill":{const t=e.CIMSymbolHelper.fromCIMHatchFill(i,s.patternFillRasterizationScale);return this._rasterizeCIMVectorMarker(t)}case"CIMPictureMarker":{const t=e.CIMSymbolHelper.fromCIMInsidePolygon(i);return this._rasterizeCIMVectorMarker(t)}case"CIMVectorMarker":{if("CIMMarkerPlacementInsidePolygon"===i.markerPlacement?.type){const t=e.CIMSymbolHelper.fromCIMInsidePolygon(i);return this._rasterizeCIMVectorMarker(t)}const t=r.getSDFInfo(i);return t&&!i.avoidSDFRasterization?o(t):this._rasterizeCIMVectorMarker(i,!1,s.rasterizedVectorMarkerMinSize)}}}_rasterizeCIMVectorMarker(t,r=!0,n){const s=r?i.fromExtent(t.frame):null,[o,a,l,c,u]=e.CIMSymbolHelper.rasterize(this._canvas,t,s,this._resourceManager,!0,n);return o?{size:[a,l],image:new Uint32Array(o.buffer),sdf:!1,simplePattern:!1,anchorX:c,anchorY:u}:null}rasterizeImageResource(e,t,i,r){this._canvas.width=e,this._canvas.height=t;const s=this._canvas.getContext("2d",{willReadFrequently:!0});i instanceof ImageData?s.putImageData(i,0,0):(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`),s.drawImage(i,0,0,e,t));const o=s.getImageData(0,0,e,t),a=new Uint8Array(o.data);if(r)for(const e of r)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[t,i,r,n]=e.oldColor,[s,o,l,c]=e.newColor;if(t===s&&i===o&&r===l&&n===c)continue;for(let e=0;e<a.length;e+=4)t===a[e]&&i===a[e+1]&&r===a[e+2]&&n===a[e+3]&&(a[e]=s,a[e+1]=o,a[e+2]=l,a[e+3]=c)}let l;for(let e=0;e<a.length;e+=4)l=a[e+3]/255,a[e]=a[e]*l,a[e+1]=a[e+1]*l,a[e+2]=a[e+2]*l;let c=a,u=e,h=t;const d=512;if(u>=d||h>=d){const i=u/h;i>1?(u=d,h=Math.round(d/i)):(h=d,u=Math.round(d*i)),c=new Uint8Array(4*u*h);const r=new Uint8ClampedArray(c.buffer);n.resampleHermite(a,e,t,r,u,h,!1)}return{size:[u,h],image:new Uint32Array(c.buffer),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0}}}})},"esri/views/2d/engine/webgl/GlyphMosaic":function(){define(["../../../../core/has","../../../../core/promiseUtils","./Rect","./RectangleBinPack","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s){"use strict";const o=e=>Math.floor(e/256);return class{constructor(e,t,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphCache={},this._textures=[],this._rangePromises=new Map,this._preloadCache={},this.width=e,this.height=t,this._glyphSource=i,this._binPack=new r(e,t),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs()}dispose(){this._binPack=null;for(const e of this._textures)e&&e.dispose();this._textures.length=0,this._glyphData.length=0}_initDecorationGlyphs(){const e=[117,149,181,207,207,181,149,117],t=[],i=[];for(let r=0;r<e.length;r++){const n=e[r];for(let e=0;e<11;e++){const s=r>=3&&r<5&&e>=3&&e<8?255:0;t.push(n),i.push(s)}}const r={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(t)},n={metrics:{width:5,height:2,left:0,top:0,advance:0},bitmap:new Uint8Array(i)};this._recordGlyph(r),this._recordGlyph(n)}getTexture(e,t){if(!this._textures[t]){const i=new s.TextureDescriptor(this.width,this.height);i.pixelFormat=6406,i.wrapMode=33071,this._textures[t]=new n.Texture(e,i,new Uint8Array(this.width*this.height))}return this._dirties[t]&&(this._textures[t].setData(this._glyphData[t]),this._dirties[t]=!1),this._textures[t]}async getGlyphItems(e,t,i){const r=this._getGlyphCache(e);return await this._fetchRanges(e,t,i),t.map(t=>this._getMosaicItem(r,e,t))}bind(e,t,i,r){const n=this.getTexture(e,i);n.setSamplingMode(t),e.bindTexture(n,r)}preloadASCIIGlyphCache(e){const t=this._preloadCache[e];if(null!=t)return t;const i=this._glyphSource.preloadASCIIRange(e).then(()=>{const t=this._getGlyphCache(e);for(let i=0;i<256;i++)this._getMosaicItem(t,e,i)});return this._preloadCache[e]=i,i}_getGlyphCache(e){return this._glyphCache[e]||(this._glyphCache[e]={}),this._glyphCache[e]}_invalidate(){this._dirties[this._currentPage]=!0}async _fetchRanges(e,t,i){const r=function(e){const t=new Set;for(const i of e)t.add(o(i));return t}(t),n=[];r.forEach(t=>{n.push(this._fetchRange(e,t,i))}),await Promise.all(n)}async _fetchRange(e,i,r){if(i>256)return;const n=e+i;return s=this._rangePromises,o=n,a=()=>this._glyphSource.getRange(e,i,r),s.has(o)||s.set(o,a().then(()=>{s.delete(o)}).catch(e=>{s.delete(o),t.throwIfNotAbortError(e)})),s.get(o);var s,o,a}_getMosaicItem(e,t,r){if(!e[r]){const n=this._glyphSource.getGlyph(t,r);if(!n?.metrics)return(e=>({rect:new i(0,0,0,0),page:0,metrics:{left:0,width:0,height:0,advance:0,top:0},code:e,sdf:!0}))(r);const s=this._recordGlyph(n),o=this._currentPage,a=n.metrics;e[r]={rect:s,page:o,metrics:a,code:r,sdf:!0},this._invalidate()}return e[r]}_recordGlyph(t){const n=t.metrics;let s;if(0===n.width)s=new i(0,0,0,0);else{const i=3,o=n.width+2*i,a=n.height+2*i;s=this._binPack.allocate(o,a),s.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(null),this._initDecorationGlyphs(),this._binPack=new r(this.width,this.height),s=this._binPack.allocate(o,a));const l=this._glyphData[this._currentPage],c=t.bitmap;let u,h;if(c)for(let e=0;e<a;e++){u=o*e,h=this.width*(s.y+e)+s.x;for(let e=0;e<o;e++)l[h+e]=c[u+e]}e("esri-glyph-debug")&&this._showDebugPage(l)}return s}_showDebugPage(e){const t=document.createElement("canvas"),i=t.getContext("2d"),r=new ImageData(this.width,this.height),n=r.data;t.width=this.width,t.height=this.height,t.style.border="1px solid black";for(let t=0;t<e.length;++t)n[4*t]=e[t],n[4*t+1]=0,n[4*t+2]=0,n[4*t+3]=255;i.putImageData(r,0,0),document.body.appendChild(t)}}})},"esri/views/2d/engine/webgl/RectangleBinPack":function(){define(["./Rect"],function(e){"use strict";return class{constructor(t,i){this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new e(0,0,t,i))}get width(){return this._width}get height(){return this._height}allocate(t,i){if(t>this._width||i>this._height)return new e;let r=null,n=-1;for(let e=0;e<this._free.length;++e){const s=this._free[e];t<=s.width&&i<=s.height&&(null===r||s.y<=r.y&&s.x<=r.x)&&(r=s,n=e)}return null===r?new e:(this._free.splice(n,1),r.width<r.height?(r.width>t&&this._free.push(new e(r.x+t,r.y,r.width-t,i)),r.height>i&&this._free.push(new e(r.x,r.y+i,r.width,r.height-i))):(r.width>t&&this._free.push(new e(r.x+t,r.y,r.width-t,r.height)),r.height>i&&this._free.push(new e(r.x,r.y+i,t,r.height-i))),new e(r.x,r.y,t,i))}release(e){for(let t=0;t<this._free.length;++t){const i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}})},"esri/views/2d/engine/webgl/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(e,t){"use strict";class i{constructor(e){for(this._metrics=[],this._bitmaps=[];e.next();)switch(e.tag()){case 1:{const t=e.getMessage();for(;t.next();)switch(t.tag()){case 3:{const e=t.getMessage();let i,r,n,s,o,a,l;for(;e.next();)switch(e.tag()){case 1:i=e.getUInt32();break;case 2:r=e.getBytes();break;case 3:n=e.getUInt32();break;case 4:s=e.getUInt32();break;case 5:o=e.getSInt32();break;case 6:a=e.getSInt32();break;case 7:l=e.getUInt32();break;default:e.skip()}e.release(),i&&(this._metrics[i]={width:n,height:s,left:o,top:a,advance:l},this._bitmaps[i]=r);break}default:t.skip()}t.release();break}default:e.skip()}}getMetrics(e){return this._metrics[e]}getBitmap(e){return this._bitmaps[e]}}class r{constructor(){this._ranges=[]}getRange(e){return this._ranges[e]}addRange(e,t){this._ranges[e]=t}}return class{constructor(e){this._glyphInfo={},this._baseURL=e}getRange(r,n,s){const o=this._getFontStack(r);if(o.getRange(n))return Promise.resolve();const a=256*n,l=a+255,c=this._baseURL.replace("{fontstack}",r).replace("{range}",a+"-"+l);return e(c,{responseType:"array-buffer",...s}).then(e=>{o.addRange(n,new i(new t(new Uint8Array(e.data),new DataView(e.data))))})}async preloadASCIIRange(r){const n=this._getFontStack(r),s=this._baseURL.replace("{fontstack}",r).replace("{range}","0-255"),o=await e(s,{responseType:"array-buffer"}),a=new i(new t(new Uint8Array(o.data),new DataView(o.data)));for(let e=0;e<=255;e++)n.getRange(e)||n.addRange(e,a)}getGlyph(e,t){const i=this._getFontStack(e);if(!i)return;const r=Math.floor(t/256),n=i.getRange(r);return n?{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}:void 0}_getFontStack(e){let t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new r),t}}})},"esri/views/2d/engine/webgl/SDFConverter":function(){define(["../../../../core/floatRGBA","../../../../core/promiseUtils","../svgUtils"],function(e,t,i){"use strict";const r=1e20;return class{constructor(e,t=2){this._textureSize=e,this._rasterizationScale=t,this._canvasSize=this._textureSize*this._rasterizationScale,this._svg=null;const{_canvasSize:i}=this,r=document.createElement("canvas");r.width=r.height=i,this._context=r.getContext("2d",{willReadFrequently:!1}),this._gridOuter=new Float64Array(i*i),this._gridInner=new Float64Array(i*i),this._f=new Float64Array(i),this._d=new Float64Array(i),this._z=new Float64Array(i+1),this._v=new Int16Array(i)}dispose(){this._context=this._gridOuter=this._gridInner=this._f=this._d=this._z=this._v=null,this._svg=i.destroyHiddenSvg(this._svg)}draw(i,n,s){const{_canvasSize:o,_textureSize:a,_rasterizationScale:l}=this,c=a/4;this._initSVG();const u=this.createSVGString(i,n);return new Promise((i,n)=>{const h=new Image;h.src="data:image/svg+xml; charset=utf8, "+encodeURIComponent(u),h.onload=()=>{h.onload=null,this._context.clearRect(0,0,o,o),this._context.drawImage(h,0,0,o,o);const t=this._context.getImageData(0,0,o,o),n=new Uint8Array(a*a*4);for(let e=0;e<o*o;e++){const i=t.data[4*e+3]/255;this._gridOuter[e]=1===i?0:0===i?r:Math.max(0,.5-i)**2,this._gridInner[e]=1===i?r:0===i?0:Math.max(0,i-.5)**2}this._edt(this._gridOuter,o,o),this._edt(this._gridInner,o,o);for(let t=0;t<a*a;t++){let i=0;for(let e=0;e<l;e++){const r=Math.floor(t/a)*l+e;for(let e=0;e<l;e++){const n=r*o+(t%a*l+e);i+=this._gridOuter[n]-this._gridInner[n]}}i/=l*l,i/=l;const r=.5-i/(2*c);e.packFloatRGBA(r,n,4*t)}i(n)};const d=s?.signal;d&&t.onAbort(d,()=>n(t.createAbortError()))})}_initSVG(){return this._svg||(this._svg=i.createHiddenSvg()),this._svg}createSVGString(e,t){const r=this._initSVG(),n=i.createSvgElement("path");n.setAttribute("d",e),r.appendChild(n);const s=n.getBBox(),o=s.width/s.height,a=this._canvasSize/2;let l,c,u;if(o>1){l=a/s.width;const e=a*(1/o);c=this._canvasSize/4,u=a-e/2}else l=a/s.height,c=a-a*o/2,u=this._canvasSize/4;const h=-s.x*l+c,d=-s.y*l+u;n.setAttribute("style",`transform: matrix(${l}, 0, 0, ${l}, ${h}, ${d})`),n.setAttribute("stroke-width",""+.5/l);const f=`<svg style="fill:${t?"red":"none"}; stroke:${t?"none":"red"}" height="${this._canvasSize}" width="${this._canvasSize}" xmlns="http://www.w3.org/2000/svg">${r.innerHTML}</svg>`;return r.removeChild(n),f}_edt(e,t,i){const r=this._f,n=this._d,s=this._v,o=this._z;for(let a=0;a<t;a++){for(let n=0;n<i;n++)r[n]=e[n*t+a];this._edt1d(r,n,s,o,i);for(let r=0;r<i;r++)e[r*t+a]=n[r]}for(let a=0;a<i;a++){for(let i=0;i<t;i++)r[i]=e[a*t+i];this._edt1d(r,n,s,o,t);for(let i=0;i<t;i++)e[a*t+i]=Math.sqrt(n[i])}}_edt1d(e,t,i,n,s){i[0]=0,n[0]=-r,n[1]=+r;for(let t=1,o=0;t<s;t++){let s=(e[t]+t*t-(e[i[o]]+i[o]*i[o]))/(2*t-2*i[o]);for(;s<=n[o];)o--,s=(e[t]+t*t-(e[i[o]]+i[o]*i[o]))/(2*t-2*i[o]);o++,i[o]=t,n[o]=s,n[o+1]=+r}for(let r=0,o=0;r<s;r++){for(;n[o+1]<r;)o++;t[r]=(r-i[o])*(r-i[o])+e[i[o]]}}}})},"esri/views/2d/engine/webgl/SpriteMosaic":function(){define(["../../../../core/Error","../../../../core/has","./definitions","./GeometryUtils","./Rect","./RectangleBinPack","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a){"use strict";function l(e){return e&&"static"===e.type}class c{constructor(e,t,i=0){this._mosaicPages=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects=new Map,this._spriteCopyQueue=[],this.pixelRatio=1,this._pageWidth=e,this._pageHeight=t,i>0&&(this._maxItemSize=i),this.pixelRatio=window.devicePixelRatio||1,this._binPack=new s(this._pageWidth,this._pageHeight);const r=Math.floor(this._pageWidth),n=Math.floor(this._pageHeight);this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(r*n)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0})}getWidth(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[0]}getHeight(e){return e>=this._mosaicPages.length?-1:this._mosaicPages[e].size[1]}getPageTexture(e){return e<this._mosaicPages.length?this._mosaicPages[e].texture:null}has(e){return this._mosaicRects.has(e)}get itemCount(){return this._mosaicRects.size}getSpriteItem(e){return this._mosaicRects.get(e)}addSpriteItem(e,r,s,o,a,c,u=1,h="Linear",d=.5,f=1){if(this._mosaicRects.has(e))return this._mosaicRects.get(e);let p,m,g;if(l(s))[p,m,g]=this._allocateImage(r[0],r[1]);else{p=new n(0,0,r[0],r[1]),m=this._mosaicPages.length;const e=void 0;this._mosaicPages.push({mosaicsData:s,size:[r[0]+2*i.spritePadding,r[1]+2*i.spritePadding],dirty:!0,texture:e})}if(p.width<=0||p.height<=0)return null;const _={type:"sprite",rect:p,width:r[0],height:r[1],sdf:a,simplePattern:c,rasterizationScale:u,samplingMode:h,sdfPaddingRatio:d,sdfDecodeCoeff:f,page:m};return this._mosaicRects.set(e,_),l(s)&&(t("esri-mosaic-debug")&&this._showDebugSprite(r,s.data),this._copy({rect:p,spriteSize:r,spriteData:s.data,page:m,pageSize:g,repeat:o,sdf:a})),_}hasItemsToProcess(){return 0!==this._spriteCopyQueue.length}processNextItem(){const e=this._spriteCopyQueue.pop();e&&this._copy(e)}getMosaicItemPosition(e){const t=this.getSpriteItem(e),r=t?.rect;if(!r)return null;r.width=t.width,r.height=t.height;const n=t.width,s=t.height,o=i.spritePadding,a=this._mosaicPages[t.page].size;return{size:[t.width,t.height],tl:[(r.x+o)/a[0],(r.y+o)/a[1]],br:[(r.x+o+n)/a[0],(r.y+o+s)/a[1]],page:t.page}}bind(e,i,r=0,n=0){const s=this._mosaicPages[r],o=s.mosaicsData;let a=s.texture;a||(a=h(e,s.size),s.texture=a),a.setSamplingMode(i),l(o)?(e.bindTexture(a,n),s.dirty&&(a.setData(new Uint8Array(o.data.buffer)),a.generateMipmap(),t("esri-mosaic-debug")&&this._showDebugPage(r))):(o.data.loadFrame(a),e.bindTexture(a,n),a.generateMipmap()),s.dirty=!1}getTexture(e,i=0){const r=this._mosaicPages[i],n=r.mosaicsData;let s=r.texture;return s||(s=h(e,r.size),r.texture=s),l(n)?r.dirty&&(s.setData(new Uint8Array(n.data.buffer)),s.generateMipmap(),t("esri-mosaic-debug")&&this._showDebugPage(i)):(n.data.loadFrame(s),s.generateMipmap()),r.dirty=!1,s}dispose(){this._binPack=null;for(const e of this._mosaicPages){const t=e.texture;t&&t.dispose();const i=e.mosaicsData;l(i)||i.data.destroy()}this._mosaicPages=null,this._mosaicRects.clear()}static _copyBits(e,t,i,r,n,s,o,a,l,c,u){let h=r*t+i,d=a*s+o;if(u){d-=s;for(let o=-1;o<=c;o++,h=((o+c)%c+r)*t+i,d+=s)for(let t=-1;t<=l;t++)n[d+t]=e[h+(t+l)%l]}else for(let i=0;i<c;i++){for(let t=0;t<l;t++)n[d+t]=e[h+t];h+=t,d+=s}}_copy(t){if(t.page>=this._mosaicPages.length)return;const r=this._mosaicPages[t.page],n=r.mosaicsData;if(!l(r.mosaicsData))throw new e("mapview-invalid-resource","unsuitable data type!");const s=t.spriteData,o=n.data;c._copyBits(s,t.spriteSize[0],0,0,o,t.pageSize[0],t.rect.x+i.spritePadding,t.rect.y+i.spritePadding,t.spriteSize[0],t.spriteSize[1],t.repeat),r.dirty=!0}_allocateImage(e,t){e+=2*i.spritePadding,t+=2*i.spritePadding;const o=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<o){const i=2**Math.ceil(r.log2(e)),s=2**Math.ceil(r.log2(t)),o=new n(0,0,e,t);return this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(i*s)},size:[i,s],dirty:!0,texture:void 0}),[o,this._mosaicPages.length-1,[i,s]]}const a=this._binPack.allocate(e,t);if(a.width<=0){const i=this._mosaicPages[this._currentPage];return!i.dirty&&l(i.mosaicsData)&&(i.mosaicsData.data=null),this._currentPage=this._mosaicPages.length,this._mosaicPages.push({mosaicsData:{type:"static",data:new Uint32Array(this._pageWidth*this._pageHeight)},size:[this._pageWidth,this._pageHeight],dirty:!0,texture:void 0}),this._binPack=new s(this._pageWidth,this._pageHeight),this._allocateImage(e,t)}return[a,this._currentPage,[this._pageWidth,this._pageHeight]]}_showDebugSprite([e,t],i){const r=document.createElement("canvas");r.width=e,r.height=t,r.setAttribute("style",`position: absolute; top: ${4+204*u++}px; right: 208px; width: 200px; height: 200px; border: 1px solid black;`);const n=r.getContext("2d"),s=new ImageData(e,t);s.data.set(new Uint8Array(i.buffer)),n.putImageData(s,0,0),document.body.appendChild(r)}_showDebugPage(e){const t=this._mosaicPages[e],{size:[i,r],mosaicsData:n}=t;if(!l(n))return;const s=`mosaicDebugPage${e}`,o=document.getElementById(s)??document.createElement("canvas");o.id=s,o.width=i,o.height=r,o.setAttribute("style",`position: absolute; top: ${4+204*e}px; right: 4px; width: 200px; height: 200px; border: 1px solid black;`);const a=o.getContext("2d"),c=new ImageData(i,r);c.data.set(new Uint8Array(n.data.buffer)),a.putImageData(c,0,0),document.body.appendChild(o)}}let u=0;function h(e,t){const i=new a.TextureDescriptor(t[0],t[1]);return i.wrapMode=33071,new o.Texture(e,i,null)}return c})},"esri/views/2d/engine/webgl/urlUtils":function(){define(["exports"],function(e){"use strict";e.discardUrlIfHasUrlHash=function(e){return"url"in e&&"urlHash"in e?{...e,url:""}:e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animatedFormats/AnimatableTextureResource":function(){define(["exports","../definitions","./utils"],function(e,t,i){"use strict";e.AnimatableTextureResource=class{constructor(e,t,r,n){this._animation=e,this._frameData=null,this.frameCount=this._animation.frameDurations.length,this.width=this._animation.width,this.height=this._animation.height,this._playHandle=i.play(this._animation,r,n,e=>{this._frameData=e,t.requestRender()})}destroy(){this._playHandle.remove()}loadFrame(e){const i=this._frameData;if(null==i)return;const r="width"in i?i.width:i.codedWidth,n="height"in i?i.height:i.codedHeight;e.updateData(0,t.spritePadding,t.spritePadding,r,n,i),this._frameData=null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animatedFormats/utils":function(){define(["exports","../../../../../core/handleUtils","../../../../../core/time","../grouping"],function(e,t,i,r){"use strict";function n(e){return i.Milliseconds(e.frameDurations.reduce((e,t)=>e+t,0))}function s(e){const{width:t,height:i}=e,r=e.frameDurations.reverse();return{frameCount:e.frameCount,duration:e.duration,frameDurations:r,getFrame:t=>{const i=e.frameDurations.length-1-t;return e.getFrame(i)},width:t,height:i}}function o(e,t){const{width:r,height:n,getFrame:s}=e,o=t/e.duration,a=e.frameDurations.map(e=>i.Milliseconds(e*o));return{frameCount:e.frameCount,duration:e.duration,frameDurations:a,getFrame:s,width:r,height:n}}function a(e,t){const{width:r,height:n,getFrame:s}=e,o=e.frameDurations.slice(),a=o.shift();return o.unshift(i.Milliseconds(a+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:o,getFrame:s,width:r,height:n}}function l(e,t){const{width:r,height:n,getFrame:s}=e,o=e.frameDurations.slice(),a=o.pop();return o.push(i.Milliseconds(a+t)),{frameCount:e.frameCount,duration:e.duration+t,frameDurations:o,getFrame:s,width:r,height:n}}class c{constructor(e,t,i,r){this._animation=e,this._repeatType=i,this._onFrameData=r,this._direction=1,this._currentFrame=0,this.timeToFrame=this._animation.frameDurations[this._currentFrame];let n=0;for(;t>n;)n+=this.timeToFrame,this.nextFrame();const s=this._animation.getFrame(this._currentFrame);this._onFrameData(s)}nextFrame(){if(this._currentFrame+=this._direction,this._direction>0){if(this._currentFrame===this._animation.frameDurations.length)switch(this._repeatType){case"None":this._currentFrame-=this._direction;break;case"Loop":this._currentFrame=0;break;case"Oscillate":this._currentFrame-=this._direction,this._direction=-1}}else if(-1===this._currentFrame)switch(this._repeatType){case"None":this._currentFrame-=this._direction;break;case"Loop":this._currentFrame=this._animation.frameDurations.length-1;break;case"Oscillate":this._currentFrame-=this._direction,this._direction=1}this.timeToFrame=this._animation.frameDurations[this._currentFrame];const e=this._animation.getFrame(this._currentFrame);this._onFrameData(e)}}function u(e,t,u,h){let d,{repeatType:f}=t;if(null==f&&(f="Loop"),!0===t.reverseAnimation&&(e=s(e)),null!=t.duration&&(e=o(e,i.Milliseconds(1e3*t.duration))),null!=t.repeatDelay){const r=1e3*t.repeatDelay;"Loop"===f?e=l(e,i.Milliseconds(r)):"Oscillate"===f&&(e=a(l(e,i.Milliseconds(r/2)),i.Milliseconds(r/2)))}if(null!=t.startTimeOffset)d=i.Milliseconds(1e3*t.startTimeOffset);else if(null!=t.randomizeStartTime){const s=82749913,o=null!=t.randomizeStartSeed?t.randomizeStartSeed:s,a=r.getRandomValue(u,o);d=i.Milliseconds(a*n(e))}else d=i.Milliseconds(0);return new c(e,d,f,h)}e.Player=c,e.adjustDuration=o,e.appendDelay=l,e.createPlayer=u,e.getDuration=n,e.play=function(e,i,r,n){const s=null==i.playAnimation||i.playAnimation,o=u(e,i,r,n);let a,l=o.timeToFrame;return function e(){a=s?setTimeout(()=>{o.nextFrame(),l=o.timeToFrame,e()},l):void 0}(),t.makeHandle(()=>s&&clearTimeout(a))},e.prependDelay=a,e.reverse=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],function(e,t){"use strict";function i(e,i){let r;if("string"==typeof e)r=t.numericHash(e+`-seed(${i})`);else{let t=12;r=e^i;do{r=107*(r>>8^r)+t|0}while(0!==--t)}return(1+r/(1<<31))/2}e.getRandomValue=i,e.getStartGroup=function(e){return Math.floor(10*i(e,53290320))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/store/AnimationStore":function(){define(["exports","../../../../../webgl/enums","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor","../../../../../webgl/ValidatedTextureDescriptor"],function(e,t,i,r,n){"use strict";class s{constructor(e,t){this.parent=e,this.key=t,this.payload=null,this._children=new Map}get(e){return this._children.get(e)}ensure(e){let t=this._children.get(e);return t||(t=new s(this,e),this._children.set(e,t)),t}delete(e){this._children.delete(e)}}class o{constructor(){this._root=new s(null,NaN)}set(e,t){let i=this._root;for(const t of e)for(const e of t)i=i.ensure(e);return i.payload=t,i}delete(e){e.parent?.delete(e.key)}get(e){let t=this._root;for(const i of e)for(const e of i){const i=t.get(e);if(!i)return;t=i}return t.payload||void 0}}class a{constructor(){this._pages=[]}add(e){0===this._pages.length&&this._pages.push(new l);let t=this._pages.length-1,i=this._pages[t].add(e);if(i||(this._pages.push(new l),t=this._pages.length-1,i=this._pages[t].add(e)),!i)throw new Error("Data allocation failed.");return{...i,page:t}}remove(e){this._pages[e.page].remove(e)}getTexture(e,t){return this._pages[t].getTexture(e)}destroy(){}}class l{constructor(){this._cursor={row:0,column:0},this._columns=1024,this._rows=1024,this._data=new Float32Array(this._columns*this._rows*4),this._texture=null,this._textureCursor={row:0,column:0}}add(e){if(e.length>this._columns)throw new Error(`The maximum allocation size is ${this._columns} texels.`);const t={...this._cursor};if(t.column+=e.length,t.column>=this._columns&&(t.column=e.length,t.row++),t.row>=this._rows)return null;this._cursor=t;const i={...this._cursor};i.column-=e.length;let r=4*(i.row*this._columns+i.column);for(let t=0;t<e.length;t++)this._data[r++]=e[t][0],this._data[r++]=e[t][1],this._data[r++]=e[t][2],this._data[r++]=e[t][3];return i}remove(e){}getTexture(e){if(!this._texture){const s=new r.TextureDescriptor(this._columns,this._rows);s.pixelFormat=6408,s.dataType=t.PixelType.FLOAT,s.wrapMode=33071,s.samplingMode=9728,s.hasMipmap=!1;const o=new n.ValidatedTextureDescriptor(e,s);this._texture=new i.Texture(e,o)}if(this._cursor.row===this._textureCursor.row&&this._cursor.column===this._textureCursor.column)return this._texture;const s=this._textureCursor.row,o=this._cursor.row-s+1;return this._texture.updateData(0,0,s,this._columns,o,this._data,s),this._textureCursor.row=this._cursor.row,this._textureCursor.column=this._cursor.column,this._texture}destroy(){this._texture?.dispose()}}e.AnimationStore=class{constructor(){this._entries=new o,this._nodes=new Map,this._book=new a}add(e){let t=this._entries.get(e);if(!t){const i=this._book.add(e),r=new Object;t={location:i,references:0,handle:r};const n=this._entries.set(e,t);this._nodes.set(r,n)}return t.references++,t}remove(e){const t=this._nodes.get(e.handle);t&&t.payload&&(t.payload.references--,0===t.payload.references&&(this._book.remove(t.payload.location),this._entries.delete(t),this._nodes.delete(e.handle)))}getTexture(e,t){return this._book.getTexture(e,t)}destroy(){this._book.destroy()}},e.PrefixMap=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TextureUploadManager":function(){define(["exports","../../../../core/has","../../../../core/promiseUtils","./definitions"],function(e,t,i,r){"use strict";e.TextureUploadManager=class{constructor(e){this._queue=[],this._refreshable=e}destroy(){this._queue=[]}enqueueTextureUpdate(e,t){const n=i.createResolver(),s=e,o=r.textureUploadManagerChunkSize,a=Math.ceil(s.height/o);i.throwIfAborted(t);for(let i=0;i<a;i++){const r=i*o,l=i===a-1,c=l?s.height-o*i:o;this._queue.push({type:"chunk",request:e,resolver:n,chunk:i,chunkOffset:r,destHeight:c,chunkIsLast:l,options:t})}return i.onAbortOrThrow(t,e=>n.reject(e)),n.promise}upload(){const e=performance.now();let t=0;for(;this._queue.length;){const i=this._queue.shift();if(i){if(null!=i.options.signal&&i.options.signal.aborted)continue;switch(i.type){case"chunk":this._uploadChunk(i);break;case"no-chunk":this._uploadNoChunk(i)}++t;const n=performance.now()-e;if(n+n/t>=r.textureUploadManagerBudget)break}}this._queue.length&&this._refreshable.requestRender()}_uploadChunk(e){const{request:t,resolver:i,chunkOffset:r,chunkIsLast:n,destHeight:s}=e,{data:o,texture:a,width:l}=t;null!=o&&(a.updateData(0,0,r,l,s,o,r),n&&i.resolve())}_uploadNoChunk(e){const{request:t,resolver:i}=e,{data:r,texture:n}=t;n.setData(r),i.resolve()}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/WorldExtentClipRenderer":function(){define(["exports","../../../../core/maybe","../../../../core/libs/gl-matrix-2/math/common","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","./definitions","./VertexStream","./shaders/StencilPrograms","../../../webgl/ProgramTemplate"],function(e,t,i,r,n,s,o,a,l,c,u,h){"use strict";const d=s.fromValues(-.5,-.5);e.WorldExtentRenderer=class{constructor(){this._centerNdc=a.create(),this._pxToNdc=a.create(),this._worldDimensionsPx=a.create(),this._mat3=n.create(),this._initialized=!1}dispose(){this._program=t.disposeMaybe(this._program),this._quad=t.disposeMaybe(this._quad)}render(e,t,i){const{context:r}=e,n=this._updateGeometry(e,i);if(null!=t){const{r:e,g:i,b:n,a:s}=t;r.setClearColor(s*e/255,s*i/255,s*n/255,s)}else r.setClearColor(0,0,0,0);if(r.setStencilFunction(519,0,255),r.setStencilWriteMask(255),!n)return r.setClearStencil(l.backbufferStencilVisible),void r.clear(17408);r.setClearStencil(l.backbufferStencilClipped),r.clear(17408),this._initialized||this._initialize(r),r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.setColorMask(!1,!1,!1,!1),r.setBlendingEnabled(!1),r.setStencilOp(7680,7680,7681),r.setStencilFunction(519,l.backbufferStencilVisible,255),r.setStencilTestEnabled(!0),r.useProgram(this._program),this._program.setUniformMatrix3fv("u_worldExtent",this._mat3),this._quad.bind(),this._quad.draw(),this._quad.unbind()}_initialize(e){this._initialized||(this._quad=new c(e,[0,0,1,0,0,1,1,1]),this._program=h.createProgram(e,u.stencil,this._quad.locations),this._initialized=!0)}_updateGeometry(e,t){const{state:n,pixelRatio:s}=e,{size:a,rotation:l}=n,c=Math.round(a[0]*s),u=Math.round(a[1]*s);if(!n.spatialReference.isWrappable)return!1;const h=i.toRadian(l),f=Math.abs(Math.cos(h)),p=Math.abs(Math.sin(h)),m=Math.round(c*f+u*p),g=Math.round(s*n.worldScreenWidth);if(m<=g)return!1;const _=c*p+u*f,y=(t.left-t.right)*s/c,x=(t.bottom-t.top)*s/u;o.set(this._worldDimensionsPx,g,_,1),o.set(this._pxToNdc,2/c,-2/u,1),o.set(this._centerNdc,y,x,1);const b=this._mat3;return r.fromTranslation(b,this._centerNdc),r.scale(b,b,this._pxToNdc),0!==l&&r.rotate(b,b,h),r.scale(b,b,this._worldDimensionsPx),r.translate(b,b,d),!0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/VertexStream":function(){define(["./shaderGraph/techniques/mesh/utils","../../../webgl/enums","../../../webgl/VertexArrayObject","../../../webgl/VertexBuffer","../../../webgl/VertexElementDescriptor"],function(e,t,i,r,n){"use strict";return class{constructor(s,o){this._rctx=s,this._attributes=[{name:"position",offset:0,type:t.DataType.SHORT,count:2}],this.layout={hash:e.vertexLayoutHash(this._attributes),attributes:this._attributes,stride:4},this._vertexBuffer=new r.VertexBuffer(s,[new n.VertexElementDescriptor("a_position",2,t.DataType.SHORT,0,4)],new Uint16Array(o)),this._vao=new i.VertexArrayObject(s,this._vertexBuffer),this._count=o.length/2}get locations(){return this._vao.locations}bind(){this._rctx.bindVAO(this._vao)}unbind(){this._rctx.bindVAO(null)}dispose(){this._vao.dispose()}draw(){this._rctx.bindVAO(this._vao),this._rctx.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,this._count)}}})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["exports","./sources/resolver"],function(e,t){"use strict";const i={vertexShader:t.resolveIncludes("stencil/stencil.vert"),fragmentShader:t.resolveIncludes("stencil/stencil.frag")};e.stencil=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/BlendEffect":function(){define(["exports","../shaderGraph/techniques/blend/BlendTechnique"],function(e,t){"use strict";e.BlendEffect=class{constructor(){this._blendTechnique=new t.BlendTechnique}dispose(e){this._blendTechnique?.shutdown()}draw(e,t,i,r,n){this._blendTechnique.render(e,{colorTexture:t,config:{opacity:n,samplingMode:i},blendMode:r})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/blend/BlendTechnique":function(){define(["exports","../../utils","../Technique","../shaders/BlendShader","../shaders/OpacityShader","../../../../../../webgl/Texture","../../../../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o){"use strict";class a extends i.Technique{constructor(){super(...arguments),this.type=5,this._backBufferTexture=null,this.shaders={blend:new r.BlendShader,opacity:new n.OpacityShader}}shutdown(){super.shutdown(),null!==this._backBufferTexture&&(this._backBufferTexture.dispose(),this._backBufferTexture=null)}render(e,i){const{context:r,state:n,pixelRatio:s,inFadeTransition:o,painter:a}=e,{size:l}=n,c=r.getBoundFramebufferObject();let u,h;null!=c?(u=c.width,h=c.height):(u=Math.round(s*l[0]),h=Math.round(s*l[1]));const{blendMode:d}=i;if("normal"===d){const e={shader:this.shaders.opacity,uniforms:{config:{layerTexture:{texture:i.colorTexture,unit:0},opacity:i.config.opacity}},defines:null,optionalAttributes:null,useComputeBuffer:!1};return a.setPipelineState(t.simplePipelineState),void a.submitDrawMesh(r,e,a.quadMesh)}const f=this._createOrResizeTexture(e,u,h);c.copyToTexture(0,0,u,h,0,0,f),a.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"custom",blendParameters:{srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0}},depth:!1,stencil:!1});const p={backbufferTexture:{texture:f,unit:0},layerTexture:{texture:i.colorTexture,unit:1},inFadeOpacity:o?1:0,...i.config},m={shader:this.shaders.blend,uniforms:{config:p},defines:{blendMode:d},optionalAttributes:null,useComputeBuffer:!1};a.submitDrawMesh(r,m,a.quadMesh)}_createOrResizeTexture(e,t,i){const{context:r}=e;if(null!==this._backBufferTexture&&this._backBufferTexture.descriptor?.width===t&&this._backBufferTexture.descriptor?.height===i)return this._backBufferTexture;if(null===this._backBufferTexture){const e=new o.TextureDescriptor(t,i);e.internalFormat=6408,e.wrapMode=33071,this._backBufferTexture=new s.Texture(r,e)}else this._backBufferTexture.resize(t,i);return this._backBufferTexture}}e.BlendTechnique=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/utils":function(){define(["exports"],function(e){"use strict";e.getLocations=function(e){return e.locationsMap},e.simplePipelineState={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/Technique":function(){define(["exports"],function(e){"use strict";e.Technique=class{constructor(){this.drawPhase=89}startup(){}shutdown(e){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/BlendShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,t,i,r,n){"use strict";class s extends i.VertexInput{}t.__decorate([i.location(0,r.Vec2)],s.prototype,"position",void 0);class o extends i.FragmentInput{}class a extends i.UniformGroup{}t.__decorate([i.uniform(r.Sampler2D)],a.prototype,"layerTexture",void 0),t.__decorate([i.uniform(r.Sampler2D)],a.prototype,"backbufferTexture",void 0),t.__decorate([i.uniform(r.Float)],a.prototype,"opacity",void 0),t.__decorate([i.uniform(r.Float)],a.prototype,"inFadeOpacity",void 0);class l extends i.GraphShaderModule{constructor(){super(...arguments),this.type="BlendShader"}vertex(e){return{uv:e.position,glPosition:new r.Vec4(n.uvToClip(e.position),0,1)}}fragment(e){const t=new i.FragmentOutput,s=r.texture2D(this.config.layerTexture,e.uv),o=r.texture2D(this.config.backbufferTexture,e.uv),a=r.ifElse(r.equal(s.a,new r.Float(0)),s.rgb,s.rgb.divide(s.a)),l=r.ifElse(r.equal(o.a,new r.Float(0)),o.rgb,o.rgb.divide(o.a)),g=this.config.opacity.multiply(s.a),_=o.a;switch(this.blendMode){case"destination-over":t.fragColor=new r.Vec4(a.multiply(g).multiply(n.oneMinus(_)).add(l.multiply(_)),g.add(_).subtract(g.multiply(_)));break;case"source-in":{const e=new r.Vec4(a.multiply(g).multiply(_),g.multiply(_)),i=new r.Vec4(l.multiply(_),_).multiply(n.oneMinus(this.config.opacity)).multiply(this.config.inFadeOpacity);t.fragColor=e.add(i)}break;case"destination-in":{const e=new r.Vec4(l.multiply(_).multiply(g),_.multiply(g)),i=new r.Vec4(l.multiply(_),_).multiply(new r.Vec4(n.oneMinus(this.config.opacity).multiply(this.config.inFadeOpacity)));t.fragColor=e.add(i)}break;case"source-out":t.fragColor=new r.Vec4(a.multiply(g).multiply(n.oneMinus(_)),g.multiply(n.oneMinus(_)));break;case"destination-out":t.fragColor=new r.Vec4(l.multiply(_).multiply(n.oneMinus(g)),_.multiply(n.oneMinus(g)));break;case"source-atop":t.fragColor=new r.Vec4(a.multiply(g).multiply(_).add(l.multiply(_.multiply(n.oneMinus(g)))),_);break;case"destination-atop":t.fragColor=new r.Vec4(a.multiply(g.multiply(n.oneMinus(_))).add(l.multiply(_).multiply(g)),g);break;case"xor":t.fragColor=new r.Vec4(a.multiply(g.multiply(n.oneMinus(_))).add(l.multiply(_.multiply(n.oneMinus(g)))),g.multiply(n.oneMinus(_)).add(_.multiply(n.oneMinus(g))));break;case"multiply":t.fragColor=new r.Vec4(a.multiply(g).multiply(l.multiply(_)).add(a.multiply(g).multiply(n.oneMinus(_))).add(l.multiply(_).multiply(n.oneMinus(g))),g.add(_.multiply(n.oneMinus(g))));break;case"screen":t.fragColor=new r.Vec4(a.add(l).subtract(a.multiply(l)).multiply(g.multiply(_)).add(a.multiply(g).multiply(n.oneMinus(_))).add(l.multiply(_).multiply(n.oneMinus(g))),g.add(_.multiply(n.oneMinus(g))));break;case"overlay":{const e=new r.Vec3(u(l.r,a.r),u(l.g,a.g),u(l.b,a.b));t.fragColor=c(e,a,l,g,_)}break;case"darken":{const e=r.min(a,l);t.fragColor=c(e,a,l,g,_)}break;case"lighter":t.fragColor=new r.Vec4(a.multiply(g).add(l.multiply(_)),g.add(_));break;case"lighten":{const e=r.max(a,l);t.fragColor=c(e,a,l,g,_)}break;case"color-dodge":{const e=r.clamp(new r.Vec3(h(l.r,a.r),h(l.g,a.g),h(l.b,a.b)),new r.Vec3(0),new r.Vec3(1));t.fragColor=c(e,a,l,g,_)}break;case"color-burn":{const e=new r.Vec3(d(l.r,a.r),d(l.g,a.g),d(l.b,a.b));t.fragColor=c(e,a,l,g,_)}break;case"hard-light":{const e=new r.Vec3(f(l.r,a.r),f(l.g,a.g),f(l.b,a.b));t.fragColor=c(e,a,l,g,_)}break;case"soft-light":{const e=new r.Vec3(p(l.r,a.r),p(l.g,a.g),p(l.b,a.b));t.fragColor=c(e,a,l,g,_)}break;case"difference":{const e=r.abs(l.subtract(a));t.fragColor=c(e,a,l,g,_)}break;case"exclusion":{const e=a.add(l).subtract(new r.Float(2).multiply(a).multiply(l));t.fragColor=c(e,a,l,g,_)}break;case"invert":t.fragColor=new r.Vec4(new r.Vec3(1).subtract(l).multiply(g).multiply(_).add(l.multiply(_).multiply(n.oneMinus(g))),_);break;case"vivid-light":{const e=new r.Vec3(r.clamp(m(l.r,a.r),new r.Float(0),new r.Float(1)),r.clamp(m(l.g,a.g),new r.Float(0),new r.Float(1)),r.clamp(m(l.b,a.b),new r.Float(0),new r.Float(1)));t.fragColor=c(e,a,l,g,_)}break;case"hue":{const e=v(a,l,l);t.fragColor=c(e,a,l,g,_)}break;case"saturation":{const e=v(l,a,l);t.fragColor=c(e,a,l,g,_)}break;case"color":{const e=b(a,l);t.fragColor=c(e,a,l,g,_)}break;case"luminosity":{const e=b(l,a);t.fragColor=c(e,a,l,g,_)}break;case"plus":t.fragColor=r.clamp(new r.Vec4(s.r.add(l.r),s.g.add(l.g),s.b.add(l.b),g.add(_)),new r.Vec4(0),new r.Vec4(1));break;case"minus":t.fragColor=new r.Vec4(r.clamp(new r.Vec3(l.r.subtract(s.r),l.g.subtract(s.g),l.b.subtract(s.b)),new r.Vec3(0),new r.Vec3(1)),_.multiply(g));break;case"average":{const e=l.add(a).divide(2);t.fragColor=c(e,a,l,g,_)}break;case"reflect":{const e=r.clamp(new r.Vec3(S(l.r,a.r),S(l.g,a.g),S(l.b,a.b)),new r.Vec3(0),new r.Vec3(1));t.fragColor=c(e,a,l,g,_)}break;default:t.fragColor=s.multiply(this.config.opacity)}return t}}function c(e,t,i,s,o){return new r.Vec4(e.multiply(s).multiply(o).add(t.multiply(s).multiply(n.oneMinus(o))).add(i.multiply(o).multiply(n.oneMinus(s))),s.add(o.multiply(n.oneMinus(s))))}function u(e,t){return new r.Float(1).subtract(r.step(new r.Float(.5),t)).multiply(n.oneMinus(new r.Float(2).multiply(n.oneMinus(t).multiply(n.oneMinus(e))))).add(r.step(new r.Float(.5),t).multiply(new r.Float(2).multiply(t).multiply(e)))}function h(e,t){return r.ifElse(r.equal(e,new r.Float(0)),new r.Float(0),r.ifElse(r.equal(t,new r.Float(1)),new r.Float(1),r.min(new r.Float(1),e.divide(new r.Float(1).subtract(t)))))}function d(e,t){return r.ifElse(r.equal(e,new r.Float(1)),new r.Float(1),r.ifElse(r.equal(t,new r.Float(0)),new r.Float(0),n.oneMinus(r.min(new r.Float(1),n.oneMinus(e).divide(t)))))}function f(e,t){return new r.Float(1).subtract(r.step(new r.Float(.5),t)).multiply(new r.Float(2).multiply(t).multiply(e)).add(r.step(new r.Float(.5),t).multiply(n.oneMinus(new r.Float(2).multiply(n.oneMinus(t).multiply(n.oneMinus(e))))))}function p(e,t){return r.cond([r.lessThanEqual(t,new r.Float(.5)),()=>{const i=new r.Float(2).multiply(t),s=n.oneMinus(i),o=n.oneMinus(e);return e.subtract(s.multiply(e).multiply(o))}],[r.lessThanEqual(e,new r.Float(.25)),()=>{const i=new r.Float(2).multiply(t),s=n.minusOne(i).multiply(e),o=new r.Float(16).multiply(e).subtract(new r.Float(12)).multiply(e).add(new r.Float(3));return e.add(s.multiply(o))}],[!0,()=>{const i=new r.Float(2).multiply(t),s=n.minusOne(i),o=r.sqrt(e).subtract(e);return e.add(s.multiply(o))}])}function m(e,t){const i=n.oneMinus(r.step(new r.Float(.5),t)).multiply(d(e,new r.Float(2).multiply(t))),s=r.step(new r.Float(.5),t).multiply(h(e,new r.Float(2).multiply(n.minusScalar(t,.5))));return i.add(s)}function g(e){return r.min(r.min(e.r,e.g),e.b)}function _(e){return r.max(r.max(e.r,e.g),e.b)}function y(e){return r.dot(e,new r.Vec3(.3,.59,.11))}function x(e){return _(e).subtract(g(e))}function b(e,t){const i=y(e),s=y(t).subtract(i);return function(e){const t=y(e),i=g(e),s=_(e);return r.cond([r.lessThan(i,new r.Float(0)),()=>{const r=e.subtract(t).multiply(t),n=t.subtract(i);return t.add(r.divide(n))}],[r.greaterThan(s,new r.Float(1)),()=>{const i=e.subtract(t),r=n.oneMinus(t),o=i.multiply(r),a=s.subtract(t);return t.add(o.divide(a))}],[!0,e])}(e.add(new r.Vec3(s)))}function v(e,t,i){const n=g(e),s=x(e),o=x(t);return b(r.ifElse(r.greaterThan(s,new r.Float(0)),()=>e.subtract(n).multiply(o).divide(s),new r.Vec3(0)),i)}function S(e,t){return r.ifElse(r.equal(t,new r.Float(1)),t,()=>{const i=n.oneMinus(t),s=e.multiply(e).divide(i);return r.min(s,new r.Float(1))})}t.__decorate([i.define],l.prototype,"blendMode",void 0),t.__decorate([i.uniform(a)],l.prototype,"config",void 0),t.__decorate([t.__param(0,i.input(s))],l.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(o))],l.prototype,"fragment",null),e.BlendShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GraphShaderModule":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/has","../../../../../core/Logger","./graph/glsl","./graph/GlslGraphWriter","./graph/ShaderGraphContext","./graph/ShaderGraphNode","./typed/TypedShaderProgram","../../../../webgl/ShaderBuilder"],function(e,t,i,r,n,s,o,a,l,c){"use strict";function u(e){return new e}function h(e,t,i){const r=e.constructor[t]??[];e.constructor.hasOwnProperty(t)||Object.defineProperty(e.constructor,t,{value:r.slice()}),e.constructor[t].push(i)}const d=e=>(t,i)=>{h(t,"builtins",{builtin:e,propertyKey:i})},f=(e,t)=>(i,r)=>{i.constructor.builtins.push({builtin:e,propertyKey:r,typeCtor:t})};class p{static{this.builtins=[]}}t.__decorate([f("gl_VertexID",n.Int)],p.prototype,"glVertexID",void 0);class m{static{this.builtins=[]}}t.__decorate([f("gl_FragCoord",n.Vec4)],m.prototype,"glFragCoord",void 0),t.__decorate([f("gl_PointCoord",n.Vec2)],m.prototype,"glPointCoord",void 0);class g{}t.__decorate([d("gl_FragDepth")],g.prototype,"glFragDepth",void 0),e.ComputeVertexInput=class{},e.FragmentInput=m,e.FragmentOutput=g,e.GraphShaderModule=class{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const e=this._shaderModuleClass.inputs.findLast(e=>"vertex"===e.propertyKey&&0===e.parameterIndex);if(!e)throw new Error("Unable to find vertex input parameter");return e}get computeInput(){return this._shaderModuleClass.inputs.findLast(e=>"vertex"===e.propertyKey&&1===e.parameterIndex)}get fragmentInput(){const e=this._shaderModuleClass.inputs.findLast(e=>"fragment"===e.propertyKey);if(!e)throw new Error("Unable to find fragment input parameter");return e}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const e=new Map,t=new Set;for(const i of this.locations)t.has(i.index)?r.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${i.propertyKey} to ${i.index}. Index already in use`,{locationsMap:e}):(e.set(i.propertyKey,i.index),t.add(i.index));return e}get locationInfo(){if(!this._locationInfo){const e=this.locationsMap,t=Array.from(e.entries()).map(([e,t])=>`${e}.${t}`).join("."),i=this.computeAttributes;this._locationInfo={stringHash:t,locations:e,computeAttributeMap:i}}return this._locationInfo}get renamedLocationsMap(){const e=new Map;for(const t of this.locations)e.set("a_"+t.propertyKey,t.index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){const e=new Set;for(const t of this._options)e.add(t.propertyKey);this._optionPropertyKeys=e}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(e,t,i,r){try{const{vertex:n,fragment:s,uniformBindings:o}=this._generateShaders(e,t,i,r);return new l.TypedShaderProgram(n,s,this.renamedLocationsMap,o,this.transformFeedbackBindings)}catch(e){return new l.TypedShaderProgram("","",this.renamedLocationsMap,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(e){const t=this._options.find(t=>t.propertyKey===e);if(t)return{type:"option",className:t.typeCtor};const i=this._uniforms.find(t=>t.propertyKey===e);if(!i)throw new Error(`Unable to find uniform class type for property: ${e}`);return{type:"required",className:i.typeCtor}}getShaderKey(e,t,i,r){const n=Object.keys(e).map(t=>`${t}.${e[t]}`).join("."),s=Object.keys(i).map(e=>`${e}.${i[e]}`).join("."),o=Object.keys(r).map(e=>`${e}.${r[e]}`).join("."),a=Object.keys(t).filter(e=>this.optionPropertyKeys.has(e)&&t[e]).join(".");return`${this.type}.${n}.${s}.${o}.${a}`}_generateShaders(e,t,i,r){const n=[];this._setDefines(i),this._setOptionalUniforms(n,t),this._setRequiredUniforms(n);const l=this._hydrateVertexInput(r),c=this._injectPackPrecisionFactor(l,e),u=this._hydrateComputeInput(),h=u&&this._injectComputePackPrecisionFactor(u,e),d=this.vertex(c,h),f=this._hydrateFragmentInput(d),p=this.fragment(f),m=new Set;for(const e in p){const t=p[e];a.setReachableUids(m,t)}const g=this._getVertexInputBuiltins(),_={};for(const[e,t]of Object.entries(l))_[e]=t;if(null!=u)for(const[e,t]of Object.entries(u))_[e]=t;const y=o.ShaderGraphContext.createVertex(_,d,g,n,this.transformFeedbackBindings,m);(new s.GlslShaderWriter).write(y);const x=this._getFragmentInputBuiltins(p);x.set("glPointCoord","gl_PointCoord");const b=o.ShaderGraphContext.createFragment(f,p,x,n,y,this.transformFeedbackBindings);(new s.GlslShaderWriter).write(b);const v=this._createShaderBuilder(y,b),S=v.generate("vertex"),w=v.generate("fragment");return this.logShader&&(console.log(S),console.log(w)),{vertex:S,fragment:w,uniformBindings:n}}_setDefines(e){for(const t in e)this[t]=e[t]}_setOptionalUniforms(e,t){for(const i of this._options)t[i.propertyKey]?this[i.propertyKey]=this._hydrateUniformGroup(e,i):this[i.propertyKey]=null}_setRequiredUniforms(e){for(const t of this._uniforms)this[t.propertyKey]=this._hydrateUniformGroup(e,t)}_hydrateUniformGroup(e,t){const i=new(0,t.typeCtor);for(const r of i._uniforms??[]){const n=u(r.typeCtor),s=`u_${t.propertyKey}_${r.propertyKey}`,o=n.type,a=[t.propertyKey,r.propertyKey].join(".");if("type"in r.typeCtor&&"array"===r.typeCtor.type){const t=n;e.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:t.size,uniformArrayElementType:t.elementType.type,uniformHydrated:n})}else if("type"in r.typeCtor&&"array-2d"===r.typeCtor.type){const t=n;e.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:t.size,uniformArrayElementType:t.elementType.type,uniformHydrated:n})}else e.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformHydrated:n});i[r.propertyKey]=n}return i}_hydrateVertexInput(e){const t=this.vertexInput.inputCtor,i=t.locations.reduce((t,i)=>!1===e[i.propertyKey]?t:{...t,[i.propertyKey]:u(i.typeCtor)},{});for(const{propertyKey:e,typeCtor:r}of t.builtins){const t=u(r);i[e]=t}return i}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((e,t)=>({...e,[t.propertyKey]:u(t.typeCtor)}),{})}_injectPackPrecisionFactor(e,t){const i={};for(const r in e){const s=e[r],o=t[r];if(o){if("float"!==s.type&&"vec2"!==s.type&&"vec3"!==s.type&&"vec4"!==s.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${s.type}`);i[r]=s.divide(new n.Float(o))}else i[r]=s}return i}_injectComputePackPrecisionFactor(e,t){const i={},r=new Map;for(const e in this.computeAttributes)for(const t of this.computeAttributes[e]??[])r.set(t,e);for(const s in e){const o=e[s],a=r.get(s);if(!a)continue;const l=t[a];if(l){if("float"!==o.type&&"vec2"!==o.type&&"vec3"!==o.type&&"vec4"!==o.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${o.type}`);i[s]=o.divide(new n.Float(l))}else i[s]=o}return i}_hydrateFragmentInput(e){const t={};for(const i in e)t[i]=e[i];for(const{propertyKey:e,typeCtor:i}of m.builtins){const r=u(i);t[e]=r}return t}_getVertexInputBuiltins(){const e=this.vertexInput.inputCtor,t=new Map;for(const{builtin:i,propertyKey:r}of e.builtins)t.set(r,i);return t}_getFragmentInputBuiltins(e){const t=e.constructor,i=new Map;for(const e of t.builtins??[])i.set(e.propertyKey,e.builtin);return i}_createShaderBuilder(e,t){const i=new c.ShaderBuilder;return this._insertDebugInfo(i),e.insertVertexShader(i),t.insertFragmentShader(i),i}_insertDebugInfo(e){e.vertex.code.add("// DEFINES: "),e.vertex.code.add("// --------------------------------------------------------- ");for(const t of this._defines)this[t.propertyKey]?e.vertex.code.add(`//   ${t.propertyKey}: true`):e.vertex.code.add(`//   ${t.propertyKey}: false`);e.vertex.code.add(""),e.vertex.code.add("// OPTIONS: "),e.vertex.code.add("// --------------------------------------------------------- ");for(const t of this._options)this[t.propertyKey]?e.vertex.code.add(`//   ${t.propertyKey}: true`):e.vertex.code.add(`//   ${t.propertyKey}: false`)}},e.UniformGroup=class{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}},e.VertexInput=p,e.builtin=d,e.define=(e,t)=>{h(e,"defines",{propertyKey:t})},e.input=e=>(t,i,r)=>{h(t,"inputs",{inputCtor:e,propertyKey:i,parameterIndex:r})},e.location=function(e,t){return(i,r)=>{h(i,"locations",{typeCtor:t,propertyKey:r,parameterIndex:null,index:e})}},e.option=e=>(t,i)=>{h(t,"options",{typeCtor:e,propertyKey:i})},e.transformFeedback=function(e){return(t,i)=>{h(t,"transformFeedbackBindings",{propertyKey:i,parameterIndex:null,index:e})}},e.uniform=e=>(t,i)=>{h(t,"uniforms",{typeCtor:e,propertyKey:i})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/glsl":function(){define(["exports","../../../../../../chunks/tslib.es6","./ShaderGraphNode"],function(e,t,i){"use strict";var r,n,s,o,a,l,c,u,h,d,f,p,m,g;function _(t){switch(t.type){case"uint":return I;case"uvec2":return e.Vec2;case"uvec3":return e.Vec3;case"uvec4":return e.Vec4;default:throw new Error("Found unexpected type")}}function y(t){switch(t.type){case"float":return e.UInt;case"vec2":return e.UVec2;case"vec3":return e.UVec3;case"vec4":return e.UVec4;default:throw new Error("Found unexpected type")}}function x(t){switch(t.type){case"int":return I;case"ivec2":return e.Vec2;case"ivec3":return e.Vec3;case"ivec4":return e.Vec4;default:throw new Error("Found unexpected type")}}function b(t){switch(t.type){case"float":return O;case"vec2":return e.IVec2;case"vec3":return e.IVec3;case"vec4":return e.IVec4;default:throw new Error("Found unexpected type")}}function v(t){switch(t.type){case"bool":case"float":case"int":case"uint":return C;case"bvec2":case"vec2":case"ivec2":case"uvec2":return e.BVec2;case"bvec3":case"vec3":case"ivec3":case"uvec3":return e.BVec3;case"bvec4":case"vec4":case"ivec4":case"uvec4":return e.BVec4;default:throw new Error("Unable to handle type")}}function S(e){return new Proxy(e,{get(t,i){if("constructor"===i)return new Proxy(t.constructor,{construct:(e,t,i)=>S(new e(...t))});if(i in t)return t[i];if("string"==typeof i){const t=function(e){const t=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const i of t)if(i.includes(e))return i.map(e=>R[e]);throw new Error("Unable to find type family")}(e.type);return D(e,i,t[i.length-1])}}})}function w(e){return new Proxy(e,{construct:(e,t,i)=>S(new e(...t))})}class T extends Error{}e.FixedArray=class extends i.ShaderPrimitiveNode{static{r=this}static{this.type="array"}constructor(e,t){super(),this.elementType=e,this.size=t,this.children=[],this.type="array"}clone(){const e=new r(this.elementType,this.size);return super.cloneInto(e),e}get(t,i){const r=new O(t),n=null!=i?new O(i):null;return null!=n?k(this,r,n,function(t){switch(t.type){case"bool":case"bvec2":case"bvec3":case"bvec4":return C;case"float":case"vec2":case"vec3":case"vec4":return I;case"int":case"ivec2":case"ivec3":case"ivec4":return O;case"uint":case"uvec2":case"uvec3":case"uvec4":return e.UInt;default:throw new Error("Unable to handle type")}}(this.elementType.constructor)):D(this,r,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(e,t,i){return W(this,e,t,i)}glslFindIndex(e,t,i){return j(this,e,t,i)}static ofType(e,t){const i={construct:(i,n)=>new r(new e,t)};return new Proxy(r,i)}},e.FixedArray=r=t.__decorate([function(e){return new Proxy(e,{construct:(e,t,i)=>{return r=new e(...t),new Proxy(r,{get(e,t){if(t in e)return e[t];if("string"==typeof t){const e=parseInt(t,10);if(!isNaN(e))return D(r,`[${e}]`,r.elementType.constructor)}}});var r}})}],e.FixedArray);class M extends i.ShaderPrimitiveNode{static{this.type="array-2d"}constructor(e,t,i,r=!1){super(),this.elementType=e,this.xSize=t,this.ySize=i,this.isRowMajor=r,this.children=[],this.type="array-2d"}clone(){const e=new M(this.elementType,this.xSize,this.ySize,this.isRowMajor);return super.cloneInto(e),e}get size(){return this.xSize*this.ySize}get(e,t){return this.isRowMajor?this._getRowMajor(e,t):this._getColumnMajor(e,t)}_getColumnMajor(e,t){const i=new O(e);return D(this,new O(t).add(i.multiply(this.xSize)),this.elementType.constructor)}_getRowMajor(e,t){const i=new O(e),r=new O(t);return D(this,i.add(r.multiply(this.ySize)),this.elementType.constructor)}static ofType(t,i,r,n=!1){const s={construct:(e,s)=>new M(new t,i,r,n)};return new Proxy(e.FixedArray,s)}}class P extends i.ShaderPrimitiveNode{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}static{this.type="sampler2D"}clone(){const e=new P;return e.children=this.children.map(i.cloneShaderNode),super.cloneInto(e),e}}class I extends i.ShaderPrimitiveNode{static{this.type="float"}constructor(e){super(),this.type="float",this.children=[e]}clone(){const e=new I(i.cloneShaderNode(this.children[0]));return super.cloneInto(e),e}multiply(e){return Y(this,"number"==typeof e?F(e,I):e)}divide(e){return X(this,"number"==typeof e?F(e,I):e)}add(e){return $(this,"number"==typeof e?F(e,I):e)}subtract(e){return Z(this,"number"==typeof e?F(e,I):e)}}e.Vec2=class extends i.ShaderPrimitiveNode{static{n=this}static{this.type="vec2"}constructor(e,t){super(),this.type="vec2",this.children=[e,t].filter(e=>null!=e)}clone(){const e=new n(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]));return super.cloneInto(e),e}get 0(){return D(this,"[0]",I)}get 1(){return D(this,"[1]",I)}get 2(){throw new T}get 3(){throw new T}multiply(e){return Y(this,"number"==typeof e?F(e,I):e)}divide(e){return X(this,"number"==typeof e?F(e,I):e)}add(e){return $(this,"number"==typeof e?F(e,I):e)}subtract(e){return Z(this,"number"==typeof e?F(e,I):e)}},e.Vec2=n=t.__decorate([w],e.Vec2),e.Vec3=class extends i.ShaderPrimitiveNode{static{s=this}static{this.type="vec3"}constructor(e,t,i){super(),this.type="vec3",this.children=[e,t,i].filter(e=>null!=e)}get 0(){return D(this,"[0]",I)}get 1(){return D(this,"[1]",I)}get 2(){return D(this,"[2]",I)}get 3(){throw new T}clone(){const e=new s(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]));return super.cloneInto(e),e}multiply(e){return Y(this,"number"==typeof e?F(e,I):e)}divide(e){return X(this,"number"==typeof e?F(e,I):e)}add(e){return $(this,"number"==typeof e?F(e,I):e)}subtract(e){return Z(this,"number"==typeof e?F(e,I):e)}},e.Vec3=s=t.__decorate([w],e.Vec3),e.Vec4=class extends i.ShaderPrimitiveNode{static{o=this}static{this.type="vec4"}constructor(e,t,i,r){super(),this.type="vec4",this.children=[e,t,i,r].filter(e=>null!=e)}clone(){const e=new o(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]),i.cloneShaderNode(this.children[3]));return super.cloneInto(e),e}get 0(){return D(this,"[0]",I)}get 1(){return D(this,"[1]",I)}get 2(){return D(this,"[2]",I)}get 3(){return D(this,"[3]",I)}multiply(e){return Y(this,"number"==typeof e?F(e,I):e)}divide(e){return X(this,"number"==typeof e?F(e,I):e)}add(e){return $(this,"number"==typeof e?F(e,I):e)}subtract(e){return Z(this,"number"==typeof e?F(e,I):e)}},e.Vec4=o=t.__decorate([w],e.Vec4),e.UInt=class extends i.ShaderPrimitiveNode{static{a=this}static{this.type="uint"}constructor(e){super(),this.type="uint",this.children=[e]}clone(){const e=new a(i.cloneShaderNode(this.children[0]));return super.cloneInto(e),e}multiply(e){return Y(this,F(e,a))}add(e){return $(this,F(e,a))}subtract(e){return Z(this,F(e,a))}divide(e){return X(this,F(e,a))}},e.UInt=a=t.__decorate([w],e.UInt),e.UVec2=class extends i.ShaderPrimitiveNode{static{l=this}static{this.type="uvec2"}constructor(e,t){super(),this.type="uvec2",this.children=[e,t].filter(e=>null!=e)}clone(){const e=new l(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]));return super.cloneInto(e),e}get 0(){return D(this,"[0]",O)}get 1(){return D(this,"[1]",O)}get 2(){throw new T}get 3(){throw new T}multiply(t){return Y(this,"number"==typeof t?F(t,e.UInt):t)}divide(t){return X(this,"number"==typeof t?F(t,e.UInt):t)}add(t){return $(this,"number"==typeof t?F(t,e.UInt):t)}subtract(t){return Z(this,"number"==typeof t?F(t,e.UInt):t)}},e.UVec2=l=t.__decorate([w],e.UVec2),e.UVec3=class extends i.ShaderPrimitiveNode{static{c=this}static{this.type="uvec3"}constructor(e,t,i){super(),this.type="uvec3",this.children=[e,t,i].filter(e=>null!=e)}clone(){const e=new c(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]));return super.cloneInto(e),e}get 0(){return D(this,"[0]",e.UInt)}get 1(){return D(this,"[1]",e.UInt)}get 2(){return D(this,"[2]",e.UInt)}get 3(){throw new T}multiply(t){return Y(this,"number"==typeof t?F(t,e.UInt):t)}divide(t){return X(this,"number"==typeof t?F(t,e.UInt):t)}add(t){return $(this,"number"==typeof t?F(t,e.UInt):t)}subtract(t){return Z(this,"number"==typeof t?F(t,e.UInt):t)}},e.UVec3=c=t.__decorate([w],e.UVec3),e.UVec4=class extends i.ShaderPrimitiveNode{static{u=this}static{this.type="uvec4"}constructor(e,t,i,r){super(),this.type="uvec4",this.children=[e,t,i,r].filter(e=>null!=e)}clone(){const e=new u(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]),i.cloneShaderNode(this.children[3]));return super.cloneInto(e),e}get 0(){return D(this,"[0]",e.UInt)}get 1(){return D(this,"[1]",e.UInt)}get 2(){return D(this,"[2]",e.UInt)}get 3(){return D(this,"[3]",e.UInt)}multiply(t){return Y(this,"number"==typeof t?F(t,e.UInt):t)}divide(t){return X(this,"number"==typeof t?F(t,e.UInt):t)}add(t){return $(this,"number"==typeof t?F(t,e.UInt):t)}subtract(t){return Z(this,"number"==typeof t?F(t,e.UInt):t)}},e.UVec4=u=t.__decorate([w],e.UVec4);class C extends i.ShaderPrimitiveNode{static{this.type="bool"}constructor(e){super(),this.type="bool",this.children=[e]}and(e){return te(this,e)}or(e){return K(this,e)}xor(e){return Q(this,e)}clone(){const e=new C(i.cloneShaderNode(this.children[0]));return super.cloneInto(e),e}}function F(e,t){return"number"==typeof e?new t(e):e}e.BVec2=class extends i.ShaderPrimitiveNode{static{h=this}static{this.type="bvec2"}constructor(e,t){super(),this.type="bvec2",this.children=[e,t].filter(e=>null!=e)}all(){return ie(this)}any(){return re(this)}clone(){const e=new h(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]));return super.cloneInto(e),e}},e.BVec2=h=t.__decorate([w],e.BVec2),e.BVec3=class extends i.ShaderPrimitiveNode{static{d=this}static{this.type="bvec3"}constructor(e,t,i){super(),this.type="bvec3",this.children=[e,t,i].filter(e=>null!=e)}all(){return ie(this)}any(){return re(this)}clone(){const e=new d(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]));return super.cloneInto(e),e}},e.BVec3=d=t.__decorate([w],e.BVec3),e.BVec4=class extends i.ShaderPrimitiveNode{static{f=this}static{this.type="bvec4"}constructor(e,t,i,r){super(),this.type="bvec4",this.children=[e,t,i,r].filter(e=>null!=e)}all(){return ie(this)}any(){return re(this)}clone(){const e=new f(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]),i.cloneShaderNode(this.children[3]));return super.cloneInto(e),e}},e.BVec4=f=t.__decorate([w],e.BVec4);class O extends i.ShaderPrimitiveNode{static{this.type="int"}constructor(e){super(),this.type="int",this.children=[e]}multiply(e){return Y(this,F(e,O))}add(e){return $(this,F(e,O))}subtract(e){return Z(this,F(e,O))}divide(e){return X(this,F(e,O))}clone(){const e=new O(i.cloneShaderNode(this.children[0]));return super.cloneInto(e),e}}e.IVec2=class extends i.ShaderPrimitiveNode{static{p=this}static{this.type="ivec2"}constructor(e,t){super(),this.type="ivec2",this.children=[e,t].filter(e=>null!=e)}clone(){const e=new p(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]));return super.cloneInto(e),e}get 0(){return D(this,"[0]",O)}get 1(){return D(this,"[1]",O)}get 2(){throw new T}get 3(){throw new T}multiply(e){return Y(this,"number"==typeof e?F(e,O):e)}divide(e){return X(this,"number"==typeof e?F(e,O):e)}add(e){return $(this,"number"==typeof e?F(e,O):e)}subtract(e){return Z(this,"number"==typeof e?F(e,O):e)}},e.IVec2=p=t.__decorate([w],e.IVec2),e.IVec3=class extends i.ShaderPrimitiveNode{static{m=this}static{this.type="ivec3"}constructor(e,t,i){super(),this.type="ivec3",this.children=[e,t,i].filter(e=>null!=e)}clone(){const e=new m(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]));return super.cloneInto(e),e}get 0(){return D(this,"[0]",O)}get 1(){return D(this,"[1]",O)}get 2(){return D(this,"[2]",O)}get 3(){throw new T}multiply(e){return Y(this,"number"==typeof e?F(e,O):e)}divide(e){return X(this,"number"==typeof e?F(e,O):e)}add(e){return $(this,"number"==typeof e?F(e,O):e)}subtract(e){return Z(this,"number"==typeof e?F(e,O):e)}},e.IVec3=m=t.__decorate([w],e.IVec3),e.IVec4=class extends i.ShaderPrimitiveNode{static{g=this}static{this.type="ivec4"}constructor(e,t,i,r){super(),this.type="ivec4",this.children=[e,t,i,r].filter(e=>null!=e)}clone(){const e=new g(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]),i.cloneShaderNode(this.children[3]));return super.cloneInto(e),e}get 0(){return D(this,"[0]",O)}get 1(){return D(this,"[1]",O)}get 2(){return D(this,"[2]",O)}get 3(){return D(this,"[3]",O)}multiply(e){return Y(this,"number"==typeof e?F(e,O):e)}divide(e){return X(this,"number"==typeof e?F(e,O):e)}add(e){return $(this,"number"==typeof e?F(e,O):e)}subtract(e){return Z(this,"number"==typeof e?F(e,O):e)}},e.IVec4=g=t.__decorate([w],e.IVec4);class A extends i.ShaderPrimitiveNode{static{this.type="mat2"}constructor(e,t,i,r){super(),this.type="mat2",this.children=[e,t,i,r]}clone(){const e=new A(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]),i.cloneShaderNode(this.children[3]));return super.cloneInto(e),e}get(e,t){return k(this,new O(e),new O(t),I)}multiply(e){return Y(this,e)}}class E extends i.ShaderPrimitiveNode{static{this.type="mat3"}static identity(){return new E(1,0,0,0,1,0,0,0,1)}static fromRotation(e){const t=se(e),i=ne(e);return new E(i,t,0,U(t),i,0,0,0,1)}constructor(e,t,i,r,n,s,o,a,l){super(),this.type="mat3",this.children=[e,t,i,r,n,s,o,a,l]}add(e){return $(this,e)}multiply(e){return Y(this,e)}get(e,t){return k(this,new O(e),new O(t),I)}clone(){const e=new E(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]),i.cloneShaderNode(this.children[3]),i.cloneShaderNode(this.children[4]),i.cloneShaderNode(this.children[5]),i.cloneShaderNode(this.children[6]),i.cloneShaderNode(this.children[7]),i.cloneShaderNode(this.children[8]));return super.cloneInto(e),e}}class z extends i.ShaderPrimitiveNode{static{this.type="mat4"}static identity(){return new z(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m){super(),this.type="mat4",this.children=[e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m]}static fromColumns(e,t,i,r){return new z(e.x,e.y,e.z,e.w,t.x,t.y,t.z,t.w,i.x,i.y,i.z,i.w,r.x,r.y,r.z,r.w)}multiply(e){return Y(this,e)}get(e,t){return k(this,new O(e),new O(t),I)}clone(){const e=new z(i.cloneShaderNode(this.children[0]),i.cloneShaderNode(this.children[1]),i.cloneShaderNode(this.children[2]),i.cloneShaderNode(this.children[3]),i.cloneShaderNode(this.children[4]),i.cloneShaderNode(this.children[5]),i.cloneShaderNode(this.children[6]),i.cloneShaderNode(this.children[7]),i.cloneShaderNode(this.children[8]),i.cloneShaderNode(this.children[9]),i.cloneShaderNode(this.children[10]),i.cloneShaderNode(this.children[11]),i.cloneShaderNode(this.children[12]),i.cloneShaderNode(this.children[13]),i.cloneShaderNode(this.children[14]),i.cloneShaderNode(this.children[15]));return super.cloneInto(e),e}}const R={float:I,vec2:e.Vec2,vec3:e.Vec3,vec4:e.Vec4,int:O,ivec2:e.IVec2,ivec3:e.IVec3,ivec4:e.IVec4,uint:e.UInt,uvec2:e.UVec2,uvec3:e.UVec3,uvec4:e.UVec4,bool:C,bvec2:e.BVec2,bvec3:e.BVec3,bvec4:e.BVec4},V=(...e)=>new I(...e);function D(e,t,r){const n=new r(new i.ShaderPropertyAccessNode(t,e,r));return n.isImplicit=!0,n}function k(e,t,r,n){const s=new n(new i.ShaderPropertyAccess2DNode(t,r,e,n));return s.isImplicit=!0,s}function L(e,t,r,n=null){if(n){const s=new n,o=new n(new i.ShaderFunctionNode(e,[t,r],!0,!1,s));return o.isImplicit=!0,o}if("float"===t.type||"int"===t.type){const n=new r.constructor(new i.ShaderFunctionNode(e,[t,r],!0,!1,r.constructor));return n.isImplicit=!0,n}if(("mat2"===t.type||"mat3"===t.type||"mat4"===t.type)&&"float"!==r.type){const n=new r.constructor(new i.ShaderFunctionNode(e,[t,r],!0,!1,r.constructor));return n.isImplicit=!0,n}const s=new t.constructor(new i.ShaderFunctionNode(e,[t,r],!0,!1,t.constructor));return s.isImplicit=!0,s}function B(e,t,r=t.constructor){const n=new r(new i.ShaderFunctionNode(e,[t],!1,!1,r));return n.isImplicit=!0,n}function N(e,t,r,n=t.constructor){const s=new n(new i.ShaderFunctionNode(e,[t,r],!1,!1,n));return s.isImplicit=!0,s}function G(e,t,r,n,s=t.constructor){const o=new s(new i.ShaderFunctionNode(e,[t,r,n],!1,!1,s));return o.isImplicit=!0,o}function U(e){return Y(e,V(-1))}function q(e,t,r,n){return new t(new i.ShaderBlockNode(e,t,r,n))}function W(e,t,i=0,r=e.size){const n=new O(i).setMutable().setDebugName("FindIndexIterator"),s=t(e.get(n)).setDebugName("FindIndexPredicate"),o=q({iter:n},O,s,({out:e,iter:t,subgraph:i})=>`\n${e} = -1;\n\nfor (; ${t} < ${r}; ${t}++) {\n\n${i.body}\n\n  if (${i.varName}) {\n    ${e} = ${t};\n    break;\n  }\n\n}\n`).setDebugName("FindIndexBlock");return o}function j(e,t,i=0,r=e.size){const n=q({array:e},O,null,({out:e,array:n})=>`\n${e} = -1;\nfor (int i = ${i}; i < ${r}; i++) {\n  bool condition;\n  ${t({array:n,i:"i",out:"condition"})}\n  if (condition) {\n    ${e} = i;\n    break;\n  }\n}\n`).setDebugName("GlslFindIndexBlock");return n}function H(e,t,r){const n="function"==typeof t?t():t,s="function"==typeof r?r():r,o=new n.constructor(new i.ShaderConditionNode(e,n,s));return o.isImplicit=!0,o}function Y(e,t){return L("*",e,t)}function X(e,t){return L("/",e,t)}function $(e,t){return L("+",e,t)}function Z(e,t){return L("-",e,t)}function K(...e){return e.length<=1?e[0]:e.slice(1).reduce((e,t)=>J(e,t),e[0])}function J(e,t){return L("||",e,t,C)}function Q(...e){return e.length<=1?e[0]:e.slice(1).reduce((e,t)=>ee(e,t),e[0])}function ee(e,t){return L("^^",e,t,C)}function te(...e){return e.length<=1?e[0]:e.slice(1).reduce((e,t)=>L("&&",e,t,C),e[0])}function ie(e){return B("all",e,C)}function re(e){return B("any",e,C)}function ne(e){return B("cos",e)}function se(e){return B("sin",e)}e.Bool=C,e.FixedArray2D=M,e.Float=I,e.Int=O,e.Mat2=A,e.Mat3=E,e.Mat4=z,e.Sampler2D=P,e._or=J,e._xor=ee,e.abs=function(e){return B("abs",e)},e.acos=function(e){return B("acos",e)},e.acosh=function(e){return B("acosh",e)},e.add=$,e.all=ie,e.and=te,e.any=re,e.asin=function(e){return B("asin",e)},e.asinh=function(e){return B("asinh",e)},e.atan=function(e,t){return null==t?B("atan",e):N("atan",e,t,e.constructor)},e.atanh=function(e){return B("atanh",e)},e.bitAnd=function(e,t){return L("&",e,t)},e.bitNot=function(e){return B("~",e)},e.bitOr=function(e,t){return L("|",e,t)},e.bitRShift=function(e,t){return L(">>",e,t)},e.bitShift=function(e,t){return L("<<",e,t)},e.bitXor=function(e,t){return L("^",e,t)},e.block=q,e.ceil=function(e){return B("ceil",e)},e.clamp=function(e,t,i){return G("clamp",e,t,i,e.constructor)},e.cond=function(...e){const t=e.map(([e,t])=>"function"==typeof t?[e,t()]:[e,t]),i=t[0][1].constructor,r=t.findIndex(e=>!0===e[0]);if(-1===r)throw new Error("A cond must have a fallthrough case with `true`/; ");const n=t.slice(0,r),s=t[r][1],o=new i(n.reduceRight((e,t)=>H(t[0],t[1],e),s));return o.isImplicit=!0,o},e.cos=ne,e.cosh=function(e){return B("cosh",e)},e.cross=function(e,t){return N("cross",e,t,e.constructor)},e.dFdx=function(e){return B("dFdX",e)},e.dFdy=function(e){return B("dFdY",e)},e.definePropertyAccess=D,e.definePropertyAccess2D=k,e.degrees=function(e){return B("degrees",e)},e.determinant=function(e){return B("determinant",e,I)},e.distance=function(e,t){return N("distance",e,t,I)},e.divide=X,e.dot=function(e,t){return N("dot",e,t,I)},e.equal=function(e,t){return L("==",e,t,C)},e.equalComponent=function(e,t){return N("equal",e,t,v(e))},e.exp=function(e){return B("exp",e)},e.exp2=function(e){return B("exp2",e)},e.faceforward=function(e,t,i){return G("faceforward",e,t,i)},e.findIndex=W,e.float=V,e.floatBitsToInt=function(e){return B("floatBitsToInt",e,b(e))},e.floatBitsToUint=function(e){return B("floatBitsToUint",e,y(e))},e.floor=function(e){return B("floor",e)},e.fract=function(e){return B("fract",e)},e.fwidth=function(e){return B("fwidth",e)},e.getTypeElementLengthForType=function e(t){switch(t.type){case"float":case"int":case"uint":case"bool":case"sampler2D":return 1;case"vec2":case"ivec2":case"uvec2":case"bvec2":return 2;case"vec3":case"ivec3":case"uvec3":case"bvec3":return 3;case"vec4":case"ivec4":case"uvec4":case"bvec4":case"mat2":return 4;case"mat3":return 9;case"mat4":return 16;case"array":case"array-2d":return t.size*e(t.elementType)}},e.glslFindIndex=j,e.greaterThan=function(e,t){return L(">",e,t,C)},e.greaterThanComponent=function(e,t){return N("greaterThan",e,t,v(e))},e.greaterThanEqual=function(e,t){return L(">=",e,t,C)},e.greaterThanEqualComponent=function(e,t){return N("greaterThanEqual",e,t,v(e))},e.ifElse=H,e.int=(...e)=>new O(...e),e.intBitsToFloat=function(e){return B("intBitsToFloat",e,x(e))},e.intMod=function(e,t){return L("%",e,t)},e.inverse=function(e){return B("inverse",e,I)},e.inversesqrt=function(e){return B("inversesqrt",e)},e.isinf=function(e){return B("isinf",e,v(e))},e.isnan=function(e){return B("isnan",e,v(e))},e.length=function(e){return B("length",e,I)},e.lessThan=function(e,t){return L("<",e,t,C)},e.lessThanComponent=function(e,t){return N("lessThan",e,t,v(e))},e.lessThanEqual=function(e,t){return L("<=",e,t,C)},e.lessThanEqualComponent=function(e,t){return N("lessThanEqual",e,t,v(e))},e.log=function(e){return B("log",e)},e.log2=function(e){return B("log2",e)},e.mat2=(...e)=>new A(...e),e.mat3=(...e)=>new E(...e),e.mat4=(...e)=>new z(...e),e.matrixCompMult=function(e,t){return N("matrixCompMult",e,t)},e.max=function(e,t){return N("max",e,t)},e.min=function(e,t){return N("min",e,t)},e.mix=function(e,t,i){return G("mix",e,t,i)},e.mod=function(e,t){return N("mod",e,t)},e.modf=function(e,t){throw new Error("modf not implemented")},e.multiply=Y,e.namedScope=function(e,t){const r="function"==typeof e?e():e,n=new r.constructor(new i.ShaderScopeNode(r).setDebugName(t));return n.isImplicit=!0,n},e.negate=U,e.normalize=function(e){return B("normalize",e)},e.not=function(e){return"bool"===e.type?B("!",e):B("not",e)},e.notEqual=function(e,t){return L("!=",e,t,C)},e.notEqualComponent=function(e,t){return N("notEqual",e,t,v(e))},e.or=K,e.outerProduct=function(e,t){throw new Error("Impl type?")},e.packHalf2x16=function(t){return B("packHalf2x16",t,e.UInt)},e.packSnorm2x16=function(t){return B("packSnorm2x16",t,e.UInt)},e.packUnorm2x16=function(t){return B("packUnorm2x16",t,e.UInt)},e.pow=function(e,t){return N("pow",e,t)},e.radians=function(e){return B("radians",e)},e.reduce2D=function(e,t){const{initialValue:i,xRange:r,yRange:n,callback:s}=t,[o,a]=r,[l,c]=n,u=new O(0).setMutable().setDebugName("iterX"),h=new O(0).setMutable().setDebugName("iterY"),d=i.setMutable().setDebugName("accumulator"),f=s(d,e.get(u,h),u,h).setDebugName("callback");return q({iterX:u,iterY:h,accumulator:d},i.constructor,f,({out:e,iterX:t,iterY:i,accumulator:r,subgraph:n})=>`\nfor (${i} = ${l}; ${i} < ${c}; ${i}++) {\n  for (${t} = ${o}; ${t} < ${a}; ${t}++) {\n\n  ${n.body}\n\n  ${r} = ${n.varName};\n  }\n}\n${e} = ${r};\n`).setDebugName("reduce2DBody")},e.reflect=function(e,t){return N("reflect",e,t)},e.refract=function(e,t,i){return G("refract",e,t,i)},e.round=function(e){return B("round",e)},e.roundEven=function(e){return B("roundEven",e)},e.sign=function(e){return B("sign",e)},e.sin=se,e.sinh=function(e){return B("sinh",e)},e.smoothstep=function(e,t,i){return G("smoothstep",e,t,i)},e.sqrt=function(e){return B("sqrt",e)},e.step=function(e,t){return N("step",e,t,t.constructor)},e.subtract=Z,e.tan=function(e){return B("tan",e)},e.tanh=function(e){return B("tanh",e)},e.texelFetch=function(t,i,r){return G("texelFetch",t,i,r,e.Vec4)},e.texelFetchOffset=function(e,t,i,r){throw new Error("Impl type")},e.texture=function(e,t,i){throw new Error("Impl type")},e.texture2D=function(t,i){return N("texture",t,i,e.Vec4)},e.textureGrad=function(e,t,i,r){throw new Error("Impl type")},e.textureGradOffset=function(e,t,i,r,n){throw new Error("Impl type")},e.textureLod=function(e,t,i){throw new Error("Impl type")},e.textureLodOffset=function(e,t,i,r){throw new Error("Impl type")},e.textureOffset=function(e,t,i,r){throw new Error("Impl type")},e.textureProj=function(e,t,i){throw new Error("Impl type")},e.textureProjGrad=function(e,t,i,r){throw new Error("Impl type")},e.textureProjGradOffset=function(e,t,i,r,n){throw new Error("Impl type")},e.textureProjLod=function(e,t,i){throw new Error("Impl type")},e.textureProjLodOffset=function(e,t,i,r){throw new Error("Impl type")},e.textureProjOffset=function(e,t,i,r){throw new Error("Impl type")},e.textureSize=function(e,t){throw new Error("Impl type")},e.transformFloatToInt=b,e.transformFloatToUInt=y,e.transformIntToFloat=x,e.transformTypeToBooleanType=v,e.transformUIntToFloat=_,e.transpose=function(e){return B("transpose",e)},e.trunc=function(e){return B("trunc",e)},e.uintBitsToFloat=function(e){return B("uintBitsToFloat",e,_(e))},e.unpackHalf2x16=function(t){return B("unpackHalf2x16",t,e.Vec2)},e.unpackSnorm2x16=function(t){return B("unpackSnorm2x16",t,e.Vec2)},e.unpackUnorm2x16=function(t){return B("unpackUnorm2x16",t,e.Vec2)},e.vec2=(...t)=>new e.Vec2(...t),e.vec3=(...t)=>new e.Vec3(...t),e.vec4=(...t)=>new e.Vec4(...t),e.when=function(e,t){const r=new t.constructor(new i.ShaderConditionNode(e,t,null));return r.isImplicit=!0,r},e.xor=Q,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphNode":function(){define(["exports"],function(e){"use strict";class t{constructor(){this.uid=t.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}static{this.NodeCount=0}get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(e){return e=e.split(" ").map((e,t)=>t>0?e.charAt(0).toUpperCase()+e.slice(1):e).join(""),this._debugName=e,this.isImplicit&&this.children[0]instanceof t&&this.children[0].setDebugName(e),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(e){e._debugName=this._debugName,e._isMutable=this._isMutable,e.isImplicit=this.isImplicit,e.uid=this.uid}}function i(e){return"object"==typeof e?e.clone():e}class r extends t{constructor(e){super(),this.child=e,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const e=new r(i(this.child));return this.cloneInto(e),e}}class n extends t{constructor(e){super(),this.text=e,this.shaderType="text-node"}get children(){return[]}clone(){const e=new n(this.text);return this.cloneInto(e),e}}class s extends t{constructor(e,t,i){super(),this.property=e,this.target=t,this.returnType=i,this.shaderType="property-access-node"}get children(){const e=[this.target];return"string"!=typeof this.property&&e.push(this.property),e}clone(){const e=new s(this.property,i(this.target),this.returnType);return this.cloneInto(e),e}}class o extends t{constructor(e,t,i,r){super(),this.x=e,this.y=t,this.target=i,this.returnType=r,this.shaderType="property-access-2d-node"}get children(){return[this.target,this.x,this.y]}clone(){const e=new o(this.x,this.y,i(this.target),this.returnType);return this.cloneInto(e),e}}class a extends t{constructor(e,t,i){super(),this.condition=e,this.ifTrue=t,this.ifFalse=i,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const e=i(this.ifTrue),t=this.ifFalse?i(this.ifFalse):null,r=new a(this.condition,e,t);return this.cloneInto(r),r}}class l extends t{constructor(e,t,i,n){super(),this.captureList=e,this.returnType=t,this.generator=n,this.shaderType="block-node",i&&(this.subgraph=new r(i))}get children(){return Object.keys(this.captureList).map(e=>this.captureList[e]).concat(this.subgraph??[])}clone(){const e={};for(const t in this.captureList)e[t]=i(this.captureList[t]);const t=new l(e,this.returnType,this.subgraph?i(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(t),t}}class c extends t{constructor(e,t,i,r,n,s=!1){super(),this.token=e,this._children=t,this.isInfix=i,this.isPropertyAccess=r,this.returnType=n,this.isTernary=s,this.shaderType="function-node"}get children(){return this._children}clone(){const e=new c(this.token,this._children.map(i),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(e),e}}e.ShaderBlockNode=l,e.ShaderConditionNode=a,e.ShaderFunctionNode=c,e.ShaderNode=t,e.ShaderPrimitiveNode=class extends t{constructor(){super(...arguments),this.shaderType="primitive-node"}},e.ShaderPropertyAccess2DNode=o,e.ShaderPropertyAccessNode=s,e.ShaderScopeNode=r,e.ShaderTextNode=n,e.cloneShaderNode=i,e.setReachableUids=function(e,t){const i=[];for(i.push(t);i.length;){const t=i.pop();if("object"==typeof t&&!e.has(t.uid)){e.add(t.uid);for(const e of t.children)i.push(e)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/GlslGraphWriter":function(){define(["exports"],function(e){"use strict";function t(e,t,i){const r=t.split("\n");for(const t of r)if(t.trim().length){{let t="";null!=i&&(t+=`/*id:${i??"000"}*/   `),e.body+=t.padEnd(14)}e.body+=" ".repeat(e.indent)+t+"\n"}}e.GlslShaderWriter=class{write(e){for(const t of e.rootOutputNodes())e.shouldPruneOutputNode(t)||(t.variableName=this._write(e,t.node));return e}_createVarName(e,t){let i="";return"boolean"!=typeof t&&"number"!=typeof t&&t.debugInfo.name&&(i=`${t.debugInfo.name}_`),`${i}v${e.varCount++}`}_write(e,t,i=!1){if("number"==typeof t)return t.toString();if("boolean"==typeof t)return t.toString();let r=e.getEmit(t);if(r)return r;switch(t.shaderType){case"scope-node":r=this._writeScopeNode(e,t);break;case"primitive-node":r=this._writePrimitiveNode(e,t,i);break;case"function-node":r=this._writeFunctionNode(e,t);break;case"property-access-node":r=this._writePropertyAccessNode(e,t);break;case"property-access-2d-node":r=this._writePropertyAccess2DNode(e,t);break;case"text-node":r=t.text;break;case"block-node":r=this._writeBlockNode(e,t);break;case"condition-node":r=this._writeConditionNode(e,t)}return e.setEmit(t,r),r}_writeScopeNode(e,i){const r=new i.child.constructor;r.setDebugName(i.debugInfo.name);const n=this._write(e,r,!0);return t(e,`{ /*ScopeStart: ${i.uid} ${i.debugInfo.name}*/`),e.indent+=2,t(e,`${n} = ${this._write(e,i.child)};`),e.indent-=2,t(e,`} /*ScopeEnd: ${i.uid} ${i.debugInfo.name}*/`),n}_writeConditionNode(e,i){const r=new i.ifTrue.constructor,n=this._write(e,r,!0);t(e,`if (${this._write(e,i.condition)}) {`),e.indent+=2;const s=e.createSubgraphContext(),o=this._write(s,i.ifTrue);if(e.body+=s.body,o&&t(e,`${n} = ${o};`),e.indent-=2,t(e,"}"),i.ifFalse){t(e,"else {"),e.indent+=2;const r=e.createSubgraphContext(),s=this._write(r,i.ifFalse);e.body+=r.body,s&&t(e,`${n} = ${s};`),e.indent-=2,t(e,"}")}return n}_writeBlockNode(e,i){const{captureList:r,generator:n,returnType:s}=i,o={};for(const t in r){if(!r[t])continue;const i=this._write(e,r[t]);o[t]=i}const a=new s,l=this._write(e,a,!0);if(o.out=l,i.subgraph){const t=e.createSubgraphContext(),r=this._write(t,i.subgraph.child),n=t.body;o.subgraph={varName:r,body:n}}const c=n(o);return t(e,"{\n"),e.indent+=2,t(e,c),e.indent-=2,t(e,"}\n"),l}_writePropertyAccessNode(e,t){const i=this._write(e,t.target);return"string"==typeof t.property&&t.property.includes("[")?`${i}${t.property}`:"string"!=typeof t.property?`${i}[${this._write(e,t.property)}]`:`${i}.${t.property}`}_writePropertyAccess2DNode(e,t){return`${this._write(e,t.target)}[${this._write(e,t.x)}][${this._write(e,t.y)}]`}_writeFunctionNode(e,i){const r=i.returnType.type;if(i.isInfix){const[n,s]=i.children.map(t=>this._write(e,t)),o=this._createVarName(e,i);return t(e,`${r.padEnd(5)} ${o} = ${n} ${i.token} ${s};`,i.uid),o}const n=i.children.map(t=>this._write(e,t)).join(", "),s=this._createVarName(e,i);return t(e,`${r.padEnd(5)} ${s} = ${i.token}(${n});`,i.uid),s}_writePrimitiveNode(e,i,r=!1){const n=e.getInput(i);if(n)return n.isUsed=!0,n.variableName;const s=1===i.children.length&&i.children[0]?.type===i.type;if(!i.isMutable&&(i.isImplicit||s))return this._write(e,i.children[0]);const o=this._createVarName(e,i);if(r)return t(e,`${i.type.padEnd(5)} ${o};`,i.uid),o;const a=!i.debugInfo.name&&!i.isMutable;if(a&&"float"===i.type&&"number"==typeof i.children[0])return Number.isInteger(i.children[0])?i.children[0].toFixed(1):i.children[0].toString();if(a&&"int"===i.type&&"number"==typeof i.children[0]&&Number.isInteger(i.children[0]))return i.children[0].toString();const l=i.children.map(t=>this._write(e,t)).join(", ");return"array"===i.type?(t(e,`${i.type.padEnd(5)} ${o} = [${l}];`,i.uid),o):a?`${i.type}(${l})`:(t(e,`${i.type.padEnd(5)} ${o} = ${i.type}(${l});`,i.uid),o)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/graph/ShaderGraphContext":function(){define(["exports","./ShaderGraphNode"],function(e,t){"use strict";class i{constructor(e,t,i,r=[]){this.variableName=e,this.variableInputType=t,this.node=i,this.qualifiers=r,this.type="shader-input",this.isUsed=!1}clone(){return new i(this.variableName,this.variableInputType,t.cloneShaderNode(this.node),[...this.qualifiers])}}class r{constructor(e,t,i,r=[]){this.outVariableName=e,this.outVariableType=t,this.node=i,this.qualifiers=r,this.type="shader-output"}clone(){const e=new r(this.outVariableName,this.outVariableType,t.cloneShaderNode(this.node),[...this.qualifiers]);return e.variableName=this.variableName,e}}class n{static createVertex(e,t,o,a,l,c){const u=[];for(const t in e){const r=e[t],n=o.get(t);n?u.push(new i(n,"builtin",r)):u.push(new i("a_"+t,"in",r))}for(const e of a){const t=e.uniformHydrated;u.push(new i(e.uniformName,"uniform",t))}const h=[];for(const e in t){const i=t[e];if("glPosition"===e)h.push(new r("gl_Position","builtin",i));else if("glPointSize"===e)h.push(new r("gl_PointSize","builtin",i));else{const t=s(i),n=[];t&&n.push(t),h.push(new r("v_"+e,"out",i,n))}}return new n(u,h,l,c)}static createFragment(e,t,s,o,a,l){const c=[],u=Array.from(a.rootOutputNodes());for(const t in e){const r=e[t],n=s.get(t);if(n){c.push(new i(n,"builtin",r));continue}const o=u.find(e=>e.node===r);o&&c.push(new i(o.outVariableName,"in",r))}for(const e of o){const t=e.uniformHydrated;c.push(new i(e.uniformName,"uniform",t))}const h=[];for(const e in t){const i=t[e],n=s.get(e);switch(e){case"discard":h.push(new r(null,"discard",i));break;case"fragData0":h.push(new r("fragData0","fragData0",i));break;case"fragData1":h.push(new r("fragData1","fragData1",i));break;case"fragData2":h.push(new r("fragData2","fragData2",i));break;case"fragData3":h.push(new r("fragData3","fragData3",i));break;default:n?h.push(new r(n,"builtin",i)):h.push(new r(e,"out",i))}}return new n(c,h,l)}constructor(e,t,i,r){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const t of e)this._inputShaderTypesByNodeUid.set(t.node.uid,t);this._outputShaderTypes=t,this._transformFeedbackBindings=i,this._transformFeedbackNames=new Set(i.map(e=>"v_"+e.propertyKey)),this._usedInFragmentShader=r}shouldPruneOutputNode(e){return!!this._usedInFragmentShader&&"builtin"!==e.outVariableType&&!this._transformFeedbackNames.has(e.outVariableName)&&!this._usedInFragmentShader.has(e.node.uid)}setEmit(e,t){this._nodeEmitMap.set(e.uid,t)}getEmit(e){return this._nodeEmitMap.get(e.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(e){return this._inputShaderTypesByNodeUid.get(e.uid)}*rootOutputNodes(){for(const e of this._outputShaderTypes)yield e}*nodes(){const e=[];for(const t of this._outputShaderTypes.values())e.push(t.node);for(;e.length;){const t=e.pop();"number"!=typeof t&&"boolean"!=typeof t&&e.push(...t.children.filter(Boolean)),yield t}}*nodesOfTypeOrFunction(){for(const e of this.nodes())"number"!=typeof e&&"boolean"!=typeof e&&(yield e)}createSubgraphContext(){const e=this.clone();return e.body="",e.indent=this.indent+2,e._nodeEmitMap=new Map(this._nodeEmitMap),e}clone(){const e=new n([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return e._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,e.indent=this.indent,e.body=this.body,e.varCount=this.varCount,e._nodeEmitMap=this._nodeEmitMap,e}insertVertexShader(e){e.vertex.code.add(""),this._insertInputs(e,"vertex"),e.vertex.code.add(""),e.vertex.code.add("// OUTPUTS: "),e.vertex.code.add("// --------------------------------------------------------- ");for(const t of this.rootOutputNodes()){const i="builtin"===t.outVariableType;if(!this.shouldPruneOutputNode(t))if(i)e.vertex.code.add(`// ${t.outVariableType.padEnd(7)} ${t.node.type.padEnd(9)} ${t.outVariableName};`);else{const i=[...t.qualifiers,t.outVariableType].join(" ");e.vertex.code.add(`${i.padEnd(10)} ${t.node.type.padEnd(9)} ${t.outVariableName};`)}}e.vertex.code.add(""),e.vertex.code.add("void main() {"),e.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const t of this.rootOutputNodes())this.shouldPruneOutputNode(t)||e.vertex.code.add(`  ${t.outVariableName} = ${t.variableName};`);e.vertex.code.add("}")}insertFragmentShader(e){this._insertInputs(e,"fragment"),e.fragment.code.add(""),e.fragment.code.add("// OUTPUTS: "),e.fragment.code.add("// --------------------------------------------------------- ");let t=0;for(const i of this.rootOutputNodes())"builtin"===i.outVariableType?e.fragment.code.add(`// ${i.outVariableType.padEnd(7)} ${i.node.type.padEnd(9)} ${i.outVariableName};`):e.outputs.add(i.outVariableName,i.node.type,t++);e.fragment.code.add(""),e.fragment.code.add("void main() {"),e.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const t of this.rootOutputNodes())"discard"===t.outVariableType?(e.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),e.fragment.code.add(`  if (${t.variableName}) {`),e.fragment.code.add("    discard;"),e.fragment.code.add("  }"),e.fragment.code.add("  ")):e.fragment.code.add(`  ${t.outVariableName} = ${t.variableName};`);e.fragment.code.add("}")}_insertInputs(e,t){e[t].code.add("// INPUTS: "),e[t].code.add("// --------------------------------------------------------- ");for(const i of this.inputs())if(i.isUsed&&"builtin"!==i.variableInputType)if("array"===i.node.type)e[t].code.add(`${i.variableInputType.padEnd(10)} ${i.node.elementType.type.padEnd(9)} ${i.variableName}[${i.node.size}];`);else if("array-2d"===i.node.type)e[t].code.add(`${i.variableInputType.padEnd(10)} ${i.node.elementType.type.padEnd(9)} ${i.variableName}[${i.node.size}]; // Emulated 2D Array. Not supported by ES3.0`);else{const r=[...i.qualifiers,i.variableInputType].join(" ");e[t].code.add(` ${r.padEnd(10)} ${i.node.type.padEnd(9)} ${i.variableName};`)}}}function s(e){switch(e.type){case"float":case"vec2":case"vec3":case"vec4":return null;case"int":case"ivec2":case"ivec3":case"ivec4":case"uint":case"uvec2":case"uvec3":case"uvec4":case"bool":case"bvec2":case"bvec3":case"bvec4":return"flat";case"mat2":case"mat3":case"mat4":case"array":case"sampler2D":case"array-2d":throw new Error(`InternalError: ${e.type} is not a valid output type`)}}e.ShaderGraphContext=n,e.ShaderInput=i,e.ShaderOutput=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/typed/TypedShaderProgram":function(){define(["exports","../../../../../../core/Error","../../../../../../core/Logger","../../../../../../core/maybe","../../../../../../core/object","../../../../../webgl/BufferObject","../../../../../webgl/FramebufferObject","../../../../../webgl/Program","../../../../../../core/has","../../../../../webgl/Renderbuffer","../../../../../webgl/Texture","../../../../../webgl/enums","../../../../../webgl/checkWebGLError","../../textureUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f){"use strict";function p(e,r,n){const s=r.length;if(s!==n){const o=new t("Invalid Uniform",`Invalid length, expected ${n} but got ${s}`,{uniformName:e,values:r});i.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(o)}}e.TypedShaderProgram=class{constructor(e,t,i,r,n){this.vertexShader=e,this.fragmentShader=t,this._locations=i,this._uniformBindings=r,this._transformFeedbackBindings=n,this._vao=null,this._temporaryTextures=[]}destroy(){this._program=r.disposeMaybe(this._program),this.cleanupTemporaryTextures()}setUniforms(e){this._uniforms=e}cleanupTemporaryTextures(){for(const e of this._temporaryTextures)e.dispose();this._temporaryTextures=[]}bind(e){const t=this._uniforms;if(!this._program){const t=[];for(const e of this._transformFeedbackBindings??[]){const{index:i,propertyKey:r}=e;t[i]=`v_${r}`}this._program=new a.Program(e,this.vertexShader,this.fragmentShader,this._locations,new Map,t)}const i=this._program;e.useProgram(i);for(const r of this._uniformBindings){const{shaderModulePath:s,uniformName:o,uniformType:a,uniformArrayLength:l}=r,c=n.getDeepValue(s,t);if(null==c){if("sampler2D"===a)continue;throw new Error(`Failed to find uniform value for ${s}`)}switch("array"===a||"array-2d"===a?r.uniformArrayElementType:a){case"sampler2D":{const{unit:t,texture:r}=c;if(i.setUniform1i(o,t),"type"in r)e.bindTexture(r,t);else{const i=f.createTexture(e,r.descriptor,r.data);e.bindTexture(i,t)}break}case"int":if(!l){i.setUniform1i(o,c);break}p(r.uniformName,c,l),i.setUniform1iv(o,c);break;case"float":if(!l){i.setUniform1f(o,c);break}p(r.uniformName,c,l),i.setUniform1fv(o,c);break;case"vec2":if(!l){i.setUniform2f(o,c[0],c[1]);break}p(r.uniformName,c,l),i.setUniform2fv(o,c.flat());break;case"vec3":if(!l){i.setUniform3f(o,c[0],c[1],c[2]);break}p(r.uniformName,c,l),i.setUniform3fv(o,c.flat());break;case"vec4":if(!l){i.setUniform4f(o,c[0],c[1],c[2],c[3]);break}p(r.uniformName,c,l),i.setUniform4fv(o,c.flat());break;case"mat3":i.setUniformMatrix3fv(o,c);break;case"mat4":i.setUniformMatrix4fv(o,c);break;default:throw new Error(`Unable to set uniform for type ${a}`)}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/textureUtils":function(){define(["exports","../../../webgl/BufferObject","../../../webgl/FramebufferObject","../../../webgl/Program","../../../../core/has","../../../webgl/Renderbuffer","../../../webgl/Texture","../../../../core/Logger","../../../webgl/enums","../../../webgl/checkWebGLError","../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";e.createTexture=function(e,t,i){const r=new u.TextureDescriptor(t.width,t.height);return r.dataType=t.dataType,t.depth&&(r.depth=t.depth),t.flipped&&(r.flipped=t.flipped),t.hasMipmap&&(r.hasMipmap=t.hasMipmap),r.internalFormat=t.internalFormat,t.isImmutable&&(r.isImmutable=t.isImmutable),t.isOpaque&&(r.isOpaque=t.isOpaque),t.maxAnisotropy&&(r.maxAnisotropy=t.maxAnisotropy),r.pixelFormat=t.pixelFormat,t.preMultiplyAlpha&&(r.preMultiplyAlpha=t.preMultiplyAlpha),t.samplingMode&&(r.samplingMode=t.samplingMode),t.target&&(r.target=t.target),r.uniform=t.uniform,t.unpackAlignment&&(r.unpackAlignment=t.unpackAlignment),t.wrapMode&&(r.wrapMode=t.wrapMode),new o.Texture(e,r,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderBuilder":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(e,t,i,r){"use strict";const n=()=>r.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class s{constructor(){this._includedModules=new Map}include(e,t){this._includedModules.has(e)?this._includedModules.get(e):(this._includedModules.set(e,t),e(this.builder,t))}}class o{constructor(e){this._stage=e,this._entries=new Map}add(...e){for(const t of e)this._add(t);return this._stage}get(e){return this._entries.get(e)}_add(e){if(null!=e){if(this._entries.has(e.name)&&!this._entries.get(e.name).equals(e))throw new t("shaderbuilder:duplicate-uniform",`Duplicate uniform name ${e.name} for different uniform type`);this._entries.set(e.name,e)}else n().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map(({name:e,arraySize:t,type:i})=>null!=t?`uniform ${i} ${e}[${t}];`:`uniform ${i} ${e};`)}get entries(){return Array.from(this._entries.values())}}class a{constructor(e){this._stage=e,this._bodies=new Array}add(e){return this._bodies.push(e),this._stage}generateSource(e){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];if(e)throw new t("shaderbuilder:missing-main","Shader does not contain main function body.");return[]}}class l{constructor(e){this._stage=e,this._entries=new Array}add(e){return this._entries.push(e),this._stage}generateSource(){return this._entries}}class c extends s{constructor(){super(...arguments),this.uniforms=new o(this),this.main=new a(this),this.code=new l(this),this.constants=new p(this)}get builder(){return this}}class u{constructor(){this._entries=new Array}add(e,t){this._entries.push([e,t])}generateSource(e){return"fragment"===e?[]:this._entries.map(e=>`in ${e[1]} ${e[0]};`)}get names(){return this._entries.map(([e])=>e)}}class h{constructor(){this._entries=new Map}add(e,t,i){this._entries.has(e)?n().warn(`Ignoring duplicate varying ${t} ${e}`):this._entries.set(e,{type:t,invariant:i?.invariant??!1,flat:i?.flat??!1})}generateSource(e){const t=new Array;return this._entries.forEach((i,r)=>t.push((i.invariant&&"vertex"===e?"invariant ":"")+(i.flat||"int"===i.type?"flat ":"")+("vertex"===e?"out":"in")+` ${i.type} ${r};`)),t}}class d{constructor(){this._entries=new Set}add(e){this._entries.add(e)}generateSource(e){const t="vertex"===e?d.ALLOWLIST_VERTEX:d.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(e=>t.includes(e)).map(e=>`#extension ${e} : enable`)}static{this.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"]}static{this.ALLOWLIST_VERTEX=[]}}class f{constructor(){this._entries=new Map}add(e,t,i=0){const r=this._entries.get(i);r?.name!==e||r?.type!==t?this._entries.set(i,{name:e,type:t}):n().warn(`Fragment shader output location ${i} occupied`)}static{this.DEFAULT_TYPE="vec4"}static{this.DEFAULT_NAME="fragColor"}generateSource(e){if("vertex"===e)return[];0===this._entries.size&&this._entries.set(0,{name:f.DEFAULT_NAME,type:f.DEFAULT_TYPE});const t=new Array;return this._entries.forEach((e,i)=>t.push(`layout(location = ${i}) out ${e.type} ${e.name};`)),t}}class p{constructor(e){this._stage=e,this._entries=new Set}add(e,t,i){let r="ERROR_CONSTRUCTOR_STRING";switch(t){case"float":r=p._numberToFloatStr(i);break;case"int":r=p._numberToIntStr(i);break;case"bool":r=i.toString();break;case"vec2":r=`vec2(${p._numberToFloatStr(i[0])},                            ${p._numberToFloatStr(i[1])})`;break;case"vec3":r=`vec3(${p._numberToFloatStr(i[0])},                            ${p._numberToFloatStr(i[1])},                            ${p._numberToFloatStr(i[2])})`;break;case"vec4":r=`vec4(${p._numberToFloatStr(i[0])},                            ${p._numberToFloatStr(i[1])},                            ${p._numberToFloatStr(i[2])},                            ${p._numberToFloatStr(i[3])})`;break;case"ivec2":r=`ivec2(${p._numberToIntStr(i[0])},                             ${p._numberToIntStr(i[1])})`;break;case"ivec3":r=`ivec3(${p._numberToIntStr(i[0])},                             ${p._numberToIntStr(i[1])},                             ${p._numberToIntStr(i[2])})`;break;case"ivec4":r=`ivec4(${p._numberToIntStr(i[0])},                             ${p._numberToIntStr(i[1])},                             ${p._numberToIntStr(i[2])},                             ${p._numberToIntStr(i[3])})`;break;case"uvec2":r=`uvec2(${p._numberToIntStr(i[0])},                             ${p._numberToIntStr(i[1])})`;break;case"uvec3":r=`uvec3(${p._numberToIntStr(i[0])},                             ${p._numberToIntStr(i[1])},                             ${p._numberToIntStr(i[2])})`;break;case"uvec4":r=`uvec4(${p._numberToIntStr(i[0])},                             ${p._numberToIntStr(i[1])},                             ${p._numberToIntStr(i[2])},                             ${p._numberToIntStr(i[3])})`;break;case"mat2":case"mat3":case"mat4":r=`${t}(${Array.prototype.map.call(i,e=>p._numberToFloatStr(e)).join(", ")})`}return this._entries.add(`const ${t} ${e} = ${r};`),this._stage}static _numberToIntStr(e){return e.toFixed(0)}static _numberToFloatStr(e){return Number.isInteger(e)?e.toFixed(1):e.toString()}generateSource(){return Array.from(this._entries)}}e.Code=l,e.Includes=s,e.Main=a,e.ShaderBuilder=class extends s{constructor(){super(...arguments),this.vertex=new c,this.fragment=new c,this.attributes=new u,this.varyings=new h,this.extensions=new d,this.outputs=new f}get fragmentUniforms(){return this.fragment.uniforms.entries}get attributeNames(){return this.attributes.names}get builder(){return this}generate(e,t=!1){const i=this.extensions.generateSource(e),r=this.attributes.generateSource(e),n=this.varyings.generateSource(e),s="vertex"===e?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),l=s.main.generateSource(t),c="vertex"===e?"precision highp float;\n precision highp sampler2D;\n precision highp usampler2D;\n precision highp sampler2DArray;\n precision highp sampler2DShadow;\n\n\n invariant gl_Position;\n ":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n  precision highp usampler2D;\n  precision highp sampler2DArray;\n  precision highp sampler2DShadow;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n  precision mediump usampler2D;\n  precision mediump sampler2DArray;\n  precision mediump sampler2DShadow;\n#endif",u=s.constants.generateSource(),h=this.outputs.generateSource(e);return`#version 300 es\n${i.join("\n")}\n${c}\n${u.join("\n")}\n${o.join("\n")}\n${r.join("\n")}\n${n.join("\n")}\n${h.join("\n")}\n${a.join("\n")}\n${l.join("\n")}`}generateBind(e){const t=new Map;this.vertex.uniforms.entries.forEach(e=>{const i=e.bind[0];i&&t.set(e.name,i)}),this.fragment.uniforms.entries.forEach(e=>{const i=e.bind[0];i&&t.set(e.name,i)});const i=Array.from(t.values()),r=i.length;return t=>{for(let n=0;n<r;++n)i[n](e,t)}}generateBindPass(e){const t=new Map;this.vertex.uniforms.entries.forEach(e=>{const i=e.bind[1];i&&t.set(e.name,i)}),this.fragment.uniforms.entries.forEach(e=>{const i=e.bind[1];i&&t.set(e.name,i)});const i=Array.from(t.values()),r=i.length;return(t,n)=>{for(let s=0;s<r;++s)i[s](e,t,n)}}generateBindDraw(e){const t=new Map;this.vertex.uniforms.entries.forEach(e=>{const i=e.bind[2];i&&t.set(e.name,i)}),this.fragment.uniforms.entries.forEach(e=>{const i=e.bind[2];i&&t.set(e.name,i)});const i=Array.from(t.values()),r=i.length;return(t,n,s)=>{for(let o=0;o<r;++o)i[o](e,s,t,n)}}},e.Stage=c,e.Uniforms=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/utils":function(){define(["exports","../../../definitions","../../graph/glsl","./constants"],function(e,t,i,r){"use strict";function n(e,t){const r=i.float(2**t);return i.mod(i.floor(e.divide(r)),i.float(2))}e.clipToUv=function(e){return e.multiply(.5).add(.5)},e.cross2=function(e,t){return e.x.multiply(t.y).subtract(t.x.multiply(e.y))},e.getBit=n,e.getBitBool=function(e,t){return i.greaterThan(n(e,t),i.float(.5))},e.getFilterBit=function(e,i){return n(e,i+t.maxHighlightReasons)},e.getHighlightBit=function(e,t){return n(e,t)},e.isNan=function(e){return i.equal(e,i.float(r.nanMagicNumber))},e.max4=function(e){return i.max(i.max(i.max(e.x,e.y),e.z),e.w)},e.minusOne=function(e){return e.subtract(new i.Float(1))},e.minusScalar=function(e,t){return e.subtract(new i.Float(t))},e.norm=function(e){return i.divide(e,i.float(255))},e.oneMinus=function(e){return new i.Float(1).subtract(e)},e.oneOver=function(e){return new i.Float(1).divide(e)},e.rand=function(e){const t=i.float(12.9898),r=i.float(78.233),n=i.float(43758.5453),s=i.dot(e,i.vec2(t,r)),o=i.mod(s,i.float(3.14));return i.fract(i.sin(o).multiply(n))},e.rgba2float=function(e){const t=i.vec4(255/256,255/65536,255/16777216,255/4294967296);return i.dot(e,t)},e.scalarMinus=function(e,t){return new i.Float(e).subtract(t)},e.unpackDisplayIdTexel=function(e){const t=n(e.z,7),r=i.float(1).subtract(t),s=e.xyz.subtract(i.vec3(0,0,i.float(128)));return r.multiply(e).add(t.multiply(s))},e.uvToClip=function(e){return e.multiply(2).subtract(1)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants":function(){define(["exports"],function(e){"use strict";e.attrVvColor=1,e.attrVvOpacity=2,e.attrVvRotation=3,e.attrVvSize=0,e.bitsetFillRandomPatternOffset=2,e.bitsetGenericConsiderAlphaOnly=4,e.bitsetGenericLockColor=1,e.bitsetLineIsSdf=3,e.bitsetLineScaleDash=2,e.bitsetMarkerAlignmentMap=0,e.bitsetMarkerOutlineAllowColorOverride=2,e.bitsetMarkerScaleSymbolsProportionally=3,e.bitsetOutlineUsesColorVV=1,e.bitsetTextIsBackground=0,e.bitsetTextIsMapAligned=3,e.bitsetTypeFillOutline=0,e.c256ToRad=3.14159265359/128,e.cDegToRad=3.14159265359/180,e.cRadToDeg=180/3.141592654,e.epsilon=1e-5,e.epsilonHitTest=.05,e.extrudeScalePlacementPadding=1/4,e.fillPositionPrecision=1,e.magnifierBarrelFactor=1.1,e.maxFilterCount=2,e.maxRepresentableInt=16777216,e.maxSdfDistance=8,e.nanMagicNumber=1e-30,e.offsetPrecision=1/8,e.outlineScale=.2,e.packPrecision=16,e.placementPadding=8,e.positionPrecision=1/8,e.sdfFontSize=24,e.signedToUnsignedByte=128,e.softEdgeRatio=1,e.thinLineHalfWidth=1,e.thinLineWidthFactor=1.1,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OpacityShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,i,r){"use strict";class n extends i.VertexInput{}t.__decorate([i.location(0,r.Vec2)],n.prototype,"position",void 0);class s extends i.FragmentInput{}class o extends i.UniformGroup{}t.__decorate([i.uniform(r.Sampler2D)],o.prototype,"layerTexture",void 0),t.__decorate([i.uniform(r.Float)],o.prototype,"opacity",void 0);class a extends i.GraphShaderModule{constructor(){super(...arguments),this.type="OpacityShader"}vertex(e){return{uv:e.position,glPosition:new r.Vec4(e.position.subtract(new r.Vec2(.5)).multiply(2),0,1)}}fragment(e){const t=new i.FragmentOutput;return t.fragColor=r.texture2D(this.config.layerTexture,e.uv).multiply(this.config.opacity),t}}t.__decorate([i.uniform(o)],a.prototype,"config",void 0),t.__decorate([t.__param(0,i.input(n))],a.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(s))],a.prototype,"fragment",null),e.OpacityShader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/FeatureEffect":function(){define(["exports","./Effect"],function(e,t){"use strict";class i extends t.Effect{constructor(e){super(),this.name=this.constructor.name,this.defines=[e]}dispose(){}bind({context:e,painter:t}){this._prev=e.getBoundFramebufferObject();const i=t.getFbos().effect0;e.bindFramebuffer(i),e.setColorMask(!0,!0,!0,!0),e.setClearColor(0,0,0,0),e.clear(16384)}unbind(){}draw(e,t){const{context:i,painter:r}=e,n=r.getPostProcessingEffects(t),s=i.getBoundFramebufferObject();for(const{postProcessingEffect:t,effect:i}of n)t.draw(e,s,i);i.bindFramebuffer(this._prev),i.setStencilTestEnabled(!1),r.blitTexture(i,s.colorTexture,9728),i.setStencilTestEnabled(!0)}}e.FeatureEffect=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/Effect":function(){define(["exports"],function(e){"use strict";e.Effect=class{constructor(){this.name=this.constructor.name}createOptions(e,t){return null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/HighlightEffect":function(){define(["../../../../../core/has","../BitBlitRenderer","./Effect","./highlight/HighlightRenderer","./highlight/HighlightSurfaces"],function(e,t,i,r,n){"use strict";class s extends i.Effect{constructor(){super(...arguments),this.defines=["highlight"],this._hlRenderer=new r,this._width=void 0,this._height=void 0,this._boundFBO=null,this._hlSurfaces=new n,this._adjustedWidth=void 0,this._adjustedHeight=void 0,this._blitRenderer=new t.BitBlitRenderer}dispose(){this._hlSurfaces?.dispose(),this._hlRenderer?.dispose(),this._boundFBO=null}bind(e){const{context:t,painter:i}=e,{width:r,height:n}=t.getViewport(),s=i.getFbos().effect0;this.setup(e,r,n),t.bindFramebuffer(s),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(16384)}unbind(){}setup({context:e},t,i){this._width=t,this._height=i;const r=t%4,n=i%4;t+=r<2?-r:4-r,i+=n<2?-n:4-n,this._adjustedWidth=t,this._adjustedHeight=i,this._boundFBO=e.getBoundFramebufferObject();const s=Math.round(1*t),o=Math.round(1*i);this._hlRenderer.setup(e,s,o),this._hlSurfaces.setup(e,s,o)}draw(e){const{context:t,passOptions:i}=e,r=i.activeGradient,n=t.getBoundFramebufferObject();t.setViewport(0,0,1*this._adjustedWidth,1*this._adjustedHeight),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setStencilTestEnabled(!1),t.setClearColor(0,0,0,0),t.clear(16384),this._blitRenderer.render(t,n.colorTexture,9728,1),t.setStencilTestEnabled(!1),t.setBlendingEnabled(!1),t.setColorMask(!1,!1,!1,!0),t.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo),t.setClearColor(0,0,0,0),t.clear(16384),this._hlRenderer.preBlur(t,this._hlSurfaces.sharedBlur1Tex),t.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),t.setClearColor(0,0,0,0),t.clear(16384),this._hlRenderer.finalBlur(t,this._hlSurfaces.sharedBlur2Tex),t.bindFramebuffer(this._boundFBO),t.setBlendingEnabled(!0),t.setColorMask(!0,!0,!0,!0),t.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(t,this._hlSurfaces.sharedBlur1Tex,r),this._boundFBO=null}}return s})},"esri/views/2d/engine/webgl/effects/highlight/HighlightRenderer":function(){define(["../../definitions","./parameters","../../shaders/HighlightPrograms","../../../../../webgl/enums","../../../../../webgl/ProgramTemplate","../../../../../webgl/VertexArrayObject","../../../../../webgl/VertexBuffer","../../../../../webgl/VertexElementDescriptor"],function(e,t,i,r,n,s,o,a){"use strict";return class{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),this._resources.blurProgram.dispose(),this._resources=null)}preBlur(i,n){i.bindTexture(n,e.textureBindingHighlight0),i.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",t.alphaToRgbaChannelSelectorMatrix),i.bindVAO(this._resources.quadVAO),i.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4),i.bindVAO(null)}finalBlur(i,n){i.bindTexture(n,e.textureBindingHighlight0),i.useProgram(this._resources.blurProgram),this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]),this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",t.rgbaToRgbaChannelSelectorMatrix),i.bindVAO(this._resources.quadVAO),i.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4),i.bindVAO(null)}renderHighlight(t,i,n){t.bindTexture(i,e.textureBindingHighlight0),t.useProgram(this._resources.highlightProgram),n.applyHighlightOptions(t,this._resources.highlightProgram),t.bindVAO(this._resources.quadVAO),t.setBlendingEnabled(!0),t.setBlendFunction(1,771),t.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4),t.bindVAO(null)}_initialize(l,c,u){this._width=c,this._height=u;const h=new o.VertexBuffer(l,[new a.VertexElementDescriptor("a_position",2,r.DataType.BYTE,0,4),new a.VertexElementDescriptor("a_texcoord",2,r.DataType.BYTE,2,4)],new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]).buffer),d=new s.VertexArrayObject(l,h),f=n.createProgram(l,i.highlight,d.locations),p=n.createProgram(l,i.blur,d.locations);l.useProgram(f),f.setUniform1i("u_texture",e.textureBindingHighlight0),f.setUniform1i("u_shade",e.textureBindingHighlight1),f.setUniform1f("u_sigma",t.sigma),l.useProgram(p),p.setUniform1i("u_texture",e.textureBindingHighlight0),p.setUniform1f("u_sigma",t.sigma),this._resources={quadGeometry:h,quadVAO:d,highlightProgram:f,blurProgram:p}}setup(e,t,i){this._resources?(this._width=t,this._height=i):this._initialize(e,t,i)}}})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["exports","./sources/resolver"],function(e,t){"use strict";const i={vertexShader:t.resolveIncludes("highlight/textured.vert"),fragmentShader:t.resolveIncludes("highlight/highlight.frag")},r={vertexShader:t.resolveIncludes("highlight/textured.vert"),fragmentShader:t.resolveIncludes("highlight/blur.frag")};e.blur=r,e.highlight=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/highlight/HighlightSurfaces":function(){define(["../../../../../webgl/FramebufferObject","../../../../../webgl/RenderbufferDescriptor","../../../../../webgl/TextureDescriptor"],function(e,t,i){"use strict";function r(r,n,s){const o=new i.TextureDescriptor(n,s);return o.wrapMode=33071,new e.FramebufferObject(r,o,new t.RenderbufferDescriptor(36168,n,s))}return class{constructor(){this._width=void 0,this._height=void 0,this._resources=null}dispose(){this._resources&&(this._resources.sharedBlur1Fbo.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)}_initialize(e,t,i){this._width=t,this._height=i;const n=r(e,t,i),s=r(e,t,i);this._resources={sharedBlur1Fbo:n,sharedBlur2Fbo:s}}setup(e,t,i){!this._resources||this._width===t&&this._height===i||this.dispose(),this._resources||this._initialize(e,t,i)}get sharedBlur1Tex(){return this._resources.sharedBlur1Fbo.colorTexture}get sharedBlur1Fbo(){return this._resources.sharedBlur1Fbo}get sharedBlur2Tex(){return this._resources.sharedBlur2Fbo.colorTexture}get sharedBlur2Fbo(){return this._resources.sharedBlur2Fbo}}})},"esri/views/2d/engine/webgl/effects/HittestEffect":function(){define(["exports","../../../../../core/has","../definitions","./Effect","../../../../webgl/enums"],function(e,t,i,r,n){"use strict";class s extends r.Effect{constructor(){super(...arguments),this.name=this.constructor.name,this.defines=["hittest"]}dispose(){null!=this._fbo&&this._fbo.dispose()}createOptions({pixelRatio:e},r){if(!r.length)return null;const n=r.shift(),s=n.x,o=n.y;this._outstanding=n;const a=t("esri-mobile");return{type:"hittest",distance:(a?i.hittestToleranceMobile:i.hittestToleranceDesktop)*e,smallSymbolDistance:(a?i.hittestToleranceMobile:i.hittestToleranceSmallSymbol)*e,smallSymbolSizeThreshold:i.hittestSmallSymbolThreshold,position:[s,o]}}bind(e){const{context:t,attributeView:i}=e;if(!i.size)return;const r=i.getBlock(2);if(null==r)return;const n=r.getFBO(t);t.setViewport(0,0,i.size,i.size),t.bindFramebuffer(n),t.setColorMask(!0,!0,!0,!0),t.setClearColor(0,0,0,0),t.clear(16640)}unbind(){}draw(e){if(null==this._outstanding)return;const t=this._outstanding;this._outstanding=null,this._resolve(e,t.resolvers)}async _resolve(e,t){const{context:i,attributeView:r}=e,s=r.getBlock(2);if(null==s)return void t.forEach(e=>e.resolve([]));const o=s.getFBO(i),a=new Uint8Array(o.width*o.height*4);try{await o.readPixelsAsync(0,0,o.width,o.height,6408,n.PixelType.UNSIGNED_BYTE,a)}catch(e){return void t.forEach(e=>e.resolve([]))}const l=[];for(let e=0;e<a.length;e+=4){const t=e/4;a[e]&&l.push(t)}t.forEach(e=>e.resolve(l))}}e.HittestEffect=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/EffectManager":function(){define(["exports","./Bloom","./Blur","./Colorize","./DropShadow","./Opacity"],function(e,t,i,r,n,s){"use strict";function o(e){switch(e){case"bloom":case"blur":case"opacity":case"drop-shadow":return e;default:return"colorize"}}const a={colorize:()=>new r.Colorize,blur:()=>new i.Blur,bloom:()=>new t.Bloom,opacity:()=>new s.Opacity,"drop-shadow":()=>new n.DropShadow};e.EffectManager=class{constructor(){this._effectMap=new Map}dispose(){this._effectMap.forEach(e=>e.dispose()),this._effectMap.clear()}getPostProcessingEffects(e){if(!e||0===e.length)return[];const t=[];for(const i of e){const e=o(i.type);let r=this._effectMap.get(e);r||(r=a[e](),this._effectMap.set(e,r)),t.push({postProcessingEffect:r,effect:i})}return t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Bloom":function(){define(["exports","../../../../../../core/maybe","../../VertexStream","../../../../../webgl/FramebufferObject","../../../../../webgl/TextureDescriptor"],function(e,t,i,r,n){"use strict";const s=[1,0],o=[0,1],a=[1,.8,.6,.4,.2],l=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];e.Bloom=class{constructor(){this._intensityFBO=null,this._compositeFBO=null,this._mipsFBOs=new Array(5),this._nMips=5,this._kernelSizeArray=[3,5,7,9,11],this._size=[0,0],this._programDesc={luminosityHighPass:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/luminosityHighPass",locations:new Map([["a_position",0]])},gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/gaussianBlur",locations:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/bloom/composite",locations:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",locations:new Map([["a_position",0]])}}}dispose(){if(this._quad=t.disposeMaybe(this._quad),this._intensityFBO=t.disposeMaybe(this._intensityFBO),this._compositeFBO=t.disposeMaybe(this._compositeFBO),this._mipsFBOs){for(let e=0;e<this._nMips;e++)this._mipsFBOs[e]&&(this._mipsFBOs[e].horizontal.dispose(),this._mipsFBOs[e].vertical.dispose());this._mipsFBOs=null}}draw(e,t,r){const{width:n,height:c}=t,{context:u,painter:h}=e,{materialManager:d}=h,f=u.gl,p=this._programDesc,{strength:m,radius:g,threshold:_}=r;this._quad||(this._quad=new i(u,[-1,-1,1,-1,-1,1,1,1])),this._createOrResizeResources(e,n,c),u.setStencilTestEnabled(!1),u.setBlendingEnabled(!0),u.setBlendFunction(1,771),u.setStencilWriteMask(0);const y=this._quad;y.bind(),u.bindFramebuffer(this._intensityFBO);const x=d.getProgram(p.luminosityHighPass);u.useProgram(x),u.bindTexture(t.colorTexture,0),x.setUniform1i("u_texture",0),x.setUniform3fv("u_defaultColor",[0,0,0]),x.setUniform1f("u_defaultOpacity",0),x.setUniform1f("u_luminosityThreshold",_),x.setUniform1f("u_smoothWidth",.01);const b=[Math.round(n/2),Math.round(c/2)];u.setViewport(0,0,b[0],b[1]),u.setClearColor(0,0,0,0),u.clear(f.COLOR_BUFFER_BIT),y.draw(),u.setBlendingEnabled(!1);let v=this._intensityFBO.colorTexture;for(let e=0;e<this._nMips;e++){const t=d.getProgram(p.gaussianBlur,[{name:"radius",value:this._kernelSizeArray[e]}]);u.useProgram(t),u.bindTexture(v,e+1),t.setUniform1i("u_colorTexture",e+1),t.setUniform2fv("u_texSize",b),t.setUniform2fv("u_direction",s),u.setViewport(0,0,b[0],b[1]);const i=this._mipsFBOs[e];u.bindFramebuffer(i.horizontal),y.draw(),v=i.horizontal.colorTexture,u.bindFramebuffer(i.vertical),u.bindTexture(v,e+1),t.setUniform2fv("u_direction",o),y.draw(),v=i.vertical.colorTexture,b[0]=Math.round(b[0]/2),b[1]=Math.round(b[1]/2)}u.setViewport(0,0,n,c);const S=d.getProgram(p.composite,[{name:"nummips",value:5}]);u.bindFramebuffer(this._compositeFBO),u.useProgram(S),S.setUniform1f("u_bloomStrength",m),S.setUniform1f("u_bloomRadius",g),S.setUniform1fv("u_bloomFactors",a),S.setUniform3fv("u_bloomTintColors",l),u.bindTexture(this._mipsFBOs[0].vertical.colorTexture,1),S.setUniform1i("u_blurTexture1",1),u.bindTexture(this._mipsFBOs[1].vertical.colorTexture,2),S.setUniform1i("u_blurTexture2",2),u.bindTexture(this._mipsFBOs[2].vertical.colorTexture,3),S.setUniform1i("u_blurTexture3",3),u.bindTexture(this._mipsFBOs[3].vertical.colorTexture,4),S.setUniform1i("u_blurTexture4",4),u.bindTexture(this._mipsFBOs[4].vertical.colorTexture,5),S.setUniform1i("u_blurTexture5",5),y.draw(),u.bindFramebuffer(t),u.setBlendingEnabled(!0);const w=d.getProgram(p.blit);u.useProgram(w),u.bindTexture(this._compositeFBO.colorTexture,6),w.setUniform1i("u_texture",6),u.setBlendFunction(1,1),y.draw(),y.unbind(),u.setBlendFunction(1,771),u.setStencilTestEnabled(!0)}_createOrResizeResources(e,t,i){const{context:s}=e;if(this._compositeFBO&&this._size[0]===t&&this._size[1]===i)return;this._size[0]=t,this._size[1]=i;const o=[Math.round(t/2),Math.round(i/2)];if(this._compositeFBO)this._compositeFBO.resize(t,i);else{const e=new n.TextureDescriptor(t,i);e.internalFormat=6408,e.wrapMode=33071,this._compositeFBO=new r.FramebufferObject(s,e)}if(this._intensityFBO)this._intensityFBO.resize(o[0],o[1]);else{const e=new n.TextureDescriptor(o[0],o[1]);e.internalFormat=6408,e.wrapMode=33071,this._intensityFBO=new r.FramebufferObject(s,e)}for(let e=0;e<this._nMips;e++){if(this._mipsFBOs[e])this._mipsFBOs[e].horizontal.resize(o[0],o[1]),this._mipsFBOs[e].vertical.resize(o[0],o[1]);else{const t=new n.TextureDescriptor(o[0],o[1]);t.internalFormat=6408,t.wrapMode=33071,this._mipsFBOs[e]={horizontal:new r.FramebufferObject(s,t),vertical:new r.FramebufferObject(s,t)}}o[0]=Math.round(o[0]/2),o[1]=Math.round(o[1]/2)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Blur":function(){define(["exports","../../VertexStream","../../../../../webgl/FramebufferObject","../../../../../webgl/TextureDescriptor"],function(e,t,i,r){"use strict";const n=[1,0],s=[0,1];e.Blur=class{constructor(){this._blurFBO=null,this._size=[0,0],this._programDesc={gaussianBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",locations:new Map([["a_position",0]])},radialBlur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/radial-blur",locations:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",locations:new Map([["a_position",0]])}}}dispose(){this._blurFBO&&(this._blurFBO.dispose(),this._blurFBO=null)}draw(e,i,r){const{context:n}=e,{type:s,radius:o}=r;if(0===o)return;this._createOrResizeResources(e),this._quad||(this._quad=new t(n,[-1,-1,1,-1,-1,1,1,1]));const a=this._quad;a.bind(),"blur"===s?this._gaussianBlur(e,i,o):this._radialBlur(e,i),a.unbind()}_gaussianBlur(e,t,i){const{context:r,state:o,painter:a,pixelRatio:l}=e,{size:c}=o,{materialManager:u}=a,h=this._programDesc,d=this._quad,f=[Math.round(l*c[0]),Math.round(l*c[1])],p=this._blurFBO,m=u.getProgram(h.gaussianBlur,[{name:"radius",value:Math.ceil(i)}]);r.useProgram(m),r.setBlendingEnabled(!1),r.bindFramebuffer(p),r.bindTexture(t.colorTexture,4),m.setUniform1i("u_colorTexture",4),m.setUniform2fv("u_texSize",f),m.setUniform2fv("u_direction",n),m.setUniform1f("u_sigma",i),d.draw(),r.bindFramebuffer(t),r.setStencilWriteMask(0),r.setStencilTestEnabled(!1),r.setDepthWriteEnabled(!1),r.setDepthTestEnabled(!1),r.bindTexture(p?.colorTexture,5),m.setUniform1i("u_colorTexture",5),m.setUniform2fv("u_direction",s),d.draw(),r.setBlendingEnabled(!0),r.setBlendFunction(1,771),r.setStencilTestEnabled(!0)}_radialBlur(e,t){const{context:i,painter:r}=e,{materialManager:n}=r,s=this._programDesc,o=this._quad,a=this._blurFBO;i.bindFramebuffer(a);const l=n.getProgram(s.radialBlur);i.useProgram(l),i.setBlendingEnabled(!1),i.bindTexture(t.colorTexture,4),l.setUniform1i("u_colorTexture",4),o.draw(),i.bindFramebuffer(t),i.setStencilWriteMask(0),i.setStencilTestEnabled(!1),i.setDepthWriteEnabled(!1),i.setDepthTestEnabled(!1),i.setBlendingEnabled(!0);const c=n.getProgram(s.blit);i.useProgram(c),i.bindTexture(a?.colorTexture,5),c.setUniform1i("u_texture",5),i.setBlendFunction(1,771),o.draw()}_createOrResizeResources(e){const{context:t,state:n,pixelRatio:s}=e,{size:o}=n,a=Math.round(s*o[0]),l=Math.round(s*o[1]);if(!this._blurFBO||this._size[0]!==a||this._size[1]!==l)if(this._size[0]=a,this._size[1]=l,this._blurFBO)this._blurFBO.resize(a,l);else{const e=new r.TextureDescriptor(a,l);e.internalFormat=6408,e.wrapMode=33071,this._blurFBO=new i.FramebufferObject(t,e)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Colorize":function(){define(["exports","../../../../../../core/maybe","../../VertexStream","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],function(e,t,i,r,n){"use strict";e.Colorize=class{constructor(){this._layerFBOTexture=null,this._size=[0,0],this._programDesc={vsPath:"post-processing/pp",fsPath:"post-processing/filterEffect",locations:new Map([["a_position",0]])}}dispose(){this._layerFBOTexture=t.disposeMaybe(this._layerFBOTexture)}draw(e,t,i){const{width:r,height:n}=t;this._createOrResizeResources(e,r,n);const{context:s,painter:o}=e,{materialManager:a}=o,l=this._programDesc,c=this._quad,u=i.colorMatrix;c.bind();const h=this._layerFBOTexture;s.bindFramebuffer(t),t.copyToTexture(0,0,r,n,0,0,h),s.setBlendingEnabled(!1),s.setStencilTestEnabled(!1);const d=a.getProgram(l);s.useProgram(d),s.bindTexture(h,2),d.setUniformMatrix4fv("u_coefficients",u),d.setUniform1i("u_colorTexture",2),c.draw(),s.setBlendingEnabled(!0),s.setBlendFunction(1,771),s.setStencilTestEnabled(!0),c.unbind()}_createOrResizeResources(e,t,s){const{context:o}=e;if(!this._layerFBOTexture||this._size[0]!==t||this._size[1]!==s){if(this._size[0]=t,this._size[1]=s,this._layerFBOTexture)this._layerFBOTexture.resize(t,s);else{const e=new n.TextureDescriptor(t,s);e.internalFormat=6408,e.wrapMode=33071,this._layerFBOTexture=new r.Texture(o,e)}this._quad||(this._quad=new i(o,[-1,-1,1,-1,-1,1,1,1]))}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/DropShadow":function(){define(["exports","../../../../../../core/maybe","../../../../../../core/screenUtils","../../VertexStream","../../../../../webgl/FramebufferObject","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o){"use strict";const a=[1,0],l=[0,1];e.DropShadow=class{constructor(){this._layerFBOTexture=null,this._horizontalBlurFBO=null,this._verticalBlurFBO=null,this._size=[0,0],this._quad=null,this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",locations:new Map([["a_position",0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",locations:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",locations:new Map([["a_position",0]])}}}dispose(){this._layerFBOTexture=t.disposeMaybe(this._layerFBOTexture),this._horizontalBlurFBO=t.disposeMaybe(this._horizontalBlurFBO),this._verticalBlurFBO=t.disposeMaybe(this._verticalBlurFBO)}draw(e,t,n){const{context:s,state:o,painter:c}=e,{materialManager:u}=c,h=this._programDesc,d=t.width,f=t.height,p=[Math.round(d),Math.round(f)],{blurRadius:m,offsetX:g,offsetY:_,color:y}=n,x=[i.pt2px(g),i.pt2px(_)];this._createOrResizeResources(e,d,f,p);const b=this._horizontalBlurFBO,v=this._verticalBlurFBO;s.setStencilWriteMask(0),s.setStencilTestEnabled(!1),s.setDepthWriteEnabled(!1),s.setDepthTestEnabled(!1);const S=this._layerFBOTexture;t.copyToTexture(0,0,d,f,0,0,S),this._quad||(this._quad=new r(s,[-1,-1,1,-1,-1,1,1,1])),s.setViewport(0,0,p[0],p[1]);const w=this._quad;w.bind(),s.setBlendingEnabled(!1);const T=u.getProgram(h.blur,[{name:"radius",value:Math.ceil(m)}]);s.useProgram(T),s.bindFramebuffer(b),s.bindTexture(t.colorTexture,4),T.setUniform1i("u_colorTexture",4),T.setUniform2fv("u_texSize",p),T.setUniform2fv("u_direction",a),T.setUniform1f("u_sigma",m),w.draw(),s.bindFramebuffer(v),s.bindTexture(b?.colorTexture,5),T.setUniform1i("u_colorTexture",5),T.setUniform2fv("u_direction",l),w.draw(),s.bindFramebuffer(t),s.setViewport(0,0,d,f);const M=u.getProgram(h.composite);s.useProgram(M),s.bindTexture(v?.colorTexture,2),M.setUniform1i("u_blurTexture",2),s.bindTexture(S,3),M.setUniform1i("u_layerFBOTexture",3),M.setUniform4fv("u_shadowColor",[y[3]*(y[0]/255),y[3]*(y[1]/255),y[3]*(y[2]/255),y[3]]),M.setUniformMatrix3fv("u_displayViewMat3",o.displayMat3),M.setUniform2fv("u_shadowOffset",x),w.draw(),s.setBlendingEnabled(!0),s.setStencilTestEnabled(!0),s.setBlendFunction(1,771),w.unbind()}_createOrResizeResources(e,t,i,r){const{context:a}=e;if(!this._horizontalBlurFBO||this._size[0]!==t||this._size[1]!==i){if(this._size[0]=t,this._size[1]=i,this._horizontalBlurFBO)this._horizontalBlurFBO.resize(r[0],r[1]);else{const e=new o.TextureDescriptor(r[0],r[1]);e.internalFormat=6408,e.wrapMode=33071,this._horizontalBlurFBO=new n.FramebufferObject(a,e)}if(this._verticalBlurFBO)this._verticalBlurFBO.resize(r[0],r[1]);else{const e=new o.TextureDescriptor(r[0],r[1]);e.internalFormat=6408,e.wrapMode=33071,this._verticalBlurFBO=new n.FramebufferObject(a,e)}if(this._layerFBOTexture)this._layerFBOTexture.resize(t,i);else{const e=new o.TextureDescriptor(t,i);e.internalFormat=6408,e.wrapMode=33071,this._layerFBOTexture=new s.Texture(a,e)}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/effects/post-processing/Opacity":function(){define(["exports","../../../../../../core/maybe","../../../../../webgl/Texture","../../../../../webgl/TextureDescriptor"],function(e,t,i,r){"use strict";e.Opacity=class{constructor(){this._size=[0,0],this._layerFBOTexture=null}dispose(){this._layerFBOTexture=t.disposeMaybe(this._layerFBOTexture)}draw(e,t,i){const{width:r,height:n}=t;this._createOrResizeResources(e,r,n);const{context:s,painter:o}=e,{amount:a}=i,l=s.gl,c=this._layerFBOTexture;s.bindFramebuffer(t),t.copyToTexture(0,0,r,n,0,0,c),s.setBlendingEnabled(!0),s.setStencilTestEnabled(!1),s.setDepthTestEnabled(!1),s.setClearColor(0,0,0,0),s.clear(l.COLOR_BUFFER_BIT),o.blitTexture(s,c,9728,a)}_createOrResizeResources(e,t,n){const{context:s}=e;if(!this._layerFBOTexture||this._size[0]!==t||this._size[1]!==n)if(this._size[0]=t,this._size[1]=n,this._layerFBOTexture)this._layerFBOTexture.resize(t,n);else{const e=new r.TextureDescriptor(t,n);e.internalFormat=6408,e.wrapMode=33071,e.samplingMode=9728,this._layerFBOTexture=new i.Texture(s,e)}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/SimpleMesh":function(){define(["exports","./definitions","./Mesh","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r,n){"use strict";const s={position:{type:r.DataType.SHORT,count:2}};class o extends i.Mesh{static create(e,i){const r=[];let{stride:s}=i;if(null==s){s=0;for(const[e,{count:r,type:n,offset:o}]of Object.entries(i.layout)){if(null!=o)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");s+=r*t.dataSizeInBytes[n]}}let a=0;for(const[e,{count:o,offset:l,type:c,normalized:u}]of Object.entries(i.layout)){null!=l&&(a=l);const i=new n.VertexElementDescriptor(e,o,c,a,s,null!=u&&u,0);r.push(i),a+=o*t.dataSizeInBytes[c]}const l={primitive:i.primitive};null!=i.index&&(l.index="indexData");let{count:c}=i;if(null==c&&(c=i.index?i.index.length:i.vertex.byteLength/s,Math.floor(c)!==c))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${s}.`);const u={start:0,count:c,group:0,primitive:i.primitive},h={vertex:{vertexData:{data:i.vertex,layout:r}},parts:[u],groups:[l]};return null!=i.index&&(h.index={indexData:{data:i.index}}),new o(e,h,i.layout)}static fromVertexStream(e,t){return o.create(e,{primitive:r.PrimitiveType.TRIANGLE_STRIP,vertex:new Uint16Array(t),layout:s})}constructor(e,t,i){super(e,t),this._spec=i}bind(e,t,i=0){super.bind(e,t,i)}}e.SimpleMesh=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/definitions":function(){define(["exports","../../../../webgl/enums"],function(e,t){"use strict";const i={[t.DataType.BYTE]:1,[t.DataType.UNSIGNED_BYTE]:1,[t.DataType.SHORT]:2,[t.DataType.UNSIGNED_SHORT]:2,[t.DataType.HALF_FLOAT]:2,[t.DataType.INT]:4,[t.DataType.UNSIGNED_INT]:4,[t.DataType.FLOAT]:4};e.dataSizeInBytes=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/meshing/Mesh":function(){define(["exports","../../../../../core/compilerUtils","../../../../webgl/BufferObject","../../../../webgl/FramebufferObject","../../../../webgl/Program","../../../../../core/has","../../../../webgl/Renderbuffer","../../../../webgl/Texture","../../../../webgl/VertexArrayObject","./definitions","../../../../webgl/VertexBuffer"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";e.Mesh=class{constructor(e,t){this._boundPart=null,this.vertexBuffers=new Map,this.indexBuffers=new Map,this.groups=[];for(const i in t.vertex){const{data:r,layout:n}=t.vertex[i],s=new u.VertexBuffer(e,n,r);this.vertexBuffers.set(i,s)}for(const r in t.index){const{data:n}=t.index[r],s=i.BufferObject.createIndex(e,35044,n);this.indexBuffers.set(r,s)}for(const e of t.groups)this.groups.push({...e,vertexArrays:new Map});this.parts=t.parts}bind(e,i,r){this._boundPart=r;const{group:n}=this.parts[this._boundPart],s=this.groups[n];if(!s)throw new Error(`Missing group ${n}.`);let o=s.vertexArrays.get(i.stringHash);if(!o){const r=t.toConst(new Set(i.locations.keys())),n=s.index?this.indexBuffers.get(s.index):null,a=new Map;for(const[e,t]of this.vertexBuffers)t.layout.filter(e=>r.has(e.name)).length>0&&a.set(e,t);o=new l.VertexArrayObject(e,a,n),s.vertexArrays.set(i.stringHash,o)}e.bindVAO(o)}draw(e){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:t,count:i}=this.parts[this._boundPart],{group:r}=this.parts[this._boundPart],{primitive:n,index:s}=this.groups[r];if(s){const r=this.indexBuffers.get(s);if(!r)throw new Error(`Missing index buffer "${s}".`);const{indexType:o}=r;if(!o)throw new Error("Buffer type error.");e.drawElements(n,i,o,t*c.dataSizeInBytes[o])}else e.drawArrays(n,t,i)}unbind(e){this._boundPart=null,e.bindVAO(null)}destroy(){this.groups.forEach(({vertexArrays:e})=>e.forEach(e=>e.disposeVAOOnly())),this.vertexBuffers.forEach(e=>e.dispose()),this.indexBuffers.forEach(e=>e.dispose())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/painter/RenderPass":function(){define(["../../../../../core/arrayUtils"],function(e){"use strict";return class{constructor(e,t){this.brushes=e,this.name=t.name,this.drawPhase=t.drawPhase||1,this._targetFn=t.target,this.effects=t.effects||[],this.enableDefaultDraw=t.enableDefaultDraw??(()=>!0),this.forceDrawByDisplayOrder=!!t.forceDrawByDisplayOrder}render(e){const{context:t,profiler:i}=e,r=this._targetFn(),n=this.drawPhase&e.drawPhase;if(i.recordPassStart(this.name),n){this.enableDefaultDraw()&&this._doRender(e,r),i.recordPassEnd();for(const i of this.effects){if(!i.enable())continue;const n=i.apply,s=i.args?.(),o=t.getViewport(),a=t.getBoundFramebufferObject(),l=e.passOptions;this._bindEffect(e,n,s),this._doRender(e,r,n.defines),this._drawAndUnbindEffect(e,n,o,a,l,s)}}}_doRender(e,t,i){if(null==t)return;const{profiler:r,context:n}=e;for(const s of this.brushes){if(r.recordBrushStart(s.name),null!=s.brushEffect){const r=n.getViewport(),o=n.getBoundFramebufferObject(),a=e.passOptions;this._bindEffect(e,s.brushEffect),this._drawWithBrush(s,e,t,i),this._drawAndUnbindEffect(e,s.brushEffect,r,o,a)}else this._drawWithBrush(s,e,t,i);r.recordBrushEnd()}}_drawWithBrush(t,i,r,n){e.isArrayLike(r)?(t.prepareState(i,n),t.drawMany(i,r,n)):r.visible&&(t.prepareState(i,n),t.draw(i,r,n))}_bindEffect(e,t,i){const{profiler:r}=e;r.recordPassStart(this.name+"."+t.name),t.bind(e,i);const n=t.createOptions(e,i);e.passOptions=n}_drawAndUnbindEffect(e,t,i,r,n,s){const{profiler:o,context:a}=e;e.passOptions=n,o.recordBrushStart(t.name),t.draw(e,s),t.unbind(e,s),a.bindFramebuffer(r);const{x:l,y:c,width:u,height:h}=i;a.setViewport(l,c,u,h),o.recordBrushEnd(),o.recordPassEnd()}}})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueProgramCache":function(){define(["exports"],function(e){"use strict";e.TechniqueProgramCache=class{constructor(){this._programCache=new Map}destroy(){for(const e of this._programCache.values())e.destroy();this._programCache.clear()}getProgram(e,t,i,r,n){const s=e.getShaderKey(t,i,r,n);let o=this._programCache.get(s);return o||(o=e.getProgram(t,i,r,n),this._programCache.set(s,o)),o}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Profiler":function(){define(["exports","../../../../core/CircularArray","../../../../core/Evented","../../../../core/has","../../../webgl/capabilities/DisjointTimerQuery"],function(e,t,i,r,n){"use strict";const s=!!r("esri-2d-profiler");e.Profiler=class{constructor(e,r){if(this._events=new i.EventEmitter,this._entries=new Map,this._timings=new t(10),this._currentContainer=null,this._currentPass=null,this._currentBrush=null,this._currentSummary=null,!s)return;this._ext=n.createDisjointTimerQuery(e.gl,{}),this._debugOutput=r;const o=e.gl;if(!this.enableCommandLogging)return;let a;for(a in o)if("function"==typeof o[a]){const e=o[a],t=a.includes("draw");o[a]=(...i)=>(this._events.emit("command",{container:this._currentContainer,pass:this._currentPass,brush:this._currentBrush,method:a,args:i,isDrawCommand:t}),this._currentSummary&&(this._currentSummary.commands++,t&&this._currentSummary.drawCommands++),e.apply(o,i))}}get enableCommandLogging(){return!("object"==typeof s&&s.disableCommands)}recordContainerStart(e){s&&(this._currentContainer=e)}recordContainerEnd(){s&&(this._currentContainer=null)}recordPassStart(e){s&&(this._currentPass=e,this._initSummary())}recordPassEnd(){s&&(this._currentPass=null,this._emitSummary())}recordBrushStart(e){s&&(this._currentBrush=e)}recordBrushEnd(){s&&(this._currentBrush=null)}recordStart(e){if(s&&null!=this._ext){if(this._entries.has(e)){const t=this._entries.get(e),i=this._ext.resultAvailable(t.query),r=this._ext.disjoint();if(i&&!r){const i=this._ext.getResult(t.query)/1e6;let r=0;if(null!=this._timings.enqueue(i)){const e=this._timings.entries,t=e.length;let i=0;for(const t of e)i+=t;r=i/t}const n=i.toFixed(2),s=r?r.toFixed(2):"--";this.enableCommandLogging?(console.groupCollapsed(`Frame report for ${e}, ${n} ms (${s} last 10 avg)\n${t.commandsLen} Commands (${t.drawCommands} draw)`),console.log("RenderPass breakdown: "),console.table(t.summaries),console.log("Commands: ",t.commands),console.groupEnd()):console.log(`Frame report for ${e}, ${n} ms (${s} last 10 avg)`),this._debugOutput.innerHTML=`${n} (${s})`}for(const e of t.handles)e.remove();this._ext.deleteQuery(t.query),this._entries.delete(e)}const t={name:e,query:this._ext.createQuery(),commands:[],commandsLen:0,drawCommands:0,summaries:[],handles:[]};this.enableCommandLogging&&(t.handles.push(this._events.on("command",e=>{t.commandsLen++,t.commands.push(e),e.isDrawCommand&&t.drawCommands++})),t.handles.push(this._events.on("summary",e=>{t.summaries.push(e)}))),this._ext.beginTimeElapsed(t.query),this._entries.set(e,t)}}recordEnd(e){s&&null!=this._ext&&this._entries.has(e)&&this._ext.endTimeElapsed()}_initSummary(){this.enableCommandLogging&&(this._currentSummary={container:this._currentContainer,pass:this._currentPass,drawCommands:0,commands:0})}_emitSummary(){this.enableCommandLogging&&this._currentSummary&&this._events.emit("summary",this._currentSummary)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){"use strict";return class{constructor(e){this.size=0,this._start=0,this.maxSize=e,this._buffer=new Array(e)}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(e){if(0===this.size)return null;for(const t of this._buffer)if(null!=t&&e(t))return t;return null}clear(e){let t=this.dequeue();for(;null!=t;)e&&e(t),t=this.dequeue()}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports"],function(e){"use strict";class t{constructor(e,t,i,r,n,s,o,a,l){this.createQuery=e,this.deleteQuery=t,this.resultAvailable=i,this.getResult=r,this.disjoint=n,this.beginTimeElapsed=s,this.endTimeElapsed=o,this.createTimestamp=a,this.timestampBits=l}}e.hasRunningElapsedTimer=!1,e.DisjointTimerQuery=t,e.createDisjointTimerQuery=function(i,r){if(r.disjointTimerQuery)return null;let n=i.getExtension("EXT_disjoint_timer_query_webgl2");return n?new t(()=>i.createQuery(),t=>{i.deleteQuery(t),e.hasRunningElapsedTimer=!1},e=>i.getQueryParameter(e,i.QUERY_RESULT_AVAILABLE),e=>i.getQueryParameter(e,i.QUERY_RESULT),()=>i.getParameter(n.GPU_DISJOINT_EXT),t=>{e.hasRunningElapsedTimer||(e.hasRunningElapsedTimer=!0,i.beginQuery(n.TIME_ELAPSED_EXT,t))},()=>{i.endQuery(n.TIME_ELAPSED_EXT),e.hasRunningElapsedTimer=!1},e=>n.queryCounterEXT(e,n.TIMESTAMP_EXT),()=>i.getQuery(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)):(n=i.getExtension("EXT_disjoint_timer_query"),n?new t(()=>n.createQueryEXT(),t=>{n.deleteQueryEXT(t),e.hasRunningElapsedTimer=!1},e=>n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT),e=>n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT),()=>i.getParameter(n.GPU_DISJOINT_EXT),t=>{e.hasRunningElapsedTimer||(e.hasRunningElapsedTimer=!0,n.beginQueryEXT(n.TIME_ELAPSED_EXT,t))},()=>{n.endQueryEXT(n.TIME_ELAPSED_EXT),e.hasRunningElapsedTimer=!1},e=>n.queryCounterEXT(e,n.TIMESTAMP_EXT),()=>n.getQueryEXT(n.TIMESTAMP_EXT,n.QUERY_COUNTER_BITS_EXT)):null)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileReshuffleManager":function(){define(["exports"],function(e){"use strict";e.TileReshuffleManager=class{constructor(){this._candidateTiles=[]}schedule(e){this._candidateTiles.includes(e)||this._candidateTiles.push(e)}reshuffle(e){const t=[];for(const i of this._candidateTiles)e>0?(i.reshuffle(),e--):t.push(i);this._candidateTiles=t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueRegistry":function(){define(["exports","./animated/AnimatedTechniques","./dotDensity/DotDensityTechnique","./fill/ComplexFillTechnique","./fill/ComplexOutlineFillTechnique","./fill/FillTechnique","./fill/GradientFillTechnique","./fill/OutlineFillTechnique","./fill/PatternFillTechnique","./fill/PatternOutlineFillTechnique","./heatmap/HeatmapTechnique","./labels/LabelTechnique","./line/GradientStrokeTechnique","./line/LineTechnique","./line/TexturedLineTechnique","./markers/MarkerTechnique","./pieChart/PieChartTechnique","./text/TextTechnique"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_){"use strict";const y={fill:new s.FillTechnique,patternFill:new l.PatternFillTechnique,complexFill:new r.ComplexFillTechnique,gradientFill:new o.GradientFillTechnique,outlineFill:new a.OutlineFillTechnique,patternOutlineFill:new c.PatternOutlineFillTechnique,complexOutlineFill:new n.ComplexOutlineFillTechnique,marker:new m.MarkerTechnique,pieChart:new g.PieChartTechnique,line:new f.LineTechnique,texturedLine:new p.TexturedLineTechnique,gradientStroke:new d.GradientStrokeTechnique,text:new _.TextTechnique,label:new h.LabelTechnique,heatmap:new u.HeatmapTechnique,dotDensity:new i.DotDensityTechnique,animatedMarker:new t.AnimatedMarkerTechnique,animatedMarkerShift:new t.AnimatedMarkerShiftTechnique,animatedFill:new t.AnimatedFillTechnique,animatedLine:new t.AnimatedLineTechnique};e.Techniques=y,e.shutdown=function(e){for(const t in y)y[t].shutdown(e)},e.startup=function(){for(const e in y)y[e].startup()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedTechniques":function(){define(["exports","./AnimatedFillShader","./AnimatedLineShader","./AnimatedMarkerShader","./AnimatedTechnique"],function(e,t,i,r,n){"use strict";class s extends n.AnimatedTechnique{constructor(){super(...arguments),this.type=2,this.symbologyPlane=2,this.shaders={geometry:new r.AnimatedMarkerShader}}}class o extends n.AnimatedTechnique{constructor(){super(...arguments),this.type=3,this.symbologyPlane=2,this.shaders={geometry:new r.AnimatedMarkerShader}}}class a extends n.AnimatedTechnique{constructor(){super(...arguments),this.type=0,this.symbologyPlane=0,this.shaders={geometry:new t.AnimatedFillShader}}}class l extends n.AnimatedTechnique{constructor(){super(...arguments),this.type=1,this.symbologyPlane=1,this.shaders={geometry:new i.AnimatedLineShader}}}e.AnimatedFillTechnique=a,e.AnimatedLineTechnique=l,e.AnimatedMarkerShiftTechnique=o,e.AnimatedMarkerTechnique=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedFillShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AAnimatedPolyShader","../shaders/ComplexFillShader","../shaders/hittestUtils"],function(e,t,i,r,n,s,o){"use strict";class a extends n.AAnimatedPolyShader{constructor(){super(...arguments),this.type="AnimatedFillShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const{distanceToPx:i,ndc:n,z:o,color:a,isOutline:l,strokeWidth:c,isSDF:u,baseSize:h,scale:d,scaleSymbolsProportionally:f}=this._vertexPoly(e),p=this.view.requiredZoomFactor,m=e.sizing.xy,g=m.multiply(p),_=new r.Float(0),y=r.sin(_),x=r.cos(_),b=s.getPatternMatrix(e.id,g,y,x,e.bitset),v=this.localTileOffset.getPatternOffsetAtTileOrigin(m,y,x),S=p.multiply(e.offset.subtract(v)).divide(g),w=new r.Vec3(e.pos,1),T=b.multiply(w).xy.subtract(S),M=e.tlbr.divide(this.mosaicInfo.size.xyxy);return{glPosition:new r.Vec4(n,o,1),tlbr:M,uv:T,color:a.multiply(new r.Float(1).subtract(l)),outlineColor:a.multiply(l),distanceToPx:i,strokeWidth:c.multiply(r.mix(new r.Float(1),d,f)),isOutline:l,isSDF:u,...this.maybeRunHittest(e,t,{pos:e.pos,size:h,sizeCorrection:new r.Float(1),isMapAligned:new r.Float(1),vvRotationMat3:new r.Mat3(1,0,0,0,1,0,0,0,1),placementMat3:new r.Mat3(1,0,0,0,1,0,0,0,1),outlineSize:new r.Float(1),distanceToPx:i,isSDF:u})}}fragment(e){const t=this._fragmentPoly(e);return this.getFragmentOutput(t,e)}hittest(e,t,i){return o.hittestFill(this,e,t)}}t.__decorate([t.__param(0,i.input(n.PolyVertexInput)),t.__param(1,i.input(n.PolyHittestVertexInput))],a.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(n.PolyFragmentInput))],a.prototype,"fragment",null),e.AnimatedFillShader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AAnimatedPolyShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AAnimatedShader","../markers/markerConstants","../shaders/utils","../shaders/vvUtils"],function(e,t,i,r,n,s,o,a){"use strict";class l extends n.AAnimatedVertexInput{}t.__decorate([i.location(9,r.Vec4)],l.prototype,"tlbr",void 0);class c extends i.ComputeVertexInput{}t.__decorate([i.location(13,r.Vec2)],c.prototype,"nextPos1",void 0),t.__decorate([i.location(14,r.Vec2)],c.prototype,"nextPos2",void 0);class u extends n.AAnimatedFragmentInput{}class h extends n.AAnimatedShader{_fragmentPoly(e){const t=r.mod(e.uv,new r.Float(1)),i=r.mix(e.tlbr.xy,e.tlbr.zw,t);return this._getColor(i,{color:e.color,distanceToPx:e.distanceToPx,isSDF:e.isSDF,outlineColor:e.outlineColor,outlineSize:e.strokeWidth})}_vertexPoly(e){const{position:t,animationPointer:i,evalParams:l,isOutline:c,unscaledDistanceToPx:u,vvScale:h,strokeWidth:d,scaleSymbolsProportionally:f,scale:p,isSDF:m,baseSize:g,clip:_}=this._vertexPreamble(e,new r.Float(0),e.lineLength||new r.Float(0)),y=this._toNdc(t);let x=n.getValue(i,1,l);x=new r.Vec4(x.rgb.multiply(x.a),x.a);let b=n.getValue(i,2,l);b=new r.Vec4(b.rgb.multiply(b.a),b.a);let v=n.getValue(i,3,l);v=new r.Vec4(v.rgb.multiply(v.a),v.a);const S=n.getValue(i,4,l).a,w=n.getValue(i,5,l).a,T=a.getVisualVariableColor(this,e.id,x,r.or(o.getBitBool(e.bitset,s.MarkerConstants.bitset.colorLocked),new r.Bool(c))),M=r.mix(T,b,v),P=a.getVisualVariableOpacity(this,e.id),I=r.mix(P,S,w),C=M.multiply(I),F=this.clip(e.id,e.zoomRange).add(_.multiply(2)),O=u.multiply(h);return{unscaledDistanceToPx:u,vvScale:h,strokeWidth:d,scaleSymbolsProportionally:f,scale:p,isSDF:m,baseSize:g,ndc:y,color:C,z:F,isOutline:c,evalParams:l,distanceToPx:O}}}e.AAnimatedPolyShader=h,e.PolyFragmentInput=u,e.PolyHittestVertexInput=c,e.PolyVertexInput=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AAnimatedShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../../../../../../symbols/cim/animationDebugFlags","../../../animations/instructions","../../GraphShaderModule","../../graph/glsl","./AnimationUniformInfo","../markers/markerConstants","../shaders/AFeatureShader","../shaders/constants","../shaders/LocalTileOffset","../shaders/MosaicInfo","../shaders/utils","../shaders/VisualVariableColor","../shaders/VisualVariableOpacity","../shaders/VisualVariableRotation","../shaders/VisualVariableSizeMinMaxValue","../shaders/VisualVariableSizeScaleStops","../shaders/VisualVariableSizeStops","../shaders/VisualVariableSizeUnitValue","../shaders/vvUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_,y,x,b){"use strict";class v extends l.FeatureVertexInput{}t.__decorate([n.location(3,s.Vec2)],v.prototype,"offset",void 0),t.__decorate([n.location(4,s.Vec4)],v.prototype,"sizing",void 0),t.__decorate([n.location(5,s.Vec4)],v.prototype,"value1Position2Value2",void 0),t.__decorate([n.location(6,s.Vec4)],v.prototype,"animationPointerAndBaseSizeAndReferenceSize",void 0),t.__decorate([n.location(7,s.Vec2)],v.prototype,"zoomRange",void 0),t.__decorate([n.location(8,s.Float)],v.prototype,"lineLength",void 0);class S extends l.FeatureFragmentInput{}class w extends l.AFeatureShader{_vertexPreamble(e,t,i){const{id:r,offset:n,animationPointerAndBaseSizeAndReferenceSize:o,sizing:l}=e,u=o.xy,h=o.z,f=o.w,p=l.xy,m=this._getEvalParams(e,p,i);let g,_;if(e.value1Position2Value2){const t=T(u,6,m).a,i=e.pos,r=e.value1Position2Value2.yz,n=e.value1Position2Value2.x,o=e.value1Position2Value2.w,a=t.subtract(n).divide(o.subtract(n));_=i.add(r.subtract(i).multiply(a)),g=s.step(new s.Float(1),a).add(s.step(new s.Float(0),s.negate(a)))}else _=e.pos,g=new s.Float(0);const y=l.z,x=d.getBit(e.bitset,a.MarkerConstants.bitset.isStroke),v=l.w,S=d.getBit(e.bitset,a.MarkerConstants.bitset.scaleSymbolsProportionally),w=T(u,0,m),M=s.cond([s.equal(d.getBit(e.bitset,a.MarkerConstants.bitset.isMapAligned),new s.Float(1)),this.view.rotation.divide(180).multiply(Math.PI)],[!0,new s.Float(0)]),P=new s.Mat2(s.cos(M),s.sin(M.multiply(-1)),s.sin(M),s.cos(M)).multiply(w.xy),I=w.z.subtract(M).subtract(t.multiply(c.c256ToRad)),C=w.w,F=d.getBit(e.bitset,a.MarkerConstants.bitset.isSDF),O=b.getVisualVariableSize(this,r,new s.Float(f)).divide(new s.Float(f));return{baseSize:h,animationPointer:u,strokeWidth:y,isOutline:x,unscaledDistanceToPx:v,scaleSymbolsProportionally:S,isSDF:F,position:this._getScreenPosition({id:r,pos:_,offset:n,referenceSize:f,translation:P,rotation:I,scale:C,vvScale:O}),evalParams:m,vvScale:O,scale:C,clip:g}}_getScreenPosition(e){const{pos:t,translation:i,rotation:r,scale:n,offset:o,id:a,vvScale:l}=e,c=b.getVisualVariableAngle(this,a).multiply(Math.PI/180),u=i.x.multiply(4/3),h=i.y.multiply(-1).multiply(4/3),d=s.sin(c),f=s.cos(c),p=f.multiply(u).add(s.negate(d).multiply(h)),m=d.multiply(u).add(f.multiply(h)),g=s.sin(r.subtract(c)),_=s.cos(r.subtract(c)),y=new s.Float(0),x=new s.Float(1),{pixelRatio:v}=this.animationInfo,S=new s.Mat3(x,y,y,y,x,y,p.multiply(v),m.multiply(v),x),w=new s.Mat3(_,g.multiply(-1),y,g,_,y,0,0,x),T=n.multiply(l).multiply(v).multiply(4/3),M=w.multiply(T),P=this.animationInfo.toScreen.multiply(new s.Vec3(t,1)),I=S.multiply(P).xy,C=M.multiply(new s.Vec3(o,0)).xy;return I.add(C)}_clip(e,t){let r=super.clip(e,t);const n=s.lessThanEqual(this._getLocalTimeOrigin(e),new s.Float(0));return i.animationDebugFlags.forceGlobalTimeOrigin||(r=r.add(s.cond([n,()=>new s.Float(2)],[!0,()=>new s.Float(0)]))),r}_getLocalTimeOrigin(e){return this.storage.getLocalTimeOrigin(e)}_toNdc(e){return this.animationInfo.toNdc.multiply(new s.Vec3(e,1)).xy}_getEvalParams(e,t,i){const{globalTime:r,animationTextureSize:n,animationTexture:s}=this.animationInfo;return{globalTime:r,localTimeOrigin:this._getLocalTimeOrigin(e.id),animationTextureSize:n,animationTexture:s,pixelDimensions:t,lineLength:i}}_getColor(e,t){return s.ifElse(s.equal(t.isSDF,new s.Float(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return s.texture2D(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){const i=s.texture2D(this.mosaicInfo.texture,e),r=new s.Float(.5).subtract(d.rgba2float(i)).multiply(t.distanceToPx).multiply(c.softEdgeRatio),n=s.clamp(new s.Float(.5).subtract(r),new s.Float(0),new s.Float(1)),o=t.color.multiply(n),a=t.outlineSize.multiply(.5),l=s.abs(r).subtract(a),u=s.clamp(new s.Float(.5).subtract(l),new s.Float(0),new s.Float(1)),h=t.outlineColor.multiply(u);return new s.Float(1).subtract(h.a).multiply(o).add(h)}}function T(e,t,i){const n=e.add(new s.Vec2(t,0)),o=s.texture2D(i.animationTexture,n.add(.5).divide(i.animationTextureSize)).xy;return e=e.add(o),s.block({animationPointer:e,...i},s.Vec4,null,e=>{const{out:t}=e;if(!t)throw new Error("out is null");return r.generateVirtualMachineSource({...e,out:t})})}t.__decorate([n.uniform(h.MosaicInfo)],w.prototype,"mosaicInfo",void 0),t.__decorate([n.uniform(o.AnimationUniformInfo)],w.prototype,"animationInfo",void 0),t.__decorate([n.uniform(u.LocalTileOffset)],w.prototype,"localTileOffset",void 0),t.__decorate([n.option(f.VisualVariableColor)],w.prototype,"visualVariableColor",void 0),t.__decorate([n.option(p.VisualVariableOpacity)],w.prototype,"visualVariableOpacity",void 0),t.__decorate([n.option(g.VisualVariableSizeMinMaxValue)],w.prototype,"visualVariableSizeMinMaxValue",void 0),t.__decorate([n.option(_.VisualVariableSizeScaleStops)],w.prototype,"visualVariableSizeScaleStops",void 0),t.__decorate([n.option(y.VisualVariableSizeStops)],w.prototype,"visualVariableSizeStops",void 0),t.__decorate([n.option(x.VisualVariableSizeUnitValue)],w.prototype,"visualVariableSizeUnitValue",void 0),t.__decorate([n.option(m.VisualVariableRotation)],w.prototype,"visualVariableRotation",void 0),e.AAnimatedFragmentInput=S,e.AAnimatedShader=w,e.AAnimatedVertexInput=v,e.getValue=T,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/instructions":function(){define(["exports"],function(e){"use strict";class t{generateSource(e){const t=[];for(let i=1;i<this.length;i++)t.push(`vec4 atom${i} = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;");for(let e=0;e<this.ins;e++)t.push("top--;"),t.push(`vec4 in${this.ins-e-1} = stack[top];`);for(let e=0;e<this.outs;e++)t.push(`vec4 out${e};`);const{microcode:i}=this;for(const e of i)t.push(e);for(let e=0;e<this.outs;e++)t.push(`stack[top] = out${e};`),t.push("top++;"),t.push(`if (top >= ${g}) { top = ${g-1}; }`);return t}}let i=128;class r extends t{constructor(){super(...arguments),this.opcode=++i,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}class n extends t{constructor(){super(...arguments),this.opcode=++i,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(e){return[[this.opcode,e,0,0]]}}class s extends t{constructor(){super(...arguments),this.opcode=++i,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(e){return[[this.opcode,e[0]||0,e[1]||0,e[2]||0]]}}class o extends t{constructor(){super(...arguments),this.opcode=++i,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(e){return[[this.opcode,0,0,0],e]}}function a(e){return[`float duration = clamp(${e.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${e.startTimeOffset};`,`float repeatDelay = ${e.repeatDelay};`,`float timeOriginSelector = ${e.timeOriginSelector};`,`float repeatType = ${e.repeatType};`,`float easing = ${e.easing};`,`float playAnimation = ${e.playAnimation} * (1.0 - step(0.0, -${e.duration}));`,`float reverseAnimation = ${e.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${e.out} = oscillate ? 1.0 - of : of;`]}const l={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},c={Loop:1,None:2,Oscillate:3},u={Local:1,Global:2};function h(e){const t=l[e.easing],i=c[e.repeatType],r=u[e.timeOriginSelector];return[[e.duration,e.startTimeOffset,e.repeatDelay,r],[i,t,e.playAnimation,e.reverseAnimation]]}class d extends t{constructor(){super(...arguments),this.opcode=++i,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...a({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...a({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...a({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;","\n    vec2 translation = vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 = vec4(translation, rotation, scale);"]}encode(e){return[[this.opcode,0,0,0],[e.translation.from[0],e.translation.from[1],e.translation.to[0],e.translation.to[1]],[e.rotation.from,e.rotation.to,e.scale.from,e.scale.to],...h(e.translation.timing),...h(e.rotation.timing),...h(e.scale.timing),[e.relativeTranslation?1:0,e.absoluteScale?1:0,0,0]]}}class f extends t{constructor(){super(...arguments),this.opcode=++i,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...a({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...a({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(e){return[[this.opcode,e.opacity.from,e.opacity.to,0],[e.color.from[0],e.color.from[1],e.color.from[2],e.color.from[3]],[e.color.to[0],e.color.to[1],e.color.to[2],e.color.to[3]],...h(e.color.timing),...h(e.opacity.timing)]}}class p extends t{constructor(){super(...arguments),this.opcode=++i,this.length=4,this.ins=1,this.outs=1,this.microcode=["float fromShift = atom0.y;","float toShift = atom0.z;","float duration = atom1.x;","bool multiplyByLineLength = atom3.x == 1.0;","float fShift;","{",...a({duration:"duration",startTimeOffset:"atom1.y",repeatDelay:"atom1.z",timeOriginSelector:"atom1.w",repeatType:"atom2.x",easing:"atom2.y",playAnimation:"atom2.z",reverseAnimation:"atom2.w",out:"fShift"}),"}","toShift *= multiplyByLineLength ? lineLength : 1.0;","float aShift = mix(fromShift, toShift, fShift);","vec4 pShift = in0;","out0 = mod(aShift + pShift, lineLength);"]}encode(e){return[[this.opcode,e.shift.from,e.shift.to,0],...h(e.shift.timing),[e.multiplyByLineLength?1:0,0,0,0]]}}const m={scalar:new n,vector3:new s,vector4:new o,animatedTransform:new d,animatedColor:new f,animatedShift:new p,ret:new r},g=4;function _(e){const t=[];t.push(`float globalTime = ${e.globalTime};`),t.push(`float localTimeOrigin = ${e.localTimeOrigin};`),t.push(`float lineLength = ${e.lineLength};`),t.push(`vec2 pointer = ${e.animationPointer};`),t.push(`vec2 size = ${e.animationTextureSize};`),t.push("int top = 0;"),t.push(`vec4 stack[${g}];`),t.push("for (int counter = 0; counter < 40; counter++) {"),t.push(`vec4 atom0 = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;"),t.push(`vec2 pixelDimensions = ${e.pixelDimensions};`),t.push("if (false) {");for(const i in m){const r=m[i];t.push(`} else if (int(atom0.x) == ${r.opcode}) {`);for(const i of r.generateSource(e))t.push(i)}return t.push("} // End if-else."),t.push("} // End for."),t.push(`${e.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),t.join("\n")}e.AAnimationInstruction=t,e.AnimatedColorInstruction=f,e.AnimatedShiftInstruction=p,e.AnimatedTransformInstruction=d,e.RetInstruction=r,e.ScalarInstruction=n,e.Vector3Instruction=s,e.Vector4Instruction=o,e.easingCodes=l,e.generateGetValueSource=function(e,t){return`\n    vec4 ${e}(int valueIndex) {\n      vec2 thePointer = ${t.animationPointer};\n      float jump = texture(${t.animationTexture}, (0.5 + vec2(thePointer.x + float(valueIndex), thePointer.y)) / ${t.animationTextureSize}).x;\n      thePointer = vec2(thePointer.x + jump, thePointer.y);\n      vec4 theResult;\n      ${_({...t,out:"theResult",animationPointer:"thePointer"})}\n      return theResult;\n    }\n  `},e.generateVirtualMachineSource=_,e.getTweenFactor=a,e.instructions=m,e.repeatTypeCodes=c,e.timeOriginSelectorCodes=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimationUniformInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,i,r){"use strict";class n extends i.UniformGroup{}t.__decorate([i.uniform(r.Float)],n.prototype,"globalTime",void 0),t.__decorate([i.uniform(r.Vec2)],n.prototype,"animationTextureSize",void 0),t.__decorate([i.uniform(r.Sampler2D)],n.prototype,"animationTexture",void 0),t.__decorate([i.uniform(r.Mat3)],n.prototype,"toScreen",void 0),t.__decorate([i.uniform(r.Mat3)],n.prototype,"toNdc",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"mapRotation",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"pixelRatio",void 0),e.AnimationUniformInfo=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/markerConstants":function(){define(["exports"],function(e){"use strict";e.MarkerConstants={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/AFeatureShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../../definitions","../../GraphShaderModule","../../graph/glsl","./EntityStorage","./ShaderHighlight","./ShaderHittest","./utils","./ViewInfo"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u extends r.VertexInput{}t.__decorate([r.location(0,n.Vec3)],u.prototype,"id",void 0),t.__decorate([r.location(1,n.Float)],u.prototype,"bitset",void 0),t.__decorate([r.location(2,n.Vec2)],u.prototype,"pos",void 0);class h extends r.ComputeVertexInput{}t.__decorate([r.location(14,n.Vec2)],h.prototype,"nextPos1",void 0),t.__decorate([r.location(15,n.Vec2)],h.prototype,"nextPos2",void 0);class d extends r.FragmentInput{}class f extends r.GraphShaderModule{clip(e,t){let i=new n.Float(0);const r=this.storage.getFilterFlags(e);if(i=i.add(n.float(2).multiply(n.float(1).subtract(l.getFilterBit(r,0)))),this.inside?i=i.add(n.float(2).multiply(n.float(1).subtract(l.getFilterBit(r,1)))):this.outside?i=i.add(n.float(2).multiply(l.getFilterBit(r,1))):this.highlight&&(i=i.add(n.float(2).multiply(n.float(1).subtract(this._checkHighlight(r))))),null!=t){const e=new n.Float(1).subtract(n.step(t.x,this.view.currentZoom)),r=n.step(t.y,this.view.currentZoom);i=i.add(new n.Float(2).multiply(e.add(r)))}return i}getFragmentOutput(e,t,i=new n.Float(1/255)){const s=new r.FragmentOutput;return s.fragColor=this._maybeWriteHittest(t)??this._maybeHighlight(e,i)??e,s}_maybeHighlight(e,t){return this.highlight?new n.Vec4(e.rgb,n.step(t,e.a)):null}_checkHighlight(e){let t=this._checkHighlightBit(e,0);for(let r=1;r<i.maxHighlightReasons;r++)t=t.add(this._checkHighlightBit(e,r));return n.step(new n.Float(.1),t.add(this.highlight.highlightAll))}_checkHighlightBit(e,t){return l.getHighlightBit(e,t).multiply(l.getBit(this.highlight.activeReasons,t))}maybeRunHittest(e,t,i){if(null==this.hittestRequest)return null;const r=this.hittest(e,t,i);let s=n.ifElse(n.greaterThan(r,this.hittestRequest.distance),new n.Float(2),new n.Float(0));const o=this.storage.getAttributeDataCoords(e.id),a=l.uvToClip(o);s=s.add(this.clip(e.id,e.zoomRange));const c=new n.Vec4(new n.Float(1/255),0,0,0);return{glPointSize:new n.Float(1),glPosition:new n.Vec4(a,s,1),color:c}}_maybeWriteHittest(e){return null!=this.hittestRequest?e.color:null}}t.__decorate([r.define],f.prototype,"inside",void 0),t.__decorate([r.define],f.prototype,"outside",void 0),t.__decorate([r.option(o.ShaderHighlight)],f.prototype,"highlight",void 0),t.__decorate([r.uniform(s.EntityStorage)],f.prototype,"storage",void 0),t.__decorate([r.uniform(c.ViewInfo)],f.prototype,"view",void 0),t.__decorate([r.option(a.ShaderHittest)],f.prototype,"hittestRequest",void 0),e.AFeatureShader=f,e.BaseHittestVertexInput=h,e.FeatureFragmentInput=d,e.FeatureVertexInput=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/EntityStorage":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../../../../../../core/has","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,t,i,r,n,s){"use strict";class o extends r.UniformGroup{getVisualVariableData(e){if(!this._vvData){const t=this.getAttributeDataCoords(e);this._vvData=n.texture2D(this.visualVariableData,t).setDebugName("storage2")}return this._vvData}getAttributeDataCoords(e){if(!this._uv){const t=s.unpackDisplayIdTexel(e),i=this.size,r=n.int(t.x),o=n.int(t.y).multiply(n.int(256)),a=n.int(t.z).multiply(n.int(256)).multiply(n.int(256)),l=n.float(r.add(o).add(a)),c=n.mod(l,i),u=l.subtract(c).divide(i);this._uv=new n.Vec2(c,u).add(.5).divide(i)}return this._uv}getFilterData(e){const t=this.getAttributeDataCoords(e);return n.texture2D(this.filterFlags,t).setDebugName("storage0")}getAnimationData(e){const t=this.getAttributeDataCoords(e);return n.texture2D(this.animation,t).setDebugName("storage1")}getVVData(e){return this.getVisualVariableData(e)}getDataDrivenData0(e){const t=this.getAttributeDataCoords(e);return n.texture2D(this.dataDriven0,t).setDebugName("storage30")}getDataDrivenData1(e){const t=this.getAttributeDataCoords(e);return n.texture2D(this.dataDriven1,t).setDebugName("storage31")}getDataDrivenData2(e){const t=this.getAttributeDataCoords(e);return n.texture2D(this.dataDriven2,t).setDebugName("storage32")}getGPGPUData(e){const t=this.getAttributeDataCoords(e);return n.texture2D(this.gpgpu,t).setDebugName("storage4")}getLocalTimeOrigin(e){const t=this.getAttributeDataCoords(e);return n.texture2D(this.localTimeOrigin,t).x.setDebugName("storage5")}getFilterFlags(e){return i("webgl-ignores-sampler-precision")?n.ceil(this.getFilterData(e).x.multiply(n.float(255))):this.getFilterData(e).x.multiply(n.float(255))}getLabelVisibility(e){const t=this.getFilterData(e).y.multiply(255);return new n.Float(1).subtract(t)}getAnimationValue(e){return this.getAnimationData(e).x}getSizeValue(e){return this.getVisualVariableData(e).x}getColorValue(e){return this.getVisualVariableData(e).y}getOpacityValue(e){return this.getVisualVariableData(e).z}getRotationValue(e){return this.getVisualVariableData(e).w}}t.__decorate([r.uniform(n.Sampler2D)],o.prototype,"filterFlags",void 0),t.__decorate([r.uniform(n.Sampler2D)],o.prototype,"animation",void 0),t.__decorate([r.uniform(n.Sampler2D)],o.prototype,"gpgpu",void 0),t.__decorate([r.uniform(n.Sampler2D)],o.prototype,"localTimeOrigin",void 0),t.__decorate([r.uniform(n.Sampler2D)],o.prototype,"visualVariableData",void 0),t.__decorate([r.uniform(n.Sampler2D)],o.prototype,"dataDriven0",void 0),t.__decorate([r.uniform(n.Sampler2D)],o.prototype,"dataDriven1",void 0),t.__decorate([r.uniform(n.Sampler2D)],o.prototype,"dataDriven2",void 0),t.__decorate([r.uniform(n.Float)],o.prototype,"size",void 0),e.EntityStorage=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHighlight":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,i,r){"use strict";class n extends i.UniformGroup{}t.__decorate([i.uniform(r.Float)],n.prototype,"activeReasons",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"highlightAll",void 0),e.ShaderHighlight=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ShaderHittest":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,i,r){"use strict";class n extends i.UniformGroup{}t.__decorate([i.uniform(r.Vec2)],n.prototype,"position",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"distance",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"smallSymbolDistance",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"smallSymbolSizeThreshold",void 0),e.ShaderHittest=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ViewInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,i,r){"use strict";class n extends i.UniformGroup{}t.__decorate([i.uniform(r.Mat3)],n.prototype,"displayViewScreenMat3",void 0),t.__decorate([i.uniform(r.Mat3)],n.prototype,"displayViewMat3",void 0),t.__decorate([i.uniform(r.Mat3)],n.prototype,"displayMat3",void 0),t.__decorate([i.uniform(r.Mat3)],n.prototype,"viewMat3",void 0),t.__decorate([i.uniform(r.Mat3)],n.prototype,"tileMat3",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"displayZoomFactor",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"requiredZoomFactor",void 0),t.__decorate([i.uniform(r.Vec2)],n.prototype,"tileOffset",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"currentScale",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"currentZoom",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"metersPerSRUnit",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"rotation",void 0),t.__decorate([i.uniform(r.Float)],n.prototype,"pixelRatio",void 0),e.ViewInfo=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LocalTileOffset":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./constants"],function(e,t,i,r,n){"use strict";class s extends i.UniformGroup{getPatternOffsetAtTileOrigin(e,t=new r.Float(0),i=new r.Float(1)){const s=new r.Vec2(n.maxRepresentableInt).divide(e);let o=e.multiply(r.fract(this.maxIntsToLocalOrigin.multiply(s))).add(this.tileOffsetFromLocalOrigin).subtract(new r.Float(.5).multiply(e));return o=new r.Vec2(o.x.multiply(i).subtract(o.y.multiply(t)),o.x.multiply(t).add(o.y.multiply(i))),r.mod(o,e)}}t.__decorate([i.uniform(r.Vec2)],s.prototype,"tileOffsetFromLocalOrigin",void 0),t.__decorate([i.uniform(r.Vec2)],s.prototype,"maxIntsToLocalOrigin",void 0),e.LocalTileOffset=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MosaicInfo":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,i,r){"use strict";class n extends i.UniformGroup{}t.__decorate([i.uniform(r.Vec2)],n.prototype,"size",void 0),t.__decorate([i.uniform(r.Sampler2D)],n.prototype,"texture",void 0),e.MosaicInfo=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableColor":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,t,i,r,n){"use strict";class s extends i.UniformGroup{getColor(e,t,i){return r.cond([r.or(n.isNan(e),i),t],[r.lessThanEqual(e,this.values.first()),this.colors.first()],[r.greaterThanEqual(e,this.values.last()),this.colors.last()],[!0,()=>{const t=this.values.findIndex(t=>r.greaterThan(t,e)),i=this.values.get(t),n=t.subtract(1),s=this.values.get(n),o=e.subtract(s).divide(i.subtract(s));return r.mix(this.colors.get(n),this.colors.get(t),o)}])}}t.__decorate([i.uniform(r.FixedArray.ofType(r.Vec4,8))],s.prototype,"colors",void 0),t.__decorate([i.uniform(r.FixedArray.ofType(r.Float,8))],s.prototype,"values",void 0),e.VisualVariableColor=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableOpacity":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,t,i,r,n){"use strict";class s extends i.UniformGroup{getOpacity(e){return r.cond([n.isNan(e),new r.Float(1)],[r.lessThanEqual(e,this.opacityValues.first()),this.opacities.first()],[r.greaterThanEqual(e,this.opacityValues.last()),this.opacities.last()],[!0,()=>{const t=this.opacityValues.findIndex(t=>r.greaterThan(t,e)),i=this.opacityValues.get(t),n=t.subtract(1),s=this.opacityValues.get(n),o=e.subtract(s).divide(i.subtract(s));return r.mix(this.opacities.get(n),this.opacities.get(t),o)}])}}t.__decorate([i.uniform(r.FixedArray.ofType(r.Float,8))],s.prototype,"opacities",void 0),t.__decorate([i.uniform(r.FixedArray.ofType(r.Float,8))],s.prototype,"opacityValues",void 0),e.VisualVariableOpacity=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableRotation":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./constants","./utils"],function(e,t,i,r,n,s){"use strict";class o extends i.UniformGroup{getVVRotationMat4(e){return r.ifElse(s.isNan(e),r.Mat4.identity(),()=>{const t=this.getNormalizedAngle(e).multiply(n.cDegToRad),i=r.sin(t),s=r.cos(t);return new r.Mat4(s,i,0,0,i.multiply(new r.Float(-1)),s,0,0,0,0,1,0,0,0,0,1)})}getVVRotationMat3(e){return r.ifElse(s.isNan(e),r.Mat3.identity(),()=>{const t=this.getNormalizedAngle(e).multiply(n.cDegToRad),i=r.sin(t),s=r.cos(t);return new r.Mat3(s,i,0,i.multiply(new r.Float(-1)),s,0,0,0,1)})}getNormalizedAngle(e){const t=r.equal(this.rotationType,new r.Float(1));return r.ifElse(t,new r.Float(90).subtract(e),e)}}t.__decorate([i.uniform(r.Float)],o.prototype,"rotationType",void 0),e.VisualVariableRotation=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeMinMaxValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,t,i,r,n){"use strict";class s extends i.UniformGroup{getSize(e,t){const i=this.minMaxValueAndSize.xy,s=this.minMaxValueAndSize.zw;return r.ifElse(n.isNan(e),t,()=>{const t=e.subtract(i.x).divide(i.y.subtract(i.x)),n=r.clamp(t,new r.Float(0),new r.Float(1));return s.x.add(n.multiply(s.y.subtract(s.x)))})}}t.__decorate([i.uniform(r.Vec4)],s.prototype,"minMaxValueAndSize",void 0),e.VisualVariableSizeMinMaxValue=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeScaleStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,i,r){"use strict";class n extends i.UniformGroup{getSizeForViewScale(e){return r.cond([r.lessThanEqual(e,this.values.first()),this.sizes.first()],[r.greaterThanEqual(e,this.values.last()),this.sizes.last()],[!0,()=>{const t=this.values.findIndex(t=>r.greaterThan(t,e)),i=this.values.get(t),n=t.subtract(1),s=this.values.get(n),o=e.subtract(s).divide(i.subtract(s));return r.mix(this.sizes.get(n),this.sizes.get(t),o)}])}}t.__decorate([i.uniform(r.FixedArray.ofType(r.Float,8))],n.prototype,"sizes",void 0),t.__decorate([i.uniform(r.FixedArray.ofType(r.Float,8))],n.prototype,"values",void 0),e.VisualVariableSizeScaleStops=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeStops":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,t,i,r,n){"use strict";class s extends i.UniformGroup{getSize(e,t){const i=r.cond([n.isNan(e),t],[r.lessThanEqual(e,this.values.first()),this.sizes.first()],[r.greaterThanEqual(e,this.values.last()),this.sizes.last()],[!0,()=>{const t=this.values.findIndex(t=>r.greaterThan(t,e)),i=this.values.get(t),n=t.subtract(1),s=this.values.get(n),o=e.subtract(s).divide(i.subtract(s));return r.mix(this.sizes.get(n),this.sizes.get(t),o)}]);return r.ifElse(n.isNan(i),t,i)}}t.__decorate([i.uniform(r.FixedArray.ofType(r.Float,8))],s.prototype,"sizes",void 0),t.__decorate([i.uniform(r.FixedArray.ofType(r.Float,8))],s.prototype,"values",void 0),e.VisualVariableSizeStops=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VisualVariableSizeUnitValue":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./utils"],function(e,t,i,r,n){"use strict";class s extends i.UniformGroup{getSize(e,t){return r.ifElse(n.isNan(e),t,e.multiply(this.unitValueToPixelsRatio))}}t.__decorate([i.uniform(r.Float)],s.prototype,"unitValueToPixelsRatio",void 0),e.VisualVariableSizeUnitValue=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/vvUtils":function(){define(["exports","../../graph/glsl"],function(e,t){"use strict";function i(e){return null!=e.visualVariableSizeMinMaxValue||null!=e.visualVariableSizeScaleStops||null!=e.visualVariableSizeStops||null!=e.visualVariableSizeUnitValue}e.getVisualVariableAngle=function(e,i){if(null==e.visualVariableRotation)return new t.Float(0);const r=e.storage.getRotationValue(i);return e.visualVariableRotation.getNormalizedAngle(r)},e.getVisualVariableColor=function(e,i,r,n=new t.Bool(!1)){if(null==e.visualVariableColor)return r;const s=e.storage.getColorValue(i);return e.visualVariableColor.getColor(s,r,n)},e.getVisualVariableOpacity=function(e,i){if(null==e.visualVariableOpacity)return new t.Float(1);const r=e.storage.getOpacityValue(i);return e.visualVariableOpacity.getOpacity(r)},e.getVisualVariableRotation=function(e,i){if(null==e.visualVariableRotation)return t.Mat3.identity();const r=e.storage.getRotationValue(i);return e.visualVariableRotation.getVVRotationMat3(r)},e.getVisualVariableSize=function(e,t,r){if(i(e)){const i=e.storage.getSizeValue(t);return e.visualVariableSizeMinMaxValue?.getSize(i,r)??e.visualVariableSizeScaleStops?.getSizeForViewScale(e.view.currentScale)??e.visualVariableSizeStops?.getSize(i,r)??e.visualVariableSizeUnitValue?.getSize(i,r)}return r},e.hasVisualVariableSize=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexFillShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./constants","./FillShader","./LocalTileOffset","./MosaicInfo","./utils"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u extends o.FillVertexInput{}t.__decorate([i.location(5,r.Vec4)],u.prototype,"tlbr",void 0),t.__decorate([i.location(6,r.Float)],u.prototype,"width",void 0),t.__decorate([i.location(7,r.Float)],u.prototype,"height",void 0),t.__decorate([i.location(8,r.Vec2)],u.prototype,"offset",void 0),t.__decorate([i.location(9,r.Vec2)],u.prototype,"scale",void 0),t.__decorate([i.location(10,r.Float)],u.prototype,"angle",void 0);class h extends n.FeatureFragmentInput{}function d(e,t,i,n,o){const a=r.equal(c.getBit(o,s.bitsetFillRandomPatternOffset),r.float(1)),l=c.rgba2float(new r.Vec4(e,0));return r.ifElse(a,r.mat3(n.divide(t.x),i.divide(t.y),0,r.negate(i.divide(t.x)),n.divide(t.y),0,c.rand(r.vec2(l,0)),c.rand(r.vec2(0,l)),1),r.mat3(n.divide(t.x),i.divide(t.y),0,r.negate(i.divide(t.x)),n.divide(t.y),0,0,0,1))}function f(e,t){const i=e.view.requiredZoomFactor,n=new r.Vec2(t.width,t.height),o=n.multiply(t.scale).multiply(i),a=t.angle.multiply(s.c256ToRad),l=r.sin(a),u=r.cos(a),h=d(t.id,o,l,u,t.bitset),f=e.localTileOffset.getPatternOffsetAtTileOrigin(n,l,u),p=i.multiply(t.scale).multiply(t.offset.subtract(f)).divide(o),m=new r.Vec3(t.pos,1),g=h.multiply(m).xy.subtract(p),_=t.tlbr.divide(e.mosaicInfo.size.xyxy);let y=c.getBit(t.bitset,s.bitsetGenericConsiderAlphaOnly);return null!=e.visualVariableColor&&(y=r.ifElse(c.isNan(e.storage.getColorValue(t.id)),new r.Float(0),y)),{tileTextureCoord:g,tlbr:_,sampleAlphaOnly:y}}function p(e,t){const i=r.mod(t.tileTextureCoord,new r.Float(1)),n=r.mix(t.tlbr.xy,t.tlbr.zw,i);let s=r.texture2D(e.mosaicInfo.texture,n);return s=r.ifElse(r.greaterThan(t.sampleAlphaOnly,new r.Float(.5)),s.aaaa,s),t.color.multiply(s)}class m extends o.FillShader{constructor(){super(...arguments),this.type="ComplexFillShader"}vertex(e,t){return{...super.vertex(e,t),...f(this,e)}}fragment(e){const t=p(this,e);return this.getFragmentOutput(t,e,new r.Float(0))}}t.__decorate([i.uniform(l.MosaicInfo)],m.prototype,"mosaicInfo",void 0),t.__decorate([i.uniform(a.LocalTileOffset)],m.prototype,"localTileOffset",void 0),t.__decorate([t.__param(0,i.input(u)),t.__param(1,i.input(n.BaseHittestVertexInput))],m.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(h))],m.prototype,"fragment",null),e.ComplexFillFragmentInput=h,e.ComplexFillShader=m,e.ComplexFillVertexInput=u,e.getComplexFillFragmentColor=p,e.getComplexFillVertexData=f,e.getPatternMatrix=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/FillShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./hittestUtils","./VisualVariableColor","./VisualVariableOpacity","./vvUtils"],function(e,t,i,r,n,s,o,a,l){"use strict";class c extends n.FeatureVertexInput{}t.__decorate([i.location(3,r.Vec4)],c.prototype,"color",void 0),t.__decorate([i.location(4,r.Vec2)],c.prototype,"zoomRange",void 0);class u extends n.AFeatureShader{constructor(){super(...arguments),this.type="FillShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const i=l.getVisualVariableOpacity(this,e.id),n=l.getVisualVariableColor(this,e.id,e.color).multiply(i),s=this.view.displayViewScreenMat3.multiply(new r.Vec3(e.pos.xy,1)),o=this.clip(e.id,e.zoomRange);return{glPosition:new r.Vec4(s.xy,o,1),color:n,...this.maybeRunHittest(e,t,null)}}fragment(e){return this.getFragmentOutput(e.color,e,new r.Float(0))}hittest(e,t){return s.hittestFill(this,e,t)}}t.__decorate([i.option(o.VisualVariableColor)],u.prototype,"visualVariableColor",void 0),t.__decorate([i.option(a.VisualVariableOpacity)],u.prototype,"visualVariableOpacity",void 0),t.__decorate([t.__param(0,i.input(c)),t.__param(1,i.input(n.BaseHittestVertexInput))],u.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(n.FeatureFragmentInput))],u.prototype,"fragment",null),e.FillShader=u,e.FillVertexInput=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/hittestUtils":function(){define(["exports","../../graph/glsl","./constants","./utils"],function(e,t,i,r){"use strict";function n(e,i){return t.dot(e,t.normalize(i))}function s(e,i,r){const s=r.subtract(i),o=n(e.subtract(i),s),a=t.clamp(o.divide(t.length(s)),new t.Float(0),new t.Float(1));return t.distance(e,i.add(a.multiply(r.subtract(i))))}function o(e){const i=t.abs(e);return t.step(i.x.add(i.y).add(i.z),new t.Float(1.05))}function a(e,i,r,n){const s=new t.Mat3(r.x.multiply(n.y).subtract(n.x.multiply(r.y)),n.x.multiply(i.y).subtract(i.x.multiply(n.y)),i.x.multiply(r.y).subtract(r.x.multiply(i.y)),r.y.subtract(n.y),n.y.subtract(i.y),i.y.subtract(r.y),n.x.subtract(r.x),i.x.subtract(n.x),r.x.subtract(i.x)),o=i.x.multiply(r.y.subtract(n.y)),a=r.x.multiply(n.y.subtract(i.y)),l=n.x.multiply(i.y.subtract(r.y)),c=o.add(a).add(l);return new t.Float(1).divide(c).multiply(s.multiply(new t.Vec3(1,e)))}function l(e,i,r,n){return t.equal(o(a(e,i,r,n)),new t.Float(1))}function c(e,n,o,a){const c=o.subtract(n),u=a.subtract(n),h=r.cross2(c,u),d=t.and(t.lessThan(h,new t.Float(i.epsilonHitTest)),t.greaterThan(h,new t.Float(-i.epsilonHitTest)));return t.cond([t.and(t.not(d),l(e.xy,n,o,a)),new t.Float(-1)],[!0,()=>{const i=s(e,n,o),r=s(e,o,a),l=s(e,a,n);return t.min(t.min(i,r),l)}])}e.distPointSegment=s,e.distPointTriangle=c,e.failHittest=function(e){return e.distance.add(1)},e.hittestFill=function(e,i,r){const{viewMat3:n,tileMat3:s}=e.view,o=n.multiply(s),a=o.multiply(new t.Vec3(i.pos,1)),l=o.multiply(new t.Vec3(r.nextPos1,1)),u=o.multiply(new t.Vec3(r.nextPos2,1));return c(e.hittestRequest.position,a.xy,l.xy,u.xy)},e.hittestMarker=function(e,i,r){return t.distance(e,r).subtract(i)},e.inTriangle=o,e.projectScalar=n,e.xyToBarycentric=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedLineShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AAnimatedPolyShader","./AAnimatedShader","../shaders/hittestUtils","../shaders/LineShader"],function(e,t,i,r,n,s,o,a){"use strict";class l extends n.PolyVertexInput{}t.__decorate([i.location(10,r.Float)],l.prototype,"accumulatedDistance",void 0),t.__decorate([i.location(11,r.Vec2)],l.prototype,"normal",void 0),t.__decorate([i.location(12,r.Vec2)],l.prototype,"segmentDirection",void 0);class c extends n.PolyFragmentInput{}class u extends n.AAnimatedPolyShader{constructor(){super(...arguments),this.type="AnimatedLineShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const{animationPointerAndBaseSizeAndReferenceSize:i}=e,n=i.xy,{distanceToPx:o,ndc:a,z:l,color:c,isOutline:u,strokeWidth:h,isSDF:d,baseSize:f,scale:p,scaleSymbolsProportionally:m,evalParams:g}=this._vertexPoly(e),_=e.sizing.xy,y=_.x.multiply(f).divide(_.y),x=s.getValue(n,6,g).a,b=e.accumulatedDistance.subtract(x),{normal:v}=e,S=e.normal.y,w=b.divide(this.view.displayZoomFactor).add(r.dot(e.segmentDirection,e.offset)).divide(y),T=S.add(1).divide(2),M=new r.Vec2(w,T),P=e.tlbr.divide(this.mosaicInfo.size.xyxy);return{glPosition:new r.Vec4(a,l,1),tlbr:P,uv:M,color:c.multiply(new r.Float(1).subtract(u)),outlineColor:c.multiply(u),distanceToPx:o,strokeWidth:h.multiply(r.mix(new r.Float(1),p,m)),isOutline:u,isSDF:d,halfWidth:f.divide(2),normal:v,...this.maybeRunHittest(e,t,{pos:e.pos,size:f,sizeCorrection:new r.Float(1),isMapAligned:new r.Float(1),vvRotationMat3:new r.Mat3(1,0,0,0,1,0,0,0,1),placementMat3:new r.Mat3(1,0,0,0,1,0,0,0,1),outlineSize:new r.Float(1),distanceToPx:o,isSDF:d})}}fragment(e){const t=this._fragmentPoly(e),{halfWidth:i,normal:n}=e,s=a.getLineThinFactor(i),o=r.length(n).multiply(i),l=r.clamp(s.multiply(i.subtract(o)).divide(s.subtract(new r.Float(1))),new r.Float(0),new r.Float(1));return this.getFragmentOutput(t.multiply(l),e)}hittest(e,t,i){const{viewMat3:n,tileMat3:s}=this.view,a=n.multiply(s),l=a.multiply(new r.Vec3(e.pos,1)),c=a.multiply(new r.Vec3(t.nextPos1,1)),u=a.multiply(new r.Vec3(t.nextPos2,1)),{distance:h,smallSymbolDistance:d,smallSymbolSizeThreshold:f}=this.hittestRequest,p=r.step(i,f.multiply(.5)).multiply(h.subtract(d)),m=this.hittestRequest.position;return r.min(o.distPointSegment(m,l.xy,c.xy),o.distPointSegment(m,l.xy,u.xy)).subtract(i).add(p)}}t.__decorate([t.__param(0,i.input(l)),t.__param(1,i.input(n.PolyHittestVertexInput))],u.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(c))],u.prototype,"fragment",null),e.AnimatedLineShader=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/LineShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./constants","./hittestUtils","./VisualVariableColor","./VisualVariableOpacity","./VisualVariableSizeMinMaxValue","./VisualVariableSizeScaleStops","./VisualVariableSizeStops","./VisualVariableSizeUnitValue","./vvUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f){"use strict";class p extends n.FeatureVertexInput{}t.__decorate([i.location(3,r.Vec4)],p.prototype,"color",void 0),t.__decorate([i.location(4,r.Vec2)],p.prototype,"offset",void 0),t.__decorate([i.location(5,r.Vec2)],p.prototype,"normal",void 0),t.__decorate([i.location(6,r.Float)],p.prototype,"halfWidth",void 0),t.__decorate([i.location(7,r.Float)],p.prototype,"referenceHalfWidth",void 0),t.__decorate([i.location(8,r.Vec2)],p.prototype,"zoomRange",void 0);class m extends n.FeatureFragmentInput{}class g extends i.UniformGroup{}function _(e){return r.max(new r.Float(s.thinLineWidthFactor).multiply(r.step(e,new r.Float(s.thinLineHalfWidth))),new r.Float(1))}function y(e,t){const{halfWidth:i,normal:n}=e,s=_(i),o=r.length(n).multiply(i);return r.clamp(s.multiply(i.subtract(o)).divide(t.add(s).subtract(new r.Float(1))),new r.Float(0),new r.Float(1))}function x(e,t){const{id:i,offset:n,pos:o,normal:a,zoomRange:l}=t,{displayViewScreenMat3:c,displayViewMat3:u}=e.view,h=f.getVisualVariableColor(e,i,t.color),d=f.getVisualVariableOpacity(e,i),p=function(e,t){const{id:i,halfWidth:n,referenceHalfWidth:o}=t;if(f.hasVisualVariableSize(e)){const t=new r.Float(2).multiply(o),a=f.getVisualVariableSize(e,i,t);return new r.Float(.5).multiply(n.divide(r.max(o,new r.Float(s.epsilon)))).multiply(a)}return n}(e,t),m=new r.Float(.5).multiply(e.antialiasingControls.antialiasing),g=r.max(p.add(m),new r.Float(.45)).add(new r.Float(.1).multiply(m)),y=_(g).multiply(g).multiply(n),x=u.multiply(new r.Vec3(y,new r.Float(0))),b=c.multiply(new r.Vec3(o,new r.Float(1))).add(x),v=new r.Float(2).multiply(r.step(p,new r.Float(0))).add(e.clip(i,l)),S=new r.Vec4(b.xy,v,1);return{color:h,opacity:d,halfWidth:g,normal:a,scaledOffset:y,scaledHalfWidth:p,glPosition:new r.Vec4(S.xy,v,1)}}function b(e,t){const{opacity:i,color:r}=e,n=y(e,t);return i.multiply(r).multiply(n)}t.__decorate([i.uniform(r.Float)],g.prototype,"antialiasing",void 0),t.__decorate([i.uniform(r.Float)],g.prototype,"blur",void 0);class v extends n.AFeatureShader{constructor(){super(...arguments),this.type="LineShader",this.computeAttributes={pos:["nextPos1","nextPos2"]}}vertex(e,t){const i=x(this,e);return{...i,...this.maybeRunHittest(e,t,i.halfWidth)}}fragment(e){const t=b(e,this.antialiasingControls.blur);return this.getFragmentOutput(t,e)}hittest(e,t,i){const{viewMat3:n,tileMat3:s}=this.view,a=n.multiply(s),l=a.multiply(new r.Vec3(e.pos,1)),c=a.multiply(new r.Vec3(t.nextPos1,1)),u=a.multiply(new r.Vec3(t.nextPos2,1)),{distance:h,smallSymbolDistance:d,smallSymbolSizeThreshold:f}=this.hittestRequest,p=r.step(i,f.multiply(.5)).multiply(h.subtract(d)),m=this.hittestRequest.position;return r.min(o.distPointSegment(m,l.xy,c.xy),o.distPointSegment(m,l.xy,u.xy)).subtract(i).add(p)}}t.__decorate([i.uniform(g)],v.prototype,"antialiasingControls",void 0),t.__decorate([i.option(a.VisualVariableColor)],v.prototype,"visualVariableColor",void 0),t.__decorate([i.option(l.VisualVariableOpacity)],v.prototype,"visualVariableOpacity",void 0),t.__decorate([i.option(c.VisualVariableSizeMinMaxValue)],v.prototype,"visualVariableSizeMinMaxValue",void 0),t.__decorate([i.option(u.VisualVariableSizeScaleStops)],v.prototype,"visualVariableSizeScaleStops",void 0),t.__decorate([i.option(h.VisualVariableSizeStops)],v.prototype,"visualVariableSizeStops",void 0),t.__decorate([i.option(d.VisualVariableSizeUnitValue)],v.prototype,"visualVariableSizeUnitValue",void 0),t.__decorate([t.__param(0,i.input(p)),t.__param(1,i.input(n.BaseHittestVertexInput))],v.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(m))],v.prototype,"fragment",null),e.AntialiasingControls=g,e.LineFragmentInput=m,e.LineShader=v,e.LineVertexInput=p,e.getLineAntialiasing=y,e.getLineFragmentColor=b,e.getLineThinFactor=_,e.getLineVertexData=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../../../../../../symbols/cim/animationDebugFlags","../../GraphShaderModule","../../graph/glsl","./AAnimatedShader","../markers/markerConstants","../shaders/hittestUtils","../shaders/utils","../shaders/vvUtils"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u extends s.AAnimatedVertexInput{}t.__decorate([r.location(9,n.Vec2)],u.prototype,"uv",void 0),t.__decorate([r.location(10,n.Float)],u.prototype,"angle",void 0);class h extends r.ComputeVertexInput{}t.__decorate([r.location(11,n.Vec2)],h.prototype,"offsetNextVertex1",void 0),t.__decorate([r.location(12,n.Vec2)],h.prototype,"offsetNextVertex2",void 0),t.__decorate([r.location(13,n.Vec2)],h.prototype,"textureUVNextVertex1",void 0),t.__decorate([r.location(14,n.Vec2)],h.prototype,"textureUVNextVertex2",void 0);class d extends s.AAnimatedFragmentInput{}function f(e,t,i,r){return t.multiply(e.x).add(i.multiply(e.y)).add(r.multiply(e.z))}class p extends s.AAnimatedShader{constructor(){super(...arguments),this.type="AnimatedMarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],uv:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(e,t){const i=e.uv.divide(this.mosaicInfo.size),{position:r,animationPointer:a,evalParams:u,isOutline:h,unscaledDistanceToPx:d,vvScale:f,strokeWidth:p,scaleSymbolsProportionally:m,scale:g,isSDF:_,baseSize:y,clip:x}=this._vertexPreamble(e,e.angle,e.lineLength||new n.Float(0)),b=this._toNdc(r);let v=s.getValue(a,1,u);v=new n.Vec4(v.rgb.multiply(v.a),v.a);let S=s.getValue(a,2,u);S=new n.Vec4(S.rgb.multiply(S.a),S.a);let w=s.getValue(a,3,u);w=new n.Vec4(w.rgb.multiply(w.a),w.a);const T=s.getValue(a,4,u).a,M=s.getValue(a,5,u).a,P=c.getVisualVariableColor(this,e.id,v,n.or(l.getBitBool(e.bitset,o.MarkerConstants.bitset.colorLocked),new n.Bool(h))),I=n.mix(P,S,w),C=c.getVisualVariableOpacity(this,e.id),F=n.mix(C,T,M),O=I.multiply(F),A=this.clip(e.id,e.zoomRange).add(x.multiply(2)),E=d.multiply(f);return{glPosition:new n.Vec4(b,A,1),uv:i,color:O.multiply(new n.Float(1).subtract(h)),outlineColor:O.multiply(h),distanceToPx:E,strokeWidth:p.multiply(n.mix(new n.Float(1),g,m)),isOutline:h,isSDF:_,...this.maybeRunHittest(e,t,{pos:e.pos,size:y,sizeCorrection:new n.Float(1),isMapAligned:new n.Float(1),vvRotationMat3:new n.Mat3(1,0,0,0,1,0,0,0,1),placementMat3:new n.Mat3(1,0,0,0,1,0,0,0,1),outlineSize:new n.Float(1),distanceToPx:E,isSDF:_})}}fragment(e){let t=this._getColor(e.uv,{color:e.color,distanceToPx:e.distanceToPx,isSDF:e.isSDF,outlineColor:e.outlineColor,outlineSize:e.strokeWidth});return i.animationDebugFlags.spotlightAnimatedSymbols&&(t=t.add(new n.Vec4(0,.3,0,.3))),this.getFragmentOutput(t,e)}hittest(e,t,i){return n.ifElse(n.lessThan(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_hittestSmallMarker(e,t,i){const{position:r,distance:s,smallSymbolDistance:o}=this.hittestRequest,a=s.subtract(o),{viewMat3:l,tileMat3:c}=this.view,u=l.multiply(c).multiply(new n.Vec3(i.pos,1)).xy,h=i.size.multiply(.5);return n.distance(u,r).subtract(h).add(a)}_hittestMarker(e,t,i){const r=this._vertexPreamble({...e},e.angle,new n.Float(0)).position,s=this._vertexPreamble({...e,offset:t.offsetNextVertex1},e.angle,new n.Float(0)).position,o=this._vertexPreamble({...e,offset:t.offsetNextVertex2},e.angle,new n.Float(0)).position,l=this.hittestRequest.position,c=this.hittestRequest.distance,u=a.distPointTriangle(l,r,s,o);return n.ifElse(n.greaterThan(u,c),u,this._hittestSamples(r,s,o,e,t,i))}_hittestSamples(e,t,i,r,s,o){const{outlineSize:l,isSDF:c,distanceToPx:u}=o,h=this.hittestRequest.position,d=this.hittestRequest.distance,p=a.xyToBarycentric(h.add(new n.Vec2(n.negate(d),n.negate(d))),e,t,i),m=a.xyToBarycentric(h.add(new n.Vec2(0,n.negate(d))),e,t,i),g=a.xyToBarycentric(h.add(new n.Vec2(d,n.negate(d))),e,t,i),_=a.xyToBarycentric(h.add(new n.Vec2(n.negate(d),0)),e,t,i),y=a.xyToBarycentric(h,e,t,i),x=a.xyToBarycentric(h.add(new n.Vec2(d,0)),e,t,i),b=a.xyToBarycentric(h.add(new n.Vec2(n.negate(d),d)),e,t,i),v=a.xyToBarycentric(h.add(new n.Vec2(0,d)),e,t,i),S=a.xyToBarycentric(h.add(new n.Vec2(d,d)),e,t,i),w=r.uv.divide(this.mosaicInfo.size),T=s.textureUVNextVertex1.divide(this.mosaicInfo.size),M=s.textureUVNextVertex2.divide(this.mosaicInfo.size),P={color:new n.Vec4(1,1,1,1),outlineSize:l,outlineColor:new n.Vec4(1,1,1,1),isSDF:c,distanceToPx:u};let I=new n.Float(0);return I=I.add(a.inTriangle(p).multiply(this._getColor(f(p,w,T,M),P).a)),I=I.add(a.inTriangle(m).multiply(this._getColor(f(m,w,T,M),P).a)),I=I.add(a.inTriangle(g).multiply(this._getColor(f(g,w,T,M),P).a)),I=I.add(a.inTriangle(_).multiply(this._getColor(f(_,w,T,M),P).a)),I=I.add(a.inTriangle(y).multiply(this._getColor(f(y,w,T,M),P).a)),I=I.add(a.inTriangle(x).multiply(this._getColor(f(x,w,T,M),P).a)),I=I.add(a.inTriangle(b).multiply(this._getColor(f(b,w,T,M),P).a)),I=I.add(a.inTriangle(v).multiply(this._getColor(f(v,w,T,M),P).a)),I=I.add(a.inTriangle(S).multiply(this._getColor(f(S,w,T,M),P).a)),n.step(I,new n.Float(.05)).multiply(a.failHittest(this.hittestRequest))}}t.__decorate([t.__param(0,r.input(u)),t.__param(1,r.input(h))],p.prototype,"vertex",null),t.__decorate([t.__param(0,r.input(d))],p.prototype,"fragment",null),e.AnimatedMarkerFragmentInput=d,e.AnimatedMarkerShader=p,e.AnimatedMarkerVertexInput=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedTechnique":function(){define(["exports","../../../../../../../core/libs/gl-matrix-2/math/mat3","../../../../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../../../../symbols/cim/animationDebugFlags","../FeatureTechnique","../featureTechniqueUtils"],function(e,t,i,r,n,s){"use strict";class o extends n.FeatureTechnique{render(e,n){const{context:o,painter:a}=e,{target:l}=n,{freezeGlobalTime:c}=r.animationDebugFlags,u=a.textureManager.animationStore.getTexture(o,0),h=[2/e.state.size[0],0,0,0,-2/e.state.size[1],0,-1,1,1],d=Array.from(t.invert(i.create(),h)),f=Array.from(t.multiply(i.create(),d,l.transforms.displayViewScreenMat3)),p=n.instance.getInput(),m=a.textureManager.getMosaicInfo(o,n.textureKey,!1),{optionalAttributes:g}=p,_=g.zoomRange,y=g.value1Position2Value2,x="accumulatedDistance"in g&&g.accumulatedDistance,b="segmentDirection"in g&&g.segmentDirection,v="normal"in g&&g.normal;a.setShader({shader:this.shaders.geometry,uniforms:{...s.resolveDynamicUniforms(e,n.target,p.uniforms),...s.getFeatureUniforms(e,n.target),mosaicInfo:m,animationInfo:{globalTime:!1===c?e.time/1e3:c,animationTextureSize:[u.descriptor.width,u.descriptor.height],animationTexture:{unit:6,texture:u},toScreen:f,toNdc:h,mapRotation:e.state.rotation,pixelRatio:e.state.pixelRatio},localTileOffset:s.getLocalTileOffset(n.target)},defines:{...s.getSelectionDefines(e)},optionalAttributes:{zoomRange:_,value1Position2Value2:y,accumulatedDistance:x,segmentDirection:b,normal:v},useComputeBuffer:!0}),a.setPipelineState({...s.getFeaturePipelineState(e)}),a.submitDraw(e,n),!1===c&&l.requestRender()}}e.AnimatedTechnique=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/FeatureTechnique":function(){define(["exports","./Technique"],function(e,t){"use strict";class i extends t.Technique{constructor(){super(...arguments),this.symbologyPlane=0,this._input=null}}e.FeatureTechnique=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityTechnique":function(){define(["exports","../../../definitions","../FeatureTechnique","../featureTechniqueUtils","./DotDensityPointShader","./DotDensityPolygonShader","./DotDensityResources","../shaders/FillShader"],function(e,t,i,r,n,s,o,a){"use strict";class l extends i.FeatureTechnique{constructor(){super(...arguments),this.type=8,this.shaders={polygon:new s.DotDensityPolygonShader,point:new n.DotDensityPointShader,fill:new a.FillShader},this._resources=new Map}render(e,t){r.isHighlight(e)||r.isHittest(e)?this._renderPolygons(e,t):this._renderDotDensity(e,t)}_renderPolygons(e,t){const{painter:i}=e;i.setShader({shader:this.shaders.fill,uniforms:{...r.getFeatureUniforms(e,t.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...r.getSelectionDefines(e)},optionalAttributes:{zoomRange:!1},useComputeBuffer:r.isHittest(e)}),i.setPipelineState(r.getFeaturePipelineState(e)),i.submitDraw(e,t)}_renderDotDensity(e,i){const{context:n,painter:s,requiredLevel:o}=e,a=i.instance.getInput().uniforms,l=this._getOrCreateResourcesRecord(n),c=l.getDotDensityTextures(n,t.tileSize,a.seed),u=1/2**(o-i.target.key.level),h=t.tileSize,d=h*window.devicePixelRatio*h*window.devicePixelRatio,f=1/u*(1/u),p=a.dotScale?e.state.scale/a.dotScale:1,m=a.dotValue*p*f;s.setShader({shader:this.shaders.polygon,uniforms:{...r.getFeatureUniforms(e,i.target),instance:{isActive:a.isActive,colors:a.colors,dotValue:Math.max(1,m)},draw:{dotTexture0:{unit:t.textureBindingRenderer0,texture:c[0]},dotTexture1:{unit:t.textureBindingRenderer1,texture:c[1]},tileZoomFactor:u,pixelRatio:window.devicePixelRatio,tileDotsOverArea:d/(t.tileSize*window.devicePixelRatio*t.tileSize*window.devicePixelRatio)}},defines:{...r.getSelectionDefines(e),blending:a.blending},optionalAttributes:{},useComputeBuffer:!1});const g=n.getViewport();n.setViewport(0,0,t.tileSize,t.tileSize);const _=n.getBoundFramebufferObject(),y=l.getFBO(n);n.bindFramebuffer(y),n.setClearColor(0,0,0,0),n.clear(16384),s.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),s.updatePipelineState(n),s.submitDraw(e,i),n.bindFramebuffer(_),n.setViewport(g.x,g.y,g.width,g.height);const x=l.getFBO(n).colorTexture,b={shader:this.shaders.point,uniforms:{view:r.getViewUniforms(e,i.target),instance:{dotSize:a.dotSize},draw:{locations:{unit:t.textureBindingRenderer0,texture:x},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...r.getSelectionDefines(e)},optionalAttributes:{},useComputeBuffer:!1};s.setPipelineState(r.getFeaturePipelineState(e)),s.submitDrawMesh(n,b,l.getDotDensityMesh(n))}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e)}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new o.DotDensityResources,this._resources.set(e,t)),t}}e.DotDensityTechnique=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityPointShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../../definitions","../../GraphShaderModule","../../graph/glsl","../shaders/AFeatureShader","../shaders/ViewInfo"],function(e,t,i,r,n,s,o){"use strict";class a extends r.VertexInput{}t.__decorate([r.location(0,n.Vec2)],a.prototype,"pos",void 0);class l extends s.FeatureFragmentInput{}class c extends r.UniformGroup{}t.__decorate([r.uniform(n.Float)],c.prototype,"dotSize",void 0);class u extends r.UniformGroup{}t.__decorate([r.uniform(n.Sampler2D)],u.prototype,"locations",void 0),t.__decorate([r.uniform(n.Float)],u.prototype,"pixelRatio",void 0),t.__decorate([r.uniform(n.Float)],u.prototype,"tileZoomFactor",void 0);class h extends r.GraphShaderModule{constructor(){super(...arguments),this.type="DotDensityPointShader"}vertex(e){const t=new n.Mat3(1,0,0,0,-1,0,0,1,1).multiply(new n.Vec3(e.pos.xy.divide(i.tileSize),1)),r=n.texture2D(this.draw.locations,t.xy),s=n.max(this.instance.dotSize.divide(2),new n.Float(1));let o=new n.Float(0);o=o.add(n.step(r.a,new n.Float(1e-6)).multiply(2));let a=s.add(this.instance.dotSize);const l=this.view.displayViewScreenMat3.multiply(new n.Vec3(e.pos.add(.5),1)),c=new n.Vec4(l.xy,o,1),u=this.instance.dotSize.divide(a),h=new n.Float(-1).divide(s.divide(a));return a=a.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:c,glPointSize:a,color:r,ratio:u,invEdgeRatio:h}}fragment(e){const t=n.length(e.glPointCoord.subtract(.5)).multiply(2),i=n.smoothstep(new n.Float(0),new n.Float(1),e.invEdgeRatio.multiply(t.subtract(e.ratio)).add(1)),s=new r.FragmentOutput;return s.fragColor=e.color.multiply(i),s}}t.__decorate([r.uniform(c)],h.prototype,"instance",void 0),t.__decorate([r.uniform(u)],h.prototype,"draw",void 0),t.__decorate([r.uniform(o.ViewInfo)],h.prototype,"view",void 0),t.__decorate([t.__param(0,r.input(a))],h.prototype,"vertex",null),t.__decorate([t.__param(0,r.input(l))],h.prototype,"fragment",null),e.DotDensityPointDrawUniforms=u,e.DotDensityPointFragmentInput=l,e.DotDensityPointInstanceUniforms=c,e.DotDensityPointShader=h,e.DotDensityPointVertexInput=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityPolygonShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../../definitions","../../GraphShaderModule","../../graph/glsl","../shaders/AFeatureShader","../shaders/hittestUtils","../shaders/utils"],function(e,t,i,r,n,s,o,a){"use strict";class l extends s.FeatureVertexInput{}t.__decorate([r.location(3,n.Float)],l.prototype,"inverseArea",void 0);class c extends s.FeatureFragmentInput{}class u extends r.UniformGroup{}t.__decorate([r.uniform(n.FixedArray.ofType(n.Vec4,2))],u.prototype,"isActive",void 0),t.__decorate([r.uniform(n.FixedArray.ofType(n.Vec4,8))],u.prototype,"colors",void 0),t.__decorate([r.uniform(n.Float)],u.prototype,"dotValue",void 0);class h extends r.UniformGroup{}t.__decorate([r.uniform(n.Sampler2D)],h.prototype,"dotTexture0",void 0),t.__decorate([r.uniform(n.Sampler2D)],h.prototype,"dotTexture1",void 0),t.__decorate([r.uniform(n.Float)],h.prototype,"tileZoomFactor",void 0),t.__decorate([r.uniform(n.Float)],h.prototype,"pixelRatio",void 0),t.__decorate([r.uniform(n.Float)],h.prototype,"tileDotsOverArea",void 0);class d extends s.AFeatureShader{constructor(){super(...arguments),this.type="DotDensityPolygonShader"}_dotThreshold(e,t,i){return e.divide(t).divide(i)}vertex(e){const t=new n.Mat3(2/i.tileSize,0,0,0,-2/i.tileSize,0,-1,1,1).multiply(new n.Vec3(e.pos,1)),r=this.clip(e.id),s=new n.Vec4(t.xy,r,1),o=this.storage.getVVData(e.id).multiply(this.instance.isActive.get(0)).multiply(e.inverseArea),a=this.storage.getDataDrivenData0(e.id).multiply(this.instance.isActive.get(1)).multiply(e.inverseArea),l=this.draw.tileZoomFactor.multiply(i.tileSize).divide(this.draw.pixelRatio),c=this._dotThreshold(o,this.instance.dotValue,this.draw.tileDotsOverArea),u=this._dotThreshold(a,this.instance.dotValue,this.draw.tileDotsOverArea),h=e.pos.add(.5).divide(l);return{glPosition:s,color:new n.Vec4(0,0,0,0),textureCoords:h,thresholds0:c,thresholds1:u}}fragment(e){const t=new r.FragmentOutput,i=n.texture2D(this.draw.dotTexture0,e.textureCoords),s=n.texture2D(this.draw.dotTexture1,e.textureCoords),o=e.thresholds0.subtract(i),l=e.thresholds1.subtract(s);let c;const u=n.Mat4.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),h=n.Mat4.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const e=n.step(new n.Float(0),o),t=n.step(new n.Float(0),l),i=n.dot(e,o).add(n.dot(t,l)),r=n.step(i,new n.Float(0)),s=new n.Float(1).subtract(r),a=i.add(r),d=o.multiply(e).divide(a),f=l.multiply(t).divide(a),p=u.multiply(d).add(h.multiply(f));c=s.multiply(p)}else{const e=n.max(a.max4(o),a.max4(l)),t=n.step(e,new n.Float(0)),i=new n.Float(1).subtract(t),r=n.step(e,o),s=n.step(e,l),d=u.multiply(r).add(h.multiply(s));c=i.multiply(d)}return t.fragColor=c,t}hittest(e){return o.failHittest(this.hittestRequest)}}t.__decorate([r.define],d.prototype,"blending",void 0),t.__decorate([r.uniform(u)],d.prototype,"instance",void 0),t.__decorate([r.uniform(h)],d.prototype,"draw",void 0),t.__decorate([t.__param(0,r.input(l))],d.prototype,"vertex",null),t.__decorate([t.__param(0,r.input(s.FeatureFragmentInput))],d.prototype,"fragment",null),e.DotDensityPolygonDrawUniforms=h,e.DotDensityPolygonFragmentInput=c,e.DotDensityPolygonInstanceUniforms=u,e.DotDensityPolygonShader=d,e.DotDensityPolygonVertexInput=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityResources":function(){define(["exports","../../../../../../../core/RandomLCG","../../../definitions","../../../meshing/SimpleMesh","../../../../../../webgl/enums","../../../../../../webgl/FramebufferObject","../../../../../../webgl/Renderbuffer","../../../../../../webgl/RenderbufferDescriptor","../../../../../../webgl/Texture","../../../../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a,l,c){"use strict";const u={pos:{count:2,type:n.DataType.UNSIGNED_SHORT}};e.DotDensityResources=class{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy()}getFBO(e){if(null==this._dotFBO){const t=i.tileSize,r=i.tileSize,l=new c.TextureDescriptor(t,r);l.samplingMode=9728,l.wrapMode=33071;const u=new o.Renderbuffer(e,new a.RenderbufferDescriptor(n.SizedDepthStencilFormat.DEPTH24_STENCIL8,t,r));this._dotFBO=new s.FramebufferObject(e,l,u)}return this._dotFBO}getDotDensityMesh(e){if(null==this._dotMesh){const t=i.tileSize,s=t*t,o=2,a=new Int16Array(s*o);for(let e=0;e<t;e++)for(let i=0;i<t;i++)a[o*(i+e*t)]=i,a[o*(i+e*t)+1]=e;this._dotMesh=r.SimpleMesh.create(e,{primitive:n.PrimitiveType.POINTS,vertex:a,count:s,layout:u})}return this._dotMesh}getDotDensityTextures(e,i,r){if(this._dotTextureSize===i&&this._seed===r||(this._disposeTextures(),this._dotTextureSize=i,this._seed=r),null===this._dotTextures){const n=new t(r);this._dotTextures=[this._allocDotDensityTexture(e,i,n),this._allocDotDensityTexture(e,i,n)]}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let e=0;e<this._dotTextures.length;e++)this._dotTextures[e].dispose();this._dotTextures=null}}_allocDotDensityTexture(e,t,i){const r=new Float32Array(t*t*4);for(let e=0;e<r.length;e++)r[e]=i.getFloat();const s=new c.TextureDescriptor(t);return s.dataType=n.PixelType.FLOAT,s.samplingMode=9728,new l.Texture(e,s,r)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../shaders/ComplexFillShader"],function(e,t,i,r){"use strict";class n extends t.FeatureTechnique{constructor(){super(...arguments),this.type=6,this.shaders={geometry:new r.ComplexFillShader}}render(e,t){const{context:r,painter:n}=e,s=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,s.uniforms),...i.getFeatureUniforms(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(r,t.textureKey),localTileOffset:i.getLocalTileOffset(t.target)},defines:{...i.getSelectionDefines(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:i.isHittest(e)}),n.setPipelineState(i.getFeaturePipelineState(e)),n.submitDraw(e,t)}}e.ComplexFillTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../line/utils","../shaders/ComplexOutlineFillShader"],function(e,t,i,r,n){"use strict";class s extends t.FeatureTechnique{constructor(){super(...arguments),this.type=7,this.shaders={geometry:new n.ComplexOutlineFillShader}}render(e,t){const{context:n,painter:s,pixelRatio:o}=e,a=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,a.uniforms),...i.getFeatureUniforms(e,t.target),antialiasingControls:r.getAntialiasingControls(o),mosaicInfo:s.textureManager.getMosaicInfo(n,t.textureKey),localTileOffset:i.getLocalTileOffset(t.target)},defines:{...i.getSelectionDefines(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:i.isHittest(e)}),s.setPipelineState(i.getFeaturePipelineState(e)),s.submitDraw(e,t)}}e.ComplexOutlineFillTechnique=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/utils":function(){define(["exports"],function(e){"use strict";e.getAntialiasingControls=function(e){const t=1/e;return{antialiasing:t,blur:0+t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/ComplexOutlineFillShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./ComplexFillShader","./constants","./hittestUtils","./LineShader","./LocalTileOffset","./MosaicInfo","./OutlineFillShader","./PatternOutlineFillShader"],function(e,t,i,r,n,s,o,a,l,c,u,h,d){"use strict";const f=1/o.packPrecision;class p extends n.FeatureVertexInput{}t.__decorate([i.location(3,r.Vec4)],p.prototype,"color",void 0),t.__decorate([i.location(4,r.Vec4)],p.prototype,"tlbr",void 0),t.__decorate([i.location(5,r.Float)],p.prototype,"angle",void 0),t.__decorate([i.location(6,r.Float)],p.prototype,"aux1",void 0),t.__decorate([i.location(7,r.Float)],p.prototype,"aux2",void 0),t.__decorate([i.location(8,r.Vec2)],p.prototype,"aux3",void 0),t.__decorate([i.location(9,r.Vec2)],p.prototype,"aux4",void 0),t.__decorate([i.location(10,r.Vec2)],p.prototype,"zoomRange",void 0);class m extends d.PatternOutlineFillFragmentInput{}class g extends h.AOutlineFillShader{constructor(){super(...arguments),this.type="ComplexOutlineFillShader"}vertex(e,t){const{aux1:i,aux2:n,aux3:a,aux4:l}=e,c={...e,width:i,height:n,offset:a,scale:l.multiply(f)},u={...e,halfWidth:i,referenceHalfWidth:n,offset:a,normal:l.subtract(o.signedToUnsignedByte).multiply(f)},d=h.getOutlineFillVertexData(this,u),p=s.getComplexFillVertexData(this,c),m=r.greaterThan(d.isOutline,new r.Float(.5));return{...d,...p,...Object.assign({},this.maybeRunHittest(e,t,m))}}fragment(e){const{isOutline:t}=e,i=r.greaterThan(t,new r.Float(.5)),n=l.getLineFragmentColor(e,this.antialiasingControls.blur),o=s.getComplexFillFragmentColor(this,e),a=r.ifElse(i,n,o),c=r.ifElse(i,new r.Float(1/255),new r.Float(0));return this.getFragmentOutput(a,e,c)}hittest(e,t,i){return r.ifElse(i,a.failHittest(this.hittestRequest),a.hittestFill(this,e,t))}}t.__decorate([i.uniform(u.MosaicInfo)],g.prototype,"mosaicInfo",void 0),t.__decorate([i.uniform(c.LocalTileOffset)],g.prototype,"localTileOffset",void 0),t.__decorate([t.__param(0,i.input(p)),t.__param(1,i.input(n.BaseHittestVertexInput))],g.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(m))],g.prototype,"fragment",null),e.ComplexOutlineFillShader=g,e.ComplexOutlineFillVertexInput=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OutlineFillShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./constants","./hittestUtils","./LineShader","./utils","./VisualVariableColor","./VisualVariableOpacity","./VisualVariableSizeMinMaxValue","./VisualVariableSizeScaleStops","./VisualVariableSizeStops","./VisualVariableSizeUnitValue","./vvUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m){"use strict";class g extends n.FeatureVertexInput{}t.__decorate([i.location(3,r.Vec2)],g.prototype,"offset",void 0),t.__decorate([i.location(4,r.Vec4)],g.prototype,"color",void 0),t.__decorate([i.location(5,r.Vec2)],g.prototype,"normal",void 0),t.__decorate([i.location(6,r.Float)],g.prototype,"halfWidth",void 0),t.__decorate([i.location(7,r.Float)],g.prototype,"referenceHalfWidth",void 0),t.__decorate([i.location(8,r.Vec2)],g.prototype,"zoomRange",void 0);class _ extends a.LineFragmentInput{}function y(e,t,i){const{id:n,bitset:o}=t,c=l.getBit(o,s.bitsetTypeFillOutline),u=r.greaterThan(c,new r.Float(.5)),h=a.getLineVertexData(e,t),d=r.ifElse(u,h.halfWidth,new r.Float(0)),f=m.getVisualVariableOpacity(e,n),p=m.getVisualVariableColor(e,n,t.color),g=r.ifElse(u,r.ifElse(l.getBitBool(o,s.bitsetOutlineUsesColorVV),p,t.color),p.multiply(f)),_=e.view.displayViewScreenMat3.multiply(new r.Vec3(t.pos.xy,1)),y=e.clip(t.id),x=new r.Vec4(_.xy,y,1),b=r.ifElse(u,h.glPosition,x),v=i&&e.maybeRunHittest(t,i,u);return{isOutline:c,color:g,opacity:new r.Float(1),halfWidth:d,normal:h.normal,glPosition:b,...v}}class x extends n.AFeatureShader{constructor(){super(...arguments),this.computeAttributes={pos:["nextPos1","nextPos2"]}}}t.__decorate([i.uniform(a.AntialiasingControls)],x.prototype,"antialiasingControls",void 0),t.__decorate([i.option(c.VisualVariableColor)],x.prototype,"visualVariableColor",void 0),t.__decorate([i.option(u.VisualVariableOpacity)],x.prototype,"visualVariableOpacity",void 0),t.__decorate([i.option(h.VisualVariableSizeMinMaxValue)],x.prototype,"visualVariableSizeMinMaxValue",void 0),t.__decorate([i.option(d.VisualVariableSizeScaleStops)],x.prototype,"visualVariableSizeScaleStops",void 0),t.__decorate([i.option(f.VisualVariableSizeStops)],x.prototype,"visualVariableSizeStops",void 0),t.__decorate([i.option(p.VisualVariableSizeUnitValue)],x.prototype,"visualVariableSizeUnitValue",void 0);class b extends x{constructor(){super(...arguments),this.type="OutlineFillShader"}vertex(e,t){return y(this,e,t)}fragment(e){const{color:t,isOutline:i}=e,n=r.greaterThan(i,new r.Float(.5)),s=a.getLineFragmentColor(e,this.antialiasingControls.blur),o=t,l=r.ifElse(n,s,o),c=r.ifElse(n,new r.Float(1/255),new r.Float(0));return this.getFragmentOutput(l,e,c)}hittest(e,t,i){return r.ifElse(i,o.failHittest(this.hittestRequest),o.hittestFill(this,e,t))}}t.__decorate([t.__param(0,i.input(g)),t.__param(1,i.input(n.BaseHittestVertexInput))],b.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(_))],b.prototype,"fragment",null),e.AOutlineFillShader=x,e.OutlineFillFragmentInput=_,e.OutlineFillShader=b,e.OutlineFillVertexInput=g,e.getOutlineFillVertexData=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternOutlineFillShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./LineShader","./LocalTileOffset","./MosaicInfo","./OutlineFillShader","./PatternFillShader"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u extends l.OutlineFillVertexInput{}t.__decorate([i.location(9,r.Vec4)],u.prototype,"tlbr",void 0),t.__decorate([i.location(10,r.Float)],u.prototype,"inverseRasterizationScale",void 0);class h extends l.OutlineFillFragmentInput{}class d extends l.OutlineFillShader{constructor(){super(...arguments),this.type="PatternOutlineFillShader"}vertex(e,t){return{...l.getOutlineFillVertexData(this,e,t),...c.getPatternFillVertexData(this,e)}}fragment(e){const{isOutline:t}=e,i=r.greaterThan(t,new r.Float(.5)),n=s.getLineFragmentColor(e,this.antialiasingControls.blur),o=c.getPatternFillFragmentColor(e,this.mosaicInfo),a=r.ifElse(i,n,o),l=r.ifElse(i,new r.Float(1/255),new r.Float(0));return this.getFragmentOutput(a,e,l)}}t.__decorate([i.uniform(a.MosaicInfo)],d.prototype,"mosaicInfo",void 0),t.__decorate([i.uniform(o.LocalTileOffset)],d.prototype,"localTileOffset",void 0),t.__decorate([t.__param(0,i.input(u)),t.__param(1,i.input(n.BaseHittestVertexInput))],d.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(h))],d.prototype,"fragment",null),e.PatternOutlineFillFragmentInput=h,e.PatternOutlineFillShader=d,e.PatternOutlineFillVertexInput=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/PatternFillShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./FillShader","./LocalTileOffset","./MosaicInfo"],function(e,t,i,r,n,s,o,a){"use strict";class l extends s.FillVertexInput{}t.__decorate([i.location(5,r.Vec4)],l.prototype,"tlbr",void 0),t.__decorate([i.location(6,r.Float)],l.prototype,"inverseRasterizationScale",void 0);class c extends n.FeatureFragmentInput{}function u(e,t){const i=t.tlbr.xy,n=t.tlbr.zw,s=n.x.subtract(i.x),o=i.y.subtract(n.y),a=new r.Vec2(s,o).multiply(t.inverseRasterizationScale),l=a.multiply(e.view.requiredZoomFactor),c=function(e){const t=new r.Float(1),i=new r.Float(0);return new r.Mat3(t.divide(e.x),i.divide(e.y),0,r.negate(i.divide(e.x)),t.divide(e.y),0,0,0,1)}(l),u=e.localTileOffset.getPatternOffsetAtTileOrigin(a).divide(l),h=new r.Vec3(t.pos,1);return{tileTextureCoord:c.multiply(h).xy.subtract(u),tlbr:t.tlbr.divide(e.mosaicInfo.size.xyxy)}}function h(e,t){const i=r.mod(e.tileTextureCoord,new r.Float(1)),n=r.mix(e.tlbr.xy,e.tlbr.zw,i),s=r.texture2D(t.texture,n);return e.color.multiply(s)}class d extends s.FillShader{constructor(){super(...arguments),this.type="PatternFillShader"}vertex(e,t){return{...super.vertex(e,t),...u(this,e)}}fragment(e){const t=h(e,this.mosaicInfo);return this.getFragmentOutput(t,e,new r.Float(0))}}t.__decorate([i.uniform(a.MosaicInfo)],d.prototype,"mosaicInfo",void 0),t.__decorate([i.uniform(o.LocalTileOffset)],d.prototype,"localTileOffset",void 0),t.__decorate([t.__param(0,i.input(l)),t.__param(1,i.input(n.BaseHittestVertexInput))],d.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(c))],d.prototype,"fragment",null),e.PatternFillFragmentInput=c,e.PatternFillShader=d,e.PatternFillVertexInput=l,e.getPatternFillFragmentColor=h,e.getPatternFillVertexData=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../shaders/FillShader"],function(e,t,i,r){"use strict";class n extends t.FeatureTechnique{constructor(){super(...arguments),this.type=9,this.shaders={geometry:new r.FillShader}}render(e,t){const{painter:r}=e,n=t.instance.getInput();r.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,n.uniforms),...i.getFeatureUniforms(e,t.target)},defines:i.getSelectionDefines(e),optionalAttributes:n.optionalAttributes,useComputeBuffer:i.isHittest(e)}),r.setPipelineState(i.getFeaturePipelineState(e)),r.submitDraw(e,t)}}e.FillTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../shaders/GradientFillShader"],function(e,t,i,r){"use strict";class n extends t.FeatureTechnique{constructor(){super(...arguments),this.type=10,this.shaders={geometry:new r.GradientFillShader},this.symbologyPlane=0}render(e,t){const{context:r,painter:n}=e,s=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,s.uniforms),...i.getFeatureUniforms(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(r,t.textureKey)},defines:{...i.getSelectionDefines(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:i.isHittest(e)}),n.setPipelineState(i.getFeaturePipelineState(e)),n.submitDraw(e,t)}}e.GradientFillTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/GradientFillShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","../fill/gradientFillConstants","./AFeatureShader","./FillShader","./MosaicInfo","./utils"],function(e,t,i,r,n,s,o,a,l){"use strict";class c extends o.FillVertexInput{}t.__decorate([i.location(5,r.Vec4)],c.prototype,"tlbr",void 0),t.__decorate([i.location(6,r.Vec2)],c.prototype,"relativePosition",void 0),t.__decorate([i.location(7,r.Float)],c.prototype,"gradientMethod",void 0),t.__decorate([i.location(8,r.Vec2)],c.prototype,"relativeGradientSize",void 0);class u extends s.FeatureFragmentInput{}class h extends o.FillShader{constructor(){super(...arguments),this.type="GradientFillShader"}vertex(e,t){const{tlbr:i,relativePosition:s,gradientMethod:o,relativeGradientSize:a}=e,c=r.ifElse(l.getBitBool(e.bitset,n.bitset.isAbsolute),this.view.displayZoomFactor,new r.Float(1));return{...super.vertex(e,t),tlbr:i,relativePosition:s,gradientMethod:o,gradientSize:a.multiply(c),isDiscrete:l.getBit(e.bitset,n.bitset.isDiscrete)}}fragment(e){const{tlbr:t,relativePosition:i,gradientMethod:s,gradientSize:o,isDiscrete:a}=e,c=r.ifElse(r.greaterThan(a,new r.Float(.5)),o.subtract(1),new r.Vec2(0)),u=r.cond([r.equal(s,new r.Float(n.gradientFillMethods.rectangular)),()=>{const e=r.abs(i).add(c).divide(o);return l.oneMinus(r.max(e.x,e.y))}],[r.equal(s,new r.Float(n.gradientFillMethods.circular)),l.oneMinus(r.sqrt(r.dot(i,i)).add(c.x).divide(o.x))],[!0,l.oneMinus(i.x.add(c.x).divide(o.x))]),h=new r.Vec2(r.clamp(u,new r.Float(0),new r.Float(1)),.5),d=r.mix(t.xy,t.zw,h).divide(this.mosaicInfo.size),f=r.texture2D(this.mosaicInfo.texture,d),p=e.color.a;return this.getFragmentOutput(f.multiply(p),e,new r.Float(0))}}t.__decorate([i.uniform(a.MosaicInfo)],h.prototype,"mosaicInfo",void 0),t.__decorate([t.__param(0,i.input(c)),t.__param(1,i.input(s.BaseHittestVertexInput))],h.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(u))],h.prototype,"fragment",null),e.GradientFillFragmentInput=u,e.GradientFillShader=h,e.GradientFillVertexInput=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/gradientFillConstants":function(){define(["exports"],function(e){"use strict";e.bitset={isAbsolute:0,isDiscrete:1},e.gradientFillMethods={linear:0,rectangular:1,circular:2},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../line/utils","../shaders/OutlineFillShader"],function(e,t,i,r,n){"use strict";class s extends t.FeatureTechnique{constructor(){super(...arguments),this.type=19,this.shaders={geometry:new n.OutlineFillShader}}render(e,t){const{painter:n,pixelRatio:s}=e,o=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,o.uniforms),...i.getFeatureUniforms(e,t.target),antialiasingControls:r.getAntialiasingControls(s)},defines:{...i.getSelectionDefines(e)},optionalAttributes:o.optionalAttributes,useComputeBuffer:i.isHittest(e)}),n.setPipelineState(i.getFeaturePipelineState(e)),n.submitDraw(e,t)}}e.OutlineFillTechnique=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../shaders/PatternFillShader"],function(e,t,i,r){"use strict";class n extends t.FeatureTechnique{constructor(){super(...arguments),this.type=21,this.shaders={geometry:new r.PatternFillShader}}render(e,t){const{context:r,painter:n}=e,s=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,s.uniforms),...i.getFeatureUniforms(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(r,t.textureKey),localTileOffset:i.getLocalTileOffset(t.target)},defines:{...i.getSelectionDefines(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:i.isHittest(e)}),n.setPipelineState(i.getFeaturePipelineState(e)),n.submitDraw(e,t)}}e.PatternFillTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../line/utils","../shaders/PatternOutlineFillShader"],function(e,t,i,r,n){"use strict";class s extends t.FeatureTechnique{constructor(){super(...arguments),this.type=22,this.shaders={geometry:new n.PatternOutlineFillShader}}render(e,t){const{context:n,painter:s,pixelRatio:o}=e,a=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,a.uniforms),...i.getFeatureUniforms(e,t.target),antialiasingControls:r.getAntialiasingControls(o),mosaicInfo:s.textureManager.getMosaicInfo(n,t.textureKey),localTileOffset:i.getLocalTileOffset(t.target)},defines:{...i.getSelectionDefines(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:i.isHittest(e)}),s.setPipelineState(i.getFeaturePipelineState(e)),s.submitDraw(e,t)}}e.PatternOutlineFillTechnique=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","./HeatmapResources","../shaders/HeatmapAccumulateShader","../shaders/HeatmapResolveShader"],function(e,t,i,r,n,s){"use strict";class o extends t.FeatureTechnique{constructor(){super(...arguments),this.type=13,this.drawPhase=73,this.shaders={accumulate:new n.HeatmapAccumulateShader,resolve:new s.HeatmapResolveShader},this._isBound=!1,this._resources=new Map}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e),this._prevFBO=null,this._unbind()}render(e,t){const{context:r,painter:n,state:s}=e,o=t.instance.getInput(),{isFieldActive:a}=o.uniforms,u=this._getOrCreateResourcesRecord(r),d=u.loadQualityProfile(r);i.isHittest(e)||this._bind(e,u,o),n.setShader({shader:this.shaders.accumulate,uniforms:{...i.getFeatureUniforms(e,t.target),kernelControls:{radius:h(o,s),isFieldActive:a?1:0}},defines:{...i.getSelectionDefines(e),...d.defines},optionalAttributes:{},useComputeBuffer:i.isHittest(e)});const f=i.isHittest(e)?c:l;n.setPipelineState(f),n.submitDraw(e,t)}getStencilReference(e){return a(e)}renderResolvePass(e,t){if(i.isHittest(e))return;const{context:r,painter:n}=e,s=this._resources.get(r);if(null==this._prevFBO||null==this._prevViewport||!s?.initialized)return;const{defines:o}=s.loadQualityProfile(r),{minDensity:a,maxDensity:l,radius:c}=t.getInput().uniforms,h=s.accumulateFramebuffer,d=s.resolveGradientTexture,f={shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:8,texture:h.colorTexture},minAndInvRange:[a,1/(l-a)],normalization:3/(c*c*Math.PI)},gradient:{texture:{unit:9,texture:d}}},defines:o,optionalAttributes:{},useComputeBuffer:!1};r.bindFramebuffer(this._prevFBO),r.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),r.bindTexture(h.colorTexture,8),r.bindTexture(d,9),n.setPipelineState(u),n.submitDrawMesh(r,f,n.quadMesh),this._unbind()}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new r.HeatmapResources,this._resources.set(e,t)),t}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1}_bind(e,t,i){if(this._isBound)return;const{context:r,state:n,pixelRatio:s}=e,o=r.getBoundFramebufferObject(),a=r.getViewport();this._prevFBO=o,this._prevViewport=a;const{gradient:l,gradientHash:c}=i.uniforms;t.ensureResolveGradientTexture(r,c,l);const{width:u,height:d}=a,f=function(e,t){const i=t>1.5?.25:.5;return e<1/(2*i)?1:i}(h(i,n),s),p=u*f,m=d*f,g=t.ensureAccumulateFBO(r,p,m);r.blitFramebuffer(o,g,1024),r.bindFramebuffer(g),r.setViewport(0,0,g.width,g.height),r.setColorMask(!0,!0,!0,!0),r.setClearColor(0,0,0,0),r.clear(16384),this._isBound=!0}}function a(e){return e.key.level+1}const l={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:a,compare:518,mask:255,op:{fail:7680,zFail:7680,zPass:7681}}}},c={...l,stencil:!1},u={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function h(e,t){const{referenceScale:i,radius:r}=e.uniforms;return r*(0!==i?i/t.scale:1)}e.HeatmapTechnique=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapResources":function(){define(["exports","../../../../../../../core/Logger","../../../../../../../core/maybe","../../../../../../webgl/enums","../../../../../../webgl/FramebufferObject","../../../../../../webgl/heatmapTextureUtils","../../../../../../webgl/RenderbufferDescriptor","../../../../../../webgl/Texture","../../../../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a,l){"use strict";e.HeatmapResources=class{destroy(){this._accumulateFramebuffer=i.disposeMaybe(this._accumulateFramebuffer),this._resolveGradientTexture=i.disposeMaybe(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(e){if(null==this._qualityProfile){const i=s.loadHeatmapTextureConfiguration(e,t.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources"));this._qualityProfile={...i,defines:{usesHalfFloatPrecision:i.dataType!==r.PixelType.FLOAT}}}return this._qualityProfile}ensureAccumulateFBO(e,t,i){if(null==this._accumulateFramebuffer){const{dataType:s,samplingMode:a,pixelFormat:c,internalFormat:u}=this.loadQualityProfile(e),h=new l.TextureDescriptor(t,i);h.pixelFormat=c,h.internalFormat=u,h.dataType=s,h.samplingMode=a,h.wrapMode=33071;const d=new o.RenderbufferDescriptor(r.SizedDepthStencilFormat.DEPTH24_STENCIL8,t,i);this._accumulateFramebuffer=new n.FramebufferObject(e,h,d)}else{const{width:e,height:r}=this._accumulateFramebuffer;e===t&&r===i||this._accumulateFramebuffer.resize(t,i)}return this._accumulateFramebuffer}ensureResolveGradientTexture(e,t,i){if(null==this._resolveGradientTexture){const t=new l.TextureDescriptor;t.wrapMode=33071,this._resolveGradientTexture=new a.Texture(e,t),this._prevGradientHash=null}return this._prevGradientHash!==t&&(this._resolveGradientTexture.resize(i.length/4,1),this._resolveGradientTexture.setData(i),this._prevGradientHash=t),this._resolveGradientTexture}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","./enums"],function(e,t,i){"use strict";class r{constructor(e,t,i,r){this.dataType=e,this.samplingMode=t,this.pixelFormat=i,this.internalFormat=r}}const n=new r(i.PixelType.HALF_FLOAT,9728,6408,6408);e.HeatmapTextureConfiguration=r,e.fallBackHeatmapConfiguration=n,e.loadHeatmapTextureConfiguration=function(e,n){const{textureFloatLinear:s,colorBufferFloat:o}=e.capabilities,a=o?.textureFloat,l=o?.textureHalfFloat,c=o?.floatBlend,u=e.driverTest.floatBufferBlend.result;if(!a&&!l)throw new t("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(c&&u||l))throw new t("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(u?"":" This device claims support for EXT_float_blend, but does not actually support it."));const h=a&&c&&u,d=l,f=s,p=!!o?.R32F,m=!!o?.R16F;if(h&&f)return f||n.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new r(i.PixelType.FLOAT,f?9729:9728,p?6403:6408,p?i.SizedPixelFormat.R32F:6408);if(d)return new r(i.PixelType.HALF_FLOAT,9729,m?6403:6408,m?i.SizedPixelFormat.R16F:6408);throw new t("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/HeatmapAccumulateShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./heatmapUtils","./hittestUtils"],function(e,t,i,r,n,s,o){"use strict";class a extends n.FeatureVertexInput{}t.__decorate([i.location(5,r.Vec2)],a.prototype,"offset",void 0);class l extends n.FeatureFragmentInput{}class c extends i.UniformGroup{}t.__decorate([i.uniform(r.Float)],c.prototype,"radius",void 0),t.__decorate([i.uniform(r.Float)],c.prototype,"isFieldActive",void 0);class u extends n.AFeatureShader{constructor(){super(...arguments),this.type="HeatmapAccumulateShader",this.usesHalfFloatPrecision=!1}vertex(e){const{radius:t,isFieldActive:i}=this.kernelControls,n=e.offset,s=i.multiply(this.storage.getVVData(e.id).x).add(new r.Float(1).subtract(i)),o=this.view.displayViewScreenMat3.multiply(new r.Vec3(e.pos,1)).add(this.view.displayViewMat3.multiply(new r.Vec3(n,0)).multiply(t)),a=this.clip(e.id);return{glPosition:new r.Vec4(o.xy,a,1),offset:n,fieldValue:s,color:new r.Vec4(0),...this.maybeRunHittest(e,{},null)}}fragment(e){const{offset:t,fieldValue:i}=e,n=r.length(t),o=r.step(n,new r.Float(1)),a=new r.Float(1).subtract(n.multiply(n)),l=a.multiply(a),c=o.multiply(l).multiply(i).multiply(new r.Float(s.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new r.Vec4(c),e)}hittest(e){const{viewMat3:t,tileMat3:i}=this.view,n=t.multiply(i).multiply(new r.Vec3(e.pos,1));return o.hittestMarker(n.xy,this.kernelControls.radius,this.hittestRequest.position)}}t.__decorate([i.define],u.prototype,"usesHalfFloatPrecision",void 0),t.__decorate([i.uniform(c)],u.prototype,"kernelControls",void 0),t.__decorate([t.__param(0,i.input(a))],u.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(l))],u.prototype,"fragment",null),e.HeatmapAccumulateFragmentInput=l,e.HeatmapAccumulateShader=u,e.HeatmapAccumulateVertexInput=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/heatmapUtils":function(){define(["exports"],function(e){"use strict";e.getHeatmapCompressionFactor=function(e){return e?.25:1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/HeatmapResolveShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./heatmapUtils"],function(e,t,i,r,n){"use strict";class s extends i.VertexInput{}t.__decorate([i.location(0,r.Vec2)],s.prototype,"position",void 0);class o extends i.FragmentInput{}class a extends i.UniformGroup{}t.__decorate([i.uniform(r.Sampler2D)],a.prototype,"texture",void 0),t.__decorate([i.uniform(r.Vec2)],a.prototype,"minAndInvRange",void 0),t.__decorate([i.uniform(r.Float)],a.prototype,"normalization",void 0);class l extends i.UniformGroup{}t.__decorate([i.uniform(r.Sampler2D)],l.prototype,"texture",void 0);class c extends i.GraphShaderModule{constructor(){super(...arguments),this.type="HeatmapResolveShader",this.usesHalfFloatPrecision=!1}vertex(e){return{glPosition:new r.Vec4(e.position.multiply(2).subtract(1),1,1),uv:e.position}}fragment(e){const{accumulatedDensity:t,gradient:s}=this;let o=r.texture2D(t.texture,e.uv).r.divide(new r.Float(n.getHeatmapCompressionFactor(this.usesHalfFloatPrecision)));o=o.multiply(t.normalization),o=o.subtract(t.minAndInvRange.x).multiply(t.minAndInvRange.y);const a=r.texture2D(s.texture,new r.Vec2(o,.5)),l=new i.FragmentOutput;return l.fragColor=new r.Vec4(a.rgb.multiply(a.a),a.a),l}}t.__decorate([i.define],c.prototype,"usesHalfFloatPrecision",void 0),t.__decorate([i.uniform(a)],c.prototype,"accumulatedDensity",void 0),t.__decorate([i.uniform(l)],c.prototype,"gradient",void 0),t.__decorate([t.__param(0,i.input(s))],c.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(o))],c.prototype,"fragment",null),e.AccumulatedDensity=a,e.Gradient=l,e.HeatmapResolveFragmentInput=o,e.HeatmapResolveShader=c,e.HeatmapResolveVertexInput=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","../text/TextShader"],function(e,t,i,r){"use strict";class n extends t.FeatureTechnique{constructor(){super(...arguments),this.type=14,this.shaders={geometry:new r.TextShader},this.drawPhase=14,this.symbologyPlane=3}render(e,t){const{context:r,painter:n}=e,s=i.getSelectionDefines(e),o={...i.getFeaturePipelineState(e),stencil:{write:!1,test:{ref:()=>255,compare:516,mask:255,op:{fail:7680,zFail:7680,zPass:7680}}}},a=t.instance.getInput(),l={shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,a.uniforms),...i.getFeatureUniforms(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(r,t.textureKey)},defines:{...s,textRenderPassType:0,isBackgroundPass:!0,isLabel:!0},optionalAttributes:a.optionalAttributes,useComputeBuffer:i.isHittest(e)};n.setPipelineState(o),n.setShader(l),n.submitDraw(e,t),n.setShader({...l,defines:{...s,textRenderPassType:2,isBackgroundPass:!1,isLabel:!0}}),n.submitDraw(e,t),n.setShader({...l,defines:{...s,textRenderPassType:0,isBackgroundPass:!1,isLabel:!0}}),n.submitDraw(e,t)}}e.LabelTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../../definitions","../../GraphShaderModule","../../graph/glsl","../shaders/AFeatureShader","../shaders/constants","../shaders/hittestUtils","../shaders/MosaicInfo","../shaders/utils","../shaders/VisualVariableColor","../shaders/VisualVariableOpacity","../shaders/VisualVariableRotation","../shaders/VisualVariableSizeMinMaxValue","../shaders/VisualVariableSizeScaleStops","../shaders/VisualVariableSizeStops","../shaders/VisualVariableSizeUnitValue","../shaders/vvUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_){"use strict";const y=360/254;class x extends s.FeatureVertexInput{}t.__decorate([r.location(3,n.Vec4)],x.prototype,"color",void 0),t.__decorate([r.location(4,n.Vec2)],x.prototype,"offset",void 0),t.__decorate([r.location(5,n.Vec2)],x.prototype,"textureUV",void 0),t.__decorate([r.location(6,n.Vec2)],x.prototype,"fontAndReferenceSize",void 0),t.__decorate([r.location(7,n.Vec4)],x.prototype,"outlineColor",void 0),t.__decorate([r.location(8,n.Vec4)],x.prototype,"haloColor",void 0),t.__decorate([r.location(9,n.Vec2)],x.prototype,"outlineAndHaloSize",void 0),t.__decorate([r.location(10,n.Vec2)],x.prototype,"zoomRange",void 0),t.__decorate([r.location(11,n.Float)],x.prototype,"clipAngle",void 0),t.__decorate([r.location(12,n.Vec4)],x.prototype,"referenceSymbol",void 0),t.__decorate([r.location(15,n.Float)],x.prototype,"visibility",void 0);class b extends r.ComputeVertexInput{}t.__decorate([r.location(13,n.Vec2)],b.prototype,"offsetNextVertex1",void 0),t.__decorate([r.location(14,n.Vec2)],b.prototype,"offsetNextVertex2",void 0);class v extends s.FeatureFragmentInput{}class S extends s.AFeatureShader{constructor(){super(...arguments),this.type="TextShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.textRenderPassType=0,this.isBackgroundPass=!1,this.isLabel=!1}clipLabel(e,t){const{clipAngle:r,zoomRange:s,visibility:o}=e,a=r.multiply(y),l=n.abs(this.view.rotation.subtract(a)),c=n.min(new n.Float(360).subtract(l),l);let u=new n.Float(0);const h=n.floor(this.view.currentZoom.multiply(i.minMaxZoomPrecisionFactor)).divide(i.minMaxZoomPrecisionFactor),d=s.x,f=s.y,p=new n.Float(1).subtract(n.step(d,h)).multiply(2),m=n.step(new n.Float(90),c).multiply(2),g=new n.Float(2).multiply(new n.Float(1).subtract(n.step(h,f)));return u=u.add(t.multiply(p)),u=u.add(t.multiply(m)),u=u.add(g),o&&(u=u.add(o)),u}vertex(e,t){const r=c.getBit(e.bitset,o.bitsetTextIsBackground),s=new n.Float(1).subtract(r);let a=e.fontAndReferenceSize[0];const l=e.fontAndReferenceSize[1];let u=a.divide(o.sdfFontSize);const h=1===this.textRenderPassType?e.outlineColor:2===this.textRenderPassType?e.haloColor:this._getVertexColor(e),d=this.view.displayViewScreenMat3.multiply(new n.Vec3(e.pos,1));let f=e.offset,p=new n.Float(1),m=n.Mat3.identity(),g=new n.Vec2(0);if(this.isLabel){if(!e.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const t=e.referenceSymbol,r=t.xy,n=t.z,s=this._unpackDirection(t.w),o=_.getVisualVariableSize(this,e.id,n).divide(2),a=s.multiply(o.add(i.labelPlacementOffsetPadding));g=r.add(a),f=f.add(g)}else p=_.getVisualVariableSize(this,e.id,l).divide(l),a=a.multiply(p),u=u.multiply(p),f=f.multiply(p),m=_.getVisualVariableRotation(this,e.id),f=m.multiply(new n.Vec3(f,0)).xy;const y=c.getBit(e.bitset,o.bitsetTextIsMapAligned),x=this._getViewRotationMatrix(y).multiply(new n.Vec3(f,0));let b=this.isLabel?this.clipLabel(e,y):this.clip(e.id,e.zoomRange);b=this.isBackgroundPass?b.add(s.multiply(2)):b.add(r.multiply(2));let v=new n.Float(0);if(1===this.textRenderPassType&&(b=b.add(n.ifElse(n.equal(e.outlineAndHaloSize.x,new n.Float(0)),new n.Float(2),new n.Float(0))),v=new n.Float(e.outlineAndHaloSize.x).divide(u).divide(o.maxSdfDistance)),2===this.textRenderPassType){const t=e.outlineAndHaloSize.x,i=new n.Float(e.outlineAndHaloSize.y);b=b.add(n.ifElse(n.equal(i,new n.Float(0)),new n.Float(2),new n.Float(0))),v=i.add(t).divide(u).divide(o.maxSdfDistance)}const S=this.isLabel?n.greaterThan(b,new n.Float(1)):new n.Bool(!1);return{glPosition:new n.Vec4(d.xy.add(x.xy),b,1),color:h,size:u,textureUV:e.textureUV.divide(this.mosaicInfo.size),antialiasingWidth:new n.Float(.105*o.sdfFontSize).divide(a).divide(this.view.pixelRatio),outlineDistanceOffset:v,...this.maybeRunHittest(e,t,{vvSizeAdjustment:p,vvRotation:m,labelOffset:g,labelClipped:S})}}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,r=new n.Float(1).subtract(e);return t.multiply(e).add(i.multiply(r))}fragment(e){const t=new n.Float(2/8),i=new n.Float(1).subtract(t),r=n.texture2D(this.mosaicInfo.texture,e.textureUV).a;let s=i.subtract(e.outlineDistanceOffset);this.highlight&&(s=s.divide(2));const o=e.antialiasingWidth,a=n.smoothstep(s.subtract(o),s.add(o),r);return this.getFragmentOutput(e.color.multiply(a),e)}hittest(e,t,{vvSizeAdjustment:i,vvRotation:r,labelOffset:s,labelClipped:o}){let l,c,u;this.isLabel?(l=new n.Vec3(e.offset.add(s),0),c=new n.Vec3(t.offsetNextVertex1.add(s),0),u=new n.Vec3(t.offsetNextVertex2.add(s),0)):(l=r.multiply(new n.Vec3(e.offset.multiply(i),0)),c=r.multiply(new n.Vec3(t.offsetNextVertex1.multiply(i),0)),u=r.multiply(new n.Vec3(t.offsetNextVertex2.multiply(i),0)));const{viewMat3:h,tileMat3:d}=this.view,f=h.multiply(d).multiply(new n.Vec3(e.pos,1)),p=f.add(d.multiply(l)).xy,m=f.add(d.multiply(c)).xy,g=f.add(d.multiply(u)).xy,_=a.distPointTriangle(this.hittestRequest.position,p.xy,m.xy,g.xy);return this.isLabel?n.ifElse(o,a.failHittest(this.hittestRequest),_):_}_unpackDirection(e){const t=new n.Int(e),i=n.bitRShift(t,new n.Int(2)),r=n.bitAnd(t,new n.Int(3));return new n.Vec2(new n.Float(i).subtract(1),new n.Float(r).subtract(1))}_getVertexColor(e){let t=e.color;if(this.visualVariableColor){const i=this.storage.getColorValue(e.id);t=this.visualVariableColor.getColor(i,e.color,new n.Bool(!1))}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(e.id),r=this.visualVariableOpacity.getOpacity(i);t=t.multiply(r)}return t}}t.__decorate([r.option(u.VisualVariableColor)],S.prototype,"visualVariableColor",void 0),t.__decorate([r.option(h.VisualVariableOpacity)],S.prototype,"visualVariableOpacity",void 0),t.__decorate([r.option(d.VisualVariableRotation)],S.prototype,"visualVariableRotation",void 0),t.__decorate([r.option(f.VisualVariableSizeMinMaxValue)],S.prototype,"visualVariableSizeMinMaxValue",void 0),t.__decorate([r.option(p.VisualVariableSizeScaleStops)],S.prototype,"visualVariableSizeScaleStops",void 0),t.__decorate([r.option(m.VisualVariableSizeStops)],S.prototype,"visualVariableSizeStops",void 0),t.__decorate([r.option(g.VisualVariableSizeUnitValue)],S.prototype,"visualVariableSizeUnitValue",void 0),t.__decorate([r.uniform(l.MosaicInfo)],S.prototype,"mosaicInfo",void 0),t.__decorate([r.define],S.prototype,"textRenderPassType",void 0),t.__decorate([r.define],S.prototype,"isBackgroundPass",void 0),t.__decorate([r.define],S.prototype,"isLabel",void 0),t.__decorate([t.__param(0,r.input(x)),t.__param(1,r.input(b))],S.prototype,"vertex",null),t.__decorate([t.__param(0,r.input(v))],S.prototype,"fragment",null),e.TextFragmentInput=v,e.TextShader=S,e.TextVertexInput=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/GradientStrokeTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","./utils","../shaders/GradientStrokeShader"],function(e,t,i,r,n){"use strict";class s extends t.FeatureTechnique{constructor(){super(...arguments),this.type=11,this.shaders={geometry:new n.GradientStrokeShader},this.symbologyPlane=1}_getShaderOptions(e,t,n){const{context:s,painter:o,pixelRatio:a}=e,l=t.instance.getInput();return{shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,l.uniforms),...i.getFeatureUniforms(e,t.target),antialiasingControls:r.getAntialiasingControls(a),mosaicInfo:o.textureManager.getMosaicInfo(s,t.textureKey),technique:{isColorPass:n}},defines:{...i.getSelectionDefines(e)},optionalAttributes:l.optionalAttributes,useComputeBuffer:i.isHittest(e)}}render(e,t){const{painter:r}=e;if(i.isHittest(e)||i.isHighlight(e)){const n=i.getFeaturePipelineState(e);return r.setPipelineState(n),r.setShader(this._getShaderOptions(e,t,1)),void r.submitDraw(e,t)}e.context.setClearDepth(1),e.context.clear(256),r.setShader(this._getShaderOptions(e,t,0)),r.setPipelineState({color:!1,depth:{write:{zNear:0,zFar:1},test:513},stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:514,mask:255,op:{fail:7680,zFail:7680,zPass:7680}}}}),r.submitDraw(e,t),r.setShader(this._getShaderOptions(e,t,1)),r.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:{write:!1,test:515},stencil:{write:!1,test:{ref:e=>e.stencilRef,compare:514,mask:255,op:{fail:7680,zFail:7680,zPass:7680}}}}),r.submitDraw(e,t)}}e.GradientStrokeTechnique=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/GradientStrokeShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../../../../../../core/has","../../GraphShaderModule","../../graph/glsl","../line/gradientStrokeConstants","./AFeatureShader","./LineShader","./MosaicInfo","./utils"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u extends a.LineVertexInput{}t.__decorate([r.location(9,n.Float)],u.prototype,"accumulatedDistance",void 0),t.__decorate([r.location(10,n.Float)],u.prototype,"totalLength",void 0),t.__decorate([r.location(11,n.Float)],u.prototype,"gradientSize",void 0),t.__decorate([r.location(12,n.Vec2)],u.prototype,"segmentDirection",void 0),t.__decorate([r.location(13,n.Vec4)],u.prototype,"tlbr",void 0);class h extends a.LineFragmentInput{}class d extends r.UniformGroup{}t.__decorate([r.uniform(n.Float)],d.prototype,"isColorPass",void 0);class f extends a.LineShader{constructor(){super(...arguments),this.type="GradientStrokeShader"}vertex(e,t){const{totalLength:i,gradientSize:r,segmentDirection:o,tlbr:l}=e,u=a.getLineVertexData(this,e),h=c.getBit(e.bitset,s.bitset.isAlongLine),d=i.divide(this.view.displayZoomFactor),f=n.ifElse(c.getBitBool(e.bitset,s.bitset.isAbsoluteSize),()=>{const e=n.ifElse(n.greaterThan(h,new n.Float(.5)),d,u.halfWidth);return r.divide(e)},r),p=e.accumulatedDistance.add(n.dot(o,u.scaledOffset).divide(d)),m=l.divide(this.mosaicInfo.size.xyxy);return{...u,tlbr:m,relativePositionAlongLine:p,relativeGradientSize:f,isAlongLine:c.getBit(e.bitset,s.bitset.isAlongLine),isDiscrete:c.getBit(e.bitset,s.bitset.isDiscrete),...this.maybeRunHittest(e,t,u.halfWidth)}}fragment(e){const{isAlongLine:t,isDiscrete:r,relativePositionAlongLine:s,relativeGradientSize:o,normal:l,tlbr:u}=e,h=a.getLineAntialiasing(e,this.antialiasingControls.blur),d=(f=l.y,n.step(new n.Float(0),f).multiply(2).subtract(1)).multiply(n.min(n.length(l),new n.Float(1)));var f;const p=new n.Float(.5).multiply(d).add(new n.Float(.5)),m=n.ifElse(n.greaterThan(t,new n.Float(.5)),s,p),g=n.ifElse(n.greaterThan(r,new n.Float(.5)),o.subtract(1),new n.Float(0)),_=c.oneMinus(m.add(g).divide(o)),y=n.mix(u.xy,u.zw,new n.Vec2(n.clamp(_,new n.Float(0),new n.Float(1)),.5)),x=n.texture2D(this.mosaicInfo.texture,y),b=e.opacity.multiply(h),v=this.getFragmentOutput(x.multiply(b),e),S=n.step(new n.Float(.5),this.technique.isColorPass).multiply(i("gradient-depth-epsilon")),w=n.step(new n.Float(0),l.y).multiply(new n.Float(i("gradient-depth-bias")).subtract(S));return v.glFragDepth=n.clamp(n.length(l).add(w),new n.Float(0),new n.Float(1)),v}}t.__decorate([r.uniform(l.MosaicInfo)],f.prototype,"mosaicInfo",void 0),t.__decorate([r.uniform(d)],f.prototype,"technique",void 0),t.__decorate([t.__param(0,r.input(u)),t.__param(1,r.input(o.BaseHittestVertexInput))],f.prototype,"vertex",null),e.GradientStrokeFragmentInput=h,e.GradientStrokeShader=f,e.GradientStrokeVertexInput=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/gradientStrokeConstants":function(){define(["exports"],function(e){"use strict";e.bitset={isAlongLine:0,isAbsoluteSize:1,isDiscrete:2},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","./utils","../shaders/LineShader"],function(e,t,i,r,n){"use strict";class s extends t.FeatureTechnique{constructor(){super(...arguments),this.type=15,this.shaders={geometry:new n.LineShader},this.symbologyPlane=1}render(e,t){const{painter:n,pixelRatio:s}=e,o=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,o.uniforms),...i.getFeatureUniforms(e,t.target),antialiasingControls:r.getAntialiasingControls(s)},defines:{...i.getSelectionDefines(e)},optionalAttributes:o.optionalAttributes,useComputeBuffer:i.isHittest(e)}),n.setPipelineState(i.getFeaturePipelineState(e)),n.submitDraw(e,t)}}e.LineTechnique=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","./utils","../shaders/TexturedLineShader"],function(e,t,i,r,n){"use strict";class s extends t.FeatureTechnique{constructor(){super(...arguments),this.type=26,this.shaders={geometry:new n.TexturedLineShader},this.symbologyPlane=1}render(e,t){const{context:n,painter:s,pixelRatio:o}=e,a=t.instance.getInput();s.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,a.uniforms),...i.getFeatureUniforms(e,t.target),antialiasingControls:r.getAntialiasingControls(o),mosaicInfo:s.textureManager.getMosaicInfo(n,t.textureKey)},defines:{...i.getSelectionDefines(e)},optionalAttributes:a.optionalAttributes,useComputeBuffer:i.isHittest(e)}),s.setPipelineState(i.getFeaturePipelineState(e)),s.submitDraw(e,t)}}e.TexturedLineTechnique=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/TexturedLineShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../../../../../../core/screenUtils","../../../../../../../symbols/cim/constants","../../GraphShaderModule","../../graph/glsl","./AFeatureShader","./constants","./LineShader","./MosaicInfo","./utils"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";class h extends l.LineVertexInput{}t.__decorate([n.location(9,s.Float)],h.prototype,"accumulatedDistance",void 0),t.__decorate([n.location(10,s.Vec2)],h.prototype,"segmentDirection",void 0),t.__decorate([n.location(11,s.Float)],h.prototype,"offsetAlongLine",void 0),t.__decorate([n.location(12,s.Float)],h.prototype,"capType",void 0),t.__decorate([n.location(13,s.Vec4)],h.prototype,"tlbr",void 0);class d extends l.LineFragmentInput{}class f extends l.LineShader{constructor(){super(...arguments),this.type="TexturedLineShader"}_getDistanceRatio(e,t){const r=u.getBit(e.bitset,a.bitsetLineScaleDash);return r.multiply(s.max(t,new s.Float(.25)).multiply(new s.Float(2))).add(new s.Float(1).subtract(r).multiply(i.pt2px(1)))}_getSDFAlpha(e){const{halfWidth:t,normal:i,tlbr:n,patternSize:o,accumulatedDistance:a,offsetAlongLine:l,dashToPx:c,capType:h}=e,d=o.x.divide(r.dashSdfRasterizationScale).multiply(c),f=s.fract(a.add(l).divide(d)),p=s.mix(n.xy,n.zw,new s.Vec2(f,.5)),m=u.rgba2float(s.texture2D(this.mosaicInfo.texture,p)).multiply(2).subtract(1).multiply(r.dashSdfDistanceNormalization).multiply(c),g=i.y.multiply(t),_=s.cond([s.equal(h,new s.Float(1)),m.subtract(t)],[s.equal(h,new s.Float(2)),s.sqrt(s.pow(s.max(m,new s.Float(0)),new s.Float(2)).add(g.multiply(g))).subtract(t)],[!0,m]),y=s.clamp(new s.Float(.25).subtract(_),new s.Float(0),new s.Float(1));return new s.Vec4(y)}_getPatternColor(e){const{halfWidth:t,normal:i,color:r,accumulatedDistance:n,patternSize:o,sampleAlphaOnly:a,tlbr:l}=e,c=o.y.multiply(new s.Float(2).multiply(t).divide(o.x)),u=s.fract(n.divide(c)),h=new s.Float(.5).multiply(i.y).add(new s.Float(.5)),d=s.mix(l.xy,l.zw,new s.Vec2(h,u));let f=s.texture2D(this.mosaicInfo.texture,d);return null!=this.visualVariableColor&&(f=s.ifElse(s.greaterThan(a,new s.Float(.5)),new s.Vec4(r.a),r)),f}vertex(e,t){const{segmentDirection:i,tlbr:r,bitset:n}=e,o=l.getLineVertexData(this,e),c=e.accumulatedDistance.divide(this.view.displayZoomFactor).add(s.dot(i,o.scaledOffset)),h=new s.Vec2(r.z.subtract(r.x),r.w.subtract(r.y)),d=r.divide(this.mosaicInfo.size.xyxy),f=u.getBit(n,a.bitsetLineIsSdf),p=u.getBit(n,a.bitsetGenericConsiderAlphaOnly),m=s.ifElse(s.greaterThan(f,new s.Float(.5)),this._getDistanceRatio(e,o.scaledHalfWidth),new s.Float(1));return{...o,tlbr:d,patternSize:h,accumulatedDistance:c,isSDF:f,sampleAlphaOnly:p,dashToPx:m,offsetAlongLine:e.offsetAlongLine,capType:e.capType,...this.maybeRunHittest(e,t,o.halfWidth)}}fragment(e){const{color:t,opacity:i,isSDF:r}=e,n=l.getLineAntialiasing(e,this.antialiasingControls.blur),o=s.ifElse(s.greaterThan(r,new s.Float(.5)),this._getSDFAlpha(e),this._getPatternColor(e)),a=t.multiply(i).multiply(n).multiply(o);return this.getFragmentOutput(a,e)}}t.__decorate([n.uniform(c.MosaicInfo)],f.prototype,"mosaicInfo",void 0),t.__decorate([t.__param(0,n.input(h)),t.__param(1,n.input(o.BaseHittestVertexInput))],f.prototype,"vertex",null),e.TexturedLineFragmentInput=d,e.TexturedLineShader=f,e.TexturedLineVertexInput=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","./MarkerShader"],function(e,t,i,r){"use strict";class n extends t.FeatureTechnique{constructor(){super(...arguments),this.type=17,this.shaders={geometry:new r.MarkerShader},this.symbologyPlane=2}render(e,t){const{context:r,painter:n}=e,s=t.instance.getInput();n.setShader({shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,s.uniforms),...i.getFeatureUniforms(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(r,t.textureKey,!0)},defines:{...i.getSelectionDefines(e)},optionalAttributes:s.optionalAttributes,useComputeBuffer:i.isHittest(e)}),n.setPipelineState(i.getFeaturePipelineState(e)),n.submitDraw(e,t)}}e.MarkerTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./markerConstants","../shaders/AFeatureShader","../shaders/constants","../shaders/hittestUtils","../shaders/MosaicInfo","../shaders/utils","../shaders/VisualVariableColor","../shaders/VisualVariableOpacity","../shaders/VisualVariableRotation","../shaders/VisualVariableSizeMinMaxValue","../shaders/VisualVariableSizeScaleStops","../shaders/VisualVariableSizeStops","../shaders/VisualVariableSizeUnitValue","../shaders/vvUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_){"use strict";class y extends s.FeatureVertexInput{}t.__decorate([i.location(3,r.Vec4)],y.prototype,"color",void 0),t.__decorate([i.location(4,r.Vec4)],y.prototype,"outlineColor",void 0),t.__decorate([i.location(5,r.Vec2)],y.prototype,"offset",void 0),t.__decorate([i.location(6,r.Vec2)],y.prototype,"textureUV",void 0),t.__decorate([i.location(7,r.Vec4)],y.prototype,"sizing",void 0),t.__decorate([i.location(8,r.Float)],y.prototype,"placementAngle",void 0),t.__decorate([i.location(9,r.Float)],y.prototype,"sdfDecodeCoeff",void 0),t.__decorate([i.location(10,r.Vec2)],y.prototype,"zoomRange",void 0);class x extends i.ComputeVertexInput{}t.__decorate([i.location(11,r.Vec2)],x.prototype,"offsetNextVertex1",void 0),t.__decorate([i.location(12,r.Vec2)],x.prototype,"offsetNextVertex2",void 0),t.__decorate([i.location(13,r.Vec2)],x.prototype,"textureUVNextVertex1",void 0),t.__decorate([i.location(14,r.Vec2)],x.prototype,"textureUVNextVertex2",void 0);class b extends s.FeatureFragmentInput{}function v(e,t,i,r){return t.multiply(e.x).add(i.multiply(e.y)).add(r.multiply(e.z))}function S(e){return e.multiply(e).divide(128)}class w extends s.AFeatureShader{constructor(){super(...arguments),this.type="MarkerShader",this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]}}vertex(e,t){const i=S(e.sizing.x),s=S(e.sizing.y),a=S(e.sizing.z),l=e.placementAngle,u=c.getBit(e.bitset,n.MarkerConstants.bitset.isSDF),h=c.getBit(e.bitset,n.MarkerConstants.bitset.isMapAligned),d=c.getBit(e.bitset,n.MarkerConstants.bitset.scaleSymbolsProportionally),f=c.getBitBool(e.bitset,n.MarkerConstants.bitset.colorLocked),p=_.getVisualVariableOpacity(this,e.id),m=_.getVisualVariableColor(this,e.id,e.color,f).multiply(p),g=this.view.displayViewScreenMat3.multiply(new r.Vec3(e.pos.xy,1)),y=_.getVisualVariableSize(this,e.id,a).divide(a),x=i.multiply(y),b=e.offset.xy.multiply(y);let v=s.multiply(d.multiply(y.subtract(1)).add(1));v=r.min(v,r.max(x.subtract(.99),new r.Float(0)));const w=r.max(v,new r.Float(1)),T=r.min(v,new r.Float(1)),M=r.Mat3.fromRotation(l.multiply(o.c256ToRad)),P=_.getVisualVariableRotation(this,e.id),I=this._getViewRotationMatrix(h).multiply(P).multiply(M).multiply(new r.Vec3(b.xy,0)),C=this.clip(e.id,e.zoomRange),F=new r.Vec4(g.xy.add(I.xy),C,1),O=e.textureUV.divide(this.mosaicInfo.size),A=e.outlineColor.multiply(T),E=c.getBit(e.bitset,n.MarkerConstants.bitset.overrideOutlineColor),z=e.sdfDecodeCoeff.multiply(x);return{glPosition:F,color:m,textureUV:O,outlineColor:A,outlineSize:w,distanceToPx:z,isSDF:u,overrideOutlineColor:E,...this.maybeRunHittest(e,t,{pos:e.pos,size:x,sizeCorrection:y,isMapAligned:h,vvRotationMat3:P,placementMat3:M,outlineSize:w,distanceToPx:z,isSDF:u})}}fragment(e){const t=this._getColor(e.textureUV,e);return this.getFragmentOutput(t,e)}hittest(e,t,i){return r.ifElse(r.lessThan(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(e,t,i),this._hittestMarker(e,t,i))}_getViewRotationMatrix(e){const t=this.view.displayViewMat3,i=this.view.displayMat3,n=new r.Float(1).subtract(e);return t.multiply(e).add(i.multiply(n))}_getViewScreenMatrix(e){const t=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,n=new r.Float(1).subtract(e);return t.multiply(e).add(i.multiply(n))}_getColor(e,t){return r.ifElse(r.equal(t.isSDF,new r.Float(1)),this._getSDFColor(e,t),this._getSpriteColor(e,t))}_getSpriteColor(e,t){return r.texture2D(this.mosaicInfo.texture,e).multiply(t.color)}_getSDFColor(e,t){const i=r.texture2D(this.mosaicInfo.texture,e),n=new r.Float(.5).subtract(c.rgba2float(i)).multiply(t.distanceToPx).multiply(o.softEdgeRatio),s=r.clamp(new r.Float(.5).subtract(n),new r.Float(0),new r.Float(1)),a=t.color.multiply(s);let l=t.outlineSize;this.highlight&&(l=r.max(l,t.overrideOutlineColor.multiply(4)));const u=l.multiply(.5),h=r.abs(n).subtract(u),d=r.clamp(new r.Float(.5).subtract(h),new r.Float(0),new r.Float(1)),f=r.mix(t.outlineColor,t.color,t.overrideOutlineColor).multiply(d);return new r.Float(1).subtract(f.a).multiply(a).add(f)}_hittestSmallMarker(e,t,i){const{position:n,distance:s,smallSymbolDistance:o}=this.hittestRequest,a=s.subtract(o),{viewMat3:l,tileMat3:c}=this.view,u=l.multiply(c).multiply(new r.Vec3(i.pos,1)).xy,h=i.size.multiply(.5);return r.distance(u,n).subtract(h).add(a)}_hittestMarker(e,t,i){const{pos:n,sizeCorrection:s,isMapAligned:o}=i,l=new r.Vec3(e.offset.multiply(s),0),c=new r.Vec3(t.offsetNextVertex1.multiply(s),0),u=new r.Vec3(t.offsetNextVertex2.multiply(s),0),{viewMat3:h,tileMat3:d}=this.view,f=h.multiply(d).multiply(new r.Vec3(n,1)),p=this._getViewScreenMatrix(o).multiply(i.vvRotationMat3).multiply(i.placementMat3),m=f.add(p.multiply(l)).xy,g=f.add(p.multiply(c)).xy,_=f.add(p.multiply(u)).xy,y=this.hittestRequest.position,x=this.hittestRequest.distance,b=a.distPointTriangle(y,m,g,_);return r.ifElse(r.greaterThan(b,x),b,this._hittestSamples(m,g,_,e,t,i))}_hittestSamples(e,t,i,n,s,o){const{outlineSize:l,isSDF:c,distanceToPx:u}=o,h=this.hittestRequest.position,d=this.hittestRequest.distance,f=a.xyToBarycentric(h.add(new r.Vec2(r.negate(d),r.negate(d))),e,t,i),p=a.xyToBarycentric(h.add(new r.Vec2(0,r.negate(d))),e,t,i),m=a.xyToBarycentric(h.add(new r.Vec2(d,r.negate(d))),e,t,i),g=a.xyToBarycentric(h.add(new r.Vec2(r.negate(d),0)),e,t,i),_=a.xyToBarycentric(h,e,t,i),y=a.xyToBarycentric(h.add(new r.Vec2(d,0)),e,t,i),x=a.xyToBarycentric(h.add(new r.Vec2(r.negate(d),d)),e,t,i),b=a.xyToBarycentric(h.add(new r.Vec2(0,d)),e,t,i),S=a.xyToBarycentric(h.add(new r.Vec2(d,d)),e,t,i),w=n.textureUV.divide(this.mosaicInfo.size),T=s.textureUVNextVertex1.divide(this.mosaicInfo.size),M=s.textureUVNextVertex2.divide(this.mosaicInfo.size),P={color:new r.Vec4(1),outlineColor:new r.Vec4(1),overrideOutlineColor:new r.Float(1),outlineSize:l,distanceToPx:u,isSDF:c};let I=new r.Float(0);return I=I.add(a.inTriangle(f).multiply(this._getColor(v(f,w,T,M),P).a)),I=I.add(a.inTriangle(p).multiply(this._getColor(v(p,w,T,M),P).a)),I=I.add(a.inTriangle(m).multiply(this._getColor(v(m,w,T,M),P).a)),I=I.add(a.inTriangle(g).multiply(this._getColor(v(g,w,T,M),P).a)),I=I.add(a.inTriangle(_).multiply(this._getColor(v(_,w,T,M),P).a)),I=I.add(a.inTriangle(y).multiply(this._getColor(v(y,w,T,M),P).a)),I=I.add(a.inTriangle(x).multiply(this._getColor(v(x,w,T,M),P).a)),I=I.add(a.inTriangle(b).multiply(this._getColor(v(b,w,T,M),P).a)),I=I.add(a.inTriangle(S).multiply(this._getColor(v(S,w,T,M),P).a)),r.step(I,new r.Float(.05)).multiply(a.failHittest(this.hittestRequest))}}t.__decorate([i.option(u.VisualVariableColor)],w.prototype,"visualVariableColor",void 0),t.__decorate([i.option(h.VisualVariableOpacity)],w.prototype,"visualVariableOpacity",void 0),t.__decorate([i.option(d.VisualVariableRotation)],w.prototype,"visualVariableRotation",void 0),t.__decorate([i.option(f.VisualVariableSizeMinMaxValue)],w.prototype,"visualVariableSizeMinMaxValue",void 0),t.__decorate([i.option(p.VisualVariableSizeScaleStops)],w.prototype,"visualVariableSizeScaleStops",void 0),t.__decorate([i.option(m.VisualVariableSizeStops)],w.prototype,"visualVariableSizeStops",void 0),t.__decorate([i.option(g.VisualVariableSizeUnitValue)],w.prototype,"visualVariableSizeUnitValue",void 0),t.__decorate([i.uniform(l.MosaicInfo)],w.prototype,"mosaicInfo",void 0),t.__decorate([t.__param(0,i.input(y)),t.__param(1,i.input(x))],w.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(b))],w.prototype,"fragment",null),e.MarkerFragmentInput=b,e.MarkerShader=w,e.MarkerVertexInput=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","./PieChartShader"],function(e,t,i,r){"use strict";class n extends t.FeatureTechnique{constructor(){super(...arguments),this.type=23,this.shaders={geometry:new r.PieChartShader},this.symbologyPlane=2}render(e,t){const{painter:r}=e,{instance:n,target:s}=t,o=this.shaders.geometry,a=n.getInput(),l=a.uniforms.numberOfFields,c=i.isHittest(e),u=i.getFeatureUniforms(e,s),h=i.getSelectionDefines(e);o.setNumberOfFields(l),r.setShader({shader:o,uniforms:{...i.resolveDynamicUniforms(e,t.target,a.uniforms.shader),...u.storage,...u.view,...u.highlight,highlightUniforms:u.highlight,hittestUniforms:u.hittestRequest?{hittestDist:u.hittestRequest?.distance,hittestPos:u.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!a.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!a.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!a.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!a.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!a.uniforms.shader.visualVariableOpacity,HITTEST:c,highlight:u.highlight?1:0,...h,numberOfFields:l},optionalAttributes:{},useComputeBuffer:c}),r.setPipelineState(i.getFeaturePipelineState(e)),r.submitDraw(e,t)}}e.PieChartTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartShader":function(){define(["exports","../../GLSLShaderModule","../../graph/glsl","../../../shaders/sources/resolver"],function(e,t,i,r){"use strict";const n={hittestDist:i.Float,hittestPos:i.Vec2},s={filterFlags:i.Sampler2D,animation:i.Sampler2D,visualVariableData:i.Sampler2D,dataDriven0:i.Sampler2D,dataDriven1:i.Sampler2D,dataDriven2:i.Sampler2D,gpgpu:i.Sampler2D,size:i.Float},o={displayViewScreenMat3:i.Mat3,displayViewMat3:i.Mat3,displayMat3:i.Mat3,viewMat3:i.Mat3,tileMat3:i.Mat3,displayZoomFactor:i.Float,requiredZoomFactor:i.Float,tileOffset:i.Vec2,currentScale:i.Float,currentZoom:i.Float,metersPerSRUnit:i.Float};class a extends t.GLSLShaderModule{constructor(){super(...arguments),this.vertexShader=r.resolveIncludes("materials/pie/pie.vert"),this.fragmentShader=r.resolveIncludes("materials/pie/pie.frag"),this.required={...s,...o,outlineWidth:i.Float,colors:i.FixedArray,defaultColor:i.Vec4,othersColor:i.Vec4,outlineColor:i.Vec4,donutRatio:i.Float,sectorThreshold:i.Float},this.options={hittestUniforms:n,visualVariableSizeMinMaxValue:{minMaxValueAndSize:i.Vec4},visualVariableSizeScaleStops:{sizes:{type:"array",elementType:i.Float,size:8},values:{type:"array",elementType:i.Float,size:8}},visualVariableSizeStops:{sizes:{type:"array",elementType:i.Float,size:8},values:{type:"array",elementType:i.Float,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:i.Float},visualVariableOpacity:{opacities:{type:"array",elementType:i.Float,size:8},opacityValues:{type:"array",elementType:i.Float,size:8}},highlightUniforms:{highlightAll:i.Float,activeReasons:i.Float}},this.locations={pos:{index:0,type:i.Vec2},id:{index:1,type:i.Vec3},bitset:{index:2,type:i.Float},offset:{index:3,type:i.Vec2},texCoords:{index:4,type:i.Vec2},size:{index:5,type:i.Vec2},referenceSize:{index:6,type:i.Float},zoomRange:{index:7,type:i.Vec2}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"}}setNumberOfFields(e){this.required.colors={type:"array",elementType:i.Vec4,size:e}}}e.PieChartShader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/GLSLShaderModule":function(){define(["exports","./typed/TypedShaderProgram"],function(e,t){"use strict";const i=e=>"array"===e.type?e.elementType?.type:void 0,r=e=>"array"===e.type?e.size:void 0;e.GLSLShaderModule=class{constructor(){this.computeAttributes={}}get locationsMap(){const e=new Map;for(const t in this.locations)e.set(t,this.locations[t].index);return e}get optionPropertyKeys(){if(!this._optionPropertyKeys){const e=new Set(Object.keys(this.options));this._optionPropertyKeys=e}return this._optionPropertyKeys}get _transformFeedbackBindings(){return[]}get locationInfo(){if(!this._locationInfo){const e=this.locationsMap,t=Array.from(e.entries()).map(([e,t])=>`${e}.${t}`).join(".");this._locationInfo={stringHash:t,locations:e,computeAttributeMap:this.computeAttributes}}return this._locationInfo}get renamedLocationsMap(){const e=new Map;for(const[t,i]of this.locationsMap.entries())e.set("a_"+t,i);return e}getShaderKey(e,t,i){return`${Object.keys(e).map(t=>`${t}.${e[t]}`).join(".")}.${Object.keys(i).filter(e=>i[e]).map(e=>`${e}_${i[e].toString()}`).join(".")}.${Object.keys(t).filter(e=>this.optionPropertyKeys.has(e)).join(".")}`}getProgram(e,i,r,n){let s="",o="";for(const e in r)if(r[e]){const t="boolean"==typeof r[e]?`#define ${e}\n`:`#define ${e} ${r[e]}\n`;s+=t,o+=t}return s+=this.vertexShader,o+=this.fragmentShader,new t.TypedShaderProgram(s,o,this.renamedLocationsMap,this._getUniformBindings(i),this._transformFeedbackBindings)}_getUniformBindings(e){const t=[];for(const e in this.required){const n=this.required[e];t.push({uniformHydrated:null,shaderModulePath:e,uniformName:e,uniformType:n.type,uniformArrayElementType:i(n),uniformArrayLength:r(n)})}for(const n in e){const s=this.options[n];if(e[n])for(const e in s){const o=s[e];t.push({uniformHydrated:null,shaderModulePath:`${n}.${e}`,uniformName:e,uniformType:o.type,uniformArrayElementType:i(o),uniformArrayLength:r(o)})}}return t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextTechnique":function(){define(["exports","../FeatureTechnique","../featureTechniqueUtils","./TextShader"],function(e,t,i,r){"use strict";class n extends t.FeatureTechnique{constructor(){super(...arguments),this.type=25,this.shaders={geometry:new r.TextShader},this.symbologyPlane=3}render(e,t){const{context:r,painter:n}=e,s=i.getSelectionDefines(e),o=t.instance.getInput(),a={shader:this.shaders.geometry,uniforms:{...i.resolveDynamicUniforms(e,t.target,o.uniforms),...i.getFeatureUniforms(e,t.target),mosaicInfo:n.textureManager.getMosaicInfo(r,t.textureKey)},defines:{...s,isBackgroundPass:!0,isLabel:!1,textRenderPassType:0},optionalAttributes:o.optionalAttributes,useComputeBuffer:i.isHittest(e)};n.setShader(a),n.setPipelineState(i.getFeaturePipelineState(e)),n.submitDraw(e,t),n.setShader({...a,defines:{...s,isBackgroundPass:!1,isLabel:!1,textRenderPassType:2}}),n.submitDraw(e,t),n.setShader({...a,defines:{...s,isBackgroundPass:!1,isLabel:!1,textRenderPassType:1}}),n.submitDraw(e,t),n.setShader({...a,defines:{...s,isBackgroundPass:!1,isLabel:!1,textRenderPassType:0}}),n.submitDraw(e,t)}}e.TextTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry":function(){define(["exports","../animated/AnimatedMarkerMeshWriter","../animated/AnimatedPolyMeshWriters","../dotDensity/DotDensityMeshWriter","../fill/ComplexFillMeshWriter","../fill/ComplexOutlineFillMeshWriter","../fill/FillMeshWriter","../fill/GradientFillMeshWriter","../fill/OutlineFillMeshWriter","../fill/PatternFillMeshWriter","../fill/PatternOutlineFillMeshWriter","../heatmap/HeatmapMeshWriter","../labels/LabelMeshWriter","../line/GradientStrokeMeshWriter","../line/LineMeshWriter","../line/TexturedLineMeshWriter","../markers/MarkerMeshWriter","./MeshWriterInputEvaluator","../pieChart/PieChartMeshWriter","../text/TextMeshWriter"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_,y,x){"use strict";e.MeshWriterRegistry=class{async createMeshWriter(e,t,i,r,n){const s=this._getMeshWriter(r.techniqueType),o=await _.MeshWriterInputEvaluator.create(e,t,r.inputParams,n),a=new s(r.id,o,r.optionalAttributes,i);return await a.loadDependencies(),a}_getMeshWriter(e){switch(e){case 9:return o.FillMeshWriter;case 8:return r.DotDensityMeshWriter;case 6:return n.ComplexFillMeshWriter;case 21:return c.PatternFillMeshWriter;case 10:return a.GradientFillMeshWriter;case 19:return l.OutlineFillMeshWriter;case 22:return u.PatternOutlineFillMeshWriter;case 7:return s.ComplexOutlineFillMeshWriter;case 17:return g.MarkerMeshWriter;case 23:return y.PieChartMeshWriter;case 25:return x.TextMeshWriter;case 15:return p.LineMeshWriter;case 26:return m.TexturedLineMeshWriter;case 11:return f.GradientStrokeMeshWriter;case 13:return h.HeatmapMeshWriter;case 14:return d.LabelMeshWriter;case 2:return t.AnimatedMarkerMeshWriter;case 3:return t.AnimatedMarkerShiftMeshWriter;case 0:return i.AnimatedFillMeshWriter;case 1:return i.AnimatedLineMeshWriter;default:throw new Error("Internal Error: Mesh writer not in the registry")}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/constants","../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper","../../../definitions","./AnimatedMeshWriter","./attributes","./ComputedAnimatedParams","../shaders/constants"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u extends o.AAnimatedMeshWriter{get vertexSpec(){return{createComputedParams:l.createComputedAnimatedMeshParams,optionalAttributes:{zoomRange:a.zoomRange,value1Position2Value2:a.value1Position2Value2,lineLength:a.lineLength},attributes:{id:a.id,bitset:a.bitset,pos:a.pos,offset:a.offset.marker,uv:a.uv.marker,animationPointerAndBaseSizeAndReferenceSize:a.animationPointerAndBaseSizeAndReferenceSize,sizing:a.sizing,angle:a.angle}}}_write(e,t){const i=this.evaluatedMeshParams.sprite,{textureBinding:r}=i;e.recordStart(this.instanceId,this.attributeLayout,r);const n=t.getDisplayId();if(this.shift&&"esriGeometryPolyline"===t.geometryType)this._writeParticles(e,t);else if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(e,t);else if("esriGeometryPolygon"===t.geometryType){const i=t.readCentroidForDisplay();if(!i)return;const[r,s]=i.coords;this._writeQuad(e,n,r,s)}else if("esriGeometryPoint"===t.geometryType){const i=t.readXForDisplay(),r=t.readYForDisplay();this._writeQuad(e,n,i,r)}else{const i=t.readGeometryForDisplay();i&&i.forEachVertex((t,i)=>{this._writeQuad(e,n,t,i)})}e.recordEnd()}_writePlacedMarkers(e,s){const o=i.GeometryCursor.fromFeatureSetReaderCIM(s)?.clone();if(!o)return;const a=n.CIMMarkerPlacementHelper.getPlacement(o,-1,this.evaluatedMeshParams.placement,t.pt2px(1),e.id);if(!a)return;const l=s.getDisplayId();let c=a.next(),u=null;for(;null!=c;){const t=c.tx,i=-c.ty;if(Math.abs(t)>r.maxTileCoordValue||Math.abs(i)>r.maxTileCoordValue){c=a.next();continue}const n=-c.getAngle();e.recordBounds(t,i,64,64),this.shift?u&&this._writeQuad(e,l,u[0],u[1],void 0,n):this._writeQuad(e,l,t,i,void 0,n),u=[t,i],c=a.next()}}_writeParticles(e,t){const i=t.getDisplayId(),r=t.readGeometryForDisplay();if(!r)return;const n=[];r.forEachVertex((e,t)=>{n.push([e,t])});const s=function(e){const t=[];let i=0;for(let r=1;r<e.length;r++){const n=e[r-1],s=e[r],o=s[0]-n[0],a=s[1]-n[1],l=Math.sqrt(o*o+a*a),c=o/l,u=a/l;t.push({a:{position:n,distance:i,direction:[c,u]},b:{position:s,distance:i+l,direction:[c,u]}}),i+=l}return t}(n);let o=0;for(let e=1;e<n.length;e++){const t=n[e][0]-n[e-1][0],i=n[e][1]-n[e-1][1],r=Math.sqrt(t*t+i*i);o+=r}const a=t=>{for(const r of s){const{a:n,b:s}=r;this._writeQuad(e,i,n.position[0],n.position[1],[n.distance-t,s.position[0],s.position[1],s.distance-t],this.evaluatedMeshParams.angleToLine?Math.atan2(n.direction[1],n.direction[0]):0,o,!0)}},{placement:l}=this.evaluatedMeshParams;if(!l||"placementTemplate"in l||"CIMMarkerPlacementOnVertices"===l.type){let e;if(l&&"CIMMarkerPlacementOnVertices"!==l.type)e=l.placementTemplate;else{e=[0];for(const t of s){const{a:i,b:r}=t,n=i.position[0]-r.position[0],s=i.position[1]-r.position[1],o=Math.sqrt(n*n+s*s);e.push(o)}}let t=-1*o;for(;t<2*o;)for(const i of e)t+=i,a(t)}else"CIMMarkerPlacementAtExtremities"===l.type?"JustBegin"===l.extremityPlacement?a(1):"JustEnd"===l.extremityPlacement?(a(o-1),a(-1)):"Both"===l.extremityPlacement&&(a(1),a(o-1)):"CIMMarkerPlacementOnLine"===l.type&&a(o/2)}_writeQuad(e,t,i,r,n,o=0,a=0,l=!1){const u=this.evaluatedMeshParams.sprite,{rect:h}=u,d=h.x+s.spritePadding,f=h.y+s.spritePadding,p=h.x+h.width-s.spritePadding,m=h.y+h.height-s.spritePadding,g=e.vertexCount();l||e.recordBounds(i,r,64,64);const _={texXmin:d,texYmin:f,texXmax:p,texYmax:m,value1Position2Value2:n,angle:o/c.c256ToRad,lineLength:a};for(let n=0;n<4;n++)this._writeVertex(e,t,i,r,_);e.indexEnsureSize(6),e.indexWrite(g),e.indexWrite(g+1),e.indexWrite(g+2),e.indexWrite(g+1),e.indexWrite(g+3),e.indexWrite(g+2)}}e.AnimatedMarkerMeshWriter=class extends u{constructor(){super(...arguments),this.shift=!1}},e.AnimatedMarkerShiftMeshWriter=class extends u{constructor(){super(...arguments),this.shift=!0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],function(e,t){"use strict";e.CIMMarkerPlacementHelper=class{static getPlacement(e,i,r,n,s){const o=t.getPlacementOperator(r);return o?(-1===i&&e.invertY(),o.execute(e,r,n,s)):null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMeshWriter":function(){define(["exports","../fill/meshWriterUtils","../markers/markerConstants","../mesh/MeshWriter"],function(e,t,i,r){"use strict";class n extends r.MeshWriter{}e.AAnimatedMeshWriter=n,e.packAnimatedBitset=function(e){const{sprite:r,isMapAligned:n,colorLocked:s,scaleSymbolsProportionally:o,isStroke:a}=e;let l=0;return n&&(l|=t.getBitMask(i.MarkerConstants.bitset.isMapAligned)),s&&(l|=t.getBitMask(i.MarkerConstants.bitset.colorLocked)),r.sdf&&(l|=t.getBitMask(i.MarkerConstants.bitset.isSDF)),o&&(l|=t.getBitMask(i.MarkerConstants.bitset.scaleSymbolsProportionally)),a&&(l|=t.getBitMask(i.MarkerConstants.bitset.isStroke)),l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/meshWriterUtils":function(){define(["exports","../../../../../../../Color","../../../../../../../core/Error","../../../../../../../core/Logger"],function(e,t,i,r){"use strict";e.getBitMask=function(e){return 1<<e},e.getMinMaxZoom=function(e,t){return[!!e?.minScale&&t.scaleToZoom(e.minScale)||0,!!e?.maxScale&&t.scaleToZoom(e.maxScale)||100]},e.packBitset=function(e){let t=0;for(const[i,r]of e)r&&(t|=1<<i);return t},e.packByteSqrt=function(e,t){return Math.round(Math.min(Math.sqrt(e*t),255))},e.packRounded=function(e,t){return Math.round(e*t)/t},e.processColorInput=function(e){let n;if(!e)return[0,0,0,0];if("string"==typeof e){const s=t.fromString(e);if(!s)return r.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils").errorOnce(new i("mapview:mesh-processing","Unable to parse string into color",{color:e})),[0,0,0,0];n=s.toArray()}else n=e;const[s,o,a,l]=n;return[s*(l/255),o*(l/255),a*(l/255),l]},e.processLineCapInput=function(e){switch(e){case"butt":case"Butt":return 0;case"round":case"Round":return 1;case"square":case"Square":return 2}},e.processLineJoinInput=function(e){switch(e){case"bevel":case"Bevel":return 0;case"miter":case"Miter":return 2;case"round":case"Round":return 1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/CIMEffects","../../../../../../../symbols/cim/effects/CIMEffectHelper","./MeshWriterVertexPack"],function(e,t,i,r,n){"use strict";e.MeshWriter=class{constructor(e,t,i,r){this._instanceId=e,this._evaluator=t,this._enabledOptionalAttributes=i,this._viewParams=r,this._evaluator.evaluator=e=>this.vertexSpec.createComputedParams(e)}get _vertexPack(){if(!this._cachedVertexPack){const e=n.MeshWriterVertexPack.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||e.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=e}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get effectInfos(){return this._evaluator.inputMeshParams.effects?.effectInfos}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}get _preventEffectClipping(){return!1}setReferences(e){this._references=e}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){for(const{effect:e}of this.effectInfos||[])await i.loadGeometryOperatorsForEffect(e)}enqueueRequest(e,t,i){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(e,t,i)}write(e,t,i,r,n){this.ensurePacked(t,i,r);const s=this.evaluatedMeshParams.effects;if(!s||0===s.length)return void this._write(e,i,void 0,n);const o=this.getEffectCursor(e,i,s);if(!o)return;let a;for(;a=o.next();)a.invertY(),this._write(e,i,a,n)}ensurePacked(e,t,i){if(!this._evaluator.hasDynamicProperties)return;const r=this._evaluator.evaluateMeshParams(e,t,i);this._vertexPack.pack(r,this._viewParams)}hasArcadeDependency(e){return this._evaluator.hasArcadeDependency(e)}_writeVertex(e,t,i,r,n){const s=this.evaluatedMeshParams;this._vertexPack.writeVertex(e,t,i,r,s,n)}getEffectCursor(e,i,n){const s=i.readGeometryForDisplay()?.clone();if(!s)return;const o=t.GeometryCursor.fromOptimizedCIM(s,i.geometryType);o.invertY();const a=e.id||"";return r.CIMEffectHelper.executeEffects(n,o,a,this._preventEffectClipping)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterVertexPack":function(){define(["exports","../../../number","./AlignedVertexSpec","./dataViewUtils"],function(e,t,i,r){"use strict";class n{static fromVertexSpec(e,t){const r=i.AlignedVertexSpec.fromVertexSpec(e,t);return new n(r)}constructor(e){this._spec=e,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(e,t,i,r,n,s){for(let e=0;e<this._spec.packVertexCount;e++){const o=e*this._spec.stride;this._packPosition(i,r,o),this._packId(t,o);const a=this._spec.bitset;if(s){if(a.packTessellation){const e=a.packTessellation(s,n,i,r);this._pack(e,a,o)}for(const e of this._spec.standardAttributes)if(null!=e.packTessellation){const t=e.packTessellation(s,n,i,r);this._pack(t,e,o)}else if(e.packAlternating?.packTessellation){const t=e.packAlternating.packTessellation(s,n,i,r);for(let i=0;i<this._spec.packVertexCount;i++){const r=t[i];this._pack(r,e,i*this._spec.stride)}}}}e.vertexWriteRegion(this._packedU32View)}pack(e,t){for(const i of this._spec.standardAttributes)if(i.pack&&"string"!=typeof i.pack){const r=i.pack(e,t);for(let e=0;e<this._spec.packVertexCount;e++)this._pack(r,i,e*this._spec.stride)}else if(i.packAlternating?.pack){const r=i.packAlternating.pack(e,t);for(let e=0;e<this._spec.packVertexCount;e++){const t=r[e];this._pack(t,i,e*this._spec.stride)}}}_packPosition(e,i,r){const{offset:n}=this._spec.position,s=this._spec.position.packPrecisionFactor??1,o=t.i1616to32(e*s,i*s);this._dataView.setUint32(r+n,o,!0)}_packId(e,t){const i=e*(this._spec.id.packPrecisionFactor??1),r=4278190080&this._dataView.getUint32(t+this._spec.id.offset,!0);this._dataView.setUint32(t+this._spec.id.offset,i|r,!0)}_pack(e,t,i){r.packDataView(this._dataView,e,t,i)}}e.MeshWriterVertexPack=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AlignedVertexSpec":function(){define(["exports","../../../../../../../core/has","./utils","../../../../../../webgl/enums"],function(e,t,i,r){"use strict";function n(e){switch(e){case r.DataType.BYTE:case r.DataType.UNSIGNED_BYTE:return 1;case r.DataType.SHORT:case r.DataType.UNSIGNED_SHORT:case r.DataType.HALF_FLOAT:return 2;case r.DataType.FLOAT:case r.DataType.INT:case r.DataType.UNSIGNED_INT:return 4}}function s(e){const t=[],i=[],r=[];for(const s of e){const e=n(s.type)*s.count;switch(e%2||e%4||4){case 4:t.push(s);continue;case 2:i.push(s);continue;case 1:r.push(s);continue;default:throw new Error("Found unexpected dataType byte count")}}return t.push(...i),t.push(...r),t}class o{static fromVertexSpec(e,t){const{attributes:i,optionalAttributes:r}=e;let a,l,c;const u=[];for(const e in i){if(i[e].otherSource)continue;const t=i[e];"position"===t.pack?a={...t,name:e,offset:0}:"id"===t.pack?l={...t,name:e,offset:4}:"bitset"===e?c={...t,name:e,offset:7}:u.push({...t,name:e})}for(const e in r)if(!0===t[e]){const t=r[e];u.push({...t,name:e})}const h=s(u),d=[];let f=8,p=1;for(const e of h)d.push({...e,offset:f}),f+=n(e.type)*e.count,e.packAlternating&&(p=Math.max(e.packAlternating.count,p));const m=Uint32Array.BYTES_PER_ELEMENT,g=f%m;return new o(a,l,c,d,f+(g?m-g:0),p)}constructor(e,t,i,r,n,s){this.position=e,this.id=t,this.bitset=i,this.standardAttributes=r,this.stride=n,this.packVertexCount=s,r.push(i),this._attributes=[e,t,i,...r]}get attributeLayout(){if(!this._attributeLayout){const e=i.vertexLayoutHash(this._attributes),t=this._attributes.map(e=>({name:e.name,count:e.count,offset:e.offset,type:e.type,packPrecisionFactor:e.packPrecisionFactor,normalized:e.normalized??!1}));this._attributeLayout={attributes:t,hash:e,stride:this.stride}}return this._attributeLayout}}e.AlignedVertexSpec=o,e.sortByAlignment=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/attributes":function(){define(["exports","../../../definitions","../../../animations/utils","./AnimatedMeshWriter","../fill/meshWriterUtils","../../../../../../webgl/enums"],function(e,t,i,r,n,s){"use strict";const o={type:s.DataType.SHORT,count:2,packPrecisionFactor:t.minMaxZoomPrecisionFactor,pack:({scaleInfo:e},{tileInfo:t})=>n.getMinMaxZoom(e,t)},a={type:s.DataType.FLOAT,count:4,packPrecisionFactor:1,packTessellation:({value1Position2Value2:e})=>(i.assert(e),e)},l={type:s.DataType.FLOAT,count:4,packPrecisionFactor:1,packTessellation:()=>[0,0,0,1]},c={type:s.DataType.FLOAT,count:1,packPrecisionFactor:1,pack:()=>0},u={type:s.DataType.FLOAT,count:1,packPrecisionFactor:1,packTessellation:({lineLength:e})=>e},h={type:s.DataType.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},d={type:s.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]},f={type:s.DataType.FLOAT,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[e,t]},p={type:s.DataType.UNSIGNED_BYTE,count:3,pack:"id"},m={type:s.DataType.UNSIGNED_BYTE,count:1,pack:r.packAnimatedBitset},g={type:s.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:1},_={marker:{type:s.DataType.FLOAT,count:2,packAlternating:{count:4,pack:({texelDimensions:e})=>[[-.5*e[0],-.5*e[1]],[.5*e[0],-.5*e[1]],[-.5*e[0],.5*e[1]],[.5*e[0],.5*e[1]]]}},line:{type:s.DataType.FLOAT,count:2,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t},{baseSize:i})=>[e*i/2,t*i/2]},fill:{type:s.DataType.FLOAT,count:2,packTessellation:()=>[0,0]}},y={marker:{type:s.DataType.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:e,texXmin:t,texYmax:i,texYmin:r})=>[[t,r],[e,r],[t,i],[e,i]]}}},x={type:s.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{const{rect:i,width:r,height:n}=e,s=i.x+t.spritePadding,o=i.y+t.spritePadding;return[s+1,o+1,s+r-1,o+n-1]}},b={type:s.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:4,pack:({animations:e,baseSize:t,referenceSize:i})=>[e.dataColumn,e.dataRow,t,i]},v={type:s.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:e,pixelDimensions:t,baseSize:i,sprite:r,sizeRatio:n})=>{const s=Math.max(i*r.width/r.height,i),o=r.sdfDecodeCoeff*s*n;return[t[0],t[1],e,o]}},S={type:s.DataType.BYTE,count:1,packTessellation:({angle:e})=>e};e.accumulatedDistance=h,e.angle=S,e.animationPointerAndBaseSizeAndReferenceSize=b,e.bitset=m,e.id=p,e.lineLength=u,e.noLineLength=c,e.noTiming=l,e.normal=f,e.offset=_,e.pos=g,e.segmentDirection=d,e.sizing=v,e.tlbr=x,e.uv=y,e.value1Position2Value2=a,e.zoomRange=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/utils":function(){define(["exports","../../../../../Color","../grouping","./infos","./instructions"],function(e,t,i,r,n){"use strict";function s(e){const t=[],i=[];let r=0;for(const s of e){const o=[...s.encode(),...n.instructions.ret.encode()];t.push([r+e.length,0,0,0]),i.push(...o),r+=o.length}return[...t,...i]}function o(e,r,n){const s=e;let l;if("number"==typeof s||"string"==typeof s||"boolean"==typeof s)l=s;else if(Array.isArray(s))l=s.map(e=>o(e,r,n));else if("object"==typeof s)if("type"in s&&null!=s.type&&"Process"===s.type)switch(s.op){case"ArcadeColor":{const e=o(s.value,r,n);a(Array.isArray(e)&&4===e.length),l=[e[0]/255,e[1]/255,e[2]/255,e[3]]}break;case"Transparency":{const e=o(s.value,r,n);a("number"==typeof e),l=1-e/100}break;case"Divide":case"Multiply":case"Add":{const e=o(s.left,r,n);a("number"==typeof e);const t=o(s.right,r,n);switch(a("number"==typeof t),s.op){case"Divide":l=e/t;break;case"Multiply":l=e*t;break;case"Add":l=e+t}}break;case"Random":{const e=o(s.seed,r,n),t=o(s.min,r,n),a=o(s.max,r,n),c=r.getObjectId(),u=i.getStartGroup(c||0);l=t+i.getRandomValue(u,e)*(a-t)}break;case"Cond":{const e=o(s.condition,r,n),t=o(s.ifTrue,r,n),i=o(s.ifFalse,r,n);l=e?t:i}break;case"MatchWinding":{const e=o(s.sign,r,n);let t=o(s.angle,r,n);if(e>0)for(;t<0;)t+=2*Math.PI;else for(;t>0;)t-=2*Math.PI;l=t}}else if("computed"in s)l=function(e){if(!("computed"in e))return e;let i=e.computed.readWithDefault(r,n,[255*e.defaultValue[0],255*e.defaultValue[1],255*e.defaultValue[2],e.defaultValue[3]]);if("string"==typeof i){const e=t.fromString(i);e&&(i=[e.r,e.g,e.b,e.a])}return i}(s);else{l={};for(const e in s)l[e]=o(s[e],r,n)}return l}function a(e){if(!e)throw new Error("Assertion failed.")}e.assert=a,e.compileAnimationParam=async function e(t,i){const r=t;let n;if("number"==typeof r||"string"==typeof r||"boolean"==typeof r)n=r;else if(Array.isArray(r))n=await Promise.all(r.map(t=>e(t,i)));else if("object"==typeof r)if("valueExpressionInfo"in r){const{valueExpressionInfo:e}=r,{expression:t}=e;n={...r,computed:await i.createComputedField({expression:t})}}else{n={};for(const t in r)n[t]=await e(r[t],i)}return n},e.createParamList=function(e){const t=[];return t.push(e.transform),t.push(e.fromColor),t.push(e.toColor),t.push(e.colorMix),t.push(e.toOpacity),t.push(e.opacityMix),e?.shift?t.push(e?.shift):t.push([1,1,1,1]),t},e.encodeParamList=s,e.fromJSON=function(e){return s(e.map(e=>o(e)).map(e=>r.hydrate(e).simplify()))},e.getAnimationExpressions=function*e(t){const i=t;if(Array.isArray(i))for(const t of i)yield*e(t);else if("object"==typeof i)if("type"in i&&null!=i.type&&"Process"===i.type)switch(i.op){case"ArcadeColor":case"Transparency":yield*e(i.value);break;case"Divide":case"Multiply":case"Add":yield*e(i.left),yield*e(i.right);break;case"Random":yield*e(i.seed),yield*e(i.min),yield*e(i.max);break;case"Cond":yield*e(i.condition),yield*e(i.ifTrue),yield*e(i.ifFalse);break;case"MatchWinding":yield*e(i.sign),yield*e(i.angle)}else if("computed"in i)yield i.computed;else for(const t in i)yield*e(i[t])},e.resolveToAnimationInfo=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/infos":function(){define(["exports","./instructions"],function(e,t){"use strict";function i(e){return e instanceof r?e:"object"==typeof e&&"type"in e?l[e.type].hydrate(e):new n(e)}class r{constructor(e){this.inputs=e}encode(){const e=[];for(const t of this.inputs)e.push(...t.encode());return e.push(...this.instructions),e}}class n extends r{constructor(e){super([]),this.value=e}simplify(){return this}get instructions(){if(Array.isArray(this.value)){const[e,i,r,n]=this.value;return null!=n?t.instructions.vector4.encode([e,i||0,r||0,n]):t.instructions.vector3.encode([e,i||0,r||0])}return t.instructions.scalar.encode(this.value)}}class s extends r{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new s(e,i(e.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;const e=this._parent.simplify();if(!(e instanceof n))return this;const[t,i,r,o]=e.value,a=this._config.translation.from[0],l=this._config.translation.from[1],c=this._config.rotation.from,u=this._config.scale.from;if(a===this._config.translation.to[0]&&l===this._config.translation.to[1]&&c===this._config.rotation.to&&u===this._config.scale.to){const e=r+c,s=o*u,h=Math.sin(r),d=Math.cos(r);return new n([d*o*a-h*o*l+t,h*o*a+d*o*l+i,e,s])}return new s(this._config,e)}get instructions(){return t.instructions.animatedTransform.encode(this._config)}}class o extends r{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new o(e,i(e.parent))}simplify(){const e=this._parent.simplify();if(!(e instanceof n))return this;const[t,i,r,s]=e.value,a=this._config.color.from[0],l=this._config.color.from[1],c=this._config.color.from[2];let u=this._config.color.from[3];const h=this._config.opacity.from;return a===this._config.color.to[0]&&l===this._config.color.to[1]&&c===this._config.color.to[2]&&u===this._config.color.to[3]&&h===this._config.opacity.to?(u*=h,new n([t*a,i*l,r*c,s*u])):new o(this._config,e)}get instructions(){return t.instructions.animatedColor.encode(this._config)}}class a extends r{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new a(e,i(e.parent))}simplify(){const e=this._parent.simplify();return e instanceof n?new a(this._config,e):this}get instructions(){return t.instructions.animatedShift.encode(this._config)}}const l={AnimatedTransform:s,AnimatedColor:o,AnimatedShift:a};e.AAnimationInfo=r,e.AnimatedColor=o,e.AnimatedShift=a,e.AnimatedTransform=s,e.Constant=n,e.hydrate=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/ComputedAnimatedParams":function(){define(["exports","../../../../../../../core/screenUtils"],function(e,t){"use strict";e.createComputedAnimatedMeshParams=function(e){let{pixelDimensions:i,texelDimensions:r,baseSize:n,referenceSize:s,strokeWidth:o,sizeRatio:a}=e;if(i||(i=e.sprite.sdf?[0,0]:[e.sprite.width,e.sprite.height]),r||(r=e.sprite.sdf?[0,0]:i),null!=e.patternHeight){const t=e.patternHeight/i[1];i[1]*=t,i[0]*=t}-1===n&&(n=i[1]),n=t.pt2px(n),s=t.pt2px(s),o=t.pt2px(o);const l=(e.sprite.sdfDecodeCoeff??1)*a;return{...e,pixelDimensions:i,texelDimensions:r,baseSize:n,referenceSize:s,strokeWidth:o,sdfDecodeCoeff:l}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedPolyMeshWriters":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../TurboLine","../../../mesh/templates/templateUtils","./AnimatedMeshWriter","./attributes","./ComputedAnimatedParams","../fill/meshWriterUtils","../line/LineMeshWriter"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u extends s.AAnimatedMeshWriter{_write(e,t,r){const n=r??i.GeometryCursor.fromFeatureSetReaderCIM(t);if(!n)return;const s=this.evaluatedMeshParams.sprite,{textureBinding:o}=s;e.recordStart(this.instanceId,this.attributeLayout,o);const a=t.getDisplayId();this._writePoly(e,a,n.asOptimized()),e.recordEnd()}}class h{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0}}e.AAnimatedPolyMeshWriter=u,e.AnimatedFillMeshWriter=class extends u{constructor(){super(...arguments),this.vertexSpec={createComputedParams:a.createComputedAnimatedMeshParams,attributes:{id:o.id,bitset:o.bitset,pos:o.pos,offset:o.offset.fill,tlbr:o.tlbr,animationPointerAndBaseSizeAndReferenceSize:o.animationPointerAndBaseSizeAndReferenceSize,sizing:o.sizing},optionalAttributes:{zoomRange:o.zoomRange,value1Position2Value2:o.noTiming,lineLength:o.noLineLength}}}_writePoly(e,t,i){const r=[];if(!n.triangulate(r,i))return;const s=e.vertexCount();i.forEachVertex((i,r)=>{this._writeVertex(e,t,i,r)}),e.indexEnsureSize(r.length);for(const t of r)e.indexWrite(s+t)}},e.AnimatedLineMeshWriter=class extends u{constructor(){super(...arguments),this.vertexSpec={createComputedParams:a.createComputedAnimatedMeshParams,attributes:{id:o.id,bitset:o.bitset,pos:o.pos,offset:o.offset.line,tlbr:o.tlbr,animationPointerAndBaseSizeAndReferenceSize:o.animationPointerAndBaseSizeAndReferenceSize,sizing:o.sizing,accumulatedDistance:o.accumulatedDistance,normal:o.normal,segmentDirection:o.segmentDirection},optionalAttributes:{zoomRange:o.zoomRange,value1Position2Value2:o.noTiming,lineLength:o.lineLength}},this._tessParams=new c.LineTessellationParams,this._currentWrite=new h,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._lineLength=0,this._lineTessellator=new r.LineTessellation((e,t,i,r,n,s,o,a,l,c,u)=>this._writeTesselatedVertex(e,t,i,r,n,s,o,a,l,c,u,this._lineLength),this._writeTriangle.bind(this),!1)}_writePoly(e,r,s){const o=n.clipLinesMarshall(i.GeometryCursor.fromOptimized(s,"esriGeometryPolyline"),64);if(null==o)return;const{_currentWrite:a,_tessellationOptions:c}=this,{baseSize:u,capType:h,joinType:d,miterLimit:f}=this.evaluatedMeshParams,p=t.pt2px(.5*u);c.halfWidth=p,c.capType=l.processLineCapInput(h||"Round"),c.joinType=l.processLineJoinInput(d||"Round"),c.miterLimit=f||2,a.out=e,a.id=r,a.vertexCount=0,a.indexCount=0,a.vertexFrom=e.vertexCount(),a.vertexBounds=1;for(const{line:e,start:t,pathLength:i}of o){c.initialDistance=t%65535,a.pathLength=i,this._lineLength=0;for(let t=1;t<e.length;t++){const i=e[t].x-e[t-1].x,r=e[t].y-e[t-1].y;this._lineLength+=Math.sqrt(i*i+r*r)}this._lineTessellator.tessellate(e,c,!1)}}_writeTesselatedVertex(e,t,i,r,n,s,o,a,l,c,u,h){const{out:d,id:f,vertexBounds:p,pathLength:m}=this._currentWrite;return this.hasEffects&&d.recordBounds(e,t,p,p),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=l,this._tessParams.normalY=c,this._tessParams.directionX=n,this._tessParams.directionY=s,this._tessParams.distance=u,this._tessParams.pathLength=m,this._tessParams.lineLength=h,this._writeVertex(d,f,e,t,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(e,t,i){const{out:r}=this._currentWrite;r.indexEnsureSize(3),r.indexWrite(e),r.indexWrite(t),r.indexWrite(i),this._currentWrite.indexCount+=3}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TurboLine":function(){define(["exports","./definitions"],function(e,t){"use strict";function i(e,t){return e.x===t.x&&e.y===t.y}function r(e,t){return e.x=t.y,e.y=-t.x,e}function n(e,t){return e.x=-t.y,e.y=t.x,e}function s(e,t){return e.x=t.x,e.y=t.y,e}function o(e,t){return e.x=-t.x,e.y=-t.y,e}function a(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function l(e,t){return e.x*t.y-e.y*t.x}function c(e,t){return e.x*t.x+e.y*t.y}function u(e,t,i,r){return e.x=t.x*i+t.y*r,e.y=t.x*r-t.y*i,e}e.LineTessellation=class{constructor(e,t,i){this._writeVertex=e,this._writeTriangle=t,this._canUseThinTessellation=i,this._prevNormal={x:void 0,y:void 0},this._nextNormal={x:void 0,y:void 0},this._textureNormalLeft={x:0,y:1},this._textureNormalRight={x:0,y:-1},this._textureNormal={x:void 0,y:void 0},this._joinNormal={x:void 0,y:void 0},this._inner={x:void 0,y:void 0},this._outer={x:void 0,y:void 0},this._roundStart={x:void 0,y:void 0},this._roundEnd={x:void 0,y:void 0},this._startBreak={x:void 0,y:void 0},this._endBreak={x:void 0,y:void 0},this._innerPrev={x:void 0,y:void 0},this._innerNext={x:void 0,y:void 0},this._bevelStart={x:void 0,y:void 0},this._bevelEnd={x:void 0,y:void 0},this._bevelMiddle={x:void 0,y:void 0}}tessellate(e,r,n=this._canUseThinTessellation){!function(e){if(!e)return;const t=e.length;if(t<=1)return;let r=0;for(let n=1;n<t;n++)i(e[n],e[r])||++r===n||(e[r]=e[n]);e.length=r+1}(e),n&&r.halfWidth<t.thinLineHalfWidthThreshold&&!r.offset?this._tessellateThin(e,r):this._tessellate(e,r)}_tessellateThin(e,t){if(e.length<2)return;const i=t.wrapDistance||65535;let r=t.initialDistance||0,n=!1,s=e[0].x,o=e[0].y;const a=e.length;for(let t=1;t<a;++t){n&&(n=!1,r=0);let a=e[t].x,l=e[t].y,c=a-s,u=l-o,h=Math.sqrt(c*c+u*u);if(c/=h,u/=h,r+h>i){n=!0;const e=(i-r)/h;h=i-r,a=(1-e)*s+e*a,l=(1-e)*o+e*l,--t}const d=this._writeVertex(s,o,0,0,c,u,u,-c,0,-1,r),f=this._writeVertex(s,o,0,0,c,u,-u,c,0,1,r);r+=h;const p=this._writeVertex(a,l,0,0,c,u,u,-c,0,-1,r),m=this._writeVertex(a,l,0,0,c,u,-u,c,0,1,r);this._writeTriangle(d,f,p),this._writeTriangle(f,p,m),s=a,o=l}}_tessellate(e,t){const h=e[0],d=e[e.length-1],f=i(h,d),p=f?3:2;if(e.length<p)return;const m=t.pixelCoordRatio,g=null!=t.capType?t.capType:0,_=null!=t.joinType?t.joinType:2,y=null!=t.miterLimit?Math.min(t.miterLimit,4):2,x=null!=t.roundLimit?Math.min(t.roundLimit,1.05):1.05,b=null!=t.halfWidth?t.halfWidth:2,v=!!t.textured;let S,w,T,M=null;const P=this._prevNormal,I=this._nextNormal;let C=-1,F=-1;const O=this._joinNormal;let A,E;const z=this._textureNormalLeft,R=this._textureNormalRight,V=this._textureNormal;let D=-1,k=-1;const L=t.wrapDistance||65535;let B=t.initialDistance||0;const N=this._writeVertex,G=this._writeTriangle,U=(e,t,i,r,n,s)=>{const o=N(w,T,A,E,i,r,e,t,n,s,B);return D>=0&&k>=0&&o>=0&&G(D,k,o),D=k,k=o,o};f&&(S=e[e.length-2],I.x=d.x-S.x,I.y=d.y-S.y,F=a(I),I.x/=F,I.y/=F);let q=!1;for(let t=0;t<e.length;++t){if(q&&(q=!1,B=0),S&&(P.x=-I.x,P.y=-I.y,C=F,B+C>L&&(q=!0)),q){const i=(L-B)/C;C=L-B,S={x:(1-i)*S.x+i*e[t].x,y:(1-i)*S.y+i*e[t].y},--t}else S=e[t];w=S.x,T=S.y;const i=t<=0&&!q,h=t===e.length-1;if(i||(B+=C),M=h?f?e[1]:null:e[t+1],M?(I.x=M.x-w,I.y=M.y-T,F=a(I),I.x/=F,I.y/=F):(I.x=void 0,I.y=void 0),!f){if(i){n(O,I),A=O.x,E=O.y,2===g&&(U(-I.y-I.x,I.x-I.y,I.x,I.y,0,-1),U(I.y-I.x,-I.x-I.y,I.x,I.y,0,1)),1===g&&(U(-I.y-I.x,I.x-I.y,I.x,I.y,-1,-1),U(I.y-I.x,-I.x-I.y,I.x,I.y,-1,1)),1!==g&&0!==g||(U(-I.y,I.x,I.x,I.y,0,-1),U(I.y,-I.x,I.x,I.y,0,1));continue}if(h){r(O,P),A=O.x,E=O.y,1!==g&&0!==g||(U(P.y,-P.x,-P.x,-P.y,0,-1),U(-P.y,P.x,-P.x,-P.y,0,1)),2===g&&(U(P.y-P.x,-P.x-P.y,-P.x,-P.y,0,-1),U(-P.y-P.x,P.x-P.y,-P.x,-P.y,0,1)),1===g&&(U(P.y-P.x,-P.x-P.y,-P.x,-P.y,1,-1),U(-P.y-P.x,P.x-P.y,-P.x,-P.y,1,1));continue}}let d,p,N=-l(P,I);if(Math.abs(N)<.01)c(P,I)>0?(O.x=P.x,O.y=P.y,N=1,d=Number.MAX_VALUE,p=!0):(n(O,I),N=1,d=1,p=!1);else{O.x=(P.x+I.x)/N,O.y=(P.y+I.y)/N,d=a(O);const e=(d-1)*b*m;p=d>4||e>C&&e>F}A=O.x,E=O.y;let G=_;switch(_){case 0:d<1.05&&(G=2);break;case 1:d<x&&(G=2);break;case 2:d>y&&(G=0)}switch(G){case 2:if(U(O.x,O.y,-P.x,-P.y,0,-1),U(-O.x,-O.y,-P.x,-P.y,0,1),h)break;if(v){const e=q?0:B;D=this._writeVertex(w,T,A,E,I.x,I.y,O.x,O.y,0,-1,e),k=this._writeVertex(w,T,A,E,I.x,I.y,-O.x,-O.y,0,1,e)}break;case 0:{const e=N<0;let t,i,a,l;if(e){const e=D;D=k,k=e,t=z,i=R}else t=R,i=z;if(p)a=e?n(this._innerPrev,P):r(this._innerPrev,P),l=e?r(this._innerNext,I):n(this._innerNext,I);else{const t=e?o(this._inner,O):s(this._inner,O);a=t,l=t}const c=e?r(this._bevelStart,P):n(this._bevelStart,P);U(a.x,a.y,-P.x,-P.y,t.x,t.y);const d=U(c.x,c.y,-P.x,-P.y,i.x,i.y);if(h)break;const f=e?n(this._bevelEnd,I):r(this._bevelEnd,I);if(p){const e=this._writeVertex(w,T,A,E,-P.x,-P.y,0,0,0,0,B);D=this._writeVertex(w,T,A,E,I.x,I.y,l.x,l.y,t.x,t.y,B),k=this._writeVertex(w,T,A,E,I.x,I.y,f.x,f.y,i.x,i.y,B),this._writeTriangle(d,e,k)}else{if(v){const e=this._bevelMiddle;e.x=(c.x+f.x)/2,e.y=(c.y+f.y)/2,u(V,e,-P.x,-P.y),U(e.x,e.y,-P.x,-P.y,V.x,V.y),u(V,e,I.x,I.y),D=this._writeVertex(w,T,A,E,I.x,I.y,e.x,e.y,V.x,V.y,B),k=this._writeVertex(w,T,A,E,I.x,I.y,l.x,l.y,t.x,t.y,B)}else{const e=D;D=k,k=e}U(f.x,f.y,I.x,I.y,i.x,i.y)}if(e){const e=D;D=k,k=e}break}case 1:{const e=N<0;let t,i;if(e){const e=D;D=k,k=e,t=z,i=R}else t=R,i=z;const a=e?o(this._inner,O):s(this._inner,O);let l,f;p?(l=e?n(this._innerPrev,P):r(this._innerPrev,P),f=e?r(this._innerNext,I):n(this._innerNext,I)):(l=a,f=a);const m=e?r(this._roundStart,P):n(this._roundStart,P),g=e?n(this._roundEnd,I):r(this._roundEnd,I),_=U(l.x,l.y,-P.x,-P.y,t.x,t.y),y=U(m.x,m.y,-P.x,-P.y,i.x,i.y);if(h)break;const x=this._writeVertex(w,T,A,E,-P.x,-P.y,0,0,0,0,B);p||this._writeTriangle(D,k,x);const b=o(this._outer,a),S=this._writeVertex(w,T,A,E,I.x,I.y,g.x,g.y,i.x,i.y,B);let M,C;const F=d>2;if(F){let t;d!==Number.MAX_VALUE?(b.x/=d,b.y/=d,t=c(P,b),t=(d*(t*t-1)+1)/t):t=-1,M=e?r(this._startBreak,P):n(this._startBreak,P),M.x+=P.x*t,M.y+=P.y*t,C=e?n(this._endBreak,I):r(this._endBreak,I),C.x+=I.x*t,C.y+=I.y*t}u(V,b,-P.x,-P.y);const L=this._writeVertex(w,T,A,E,-P.x,-P.y,b.x,b.y,V.x,V.y,B);u(V,b,I.x,I.y);const G=v?this._writeVertex(w,T,A,E,I.x,I.y,b.x,b.y,V.x,V.y,B):L,q=x,W=v?this._writeVertex(w,T,A,E,I.x,I.y,0,0,0,0,B):x;let j=-1,H=-1;if(F&&(u(V,M,-P.x,-P.y),j=this._writeVertex(w,T,A,E,-P.x,-P.y,M.x,M.y,V.x,V.y,B),u(V,C,I.x,I.y),H=this._writeVertex(w,T,A,E,I.x,I.y,C.x,C.y,V.x,V.y,B)),v?F?(this._writeTriangle(q,y,j),this._writeTriangle(q,j,L),this._writeTriangle(W,G,H),this._writeTriangle(W,H,S)):(this._writeTriangle(q,y,L),this._writeTriangle(W,G,S)):F?(this._writeTriangle(x,y,j),this._writeTriangle(x,j,H),this._writeTriangle(x,H,S)):(this._writeTriangle(x,y,L),this._writeTriangle(x,G,S)),p?(D=this._writeVertex(w,T,A,E,I.x,I.y,f.x,f.y,t.x,t.y,B),k=S):(D=v?this._writeVertex(w,T,A,E,I.x,I.y,f.x,f.y,t.x,t.y,B):_,this._writeTriangle(D,W,S),k=S),e){const e=D;D=k,k=e}break}}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define(["exports","../../../../../../chunks/earcut","../../../../../../geometry/libtess","../../../../../../geometry/support/TileClipper","../../../../../../layers/graphics/OptimizedGeometry","../../definitions","../bufcut"],function(e,t,i,r,n,s,o){"use strict";const a=new r.TileClipper(0,0,0,1,0),l=new r.TileClipper(0,0,0,1,0);function c(e,t,i){let r=0;for(let n=1;n<i;n++){const i=e[2*(t+n-1)],s=e[2*(t+n-1)+1];r+=(e[2*(t+n)]-i)*(e[2*(t+n)+1]+s)}return r}function u(e,t,i,r,n){let s=0;for(let o=i;o<r;o+=3){const i=2*(e[o]-n),r=2*(e[o+1]-n),a=2*(e[o+2]-n);s+=Math.abs((t[i]-t[a])*(t[r+1]-t[i+1])-(t[i]-t[r])*(t[a+1]-t[i+1]))}return s}a.setExtent(s.tileSize),l.setExtent(s.tileSize),e.area=c,e.clipLinesMarshall=function(e,t){l.setPixelMargin(t);const i=l,r=-t,n=s.tileSize+t;let o=[],a=!1;if(!e.nextPath())return null;let c=e.pathLength(),u=!0;for(;u;){e.seekPathStart();const t=[];if(!e.pathSize)return null;i.reset(2),e.nextPoint();let s=e.x,l=e.y;if(a)i.moveTo(s,l);else{if(s<r||s>n||l<r||l>n){a=!0;continue}t.push({x:s,y:l})}let h=!1;for(;e.nextPoint();)if(s=e.x,l=e.y,a)i.lineTo(s,l);else{if(s<r||s>n||l<r||l>n){h=!0;break}t.push({x:s,y:l})}if(h)a=!0;else{if(a){const e=i.resultWithStarts();if(e)for(const t of e)o.push({...t,pathLength:c})}else o.push({line:t,start:0,pathLength:c});u=e.nextPath(),c=u?e.pathLength():0,a=!1}}return o=o.filter(e=>e.line.length>1),0===o.length?null:o},e.clipMarshall=function(e,t){if(null==e)return null;if(!function(e,t,i){let r=0;for(let t=0;t<e.lengths.length;t++){const n=e.lengths[t];for(let t=0;t<n;t++){const n=e.coords[2*(t+r)],s=e.coords[2*(t+r)+1];if(n<-128||n>i||s<-128||s>i)return!0}r+=n}return!1}(e,0,s.tileSize+128))return e;a.setPixelMargin(t),a.reset(3);let i=0;for(let t=0;t<e.lengths.length;t++){const r=e.lengths[t];let n=e.coords[2*(0+i)],s=e.coords[2*(0+i)+1];a.moveTo(n,s);for(let t=1;t<r;t++)n=e.coords[2*(t+i)],s=e.coords[2*(t+i)+1],a.lineTo(n,s);a.close(),i+=r}const r=a.result(!1);if(!r)return null;const o=[],l=[];for(const e of r){let t=0;for(const i of e)l.push(i.x),l.push(i.y),t++;o.push(t)}return new n(o,l)},e.triangleAreaArray=u,e.triangulate=function(e,t){const{coords:i,lengths:r}=t,n=e;let s=0;for(let e=0;e<r.length;){let t=e,a=r[e],l=c(i,s,a);const h=[];for(;++t<r.length;){const e=r[t],n=c(i,s+a,e);if(!(n>0))break;l+=n,h.push(s+a),a+=e}const d=n.length;o.bufcut(n,i,s,s+a,h,2,0);const f=u(n,i,d,n.length,0),p=Math.abs(l);if(Math.abs((f-p)/Math.max(1e-7,p))>1e-5)return n.length=0,!1;e=t,s+=a}return!0},e.triangulateEarcut=function(e,i,r){const{coords:n,lengths:s}=i;let o=0;for(let a=0;a<s.length;){let l=a,u=s[a];const h=[];for(;++l<s.length;){const e=s[l];if(!(c(n,o+u,e)>0))break;h.push(o+u-o),u+=e}const d=o+u,f=i.coords.slice(2*o,2*d),p=t.earcut(f,h,2);for(const t of p)e.push(t+r+o);a=l,o+=u}return!0},e.triangulateLibtess=function(e){const{coords:t,lengths:r}=e,{buffer:n}=i.triangulate(t,r);return n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports"],function(e){"use strict";function t(e,t,s){s=s||2;var o,a,l,u,d,f,m,g=t&&t.length,_=g?t[0]*s:e.length,y=i(e,0,_,s,!0),x=[];if(!y||y.next===y.prev)return x;if(g&&(y=function(e,t,n,s){var o,a,l,u=[];for(o=0,a=t.length;o<a;o++)(l=i(e,t[o]*s,o<a-1?t[o+1]*s:e.length,s,!1))===l.next&&(l.steiner=!0),u.push(p(l));for(u.sort(c),o=0;o<u.length;o++)n=r(n=h(u[o],n),n.next);return n}(e,t,y,s)),e.length>80*s){o=l=e[0],a=u=e[1];for(var b=s;b<_;b+=s)(d=e[b])<o&&(o=d),(f=e[b+1])<a&&(a=f),d>l&&(l=d),f>u&&(u=f);m=0!==(m=Math.max(l-o,u-a))?1/m:0}return n(y,x,s,o,a,m),x}function i(e,t,i,r,n){var s,o;if(n===I(e,t,i,r)>0)for(s=t;s<i;s+=r)o=T(s,e[s],e[s+1],o);else for(s=i-r;s>=t;s-=r)o=T(s,e[s],e[s+1],o);if(o&&y(o,o.next)){var a=o.next;M(o),o=a}return o}function r(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!y(r,r.next)&&0!==_(r.prev,r,r.next))r=r.next;else{var n=r.prev;if(M(r),(r=t=n)===r.next)break;i=!0}}while(i||r!==t);return t}function n(e,t,i,c,u,h,d){if(e){!d&&h&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=f(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,s,o,a,l,c=1;do{for(i=e,e=null,s=null,o=0;i;){for(o++,r=i,a=0,t=0;t<c&&(a++,r=r.nextZ);t++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=r}s.nextZ=null,c*=2}while(o>1)}(n)}(e,c,u,h);for(var p,m,g=e;e.prev!==e.next;)if(p=e.prev,m=e.next,h?o(e,c,u,h):s(e))t.push(p.i/i),t.push(e.i/i),t.push(m.i/i),M(e),e=m.next,g=m.next;else if((e=m)===g){d?1===d?n(e=a(r(e),t,i),t,i,c,u,h,2):2===d&&l(e,t,i,c,u,h):n(r(e),t,i,c,u,h,1);break}}}function s(e){var t=e.prev,i=e,r=e.next;if(_(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(m(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&_(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function o(e,t,i,r){var n=e.prev,s=e,o=e.next;if(_(n,s,o)>=0)return!1;for(var a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,l=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,c=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,u=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=f(a,l,t,i,r),d=f(c,u,t,i,r),p=e.prevZ,g=e.nextZ;p&&p.z>=h&&g&&g.z<=d;){if(p!==e.prev&&p!==e.next&&m(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,g!==e.prev&&g!==e.next&&m(n.x,n.y,s.x,s.y,o.x,o.y,g.x,g.y)&&_(g.prev,g,g.next)>=0)return!1;g=g.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&m(n.x,n.y,s.x,s.y,o.x,o.y,p.x,p.y)&&_(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=d;){if(g!==e.prev&&g!==e.next&&m(n.x,n.y,s.x,s.y,o.x,o.y,g.x,g.y)&&_(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0}function a(e,t,i){var n=e;do{var s=n.prev,o=n.next.next;!y(s,o)&&x(s,n,n.next,o)&&S(s,o)&&S(o,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(o.i/i),M(n),M(n.next),n=e=o),n=n.next}while(n!==e);return r(n)}function l(e,t,i,s,o,a){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&g(l,c)){var u=w(l,c);return l=r(l,l.next),u=r(u,u.next),n(l,t,i,s,o,a),void n(u,t,i,s,o,a)}c=c.next}l=l.next}while(l!==e)}function c(e,t){return e.x-t.x}function u(e){if(e.next.prev===e)return e;let t=e;for(;;){const i=t.next;if(i.prev===t||i===t||i===e)break;t=i}return t}function h(e,t){var i=function(e,t){var i,r=t,n=e.x,s=e.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>o){if(o=a,a===n){if(s===r.y)return r;if(s===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===o)return i;var l,c=i,u=i.x,h=i.y,f=1/0;r=i;do{n>=r.x&&r.x>=u&&n!==r.x&&m(s<h?n:o,s,u,h,s<h?o:n,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(n-r.x),S(r,e)&&(l<f||l===f&&(r.x>i.x||r.x===i.x&&d(i,r)))&&(i=r,f=l)),r=r.next}while(r!==c);return i}(e,t);if(!i)return t;var n=w(i,e),s=r(i,i.next);let o=u(n);return r(o,o.next),s=u(s),u(t===i?s:t)}function d(e,t){return _(e.prev,e,t.prev)<0&&_(t.next,e,e.next)<0}function f(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function m(e,t,i,r,n,s,o,a){return(n-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(r-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(n-o)*(r-a)>=0}function g(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&x(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(S(e,t)&&S(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)&&(_(e.prev,e,t.prev)||_(e,t.prev,t))||y(e,t)&&_(e.prev,e,e.next)>0&&_(t.prev,t,t.next)>0)}function _(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function y(e,t){return e.x===t.x&&e.y===t.y}function x(e,t,i,r){var n=v(_(e,t,i)),s=v(_(e,t,r)),o=v(_(i,r,e)),a=v(_(i,r,t));return n!==s&&o!==a||!(0!==n||!b(e,i,t))||!(0!==s||!b(e,r,t))||!(0!==o||!b(i,e,r))||!(0!==a||!b(i,t,r))}function b(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function v(e){return e>0?1:e<0?-1:0}function S(e,t){return _(e.prev,e,e.next)<0?_(e,t,e.next)>=0&&_(e,e.prev,t)>=0:_(e,t,e.prev)<0||_(e,e.next,t)<0}function w(e,t){var i=new P(e.i,e.x,e.y),r=new P(t.i,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}function T(e,t,i,r){var n=new P(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function P(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function I(e,t,i,r){for(var n=0,s=t,o=i-r;s<i;s+=r)n+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return n}t.deviation=function(e,t,i,r){var n=t&&t.length,s=n?t[0]*i:e.length,o=Math.abs(I(e,0,s,i));if(n)for(var a=0,l=t.length;a<l;a++){var c=t[a]*i,u=a<l-1?t[a+1]*i:e.length;o-=Math.abs(I(e,c,u,i))}var h=0;for(a=0;a<r.length;a+=3){var d=r[a]*i,f=r[a+1]*i,p=r[a+2]*i;h+=Math.abs((e[d]-e[p])*(e[f+1]-e[d+1])-(e[d]-e[f])*(e[p+1]-e[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},t.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},r=0,n=0;n<e.length;n++){for(var s=0;s<e[n].length;s++)for(var o=0;o<t;o++)i.vertices.push(e[n][s][o]);n>0&&(r+=e[n-1].length,i.holes.push(r))}return i},e.earcut=t})},"esri/geometry/libtess":function(){define(["require","exports","../assets","../core/has"],function(e,t,i,r){"use strict";let n=null,s=null;t.loadLibtess=async function(){return n||(n=async function(){const t=r("esri-csp-restrictions")?await new Promise((t,i)=>e(["../chunks/libtess-asm"],t,i)).then(e=>e.libtessAsm):await new Promise((t,i)=>e(["../chunks/libtess"],t,i)).then(e=>e.libtess);s=await t.default({locateFile:e=>i.getAssetUrl(`esri/core/libs/libtess/${e}`)})}()),n},t.triangulate=function(e,t){const i=Math.max(e.length,128e3);return s.triangulate(e,t,i)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports","../../../../../core/has"],function(e,t){"use strict";function i(e,t,i,r,n,s,o){let c;if(o===function(e,t,i,r,n,s){let o=0;for(let i=r,a=n-s;i<n;i+=s)o+=(e[a+t*s]-e[i+t*s])*(e[i+1+t*s]+e[a+1+t*s]),a=i;return o}(e,t,0,r,n,s)>0)for(let i=r;i<n;i+=s)c=a(i+t*s,e[i+t*s],e[i+1+t*s],c);else for(let i=n-s;i>=r;i-=s)c=a(i+t*s,e[i+t*s],e[i+1+t*s],c);return c&&_(c,c.next)&&(l(c),c=c.next),c}function r(e,t=e){if(!e)return e;let i,r=e;do{if(i=!1,r.steiner||!_(r,r.next)&&0!==d(r.prev,r,r.next))r=r.next;else{if(l(r),r=t=r.prev,r===r.next)break;i=!0}}while(i||r!==t);return t}function n(e,t,i,a,c,u,d,f){if(!e)return;!f&&u&&(e=h(e,a,c,u));let p=e;for(;e.prev!==e.next;){const h=e.prev,m=e.next;if(u?o(e,a,c,u):s(e))t.push(h.index/i+d),t.push(e.index/i+d),t.push(m.index/i+d),l(e),e=m.next,p=m.next;else if((e=m)===p){f?1===f?n(e=x(e,t,i,d),t,i,a,c,u,d,2):2===f&&b(e,t,i,a,c,u,d):n(r(e),t,i,a,c,u,d,1);break}}}function s(e){const t=e.prev,i=e,r=e.next;if(d(t,i,r)>=0)return!1;let n=e.next.next;const s=n;let o=0;for(;n!==e.prev&&(0===o||n!==s);){if(o++,p(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&d(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function o(e,t,i,r){const n=e.prev,s=e,o=e.next;if(d(n,s,o)>=0)return!1;const a=n.x<s.x?n.x<o.x?n.x:o.x:s.x<o.x?s.x:o.x,l=n.y<s.y?n.y<o.y?n.y:o.y:s.y<o.y?s.y:o.y,c=n.x>s.x?n.x>o.x?n.x:o.x:s.x>o.x?s.x:o.x,u=n.y>s.y?n.y>o.y?n.y:o.y:s.y>o.y?s.y:o.y,h=g(a,l,t,i,r),f=g(c,u,t,i,r);let m=e.prevZ,_=e.nextZ;for(;m&&m.z>=h&&_&&_.z<=f;){if(m!==e.prev&&m!==e.next&&p(n.x,n.y,s.x,s.y,o.x,o.y,m.x,m.y)&&d(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,_!==e.prev&&_!==e.next&&p(n.x,n.y,s.x,s.y,o.x,o.y,_.x,_.y)&&d(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;m&&m.z>=h;){if(m!==e.prev&&m!==e.next&&p(n.x,n.y,s.x,s.y,o.x,o.y,m.x,m.y)&&d(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;_&&_.z<=f;){if(_!==e.prev&&_!==e.next&&p(n.x,n.y,s.x,s.y,o.x,o.y,_.x,_.y)&&d(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function a(e,t,i,r){const n=w.create(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function c(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function u(e,t){const i=function(e,t){let i=t;const r=e.x,n=e.y;let s,o=-1/0;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){const e=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=r&&e>o){if(o=e,e===r){if(n===i.y)return i;if(n===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!s)return null;if(r===o)return s.prev;const a=s,l=s.x,c=s.y;let u,h=1/0;for(i=s.next;i!==a;)r>=i.x&&i.x>=l&&r!==i.x&&p(n<c?r:o,n,l,c,n<c?o:r,n,i.x,i.y)&&(u=Math.abs(n-i.y)/(r-i.x),(u<h||u===h&&i.x>s.x)&&m(i,e)&&(s=i,h=u)),i=i.next;return s}(e,t);if(!i)return t;const n=S(i,e);return r(n,n.next),r(i,i.next)}function h(e,t,i,r){let n;for(;n!==e;n=n.next){if(n=n||e,null===n.z&&(n.z=g(n.x,n.y,t,i,r)),n.prev.next!==n||n.next.prev!==n)return n.prev.next=n,n.next.prev=n,h(e,t,i,r);n.prevZ=n.prev,n.nextZ=n.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){let t,i=1;for(;;){let r,n=e;e=null,t=null;let s=0;for(;n;){s++,r=n;let o=0;for(;o<i&&r;o++)r=r.nextZ;let a=i;for(;o>0||a>0&&r;){let i;0===o?(i=r,r=r.nextZ,a--):0!==a&&r?n.z<=r.z?(i=n,n=n.nextZ,o--):(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,o--),t?t.nextZ=i:e=i,i.prevZ=t,t=i}n=r}if(t.nextZ=null,i*=2,s<2)return e}}(e)}function d(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function f(e,t,i,r){return!!(_(e,t)&&_(i,r)||_(e,r)&&_(i,t))||d(e,t,i)>0!=d(e,t,r)>0&&d(i,r,e)>0!=d(i,r,t)>0}function p(e,t,i,r,n,s,o,a){return(n-o)*(t-a)-(e-o)*(s-a)>=0&&(e-o)*(r-a)-(i-o)*(t-a)>=0&&(i-o)*(s-a)-(n-o)*(r-a)>=0}function m(e,t){return d(e.prev,e,e.next)<0?d(e,t,e.next)>=0&&d(e,e.prev,t)>=0:d(e,t,e.prev)<0||d(e,e.next,t)<0}function g(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function _(e,t){return e.x===t.x&&e.y===t.y}function y(e,t){return e.x-t.x}function x(e,t,i,r){let n=e;do{const s=n.prev,o=n.next.next;!_(s,o)&&f(s,n,n.next,o)&&m(s,o)&&m(o,s)&&(t.push(s.index/i+r),t.push(n.index/i+r),t.push(o.index/i+r),l(n),l(n.next),n=e=o),n=n.next}while(n!==e);return n}function b(e,t,i,s,o,a,l){let c=e;do{let e=c.next.next;for(;e!==c.prev;){if(c.index!==e.index&&v(c,e)){let u=S(c,e);return c=r(c,c.next),u=r(u,u.next),n(c,t,i,s,o,a,l,0),void n(u,t,i,s,o,a,l,0)}e=e.next}c=c.next}while(c!==e)}function v(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){let i=e;do{if(i.index!==e.index&&i.next.index!==e.index&&i.index!==t.index&&i.next.index!==t.index&&f(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&m(e,t)&&m(t,e)&&function(e,t){let i=e,r=!1;const n=(e.x+t.x)/2,s=(e.y+t.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)}function S(e,t){const i=w.create(e.index,e.x,e.y),r=w.create(t.index,t.x,t.y),n=e.next,s=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,s.next=r,r.prev=s,r}class w{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(e,t,i){const r=M<T.length?T[M++]:new w;return r.index=e,r.x=t,r.y=i,r.prev=null,r.next=null,r.z=null,r.prevZ=null,r.nextZ=null,r.steiner=!1,r}}const T=[];let M=0;for(let e=0;e<8096;e++)T.push(new w);e.bufcut=function(e,t,r,s,o,a,l){M=0;const h=(s-r)*a,d=o&&o.length,f=d?(o[0]-r)*a:h;let p,m,g,_,x,b=i(t,r,0,0,f,a,!0);if(b&&b.next!==b.prev){if(d&&(b=function(e,t,r,n,s,o){const a=new Array;for(let s=0,l=n.length;s<l;s++){const u=i(e,t,0,n[s]*o,s<l-1?n[s+1]*o:r*o,o,!1);u===u.next&&(u.steiner=!0),a.push(c(u))}a.sort(y);for(const e of a)s=u(e,s);return s}(t,r,s,o,b,a)),h>80*a){p=g=t[0+r*a],m=_=t[1+r*a];for(let e=a;e<f;e+=a){const i=t[e+r*a],n=t[e+1+r*a];p=Math.min(p,i),m=Math.min(m,n),g=Math.max(g,i),_=Math.max(_,n)}x=Math.max(g-p,_-m),x=0!==x?1/x:0}n(b,e,a,p,m,x,l,0)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../definitions","../../../TurboLine","../../../mesh/templates/templateUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../mesh/utils","../../../../../../webgl/enums"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0,this.pathLength=0,this.distanceOffset=0,this.lineLength=0}}const h={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:c.DataType.SHORT,count:2,packPrecisionFactor:r.minMaxZoomPrecisionFactor,pack:({scaleInfo:e},{tileInfo:t})=>o.getMinMaxZoom(e,t)}},attributes:{id:{type:c.DataType.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:c.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:c.DataType.UNSIGNED_BYTE,count:1},color:{type:c.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>o.processColorInput(e)},offset:{type:c.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[o.packRounded(e,16),o.packRounded(t,16)]},normal:{type:c.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[o.packRounded(e,16),o.packRounded(t,16)]},halfWidth:{type:c.DataType.HALF_FLOAT,count:1,pack:({width:e})=>t.pt2px(.5*e)},referenceHalfWidth:{type:c.DataType.HALF_FLOAT,count:1,pack:({referenceWidth:e})=>t.pt2px(.5*e)}}};class d{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0,this.distanceOffset=0}}const f=65535;class p extends a.MeshWriter{constructor(e,t,i,r){super(e,t,i,r),this.vertexSpec=h,this._currentWrite=new d,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:f,textured:!1},this._tessParams=new u,this._initializeTessellator()}writeLineVertices(e,t,i){const r=this._getLines(t);null!=r&&this._writeVertices(e,i,r)}_initializeTessellator(){this._lineTessellator=new n.LineTessellation(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(e,t,r){const n=r??i.GeometryCursor.fromFeatureSetReaderCIM(t);n&&this._writeGeometry(e,t,n)}_writeGeometry(e,t,i,r){e.recordStart(this.instanceId,this.attributeLayout,r),this.writeLineVertices(e,i,t),e.recordEnd()}_getLines(e){return s.clipLinesMarshall(e,l.getLineClippingMargin(this.evaluatedMeshParams))}_writeVertices(e,i,n){const{_currentWrite:s,_tessellationOptions:a,evaluatedMeshParams:l}=this,{width:c,capType:u,joinType:h,miterLimit:d,hasSizeVV:p}=l,m=t.pt2px(.5*c);a.halfWidth=m,a.capType=o.processLineCapInput(u),a.joinType=o.processLineJoinInput(h),a.miterLimit=d;const g=!p;s.out=e,s.id=i.getDisplayId(),s.vertexCount=0,s.indexCount=0,s.vertexFrom=e.vertexCount(),s.vertexBounds=g&&m<r.thinLineHalfWidthThreshold?0:1;for(const{line:e,start:t,pathLength:i}of n)a.initialDistance=t%f,s.pathLength=i,s.distanceOffset=Math.floor(t/f)*f,this._lineTessellator.tessellate(e,a,g)}_writeTesselatedVertex(e,t,i,r,n,s,o,a,l,c,u){const{out:h,id:d,vertexBounds:f,pathLength:p,distanceOffset:m}=this._currentWrite;return this.hasEffects&&h.recordBounds(e,t,f,f),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=l,this._tessParams.normalY=c,this._tessParams.directionX=n,this._tessParams.directionY=s,this._tessParams.distance=u,this._tessParams.pathLength=p,this._tessParams.distanceOffset=m,this._writeVertex(h,d,e,t,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(e,t,i){const{out:r}=this._currentWrite;r.indexEnsureSize(3),r.indexWrite(e),r.indexWrite(t),r.indexWrite(i),this._currentWrite.indexCount+=3}}e.LineMeshWriter=p,e.LineTessellationParams=u,e.LineVertexSpec=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter":function(){define(["exports","../fill/AFillMeshWriter","../../../../../../webgl/enums"],function(e,t,i){"use strict";const r={createComputedParams:e=>e,optionalAttributes:{},attributes:{id:{type:i.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:i.DataType.UNSIGNED_BYTE,count:1},pos:{type:i.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:i.DataType.FLOAT,count:1,packTessellation:({inverseArea:e})=>e}}};class n extends t.AFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=r}createTesselationParams(e){return{inverseArea:1/e.readGeometryArea()}}}e.DotDensityMeshWriter=n,e.dotDensityVertexSpec=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/AFillMeshWriter":function(){define(["exports","../../../../../../../core/has","../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils","../mesh/MeshWriter"],function(e,t,i,r,n){"use strict";const s=t("featurelayer-fast-triangulation-enabled");class o extends n.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),i.loadLibtess()])}_write(e,t,i){const r=i?.asOptimized()??t.readGeometryForDisplay(),n=this._clip(r);n&&(e.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(e,t,n),e.recordEnd())}_clip(e){if(!e)return null;const t=this.hasEffects?256:8;return r.clipMarshall(e,t)}_writeGeometry(e,t,i){const n=i.maxLength>100,o=[],a=this.createTesselationParams(t);if(!n&&s&&r.triangulate(o,i))return void(o.length&&this._writeVertices(e,t,i.coords,a,o));const l=r.triangulateLibtess(i);this._writeVertices(e,t,l,a)}_writeVertices(e,t,i,r,n){const s=t.getDisplayId(),o=e.vertexCount(),a=this.hasEffects;let l=0;if(n)for(const t of n){const n=i[2*t],o=i[2*t+1];a&&e.recordBounds(n,o,0,0),this._writeVertex(e,s,n,o,r),l++}else for(let t=0;t<i.length;t+=2){const n=Math.round(i[t]),o=Math.round(i[t+1]);a&&e.recordBounds(n,o,0,0),this._writeVertex(e,s,n,o,r),l++}e.indexEnsureSize(l);for(let t=0;t<l;t++)e.indexWrite(t+o)}}e.AFillMeshWriter=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../vectorTiles/GeometryUtils","./meshWriterUtils","./PatternFillMeshWriter","../shaders/constants","../../../../../../webgl/enums"],function(e,t,i,r,n,s,o){"use strict";function a(e){const{sprite:i,aspectRatio:r,scaleProportionally:n}=e,s=t.pt2px(e.height),o=s>0?s:i.height;let a=s*r;return a<=0?a=i.width:n&&(a*=i.width/i.height),{width:a,height:o}}function l(e){const{applyRandomOffset:t,sampleAlphaOnly:i}=e;return r.packBitset([[s.bitsetFillRandomPatternOffset,t],[s.bitsetGenericConsiderAlphaOnly,i]])}const c={createComputedParams:e=>e,optionalAttributes:n.patternFillVertexSpec.optionalAttributes,attributes:{...n.patternFillVertexSpec.attributes,bitset:{count:1,type:o.DataType.UNSIGNED_BYTE,pack:l},width:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>a(e).width},height:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>a(e).height},offset:{count:2,type:o.DataType.HALF_FLOAT,pack:({offsetX:e,offsetY:i})=>[t.pt2px(e),-t.pt2px(i)]},scale:{count:2,type:o.DataType.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:e,scaleY:t})=>[e,t]},angle:{count:1,type:o.DataType.UNSIGNED_BYTE,pack:({angle:e})=>i.degToByte(e)}}};class u extends n.PatternFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=c}}e.ComplexFillMeshWriter=u,e.complexFillVertexSpec=c,e.getPatternSize=a,e.packComplexFillBitset=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter":function(){define(["exports","../../../definitions","./FillMeshWriter","../../../../../../webgl/enums"],function(e,t,i,r){"use strict";const n={createComputedParams:e=>e,optionalAttributes:i.fillVertexSpec.optionalAttributes,attributes:{...i.fillVertexSpec.attributes,tlbr:{count:4,type:r.DataType.UNSIGNED_SHORT,pack:({sprite:e})=>{const{rect:i,width:r,height:n}=e,s=i.x+t.spritePadding,o=i.y+t.spritePadding;return[s,o,s+r,o+n]}},inverseRasterizationScale:{count:1,type:r.DataType.BYTE,packPrecisionFactor:16,pack:({sprite:e})=>1/e.rasterizationScale}}};class s extends i.FillMeshWriter{constructor(){super(...arguments),this.vertexSpec=n}_write(e,t,i){const r=i?.asOptimized()??t.readGeometryForDisplay(),n=this._clip(r);if(!n)return;const s=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,s),this._writeGeometry(e,t,n),e.recordEnd()}}e.PatternFillMeshWriter=s,e.patternFillVertexSpec=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter":function(){define(["exports","../../../definitions","./AFillMeshWriter","./meshWriterUtils","../../../../../../webgl/enums"],function(e,t,i,r,n){"use strict";const s={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:n.DataType.SHORT,count:2,packPrecisionFactor:t.minMaxZoomPrecisionFactor,pack:({scaleInfo:e},{tileInfo:t})=>r.getMinMaxZoom(e,t)}},attributes:{id:{type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.DataType.UNSIGNED_BYTE,count:1},pos:{type:n.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:n.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>r.processColorInput(e)}}};class o extends i.AFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=s}createTesselationParams(e){return null}}e.FillMeshWriter=o,e.fillVertexSpec=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","./ComplexFillMeshWriter","./meshWriterUtils","./OutlineFillMeshWriter","../shaders/constants","../../../../../../webgl/enums"],function(e,t,i,r,n,s,o){"use strict";const a=i.complexFillVertexSpec,l=n.outlineFillVertexSpec_Outline,c={createComputedParams:e=>e,optionalAttributes:a.optionalAttributes,attributes:{...a.attributes,bitset:{type:o.DataType.UNSIGNED_BYTE,count:1,pack:e=>i.packComplexFillBitset(e)},aux1:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>i.getPatternSize(e).width},aux2:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>i.getPatternSize(e).height},aux3:{count:2,type:o.DataType.HALF_FLOAT,pack:({offsetX:e,offsetY:i})=>[t.pt2px(e),t.pt2px(i)]},aux4:{count:2,type:o.DataType.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:t})=>[e*s.packPrecision,t*s.packPrecision]}}},u={createComputedParams:e=>e,optionalAttributes:a.optionalAttributes,attributes:{...a.attributes,color:l.attributes.color,bitset:{type:o.DataType.UNSIGNED_BYTE,count:1,pack:e=>r.packBitset([[s.bitsetTypeFillOutline,!0]])},aux1:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>t.pt2px(.5*e.width)},aux2:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>t.pt2px(.5*e.referenceWidth)},aux3:{count:2,type:o.DataType.HALF_FLOAT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[e,t]},aux4:{count:2,type:o.DataType.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:t})=>[e*s.packPrecision+s.signedToUnsignedByte,t*s.packPrecision+s.signedToUnsignedByte]}}};class h extends n.OutlineFillOutlineMeshWriter{constructor(){super(...arguments),this.vertexSpec=u}}class d extends n.OutlineFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=c}_createOutlineWriter(e,t,i,r){return new h(e,t,i,r)}write(e,t,i,r,n){this.ensurePacked(t,i,r);const s=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,s),this._write(e,i),e.recordEnd()}ensurePacked(e,t,i){super.ensurePacked(e,t,i),this._lineMeshWriter.ensurePacked(e,t,i)}enqueueRequest(e,t,i){super.enqueueRequest(e,t,i),this._lineMeshWriter.enqueueRequest(e,t,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}e.ComplexOutlineFillMeshWriter=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","../../../mesh/templates/templateUtils","./FillMeshWriter","./meshWriterUtils","../line/LineMeshWriter","../mesh/utils","../shaders/constants","../../../../../../webgl/enums"],function(e,t,i,r,n,s,o,a,l){"use strict";const c={createComputedParams:e=>e,optionalAttributes:s.LineVertexSpec.optionalAttributes,attributes:{...s.LineVertexSpec.attributes,bitset:{type:l.DataType.UNSIGNED_BYTE,count:1,pack:e=>0},color:{type:l.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>n.processColorInput(e)}}},u={createComputedParams:e=>e,optionalAttributes:s.LineVertexSpec.optionalAttributes,attributes:{...s.LineVertexSpec.attributes,bitset:{type:l.DataType.UNSIGNED_BYTE,count:1,pack:e=>n.packBitset([[a.bitsetTypeFillOutline,!0],[a.bitsetOutlineUsesColorVV,e.outlineUsesColorVV]])},color:{type:l.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>n.processColorInput(e)}}};class h extends s.LineMeshWriter{constructor(){super(...arguments),this.vertexSpec=u}}class d extends r.FillMeshWriter{constructor(e,t,i,r){super(e,t,i,r),this.vertexSpec=c,this._lineMeshWriter=this._createOutlineWriter(e,t,i,r)}_createOutlineWriter(e,t,i,r){return new h(e,t,i,r)}_write(e,t){const i=this.evaluatedMeshParams.effects,r=this.evaluatedMeshParams.outlineEffects;if(i?.length||r?.length){if(i?.length){const r=this.getEffectCursor(e,t,i);if(r){let i;for(;i=r?.next();)i.invertY(),this._writeFill(e,t,i)}}else this._writeFill(e,t);if(r?.length){const i=this.getEffectCursor(e,t,r);if(i){let r;for(;r=i?.next();)r.invertY(),this._writeOutline(e,t,r)}}else this._writeOutline(e,t)}else this._writeSimpleOutlineFill(e,t)}_writeSimpleOutlineFill(e,i){const r=i.readGeometryForDisplay(),n=this._clip(r);n&&(this._writeGeometry(e,i,n),this._lineMeshWriter.writeLineVertices(e,t.GeometryCursor.fromOptimizedCIM(n,"esriGeometryPolyline"),i))}_writeFill(e,t,i){const r=i?.asOptimized()??t.readGeometryForDisplay(),n=this._clip(r);n&&this._writeGeometry(e,t,n)}_writeOutline(e,i,r){const n=r?.asOptimized()??i.readGeometryForDisplay(),s=this._clip(n);s&&this._lineMeshWriter.writeLineVertices(e,t.GeometryCursor.fromOptimizedCIM(s,"esriGeometryPolyline"),i)}_clip(e){return e?i.clipMarshall(e,o.getLineClippingMargin(this.evaluatedMeshParams)):null}get effectInfos(){return[...this._evaluator.inputMeshParams.effects?.effectInfos??[],...this._evaluator.inputMeshParams.outlineEffects?.effectInfos??[]]}write(e,t,i,r,n){this.ensurePacked(t,i,r),e.recordStart(this.instanceId,this.attributeLayout),this._write(e,i),e.recordEnd()}ensurePacked(e,t,i){super.ensurePacked(e,t,i),this._lineMeshWriter.ensurePacked(e,t,i)}enqueueRequest(e,t,i){super.enqueueRequest(e,t,i),this._lineMeshWriter.enqueueRequest(e,t,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}get hasEffects(){return!!this.evaluatedMeshParams.outlineEffects}}e.OutlineFillMeshWriter=d,e.OutlineFillOutlineMeshWriter=h,e.outlineFillVertexSpec_Fill=c,e.outlineFillVertexSpec_Outline=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientFillMeshWriter":function(){define(["exports","../../../definitions","./AFillMeshWriter","./FillMeshWriter","./gradientFillConstants","./GradientSizeHelper","./meshWriterUtils","../../../../../../webgl/enums"],function(e,t,i,r,n,s,o,a){"use strict";const l={createComputedParams:e=>e,optionalAttributes:r.fillVertexSpec.optionalAttributes,attributes:{...r.fillVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({gradientSizeUnits:e,gradientType:t})=>{let i=0;return 1===e&&(i|=o.getBitMask(n.bitset.isAbsolute)),"discrete"===t.toLowerCase()&&(i|=o.getBitMask(n.bitset.isDiscrete)),i}},tlbr:{count:4,type:a.DataType.UNSIGNED_SHORT,pack:({sprite:e})=>{const{rect:i,width:r,height:n}=e,s=i.x+t.spritePadding+t.gradientTextureExternalPadding,o=i.y+t.spritePadding;return[s,o,s+r-2*t.gradientTextureExternalPadding,o+n]}},relativePosition:{count:2,type:a.DataType.HALF_FLOAT,packTessellation:({gradientStats:e},t,i,r)=>e?.getRelativePosition(i,r)??[0,0]},relativeGradientSize:{count:2,type:a.DataType.HALF_FLOAT,packTessellation:({gradientStats:e})=>e?.relativeSize??[1,1]},gradientMethod:{count:1,type:a.DataType.UNSIGNED_BYTE,pack:({gradientMethod:e})=>{switch(e.toLowerCase()){case"rectangular":return n.gradientFillMethods.rectangular;case"circular":return n.gradientFillMethods.circular;default:return n.gradientFillMethods.linear}}}}};class c extends i.AFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=l}get _preventEffectClipping(){return!0}createTesselationParams(e){return{gradientStats:s.getGradientSizeHelper(this._unclippedGeometry,this.evaluatedMeshParams)}}_write(e,t,i){const r=i?.asOptimized()??t.readGeometryForDisplay();this._unclippedGeometry=r;const n=this._clip(r);if(!n)return void(this._unclippedGeometry=null);const s=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,s),this._writeGeometry(e,t,n),this._unclippedGeometry=null,e.recordEnd()}}e.GradientFillMeshWriter=c,e.gradientFillVertexSpec=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientSizeHelper":function(){define(["exports","../../../../../../../core/Logger","../../../../../../../core/mathUtils","../../../../../../../core/screenUtils"],function(e,t,i,r){"use strict";class n{constructor(e,t){this._size=e,this._sizeUnits=t,this._relativeSize=null}get relativeSize(){return this._relativeSize??=this.calculateRelativeSize(),this._relativeSize}calculateRelativeSize(){if(0===this._sizeUnits){const e=Math.min(this._size/100,1);return[e,e]}return this.calculateRelativeSizeFromAbsolute()}}class s extends n{constructor(e,t,i,r){super(t,i),this.rotationMatrix00=1,this.rotationMatrix01=0,this.rotationMatrix10=0,this.rotationMatrix11=1,this.bounds={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0},this.rotationMatrix00=Math.cos(r),this.rotationMatrix01=-Math.sin(r),this.rotationMatrix10=-this.rotationMatrix01,this.rotationMatrix11=this.rotationMatrix00;const{bounds:n,rotationMatrix00:s,rotationMatrix01:o,rotationMatrix10:a,rotationMatrix11:l}=this;e.forEachVertex((e,t)=>{const i=e*s+t*o,r=e*a+t*l;n.xmin=Math.min(n.xmin,i),n.ymin=Math.min(n.ymin,r),n.xmax=Math.max(n.xmax,i),n.ymax=Math.max(n.ymax,r)}),this.center=[(n.xmin+n.xmax)/2,(n.ymin+n.ymax)/2]}}class o extends s{constructor(e,t,i,r){super(e,t,i,r),this.method="linear"}getRelativePosition(e,t){const{rotationMatrix00:i,rotationMatrix01:r,bounds:n}=this,{xmin:s,xmax:o}=n;return[(e*i+t*r-s)/(o-s),0]}calculateRelativeSizeFromAbsolute(){const{_size:e,bounds:t}=this,{xmin:i,xmax:n}=t;return[r.pt2px(e)/(n-i),0]}}class a extends s{constructor(e,t,i,r){super(e,t,i,r),this.method="rectangular"}getRelativePosition(e,t){const{bounds:i,center:r,rotationMatrix00:n,rotationMatrix01:s,rotationMatrix10:o,rotationMatrix11:a}=this,l=e*o+t*a,c=e*n+t*s-r[0],u=l-r[1];return[c*(2/(i.xmax-i.xmin)),-u*(2/(i.ymax-i.ymin))]}calculateRelativeSizeFromAbsolute(){const{_size:e,bounds:t}=this,{xmin:i,ymin:n,xmax:s,ymax:o}=t;return[r.pt2px(2*e)/(s-i),r.pt2px(2*e)/(o-n)]}}class l extends s{constructor(e,t,i){super(e,t,i,0),this.method="circular";const{xmin:r,xmax:n,ymin:s,ymax:o}=this.bounds,a=n-r,l=o-s;this.radius=Math.sqrt(a*a+l*l)/2}getRelativePosition(e,t){const{center:i,radius:r}=this;return[(e-i[0])/r,-(t-i[1])/r]}calculateRelativeSizeFromAbsolute(){const{_size:e}=this;return[r.pt2px(e)/this.radius,0]}}e.AGradientSizeHelper=n,e.getGradientSizeHelper=function(e,r){if(null==e)return null;const n=i.deg2rad(r.angle),s=r.gradientSize,c=r.gradientSizeUnits;switch(r.gradientMethod.toLowerCase()){case"linear":return new o(e,s,c,n);case"rectangular":return new a(e,s,c,n);case"circular":return new l(e,s,c);default:return t.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.fill.GradientSizeHelper").errorOnce(`Gradient fill method "${r.gradientMethod}" currently unsupported.`),null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter":function(){define(["exports","./OutlineFillMeshWriter","./PatternFillMeshWriter"],function(e,t,i){"use strict";const r={optionalAttributes:i.patternFillVertexSpec.optionalAttributes,createComputedParams:e=>e,attributes:{...i.patternFillVertexSpec.attributes,...t.outlineFillVertexSpec_Fill.attributes}},n={optionalAttributes:i.patternFillVertexSpec.optionalAttributes,createComputedParams:e=>e,attributes:{...i.patternFillVertexSpec.attributes,...t.outlineFillVertexSpec_Outline.attributes}};class s extends t.OutlineFillOutlineMeshWriter{constructor(){super(...arguments),this.vertexSpec=n}}class o extends t.OutlineFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=r}_createOutlineWriter(e,t,i,r){return new s(e,t,i,r)}write(e,t,i,r,n){this.ensurePacked(t,i,r);const s=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,s),this._write(e,i),e.recordEnd()}ensurePacked(e,t,i){super.ensurePacked(e,t,i),this._lineMeshWriter.ensurePacked(e,t,i)}enqueueRequest(e,t,i){super.enqueueRequest(e,t,i),this._lineMeshWriter.enqueueRequest(e,t,i)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}e.PatternOutlineFillMeshWriter=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter":function(){define(["exports","../mesh/MeshWriter","../../../../../../webgl/enums"],function(e,t,i){"use strict";const r={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:i.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:i.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:i.DataType.UNSIGNED_BYTE,count:1},offset:{type:i.DataType.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class n extends t.MeshWriter{constructor(){super(...arguments),this.vertexSpec=r}_write(e,t){e.recordStart(this.instanceId,this.attributeLayout);const i=t.getDisplayId();if("esriGeometryPoint"===t.geometryType){const r=t.readXForDisplay(),n=t.readYForDisplay();this._writeQuad(e,i,r,n)}else if("esriGeometryMultipoint"===t.geometryType){const r=t.readGeometryForDisplay();r?.forEachVertex((t,r)=>{t>=0&&t<=512&&r>=0&&r<=512&&this._writeQuad(e,i,t,r)})}e.recordEnd()}_writeQuad(e,t,i,r){const n=e.vertexCount();this._writeVertex(e,t,i,r),e.indexWrite(n+0),e.indexWrite(n+1),e.indexWrite(n+2),e.indexWrite(n+1),e.indexWrite(n+3),e.indexWrite(n+2)}}e.HeatmapMeshWriter=n,e.heatmapVertexSpec=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelMeshWriter":function(){define(["exports","../../../../../../../core/MapUtils","../../../../../../../core/screenUtils","../../../../../../../core/string","../../../../../../../core/libs/gl-matrix-2/math/mat2d","../../../../../../../core/libs/gl-matrix-2/factories/mat2df32","../../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../../core/libs/gl-matrix-2/factories/vec2f32","../../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../../../../geometry/GeometryCursor","../../../../../../../layers/graphics/featureConversionUtils","../../../../../../../layers/graphics/OptimizedGeometry","../../../definitions","../../../collisions/BoundingBox","../../../collisions/LabelMetric","../../../mesh/templates/segmentUtils","../fill/meshWriterUtils","../text/TextMeshWriter"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_){"use strict";function y(e,t){return r.numericHash(`${e}${t}`)}function x(e,t,i){return r.numericHash(`${e}${t}${i}`)}function b(e,t,i,n){const s=i*2**(_.maxLabelZoom-n);return r.numericHash(`${e}${t}${s}`)}function v(e,t,i,n,s){const o=i*2**(_.maxLabelZoom-n);return r.numericHash(`${e}${s}${t}${o}`)}const S=t.memoize(e=>{let t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t});class w extends _.TextMeshWriter{constructor(){super(...arguments),this._zoomLevel=0}_write(e,t,i,r){if(this._zoomLevel=r||0,null!=i)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(t.geometryType){case"esriGeometryPoint":{const i=t.readXForDisplay(),r=t.readYForDisplay();this._writePoint(e,i,r,0,t);break}case"esriGeometryEnvelope":case"esriGeometryPolygon":{const i=t.readCentroidForDisplay();if(!i)return;const[r,n]=i.coords;this._writePoint(e,r,n,0,t);break}case"esriGeometryMultipoint":{let i=0;const r=c.GeometryCursor.fromFeatureSetReader(t);if(r?.nextPath())for(;r.nextPoint();)this._writePoint(e,r.x,r.y,i++,t);break}case"esriGeometryPolyline":this._writeLines(e,t)}}_getMetricDir(){const{horizontalAlignment:e,verticalAlignment:t}=this.evaluatedMeshParams;return["center"===e?0:"right"===e?-1:1,"middle"===t?0:"bottom"===t?-1:1]}_createLineLabelMetric(e,t,i,r,n,s){const[o,a]=this._getMetricDir(),l=this.evaluatedMeshParams.scaleInfo?.maxScale??0,c=this.evaluatedMeshParams.scaleInfo?.minScale??0,u=this.evaluatedMeshParams.labelClassId;return new p.LabelMetric(e,u,t,i,r,n,o,a,l,c,s)}_writePoint(e,t,i,r,n){if(t<0||t>d.tileSize||i<0||i>d.tileSize)return;const s=this._getShaping();if(!s)return;const o=n.getDisplayId(),a=this.evaluatedMeshParams.labelClassId,l=y(n.getObjectId(),r),c=x(n.getObjectId(),a,r),[u,h]=this._getMetricDir(),f=this.evaluatedMeshParams.scaleInfo?.maxScale??0,m=this.evaluatedMeshParams.scaleInfo?.minScale??0,g=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};e.metricStart(new p.LabelMetric(o,a,l,c,t,i,u,h,f,m,g)),this._writeGlyphs(e,o,t,i,s,0,g,void 0,!1),e.metricBoxWrite(s.boundsT),e.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const e of this._references){const t=e.getBoundsInfo();if(t)return t}return null}_writeLines(e,t){const{scaleInfo:i,verticalAlignment:r}=this.evaluatedMeshParams,n=this.evaluatedMeshParams.repeatLabelDistance||128,s=this._getShaping("middle");if(!s)return;const o=(e,t,i,r)=>this._placeSubdivGlyphs(e,t,i,r),a=(s.bounds.width+n)/2;this._current={out:e,id:t.getDisplayId(),objId:t.getObjectId(),shaping:s,zoomRange:g.getMinMaxZoom(i,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null,pathIndex:0},this._verticalPlacement="bottom"===r?"above":"top"===r?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(t,o,a):this._writeCenterAlong(t,o,a)}_writeAboveAndBelowAlong(e,t,i){const{repeatLabel:r}=this.evaluatedMeshParams,{shaping:n}=this._current,s=n.bounds.halfHeight,o=e.readGeometryForDisplay();if(!o)return;const a=new h;u.generalizeOptimizedGeometry(a,o,!1,!1,"esriGeometryPolyline",1);const l=T(new h,a,s),c=T(new h,a,-s),d=u.convertToGeometry(c,"esriGeometryPolyline",!1,!1),f=u.convertToGeometry(l,"esriGeometryPolyline",!1,!1),p=m.smoothPaths(f.paths,n.bounds.width),g=m.smoothPaths(d.paths,n.bounds.width);this._current.offsetDirection="above";for(let e=0;e<p.length;e++)this._current.pathIndex=e,m.pathDivide(p[e],i,t,!!r);this._current.offsetDirection="below";for(let e=0;e<g.length;e++)this._current.pathIndex=e,m.pathDivide(g[e],i,t,!!r)}_writeCenterAlong(e,t,i){const{repeatLabel:r}=this.evaluatedMeshParams,{shaping:n}=this._current,s=m.smoothPaths(e.readLegacyGeometryForDisplay().paths,n.bounds.width);for(let e=0;e<s.length;e++)this._current.pathIndex=e,m.pathDivide(s[e],i,t,!!r)}_placeSubdivGlyphs(e,t,i,r){const{allowOverrun:n,labelPosition:s,repeatLabelDistance:o}=this.evaluatedMeshParams,a=this._current.zoomRange[0],l=S(t),c=this._current.shaping.bounds.width/2,u=Math.sqrt(o||128)/2,h=Math.min(i,r-i),d=this._current.shaping.isMultiline?_.maxLabelZoom:Math.log2(h/(u+c/2)),f=0===t?d:Math.min(l,d),p=Math.max(a,this._zoomLevel+1-f),m=this._zoomLevel-p,g=this._current.shaping.bounds.width/2*2**m,y=b(this._current.objId,this._current.pathIndex,t,this._zoomLevel),x=v(this._current.objId,this._current.pathIndex,t,this._zoomLevel,this.evaluatedMeshParams.labelClassId);this._current.shaping.isMultiline?0===t&&this._placeStraight(e,p,y,x):n&&m<0?this._placeStraightAlong(e,a,y,x):"parallel"===s?this._placeStraightAlong(e,p,y,x):"curved"===s&&this._placeCurved(e,p,g,y,x)}_placeStraight(e,t,i,r){const{out:n,id:s,shaping:o,referenceBounds:a}=this._current,{x:l,y:c}=e;n.metricStart(this._createLineLabelMetric(s,i,r,l,c)),n.metricBoxWrite(o.boundsT);const u=e.angle*(180/Math.PI)%360,h=(e.angle*(180/Math.PI)+180)%360,d={clipAngle:u,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(n,s,l,c,o,0,a,d,!1);const f={clipAngle:h,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(n,s,l,c,o,0,a,f,!1),n.metricEnd()}_placeCurved(e,t,i,r,n){const{out:s,id:o}=this._current;s.metricStart(this._createLineLabelMetric(o,r,n,e.x,e.y));const a=e.clone(),l=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(a,t,1,l),this._placeBack(e,a,t,i,1,l),this._placeForward(e,a,t,i,1,l)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(a,t,0,c),this._placeBack(e,a,t,i,0,c),this._placeForward(e,a,t,i,0,c)),s.metricEnd()}_placeStraightAlong(e,t,r,o){const{out:l,id:c,shaping:u,zoomRange:h,referenceBounds:d}=this._current,{boxBorderLineColor:f,boxBackgroundColor:p}=this.evaluatedMeshParams,m=e.clone(),g=e.angle*(180/Math.PI)%360,y=(e.angle*(180/Math.PI)+180)%360,x=u.glyphs.length>0&&!(!f&&!p);if(l.metricStart(this._createLineLabelMetric(c,r,o,e.x,e.y)),x){const r=Math.max(t,h[0],0),o=Math.min(_.maxLabelZoom,h[1]),f=n.fromRotation(s.create(),-e.angle),p={minZoom:r,maxZoom:o,clipAngle:g,mapAligned:!0,isLineLabel:!0},m=i.pt2px(this.evaluatedMeshParams.offsetX),x=i.pt2px(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const t=a.fromValues(m,-1*x),[i,r]=u.shapeBackground(n.translate(s.create(),f,t));l.recordStart(this.instanceId,this.attributeLayout,u.glyphs[0].textureBinding),this._writeTextBox(l,c,e.x,e.y,r,d,p),l.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const t=a.fromValues(m,x),[i,r]=u.shapeBackground(n.translate(s.create(),f,t));p.clipAngle=y,l.recordStart(this.instanceId,this.attributeLayout,u.glyphs[0].textureBinding),this._writeTextBox(l,c,e.x,e.y,r,d,p),l.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(m,t,1,g,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(m,t,0,y,!0),l.metricEnd()}_placeBack(e,t,i,r,n,s){const o=e.clone();let a=e.backwardLength+0;for(;o.prev()&&!(a>=r);)this._placeOnSegment(o,t,a,i,-1,n,s),a+=o.length+0}_placeForward(e,t,i,r,n,s){const o=e.clone();let a=e.remainingLength+0;for(;o.next()&&!(a>=r);)this._placeOnSegment(o,t,a,i,1,n,s),a+=o.length+0}_placeFirst(e,t,r,l,c=!1){const{out:u,id:h,shaping:d,zoomRange:p,referenceBounds:m}=this._current,g=d.glyphs,y=i.pt2px(this.evaluatedMeshParams.offsetX),x=i.pt2px(this.evaluatedMeshParams.offsetY),b=a.fromValues(y,x),v=n.fromRotation(s.create(),-e.angle);o.transformMat2d(b,b,v);for(const i of g){const n=i.x>d.bounds.x?r:1-r,s=n*e.remainingLength+(1-n)*e.backwardLength,o=Math.abs(i.x+i.width/2-d.bounds.x),a=Math.max(0,this._zoomLevel+Math.log2(o/(s+0))),g=Math.max(t,c?0:a);if(i.maxZoom=Math.min(p[1],_.maxLabelZoom),i.angle=e.angle+(1-r)*Math.PI,i.minZoom=Math.max(p[0],g),this._writeLineGlyph(u,h,e.x,e.y,i,l,m,!0),(r||this._current.offsetDirection)&&this._isVisible(i.minZoom,i.maxZoom)){const e=new f(i.bounds.x+b[0],i.bounds.y+b[1],i.bounds.width,i.bounds.height);u.metricBoxWrite(e)}}}_placeOnSegment(e,t,r,l,c,u,h){const{out:d,id:p,shaping:m,referenceBounds:g}=this._current,_=m.glyphs,y=e.dx/e.length,x=e.dy/e.length,b={x:e.x+r*-c*y,y:e.y+r*-c*x},v=i.pt2px(this.evaluatedMeshParams.offsetX),S=i.pt2px(this.evaluatedMeshParams.offsetY),w=a.fromValues(v,S),T=n.fromRotation(s.create(),-e.angle);o.transformMat2d(w,w,T);for(const t of _){const i=t.x>m.bounds.x?u:1-u;if(!(i&&1===c||!i&&-1===c))continue;const n=Math.abs(t.x+t.width/2-m.bounds.x),s=Math.max(0,this._zoomLevel+Math.log2(n/r)-.1),o=Math.max(l,this._zoomLevel+Math.log2(n/(r+e.length+0)));if(0!==s&&(t.angle=e.angle+(1-u)*Math.PI,t.minZoom=o,t.maxZoom=s,this._writeLineGlyph(d,p,b.x,b.y,t,h,g,!0),(u||this._current.offsetDirection)&&this._isVisible(t.minZoom,t.maxZoom))){const e=new f(t.bounds.x+w[0],t.bounds.y+w[1],t.bounds.width,t.bounds.height);d.metricBoxWrite(e)}}}_writeLineGlyph(e,t,i,r,n,s,o,a){if(i<0||i>d.tileSize||r<0||r>d.tileSize)return;e.recordStart(this.instanceId,this.attributeLayout,n.textureBinding);const{texcoords:l,offsets:c}=n,{fontSize:u,haloSize:h,outlineSize:f}=this._textMeshTransformProps;this._writeQuad(e,t,i,r,{texcoords:l,offsets:c,fontSize:u,haloSize:h,outlineSize:f,color:g.processColorInput(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:o,minZoom:Math.max(this._current.zoomRange[0],n.minZoom),maxZoom:Math.min(this._current.zoomRange[1],n.maxZoom),clipAngle:s,mapAligned:a,isLineLabel:!0}),e.recordEnd()}_packedZoom(e){return Math.floor(e*d.minMaxZoomPrecisionFactor)/d.minMaxZoomPrecisionFactor}_isVisible(e,t){let i=Math.max(this._current.zoomRange[0],e),r=Math.min(this._current.zoomRange[1],t);i=this._packedZoom(i),r=this._packedZoom(r);const n=this._packedZoom(this._zoomLevel);return i<=n&&n<=r}}function T(e,t,i){const{coords:r,lengths:n}=t,s=l.create(),a=l.create(),c=l.create(),u=l.create(),h=l.create(),d=l.create();let f=0;for(let t=0;t<n.length;t++){const l=n[t];for(let t=0;t<l;t++){const n=2*(t+f-1),p=2*(t+f),m=2*(t+f+1);t>0?o.set(s,r[n],r[n+1]):o.set(s,0,0),o.set(a,r[p],r[p+1]),t<l-1?o.set(c,r[m],r[m+1]):o.set(c,0,0),0===t?o.set(u,0,0):(o.sub(u,a,s),o.normalize(u,u),o.set(u,u[1],-u[0])),t===l-1?o.set(h,0,0):(o.sub(h,c,a),o.normalize(h,h),o.set(h,h[1],-h[0])),o.add(d,u,h),o.normalize(d,d);const g=d[0]*h[0]+d[1]*h[1];0!==g&&o.scale(d,d,g),o.scale(d,d,i),e.coords.push(a[0]+d[0],a[1]+d[1])}e.lengths.push(l),f+=l}return e}e.LabelMeshWriter=w,e.labelIdHash=y,e.labelMetricHash=x,e.lineLabelIdHash=b,e.lineLabelMetricHash=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports","../../definitions"],function(e,t){"use strict";function i(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function r(e,t){return Math.sqrt(e*e+t*t)}function n(e){const t=r(e[0],e[1]);e[0]/=t,e[1]/=t}function s(e,t){return r(e[0]-t[0],e[1]-t[1])}function o(e,t){return e[t+1]}function a(e){return e.length-1}function l(e){let t=0;for(let i=0;i<a(e);i++)t+=c(e,i);return t}function c(e,t,i=1){let[r,n]=o(e,t);return[r,n]=[Math.round(r),Math.round(n)],Math.sqrt(r*r+n*n)*i}class u{constructor(e,t,i,r,n){this._segments=e,this._index=t,this._distance=i,this._xStart=r,this._yStart=n,this._done=!1}static create(e){return new u(e,0,0,e[0][0],e[0][1])}clone(){return new u(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}leq(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}geq(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}get _segment(){return this._segments[this._index+1]}get angle(){const e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length);let i=Math.acos(t);return e>0&&(i=2*Math.PI-i),i}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:e,dy:t}=this;return Math.sqrt(e*e+t*t)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<a(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(e,t){const i=this.backwardLength;if(e<=i)return this._distance=(i-e)/this.length,this;let r=this.backwardLength;for(;this.prev();){if(r+this.length>e)return this._seekBackwards(e-r);r+=this.length}return this._distance=0,t?this:null}seek(e,t=!1){if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>e)return this.seek(e-i,t);i+=this.length}return this._distance=1,t?this:null}}function h(e,t,i,r,n){if(i<t)return;const s=r.clone().seek(i/2);if(null==s)return;e(s.clone(),i,n),i=(i-t)/2;const o=s.seek(t/2);h(e,t,i,r,n+1),h(e,t,i,o,n+1)}function d(e,t){const r=1e-6;if(t<=0)return;const o=e.length;if(o<3)return;const a=[];let l=0;a.push(0);for(let t=1;t<o;t++)l+=s(e[t],e[t-1]),a.push(l);t=Math.min(t,.2*l);const c=[];c.push(e[0][0]),c.push(e[0][1]);const u=e[o-1][0],h=e[o-1][1],d=i([0,0],e[0],e[1]);n(d),e[0][0]+=t*d[0],e[0][1]+=t*d[1],i(d,e[o-1],e[o-2]),n(d),e[o-1][0]+=t*d[0],e[o-1][1]+=t*d[1];for(let e=1;e<o;e++)a[e]+=t;a[o-1]+=t;const f=.5*t;for(let i=1;i<o-1;i++){let n=0,s=0,l=0;for(let o=i-1;o>=0&&!(a[o+1]<a[i]-f);o--){const c=f+a[o+1]-a[i],u=a[o+1]-a[o],h=a[i]-a[o]<f?1:c/u;if(Math.abs(h)<r)break;const d=h*h,p=h*c-.5*d*u,m=h*u/t,g=e[o+1],_=e[o][0]-g[0],y=e[o][1]-g[1];n+=m/p*(g[0]*h*c+.5*d*(c*_-u*g[0])-d*h*u*_/3),s+=m/p*(g[1]*h*c+.5*d*(c*y-u*g[1])-d*h*u*y/3),l+=m}for(let c=i+1;c<o&&!(a[c-1]>a[i]+f);c++){const o=f-a[c-1]+a[i],u=a[c]-a[c-1],h=a[c]-a[i]<f?1:o/u;if(Math.abs(h)<r)break;const d=h*h,p=h*o-.5*d*u,m=h*u/t,g=e[c-1],_=e[c][0]-g[0],y=e[c][1]-g[1];n+=m/p*(g[0]*h*o+.5*d*(o*_-u*g[0])-d*h*u*_/3),s+=m/p*(g[1]*h*o+.5*d*(o*y-u*g[1])-d*h*u*y/3),l+=m}c.push(n/l),c.push(s/l)}c.push(u),c.push(h);for(let t=0,i=0;t<o;t++)e[t][0]=c[i++],e[t][1]=c[i++]}e.SegmentCursor=u,e.pathDivide=function(e,i,r,n=!0){const s=l(e),o=u.create(e),a=s/2;if(!n)return o.seek(a),void(o.x<t.tileSize&&o.y<t.tileSize&&o.x>=0&&o.y>=0&&r(o.clone(),0,a+0*i,s));const c=Math.max((s-i)/2,0),h=Math.floor(c/i),d=a-h*i;o.seek(d);for(let e=-h;e<=h;e++)o.x<t.tileSize&&o.y<t.tileSize&&o.x>=0&&o.y>=0&&r(o.clone(),e,a+e*i,s),o.seek(i)},e.pathLength=l,e.pathSubdivide=function(e,t,i){h(i,t,l(e),u.create(e),0)},e.segmentAt=o,e.segmentCount=a,e.segmentLength=c,e.smoothPaths=function(e,t){const i=t;for(let t=0;t<e.length;t++){let r=e[t];d(r,i);const n=[];n.push(r[0]);for(let e=1;e<r.length;e++){const[t,i]=r[e-1],[s,o]=r[e],a=s-t,l=o-i;n.push([a,l])}e[t]=n,r=n}return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter":function(){define(["exports","../../../../../../../core/mathUtils","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper","../../../alignmentUtils","../../../definitions","../../../mesh/templates/shapingUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../shaders/constants","./TextParams","../../../../../../webgl/enums"],function(e,t,i,r,n,s,o,a,l,c,u,h,d){"use strict";const f=[4,4],p=[16,4],m={topLeft:p,topRight:p,bottomLeft:p,bottomRight:p},g=[4,2],_=[4,6],y={topLeft:g,topRight:g,bottomLeft:_,bottomRight:_},x={topLeft:g,topRight:_,bottomLeft:g,bottomRight:_},b={topLeft:_,topRight:_,bottomLeft:f,bottomRight:f},v={topLeft:f,topRight:f,bottomLeft:_,bottomRight:_},S={topLeft:_,topRight:f,bottomLeft:_,bottomRight:f},w={topLeft:f,topRight:_,bottomLeft:f,bottomRight:_},T={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:d.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:o.minMaxZoomPrecisionFactor,packTessellation:({minZoom:e,maxZoom:t})=>[e||0,t||28]},clipAngle:{type:d.DataType.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:e})=>P(e||0)},referenceSymbol:{type:d.DataType.BYTE,count:4,packPrecisionFactor:1,packTessellation:(e,t)=>{const r=e.isLineLabel||!e.referenceBounds,n=s.getXDirection(r?"center":t.horizontalAlignment),o=s.getYDirection(r?"middle":t.verticalAlignment),{offsetX:a,offsetY:l,size:c}=r?{offsetX:0,offsetY:0,size:0}:e.referenceBounds;return[i.pt2px(a),-i.pt2px(l),Math.round(i.pt2px(c)),n+1<<2|o+1]}},visibility:{type:d.DataType.FLOAT,count:1,otherSource:!0}},attributes:{pos:{type:d.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:d.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:e,mapAligned:t})=>l.packBitset([[u.bitsetTextIsBackground,e],[u.bitsetTextIsMapAligned,!!t]])},offset:{type:d.DataType.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:e})=>{const{bottomLeft:t,bottomRight:i,topLeft:r,topRight:n}=e;return[r,n,t,i]}}},textureUV:{type:d.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:e})=>{const{bottomLeft:t,bottomRight:i,topLeft:r,topRight:n}=e;return[r,n,t,i]}}},color:{type:d.DataType.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:e})=>e},fontAndReferenceSize:{type:d.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({fontSize:e},{referenceSize:t})=>[Math.round(i.pt2px(e)),Math.round(i.pt2px(t??e))]},outlineColor:{type:d.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>l.processColorInput(e)},haloColor:{type:d.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:e})=>l.processColorInput(e)},outlineAndHaloSize:{type:d.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:e,haloSize:t})=>[Math.round(i.pt2px(e)),Math.round(i.pt2px(t))]}}};class M extends c.MeshWriter{constructor(){super(...arguments),this.vertexSpec=T,this._textMeshParamsPropsInitialized=!1}ensurePacked(e,t,i){super.ensurePacked(e,t,i),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new h.TextMeshTransformProps(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(e,t,i){const r=this._getShaping();if(!r)return;const n=t.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(e,t,r,i);if(i?.nextPath())return i.nextPoint(),this._writeGlyphs(e,n,i.x,i.y,r,0);if("esriGeometryPolygon"===t.geometryType){const i=t.readCentroidForDisplay();if(!i)return;const[s,o]=i.coords;return this._writeGlyphs(e,n,s,o,r,0)}if("esriGeometryMultipoint"===t.geometryType){const i=t.readGeometryForDisplay();return void i?.forEachVertex((t,i)=>this._writeGlyphs(e,n,t,i,r,0))}const s=t.readXForDisplay(),o=t.readYForDisplay();return this._writeGlyphs(e,n,s,o,r,0)}_writePlacedTextMarkers(e,t,s,o){const a=o??r.GeometryCursor.fromFeatureSetReaderCIM(t);if(!a)return;const l=n.CIMMarkerPlacementHelper.getPlacement(a,-1,this.evaluatedMeshParams.placement,i.pt2px(1),e.id);if(!l)return;const c=t.getDisplayId();let u=l.next();for(;null!=u;){const t=u.tx,i=-u.ty,r=-u.getAngle();this._writeGlyphs(e,c,t,i,s,r),u=l.next()}}_getShaping(e){const r=this._textMeshTransformProps,n=this.evaluatedMeshParams;if(!n.glyphs?.glyphs.length)return null;const s=i.pt2px(r.fontSize),l=i.pt2px(r.offsetX),c=i.pt2px(r.offsetY),u=t.clamp(i.pt2px(n.lineWidth),o.minTextLineWidth,o.maxTextLineWidth),h=o.magicLabelLineHeight*t.clamp(n.lineHeightRatio,.25,4);return a.shapeGlyphs(n.glyphs,{scale:s/o.glyphSize,angle:r.postAngle,xOffset:l,yOffset:c,horizontalAlignment:n.horizontalAlignment,verticalAlignment:e||n.verticalAlignment,maxLineWidth:u,lineHeight:h,decoration:n.decoration,borderLineSizePx:i.pt2px(n.boxBorderLineSize),hasBackground:!!n.boxBackgroundColor,useCIMAngleBehavior:n.useCIMAngleBehavior})}_writeGlyphs(e,t,r,n,s,o,a,c,u=!0){const h=this.evaluatedMeshParams,d=this._textMeshTransformProps,f=i.pt2px(d.fontSize),p=d.haloSize,m=d.outlineSize,g=i.pt2px(d.offsetX),_=i.pt2px(d.offsetY),[y,x]=l.getMinMaxZoom(h.scaleInfo,this.getTileInfo());0!==o&&s.setRotation(o);const b=s.bounds,v=r+b.x+g,S=n+b.y-_,w=2*(h.minPixelBuffer?h.minPixelBuffer/f:1),T=Math.max(b.width,b.height)*w;s.textBox&&(e.recordStart(this.instanceId,this.attributeLayout,s.glyphs[0].textureBinding),u&&e.recordBounds(v,S,T,T),this._writeTextBox(e,t,r,n,s.textBox,a,c),e.recordEnd());for(const i of s.glyphs){e.recordStart(this.instanceId,this.attributeLayout,i.textureBinding),u&&e.recordBounds(v,S,T,T);const{texcoords:s,offsets:o}=i;this._writeQuad(e,t,r,n,{texcoords:s,offsets:o,fontSize:f,haloSize:p,outlineSize:m,color:l.processColorInput(h.color),isBackground:!1,referenceBounds:a,minZoom:y,maxZoom:x,...c}),e.recordEnd()}0!==o&&s.setRotation(-o)}_writeTextBox(e,t,i,r,n,s,o){const a=this.evaluatedMeshParams,{fontSize:c,haloSize:u,outlineSize:h}=this._textMeshTransformProps,{boxBackgroundColor:d,boxBorderLineColor:f}=a,p={isBackground:!0,fontSize:c,haloSize:u,outlineSize:h,referenceBounds:s,...o};d&&(this._writeQuad(e,t,i,r,{texcoords:m,offsets:n.main,color:l.processColorInput(d),...p}),f||(this._writeQuad(e,t,i,r,{texcoords:b,offsets:n.top,color:l.processColorInput(d),...p}),this._writeQuad(e,t,i,r,{texcoords:v,offsets:n.bot,color:l.processColorInput(d),...p}),this._writeQuad(e,t,i,r,{texcoords:S,offsets:n.left,color:l.processColorInput(d),...p}),this._writeQuad(e,t,i,r,{texcoords:w,offsets:n.right,color:l.processColorInput(d),...p}))),f&&(this._writeQuad(e,t,i,r,{texcoords:y,offsets:n.top,color:l.processColorInput(f),...p}),this._writeQuad(e,t,i,r,{texcoords:y,offsets:n.bot,color:l.processColorInput(f),...p}),this._writeQuad(e,t,i,r,{texcoords:x,offsets:n.left,color:l.processColorInput(f),...p}),this._writeQuad(e,t,i,r,{texcoords:x,offsets:n.right,color:l.processColorInput(f),...p}))}_writeQuad(e,t,i,r,n){const s=e.vertexCount();this._writeVertex(e,t,i,r,n),e.indexWrite(s+0),e.indexWrite(s+1),e.indexWrite(s+2),e.indexWrite(s+1),e.indexWrite(s+3),e.indexWrite(s+2)}}const P=e=>Math.round(e*(254/360));e.TextMeshWriter=M,e.TextVertexSpec=T,e.maxLabelZoom=28,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextParams":function(){define(["exports","../../../../../../../symbols/cim/utils"],function(e,t){"use strict";e.TextMeshTransformProps=class{constructor(e){const{offsetX:i,offsetY:r,postAngle:n,fontSize:s,haloSize:o,outlineSize:a,scaleFactor:l,transforms:c}=e;if(this.offsetX=i,this.offsetY=r,this.postAngle=n,this.fontSize=Math.min(s,96),this.haloSize=o??0,this.outlineSize=a??0,this.transforms=c,c&&c.infos.length>1){const e=t.applyParentTransform(s,n,!1,i,r,c,!1);this.fontSize=Math.min(e.size,96);const o=e.size/s;this.haloSize*=o,this.outlineSize*=o,this.postAngle=e.rotation,this.offsetX=e.offsetX,this.offsetY=e.offsetY}l&&(this.fontSize*=l,this.offsetX*=l,this.offsetY*=l)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/GradientStrokeMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../definitions","../fill/meshWriterUtils","./gradientStrokeConstants","./LineMeshWriter","../../../../../../webgl/enums"],function(e,t,i,r,n,s,o,a){"use strict";const l={createComputedParams:e=>e,optionalAttributes:o.LineVertexSpec.optionalAttributes,attributes:{...o.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({gradientMethod:e,gradientSizeUnits:t,gradientType:i})=>n.packBitset([[s.bitset.isAlongLine,"alongline"===e.toLowerCase()],[s.bitset.isAbsoluteSize,1===t],[s.bitset.isDiscrete,"discrete"===i.toLowerCase()]])},tlbr:{type:a.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{const{rect:t,width:i,height:n}=e,s=t.x+r.spritePadding+r.gradientTextureExternalPadding,o=t.y+r.spritePadding;return[s,o,s+i-2*r.gradientTextureExternalPadding,o+n]}},accumulatedDistance:{type:a.DataType.HALF_FLOAT,count:1,packTessellation:({distance:e,pathLength:t,distanceOffset:i})=>(i+e)/t},gradientSize:{type:a.DataType.HALF_FLOAT,count:1,pack:({gradientSize:e,gradientSizeUnits:i})=>0===i?e/100:t.pt2px(e)},totalLength:{type:a.DataType.HALF_FLOAT,count:1,packTessellation:({pathLength:e})=>e},segmentDirection:{type:a.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]}}};class c extends o.LineMeshWriter{get _preventEffectClipping(){return!0}constructor(e,t,i,r){super(e,t,i,r),this.vertexSpec=l,this._tessellationOptions.textured=!0}_write(e,t,r){const n=r??i.GeometryCursor.fromFeatureSetReaderCIM(t);if(!n)return;const{sprite:s}=this.evaluatedMeshParams;this._writeGeometry(e,t,n,s?.textureBinding)}}e.GradientStrokeMeshWriter=c,e.GradientStrokeVertexSpec=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../definitions","../fill/meshWriterUtils","./LineMeshWriter","../shaders/constants","../../../../../../webgl/enums"],function(e,t,i,r,n,s,o,a){"use strict";const l={createComputedParams:e=>e,optionalAttributes:s.LineVertexSpec.optionalAttributes,attributes:{...s.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:e,shouldScaleDash:t,isSDF:i})=>n.packBitset([[o.bitsetGenericConsiderAlphaOnly,e],[o.bitsetLineScaleDash,t],[o.bitsetLineIsSdf,i]])},tlbr:{type:a.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{const{rect:t,width:i,height:n}=e,s=t.x+r.spritePadding,o=t.y+r.spritePadding;return[s,o,s+i,o+n]}},accumulatedDistance:{type:a.DataType.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},segmentDirection:{type:a.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]},offsetAlongLine:{type:a.DataType.HALF_FLOAT,count:1,pack:({offsetAlongLine:e})=>t.pt2px(e)},capType:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({capType:e})=>{switch(e){case"Butt":case"butt":default:return 0;case"Square":case"square":return 1;case"Round":case"round":return 2}}}}};class c extends s.LineMeshWriter{constructor(e,t,i,r){super(e,t,i,r),this.vertexSpec=l,this._tessellationOptions.textured=!0}_write(e,t,r){const n=r??i.GeometryCursor.fromFeatureSetReaderCIM(t);if(!n)return;const{sprite:s}=this.evaluatedMeshParams;this._writeGeometry(e,t,n,s?.textureBinding)}}e.TexturedLineMeshWriter=c,e.texturedLineVertexSpec=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../core/libs/gl-matrix-2/math/mat2d","../../../../../../../core/libs/gl-matrix-2/factories/mat2df32","../../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/CIMEffects","../../../../../../../symbols/cim/constants","../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper","../../../definitions","../fill/meshWriterUtils","./ComputedMarkerParams","./markerConstants","../mesh/MeshWriter","../../../../../../webgl/enums"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p){"use strict";const m=128/Math.PI,g={createComputedParams:e=>h.ComputedMarkerParams.from(e),optionalAttributes:{zoomRange:{type:p.DataType.SHORT,count:2,packPrecisionFactor:c.minMaxZoomPrecisionFactor,pack:({scaleInfo:e},{tileInfo:t})=>u.getMinMaxZoom(e,t)}},attributes:{pos:{type:p.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:p.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:p.DataType.UNSIGNED_BYTE,count:1,pack:({sprite:e,alignment:t,scaleSymbolsProportionally:i,overrideOutlineColor:r,colorLocked:n})=>{let s=0;return e.sdf&&(s|=u.getBitMask(d.MarkerConstants.bitset.isSDF)),1===t&&(s|=u.getBitMask(d.MarkerConstants.bitset.isMapAligned)),i&&(s|=u.getBitMask(d.MarkerConstants.bitset.scaleSymbolsProportionally)),r&&(s|=u.getBitMask(d.MarkerConstants.bitset.overrideOutlineColor)),n&&(s|=u.getBitMask(d.MarkerConstants.bitset.colorLocked)),s}},offset:{type:p.DataType.HALF_FLOAT,count:2,packAlternating:{count:4,pack:({angle:e,computedWidth:t,computedHeight:s,anchorX:o,anchorY:a,offsetX:l,offsetY:c,rotateClockwise:u})=>{const h=function(e,t,n,s,o=!1){const a=r.create(),l=o?1:-1;return i.identity(a),(t||n)&&i.translate(a,a,[t,-n]),s&&i.rotate(a,a,.017453292519944444*l*-s),a}(0,l,c,-e,u),d=-(.5+o)*t,f=-(.5-a)*s,p=[d,f],m=[d+t,f],g=[d,f+s],_=[d+t,f+s];return n.transformMat2d(p,p,h),n.transformMat2d(m,m,h),n.transformMat2d(g,g,h),n.transformMat2d(_,_,h),[p,m,g,_]}}},textureUV:{type:p.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:e,texXmin:t,texYmax:i,texYmin:r})=>[[t,r],[e,r],[t,i],[e,i]]}},color:{type:p.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>u.processColorInput(e)},outlineColor:{type:p.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>u.processColorInput(e)},sizing:{type:p.DataType.UNSIGNED_BYTE,count:4,pack:({rawWidth:e,rawHeight:t,outlineSize:i,referenceSize:r})=>{const n=Math.max(e,t);return[u.packByteSqrt(n,128),u.packByteSqrt(i,128),u.packByteSqrt(r,128),0]}},placementAngle:{type:p.DataType.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:e})=>{return t=e*m,t%=256,Math.abs(t>=0?t:t+256);var t}},sdfDecodeCoeff:{type:p.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:e})=>e}}};class _ extends f.MeshWriter{constructor(){super(...arguments),this.vertexSpec=g}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(e,t,i){const r=this.evaluatedMeshParams.sprite?.textureBinding,n=t.getDisplayId();e.recordStart(this.instanceId,this.attributeLayout,r);const s=this.evaluatedMeshParams.minPixelBuffer,l=Math.max(this.evaluatedMeshParams.computedWidth,s),c=Math.max(this.evaluatedMeshParams.computedHeight,s),u=-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,h=this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight,d=this.evaluatedMeshParams.offsetX+u,f=-this.evaluatedMeshParams.offsetY+h;if(null!=this.evaluatedMeshParams.placement){let r=null;if(null!=i){const e=Math.max(this.evaluatedMeshParams.computedWidth,this.evaluatedMeshParams.computedHeight);if(r=o.clipCursorToTileExtent(i,2*e,!1),null===r)return}this._writePlacedMarkers(e,t,r,l,c)}else if(i?.nextPath()){i.nextPoint();const t=i.x,r=i.y;e.recordBounds(t+d,r+f,l,c),this._writeQuad(e,n,t,r)}else if("esriGeometryPolygon"===t.geometryType){const i=t.readCentroidForDisplay();if(!i)return;const[r,s]=i.coords;e.recordBounds(r+d,s+f,l,c),this._writeQuad(e,n,r,s)}else if("esriGeometryPoint"===t.geometryType){const i=t.readXForDisplay(),r=t.readYForDisplay();e.recordBounds(i+d,r+f,l,c),this._writeQuad(e,n,i,r)}else{const i=t.readGeometryForDisplay();i?.forEachVertex((t,i)=>{e.recordBounds(t+d,i+f,l,c),Math.abs(t)>a.maxTileCoordValue||Math.abs(i)>a.maxTileCoordValue||this._writeQuad(e,n,t,i)})}e.recordEnd()}_writePlacedMarkers(e,i,r,n,o){const c=r??s.GeometryCursor.fromFeatureSetReaderCIM(i);if(!c)return;const u=l.CIMMarkerPlacementHelper.getPlacement(c,-1,this.evaluatedMeshParams.placement,t.pt2px(1),e.id);if(!u)return;const h=i.getDisplayId();let d=u.next();const f=this.evaluatedMeshParams.offsetX,p=-this.evaluatedMeshParams.offsetY;for(;null!=d;){const t=d.tx,i=-d.ty;if(Math.abs(t)>a.maxTileCoordValue||Math.abs(i)>a.maxTileCoordValue){d=u.next();continue}const r=-d.getAngle();e.recordBounds(t+f,i+p,n,o),this._writeQuad(e,h,t,i,r),d=u.next()}}_writeQuad(e,t,i,r,n){const s=e.vertexCount(),o=null==n?null:{placementAngle:n};this._writeVertex(e,t,i,r,o),e.indexWrite(s+0),e.indexWrite(s+1),e.indexWrite(s+2),e.indexWrite(s+1),e.indexWrite(s+3),e.indexWrite(s+2)}}e.MarkerMeshWriter=_,e.MarkerVertexSpec=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/ComputedMarkerParams":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../symbols/cim/utils","../../../definitions"],function(e,t,i,r){"use strict";class n{static from(e){return"width"in e?this.fromSimpleMeshParams(e):this.fromComplexMeshParams(e)}static fromSimpleMeshParams(e){const i=new n(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects),{type:r,width:s,height:o,angle:a,alignment:l,outlineSize:c,referenceSize:u,sprite:h,overrideOutlineColor:d}=e;return i.rawWidth=t.pt2px(s),i.rawHeight=t.pt2px(o),i.angle=a,i.alignment=l,i.outlineSize=t.pt2px(c),i.referenceSize=t.pt2px(u),i.overrideOutlineColor=d,i.offsetX=t.pt2px(e.offsetX),i.offsetY=t.pt2px(e.offsetY),"simple"!==r||h.sdf||(i.rawWidth=h.width,i.rawHeight=h.height),i._computeSize(e,!1),i}static fromComplexMeshParams(e){const r=new n(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects);let{alignment:s,transforms:o,size:a,scaleX:l,anchorX:c,anchorY:u,angle:h,colorLocked:d,frameHeight:f,widthRatio:p,offsetX:m,offsetY:g,outlineSize:_,referenceSize:y,scaleFactor:x,sizeRatio:b,isAbsoluteAnchorPoint:v,rotateClockwise:S,scaleSymbolsProportionally:w,sprite:T}=e;if(o&&o.infos.length>0){const e=i.applyParentTransform(a,h,S,m,g,o);a=e.size,h=e.rotation,m=e.offsetX,g=e.offsetY,S=!1}x&&(a*=x,m*=x,g*=x);const M=l*(T.width/T.height);r.alignment=s,r.rawHeight=t.pt2px(a),r.rawWidth=r.rawHeight*M,r.referenceSize=t.pt2px(y),r.sizeRatio=b,r.sdfDecodeCoeff=(T.sdfDecodeCoeff??1)*b,r.angle=h,r.rotateClockwise=S,r.anchorX=c,r.anchorY=u,r.offsetX=t.pt2px(m),r.offsetY=t.pt2px(g),v&&a&&(T.sdf?r.anchorX=c/(a*p):r.anchorX=c/(a*M),r.anchorY=u/a);const P=w&&f?a/f:1;return r.outlineSize=0===_||isNaN(_)?0:t.pt2px(_)*P,r.scaleSymbolsProportionally=w,r.colorLocked=d,r._computeSize(e,!0),r}constructor(e,t,i,r,n,s,o){this.sprite=e,this.color=t,this.outlineColor=i,this.minPixelBuffer=r,this.placement=n,this.scaleInfo=s,this.effects=o,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.sdfDecodeCoeff=1,this.alignment=0,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(e,t){const{sprite:i,hasSizeVV:n}=e,a=!!i.sdf,l=i.sdfPaddingRatio??.5,{rawWidth:c,rawHeight:u,sizeRatio:h,outlineSize:d}=this,f=i.rect;let p=c*h,m=u*h,g=0,_=0;if(a){const e=1/(1-l);if(p*=e,m*=e,n)this.computedWidth=p,this.computedHeight=m;else{const e=t&&c>u?p:c,r=u,n=d+2;this.computedWidth=Math.min(e+n,p),this.computedHeight=Math.min(r+n,m);const s=Math.max(i.width,i.height)/Math.max(p,m);g=(this.computedWidth-p)*s,_=(this.computedHeight-m)*s}}else this.computedWidth=p*(f.width/i.width),this.computedHeight=m*(f.height/i.height),g=2*r.spritePadding,_=2*r.spritePadding;const y=f.x+r.spritePadding-g/2,x=f.y+r.spritePadding-_/2,b=y+i.width+g,v=x+i.height+_;this.texXmin=s(y),this.texYmin=s(x),this.texXmax=o(b),this.texYmax=o(v),this.computedWidth*=(this.texXmax-this.texXmin)/(b-y),this.computedHeight*=(this.texYmax-this.texYmin)/(v-x),this.anchorX*=p/this.computedWidth,this.anchorY*=m/this.computedHeight}}function s(e,t=1e-7){const i=Math.ceil(e);return i-e<t?i:Math.floor(e)}function o(e,t=1e-7){const i=Math.floor(e);return e-i<t?i:Math.ceil(e)}e.ComputedMarkerParams=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterInputEvaluator":function(){define(["exports","../../../../../../../core/arrayUtils","../../../../../../../core/Error","../../../../../../../core/lang","../../../../../../../core/Logger","../../../../../../../support/ArcadeExpression","../../../grouping","../../../animations/infos","../../../animations/utils","./utils","../../../../../layers/features/support/DictionaryValue"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";const h=()=>n.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator");async function d(e,t,i,r){const{defaultValue:n,valueExpressionInfo:s,value:o}=t;if(s){if("dictionary-template"===s.type)return{...t,computed:e.createDictionaryTemplateField(s,i),defaultValue:n};const{expression:o}=s,a=await e.createComputedField({expression:o},r);return a?{...t,computed:a,defaultValue:n}:null}return{...t,computed:new u.DictionaryValue(o),defaultValue:n}}async function f(e,t,i){const{valueExpressionInfo:r}=t,n="dictionary-template"===r.type?e.createDictionaryTemplateField(r,i):await e.createComputedField({expression:r.expression});return n?{...t,computed:n}:null}function p(e){return"object"==typeof e&&null!=e&&(!(!("valueExpressionInfo"in e)||!e.valueExpressionInfo)||"type"in e&&"Process"===e.type&&"op"in e&&"Random"===e.op)}function m(e){if(Array.isArray(e))for(const t of e)if(m(t))return!0;if("object"==typeof e){if(p(e))return!0;for(const t in e)if(m(e[t]))return!0}return!1}class g{static async create(e,i,r,n){const s={},o=new Map,a=new Map,c=new Map,u=new Map,h=new Map,_=new Map;for(const g in r){const y=r[g];if(null!=y&&"object"==typeof y)if(Array.isArray(y)){if("object"==typeof y[0])throw new Error(`InternalError: Cannot handle ${g}. Nested array params are not supported`);s[g]=y}else{if("valueExpressionInfo"in y){if(y.value){s[g]=y.value;continue}const t=await f(e,y,n);if(!t){s[g]=y.defaultValue;continue}o.set(g,t),s[g]=null;continue}switch(y.type){case"cim-effect-infos":if(y.effectInfos.some(e=>e.overrides.length)){a.set(g,{effects:await Promise.all(y.effectInfos.map(async i=>{const r=i.overrides.map(t=>d(e,t,n,!1));return{effect:i.effect,compiledOverrides:(await Promise.all(r)).filter(t.isSome)}}))});break}s[g]=y.effectInfos.map(e=>e.effect);break;case"cim-marker-placement-param":y.overrides.length&&c.set(g,{placementInfo:y,compiledOverrides:(await Promise.all(y.overrides.map(t=>d(e,t,n,!1)))).filter(t.isSome)}),s[g]=y.placement;break;case"text-rasterization-param":{if(y.overrides.length){const i=y.overrides.map(t=>d(e,t,n,y.useLegacyLabelEvaluationRules??!1));u.set(g,{compiledOverrides:(await Promise.all(i)).filter(t.isSome),rasterizationParam:y,objectIdToResourceId:new Map});continue}const r={type:"cim-rasterization-info",resource:y.resource};s[g]=await i.fetchResourceImmediate(r)??null;break}case"sprite-rasterization-param":{if(y.overrides.length){const i=y.overrides.map(t=>d(e,t,n,!1));u.set(g,{compiledOverrides:(await Promise.all(i)).filter(t.isSome),rasterizationParam:y,objectIdToResourceId:new Map});continue}if("animated"===y.resource.type){u.set(g,{compiledOverrides:[],rasterizationParam:y,objectIdToResourceId:new Map});continue}const r={type:"cim-rasterization-info",resource:y.resource};s[g]=await i.fetchResourceImmediate(r)??null;break}case"cim-marker-transform-param":{const{params:t}=y;if(m(t)){const i={compiledMarkerInfos:[]};await Promise.all(t.map(async t=>{const r={props:{}};for(const i in t)if(p(t[i])){const s=await f(e,t[i],n);r.compiledExpressionMap||(r.compiledExpressionMap=new Map);const o=r.compiledExpressionMap;s&&o.set(i,s)}else r.props[i]=t[i];i.compiledMarkerInfos.push(r)})),h.set(g,i)}else s[g]={type:"cim-marker-transform-info",infos:t};break}case"animation-params":{const{params:t}=y,r=l.createParamList(t);if(m(r)){const t=await Promise.all(r.map(t=>l.compileAnimationParam(t,e)));_.set(g,{params:t,propertyIdToResourceId:new Map,key:g})}else{const e=l.fromJSON(r),t=await i.fetchResourceImmediate({type:"animation-info",resource:e});null!=t&&"sprite"===t.type&&(s[g]={dataRow:t.rect.y,dataColumn:t.rect.x})}break}default:s[g]=y}}else s[g]=y}return new g(r,s,o,a,c,u,h,_)}constructor(e,t,i,r,n,o,a,l){this.inputMeshParams=e,this._resolvedMeshParams=t,this._dynamicProperties=i,this._dynamicEffectProperties=r,this._dynamicPlacementProperties=n,this._dynamicAsyncProperties=o,this._dynamicTransformProperties=a,this._dynamicAsyncAnimations=l,this.evaluator=e=>e,this._arcadeDependencies=new Set;for(const e of this._expressions())s.collectExpressionDependencies(this._arcadeDependencies,e)}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(e,t,n){for(const s of this._dynamicAsyncProperties.values()){const a=r.clone(s.rasterizationParam.resource);"animated"===s.rasterizationParam.resource.type&&s.rasterizationParam.resource.randomizeStartTime&&(a.primitiveName="__RESERVED__PRIMITIVE__NAME__",a.startGroup=o.getStartGroup(t.getObjectId()||0));for(const{primitiveName:e,propertyName:r,computed:o,defaultValue:l,valueExpressionInfo:u}of s.compiledOverrides)try{const i="animated"===s.rasterizationParam.resource.type?a.primitiveName:e;c.applyComputedValue(a,i,r,o,t,n,l)}catch(e){h().errorOnce(new i("invalid-arcade-expression","Encountered an error when evaluating the arcade expression",{error:e,valueExpressionInfo:u}))}const l=e.enqueueRequest({type:"cim-rasterization-info",resource:a});s.objectIdToResourceId.set(t.getObjectId(),l)}for(const i of this._dynamicAsyncAnimations.values()){const r=i.params.map(e=>l.resolveToAnimationInfo(e,t,n)).map(a.hydrate).map(e=>e.simplify()),s=l.encodeParamList(r),o=e.enqueueRequest({type:"animation-info",resource:s});i.propertyIdToResourceId.set(t.getObjectId()+"."+i.key,o)}}evaluateMeshParams(e,t,i){for(const[e,r]of this._dynamicProperties.entries())this._resolvedMeshParams[e]=r.computed.readWithDefault(t,i,r.defaultValue);for(const[e,r]of this._dynamicPlacementProperties.entries())for(const{computed:n,defaultValue:s,propertyName:o}of r.compiledOverrides){const a=n.readWithDefault(t,i,s);r.placementInfo.placement[o]=a,this._resolvedMeshParams[e]=r.placementInfo.placement}for(const[e,r]of this._dynamicEffectProperties.entries())for(const n of r.effects){for(const{computed:e,defaultValue:r,propertyName:s}of n.compiledOverrides){const o=e.readWithDefault(t,i,r);n.effect[s]=o}this._resolvedMeshParams[e]=r.effects.map(e=>e.effect)}for(const[e,r]of this._dynamicTransformProperties.entries()){const n={type:"cim-marker-transform-info",infos:[]};for(const e of r.compiledMarkerInfos){const r={...e.props};if(e.compiledExpressionMap)for(const[n,s]of e.compiledExpressionMap){const e=s.computed.readWithDefault(t,i,s.defaultValue);r[n]="number"==typeof e||"boolean"==typeof e?e:s.defaultValue}n.infos.push(r)}this._resolvedMeshParams[e]=n}for(const[i,r]of this._dynamicAsyncProperties.entries()){const n=r.objectIdToResourceId.get(t.getObjectId());if(null==n)continue;const s=e.getResource(n);this._resolvedMeshParams[i]=s}for(const[i,r]of this._dynamicAsyncAnimations.entries()){const n=r.propertyIdToResourceId.get(t.getObjectId()+"."+i);if(null==n)continue;const s=e.getResource(n);this._resolvedMeshParams[i]={dataRow:s.rect.y,dataColumn:s.rect.x}}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}*_expressions(){for(const e of this._dynamicProperties.values())yield e.computed;for(const e of this._dynamicEffectProperties.values())for(const t of e.effects)for(const e of t.compiledOverrides)yield e.computed;for(const e of this._dynamicPlacementProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicAsyncProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicTransformProperties.values())for(const t of e.compiledMarkerInfos)if(null!=t.compiledExpressionMap)for(const e of t.compiledExpressionMap.values())yield e.computed;for(const e of this._dynamicAsyncAnimations.values())for(const t of e.params)yield*l.getAnimationExpressions(t)}}e.MeshWriterInputEvaluator=g,e.hasExpression=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DictionaryValue":function(){define(["exports","./AComputedField"],function(e,t){"use strict";class i extends t.AComputedField{constructor(e){super(),this._value=e}resize(e){}read(e,t){return this._value}readWithDefault(e,t,i){return this._value}hasArcadeDependency(e){return!1}}e.DictionaryValue=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AComputedField":function(){define(["exports"],function(e){"use strict";e.AComputedField=class{destroy(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../../../../../../webgl/enums"],function(e,t,i,r,n){"use strict";const s={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:n.DataType.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:n.DataType.UNSIGNED_BYTE,count:1,pack:e=>0},offset:{type:n.DataType.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:e})=>{const i=t.pt2px(e),r=-i/2,n=-i/2;return[[r,n],[r+i,n],[r,n+i],[r+i,n+i]]}}},texCoords:{type:n.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:n.DataType.UNSIGNED_BYTE,count:2,pack:({size:e})=>[e,e]},referenceSize:{type:n.DataType.UNSIGNED_BYTE,count:1,pack:({size:e})=>t.pt2px(e)},zoomRange:{type:n.DataType.UNSIGNED_BYTE,count:2,pack:({scaleInfo:e},{tileInfo:t})=>i.getMinMaxZoom(e,t)}}};class o extends r.MeshWriter{constructor(){super(...arguments),this.vertexSpec=s}_write(e,i){const r=i.getDisplayId(),n=this.evaluatedMeshParams.minPixelBuffer,s=Math.max(t.pt2px(this.evaluatedMeshParams.size),n);let o,a;if("esriGeometryPoint"===i.geometryType)o=i.readXForDisplay(),a=i.readYForDisplay();else{const e=i.readCentroidForDisplay();if(!e)return;o=e?.coords[0],a=e?.coords[1]}e.recordStart(this.instanceId,this.attributeLayout),e.recordBounds(o,a,s,s);const l=e.vertexCount();this._writeVertex(e,r,o,a),e.indexWrite(l+0),e.indexWrite(l+1),e.indexWrite(l+2),e.indexWrite(l+1),e.indexWrite(l+3),e.indexWrite(l+2),e.recordEnd()}}e.PieChartMeshWriter=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define(["exports","../../core/has","../../core/maybe","../../core/promiseUtils","../../core/time","./checkWebGLError","./ContextState","./enums","./InstanceCounter","./Parameters","./ProgramCache","./renderState","./Texture","./WebGLDriverTest","./capabilities/Capabilities"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p){"use strict";function m(e,t,i,r){return t?r!==t&&e.bindBuffer(i,t.glName):e.bindBuffer(i,null),t}function g(e,t){switch(e){case a.PrimitiveType.POINTS:return 2*t;case a.PrimitiveType.TRIANGLES:return t/3;case a.PrimitiveType.TRIANGLE_STRIP:case a.PrimitiveType.TRIANGLE_FAN:return t-2;default:return 0}}e.RenderingContext=class{constructor(e,t){this.gl=e,this.instanceCounter=new l.InstanceCounter,this._programCache=new u.ProgramCache(this),this._transformFeedbackRequestInfo=null,this._state=new o.ContextState,this._numOfDrawCalls=0,this._numOfTriangles=0,this._options=t,this.configure(t)}configure(e){this._options=e,this._capabilities=new p.Capabilities(this.gl,e),this._parameters=new c.Parameters(this.gl,this._capabilities,e),d.Texture.TEXTURE_UNIT_FOR_UPDATES=this._parameters.maxTextureImageUnits-1;const t=this.gl.getParameter(this.gl.VIEWPORT);this._state=new o.ContextState,this._state.viewport={x:t[0],y:t[1],width:t[2],height:t[3]},this._stateTracker=new h.StateTracker({setBlending:e=>{if(e){this.setBlendingEnabled(!0),this.setBlendEquationSeparate(e.opRgb,e.opAlpha),this.setBlendFunctionSeparate(e.srcRgb,e.dstRgb,e.srcAlpha,e.dstAlpha);const t=e.color;this.setBlendColor(t.r,t.g,t.b,t.a)}else this.setBlendingEnabled(!1)},setCulling:e=>{e?(this.setFaceCullingEnabled(!0),this.setCullFace(e.face),this.setFrontFace(e.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:e=>{e?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(e.factor,e.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:e=>{e?(this.setDepthTestEnabled(!0),this.setDepthFunction(e.func)):this.setDepthTestEnabled(!1)},setStencilTest:e=>{if(e){this.setStencilTestEnabled(!0);const t=e.function;this.setStencilFunction(t.func,t.ref,t.mask);const i=e.operation;this.setStencilOp(i.fail,i.zFail,i.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:e=>{e?(this.setDepthWriteEnabled(!0),this.setDepthRange(e.zNear,e.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:e=>{e?this.setColorMask(e.r,e.g,e.b,e.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:e=>{e?this.setStencilWriteMask(e.mask):this.setStencilWriteMask(0)},setDrawBuffers:e=>{if(e)this.setDrawBuffers(e.buffers);else{const{drawFramebuffer:e}=this._state;null===e?this.setDrawBuffers([1029]):0===e.colorAttachments.length?this.setDrawBuffers([0]):this.setDrawBuffers([a.ColorAttachment0])}}}),this.enforceState(),i.disposeMaybe(this._driverTest),this._driverTest=new f.WebGLDriverTest(this)}updateOptions(e){this._options={...this._options,...e},this._parameters=new c.Parameters(this.gl,this._capabilities,this._options)}dispose(){this._driverTest=i.disposeMaybe(this._driverTest),this._programCache=i.disposeMaybe(this._programCache),this.bindVAO(null),this.unbindBuffer(34962),this.unbindBuffer(34963),this.unbindBuffer(35345),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(35051),this.unbindBuffer(35052),this.unbindBuffer(36662),this.unbindBuffer(36663),this._state.textureUnitMap.length=0,this._state=null,this._capabilities=null,this._stateTracker=null,s.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)}get driverTest(){return this._driverTest}get contextAttributes(){return this.gl.getContextAttributes()}get parameters(){return this._parameters}get programCache(){return this._programCache}setPipelineState(e){this._stateTracker.setPipeline(e)}setBlendingEnabled(e){this._state.blend!==e&&(!0===e?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=e,this._stateTracker.invalidateBlending())}externalProgramUpdate(){this._state.program?.stop(),this._state.program=null}externalTextureUnitUpdate(e,t){for(let t=0;t<e.length;++t)this._state.textureUnitMap[e[t]]=null;t>=0&&(this._state.activeTexture=t)}externalVertexArrayObjectUpdate(){this.gl.bindVertexArray(null),this._state.vertexArrayObject=null,this._state.vertexBuffer=null,this._state.indexBuffer=null}externalVertexBufferUpdate(){this._state.vertexBuffer=null}externalIndexBufferUpdate(){this._state.indexBuffer=null}setBlendColor(e,t,i,r){e===this._state.blendColor.r&&t===this._state.blendColor.g&&i===this._state.blendColor.b&&r===this._state.blendColor.a||(this.gl.blendColor(e,t,i,r),this._state.blendColor.r=e,this._state.blendColor.g=t,this._state.blendColor.b=i,this._state.blendColor.a=r,this._stateTracker.invalidateBlending())}setBlendFunction(e,t){e===this._state.blendFunction.srcRGB&&t===this._state.blendFunction.dstRGB||(this.gl.blendFunc(e,t),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=e,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=t,this._stateTracker.invalidateBlending())}setBlendFunctionSeparate(e,t,i,r){this._state.blendFunction.srcRGB===e&&this._state.blendFunction.srcAlpha===i&&this._state.blendFunction.dstRGB===t&&this._state.blendFunction.dstAlpha===r||(this.gl.blendFuncSeparate(e,t,i,r),this._state.blendFunction.srcRGB=e,this._state.blendFunction.srcAlpha=i,this._state.blendFunction.dstRGB=t,this._state.blendFunction.dstAlpha=r,this._stateTracker.invalidateBlending())}setBlendEquation(e){this._state.blendEquation.mode!==e&&(this.gl.blendEquation(e),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=e,this._stateTracker.invalidateBlending())}setBlendEquationSeparate(e,t){this._state.blendEquation.mode===e&&this._state.blendEquation.modeAlpha===t||(this.gl.blendEquationSeparate(e,t),this._state.blendEquation.mode=e,this._state.blendEquation.modeAlpha=t,this._stateTracker.invalidateBlending())}setColorMask(e,t,i,r){this._state.colorMask.r===e&&this._state.colorMask.g===t&&this._state.colorMask.b===i&&this._state.colorMask.a===r||(this.gl.colorMask(e,t,i,r),this._state.colorMask.r=e,this._state.colorMask.g=t,this._state.colorMask.b=i,this._state.colorMask.a=r,this._stateTracker.invalidateColorWrite())}setClearColor(e,t,i,r){this._state.clearColor.r===e&&this._state.clearColor.g===t&&this._state.clearColor.b===i&&this._state.clearColor.a===r||(this.gl.clearColor(e,t,i,r),this._state.clearColor.r=e,this._state.clearColor.g=t,this._state.clearColor.b=i,this._state.clearColor.a=r)}setFaceCullingEnabled(e){this._state.faceCulling!==e&&(!0===e?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=e,this._stateTracker.invalidateCulling())}setPolygonOffsetFillEnabled(e){this._state.polygonOffsetFill!==e&&(!0===e?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=e,this._stateTracker.invalidatePolygonOffset())}setPolygonOffset(e,t){this._state.polygonOffset[0]===e&&this._state.polygonOffset[1]===t||(this._state.polygonOffset[0]=e,this._state.polygonOffset[1]=t,this.gl.polygonOffset(e,t),this._stateTracker.invalidatePolygonOffset())}setCullFace(e){this._state.cullFace!==e&&(this.gl.cullFace(e),this._state.cullFace=e,this._stateTracker.invalidateCulling())}setFrontFace(e){this._state.frontFace!==e&&(this.gl.frontFace(e),this._state.frontFace=e,this._stateTracker.invalidateCulling())}setScissorTestEnabled(e){this._state.scissorTest!==e&&(!0===e?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=e)}setScissorRect(e,t,i,r){this._state.scissorRect.x===e&&this._state.scissorRect.y===t&&this._state.scissorRect.width===i&&this._state.scissorRect.height===r||(this.gl.scissor(e,t,i,r),this._state.scissorRect.x=e,this._state.scissorRect.y=t,this._state.scissorRect.width=i,this._state.scissorRect.height=r)}setDepthTestEnabled(e){this._state.depthTest!==e&&(!0===e?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=e,this._stateTracker.invalidateDepthTest())}setClearDepth(e){this._state.clearDepth!==e&&(this.gl.clearDepth(e),this._state.clearDepth=e)}setDepthFunction(e){this._state.depthFunction!==e&&(this.gl.depthFunc(e),this._state.depthFunction=e,this._stateTracker.invalidateDepthTest())}setDepthWriteEnabled(e){this._state.depthWrite!==e&&(this.gl.depthMask(e),this._state.depthWrite=e,this._stateTracker.invalidateDepthWrite())}setDepthRange(e,t){this._state.depthRange.zNear===e&&this._state.depthRange.zFar===t||(this.gl.depthRange(e,t),this._state.depthRange.zNear=e,this._state.depthRange.zFar=t,this._stateTracker.invalidateDepthWrite())}setStencilTestEnabled(e){this._state.stencilTest!==e&&(!0===e?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=e,this._stateTracker.invalidateStencilTest())}setClearStencil(e){e!==this._state.clearStencil&&(this.gl.clearStencil(e),this._state.clearStencil=e)}setStencilFunction(e,t,i){this._state.stencilFunction.func===e&&this._state.stencilFunction.ref===t&&this._state.stencilFunction.mask===i||(this.gl.stencilFunc(e,t,i),this._state.stencilFunction.face=1032,this._state.stencilFunction.func=e,this._state.stencilFunction.ref=t,this._state.stencilFunction.mask=i,this._stateTracker.invalidateStencilTest())}setStencilFunctionSeparate(e,t,i,r){this._state.stencilFunction.face===e&&this._state.stencilFunction.func===t&&this._state.stencilFunction.ref===i&&this._state.stencilFunction.mask===r||(this.gl.stencilFuncSeparate(e,t,i,r),this._state.stencilFunction.face=e,this._state.stencilFunction.func=t,this._state.stencilFunction.ref=i,this._state.stencilFunction.mask=r,this._stateTracker.invalidateStencilTest())}setStencilWriteMask(e){this._state.stencilWriteMask!==e&&(this.gl.stencilMask(e),this._state.stencilWriteMask=e,this._stateTracker.invalidateStencilWrite())}setStencilOp(e,t,i){1032===this._state.stencilOperation.face&&this._state.stencilOperation.fail===e&&this._state.stencilOperation.zFail===t&&this._state.stencilOperation.zPass===i||(this.gl.stencilOp(e,t,i),this._state.stencilOperation.face=1032,this._state.stencilOperation.fail=e,this._state.stencilOperation.zFail=t,this._state.stencilOperation.zPass=i,this._stateTracker.invalidateStencilTest())}setStencilOpSeparate(e,t,i,r){this._state.stencilOperation.face===e&&this._state.stencilOperation.fail===t&&this._state.stencilOperation.zFail===i&&this._state.stencilOperation.zPass===r||(this.gl.stencilOpSeparate(e,t,i,r),this._state.stencilOperation.face=e,this._state.stencilOperation.fail=t,this._state.stencilOperation.zFail=i,this._state.stencilOperation.zPass=r,this._stateTracker.invalidateStencilTest())}setActiveTexture(e,t=!1){const i=this._state.activeTexture;return e>=0&&(t||e!==this._state.activeTexture)&&(this.gl.activeTexture(a.baseTextureUnit+e),this._state.activeTexture=e),i}setDrawBuffers(e){const{drawFramebuffer:t}=this._state,i=null===t,r=i?this._state.drawBuffers.defaultFramebuffer:this._state.drawBuffers.fbos.get(t);if(r?.length!==e.length||!r.every((t,i)=>t===e[i]))if(e.length>this.parameters.maxDrawBuffers)console.error("Setting more active draw buffers than GL.MAX_DRAW_BUFFERS allows.");else{if(i){if(e.length>1)return void console.error("The default framebuffer can only have one active draw buffer.");if(1029!==e[0]&&0!==e[0])return void console.error("The default framebuffer can only use the constants GL.BACK or GL.NONE as draw buffers.")}i||!e.includes(1029)?(this.gl.drawBuffers(e),i?this._state.drawBuffers.defaultFramebuffer=e:this._state.drawBuffers.fbos.set(t,e),this._stateTracker.invalidateDrawBuffers()):console.error("A framebuffer object can only use the constants GL.COLOR_ATTACHMENTi or GL.NONE as draw buffers.")}}clear(e,t=255){if(e){if(16384&e){const e=this._state.drawFramebuffer?.colorAttachments;e&&this.setDrawBuffers(e),this.setColorMask(!0,!0,!0,!0)}256&e&&this.setDepthWriteEnabled(!0),1024&e&&this.setStencilWriteMask(t),this.gl.clear(e)}}clearFramebuffer(e,t=!1,i=!1){let r=0;if(e){const t=1e-13,i=Math.max(t,e[3]);this.setClearColor(e[0],e[1],e[2],i),r|=16384}t&&(r|=256),!1===i?i=0:(!0===i&&(i=255),r|=1024),r&&this.clear(r,i)}clearBuffer(e,t,i=6144,r=void 0){this.gl.clearBufferfv(i,e,t,r)}clearBufferInteger(e,t,i=6144,r=void 0){this.gl.clearBufferiv(i,e,t,r)}clearBufferUnsignedInteger(e,t,i=6144,r=void 0){this.gl.clearBufferuiv(i,e,t,r)}drawArrays(e,i,r){if(this._transformFeedbackRequestInfo){if(e!==this._transformFeedbackRequestInfo.primitiveType)throw new Error("DrawArrays called during transform feedback, but primitiveType does not match that of the current transform feedback request");if(null==this._state.program?.hasTransformFeedbackVaryings)throw new Error("DrawArrays called during transform feedback, but the shader program was not linked with a transform feedback varying")}if(s.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=g(e,r),t("enable-feature:webgl-debug:textureReadWrite"))){const e=this._state.textureUnitMap;for(let t=0;t<e.length;t++){const i=e[t];if(null!=i&&i===this._state.drawFramebuffer?.colorTexture)throw new Error(`Detected readWrite. Texture already bound at index ${t}`)}}this.gl.drawArrays(e,i,r),s.checkWebGLError(this.gl)}drawArraysInstanced(e,t,i,r){this.gl.drawArraysInstanced(e,t,i,r),s.checkWebGLError(this.gl)}drawElements(e,t,i,r){if(this._transformFeedbackRequestInfo)throw new Error("Cannot called drawElements during a transform feedback request");if(s.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=g(e,t)),this.gl.drawElements(e,t,i,r),s.webglDebugEnabled()){const n=s.getErrorMessage(this.gl);if(n){const s=this.getBoundVAO(),o=s?.indexBuffer,a=s?.buffers,l={indexBuffer:o,vertexBuffers:a},c={mode:e,count:t,type:i,offset:r},u=o?.size??0,h=r+t,d=u<h?`. Buffer is too small. Attempted to draw index ${h} of ${u}`:"";console.error(`drawElements: ${n}${d}`,{args:c,vao:l})}}}drawElementsInstanced(e,t,i,r,n){this.gl.drawElementsInstanced(e,t,i,r,n),s.checkWebGLError(this.gl)}logInfo(){s.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)}resetInfo(){s.webglDebugEnabled()&&(this._numOfDrawCalls=0,this._numOfTriangles=0)}get capabilities(){return this._capabilities}setViewport(e,t,i,r){i=Math.max(Math.round(i),1),r=Math.max(Math.round(r),1);const n=this._state.viewport;n.x===e&&n.y===t&&n.width===i&&n.height===r||(n.x=e,n.y=t,n.width=i,n.height=r,this.gl.viewport(e,t,i,r))}setViewport4fv(e){this.setViewport(e[0],e[1],e[2],e[3])}restoreViewport({x:e,y:t,width:i,height:r}){this.setViewport(e,t,i,r)}getViewport(){const e=this._state.viewport;return{x:e.x,y:e.y,width:e.width,height:e.height}}useProgram(e){this._state.program!==e&&(this._state.program?.stop(),this._state.program=e,this.gl.useProgram(e?.glName??null))}bindTexture(e,t,i=!1){(t>=this.parameters.maxTextureImageUnits||t<0)&&console.error("Input texture unit is out of range of available units!");const r=this._state.textureUnitMap[t];return null==e?.glName?(null!=r&&(this.setActiveTexture(t,i),this.gl.bindTexture(r.descriptor.target,null)),this._state.textureUnitMap[t]=null,r):i||r!==e?(this.setActiveTexture(t,i),this.gl.bindTexture(e.descriptor.target,e.glName),e.applyChanges(),this._state.textureUnitMap[t]=e,r):(e.isDirty&&(this.setActiveTexture(t,i),e.applyChanges()),r)}unbindTexture(e){if(null!=e)for(let t=0;t<this.parameters.maxTextureImageUnits;t++)this._state.textureUnitMap[t]===e&&(this.bindTexture(null,t),this._state.textureUnitMap[t]=null)}bindFramebuffer(e,t=!1){if(t||this._state.readFramebuffer!==e||this._state.drawFramebuffer!==e){if(this._stateTracker.invalidateDrawBuffers(),null==e)return this.gl.bindFramebuffer(36160,null),void(this._state.readFramebuffer=this._state.drawFramebuffer=null);e.initializeAndBind(36160),this._state.readFramebuffer=e,this._state.drawFramebuffer=e}}bindFramebufferSeparate(e,t,i=!1){const r=36008===t,n=r?this._state.readFramebuffer:this._state.drawFramebuffer;(i||n!==e)&&(null==e?this.gl.bindFramebuffer(t,null):e.initializeAndBind(t),r?this._state.readFramebuffer=e??null:(this._stateTracker.invalidateDrawBuffers(),this._state.drawFramebuffer=e??null))}blitFramebuffer(e,t,i=16384,r=9728,n=0,s=0,o=e.width,a=e.height,l=0,c=0,u=t.width,h=t.height){this.bindFramebufferSeparate(e,36008,!0),this.bindFramebufferSeparate(t,36009,!0),this.gl.blitFramebuffer(n,s,o,a,l,c,u,h,i,r)}bindBuffer(e,t){if(e)switch(t??=e.bufferType,t){case 34962:this._state.vertexBuffer=m(this.gl,e,t,this._state.vertexBuffer);break;case 34963:this._state.indexBuffer=m(this.gl,e,t,this._state.indexBuffer);break;case 35345:this._state.uniformBuffer=m(this.gl,e,t,this._state.uniformBuffer);break;case 35051:this._state.pixelPackBuffer=m(this.gl,e,t,this._state.pixelPackBuffer);break;case 35052:this._state.pixelUnpackBuffer=m(this.gl,e,t,this._state.pixelUnpackBuffer);break;case 36662:this._state.copyReadBuffer=m(this.gl,e,t,this._state.copyReadBuffer);break;case 36663:this._state.copyWriteBuffer=m(this.gl,e,t,this._state.copyWriteBuffer);break;case 35982:this._state.transformFeedbackBuffer=m(this.gl,e,t,this._state.transformFeedbackBuffer)}}bindRenderbuffer(e){const t=this.gl;e||(t.bindRenderbuffer(t.RENDERBUFFER,null),this._state.renderbuffer=null),this._state.renderbuffer!==e&&(t.bindRenderbuffer(t.RENDERBUFFER,e.glName),this._state.renderbuffer=e)}_getBufferBinding(e,t){if(t>=this.parameters.maxUniformBufferBindings||t<0)return console.error("Uniform buffer binding point is out of range!"),null;const i=35345===e?this._state.uniformBufferBindingPoints:this._state.transformBufferBindingPoints;let r=i[t];return null==r&&(r={buffer:null,offset:0,size:0},i[t]=r),r}bindBufferBase(e,t,i){const r=this._getBufferBinding(e,t);null!=r&&(r.buffer===i&&0===r.offset&&0===r.size||(this.gl.bindBufferBase(e,t,i?i.glName:null),r.buffer=i,r.offset=0,r.size=0))}bindBufferRange(e,t,i,r,n){const s=this._getBufferBinding(e,t);null!=s&&(s.buffer===i&&s.offset===r&&s.size===n||(r%this._parameters.uniformBufferOffsetAlignment===0?(this.gl.bindBufferRange(e,t,i.glName,r,n),s.buffer=i,s.offset=r,s.size=n):console.error("Uniform buffer binding offset is not a multiple of the context offset alignment")))}bindUBO(e,t,i,r){null!=t?(s.webglDebugEnabled()&&(r??t.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),t.initialize(),void 0!==i&&void 0!==r?this.bindBufferRange(35345,e,t.buffer,i,r):this.bindBufferBase(35345,e,t.buffer)):this.bindBufferBase(35345,e,null)}unbindUBO(e){for(let t=0,i=this._state.uniformBufferBindingPoints.length;t<i;t++){const i=this._state.uniformBufferBindingPoints[t];null!=i&&i.buffer===e.buffer&&this.bindBufferBase(35345,t,null)}}unbindBuffer(e){switch(e){case 34962:this._state.vertexBuffer=m(this.gl,null,e,this._state.vertexBuffer);break;case 34963:this._state.indexBuffer=m(this.gl,null,e,this._state.indexBuffer);break;case 35345:this._state.uniformBuffer=m(this.gl,null,e,this._state.uniformBuffer);break;case 35051:this._state.pixelPackBuffer=m(this.gl,null,e,this._state.pixelPackBuffer);break;case 35052:this._state.pixelUnpackBuffer=m(this.gl,null,e,this._state.pixelUnpackBuffer);break;case 36662:this._state.copyReadBuffer=m(this.gl,null,e,this._state.copyReadBuffer);break;case 36663:this._state.copyWriteBuffer=m(this.gl,null,e,this._state.copyWriteBuffer)}}bindVAO(e,t){if(null==e)return this._state.vertexArrayObject?.unbind(),void(this._state.vertexArrayObject=null);this._state.vertexArrayObject!==e&&(e.bind(t),this._state.vertexArrayObject=e)}bindTransformFeedback(e){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,e.glName)}beginTransformFeedback(e,t){if(this._transformFeedbackRequestInfo)throw new Error("Already in a transform feedback request");const{gl:i}=this;i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,e.glName),i.beginTransformFeedback(t),this._transformFeedbackRequestInfo={primitiveType:t}}endTransformFeedback(){if(!this._transformFeedbackRequestInfo)throw new Error("Not in a transform feedback request");const{gl:e}=this;e.endTransformFeedback(),e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),this._transformFeedbackRequestInfo=null}async clientWaitAsync(e=n.Milliseconds(10)){const{gl:t}=this,i=t.fenceSync(37143,0);if(!i)throw new Error("Client wait failed, could not create sync object");let s;this.instanceCounter.increment(a.ResourceType.Sync,i),t.flush();do{await r.after(e),s=t.clientWaitSync(i,0,0)}while(37147===s);if(this.instanceCounter.decrement(a.ResourceType.Sync,i),t.deleteSync(i),37149===s)throw new Error("Client wait failed")}getBoundFramebufferObject(e=36160){return 36008===e?this._state.readFramebuffer:this._state.drawFramebuffer}temporaryBindFramebufferObject(e,t,i=!1){const r=this.getBoundFramebufferObject();try{this.bindFramebuffer(e,i),t()}finally{this.bindFramebuffer(r,i)}}getBoundVAO(){return this._state.vertexArrayObject}resetState(){this.useProgram(null),this.bindVAO(null),this.bindFramebuffer(null,!0),this.unbindBuffer(34962),this.unbindBuffer(34963),this.unbindBuffer(35345),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(35051),this.unbindBuffer(35052),this.unbindBuffer(36662),this.unbindBuffer(36663);for(let e=0;e<this.parameters.maxTextureImageUnits;++e)this.bindTexture(null,e);this.setBlendingEnabled(!1),this.setBlendFunction(1,0),this.setBlendEquation(32774),this.setBlendColor(0,0,0,0),this.setFaceCullingEnabled(!1),this.setCullFace(1029),this.setFrontFace(2305),this.setPolygonOffsetFillEnabled(!1),this.setPolygonOffset(0,0),this.setScissorTestEnabled(!1),this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height),this.setDepthTestEnabled(!1),this.setDepthFunction(513),this.setDepthRange(0,1),this.setStencilTestEnabled(!1),this.setStencilFunction(519,0,0),this.setStencilOp(7680,7680,7680),this.setClearColor(0,0,0,0),this.setClearDepth(1),this.setClearStencil(0),this.setColorMask(!0,!0,!0,!0),this.setStencilWriteMask(4294967295),this.setDepthWriteEnabled(!0),this.setDrawBuffers([1029]),this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)}enforceState(){const{gl:e}=this;e.bindVertexArray(null);for(let t=0;t<this.parameters.maxVertexAttributes;t++)e.disableVertexAttribArray(t);this._state.vertexBuffer?e.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):e.bindBuffer(34962,null),this._state.indexBuffer?e.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):e.bindBuffer(34963,null),this._state.uniformBuffer?e.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):e.bindBuffer(35345,null);for(let t=0;t<this._parameters.maxUniformBufferBindings;t++){const i=this._state.uniformBufferBindingPoints[t];if(null!=i){const{buffer:r,offset:n,size:s}=i;null!==r?0===n&&0===s?e.bindBufferBase(35345,t,r.glName):e.bindBufferRange(35345,t,r.glName,n,s):e.bindBufferBase(35345,t,null)}}if(this._state.pixelPackBuffer?e.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):e.bindBuffer(35051,null),this._state.pixelUnpackBuffer?e.bindBuffer(this._state.pixelUnpackBuffer.bufferType,this._state.pixelUnpackBuffer.glName):e.bindBuffer(35052,null),this._state.copyReadBuffer?e.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):e.bindBuffer(36662,null),this._state.copyWriteBuffer?e.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):e.bindBuffer(36663,null),e.bindFramebuffer(36008,null),e.readBuffer(e.BACK),this._state.readFramebuffer&&(e.bindFramebuffer(36008,this._state.readFramebuffer.glName),e.readBuffer(a.ColorAttachment0)),e.bindFramebuffer(36009,this._state.drawFramebuffer?.glName??null),null===this._state.drawFramebuffer){const t=this._state.drawBuffers.defaultFramebuffer;e.drawBuffers(t??[1029])}else{const t=this._state.drawBuffers.fbos.get(this._state.drawFramebuffer);e.drawBuffers(t??[a.ColorAttachment0])}if(this._state.vertexArrayObject){const e=this._state.vertexArrayObject;this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=null),this.bindVAO(e)}e.useProgram(this._state.program?.glName??null),e.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a),e.bindRenderbuffer(e.RENDERBUFFER,this._state.renderbuffer?.glName??null),!0===this._state.blend?e.enable(this.gl.BLEND):e.disable(this.gl.BLEND),e.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha),e.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha),e.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a),e.clearDepth(this._state.clearDepth),e.clearStencil(this._state.clearStencil),e.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a),e.cullFace(this._state.cullFace),e.depthFunc(this._state.depthFunction),e.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar),!0===this._state.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),e.depthMask(this._state.depthWrite),e.frontFace(this._state.frontFace),e.lineWidth(1),!0===this._state.faceCulling?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),e.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]),!0===this._state.polygonOffsetFill?e.enable(e.POLYGON_OFFSET_FILL):e.disable(e.POLYGON_OFFSET_FILL),e.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height),!0===this._state.scissorTest?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST),e.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask),e.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass),!0===this._state.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),e.stencilMask(this._state.stencilWriteMask);for(let t=0;t<this.parameters.maxTextureImageUnits;t++){e.activeTexture(a.baseTextureUnit+t),e.bindTexture(3553,null),e.bindTexture(34067,null),e.bindTexture(32879,null),e.bindTexture(35866,null);const i=this._state.textureUnitMap[t];null!=i&&e.bindTexture(i.descriptor.target,i.glName)}e.activeTexture(a.baseTextureUnit+this._state.activeTexture);const t=this._state.viewport;e.viewport(t.x,t.y,t.width,t.height),this.resetInfo()}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports"],function(e){"use strict";e.ContextState=class{constructor(){this.blend=!1,this.blendColor={r:0,g:0,b:0,a:0},this.blendFunction={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0},this.blendEquation={mode:32774,modeAlpha:32774},this.colorMask={r:!0,g:!0,b:!0,a:!0},this.faceCulling=!1,this.cullFace=1029,this.frontFace=2305,this.scissorTest=!1,this.scissorRect={x:0,y:0,width:0,height:0},this.depthTest=!1,this.depthFunction=513,this.clearDepth=1,this.depthWrite=!0,this.depthRange={zNear:0,zFar:1},this.viewport=null,this.stencilTest=!1,this.polygonOffsetFill=!1,this.polygonOffset=[0,0],this.stencilFunction={face:1032,func:519,ref:0,mask:1},this.clearStencil=0,this.stencilWriteMask=1,this.stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680},this.clearColor={r:0,g:0,b:0,a:0},this.program=null,this.vertexBuffer=null,this.indexBuffer=null,this.uniformBuffer=null,this.pixelPackBuffer=null,this.pixelUnpackBuffer=null,this.copyReadBuffer=null,this.copyWriteBuffer=null,this.transformFeedbackBuffer=null,this.uniformBufferBindingPoints=new Array,this.transformBufferBindingPoints=new Array,this.readFramebuffer=null,this.drawFramebuffer=null,this.drawBuffers={defaultFramebuffer:[1029],fbos:new WeakMap},this.renderbuffer=null,this.activeTexture=0,this.textureUnitMap=new Array,this.vertexArrayObject=null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../core/object","./AllocationTracer","./enums"],function(e,t,i,r){"use strict";const n={RECORD_ALLOCATIONS:!1};e.InstanceCounter=class{constructor(){for(this._current=new Array,this._allocations=n.RECORD_ALLOCATIONS?new i.AllocationTracer("WebGLObject"):null;this._current.length<r.ResourceType.COUNT;)this._current.push(0)}increment(e,t,i=1){this._current[e]+=i,this._allocations?.add(t)}decrement(e,t,i=1){this._current[e]-=i,this._allocations?.remove(t)}get current(){return this._current}get total(){return this.current.reduce((e,t,i)=>e+(i<r.ResourceType.UNCOUNTED?t:0),0)}get resourceInformation(){let e="";if(this.total>0){e+="Live objects:\n";for(let i=0;i<r.ResourceType.COUNT;++i){const n=this._current[i];n>0&&(e+=`${t.getKey(r.ResourceType,i)}: ${n}\n`)}}return e+=this._allocations?.resetLog(),e}},e.test=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AllocationTracer":function(){define(["exports"],function(e){"use strict";class t{constructor(e){this.from=e,this.retains=new Array,this.releases=new Array}}e.AllocationTracer=class{constructor(e){this._objectType=e,this._active=new Map}get _stack(){const e=(new Error).stack.split("\n");return e.shift(),e.shift(),e.shift(),e.join("\n")}add(e){this._active.set(e,new t(this._stack))}remove(e){this._active.delete(e)}addReference(e){const t=this._active.get(e);t&&t.retains.push(this._stack)}removeReference(e){const t=this._active.get(e);t&&t.releases.push(this._stack)}resetLog(){const e=new Map;let t="";this._active.forEach((i,{usedMemory:r})=>{e.has(i.from)||(e.set(i.from,new Map),i.retains.length>0&&(t+=`  First reference count mismatch:\n  Retain:\n    ${i.retains.join("\n\n    ")}\n\n  Release:    ${i.releases.join("\n\n    ")}\n`));const n=e.get(i.from);n.set(r??0,n.get(r??0)??1)}),this._active.clear();let i=0;const r=new Array;return e.forEach((e,t)=>{let n=0;e.forEach((e,t)=>n+=e*t),e.set(-1,n),i+=n,r.push([t,e])}),e.clear(),r.sort((e,t)=>t[1].get(-1)-e[1].get(-1)),r.reduce((e,[t,i])=>{const r=Math.round(i.get(-1)/1024);return i.delete(-1),e+`  ${r}KB from ${Array.from(i.values()).reduce((e,t)=>e+t,0)} allocations at ${t}\n`},`Total ${this._objectType} memory: ${Math.round(i/1024)}KB\n${t}`)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Parameters":function(){define(["exports"],function(e){"use strict";e.Parameters=class{constructor(e,t,i){const r=t.textureFilterAnisotropic;this.versionString=e.getParameter(e.VERSION),this.maxVertexTextureImageUnits=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this.maxVertexAttributes=e.getParameter(e.MAX_VERTEX_ATTRIBS);const n=i.maxAnisotropy;this.maxMaxAnisotropy=r?Math.min(e.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY),n):1,this.maxTextureImageUnits=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.maxPreferredTexturePixels=i.maxPreferredTexturePixels,this.maxRenderbufferSize=e.getParameter(e.MAX_RENDERBUFFER_SIZE),this.maxViewportDims=e.getParameter(e.MAX_VIEWPORT_DIMS),this.maxUniformBufferBindings=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),this.maxVertexUniformBlocks=e.getParameter(e.MAX_VERTEX_UNIFORM_BLOCKS),this.maxFragmentUniformBlocks=e.getParameter(e.MAX_FRAGMENT_UNIFORM_BLOCKS),this.maxUniformBlockSize=e.getParameter(e.MAX_UNIFORM_BLOCK_SIZE),this.uniformBufferOffsetAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT),this.maxArrayTextureLayers=e.getParameter(e.MAX_ARRAY_TEXTURE_LAYERS),this.maxSamples=e.getParameter(e.MAX_SAMPLES),this.maxDrawBuffers=e.getParameter(e.MAX_DRAW_BUFFERS)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports"],function(e){"use strict";function t(e,t,i=32774,r=[0,0,0,0]){return{srcRgb:e,srcAlpha:e,dstRgb:t,dstAlpha:t,opRgb:i,opAlpha:i,color:{r:r[0],g:r[1],b:r[2],a:r[3]}}}function i(e,t,i,r,n=32774,s=32774,o=[0,0,0,0]){return{srcRgb:e,srcAlpha:t,dstRgb:i,dstAlpha:r,opRgb:n,opAlpha:s,color:{r:o[0],g:o[1],b:o[2],a:o[3]}}}const r=t(0,771),n=t(1,0),s=t(1,1),o=t(1,771),a=i(770,1,771,771),l={face:1029,mode:2305},c={face:1028,mode:2305};function u(e){return v.intern(e)}function h(e){return w.intern(e)}function d(e){return M.intern(e)}function f(e){return I.intern(e)}function p(e){return F.intern(e)}function m(e){return A.intern(e)}function g(e){return z.intern(e)}function _(e){return V.intern(e)}function y(e){return k.intern(e)}class x{constructor(e,t){this._makeKey=e,this._makeRef=t,this._interns=new Map}intern(e){if(!e)return null;const t=this._makeKey(e),i=this._interns;return i.has(t)||i.set(t,this._makeRef(e)),i.get(t)??null}}function b(e){return"["+e.join(",")+"]"}const v=new x(S,e=>({__tag:"Blending",...e}));function S(e){return e?b([e.srcRgb,e.srcAlpha,e.dstRgb,e.dstAlpha,e.opRgb,e.opAlpha,e.color.r,e.color.g,e.color.b,e.color.a]):null}const w=new x(T,e=>({__tag:"Culling",...e}));function T(e){return e?b([e.face,e.mode]):null}const M=new x(P,e=>({__tag:"PolygonOffset",...e}));function P(e){return e?b([e.factor,e.units]):null}const I=new x(C,e=>({__tag:"DepthTest",...e}));function C(e){return e?b([e.func]):null}const F=new x(O,e=>({__tag:"StencilTest",...e}));function O(e){return e?b([e.function.func,e.function.ref,e.function.mask,e.operation.fail,e.operation.zFail,e.operation.zPass]):null}const A=new x(E,e=>({__tag:"DepthWrite",...e}));function E(e){return e?b([e.zNear,e.zFar]):null}const z=new x(R,e=>({__tag:"ColorWrite",...e}));function R(e){return e?b([e.r,e.g,e.b,e.a]):null}const V=new x(D,e=>({__tag:"StencilWrite",...e}));function D(e){return e?b([e.mask]):null}const k=new x(L,e=>({__tag:"DrawBuffers",...e}));function L(e){return e?b(e.buffers):null}const B=new x(function(e){return e?b([S(e.blending),T(e.culling),P(e.polygonOffset),C(e.depthTest),O(e.stencilTest),E(e.depthWrite),R(e.colorWrite),D(e.stencilWrite),L(e.drawBuffers)]):null},e=>({blending:u(e.blending),culling:h(e.culling),polygonOffset:d(e.polygonOffset),depthTest:f(e.depthTest),stencilTest:p(e.stencilTest),depthWrite:m(e.depthWrite),colorWrite:g(e.colorWrite),stencilWrite:_(e.stencilWrite),drawBuffers:y(e.drawBuffers)}));e.StateTracker=class{constructor(e){this._pipelineInvalid=!0,this._blendingInvalid=!0,this._cullingInvalid=!0,this._polygonOffsetInvalid=!0,this._depthTestInvalid=!0,this._stencilTestInvalid=!0,this._depthWriteInvalid=!0,this._colorWriteInvalid=!0,this._stencilWriteInvalid=!0,this._drawBuffersInvalid=!0,this._stateSetters=e}setPipeline(e){(this._pipelineInvalid||e!==this._pipeline)&&(this._setBlending(e.blending),this._setCulling(e.culling),this._setPolygonOffset(e.polygonOffset),this._setDepthTest(e.depthTest),this._setStencilTest(e.stencilTest),this._setDepthWrite(e.depthWrite),this._setColorWrite(e.colorWrite),this._setStencilWrite(e.stencilWrite),this._setDrawBuffers(e.drawBuffers),this._pipeline=e),this._pipelineInvalid=!1}invalidateBlending(){this._blendingInvalid=!0,this._pipelineInvalid=!0}invalidateCulling(){this._cullingInvalid=!0,this._pipelineInvalid=!0}invalidatePolygonOffset(){this._polygonOffsetInvalid=!0,this._pipelineInvalid=!0}invalidateDepthTest(){this._depthTestInvalid=!0,this._pipelineInvalid=!0}invalidateStencilTest(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDepthWrite(){this._depthWriteInvalid=!0,this._pipelineInvalid=!0}invalidateColorWrite(){this._colorWriteInvalid=!0,this._pipelineInvalid=!0}invalidateStencilWrite(){this._stencilTestInvalid=!0,this._pipelineInvalid=!0}invalidateDrawBuffers(){this._drawBuffersInvalid=!0,this._pipelineInvalid=!0}_setBlending(e){this._blending=this._setSubState(e,this._blending,this._blendingInvalid,this._stateSetters.setBlending),this._blendingInvalid=!1}_setCulling(e){this._culling=this._setSubState(e,this._culling,this._cullingInvalid,this._stateSetters.setCulling),this._cullingInvalid=!1}_setPolygonOffset(e){this._polygonOffset=this._setSubState(e,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset),this._polygonOffsetInvalid=!1}_setDepthTest(e){this._depthTest=this._setSubState(e,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest),this._depthTestInvalid=!1}_setStencilTest(e){this._stencilTest=this._setSubState(e,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest),this._stencilTestInvalid=!1}_setDepthWrite(e){this._depthWrite=this._setSubState(e,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite),this._depthWriteInvalid=!1}_setColorWrite(e){this._colorWrite=this._setSubState(e,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite),this._colorWriteInvalid=!1}_setStencilWrite(e){this._stencilWrite=this._setSubState(e,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite),this._stencilTestInvalid=!1}_setDrawBuffers(e){this._drawBuffers=this._setSubState(e,this._drawBuffers,this._drawBuffersInvalid,this._stateSetters.setDrawBuffers),this._drawBuffersInvalid=!1}_setSubState(e,t,i,r){return(i||e!==t)&&(r(e),this._pipelineInvalid=!0),e}},e.add=s,e.backFaceCullingParams=l,e.copySource=n,e.cullingParams=e=>2===e?l:1===e?c:null,e.defaultColorWrite={r:!0,g:!0,b:!0,a:!0},e.defaultDepthWrite={zNear:0,zFar:1},e.destinationTimesOneMinusSourceAlpha=r,e.frontFaceCullingParams=c,e.makeBlending=u,e.makeColorWrite=g,e.makeCulling=h,e.makeDepthTest=f,e.makeDepthWrite=m,e.makeDrawBuffers=y,e.makePipelineState=function(e){return B.intern(e)},e.makePolygonOffset=d,e.makeStencilTest=p,e.makeStencilWrite=_,e.premultipliedAlpha=o,e.separateBlendingParams=i,e.simpleBlendingParams=t,e.unpremultipliedAlphaToPremultipliedAlpha=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTest":function(){define(["exports","./testAppleAmdDrawArrays","./testFloatBufferBlend","./testSVGPremultipliedAlpha"],function(e,t,i,r){"use strict";e.WebGLDriverTest=class{constructor(e){this.rctx=e,this.floatBufferBlend=new i.FloatBufferBlend(e),this.svgPremultipliesAlpha=new r.SVGPremultipliedAlpha(e),this.drawArraysRequiresIndicesTypeReset=new t.DrawArraysRequiresIndicesTypeReset(e)}dispose(){this.svgPremultipliesAlpha.dispose(),this.floatBufferBlend.dispose(),this.drawArraysRequiresIndicesTypeReset.dispose()}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define(["exports","../../core/has","../3d/webgl-engine/core/shaderModules/glsl","./AppleAmdDriverHelper","./BufferObject","./enums","./FramebufferObject","./TextureDescriptor","./WebGLDriverTestModule"],function(e,t,i,r,n,s,o,a,l){"use strict";class c extends l.WebGLDriverTestModule{constructor(e){super(),this._rctx=e,this._helperProgram=null,t("mac")&&t("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const t=this._rctx,i=t.getBoundFramebufferObject(),{x:r,y:l,width:c,height:u}=t.getViewport();t.resetState();const h=new a.TextureDescriptor(1);h.wrapMode=33071,h.samplingMode=9728;const d=new o.FramebufferObject(t,h),f=n.BufferObject.createIndex(this._rctx,35044,new Uint8Array([0]));t.bindFramebuffer(d),t.setViewport(0,0,1,1),t.useProgram(this._helperProgram),t.bindBuffer(f,34963),t.drawElements(s.PrimitiveType.POINTS,1,s.DataType.UNSIGNED_BYTE,0),t.useProgram(e),t.bindVAO(null),t.drawArrays(s.PrimitiveType.TRIANGLES,0,258);const p=new Uint8Array(4);return d.readPixels(0,0,1,1,6408,s.PixelType.UNSIGNED_BYTE,p),t.setViewport(r,l,c,u),t.bindFramebuffer(i),d.dispose(),f.dispose(),255===p[0]}_prepareProgram(){const e=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${i.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,t=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${i.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(e,t,new Map([]))}_prepareHelperProgram(){const e=r.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}}e.DrawArraysRequiresIndicesTypeReset=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/glsl":function(){define(["exports"],function(e){"use strict";const t=(e,...t)=>{let i="";for(let r=0;r<t.length;r++)i+=e[r]+t[r];return i+=e[e.length-1],i};t.int=e=>Math.round(e).toString(),t.float=e=>e.toPrecision(8),e.If=function(e,t,i=""){return e?t:i},e.glsl=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/AppleAmdDriverHelper":function(){define(["exports","../../core/has","./BufferObject","./enums"],function(e,t,i,r){"use strict";class n{constructor(e){this._rctx=e,this._indexBuffer=this._createIndexbuffer(),this._program=this._createHelperProgram()}static getShaderSources(){return{vertex:"#version 300 es\n    precision highp float;\n\n    void main(void) {\n      gl_Position = vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }",fragment:"#version 300 es\n    precision highp float;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = vec4(0.0, 0.0, 0.0, 1.0);\n    }"}}_createHelperProgram(){const e=n.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}_createIndexbuffer(){return i.BufferObject.createIndex(this._rctx,35044,new Uint32Array([0]))}run(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,34963),this._rctx.drawElements(r.PrimitiveType.POINTS,1,r.DataType.UNSIGNED_INT,0))}dispose(){this._program.dispose(),this._indexBuffer.dispose()}get test(){}}e.AppleAmdDriverHelper=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../core/maybe"],function(e,t){"use strict";e.WebGLDriverTestModule=class{constructor(){this._result=!1}dispose(){this._program=t.disposeMaybe(this._program)}get result(){return null!=this._program&&(this._result=this._test(this._program),this.dispose()),this._result}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define(["exports","./enums","./FramebufferObject","./renderState","./TextureDescriptor","./VertexArrayObject","./VertexAttributeLayouts","./VertexBuffer","./WebGLDriverTestModule"],function(e,t,i,r,n,s,o,a,l){"use strict";class c extends l.WebGLDriverTestModule{constructor(e){super(),this._rctx=e,e.gl&&e.capabilities.colorBufferFloat?.textureFloat&&e.capabilities.colorBufferFloat?.floatBlend&&(this._program=e.programCache.acquire("\n    precision highp float;\n    attribute vec2 position;\n\n    void main() {\n      gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n     precision highp float;\n\n     void main() {\n      gl_FragColor = vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",o.Pos2usLocations))}_test(e){const l=this._rctx,c=new n.TextureDescriptor(1);c.wrapMode=33071,c.dataType=t.PixelType.FLOAT,c.internalFormat=t.SizedPixelFormat.RGBA32F,c.samplingMode=9728;const u=new i.FramebufferObject(l,c),h=new a.VertexBuffer(l,o.Pos2us,new Uint16Array([0,0,1,0,0,1,1,1])),d=new s.VertexArrayObject(l,h);l.gl.getError(),l.useProgram(e);const f=l.getBoundFramebufferObject(),{x:p,y:m,width:g,height:_}=l.getViewport();l.bindFramebuffer(u),l.setViewport(0,0,1,1),l.bindVAO(d),l.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,4);const y=r.makePipelineState({blending:r.destinationTimesOneMinusSourceAlpha});l.setPipelineState(y),l.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,4);const x=l.gl.getError();return l.setViewport(p,m,g,_),l.bindFramebuffer(f),d.dispose(),u.dispose(),x!==l.gl.INVALID_OPERATION||(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1)}}e.FloatBufferBlend=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define(["exports","./enums","./FramebufferObject","./Texture","./TextureDescriptor","./VertexArrayObject","./VertexAttributeLayouts","./VertexBuffer","./WebGLDriverTestModule"],function(e,t,i,r,n,s,o,a,l){"use strict";class c extends l.WebGLDriverTestModule{constructor(e){super(),this._rctx=e,this._program=e.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 position;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv = position;\n      gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ","\n    precision highp float;\n\n    varying vec2 v_uv;\n\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor = texture2D(u_texture, v_uv);\n    }\n    ",o.Pos2usLocations)}dispose(){super.dispose()}_test(e){const l=this._rctx;if(!l.gl)return e.dispose(),!0;const c=new n.TextureDescriptor(1);c.wrapMode=33071,c.samplingMode=9728;const h=new i.FramebufferObject(l,c),d=new a.VertexBuffer(l,o.Pos2us,new Uint16Array([0,0,1,0,0,1,1,1])),f=new s.VertexArrayObject(l,d),p=new n.TextureDescriptor;p.samplingMode=9729,p.wrapMode=33071;const m=new r.Texture(l,p,u);l.useProgram(e),l.bindTexture(m,0),e.setUniform1i("u_texture",0);const g=l.getBoundFramebufferObject(),{x:_,y,width:x,height:b}=l.getViewport();l.bindFramebuffer(h),l.setViewport(0,0,1,1),l.setClearColor(0,0,0,0),l.setBlendingEnabled(!1),l.clear(16384),l.bindVAO(f),l.drawArrays(t.PrimitiveType.TRIANGLE_STRIP,0,4);const v=new Uint8Array(4);return h.readPixels(0,0,1,1,6408,t.PixelType.UNSIGNED_BYTE,v),f.dispose(),h.dispose(),m.dispose(),l.setViewport(_,y,x,b),l.bindFramebuffer(g),255!==v[0]}}const u=new Image;u.src="data:image/svg+xml,%3C%3Fxml version='1.0' encoding='UTF-8'%3F%3E%3Csvg width='5' height='5' version='1.1' viewBox='0 0 5 5' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='5' height='5' fill='%23f00' fill-opacity='.5'/%3E%3C/svg%3E%0A",u.width=5,u.height=5,u.decode(),e.SVGPremultipliedAlpha=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define(["exports","./DebugRendererInfo","./DisjointTimerQuery","./load","./LoseContext"],function(e,t,i,r,n){"use strict";e.Capabilities=class{constructor(e,t){this._gl=e,this._compressedTextureETC=null,this._compressedTextureS3TC=null,this._textureFilterAnisotropic=null,this._colorBufferFloat=null,this._loseContext=null,this._textureNorm16=null,this._textureFloatLinear=null,this._parallelShaderCompile=null,this._rendererInfo=null,this._disabledExtensions=t.disabledExtensions,this._debugWebGLExtensions=t.debugWebGLExtensions}get compressedTextureETC(){return this._compressedTextureETC??=r.loadCompressedTextureETC(this._gl,this._disabledExtensions),this._compressedTextureETC}get compressedTextureS3TC(){return this._compressedTextureS3TC??=r.loadCompressedTextureS3TC(this._gl,this._disabledExtensions),this._compressedTextureS3TC}get textureFilterAnisotropic(){return this._textureFilterAnisotropic??=r.loadTextureFilterAnisotropicCapability(this._gl,this._disabledExtensions),this._textureFilterAnisotropic}get disjointTimerQuery(){return this._disjointTimerQuery??=i.createDisjointTimerQuery(this._gl,this._disabledExtensions),this._disjointTimerQuery}get colorBufferFloat(){return this._colorBufferFloat??=r.loadColorBufferFloat(this._gl,this._disabledExtensions),this._colorBufferFloat}get textureNorm16(){return this._textureNorm16??=r.loadTextureNorm16(this._gl,this._disabledExtensions),this._textureNorm16}get textureFloatLinear(){return this._textureFloatLinear??=r.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]),this._textureFloatLinear}get parallelShaderCompile(){return this._parallelShaderCompile??=r.loadBooleanExtension(this._gl,this._disabledExtensions,"parallelShaderCompile",!1,["KHR_parallel_shader_compile"]),this._parallelShaderCompile}get loseContext(){return this._loseContext??=n.load(this._gl,this._debugWebGLExtensions),this._loseContext}get rendererInfo(){return this._rendererInfo??=t.loadRendererInfo(this._gl),this._rendererInfo}enable(e){return this[e]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports"],function(e){"use strict";e.loadBooleanExtension=function(e,t,i,r,n){if(r)return!0;if(t[i])return!1;for(const t of n)if(e.getExtension(t))return!0;return!1},e.loadColorBufferFloat=function(e,t){const i=!t.colorBufferHalfFloat&&e.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&e.getExtension("EXT_color_buffer_float"),n=!t.floatBlend&&!t.colorBufferFloat&&e.getExtension("EXT_float_blend");return i||r||n?{textureFloat:!!r,textureHalfFloat:!!i,floatBlend:!!n,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null},e.loadCompressedTextureETC=function(e,t){if(t.compressedTextureETC)return null;const i=e.getExtension("WEBGL_compressed_texture_etc");return i?{COMPRESSED_R11_EAC:i.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:i.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:i.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:i.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:i.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:i.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:i.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null},e.loadCompressedTextureS3TC=function(e,t){if(t.compressedTextureS3TC)return null;const i=e.getExtension("WEBGL_compressed_texture_s3tc");return i?{COMPRESSED_RGB_S3TC_DXT1:i.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:i.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:i.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:i.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null},e.loadTextureFilterAnisotropicCapability=function(e,t){if(t.textureFilterAnisotropic)return null;const i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");return i?{MAX_TEXTURE_MAX_ANISOTROPY:i.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:i.TEXTURE_MAX_ANISOTROPY_EXT}:null},e.loadTextureNorm16=function(e,t){if(t.textureNorm16)return null;const i=e.getExtension("EXT_texture_norm16");return i?{R16:i.R16_EXT,RG16:i.RG16_EXT,RGB16:i.RGB16_EXT,RGBA16:i.RGBA16_EXT,R16_SNORM:i.R16_SNORM_EXT,RG16_SNORM:i.RG16_SNORM_EXT,RGB16_SNORM:i.RGB16_SNORM_EXT,RGBA16_SNORM:i.RGBA16_SNORM_EXT}:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(e){"use strict";e.load=function(e,t){const i=t.loseContext&&e.getExtension("WEBGL_lose_context");return i?{loseRenderingContext:()=>i.loseContext()}:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/ParentChildStage":function(){define(["exports","../../../Color","./ManagedCanvas","./Stage","./webgl/VideoScreenRenderer"],function(e,t,i,r,n){"use strict";class s extends r.Stage{constructor(e,t,r){super(null,t={...t,renderFrame:e=>{}},new i.ManagedCanvas(null,{canvas:e})),this._requestRender=r,this.viewIsReady=!1,this.videoScreenRenderer=new n(this,t),this.videoScreenRenderer.visible=!0}requestRender(){this._requestRender()}processRender(e){this.videoScreenRenderer.bind(e),e.backgroundColor=t.fromArray([0,0,0,0]),super.processRender(e),this.videoScreenRenderer.unbind(e)}}class o extends r.Stage{constructor(e,t,i){super(e,t={...t,renderFrame:e=>{this.render(e)}},i),this._childStage=new s(i.canvas,t,()=>this.requestRender())}get childStage(){return this._childStage}render(e){this._childStage.viewIsReady?(this._childStage.context.enforceState(),this._childStage.renderFrame(e)):this.requestRender(),this.context.enforceState(),super.renderFrame(e)}processRender(e){super.processRender(e),this._childStage.viewIsReady&&this._childStage.visible&&this._childStage.videoScreenRenderer.processRender(e)}}e.ChildStage=s,e.ParentStage=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/VideoScreenRenderer":function(){define(["../../../../core/maybe","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../core/libs/gl-matrix-2/factories/vec4f32","../../../../geometry/Point","../../../../geometry/operators/projectOperator","../DisplayObject","./shaderGraph/techniques/videoScreenRenderer/VideoScreenTechnique","../../../webgl/enums","../../../webgl/FramebufferObject","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";class h extends s.DisplayObject{constructor(e,t){super(),this._controlPointsOwner=t,this.readbackScreenCoords=i.create(),this.videoTextureCoords=new Array(36),this.overlayTextureCoords=new Array(36),this._prevFBO=null,this._acquiredFBO=null,this._isBound=!1,this._hasCoordinates=!1,this._geIsLoaded=!1,this._ndcRect=[0,0,2,2],this._technique=new o.VideoScreenTechnique,this.visible=!1,this.stage=e;for(let e=0;e<6;e++){const t=e/5;for(let i=0;i<6;i++){const r=i/5;this.videoTextureCoords[6*e+i]={u:r,v:t}}}}getMesh(e){throw new Error("Method not implemented.")}destroy(){super.destroy(),e.disposeMaybe(this._readbackTexture)}bind(e){const{context:t,pixelRatio:i,state:r}=e;if(this._update(e),!this.ready||0===this.readbackScreenCoords[2]||0===this.readbackScreenCoords[3])return this.requestRender(),!1;const{size:n}=r,s=Math.round(i*n[0]),o=Math.round(i*n[1]),a=new u.TextureDescriptor(s,o);return a.samplingMode=9729,a.wrapMode=33071,this._acquiredFBO||(this._acquiredFBO=new l.FramebufferObject(t,a)),this._acquiredFBO.resize(s,o),t.bindFramebuffer(this._acquiredFBO),this._isBound=!0,!0}unbind(e){if(!this._isBound)return;const{context:t,pixelRatio:i,state:r}=e,{size:n}=r,s=this._acquiredFBO;if(!s.getColorTexture(a.ColorAttachment0))throw new Error("Failed to get color texture from FBO.");const o=this._getReadbackTexture(e),l=this.readbackScreenCoords,c=Math.round(i*l[0]),u=Math.round(i*(n[1]-l[1]))-o.descriptor.height,h=c+o.descriptor.width,d=u+o.descriptor.height,f=Math.max(c,0),p=Math.max(u,0),m=Math.min(h,s.width)-f,g=Math.min(d,s.height)-p;m>0&&g>0&&s.copyToTexture(f,p,m,g,f-c,p-u,o),t.bindFramebuffer(this._prevFBO)}_update(e){const{state:i}=e,s=this._controlPointsOwner,o=s.groundControlPoints(),a=s.getSize(),l=i.size,c=o?.length;if(!c)return;if(n.load().then(()=>{this._geIsLoaded=!0}),!this._geIsLoaded)return void this.requestRender();const u=a[0],h=a[1],d=l[0],f=h/l[1],p=u/d;if(f>p){const e=p/f*2,t=(2-e)/2;this._ndcRect[0]=-1+t,this._ndcRect[1]=1,this._ndcRect[2]=e,this._ndcRect[3]=2}else{const e=f/p*2,t=(2-e)/2;this._ndcRect[0]=-1,this._ndcRect[1]=1-t,this._ndcRect[2]=2,this._ndcRect[3]=e}const m=new Array(c),g=i.spatialReference;for(let e=0;e<c;e++){const{lat:t,lon:i}=o[e],s=new r(i,t);m[e]=n.execute(s,g)}const _=[];let y=1/0,x=1/0,b=-1/0,v=-1/0;for(const e of m){const r=t.create();i.toScreen(r,e.x,e.y),_.push({x:r[0],y:r[1]}),y=Math.min(y,r[0]),x=Math.min(x,r[1]),b=Math.max(b,r[0]),v=Math.max(v,r[1])}const S=[y,v],w=[b,x];this.readbackScreenCoords[0]=Math.max(Math.floor(S[0]),0),this.readbackScreenCoords[1]=Math.max(Math.floor(w[1]),0),this.readbackScreenCoords[2]=Math.ceil(w[0]),this.readbackScreenCoords[3]=Math.ceil(S[1]);for(let e=0;e<_.length;e++){const t=_[e],i=(t.x-y)/(b-y),r=(v-t.y)/(v-x);this.overlayTextureCoords[e]={u:i,v:r}}this._hasCoordinates=!0}_createTransforms(){return null}doRender(e){this._readbackTexture&&this._hasCoordinates?this._technique.render(e,{texture:this._readbackTexture,textureCoords:this.overlayTextureCoords,opacity:1,ndcRect:this._ndcRect}):this.requestRender()}_getReadbackTexture(e){const{context:t,pixelRatio:i}=e,r=Math.round(i*Math.abs(this.readbackScreenCoords[2]-this.readbackScreenCoords[0])),n=Math.round(i*Math.abs(this.readbackScreenCoords[3]-this.readbackScreenCoords[1]));if(this._readbackTexture)this._readbackTexture.resize(r,n);else{const e=new u.TextureDescriptor(r,n);e.wrapMode=33071,e.internalFormat=a.SizedPixelFormat.RGBA8,this._readbackTexture=new c.Texture(t,e)}return this._readbackTexture}}return h})},"esri/geometry/operators/projectOperator":function(){define(["require","exports","./gx/operatorProject"],function(e,t,i){"use strict";let r,n,s,o,a,l,c,u,h,d,f;function p(){return!!n&&i.isLoaded()}function m(e,t,i={}){let n;const o=s(e),a=s(t);if(i?.geographicTransformation){const e=new l;e.setInputSpatialReference(o),e.setOutputSpatialReference(a);for(const t of i.geographicTransformation.steps){let i;i=t.wkid?c(t.wkid,t.isInverse):u(t.wkt,t.isInverse),e.add(i)}n=e.create()}else if(i?.areaOfInterestExtent)return d(o,a,r(i.areaOfInterestExtent).asEnvelope2D());return n?h(o,a,n):f(o,a)}t.supportsCurves=void 0,t.execute=function(e,t,r={}){const s=m(o(e),t,r);return a(i.execute(n(e),s),t)},t.executeMany=function(e,t,r={}){const s=e.map(n),l=m(o(e),t,r);return i.executeMany(s,l).map(e=>a(e,t))},t.isLoaded=p,t.load=async function(){if(!p()){const[p,m,g,_]=await Promise.all([new Promise((t,i)=>e(["./support/apiConverter"],t,i)),new Promise((t,i)=>e(["../../chunks/ProjectionTransformation"],t,i)).then(e=>e.CompositeGeographicTransformation).then(({CompositeGeographicTransformationEditor:e})=>e),new Promise((t,i)=>e(["../../chunks/ProjectionTransformation"],t,i)).then(e=>e.GeographicTransformation).then(({create:e,createFromWKT:t})=>({create:e,createFromWKT:t})),new Promise((t,i)=>e(["../../chunks/ProjectionTransformation"],t,i)).then(e=>e.ProjectionTransformation).then(({create:e,createEx:t,createFromAoi:i})=>({create:e,createEx:t,createFromAoi:i})),i.load()]);r=p.fromExtent,n=p.fromGeometry,s=p.fromSpatialReference,o=p.getSpatialReference,a=p.toGeometry,l=m,c=g.create,u=g.createFromWKT,h=_.createEx,d=_.createFromAoi,f=_.create,t.supportsCurves=i.supportsCurves()}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/operators/gx/operatorProject":function(){define(["require","exports","../../../chunks/SimpleGeometryCursor","../../../chunks/pe"],function(e,t,i,r){"use strict";let n;function s(){return!!n&&r.isLoaded()}t.clipToSpatialReference=function(e,t,i){return n.clipToSpatialReference(e,t,null,i)},t.execute=function(e,t){return n.execute(e,t,null)},t.executeMany=function(e,t){const r=n.executeMany(new i.SimpleGeometryCursor(e),t,null);return Array.from(r)},t.foldInto360Range=function(e,t){return n.foldInto360Range(e,t)},t.foldInto360RangeGeodetic=function(e,t,i){return n.foldInto360RangeGeodetic(e,t,i)},t.isLoaded=s,t.load=async function(){if(!s()){const[t,i]=await Promise.all([new Promise((t,i)=>e(["../../../chunks/ProjectionTransformation"],t,i)).then(e=>e.OperatorProject$1),new Promise((t,i)=>e(["../../../chunks/ProjectionTransformation"],t,i)).then(e=>e.SpatialReference).then(({injectPe:e})=>e),r.load()]);n=new t.OperatorProject,i(r.pe)}},t.normalizeGeometry=function(e,t,i){return n.normalizeGeometry(e,t,i)},t.supportsCurves=function(){return n.supportsCurves()},t.transform=function(e,t,i,r,s){return n.transform(e,t,i,r,s)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleGeometryCursor":function(){define(["exports"],function(e){"use strict";class t{*[Symbol.iterator](){let e=this.next();for(;e;)yield e,e=this.next()}}e.GeometryCursor=t,e.OverlayGeometryCursor=class extends t{},e.SimpleGeometryCursor=class extends t{constructor(e){super(),this.m_iGeom=-1,this.m_aGeoms=e?e.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const e=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,e}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}})},"esri/views/2d/engine/webgl/shaderGraph/techniques/videoScreenRenderer/VideoScreenTechnique":function(){define(["exports","../../../../../../../core/maybe","../../../meshing/Mesh","../../utils","../Technique","../shaders/VideoScreenShader","../../../../../../webgl/enums","../../../../../../webgl/VertexElementDescriptor"],function(e,t,i,r,n,s,o,a){"use strict";class l extends n.Technique{constructor(){super(...arguments),this.type=27,this._mesh=null,this.shaders={geometry:new s.VideoScreenShader}}render(e,t){const{context:i,painter:n}=e,{texture:s,textureCoords:o}=t,a=this._getMesh(e),l=t.ndcRect[2],c=t.ndcRect[3],u=t.ndcRect[0],h=t.ndcRect[1],d=new Float32Array(180);for(let e=0;e<6;e++){const t=c*e/5;for(let i=0;i<6;i++){const r=l*i/5,{u:n,v:s}=o[6*e+i];d[5*(6*e+i)]=u+r,d[5*(6*e+i)+1]=h-t,d[5*(6*e+i)+2]=n,d[5*(6*e+i)+3]=s,d[5*(6*e+i)+4]=1}}a.vertexBuffers.get("geometry")?.setData(d);const f={texture:{texture:s,unit:0},opacity:t.opacity},p={shader:this.shaders.geometry,uniforms:{config:f},defines:{},optionalAttributes:null,useComputeBuffer:!1};n.setPipelineState(r.simplePipelineState),n.submitDrawMeshUntyped(i,p,a)}shutdown(){t.destroyMaybe(this._mesh)}_getMesh(e){const{context:t}=e,r=new Uint32Array(150);for(let e=0;e<5;e++)for(let t=0;t<5;t++){const i=6*(5*e+t),n=6*(e+1)+t+1,s=n-1,o=n-6,a=n-7;r[i]=n,r[i+1]=s,r[i+2]=o,r[i+3]=s,r[i+4]=a,r[i+5]=o}return this._mesh||(this._mesh=new i.Mesh(t,{vertex:{geometry:{data:new Float32Array(180),layout:[new a.VertexElementDescriptor("position",2,o.DataType.FLOAT,0,20),new a.VertexElementDescriptor("texcoord",2,o.DataType.FLOAT,8,20),new a.VertexElementDescriptor("w",1,o.DataType.FLOAT,16,20)]}},index:{index:{data:r}},groups:[{primitive:o.PrimitiveType.TRIANGLES,index:"index"}],parts:[{group:0,start:0,count:r.length}]})),this._mesh}}e.VideoScreenTechnique=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/VideoScreenShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,i,r){"use strict";class n extends i.VertexInput{}t.__decorate([i.location(0,r.Vec2)],n.prototype,"position",void 0),t.__decorate([i.location(1,r.Vec2)],n.prototype,"texcoord",void 0),t.__decorate([i.location(2,r.Float)],n.prototype,"w",void 0);class s extends i.FragmentInput{}class o extends i.UniformGroup{}t.__decorate([i.uniform(r.Sampler2D)],o.prototype,"texture",void 0),t.__decorate([i.uniform(r.Float)],o.prototype,"opacity",void 0);class a extends i.GraphShaderModule{constructor(){super(...arguments),this.type="VideoScreenShader"}vertex(e){const{position:t,texcoord:i,w:n}=e;return{glPosition:new r.Vec4(t,0,n),texcoord:i}}fragment(e){const t=new i.FragmentOutput;return t.fragColor=r.texture2D(this.config.texture,e.texcoord).multiply(this.config.opacity),t}}t.__decorate([i.uniform(o)],a.prototype,"config",void 0),t.__decorate([t.__param(0,i.input(n))],a.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(s))],a.prototype,"fragment",null),e.VideoScreenShader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/LabelManager":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/has","../../core/accessorSupport/decorators/property","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./engine/vectorTiles/decluttering/SymbolFader","./engine/webgl/definitions"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u{constructor(){this.styles=new Map,this.layerContexts=new Map}get cachedStyles(){return this.styles}setLabelClassStyle(e,t,i){this.layerContexts.set(e,t),this.styles.set(e,i)}}function h(e){const t="esriGeometryPolyline"===e.geometryType?0:1,i="esriGeometryPolyline"===e.geometryType?0:1;return{geometryType:e.geometryType,iconAllowOverlap:!e.deconflictionEnabled,iconIgnorePlacement:!1,textAllowOverlap:!e.deconflictionEnabled,textIgnorePlacement:!1,iconRotationAlignment:t,textRotationAlignment:t,iconTranslateAnchor:i,iconTranslate:[0,0],textTranslateAnchor:i,textTranslate:[0,0]}}e.LabelManager=class extends i{constructor(e){super(e),this._faderWorkingSet=[],this._styleRepository=new u,this.lastUpdateId=-1,this.updateRequested=!1,this.view=null,this.symbolFader=new l.SymbolFader("feature-tile",this._styleRepository,(e,t)=>{e.updateLabelVisibility(),e.requestRender(),e.isReady&&(e.decluttered=!0)},this._faderWorkingSet,c.tileSize,7e6)}get updating(){return r("esri-2d-log-updating")&&console.log(`Updating LabelManager ${this.updateRequested}:\n-> updateRequested: ${this.updateRequested}`),this.updateRequested}viewChange(){this.requestUpdate()}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.view?.requestUpdate())}processUpdate(e){this.doUpdate(e)?this.updateRequested=!1:(this.updateRequested=!0,this.view?.requestUpdate())}setLabelSchemaStyles(e,t){let i;switch(e.type){case"label":i=e.classes;break;case"subtype":i=Array.from(Object.values(e.renderers).flatMap(e=>e.classes));break;case"cluster":i=[...e.cluster.classes,...e.feature.classes];break;case"track":i=[...e.latestObservation.classes,...e.previousObservation.classes,...e.trackLine.classes]}for(const e of i){const i=h(e);this._styleRepository.setLabelClassStyle(e.labelClassId,t,i)}}doUpdate(e){const t=this.view;if(!t)return!1;const i=t.allLayerViews.map(e=>e.featureContainer).filter(e=>!!e&&e?.hasLabels);if(i.length>0){this._faderWorkingSet.length=0;for(const t of i)for(const i of t.tiles||[])i.setTransform(e.state),this._faderWorkingSet.push(i);const r=e.state.scale,n=t.featuresTilingScheme.scaleToZoom(r);return this.symbolFader.update(n,e.state)}return!0}},t.__decorate([n.property()],e.LabelManager.prototype,"updateRequested",void 0),t.__decorate([n.property()],e.LabelManager.prototype,"updating",null),t.__decorate([n.property()],e.LabelManager.prototype,"view",void 0),e.LabelManager=t.__decorate([a.subclass("esri.views.2d.LabelManager")],e.LabelManager),e.LabelClassStyleRepository=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define(["exports","../../../../../core/signal","./CollisionJob","./config","./SymbolDeclutterer","./SymbolRepository"],function(e,t,i,r,n,s){"use strict";const o=1e-6;e.SymbolFader=class{constructor(e,i,a,l,c,u=r.declutterBudget){this.styleRepository=i,this._declutterBudget=u,this._tileToHandle=new Map,this._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]},this._offsetFromScreenCenter=[0,0],this._completed=!1,this._fading=t.signal(!1),this._symbolRepository=new s.SymbolRepository(c,l),this._symbolDeclutterer=new n.SymbolDeclutterer(e,l,this._symbolRepository,this.styleRepository,(e,t,i)=>this._createCollisionJob(e,t,i),a,(e,t)=>(this.styleRepository.getStyleLayerByUID?.(e.styleLayerUID)?.z??0)-(this.styleRepository.getStyleLayerByUID?.(t.styleLayerUID)?.z??0),e=>{const t=this.styleRepository.getStyleLayerByUID?.(e);if(t){if(this._zoom+o<t.minzoom||this._zoom-o>=t.maxzoom)return!1;const e=t.getLayoutProperty?.("visibility");if(e&&1===e.getValue())return!1}return!0})}get symbolRepository(){return this._symbolRepository}_createCollisionJob(e,t,r){return this.updateDecluttererViewState(),new i.CollisionJob(e,t,r,this.styleRepository,this._zoom,this._viewState.rotation)}get fading(){return this._fading.value}get decluttererOffset(){return this._offsetFromScreenCenter}registerFeatureTile(e){this.symbolRepository?(this.symbolRepository.registerFeatureTile(e),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}unregisterFeatureTile(e){this.symbolRepository?(this._symbolRepository.unregisterFeatureTile(e),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}insertFeatureTileMetrics(e,t){this.symbolRepository?(this.symbolRepository.insertFeatureTileMetrics(e,t),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}removeFeatureTileMetrics(e,t){this.symbolRepository?(this.symbolRepository.removeFeatureTileMetrics(e,t),this.restartDeclutter()):console.error("InternalError: Symbol repository not yet initialized")}addTile(e){e.decluttered=!1,this._tileToHandle.set(e,e.on("symbols-changed",()=>{this._symbolRepository.registerVectorTile(e),this.restartDeclutter()})),this._symbolRepository.registerVectorTile(e),this.restartDeclutter()}removeTile(e){const t=this._tileToHandle.get(e);t&&(this._symbolRepository.unregisterVectorTile(e),this.restartDeclutter(),t.remove(),this._tileToHandle.delete(e))}update(e,t){this._zoom=e,this._viewState={scale:t.scale,rotation:t.rotation,center:[t.center[0],t.center[1]],size:[t.size[0],t.size[1]]};const i=[0,0];t.toScreen(i,t.center);const r=[0,0];return t.toScreen(r,this._declutterViewState.center),this._offsetFromScreenCenter[0]=i[0]-r[0],this._offsetFromScreenCenter[1]=i[1]-r[1],this._continueDeclutter(),this._completed}restartDeclutter(){this._completed=!1,this._symbolDeclutterer.restart(),this._notifyUnstable()}clear(){this._completed=!1,this._symbolRepository=null,this._symbolDeclutterer.restart(),this._tileToHandle.forEach(e=>e.remove()),this._tileToHandle.clear()}get stale(){return this._zoom!==this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}deleteStyleLayers(e){this._symbolRepository.deleteStyleLayers(e)}_continueDeclutter(){this._completed&&!this.stale||(this._symbolDeclutterer.running||(this.updateDecluttererViewState(),this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),this._completed=this._symbolDeclutterer.continue(this._declutterBudget),this._completed&&this._scheduleNotifyStable())}_scheduleNotifyStable(){null!=this._stableNotificationHandle&&clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null,this._fading.value=!1},1.5*r.fadeDuration)}_notifyUnstable(){null!=this._stableNotificationHandle&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null),this._fading.value=!0}updateDecluttererViewState(){this._declutterZoom=this._zoom,this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._offsetFromScreenCenter[0]=0,this._offsetFromScreenCenter[1]=0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/CollisionJob":function(){define(["exports","../../../../../core/libs/gl-matrix-2/factories/mat3f32","./config","./util"],function(e,t,i,r){"use strict";e.CollisionJob=class{constructor(e,n,s,o,a,l){this._symbols=e,this._styleRepository=o,this._zoom=a,this._currentLayerCursor=0,this._currentSymbolCursor=0,this._styleProps=new Map,this._allNeededMatrices=new Map,this._gridIndex=new r.GridIndex(n,s,i.collisionGridCellSize),this._si=Math.sin(Math.PI*l/180),this._co=Math.cos(Math.PI*l/180),o.cachedStyles&&(this._styleProps=o.cachedStyles);for(const i of e)for(const e of i.symbols)this._allNeededMatrices.has(e.tile)||this._allNeededMatrices.set(e.tile,t.clone(e.tile.transforms.tileUnitsToPixels))}work(e){const t=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const i=this._symbols[this._currentLayerCursor],r=this._getProperties(i.styleLayerUID),n=this._styleRepository.layerContexts?.get(i.styleLayerUID);for(;this._currentSymbolCursor<i.symbols.length;this._currentSymbolCursor++){if(this._currentSymbolCursor%100==99&&performance.now()-t>e)return!1;const s=i.symbols[this._currentSymbolCursor];if(!s.uniqueSymbol?.show)continue;const o=this._computeCoordinates(s,r,n),a=s.uniqueSymbol;if(!a.show)continue;const{iconAllowOverlap:l,textAllowOverlap:c}=r;for(const e of o){if(!e.enabled)continue;const t=a.parts[e.partIndex];t.show&&!(e.partIndex?c:l)&&this._doesCollide(e)&&(e.hard?a.show=!1:t.show=!1)}a.show&&this._insertColliders(a.parts,o,r)}}return!0}_insertColliders(e,t,i){const{iconIgnorePlacement:r,textIgnorePlacement:n}=i;for(const i of t){if(!i.enabled)continue;if(i.partIndex?n:r)continue;if(!e[i.partIndex].show)continue;const t=i.xScreen+i.dxScreen,s=i.yScreen+i.dyScreen,o=t+i.width,a=s+i.height,[l,c,u,h]=this._gridIndex.getCellSpan(t,s,o,a);for(let e=c;e<=h;e++)for(let t=l;t<=u;t++)this._gridIndex.cells[e][t].push(i)}}_computeCoordinates(e,t,i){const{iconRotationAlignment:r,textRotationAlignment:n,iconTranslate:s,iconTranslateAnchor:o,textTranslate:a,textTranslateAnchor:l}=t,c=this._si,u=this._co,h=this._zoom,d=this._allNeededMatrices.get(e.tile),f=e.uniqueSymbol,p=e.colliders(i);let m=0;for(const e of p){const[t,i]=0===e.partIndex?s:a,f=0===e.partIndex?o:l,p=e.minLod<=h&&h<=e.maxLod;m+=p?0:1,e.enabled=p,e.xScreen=e.xTile*d[0]+e.yTile*d[3]+d[6],e.yScreen=e.xTile*d[1]+e.yTile*d[4]+d[7],0===f?(e.xScreen+=u*t-c*i,e.yScreen+=c*t+u*i):(e.xScreen+=t,e.yScreen+=i),1===(0===e.partIndex?r:n)?(e.dxScreen=e.dxPixels,e.dyScreen=e.dyPixels):(e.dxScreen=u*(e.dxPixels+e.width/2)-c*(e.dyPixels+e.height/2)-e.width/2,e.dyScreen=c*(e.dxPixels+e.width/2)+u*(e.dyPixels+e.height/2)-e.height/2)}return p.length>0&&m===p.length&&f&&(f.show=!1),p}_getProperties(e){const t=this._styleProps.get(e);if(t)return t;const i=this._styleRepository.getLayerStyleProperties?.(e,this._zoom);return this._styleProps.set(e,i),i}_doesCollide(e){const t=e.xScreen+e.dxScreen,i=e.yScreen+e.dyScreen,r=t+e.width,n=i+e.height,[s,o,a,l]=this._gridIndex.getCellSpan(t,i,r,n);for(let c=o;c<=l;c++)for(let o=s;o<=a;o++){const s=this._gridIndex.cells[c][o];for(const o of s){if(null!=o.labelId&&null!=e.labelId&&o.labelId===e.labelId)continue;const s=o.xScreen+o.dxScreen,a=o.yScreen+o.dyScreen,l=s+o.width,c=a+o.height;if(!(r<s||t>l||n<a||i>c))return!0}}return!1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../GeometryUtils","./core"],function(e,t,i){"use strict";function r(e,t,i,r,n,s){const o=i-n;if(o>=0)return(t>>o)+(r-(s<<o))*(e>>o);const a=-o;return t-(s-(r<<a))*(e>>a)<<a}function n(e,t,i,r,n){const s=e.layerData.get(n);if(3===s.type){for(const t of r){const r=t.uniqueSymbol;let n;if(t.selectedForRendering){const t=r.parts[0],s=t.startOpacity,o=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===o;const a=i?Math.floor(127*s)|o<<7:o?255:0;n=a<<24|a<<16|a<<8|a}else n=0;for(const[e,i]of t.iconVertexRanges)for(let t=e;t<e+i;t+=4)s.iconOpacity[t/4]=n;if(t.selectedForRendering){const t=r.parts[1],s=t.startOpacity,o=t.targetOpacity;e.allSymbolsFadingOut=e.allSymbolsFadingOut&&0===o;const a=i?Math.floor(127*s)|o<<7:o?255:0;n=a<<24|a<<16|a<<8|a}else n=0;for(const[e,i]of t.textVertexRanges)for(let t=e;t<e+i;t+=4)s.textOpacity[t/4]=n}s.lastOpacityUpdate=t,s.opacityChanged=!0}}e.GridIndex=class{constructor(e,t,i){this._rows=Math.ceil(t/i),this._columns=Math.ceil(e/i),this._cellSize=i,this.cells=new Array(this._rows);for(let e=0;e<this._rows;e++){this.cells[e]=new Array(this._columns);for(let t=0;t<this._columns;t++)this.cells[e][t]=[]}}getCell(e,t){const i=Math.min(Math.max(Math.floor(t/this._cellSize),0),this._rows-1),r=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[i]&&this.cells[i][r]||null}getCellSpan(e,t,i,r){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(t/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(i/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(r/this._cellSize),0),this.rows-1)]}get cellSize(){return this._cellSize}get columns(){return this._columns}get rows(){return this._rows}},e.deserializeSymbols=function(e,t,r,n,s,o,a){const l=t[n++];for(let c=0;c<l;c++){const l=new i.VTLSymbol(o,a);l.xTile=t[n++],l.yTile=t[n++],l.hash=t[n++],l.priority=t[n++],l.featureIndex=t[n++];const c=t[n++],u=l.colliders();for(let e=0;e<c;e++){const e=t[n++],i=t[n++],s=t[n++],o=t[n++],a=!!t[n++],l=t[n++],c=r[n++],h=r[n++],d=t[n++],f=t[n++];u.push({xTile:e,yTile:i,dxPixels:s,dyPixels:o,hard:a,partIndex:l,width:d,height:f,minLod:c,maxLod:h})}const h=e[n++];for(let t=0;t<h;t++)l.textVertexRanges.push([e[n++],e[n++]]);const d=e[n++];for(let t=0;t<d;t++)l.iconVertexRanges.push([e[n++],e[n++]]);s.push(l)}return n},e.isSearchCircleOverlapingSymbol=function(e,i,r,n){const s=e.colliders();let o,a,l,c;for(const u of s)if(e.uniqueSymbol?.show&&e.uniqueSymbol.parts[u.partIndex].show&&(o=u.xScreen-n[0]+u.dxScreen,a=u.yScreen-n[1]+u.dyScreen,l=o+u.width,c=a+u.height,t.isCircleOverlapingRect(r,i.x,i.y,o,a,l,c)))return!0;return!1},e.tileCoordChangeX=function(e,t,i,n){return r(e,t,i.level,i.col,n.key.level,n.key.col)},e.tileCoordChangeY=function(e,t,i,n){return r(e,t,i.level,i.row,n.level,n.row)},e.writeOpacityToBuffers=function(e,t,i){for(const[r,s]of e.symbols)n(e,t,i,s,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(e){"use strict";e.UniqueSymbol=class{constructor(e){this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}],this.show=!1,this.lastShow=!1,this.tileSymbols=[e],this.id=e.id}},e.VTLSymbol=class{constructor(e,t){this.sourceTile=t,this.xTile=0,this.yTile=0,this.hash=0,this.priority=1,this.featureIndex=0,this.uniqueSymbol=null,this._colliders=[],this.textVertexRanges=[],this.iconVertexRanges=[],this.tile=e}colliders(){return this._colliders}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","../VectorTile","./config","../../webgl/definitions"],function(e,t,i,r){"use strict";function n(e){return(e.uniqueSymbol?.show&&e.uniqueSymbol?.lastShow)??!1}function s(e,t){if(e.priority-t.priority)return e.priority-t.priority;if(n(e)&&!n(t))return-1;if(n(t)&&!n(e))return 1;const i=e.tile.key,r=t.tile.key;return i.world-r.world?i.world-r.world:i.level-r.level?i.level-r.level:i.row-r.row?i.row-r.row:i.col-r.col?i.col-r.col:e.xTile-t.xTile?e.xTile-t.xTile:e.yTile-t.yTile}function o(e,t){for(const r of e){const e=r.uniqueSymbol;for(const r of e.parts){const n=r.targetOpacity>.5?1:-1;r.startOpacity+=n*((t-r.startTime)/i.fadeDuration),r.startOpacity=Math.min(Math.max(r.startOpacity,0),1),r.startTime=t,r.targetOpacity=e.show&&r.show?1:0}}}function a(e){let t=null,i=null,r=null;for(const n of e.tileSymbols){const e=n.tile;e.isReady&&e.isCoverage?t=n:e.isReady?i=n:e.rendering&&(r=n)}return t??i??r}function l(e){let t=null,i=!1,r=!1;for(const n of e.tileSymbols)if(!r||!i){const e=n.tile;(!t||e.isCoverage||e.neededForCoverage&&!i)&&(t=n,(e.neededForCoverage||e.isCoverage)&&(r=!0),e.isCoverage&&(i=!0))}return r?t:null}e.SymbolDeclutterer=class{get running(){return this._running}constructor(e,t,i,r,n,s,o,a){this.selectionMode=e,this._visibleTiles=t,this._symbolRepository=i,this._styleRepository=r,this._createCollisionJob=n,this._assignTileSymbolsOpacity=s,this._symbolLayerSorter=o,this._isLayerVisible=a,this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}setScreenSize(e,t){this._screenWidth===e&&this._screenHeight===t||this.restart(),this._screenWidth=e,this._screenHeight=t}restart(){this._selectionJob=null,this._selectionJobCompleted=!1,this._collisionJob=null,this._collisionJobCompleted=!1,this._opacityJob=null,this._opacityJobCompleted=!1,this._running=!0}continue(e){if(this._selectionJob||(this._selectionJob=this._createSelectionJob()),!this._selectionJobCompleted){const t=performance.now();if(!this._selectionJob.work(e))return!1;if(this._selectionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight)),!this._collisionJobCompleted){const t=performance.now();if(!this._collisionJob.work(e))return!1;if(this._collisionJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}if(this._opacityJob||(this._opacityJob=this._createOpacityJob()),!this._opacityJobCompleted){const t=performance.now();if(!this._opacityJob.work(e))return!1;if(this._opacityJobCompleted=!0,0===(e=Math.max(0,e-(performance.now()-t))))return!1}return this._running=!1,!0}_isFeatureFiltered(e,t,i){const n=t.getFilterFlags(e),s=n&r.filterFlag0,o=null==i.featureEffect||i.featureEffect.excludedLabelsVisible||n&r.effectFlag0;return!(s&&o)}_getFilteredByLayer(){let e;if(this._styleRepository?.layerContexts)for(const t of this._symbolRepository.uniqueSymbols){const i=this._styleRepository.layerContexts?.get(t.styleLayerUID);if(i?.attributeView)for(const r of t.uniqueSymbols){e??=new Map,e.get(t.styleLayerUID)||e.set(t.styleLayerUID,new Set);const n=e.get(t.styleLayerUID),s=i.attributeView,o=i.layerView;this._isFeatureFiltered(r.id,s,o)&&n.add(r.id)}}return e}_resetSelection(){for(let e=0;e<this._symbolRepository.uniqueSymbols.length;e++){const t=this._symbolRepository.uniqueSymbols[e];for(let e=0;e<t.uniqueSymbols.length;e++){const i=t.uniqueSymbols[e];for(const e of i.tileSymbols)e.selectedForRendering=!1}}}_createSelectionJob(){const e="feature-tile"===this.selectionMode?a:l,t=this._symbolRepository.uniqueSymbols;this._resetSelection();const i=[];let r=0,n=0;const o=this._isLayerVisible,c=this._getFilteredByLayer(),u=this._styleRepository?.layerContexts,h=this._symbolLayerSorter;return{work:function(a){let l;const h=performance.now();for(;n<t.length;n++,r=0){const s=t[n],d=s.styleLayerUID,f=c?.get(d);let p=0;if(u){const e=u.get(d).layerView;p=e.view.allLayerViews.items.indexOf(e)}if(!o(d)){i[n]||(i[n]={styleLayerUID:d,layerOrder:p,symbols:[]});continue}i[n]||={styleLayerUID:d,symbols:[],layerOrder:p};const m=i[n];for(;r<s.uniqueSymbols.length;r++){if(l=s.uniqueSymbols[r],r%100==99&&performance.now()-h>a)return!1;if(l.lastShow=l.show,l.id&&f?.has(l.id)){l.show=!1,l.parts[0].show=!1,l.parts[1].show=!1;continue}const t=e(l);if(t){t.selectedForRendering=!0,m.symbols.push(t),l.show=!0;for(const e of l.parts)e.show=!0}else l.show=!1}}for(const e of i)e.symbols.sort(s);return i.sort((e,t)=>t.layerOrder-e.layerOrder),!0},get sortedSymbols(){return i.sort(h)}}}_createOpacityJob(){const e=this._assignTileSymbolsOpacity,i=this._visibleTiles;let r=0;function n(t,i){for(const e of t.symbols.values())o(e,i);e(t,i);for(const e of t.childrenTiles)n(e,i)}return{work(s){const o=performance.now();for(;r<i.length;r++){if(performance.now()-o>s)return!1;const a=i[r];if(null!=a.parentTile)continue;const l=performance.now();a instanceof t.VectorTile?n(a,l):e(a,l)}return!0}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define(["exports","../../../../core/has","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","./constants","./RenderBucket","./decluttering/config","../webgl/TiledDisplayObject"],function(e,t,i,r,n,s,o,a){"use strict";class l extends a.TiledDisplayObject{constructor(e,t,i,r,s,o,a,l=null){super(e,t,i,r,s,o,n.tileCoordSize,n.tileCoordSize),this.styleRepository=a,this._owner=l,this.type="vector-tile",this._referenced=1,this._hasSymbolBuckets=!1,this._usedMemory=256,this.layerData=new Map,this.status="loading",this.allSymbolsFadingOut=!1,this.lastOpacityUpdate=0,this.symbols=new Map,this.isCoverage=!1,this.neededForCoverage=!1,this.decluttered=!1,this.parentTile=null,this.childrenTiles=new Set,this.featureIndex=null,this.triangleCount=0,this._processed=!1,this.id=e.id}get styleLayerUIDs(){return Array.from(this.layerData.keys())}get hasSymbolBuckets(){return this._hasSymbolBuckets}get isFading(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<o.fadeDuration}get isHoldingForFade(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<o.fadeDuration)}get wasRequested(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}setData(e){this.changeDataImpl(e),this.requestRender(),this.ready(),this._processed=!0}deleteLayerData(e){let t=!1;for(const i of e){const e=this.layerData.get(i);e&&(this._usedMemory-=e.usedMemory,3===e.type&&this.symbols.delete(i)&&(t=!0),e.destroy(),this.layerData.delete(i))}this._owner?.updateTileSize(this),t&&(this.featureIndex?.clear(),this.emit("symbols-changed")),this.requestRender()}processed(){return this._processed}hasData(){return this.layerData.size>0}hasFeatures(){const e=this.layerData.values();for(const t of e)if(t.hasData())return!0;return!1}dispose(){"unloaded"!==this.status&&(l._destroyRenderBuckets(this.layerData),this.layerData.clear(),this.featureIndex=null,this._usedMemory=0,this.destroy(),this.status="unloaded")}release(){0===--this._referenced&&(this._owner?.onDisposeTile(this),this.dispose(),this.stage=null)}retain(){++this._referenced}get cachedMemory(){return this._usedMemory}get usedMemory(){return this._usedMemory}get usedMemoryPerReference(){return this._usedMemory/(this._referenced||1)}changeDataImpl(e){this.featureIndex?.clear();let t=!1;if(e){const{bucketsWithData:i,emptyBuckets:r}=e,n=this._createRenderBuckets(i);if(r&&r.byteLength>0){const e=new Uint32Array(r);for(const t of e)this._deleteLayerData(t)}for(const[e,i]of n)this._deleteLayerData(e),3===i.type&&(this.symbols.set(e,i.symbols),t=!0),this._usedMemory+=i.usedMemory,this.layerData.set(e,i);this._owner?.updateTileSize(this)}this._hasSymbolBuckets=!1;for(const e of this.layerData.values())3===e.type&&(this._hasSymbolBuckets=!0);t&&this.emit("symbols-changed")}attachWithContext(e){this.stage={context:e,trashDisplayObject(e){e.processDetach()},untrashDisplayObject:()=>!1}}setTransform(e){super.setTransform(e);const t=this.resolution/(e.resolution*e.pixelRatio),r=this.width/this.rangeX*t,n=this.height/this.rangeY*t,s=[0,0];e.toScreen(s,[this.x,this.y]);const o=this.transforms.tileUnitsToPixels;i.identity(o),i.translate(o,o,s),i.rotate(o,o,Math.PI*e.rotation/180),i.scale(o,o,[r,n,1])}_createTransforms(){return{displayViewScreenMat3:r.create(),tileMat3:r.create(),tileUnitsToPixels:r.create()}}static _destroyRenderBuckets(e){if(!e)return;const t=new Set;for(const i of e.values())t.has(i)||(i.destroy(),t.add(i));e.clear()}_createRenderBuckets(e){const t=new Map,i=new Map;for(const r of e){const e=this._deserializeBucket(r,i);for(const i of e.layerUIDs)t.set(i,e)}return t}_deserializeBucket(e,t){let i=t.get(e);if(i)return i;switch(new Uint32Array(e)[0]){case 1:i=new s.FillRenderBucket(e,this.styleRepository);break;case 2:i=new s.LineRenderBucket(e,this.styleRepository);break;case 3:i=new s.SymbolRenderBucket(e,this.styleRepository,this);break;case 4:i=new s.CircleRenderBucket(e,this.styleRepository)}return t.set(e,i),i}_deleteLayerData(e){if(!this.layerData.has(e))return;const t=this.layerData.get(e);this._usedMemory-=t.usedMemory,t.destroy(),this.layerData.delete(e)}}e.VectorTile=l,e.tracer=null,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/constants":function(){define(["exports"],function(e){"use strict";e.tileCoordSize=4096,e.tileCoordinateScale=.125,e.tilePixelRatio=8,e.tilePixelSize=512,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define(["exports","../../../../core/maybe","../../../../core/memoryEstimations","../../tiling/TileInfoView","../../tiling/TileKey","../../tiling/TileQueue","../../tiling/TileStrategy","./decluttering/util","../../../webgl/BufferObject","../../../webgl/VertexArrayObject","../../../webgl/VertexBuffer"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";class h{constructor(e,t){this.layerUIDs=[],this.isDestroyed=!1,this._data=e;let i=1;const r=new Uint32Array(e);this.layerUIDs=[];const n=r[i++];for(let e=0;e<n;e++)this.layerUIDs[e]=r[i++];this.bufferDataOffset=i,t&&(this.layer=t.getStyleLayerByUID(this.layerUIDs[0]))}get isPreparedForRendering(){return null==this._data}get offset(){return this.bufferDataOffset}get data(){return this._data}destroy(){this.isDestroyed||(this.doDestroy(),this._data=null,this.isDestroyed=!0)}prepareForRendering(e){null!=this._data&&(this.doPrepareForRendering(e,this._data,this.bufferDataOffset),this._data=null)}}e.CircleRenderBucket=class extends h{constructor(e,t){super(e,t),this.type=4,this.circleIndexStart=0,this.circleIndexCount=0;const i=new Uint32Array(e);let r=this.bufferDataOffset;this.circleIndexStart=i[r++],this.circleIndexCount=i[r++],this.bufferDataOffset=r}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.cachedMemory??0)}hasData(){return this.circleIndexCount>0}triangleCount(){return this.circleIndexCount/3}doDestroy(){this.vao=t.disposeMaybe(this.vao)}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),n=new Int32Array(r.buffer),s=r[i++],o=this.layer.circleMaterial,a=new u.VertexBuffer(e,o.geometryLayout,new Int32Array(n.buffer,4*i,s));i+=s;const h=r[i++],d=l.BufferObject.createIndex(e,35044,new Uint32Array(r.buffer,4*i,h));i+=h,this.vao=new c.VertexArrayObject(e,a,d)}},e.FillRenderBucket=class extends h{constructor(e,t){super(e,t),this.type=1,this.fillIndexStart=0,this.fillIndexCount=0,this.outlineIndexStart=0,this.outlineIndexCount=0;const i=new Uint32Array(e);let r=this.bufferDataOffset;this.fillIndexStart=i[r++],this.fillIndexCount=i[r++],this.outlineIndexStart=i[r++],this.outlineIndexCount=i[r++];const n=i[r++];if(n>0){this.patternMap=new Map;for(let e=0;e<n;e++){const e=i[r++],t=i[r++],n=i[r++];this.patternMap.set(e,[t,n])}}this.bufferDataOffset=r}get usedMemory(){return(this.data?.byteLength??0)+(this.fillVAO?.cachedMemory??0)+(this.outlineVAO?.cachedMemory??0)}hasData(){return this.fillIndexCount>0||this.outlineIndexCount>0}triangleCount(){return(this.fillIndexCount+this.outlineIndexCount)/3}doDestroy(){this.fillVAO=t.disposeMaybe(this.fillVAO),this.outlineVAO=t.disposeMaybe(this.outlineVAO)}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),n=new Int32Array(r.buffer),s=r[i++],o=this.layer,a=o.fillMaterial,h=new u.VertexBuffer(e,a.geometryLayout,new Int32Array(n.buffer,4*i,s));i+=s;const d=r[i++],f=l.BufferObject.createIndex(e,35044,new Uint32Array(r.buffer,4*i,d));i+=d;const p=r[i++],m=o.outlineMaterial,g=new u.VertexBuffer(e,m.geometryLayout,new Int32Array(n.buffer,4*i,p));i+=p;const _=r[i++],y=l.BufferObject.createIndex(e,35044,new Uint32Array(r.buffer,4*i,_));i+=_,this.fillVAO=new c.VertexArrayObject(e,h,f),this.outlineVAO=new c.VertexArrayObject(e,g,y)}},e.LineRenderBucket=class extends h{constructor(e,t){super(e,t),this.type=2,this.lineIndexStart=0,this.lineIndexCount=0;const i=new Uint32Array(e);let r=this.bufferDataOffset;this.lineIndexStart=i[r++],this.lineIndexCount=i[r++];const n=i[r++];if(n>0){this.patternMap=new Map;for(let e=0;e<n;e++){const e=i[r++],t=i[r++],n=i[r++];this.patternMap.set(e,[t,n])}}this.bufferDataOffset=r}get usedMemory(){return(this.data?.byteLength??0)+(this.vao?.cachedMemory??0)}hasData(){return this.lineIndexCount>0}triangleCount(){return this.lineIndexCount/3}doDestroy(){this.vao=t.disposeMaybe(this.vao)}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),n=new Int32Array(r.buffer),s=r[i++],o=this.layer.lineMaterial,a=new u.VertexBuffer(e,o.geometryLayout,new Int32Array(n.buffer,4*i,s));i+=s;const h=r[i++],d=l.BufferObject.createIndex(e,35044,new Uint32Array(r.buffer,4*i,h));i+=h,this.vao=new c.VertexArrayObject(e,a,d)}},e.RenderBucketBase=h,e.SymbolRenderBucket=class extends h{constructor(e,t,i){super(e,t),this.type=3,this.iconPerPageElementsMap=new Map,this.glyphPerPageElementsMap=new Map,this.symbolInstances=[],this.isIconSDF=!1,this.opacityChanged=!1,this.lastOpacityUpdate=0,this.symbols=[];const r=new Uint32Array(e),s=new Int32Array(e),o=new Float32Array(e);let l=this.bufferDataOffset;this.isIconSDF=!!r[l++];const c=r[l++],u=r[l++],h=r[l++],d=new n(c,u,h,0),f=r[l++];for(let e=0;e<f;e++){const e=r[l++],t=r[l++],i=r[l++];this.iconPerPageElementsMap.set(e,[t,i])}const p=r[l++];for(let e=0;e<p;e++){const e=r[l++],t=r[l++],i=r[l++];this.glyphPerPageElementsMap.set(e,[t,i])}const m=r[l++],g=r[l++];this.iconOpacity=new Int32Array(m),this.textOpacity=new Int32Array(g),l=a.deserializeSymbols(r,s,o,l,this.symbols,i,d),this.bufferDataOffset=l}get usedMemory(){return(this.data?.byteLength??0)+(this.iconVAO?.cachedMemory??0)+(this.textVAO?.cachedMemory??0)+i.estimateNumberArrayMemory(this.iconOpacity)+i.estimateNumberArrayMemory(this.textOpacity)}hasData(){return this.iconPerPageElementsMap.size>0||this.glyphPerPageElementsMap.size>0}triangleCount(){let e=0;for(const t of this.iconPerPageElementsMap.values())e+=t[1];for(const t of this.glyphPerPageElementsMap.values())e+=t[1];return e/3}doDestroy(){this.iconVAO=t.disposeMaybe(this.iconVAO),this.textVAO=t.disposeMaybe(this.textVAO)}updateOpacityInfo(){if(!this.opacityChanged)return;this.opacityChanged=!1;const e=this.iconOpacity,t=this.iconVAO.buffer("opacity");e.length>0&&e.byteLength===t.usedMemory&&t.setSubData(e,0,0,e.length);const i=this.textOpacity,r=this.textVAO.buffer("opacity");i.length>0&&i.byteLength===r.usedMemory&&r.setSubData(i,0,0,i.length)}doPrepareForRendering(e,t,i){const r=new Uint32Array(t),n=new Int32Array(r.buffer),s=r[i++],o=this.layer,a=o.iconMaterial,h=new u.VertexBuffer(e,a.geometryLayout,new Int32Array(n.buffer,4*i,s));i+=s;const d=r[i++],f=l.BufferObject.createIndex(e,35044,new Uint32Array(r.buffer,4*i,d));i+=d;const p=r[i++],m=o.textMaterial,g=new u.VertexBuffer(e,m.geometryLayout,new Int32Array(n.buffer,4*i,p));i+=p;const _=r[i++],y=l.BufferObject.createIndex(e,35044,new Uint32Array(r.buffer,4*i,_));i+=_;const x=new u.VertexBuffer(e,a.opacityLayout,this.iconOpacity.buffer),b=new u.VertexBuffer(e,m.opacityLayout,this.textOpacity.buffer);this.iconVAO=new c.VertexArrayObject(e,new Map([["geometry",h],["opacity",x]]),f),this.textVAO=new c.VertexArrayObject(e,new Map([["geometry",g],["opacity",b]]),y)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","./core","./util"],function(e,t,i){"use strict";class r{static fromSymbols(e,t){let a=e.length;if(a>=n){let n=t;do{n/=2,a/=4}while(a>s&&n>o);const l=new i.GridIndex(t,t,n);for(const t of e)l.getCell(t.xTile,t.yTile).push(t);return new r(t,e,l)}return new r(t,e,null)}constructor(e,t,i){this.tileCoordRange=e,this._symbols=t,this._index=i}addSymbols(e){for(const t of e)this._symbols.push(t);if(this._index)for(const t of e)this._index.getCell(t.xTile,t.yTile).push(t)}removeSymbols(e){const t=new Set(e);if(this._symbols=this._symbols.filter(e=>!t.has(e)),this._index)for(const e of this._index.cells)for(let i=0;i<e.length;i++)e[i]=e[i].filter(e=>!t.has(e))}getSymbols(){return this._symbols}getCandidate(e,t,i,r){if(!this._index){for(const n of this._symbols)if(i===n.hash&&Math.abs(e-n.xTile)<=r&&Math.abs(t-n.yTile)<=r)return n;return null}const n=this._index.getCellSpan(e-r,t-r,e+r,t+r),[s,o,a,l]=n;for(let n=o;n<=l;n++)for(let o=s;o<=a;o++){const s=this._index.cells[n][o];for(const n of s)if(i===n.hash&&Math.abs(e-n.xTile)<=r&&Math.abs(t-n.yTile)<=r)return n}return null}}const n=32,s=8,o=64;function a(e){const t=new Map;for(const i of e){const e=i.labelClassId;let r=t.get(e);r||(r=[],t.set(e,r)),r.push(i)}return t}e.SymbolRepository=class{constructor(e,t){this.tileCoordRange=e,this._visibleTiles=t,this._indexMapByTile=new Map,this._uniqueSymbolsByStyleLayerId=new Map}get uniqueSymbols(){return null==this._uniqueSymbolLayerArray&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray()),this._uniqueSymbolLayerArray}registerVectorTile(e,t){const i=this._ensureIndexMap(e),r=t?.values()??i.keys();for(const e of r){const t=i.get(e);t&&(this._removeSymbols(e,t.getSymbols()),i.delete(e))}this._addSymbols(e.key,i,e.symbols),this._invalidate()}unregisterVectorTile(e){this._removeTile(e),this._invalidate()}registerFeatureTile(e){this._ensureIndexMap(e),this._invalidate()}unregisterFeatureTile(e){this._removeTile(e),this._invalidate()}insertFeatureTileMetrics(e,t){const i=this._indexMapByTile.get(e);if(!i)throw new Error(`tile ${e.id} not registered!`);this._addSymbols(e.key,i,a(t)),this._invalidate()}removeFeatureTileMetrics(e,t){const i=this._indexMapByTile.get(e);if(!i)return;const r=a(t);for(const[e,t]of i.entries()){const i=r.get(e);i&&(t.removeSymbols(i),this._removeSymbols(e,i))}this._invalidate()}deleteStyleLayers(e){for(const t of this._indexMapByTile.values())for(const i of e){const e=t.get(i);e&&(this._removeSymbols(i,e.getSymbols()),t.delete(i))}this._invalidate()}querySymbols(e,t,r,n){const s=[];for(const[n,o]of this._uniqueSymbolsByStyleLayerId.entries())for(const a of o){const o=a.tileSymbols.find(e=>e.selectedForRendering);o&&i.isSearchCircleOverlapingSymbol(o,e,t*(window.devicePixelRatio||1),r)&&s.push({vtlSymbol:o,styleLayerUID:n,tileKey:o.tile.key})}return s}_ensureIndexMap(e){let t=this._indexMapByTile.get(e);return t||(t=new Map,this._indexMapByTile.set(e,t)),t}_invalidate(){this._uniqueSymbolLayerArray=null}_addSymbols(e,t,i){for(const[e,n]of i){let i=t.get(e);i?i.addSymbols(n):(i=r.fromSymbols(n,this.tileCoordRange),t.set(e,i))}this._updateUniqueSymbols(e,i)}_removeTile(e){const t=this._indexMapByTile.get(e);if(t){for(const[e,i]of t.entries())this._removeSymbols(e,i.getSymbols());this._indexMapByTile.delete(e),this._invalidate()}}_removeSymbols(e,t){for(const i of t){const t=i.uniqueSymbol;if(t){if(t.tileSymbols=t.tileSymbols.filter(e=>e!==i),0===t.tileSymbols.length){const i=this._uniqueSymbolsByStyleLayerId.get(e);i.delete(t),0===i.size&&this._uniqueSymbolsByStyleLayerId.delete(e)}i.uniqueSymbol=null}}}_updateUniqueSymbols(e,i){if(0!==i.size){for(const t of this._visibleTiles)t.parentTile||t.key.world!==e.world||t.key.level===e.level&&!t.key.equals(e)||this._matchSymbols(t,e,i);for(const[e,r]of i)for(const i of r)if(!i.uniqueSymbol){i.uniqueSymbol=new t.UniqueSymbol(i);let r=this._uniqueSymbolsByStyleLayerId.get(e);r||(r=new Set,this._uniqueSymbolsByStyleLayerId.set(e,r)),r.add(i.uniqueSymbol)}}}_matchSymbols(e,t,r){if(e.key.level>t.level){const i=e.key.level-t.level;if(e.key.row>>i!==t.row||e.key.col>>i!==t.col)return}if(t.level>e.key.level){const i=t.level-e.key.level;if(t.row>>i!==e.key.row||t.col>>i!==e.key.col)return}const n=new Map;for(const[s,o]of r){const r=[],a=20+(e.key.level<t.level?1:1<<e.key.level-t.level),l=this._indexMapByTile.get(e),c=l?.get(s);if(c)for(const n of o){if(n.uniqueSymbol)continue;const s=i.tileCoordChangeX(this.tileCoordRange,n.xTile,t,e.key),o=i.tileCoordChangeY(this.tileCoordRange,n.yTile,t,e.key),l=-20,u=this.tileCoordRange+20;if(!(s>=l&&s<u&&o>=l&&o<u)){r.push(n);continue}const h=c.getCandidate(s,o,n.hash,a),d=h?.uniqueSymbol;d?(n.uniqueSymbol=d,d.tileSymbols.push(n)):r.push(n)}r.length>0&&n.set(s,r)}for(const i of e.childrenTiles||[])this._matchSymbols(i,t,n)}_createUniqueSymbolLayerArray(){const e=this._uniqueSymbolsByStyleLayerId,t=new Array(e.size);let i,r=0;for(const[n,s]of e){const e=new Array(s.size);i=0;for(const t of s)e[i++]=t;t[r]={styleLayerUID:n,uniqueSymbols:e},r++}return t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicsView2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/arrayUtils","../../../../core/has","../../../../core/Identifiable","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/Logger","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/jsonUtils","../../../../layers/support/FieldsIndex","../../../../symbols/cim/CIMSymbolHelper","../../../../symbols/cim/OverrideHelper","../../../../symbols/support/defaults","../../engine/webgl/definitions","../../engine/webgl/FeatureTile","../../engine/webgl/mesh/MeshData","../../engine/webgl/mesh/factories/ResourceProxy","../../engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas","../features/schema/processor/StorageSchema","../features/support/AttributeStore","../features/support/ComputedAttributeStorage","../features/support/FeatureMetadata","../features/support/GraphicsReader","./GraphicStore","../support/FeatureCommandQueue","../support/UpdateTracking2D"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_,y,x,b,v,S,w,T,M,P,I,C,F,O){"use strict";class A{static getOrCreate(e,t,i){let r=t.get(e.id);return r||(r=new A(e,i),t.set(e.id,r)),r}static fromItems(e,t,i){const r=new A(e,i);for(const e of t)r.append(e);return r}constructor(e,t){this.tile=e,this.metadata=t,this.addedOrModified=[],this.removed=[],this.objectIdMap=null}get reader(){return this._reader||(this._reader=I.GraphicsReader.from(this.addedOrModified,this.tile,this.metadata)),this._reader}append(e){this.addedOrModified.push(e),e.hasAnimations&&(this.objectIdMap=this.objectIdMap||{},this.objectIdMap[e.displayId]=e.objectId)}}return e.default=class extends(s.IdentifiableMixin(i)){constructor(e){super(e),this._attached=!1,this._tiles=new Map,this._controller=new AbortController,this._hashToSymbolInfo=new Map,this._lastCleanup=performance.now(),this._cleanupRequired=!0,this.lastUpdateId=-1,this.renderer=null,this._updateTracking=new O.UpdateTracking2D({debugName:"GraphicsView2D"}),this.updateRequested=!1,this.defaultPointSymbolEnabled=!0,this._commandQueue=new F.FeatureCommandQueue({process:e=>{if("update"===e.type)return this._update();throw new Error("InternalError: Unsupported command")}}),this.graphicUpdateHandler=this.graphicUpdateHandler.bind(this)}destroy(){this.container.destroy(),this.view=null,this.renderer=null,this._set("graphics",null),this._controller.abort(),this._graphicStore.clear(),this._graphicStore.destroy(),this._attributeStore=null,this._hashToSymbolInfo.clear(),this._updateTracking.destroy(),this._commandQueue.destroy()}_initAttributeStore(){this._storage=new M.ComputedAttributeStorage({spatialReference:this.view.spatialReference,fields:new p}),this._attributeStore=new T.AttributeStore({isLocal:!0,update:e=>{n("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateStart`,{message:e}),this.container.attributeView.requestUpdate(e),this.container.requestRender(),n("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView2D.AttributeStoreView.updateEnd`,{message:e})}});const e=w.createStorageSchema(null,[]);this._attributeStore.update(e,this._storage,null),this.container.checkHighlight=()=>this._attributeStore.hasHighlight}initialize(){this._initAttributeStore(),this._metadata=P.GraphicsMetadata.createGraphics(this.view.spatialReference),this._resourceProxy=new v.ResourceProxy({fetch:e=>Promise.all(e.map(e=>this.view.stage.textureManager.rasterizeItem(e))),fetchDictionary:e=>{throw new Error("InternalError: Graphics do not support Dictionary requests")}}),this.addHandles([l.watch(()=>this._effectiveRenderer,()=>this._pushUpdate()),this.view.graphicsTileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",()=>{this.addHandles([this.graphics.on("change",()=>this._pushUpdate())]),this._graphicStore?.destroy(),this._graphicStore=new C(this.view.spatialReference,this._cimResourceManager,this.view.featuresTilingScheme,this.view.state.scale,this._attributeStore),this._attached=!0,this.requestUpdate(),this._pushUpdate()})]),this._updateTracking.addUpdateTracking("CommandQueue",this._commandQueue.updateTracking);const e=this.view.graphicsTileStore.tiles;this._onTileUpdate({added:e,removed:[]})}get _effectiveRenderer(){return"function"==typeof this.renderer?this.renderer():this.renderer}get _cimResourceManager(){return this.view.stage.textureManager.resourceManager}get updating(){const e=!this._attached||this._updateTracking.updating;return n("esri-2d-log-updating")&&console.log(`Updating GraphicsView2D: ${e}\n  -> attaching ${!this._attached}\n  -> updateTracking ${this._updateTracking.updating}`),e}hitTest(e){if(!this.view||this.view.suspended)return[];const{resolution:t,rotation:i}=this.view.state,n=this._graphicStore.hitTest(e.x,e.y,2,t,i),s=new Set(n),o=this.graphics.items.reduce((e,t)=>(s.has(t.uid)&&e.set(t.uid,t),e),new Map);return n.map(e=>o.get(e)).filter(r.isSome)}requestUpdate(){this.updateRequested||(this.updateRequested=!0,this.requestUpdateCallback()),this.notifyChange("updating")}processUpdate(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))}viewChange(){this.requestUpdate()}setHighlight(e){const t=[];for(const{objectId:i,highlightFlags:r}of e){const e=this._graphicStore.getItem(i)?.displayId;t.push({objectId:i,highlightFlags:r,displayId:e})}this._attributeStore.setHighlight(t,e),this._pushUpdate()}graphicUpdateHandler(e){this._pushUpdate()}update(e){this.updateRequested=!1,this._attached&&this._graphicStore.updateLevel(e.state.resolution)&&this.pushUpdate()}pushUpdate(){this._pushUpdate()}_pushUpdate(){a.ignoreAbortErrors(this._commandQueue.push({type:"update"}))}async _update(){try{n("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView._update start`);const e=await this._graphicStore.update(this.graphics,e=>this._getSymbolForGraphic(e),e=>this._ensureSymbolResource(e));for(const t of e.updated)this.container.restartAnimation(t.objectId);if(!e.hasAnyUpdate())return void this._attributeStore.sendUpdates();e.removed.length&&(this._cleanupRequired=!0),n("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView updateMessage`,e);const t=this._createTileMessages(e);await this._densifyItemsForDisplay(t),await this._fetchResources(t),this._write(t);for(const t of e.added)this._setFilterState(t);for(const t of e.updated)this._setFilterState(t);n("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate`,e),this._attributeStore.sendUpdates(),n("esri-2d-update-debug")&&console.debug(`[Id: ${this.layerId}] GraphicsView sendUpdate.await`,e)}catch(e){}this._cleanupSharedResources()}_createTileMessages(e){const t=new Map;for(const i of e.added){const e=this.view.graphicsTileStore.getIntersectingTiles(i.symbolBounds);for(const r of e)A.getOrCreate(r,t,this._metadata).append(i)}for(const i of e.updated){const e=this.view.graphicsTileStore.getIntersectingTiles(i.prevSymbolBounds),r=this.view.graphicsTileStore.getIntersectingTiles(i.symbolBounds);for(const r of e)A.getOrCreate(r,t,this._metadata).removed.push(i.displayId);for(const e of r)A.getOrCreate(e,t,this._metadata).append(i)}for(const i of e.removed){const e=this.view.graphicsTileStore.getIntersectingTiles(i.symbolBounds);for(const r of e)A.getOrCreate(r,t,this._metadata).removed.push(i.displayId)}return Array.from(t.values())}async _densifyItemsForDisplay(e){const t=new Map;for(const i of e)for(const e of i.addedOrModified)t.has(e)||t.set(e,e.densifyCurvedGeometryForDisplay(this.view.spatialReference));await Promise.all(t.values())}async _fetchResources(e){const t={timeZone:null,timeExtent:null};for(const{tile:i,reader:r}of e){n("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${i.id}] GraphicsView fetchResources`,e);const s=r.getCursor();for(;s.next();)for(const e of s.getMeshWriters())e.enqueueRequest(this._resourceProxy,s,i.createArcadeEvaluationOptions(t))}await this._resourceProxy.fetchEnqueuedResources()}_write(e){for(const t of e){n("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${t.tile.id}] GraphicsView write`,t);const e=this._writeMeshes(t);let i=this._tiles.get(t.tile.key);i||(i=this._createFeatureTile(t.tile.key)),n("esri-2d-update-debug")&&console.debug(`Id[${this.layerId}] Tile[${t.tile.id}] GraphicsView onTileData`,t),this.container.onTileData(i,{type:"update",modify:e,remove:t.removed,end:!1,attributeEpoch:this._attributeStore.epoch,objectIdMap:t.objectIdMap}),this.container.requestRender()}}_writeMeshes(e){const t={timeZone:null,timeExtent:null},i=new b.MeshData(e.tile.id),r=e.reader.getCursor();for(;r.next();){i.entityStart(r.getDisplayId(),r.getZOrder());for(const n of r.getMeshWriters())n.write(i,this._resourceProxy,r,e.tile.createArcadeEvaluationOptions(t),e.tile.level);i.entityEnd()}return{...i.serialize().message,tileId:e.tile.id}}_setFilterState(e){const t=e.displayId,i=this._attributeStore.getHighlightFlags(e.objectId);this._attributeStore.setData(t,0,0,i|(e.visible?y.filterFlag0:0))}_getSymbolForGraphic(e){return null!=e.symbol?e.symbol:null!=this._effectiveRenderer?this._effectiveRenderer.getSymbol(e):this._getNullSymbol(e)}async _ensureSymbolResource(e){if(!e.symbol)return;const t=await this._getSymbolInfo(e.symbol);if(!t)return;const i=t.linearCIM.filter(e=>"text"===e.type);if(i.length>0){const r=await this._getTextResources(e,i);return void(e.symbolResource={symbolInfo:t,textInfo:r})}e.symbolResource={symbolInfo:t}}_getSymbolInfo(e){const t=e.hash();return this._hashToSymbolInfo.has(t)||this._hashToSymbolInfo.set(t,this._createSymbolInfo(t,e).catch(e=>null)),this._hashToSymbolInfo.get(t)}async _createSymbolInfo(e,t){const i=await this._convertToCIMSymbol(t),r=await this._createLinearCIM(i);return{hash:e,cimSymbol:i,linearCIM:r,meshWriters:await this._createMeshWriters(i,r)}}async _convertToCIMSymbol(e){const t=m.symbolToCIM(e);return"web-style"===t.type?this._convertToCIMSymbol(await t.fetchSymbol({acceptedFormats:["cim","web"]})):t}async _createLinearCIM(e){return await Promise.all(m.CIMSymbolHelper.fetchResources(e.symbol,this._cimResourceManager,[])),this.view.stage.cimAnalyzer.analyzeSymbolReference(e,!1)}async _createMeshWriters(e,t){a.throwIfAborted(this._controller.signal);const i=this.container.instanceStore,r=this.view.stage.meshWriterRegistry,n=await S.createGraphicSymbolMeshSchemas(e,t,i);return Promise.all(n.map(e=>r.createMeshWriter(this._storage,this._resourceProxy,{tileInfo:this.view.featuresTilingScheme.tileInfo},e,null)))}_onTileUpdate(e){if(e.added&&e.added.length>0)for(const t of e.added)this._updateTracking.addPromise(this._addTile(t));if(e.removed&&e.removed.length>0)for(const t of e.removed)this._removeTile(t.key)}_createFeatureTile(e){const t=this.view.featuresTilingScheme.getTileBounds(d.create(),e),i=this.view.featuresTilingScheme.getTileResolution(e.level),r=new x.FeatureTile(e,i,t[0],t[3]);return this._tiles.set(e,r),this.container.addChild(r),r}async _addTile(e){if(!this._attached)return;const t=this._graphicStore.queryItems(e);if(!t.length)return;const i=this._createFeatureTile(e.key),r=A.fromItems(e,t,this._metadata);await this._densifyItemsForDisplay([r]),await this._fetchResources([r]);const n=this._writeMeshes(r);i.onMessage({type:"append",append:n,clear:!1,end:!0,attributeEpoch:this._attributeStore.epoch,objectIdMap:r.objectIdMap})}_removeTile(e){if(!this._tiles.has(e))return;const t=this._tiles.get(e);this.container.removeChild(t),t.destroy(),this._tiles.delete(e)}_getNullSymbol(e){const t=e.geometry;return t?f.isPolyline(t)?_.errorPolylineSymbol2D:f.isPolygon(t)||f.isExtent(t)?_.errorPolygonSymbol2D:this.defaultPointSymbolEnabled?_.errorPointSymbol2D:null:this.defaultPointSymbolEnabled?_.errorPointSymbol2D:null}async _getTextResources(e,t){const i=new Array,r=new Array;for(let n=0;n<t.length;n++){const s=t[n],{resource:o,overrides:a}=s.textRasterizationParam;if(a?.length>0){const t=g.OverrideHelper.resolveSymbolOverrides({type:"CIMSymbolReference",primitiveOverrides:a,symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,size:o.symbol.height,anchorPointUnits:"Relative",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:o.symbol,textString:o.textString}],scaleSymbolsProportionally:!0,respectFrame:!0}]}},e,this.view.spatialReference,null,f.getJsonType(e.projectedGeometry),null,null);t.then(e=>{const t=e.symbolLayers[0],{textString:i}=t.markerGraphics[0];r.push({type:"cim-rasterization-info",resource:{type:"text",textString:i||"",font:o.font}}),s.text=o.textString=i||""}),i.push(t)}else r.push({type:"cim-rasterization-info",resource:o})}i.length>0&&await Promise.all(i);const n=r.map(e=>this.view.stage.textureManager.rasterizeItem(e)),s=await Promise.all(n);o.assertIsSome(s);const a=new Map;for(let e=0;e<t.length;e++){const i=t[e];a.set(i.textRasterizationParam.resource.symbol,{text:i.text,glyphMosaicItems:s[e]})}return a}_cleanupSharedResources(){if(!this._cleanupRequired)return;const e=performance.now();if(e-this._lastCleanup<5e3)return;this._cleanupRequired=!1,this._lastCleanup=e;const t=new Set;for(const e of this._graphicStore.items()){const i=e.symbolResource?.symbolInfo.hash;t.add(i)}const i=new Set(this._hashToSymbolInfo.keys());for(const e of i.values())t.has(e)||this._hashToSymbolInfo.delete(e)}},t.__decorate([c.property()],e.default.prototype,"_effectiveRenderer",null),t.__decorate([c.property({constructOnly:!0})],e.default.prototype,"layerId",void 0),t.__decorate([c.property({constructOnly:!0})],e.default.prototype,"requestUpdateCallback",void 0),t.__decorate([c.property()],e.default.prototype,"container",void 0),t.__decorate([c.property({constructOnly:!0})],e.default.prototype,"graphics",void 0),t.__decorate([c.property()],e.default.prototype,"renderer",void 0),t.__decorate([c.property()],e.default.prototype,"_updateTracking",void 0),t.__decorate([c.property()],e.default.prototype,"updating",null),t.__decorate([c.property()],e.default.prototype,"view",void 0),t.__decorate([c.property()],e.default.prototype,"updateRequested",void 0),t.__decorate([c.property()],e.default.prototype,"defaultPointSymbolEnabled",void 0),e.default=t.__decorate([h.subclass("esri.views.2d.layers.graphics.GraphicsView2D")],e.default),e.default})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["exports","../DisplayEntity","../DisplayRecord","./VertexDataWriter","../util/Writer"],function(e,t,i,r,n){"use strict";e.MeshData=class{constructor(e,i=0){this._id=e,this._sizeHint=i,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._didEntityStart=!1,this._instanceIdToVertexData=new Map,this._recordIndexStart=0,this._recordIndexCount=0,this._recordVertexStart=0,this._recordVertexCount=0,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new n(Uint32Array,this._sizeHint*t.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const e=new Array,t=[],i=this._entities.buffer();for(const i of this._instanceIdToVertexData.values())t.push(i.serialize(e));return{message:{data:t,entities:i},transferList:e}}vertexStart(){return this._current.vertexStart??0}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(e){this._current.writer.vertexEnsureSize(e)}indexEnsureSize(e){this._current.writer.indexEnsureSize(e)}vertexWrite(e){this._current.writer.writeVertex(e)}vertexWriteRegion(e){this._current.writer.writeVertexRegion(e)}vertexWriteF32(e){this._current.writer.writeVertexF32(e)}recordBounds(e,t,i,r){}indexWrite(e){this._current.writer.writeIndex(e)}metricStart(e){this._current.metric=e,this._current.metric.recordStart=this.recordCount()}metricEnd(){const e=this._current.writer;this._current.metric&&(this._current.metric.recordCount=this.recordCount()-this._current.metric.recordStart),this._current.metric?.bounds.length&&this._current.metric?.recordCount?(e.writeMetric(this._current.metric),this._current.metric=null):this._current.metric=null}metricBoxWrite(e){this._current.metric.bounds.push(e)}entityStart(e,t=e){this._entityIdIndex=this._entities.push(e),this._entitySortKeyIndex=this._entities.writeF32(t),this._entityRecordCountOffset=this._entities.push(0),this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset),this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(e,t,i=0){this._current.writer=this._getVertexWriter(e,t),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=e,this._current.layoutHash=t.hash,this._current.textureKey=i}recordEnd(e=0){const t=this._current.vertexStart,r=this._current.writer.vertexCount-t;if(!r)return!1;const n=this._current.indexStart,s=this._current.writer.indexCount-n;return this._recordIndexStart=n,this._recordIndexCount=s,this._recordVertexStart=t,this._recordVertexCount=r,this._entities.incr(this._entityRecordCountOffset),i.write(this._entities,this._current.instanceId,this._current.textureKey,n,s,t,r,e),!0}copyLast(e,t){const r=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset),i.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,r,this._recordVertexCount,0);const n=this._current.writer.indexWriter,s=this._current.writer.vertexWriter,o=this._recordIndexStart+this._recordIndexCount,a=this._recordVertexCount;for(let e=this._recordIndexStart;e!==o;e++){const t=n.getValue(e);n.push(t+a)}const l=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,c=this._recordVertexStart*l,u=(this._recordVertexStart+this._recordVertexCount)*l;for(let e=c;e!==u;e++){const t=s.getValue(e);s.push(t)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,p=e*d,m=t*d;for(let e=r*l;e<=s.length;e+=l)s.i1616Add(e+f,p,m)}copyLastFrom(e,t,i){const r=e._entities.getValue(e._entityIdIndex);if(r!==this._entities.getValue(this._entityIdIndex)){const t=e._entities.getValueF32(e._entitySortKeyIndex);this.entityStart(r,t)}this.recordStart(e._current.instanceId,e._current.writer.layout,e._current.textureKey);const n=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,s=this._current.vertexStart,o=e._current.vertexStart-s,a=this._current.writer.indexWriter,l=this._current.writer.vertexWriter,c=e._current.writer.indexWriter,u=e._current.writer.vertexWriter;for(let t=e._current.indexStart;t!==c.length;t++){const e=c.getValue(t);a.push(e-o)}for(let t=e._current.vertexStart*n;t!==u.length;t++){const e=u.getValue(t);l.push(e)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,f=h.offset/Uint32Array.BYTES_PER_ELEMENT,p=t*d,m=i*d;for(let e=s*n;e<=l.length;e+=n)l.i1616Add(e+f,p,m);this.recordEnd()}_getVertexWriter(e,t){const i=this._instanceIdToVertexData;return i.has(e)||i.set(e,new r.VertexDataWriter(e,t,this._sizeHint)),i.get(e)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../util/Writer"],function(e,t){"use strict";e.VertexDataWriter=class{constructor(e,i,r=0){const n=6*r*Uint32Array.BYTES_PER_ELEMENT,s=4*r*i.stride,o=i.stride/4,a=i.attributes.find(e=>"pos"===e.name||"position"===e.name);if(!a)throw new Error("InternalError: Unable to find position attribute");this.layout={...i,position:a},this._indices=new t(Uint32Array,n),this._vertices=new t(Uint32Array,s),this._metrics=new t(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=o,this._instanceId=e}serialize(e){const t=this._indices.buffer(),i=this._vertices.buffer(),r=this._metrics.length?this._metrics.buffer():null;return e.push(t,i),{instanceId:this._instanceId,layout:this.layout,indices:t,vertices:i,metrics:r}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(e){this._vertices.ensureSize(e)}indexEnsureSize(e){this._indices.ensureSize(e)}writeIndex(e){this._indices.push(e)}writeVertex(e){this._vertices.push(e)}writeVertexRegion(e){this._vertices.writeRegion(e)}writeVertexF32(e){this._vertices.writeF32(e)}writeMetric(e){this._metrics.incr(this._metricCountOffset),e.serialize(this._metrics)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){"use strict";return class{get length(){return this._pos}constructor(e,t){this._pos=0;const i=t?this._roundToNearest(t,e.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new e(this._array),this._ctor=e,this._i16View=new Int16Array(this._array)}_roundToNearest(e,t){const i=Math.round(e);return 1===t?i:i+(t-i%t)}_ensureSize(e){if(this._pos+e>=this._buffer.length){const t=this._roundToNearest(1.25*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),i=new ArrayBuffer(t),r=new this._ctor(i);r.set(this._buffer,0),this._array=i,this._buffer=r,this._i16View=new Int16Array(this._array)}}ensureSize(e){this._ensureSize(e)}writeF32(e){this._ensureSize(1);const t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}push(e){this._ensureSize(1);const t=this._pos;return this._buffer[this._pos++]=e,t}writeFixed(e){this._buffer[this._pos++]=e}setValue(e,t){this._buffer[e]=t}i1616Add(e,t,i){this._i16View[2*e]+=t,this._i16View[2*e+1]+=i}getValue(e){return this._buffer[e]}getValueF32(e){return new Float32Array(this._array,4*e,1)[0]}incr(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}decr(e){this._buffer[e]--}writeRegion(e){this._ensureSize(e.length);const t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}writeManyFrom(e,t,i){this._ensureSize(i-t);for(let r=t;r!==i;r++)this.writeFixed(e._buffer[r])}buffer(){const e=this._array.slice(0,4*this._pos);return this.destroy(),e}toArray(){return[...this._buffer]}seek(e){this._pos=e}destroy(){this._array=null,this._buffer=null}}})},"esri/views/2d/engine/webgl/mesh/factories/ResourceProxy":function(){define(["exports","../../../../../../core/string","../../urlUtils","../../shaderGraph/techniques/mesh/AResourceProxy"],function(e,t,i,r){"use strict";class n extends r.AResourceProxy{constructor(e){super(),this._fetcher=e,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(e){const r=i.discardUrlIfHasUrlHash(e.resource),n=t.numericHash(JSON.stringify(r));return this._pendingIds.has(n)||(this._pendingIds.add(n),this._pendingRequests.push({...e,resourceId:n})),n}async fetchEnqueuedResources(){const e=this._pendingRequests;if(this._pendingIds.clear(),this._pendingRequests=[],0===e.length)return;const t=await this._fetcher.fetch(e,this._abortOptions);for(let i=0;i<t.length;i++){const r=e[i].resourceId;this._resourceIdToResource.set(r,t[i])}}async fetchResourceImmediate(e){const t=await this._fetcher.fetch([e]);if(1!==t.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return t[0]}async fetchDictionaryResourceImmediate(e){const t=await this._fetcher.fetchDictionary([e]);if(1!==t.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return t[0]}getResource(e){return this._resourceIdToResource.get(e)}}e.ResourceProxy=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AResourceProxy":function(){define(["exports"],function(e){"use strict";e.AResourceProxy=class{},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/createGraphicSymbolMeshSchemas":function(){define(["exports","../../../../layers/features/schema/processor/VisualVariablesSchema","../../../../layers/features/schema/processor/symbols/ComplexSymbolSchema"],function(e,t,i){"use strict";e.createGraphicSymbolMeshSchemas=async function(e,r,n){const s=[],o={scaleInfo:i.getScaleInfo(e),scaleExpression:null};for(const e of r)switch(e.type){case"marker":if(e.animationParams){if(e.animationParams.params.hasShiftAnimation){s.push(...i.createAnimatedMarkerMeshInfos(n.instances.animatedMarkerShift,e,t.noVisualVariables,o));break}s.push(...i.createAnimatedMarkerMeshInfos(n.instances.animatedMarker,e,t.noVisualVariables,o));break}s.push(...i.createComplexMarkerMeshInfos(n.instances.marker,e,t.noVisualVariables,o));break;case"fill":if(e.animationParams){s.push(...i.createAnimatedPolyMeshInfos(n.instances.animatedPolygon,e,t.noVisualVariables,o));break}null==e.spriteRasterizationParam?s.push(...i.createComplexSimpleFillMeshInfos(n.instances.fill,e,o)):s.push(...i.createComplexFillMeshInfos(n.instances.complexFill,e,!1,o));break;case"line":if(e.animationParams){if(e.animationParams.params.hasShiftAnimation){s.push(...i.createAnimatedPolyMeshInfos(n.instances.animatedPolylineShift,e,t.noVisualVariables,o));break}s.push(...i.createAnimatedPolyMeshInfos(n.instances.animatedPolyline,e,t.noVisualVariables,o));break}e.spriteRasterizationParam?s.push(...i.createComplexTexturedLineMeshInfos(n.instances.texturedLine,e,!1,o)):s.push(...i.createComplexSimpleLineMeshInfos(n.instances.line,e,!1,o));break;case"text":s.push(...i.createComplexTextMeshInfos(n.instances.text,e,t.noVisualVariables,o));break;case"gradientFill":s.push(...i.createGradientFillMeshInfos(n.instances.gradientFill,e,o));break;case"gradientStroke":s.push(...i.createGradientStrokeMeshInfos(n.instances.gradientStroke,e,o));break;case"outlineFill":s.push(...i.createComplexSimpleOutlineFillMeshInfos(n.instances.outlineFill,e,o))}return s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/VisualVariablesSchema":function(){define(["exports","../../../../../../core/has","../../../../../../core/screenUtils","../../../../../../core/unitUtils","../../../../../../renderers/support/lengthUtils","../../../../engine/webgl/definitions","./schemaUtils","../../support/rendererUtils"],function(e,t,i,r,n,s,o,a){"use strict";function l(e){if(!e.stops?.length)return null;const t=e.stops.sort((e,t)=>e.value-t.value),i=o.padStops(t,8),r=i.map(({value:e})=>e),n=i.map(({color:e})=>o.premultiplyColor(e));return{values:r,colors:n}}function c(e){if(!e.stops?.length)return null;const t=e.stops.sort((e,t)=>e.value-t.value),i=o.padStops(t,8);return{opacityValues:i.map(({value:e})=>e),opacities:i.map(({opacity:e})=>e)}}function u(e){return{rotationType:"geographic"===e.rotationType?0:1}}function h(e){if(!e.stops?.length)return null;if(e.stops.some(e=>e.useMaxValue||e.useMinValue))return(t,r)=>{const n=t.statisticsByLevel.get(r.key.level),a=e.stops.map(t=>({value:t.useMaxValue?n?.get(e.field)?.maxValue??0:t.useMinValue?n?.get(e.field)?.minValue??0:t.value,size:t.size?i.pt2px(t.size):s.nanMagicNumber})).sort((e,t)=>e.value-t.value),l=o.padStops(a,8);return{values:l.map(({value:e})=>e),sizes:l.map(({size:e})=>e)}};const t=e.stops.sort((e,t)=>e.value-t.value),r=o.padStops(t,8);return{values:r.map(({value:e})=>e),sizes:r.map(({size:e})=>i.pt2px(e))}}function d(e){return t=>{const{state:i}=t;return{unitValueToPixelsRatio:r.getMetersPerUnitForSR(i.spatialReference)/n.meterIn[e.valueUnit??"meters"]/i.resolution}}}function f(e,t){const i=t.length;if(e<t[0].value||1===i)return t[0].size;for(let r=1;r<i;r++)if(e<t[r].value){const i=(e-t[r-1].value)/(t[r].value-t[r-1].value);return t[r-1].size+i*(t[r].size-t[r-1].size)}return t[i-1].size}function p(e){const{minDataValue:t,maxDataValue:r,minSize:n,maxSize:s}=e;if("object"==typeof n&&"object"==typeof s)return(e,o)=>{const a=e.state.scale,l=i.pt2px(f(a,n.stops)),c=i.pt2px(f(a,s.stops));return{minMaxValueAndSize:[t,r,l,c]}};if("object"==typeof n||"object"==typeof s)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return{minMaxValueAndSize:[t,r,i.pt2px(n),i.pt2px(s)]}}const m={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function g(e){return"number"==typeof e.minDataValue&&"number"==typeof e.maxDataValue&&null!=e.minSize&&null!=e.maxSize?"min-max":"$view.scale"===e?.valueExpression&&Array.isArray(e.stops)?"scale-stops":null==e.field&&"$view.scale"===e?.valueExpression||!(Array.isArray(e.stops)||"levels"in e&&e.levels)?null!=e.field||"$view.scale"!==e?.valueExpression?"unit-value":null:"field-stops"}e.createVisualVariableColor=l,e.createVisualVariableOpacity=c,e.createVisualVariableRotation=u,e.createVisualVariableSizeMinMaxValue=p,e.createVisualVariableSizeStops=h,e.createVisualVariableSizeUnitValue=d,e.createVisualVariableUniforms=function(e){const t={...m};if(!e||!("visualVariables"in e)||!e.visualVariables)return t;for(const i of a.simplifyVisualVariables(e.visualVariables))switch(i.type){case"color":t.visualVariableColor=l(i);break;case"opacity":t.visualVariableOpacity=c(i);break;case"rotation":t.visualVariableRotation=u(i);break;case"size":switch(g(i)){case"field-stops":t.visualVariableSizeStops=h(i);break;case"scale-stops":"outline"===i.target?t.visualVariableSizeOutlineScaleStops=h(i):t.visualVariableSizeScaleStops=h(i);break;case"min-max":t.visualVariableSizeMinMaxValue=p(i);break;case"unit-value":t.visualVariableSizeUnitValue=d(i)}}return t},e.getMaxSizeVVSize=function(e,t=128,i=1.25){if(e.visualVariableSizeMinMaxValue)return"function"==typeof e.visualVariableSizeMinMaxValue?128:Math.max(e.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,t);if(e.visualVariableSizeScaleStops){if("function"==typeof e.visualVariableSizeScaleStops)return 128;const r=e.visualVariableSizeScaleStops.sizes;return Math.max(r[r.length-1]*i,t)}if(e.visualVariableSizeStops){if("function"==typeof e.visualVariableSizeStops)return 128;const r=e.visualVariableSizeStops.sizes;return Math.max(r[r.length-1]*i,t)}return e.visualVariableSizeUnitValue?256:0},e.noVisualVariables=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/schemaUtils":function(){define(["exports"],function(e){"use strict";e.padStops=function(e,t){const i=e.slice(0,t),r=t-i.length;for(let e=0;e<r;e++){const e=i[i.length-1];i.push(e)}return i},e.premultiplyColor=function(e){if(!e)return[0,0,0,0];const{r:t,g:i,b:r,a:n}=e;return[t*(n/255),i*(n/255),r*(n/255),n]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/rendererUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/screenUtils","../../../../webgl/capabilities"],function(e,t,i,r,n){"use strict";const s=()=>i.getLogger("esri.views.2d.layers.features.support.rendererUtils");function o(e,t,i){return(1-i)*e+i*t}e.isRendererSupported=function(e){if(!e)return!0;switch(e.type){case"dot-density":break;case"heatmap":if(!function(){const{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:t,supportsColorBufferHalfFloat:i}=n.getWebGLCapabilities();return e&&t||i}()){const e=n.getWebGLCapabilities(),i=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(t=>!e[t]).join(", ");return s().errorOnce(new t("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${i}`)),!1}}return!0},e.simplifyVisualVariables=function(e){return e.map(e=>function(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}(e)?function(e){return e.stops=(t=e.type,(i=e.stops??[]).length<=8?i:(s().warn(`Found ${i.length} Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified.`),i.length>16?function(e,t){const[i,...n]=t,s=n.pop(),a=n[0].value,l=n[n.length-1].value,c=(l-a)/6,u=[];for(let i=a;i<l;i+=c){let s=0;for(;i>=n[s].value;)s++;const a=n[s],l=t[s-1],c=i-l.value,h=a.value===l.value?1:c/(a.value-l.value);if("color"===e){const e=n[s],r=t[s-1],a=e.color.clone();a.r=o(r.color.r,a.r,h),a.g=o(r.color.g,a.g,h),a.b=o(r.color.b,a.b,h),a.a=o(r.color.a,a.a,h),u.push({value:i,color:a,label:e.label})}else if("size"===e){const e=n[s],a=t[s-1],l=r.toPt(e.size),c=o(r.toPt(a.size),l,h);u.push({value:i,size:c,label:e.label})}else{const e=n[s],r=o(t[s-1].opacity,e.opacity,h);u.push({value:i,opacity:r,label:e.label})}}return[i,...u,s]}(t,i):function(e){const[t,...i]=e,r=i.pop();for(;i.length>6;){let e=0,t=0;for(let r=1;r<i.length;r++){const n=i[r-1],s=i[r],o=Math.abs(s.value-n.value);o>t&&(t=o,e=r)}i.splice(e,1)}return[t,...i,r]}(i))),e;var t,i}(e.clone()):e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/ComplexSymbolSchema":function(){define(["exports","../../../../../../../symbols/cim/CIMSymbolHelper","../../../../../../../symbols/cim/defaultCIMValues","../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry","../VisualVariablesSchema","./utils"],function(e,t,i,r,n,s){"use strict";function o(e){return e.minScale||e.maxScale?{minScale:e.minScale??0,maxScale:e.maxScale??0}:null}function a(e){if(null==e)return null;if(Array.isArray(e)){const[t,i,r,n]=e;return[t,i,r,255*n]}return"string"==typeof e?e:{...e,defaultValue:a(e?.defaultValue)}}function l(e,t,i){const{uniforms:s,schemaOptions:o}=t,{store:a}=o,l=e.isOutline?{...n.noVisualVariables,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue,visualVariableRotation:s.visualVariableRotation};if(e.animationParams){const{hasShiftAnimation:t}=e.animationParams.params,s=t?r.Techniques.animatedMarkerShift:r.Techniques.animatedMarker;return c(a.ensureInstance(s,{uniforms:l,optionalAttributes:{zoomRange:!0,value1Position2Value2:e.animationParams.params.hasShiftAnimation,lineLength:t}}),e,n.noVisualVariables,i)}return h(a.ensureInstance(r.Techniques.marker,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,s,i)}function c(e,t,i,r){return t.animationParams?[e.createMeshInfo({pixelDimensions:t.pixelDimensions,texelDimensions:t.texelDimensions,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,sprite:s.getAnimatedTechniqueSprite(t),animations:t.animationParams,scaleInfo:r.scaleInfo,scaleSymbolsProportionally:t.scaleSymbolsProportionally,strokeWidth:t.outlineWidth,isMapAligned:1===t.alignment,colorLocked:t.colorLocked,isStroke:t.isStroke,baseSize:t.baseSize,placement:t.markerPlacement,referenceSize:t.referenceSize,angleToLine:!!t.markerPlacement&&t.markerPlacement.placement&&"angleToLine"in t.markerPlacement.placement&&t.markerPlacement.placement.angleToLine,sizeRatio:t.sizeRatio,patternHeight:null})]:[]}function u(e,t,i,r){return t.animationParams?[e.createMeshInfo({effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,sprite:s.getAnimatedTechniqueSprite(t),animations:t.animationParams,scaleInfo:r.scaleInfo,scaleSymbolsProportionally:!1,strokeWidth:1,isMapAligned:!0,colorLocked:t.colorLocked||!1,isStroke:!1,baseSize:"width"in t?t.width:-1,placement:null,referenceSize:2,angleToLine:!1,sizeRatio:1,patternHeight:"fill"===t.type&&t.spriteRasterizationParam?t.height:null,joinType:"join"in t?t.join:"round",capType:"cap"in t?t.cap:"round",miterLimit:"miterLimit"in t&&t.miterLimit||2})]:[]}function h(e,t,r,{scaleInfo:o,scaleExpression:l}){const c=s.hasSizeVVUniform(r);return[e.createMeshInfo({size:t.size,scaleX:t.scaleX,anchorX:t.anchorPoint.x,anchorY:t.anchorPoint.y,angle:t.rotation,color:a(t.color)??[0,0,0,0],colorLocked:t.colorLocked,frameHeight:t.frameHeight,widthRatio:t.widthRatio,scaleInfo:o,offsetX:t.offsetX,offsetY:t.offsetY,outlineColor:a(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineWidth,referenceSize:t.referenceSize||i.defaultCIMValues.CIMVectorMarker.size,rotateClockwise:t.rotateClockwise,scaleFactor:l??1,sizeRatio:t.sizeRatio,alignment:t.alignment,isAbsoluteAnchorPoint:t.isAbsoluteAnchorPoint,scaleSymbolsProportionally:t.scaleSymbolsProportionally,sprite:t.spriteRasterizationParam,hasSizeVV:c,placement:t.markerPlacement,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,transforms:t.transform,minPixelBuffer:n.getMaxSizeVVSize(r)})]}function d(e,t,i){const{uniforms:n,schemaOptions:s}=t,{store:o}=s;return f(o.ensureInstance(r.Techniques.outlineFill,{uniforms:{visualVariableColor:e.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}function f(e,t,i){const r=a(t.color)??[0,0,0,0],n=a(t.outlineColor)??[0,0,0,0];return[e.createMeshInfo({color:r,outlineColor:n,width:t.outlineWidth,referenceWidth:t.referenceWidth,capType:t.cap,joinType:t.join,miterLimit:t.miterLimit,outlineUsesColorVV:!t.outlineColorLocked,hasSizeVV:!1,scaleInfo:i.scaleInfo,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,outlineEffects:t.outlineEffects?{type:"cim-effect-infos",effectInfos:t.outlineEffects}:null})]}function p(e,t,{scaleInfo:i}){return[e.createMeshInfo({color:a(t.color)??[0,0,0,0],scaleInfo:i,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function m(e,t,i){if(!e.spriteRasterizationParam)return function(e,t,i){const{uniforms:s,schemaOptions:o}=t,{store:a}=o,l={visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity};if(e.animationParams){const t=r.Techniques.animatedFill;return u(a.ensureInstance(t,{uniforms:{...l,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableSizeScaleStops:null,visualVariableRotation:null},optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,lineLength:!1}}),e,n.noVisualVariables,i)}return p(a.ensureInstance(r.Techniques.fill,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}(e,t,i);const{uniforms:s,schemaOptions:o}=t,{store:a}=o,l={visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity};if(e.animationParams){const t=r.Techniques.animatedFill;return u(a.ensureInstance(t,{uniforms:{...l,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableSizeScaleStops:null,visualVariableRotation:null},optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,lineLength:!1}}),e,n.noVisualVariables,i)}return g(a.ensureInstance(r.Techniques.complexFill,{uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,null!=s.visualVariableColor,i)}function g(e,t,i,{scaleInfo:r}){if(!t.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const n=!!t.hasUnresolvedReplacementColor&&(!i||t.colorLocked),s=t.sampleAlphaOnly&&!n,o=t.spriteRasterizationParam;return[e.createMeshInfo({color:a(t.color)??[0,0,0,0],height:t.height,aspectRatio:t.scaleX,offsetX:t.offsetX,offsetY:t.offsetY,scaleX:1,scaleY:1,angle:t.angle,applyRandomOffset:t.applyRandomOffset,sampleAlphaOnly:s,scaleProportionally:"CIMHatchFill"===o.resource.type,sprite:o,scaleInfo:r,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function _(e,t,i){const{uniforms:n,schemaOptions:s}=t,{store:o}=s;return y(o.ensureInstance(r.Techniques.gradientFill,{uniforms:{visualVariableColor:null,visualVariableOpacity:n.visualVariableOpacity},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}function y(e,t,{scaleInfo:i}){if(!t.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const r=t.spriteRasterizationParam;return[e.createMeshInfo({color:a(t.color)??[0,0,0,0],angle:t.angle,gradientMethod:t.gradientMethod,gradientSize:t.gradientSize,gradientSizeUnits:t.gradientSizeUnits,gradientType:t.gradientType,sprite:r,scaleInfo:i,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function x(e,t,i){const{uniforms:s,schemaOptions:o}=t,{store:a}=o,l=e.isOutline?{...n.noVisualVariables,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:e.colorLocked?null:s.visualVariableColor,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue};if(e.animationParams){const{hasShiftAnimation:t}=e.animationParams.params,s=r.Techniques.animatedLine;return u(a.ensureInstance(s,{uniforms:{...l,visualVariableRotation:null},optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,accumulatedDistance:!0,segmentDirection:!0,normal:!0,lineLength:t}}),e,n.noVisualVariables,i)}const c={uniforms:l,optionalAttributes:{zoomRange:!!i.scaleInfo}},h=!!(l.visualVariableSizeMinMaxValue||l.visualVariableSizeScaleStops||l.visualVariableSizeStops||l.visualVariableSizeUnitValue);return e.spriteRasterizationParam?S(a.ensureInstance(r.Techniques.texturedLine,c),e,h,i):v(a.ensureInstance(r.Techniques.line,c),e,h,i)}function b(e,t,{scaleInfo:i}){return{color:a(e.color)??[0,0,0,0],width:e.width,referenceWidth:e.referenceWidth,capType:e.cap,joinType:e.join,miterLimit:e.miterLimit,scaleInfo:i,hasSizeVV:t,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null}}function v(e,t,i,r){if(t.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const n=b(t,i,r);return[e.createMeshInfo(n)]}function S(e,t,i,r){const{spriteRasterizationParam:n,scaleDash:s,sampleAlphaOnly:o}=t;if(!n)throw new Error("InternalError: Sprite should be defined");return[e.createMeshInfo({...b(t,i,r),offsetAlongLine:t.offsetAlongLine??0,shouldScaleDash:s??!1,shouldSampleAlphaOnly:o,isSDF:"CIMPictureStroke"!==n.resource.type&&"CIMGradientStroke"!==n.resource.type,sprite:n})]}function w(e,t,i){const{uniforms:s,schemaOptions:o}=t,{store:a}=o;return T(a.ensureInstance(r.Techniques.gradientStroke,{uniforms:e.isOutline?{...n.noVisualVariables,visualVariableSizeScaleStops:s.visualVariableSizeOutlineScaleStops}:{visualVariableColor:null,visualVariableOpacity:s.visualVariableOpacity,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo}}),e,i)}function T(e,t,i){if(!t.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const r=t.spriteRasterizationParam;return[e.createMeshInfo({...b(t,!1,i),gradientMethod:t.gradientMethod,gradientSize:t.gradientSize,gradientSizeUnits:t.gradientSizeUnits,gradientType:t.gradientType,sprite:r,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null})]}function M(e,t,i){const{uniforms:n,schemaOptions:s}=t,{store:o}=s;return P(o.ensureInstance(r.Techniques.text,{uniforms:{visualVariableColor:e.colorLocked?null:n.visualVariableColor,visualVariableOpacity:n.visualVariableOpacity,visualVariableRotation:n.visualVariableRotation,visualVariableSizeMinMaxValue:n.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:n.visualVariableSizeScaleStops,visualVariableSizeStops:n.visualVariableSizeStops,visualVariableSizeUnitValue:n.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!i.scaleInfo,referenceSymbol:!1,clipAngle:!1,visibility:!1}}),e,n,i)}function P(e,t,i,{scaleInfo:r,scaleExpression:s}){return[e.createMeshInfo({boxBackgroundColor:a(t.backgroundColor),boxBorderLineColor:a(t.borderLineColor),boxBorderLineSize:t.borderLineWidth??0,color:a(t.color)??[0,0,0,0],offsetX:t.offsetX,offsetY:t.offsetY,postAngle:t.angle,fontSize:t.size,referenceSize:t.referenceSize,decoration:t.decoration,haloColor:a(t.haloColor)??[0,0,0,0],haloSize:t.haloSize??0,outlineColor:a(t.outlineColor)??[0,0,0,0],outlineSize:t.outlineSize,lineWidth:t.lineWidth||512,lineHeightRatio:1,horizontalAlignment:t.horizontalAlignment??"center",verticalAlignment:t.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:t.textRasterizationParam,scaleInfo:r,effects:t.effects?{type:"cim-effect-infos",effectInfos:t.effects}:null,placement:t.markerPlacement,transforms:t.transform,scaleFactor:s??1,minPixelBuffer:n.getMaxSizeVVSize(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,labelClassId:-1})]}e.createAnimatedMarkerMeshInfos=c,e.createAnimatedPolyMeshInfos=u,e.createComplexFillMeshInfos=g,e.createComplexMarkerMeshInfos=h,e.createComplexSimpleFillMeshInfos=p,e.createComplexSimpleLineMeshInfos=v,e.createComplexSimpleOutlineFillMeshInfos=f,e.createComplexSymbolInstances=async function(e,i){const{cimResourceManager:r,cimAnalyzer:n,scaleExpression:s}=i.schemaOptions;await Promise.all(t.CIMSymbolHelper.fetchResources(e.symbol,r,[]));const a=n.analyzeSymbolReference(e,!1),c={scaleInfo:o(e),scaleExpression:s},u=[];for(const e of a)switch(e.type){case"marker":u.push(...l(e,i,c));break;case"fill":u.push(...m(e,i,c));break;case"outlineFill":u.push(...d(e,i,c));break;case"gradientFill":u.push(..._(e,i,c));break;case"line":u.push(...x(e,i,c));break;case"gradientStroke":u.push(...w(e,i,c));break;case"text":u.push(...M(e,i,c))}return u},e.createComplexTextMeshInfos=P,e.createComplexTexturedLineMeshInfos=S,e.createGradientFillMeshInfos=y,e.createGradientStrokeMeshInfos=T,e.getScaleInfo=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/utils":function(){define(["exports"],function(e){"use strict";e.getAnimatedTechniqueSprite=function(e){return e.spriteRasterizationParam?e.spriteRasterizationParam:{type:"sprite-rasterization-param",resource:{type:"CIMPictureMarker",url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAJOgAACToAYJjBRwAAAAsSURBVEhL7c0xAQAwDASh+jf9lcCU7TDA27ECKqACKqACKqACKqACKqDjYPuLVfSmMPfafQAAAABJRU5ErkJggg==",size:16,invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture"},overrides:[]}},e.hasRotationVVUniform=function(e){return!!e.visualVariableRotation},e.hasSizeVVUniform=function(e){return!!(e.visualVariableSizeMinMaxValue||e.visualVariableSizeScaleStops||e.visualVariableSizeStops||e.visualVariableSizeUnitValue||e.visualVariableSizeOutlineScaleStops)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/StorageSchema":function(){define(["exports","../../../../../../core/arrayUtils","../../../../../../layers/support/streamLayerUtils","../../support/rendererUtils","../../../../../webgl/capabilities"],function(e,t,i,r,n){"use strict";function s(e){switch(e){case"opacity":return 2;case"color":return 1;case"rotation":return 3;case"size":return 0;default:return null}}function o(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return u(e);case"dot-density":return a(e);case"pie-chart":return l(e);case"heatmap":return c(e)}}function a(e){const t=[];for(const i of e.attributes)t.push({binding:t.length,expression:i.valueExpression,field:i.field});return t}function l(e){const t=u(e);let i=4;for(const r of e.attributes)t.push({binding:i++,expression:r.valueExpression,field:r.field});return t}function c({valueExpression:e,field:t}){return e||t?[{binding:0,expression:e,field:t}]:[]}function u(e){return"visualVariables"in e&&e.visualVariables?.length?r.simplifyVisualVariables(e.visualVariables).map(e=>function(e){switch(e.type){case"size":return function(e){return"$view.scale"===e.valueExpression?null:{binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}(e);case"color":case"opacity":return function(e){return{binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}(e);case"rotation":return function(e){return{binding:s(e.type),expression:e.valueExpression,field:e.field}}(e)}}(e)).filter(t.isSome):[]}e.createDotDensityBindings=a,e.createHeatmapBindings=c,e.createPieChartBindings=l,e.createStorageSchema=function(e,t){return{type:"simple",filters:t,capabilities:{maxTextureSize:n.getWebGLCapabilities().maxTextureSize},bindings:o(e)}},e.createTrackStorageSchema=function(e,t){const r=n.getWebGLCapabilities();return{type:"multi",target:"feature",keyField:i.internalTrackPartField,filters:t,capabilities:{maxTextureSize:r.maxTextureSize},bindings:{0:o(e.trackLines.renderer),1:o(e.latestObservations.renderer),2:o(e.previousObservations.renderer)}}},e.createVVBindings=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/streamLayerUtils":function(){define(["exports"],function(e){"use strict";e.defaultStreamIdField="__esri_stream_id__",e.esriTimestamp="__esri_timestamp__",e.externalTrackLineOidPrefix="__esri_track_line__",e.internalTimeReceivedField="__esri_time_received__",e.internalTrackPartField="__esri_track_part__",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define(["exports","../../../../../core/Error","../../../../../core/has","../../../../../core/Logger","../../../../../core/accessorSupport/diffUtils","../../../../../support/ArcadeExpression","../../../engine/webgl/definitions","../../../engine/webgl/DisplayId","../../../engine/webgl/Utils","../../../engine/webgl/shaderGraph/techniques/shaders/constants","../../../engine/webgl/util/debug","./DisplayIdGenerator","./FeatureFilterEvaluator","../../../../webgl/enums"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f){"use strict";function p(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}const m=()=>r.getLogger("esri.views.layers.2d.features.support.AttributeStore"),g=u.createDebugLogger(u.DEBUG_ATTR_UPDATES,m()),_=i("esri-shared-array-buffer");i("esri-atomics");class y{constructor(e,t,i){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:r,layout:n,textureOnly:s}=t;this.textureOnly=s||!1,this.pixelType=r,this.layout=n,this._resetRange(),this.size=e,this.isLocal=i,s||(this.data=this._initData(r,e))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(e,t){const i=this.data;for(let r=0;r<this.size*this.size;r++)i[r*this.texelSize+e]&=~t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,t){const i=this.data;for(let r=0;r<this.size*this.size;r++)i[r*this.texelSize+e]|=255&t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,t,i){const r=this.data;for(const n of i)r[n*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,n),this.dirtyEnd=Math.max(this.dirtyEnd,n)}setComponentTexel(e,t,i){this.data[i*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}unsetComponentTexel(e,t,i){this.data[i*this.texelSize+e]&=~t,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}getData(e,t){const i=a.getDisplayIdTexel(e);return this.data[i*this.texelSize+t]}setData(e,t,i){const r=a.getDisplayIdTexel(e),n=1<<t;0!==(this.layout&n)?null!=this.data&&(this.data[r*this.texelSize+t]=i,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)):m().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(e){if(this.size=e,!this.textureOnly){const t=this._initData(this.pixelType,e),i=this.data;t.set(i),this.data=t}}toMessage(){const e=this.dirtyStart,t=this.dirtyEnd,i=this.texelSize;if(e>t)return null;this._resetRange();const r=!this.isLocal,n=this.pixelType,s=this.layout,o=this.data;return{start:e,end:t,data:r&&o.slice(e*i,(t+1)*i)||null,pixelType:n,layout:s}}_initData(e,t){const i=ArrayBuffer,r=l.getPixelArrayCtor(e),n=new r(new i(t*t*4*r.BYTES_PER_ELEMENT));for(let e=0;e<n.length;e+=4)n[e+1]=255;return n}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}e.AttributeStore=class{constructor(e){this._client=e,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=o.attributeStoreInitialSize,this._idsToHighlight=new Map,this._arcadeDependencies=new Set,this._initialized=!1,this.version=0,this._idGenerator=new h.DisplayIdGenerator,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const e=f.PixelType.FLOAT;g(`Creating AttributeStore ${_?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:f.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:f.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:f.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:f.PixelType.FLOAT,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(e){return this._idGenerator.createIdForObjectId(e)}releaseDisplayIdForObjectId(e){return this._idGenerator.releaseIdForObjectId(e)}getDisplayIdForObjectId(e){return this._idGenerator.getDisplayIdForObjectId(e)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}releaseAllIds(){this._idGenerator.releaseAll()}async update(e,t,r,s=0){const o=n.diff(this._schema,e);if(this.version=s,o&&(i("esri-2d-update-debug")&&console.debug(`Version[${s}] AttributeStore.update`,{changed:o}),this._schema=e,this._attributeComputeInfo=null,this._initialize(),null!=e))if(r&&(this._filters=await Promise.all(e.filters.map(e=>e?d.create({geometryType:r.geometryType,hasM:!1,hasZ:!1,timeInfo:r.timeInfo,fieldsIndex:r.fieldsIndex,spatialReference:r.outSpatialReference,filterJSON:e}):null))),"multi"!==e.type)this._attributeComputeInfo={type:"feature",map:new Map},await Promise.all(e.bindings.map(async e=>{const i=await this._bind(t,e);this._updateReferences(i)}));else{this._attributeComputeInfo={type:"multi",keyField:e.keyField,map:new Map};for(const i in e.bindings){const r=e.bindings[i];await Promise.all(r.map(async e=>{const r=await this._bind(t,e,parseInt(i,10));this._updateReferences(r)}))}}}setHighlight(e,t){let i=null;0===e.length&&0===t.length&&(i=this._getBlock(0),i.unsetComponentAllTexels(0,(1<<o.maxHighlightReasons)-1));for(const{displayId:t,highlightFlags:r}of e){if(null==t||-1===t)continue;i||(i=this._getBlock(0),i.unsetComponentAllTexels(0,(1<<o.maxHighlightReasons)-1));const e=a.getDisplayIdTexel(t);i.setComponent(0,r,[e])}this._idsToHighlight.clear();for(const{objectId:t,highlightFlags:i}of e)this._idsToHighlight.set(t,i);for(const{objectId:e,highlightFlags:i}of t)this._idsToHighlight.set(e,i)}setData(e,t,i,r){const n=a.getDisplayIdTexel(e);this._ensureSizeForTexel(n),this._getBlock(t).setData(e,i,r)}getData(e,t,i){return this._getBlock(t).getData(e,i)}getHighlightFlags(e){return this._idsToHighlight.get(e)||0}unsetAttributeData(e){const t=a.getDisplayIdTexel(e);this._getBlock(0).setData(t,0,0)}setAttributeData(e,t,i,r){const n=a.getDisplayIdTexel(e);this._ensureSizeForTexel(n),this._getBlock(0).setData(n,0,this.getFilterFlags(t,r));const s=this._attributeComputeInfo;let o=null;s&&(o="multi"===s.type?s.map.get(t.readAttribute(s.keyField)):s.map,o?.size&&o.forEach((e,r)=>{const s=1*r%4,o=Math.floor(1*r/4),a=this._getBlock(o+3);let l=e.field?.read(t,i);e.valueRepresentation&&(l=p(l,e.valueRepresentation)),(null===l||isNaN(l)||l===1/0||l===-1/0)&&(l=c.nanMagicNumber),a.setData(n,s,l)}))}get epoch(){return this._epoch}sendUpdates(){const e=this._blocks.map(e=>null!=e?e.toMessage():null),t=this._getInitArgs();i("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),this._client.update({initArgs:t,blockData:e,version:this.version,sendUpdateEpoch:this._epoch}),this._epoch+=1,i("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}async _bind(e,t,i){const r=await e.createComputedField(t),{valueRepresentation:n}=t,s=this._attributeComputeInfo;if("multi"===s.type){const e=s.map.get(i)??new Map;e.set(t.binding,{field:r,valueRepresentation:n}),s.map.set(i,e)}else s.map.set(t.binding,{field:r,valueRepresentation:n});return r}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(1),this._getBlock(2),this._getBlock(7),{blockSize:this._size,blockDescriptors:this._blocks.map(e=>null!=e?{textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}:null)})}_getBlock(e){const t=this._blocks[e];if(null!=t)return t;g(`Initializing AttributeBlock at index ${e}`);const i=new y(this._size,this._blockDescriptors[e],this._client.isLocal);return this._blocks[e]=i,this._initialized=!1,i}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const e=this._size<<=1;g("Expanding block size to",e,this._blocks);for(const t of this._blocks)t?.expand(e);return this._initialized=!1,this._size=e,0}return m().error(new t("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}_updateReferences(e){s.collectExpressionDependencies(this._arcadeDependencies,e)}isVisible(e){return!!(this._getBlock(0).getData(e,0)&1<<o.maxHighlightReasons)}getFilterFlags(e,t){let i=0;for(let r=0;r<this._filters.length;r++){const n=!!(1<<r),s=this._filters[r];i|=(!n||null==s||s.check(e,t)?1:0)<<r}let r=0;if(this._idsToHighlight.size){const t=e.getObjectId();r=this.getHighlightFlags(t)}return i<<o.maxHighlightReasons|r}},e.getVisualVariableSizeValueRepresentationRatio=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],function(e){"use strict";const t=8388607,i=8388608,r=e=>(e&i)>>>23;e.aggregateValidFiltersMask=254,e.createDisplayId=function(e,t){return((t?i:0)|e)>>>0},e.displayIdTexelMask=t,e.displayIdTypeAggregate=1,e.displayIdTypeFeature=0,e.displayIdTypeMask=i,e.getDisplayIdFilterMask=e=>1===r(e)?254:255,e.getDisplayIdTexel=e=>e&t,e.getDisplayIdType=r,e.isAggregateId=function(e){return 1===r(e)},e.nonAggregateValidFiltersMask=255,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(e){"use strict";e.DEBUG_ATTR_UPDATES=!1,e.createDebugLogger=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],function(e,t){"use strict";class i{constructor(e){this.data=e,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}e.DisplayIdGenerator=class{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(e){let r=this._objectIdToDisplayId.get(e);return r?r.increment():(r=new i(t.createDisplayId(this._getFreeId(),!1)),r.increment(),this._objectIdToDisplayId.set(e,r)),r.data}releaseIdForObjectId(e){const t=this._objectIdToDisplayId.get(e);t&&(t.decrement(),t.empty()&&(this._objectIdToDisplayId.delete(e),this._freeIds.push(t.data)))}getDisplayIdForObjectId(e){const t=this._objectIdToDisplayId.get(e);return null!=t?t.data:null}releaseAll(){for(const e of this._objectIdToDisplayId.values())this._freeIds.push(e.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureFilterEvaluator":function(){define(["../../../../../core/Error","../../../../../core/Logger","../../../../../geometry/support/aaBoundingRect","../../../../../geometry/support/boundsUtils","../../../../../layers/graphics/data/queryUtils","../../../../../layers/graphics/data/spatialQuerySupport","../../../../../layers/graphics/data/timeSupport","../../../../../rest/support/Query","../FeatureStoreQueryAdapter","./whereUtils"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u{constructor(e){this._geometryBounds=i.create(),this._idToVisibility=new Map,this._serviceInfo=e}static async create(e){const t=new u(e);return await t.update(e.filterJSON,e.spatialReference),t}get hash(){return this._hash}check(e,t){return this._applyFilter(e,t)}invalidate(){this._idToVisibility.forEach((e,t)=>{this._idToVisibility.set(t,0)})}setKnownIds(e){for(const t of e)this._idToVisibility.set(t,1)}setTrue(e){const t=[],i=[],r=new Set(e);return this._idToVisibility.forEach((e,n)=>{const s=!!(1&this._idToVisibility.get(n)),o=r.has(n);!s&&o?t.push(n):s&&!o&&i.push(n),this._idToVisibility.set(n,o?3:0)}),{show:t,hide:i}}createQuery(){const{geometry:e,spatialRel:t,where:i,timeExtent:r,objectIds:n}=this;return a.fromJSON({geometry:e,spatialRel:t,where:i,timeExtent:r,objectIds:n})}async update(e,t){this._hash=JSON.stringify(e);const i=await n.normalizeQueryLike(e,null,t);await Promise.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(e){if(!e?.where)return this._clause=null,void(this.where=null);this._clause=await c.createWhereClause(e.where,this._serviceInfo.fieldsIndex),this.where=e.where}_setIdFilter(e){this._idsToShow=e?.objectIds&&new Set(e.objectIds),this._idsToHide=e?.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e?.objectIds}async _setGeometryFilter(e){if(!e?.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const t=e.geometry,i=e.spatialRel??"esriSpatialRelIntersects",n=await s.getSpatialQueryOperator(i,t,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);r.getBoundsXY(this._geometryBounds,t),this._spatialQueryOperator=n,this.geometry=t,this.spatialRel=i}_setTimeFilter(i){if(this.timeExtent=this._timeOperator=null,i?.timeExtent){if(!this._serviceInfo.timeInfo){const r=new e("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",i.timeExtent);return void t.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(r)}this.timeExtent=i.timeExtent,this._timeOperator=o.getTimeOperator(this._serviceInfo.timeInfo,i.timeExtent,l.FeatureStoreQueryAdapter.Shared)}}_applyFilter(e,t){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e,t)}_filterByExpression(e,t){return!this.where||this._clause(e,t)}_filterById(e){return(!this._idsToHide?.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const t=e.readGeometryWorldSpace();return!!t&&this._spatialQueryOperator(t)}_filterByTime(e){return null==this._timeOperator||this._timeOperator(e)}}return u})},"esri/layers/graphics/data/queryUtils":function(){define(["require","exports","../../../core/Error","../../../core/jsonMap","../../../core/unitUtils","../../../geometry/projectionUtils","../../../geometry/support/extentUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","./projectionSupport"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";const h=new r.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),d=Object.freeze({});async function f(e,t,i){const{outFields:r,orderByFields:n,groupByFieldsForStatistics:s,outStatistics:o}=e;if(r)for(let e=0;e<r.length;e++)r[e]=r[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(o)for(let e=0;e<o.length;e++)o[e].onStatisticField&&(o[e].onStatisticField=o[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),p(e,t,i)}async function p(t,r,s){if(!t)return null;let{where:f}=t;if(t.where=f=f?.trim(),(!f||/^1 *= *1$/.test(f)||r&&r===f)&&(t.where=null),!t.geometry)return t;let p=await async function(t){const{distance:r,units:s}=t,o=t.geometry;if(null==r||"vertexAttributes"in o)return o;const l=o.spatialReference,d=s?h.fromJSON(s):n.getUnitString(l),f=l&&(c.isGeographic(l)||c.isWebMercator(l))?o:await u.checkProjectionSupport(l,c.wgs84).then(()=>u.project(o,c.wgs84)),p=await new Promise((t,i)=>e(["../../../geometry/operators/json/geodesicBufferOperator"],t,i));await p.load();const m=p.execute(f,r||1,{unit:d})??void 0;if(!m||!a.isPolygon(m)||0===m.rings.length)throw new i("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return m}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;p=o.getGeometryExtent(p),p.spatialReference=e}if(p){await u.checkProjectionSupport(p.spatialReference,s),p=function(e,t){const i=e.spatialReference;return m(e,t)&&a.isExtent(e)?{spatialReference:i,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(p,s);const e=(await l.normalizeCentralMeridian(a.fromJSON(p)))[0];if(null==e)throw d;const i="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,r=i&&m(p,s)?{densificationStep:8*i}:void 0,n=e.toJSON(),o=u.project(n,n.spatialReference,s,r);if(!o)throw d;o.spatialReference=s,t.geometry=o}return t}function m(e,t){if(!e)return!1;const i=e.spatialReference;return(a.isExtent(e)||a.isPolygon(e)||a.isPolyline(e))&&!c.equals(i,t)&&!s.canProjectWithoutEngine(i,t)}t.getDateInNumber=function(e,t){return null==e?null:"string"==typeof e?t?new Date(`1970-01-01T${e}Z`).getTime():new Date(e).getTime():e instanceof Date?e.getTime():e},t.normalizeAttributeBinsQuery=async function(e,t,i){const r=e.bin;return r.onField&&(r.onField=r.onField.trim()),r.onExpression?.value&&(r.onExpression.value=r.onExpression.value.trim()),r.splitBy&&(r.splitBy.value&&(r.splitBy.value=r.splitBy.value.trim()),r.splitBy.outAlias&&(r.splitBy.outAlias=r.splitBy.outAlias.trim())),r.stackBy&&(r.stackBy.value&&(r.stackBy.value=r.stackBy.value.trim()),r.stackBy.outAlias&&(r.stackBy.outAlias=r.stackBy.outAlias.trim())),"normalizationField"in r.parameters&&r.parameters.normalizationField&&(r.parameters.normalizationField=r.parameters.normalizationField.trim()),e.outStatistics?.length||(e.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:"frequency"}]),f(e,t,i)},t.normalizeQuery=f,t.normalizeQueryLike=p,t.queryEngineEmptyResult=d,t.unitsKebabDict=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define(["exports","../../../core/arrayUtils","../../../core/promiseUtils","../../../geometry/projectionUtils","../../../geometry/geometryAdapters/json","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils"],function(e,t,i,r,n,s,o){"use strict";const a=[0,0];function l(e,t){if(!t)return null;if("x"in t){const i={x:0,y:0};return[i.x,i.y]=e(t.x,t.y,a),null!=t.z&&(i.z=t.z),null!=t.m&&(i.m=t.m),i}if("xmin"in t){const i={xmin:0,ymin:0,xmax:0,ymax:0};return[i.xmin,i.ymin]=e(t.xmin,t.ymin,a),[i.xmax,i.ymax]=e(t.xmax,t.ymax,a),t.hasZ&&(i.zmin=t.zmin,i.zmax=t.zmax,i.hasZ=!0),t.hasM&&(i.mmin=t.mmin,i.mmax=t.mmax,i.hasM=!0),i}return"rings"in t?{rings:c(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:c(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:u(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function c(e,t){const i=[];for(const r of e)i.push(u(r,t));return i}function u(e,t){const i=[];for(const r of e){const e=t(r[0],r[1],[0,0]);i.push(e),r.length>2&&e.push(r[2]),r.length>3&&e.push(r[3])}return i}const h=l.bind(null,o.lngLatToXY),d=l.bind(null,o.xyToLngLat),f=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,r,n){if(!e?.length||!t||!r||s.equals(t,r))return e;const o={geometries:e,inSpatialReference:t,outSpatialReference:r,geographicTransformation:n,resolve:i.createResolver()};return this._jobs.push(o),this._timer??=setTimeout(this._process,10),o.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:i,outSpatialReference:a,resolve:l,geographicTransformation:c}=e;o.canProject(i,a)?s.isWebMercator(a)?l(t.map(h)):l(t.map(d)):l(r.projectMany(n.jsonAdapter,t,i,a,c,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};e.checkProjectionSupport=async function(e,i){if(!e||!i)return;const n=Array.isArray(e)?e.map(e=>null!=e.geometry?e.geometry.spatialReference:null).filter(t.isSome):[e];await r.initializeProjection(n.map(e=>({source:e,dest:i})))},e.project=function(e,t,i,a){if(!e)return null;if(i||(i=t,t=e.spatialReference),!s.isValid(t)||!s.isValid(i)||s.equals(t,i))return e;if(o.canProject(t,i)){const t=s.isWebMercator(i)?h(e):d(e);return t.spatialReference=i,t}return r.projectMany(n.jsonAdapter,[e],t,i,null,a)[0]},e.projectMany=function(e,t,i,r){return f.push(e,t,i,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(e){"use strict";const t={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,r){const n=new i(e.getPointX(t),e.getPointY(t),r),s=e.hasZ(t),o=e.hasM(t);return s&&(n.z=e.getPointZ(t)),o&&(n.m=e.getPointM(t)),n},exportPolygon:function(e,t,i){return new r(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,i){return new n(e.exportPaths(t),i,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,i){return new s(e.exportPoints(t),i,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,i){const r=e.hasZ(t),n=e.hasM(t),s=new o(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),i);if(r){const i=e.getZExtent(t);s.zmin=i.vmin,s.zmax=i.vmax}if(n){const i=e.getMExtent(t);s.mmin=i.vmin,s.mmax=i.vmax}return s}};class i{constructor(e,t,i){this.x=e,this.y=t,this.spatialReference=i,this.z=void 0,this.m=void 0}}class r{constructor(e,t,i,r){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),r&&(this.hasM=r)}}class n{constructor(e,t,i,r){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),r&&(this.hasM=r)}}class s{constructor(e,t,i,r){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,i&&(this.hasZ=i),r&&(this.hasM=r)}}class o{constructor(e,t,i,r,n){this.xmin=e,this.ymin=t,this.xmax=i,this.ymax=r,this.spatialReference=n,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}e.jsonAdapter=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define(["require","exports","../../../core/Error","../../../geometry/support/contains","../../../geometry/support/intersects","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../contains","../featureConversionUtils","../OptimizedGeometry","./geometryUtils","./projectionSupport"],function(e,t,i,r,n,s,o,a,l,c,u,h){"use strict";const d="unsupported-query",f={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},p={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1},g={esriSpatialRelIntersects:()=>new Promise((t,i)=>e(["../../../geometry/operators/json/intersectsOperator"],t,i)),esriSpatialRelContains:()=>new Promise((t,i)=>e(["../../../geometry/operators/json/containsOperator"],t,i)),esriSpatialRelCrosses:()=>new Promise((t,i)=>e(["../../../geometry/operators/json/crossesOperator"],t,i)),esriSpatialRelDisjoint:()=>new Promise((t,i)=>e(["../../../geometry/operators/json/disjointOperator"],t,i)),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>new Promise((t,i)=>e(["../../../geometry/operators/json/overlapsOperator"],t,i)),esriSpatialRelTouches:()=>new Promise((t,i)=>e(["../../../geometry/operators/json/touchesOperator"],t,i)),esriSpatialRelWithin:()=>new Promise((t,i)=>e(["../../../geometry/operators/json/withinOperator"],t,i)),esriSpatialRelRelation:null};t.canQueryWithRBush=function(e){if(s.isExtent(e))return!0;if(s.isPolygon(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1},t.checkSpatialQuerySupport=async function(e,t,r){const{spatialRel:n,geometry:a}=e;if(a){if(null==(l=n)||!0!==f[l])throw new i(d,"Unsupported query spatial relationship",{query:e});var l;if(o.isValid(a.spatialReference)&&o.isValid(r)){if(!function(e){return null!=e&&!0===p[s.getJsonType(e)]}(a))throw new i(d,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===m[e]}(t))throw new i(d,"Unsupported layer geometry type",{query:e});if(e.outSR)return h.checkProjectionSupport(e.geometry?.spatialReference,e.outSR)}}},t.getSpatialQueryOperator=async function(e,t,i,o,h){if(s.isPolygon(t)){if("esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=l.convertFromPolygon(new c,t,!1,!1);return t=>a.polygonContainsPoint(e,!1,!1,t)}if("esriGeometryMultipoint"===i){const i=l.convertFromPolygon(new c,t,!1,!1);if("esriSpatialRelContains"===e)return e=>a.polygonContainsMultipoint(i,!1,!1,e,o,h)}}if(s.isExtent(t)){if("esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return e=>r.extentContainsPoint(t,u.getGeometry(i,o,h,e));if("esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return e=>r.extentContainsMultipoint(t,u.getGeometry(i,o,h,e));if("esriSpatialRelIntersects"===e){const e=n.getExtentIntersector(i);return r=>e(t,u.getGeometry(i,o,h,r))}}"esriSpatialRelEnvelopeIntersects"===e&&(e="esriSpatialRelIntersects");const d=await function(e){const t=g[e];if(null==t)throw new Error(`Cannot load unsupported spatial operator: ${e}`);return t()}(e);return e=>d.execute(t,u.getGeometry(i,o,h,e))},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(e,t){"use strict";e.extentIntersectsExtent=t.extentIntersectsExtent,e.extentIntersectsMultipoint=t.extentIntersectsMultipoint,e.extentIntersectsPoint=t.extentIntersectsPoint,e.extentIntersectsPolygon=t.extentIntersectsPolygon,e.extentIntersectsPolyline=t.extentIntersectsPolyline,e.getFeatureExtentIntersector=t.getFeatureExtentIntersector,e.isSelfIntersecting=t.isSelfIntersecting,e.segmentIntersects=t.segmentIntersects,e.getExtentIntersector=function(e){return"mesh"===e?t.extentIntersectsExtent:t.getFeatureExtentIntersector(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function i(e,i,n,s,o){if(!e)return!1;const a=t(i,n),{coords:l,lengths:c}=e;let u=!1,h=0;for(const e of c)u=r(u,l,a,h,e,s,o),h+=e*a;return u}function r(e,t,i,r,n,s,o){let a=e,l=r;for(let e=r,c=r+n*i;e<c;e+=i){l=e+i,l===c&&(l=r);const n=t[e],u=t[e+1],h=t[l],d=t[l+1];(u<o&&d>=o||d<o&&u>=o)&&n+(o-u)/(d-u)*(h-n)<s&&(a=!a)}return a}e.polygonContainsCoords=i,e.polygonContainsMultipoint=function(e,r,n,s,o,a){const l=t(o,a),{coords:c,lengths:u}=s;if(!u)return!1;for(let t=0,s=0;t<u.length;t++,s+=l)if(!i(e,r,n,c[s],c[s+1]))return!1;return!0},e.polygonContainsPoint=function(e,t,r,n){return i(e,t,r,n.coords[0],n.coords[1])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(e,t,i){"use strict";const r=new i,n=new i,s=new i,o={esriGeometryPoint:t.convertToPoint,esriGeometryPolyline:t.convertToPolyline,esriGeometryPolygon:t.convertToPolygon,esriGeometryMultipoint:t.convertToMultipoint},a="_geVersion",l=(e,t)=>e===a?void 0:t;e.cleanFromGeometryEngine=function(e){return e&&a in e?JSON.parse(JSON.stringify(e,l)):e},e.getGeometry=function(e,i,a,l,c,u,h=i,d=a){const f=i&&h,p=a&&d,m=null!=l?"coords"in l?l:l.geometry:null;if(null==m)return null;if(c){let r=t.generalizeOptimizedGeometry(n,m,i,a,e,c,h,d);return u&&(r=t.quantizeOptimizedGeometry(s,r,f,p,e,u)),o[e]?.(r,f,p)??null}if(u){const r=t.quantizeOptimizedGeometry(s,m,i,a,e,u,h,d);return o[e]?.(r,f,p)??null}return t.removeZMValues(r,m,i,a,h,d),o[e]?.(r,f,p)??null},e.transformCentroid=function(e,i,r,n=e.hasZ,o=e.hasM){if(null==i)return null;const a=e.hasZ&&n,l=e.hasM&&o;if(r){const c=t.quantizeOptimizedGeometry(s,i,e.hasZ,e.hasM,"esriGeometryPoint",r,n,o);return t.convertToPoint(c,a,l)}return t.convertToPoint(i,a,l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports","../../../core/compilerUtils"],function(e,t){"use strict";e.getTimeExtent=async function(e,i){if(!e)return null;const r=i.featureAdapter,{startTimeField:n,endTimeField:s}=e;let o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(n&&s)await i.forEach(e=>{const i=r.getAttribute(t.toConst(e),n),l=r.getAttribute(t.toConst(e),s);null==i||isNaN(i)||(o=Math.min(o,i)),null==l||isNaN(l)||(a=Math.max(a,l))});else{const e=n||s;await i.forEach(i=>{const n=r.getAttribute(t.toConst(i),e);null==n||isNaN(n)||(o=Math.min(o,n),a=Math.max(a,n))})}return{start:o,end:a}},e.getTimeOperator=function(e,t,i){if(!t||!e)return null;const{startTimeField:r,endTimeField:n}=e;if(!r&&!n)return null;const{start:s,end:o}=t;if(null===s&&null===o)return null;if(void 0===s&&void 0===o)return()=>!1;const a=i.getAttributeAsTimestamp?.bind(i)??i.getAttribute.bind(i);return r&&n?function(e,t,i,r,n){return null!=r&&null!=n?s=>{const o=e(s,t),a=e(s,i);return(null==o||o<=n)&&(null==a||a>=r)}:null!=r?t=>{const n=e(t,i);return null==n||n>=r}:null!=n?i=>{const r=e(i,t);return null==r||r<=n}:void 0}(a,r,n,s,o):function(e,t,i,r){return null!=i&&null!=r&&i===r?r=>e(r,t)===i:null!=i&&null!=r?n=>{const s=e(n,t);return null!=s&&s>=i&&s<=r}:null!=i?r=>{const n=e(r,t);return null!=n&&n>=i}:null!=r?i=>{const n=e(i,t);return null!=n&&n<=r}:void 0}(a,r||n,s,o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureStoreQueryAdapter":function(){define(["exports","../../../../layers/graphics/OptimizedFeature","./support/FeatureSetReaderJSON"],function(e,t,i){"use strict";class r{static{this.Shared=new r}getObjectId(e){return e.getObjectId()}getAttributes(e){return e.readAttributes()}getAttribute(e,t){return e.readAttribute(t)}getAttributeAsTimestamp(e,t){return e.readAttributeAsTimestamp(t)}cloneWithGeometry(e,r){const n=e.readAttributes(),s=new t.OptimizedFeature(r,n,null,e.getObjectId(),e.getDisplayId()),o=i.FeatureSetReaderJSON.fromOptimizedFeatures([s],e.metadata);return o.setIndex(0),o}getGeometry(e){return e.readGeometryWorldSpace()}getCentroid(e,t){return e.readCentroidForDisplay()}}e.FeatureStoreQueryAdapter=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderJSON":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/support/FieldsIndex","./FeatureSetReader"],function(e,t,i,r,n){"use strict";class s extends n.FeatureSetReader{static fromFeatures(e,i){const{geometryType:r}=i,n=t.convertFromFeatures([],e,r,!1,!1,i.featureIdInfo);for(let t=0;t<n.length;t++)n[t].displayId=e[t].displayId;return s.fromOptimizedFeatures(n,i)}static fromFeatureSet(e,i){const r=t.convertFromFeatureSet(e,i.featureIdInfo);return s.fromOptimizedFeatureSet(r,i)}static fromOptimizedFeatureSet(e,t){const i=s.fromOptimizedFeatures(e.features,t);return i._exceededTransferLimit=e.exceededTransferLimit,i._transform=e.transform,i._fieldsIndex=new r(e.fields),i}static fromOptimizedFeatures(e,t,i){const r=new s(e,t);return r._fieldsIndex=t.fieldsIndex,r._transform=i,r}static empty(e){return new s([],e)}constructor(e,t){super(t),this._exceededTransferLimit=!1,this._featureIndex=-1,this._fieldsIndex=null,this._geometryType=t.geometryType,this._features=e}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}get usedMemory(){return this._current.usedMemory}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let e="";for(const t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}copy(){const e=new s(this._features,this.metadata);return this.copyInto(e),e}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return i.hasGeometry(this._current)?t.getQuantizedArea(this._current.geometry,2):0}_readX(){return i.hasGeometry(this._current)?this._current.geometry.coords[0]:0}_readY(){return i.hasGeometry(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return i.hasGeometry(this._current)?this._current.geometry??null:null}_readServerCentroid(){return this._current.centroid}_readAttribute(e,t){if(!this._fieldsIndex){const t=this._current.attributes[e];if(void 0!==t)return t;const i=e.toLowerCase();for(const e in this._current.attributes)if(e.toLowerCase()===i)return this._current.attributes[e];return}const i=this._fieldsIndex.get(e);if(!i)return;const r=this._current.attributes[i.name];return null==r?r:t&&this.fields.isDateField(e)?new Date(r):r}_readAttributes(){return this._current.attributes}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._fieldsIndex=this._fieldsIndex}}e.FeatureSetReaderJSON=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define(["exports","../../../../../arcade/ArcadeDate","../../../../../core/has","../../../../../core/sql/DateOnly","../../../../../core/sql/TimeOnly","../../../../../geometry/GeometryCursor","../../../../../geometry/support/aaBoundingBox","../../../../../geometry/support/jsonUtils","../../../../../geometry/support/labelPoint","../../../../../geometry/support/quantizationUtils","../../../../../layers/graphics/centroid","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/graphics/OptimizedGeometry","../../../../../time/constants","./FeatureSetCache"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m){"use strict";const g=i("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],_=g[0],y=g[1],x=g[2],b=g[3],v=i("featurelayer-simplify-payload-size-factors")??[1,2,4],S=v[0],w=v[1],T=v[2],M=i("featurelayer-simplify-mobile-factor")??2,P=i("esri-mobile"),I=4294967295;class C{constructor(e){this.metadata=e,this.type="FeatureSetReader",this._overrides=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this._caches=new Map,this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}destroy(){}[Symbol.dispose](){this.destroy()}getAreaSimplificationThreshold(e,t){let i=1;const r=P?M:1;t>4e6?i=T*r:t>1e6?i=w*r:t>5e5?i=S*r:t>1e5&&(i=r);let n=0;return e>4e3?n=b*i:e>2e3?n=x*i:e>100?n=y:e>15&&(n=_),n}getBounds(e){!function(e,t){if(!(e.length>t))for(;e.length<=t;)e.push(0)}(this._boundsBuffer,4*this.getIndex()+4);const t=this.getBoundsXMin();if(t===I||!isFinite(t))return!1;if(0===this.getBoundsXMin()){const t=this.readGeometryWorldSpace();if(t?.isPoint&&0===t.coords[0]&&0===t.coords[1])return o.fromRectValues(e,0,0,0,0),!0;if(!t)return this.setBoundsXMin(I),!1;let i=1/0,r=1/0,n=-1/0,s=-1/0;return t.forEachVertex((e,t)=>{i=Math.min(i,e),r=Math.min(r,t),n=Math.max(n,e),s=Math.max(s,t)}),this.setBoundsXMin(i),this.setBoundsYMin(r),this.setBoundsXMax(n),this.setBoundsYMax(s),o.fromRectValues(e,i,r,n,s),!0}const i=this.getBoundsXMin(),r=this.getBoundsYMin(),n=this.getBoundsXMax(),s=this.getBoundsYMax();return o.fromRectValues(e,i,r,n,s),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(e){this._boundsBuffer[4*this.getIndex()]=e}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(e){this._boundsBuffer[4*this.getIndex()+1]=e}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(e){this._boundsBuffer[4*this.getIndex()+2]=e}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(e){this._boundsBuffer[4*this.getIndex()+3]=e}readAttributeAsTimestamp(e){const t=this.readAttribute(e);return"string"==typeof t?new Date(t).getTime():"number"==typeof t||null==t?t:null}readAttribute(e,t=!1){const i=this._readAttribute(e,t);if(void 0!==i)return i;for(const i of this._joined){i.setIndex(this.getIndex());const r=i._readAttribute(e,t);if(void 0!==r)return r}}readAttributes(){const e=this._readAttributes();for(const t of this._joined){t.setIndex(this.getIndex());const i=t._readAttributes();for(const t of Object.keys(i))e[t]=i[t]}return e}joinAttributes(e){this._joined.push(e)}registerOverrides(e){this._overrides=e}withoutOverrides(){const e=this.copy();return e._overrides=null,e}readOptimizedFeatureWorldSpace(){const e=this.readGeometryWorldSpace(),t=this.readAttributes(),i=this.readCentroidWorldSpace();return new d.OptimizedFeature(e,t,i,this.getObjectId(),this.getDisplayId())}readLegacyFeatureForDisplay(){const e=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null}}readLegacyFeatureWorldSpace(){const e=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null}}readLegacyGeometryForDisplay(){const e=this.readGeometryForDisplay();return h.convertToGeometry(e,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const e=this._readX(),t=this.getInTransform();return null==t?e:e*t.scale[0]+t.translate[0]}readYWorldSpace(){const e=this._readY(),t=this.getInTransform();return null==t?e:t.translate[1]-e*t.scale[1]}readGeometryForDisplay(){const e=this._readGeometryDeltaDecoded(!0);if(!e){const e=this._createDeltaQuantizedGeometryFromServerCentroid();return e?e.deltaDecode():null}return e}readGeometryForDisplayTransformed(e){let t=this.readGeometryForDisplay();if(t&&"esriGeometryPolyline"===this.metadata.geometryType&&(t=h.generalizeOptimizedGeometry(new f,t,this.hasZ,this.hasM,this.metadata.geometryType,e.scale[0])),t&&(t=h.quantizeForDisplay(t,e,this.metadata.geometryType,this.hasZ,this.hasM)),!t){const t=this.readCentroidForDisplay();if(!t)return null;const i=c.quantizeX(e,t.coords[0]),r=c.quantizeY(e,t.coords[1]);return this._createDeltaQuantizedExtrudedGeometry(i,r).deltaDecode()}return t}readGeometryWorldSpace(){let e=this._readGeometry();if(e||(e=this._createDeltaQuantizedGeometryFromServerCentroid()),!e)return null;const t=e.clone(),i=this.getInTransform();return null!=i&&h.unquantizeOptimizedGeometry(t,t,this.hasZ,this.hasM,i),t}readCentroidForDisplay(){const e=this.readGeometryForDisplay();return e?this._computeDisplayCentroid(e):this._readServerCentroid()}readCentroidWorldSpace(){const e=this.readGeometryForDisplay(),t=e?this._computeDisplayCentroid(e):this._readServerCentroid();if(!t)return null;const i=t.clone(),r=this.getInTransform();return null!=r&&h.unquantizeOptimizedGeometry(i,i,this.hasZ,this.hasM,r),i}setCache(e){let t=this._caches.get(e);null==t&&(t=new m.FeatureSetCache(this.getSize()),this._caches.set(e,t)),this._activeCache=t}setCachedValue(e){this._activeCache.set(this.getIndex(),e)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(e){const t=this._readGeometry(e);return"esriGeometryPoint"!==this.geometryType&&t&&this.getInTransform()?t.deltaDecode():t}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(e){this._contextTimeZone=e}readArcadeFeature(){return this}hasField(e){return this.fields.has(e)||this._joined.some(t=>t.hasField(e))}geometry(){const e=this.readGeometryWorldSpace(),t=h.convertToGeometry(e,this.geometryType,this.hasZ,this.hasM),i=a.fromJSON(t);if(i){if(!this.metadata.outSpatialReference)throw new Error("InternalError: Expected spatial reference to be defined");i.spatialReference=this.metadata.outSpatialReference}return i}autocastArcadeDate(e,i){return i&&i instanceof Date?this.isUnknownDateTimeField(e)?t.ArcadeDate.unknownDateJSToArcadeDate(i):t.ArcadeDate.dateJSAndZoneToArcadeDate(i,this.contextTimeZone??p.system):i}isUnknownDateTimeField(e){return this.metadata.fieldsIndex.getTimeZone(e)===p.unknown}field(e){let i=this.fields.get(e);if(i)switch(i.type){case"date-only":case"esriFieldTypeDateOnly":return r.DateOnly.fromReader(this.readAttribute(e,!1));case"time-only":case"esriFieldTypeTimeOnly":return n.TimeOnly.fromReader(this.readAttribute(e,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return t.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(e,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(e,this.readAttribute(e,!0));default:return this.readAttribute(e,!1)}for(const s of this._joined)if(s.setIndex(this.getIndex()),i=s.fields.get(e),i)switch(i.type){case"date-only":case"esriFieldTypeDateOnly":return r.DateOnly.fromReader(s._readAttribute(e,!1));case"time-only":case"esriFieldTypeTimeOnly":return n.TimeOnly.fromReader(s._readAttribute(e,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return t.ArcadeDate.fromReaderAsTimeStampOffset(s._readAttribute(e,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(e,s._readAttribute(e,!0));default:return this.readAttribute(e,!1)}throw new Error(`Field ${e} does not exist`)}setField(e,t){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map(e=>e.name)}castToText(e=!1){if(!e)return JSON.stringify(this.readLegacyFeatureForDisplay());const t=this.readLegacyFeatureForDisplay();if(!t)return JSON.stringify(null);const i={geometry:t.geometry,attributes:{...t.attributes??{}}};for(const e in i.attributes){const t=i.attributes[e];t instanceof Date&&(i.attributes[e]=t.getTime())}return JSON.stringify(i)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(e=null){return{attributes:this._readAttributes(),geometry:!0===e?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(e=null,t=null){return Promise.resolve(this.castAsJson(t))}_getExists(){if(this._overrides){const e=this.getObjectId();return!this._overrides.hasOverride(e)}return!0}_computeDisplayCentroid(e){if(null==this.getInTransform())return u.getCentroidOptimizedGeometry(new f,e,this.hasM,this.hasZ);const t=s.GeometryCursor.fromOptimized(e,this.geometryType);t.yFactor*=-1;const i=l.getLabelPoint(t);return i?(i[1]*=-1,new f([],i)):null}copyInto(e){e._joined=this._joined,e._overrides=this._overrides,e._objectIdToIndex=this._objectIdToIndex,e._boundsBuffer=this._boundsBuffer,e._activeCache=this._activeCache,e._caches=this._caches,e._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const e=this.readGeometryWorldSpace();return h.convertToGeometry(e,this.geometryType,!1,!1)}_createDeltaQuantizedGeometryFromServerCentroid(){const e=this._readServerCentroid();if(!e)return null;const[t,i]=e.coords;return this._createDeltaQuantizedExtrudedGeometry(t,i)}_createDeltaQuantizedExtrudedGeometry(e,t){return"esriGeometryPolyline"===this.geometryType?this._createDeltaQuantizedExtrudedLine(e,t):this._createDeltaQuantizedExtrudedQuad(e,t)}_createDeltaQuantizedExtrudedQuad(e,t){return new f([5],[e-1,t,1,-1,1,1,-1,1,-1,-1])}_createDeltaQuantizedExtrudedLine(e,t){return new f([2],[e-1,t+1,1,-1])}}e.FeatureSetReader=C,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetCache":function(){define(["exports","./StaticBitSet"],function(e,t){"use strict";e.FeatureSetCache=class{constructor(e){this._valid=t.StaticBitSet.create(e),this._data=new Array(e)}has(e){return this._valid.has(e)}set(e,t){this._valid.set(e),this._data[e]=t}get(e){return this._data[e]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(e){"use strict";class t{static fromBuffer(e,i){return new t(e,i)}static create(e,i=4294967295){const r=new Uint32Array(Math.ceil(e/32));return new t(r,i)}constructor(e,t){this._mask=0,this._buf=e,this._mask=t}_getIndex(e){return Math.floor(e/32)}has(e){const t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}hasRange(e,t){let i=e,r=t;for(;i%32&&i!==r;){if(this.has(i))return!0;i++}for(;r%32&&i!==r;){if(this.has(i))return!0;r--}if(i===r)return!1;for(let e=i/32;e!==r/32;e++)if(this._buf[e])return!0;return!1}set(e){const t=this._mask&e,i=this._getIndex(t),r=1<<t%32;this._buf[i]|=r}setRange(e,t){let i=e,r=t;for(;i%32&&i!==r;)this.set(i++);for(;r%32&&i!==r;)this.set(r--);if(i!==r)for(let e=i/32;e!==r/32;e++)this._buf[e]=4294967295}unset(e){const t=this._mask&e,i=this._getIndex(t),r=1<<t%32;this._buf[i]&=4294967295^r}resize(e){const t=this._buf,i=new Uint32Array(Math.ceil(e/32));i.set(t),this._buf=i}or(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(let e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(let t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new t(this._buf.slice(),this._mask)}clear(){for(let e=0;e<this._buf.length;e++)this._buf[e]=0;return this}forEachSet(e){for(let t=0;t<this._buf.length;t++){let i=this._buf[t],r=32*t;if(i)for(;i;)1&i&&e(r),i>>>=1,r++}}countSet(){let e=0;return this.forEachSet(t=>{e++}),e}}e.StaticBitSet=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/whereUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/sql"],function(e,t,i,r){"use strict";const n=()=>i.getLogger("esri.views.2d.layers.FeatureLayerView2D"),s={getAttribute:(e,t)=>e.readAttribute(t)};e.createWhereClause=async function(e,i){try{const o=await r.parseWhereClause(e,i);return o.isStandardized||n().error(new t("sql-parse-error","expression is not standardized",{where:e})),(i,r)=>{const a=i.readArcadeFeature();try{return o.testFeatureCompiled(a,s,r.currentUser)}catch(i){return n().warn(new t("sql-runtime-error","Encountered an error when evaluating where clause",{where:e,error:i})),!0}}}catch(i){return n().warn(new t("sql-runtime-error","Encountered an error when evaluating where clause",{where:e,error:i})),e=>!0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../geometry/support/aaBoundingBox","../../../engine/webgl/DisplayId","./CachedField","./ComputedExpression","./ComputedLegacyLabelExpression","./DictionaryTemplate","./NormalizedField","./StaticBitSet","./whereUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h){"use strict";const d=()=>i.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),f=4294967295;function p(e,t,i){if(!(e.length>t))for(;e.length<=t;)e.push(i)}e.ComputedAttributeStorage=class{constructor(e){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=e}createBitset(){const e=this._bitsets.length;return this._bitsets.push(u.StaticBitSet.create(this._allocatedSize,n.displayIdTexelMask)),e+1}createDictionaryTemplateField(e,t){return new l.ComputedDictionaryTemplate(e,t)}async createComputedField(e,i=!1){if(e.expression)try{if(!this.compilationOptions)throw new Error("InternalError: Compilation options not defined");return i?await a.ComputedLegacyLabelExpression.create(e.expression,this.compilationOptions):await o.ComputedExpression.create(e.expression,this.compilationOptions)}catch(i){const r=new t("featurelayer","Failed to compile arcade expression",{error:i,expression:e.expression});return d().error(r),null}if(e.normalizationType||e.normalizationField)return new c.NormalizedField(e.field,e);if(e.field)return new s.CachedField(e.field);const r=new t("featurelayer","Unable to create computed field. No expression or field found",{info:e});return d().error(r),null}async createWhereClause(e){return e?h.createWhereClause(e,this.compilationOptions.fields):null}getBitset(e){return this._bitsets[e-1]}getComputedNumeric(e,t){return this.getComputedNumericAtIndex(e&n.displayIdTexelMask,0)}setComputedNumeric(e,t,i){return this.setComputedNumericAtIndex(e&n.displayIdTexelMask,i,0)}getComputedString(e,t){return this.getComputedStringAtIndex(e&n.displayIdTexelMask,0)}setComputedString(e,t,i){return this.setComputedStringAtIndex(e&n.displayIdTexelMask,0,i)}getComputedNumericAtIndex(e,t){const i=e&n.displayIdTexelMask;return this._ensureNumeric(t,i),this._numerics[t][i]}setComputedNumericAtIndex(e,t,i){const r=e&n.displayIdTexelMask;this._ensureNumeric(t,r),this._numerics[t][r]=i}getPackedChunkId(e){const t=e&n.displayIdTexelMask;return this._ensureInstanceId(t),this._instanceIds[t]}setPackedChunkId(e,t){const i=e&n.displayIdTexelMask;this._ensureInstanceId(i),this._instanceIds[i]=t}getComputedStringAtIndex(e,t){const i=e&n.displayIdTexelMask;return this._ensureString(t,i),this._strings[t][i]}setComputedStringAtIndex(e,t,i){const r=e&n.displayIdTexelMask;this._ensureString(t,r),this._strings[t][r]=i}getXMin(e){return this._bounds[4*(e&n.displayIdTexelMask)]}getYMin(e){return this._bounds[4*(e&n.displayIdTexelMask)+1]}getXMax(e){return this._bounds[4*(e&n.displayIdTexelMask)+2]}getYMax(e){return this._bounds[4*(e&n.displayIdTexelMask)+3]}setBounds(e,t,i=!1){const r=e&n.displayIdTexelMask;if(!i&&!this._dirtyBitset.has(e))return this._bounds[4*r]!==f;this._dirtyBitset.unset(e);const s=t.readGeometryWorldSpace();if(p(this._bounds,4*r+4,0),!s||!s.coords.length)return this._bounds[4*r]=f,this._bounds[4*r+1]=f,this._bounds[4*r+2]=f,this._bounds[4*r+3]=f,!1;let o=1/0,a=1/0,l=-1/0,c=-1/0;return s.forEachVertex((e,t)=>{o=Math.min(o,e),a=Math.min(a,t),l=Math.max(l,e),c=Math.max(c,t)}),this._bounds[4*r]=o,this._bounds[4*r+1]=a,this._bounds[4*r+2]=l,this._bounds[4*r+3]=c,!0}getBounds(e,t){const i=this.getXMin(t),n=this.getYMin(t),s=this.getXMax(t),o=this.getYMax(t);return r.fromRectValues(e,i,n,s,o),i!==f}_ensureNumeric(e,t){this._numerics[e]||(this._numerics[e]=[]),p(this._numerics[e],t,0)}_ensureInstanceId(e){p(this._instanceIds,e,0)}_ensureString(e,t){this._strings[e]||(this._strings[e]=[]),p(this._strings[e],t,null)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/CachedField":function(){define(["exports","./AComputedField"],function(e,t){"use strict";class i extends t.AComputedField{constructor(e){super(),this._field=e}resize(e){throw new Error("Method not implemented.")}read(e,t){return e.readAttribute(this._field)}readWithDefault(e,t){return e.readAttribute(this._field)}hasArcadeDependency(e){return!1}}e.CachedField=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedExpression":function(){define(["exports","../../../../../core/string","../../../../../support/ArcadeExpression","../../../arcade/callExpressionWithCursor","./AComputedField"],function(e,t,i,r,n){"use strict";class s extends n.AComputedField{static async create(e,r){const n=await i.createRendererExpression(e,r.spatialReference),o=t.numericHash(e);return new s(n,o)}constructor(e,t){super(),this._compiled=e,this._cacheKey=t}resize(e){}read(e,t){return this.hasArcadeDependency("scale")||"system"!==t.$view.timeZone?r.callExpressionWithCursor(this._compiled,e,t):this._readCached(e,t)}readWithDefault(e,t,i){return this.hasArcadeDependency("scale")||"system"!==t.$view.timeZone?r.callExpressionWithCursorWithDefault(this._compiled,e,t,i):this._readWithDefaultCached(e,t,i)}hasArcadeDependency(e){return this._compiled?.references(e)??!1}_getCacheKey(e){if(!this._compiled?.references("timeProperties"))return this._cacheKey;const{currentStart:t,currentEnd:i}=e.$view.timeProperties;return this._cacheKey+function(e,t){const i=43758.5453*Math.sin(12.9898*e+78.233*t);return i-Math.floor(i)}(t??1,i??1)}_readCached(e,t){if(e.setCache(this._getCacheKey(t)),e.hasCachedValue())return e.getCachedValue();const i=r.callExpressionWithCursor(this._compiled,e,t);return e.setCachedValue(i),i}_readWithDefaultCached(e,t,i){if(e.setCache(this._getCacheKey(t)),e.hasCachedValue())return e.getCachedValue();const n=r.callExpressionWithCursorWithDefault(this._compiled,e,t,i);return e.setCachedValue(n),n}}e.ComputedExpression=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithCursor":function(){define(["exports","../../../core/has","../../../core/Logger"],function(e,t,i){"use strict";function r(e){return null==e||e===1/0||e===-1/0||"number"==typeof e&&isNaN(e)}e.callExpressionWithCursor=function(e,t,r){if(null==e)return null;const n=t.readArcadeFeature();t.contextTimeZone=r.$view?.timeZone;try{return e.evaluate(n,r)}catch(e){return i.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}},e.callExpressionWithCursorWithDefault=function(e,t,i,n){if(null==e)return null!=n?n:null;const s=t.readArcadeFeature();t.contextTimeZone=i.$view?.timeZone;const o=e.evaluate(s,i);return r(o)?null!=n?n:null:o},e.isBadArcadeResult=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedLegacyLabelExpression":function(){define(["exports","../../../../../layers/support/labelFormatUtils","../../../../../layers/support/labelUtils","../../../arcade/callExpressionWithCursor","./AComputedField"],function(e,t,i,r,n){"use strict";class s extends n.AComputedField{static async create(e,r){const n=i.sqlToTemplateString(e);return new s(e=>n.replaceAll(/{[^}]*}/g,i=>{const r=i.slice(1,-1),n=e.metadata.fieldsIndex.get(r);if(null==n)return i;const s=e.readAttribute(r);return null==s?"":t.formatField(s,n)}))}constructor(e){super(),this._evaluator=e}resize(e){}read(e,t){return this._evaluator(e)}readWithDefault(e,t,i){const n=this._evaluator(e);return r.isBadArcadeResult(n)?i:n}hasArcadeDependency(e){return!1}}e.ComputedLegacyLabelExpression=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define(["exports","../../core/Error","../../core/Logger","../../core/sql","../../intl/date","../../intl/number","./domainUtils","./fieldUtils","./labelUtils","../../support/ArcadeExpression","../../support/arcadeExpressionUtils"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";const h=()=>i.getLogger("esri.layers.support.labelFormatUtils"),d={type:"simple",evaluate:()=>null},f={getAttribute:(e,t)=>e.field(t)};function p(e,t){if(null==e)return"";const i=t.domain;if(i)if("codedValue"===i.type||"coded-value"===i.type){const t=e;for(const e of i.codedValues)if(e.code===t)return e.name}else if("range"===i.type){const{max:r,min:n}=o.getDomainRange(t),s=+e;if(null!=n&&null!=r&&n<=s&&s<=r)return i.name}let r=e;return a.isDateField(t)?r=n.formatDate(r,n.convertDateFormatToIntlOptions("short-date")):a.isNumericField(t)&&(r=s.formatNumber(+r)),r||""}e.createLabelFunction=async function(e,i,n){if(!e||!e.symbol||!i)return d;const s=e.where,o=l.getLabelExpression(e);let m;if("arcade"===o.type){const e=u.getFieldNameFromSimpleExpression(o.expression),r=i.get(e);if(r&&(a.isIntegerField(r)||a.isNumericField(r)||a.isStringField(r)))m={type:"simple",evaluate(e){const t="attributes"in e?e.attributes?.[r.name]:e.field(r.name);return null==t?"":t.toString()}};else{const e=await c.createLabelExpression(o.expression,n);if(null==e)return d;m={type:"arcade",evaluate(r,n){try{const t="attributes"in r?e.repurposeFeature(r,i):r;t.contextTimeZone=n??null;const s=e.evaluate(t,{$view:{timeZone:n}});if(null!=s)return s.toString()}catch(e){h().error(new t("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:e,feature:r,expression:o}))}return null},needsHydrationToEvaluate:()=>null==l.getSingleFieldArcadeExpression(o.expression)}}}else m={type:"simple",evaluate:e=>o.expression.replaceAll(/{[^}]*}/g,t=>{const r=t.slice(1,-1),n=i.get(r);if(!n)return t;let s=null;return s="attributes"in e?e?.attributes?.[n.name]:e.field(n.name),null==s?"":p(s,n)})};if(s){let e;try{e=await r.parseWhereClause(s,i)}catch(e){return h().error(new t("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:s,error:e})),d}const n=m.evaluate;m.evaluate=(i,r)=>{const o="attributes"in i?void 0:f;try{if(e.testFeature(i,o))return n(i,r)}catch(e){h().error(new t("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:s,feature:i,error:e}))}return null}}return m},e.formatField=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DictionaryTemplate":function(){define(["exports","../../../../../symbols/cim/utils","./AComputedField"],function(e,t,i){"use strict";class r extends i.AComputedField{constructor(e,i){super(),this._template=e,this._parts=t.analyzeTextParts(e.template,i)}resize(e){}read(e,i){return t.getTextValuesFromFeatureHandle(e,this._parts,this._template.textCase)}readWithDefault(e,i,r){return t.getTextValuesFromFeatureHandle(e,this._parts,this._template.textCase)}hasArcadeDependency(e){return!1}}e.ComputedDictionaryTemplate=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/NormalizedField":function(){define(["exports","./AComputedField"],function(e,t){"use strict";class i extends t.AComputedField{constructor(e,t){super(),this._field=e,this._normalizationInfo=t}resize(e){throw new Error("Method not implemented.")}read(e,t){return this._readNormalized(e)}readWithDefault(e,t){return this._readNormalized(e)}hasArcadeDependency(e){return!1}_readNormalized(e){const t=e.readAttribute(this._field);if(null==t)return null;const{normalizationField:i,normalizationTotal:r,normalizationType:n}=this._normalizationInfo,s=e.readAttribute(i);switch(n??"esriNormalizeByField"){case"esriNormalizeByField":return s?s?t/s:void 0:null;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return r?t/r*100:null}}}e.NormalizedField=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureMetadata":function(){define(["exports","../../../../../geometry/SpatialReference","../../../../../layers/support/FieldsIndex"],function(e,t,i){"use strict";class r{static minimal(e,t,n=[]){return new r({geometryType:e,fieldsIndex:new i(n).toJSON(),featureIdInfo:{type:"object-id",fieldName:t},subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,outSpatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null})}static createFeature(e){return new r(e)}constructor(e){let r;this._options=e,this._fieldsIndex=i.fromJSON(e.fieldsIndex),e.spatialReference&&(this._spatialReference=t.fromJSON(e.spatialReference)),e.outSpatialReference&&(this._outSpatialReference=t.fromJSON(e.outSpatialReference)),"object-id"===e.featureIdInfo.type&&(r=e.featureIdInfo.fieldName),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:r,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0,datesInUnknownTimezone:this._options.timeReferenceUnknownClient??void 0,dateFieldsTimeZone:this._options.dateFieldsTimeZone??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get featureIdInfo(){return this._options.featureIdInfo}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get outSpatialReference(){return this._outSpatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}weakCloneWithAdditionalFields(e){return new r({fieldsIndex:{fields:[...this._fieldsIndex.fields,...e],timeZoneByFieldName:null},geometryType:this.geometryType,globalIdField:this.globalIdField,featureIdInfo:this.featureIdInfo,spatialReference:this.spatialReference,outSpatialReference:this.outSpatialReference,subtypeField:this.subtypeField,subtypes:this._options.subtypes,timeInfo:this.timeInfo,timeReferenceUnknownClient:this.timeReferenceUnknownClient,dateFieldsTimeZone:this._options.dateFieldsTimeZone,typeIdField:this._options.typeIdField,types:this._options.types})}}class n extends r{static createGraphics(e){return new n({fieldsIndex:(new i).toJSON(),featureIdInfo:{type:"object-id",fieldName:"uid"},geometryType:null,spatialReference:e,outSpatialReference:e,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null})}}e.FeatureMetadata=r,e.GraphicsMetadata=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/GraphicsReader":function(){define(["exports","../../../../../geometry/support/centroid","../../../../../geometry/support/jsonUtils","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry","../../../engine/webgl/definitions","./FeatureSetReader"],function(e,t,i,r,n,s,o){"use strict";class a extends o.FeatureSetReader{static from(e,t,i){return new a(e,t,i)}constructor(e,t,i){super(i),this._items=e,this._tile=t,this._index=-1,this._cachedGeometry=null;const r=t.lod;r.wrap&&(this._wrappingInfo={worldSizeX:r.worldSize[0]})}get _current(){return this._items[this._index]}getItem(){return this._current}getZOrder(){return this._current.zOrder}getMeshWriters(){return this._current.symbolResource?.symbolInfo.meshWriters??[]}hasField(e){return null!=this._current.attributes[e]}field(e){return this.readAttribute(e)}get geometryType(){const e=i.getJsonType(this._current.geometry);return"esriGeometryPoint"===e?"esriGeometryMultipoint":e}getCursor(){return this.copy()}copy(){const e=new a(this._items,this._tile,this.metadata);return this.copyInto(e),e}copyInto(e){super.copyInto(e),e._cachedGeometry=this._cachedGeometry,e._index=this._index}get fields(){throw new Error("Fields reading not supported to graphics.")}get hasFeatures(){return!!this._items.length}get hasNext(){return this._index+1<this._items.length}get exceededTransferLimit(){throw new Error("InternalError: exceededTransferLimit not implemented for graphics.")}get hasZ(){return!1}get hasM(){return!1}get usedMemory(){return this._current.usedMemory}getInTransform(){return this._tile.transform}getSize(){return this._items.length}getAttributeHash(){let e="";for(const t in this._current.attributes)e+=this._current.attributes[t];return e}getObjectId(){return this._items[this._index].objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){throw new Error("InternalError: Setting displayId not supported for graphics.")}setIndex(e){this._index=e}getIndex(){return this._index}next(){for(this._cachedGeometry=null;++this._index<this._items.length&&!this._getExists(););return this._index<this._items.length}readGeometryArea(){throw new Error("InternalError: readGeometryArea not supported for graphics.")}_readGeometry(){if(!this._cachedGeometry){let e=r.convertFromGeometry(this._current.projectedGeometry,this.hasZ,this.hasM);if("esriGeometryPolyline"===this.geometryType&&(e=r.generalizeOptimizedGeometry(new n,e,this.hasZ,this.hasM,this.geometryType,this._tile.transform.scale[0])),this._cachedGeometry=r.quantizeOptimizedGeometry(new n,e,this.hasZ,this.hasM,this.geometryType,this._tile.transform),!this._cachedGeometry)return null;this._wrapGeometry(this._cachedGeometry)}return this._cachedGeometry}_wrapGeometry(e){if(!this._wrappingInfo)return;const{worldSizeX:t}=this._wrappingInfo;if(e.isPoint)return 1===t?(e.coords.push(s.tileSize,0),e.coords.push(2*-s.tileSize,0),void e.lengths.push(3)):2===t?(e.coords.push(2*s.tileSize,0),e.coords.push(4*-s.tileSize,0),void e.lengths.push(3)):void this._wrapVertex(e.coords,0,2,t);if("esriGeometryMultipoint"!==this.geometryType);else{if(1===t){const t=e.coords.slice();t[0]-=512;const i=e.coords.slice();i[0]+=512,e.coords.push(...t,...i);const r=e.lengths[0];return void e.lengths.push(r,r)}this._wrapVertex(e.coords,0,2,t)}}_wrapVertex(e,t,i,r){const n=t*i,o=e[n];o<-s.tileSize*(r-2)?e[n]=o+s.tileSize*r:o>s.tileSize*(r-1)&&(e[n]=o-s.tileSize*r)}_readX(){const e=this._readGeometry();return null!=e?e.coords[0]:0}_readY(){const e=this._readGeometry();return null!=e?e.coords[1]:0}_readServerCentroid(){switch(this.geometryType){case"esriGeometryPolygon":{const e=t.polygonCentroid(this._current.projectedGeometry),i=new n([],e);return r.quantizeOptimizedGeometry(new n,i,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}case"esriGeometryPolyline":{const e=this._current.projectedGeometry,i=t.ringsCentroid(e.paths,this.hasZ),s=new n([],i);return r.quantizeOptimizedGeometry(new n,s,this.hasZ,this.hasM,this.geometryType,this._tile.transform)}}return null}_readAttribute(e,t){const i=this._current.attributes[e];if(void 0!==i)return i;const r=e.toLowerCase();for(const e in this._current.attributes)if(e.toLowerCase()===r)return this._current.attributes[e]}_readAttributes(){return this._current.attributes}}e.GraphicsReader=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicStore":function(){define(["../../../../core/has","../../../../core/screenUtils","../../../../chunks/rbush","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/normalizeUtils","../../../../geometry/support/spatialReferenceUtils","../../../../symbols/cim/CIMSymbolDrawHelper","../../../../symbols/cim/CIMSymbolHelper","../../engine/webgl/definitions","./GraphicStoreItem","./graphicsUtils","./GraphicUpdateMessage"],function(e,t,i,r,n,s,o,a,l,c,u,h){"use strict";const d=1e-5;function f(e,t){return t.zOrder-e.zOrder}return class{constructor(e,t,i,r,n){this._items=new Map,this._boundsDirty=!1,this._outSpatialReference=e,this._cimResourceManager=t,this._hittestDrawHelper=new o.HittestDrawHelper(t),this._tileInfoView=i,this._store=n;const s=i.getClosestInfoForScale(r);this._resolution=this._tileInfoView.getTileResolution(s.level)}destroy(){this._hittestDrawHelper.destroy()}items(){return this._items.values()}getItem(e){return this._items.get(e)}async update(e,t,i){const r=[],n=[],s=[],o=new Set,a=[];let l=0;for(const s of e.items){l++;const e=s.uid,u=this._items.get(e),h=t(s);if(o.add(e),u){const e=u.update(s,h,l),t=u.updateDensificationResolution(this._resolution);e&&a.push(this._updateItem(u,i)),(e||t)&&n.push(u);continue}const d=this._store.createDisplayIdForObjectId(e),f=c.GraphicStoreItem.fromGraphic(s,h,l,d);f.updateDensificationResolution(this._resolution),a.push(this._updateItem(f,i)),this._items.set(f.objectId,f),r.push(f)}for(const[e,t]of this._items.entries())o.has(e)||(this._store.releaseDisplayIdForObjectId(e),this._items.delete(e),s.push(t));return await Promise.all(a),this._index=null,new h.GraphicUpdateMessage(r,n,s)}updateLevel(e){if(this._resolution===e)return!1;this._index=null,this._boundsDirty=!0,this._resolution=e;for(const e of this.items())if(e.hasCurvedGeoemtry)return!0;return!1}hitTest(t,i,s,o,a){const c=e("esri-mobile"),h=c?l.hittestToleranceMobile:l.hittestToleranceDesktop,d=h+(c?0:l.hittestToleranceSmallSymbol);t=n.normalizeMapX(t,this._tileInfoView.spatialReference);const p=o*window.devicePixelRatio*d,m=r.create();m[0]=t-p,m[1]=i-p,m[2]=t+p,m[3]=i+p;const g=o*window.devicePixelRatio*h,_=r.create();_[0]=t-g,_[1]=i-g,_[2]=t+g,_[3]=i+g;const y=.5*o*(d+u.pixelBuffer),x=this._searchIndex(t-y,i-y,t+y,i+y);if(!x||0===x.length)return[];const b=[],v=r.create(),S=r.create();for(const e of x){if(!e.visible)continue;const{geometryBounds:t,symbolResource:i}=e;this._getSymbolBounds(v,i,t,S,a),S[3]=S[2]=S[1]=S[0]=0,r.intersects(v,m)&&b.push(e)}if(0===b.length)return[];const w=this._hittestDrawHelper,T=[];for(const e of b){const{projectedGeometry:t,symbolResource:i}=e;if(!i)continue;const{textInfo:r,symbolInfo:n}=i,s=n.cimSymbol;w.hitTest(_,s.symbol,t,r,a,o)&&T.push(e)}return T.sort(f),T.map(e=>e.objectId)}queryItems(e){return 0===this._items.size?[]:this._searchForItems(e)}clear(){this._items.clear(),this._index=null}async _updateItem(e,t){await e.projectAndNormalize(this._outSpatialReference),await t(e);const{size:i}=e;i[0]=i[1]=i[2]=i[3]=0,this._getSymbolBounds(e.symbolBounds,e.symbolResource,e.geometryBounds,e.size,0)}_searchIndex(e,t,r,n){return this._boundsDirty&&(this._items.forEach(e=>this._getSymbolBounds(e.symbolBounds,e.symbolResource,e.geometryBounds,e.size,0)),this._boundsDirty=!1),this._index||(this._index=i.rbush(9,e=>({minX:e.symbolBounds[0],minY:e.symbolBounds[1],maxX:e.symbolBounds[2],maxY:e.symbolBounds[3]})),this._index.load(Array.from(this._items.values()))),this._index.search({minX:e,minY:t,maxX:r,maxY:n})}_searchForItems(e){const t=this._tileInfoView.spatialReference,i=e.bounds,n=s.getInfo(t);if(n&&t.isWrappable){const[t,s]=n.valid,o=Math.abs(i[2]-s)<d,a=Math.abs(i[0]-t)<d;if((!o||!a)&&(o||a)){const n=e.resolution;let a;a=o?r.create([t,i[1],t+n*u.pixelBuffer,i[3]]):r.create([s-n*u.pixelBuffer,i[1],s,i[3]]);const l=this._searchIndex(i[0],i[1],i[2],i[3]),c=this._searchIndex(a[0],a[1],a[2],a[3]);return[...new Set([...l,...c])]}}return this._searchIndex(i[0],i[1],i[2],i[3])}_getSymbolBounds(e,i,n,s,o){if(!i||!i.symbolInfo.linearCIM)return null;if(e||(e=r.create()),r.copy(e,n),!s||0===s[0]&&0===s[1]&&0===s[2]&&0===s[3]){const{textInfo:e,symbolInfo:r}=i,n=r.cimSymbol;s||(s=[0,0,0,0]);const l=a.CIMSymbolInflatedSizeHelper.getSymbolInflateSize(s,n.symbol,this._cimResourceManager,o,e);s[0]=t.pt2px(l[0]),s[1]=t.pt2px(l[1]),s[2]=t.pt2px(l[2]),s[3]=t.pt2px(l[3])}const l=this._resolution,c=a.CIMSymbolInflatedSizeHelper.safeSize(s);return e[0]-=c*l,e[1]-=c*l,e[2]+=c*l,e[3]+=c*l,e}}})},"esri/views/2d/layers/graphics/GraphicStoreItem":function(){define(["exports","../../../../core/memoryEstimations","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/boundsUtils","../../../../geometry/support/coordsUtils","../../../../geometry/support/jsonUtils","../../../../geometry/support/normalizeUtilsSync","../../../../geometry/support/curves/curveUtils","../../../../geometry/support/curves/densifyCurvedGeometry","../../../../layers/graphics/dehydratedFeatures","../../../../layers/graphics/data/projectionSupport","./densificationConstants","./graphicsUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d){"use strict";class f{static fromGraphic(e,t,i,r){return new f(e.geometry,t,e.attributes,e.visible,e.uid,e.version,i,r)}constructor(e,t,r,n,s,o,a,l){this.geometry=e,this.symbol=t,this.attributes=r,this.visible=n,this.objectId=s,this._version=o,this.zOrder=a,this.displayId=l,this.symbolBounds=i.empty(),this.prevSymbolBounds=i.empty(),this.size=[0,0,0,0],this.geometryBounds=i.empty(),this._isDensificationDirty=!1,this._densificationDeviation=1/0}get projectedGeometry(){return this._projectedGeometry}get linearCIM(){return this.symbolResource?.symbolInfo.linearCIM}get usedMemory(){return 128+t.estimateAttributesMemory(this.attributes)+c.estimateGeometryMemory(this.geometry)}get hasAnimations(){const{linearCIM:e}=this;return!!e&&e.some(e=>"animationParams"in e&&!!e.animationParams)}get hasCurvedGeoemtry(){return null!=this.geometry&&"mesh"!==this.geometry.type&&a.isCurvedGeometry(this.geometry)}update(e,t,r){return(this._version!==e.version||this.zOrder!==r||this.symbol!==t)&&(this.prevSymbolBounds=this.symbolBounds,this.symbolBounds=i.empty(),this.zOrder=r,this.geometry=e.geometry,this.attributes=e.attributes,this.symbol=t,this.visible=e.visible,this._version=e.version,this.symbolResource=null,this._projectedGeometry=null,i.empty(this.geometryBounds),this._minDensificationDeviation=null,this._isDensificationDirty=!0,!0)}updateDensificationResolution(e){if(!this.hasCurvedGeoemtry)return!1;const t=Math.max(function(e){return 2**Math.round(Math.log2(e))*h.getMaxDeviationInPixels()}(e),this._minDensificationDeviation??0);return t!==this._densificationDeviation&&(this._densificationDeviation=t,this._isDensificationDirty=!0,!0)}async projectAndNormalize(e){let t,n=this.geometry;if(n&&n.spatialReference&&"mesh"!==n.type&&("extent"===n.type&&(n=d.polygonFromExtent(n)),t=a.isCurvedGeometry(n)?l.densifyCurvedGeometry(n,{maxSegmentLength:1/0,minSegmentsPerCurve:h.getCoarseSegmentsPerCurve()}):n.toJSON(),this._projectedGeometry=await p(t,n.spatialReference,e),r.getBoundsXY(this.geometryBounds,this._projectedGeometry),this.hasCurvedGeoemtry&&null!=this._projectedGeometry)){const e=i.width(this.geometryBounds),t=i.height(this.geometryBounds);this._minDensificationDeviation=function(e,t){if(e>0&&t>0){const i=Math.min(e,t)/2,r=2*Math.PI/h.getApproximateMaxDensificationSegments();return i*(1-Math.cos(r/2))}return null}(e,t)}}async densifyCurvedGeometryForDisplay(e){if(!this.hasCurvedGeoemtry||!this._isDensificationDirty)return;this._isDensificationDirty=!1;const t=this.geometry;if(!t||!t.spatialReference||"mesh"===t.type)return;const i=e.metersPerUnit/t.spatialReference.metersPerUnit,r=this._densificationDeviation*i,n=l.densifyCurvedGeometry(t,{maxDeviation:r,minSegmentsPerCurve:h.getMinSegmentsPerCurve()});this._projectedGeometry=await p(n,t.spatialReference,e)}}async function p(e,t,i){await u.checkProjectionSupport(e.spatialReference,i);const r=o.normalizeCentralMeridianForDisplay(e);if(!r)return;const a=u.project(r,t,i);return a&&n.closeRingsAndFixWinding(a),s.isExtent(a)?d.polygonFromExtent(a):a}e.GraphicStoreItem=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsSync":function(){define(["exports","../../core/support/jsonUtils","./aaBoundingRect","./boundsUtils","./coordsUtils","./jsonUtils","./normalizeUtilsCommon","./spatialReferenceUtils"],function(e,t,i,r,n,s,o,a){"use strict";function l(e,i){if(null==e)return null;const n=e.spatialReference,l=a.getInfo(n),d=t.isSerializable(e)?e.toJSON():e;if(!l)return d;const g=a.isWebMercator(n)?102100:4326,_=o.cutParams[g].maxX,y=o.cutParams[g].minX;if(s.isPoint(d))return c(d,_,y);if(s.isMultipoint(d))return d.points=d.points.map(e=>c(e,_,y)),d;if(s.isExtent(d))return function(e,t){if(!t)return e;const i=function(e,t){const i=[],{ymin:r,ymax:n,xmin:s,xmax:o}=e,a=e.xmax-e.xmin,[l,c]=t.valid,{x:d,frameId:f}=u(e.xmin,t),{x:m,frameId:g}=u(e.xmax,t),_=d===m&&a>0;if(a>2*c){const e={xmin:s<o?d:m,ymin:r,xmax:c,ymax:n},t={xmin:l,ymin:r,xmax:s<o?m:d,ymax:n},a={xmin:0,ymin:r,xmax:c,ymax:n},u={xmin:l,ymin:r,xmax:0,ymax:n},_=[],y=[];h(e,a)&&_.push(f),h(e,u)&&y.push(f),h(t,a)&&_.push(g),h(t,u)&&y.push(g);for(let e=f+1;e<g;e++)_.push(e),y.push(e);i.push(new p(e,[f]),new p(t,[g]),new p(a,_),new p(u,y))}else d>m||_?i.push(new p({xmin:d,ymin:r,xmax:c,ymax:n},[f]),new p({xmin:l,ymin:r,xmax:m,ymax:n},[g])):i.push(new p({xmin:d,ymin:r,xmax:m,ymax:n},[f]));return i}(e,t).map(e=>e.extent);return i.length<2?i[0]||e:i.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}}(d,l);if(s.isPolygon(d)||s.isPolyline(d)){const e=r.getBoundsXY(m,d),t={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},n=o.offsetMagnitude(t.xmin,y)*(2*_),s=0===n?d:o.updatePolyGeometry(d,n);return t.xmin+=n,t.xmax+=n,t.xmax>_?f(s,_,i):t.xmin<y?f(s,y,i):s}return d}function c(e,t,i){if(Array.isArray(e)){const r=e[0];if(r>t){const i=o.offsetMagnitude(r,t);e[0]=r+i*(-2*t)}else if(r<i){const t=o.offsetMagnitude(r,i);e[0]=r+t*(-2*i)}}else{const r=e.x;if(r>t){const i=o.offsetMagnitude(r,t);e.x+=i*(-2*t)}else if(r<i){const t=o.offsetMagnitude(r,i);e.x+=t*(-2*i)}}return e}function u(e,t){const[i,r]=t.valid,n=2*r;let s,o=0;return e>r?(s=Math.ceil(Math.abs(e-r)/n),e-=s*n,o=s):e<i&&(s=Math.ceil(Math.abs(e-i)/n),e+=s*n,o=-s),{x:e,frameId:o}}function h(e,t){const{xmin:i,ymin:r,xmax:n,ymax:s}=t;return d(e,i,r)&&d(e,i,s)&&d(e,n,s)&&d(e,n,r)}function d(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function f(e,t,i=!0){const r=!s.isPolyline(e);if(r&&n.closeRings(e),i)return(new g).cut(e,t);const o=r?e.rings:e.paths,a=r?4:2,l=o.length,c=-2*t;for(let e=0;e<l;e++){const t=o[e];if(t&&t.length>=a){const e=[];for(const i of t)e.push([i[0]+c,i[1]]);o.push(e)}}return r?e.rings=o:e.paths=o,e}class p{constructor(e,t){this.extent=e,this.frameIds=t}}const m=i.create();class g{constructor(){this._linesIn=[],this._linesOut=[]}cut(e,t){let i;if(this._xCut=t,e.rings)this._closed=!0,i=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,i=e.paths,this._minPts=2}for(const e of i){if(!e||e.length<this._minPts)continue;let t=!0;for(const i of e)t?(this.moveTo(i),t=!1):this.lineTo(i);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),i=[];for(const e of this._linesIn)e&&e.length>=this._minPts&&i.push(e);const r=-2*this._xCut;for(const e of this._linesOut)if(e&&e.length>=this._minPts){for(const t of e)t[0]+=r;i.push(e)}return this._closed?e.rings=i:e.paths=i,e}moveTo(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}lineTo(e){const t=this._side(e[0]);if(t*this._prevSide===-1){const i=this._intersect(this._prevPt,e);this._lineTo(this._xCut,i,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}close(){const e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(e,t,i){this._closed?(this._lineIn.push([i<=0?e:this._xCut,t]),this._lineOut.push([i>=0?e:this._xCut,t])):(i<=0&&this._lineIn.push([e,t]),i>=0&&this._lineOut.push([e,t]))}_lineTo(e,t,i){this._closed?(_(this._lineIn,i<=0?e:this._xCut,t),_(this._lineOut,i>=0?e:this._xCut,t)):i<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):i>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}_checkClosingPt(e){const t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}_side(e){return e<this._xCut?-1:e>this._xCut?1:0}_intersect(e,t){const i=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+i*(t[1]-e[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function _(e,t,i){const r=e.length;r>1&&e[r-1][0]===t&&e[r-2][0]===t?e[r-1][1]=i:e.push([t,i])}e.CutVertical=g,e.normalizeCentralMeridianForDisplay=function(e){return l(e,!1)},e.normalizeCentralMeridianSync=function(e){return l(e,!0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/curves/curveUtils":function(){define(["exports"],function(e){"use strict";function t(e){return"b"in e}function i(e){return"c"in e}function r(e){return Array.isArray(e)}function n(e){return"a"in e}function s(e){return"a"in e&&4===e.a.length}function o(e){return"a"in e&&7===e.a.length}e.cloneCurve=function(e){if(t(e)){const[t,i,r]=e.b;return{b:[[...t],[...i],[...r]]}}if(i(e)){const[t,i]=e.c;return{c:[[...t],[...i]]}}if(r(e))return[...e];if(s(e)){const[t,i,r,n]=e.a;return{a:[[...t],[...i],r,n]}}if(o(e)){const[t,i,r,n,s,o,a]=e.a;return{a:[[...t],[...i],r,n,s,o,a]}}return e},e.getCurves=function(e){return"curveRings"in e?e.curveRings:e.curvePaths},e.getEndpoint=function(e){return t(e)?e.b[0]:i(e)?e.c[0]:n(e)?e.a[0]:e},e.isBezierCurve=t,e.isCircularArc=i,e.isCoordinate=r,e.isCurvedGeometry=function(e){return"curveRings"in e&&!!e.curveRings?.length||"curvePaths"in e&&!!e.curvePaths?.length},e.isEllipticArc=n,e.isEllipticArc4=s,e.isEllipticArc7=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/curves/densifyCurvedGeometry":function(){define(["exports","./bezierCurveUtils","./circularArcUtils","./curveUtils","./ellipticArc4Utils","./ellipticArc7Utils","./mathUtils"],function(e,t,i,r,n,s,o){"use strict";const a={maxSegmentLength:1/0,maxDeviation:1/0,maxSegmentsPerCurve:12e3,minSegmentsPerCurve:1},l=1e-6,c=[0,0];class u{constructor(e,t){this.curveStart=e,this.curveEnd=t,this.tStart=0,this.tEnd=0,this.tEndStack=[],this.arcEndStack=[]}get stackSize(){return this.tEndStack.length}initialize(e,t){this.tStart=0,this.arcStart=e,this.tEndStack.push(1),this.arcEndStack.push(t)}splitAt(e){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(e),this.arcEndStack.push(this.interpolate(e))}splitInHalf(){return this.splitAt((this.tStart+this.tEnd)/2)}pop(){this.tEnd=this.tEndStack.pop(),this.arcEnd=this.arcEndStack.pop()}next(){this.tStart=this.tEnd,this.arcStart=this.arcEnd}densify(e,{maxDeviation:t,maxSegmentLength:i,maxSegmentsPerCurve:r,minSegmentsPerCurve:n}){const s=i*i,a=t*t,c=1/r,u=this.interpolate(0),h=this.interpolate(1);o.distance2(this.curveStart,u)>l&&e.push(u),this.initialize(u,h);const d=1/n;for(let e=n-1;e>0;e--){const t=e*d;this.pop(),this.splitAt(t)}for(;this.stackSize>0;)this.pop(),this.tStart===this.tEnd||this.tEnd-this.tStart<c||(0===s||!isFinite(s)||o.distance2(this.arcStart,this.arcEnd)<s)&&(0===a||!isFinite(a)||this.getDeviation2()<a)?(e.push(this.arcEnd),this.next()):this.splitInHalf();return o.distance2(this.curveEnd,h)>l&&e.push([...this.curveEnd]),e}}class h extends u{constructor(e,t){const[i,r,n]=t.b;super(e,i),this._controlPointsStack=[],this._curveControlPoints=[r,n],this._arcControlPoints=[r,n],this._controlPointsStack.push(this._arcControlPoints)}splitAt(e){const{arcStart:t,arcEnd:i,tStart:r,tEnd:n}=this,[s,a]=this._arcControlPoints,l=(e-r)/(n-r),u=o.interpolateSegment([],t,s,l),h=o.interpolateSegment(c,s,a,l),d=o.interpolateSegment([],a,i,l),f=o.interpolateSegment([],u,h,l),p=o.interpolateSegment([],h,d,l),m=o.interpolateSegment([],f,p,l);this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this._controlPointsStack.push([p,d]),this.tEndStack.push(e),this.arcEndStack.push(m),this._arcControlPoints[0]=u,this._arcControlPoints[1]=f,this._controlPointsStack.push(this._arcControlPoints)}pop(){super.pop(),this._arcControlPoints=this._controlPointsStack.pop()}interpolate(e){const{curveStart:i,curveEnd:r}=this,[n,s]=this._curveControlPoints;return t.interpolateCubicBezier(i,n,s,r,e)}getDeviation2(){const{arcStart:e,arcEnd:t}=this,[i,r]=this._arcControlPoints;return Math.max(o.pointToSegmentDistance2(i,e,t),o.pointToSegmentDistance2(r,e,t))}}class d extends u{constructor(e,t){const[i]=t.a;super(e,i),this._derivedEllipse=s.deriveEllipse(e,t)}pop(){super.pop(),this._tMid=(this.tStart+this.tEnd)/2,this._arcMid=this.interpolate(this._tMid)}splitInHalf(){this.tEndStack.push(this.tEnd),this.arcEndStack.push(this.arcEnd),this.tEndStack.push(this._tMid),this.arcEndStack.push(this._arcMid)}interpolate(e){return s.interpolateEllipse(this._derivedEllipse,e)}getDeviation2(){return o.pointToSegmentDistance2(this._arcMid,this.arcStart,this.arcEnd)}}function f(e,t,i,{cx:r,cy:n,radius:s,thetaStart:a,thetaEnd:c,isInvalid:u},{maxDeviation:h,maxSegmentLength:d,maxSegmentsPerCurve:f,minSegmentsPerCurve:p}){if(u)return e.push([...i]),e;const m=2*s,g=[r+s*Math.cos(a),n+s*Math.sin(a)],_=[r+s*Math.cos(c),n+s*Math.sin(c)];o.distance2(t,g)>l&&e.push(g);const y=Math.abs(c-a),x=d<m?2*Math.asin(d/m):y,b=h<=s?2*Math.acos(1-h/s):y,v=Math.min(x,b),S=Math.min(f,Math.max(p,Math.ceil(Math.abs(y/v)))),w=1/S;for(let t=1;t<S;t++){const i=t*w,o=a*(1-i)+c*i;e.push([r+s*Math.cos(o),n+s*Math.sin(o)])}return e.push(_),o.distance2(i,_)>l&&e.push([...i]),e}function p(e,t,s,o){return r.isCoordinate(s)?(e.push([...s]),e):r.isBezierCurve(s)?function(e,t,i,r){return new h(t,i).densify(e,r)}(e,t,s,o):r.isCircularArc(s)?function(e,t,r,n){const s=i.deriveCircleFromCircularArc(t,r),[o]=r.c;return f(e,t,o,s,n)}(e,t,s,o):r.isEllipticArc4(s)?function(e,t,i,r){const s=n.deriveCircleFromEllipticArc4(t,i),[o]=i.a;return f(e,t,o,s,r)}(e,t,s,o):function(e,t,i,r){const[n,s,o,a,l,c,u]=i.a;return 0===c||0===u?(e.push([...n]),e):new d(t,i).densify(e,r)}(e,t,s,o)}e.densifyCurvedGeometry=function(e,t){if(!r.isCurvedGeometry(e))return e;const i=r.getCurves(e),n=[];for(const e of i){const i=[];for(let n=0,s=1;s<e.length;n=s++){const o=[...r.getEndpoint(e[n])];0===n&&i.push(o),p(i,o,e[s],{maxSegmentLength:t.maxSegmentLength??a.maxSegmentLength,maxDeviation:t.maxDeviation??a.maxDeviation,maxSegmentsPerCurve:t.maxSegmentsPerCurve??a.maxSegmentsPerCurve,minSegmentsPerCurve:Math.max(t.minSegmentsPerCurve??a.minSegmentsPerCurve,1)})}n.push(i)}return"curvePaths"in e?{paths:n,spatialReference:e.spatialReference}:{rings:n,spatialReference:e.spatialReference}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/curves/bezierCurveUtils":function(){define(["exports","../../../core/mathUtils","../aaBoundingRect","./mathUtils"],function(e,t,i,r){"use strict";const n=[0,0];function s(e,t,i,r,n){const s=1-n,o=s*s,a=n*n,l=o*s,c=3*n*o,u=3*a*s,h=a*n;return[e[0]*l+t[0]*c+i[0]*u+r[0]*h,e[1]*l+t[1]*c+i[1]*u+r[1]*h]}function o(e,t,i){const s=e,[o,a,l]=t.b,c=r.interpolateSegment([0,0],s,a,i),u=r.interpolateSegment(n,a,l,i),h=r.interpolateSegment([0,0],l,o,i),d=r.interpolateSegment([0,0],c,u,i),f=r.interpolateSegment([0,0],u,h,i);return[{b:[r.interpolateSegment([],d,f,i),c,d]},{b:[[...o],f,h]}]}e.bezierCurveExtent=function(e,t,r){const n=t,[s,o,a]=r.b;return i.expandPointInPlace(e,n),i.expandPointInPlace(e,o),i.expandPointInPlace(e,a),i.expandPointInPlace(e,s),e},e.bezierCurveLength=function(e,t,i){let n=0,s=[t];for(let t=0;t<16;t++){let t=e;const a=[];for(const e of s)a.push(...o(t,e,.5)),t=e.b[0];s=a,t=e,n=0;let l=0;for(const e of s){const[i,s,o]=e.b,a=Math.sqrt(r.distance2(t,i));n+=(a+(Math.sqrt(r.distance2(t,s))+Math.sqrt(r.distance2(s,o))+Math.sqrt(r.distance2(o,i))))/2,l+=a,t=i}if(n-l<i)return n}return n},e.closestPointsOnBezierCurve=function(e,i,n){const o=e,[a,l,c]=i.b,u=r.findClosestAndFurthestCurveParametersToPoint(n,[.1,.5,.9],e=>{const t=1-e,[i,r]=s(o,l,c,a,e);return[i,r,3*t*t*(l[0]-o[0])+6*t*e*(c[0]-l[0])+3*e*e*(a[0]-c[0]),3*t*t*(l[1]-o[1])+6*t*e*(c[1]-l[1])+3*e*e*(a[1]-c[1]),6*t*(c[0]-2*l[0]+o[0])+6*e*(a[0]-2*c[0]+l[0]),6*t*(c[1]-2*l[1]+o[1])+6*e*(a[1]-2*c[1]+l[1])]}).map(e=>Math.min(1,Math.max(0,e)));u.push(0,1);let h=1/0;const d=u.map(e=>{const t=s(o,l,c,a,e),[i,r]=t,u=n[0]-i,d=n[1]-r,f=Math.sqrt(u*u+d*d);return h=Math.min(f,h),{t:e,curvePoint:t,distance:f}}),f=[];for(const e of d){const{t:i,distance:r}=e;t.floatEqualRelative(r,h)&&!f.some(({t:e})=>t.floatEqualAbsolute(e,i))&&f.push(e)}return f},e.interpolateBezierCurve=function(e,t,i){const r=e,[n,o,a]=t.b;return s(r,o,a,n,i)},e.interpolateCubicBezier=s,e.splitBezierCurve=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/curves/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../core/libs/gl-matrix-2/math/vec2"],function(e,t,i){"use strict";function r(e,t){return i.squaredDistance(e,t)}e.correctSweepAndWinding=function(e,i,r){const[n,s,o,a]=r.a,l=Math.abs(e-i),c=l>Math.PI,u=l<Math.PI,h=t.floatEqualAbsolute(l,Math.PI);return(!h&&(c&&o||u&&!o)||h&&(e>i&&a||e<i&&!a))&&(e+=2*(Math.sign(i-e)||1)*Math.PI),e},e.distance2=r,e.findClosestAndFurthestCurveParametersToPoint=function(e,t,i,r=10){return t.map(t=>{let n=t;for(let t=0;t<r;t++){const[t,r,s,o,a,l]=i(n),c=e[0]-t,u=e[1]-r,h=-s,d=-o;n+=-(2*c*h+2*u*d)/(2*h*h+2*c*-a+2*d*d+2*u*-l||1e-6)}return n})},e.interpolateSegment=function(e,t,i,r){return e[0]=t[0]*(1-r)+i[0]*r,e[1]=t[1]*(1-r)+i[1]*r,e},e.intersectLineLine=function(e,t,i,r,n){const[s,o]=t,[a,l]=i,[c,u]=r,[h,d]=n,f=(s-a)*(u-d)-(o-l)*(c-h);if(0===f)return null;const p=(s*l-o*a)*(c-h)-(s-a)*(c*d-u*h),m=(s*l-o*a)*(u-d)-(o-l)*(c*d-u*h);return e[0]=p/f,e[1]=m/f,e},e.matchWindingAndWrap=function(e,t,i){const r=2*Math.PI,n=e-t;return(i-t)*n<0?e-=(Math.trunc(n/r)+Math.sign(n))*r:n>=r&&(e-=Math.trunc(n/r)*r),e},e.pointToSegmentDistance2=function(e,t,i){const n=r(t,i);if(0===n)return r(t,e);const s=(t[0]-e[0])*(i[1]-e[1])-(t[1]-e[1])*(i[0]-e[0]);return s*s/n},e.wrapAtan2=function(e,t){const i=Math.atan2(e,t);return i<0?i+2*Math.PI:i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/curves/circularArcUtils":function(){define(["exports","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f64","./circleUtils","./mathUtils"],function(e,t,i,r,n){"use strict";const s=i.create();e.deriveCircleFromCircularArc=function(e,i){const[o,a]=i.c,l=function(e,i,r){const[n,o]=e,[a,l]=i,[c,u]=r,h=n*n+o*o,d=a*a+l*l,f=c*c+u*u;t.set(s,n,a,c,o,l,u,1,1,1);const p=t.determinant(s);if(0===p)return null;t.set(s,h,d,f,o,l,u,1,1,1);const m=t.determinant(s);return t.set(s,h,d,f,n,a,c,1,1,1),[m/p*.5,t.determinant(s)/p*-.5]}(e,a,o),c=null==l,u=l??n.interpolateSegment([],e,o,.5),[h,d]=e,[f,p]=a,[m,g]=o,[_,y]=u,x=h-_,b=d-y,v=Math.sqrt(x*x+b*b),S=n.wrapAtan2(d-y,h-_),w=n.wrapAtan2(p-y,f-_);let T=n.wrapAtan2(g-y,m-_);return(w-S)*(T-w)<0&&(T+=2*Math.sign(S-T)*Math.PI),new r.DerivedCircle(_,y,v,S,T,c)},e.splitCircularArc=function(e,t,i){const n=r.interpolateCircle(e,i/2),s=r.interpolateCircle(e,i),o=r.interpolateCircle(e,(i+1)/2);return[{c:[s,n]},{c:[[...t.c[0]],o]}]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/curves/circleUtils":function(){define(["exports","../aaBoundingRect","./mathUtils"],function(e,t,i){"use strict";const r=2*Math.PI;function n(e,t){const{cx:i,cy:r,radius:n}=e;return[i+n*Math.cos(t),r+n*Math.sin(t)]}function s(e,t){const{thetaStart:i,thetaEnd:r}=e;return n(e,i*(1-t)+r*t)}e.DerivedCircle=class{constructor(e,t,i,r,n,s){this.cx=e,this.cy=t,this.radius=i,this.thetaStart=r,this.thetaEnd=n,this.isInvalid=s}},e.circularCurveExtent=function(e,r){const{thetaStart:s,thetaEnd:o}=r,a=o-s;t.expandPointInPlace(e,n(r,s)),t.expandPointInPlace(e,n(r,o));for(let l=0;l<4;l++){let c=l*(Math.PI/2);c=i.matchWindingAndWrap(c,s,o);const u=(c-s)/a;u>0&&u<1&&t.expandPointInPlace(e,n(r,c))}return e},e.circularCurveLength=function(e){const{radius:t,thetaStart:i,thetaEnd:r}=e;return t*Math.abs(r-i)},e.closestPointOnCircle=function(e,t){const{cx:n,cy:o,thetaStart:a,thetaEnd:l}=e,[c,u]=t;let h=i.wrapAtan2(u-o,c-n);h=i.matchWindingAndWrap(h,a,l);const d=h-a;let f=d/(l-a);if(f<0||f>1){const e=Math.abs(d)%r,t=Math.abs(h-l)%r;f=Math.min(t,r-t)<Math.min(e,r-e)?1:0}const p=s(e,f);return{t:f,curvePoint:p,distance:Math.sqrt(i.distance2(t,p))}},e.interpolateCircle=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/curves/ellipticArc4Utils":function(){define(["exports","../../../core/mathUtils","./circleUtils","./mathUtils"],function(e,t,i,r){"use strict";e.deriveCircleFromEllipticArc4=function(e,n){const[s,o]=n.a,[a,l]=e,[c,u]=s,[h,d]=o,f=a-h,p=l-d,m=Math.sqrt(f*f+p*p),g=c-h,_=u-d,y=Math.sqrt(g*g+_*_),x=0===m||0===y||!t.floatEqualRelative(m,y),b=m,v=r.wrapAtan2(l-d,a-h),S=r.correctSweepAndWinding(r.wrapAtan2(u-d,c-h),v,n);return new i.DerivedCircle(h,d,b,v,S,x)},e.splitEllipticArc4=function(e,t,r){const{cx:n,cy:s,thetaStart:o,thetaEnd:a}=e,[l,c,u,h]=t.a,d=o*(1-r)+a*r;return[{a:[i.interpolateCircle(e,r),[n,s],Math.abs(d-o)<Math.PI?1:0,h]},{a:[[...l],[n,s],Math.abs(a-d)<Math.PI?1:0,h]}]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/curves/ellipticArc7Utils":function(){define(["exports","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f64","../../../core/libs/gl-matrix-2/math/vec2","../aaBoundingRect","./curveUtils","./mathUtils"],function(e,t,i,r,n,s,o){"use strict";class a{constructor(e,t,i,r,n,s,o,a,l){this.cx=e,this.cy=t,this.a=i,this.b=r,this.cosR=n,this.sinR=s,this.u1=o,this.u2=a,this.isInvalid=l}}function l(e,t){const[i,r,n,s,l,c,u]=t.a,[h,d]=e,[f,p]=i,[m,g]=r,_=c*u,y=Math.cos(l),x=Math.sin(l),b=o.wrapAtan2(1/_*(d-g)*y-1/_*(h-m)*x,1/c*(d-g)*x+1/c*(h-m)*y),v=o.correctSweepAndWinding(o.wrapAtan2(1/_*(p-g)*y-1/_*(f-m)*x,1/c*(p-g)*x+1/c*(f-m)*y),b,t);return new a(m,g,c,_,y,x,b,v,0===c||0===_)}function c(e,t){const{a:i,b:r,cosR:n,sinR:s,cx:o,cy:a}=e,l=Math.cos(t),c=Math.sin(t);return[i*l*n-r*c*s+o,i*l*s+r*c*n+a]}function u(e,t){const{u1:i,u2:r}=e;return c(e,i*(1-t)+r*t)}const h=i.create(),d=i.create(),f=i.create(),p=i.create();e.DerivedEllipse=a,e.closestPointOnEllipse=function(e,t){const{a:i,b:r,cosR:n,sinR:s,u1:a,u2:l}=e,u=Math.PI/6,h=[1*u,2*u,4*u,5*u,7*u,8*u,10*u,11*u],d=o.findClosestAndFurthestCurveParametersToPoint(t,h,t=>{const o=Math.cos(t),a=Math.sin(t),[l,u]=c(e,t);return[l,u,-i*n*a-r*s*o,-i*s*a+r*n*o,-i*n*o+r*s*a,-i*s*o-r*n*a]}).map(e=>o.matchWindingAndWrap(e,a,l));d.push(a,l);let f,p,m=1/0;for(const i of d){const r=(i-a)/(l-a);if(r<0||r>1)continue;const n=c(e,i),[s,o]=n,u=t[0]-s,h=t[1]-o,d=u*u+h*h;d<m&&(f=r,p=n,m=d)}return{t:f,curvePoint:p,distance:Math.sqrt(m)}},e.deriveEllipse=l,e.ellipticArcExtent=function(e,t,i){const r=l(t,i),{a:s,b:a,u1:u,u2:h,cosR:d,sinR:f,isInvalid:p}=r,m=h-u,g=i.a[0];if(n.expandPointInPlace(e,t),n.expandPointInPlace(e,g),p)return e;const _=Math.atan2(-a*f,s*d),y=_+Math.PI,x=Math.atan2(a*d,s*f),b=x+Math.PI;for(const t of[_,y,x,b]){const i=o.matchWindingAndWrap(t,u,h),s=(i-u)/m;s>0&&s<1&&n.expandPointInPlace(e,c(r,i))}return e},e.ellipticArcLength=function(e,t,i){const[r,n,s,a,h,d,f]=t.a,p=l(e,t),{u1:m,u2:g,isInvalid:_}=p,y=g-m;if(_)return Math.sqrt(o.distance2(e,r));const x=[0,0];let b=0,v=[u(p,0),u(p,.25),u(p,.5),u(p,.75),u(p,1)];for(let e=0;e<14;e++){const e=v.length-1,t=y/(2*e),r=[];for(let i=0;i<e;i++)r.push(v[i]),r.push(c(p,m+(2*i+1)*t));r.push(v[v.length-1]),v=r,b=0;let s=0;for(let e=1;e<v.length;e++){const t=v[e-1],i=v[e];if(b+=Math.sqrt(o.distance2(t,i)),e>1){const r=v[e-2],a=o.intersectLineLine(x,r,t,n,i);s+=a?Math.sqrt(o.distance2(t,a)):Math.abs(i[0]-t[0])+Math.abs(i[1]-t[1])}else s+=b}if(s-b<i)return b}return b},e.interpolateEllipse=u,e.splitEllipticArc7=function(e,t,i){if(i<0||i>1)return[];if(0===i||1===i)return[s.cloneCurve(t)];const[r,[n,o],a,l,c,h,d]=t.a,{u1:f,u2:p}=e,m=f*(1-i)+p*i;return[{a:[[...u(e,i)],[n,o],Math.abs(m-f)<Math.PI?1:0,l,c,h,d]},{a:[[...r],[n,o],Math.abs(p-m)<Math.PI?1:0,l,c,h,d]}]},e.transformEllipticArc=function(e,i,n){const[s,a,c,u,m,g,_]=i.a,y=l(e,i),{cosR:x,sinR:b,a:v,b:S,cx:w,cy:T}=y,M=r.transformMat3([0,0],s,n),P=r.transformMat3([0,0],a,n),I=n[0]*n[4]<0?1-u:u;{const e=v*v*b*b+S*S*x*x,i=2*(S*S-v*v)*b*x,r=v*v*x*x+S*S*b*b,n=-2*e*w-i*T,s=-i*w-2*r*T,o=e*w*w+i*w*T+r*T*T-v*v*S*S;t.set(h,e,i/2,n/2,i/2,r,s/2,n/2,s/2,o)}if(t.invert(d,n),null==d){const t=r.transformMat3([0,0],e,n);return{a:[M,P,c,u,o.wrapAtan2(M[1],M[0]),Math.sqrt(o.distance2(M,t))/2,0]}}t.transpose(f,d),t.multiply(p,t.multiply(p,f,h),d);{const e=p[0],t=2*p[1],i=p[4],r=2*p[2],n=2*p[5],s=t*t-4*e*i,a=2*(e*n*n+i*r*r-t*r*n+s*p[8]),l=Math.sqrt((e-i)**2+t*t),u=-Math.sqrt(a*(e+i+l))/s,h=-Math.sqrt(a*(e+i-l))/s;return{a:[M,P,c,I,.5*o.wrapAtan2(-t,i-e),u,h/u]}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define(["exports","../../core/has","../../core/memoryEstimations","../../core/uid","../../geometry/SpatialReference","../../geometry/support/aaBoundingBox","../../geometry/support/aaBoundingRect","../../geometry/support/quantizationUtils","../../geometry/support/typeUtils","../support/Field","../../views/2d/layers/graphics/densificationConstants","./dehydratedFeatureComparison"],function(e,t,i,r,n,s,o,a,l,c,u,h){"use strict";function d(e,t,i){if(null==e)return null;switch(t){case"point":{const t=e;return{x:t.x,y:t.y,z:t.z,m:t.m,hasZ:null!=t.z,hasM:null!=t.m,type:"point",spatialReference:i}}case"polyline":{const t=e;return{paths:t.paths,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polyline",spatialReference:i}}case"polygon":{const t=e;return{rings:t.rings,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"polygon",spatialReference:i}}case"multipoint":{const t=e;return{points:t.points,hasZ:!!t.hasZ,hasM:!!t.hasM,type:"multipoint",spatialReference:i}}}}function f(e){if(null==e)return 0;switch(e.type){case"point":return i.baseObjectMemory+10+8+24;case"polyline":case"polygon":{let t=0;const r=2+(e.hasZ?1:0)+(e.hasM?1:0),n="polyline"===e.type?e.paths:e.rings,s="polyline"===e.type?e.curvePaths:e.curveRings;if(s?.length){const e=3*u.getApproximateMaxDensificationSegments()*128;t=8*e*r+128*e+32*(n.length+1)}else t=i.estimateNestedObjectMemory(n);return i.baseObjectMemory+64+t+34}case"multipoint":{const t=i.estimateNestedObjectMemory(e.points);return i.baseObjectMemory+t+64+34+32}case"extent":return i.baseObjectMemory+10+64+34;case"mesh":{const t=e.vertexAttributes;return i.baseObjectMemory+i.estimateNumberArrayMemory(t.position,t.normal,t.uv,t.tangent)}default:return i.baseObjectMemory}}function p(e,t){return null!=e.objectId?e.objectId:e.attributes&&t?e.attributes[t]:null}function m(e,t,i,r){if(t?.size&&null!=i&&e)for(const n in e){if(!t.has(n))continue;const s=e[n];"string"==typeof s&&s.length>i&&(r(n),e[n]="")}}e.equals=h.equals,e.DehydratedFeatureClass=class{constructor(e,t,i){this.uid=e,this.geometry=t,this.attributes=i,this.visible=!0,this.objectId=null,this.centroid=null}},e.DehydratedFeatureSetClass=class{constructor(){this.exceededTransferLimit=!1,this.features=[],this.fields=[],this.hasM=!1,this.hasZ=!1,this.geometryType=null,this.objectIdFieldName=null,this.globalIdFieldName=null,this.geometryProperties=null,this.geohashFieldName=null,this.spatialReference=null,this.transform=null}},e.computeAABB=function(e,t){switch(s.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[3]=e.x,t[1]=t[4]=e.y,e.hasZ&&(t[2]=t[5]=e.z);break;case"polyline":for(let i=0;i<e.paths.length;i++)s.expandWithNestedArray(t,e.paths[i],!!e.hasZ);break;case"polygon":for(let i=0;i<e.rings.length;i++)s.expandWithNestedArray(t,e.rings[i],!!e.hasZ);break;case"multipoint":s.expandWithNestedArray(t,e.points,!!e.hasZ);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[3]=e.xmax,t[4]=e.ymax,null!=e.zmin&&(t[2]=e.zmin),null!=e.zmax&&(t[5]=e.zmax)}return t},e.computeAABR=function(e,t){switch(o.empty(t),"mesh"===e.type&&(e=e.extent),e.type){case"point":t[0]=t[2]=e.x,t[1]=t[3]=e.y;break;case"polyline":for(let i=0;i<e.paths.length;i++)o.expandWithNestedArray(t,e.paths[i]);break;case"polygon":for(let i=0;i<e.rings.length;i++)o.expandWithNestedArray(t,e.rings[i]);break;case"multipoint":o.expandWithNestedArray(t,e.points);break;case"extent":t[0]=e.xmin,t[1]=e.ymin,t[2]=e.xmax,t[3]=e.ymax}},e.estimateGeometryMemory=f,e.estimateSize=function(e){let t=32;return t+=i.estimateAttributesMemory(e.attributes),t+=3,t+=8+f(e.geometry),t},e.fromFeatureSetJSON=function(e,t){const i=l.featureGeometryTypeKebabDictionary.fromJSON(e.geometryType),s=n.fromJSON(e.spatialReference),o=e.transform,u=e.objectIdFieldName,h=t?.maxStringAttributeLength,f=t?.maxStringAttributeFields;let g;const _=e.features.map(t=>{const n=function(e,t,i,n){return{uid:r.generateUID(),objectId:n&&e.attributes?e.attributes[n]:null,attributes:e.attributes,geometry:d(e.geometry,t,i),visible:!0}}(t,i,s,e.objectIdFieldName),l=n.geometry;if(m(n.attributes,f,h,e=>{g??=[];const t=p(n,u);null!=t&&g.push({objectId:t,attribute:e})}),null!=l&&o)switch(l.type){case"point":n.geometry=a.unquantizePoint(o,l,l);break;case"multipoint":n.geometry=a.unquantizeMultipoint(o,l,l);break;case"polygon":n.geometry=a.unquantizePolygon(o,l,l);break;case"polyline":n.geometry=a.unquantizePolyline(o,l,l);break;case"extent":case"mesh":n.geometry=l}return n});return{geometryType:i,features:_,spatialReference:s,fields:e.fields?.map(e=>c.fromJSON(e))??[],objectIdFieldName:e.objectIdFieldName,globalIdFieldName:e.globalIdFieldName,geohashFieldName:e.geohashFieldName,geometryProperties:e.geometryProperties,hasZ:e.hasZ,hasM:e.hasM,exceededTransferLimit:e.exceededTransferLimit,transform:null,missingAttributes:g}},e.fromJSONGeometry=d,e.getObjectId=p,e.hasGeometry=function(e){return null!=e.geometry},e.hasVertices=function(e){if(null==e)return!1;switch(e.type){case"extent":case"point":return!0;case"polyline":for(const t of e.paths)if(t.length>0)return!0;return!1;case"polygon":for(const t of e.rings)if(t.length>0)return!0;return!1;case"multipoint":return e.points.length>0;case"mesh":return!e.loaded||e.vertexAttributes.position.length>0}},e.numVertices=function(e){if(null==e)return 0;switch(e.type){case"point":return 1;case"polyline":{let t=0;for(const i of e.paths)t+=i.length;return t}case"polygon":{let t=0;for(const i of e.rings)t+=i.length;return t}case"multipoint":return e.points.length;case"extent":return 2;case"mesh":{const t=e.vertexAttributes&&e.vertexAttributes.position;return t?t.length/3:0}default:return}},e.removeLargeStringAttributes=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/densificationConstants":function(){define(["exports","../../../../core/has"],function(e,t){"use strict";e.getApproximateMaxDensificationSegments=function(){return t("curve-densification-max-segments")},e.getCoarseSegmentsPerCurve=function(){return t("curve-densification-coarse-segments")},e.getMaxDeviationInPixels=function(){return t("curve-densification-pixel-deviation")},e.getMinSegmentsPerCurve=function(){return t("curve-densification-min-segments")},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has","../../core/mathUtils","../../geometry/support/spatialReferenceUtils"],function(e,t,i,r){"use strict";function n(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++){const r=e[i],n=t[i];if(r.length!==n.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!==n[e])return!1}return!0}function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!n(e[i],t[i]))return!1;return!0}function o(e,t){return e===t||null!=e&&null!=t&&r.equals(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}e.equals=function(e,t){return e===t||null!=e&&null!=t&&e.objectId===t.objectId&&!!function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.type!==t.type)return!1;switch(e.type){case"point":return o(e,t);case"extent":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!r.equals(e.spatialReference,t.spatialReference)&&e.xmin===t.xmin&&e.ymin===t.ymin&&e.zmin===t.zmin&&e.xmax===t.xmax&&e.ymax===t.ymax&&e.zmax===t.zmax}(e,t);case"polyline":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!r.equals(e.spatialReference,t.spatialReference)&&s(e.paths,t.paths)}(e,t);case"polygon":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!r.equals(e.spatialReference,t.spatialReference)&&s(e.rings,t.rings)}(e,t);case"multipoint":return function(e,t){return e.hasZ===t.hasZ&&e.hasM===t.hasM&&!!r.equals(e.spatialReference,t.spatialReference)&&n(e.points,t.points)}(e,t);case"mesh":return!1;default:return}}(e.geometry,t.geometry)&&!!function(e,t){if(e===t)return!0;if(!e||!t)return!1;const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const r of i)if(e[r]!==t[r])return!1;return!0}(e.attributes,t.attributes)},e.pointEquals=o,e.pointNear=function(e,t,n){return e===t||null!=e&&null!=t&&r.equals(e.spatialReference,t.spatialReference)&&i.floatEqualAbsolute(e.x,t.x,n)&&i.floatEqualAbsolute(e.y,t.y,n)&&i.floatEqualAbsolute(e.z??0,t.z??0,n)&&i.floatEqualAbsolute(e.m??0,t.m??0,n)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicUpdateMessage":function(){define(["exports"],function(e){"use strict";e.GraphicUpdateMessage=class{constructor(e,t,i){this.added=e,this.updated=t,this.removed=i}hasAnyUpdate(){return!!(this.added.length||this.updated.length||this.removed.length)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/FeatureCommandQueue":function(){define(["exports","../../../../core/promiseUtils","../../../../core/QueueProcessor","./UpdateTracking2D"],function(e,t,i,r){"use strict";class n{constructor(){this.type="override-batch",this.messages=[],this._resovler=t.createResolver()}get promise(){return this._resovler.promise}resolve(){this._resovler.resolve()}add(e){this.messages.push(e)}}e.FeatureCommandQueue=class{constructor(e){this.updateTracking=new r.UpdateTracking2D({debugName:"FeatureCommandQueue"}),this.process=e.process,this._queueProcessor=new i.QueueProcessor({concurrency:1,process:async e=>{if("override-batch"===e.type){const e=this._nextOverrideBatch;if(null==e)throw new Error("InternalError: Override should be defined");return this._nextOverrideBatch=null,await this.process(e),void e.resolve()}return this.process(e)}})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(e){return t.ignoreAbortErrors(this.updateTracking.addPromise(this._doPush(e)))}async _doPush(e){const t=this._queueProcessor,i=t.last();switch(e.type){case"update":case"highlight":if(i?.type===e.type)return;return t.push(e);case"override":case"edit":return this._pushOverride(e)}}_pushOverride(e){return null==this._nextOverrideBatch&&(this._nextOverrideBatch=new n,this._queueProcessor.push(this._nextOverrideBatch)),this._nextOverrideBatch.add(e),this._nextOverrideBatch.promise}},e.OverrideBatch=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/UpdateTracking2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/has","../../../../core/ReactiveMap","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/support/UpdatingHandles"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";e.UpdateTracking2D=class extends i{constructor(e){super(e),this.debugName="",this._updatingHandles=new u.UpdatingHandles,this._idToUpdatingState=new n}get updating(){const e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(e=>e);if(r("esri-2d-log-updating")){const t=Array.from(this._idToUpdatingState.entries()).map(([e,t])=>`-> ${e}: ${t}`).join("\n");console.log(`${this.debugName}: Updating: ${e}\n-> Handles: ${this._updatingHandles.updating}\n${t}`)}return e}addUpdateTracking(e,t){const i=s.watch(()=>t.updating,t=>this._idToUpdatingState.set(e,t),{sync:!0});this.addHandles(i)}addPromise(e){return this._updatingHandles.addPromise(e)}},t.__decorate([o.property({constructOnly:!0})],e.UpdateTracking2D.prototype,"debugName",void 0),t.__decorate([o.property({readOnly:!0})],e.UpdateTracking2D.prototype,"updating",null),e.UpdateTracking2D=t.__decorate([c.subclass("esri.views.2d.layers.support.UpdateTracking2D")],e.UpdateTracking2D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicContainer":function(){define(["./AGraphicContainer","../support/util"],function(e,t){"use strict";class i extends e.AGraphicContainer{renderChildren(e){for(const t of this.children)t.setTransform(e.state);if(super.renderChildren(e),this._updateAttributeView(),this.children.some(e=>e.hasData)){switch(e.drawPhase){case 1:this._renderChildren(e,0);break;case 16:this.hasHighlight&&this._renderHighlight(e)}this._boundsRenderer&&this._boundsRenderer.doRender(e)}}_renderHighlight(e){t.renderHighlight(e,!1,e=>{this._renderChildren(e,1)})}}return i})},"esri/views/2d/layers/graphics/AGraphicContainer":function(){define(["exports","../../../../core/maybe","../../engine/AFeatureContainer","../../engine/webgl/shaderGraph/techniques/GraphicInstanceStore","./GraphicBoundsRenderer"],function(e,t,i,r,n){"use strict";class s extends i.AFeatureContainer{constructor(e){super(e),this._instanceStore=new r.GraphicInstanceStore,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=t.destroyMaybe(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(e){this._boundsRenderer=new n(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,t){e.onMessage(t),this.contains(e)||this.addChild(e),this.requestRender()}_renderChildren(e,t){e.selection=t;for(const t of this.children){if(!t.visible)continue;const i=t.getDisplayList(this._instanceStore,1);i?.render(e)}}}e.AGraphicContainer=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/AFeatureContainer":function(){define(["exports","./webgl/AttributeStoreView","./webgl/TileContainer"],function(e,t,i){"use strict";e.AFeatureContainer=class extends i{constructor(e){super(e),this._statisticsByLevel=new Map,this._entityIndex=new Map,this.attributeView=new t.AttributeStoreView}destroy(){super.destroy(),this.children.forEach(e=>e.destroy()),this.removeAllChildren(),this.attributeView.destroy()}doRender(e){e.context.capabilities.enable("textureFloatLinear"),super.doRender(e)}get hasAnimations(){for(const e of this.children)if(e.hasAnimations)return!0;return!1}_reindexAndUpdateFeaturesIfNeeded(){if(this.hasAnimations&&(this._reindexFeatures(),0!==this.attributeView.size))for(const e of this._entityIndex.values())e.dirty&&(this.attributeView.setData(e.displayId,7,0,e.firstIndexed),e.dirty=!1)}restartAnimation(e){const t=this._entityIndex.get(e);if(!t)return;const i=performance.now()/1e3;t.firstIndexed=i,t.dirty=!0}restartAllAnimations(){const e=performance.now()/1e3;for(const[t,i]of this._entityIndex)i.firstIndexed=e,i.dirty=!0}_reindexFeatures(){const e=performance.now()/1e3;for(const t of this.children)for(const i of t.entityIds){const{objectId:t}=i;let r=this._entityIndex.get(t);r||(r={objectId:t,displayId:0,firstIndexed:e,lastIndexed:0,dirty:!0},this._entityIndex.set(t,r)),r.lastIndexed=e,r.displayId=i.displayId}for(const[t,i]of this._entityIndex)e-i.lastIndexed>60&&this._entityIndex.delete(t)}_updateAttributeView(){this.attributeView.update(),this._reindexAndUpdateFeaturesIfNeeded()}createRenderParams(e){const t=super.createRenderParams(e);return t.attributeView=this.attributeView,t.instanceStore=this._instanceStore,t.statisticsByLevel=this._statisticsByLevel,t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/AttributeStoreView":function(){define(["exports","../../../../core/Error","../../../../core/has","../../../../core/Logger","./definitions","./DisplayId","./Utils","../../../webgl/FramebufferObject","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u{constructor(e,t,i){this._texture=null,this._lastTexture=null,this._fbos={},this.texelSize=4;const{buffer:r,pixelType:n,textureOnly:s}=e,a=o.getPixelArrayCtor(n);this.blockIndex=i,this.pixelType=n,this.size=t,this.textureOnly=s,s||(this.data=new a(r)),this._resetRange()}destroy(){this._texture?.dispose();for(const e in this._fbos){const t=this._fbos[e];t&&("0"===e&&t.detachColorTexture(),t.dispose()),this._fbos[e]=null}this._texture=null}get _textureDesc(){const e=new c.TextureDescriptor(this.size);return e.wrapMode=33071,e.samplingMode=9728,e.dataType=this.pixelType,e}setData(e,t,i){const r=s.getDisplayIdTexel(e),n=this.data,o=r*this.texelSize+t;!n||o>=n.length||(n[o]=i,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r))}getData(e,t){if(null==this.data)return null;const i=s.getDisplayIdTexel(e)*this.texelSize+t;return!this.data||i>=this.data.length?null:this.data[i]}getTexture(e){return this._texture??this._initTexture(e)}getFBO(e,t=0){if(!this._fbos[t]){const i=0===t?this.getTexture(e):this._textureDesc;this._fbos[t]=new a.FramebufferObject(e,i)}return this._fbos[t]}get hasDirty(){const e=this.dirtyStart;return this.dirtyEnd>=e}updateTexture(e,n){try{const s=this.dirtyStart,a=this.dirtyEnd;if(!this.hasDirty)return;i("esri-2d-update-debug")&&console.debug(`Version[${n}] AttributeStoreView.updateTexture`,{start:s,end:a,firstBytes:new Uint8Array(this.data.buffer.slice(0,16)),block:this}),this._resetRange();const l=this.data.buffer,c=this.getTexture(e),u=4,h=(s-s%this.size)/this.size,d=(a-a%this.size)/this.size,f=h,p=this.size,m=d,g=h*this.size*u,_=(p+m*this.size)*u-g,y=o.getPixelArrayCtor(this.pixelType),x=new y(l,g*y.BYTES_PER_ELEMENT,_),b=this.size,v=m-f+1;if(v>this.size)return void r.getLogger("esri.views.2d.engine.webgl.AttributeStoreView").error(new t("mapview-webgl","Out-of-bounds index when updating AttributeData"));c.updateData(0,0,f,b,v,x)}catch(e){}}update(e){const{data:t,start:i,end:r}=e;if(null!=t&&null!=this.data){const r=this.data,n=i*this.texelSize;for(let i=0;i<t.length;i++){const s=1<<i%this.texelSize;e.layout&s&&(r[n+i]=t[i])}}this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,r)}resize(e,t){const i=this.size;if(this.size=t,this.textureOnly)return void(i!==this.size&&(this._lastTexture=this._texture,this._texture=null));const r=o.getPixelArrayCtor(this.pixelType);this.destroy(),this.data=new r(e.buffer)}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}_initTexture(e){const t=new l.Texture(e,this._textureDesc,this.data??void 0);if(null!=this._lastTexture&&this._fbos[0]){const i=this._lastTexture.descriptor.width,r=this._lastTexture.descriptor.height,n=this._lastTexture.descriptor.dataType,s=this._lastTexture.descriptor.pixelFormat,a=this.getFBO(e),l=o.getPixelBytes(n),c=new(o.getPixelArrayCtor(n))(new ArrayBuffer(i*r*l*this.texelSize)),u=e.getBoundFramebufferObject(),{x:h,y:d,width:f,height:p}=e.getViewport();e.bindFramebuffer(a),a.readPixels(0,0,i,r,s,n,c),t.updateData(0,0,0,2*i,r/2,c),e.setViewport(h,d,f,p),e.bindFramebuffer(u)}return this.destroy(),this._texture=t,this._texture}}e.AttributeStoreView=class{constructor(){this.size=0,this._pendingAttributeUpdates=[],this._version=0,this._epoch=0,this._locked=!1}get locked(){return this._locked}_initialize(e){if(!e)throw new Error("InternalError: initArgs must be defined");const t=e.blockDescriptors;if(this.size=e.blockSize,i("esri-2d-update-debug")&&console.debug("AttributeStoreView.initialize",{message:e}),null==this._data)this._data=t.map((e,t)=>null!=e?new u(e,this.size,t):null);else for(let e=0;e<this._data.length;e++){const i=this._data[e],r=t[e];null!=r&&(null==i?this._data[e]=new u(r,this.size,e):i.resize(r,this.size))}}destroy(){for(const e of this._data??[])e?.destroy();this._defaultTexture?.dispose(),this._defaultTexture=null,this._pendingAttributeUpdates=[]}isEmpty(){return null==this._data}getBlock(e){return null==this._data?null:this._data[e]}setLabelMinZoom(e,t){this.setData(e,0,1,t)}setLocalTimeOrigin(e,t){this.setData(e,7,0,t)}getLabelMinZoom(e){return this.getData(e,0,1,255)}getFilterFlags(e){return this.getData(e,0,0,0)}getVisualVariableData(e,t){return this.getData(e,3,t,0)}getData(e,t,i,r){if(!this._data)return 0;const n=this._data[t];if(null==n)return 0;const s=n.getData(e,i);return null!=s?s:r}setData(e,t,i,r){this._data[t].setData(e,i,r)}lockTextureUploads(){this._locked=!0}unlockTextureUploads(){this._locked=!1,this.update()}requestUpdate(e){this._version=e.version,this._pendingAttributeUpdates.push(e),i("esri-2d-update-debug")&&console.debug(`Version[${this._version}] AttributeStoreView.requestUpdate`,{message:e})}get currentEpoch(){return this._epoch}get hasPendingUpdates(){return this._pendingAttributeUpdates.length>0}update(){if(this._locked)return;const e=this._pendingAttributeUpdates;this._pendingAttributeUpdates=[];for(const t of e){const{blockData:e,initArgs:r,sendUpdateEpoch:n,version:s}=t;i("esri-2d-update-debug")&&console.debug(`Version[${this._version}] Epoch[${n}] AttributeStoreView.applyUpdate`),this._version=s,this._epoch=n,null!=r&&this._initialize(r);const o=this._data;for(let t=0;t<e.length;t++){const r=e[t],n=o[t];null!=n&&null!=r&&(i("esri-2d-update-debug")&&console.debug(`Version[${this._version}] CpuBlock[${t}] AttributeStoreView.update`,{block:r}),n.update(r))}}}getUniforms(e){return{filterFlags:{texture:this._getTexture(e,0),unit:n.filterFlagsUnit},animation:{texture:this._getTexture(e,1),unit:n.animationUnit},gpgpu:{texture:this._getTexture(e,2),unit:n.gpgpuUnit},localTimeOrigin:{texture:this._getTexture(e,7),unit:n.localTimeOriginUnit},visualVariableData:{texture:this._getTexture(e,3),unit:n.visualVariableUnit},dataDriven0:{texture:this._getTexture(e,4),unit:n.dataDrivenUnit0},dataDriven1:{texture:this._getTexture(e,5),unit:n.dataDrivenUnit1},dataDriven2:{texture:this._getTexture(e,6),unit:n.dataDrivenUnit2},size:this.size}}_getTexture(e,t){const i=this._data?.[t];return i?(i.updateTexture(e,this._version),i.getTexture(e)):this._getDefaultTexture(e)}_getDefaultTexture(e){if(null==this._defaultTexture){const t=new c.TextureDescriptor(1);t.wrapMode=33071,t.samplingMode=9728,this._defaultTexture=new l.Texture(e,t,new Uint8Array(4))}return this._defaultTexture}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TileContainer":function(){define(["../../../../core/has","./WGLContainer","./brushes/WGLBrushStencil","./brushes/WGLBrushTileDebugInfo"],function(e,t,i,r){"use strict";const n=(e,t)=>e.key.level-t.key.level!==0?e.key.level-t.key.level:e.key.row-t.key.row!==0?e.key.row-t.key.row:e.key.col-t.key.col;return class extends t{constructor(e){super(),this.tileInfoView=e,this.sortFunction=n}renderChildren(e){this.setStencilReference(e),super.renderChildren(e)}createRenderParams(e){const{state:t}=e,i=super.createRenderParams(e);return i.requiredLevel=this.tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this.tileInfoView.tileInfo.scaleToZoom(t.scale),i}prepareRenderPasses(t){const n=super.prepareRenderPasses(t);return n.push(t.registerRenderPass({name:"stencil",brushes:[i],drawPhase:83,target:()=>this.getStencilTarget()})),e("esri-tiles-debug")&&n.push(t.registerRenderPass({name:"tileInfo",brushes:[r],drawPhase:64,target:()=>this.children})),n}getStencilTarget(){return this.children}setStencilReference(e){let t=1;for(const e of this.children)e.stencilRef=t++}}})},"esri/views/2d/engine/webgl/WGLContainer":function(){define(["../../../../core/has","../brushes","../Container","./ClippingInfo"],function(e,t,i,r){"use strict";class n extends i.Container{set clips(e){super.clips=e,this._updateClippingInfo(e)}renderChildren(e){e.painter.setPipelineState(null),null==this._renderPasses&&(this._renderPasses=this.prepareRenderPasses(e.painter));for(const t of this._renderPasses)try{t.render(e)}catch(e){}}prepareRenderPasses(e){return[e.registerRenderPass({name:"clip",brushes:[t.brushes.clip],target:()=>this._clippingInfos,drawPhase:87})]}_updateClippingInfo(e){null!=this._clippingInfos&&(this._clippingInfos.forEach(e=>e.destroy()),this._clippingInfos=null),null!=e&&e.length&&(this._clippingInfos=e.items.map(e=>r.fromClipArea(this.stage,e))),this.requestRender()}}return n})},"esri/views/2d/engine/webgl/ClippingInfo":function(){define(["../../../../core/Error","../../../../core/Logger","../../../../core/reactiveUtils","../../../../core/libs/gl-matrix-2/factories/mat3f32","../DisplayObject","./Mesh2D","../../support/clippingUtils","../../../webgl/VertexArrayObject"],function(e,t,i,r,n,s,o,a){"use strict";class l extends n.DisplayObject{constructor(e,t){super(),this._clip=t,this._cache={},this.stage=e,this._handle=i.watch(()=>t.version,()=>this._invalidate()),this.ready()}static fromClipArea(e,t){return new l(e,t)}_destroyGL(){null!=this._cache.mesh&&(this._cache.mesh.destroy(),this._cache.mesh=null),null!=this._cache.vao&&(this._cache.vao.dispose(),this._cache.vao=null)}destroy(){super.destroy(),this._destroyGL(),this._handle.remove()}getVAO(e,t,i){const[r,n]=t.size;if("geometry"!==this._clip.type&&this._lastWidth===r&&this._lastHeight===n||(this._lastWidth=r,this._lastHeight=n,this._destroyGL()),null==this._cache.vao){const r=this._createMesh(t,this._clip),n=r.getIndexBuffer(e),s=r.getVertexBuffers(e,i);this._cache.mesh=r,this._cache.vao=new a.VertexArrayObject(e,s,n)}return this._cache.vao}_createTransforms(){return{displayViewScreenMat3:r.create()}}_invalidate(){this._destroyGL(),this.requestRender()}_createMesh(i,r){switch(r.type){case"rect":return s.fromScreenExtent(o.createScreenExtent(r,i.size[0],i.size[1]));case"path":return s.fromPath(r);case"geometry":return s.fromGeometry(i,r);default:return t.getLogger("esri.views.2d.engine.webgl.ClippingInfo").error(new e("mapview-bad-type","Unable to create ClippingInfo mesh from clip of type: ${clip.type}")),s.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}}return l})},"esri/views/2d/engine/webgl/Mesh2D":function(){define(["../../../../core/Error","../../../../core/Logger","../../../../chunks/earcut","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../layers/graphics/featureConversionUtils","../../../../layers/graphics/OptimizedGeometry","./number","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexBuffer"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";const h=(e,t,i,r)=>{let n=0;for(let r=1;r<i;r++){const i=e[2*(t+r-1)],s=e[2*(t+r-1)+1];n+=(e[2*(t+r)]-i)*(e[2*(t+r)+1]+s)}return r?n>0:n<0},d=({coords:e,lengths:t},r)=>{const n=[];for(let s=0,o=0;s<t.length;o+=t[s],s+=1){const a=o,l=[];for(;s<t.length-1&&h(e,o+t[s],t[s+1],r);s+=1,o+=t[s])l.push(o+t[s]-a);const c=e.slice(2*a,2*(o+t[s])),u=i.earcut(c,l,2);for(const e of u)n.push(e+a)}return n};class f{constructor(e,t,i,r=!1){this.vertices=e,this.indices=t,this.primitiveType=i,this.isMapSpace=r,this._cache={}}static fromPath(e){const t=s.convertFromNestedArray(new o,e.path,!1,!1),i=t.coords,r=new Uint32Array(d(t,!0)),n=new Uint32Array(i.length/2);for(let e=0;e<n.length;e++)n[e]=a.i1616to32(Math.floor(i[2*e]),Math.floor(i[2*e+1]));return new f(n,r,c.PrimitiveType.TRIANGLES)}static fromGeometry(i,r){const n=r.geometry?.type;switch(n){case"polygon":return f.fromPolygon(i,r.geometry);case"extent":return f.fromMapExtent(i,r.geometry);default:return t.getLogger("esri.views.2d.engine.webgl.Mesh2D").error(new e("mapview-bad-type",`Unable to create a mesh from type ${n}`,r)),f.fromScreenExtent({xmin:0,ymin:0,xmax:1,ymax:1})}}static fromPolygon(e,t){const i=s.convertFromPolygon(new o,t,!1,!1),l=i.coords,u=new Uint32Array(d(i,!1)),h=new Uint32Array(l.length/2),p=n.create(),m=n.create();for(let t=0;t<h.length;t++)r.set(p,l[2*t],l[2*t+1]),e.toScreen(m,p),h[t]=a.i1616to32(Math.floor(m[0]),Math.floor(m[1]));return new f(h,u,c.PrimitiveType.TRIANGLES,!0)}static fromScreenExtent({xmin:e,xmax:t,ymin:i,ymax:r}){const n=new Uint32Array([a.i1616to32(e,i),a.i1616to32(t,i),a.i1616to32(e,r),a.i1616to32(e,r),a.i1616to32(t,i),a.i1616to32(t,r)]),s=new Uint32Array([0,1,2,3,4,5]);return new f(n,s,c.PrimitiveType.TRIANGLES)}static fromMapExtent(e,t){const[i,r]=e.toScreen([0,0],[t.xmin,t.ymin]),[n,s]=e.toScreen([0,0],[t.xmax,t.ymax]),o=new Uint32Array([a.i1616to32(i,r),a.i1616to32(n,r),a.i1616to32(i,s),a.i1616to32(i,s),a.i1616to32(n,r),a.i1616to32(n,s)]),l=new Uint32Array([0,1,2,3,4,5]);return new f(o,l,c.PrimitiveType.TRIANGLES)}destroy(){null!=this._cache.indexBuffer&&this._cache.indexBuffer.dispose(),this._cache.vertexBuffer?.dispose(),this._cache.indexBuffer=this._cache.vertexBuffer=null}getIndexBuffer(e,t=35044){return this._cache.indexBuffer??=l.BufferObject.createIndex(e,t,this.indices),this._cache.indexBuffer}getVertexBuffers(e,t){return this._cache.vertexBuffer??=new u.VertexBuffer(e,t,this.vertices),this._cache.vertexBuffer}}return f})},"esri/views/2d/engine/webgl/shaderGraph/techniques/GraphicInstanceStore":function(){define(["exports","./TechniqueInstance","./TechniqueRegistry","./mesh/instanceIdUtils"],function(e,t,i,r){"use strict";let n=0;function s(e,i){return new t.FeatureTechniqueInstance(r.castInstanceId(n++),e,i)}const o={visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null,visualVariableSizeOutlineScaleStops:null};e.GraphicInstanceStore=class{constructor(){this.instances={fill:s(i.Techniques.fill,{uniforms:o,optionalAttributes:{zoomRange:!0}}),marker:s(i.Techniques.marker,{uniforms:o,optionalAttributes:{zoomRange:!0}}),line:s(i.Techniques.line,{uniforms:o,optionalAttributes:{zoomRange:!0}}),text:s(i.Techniques.text,{uniforms:o,optionalAttributes:{zoomRange:!0,referenceSymbol:!1,clipAngle:!1,visibility:!1}}),outlineFill:s(i.Techniques.outlineFill,{uniforms:o,optionalAttributes:{zoomRange:!0}}),complexFill:s(i.Techniques.complexFill,{uniforms:o,optionalAttributes:{zoomRange:!0}}),gradientFill:s(i.Techniques.gradientFill,{uniforms:o,optionalAttributes:{zoomRange:!0}}),texturedLine:s(i.Techniques.texturedLine,{uniforms:o,optionalAttributes:{zoomRange:!0}}),gradientStroke:s(i.Techniques.gradientStroke,{uniforms:o,optionalAttributes:{zoomRange:!0}}),animatedMarker:s(i.Techniques.animatedMarker,{uniforms:o,optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,lineLength:!1}}),animatedMarkerShift:s(i.Techniques.animatedMarkerShift,{uniforms:o,optionalAttributes:{zoomRange:!0,value1Position2Value2:!0,lineLength:!0}}),animatedPolygon:s(i.Techniques.animatedFill,{uniforms:o,optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,lineLength:!1}}),animatedPolyline:s(i.Techniques.animatedLine,{uniforms:o,optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,accumulatedDistance:!0,segmentDirection:!0,normal:!0,lineLength:!1}}),animatedPolylineShift:s(i.Techniques.animatedLine,{uniforms:o,optionalAttributes:{zoomRange:!0,value1Position2Value2:!1,accumulatedDistance:!0,segmentDirection:!0,normal:!0,lineLength:!0}})},this._instancesById=Object.values(this.instances).reduce((e,t)=>(e.set(t.instanceId,t),e),new Map)}getInstance(e){return this._instancesById.get(e)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/TechniqueInstance":function(){define(["exports","./mesh/instanceIdUtils"],function(e,t){"use strict";e.FeatureTechniqueInstance=class{constructor(e,t,i){this._instanceId=e,this.techniqueRef=t,this._input=i}get instanceId(){return t.castStrictInstanceId(this._instanceId)}createMeshInfo(e){return{id:t.castStrictInstanceId(this._instanceId),techniqueType:this.techniqueRef.type,inputParams:e,optionalAttributes:this._input.optionalAttributes}}getInput(){return this._input}setInput(e){this._input=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/instanceIdUtils":function(){define(["exports"],function(e){"use strict";e.castInstanceId=function(e){return e},e.castStrictInstanceId=function(e){return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/graphics/GraphicBoundsRenderer":function(){define(["../../../../core/maybe","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../core/libs/gl-matrix-2/factories/vec2f32","../../../../core/libs/gl-matrix-2/factories/vec3f32","../../../../geometry/support/normalizeUtils","../../engine/DisplayObject","../../engine/webgl/Utils","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject","../../../webgl/VertexBuffer"],function(e,t,i,r,n,s,o,a,l,c,u,h){"use strict";const d=Math.PI/180;class f extends o.DisplayObject{constructor(e){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=i.create(),this._localOrigin={x:0,y:0},this._getBounds=e}destroy(){super.destroy(),this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=e.disposeMaybe(this._program)}doRender(e){const{context:t}=e,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,i),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(1,771),t.setColorMask(!0,!0,!0,!0);const r=this._program;t.bindVAO(this._vao),t.useProgram(r),r.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(c.PrimitiveType.LINES,8*i.length,c.DataType.UNSIGNED_INT,0),t.bindVAO(null)}_createTransforms(){return{displayViewScreenMat3:i.create()}}_createShaderProgram(e){this._program||(this._program=e.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",p().attributes))}_updateMatricesAndLocalOrigin(e){const{state:i}=e,{displayMat3:o,size:a,resolution:l,pixelRatio:c,rotation:u,viewpoint:h}=i,f=d*u,{x:p,y:m}=h.targetGeometry,g=s.normalizeMapX(p,i.spatialReference);this._localOrigin.x=g,this._localOrigin.y=m;const _=c*a[0],y=c*a[1],x=l*_,b=l*y,v=t.identity(this._dvsMat3);t.multiply(v,v,o),t.translate(v,v,r.fromValues(_/2,y/2)),t.scale(v,v,n.fromValues(a[0]/x,-y/b,1)),t.rotate(v,v,-f)}_updateBufferData(e,t){const{x:i,y:r}=this._localOrigin,n=8*t.length,s=new Float32Array(n),o=new Uint32Array(8*t.length);let a=0,c=0;for(const e of t)e&&(s[2*a]=e[0]-i,s[2*a+1]=e[1]-r,s[2*a+2]=e[0]-i,s[2*a+3]=e[3]-r,s[2*a+4]=e[2]-i,s[2*a+5]=e[3]-r,s[2*a+6]=e[2]-i,s[2*a+7]=e[1]-r,o[c]=a+0,o[c+1]=a+3,o[c+2]=a+3,o[c+3]=a+2,o[c+4]=a+2,o[c+5]=a+1,o[c+6]=a+1,o[c+7]=a+0,a+=4,c+=8);const d=p();this._vertexBuffer?this._vertexBuffer.setData(s.buffer):this._vertexBuffer=new h.VertexBuffer(e,d.bufferLayout,s.buffer,35048),this._indexBuffer?this._indexBuffer.setData(o):this._indexBuffer=l.BufferObject.createIndex(e,35048,o),this._vao||(this._vao=new u.VertexArrayObject(e,this._vertexBuffer,this._indexBuffer))}}const p=()=>a.createProgramDescriptor("bounds",[{location:0,name:"a_position",count:2,type:c.DataType.FLOAT}]);return f})},"esri/views/2d/navigation/MapViewNavigation":function(){define(["../../../chunks/tslib.es6","../../../Viewpoint","../../../core/Accessor","../../../core/maybe","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Point","../viewpointUtils","./duration","./ZoomBox","./actions/Pan","./actions/Pinch","./actions/Rotate"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m){"use strict";const g=new t({targetGeometry:new c}),_=[0,0];let y=class extends i{constructor(e){super(e),this._endTimer=null,this._lastEventTimestamp=null,this.animationManager=null,this.interacting=!1}initialize(){this.pan=new f({navigation:this}),this.rotate=new m({navigation:this}),this.pinch=new p({navigation:this}),this.zoomBox=new d({view:this.view,navigation:this})}destroy(){this.pan=r.destroyMaybe(this.pan),this.rotate=r.destroyMaybe(this.rotate),this.pinch=r.destroyMaybe(this.pinch),this.zoomBox=r.destroyMaybe(this.zoomBox),this.animationManager=null}begin(){this.stop(),this._set("interacting",!0)}end(){this._lastEventTimestamp=performance.now(),this._startTimer(250)}async zoom(e,t=this._getDefaultAnchor()){if(this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return e<1?this.zoomIn(t):this.zoomOut(t);this.setViewpoint(t,e,0,[0,0])}async zoomIn(e){const t=this.view,i=t.constraints.snapToNextScale(t.scale);return this._zoomToScale(i,e)}async zoomOut(e){const t=this.view,i=t.constraints.snapToPreviousScale(t.scale);return this._zoomToScale(i,e)}setViewpoint(e,t,i,r){this.begin(),this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,e,t,i,r),this.end()}setViewpointImmediate(e,t=0,i=[0,0],r=this._getDefaultAnchor()){this.view.stateManager.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,r,e,t,i)}continuousRotateClockwise(){const e=this.view.viewpoint;this.animationManager?.animateContinuous(e,e=>{u.rotateBy(e,e,-1)})}continuousRotateCounterclockwise(){const e=this.view.viewpoint;this.animationManager?.animateContinuous(e,e=>{u.rotateBy(e,e,1)})}resetRotation(){this.view.constraints.rotationEnabled&&(this.view.rotation=0)}continuousPanLeft(){this._continuousPan([-10,0])}continuousPanRight(){this._continuousPan([10,0])}continuousPanUp(){this._continuousPan([0,10])}continuousPanDown(){this._continuousPan([0,-10])}continuousPanVector({x:e,y:t}){this._continuousPan([10*e,10*t])}stop(){this.pan.stopMomentumNavigation(),this.animationManager?.stop(),this.end(),null!==this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=null,this._set("interacting",!1))}_continuousPan(e){const t=this.view.viewpoint;this.animationManager?.animateContinuous(t,t=>{u.translateBy(t,t,e),this.view.constraints.constrainByGeometry(t)})}_startTimer(e){return null!==this._endTimer||(this._endTimer=setTimeout(()=>{this._endTimer=null;const e=performance.now()-(this._lastEventTimestamp??0);e<250?this._endTimer=this._startTimer(e):this._set("interacting",!1)},e)),this._endTimer}_getDefaultAnchor(){const{size:e,padding:{left:t,right:i,top:r,bottom:n}}=this.view;return _[0]=.5*(e[0]-i+t),_[1]=.5*(e[1]-n+r),_}async _zoomToScale(e,t=this._getDefaultAnchor()){const{view:i}=this,{constraints:r,scale:n,viewpoint:s,size:o,padding:a}=i,l=r.canZoomInTo(e),c=r.canZoomOutTo(e);if(!(e<n&&!l||e>n&&!c))return u.padAndScaleAndRotateBy(g,s,e/n,0,t,o,a),r.constrainByGeometry(g),i.goTo(g,{animate:!0,animationMode:"always",duration:h.getGoToDuration(),pickClosestTarget:!1})}_scaleRotateTranslateViewpoint(e,t,i,r,n){const{view:s}=this,{size:o,padding:a,constraints:l,scale:c,viewpoint:h}=s,d=c*i,f=l.canZoomInTo(d),p=l.canZoomOutTo(d);return(i<1&&!f||i>1&&!p)&&(i=1),u.translateBy(h,h,n),u.padAndScaleAndRotateBy(e,h,i,r,t,o,a),l.constrainByGeometry(e)}};return e.__decorate([n.property()],y.prototype,"animationManager",void 0),e.__decorate([n.property({type:Boolean,readOnly:!0})],y.prototype,"interacting",void 0),e.__decorate([n.property()],y.prototype,"pan",void 0),e.__decorate([n.property()],y.prototype,"pinch",void 0),e.__decorate([n.property()],y.prototype,"rotate",void 0),e.__decorate([n.property()],y.prototype,"view",void 0),e.__decorate([n.property()],y.prototype,"zoomBox",void 0),y=e.__decorate([l.subclass("esri.views.2d.navigation.MapViewNavigation")],y),y})},"esri/views/2d/navigation/ZoomBox":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/screenUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./duration","../../input/InputManager"],function(e,t,i,r,n,s,o,a,l,c,u){"use strict";const h="esri-zoom-box",d={container:`${h}__container`,overlay:`${h}__overlay`,background:`${h}__overlay-background`,box:`${h}__outline`},f="Shift";return e.default=class extends i{constructor(e){super(e),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(e){this.removeAllHandles(),this._destroyOverlay(),this._set("view",e),e&&this.addHandles([e.on("drag",[f],e=>this._handleDrag(e,1),u.ViewEventPriorities.INTERNAL),e.on("drag",[f,"Control"],e=>this._handleDrag(e,-1),u.ViewEventPriorities.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(e,t,i,r){this._box.x=e,this._box.y=t,this._box.width=i,this._box.height=r,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(e,t,i,n,s){const o=this.view,a=o.toMap(r.createScreenPoint(e+.5*i,t+.5*n));let l=Math.max(i/o.width,n/o.height);-1===s&&(l=1/l),this._destroyOverlay(),this.navigation.end(),o.goTo({center:a,scale:o.scale*l},{animationMode:"always",duration:c.getGoToDuration()})}_updateBox(e,t,i,r){const n=this._boxShape;n.setAttributeNS(null,"x",""+e),n.setAttributeNS(null,"y",""+t),n.setAttributeNS(null,"width",""+i),n.setAttributeNS(null,"height",""+r),n.setAttributeNS(null,"class",d.box)}_updateBackground(e,t,i,r){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(e,t,i,r,this.view.width,this.view.height))}_createContainer(){const e=document.createElement("div");e.className=d.container,this.view.root.appendChild(e),this._container=e}_createOverlay(){const e=this.view.width,t=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+e+" 0 L "+e+" "+t+" L 0 "+t+" Z"),i.setAttributeNS(null,"class",d.background);const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttributeNS(null,"class",d.overlay),n.appendChild(i),n.appendChild(r),this._container.appendChild(n),this._backgroundShape=i,this._boxShape=r,this._overlay=n}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(e,t,i,r,n,s){const o=e+i,a=t+r;return"M 0 0 L "+n+" 0 L "+n+" "+s+" L 0 "+s+" ZM "+e+" "+t+" L "+e+" "+a+" L "+o+" "+a+" L "+o+" "+t+" Z"}_handleDrag(e,t){const i=e.x,r=e.y,n=e.origin.x,s=e.origin.y;let o,a,l,c;switch(i>n?(o=n,l=i-n):(o=i,l=n-i),r>s?(a=s,c=r-s):(a=r,c=s-r),e.action){case"start":this._start();break;case"update":this._update(o,a,l,c);break;case"end":this._end(o,a,l,c,t)}e.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:e,y:t,width:i,height:r}=this._box;this._updateBox(e,t,i,r),this._updateBackground(e,t,i,r),this._rafId=requestAnimationFrame(this._redraw)}},t.__decorate([n.property()],e.default.prototype,"navigation",void 0),t.__decorate([n.property()],e.default.prototype,"view",null),e.default=t.__decorate([l.subclass("esri.views.2d.navigation.ZoomBox")],e.default),e.default})},"esri/views/2d/navigation/actions/Pan":function(){define(["exports","../../../../chunks/tslib.es6","../../../../Viewpoint","../../../../core/Accessor","../../../../core/reactiveUtils","../../../../core/screenUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/Point","../../viewpointUtils","../../../navigation/PanPlanarMomentumEstimator"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m){"use strict";return e.default=class extends r{constructor(e){super(e),this.animationTime=0,this.momentumEstimator=new m.PanPlanarMomentumEstimator(500,6,.92),this.momentum=null,this.tmpMomentum=d.create(),this.momentumFinished=!1,this.viewpoint=new i({targetGeometry:new f,scale:0,rotation:0}),this._previousDrag=null,n.when(()=>this.momentumFinished,()=>this.navigation.stop())}begin(e,t){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(t),this._previousDrag=t}update(e,t){this.addToEstimator(t);let i=t.center.x,r=t.center.y;const n=this._previousDrag;i=n?n.center.x-i:-i,r=n?r-n.center.y:r,e.viewpoint=p.translateBy(this.viewpoint,e.viewpoint,[i||0,r||0]),this._previousDrag=t}end(e,t){this.addToEstimator(t);const i=e.navigation.effectiveMomentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(e),this._previousDrag=null,this.navigation.end()}addToEstimator(e){const t=e.center.x,i=e.center.y,r=s.createScreenPointArray(-t,i),n=d.fromValues(-t,i,0);this.momentumEstimator.add(r,n,.001*e.timestamp)}onAnimationUpdate(e){this.navigation.animationManager?.animateContinuous(e.viewpoint,(t,i)=>{const{momentum:r,animationTime:n,tmpMomentum:s}=this,o=.001*i;if(!(this.momentumFinished=!r||r.isFinished(n))){const i=r.valueDelta(n,o);h.scale(s,r.direction,i),p.translateBy(t,t,s),e.constraints.constrainByGeometry(t)}this.animationTime+=o})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}},t.__decorate([o.property()],e.default.prototype,"momentumFinished",void 0),t.__decorate([o.property()],e.default.prototype,"viewpoint",void 0),t.__decorate([o.property()],e.default.prototype,"navigation",void 0),e.default=t.__decorate([u.subclass("esri.views.2d.navigation.actions.Pan")],e.default),e.default})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define(["exports","../../chunks/vec32","../../core/libs/gl-matrix-2/factories/vec3f64","./FilteredFiniteDifference","./Momentum"],function(e,t,i,r,n){"use strict";class s extends n.Momentum{constructor(e,t,i,r,n){super(e,t,i),this._sceneVelocity=r,this.direction=n}value(e){return super.valueFromInitialVelocity(this._sceneVelocity,e)}}e.PanPlanarMomentum=s,e.PanPlanarMomentumEstimator=class{constructor(e=300,t=12,n=.84){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=n,this.enabled=!0,this._time=new r.FilteredFiniteDifference(.6),this._screen=[new r.FilteredFiniteDifference(.4),new r.FilteredFiniteDifference(.4)],this._scene=[new r.FilteredFiniteDifference(.6),new r.FilteredFiniteDifference(.6),new r.FilteredFiniteDifference(.6)],this._tmpDirection=i.create()}add(e,t,i){if(this.enabled){if(this._time.hasLastValue()&&this._time.computeDelta(i)<.015)return;this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(t[0]),this._scene[1].update(t[1]),this._scene[2].update(t[2]),this._time.update(i)}}reset(){this._screen[0].reset(),this._screen[1].reset(),this._scene[0].reset(),this._scene[1].reset(),this._scene[2].reset(),this._time.reset()}evaluateMomentum(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;const e=this._screen[0].filteredDelta,t=this._screen[1].filteredDelta,i=null==e||null==t?0:Math.sqrt(e*e+t*t),r=this._time.filteredDelta,n=null==r||null==i?0:i/r;return Math.abs(n)<this._minimumInitialVelocity?null:this.createMomentum(n,this._stopVelocity,this._friction)}createMomentum(e,i,r){t.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??0,this._scene[2].filteredDelta??0);const n=t.length(this._tmpDirection);n>0&&t.scale(this._tmpDirection,this._tmpDirection,1/n);const o=this._time.filteredDelta;return new s(e,i,r,null==o?0:n/o,this._tmpDirection)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(e){"use strict";e.FilteredFiniteDifference=class{constructor(e){this._gain=e,this.lastValue=void 0,this.filteredDelta=void 0}update(e){if(this.hasLastValue()){const t=this.computeDelta(e);this._updateDelta(t)}this.lastValue=e}reset(){this.lastValue=void 0,this.filteredDelta=void 0}hasLastValue(){return void 0!==this.lastValue}hasFilteredDelta(){return void 0!==this.filteredDelta}computeDelta(e){return void 0===this.lastValue?NaN:e-this.lastValue}_updateDelta(e){void 0!==this.filteredDelta?this.filteredDelta=(1-this._gain)*this.filteredDelta+this._gain*e:this.filteredDelta=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports"],function(e){"use strict";e.Momentum=class{constructor(e,t,i){this._initialVelocity=e,this._stopVelocity=t,this._friction=i,this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}get duration(){return this._duration}isFinished(e){return e>this.duration}get friction(){return this._friction}value(e){return this.valueFromInitialVelocity(this._initialVelocity,e)}valueDelta(e,t){const i=this.value(e);return this.value(e+t)-i}valueFromInitialVelocity(e,t){t=Math.min(t,this.duration);const i=1-this.friction;return e*(i**t-1)/Math.log(i)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/navigation/actions/Pinch":function(){define(["exports","../../../../chunks/tslib.es6","../../../../Viewpoint","../../../../core/Accessor","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../geometry/Point","../../viewpointUtils","../../../navigation/RotationMomentumEstimator","../../../navigation/ZoomMomentumEstimator"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m){"use strict";return e.default=class extends r{constructor(e){super(e),this._animationTime=0,this._momentumFinished=!1,this._previousAngle=0,this._previousRadius=0,this._previousCenter=null,this._rotationMomentumEstimator=new p.RotationMomentumEstimator(.6,.15,.95),this._rotationDirection=1,this._startAngle=0,this._startRadius=0,this._updateTimestamp=null,this._zoomDirection=1,this._zoomMomentumEstimator=new m.ZoomMomentumEstimator,this._zoomOnly=null,this.viewpoint=new i({targetGeometry:new d,scale:0,rotation:0}),this.zoomMomentum=null,this.rotateMomentum=null,this.addHandles(n.when(()=>this._momentumFinished,()=>this.navigation.stop()))}begin(e,t){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=t.angle,this._previousRadius=this._startRadius=t.radius,this._previousCenter=t.center,this._updateTimestamp=null,e.constraints.rotationEnabled&&this.addToRotateEstimator(0,t.timestamp),this.addToZoomEstimator(t,1)}update(e,t){null===this._updateTimestamp&&(this._updateTimestamp=t.timestamp);const i=t.angle,r=t.radius,n=t.center,s=Math.abs(180*(i-this._startAngle)/Math.PI),o=Math.abs(r-this._startRadius),a=this._startRadius/r;if(this._previousRadius&&this._previousCenter){const l=r/this._previousRadius;let c=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=c>=0?1:-1,this._zoomDirection=l>=1?1:-1,e.constraints.rotationEnabled?(null===this._zoomOnly&&t.timestamp-this._updateTimestamp>200&&(this._zoomOnly=o-s>0),null===this._zoomOnly||this._zoomOnly?c=0:this.addToRotateEstimator(i-this._startAngle,t.timestamp)):c=0,this.addToZoomEstimator(t,a),this.navigation.setViewpoint([n.x,n.y],1/l,c,[this._previousCenter.x-n.x,n.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=r,this._previousCenter=n}end(e){this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(e),this.navigation.end()}addToRotateEstimator(e,t){this._rotationMomentumEstimator.add(e,.001*t)}addToZoomEstimator(e,t){this._zoomMomentumEstimator.add(t,.001*e.timestamp)}canZoomIn(e){const t=e.scale,i=e.constraints.effectiveMaxScale;return 0===i||t>i}canZoomOut(e){const t=e.scale,i=e.constraints.effectiveMinScale;return 0===i||t<i}onAnimationUpdate(e){this.navigation.animationManager?.animateContinuous(e.viewpoint,(t,i)=>{const r=!this.canZoomIn(e)&&this._zoomDirection>1||!this.canZoomOut(e)&&this._zoomDirection<1,n=!this.rotateMomentum||this.rotateMomentum.isFinished(this._animationTime),s=r||!this.zoomMomentum||this.zoomMomentum.isFinished(this._animationTime),o=.001*i;if(this._momentumFinished=n&&s,!this._momentumFinished){const i=this.rotateMomentum?Math.abs(this.rotateMomentum.valueDelta(this._animationTime,o))*this._rotationDirection*180/Math.PI:0;let r=this.zoomMomentum?Math.abs(this.zoomMomentum.valueDelta(this._animationTime,o)):1;const n=h.create(),s=h.create();if(this._previousCenter){u.set(n,this._previousCenter.x,this._previousCenter.y),f.getPaddingScreenTranslation(s,e.size,e.padding),u.add(n,n,s);const{constraints:o,scale:a}=e,l=a*r;r<1&&!o.canZoomInTo(l)?(r=a/o.effectiveMaxScale,this.zoomMomentum=null,this.rotateMomentum=null):r>1&&!o.canZoomOutTo(l)&&(r=a/o.effectiveMinScale,this.zoomMomentum=null,this.rotateMomentum=null),f.scaleAndRotateBy(t,e.viewpoint,r,i,n,e.size),e.constraints.constrainByGeometry(t)}}this._animationTime+=o})}stopMomentumNavigation(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())}},t.__decorate([s.property()],e.default.prototype,"_momentumFinished",void 0),t.__decorate([s.property()],e.default.prototype,"viewpoint",void 0),t.__decorate([s.property()],e.default.prototype,"navigation",void 0),e.default=t.__decorate([c.subclass("esri.views.2d.navigation.actions.Pinch")],e.default),e.default})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","./MomentumEstimator"],function(e,t){"use strict";class i extends t.MomentumEstimator{constructor(e=3,t=.01,i=.95,r=12){super(e,t,i,r)}add(e,t){const i=this.value.lastValue;if(null!=i){let t=e-i;for(;t>Math.PI;)t-=2*Math.PI;for(;t<-Math.PI;)t+=2*Math.PI;e=i+t}super.add(e,t)}}e.RotationMomentumEstimator=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(e,t,i,r){"use strict";e.MomentumEstimator=class{constructor(e=2.5,t=.01,r=.95,n=12){this._minimumInitialVelocity=e,this._stopVelocity=t,this._friction=r,this._maxVelocity=n,this.enabled=!0,this.value=new i.FilteredFiniteDifference(.8),this.time=new i.FilteredFiniteDifference(.3)}add(e,t){if(this.enabled&&null!=t){if(this.time.hasLastValue()){if(this.time.computeDelta(t)<.01)return;if(this.value.hasFilteredDelta()){const t=this.value.computeDelta(e);this.value.filteredDelta*t<0&&this.value.reset()}}this.time.update(t),this.value.update(e)}}reset(){this.value.reset(),this.time.reset()}evaluateMomentum(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let e=this.value.filteredDelta/this.time.filteredDelta;return e=t.clamp(e,-this._maxVelocity,this._maxVelocity),Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)}createMomentum(e,t,i){return new r.Momentum(e,t,i)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","./Momentum","./MomentumEstimator"],function(e,t,i){"use strict";class r extends t.Momentum{constructor(e,t,i){super(e,t,i)}value(e){const t=super.value(e);return Math.exp(t)}valueDelta(e,t){const i=super.value(e),r=super.value(e+t)-i;return Math.exp(r)}}class n extends i.MomentumEstimator{constructor(e=2.5,t=.01,i=.95,r=12){super(e,t,i,r)}add(e,t){super.add(Math.log(e),t)}createMomentum(e,t,i){return new r(e,t,i)}}e.ZoomMomentum=r,e.ZoomMomentumEstimator=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/navigation/actions/Rotate":function(){define(["exports","../../../../chunks/tslib.es6","../../../../Viewpoint","../../../../core/Accessor","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../geometry/Point","../../viewpointUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d){"use strict";const f=u.create(),p=u.create();return e.default=class extends r{constructor(e){super(e),this._previousCenter=u.create(),this.viewpoint=new i({targetGeometry:new h,scale:0,rotation:0})}begin(e,t){this.navigation.begin(),c.set(this._previousCenter,t.center.x,t.center.y)}update(e,t){const{state:{size:i,padding:r}}=e;c.set(f,t.center.x,t.center.y),d.getAnchor(p,i,r),e.viewpoint=d.rotateBy(this.viewpoint,e.state.paddedViewState.viewpoint,d.angleBetween(p,this._previousCenter,f)),c.copy(this._previousCenter,f)}end(){this.navigation.end()}},t.__decorate([n.property()],e.default.prototype,"viewpoint",void 0),t.__decorate([n.property()],e.default.prototype,"navigation",void 0),e.default=t.__decorate([l.subclass("esri.views.2d.navigation.actions.Rotate")],e.default),e.default})},"esri/views/2d/magnifier/MagnifierView2D":function(){define(["../../../request","../../../core/asyncUtils","../../../core/Handles","../../../core/maybe","../../../core/reactiveUtils","../../../core/libs/gl-matrix-2/factories/mat3f32","../../../core/support/UpdatingHandles","../engine/DisplayObject","../engine/webgl/shaderGraph/techniques/magnifier/MagnifierTechnique","../../magnifier/resources"],function(e,t,i,r,n,s,o,a,l,c){"use strict";class u extends a.DisplayObject{constructor(){super(),this._handles=new i,this._magnifierTechnique=new l.MagnifierTechnique,this.updatingHandles=new o.UpdatingHandles,this.visible=!1}destroy(){super.destroy(),this._handles=r.destroyMaybe(this._handles),this._magnifierTechnique.shutdown(),this._resourcesTask=r.abortMaybe(this._resourcesTask)}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){this._backgroundColor=e,this.requestRender()}get magnifier(){return this._magnifier}set magnifier(e){this._magnifier=e,this._handles.removeAll(),this._handles.add([n.watch(()=>e.version,()=>{this.visible=e.visible&&null!=e.position&&e.size>0,this.requestRender()},n.initial),n.watch(()=>[e.maskUrl,e.overlayUrl],()=>this._reloadResources()),n.watch(()=>e.size,()=>{this._magnifierTechnique.shutdown(),this.requestRender()})])}_createTransforms(){return{displayViewScreenMat3:s.create()}}doRender(e){if(!this._resourcesTask)return void this._reloadResources();if(1!==e.drawPhase||!this._canRender())return;const t=this._magnifier;if(null==t.position)return;this._magnifierTechnique.updateResources(e,this._mask,this._overlay,t);const i=this.backgroundColor,r=i?[i.a*i.r/255,i.a*i.g/255,i.a*i.b/255,i.a]:[1,1,1,1];this._magnifierTechnique.render(e,{background:r,maskEnabled:t.maskEnabled?1:0,overlayEnabled:t.overlayEnabled?1:0})}_canRender(){return this._mask&&this._overlay&&null!=this._magnifier}_reloadResources(){this._resourcesTask&&this._resourcesTask.abort();const i=null!=this._magnifier?this._magnifier.maskUrl:null,r=null!=this._magnifier?this._magnifier.overlayUrl:null;this._resourcesTask=t.createTask(async t=>{const n=null==i||null==r?c.loadMagnifierResources(t):null,s=null!=i?e(i,{responseType:"image",signal:t}).then(e=>e.data):n.then(e=>e.mask),o=null!=r?e(r,{responseType:"image",signal:t}).then(e=>e.data):n.then(e=>e.overlay),[a,l]=await Promise.all([s,o]);this._mask=a,this._overlay=l,this._magnifierTechnique.shutdown(),this.requestRender()}),this.updatingHandles.addPromise(this._resourcesTask.promise)}}return u})},"esri/views/2d/engine/webgl/shaderGraph/techniques/magnifier/MagnifierTechnique":function(){define(["exports","../../../../../../../core/mathUtils","../../../../../../../core/maybe","../../../../../../../core/urlUtils","../../utils","../Technique","../shaders/MagnifierShader","../../../../../../webgl/Texture","../../../../../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a,l){"use strict";class c extends s.Technique{constructor(){super(...arguments),this.type=16,this._resourcePixelRatio=1,this._position=[0,0,0,0],this.shaders={magnifier:new o.MagnifierShader}}updateResources(e,i,r,n){e.pixelRatio!==this._resourcePixelRatio&&this._destroyResources(),this._readbackTexture||this._initializeResources(e,i,r,n);const{context:s,pixelRatio:o}=e,{factor:a,offset:l,position:c}=n,{size:u}=e.state,h=n.size*o,d=1/a,f=Math.ceil(d*h);this._readbackTexture.resize(f,f);const p=o*u[0],m=o*u[1],g=.5*f,_=.5*f,y=t.clamp(o*c.x,g,p-g-1),x=t.clamp(m-o*c.y,_,m-_-1),b=y-g,v=x-_,S=this._readbackTexture;s.bindTexture(S,0),s.gl.copyTexImage2D(S.descriptor.target,0,S.descriptor.pixelFormat,b,v,f,f,0);const w=(y+l.x*o)/p*2-1,T=(x-l.y*o)/m*2-1,M=h/p*2,P=h/m*2;this._position[0]=w,this._position[1]=T,this._position[2]=M,this._position[3]=P}render(e,t){const{context:i,painter:r}=e;r.setPipelineState(n.simplePipelineState);const s={readbackTexture:{texture:this._readbackTexture,unit:0},maskTexture:{texture:this._maskTexture,unit:7},overlayTexture:{texture:this._overlayTexture,unit:6},drawPos:this._position,...t};r.submitDrawMesh(i,{shader:this.shaders.magnifier,uniforms:{config:s},defines:null,optionalAttributes:null,useComputeBuffer:!1},r.quadMesh)}shutdown(){this._destroyResources()}_initializeResources(e,t,i,n){const s=e.context;this._resourcePixelRatio=e.pixelRatio;const o=Math.ceil(n.size*e.pixelRatio);i.width=o,i.height=o;const c=new l.TextureDescriptor(Math.ceil(o/n.factor));c.internalFormat=6408,c.wrapMode=33071,c.samplingMode=9728,c.flipped=!0,c.preMultiplyAlpha=!r.isSVG(i.src)||!e.context.driverTest.svgPremultipliesAlpha.result,this._overlayTexture=new a.Texture(s,c,i),t.width=o,t.height=o,c.pixelFormat=c.internalFormat=6406,this._maskTexture=new a.Texture(s,c,t),c.pixelFormat=c.internalFormat=6408,c.samplingMode=9729,c.flipped=!1,this._readbackTexture=new a.Texture(s,c)}_destroyResources(){i.disposeMaybe(this._maskTexture),i.disposeMaybe(this._overlayTexture),i.disposeMaybe(this._readbackTexture),this._maskTexture=null,this._overlayTexture=null,this._readbackTexture=null}}e.MagnifierTechnique=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/MagnifierShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./constants"],function(e,t,i,r,n){"use strict";class s extends i.VertexInput{}t.__decorate([i.location(0,r.Vec2)],s.prototype,"position",void 0);class o extends i.FragmentInput{}class a extends i.UniformGroup{}t.__decorate([i.uniform(r.Sampler2D)],a.prototype,"readbackTexture",void 0),t.__decorate([i.uniform(r.Sampler2D)],a.prototype,"maskTexture",void 0),t.__decorate([i.uniform(r.Sampler2D)],a.prototype,"overlayTexture",void 0),t.__decorate([i.uniform(r.Vec4)],a.prototype,"background",void 0),t.__decorate([i.uniform(r.Vec4)],a.prototype,"drawPos",void 0),t.__decorate([i.uniform(r.Float)],a.prototype,"maskEnabled",void 0),t.__decorate([i.uniform(r.Float)],a.prototype,"overlayEnabled",void 0);class l extends i.GraphShaderModule{constructor(){super(...arguments),this.type="MagnifierShader"}vertex(e){const t=e.position,i=e.position.subtract(new r.Vec2(.5)).multiply(this.config.drawPos.zw),n=this.config.drawPos.xy.add(i);return{glPosition:new r.Vec4(n,0,1),texCoord:t}}fragment(e){let t=r.texture2D(this.config.readbackTexture,function(e){const t=e.multiply(new r.Vec2(2)).subtract(1);return r.ifElse(r.equal(t.x,new r.Float(0)).and(r.equal(t.y,new r.Float(0))),new r.Vec2(.5),()=>{const e=r.atan(t.y,t.x),i=r.pow(r.length(t),new r.Float(n.magnifierBarrelFactor)),s=new r.Vec2(r.cos(e),r.sin(e));return i.multiply(s).multiply(new r.Vec2(.5)).add(new r.Float(.5))})}(e.texCoord));t=t.add(new r.Float(1).subtract(t.a)).multiply(this.config.background);const s=r.ifElse(r.equal(this.config.maskEnabled,new r.Float(1)),r.texture2D(this.config.maskTexture,e.texCoord).a,new r.Float(1));t=t.multiply(s);const o=r.ifElse(r.equal(this.config.overlayEnabled,new r.Float(1)),r.texture2D(this.config.overlayTexture,e.texCoord),new r.Vec4(0)),a=new i.FragmentOutput;return a.fragColor=o.add(new r.Float(1).subtract(o.a).multiply(t)),a}}t.__decorate([i.uniform(a)],l.prototype,"config",void 0),t.__decorate([t.__param(0,i.input(s))],l.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(o))],l.prototype,"fragment",null),e.MagnifierShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(e,t,i,r){"use strict";const n=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));t.loadMagnifierResources=async function(t){const s=new Promise((t,i)=>e(["./mask-svg"],e=>t(n(e)),i)),o=new Promise((t,i)=>e(["./overlay-svg"],e=>t(n(e)),i)),a=r.requestImage((await s).default,{signal:t}),l=r.requestImage((await o).default,{signal:t}),c={mask:await a,overlay:await l};return i.throwIfAborted(t),c},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../request"],function(e,t){"use strict";e.requestImage=async function(e,i){const{data:r}=await t(e,{responseType:"image",...i});return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/grid/GridView2D":function(){define(["../../../core/Handles","../../../core/mathUtils","../../../core/maybe","../../../core/reactiveUtils","../../../core/unitUtils","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f32","../../../core/libs/gl-matrix-2/math/vec2","../../../core/libs/gl-matrix-2/factories/vec2f32","../../../core/libs/gl-matrix-2/factories/vec2f64","../../../geometry/projectionUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/scaleUtils","../../../geometry/support/spatialReferenceUtils","../engine/DisplayObject","../engine/webgl/shaderGraph/techniques/grid/GridTechnique","./constants","./gridUtils"],function(e,t,i,r,n,s,o,a,l,c,u,h,d,f,p,m,g,_){"use strict";const y=c.create();class x extends p.DisplayObject{constructor(){super(),this._handles=new e,this._projectedCenter=null,this._metersPerSRUnit=null,this._technique=new m.GridTechnique,this._grid=null,this.visible=!0}destroy(){super.destroy(),this._handles=i.destroyMaybe(this._handles),this._technique.shutdown()}get grid(){return this._grid}set grid(e){this._grid=e,this._handles.removeAll(),this._handles.add([r.watch(()=>e?.center,()=>{this._projectedCenter=null},r.initial),r.watch(()=>[e?.center,e?.dynamicScaling,e?.majorLineColor,e?.majorLineInterval,e?.minorLineColor,e?.rotateWithMap,e?.rotation,e?.spacing,e?.units],()=>this.requestRender(),r.initial)])}_createTransforms(){return{displayViewScreenMat3:o.create()}}doRender(e){if(1!==e.drawPhase||null==this.grid||!this.visible)return;const{spacing:t,units:i,majorLineInterval:r,dynamicScaling:s,majorLineColor:o,minorLineColor:a}=this.grid;if(0===t)return;if(this._updateDerivedValues(e),null==this._projectedCenter||null==this._metersPerSRUnit)return;const{scale:l,spatialReference:c}=e.state,u=n.convertUnit(t,i,"meters"),h=this._metersPerSRUnit*d.getResolutionForScale(l,c),f=u/h;if(!s&&f<g.minimumPixelsPerStrideForDisplayWhenScalingOff)return;const p=u*_.getScaleFactor(r,f,s);this._updateTransform(e,h,p),this._technique.render(e,{transform:{dvs:this.transforms.displayViewScreenMat3},config:{pxPerCell:p/h,minorLineColor:b(a),majorLineColor:b(o),majorLineInterval:r,halfWidth:.25,aaWidth:.5}})}_updateDerivedValues(e){if(!this.grid)return;const{center:t}=this.grid,{spatialReference:i}=e.state;this._projectedCenter&&f.equals(this._projectedCenter.spatialReference,i)||(this._metersPerSRUnit=null,f.equals(t.spatialReference,i)?this._projectedCenter=t:u.isLoadedOrLoadFor(t.spatialReference,i)?this._projectedCenter=u.project(t,i):this.requestRender()),null==this._metersPerSRUnit&&null!=this._projectedCenter&&(this._metersPerSRUnit=_.measureMetersPerUnitAtReferencePoint(this._projectedCenter))}_updateTransform(e,i,r){const{grid:n}=this,{center:o,rotation:c,size:u,spatialReference:d}=e.state;if(null==n||null==this._projectedCenter||null==this._metersPerSRUnit)return;const f=i*(u[0]/2),p=i*(u[1]/2),m=this._metersPerSRUnit/r,g=this._projectedCenter,_=t.deg2rad(n.rotation),x=t.deg2rad(c),b=this.transforms.displayViewScreenMat3;s.fromRotation(b,-_);const v=d.isWrappable?h.getClosestDenormalizedXToReference(g.x,o[0],d):g.x,S=a.set(y,v,g.y),w=a.sub(y,o,S);var T,M;a.scale(w,w,m),n.rotateWithMap||a.rotate(w,w,l.ZEROS,-x),a.rotate(w,w,l.ZEROS,-_),a.scale(w,w,1/n.majorLineInterval),M=w,(T=w)[0]=M[0]-Math.trunc(M[0]),T[1]=M[1]-Math.trunc(M[1]),a.scale(w,w,n.majorLineInterval),a.rotate(w,w,l.ZEROS,_),s.translate(b,b,w),n.rotateWithMap&&s.rotate(b,b,x);const P=f/r,I=p/r,C=a.set(y,P,I);s.scaleByVec2(b,b,C)}}function b(e){const[t,i,r,n]=e.toArray().map(e=>e/255);return[t*n,i*n,r*n,n]}return x})},"esri/views/2d/engine/webgl/shaderGraph/techniques/grid/GridTechnique":function(){define(["exports","../../utils","../Technique","../shaders/GridShader"],function(e,t,i,r){"use strict";class n extends i.Technique{constructor(){super(...arguments),this.type=12,this.shaders={grid:new r.GridShader}}render(e,i){const{context:r,painter:n}=e;n.setPipelineState(t.simplePipelineState),n.submitDrawMesh(r,{shader:this.shaders.grid,uniforms:i,defines:null,optionalAttributes:null,useComputeBuffer:!1},n.quadMesh)}}e.GridTechnique=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/GridShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,i,r){"use strict";class n extends i.VertexInput{}t.__decorate([i.location(0,r.Vec2)],n.prototype,"position",void 0);class s extends i.FragmentInput{}class o extends i.UniformGroup{}t.__decorate([i.uniform(r.Mat3)],o.prototype,"dvs",void 0);class a extends i.UniformGroup{}t.__decorate([i.uniform(r.Float)],a.prototype,"halfWidth",void 0),t.__decorate([i.uniform(r.Float)],a.prototype,"aaWidth",void 0),t.__decorate([i.uniform(r.Float)],a.prototype,"pxPerCell",void 0),t.__decorate([i.uniform(r.Vec4)],a.prototype,"minorLineColor",void 0),t.__decorate([i.uniform(r.Vec4)],a.prototype,"majorLineColor",void 0),t.__decorate([i.uniform(r.Int)],a.prototype,"majorLineInterval",void 0);class l extends i.GraphShaderModule{constructor(){super(...arguments),this.type="GridShader"}vertex(e){const t=e.position.multiply(2).subtract(1);return{gridPos:this.transform.dvs.multiply(new r.Vec3(t,1)).xy,glPosition:new r.Vec4(t,0,1)}}fragment(e){const t=r.abs(e.gridPos),n=r.fract(t),s=r.min(n.x,new r.Float(1).subtract(n.x)),o=r.min(n.y,new r.Float(1).subtract(n.y)),a=new r.Vec2(s,o).multiply(this.config.pxPerCell).subtract(this.config.halfWidth),l=r.min(a.x,a.y),c=new r.Float(1).subtract(r.smoothstep(new r.Float(0),this.config.aaWidth,l)),u=new r.Int(r.round(t.x)),h=new r.Int(r.round(t.y)),d=new r.Float(r.intMod(u,this.config.majorLineInterval)),f=new r.Float(r.intMod(h,this.config.majorLineInterval)),p=r.ifElse(r.lessThan(a.x,a.y),d,f),m=r.greaterThan(r.multiply(r.step(a.x,this.config.aaWidth),r.step(a.y,this.config.aaWidth)),new r.Float(.5)),g=r.min(d,f),_=r.ifElse(m,g,p),y=r.mix(this.config.majorLineColor,this.config.minorLineColor,r.min(_,new r.Float(1))),x=new i.FragmentOutput;return x.fragColor=y.multiply(c),x}}t.__decorate([i.uniform(o)],l.prototype,"transform",void 0),t.__decorate([i.uniform(a)],l.prototype,"config",void 0),t.__decorate([t.__param(0,i.input(n))],l.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(s))],l.prototype,"fragment",null),e.GridShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/grid/constants":function(){define(["exports"],function(e){"use strict";e.minimumPixelsPerStrideForDisplayWhenScalingOff=5,e.pixelsPerCell=50,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/grid/gridUtils":function(){define(["exports","../../../core/unitUtils","../../../geometry/Point","../../../geometry/Polyline","../../../geometry/SpatialReference","../../../geometry/support/geodesicUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils","./constants"],function(e,t,i,r,n,s,o,a,l,c){"use strict";function u(e){const{isGeographic:t,isWebMercator:i}=e;return!t&&!i}e.getScaleFactor=function(e,t,i){const r=1===e?10:e;var n,s;return r**(i?Math.round((n=c.pixelsPerCell/t,s=r,Math.log(n)/Math.log(s))):0)},e.measureMetersPerUnitAtReferencePoint=function(e,c,h){const d="number"==typeof e?null:e,f=h??d?.spatialReference;if(null==f||!a.isValid(f)||u(f))return t.getMetersPerUnitForSR(f);let p=d?.x??e,m=d?.y??c;const g=1/Math.sqrt(2);let _=p+g,y=m+g;const{isWebMercator:x,isGeographic:b}=f;let v=b&&!s.isSupported(f)?n.WGS84:f;if(x){let e=new i({x:p,y:m,spatialReference:f});l.webMercatorToGeographic(e,!0,e),p=e.x,m=e.y,e=new i({x:_,y,spatialReference:f}),l.webMercatorToGeographic(e,!0,e),_=e.x,y=e.y,v=n.WGS84}const S=new r({paths:[[[p,m],[_,y]]],spatialReference:v}),w=o.straightLineDensify(S,10);let T;try{[T]=s.geodesicLengths([w],"meters")}catch{return t.getMetersPerUnitForSR(f)}return T},e.shouldUsePlanar=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/geodesicUtils":function(){define(["exports","../../core/Error","../../core/unitUtils","../../core/accessorSupport/ensureType","../Point","../Polygon","../Polyline","../SpatialReference","./geodesicConstants","./spatialReferenceUtils"],function(e,t,i,r,n,s,o,a,l,c){"use strict";function u(e){if(!e)return null;const t=e.wkid;if(t)return l.spheroids[t];const i=e.wkt2??e.wkt;return i?function(e){const t=l.wktSpheroidRegex.exec(e);if(!t||2!==t.length)return null;const i=t[1].split(",");if(!i||i.length<3)return null;const r=parseFloat(i[1]),n=parseFloat(i[2]);return isNaN(r)||isNaN(n)?null:{a:r,f:0===n?0:1/n}}(i):null}function h(e){const t=u(e);if(function(e){return null!=e&&"b"in e&&"eSq"in e&&"radius"in e}(t))return t;const i=t.a*(1-t.f);return Object.assign(t,{b:i,eSq:1-(i/t.a)**2,radius:(2*t.a+i)/3,densificationRatio:1e4/((2*t.a+i)/3)})}function d(e){return null!=e&&e<0?e+360:e}function f(e,t,i){const{a:r,eSq:n}=h(i),s=Math.sqrt(n),o=Math.sin(t[1]*l.toRadians),a=r*t[0]*l.toRadians;let c;return c=n>0?r*((1-n)*(o/(1-n*(o*o))-1/(2*s)*Math.log((1-s*o)/(1+s*o))))*.5:r*o,e[0]=a,e[1]=c,e}function p(e){return c.isGeographic(e)&&!!u(e)}function m(e,i){if("polyline"!==e.type&&"polygon"!==e.type)throw new t("geodesic-densify:invalid-geometry","the input geometry is neither polyline nor polygon");const{spatialReference:n}=e;if(!p(n))throw new t("geodesic-densify:invalid-spatial-reference","the input geometry spatial reference is not supported");const l="polyline"===e.type?e.paths:e.rings,c=[],u=[0,0],h=new g;for(const e of l){const t=[];c.push(t),t.push([e[0][0],e[0][1]]);let r,s,o=e[0][0],a=e[0][1];for(let l=0;l<e.length-1;l++){if(r=e[l+1][0],s=e[l+1][1],o===r&&a===s)continue;const c=[o,a];y(h,[o,a],[r,s],n);const{azimuth:d,distance:f}=h,p=f/i;if(p>1){for(let e=1;e<=p-1;e++)_(u,c,d,e*i,n),t.push(u.slice());_(u,c,d,(f+Math.floor(p-1)*i)/2,n),t.push(u.slice())}_(u,c,d,f,n),t.push(u.slice()),o=u[0],a=u[1]}}const d=r.ensureClass(a,n);return"polyline"===e.type?new o({paths:c,spatialReference:d}):new s({rings:c,spatialReference:d})}class g{constructor(e=0,t=void 0,i=void 0){this.distance=e,this.azimuth=t,this.reverseAzimuth=i}}function _(e,t,i,r,n){const s=t[0],o=t[1],a=s*l.toRadians,c=o*l.toRadians,u=(i??0)*l.toRadians,{a:d,b:f,f:p}=h(n),m=Math.sin(u),g=Math.cos(u),_=(1-p)*Math.tan(c),y=1/Math.sqrt(1+_*_),x=_*y,b=Math.atan2(_,g),v=y*m,S=v*v,w=1-S,T=w*(d*d-f*f)/(f*f),M=1+T/16384*(4096+T*(T*(320-175*T)-768)),P=T/1024*(256+T*(T*(74-47*T)-128));let I,C,F,O=r/(f*M),A=2*Math.PI;for(;Math.abs(O-A)>1e-12;)F=Math.cos(2*b+O),I=Math.sin(O),C=Math.cos(O),A=O,O=r/(f*M)+P*I*(F+P/4*(C*(2*F*F-1)-P/6*F*(4*I*I-3)*(4*F*F-3)));const E=x*I-y*C*g,z=Math.atan2(x*C+y*I*g,(1-p)*Math.sqrt(S+E*E)),R=p/16*w*(4+p*(4-3*w)),V=Math.atan2(I*m,y*C-x*I*g)-(1-R)*p*v*(O+R*I*(F+R*C*(2*F*F-1)));return e[0]=(a+V)/l.toRadians,e[1]=z/l.toRadians,e}function y(e,t,i,r){const n=t[0]*l.toRadians,s=t[1]*l.toRadians,o=i[0]*l.toRadians,a=i[1]*l.toRadians,{a:c,b:u,f:d,radius:f}=h(r),p=o-n,m=Math.atan((1-d)*Math.tan(s)),g=Math.atan((1-d)*Math.tan(a)),_=Math.sin(m),y=Math.cos(m),x=Math.sin(g),b=Math.cos(g);let v,S,w,T,M,P,I,C,F,O,A=1e3,E=p;do{if(I=Math.sin(E),C=Math.cos(E),w=Math.sqrt(b*I*(b*I)+(y*x-_*b*C)*(y*x-_*b*C)),0===w)return e.distance=0,e.azimuth=void 0,e.reverseAzimuth=void 0,e;M=_*x+y*b*C,P=Math.atan2(w,M),F=y*b*I/w,S=1-F*F,T=M-2*_*x/S,isNaN(T)&&(T=0),O=d/16*S*(4+d*(4-3*S)),v=E,E=p+(1-O)*d*F*(P+O*w*(T+O*M*(2*T*T-1)))}while(Math.abs(E-v)>1e-12&&--A>0);if(0===A){const t=f,i=Math.acos(Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos(o-n))*t,r=o-n,c=Math.sin(r)*Math.cos(a),u=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(r),h=Math.atan2(c,u);return e.azimuth=h/l.toRadians,e.distance=i,e.reverseAzimuth=void 0,e}const z=S*(c*c-u*u)/(u*u),R=z/1024*(256+z*(z*(74-47*z)-128)),V=u*(1+z/16384*(4096+z*(z*(320-175*z)-768)))*(P-R*w*(T+R/4*(M*(2*T*T-1)-R/6*T*(4*w*w-3)*(4*T*T-3)))),D=Math.atan2(b*Math.sin(E),y*x-_*b*Math.cos(E)),k=Math.atan2(y*Math.sin(E),y*x*Math.cos(E)-_*b);return e.azimuth=D/l.toRadians,e.distance=V,e.reverseAzimuth=k/l.toRadians,e}e.InverseGeodeticSolverResult=g,e.directGeodeticSolver=_,e.geodesicAreas=function(e,r="square-meters"){if(e.some(e=>!p(e.spatialReference)))throw new t("geodesic-areas:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let t=0;t<e.length;t++){const i=e[t],r=i.spatialReference,{radius:s,densificationRatio:o}=h(r),a=s*o;n.push(m(i,a))}const s=[],o=[0,0],a=[0,0];for(let e=0;e<n.length;e++){const{rings:t,spatialReference:l}=n[e];let c=0;for(let e=0;e<t.length;e++){const i=t[e];f(o,i[0],l),f(a,i[i.length-1],l);let r=a[0]*o[1]-o[0]*a[1];for(let e=0;e<i.length-1;e++)f(o,i[e+1],l),f(a,i[e],l),r+=a[0]*o[1]-o[0]*a[1];c+=r}c=i.convertUnit(c,"square-meters",r),s.push(c/-2)}return s},e.geodesicCompatibleSpatialReference=function(e){return p(e)?e:c.isWebMercator(e)?a.WGS84:null},e.geodesicDensify=m,e.geodesicDistance=function(e,r,n="meters"){if(!e||!r)throw new t("geodesic-distance:missing-parameters","one or both input parameters are missing");if(!e.spatialReference||!r.spatialReference)throw new t("geodesic-distance:invalid-parameters","one or both input points do not have a spatial reference");if(!c.equals(e.spatialReference,r.spatialReference))throw new t("geodesic-distance:invalid-parameters","spatial references of input parameters do not match");const{spatialReference:s}=e;if(!p(s))throw new t("geodesic-distance:not-supported","input geometry spatial reference is not supported");if(e.x===r.x&&e.y===r.y)return new g(0,0,0);const o=new g;return y(o,[e.x,e.y],[r.x,r.y],s),o.distance=i.convertUnit(o.distance,"meters",n),o.azimuth=d(o.azimuth),o.reverseAzimuth=d(o.reverseAzimuth),o},e.geodesicLengths=function(e,r="meters"){if(!e)throw new t("geodesic-lengths:invalid-geometries","the input geometries type is not supported");if(e.some(e=>!p(e.spatialReference)))throw new t("geodesic-lengths:invalid-spatial-reference","the input geometries spatial reference is not supported");const n=[];for(let t=0;t<e.length;t++){const s=e[t],{spatialReference:o}=s,a="polyline"===s.type?s.paths:s.rings;let l=0;for(let e=0;e<a.length;e++){const t=a[e];let i=0;for(let e=1;e<t.length;e++){const r=t[e-1][0],n=t[e][0],s=t[e-1][1],a=t[e][1];if(s!==a||r!==n){const e=new g;y(e,[r,s],[n,a],o),i+=e.distance}}l+=i}l=i.convertUnit(l,"meters",r),n.push(l)}return n},e.inverseGeodeticSolver=y,e.isSupported=p,e.pointFromDistance=function(e,i,r){if(!e||null==i||null==r)throw new t("point-from-distance:missing-parameters","one or more input parameters are missing or undefined");if(r<0||r>360)throw new t("point-from-distance:-of-bounds","azimuth is restricted to angles between, and including, 0° to 360° degrees");if(!e.spatialReference)throw new t("point-from-distance:missing-spatial-reference","the input point must have a spatial reference");const{spatialReference:s}=e;if(!p(s))throw new t("geodesic-distance:not-supported","input geometry spatial reference is not supported");const o=[0,0];return _(o,[e.x,e.y],r,i,s),new n({x:o[0],y:o[1],spatialReference:s})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["exports","./math/mat4"],function(e,t){"use strict";e.mat4=t.mat4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["exports","./factories/mat4f32"],function(e,t){"use strict";e.mat4f32=t.mat4f32,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["exports","./factories/vec3f32"],function(e,t){"use strict";e.vec3f32=t.vec3f32,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["exports","./factories/vec4f32"],function(e,t){"use strict";e.vec4f32=t.vec4f32,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/Bitmap":function(){define(["exports","../../../core/promiseUtils","../../../core/libs/gl-matrix-2/math/mat3","../../../core/libs/gl-matrix-2/factories/mat3f32","../../../core/libs/gl-matrix-2/factories/vec2f32","./DisplayObject","./ImageryBitmapSource","../../webgl/enums","../../webgl/Texture","../../webgl/TextureDescriptor"],function(e,t,i,r,n,s,o,a,l,c){"use strict";function u(e){return e&&"render"in e}function h(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,e.render(t.getContext("2d")),t}class d extends s.DisplayObject{constructor(e=null,t=!1){super(),this.blendFunction="standard",this._sourceWidth=0,this._sourceHeight=0,this._textureInvalidated=!1,this.stencilRef=0,this.coordScale=[1,1],this._height=void 0,this.pixelRatio=1,this.resolution=0,this.rotation=0,this._source=null,this._texture=null,this._width=void 0,this.x=0,this.y=0,this.immutable=t,this.source=e,this.requestRender=this.requestRender.bind(this)}destroy(){super.destroy(),this._texture&&(this._texture.dispose(),this._texture=null),null!=this._uploadStatus&&(this._uploadStatus.controller.abort(),this._uploadStatus=null)}get isSourceScaled(){return this.width!==this._sourceWidth||this.height!==this._sourceHeight}get height(){return void 0!==this._height?this._height:this._sourceHeight}set height(e){this._height=e}get source(){return this._source}set source(e){null==e&&null==this._source||(this._source=e,this.invalidateTexture(),this.requestRender())}get texture(){return this._texture}get width(){return void 0!==this._width?this._width:this._sourceWidth}set width(e){this._width=e}beforeRender(e){super.beforeRender(e),this.updateTexture(e)}async setSourceAsync(e,i){null!=this._uploadStatus&&this._uploadStatus.controller.abort();const r=new AbortController,n=t.createResolver();return t.onAbortOrThrow(i,()=>r.abort()),t.onAbortOrThrow(r,e=>n.reject(e)),this._uploadStatus={controller:r,resolver:n},this.source=e,n.promise}invalidateTexture(){this._textureInvalidated||(this._textureInvalidated=!0,this._source instanceof HTMLImageElement?(this._sourceHeight=this._source.naturalHeight,this._sourceWidth=this._source.naturalWidth):this._source&&(this._sourceHeight=this._source.height,this._sourceWidth=this._source.width))}transitionStep(e,t){e>=64&&(this.fadeTransitionEnabled=!1),super.transitionStep(e,t)}setTransform(e){const t=i.identity(this.transforms.displayViewScreenMat3),[r,s]=e.toScreenNoRotation([0,0],[this.x,this.y]),o=this.resolution/this.pixelRatio/e.resolution,a=o*this.width,l=o*this.height,c=Math.PI*this.rotation/180;i.translate(t,t,n.fromValues(r,s)),i.translate(t,t,n.fromValues(a/2,l/2)),i.rotate(t,t,-c),i.translate(t,t,n.fromValues(-a/2,-l/2)),i.scaleByVec2(t,t,n.fromValues(a,l)),i.multiply(this.transforms.displayViewScreenMat3,e.displayViewMat3,t)}setSamplingProfile(e){this._texture&&(e.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),this._texture.setSamplingMode(e.samplingMode))}bind(e,t){this._texture&&e.bindTexture(this._texture,t)}async updateTexture({context:e,painter:i}){if(!this._textureInvalidated)return;if(this._textureInvalidated=!1,this._texture||(this._texture=this._createTexture(e)),!this.source)return void this._texture.setData(null);this._texture.resize(this._sourceWidth,this._sourceHeight);const r=u(n=this.source)?n instanceof o?n.getRenderedRasterPixels()?.renderedRasterPixels:h(n):n;var n;try{if(null!=this._uploadStatus){const{controller:e,resolver:t}=this._uploadStatus,n={signal:e.signal},{width:s,height:o}=this,a=this._texture,l=i.textureUploadManager;await l.enqueueTextureUpdate({data:r,texture:a,width:s,height:o},n),t.resolve(),this._uploadStatus=null}else this._texture.setData(r);this.ready()}catch(e){t.throwIfNotAbortError(e)}}onDetach(){this.destroy()}_createTransforms(){return{displayViewScreenMat3:r.create()}}_createTexture(e){const t=this.immutable,i=new c.TextureDescriptor(this._sourceWidth,this._sourceHeight);return i.internalFormat=t?a.SizedPixelFormat.RGBA8:6408,i.wrapMode=33071,i.isImmutable=t,new l.Texture(e,i)}}e.Bitmap=d,e.isImageSource=u,e.rasterize=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/ImageryBitmapSource":function(){define(function(){"use strict";return class{constructor(e,t,i){this.pixelBlock=e,this.extent=t,this.originalPixelBlock=i}get width(){return null!=this.pixelBlock?this.pixelBlock.width:0}get height(){return null!=this.pixelBlock?this.pixelBlock.height:0}render(e){const t=this.pixelBlock;if(null==t)return;const i=this.filter({extent:this.extent,pixelBlock:this.originalPixelBlock??t});if(null==i.pixelBlock)return;i.pixelBlock.maskIsAlpha&&(i.pixelBlock.premultiplyAlpha=!0);const r=i.pixelBlock.getAsRGBA(),n=e.createImageData(i.pixelBlock.width,i.pixelBlock.height);n.data.set(r),e.putImageData(n,0,0)}getRenderedRasterPixels(){const e=this.filter({extent:this.extent,pixelBlock:this.pixelBlock});return null==e.pixelBlock?null:(e.pixelBlock.maskIsAlpha&&(e.pixelBlock.premultiplyAlpha=!0),{width:e.pixelBlock.width,height:e.pixelBlock.height,renderedRasterPixels:new Uint8Array(e.pixelBlock.getAsRGBA().buffer)})}}})},"esri/views/2d/engine/BitmapContainer":function(){define(["exports","./webgl/WGLContainer","./webgl/shaderGraph/techniques/bitmap/BitmapTechnique"],function(e,t,i){"use strict";e.BitmapContainer=class extends t{constructor(){super(...arguments),this._hasCrossfade=!1,this._bitmapTechnique=null}get requiresDedicatedFBO(){return super.requiresDedicatedFBO||this._hasCrossfade}beforeRender(e){super.beforeRender(e),this._manageFade()}onAttach(){super.onAttach(),this._bitmapTechnique=new i.BitmapTechnique}onDetach(){super.onDetach(),this._bitmapTechnique?.shutdown(),this._bitmapTechnique=null}renderChildren(e){super.renderChildren(e),this.visible&&1===e.drawPhase&&null!=this._bitmapTechnique&&this._bitmapTechnique.render(e,{bitmaps:this.children})}_manageFade(){this.children.reduce((e,t)=>e+(t.inFadeTransition?1:0),0)>=2?(this.children.forEach(e=>e.blendFunction="additive"),this._hasCrossfade=!0):(this.children.forEach(e=>e.blendFunction="standard"),this._hasCrossfade=!1)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/bitmap/BitmapTechnique":function(){define(["exports","../../../definitions","../Technique","../shaders/BitmapShader"],function(e,t,i,r){"use strict";const n={nearest:{samplingMode:9728,mips:!1},bilinear:{samplingMode:9729,mips:!1},bicubic:{samplingMode:9729,mips:!1},trilinear:{samplingMode:9987,mips:!0}},s=(e,t,i)=>{if("dynamic"===i.samplingMode){const{state:i}=e,r=t.resolution/t.pixelRatio/i.resolution,s=Math.round(e.pixelRatio)!==e.pixelRatio,o=r>1.05||r<.95;return i.rotation||o||s||t.isSourceScaled||t.rotation?n.bilinear:n.nearest}return n[i.samplingMode]};class o extends i.Technique{constructor(){super(...arguments),this.name="BrushBitmap",this.type=4,this.shaders={bitmap:new r.BitmapShader}}render(e,i){const{context:r,renderingOptions:o,painter:a}=e;for(const l of i.bitmaps){const i=l.texture;if(!l.source||!l.isReady||null==i)continue;const c=s(e,l,o);e.timeline.begin(this.name),a.setPipelineState({depth:!1,stencil:{test:{mask:255,ref:l.stencilRef,compare:514,op:{fail:7680,zFail:7680,zPass:7680}},write:!1},color:{write:[!0,!0,!0,!0],blendMode:"additive"===l.blendFunction?"additive":"composite"}}),l.setSamplingProfile(c);const{coordScale:u,computedOpacity:h,transforms:d}=l,f={texture:{texture:i,unit:t.textureBindingBitmap},dvsMat3:d.displayViewScreenMat3,coordScale:u,opacity:h};a.submitDrawMesh(r,{shader:this.shaders.bitmap,uniforms:{config:f},defines:{bicubic:c===n.bicubic},optionalAttributes:null,useComputeBuffer:!1},a.quadMesh),e.timeline.end(this.name)}}}e.BitmapTechnique=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/BitmapShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl","./bitmapUtils"],function(e,t,i,r,n){"use strict";class s extends i.VertexInput{}t.__decorate([i.location(0,r.Vec2)],s.prototype,"position",void 0);class o extends i.FragmentInput{}class a extends i.UniformGroup{}t.__decorate([i.uniform(r.Sampler2D)],a.prototype,"texture",void 0),t.__decorate([i.uniform(r.Mat3)],a.prototype,"dvsMat3",void 0),t.__decorate([i.uniform(r.Vec2)],a.prototype,"coordScale",void 0),t.__decorate([i.uniform(r.Float)],a.prototype,"opacity",void 0);class l extends i.GraphShaderModule{constructor(){super(...arguments),this.type="BitmapShader"}vertex(e){const t=this.config.dvsMat3.multiply(new r.Vec3(e.position.multiply(this.config.coordScale),1));return{glPosition:new r.Vec4(t,1),texcoord:e.position}}fragment(e){const t=new i.FragmentOutput;let s;return s=this.bicubic?n.sampleBicubicBSpline(this.config.texture,e.texcoord,this.config.coordScale):r.texture2D(this.config.texture,e.texcoord),t.fragColor=new r.Vec4(s.rgb.multiply(this.config.opacity),s.a.multiply(this.config.opacity)),t}}t.__decorate([i.uniform(a)],l.prototype,"config",void 0),t.__decorate([i.define],l.prototype,"bicubic",void 0),t.__decorate([t.__param(0,i.input(s))],l.prototype,"vertex",null),t.__decorate([t.__param(0,i.input(o))],l.prototype,"fragment",null),e.BitmapShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/bitmapUtils":function(){define(["exports","../../graph/glsl"],function(e,t){"use strict";function i(e){const i=function(e){const i=new t.Float(1/6),r=e.multiply(e),n=r.multiply(e),s=i.multiply(n.multiply(-1).add(new t.Float(3).multiply(r)).subtract(new t.Float(3).multiply(e)).add(1)),o=i.multiply(n.multiply(3).subtract(r.multiply(6)).add(4)),a=i.multiply(n.multiply(-3).add(r.multiply(3)).add(e.multiply(3)).add(1)),l=i.multiply(n);return new t.Vec4(s,o,a,l)}(e),r=i.x.add(i.y),n=i.z.add(i.w),s=new t.Float(1).subtract(i.y.divide(r)).add(e),o=new t.Float(1).add(i.w.divide(n)).subtract(e);return new t.Vec4(s,o,r,n)}e.sampleBicubicBSpline=function(e,r,n){const s=new t.Vec2(new t.Float(1).divide(n.x),0),o=new t.Vec2(0,new t.Float(1).divide(n.y)),a=r.multiply(n).subtract(.5),l=i(t.fract(a).x).xyz,c=i(t.fract(a).y).xyz;let u=r.add(l.x.multiply(s)),h=r.subtract(l.y.multiply(s));const d=u.add(c.x.multiply(o)),f=h.add(c.x.multiply(o));u=u.subtract(c.y.multiply(o)),h=h.subtract(c.y.multiply(o));let p=t.texture2D(e,h),m=t.texture2D(e,u);const g=t.texture2D(e,f),_=t.texture2D(e,d);return p=t.mix(p,g,c.z),m=t.mix(m,_,c.z),p=t.mix(p,m,l.z),p},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTile":function(){define(["exports","../../../core/libs/gl-matrix-2/factories/mat3f32","./Bitmap","./webgl/TiledDisplayObject"],function(e,t,i,r){"use strict";class n extends r.TiledDisplayObject{constructor(e,t,r,n,s,o,a=null){super(e,t,r,n,s,o),this.bitmap=new i.Bitmap(a),this.bitmap.coordScale=[s,o],this.bitmap.once("isReady",()=>this.ready())}destroy(){super.destroy(),this.bitmap.destroy()}beforeRender(e){this.bitmap.beforeRender(e),super.beforeRender(e)}afterRender(e){this.bitmap.afterRender(e),super.afterRender(e)}set stencilRef(e){this.bitmap.stencilRef=e}get stencilRef(){return this.bitmap.stencilRef}_createTransforms(){return{displayViewScreenMat3:t.create(),tileMat3:t.create()}}setTransform(e){super.setTransform(e),this.bitmap.transforms.displayViewScreenMat3=this.transforms.displayViewScreenMat3}onAttach(){this.bitmap.stage=this.stage}onDetach(){this.bitmap&&(this.bitmap.stage=null)}}e.BitmapTile=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/BitmapTileContainer":function(){define(["exports","../../../geometry/support/aaBoundingRect","./BitmapTile","./webgl/TileContainer","./webgl/shaderGraph/techniques/bitmap/BitmapTechnique"],function(e,t,i,r,n){"use strict";e.BitmapTileContainer=class extends r{constructor(){super(...arguments),this._bitmapTechnique=null}get requiresDedicatedFBO(){return this.children.some(e=>"additive"===e.bitmap.blendFunction)}createTile(e){const r=this.tileInfoView.getTileBounds(t.create(),e),n=this.tileInfoView.getTileResolution(e.level),[s,o]=this.tileInfoView.tileInfo.size;return new i.BitmapTile(e,n,r[0],r[3],s,o)}onAttach(){super.onAttach(),this._bitmapTechnique=new n.BitmapTechnique}onDetach(){super.onDetach(),this._bitmapTechnique?.shutdown(),this._bitmapTechnique=null}renderChildren(e){if(super.renderChildren(e),!this.visible||1!==e.drawPhase||null==this._bitmapTechnique)return;const t=this.children.map(e=>e.bitmap);this._bitmapTechnique.render(e,{bitmaps:t})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/color":function(){define(["exports","./number"],function(e,t){"use strict";e.premultiplyAlpha=function(e,t=0,i=!1){const r=e[t+3];return e[t]*=r,e[t+1]*=r,e[t+2]*=r,i||(e[t+3]*=255),e},e.premultiplyAlphaRGBA=function(e){if(!e)return 0;const{r:i,g:r,b:n,a:s}=e,o=i*s,a=r*s,l=n*s,c=255*s;return t.i8888to32(o,a,l,c)},e.premultiplyAlphaRGBAArray=function(e){if(!e)return 0;const[i,r,n,s]=e,o=i*(s/255),a=r*(s/255),l=n*(s/255),c=s;return t.i8888to32(o,a,l,c)},e.writeColor=function(e,t,i=0){if(null==t)return e[i]=0,e[i+1]=0,e[i+2]=0,void(e[i+3]=0);const{r,g:n,b:s,a:o}=t;e[i]=r*o/255,e[i+1]=n*o/255,e[i+2]=s*o/255,e[i+3]=o},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/enums":function(){define(function(){})},"esri/views/2d/engine/webgl/util/Matcher":function(){define(["exports"],function(e){"use strict";class t{constructor(){this._defaultResult=null,this._backgroundFillResult=null}static async from(e,i){const r=new t;return r.setDefault(await e.createMeshWriters(i.meshes)),r}size(){return 1}getDefault(){return this._defaultResult}setDefault(e){this._defaultResult=e}getBackgroundFill(){return this._backgroundFillResult}setBackgroundFill(e){this._backgroundFillResult=e}hasArcadeDependency(e){return this._defaultResult?.some(t=>t.hasArcadeDependency(e))??!1}match(e,t,i){const r=this.doMatch(e,t)||this.getDefault();if(r&&r.length>0){const e=this.getBackgroundFill();if(e)return[...e,...r]}return r}getSortKey(e,t){return 0}doMatch(e,t){return null}async fetchResources(e,t){}}e.FeatureMatcher=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["exports","./engine/Stage","./engine/ParentChildStage","./LabelManager","./layers/graphics/GraphicsView2D","./layers/graphics/GraphicContainer","./navigation/MapViewNavigation","./magnifier/MagnifierView2D","./grid/GridView2D"],function(e,t,i,r,n,s,o,a,l){"use strict";e.Stage=t.Stage,e.ChildStage=i.ChildStage,e.ParentStage=i.ParentStage,Object.defineProperty(e,"LabelManager",{enumerable:!0,get:()=>r.LabelManager}),Object.defineProperty(e,"GraphicsView2D",{enumerable:!0,get:()=>n}),e.GraphicContainer=s,e.MapViewNavigation=o,e.MagnifierView2D=a,e.GridView2D=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});