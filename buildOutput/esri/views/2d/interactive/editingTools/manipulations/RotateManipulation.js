// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/Handles","../../../../../chunks/vec32","../../../../../core/libs/gl-matrix-2/factories/vec3f64","./Manipulation","./utils","../../../../draw/support/drawUtils","../../../../interactive/dragEventPipeline","../../../../interactive/GraphicManipulator","../../../../interactive/editGeometry/support/editPlaneUtils"],function(t,i,a,e,n,r,o,s,l,h){"use strict";class p extends n.Manipulation{constructor(t){super(),this._handles=new i,this._originCache=e.create(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._snapRotation=t.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",t=>r.onGrabChangedHandle(t,this._manipulator))]),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this._handles.destroy(),this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(t){t(this._manipulator,2)}createDragPipeline(t,i){let e=null,n=null;return s.createManipulatorDragEventPipeline(this._manipulator,(r,l)=>{l.next(i=>{if("start"===i.action){r.cursor="grabbing";const i=t();e=i.plane,n=i.editGeometryOperations}return i}).next(s.screenToMap(this._view)).next(t=>({...t,rotateAngle:o.getRotationAngle(t.mapStart,t.mapEnd,{x:e.origin[0],y:e.origin[1]},!0)})).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next(t=>{const r=a.copy(this._originCache,e.origin),o="start"===t.action?0:1,s=n.rotate(r,t.rotateAngle,o,1);return h.apply(s,e),i(t,s),t}).next(t=>("end"===t.action&&(r.cursor="grab"),t))})}_createManipulator(){const t=this._view,i=this._graphic;return new l.GraphicManipulator({view:t,graphic:i,selectable:!0,cursor:"grab"})}}t.RotateManipulation=p,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});