// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../chunks/tslib.es6","../../../../../Graphic","../../../../../core/handleUtils","../../../../../core/maybe","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass","../../../../../geometry/Multipoint","../../../../../geometry/Point","../../SnappingVisualizer2D","./symbols","../../../../draw/DrawGraphicTool","../../../../draw/DrawOperation","../../../../draw/drawSurfaces"],function(e,t,i,r,a,s,l,n,c,o,h,p,u,m,v,d,y,g){"use strict";function G(e,t){return(e.attributes?.displayOrder??-1/0)-(t.attributes?.displayOrder??-1/0)}e.DrawGraphicTool2D=class extends d.DrawGraphicTool{constructor(e){super(e),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:e.activeLineSymbol??v.outline,regularVertices:e.regularVerticesSymbol??v.regularVertices,activeVertex:e.activeVertexSymbol??v.activeVertex,fill:e.activeFillSymbol},e.activeVertexSymbol||this.addHandles(s.watch(()=>this.view?.effectiveTheme?.accentColor,e=>{if(!e)return;const t=this._visualElementSymbols.activeVertex.clone().set({color:e});this._visualElementGraphics.activeVertex?.set("symbol",t),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:t}},s.initial))}normalizeCtorArgs(e){const t={...e};return delete t.activeFillSymbol,delete t.activeVertexSymbol,delete t.regularVerticesSymbol,delete t.activeLineSymbol,t}initializeGraphic(e){return null!=this._visualElementSymbols.fill&&(e.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(G),r.makeHandle()}makeDrawOperation(){const{defaultZ:e,hasZ:t,view:i}=this;return this._createOrUpdateGraphic(null),new y.DrawOperation({view:i,manipulators:this.manipulators,geometryType:d.geometryTypeToDrawOperationGeometryType(this.geometryType),drawingMode:this.mode,hasZ:t,defaultZ:e,snapToSceneEnabled:this.snapToScene,drawSurface:new g.MapDrawSurface(i,t,e),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new m.SnappingVisualizer2D(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0,automaticLengthMeasurementUtils:this.automaticLengthMeasurementUtils})}onActiveVertexChanged(e){if("point"===this.geometryType)return r.makeHandle();const[t,s]=e,l=new u({x:t,y:s,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.activeVertex?(this._visualElementGraphics.activeVertex.geometry=l,r.makeHandle()):(this._visualElementGraphics.activeVertex=new i({geometry:l,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(G),r.makeHandle(()=>{null!=this._visualElementGraphics.activeVertex&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=a.destroyMaybe(this._visualElementGraphics.activeVertex))}))}onCursorEdgeChanged(e){return null!=this._visualElementGraphics.activeEdge?(this._visualElementGraphics.activeEdge.geometry=e,r.makeHandle()):(this._visualElementGraphics.activeEdge=new i({geometry:e,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(G),r.makeHandle(()=>{null!=this._visualElementGraphics.activeEdge&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=a.destroyMaybe(this._visualElementGraphics.activeEdge))}))}onRegularVerticesChanged(e){const t=new p({points:e,spatialReference:this.view.spatialReference});return null!=this._visualElementGraphics.regularVertices?(this._visualElementGraphics.regularVertices.geometry=t,r.makeHandle()):(this._visualElementGraphics.regularVertices=new i({geometry:t,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(G),r.makeHandle(()=>{null!=this._visualElementGraphics.regularVertices&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=a.destroyMaybe(this._visualElementGraphics.regularVertices))}))}},t.__decorate([l.property()],e.DrawGraphicTool2D.prototype,"activeFillSymbol",void 0),t.__decorate([l.property({readOnly:!0})],e.DrawGraphicTool2D.prototype,"type",void 0),t.__decorate([l.property({constructOnly:!0,nonNullable:!0})],e.DrawGraphicTool2D.prototype,"view",void 0),e.DrawGraphicTool2D=t.__decorate([h.subclass("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],e.DrawGraphicTool2D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});