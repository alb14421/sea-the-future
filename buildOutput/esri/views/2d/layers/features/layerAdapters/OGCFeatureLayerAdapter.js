// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/lang","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,a,o,i,l,n){"use strict";e.OGCFeatureLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=o.getFeatureReductionDeconflictionEnabled(t,e)??o.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:o.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r,labelingInfo:t.labelingInfo}]}async createServiceOptions(e){const r=this.layer,{capabilities:o}=r,i=r.fieldsIndex.toJSON(),l=a.getServiceGeometryType(r),n=r.timeInfo?.toJSON(),s=r.spatialReference.toJSON(),c=r.source.getSource(),u=this.layer.objectIdField,d=t.clone(o);d.query.maxRecordCount=c.maxRecordCount;const p=e.spatialReference.toJSON();return{type:"ogc",source:c,orderByFields:u,outSpatialReference:p,metadata:{fieldsIndex:i,geometryType:l,featureIdInfo:{type:"object-id",fieldName:r.objectIdField},timeInfo:n,spatialReference:s,outSpatialReference:p,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{customParameters:r,timeExtent:a,apiKey:o}=this.layer,l={customParameters:r,timeExtent:a};return i.createFeatureSourceSchema(l,e,t,o)}createProcessorSchema(e,t,a){const{fields:o,renderer:i,geometryType:n,labelingInfo:s,labelsVisible:c,orderBy:u,objectIdField:d}=this.layer,p={fields:o.map(e=>e.toJSON()),renderer:i?.clone(),labelingInfoSource:this.layer.id,featureReduction:r.getEffectiveFeatureReduction(this.layer,t),geometryType:n,labelingInfo:s,labelsVisible:c,objectIdField:d,orderBy:u??"default"};return l.createSimpleProcessorSchema(e,t,p,a)}get hasRequiredSupport(){return n.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>r.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy,()=>this.layer.renderer]}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});