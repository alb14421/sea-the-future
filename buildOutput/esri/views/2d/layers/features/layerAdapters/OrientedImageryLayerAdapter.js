// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/lang","../../../../../layers/support/arcgisLayerUrl","./featureReductionUtils","./featureServiceUtils","./floorFilterUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,o,a,l,s,n,c,u){"use strict";e.OrientedImageryLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=s.getFeatureReductionDeconflictionEnabled(t,e)??s.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:s.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const i=this.layer,{capabilities:a,globalIdField:s,orderBy:n,refreshInterval:c}=i,u=i.fieldsIndex.toJSON(),d=l.getServiceGeometryType(i),p=i.timeInfo?.toJSON(),y=i.spatialReference.toJSON(),f=t.clone(this.layer.parsedUrl);let m=this.layer.objectIdField;if(n?.length){const e=!n[0].valueExpression&&n[0].field;e&&(m=e)}const h=c>0,g=r.isHostedAgolService(f.path),S=e.spatialReference.toJSON(),F=o.createSnapshotInfo(g,h,a,d,e.extent,i.fullExtent);return{type:"feature-service",source:f,isSourceHosted:g,orderByFields:m,outSpatialReference:S,metadata:{globalIdField:s,fieldsIndex:u,geometryType:d,featureIdInfo:{type:"object-id",fieldName:i.objectIdField},timeInfo:p,spatialReference:y,outSpatialReference:S,timeReferenceUnknownClient:i.datesInUnknownTimezone,dateFieldsTimeZone:i.dateFieldsTimeZone,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:null,snapshotInfo:F}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:i,customParameters:o,timeExtent:a}=this.layer,l={definitionExpression:r,displayFilterInfo:i,customParameters:o,timeExtent:a};return n.createFeatureSourceSchema(l,e,t,null)}createProcessorSchema(e,t,r){const{fields:o,renderer:a,geometryType:l,labelingInfo:s,labelsVisible:n,orderBy:u,objectIdField:d}=this.layer,p={fields:o.map(e=>e.toJSON()),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:i.getEffectiveFeatureReduction(this.layer,t),geometryType:l,labelingInfo:s,labelsVisible:n,objectIdField:d,orderBy:u??"default"};return c.createSimpleProcessorSchema(e,t,p,r)}get hasRequiredSupport(){return u.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}addFilters(e,t){return a.addFloorFilter(this.layer,e,t)}getUpdateHashProperties(e){return[()=>this.layer.outFields,()=>this.layer.orderBy,()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>i.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>a.hasFloorFilter(this.layer,e)?e.floors:null]}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});