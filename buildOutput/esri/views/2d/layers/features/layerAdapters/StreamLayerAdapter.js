// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,n,l){"use strict";e.StreamLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const r=this.layer,n=i.getFeatureReductionDeconflictionEnabled(r,e)??i.getLayerDeconflictionEnabled(r),l=t.getEffectiveFeatureReduction(r,e),a=[...r.labelingInfo||[],...l?.labelingInfo||[]];return[{vvEvaluators:{0:i.createLabelVVEvaluator(r.renderer)},deconflictionEnabled:n,labelingInfo:a}]}async createServiceOptions(e){const t=this.layer,i=r.getServiceGeometryType(t),n=t.timeInfo?.toJSON()||null,l=t.spatialReference?t.spatialReference.toJSON():null,a=e.spatialReference.toJSON();return{type:"stream",source:this.layer.parsedUrl,outSpatialReference:a,metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:i,featureIdInfo:{type:"object-id",fieldName:this.layer.objectIdField},timeInfo:n,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,spatialReference:l,outSpatialReference:a,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}}createSourceSchema(e,t){const{definitionExpression:r,geometryDefinition:i,customParameters:n}=this.layer;return{type:"stream",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields,dataFilter:{geometryDefinition:i?.toJSON(),definitionExpression:r,customParameters:n??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(e,r,i){const{fields:l,renderer:a,geometryType:o,labelingInfo:s,labelsVisible:c,objectIdField:d,trackInfo:u}=this.layer,f={fields:l.map(e=>e.toJSON()),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:t.getEffectiveFeatureReduction(this.layer,r),geometryType:o,labelingInfo:s,labelsVisible:c,objectIdField:d,orderBy:"default",trackInfo:u};return n.createSimpleProcessorSchema(e,r,f,i)}get hasRequiredSupport(){return l.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>t.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>this.layer.geometryDefinition,()=>this.layer.definitionExpression,()=>this.layer.trackInfo]}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});