// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/Error","../../../../../layers/support/parquetUtils","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,l,i,a,s,n){"use strict";e.ParquetLayerAdapter=class{constructor(e){this.layer=e}get hasRequiredSupport(){return n.isRendererSupported(this.layer.renderer)}get timeOptions(){return null}getLabelingDeconflictionInfo(e){const t=this.layer,r=a.getFeatureReductionDeconflictionEnabled(t,e)??a.getLayerDeconflictionEnabled(t),i=l.getEffectiveFeatureReduction(t,e),s=[...t.labelingInfo||[],...i?.labelingInfo||[]];return[{vvEvaluators:{0:a.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r,labelingInfo:s}]}getUpdateHashProperties(e){return[()=>this.layer.outFields,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>l.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>this.layer.orderBy,()=>this.layer.renderer,()=>this.layer.popupTemplate]}async createServiceOptions(e){const l=i.getServiceGeometryType(this.layer),a=e.spatialReference.toJSON(),s=this.layer.encoding;if(null==s)throw new t("parquet-layer:unsupported","creating a parquet layer view requires an encoding",{layer:this.layer});return{type:"parquet",source:{urls:this.layer.urls.items},outSpatialReference:a,geometryInfo:{geometryType:r.toParquetJSONGeometryType(this.layer.geometryType),spatialReference:this.layer.spatialReference.toJSON(),encoding:s.toJSON(),displayOptimization:this.layer.displayOptimization},metadata:{spatialReference:this.layer.spatialReference.toJSON(),outSpatialReference:a,fieldsIndex:this.layer.fieldsIndex.toJSON(),featureIdInfo:{type:"object-id",fieldName:this.layer.objectIdField},geometryType:l,types:null,subtypes:null,timeInfo:null,typeIdField:null,subtypeField:null,globalIdField:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null}}}createSourceSchema(e,t){return{type:"parquet",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields.includes("*")?this.layer.fields.map(e=>e.name):e.availableFields,dataFilter:{customParameters:this.layer.customParameters??null}}}}createProcessorSchema(e,t,r){const i={fields:this.layer.fields.map(e=>e.toJSON()),renderer:this.layer.renderer?.clone(),labelingInfoSource:this.layer.id,featureReduction:l.getEffectiveFeatureReduction(this.layer,t),geometryType:this.layer.geometryType,labelingInfo:this.layer.labelingInfo,labelsVisible:this.layer.labelsVisible,objectIdField:this.layer.objectIdField,orderBy:this.layer.orderBy};return s.createSimpleProcessorSchema(e,t,i,r)}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});