// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/Error","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,o,n,a,l){"use strict";e.InMemoryLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=o.getFeatureReductionDeconflictionEnabled(t,e)??o.getLayerDeconflictionEnabled(t),n=r.getEffectiveFeatureReduction(t,e),a=[...t.labelingInfo||[],...n?.labelingInfo||[]];return[{vvEvaluators:{0:o.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:i,labelingInfo:a}]}async createServiceOptions(e){const r=this.layer,{capabilities:o,objectIdField:n}=r,a=r.fieldsIndex.toJSON(),l=i.getServiceGeometryType(r),s=r.timeInfo?.toJSON(),u=r.spatialReference.toJSON();!function(e){if(!("openPorts"in e))throw new t("featurelayer:source-not-supported","source is not supported")}(r.source);const c=await r.source.openPorts(),d=n,p=e.spatialReference.toJSON();return{type:"memory",source:c,orderByFields:d,outSpatialReference:p,metadata:{fieldsIndex:a,geometryType:l,featureIdInfo:{type:"object-id",fieldName:r.objectIdField},timeInfo:s,spatialReference:u,outSpatialReference:p,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:"datesInUnknownTimezone"in r?r.datesInUnknownTimezone:null,dateFieldsTimeZone:"dateFieldsTimeZone"in r?r.dateFieldsTimeZone:null},queryMetadata:{maxRecordCount:o.query.maxRecordCount,supportsCompactGeometry:o.query.supportsCompactGeometry,supportsDefaultSpatialReference:o.query.supportsDefaultSpatialReference,supportsFormatPBF:o.query.supportsFormatPBF,supportsMaxRecordCountFactor:o.query.supportsMaxRecordCountFactor,supportsQuantization:o.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:r,timeExtent:i,displayFilterInfo:o}=this.layer,a={customParameters:null,definitionExpression:r,displayFilterInfo:o,timeExtent:i};return n.createFeatureSourceSchema(a,e,t,null)}createProcessorSchema(e,t,i){const{fields:o,renderer:n,geometryType:l,labelingInfo:s,labelsVisible:u,orderBy:c,objectIdField:d}=this.layer,p="trackInfo"in this.layer?this.layer.trackInfo:null,y={fields:o.map(e=>e.toJSON()),renderer:n?.clone(),labelingInfoSource:this.layer.id,featureReduction:r.getEffectiveFeatureReduction(this.layer,t),geometryType:l,labelingInfo:s,labelsVisible:u,objectIdField:d,orderBy:c??"default",trackInfo:p};return a.createSimpleProcessorSchema(e,t,y,i)}get hasRequiredSupport(){return l.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.definitionExpression,()=>this.layer.displayFilterInfo,()=>this.layer.orderBy,()=>"outFields"in this.layer?this.layer.outFields:null,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>r.getEffectiveFeatureReduction(this.layer,e),()=>"trackInfo"in this.layer?this.layer.trackInfo:null]}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});