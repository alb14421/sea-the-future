// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/lang","../../../../../graphic/CatalogGraphicOrigin","../../../../../layers/support/arcgisLayerUrl","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,a,i,o,s,l,n){"use strict";e.CatalogFootprintLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=o.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:o.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const r=this.layer,{capabilities:o,editingInfo:s,objectIdField:l,globalIdField:n,datesInUnknownTimezone:c,dateFieldsTimeZone:p,orderBy:d,parsedUrl:u}=r,y=r.fieldsIndex.toJSON(),m=i.getServiceGeometryType(r),f=r.timeInfo?.toJSON(),h=r.spatialReference.toJSON(),g=t.clone(u);let S=l;if(d?.length){const e=!d[0].valueExpression&&d[0].field;e&&(S=e)}const b=a.isHostedAgolService(g.path),I=e.spatialReference.toJSON();return{type:"feature-service",source:g,isSourceHosted:b,orderByFields:S,outSpatialReference:I,metadata:{timeReferenceUnknownClient:c,dateFieldsTimeZone:p,globalIdField:n,fieldsIndex:y,geometryType:m,featureIdInfo:{type:"object-id",fieldName:l},timeInfo:f,spatialReference:h,outSpatialReference:I,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:o.query.maxRecordCount,supportsCompactGeometry:o.query.supportsCompactGeometry,supportsDefaultSpatialReference:o.query.supportsDefaultSpatialReference,supportsFormatPBF:o.query.supportsFormatPBF,supportsMaxRecordCountFactor:o.query.supportsMaxRecordCountFactor,supportsQuantization:o.query.supportsQuantization,lastEditDate:s?.lastEditDate?.getTime(),snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:a,customParameters:i,timeExtent:o,apiKey:l}=this.layer,n={definitionExpression:r,displayFilterInfo:a,customParameters:i,timeExtent:o};return s.createFeatureSourceSchema(n,e,t,l)}createProcessorSchema(e,t,r){const{fields:a,geometryType:i,orderBy:o,objectIdField:s,renderer:n,labelingInfo:c,labelsVisible:p}=this.layer,d={featureReduction:null,labelingInfoSource:this.layer.id,fields:a.map(e=>e.toJSON()),geometryType:i,labelingInfo:c,labelsVisible:p,objectIdField:s,orderBy:o??"default",renderer:n?.clone()};return l.createSimpleProcessorSchema(e,t,d,r)}get hasRequiredSupport(){return n.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>this.layer.outFields,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy]}setGraphicOrigin(e){e.origin=new r(this.layer)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});