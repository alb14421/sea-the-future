// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../../core/arrayUtils","../../../../../../layers/support/streamLayerUtils","../../support/rendererUtils","../../../../../webgl/capabilities"],function(e,i,r,t,n){"use strict";function a(e){switch(e){case"opacity":return 2;case"color":return 1;case"rotation":return 3;case"size":return 0;default:return null}}function s(e){if(!e)return[];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return c(e);case"dot-density":return l(e);case"pie-chart":return o(e);case"heatmap":return u(e)}}function l(e){const i=[];for(const r of e.attributes)i.push({binding:i.length,expression:r.valueExpression,field:r.field});return i}function o(e){const i=c(e);let r=4;for(const t of e.attributes)i.push({binding:r++,expression:t.valueExpression,field:t.field});return i}function u({valueExpression:e,field:i}){return e||i?[{binding:0,expression:e,field:i}]:[]}function c(e){return"visualVariables"in e&&e.visualVariables?.length?t.simplifyVisualVariables(e.visualVariables).map(e=>function(e){switch(e.type){case"size":return function(e){return"$view.scale"===e.valueExpression?null:{binding:a(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}(e);case"color":case"opacity":return function(e){return{binding:a(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}(e);case"rotation":return function(e){return{binding:a(e.type),expression:e.valueExpression,field:e.field}}(e)}}(e)).filter(i.isSome):[]}e.createDotDensityBindings=l,e.createHeatmapBindings=u,e.createPieChartBindings=o,e.createStorageSchema=function(e,i){return{type:"simple",filters:i,capabilities:{maxTextureSize:n.getWebGLCapabilities().maxTextureSize},bindings:s(e)}},e.createTrackStorageSchema=function(e,i){const t=n.getWebGLCapabilities();return{type:"multi",target:"feature",keyField:r.internalTrackPartField,filters:i,capabilities:{maxTextureSize:t.maxTextureSize},bindings:{0:s(e.trackLines.renderer),1:s(e.latestObservations.renderer),2:s(e.previousObservations.renderer)}}},e.createVVBindings=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});