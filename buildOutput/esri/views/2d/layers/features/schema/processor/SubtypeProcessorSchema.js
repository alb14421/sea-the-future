// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","./LabelMatcherSchema","./MatcherSchema","./StorageSchema","./VisualVariablesSchema","../../../../../webgl/capabilities"],function(e,t,r,a,s,i){"use strict";async function n(e,{subtypeField:t,sublayers:a}){const s=await Promise.all(a.map(({renderer:t})=>r.createMatcherSchema(e,t)));return{type:"subtype",subtypeField:t,renderers:a.reduce((e,{subtypeCode:t},r)=>({...e,[t]:s[r]}),{})}}function u(e,t){const r=i.getWebGLCapabilities();return{type:"multi",filters:e.filters,capabilities:{maxTextureSize:r.maxTextureSize},keyField:t.subtypeField,target:"feature",bindings:t.sublayers.reduce((e,{renderer:t,subtypeCode:r})=>{const s=a.createVVBindings(t);return{...e,[r]:s}},{})}}async function c(e,{subtypeField:r,sublayers:a,labelingInfoSource:i}){const n=await Promise.all(a.map(r=>{const a=s.createVisualVariableUniforms(r.renderer),n={...r,geometryType:r.geometryType??null,labelingInfoSource:i};return t.createLabelMatcherSchema(e,n,a)}));return{type:"subtype",subtypeField:r,renderers:a.reduce((e,{subtypeCode:t},r)=>({...e,[t]:n[r]}),{})}}e.createSubtypeProcessorSchema=async function(e,t,r,a){return{storage:u(t,r),mesh:{properties:{timeZone:t.timeZone,displayRefreshVersion:a,returnMeshObjectId:!1,sortKey:null,currentUser:t.currentUser},strategy:{type:"feature"},factory:{symbology:await n(e,r),labels:await c(e,r)}},expressionProperties:{timeExtent:t.timeExtent?.toJSON()}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});