// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/core/screenUtils":function(){define(["exports"],function(e){"use strict";const t=/^-?(\d+(\.\d+)?)\s*((px)|(pt))?$/i;function r(e){return e?72*e/96:0}function s(e=0,t=0){return{x:e,y:t}}e.castRenderScreenPointArray=function(e){return e},e.castRenderScreenPointArray3=function(e){return e},e.castScreenPointArray=function(e){return e},e.cloneScreenPoint=function(e){return e?s(e.x,e.y):null},e.createRenderScreenPoint=function(e=0,t=0){return{x:e,y:t}},e.createRenderScreenPointArray=function(e=0,t=0){return[e,t]},e.createRenderScreenPointArray3=function(e=0,t=0,r=0){return[e,t,r]},e.createScreenPoint=s,e.createScreenPointArray=function(e=0,t=0){return[e,t]},e.pt2px=function(e){return e?e/72*96:0},e.px2pt=r,e.screenPointArrayToObject=function(e,t){return t?(t.x=e[0],t.y=e[1],t):{x:e[0],y:e[1]}},e.screenPointObjectToArray=function(e,t){return t?(t[0]=e.x,t[1]=e.y,t.length>2&&(t[2]=0),t):[e.x,e.y]},e.toPt=function(e){if("string"==typeof e){const s=e.match(t);if(s){const t=Number(s[1]),i=s[3]&&s[3].toLowerCase(),n=e.startsWith("-"),o="px"===i?r(t):t;return n?-o:o}return console.warn("screenUtils.toPt: input not recognized!"),null}return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/TileInfo":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/unitUtils","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../core/accessorSupport/decorators/writer","../../geometry/Point","../../geometry/SpatialReference","../../geometry/support/aaBoundingRect","../../geometry/support/spatialReferenceUtils","../../geometry/support/webMercatorUtils","./LOD","./TileKey"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_){"use strict";var b;const S=new r.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});return e.default=class extends s.JSONSupport{static{b=this}static create(e={}){const{resolutionFactor:t=1,scales:r,size:s=256,spatialReference:n=p.WebMercator,numLODs:o=24}=e;if(!m.isValid(n)){const e=[];if(r)for(let t=0;t<r.length;t++){const s=r[t];e.push(new y({level:t,scale:s,resolution:s}))}else{let t=5e-4;for(let r=o-1;r>=0;r--)e.unshift(new y({level:r,scale:t,resolution:t})),t*=2}return new b({dpi:96,lods:e,origin:new d(0,0,n),size:[s,s],spatialReference:n})}const a=m.getInfo(n),l=e.origin?new d({x:e.origin.x,y:e.origin.y,spatialReference:n}):new d(a?{x:a.origin[0],y:a.origin[1],spatialReference:n}:{x:0,y:0,spatialReference:n}),c=1/(39.37*i.getMetersPerUnitForSR(n)*96),u=[];if(r)for(let e=0;e<r.length;e++){const t=r[e],s=t*c;u.push(new y({level:e,scale:t,resolution:s}))}else{let e=m.isGeographic(n)?512/s*591657527.5917094:256/s*591657527.591555;const r=Math.ceil(o/t);u.push(new y({level:0,scale:e,resolution:e*c}));for(let s=1;s<r;s++){const r=e/2**t,i=r*c;u.push(new y({level:s,scale:r,resolution:i})),e=r}}return new b({dpi:96,lods:u,origin:l,size:[s,s],spatialReference:n})}constructor(e){super(e),this.dpi=96,this.format=null,this.origin=null,this.size=null,this.spatialReference=null}get isWrappable(){const{spatialReference:e,origin:t}=this;if(e&&t){const r=m.getInfo(e);return e.isWrappable&&!!r&&Math.abs(r.origin[0]-t.x)<=r.dx}return!1}readOrigin(e,t){return d.fromJSON({spatialReference:t.spatialReference,...e})}set lods(e){let t=0,r=0;const s=[],i=this._levelToLOD={};e&&(t=-1/0,r=1/0,e.forEach(e=>{s.push(e.scale),t=e.scale>t?e.scale:t,r=e.scale<r?e.scale:r,i[e.level]=e})),this._set("scales",s),this._set("lods",e),this._initializeUpsampleLevels()}readSize(e,t){return[t.cols,t.rows]}writeSize(e,t){t.cols=e[0],t.rows=e[1]}zoomToScale(e){const t=this.scales;if(e<=0)return t[0];if(e>=t.length-1)return t[t.length-1];const r=Math.floor(e),s=r+1;return t[r]/(t[r]/t[s])**(e-r)}scaleToZoom(e){const t=this.scales,r=t.length-1;let s=0;for(;s<r;s++){const r=t[s],i=t[s+1];if(r<=e)return s;if(i===e)return s+1;if(r>e&&i<e)return s+Math.log(r/e)/Math.log(r/i)}return s}tileAt(e,t,r,s){const i=this.lodAt(e);if(!i)return null;let n,o;if("number"==typeof t)n=t,o=r;else if(m.equals(t.spatialReference,this.spatialReference))n=t.x,o=t.y,s=r;else{const e=g.project(t,this.spatialReference);if(null==e)return null;n=e.x,o=e.y,s=r}const a=i.resolution*this.size[0],l=i.resolution*this.size[1];return s||(s=new _.TileKey(null,0,0,0,f.create())),s.level=e,s.row=Math.floor((this.origin.y-o)/l+.001),s.col=Math.floor((n-this.origin.x)/a+.001),this.updateTileInfo(s),s}updateTileInfo(e,t=0){let r=this.lodAt(e.level);if(!r&&1===t){const t=this.lods[this.lods.length-1];t.level<e.level&&(r=t)}if(!r)return;const s=e.level-r.level,i=r.resolution*this.size[0]/2**s,n=r.resolution*this.size[1]/2**s;e.id=`${e.level}/${e.row}/${e.col}`,e.extent||(e.extent=f.create()),e.extent[0]=this.origin.x+e.col*i,e.extent[1]=this.origin.y-(e.row+1)*n,e.extent[2]=e.extent[0]+i,e.extent[3]=e.extent[1]+n}upsampleTile(e){const t=this._upsampleLevels[e.level];return!(!t||-1===t.parentLevel||(e.level=t.parentLevel,e.row=Math.floor(e.row/t.factor+.001),e.col=Math.floor(e.col/t.factor+.001),this.updateTileInfo(e),0))}getTileBounds(e,t){const r=this.lodAt(t.level);if(null==r)return null;const{resolution:s}=r,i=s*this.size[0],n=s*this.size[1];return e[0]=this.origin.x+t.col*i,e[1]=this.origin.y-(t.row+1)*n,e[2]=e[0]+i,e[3]=e[1]+n,e}lodAt(e){return this._levelToLOD?.[e]??null}clone(){return b.fromJSON(this.write({}))}getCompatibleForVTL(e){if(this.size[0]!==this.size[1]||256===this.size[0]&&512===e)return null;const t=(512===this.size[0]&&256===e?-1:0)+(this.spatialReference.isGeographic?1:0);if(this.size[0]===e&&0===t)return this;const r=[],s=this.lods.length-t;for(let e=0;e<s;e++){const s=e+t,{scale:i,resolution:n}=s>=0?this.lods[s]:{scale:2*this.lods[0].scale,resolution:2*this.lods[0].resolution};r.push(new y({level:e,scale:i,resolution:n}))}return new b({size:[e,e],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:r})}_initializeUpsampleLevels(){const e=this.lods;this._upsampleLevels=[];let t=null;for(let r=0;r<e.length;r++){const s=e[r];this._upsampleLevels[s.level]={parentLevel:t?t.level:-1,factor:t?t.resolution/s.resolution:0},t=s}}},t.__decorate([n.property({type:Number,json:{write:!0}})],e.default.prototype,"compressionQuality",void 0),t.__decorate([n.property({type:Number,json:{write:!0}})],e.default.prototype,"dpi",void 0),t.__decorate([n.property({type:String,json:{read:S.read,write:S.write,origins:{"web-scene":{read:!1,write:!1}}}})],e.default.prototype,"format",void 0),t.__decorate([n.property({readOnly:!0})],e.default.prototype,"isWrappable",null),t.__decorate([n.property({type:d,json:{write:!0}})],e.default.prototype,"origin",void 0),t.__decorate([c.reader("origin")],e.default.prototype,"readOrigin",null),t.__decorate([n.property({type:[y],value:null,json:{write:!0}})],e.default.prototype,"lods",null),t.__decorate([n.property({readOnly:!0})],e.default.prototype,"scales",void 0),t.__decorate([n.property({cast:e=>Array.isArray(e)?e:"number"==typeof e?[e,e]:[256,256]})],e.default.prototype,"size",void 0),t.__decorate([c.reader("size",["rows","cols"])],e.default.prototype,"readSize",null),t.__decorate([h.writer("size",{cols:{type:o.Integer},rows:{type:o.Integer}})],e.default.prototype,"writeSize",null),t.__decorate([n.property({type:p,json:{write:!0}})],e.default.prototype,"spatialReference",void 0),e.default=b=t.__decorate([u.subclass("esri.layers.support.TileInfo")],e.default),e.default})},"esri/layers/support/LOD":function(){define(["exports","../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a){"use strict";var l;return e.default=class extends r.JSONSupport{static{l=this}constructor(e){super(e),this.cols=null,this.level=0,this.levelValue=null,this.origin=null,this.resolution=0,this.rows=null,this.scale=0}clone(){return new l({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})}},t.__decorate([s.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.default.prototype,"cols",void 0),t.__decorate([s.property({type:i.Integer,json:{write:!0}})],e.default.prototype,"level",void 0),t.__decorate([s.property({type:String,json:{write:!0}})],e.default.prototype,"levelValue",void 0),t.__decorate([s.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.default.prototype,"origin",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"resolution",void 0),t.__decorate([s.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],e.default.prototype,"rows",void 0),t.__decorate([s.property({type:Number,json:{write:!0}})],e.default.prototype,"scale",void 0),e.default=l=t.__decorate([a.subclass("esri.layers.support.LOD")],e.default),e.default})},"esri/layers/support/TileKey":function(){define(["exports"],function(e){"use strict";e.TileKey=class{constructor(e,t,r,s,i=void 0){this.id=e,this.level=t,this.row=r,this.col=s,this.extent=i}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/PipelineConnectionHandlers":function(){define(["exports","../../../../core/workers/utils"],function(e,t){"use strict";e.PipelineConnectionHandlers=class{constructor(e){this._client=e,this.layerView=this._client.createInvokeProxy(""),this.container=this._client.createInvokeProxy("container"),this._eventLog=this._client.createInvokeProxy("eventLog")}onEvent(e){t.ignoreConnectionErrors(this._eventLog.onEvent(e))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/Processor":function(){define(["../../../../core/has","../../../../core/maybe","../../../../core/object","../../../../core/promiseUtils","../../../../core/accessorSupport/diffUtils","../../../../core/workers/utils","../../../../geometry/SpatialReference","../../engine/webgl/mesh/MultiTileMeshData","../../engine/webgl/mesh/factories/FeatureMeshFactory","../../engine/webgl/mesh/factories/ResourceProxy","../../engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry","../../engine/webgl/util/MatcherContext","./ProcessorTileMessageQueue","./processor/BinningStrategy","./processor/ClusterStrategy","./processor/FeatureUpdateStrategy","./processor/TrackStrategy","./support/AttributeStore","./support/ComputedAttributeStorage"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_){"use strict";function b(e){const{timeZone:t}=e?.mesh.properties??{},{timeExtent:r}=e?.expressionProperties??{};return{timeZone:t,timeExtent:r}}return class{constructor(e,t){this._connection=e,this._source=t,this._version=1,this._registry=new u.MeshWriterRegistry,this._proxy=new c.ResourceProxy({fetch:(e,t)=>this._connection.layerView.fetch(e,t),fetchDictionary:(e,t)=>this._connection.layerView.fetchDictionary(e,t)}),this._attributeStore=new y.AttributeStore({isLocal:!1,update:e=>n.ignoreConnectionErrors(this._connection.container.updateAttributeView(e))})}destroy(){this._proxy.destroy(),this._strategy?.destroy(),this._attributeStore.destroy()}get aggregateQueryEngine(){return this._strategy?.aggregateQueryEngine}get version(){return this._version}getDisplayFeatures(e){return this._strategy?this._strategy.getDisplayFeatures(e):{features:[],aggregates:[],tracks:[]}}getDisplayIds(e){const t={};return this._strategy?(this._strategy.displayMap(e,e=>e,(e,r,s)=>{t[s]=e}),t):t}getFeatureObjectIdsForAggregate(e){return this._strategy?this._strategy.getFeatureObjectIdsForAggregate(e):[]}onSubscribe(e){this._strategy?.onSubscribe(e)}onUnsubscribe(e){this._strategy?.onUnsubscribe(e)}requiresInvalidation(){return this._strategy?.requiresInvalidation()??!1}async update(t,s,n,a,c){const u=t.processor,d=r.notDeepEqual(this._schema?.storage,u.storage),p=r.notDeepEqual(this._schema?.mesh.properties,u.mesh.properties),f=r.notDeepEqual(this._schema?.mesh.factory,u.mesh.factory),m=r.notDeepEqual(this._schema?.mesh.strategy,u.mesh.strategy),g=function(e,t){const r=[];return e?.timeExtent?.start===t.timeExtent?.start&&e?.timeExtent?.end===t.timeExtent?.end||r.push("timeProperties"),r}(this._schema?.expressionProperties,u.expressionProperties),y=g.some(e=>this._attributeStore.hasArcadeDependency(e)),S=g.some(e=>this._factory?.hasArcadeDependency(e)??!1),x=g.some(e=>this._strategy?.hasArcadeDependency(e))||this._strategy?.isAggregate&&y,w=S||x,v=p||f||m;if(!(d||v||S||y||x||a))return!1;e("esri-2d-update-debug")&&console.debug(`Version[${this._version}] SymbolProcessor.update`,{changes:i.diff(this._schema,u),schema:u}),this._schema=u;const M=o.fromJSON(this._source.service.outSpatialReference),I=new _.ComputedAttributeStorage({fields:this._source.metadata.fieldsIndex,spatialReference:M}),P={currentUser:u.mesh.properties.currentUser};if((d||v||y)&&(await this._attributeStore.update(u.storage,I,this._source.metadata,s),this._strategy?.invalidateAttributeData(b(u))),!a&&!v&&!w)return!1;(m||p||w)&&await this._updateStrategy(u.mesh.strategy,M,c,b(u),P),this._updateSortKey(I,"sortKey"in u.mesh.properties?u.mesh.properties.sortKey:null);const T="dictionary"===u.mesh.factory.symbology.type?u.mesh.factory.symbology.fieldMap:null,C=new h.MatcherContext(I,this._proxy,n,this._registry,T);return(f||"dictionary"===u.mesh.factory.symbology.type)&&(this._factory=await l.FeatureMeshFactory.create(C,u.mesh.factory)),this._version=s,!0}async applyOverrideUpdate(e){if(!this._strategy)return;const t=this._strategy.applyOverrideUpdate(e);for await(const e of t)try{await this._process(e)}catch(e){}}async updateChunks(){await this._doUpdateChunks(),this._strategy?.afterUpdateChunks()}async removeChunks(e){this._strategy?.removeChunks(e),this._attributeStore.incrementDisplayIdGeneration()}updateHighlight({highlights:e}){if(!this._strategy||!this._strategy.hasSubscribers)return void this._attributeStore.setHighlight(e.map(({objectId:e,highlightFlags:t})=>({objectId:e,highlightFlags:t,displayId:-1})),e);const t=this._strategy.displayMap(e,({objectId:e})=>e,(e,{highlightFlags:t},r)=>({objectId:r,displayId:e,highlightFlags:t}));this._attributeStore.setHighlight(t,e)}invalidate(){this._strategy&&this._strategy.invalidate()}async _doUpdateChunks(){if(!this._strategy)return;const t=this._strategy.updateChunks(),r=[],i=new Map;for await(const e of t){let t=i.get(e.id);null==t&&(t=new d.ProcessorTileMessageQueue({concurrency:16,process:e=>this._process(e)}),i.set(e.id,t));const n=t.push(e).catch(e=>s.throwIfNotAbortError(e));r.push(n)}try{await Promise.all(r)}catch(e){}e("esri-2d-update-debug")&&console.log("SendUpdates"),this._attributeStore.sendUpdates(),e("esri-2d-update-debug")&&console.log("SendUpdates.await")}async _updateStrategy(e,t,r,s,i){switch(this._strategy?.destroy(),e.type){case"feature":this._strategy=new m.FeatureUpdateStrategy(this._source,this._attributeStore,s,i);break;case"binning":this._strategy=await p.BinningStrategy.create(e,t,this._source,this._attributeStore,s,i);break;case"cluster":this._strategy=await f.ClusterStrategy.create(this._connection,e,t,this._source,this._attributeStore,s,i);break;case"track":this._strategy=await g.TrackStrategy.create(e,t,this._source,this._attributeStore,s,i)}for(const e of r)this._strategy.onSubscribe(e)}async _updateSortKey(e,r){if(this._sortInfo=t.destroyMaybe(this._sortInfo?.computed),null!=r){const t=r.byRenderer?null:await e.createComputedField(r);this._sortInfo={...r,computed:t}}}async _process(t){const r=t.subscription;if(e("esri-2d-update-debug")){const e=r.tile;console.debug(`Version[${this._version}] Tile[${e.key.id}, end=${t.end}] Processor._process`)}const i={currentUser:this._schema?.mesh.properties.currentUser};await this._fetchResources(t,i),s.throwIfAborted(r.signal);const n=await this._write(t,r.tile.createArcadeEvaluationOptions(b(this._schema)),i),o=r.tile.tileInfoView.getLODInfoAt(r.tile.key);s.throwIfAborted(r.signal);const{message:a,transferList:l}=n.serialize(o),c={objectIdMap:null,inner:t.createMessage(a,this._version,this._attributeStore.epoch)};if(this._schema?.mesh.properties.returnMeshObjectId){c.objectIdMap={};const e=t.reader?.getCursor();if(e)for(;e.next();)c.objectIdMap[e.getDisplayId()]=e.getObjectId()}if(s.throwIfAborted(r.signal),await this._connection.container.onMessage(c,{signal:r.signal,transferList:l}),this._attributeStore.sendUpdates(),e("esri-2d-update-debug")){const e=r.tile;console.debug(`Version[${this._version}] Tile[${e.key.id}, end=${t.end}] Processor._process.await`)}}async _fetchResources(e,t){await this._fetchMatcherResources(e),await this._fetchWriterResources(e,t)}async _fetchMatcherResources(e){if(e.reader)return this._factory.enqueueMatcherRequests(this._proxy,e.reader)}async _fetchWriterResources(e,t){if(!e.reader)return;const r=e.reader.getCursor(),s=e.subscription.tile.createArcadeEvaluationOptions(b(this._schema));for(;r.next();)this._factory.enqueueWriterRequests(this._proxy,r,s,t);await this._proxy.fetchEnqueuedResources()}async _write(e,t,r){const i=e.subscription.tile,n=e.reader?.getCursor(),o=n?.getSize()??0,l=i.tileInfoView.tileInfo.isWrappable,c=i.tileInfoView.tileInfo.spatialReference.isWGS84,u=new a.MultiTileMeshData(i.key,this._strategy.enablePixelBuffering,l,c,o);if(!n)return u;const h=i.createArcadeEvaluationOptions(b(this._schema));let d=0;for(;n.next();){++d%1e3||(await s.after(0),s.throwIfAborted(e.subscription));const o=this._getSortKeyValue(n,t);u.entityStart(n.getDisplayId(),o),this._factory.write(u,this._proxy,n,h,r,i.level),u.entityEnd()}return u}_getSortKeyValue(e,t){if(!this._sortInfo)return 0;const{computed:r,order:s,byRenderer:i}=this._sortInfo,n=i?this._factory.getSortKey(e,t):r?.read(e,t);return null==n||isNaN(n)?0:n*("asc"===s?-1:1)}}})},"esri/core/accessorSupport/diffUtils":function(){define(["exports","../Accessor","../Collection","./utils"],function(e,t,r,s){"use strict";const i=new Set(["esri.Color","esri.portal.Portal","esri.symbols.support.Symbol3DAnchorPosition2D","esri.symbols.support.Symbol3DAnchorPosition3D"]);function n(e){return e instanceof t}function o(e){return e instanceof r?Object.keys(e.items):n(e)?s.getProperties(e).keys():e?Object.keys(e):[]}function a(e,t){return e instanceof r?e.items[t]:e[t]}function l(e){return e?e.declaredClass:null}function c(e,t){const r=e.diff;if(r&&"function"==typeof r)return r(e,t);const s=o(e),u=o(t);if(0===s.length&&0===u.length)return;if(!s.length||!u.length||function(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.length!==t.length}(e,t))return{type:"complete",oldValue:e,newValue:t};const h=u.filter(e=>!s.includes(e)),d=s.filter(e=>!u.includes(e)),p=s.filter(r=>u.includes(r)&&a(e,r)!==a(t,r)).concat(h,d).sort(),f=l(e);if(f&&i.has(f)&&p.length)return{type:"complete",oldValue:e,newValue:t};let m;const g=n(e)&&n(t);for(const s of p){const i=a(e,s),n=a(t,s);let o;if((g||"function"!=typeof i&&"function"!=typeof n)&&i!==n&&(null!=i||null!=n)){if(r&&r[s]&&"function"==typeof r[s])o=r[s]?.(i,n);else if(i instanceof Date&&n instanceof Date){if(i.getTime()===n.getTime())continue;o={type:"complete",oldValue:i,newValue:n}}else o="object"==typeof i&&"object"==typeof n&&l(i)===l(n)?c(i,n):{type:"complete",oldValue:i,newValue:n};null!=o&&(null!=m?m.diff[s]=o:m={type:"partial",diff:{[s]:o}})}}return m}function u(e,t){if(null==e)return!1;const r=t.split(".");let s=e;for(const e of r){if("complete"===s.type)return!0;if("partial"!==s.type)return!1;{const t=s.diff[e];if(!t)return!1;s=t}}return!0}e.diff=function(e,t){if("function"!=typeof e&&"function"!=typeof t&&(null!=e||null!=t))return null==e||null==t||"object"==typeof e&&"object"==typeof t&&l(e)!==l(t)?{type:"complete",oldValue:e,newValue:t}:c(e,t)},e.hasDiff=u,e.hasRootDiff=function(e,t){return u(e,t)},e.hasRootDiffOnly=function(e,t){if(!e)return!1;if("partial"===e.type){const r=Object.keys(e.diff);return 1===r.length&&r[0]===t}return!1},e.isEmpty=function e(t){if(null==t)return!0;switch(t.type){case"complete":return!1;case"collection":{const r=t;for(const t of r.added)if(!e(t))return!1;for(const t of r.removed)if(!e(t))return!1;for(const t of r.changed)if(!e(t))return!1;return!0}case"partial":for(const r in t.diff)if(!e(t.diff[r]))return!1;return!0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/Collection":function(){define(["../chunks/tslib.es6","./ArrayPool","./Evented","./handleUtils","./lang","./ObjectPool","./scheduling","./accessorSupport/ensureType","./accessorSupport/tracking","./accessorSupport/decorators/property","./accessorSupport/decorators/shared","./accessorSupport/decorators/subclass","./accessorSupport/tracking/SimpleObservable","./support/jsonUtils"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p){"use strict";var f;class m{constructor(e,t,r,s,i){this.target=e,this.added=t,this.removed=r,this.start=s,this.deleteCount=i}}const g=new n(class{constructor(){this.target=null,this.cancellable=!1,this.defaultPrevented=!1,this.item=void 0,this.type=void 0}preventDefault(){this.cancellable&&(this.defaultPrevented=!0)}reset(e){this.defaultPrevented=!1,this.item=e}},void 0,e=>{e.item=null,e.target=null,e.defaultPrevented=!1,e.cancellable=!1});function y(e){e&&"object"==typeof e&&"destroy"in e&&"function"==typeof e.destroy&&e.destroy()}function _(e){return e?e instanceof T?e.toArray():e.length?Array.prototype.slice.apply(e):[]:[]}function b(e){if(e?.length)return e[0]}function S(e,t,r,s){const i=Math.min(e.length-r,t.length-s);let n=0;for(;n<i&&e[r+n]===t[s+n];)n++;return n}function x(e,t,r,s){t&&t.forEach((t,i,n)=>{e.push(t),x(e,r.call(s,t,i,n),r,s)})}const w=new Set,v=new Set,M=new Set,I=new Map;let P=0,T=class extends r.EventedAccessor{static{f=this}static{this.ofType=t=>{if(!t)return f;if(I.has(t))return I.get(t);let r=null;if("function"==typeof t)r=t.prototype.declaredClass;else if(t.base)r=t.base.prototype.declaredClass;else for(const e in t.typeMap){const s=t.typeMap[e].prototype.declaredClass;r?r+=` | ${s}`:r=s}let s=class extends f{};return e.__decorate([u.shared({Type:t,ensureType:"function"==typeof t?a.ensureType(t):a.ensureOneOfType(t)})],s.prototype,"itemType",void 0),s=e.__decorate([h.subclass(`esri.core.Collection<${r}>`)],s),I.set(t,s),s}}static isCollection(e){return null!=e&&e instanceof f}constructor(e){super(e),this._chgListeners=[],this._notifications=null,this._updating=!1,this._timer=null,this._observable=new d.SimpleObservable,this.length=0,this._items=[],Object.defineProperty(this,"uid",{value:P++})}normalizeCtorArgs(e){return e?Array.isArray(e)||e instanceof f?{items:e}:e:{}}destroy(){this._removeAllRaw(),this._timer&&this._timer.remove(),super.destroy(),this._notifications=null}*[Symbol.iterator](){yield*this.items}get items(){return l.trackAccess(this._observable),this._items}set items(e){this._emitBeforeChanges(1)||(this._splice(0,this.length,_(e)),this._emitAfterChanges(1))}hasEventListener(e){return!this.destroyed&&("change"===e?this._chgListeners.length>0:super.hasEventListener(e))}on(e,t){if(this.destroyed)return s.makeHandle();if("change"===e){const e=this._chgListeners,r={removed:!1,callback:t};return e.push(r),this._notifications&&this._notifications.push({listeners:e.slice(),items:this._items.slice(),changes:[]}),s.makeHandle(()=>{r.removed=!0,e.splice(e.indexOf(r),1)})}return super.on(e,t)}once(e,t){const r="deref"in t?()=>t.deref():()=>t,s=this.on(e,e=>{r()?.call(null,e),s.remove()});return s}add(e,t){if(l.trackAccess(this._observable),this._emitBeforeChanges(1))return this;const r=this.getNextIndex(t??null);return this._splice(r,0,[e]),this._emitAfterChanges(1),this}addMany(e,t=this._items.length){if(l.trackAccess(this._observable),!e?.length)return this;if(this._emitBeforeChanges(1))return this;const r=this.getNextIndex(t);return this._splice(r,0,_(e)),this._emitAfterChanges(1),this}at(e){if(l.trackAccess(this._observable),(e=Math.trunc(e)||0)<0&&(e+=this.length),!(e<0||e>=this.length))return this._items[e]}removeAll(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return[];const e=this._removeAllRaw();return this._emitAfterChanges(2),e}_removeAllRaw(){return 0===this.length?[]:this._splice(0,this.length)||[]}clone(){return l.trackAccess(this._observable),this._createNewInstance({items:this._items.map(i.clone)})}concat(...e){l.trackAccess(this._observable);const t=e.map(_);return this._createNewInstance({items:this._items.concat(...t)})}drain(e,t){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const r=this._splice(0,this.length),s=r.length;for(let i=0;i<s;i++)e.call(t,r[i],i,r);this._emitAfterChanges(2)}destroyAll(){this.drain(y)}destroyMany(e){const t=this.removeMany(e);return t.forEach(y),t}every(e,t){return l.trackAccess(this._observable),this._items.every(e,t)}filter(e,t){l.trackAccess(this._observable);const r=2===arguments.length?this._items.filter(e,t):this._items.filter(e);return this._createNewInstance({items:r})}find(e,t){return l.trackAccess(this._observable),this._items.find(e,t)}findIndex(e,t){return l.trackAccess(this._observable),this._items.findIndex(e,t)}flatten(e,t){l.trackAccess(this._observable);const r=[];return x(r,this,e,t),new f(r)}forEach(e,t){return l.trackAccess(this._observable),this._items.forEach(e,t)}getItemAt(e){return l.trackAccess(this._observable),this._items[e]}getNextIndex(e){l.trackAccess(this._observable);const t=this.length;return(e=e??t)<0?e=0:e>t&&(e=t),e}includes(e,t=0){return l.trackAccess(this._observable),this._items.includes(e,t)}indexOf(e,t=0){return l.trackAccess(this._observable),this._items.indexOf(e,t)}join(e=","){return l.trackAccess(this._observable),this._items.join(e)}lastIndexOf(e,t=this.length-1){return l.trackAccess(this._observable),this._items.lastIndexOf(e,t)}map(e,t){l.trackAccess(this._observable);const r=this._items.map(e,t);return new f({items:r})}reorder(e,t=this.length-1){l.trackAccess(this._observable);const r=this.indexOf(e);if(-1!==r){if(t<0?t=0:t>=this.length&&(t=this.length-1),r!==t){if(this._emitBeforeChanges(4))return e;this._splice(r,1),this._splice(t,0,[e]),this._emitAfterChanges(4)}return e}}pop(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=b(this._splice(this.length-1,1));return this._emitAfterChanges(2),e}push(...e){return l.trackAccess(this._observable),this._emitBeforeChanges(1)||(this._splice(this.length,0,e),this._emitAfterChanges(1)),this.length}reduce(e,t){l.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduce(e,t):r.reduce(e)}reduceRight(e,t){l.trackAccess(this._observable);const r=this._items;return 2===arguments.length?r.reduceRight(e,t):r.reduceRight(e)}remove(e){return l.trackAccess(this._observable),this.removeAt(this.indexOf(e))}removeAt(e){if(l.trackAccess(this._observable),e<0||e>=this.length||this._emitBeforeChanges(2))return;const t=b(this._splice(e,1));return this._emitAfterChanges(2),t}removeMany(e){if(l.trackAccess(this._observable),!e?.length||this._emitBeforeChanges(2))return[];const t=e instanceof f?e.toArray():e,r=this._items,s=[],i=t.length;for(let e=0;e<i;e++){const i=t[e],n=r.indexOf(i);if(n>-1){const i=1+S(t,r,e+1,n+1),o=this._splice(n,i);o&&o.length>0&&s.push.apply(s,o),e+=i-1}}return this._emitAfterChanges(2),s}reverse(){if(l.trackAccess(this._observable),this._emitBeforeChanges(4))return this;const e=this._splice(0,this.length);return e&&(e.reverse(),this._splice(0,0,e)),this._emitAfterChanges(4),this}shift(){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(2))return;const e=b(this._splice(0,1));return this._emitAfterChanges(2),e}slice(e=0,t=this.length){return l.trackAccess(this._observable),this._createNewInstance({items:this._items.slice(e,t)})}some(e,t){return l.trackAccess(this._observable),this._items.some(e,t)}sort(e){if(l.trackAccess(this._observable),!this.length||this._emitBeforeChanges(4)||!this._requiresSort(e))return this;const t=this._splice(0,this.length);return arguments.length?t.sort(e):t.sort(),this._splice(0,0,t),this._emitAfterChanges(4),this}_requiresSort(e=(e,t)=>e===t?0:e<t?-1:1){const t=this.length-1;for(let r=0;r<t;r++)if(e(this.items[r],this.items[r+1])>0)return!0;return!1}splice(e,t,...r){l.trackAccess(this._observable),1===arguments.length&&(t=this.length),t??=0;const s=(t?2:0)|(r.length?1:0);if(this._emitBeforeChanges(s))return[];const i=this._splice(e,t,r)||[];return this._emitAfterChanges(s),i}toArray(){return l.trackAccess(this._observable),this._items.slice()}toJSON(e){return l.trackAccess(this._observable),this.toArray().map(t=>p.isSerializable(t)?t.toJSON(e):t)}toLocaleString(){return l.trackAccess(this._observable),this._items.toLocaleString()}toString(){return l.trackAccess(this._observable),this._items.toString()}unshift(...e){return l.trackAccess(this._observable),!e.length||this._emitBeforeChanges(1)||(this._splice(0,0,e),this._emitAfterChanges(1)),this.length}_createNewInstance(e){return new this.constructor(e)}_splice(e,t,r){const s=this._items,i=this.itemType;let n,a;if(!this._notifications&&this.hasEventListener("change")&&(this._notifications=[{listeners:this._chgListeners.slice(),items:this._items.slice(),changes:[]}],this._timer&&this._timer.remove(),this._updating=!0,this._timer=o.schedule(()=>this._dispatchChange())),e<0&&(e+=this.length),t){if(a=s.splice(e,t),this.hasEventListener("before-remove")){const t=g.acquire();t.target=this,t.cancellable=!0;for(let r=0,i=a.length;r<i;r++)n=a[r],t.reset(n),this.emit("before-remove",t),t.defaultPrevented&&(a.splice(r,1),s.splice(e,0,n),e+=1,r-=1,i-=1);g.release(t)}if(this.length=this._items.length,this.hasEventListener("after-remove")){const e=g.acquire();e.target=this,e.cancellable=!1;const t=a.length;for(let r=0;r<t;r++)e.reset(a[r]),this.emit("after-remove",e);g.release(e)}}if(r?.length){if(i){const e=[];for(const t of r){const r=i.ensureType(t);null==r&&null!=t||e.push(r)}r=e}const t=this.hasEventListener("before-add"),n=this.hasEventListener("after-add"),o=e===this.length;if(t||n){const i=g.acquire();i.target=this,i.cancellable=!0;const a=g.acquire();a.target=this,a.cancellable=!1;for(const l of r)t?(i.reset(l),this.emit("before-add",i),i.defaultPrevented||(o?s.push(l):s.splice(e++,0,l),this._set("length",s.length),n&&(a.reset(l),this.emit("after-add",a)))):(o?s.push(l):s.splice(e++,0,l),this._set("length",s.length),a.reset(l),this.emit("after-add",a));g.release(a),g.release(i)}else{if(o)for(const e of r)s.push(e);else s.splice(e,0,...r);this._set("length",s.length)}}if((r?.length||a?.length)&&this._notifyChangeEvent(r,a),this.hasEventListener("after-splice")){const s=new m(this,r,a,e,t);this.emit("after-splice",s)}return a}_emitBeforeChanges(e){let t=!1;if(this.hasEventListener("before-changes")){const r=g.acquire();r.target=this,r.cancellable=!0,r.type=e,this.emit("before-changes",r),t=r.defaultPrevented,g.release(r)}return t}_emitAfterChanges(e){if(this.hasEventListener("after-changes")){const t=g.acquire();t.target=this,t.cancellable=!1,t.type=e,this.emit("after-changes",t),g.release(t)}this._observable.notify()}_notifyChangeEvent(e,t){this.hasEventListener("change")&&this._notifications&&this._notifications[this._notifications.length-1].changes.push({added:e,removed:t})}get updating(){return this._updating}_dispatchChange(){if(this._timer&&(this._timer.remove(),this._timer=null),this._updating=!1,!this._notifications)return;const e=this._notifications;this._notifications=null;for(const r of e){const e=r.changes;w.clear(),v.clear(),M.clear();for(const{added:t,removed:r}of e){if(t)if(0===M.size&&0===v.size)for(const e of t)w.add(e);else for(const e of t)v.has(e)?(M.add(e),v.delete(e)):M.has(e)||w.add(e);if(r)if(0===M.size&&0===w.size)for(const e of r)v.add(e);else for(const e of r)w.has(e)?w.delete(e):(M.delete(e),v.add(e))}const s=t.acquire();w.forEach(e=>{s.push(e)});const i=t.acquire();v.forEach(e=>{i.push(e)});const n=this._items,o=r.items,a=t.acquire();if(M.forEach(e=>{o.indexOf(e)!==n.indexOf(e)&&a.push(e)}),r.listeners&&(s.length||i.length||a.length)){const e={target:this,added:s,removed:i,moved:a},t=r.listeners.length;for(let s=0;s<t;s++){const t=r.listeners[s];t.removed||t.callback.call(this,e)}}t.release(s),t.release(i),t.release(a)}w.clear(),v.clear(),M.clear()}};return e.__decorate([c.property()],T.prototype,"_updating",void 0),e.__decorate([c.property()],T.prototype,"length",void 0),e.__decorate([c.property()],T.prototype,"items",null),e.__decorate([c.property({readOnly:!0})],T.prototype,"updating",null),T=f=e.__decorate([h.subclass("esri.core.Collection")],T),T})},"esri/core/Evented":function(){define(["exports","./Accessor","./handleUtils"],function(e,t,r){"use strict";const s=e=>{const t=e;return class extends t{constructor(){super(...arguments),this._listenersMap=null}clearEvents(){this._listenersMap?.clear(),this._listenersMap=null}destroy(){this.clearEvents()}emit(e,t){let r=this._listenersMap?.get(e);if(!r)return!1;let s=!1;for(const e of r.slice()){const r="deref"in e?e.deref():e;r?r?.call(this,t):s=!0}return s&&(r=r.filter(e=>!("deref"in e)||null!=e.deref()),this._listenersMap.set(e,r)),r.length>0}on(e,t){if(Array.isArray(e)){const s=e.map(e=>this.on(e,t));return r.handlesGroup(s)}if(e.includes(","))throw new TypeError("Evented.on() with a comma delimited string of event types is not supported");this._listenersMap??=new Map;const s=this._listenersMap.get(e)||[];return s.push(t),this._listenersMap.set(e,s),r.makeHandle(()=>{const r=this._listenersMap?.get(e),s=r?.indexOf(t)??-1;s>=0&&r.splice(s,1)})}once(e,t){const r=this.on(e,e=>{r.remove();const s="deref"in t?t.deref():t;s?.call(null,e)});return r}hasEventListener(e){const t=this._listenersMap?.get(e);return null!=t&&t.length>0}}},i=s(class{}),n=i,o=s(t);e.EventEmitter=n,e.Evented=i,e.EventedAccessor=o,e.EventedMixin=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/accessorSupport/decorators/shared":function(){define(["exports"],function(e){"use strict";e.shared=function(e){return(t,r)=>{t[r]=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/MultiTileMeshData":function(){define(["exports","../../../tiling/TileInfoView","../../../tiling/TileKey","../../../tiling/TileQueue","../../../tiling/TileStrategy","../definitions","./MeshData"],function(e,t,r,s,i,n,o){"use strict";function a(e){switch(e){case 1:case 8:case 32:return-1;case 2:case 64:return 0;case 4:case 16:case 128:return 1}}function l(e){switch(e){case 1:case 2:case 4:return-1;case 8:case 16:return 0;case 32:case 64:case 128:return 1}}e.MultiTileMeshData=class{constructor(e,t,r,s,i=0){this.tileKey=e,this._bufferingEnabled=t,this._sizeHint=i,this._meshes={self:new o.MeshData(this.id,this._sizeHint),neighbors:new Array},this._currentRecordOverlaps=0,this._currentEntityOverlaps=0;const n=s?1:0;this._copyBufferedDataIntoSelf=r&&this._bufferingEnabled&&e.level===n}get id(){return this.tileKey.id}vertexStart(){return this._meshes.self.vertexStart()??0}vertexCount(){return this._meshes.self.vertexCount()}indexCount(){return this._meshes.self.indexCount()}indexEnsureSize(e){this._meshes.self.indexEnsureSize(e)}entityStart(e,t=e){this._currentEntityOverlaps=0,this._meshes.self.entityStart(e,t)}entityRecordCount(){return this._meshes.self.entityRecordCount()}entityEnd(){if(this._meshes.self.entityEnd(),this._bufferingEnabled){if(this._copyBufferedDataIntoSelf)return;for(let e=0;e<8;e++){const t=1<<e;this._currentEntityOverlaps&t&&this._meshes.neighbors[e].entityEnd()}}}recordStart(e,t,r){this._currentRecordOverlaps=0,this._meshes.self.recordStart(e,t,r)}recordEnd(e=0){const t=this._meshes.self.recordEnd(this._currentRecordOverlaps);return t&&0!==this._currentRecordOverlaps?(this._copyIntoNeighbors(),this._currentEntityOverlaps|=this._currentRecordOverlaps,!0):t}recordBounds(e,t,r,s){this._bufferingEnabled&&this._addOverlap(e,t,r,s)}recordCount(){return this._meshes.self.recordCount()}metricStart(e){this._meshes.self.metricStart(e)}metricBoxWrite(e){this._meshes.self.metricBoxWrite(e)}metricEnd(){this._meshes.self.metricEnd()}vertexWrite(e){this._meshes.self.vertexWrite(e)}vertexWriteF32(e){this._meshes.self.vertexWriteF32(e)}vertexWriteRegion(e){this._meshes.self.vertexWriteRegion(e)}indexWrite(e){this._meshes.self.indexWrite(e)}serialize(e){const t={message:[],transferList:[]},s=this._meshes.self.serialize();return t.message.push({tileId:this.tileKey.id,...s.message}),t.transferList.push(...s.transferList),this._meshes.neighbors.forEach((s,i)=>{const n=s.serialize(),o=1<<i,c=a(o),u=l(o),h=new r(this.tileKey).getNormalizedNeighbor(c,u,e);t.message.push({tileId:h.id,...n.message}),t.transferList.push(...n.transferList)}),t}_addOverlap(e,t,r,s){const i=Math.min(n.tileSize/2,r),o=Math.min(n.tileSize/2,s),a=255^((e<0+i?148:e>=n.tileSize-i?41:189)|(t<0+o?224:t>=n.tileSize-o?7:231));this._currentRecordOverlaps|=a}_copyIntoNeighbors(){for(let e=0;e<8;e++){const t=1<<e;if(this._currentRecordOverlaps&t){if(this._copyBufferedDataIntoSelf){const e=-a(t)*n.tileSize,r=-l(t)*n.tileSize;if(0!==r)continue;this._meshes.self.copyLast(e,r);continue}if(!this._meshes.neighbors[e]){const r=Math.floor(this._sizeHint/16);this._meshes.neighbors[e]=new o.MeshData(t,r)}const r=this._meshes.neighbors[e],s=-a(t)*n.tileSize,i=-l(t)*n.tileSize;r.copyLastFrom(this._meshes.self,s,i)}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileInfoView":function(){define(["../../../geometry/support/spatialReferenceUtils","./LODInfo","./TileCoverage","./TileKey","./TileSpan"],function(e,t,r,s,i){"use strict";const n=new s("0/0/0/0");class o{static create(e,t){e[1]>t[1]&&([e,t]=[t,e]);const[r,s]=e,[i,n]=t,a=i-r,l=n-s,c=0!==l?a/l:0,u=(Math.ceil(s)-s)*c,h=(Math.floor(s)-s)*c;return new o(r,Math.floor(s),Math.ceil(n),c,a<0?u:h,a<0?h:u,a<0?i:r,a<0?r:i)}constructor(e,t,r,s,i,n,o,a){this.x=e,this.ymin=t,this.ymax=r,this.invM=s,this.leftAdjust=i,this.rightAdjust=n,this.leftBound=o,this.rightBound=a}incrRow(){this.x+=this.invM}getLeftCol(){return Math.max(this.x+this.leftAdjust,this.leftBound)}getRightCol(){return Math.min(this.x+this.rightAdjust,this.rightBound)}}const a=[[0,0],[0,0],[0,0],[0,0]];return class{constructor(e,r=null,s=e.lods[0].level,i=e.lods[e.lods.length-1].level){this.tileInfo=e,this.fullExtent=r,this.scales=[],this._infoByScale={},this._infoByLevel={};const n=e.lods.filter(e=>e.level>=s&&e.level<=i);this.minScale=n[0].scale,this.maxScale=n[n.length-1].scale;const o=this._lodInfos=n.map(s=>t.create(e,s,r));n.forEach((e,t)=>{this._infoByLevel[e.level]=o[t],this._infoByScale[e.scale]=o[t],this.scales[t]=e.scale},this),this._wrap=e.isWrappable}get spatialReference(){return this.tileInfo.spatialReference}getLODInfoAt(e){return this._infoByLevel["number"==typeof e?e:e.level]}getTileBounds(e,t,r=!1){n.set(t);const s=this._infoByLevel[n.level];return s?s.getTileBounds(e,n,r):e}getTileCoords(e,t,r=!1){n.set(t);const s=this._infoByLevel[n.level];return s?s.getTileCoords(e,n,r):e}getTileCoverage(e,t=192,s=!0,n="closest"){if(!s&&(e.scale>this.minScale||e.scale<this.maxScale))return null;const l="closest"===n?this.getClosestInfoForScale(e.scale):this.getSmallestInfoForScale(e.scale),c=r.pool.acquire(l),u=this._wrap;let h,d,p,f=1/0,m=-1/0;const g=c.spans;a[0][0]=a[0][1]=a[1][1]=a[3][0]=-t,a[1][0]=a[2][0]=e.size[0]+t,a[2][1]=a[3][1]=e.size[1]+t;for(const t of a)e.toMap(t,t),t[0]=l.getColumnForX(t[0]),t[1]=l.getRowForY(t[1]);const y=[];let _=3;for(let e=0;e<4;e++){if(a[e][1]===a[_][1]){_=e;continue}const t=o.create(a[e],a[_]);f=Math.min(t.ymin,f),m=Math.max(t.ymax,m),void 0===y[t.ymin]&&(y[t.ymin]=[]),y[t.ymin].push(t),_=e}if(null==f||null==m||m-f>100)return null;let b=[];for(h=f;h<m;){null!=y[h]&&(b=b.concat(y[h])),d=1/0,p=-1/0;for(let e=b.length-1;e>=0;e--){const t=b[e];d=Math.min(d,t.getLeftCol()),p=Math.max(p,t.getRightCol())}if(d=Math.floor(d),p=Math.floor(p),h>=l.first[1]&&h<=l.last[1])if(u)if(l.size[0]<l.worldSize[0]){const e=Math.floor(p/l.worldSize[0]);for(let t=Math.floor(d/l.worldSize[0]);t<=e;t++)g.push(new i(h,Math.max(l.getFirstColumnForWorld(t),d),Math.min(l.getLastColumnForWorld(t),p)))}else g.push(new i(h,d,p));else d>l.last[0]||p<l.first[0]||(d=Math.max(d,l.first[0]),p=Math.min(p,l.last[0]),g.push(new i(h,d,p)));h+=1;for(let e=b.length-1;e>=0;e--){const t=b[e];t.ymax>=h?t.incrRow():b.splice(e,1)}}return c}getTileParentId(e){n.set(e);const t=this._infoByLevel[n.level],r=this._lodInfos.indexOf(t)-1;return r<0?null:(this._getTileIdAtLOD(n,this._lodInfos[r],n),n.id)}getTileResolution(e){const t=this._infoByLevel["object"==typeof e?e.level:e];return t?t.resolution:-1}getTileScale(e){const t=this._infoByLevel[e.level];return t?t.scale:-1}intersects(e,t){n.set(t);const r=this._infoByLevel[n.level],s=e.lodInfo;if(s.resolution>r.resolution){this._getTileIdAtLOD(n,s,n);const t=s.denormalizeCol(n.col,n.world);for(const r of e.spans)if(r.row===n.row&&r.colFrom<=t&&r.colTo>=t)return!0}if(s.resolution<r.resolution){const[t,i,o,a]=e.spans.reduce((e,t)=>(e[0]=Math.min(e[0],t.row),e[1]=Math.max(e[1],t.row),e[2]=Math.min(e[2],t.colFrom),e[3]=Math.max(e[3],t.colTo),e),[1/0,-1/0,1/0,-1/0]),l=r.denormalizeCol(n.col,n.world),c=s.getColumnForX(r.getXForColumn(l)),u=s.getRowForY(r.getYForRow(n.row)),h=s.getColumnForX(r.getXForColumn(l+1))-1,d=s.getRowForY(r.getYForRow(n.row+1))-1;return!(c>a||h<o||u>i||d<t)}const i=s.denormalizeCol(n.col,n.world);return e.spans.some(e=>e.row===n.row&&e.colFrom<=i&&e.colTo>=i)}normalizeBounds(t,r,s){if(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],this._wrap){const r=e.getInfo(this.tileInfo.spatialReference),i=-s*(r.valid[1]-r.valid[0]);t[0]+=i,t[2]+=i}return t}getSmallestInfoForScale(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e];if(e>t[0])return this._infoByScale[t[0]];for(let r=1;r<t.length-1;r++)if(e>t[r]+1e-6)return this._infoByScale[t[r-1]];return this._infoByScale[t[t.length-1]]}getClosestInfoForScale(e){const t=this.scales;return this._infoByScale[e]||(e=t.reduce((t,r)=>Math.abs(r-e)<Math.abs(t-e)?r:t,t[0])),this._infoByScale[e]}scaleToLevel(e){const t=this.scales;if(this._infoByScale[e])return this._infoByScale[e].level;for(let r=t.length-1;r>=0;r--)if(e<t[r])return r===t.length-1?this._infoByScale[t[t.length-1]].level:this._infoByScale[t[r]].level+(t[r]-e)/(t[r]-t[r+1]);return this._infoByScale[t[0]].level}scaleToZoom(e){return this.tileInfo.scaleToZoom(e)}zoomToScale(e){return this.tileInfo.zoomToScale(e)}_getTileIdAtLOD(e,t,r){const s=this._infoByLevel[r.level];return e.set(r),t.resolution<s.resolution?null:(t.resolution===s.resolution||(e.level=t.level,e.col=Math.floor(r.col*s.resolution/t.resolution+.01),e.row=Math.floor(r.row*s.resolution/t.resolution+.01)),e)}}})},"esri/views/2d/tiling/LODInfo":function(){define(["../../../geometry/support/spatialReferenceUtils","./TileKey"],function(e,t){"use strict";function r(e,t){return[e,t]}function s(e,t,r){return e[0]=t,e[1]=r,e}const i=new t("0/0/0/0");class n{static create(t,i,o=null){const a=e.getInfo(t.spatialReference),l=i.origin||r(t.origin.x,t.origin.y),c=r(t.size[0]*i.resolution,t.size[1]*i.resolution),u=r(-1/0,-1/0),h=r(1/0,1/0),d=r(1/0,1/0);null!=o&&(s(u,Math.max(0,Math.floor((o.xmin-l[0])/c[0])),Math.max(0,Math.floor((l[1]-o.ymax)/c[1]))),s(h,Math.max(0,Math.floor((o.xmax-l[0])/c[0])),Math.max(0,Math.floor((l[1]-o.ymin)/c[1]))),s(d,h[0]-u[0]+1,h[1]-u[1]+1));const{cols:p,rows:f}=i;let m,g,y,_;return!o&&p&&f&&(s(u,p[0],f[0]),s(h,p[1],f[1]),s(d,p[1]-p[0]+1,f[1]-f[0]+1)),t.isWrappable?(m=r(Math.ceil(Math.round((a.valid[1]-a.valid[0])/i.resolution)/t.size[0]),d[1]),g=!0,y=a.origin,_=a.valid):(m=d,g=!1),new n(i.level,i.resolution,i.scale,l,u,h,d,c,m,g,y,_)}constructor(e,t,r,s,i,n,o,a,l,c,u,h){this.level=e,this.resolution=t,this.scale=r,this.origin=s,this.first=i,this.last=n,this.size=o,this.norm=a,this.worldSize=l,this.wrap=c,this._spatialReferenceOrigin=u,this._spatialReferenceValid=h}normalizeCol(e){if(!this.wrap)return e;const t=this.worldSize[0];return e<0?t-1-Math.abs((e+1)%t):e%t}normalizeKey(e){if(!this.wrap)return;const t=this.worldSize[0],r=e.col;r<0?(e.col=r+t,e.world-=1):r>=t&&(e.col=r-t,e.world+=1)}denormalizeCol(e,t){return this.wrap?this.worldSize[0]*t+e:e}getWorldForColumn(e){return this.wrap?Math.floor(e/this.worldSize[0]):0}getFirstColumnForWorld(e){return e*this.worldSize[0]+this.first[0]}getLastColumnForWorld(e){return e*this.worldSize[0]+this.first[0]+this.size[0]-1}getColumnForX(e){return(e-this.origin[0])/this.norm[0]}getXForColumn(e){const t=this.origin[0]+e*this.norm[0],r=this._spatialReferenceOrigin,s=this._spatialReferenceValid;return this.wrap&&r&&s?t===r[0]?s[0]:this.origin[0]===r[0]&&e===this.worldSize[0]?s[1]:t:t}getRowForY(e){return(this.origin[1]-e)/this.norm[1]}getYForRow(e){return this.origin[1]-e*this.norm[1]}getTileBounds(e,t,r=!1){i.set(t);const s=r?i.col:this.denormalizeCol(i.col,i.world),n=i.row;return function(e,t,r,s,i){e[0]=t,e[1]=r,e[2]=s,e[3]=i}(e,this.getXForColumn(s),this.getYForRow(n+1),this.getXForColumn(s+1),this.getYForRow(n)),e}getTileCoords(e,t,r=!1){i.set(t);const n=r?i.col:this.denormalizeCol(i.col,i.world);return Array.isArray(e)?s(e,this.getXForColumn(n),this.getYForRow(i.row)):(e.x=this.getXForColumn(n),e.y=this.getYForRow(i.row)),e}}return n})},"esri/views/2d/tiling/TileKey":function(){define(["../../../core/ObjectPool"],function(e){"use strict";class t{static{this.pool=new e(t,null,null,25,50)}static getId(e,t,r,s){return"object"==typeof e?`${e.level}/${e.row}/${e.col}/${e.world}`:`${e}/${t}/${r}/${s}`}constructor(e,t,r,s){this.set(e,t,r,s)}get key(){return this}get id(){return this.toString()}get normalizedId(){return`${this.level}/${this.row}/${this.col}`}set id(e){this.set(e)}get hash(){const e=4095&this.row,t=4095&this.col,r=63&this.level;return(3&this.world)<<30|t<<22|e<<8|r}acquire(e,t,r,s){this.set(e,t,r,s)}contains(e){const t=e.level-this.level;return t>=0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}containsChild(e){const t=e.level-this.level;return t>0&&this.row===e.row>>t&&this.col===e.col>>t&&this.world===e.world}equals(e){return this.level===e.level&&this.row===e.row&&this.col===e.col&&this.world===e.world}clone(){return new t(this)}release(){this.level=0,this.row=0,this.col=0,this.world=0}set(e,t,r,s){if(null==e)this.level=0,this.row=0,this.col=0,this.world=0;else if("object"==typeof e)this.level=e.level||0,this.row=e.row||0,this.col=e.col||0,this.world=e.world||0;else if("string"==typeof e){const[t,r,s,i]=e.split("/");this.level=parseFloat(t),this.row=parseFloat(r),this.col=parseFloat(s),this.world=parseFloat(i)}else this.level=+e,this.row=+t,this.col=+r,this.world=+s||0;return this}toString(){return`${this.level}/${this.row}/${this.col}/${this.world}`}getParentKey(){return this.level<=0?null:new t(this.level-1,this.row>>1,this.col>>1,this.world)}getNormalizedNeighbor(e,t,r){const s=this.clone();return s.col+=e,s.row+=t,r.normalizeKey(s),s}getChildKeys(){const e=this.level+1,r=this.row<<1,s=this.col<<1,i=this.world;return[new t(e,r,s,i),new t(e,r,s+1,i),new t(e,r+1,s,i),new t(e,r+1,s+1,i)]}compareRowMajor(e){return this.row<e.row?-1:this.row>e.row?1:this.col<e.col?-1:this.col>e.col?1:0}}return t})},"esri/views/2d/tiling/TileCoverage":function(){define(["../../../core/ObjectPool","./TileKey"],function(e,t){"use strict";class r{constructor(){this.spans=[]}static{this.pool=new e(r)}acquire(e){this.lodInfo=e}release(){this.lodInfo=null,this.spans.length=0}*keys(){const e=this.lodInfo;for(const{row:r,colFrom:s,colTo:i}of this.spans)for(let n=s;n<=i;n++){const s=e.getWorldForColumn(n);yield new t(e.level,r,e.normalizeCol(n),s)}}forEach(e,t){const{spans:r,lodInfo:s}=this,{level:i}=s;if(0!==r.length)for(const{row:n,colFrom:o,colTo:a}of r)for(let r=o;r<=a;r++)e.call(t,i,n,s.normalizeCol(r),s.getWorldForColumn(r))}}return r})},"esri/views/2d/tiling/TileSpan":function(){define(function(){"use strict";return class{constructor(e,t,r){this.row=e,this.colFrom=t,this.colTo=r}}})},"esri/views/2d/tiling/TileQueue":function(){define(["../../../chunks/tslib.es6","../../../core/Accessor","../../../core/MapUtils","../../../core/maybe","../../../core/SetUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../core/libs/gl-matrix-2/math/vec2","../../support/ScheduledQueueProcessor"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";const d=[0,0];let p=class extends t{constructor(e){super(e),this._keyToItem=new Map,this._tilesByScale=new Map,this.concurrency=6}initialize(){const{concurrency:e,process:t,scheduler:r,priority:s}=this;this._queue=new h.ScheduledQueueProcessor({concurrency:e,scheduler:r,priority:s,process:(e,r)=>{const s=this._keyToItem.get(e);return t(s,{signal:r})},peeker:e=>this._peek(e)})}destroy(){this.clear(),this._queue=s.destroyMaybe(this._queue)}get length(){return this._queue?this._queue.length:0}abort(e){const t="string"==typeof e?e:e.id;this._queue.abort(t)}clear(){this._queue.clear(),this._keyToItem.clear(),this._tilesByScale.clear()}has(e){return"string"==typeof e?this._keyToItem.has(e):this._keyToItem.has(e.id)}pause(){this._queue.pause()}push(e){const t=e.key.id;if(this._queue.has(t))return this._queue.get(t);const s=this._queue.push(t),i=this.tileInfoView.getTileScale(e.key),n=r.getOrCreateMapValue(this._tilesByScale,i,()=>new Set),o=()=>{n.delete(e.key),0===n.size&&this._tilesByScale.delete(i),this._keyToItem.delete(t)};return n.add(e.key),this._keyToItem.set(t,e),s.then(o,o),s}reset(){this._queue.reset()}resume(){this._queue.resume()}_peek(e){if(!this.state)return e.values().next().value;const t=new Set;for(const r of e)t.add(this._keyToItem.get(r).key);const r=this.state.scale;let s,n=Number.POSITIVE_INFINITY;for(const[e,o]of this._tilesByScale)if(i.someSet(o,e=>t.has(e))){const t=Math.abs(e-r);t<n&&(s=o,n=t)}return this._getClosestTileKey(s,e).id}_getClosestTileKey(e,t){const r=this.tileInfoView,s=this.state.center;let i,n=Number.POSITIVE_INFINITY;for(const o of e)if(t.has(o.id)){r.getTileCoords(d,o);const e=u.distance(d,s);e<n&&(n=e,i=o)}return i}};return e.__decorate([n.property({constructOnly:!0})],p.prototype,"concurrency",void 0),e.__decorate([n.property({constructOnly:!0})],p.prototype,"priority",void 0),e.__decorate([n.property({constructOnly:!0})],p.prototype,"process",void 0),e.__decorate([n.property({constructOnly:!0})],p.prototype,"scheduler",void 0),e.__decorate([n.property()],p.prototype,"state",void 0),e.__decorate([n.property({constructOnly:!0})],p.prototype,"tileInfoView",void 0),p=e.__decorate([c.subclass("esri.views.2d.tiling.TileQueue")],p),p})},"esri/core/libs/gl-matrix-2/math/vec2":function(){define(["exports","./common"],function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e}function s(e,t,r){return e[0]=t,e[1]=r,e}function i(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function n(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function o(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function a(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function l(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function c(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function u(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e}function h(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e}function d(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function p(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function f(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e}function m(e,t){const r=t[0]-e[0],s=t[1]-e[1];return Math.sqrt(r*r+s*s)}function g(e,t){const r=t[0]-e[0],s=t[1]-e[1];return r*r+s*s}function y(e){const t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function _(e){const t=e[0],r=e[1];return t*t+r*r}function b(e,t){return e[0]=-t[0],e[1]=-t[1],e}function S(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function x(e,t){const r=t[0],s=t[1];let i=r*r+s*s;return i>0&&(i=1/Math.sqrt(i),e[0]=t[0]*i,e[1]=t[1]*i),e}function w(e,t){return e[0]*t[0]+e[1]*t[1]}function v(e,t,r){const s=t[0]*r[1]-t[1]*r[0];return e[0]=e[1]=0,e[2]=s,e}function M(e,t,r,s){const i=t[0],n=t[1];return e[0]=i+s*(r[0]-i),e[1]=n+s*(r[1]-n),e}function I(e,r=1){const s=2*t.RANDOM()*Math.PI;return e[0]=Math.cos(s)*r,e[1]=Math.sin(s)*r,e}function P(e,t,r){const s=t[0],i=t[1];return e[0]=r[0]*s+r[2]*i,e[1]=r[1]*s+r[3]*i,e}function T(e,t,r){const s=t[0],i=t[1];return e[0]=r[0]*s+r[2]*i+r[4],e[1]=r[1]*s+r[3]*i+r[5],e}function C(e,t,r){const s=t[0],i=t[1];return e[0]=r[0]*s+r[3]*i+r[6],e[1]=r[1]*s+r[4]*i+r[7],e}function F(e,t,r){const s=t[0],i=t[1];return e[0]=r[0]*s+r[4]*i+r[12],e[1]=r[1]*s+r[5]*i+r[13],e}function k(e,t,r,s){const i=t[0]-r[0],n=t[1]-r[1],o=Math.sin(s),a=Math.cos(s);return e[0]=i*a-n*o+r[0],e[1]=i*o+n*a+r[1],e}function A(e,t){const r=e[0],s=e[1],i=t[0],n=t[1];let o=r*r+s*s;o>0&&(o=1/Math.sqrt(o));let a=i*i+n*n;a>0&&(a=1/Math.sqrt(a));const l=(r*i+s*n)*o*a;return l>1?0:l<-1?Math.PI:Math.acos(l)}function O(e){return"vec2("+e[0]+", "+e[1]+")"}function E(e,t){return e[0]===t[0]&&e[1]===t[1]}function z(e,r){const s=e[0],i=e[1],n=r[0],o=r[1],a=t.getEpsilon();return Math.abs(s-n)<=a*Math.max(1,Math.abs(s),Math.abs(n))&&Math.abs(i-o)<=a*Math.max(1,Math.abs(i),Math.abs(o))}function R(e,t,r,s,i){let n=t[0]-r[0],o=t[1]-r[1];const a=(s[0]*n+s[1]*o)*(i-1);return n=s[0]*a,o=s[1]*a,e[0]=t[0]+n,e[1]=t[1]+o,e}const L=y,D=n,N=o,G=a,q=m,B=g,U=_,j=Object.freeze(Object.defineProperty({__proto__:null,add:i,angle:A,ceil:l,copy:r,cross:v,dist:q,distance:m,div:G,divide:a,dot:w,equals:z,exactEquals:E,floor:c,inverse:S,len:L,length:y,lerp:M,max:h,min:u,mul:N,multiply:o,negate:b,normalize:x,projectAndScale:R,random:I,rotate:k,round:d,scale:p,scaleAndAdd:f,set:s,sqrDist:B,sqrLen:U,squaredDistance:g,squaredLength:_,str:O,sub:D,subtract:n,transformMat2:P,transformMat2d:T,transformMat3:C,transformMat4:F},Symbol.toStringTag,{value:"Module"}));e.add=i,e.angle=A,e.ceil=l,e.copy=r,e.cross=v,e.dist=q,e.distance=m,e.div=G,e.divide=a,e.dot=w,e.equals=z,e.exactEquals=E,e.floor=c,e.inverse=S,e.len=L,e.length=y,e.lerp=M,e.max=h,e.min=u,e.mul=N,e.multiply=o,e.negate=b,e.normalize=x,e.projectAndScale=R,e.random=I,e.rotate=k,e.round=d,e.scale=p,e.scaleAndAdd=f,e.set=s,e.sqrDist=B,e.sqrLen=U,e.squaredDistance=g,e.squaredLength=_,e.str=O,e.sub=D,e.subtract=n,e.transformMat2=P,e.transformMat2d=T,e.transformMat3=C,e.transformMat4=F,e.vec2=j,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/ScheduledQueueProcessor":function(){define(["exports","../../core/has","../../core/maybe","../../core/promiseUtils","../../core/Queue","../../core/ReactiveMap","../../core/scheduling","../../core/signal"],function(e,t,r,s,i,n,o,a){"use strict";class l{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}e.ScheduledQueueProcessor=class{constructor(e){this._schedule=null,this._task=null,this._deferreds=new n,this._controllers=new n,this._processingItems=new n,this._pausedSignal=a.signal(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new i(e.peeker),this.process=e.process;const t=e.scheduler;e.priority&&t&&(this._task=t.registerTask(e.priority,this))}destroy(){this.clear(),this._schedule=r.removeMaybe(this._schedule),this._task=r.removeMaybe(this._task)}get updating(){return!!this._task?.updating||this.readyToRun}get length(){return this._processingItems.size+this._queue.length}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(t=>e.push(t)),this._controllers.clear(),e.forEach(e=>e.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((t,r)=>e(r))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const r=this.get(e);if(r)return r;const i=new AbortController;let n=null;t&&(n=s.onAbort(t,()=>i.abort()));const o=()=>{a.remove(),null!=n&&n.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},a=s.onAbortOrThrow(i.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),l.reject(s.createAbortError())}),l=s.createResolver();return this._deferreds.set(e,l),this._controllers.set(e,i),l.promise.then(o,o),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject(s.createAbortError()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}get readyToRun(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}runTask(e){for(;!e.done&&this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop()),e.madeProgress()}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._task||this._pausedSignal.value||this._schedule||(this._schedule=o.schedule(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const r=new AbortController,i=new l(e,r);this._processingItems.set(e,i);try{t=this.process(e,r.signal)}catch(e){this._processError(i,e)}s.isPromiseLike(t)?(i.promise=t,t.then(e=>this._processResult(i,e),e=>this._processError(i,e))):this._processResult(i,t)}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/Queue":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t){"use strict";class r{constructor(e=e=>e.values().next().value){this._peeker=e,this._observable=new t.SimpleObservable,this._items=new Set}get length(){return e.trackAccess(this._observable),this._items.size}clear(){0!==this.length&&(this._items.clear(),this._observable.notify())}last(){if(0===this.length)return;let e;for(e of this._items);return e}peek(){if(0!==this.length)return this._peeker(this._items)}push(e){this.contains(e)||(this._items.add(e),this._observable.notify())}contains(t){return e.trackAccess(this._observable),this._items.has(t)}pop(){if(0===this.length)return;const e=this.peek();return this._items.delete(e),this._observable.notify(),e}popLast(){if(0===this.length)return;const e=this.last();return this._items.delete(e),this._observable.notify(),e}remove(e){this.contains(e)&&(this._items.delete(e),this._observable.notify())}filter(e){const t=this.length;return this._items.forEach(t=>{e(t)||this._items.delete(t)}),t!==this._items.size&&this._observable.notify(),this}*[Symbol.iterator](){e.trackAccess(this._observable),yield*this._items}}return r})},"esri/core/ReactiveMap":function(){define(["./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t){"use strict";class r{constructor(e){this._observable=new t.SimpleObservable,this._map=new Map(e)}get size(){return e.trackAccess(this._observable),this._map.size}clear(){this._map.size>0&&(this._map.clear(),this._observable.notify())}delete(e){const t=this._map.delete(e);return t&&this._observable.notify(),t}entries(){return e.trackAccess(this._observable),this._map.entries()}forEach(t,r){e.trackAccess(this._observable),this._map.forEach((e,s)=>t.call(r,e,s,this),r)}get(t){return e.trackAccess(this._observable),this._map.get(t)}has(t){return e.trackAccess(this._observable),this._map.has(t)}keys(){return e.trackAccess(this._observable),this._map.keys()}set(e,t){return this._map.set(e,t),this._observable.notify(),this}values(){return e.trackAccess(this._observable),this._map.values()}[Symbol.iterator](){return e.trackAccess(this._observable),this._map[Symbol.iterator]()}[Symbol.dispose](){this._observable.destroy()}get[Symbol.toStringTag](){return this._map[Symbol.toStringTag]}}return r})},"esri/core/signal":function(){define(["exports","./lang","./accessorSupport/tracking","./accessorSupport/tracking/SimpleObservable"],function(e,t,r,s){"use strict";class i{constructor(e,t){this._observable=new s.SimpleObservable,this._value=e,this._equalityFunction=t}get value(){return r.trackAccess(this._observable),this._value}set value(e){this._equalityFunction(e,this._value)||(this._value=e,this._observable.notify())}mutate(e){e(this._value),this._observable.notify()}}e.signal=function(e,r=t.equalsShallow){return new i(e,r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileStrategy":function(){define(["../../../geometry/support/aaBoundingRect","./TileCache","./TileCoverage","./TileKey"],function(e,t,r,s){"use strict";const i=new s(0,0,0,0),n=new Map,o=[],a=[];return class{constructor(e){this._previousScale=Number.POSITIVE_INFINITY,this.cachePolicy="keep",this.coveragePolicy="closest",this.resampling=!0,this.tileIndex=new Map,this.tiles=[],this.buffer=192,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,null!=e.resampling&&(this.resampling=e.resampling),e.cachePolicy&&(this.cachePolicy=e.cachePolicy),e.coveragePolicy&&(this.coveragePolicy=e.coveragePolicy),null!=e.buffer&&(this.buffer=e.buffer),e.cacheSize&&(this._tileCache=new t(e.cacheSize,this.tileInfoView,e=>{this.releaseTile(e)}))}destroy(){this.tileIndex.clear()}update(e){const{resampling:t,tileIndex:s}=this,{scale:l,center:c,resolution:u}=e.state,{minScale:h,maxScale:d}=this.tileInfoView,p=!e.stationary&&l>this._previousScale;if(this._previousScale=l,!t&&(l>h||l<d))return this.tiles.length=0,void this.clear();const f=this.tileInfoView.getTileCoverage(e.state,this.buffer,this.resampling,this.coveragePolicy);if(!f)return this.tiles.length=0,void this.clear();const{spans:m,lodInfo:g}=f,{level:y}=g;this.tiles.length=0,s.forEach(e=>e.visible=!0);let _=0,b=0;if(m.length>0)for(const{row:e,colFrom:t,colTo:r}of m)for(let o=t;o<=r;o++){_++;const t=i.set(y,e,g.normalizeCol(o),g.getWorldForColumn(o)).id;let r=s.get(t);if(r)r.isReady?(n.set(t,r),b++):p||this._addParentTile(t,n);else{if(this._tileCache?.has(t)){if(r=this._tileCache.pop(t),this.tileIndex.set(t,r),r.isReady){n.set(t,r),b++;continue}}else r=this.acquireTile(i),this.tileIndex.set(t,r);p||this._addParentTile(t,n)}}const S=b===_;for(const[e,t]of s){if(n.has(e))continue;i.set(e);const r=this.tileInfoView.intersects(f,i),s="purge"===this.cachePolicy?i.level!==y:i.level>y;!r||!p&&S?!s&&r||o.push(t):t.isReady?s&&"purge"===this.cachePolicy&&this._hasReadyAncestor(i,y)?o.push(t):a.push(t):s&&o.push(t)}for(const e of a)e.isReady&&n.set(e.key.id,e);for(const e of o)this._tileCache?this._tileCache.add(e):this.releaseTile(e),s.delete(e.key.id);for(const e of n.values())this.tiles.push(e);for(const e of s.values())n.has(e.key.id)||(e.visible=!1);this._tileCache?.prune(y,c,u),r.pool.release(f),a.length=0,o.length=0,n.clear()}clear(){const{tileIndex:e}=this;for(const t of e.values())this.releaseTile(t);e.clear()}refresh(e){for(const t of this.tileIndex.values())e(t);this._tileCache?.clear()}updateCacheSize(e){this._tileCache&&(this._tileCache.maxSize=e)}_addParentTile(e,t){let r=e,s=null;for(;r=this.tileInfoView.getTileParentId(r),r;)if(this.tileIndex.has(r)){if(s=this.tileIndex.get(r),s?.isReady){t.has(s.key.id)||t.set(s.key.id,s);break}}else if(this._tileCache?.has(r)&&(s=this._tileCache.pop(r),this.tileIndex.set(r,s),s?.isReady)){t.has(s.key.id)||t.set(s.key.id,s);break}}_hasReadyAncestor(t,r){const s=e.create();this.tileInfoView.getTileBounds(s,t,!0);for(const i of this.tileIndex.values())if(i.isReady&&i.key.level>=r&&i.key.level<t.level){const t=e.create();if(this.tileInfoView.getTileBounds(t,i.key,!0),e.contains(t,s))return!0}return!1}}})},"esri/views/2d/tiling/TileCache":function(){define(["../../../core/libs/gl-matrix-2/math/vec2"],function(e){"use strict";function t(e,t){e.delete(t)}return class{constructor(e,t,r){this.maxSize=e,this._tileInfoView=t,this._removedFunc=r,this._tilePerId=new Map,this._tileKeysPerLevel=[]}clear(){this._tilePerId.clear(),this._tileKeysPerLevel=[]}has(e){return this._tilePerId.has(e)}get(e){return this._tilePerId.get(e)}pop(e){const r=this._tilePerId.get(e);if(!r)return;const s=r.key.level,i=this._tileKeysPerLevel[s];t(this._tilePerId,e);for(let t=0;t<i.length;t++)if(i[t].id===e){i.splice(t,1);break}return r.visible=!0,r}add(e){e.visible=!1;const t=e.key,r=t.id;if(this._tilePerId.has(r))return;this._tilePerId.set(r,e);const s=t.level;this._tileKeysPerLevel[s]||(this._tileKeysPerLevel[s]=[]),this._tileKeysPerLevel[s].push(t)}prune(e,t,r){let s=this._tilePerId.size;if(s<=this.maxSize)return;let i=this._tileKeysPerLevel.length-1;for(;s>this.maxSize&&i>=0;)i!==e&&(s=this._pruneAroundCenterTile(s,t,r,i)),i--;s>this.maxSize&&(s=this._pruneAroundCenterTile(s,t,r,e))}_pruneAroundCenterTile(t,r,s,i){const n=this._tileKeysPerLevel[i];if(!n||0===n.length)return t;const{size:o,origin:a}=this._tileInfoView.tileInfo,l=s*o[0],c=s*o[1],u=[0,0],h=[0,0];for(n.sort((t,s)=>(u[0]=a.x+l*(t.col+.5),u[1]=a.y-c*(t.row+.5),h[0]=a.x+l*(s.col+.5),h[1]=a.y-c*(s.row+.5),e.squaredDistance(u,r)-e.squaredDistance(h,r)));n.length>0;){const e=n.pop();if(this._removeTile(e.id),--t===this.maxSize)break}return t}_removeTile(e){const r=this._tilePerId.get(e);this._removedFunc&&r&&this._removedFunc(r),t(this._tilePerId,e)}}})},"esri/views/2d/engine/webgl/mesh/MeshData":function(){define(["exports","../DisplayEntity","../DisplayRecord","./VertexDataWriter","../util/Writer"],function(e,t,r,s,i){"use strict";e.MeshData=class{constructor(e,r=0){this._id=e,this._sizeHint=r,this._entityRecordCountOffset=0,this._entityCountOffset=0,this._entityIdIndex=0,this._entitySortKeyIndex=0,this._didEntityStart=!1,this._instanceIdToVertexData=new Map,this._recordIndexStart=0,this._recordIndexCount=0,this._recordVertexStart=0,this._recordVertexCount=0,this._current={metric:null,writer:null,start:0,sortKey:0,instanceId:0,layoutHash:0,indexStart:0,vertexStart:0,textureKey:0,metricBoxLenPointer:0},this._entities=new i(Uint32Array,this._sizeHint*t.byteSizeHint),this._entityCountOffset=this._entities.push(0)}get id(){return this._id}serialize(){const e=new Array,t=[],r=this._entities.buffer();for(const r of this._instanceIdToVertexData.values())t.push(r.serialize(e));return{message:{data:t,entities:r},transferList:e}}vertexStart(){return this._current.vertexStart??0}vertexCount(){return this._current.writer?.vertexCount??0}indexCount(){return this._current.writer?.indexCount??0}vertexEnsureSize(e){this._current.writer.vertexEnsureSize(e)}indexEnsureSize(e){this._current.writer.indexEnsureSize(e)}vertexWrite(e){this._current.writer.writeVertex(e)}vertexWriteRegion(e){this._current.writer.writeVertexRegion(e)}vertexWriteF32(e){this._current.writer.writeVertexF32(e)}recordBounds(e,t,r,s){}indexWrite(e){this._current.writer.writeIndex(e)}metricStart(e){this._current.metric=e,this._current.metric.recordStart=this.recordCount()}metricEnd(){const e=this._current.writer;this._current.metric&&(this._current.metric.recordCount=this.recordCount()-this._current.metric.recordStart),this._current.metric?.bounds.length&&this._current.metric?.recordCount?(e.writeMetric(this._current.metric),this._current.metric=null):this._current.metric=null}metricBoxWrite(e){this._current.metric.bounds.push(e)}entityStart(e,t=e){this._entityIdIndex=this._entities.push(e),this._entitySortKeyIndex=this._entities.writeF32(t),this._entityRecordCountOffset=this._entities.push(0),this._didEntityStart=!0}entityRecordCount(){return this._entities.getValue(this._entityRecordCountOffset)}entityEnd(){this._didEntityStart&&(0===this.entityRecordCount()?this._entities.seek(this._entityIdIndex):this._entities.incr(this._entityCountOffset),this._didEntityStart=!1)}recordCount(){return this._entities.getValue(this._entityRecordCountOffset)}recordStart(e,t,r=0){this._current.writer=this._getVertexWriter(e,t),this._current.indexStart=this._current.writer.indexCount,this._current.vertexStart=this._current.writer.vertexCount,this._current.instanceId=e,this._current.layoutHash=t.hash,this._current.textureKey=r}recordEnd(e=0){const t=this._current.vertexStart,s=this._current.writer.vertexCount-t;if(!s)return!1;const i=this._current.indexStart,n=this._current.writer.indexCount-i;return this._recordIndexStart=i,this._recordIndexCount=n,this._recordVertexStart=t,this._recordVertexCount=s,this._entities.incr(this._entityRecordCountOffset),r.write(this._entities,this._current.instanceId,this._current.textureKey,i,n,t,s,e),!0}copyLast(e,t){const s=this._recordVertexStart+this._recordVertexCount;this._entities.incr(this._entityRecordCountOffset),r.write(this._entities,this._current.instanceId,this._current.textureKey,this._recordIndexStart+this._recordIndexCount,this._recordIndexCount,s,this._recordVertexCount,0);const i=this._current.writer.indexWriter,n=this._current.writer.vertexWriter,o=this._recordIndexStart+this._recordIndexCount,a=this._recordVertexCount;for(let e=this._recordIndexStart;e!==o;e++){const t=i.getValue(e);i.push(t+a)}const l=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,c=this._recordVertexStart*l,u=(this._recordVertexStart+this._recordVertexCount)*l;for(let e=c;e!==u;e++){const t=n.getValue(e);n.push(t)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,p=h.offset/Uint32Array.BYTES_PER_ELEMENT,f=e*d,m=t*d;for(let e=s*l;e<=n.length;e+=l)n.i1616Add(e+p,f,m)}copyLastFrom(e,t,r){const s=e._entities.getValue(e._entityIdIndex);if(s!==this._entities.getValue(this._entityIdIndex)){const t=e._entities.getValueF32(e._entitySortKeyIndex);this.entityStart(s,t)}this.recordStart(e._current.instanceId,e._current.writer.layout,e._current.textureKey);const i=this._current.writer.layout.stride/Uint32Array.BYTES_PER_ELEMENT,n=this._current.vertexStart,o=e._current.vertexStart-n,a=this._current.writer.indexWriter,l=this._current.writer.vertexWriter,c=e._current.writer.indexWriter,u=e._current.writer.vertexWriter;for(let t=e._current.indexStart;t!==c.length;t++){const e=c.getValue(t);a.push(e-o)}for(let t=e._current.vertexStart*i;t!==u.length;t++){const e=u.getValue(t);l.push(e)}const h=this._current.writer.layout.position,d=h.packPrecisionFactor??1,p=h.offset/Uint32Array.BYTES_PER_ELEMENT,f=t*d,m=r*d;for(let e=n*i;e<=l.length;e+=i)l.i1616Add(e+p,f,m);this.recordEnd()}_getVertexWriter(e,t){const r=this._instanceIdToVertexData;return r.has(e)||r.set(e,new s.VertexDataWriter(e,t,this._sizeHint)),r.get(e)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayEntity":function(){define(["./DisplayRecord","./util/serializationUtils"],function(e,t){"use strict";class r{static{this.byteSizeHint=2*Uint32Array.BYTES_PER_ELEMENT+e.byteSizeHint}constructor(e,t){this.id=e,this.sortKey=t,this.records=[]}serialize(e){return e.push(this.id),e.writeF32(this.sortKey),t.serializeList(e,this.records),e}static deserialize(s){const i=s.readInt32(),n=s.readF32(),o=new r(i,n);return o.records=t.deserializeList(s,e)??[],o}}return r})},"esri/views/2d/engine/webgl/DisplayRecord":function(){define(function(){"use strict";class e{static{this.byteSizeHint=7*Uint32Array.BYTES_PER_ELEMENT}constructor(e,t,r,s,i,n,o){this.instanceId=e,this.textureKey=t,this.indexStart=r,this.indexCount=s,this.vertexStart=i,this.vertexCount=n,this.overlaps=o}updateBaseOffsets(e){this.vertexStart+=e.vertexFrom,this.indexStart+=e.indexFrom}clone(){return new e(this.instanceId,this.textureKey,this.indexStart,this.indexCount,this.vertexStart,this.vertexCount,this.overlaps)}static write(e,t,r,s,i,n,o,a){e.push(t),e.push(r),e.push(s),e.push(i),e.push(n),e.push(o),e.push(a)}serialize(e){return e.push(this.instanceId),e.push(this.textureKey),e.push(this.indexStart),e.push(this.indexCount),e.push(this.vertexStart),e.push(this.vertexCount),e.push(this.overlaps),e}static deserialize(t){const r=t.readInt32(),s=t.readInt32(),i=t.readInt32(),n=t.readInt32(),o=t.readInt32(),a=t.readInt32(),l=t.readInt32();return new e(r,s,i,n,o,a,l)}}return e})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["exports"],function(e){"use strict";e.deserializeList=function(e,t,r){const s=e.readInt32(),i=new Array(s);for(let s=0;s<i.length;s++)i[s]=t.deserialize(e,r);return i},e.serializeList=function(e,t){if(null!==t){e.push(t.length);for(const r of t)r.serialize(e);return e}e.push(0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/VertexDataWriter":function(){define(["exports","../util/Writer"],function(e,t){"use strict";e.VertexDataWriter=class{constructor(e,r,s=0){const i=6*s*Uint32Array.BYTES_PER_ELEMENT,n=4*s*r.stride,o=r.stride/4,a=r.attributes.find(e=>"pos"===e.name||"position"===e.name);if(!a)throw new Error("InternalError: Unable to find position attribute");this.layout={...r,position:a},this._indices=new t(Uint32Array,i),this._vertices=new t(Uint32Array,n),this._metrics=new t(Uint32Array,0),this._metricCountOffset=this._metrics.push(0),this._strideInt=o,this._instanceId=e}serialize(e){const t=this._indices.buffer(),r=this._vertices.buffer(),s=this._metrics.length?this._metrics.buffer():null;return e.push(t,r),{instanceId:this._instanceId,layout:this.layout,indices:t,vertices:r,metrics:s}}get strideInt(){return this._strideInt}get vertexCount(){return this._vertices.length/this._strideInt}get indexCount(){return this._indices.length}get indexWriter(){return this._indices}get vertexWriter(){return this._vertices}get metricWriter(){return this._metrics}vertexEnsureSize(e){this._vertices.ensureSize(e)}indexEnsureSize(e){this._indices.ensureSize(e)}writeIndex(e){this._indices.push(e)}writeVertex(e){this._vertices.push(e)}writeVertexRegion(e){this._vertices.writeRegion(e)}writeVertexF32(e){this._vertices.writeF32(e)}writeMetric(e){this._metrics.incr(this._metricCountOffset),e.serialize(this._metrics)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Writer":function(){define(function(){"use strict";return class{get length(){return this._pos}constructor(e,t){this._pos=0;const r=t?this._roundToNearest(t,e.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(r),this._buffer=new e(this._array),this._ctor=e,this._i16View=new Int16Array(this._array)}_roundToNearest(e,t){const r=Math.round(e);return 1===t?r:r+(t-r%t)}_ensureSize(e){if(this._pos+e>=this._buffer.length){const t=this._roundToNearest(1.25*(this._array.byteLength+e*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),r=new ArrayBuffer(t),s=new this._ctor(r);s.set(this._buffer,0),this._array=r,this._buffer=s,this._i16View=new Int16Array(this._array)}}ensureSize(e){this._ensureSize(e)}writeF32(e){this._ensureSize(1);const t=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=e,this._pos++,t}push(e){this._ensureSize(1);const t=this._pos;return this._buffer[this._pos++]=e,t}writeFixed(e){this._buffer[this._pos++]=e}setValue(e,t){this._buffer[e]=t}i1616Add(e,t,r){this._i16View[2*e]+=t,this._i16View[2*e+1]+=r}getValue(e){return this._buffer[e]}getValueF32(e){return new Float32Array(this._array,4*e,1)[0]}incr(e){if(this._buffer.length<e)throw new Error("Increment index overflows the target buffer");this._buffer[e]++}decr(e){this._buffer[e]--}writeRegion(e){this._ensureSize(e.length);const t=this._pos;return this._buffer.set(e,this._pos),this._pos+=e.length,t}writeManyFrom(e,t,r){this._ensureSize(r-t);for(let s=t;s!==r;s++)this.writeFixed(e._buffer[s])}buffer(){const e=this._array.slice(0,4*this._pos);return this.destroy(),e}toArray(){return[...this._buffer]}seek(e){this._pos=e}destroy(){this._array=null,this._buffer=null}}})},"esri/views/2d/engine/webgl/mesh/factories/FeatureMeshFactory":function(){define(["exports","./MeshFactory","../../util/createMatcher"],function(e,t,r){"use strict";class s extends t.AMeshFactory{static async create(e,t){const i=await r.createMatcher(e,t.symbology),n=t.labels?await r.createMatcher(e,t.labels):null;return new s(i,n)}constructor(e,t){super(),this._symbology=e,this._labels=t}destroy(){}async enqueueMatcherRequests(e,t){await Promise.all([this._symbology.fetchResources(e,t),this._labels?.fetchResources(e,t)])}enqueueWriterRequests(e,t,r,s){const i=this._symbology.match(t,r,s);if(i){for(const s of i)s.enqueueRequest(e,t,r);if(this._labels){const i=this._labels.match(t,r,s);if(!i)return;for(const s of i)s.enqueueRequest(e,t,r)}}}write(e,t,r,s,i,n){const o=this._symbology.match(r,s,i);if(o){for(const i of o)i.write(e,t,r,s,n);if(e.entityRecordCount()>=1&&this._labels){const a=this._labels.match(r,s,i);if(!a)return;for(const i of a)i.setReferences(o),i.write(e,t,r,s,n)}}}getSortKey(e,t){return this._symbology.getSortKey(e,t)}hasArcadeDependency(e){return!(!this._symbology.hasArcadeDependency(e)&&!this._labels?.hasArcadeDependency(e))}}e.FeatureMeshFactory=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/MeshFactory":function(){define(["exports"],function(e){"use strict";e.AMeshFactory=class{},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/createMatcher":function(){define(["exports","../../../../../layers/support/streamLayerUtils","./DictionaryMatcher","./IntervalMatcher","./LabelMatcher","./MapMatcher","./Matcher"],function(e,t,r,s,i,n,o){"use strict";async function a(e,t){switch(t.type){case"simple":case"heatmap":case"dot-density":case"pie-chart":return o.FeatureMatcher.from(e,t);case"interval":return s.IntervalMatcher.fromIntervalSchema(e,t);case"dictionary":return r.DictionaryMatcher.fromDictionaryRenderer(e,t);case"label":return i.LabelMatcher.fromLabelSchema(e,t);case"map":return n.MapMatcher.fromMatcherSchema(e,t);case"subtype":return l.fromSubtypes(e,t);case"cluster":return c.fromClusterSchema(e,t);case"track":return u.fromTrackSchema(e,t);default:throw new Error("Impl")}}class l extends o.FeatureMatcher{constructor(e,t){super(),this._subMatchers=e,this._subtypeField=t}static async fromSubtypes(e,t){const r=new Map,s=[];for(const i in t.renderers){const n=parseInt(i,10),o=a(e,t.renderers[i]).then(e=>r.set(n,e));s.push(o)}return await Promise.all(s),new l(r,t.subtypeField)}match(e,t,r){const s=e.readAttribute(this._subtypeField),i=this._subMatchers.get(s);return i?i.match(e,t,r):null}hasArcadeDependency(e){for(const t of this._subMatchers.values())if(t.hasArcadeDependency(e))return!0;return!1}}class c extends o.FeatureMatcher{static async fromClusterSchema(e,t){const[r,s]=await Promise.all([a(e,t.feature),a(e,t.cluster)]);return new c(r,s)}constructor(e,t){super(),this._featureMatcher=e,this._clusterMatcher=t}match(e,t,r){return 1===e.readAttribute("cluster_count")?this._featureMatcher.match(e,t,r):this._clusterMatcher.match(e,t,r)}hasArcadeDependency(e){return this._featureMatcher.hasArcadeDependency(e)||this._clusterMatcher.hasArcadeDependency(e)}}class u extends o.FeatureMatcher{static async fromTrackSchema(e,t){const[r,s,i]=await Promise.all([a(e,t.previousObservation),a(e,t.latestObservation),a(e,t.trackLine)]);return new u(r,s,i)}constructor(e,t,r){super(),this._previousObservationMatcher=e,this._latestObservationMatcher=t,this._trackLineMatcher=r}match(e,r,s){switch(e.readAttribute(t.internalTrackPartField)){case 0:return this._trackLineMatcher.match(e,r,s);case 1:return this._latestObservationMatcher.match(e,r,s);case 2:return this._previousObservationMatcher.match(e,r,s)}return null}hasArcadeDependency(e){return this._trackLineMatcher.hasArcadeDependency(e)||this._latestObservationMatcher.hasArcadeDependency(e)||this._previousObservationMatcher.hasArcadeDependency(e)}}e.ClusterMatcher=c,e.SubtypeMatcher=l,e.createMatcher=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/streamLayerUtils":function(){define(["exports"],function(e){"use strict";e.defaultStreamIdField="__esri_stream_id__",e.esriTimestamp="__esri_timestamp__",e.externalTrackLineOidPrefix="__esri_track_line__",e.internalTimeReceivedField="__esri_time_received__",e.internalTrackPartField="__esri_track_part__",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/DictionaryMatcher":function(){define(["exports","../../../../../renderers/support/DictionaryScriptEvaluator","./Matcher"],function(e,t,r){"use strict";class s extends r.FeatureMatcher{static async fromDictionaryRenderer(e,r){const i=await t.DictionaryScriptEvaluator.from(r.dictionaryInfo,r.userConfig,r.fieldMap);return new s(e,i)}constructor(e,t){super(),this._context=e,this._evaluator=t,this._controlStringToPromise=new Map,this._controlStringToGroup=new Map}async fetchResources(e,t){const r=t.getCursor(),s=new Set;for(;r.next();){const e=this._evaluateControlString(r);e&&s.add(e)}const i=Array.from(s.values()).map(t=>this._ensureGroup(e,t));await Promise.all(i)}match(e,t){const r=this._evaluateControlString(e);return r?this._controlStringToGroup.get(r):null}_evaluateControlString(e){const t=e.readLegacyFeatureWorldSpace();return this._evaluator.evaluate(t,0,e.fields,null)}_ensureGroup(e,t){let r=this._controlStringToPromise.get(t);return null==r&&(r=this._fetchGroup(e,t),this._controlStringToPromise.set(t,r)),r}async _fetchGroup(e,t){const r=await e.fetchDictionaryResourceImmediate({type:"dictionary-request",controlString:t});if(!r)return;const s=await this._context.createMeshWriters(r.meshes);this._controlStringToGroup.set(t,s)}}e.DictionaryMatcher=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/DictionaryScriptEvaluator":function(){define(["exports","../../core/Error","../../core/Logger","../../core/Version","../../layers/support/FieldsIndex","../../support/ArcadeExpression"],function(e,t,r,s,i,n){"use strict";class o{static async from(e,i,l){const c=e.dictionary_version?s.Version.parse(e.dictionary_version):null,u=new Set(e.itemsNames),h={};if(i)for(const e in i)h[e]=i[e];if(e.authoringInfo.configuration)for(const t of e.authoringInfo.configuration)h.hasOwnProperty(t.name)||(h[t.name]=t.value);const d=new Set(e.authoringInfo.symbol);for(const e of Object.keys(l))d.delete(e);d.size&&r.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("missing-fields: fieldMap entries for the following symbol fields are missing",{symbolFields:d});const p=await n.createDictionaryExpression(e.expression,null,h);if(!p)throw new t("dictionary-renderer:expression-error","Unable to create dictionary renderer expression");const f=!c||!c.greaterEqual(4,0);f&&r.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("Dictionary script does not support native field types. Applying fallback",{version:c});const m=new a(l,f);return new o(f,u,p,m)}constructor(e,t,r,s){this._requiresFieldCoercionToString=e,this._itemNames=t,this._compiled=r,this._reader=s}get itemNames(){return this._itemNames}evaluate(e,t,s,i){try{return this._reader.bind(e,s,i),this._compiled.evaluate(this._reader,{$view:{scale:t}})}catch(e){r.getLogger("esri.renderers.support.DictionaryScriptEvaluator").warnOnce("arcade: dictionary script evaluation failed",{error:e})}return null}createDictionaryFieldsIndex(e){if(!this._requiresFieldCoercionToString)return new i(e);const t=e.map(e=>({...e,type:"esriFieldTypeString"}));return new i(t)}}class a extends n.ArcadeFeatureReader{constructor(e,t){super(),this._fieldMap=e,this._requiresFieldCoercionToString=t}_getField(e){const t=this._fieldMap[e]??e;return this._boundSchema.fieldsIndex.get(t)}field(e){if(!this._requiresFieldCoercionToString)return super.field(e,!1);const t=this._getField(e);return null==t||null==this._boundTarget.attributes[t.name]?"":""+this._boundTarget.attributes[t.name]}}e.DictionaryScriptEvaluator=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/Version":function(){define(["exports","./Error"],function(e,t){"use strict";e.Version=class e{constructor(e,t,r=""){this.major=e,this.minor=t,this._context=r}lessThan(e,t){return this.major<e||e===this.major&&this.minor<t}greaterEqual(e,t){return!this.lessThan(e,t)}validate(e){if(this.major!==e.major){const r=this._context&&this._context+":",s=this._context&&this._context+" ";throw new t(r+"unsupported-version",`Required major ${s}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e})}}clone(){return new e(this.major,this.minor,this._context)}static parse(r,s=""){const[i,n]=r.split("."),o=/^\s*\d+\s*$/;if(!i?.match||!o.test(i))throw new t((s&&s+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:r});if(!n?.match||!o.test(n))throw new t((s&&s+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:r});const a=parseInt(i,10),l=parseInt(n,10);return new e(a,l,s)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FieldsIndex":function(){define(["../../core/Error","../../core/Logger","../../core/MapUtils","../../core/sql/UnknownTimeZone","../../core/support/jsonUtils","./fieldUtils","../../time/constants","../../time/timeZoneUtils","../../chunks/datetime"],function(e,t,r,s,i,n,o,a,l){"use strict";const c=new Map;class u{static fromJSON(e){return new u(e.fields,e.timeZoneByFieldName)}static fromLayer(e){return new u(e.fields??[],f(e))}static fromLayerJSON(e){return new u(e.fields??[],f(e))}constructor(e=[],t){this._fieldsMap=new Map,this._normalizedFieldsMap=new Map,this._dateFieldsSet=new Set,this._numericFieldsSet=new Set,this._requiredFields=null,this.dateFields=[],this.numericFields=[],this.fields=e||[],this._timeZoneByFieldName=t?new Map(t):null;const r=[];for(const e of this.fields){const t=e?.name,s=d(t);if(t&&s){const i=h(t);this._fieldsMap.set(t,e),this._fieldsMap.set(i,e),this._normalizedFieldsMap.set(s,e),r.push(`${i}:${e.type}:${this._timeZoneByFieldName?.get(t)}`),n.isDateField(e)?(this.dateFields.push(e),this._dateFieldsSet.add(e)):n.isNumericField(e)&&(this._numericFieldsSet.add(e),this.numericFields.push(e)),n.isObjectIDField(e)||n.isGlobalIDField(e)||(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable)}}r.sort(),this.uid=r.join()}get requiredFields(){if(!this._requiredFields){this._requiredFields=[];for(const e of this.fields)n.isObjectIDField(e)||n.isGlobalIDField(e)||e.nullable||void 0!==n.getFieldDefaultValue(e)||this._requiredFields.push(e)}return this._requiredFields}equals(e){return this.uid===e?.uid}has(e){return null!=this.get(e)}get(e){if(!e)return;let t=this._fieldsMap.get(e);return t||(t=this._fieldsMap.get(h(e))??this._normalizedFieldsMap.get(d(e)),t&&this._fieldsMap.set(e,t),t)}getTimeZone(r){const s=this.get(r&&"string"!=typeof r?r.name:r);return s?this._timeZoneByFieldName?this._timeZoneByFieldName.get(s.name):"date"===s.type||"esriFieldTypeDate"===s.type?(t.getLogger("esri.layers.support.FieldsIndex").errorOnce(new e("getTimeZone:no-timezone-information",`no time zone information for field '${s.name}'`)),o.utc):p.has(s.type)?o.unknown:null:null}getLuxonTimeZone(e){const t=this.getTimeZone(e);return t?t===o.unknown?s.UnknownTimeZone.instance:t===o.utc?l.FixedOffsetZone.utcInstance:r.getOrCreateMapValue(c,t,()=>l.IANAZone.create(t)):null}isDateField(e){return this._dateFieldsSet.has(this.get(e))}isTimeOnlyField(e){return n.isTimeOnlyField(this.get(e))}isNumericField(e){return this._numericFieldsSet.has(this.get(e))}normalizeFieldName(e){return this.get(e)?.name??void 0}toJSON(){return{fields:this.fields.map(e=>i.isSerializable(e)?e.toJSON():e),timeZoneByFieldName:this._timeZoneByFieldName?Array.from(this._timeZoneByFieldName.entries()):null}}}function h(e){return e.trim().toLowerCase()}function d(e){return n.normalizeFieldName(e)?.toLowerCase()??""}const p=new Set(["time-only","date-only","timestamp-offset","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]);function f(e){const t=new Map;if(!e.fields)return t;const r=!0===e.datesInUnknownTimezone,{timeInfo:s,editFieldsInfo:i}=e,n=(s?"startField"in s?s.startField:s.startTimeField:"")??"",l=(s?"endField"in s?s.endField:s.endTimeField:"")??"",c="dateFieldsTimeZone"in e?e.dateFieldsTimeZone??null:e.dateFieldsTimeReference?a.fromTimeReference(e.dateFieldsTimeReference):null,u=i?"timeZone"in i?i.timeZone??c:i.dateFieldsTimeReference?a.fromTimeReference(i.dateFieldsTimeReference):c??o.utc:null,d=s?"timeZone"in s?s.timeZone??c:s.timeReference?a.fromTimeReference(s.timeReference):c:null,f=new Map([[h(i?.creationDateField??""),u],[h(i?.editDateField??""),u],[h(n),d],[h(l),d]]);for(const{name:s,type:i}of e.fields)if(p.has(i))t.set(s,o.unknown);else if("date"!==i&&"esriFieldTypeDate"!==i)t.set(s,null);else if(r)t.set(s,o.unknown);else{const e=f.get(h(s??""))??c;t.set(s,e)}return t}return u})},"esri/support/ArcadeExpression":function(){define(["exports","../arcade/ArcadeDate","../core/Error","../core/has","../core/sql/DateOnly","../core/sql/TimeOnly","../geometry/support/jsonUtils","../layers/support/FieldsIndex","./loadArcade","../time/constants"],function(e,t,r,s,i,n,o,a,l,c){"use strict";const u=["geometry","scale","timeProperties"];class h{static async create(e,t,s,i){const{arcade:n,Dictionary:o}=await l.loadArcade();let a;try{a=n.parseScript(e)}catch(t){throw new r("arcade-bad-expression","Failed to parse arcade script",{script:e,error:t})}const c=n.scriptUsesGeometryEngine(a);c&&await n.enableGeometrySupport(),await n.loadDependentModules(new Set,a,null,!1,c);const u={vars:i.reduce((e,t)=>({...e,[t]:null}),{}),spatialReference:t,useAsync:!1},d=n.compileScript(a,u);let p=null;null!=s&&(p=new o(s),p.immutable=!0);const f=new o;return f.immutable=!1,f.setField("scale",0),new h(e,n,a,d,t,f,p,o)}constructor(e,t,r,s,i,n,o,a){this.script=e,this._arcade=t,this._syntaxTree=r,this._compiled=s,this._spatialReference=i,this._viewDict=n,this._configDict=o,this._dictionaryCtor=a,this._dependencies=new Map,this._featureReader=new d,this._dependencies.set("geometry",t.scriptTouchesGeometry(this._syntaxTree)),this._dependencies.set("scale",this._arcade.referencesMember(this._syntaxTree,"scale")),this._dependencies.set("timeProperties",this._arcade.scriptUsesViewProperties(this._syntaxTree,["timeProperties"]))}evaluate(e,r){const s=r.$view?.timeZone;if(r.$view){let e;if(this._viewDict.setField("scale",r.$view.scale),null!=r.$view.timeProperties){const{currentStart:i,currentEnd:n}=r.$view.timeProperties;e=new this._dictionaryCtor({currentStart:null!=i?null!=s?t.ArcadeDate.epochToArcadeDate(i,s):t.ArcadeDate.unknownEpochToArcadeDate(i):void 0,currentEnd:null!=n?null!=s?t.ArcadeDate.epochToArcadeDate(n,s):t.ArcadeDate.unknownEpochToArcadeDate(n):void 0,startIncluded:!0,endIncluded:!0})}this._viewDict.setField("timeProperties",e)}return this._compiled({vars:{$view:this._viewDict,$config:this._configDict,$feature:e},spatialReference:this._spatialReference,timeZone:s})}repurposeFeature(e,t){return this._featureReader.bind(e,t,this._spatialReference),this._featureReader}references(e){return this._dependencies.get(e)??!1}}class d{constructor(){this._boundTarget=null,this._boundSchema={fields:null,fieldsIndex:null,spatialReference:null,get geometryType(){return null},get objectIdField(){return null}},this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}bind(e,t,r){const s=t??new a(p(e.attributes));this._boundTarget=e,this._boundSchema.fields=s.fields,this._boundSchema.fieldsIndex=s,this._boundSchema.spatialReference=r}_getField(e){return this._boundSchema.fieldsIndex.get(e)}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(e){this._contextTimeZone=e}readArcadeFeature(){return this}hasField(e){return this._boundSchema.fieldsIndex.has(e)}geometry(){if("fromJSON"in this._boundTarget)return this._boundTarget.geometry;const e=o.fromJSON(this._boundTarget.geometry);if(e){if(!this._boundSchema.spatialReference)throw new Error("InternalError: Expected spatial reference to be defined");e.spatialReference=this._boundSchema.spatialReference}return e}isUnknownDateTimeField(e){return this._boundSchema.fieldsIndex.getTimeZone(e)===c.unknown}field(e,r=!0){const s=this._getField(e);if(s){const r=this._boundTarget.attributes[s.name];if(null==r)return null;switch(s.type){case"date-only":case"esriFieldTypeDateOnly":return i.DateOnly.fromReader(r);case"time-only":case"esriFieldTypeTimeOnly":return n.TimeOnly.fromReader(r);case"esriFieldTypeTimestampOffset":case"timestamp-offset":return t.ArcadeDate.fromReaderAsTimeStampOffset(r);case"date":case"esriFieldTypeDate":return this.isUnknownDateTimeField(e)?t.ArcadeDate.unknownEpochToArcadeDate(r):t.ArcadeDate.epochToArcadeDate(r,this.contextTimeZone??c.system);default:return r}}if(r)throw new Error(`Field ${e} does not exist`);return null}setField(e,t){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this._boundSchema.fieldsIndex.fields.map(e=>e.name)}castToText(e=!1){return JSON.stringify(this._boundTarget)}gdbVersion(){return null}fullSchema(){return this._boundSchema}castAsJson(e=null){return{attributes:this._boundTarget.attributes,geometry:!0===e?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(e=null,t=null){return Promise.resolve(this.castAsJson(t))}}function p(e){const t=[];for(const r in e)t.push({name:r,alias:r,type:"string"==typeof e[r]?"esriFieldTypeString":"esriFieldTypeDouble"});return t}e.ArcadeExpression=h,e.ArcadeFeatureReader=d,e.collectExpressionDependencies=function(e,t){if(null!=t)for(const r of u)t.hasArcadeDependency(r)&&e.add(r);return e},e.createDictionaryExpression=function(e,t,r){return h.create(e,t,r,["$feature","$view","$config"])},e.createLabelExpression=function(e,t){return h.create(e,t,null,["$feature","$view"])},e.createRendererExpression=function(e,t){return h.create(e,t,null,["$feature","$view"])},e.deriveFields=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/Matcher":function(){define(["exports"],function(e){"use strict";class t{constructor(){this._defaultResult=null,this._backgroundFillResult=null}static async from(e,r){const s=new t;return s.setDefault(await e.createMeshWriters(r.meshes)),s}size(){return 1}getDefault(){return this._defaultResult}setDefault(e){this._defaultResult=e}getBackgroundFill(){return this._backgroundFillResult}setBackgroundFill(e){this._backgroundFillResult=e}hasArcadeDependency(e){return this._defaultResult?.some(t=>t.hasArcadeDependency(e))??!1}match(e,t,r){const s=this.doMatch(e,t)||this.getDefault();if(s&&s.length>0){const e=this.getBackgroundFill();if(e)return[...e,...s]}return s}getSortKey(e,t){return 0}doMatch(e,t){return null}async fetchResources(e,t){}}e.FeatureMatcher=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/IntervalMatcher":function(){define(["exports","./Matcher"],function(e,t){"use strict";class r extends t.FeatureMatcher{constructor(e,t){super(),this._intervals=[],this._isMaxInclusive=t,this._field=e}static async fromIntervalSchema(e,t){const s=await e.storage.createComputedField(t),i=new r(s,t.isMaxInclusive);await Promise.all(t.intervals.map(async t=>{const r=await e.createMeshWriters(t.meshes);i.add(t,r)}));const n=await e.createMeshWriters(t.defaultSymbol);i.setDefault(n);const o=await e.createMeshWriters(t.backgroundFill);return i.setBackgroundFill(o),i}add(e,t){this._intervals.push({interval:e,result:t}),this._intervals.sort((e,t)=>e.interval.min-t.interval.min)}size(){return super.size()+this._intervals.length}hasArcadeDependency(e){return this._field?.hasArcadeDependency(e)||this._intervals.some(t=>t.result.some(t=>t.hasArcadeDependency(e)))}doMatch(e,t){const r=this._field?.read(e,t);if(null==r||isNaN(r)||r===1/0||r===-1/0)return null;for(let e=0;e<this._intervals.length;e++){const{interval:t,result:s}=this._intervals[e],i=r>=t.min,n=this._isMaxInclusive?r<=t.max:r<t.max;if(i&&n)return s}return null}}e.IntervalMatcher=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/LabelMatcher":function(){define(["exports","./Matcher"],function(e,t){"use strict";class r extends t.FeatureMatcher{static async fromLabelSchema(e,t){const s=t.classes.map(async t=>{const r=await e.createMeshWriters(t.meshes);return{minScale:t.minScale,maxScale:t.maxScale,meshes:r,expression:null,where:await e.storage.createWhereClause(t.where)}}),i=await Promise.all(s);return new r(i)}constructor(e){super(),this._labels=e}match(e,t,r){if(!this._labels.length)return null;const s=this._getLabels(t.$view.scale),i=[];for(const t of s)t.where&&!t.where(e,r)||i.push(...t.meshes);return i}hasArcadeDependency(e){return this._labels.some(t=>t.meshes.some(t=>t.hasArcadeDependency(e)))}_getLabels(e){return this._labels.filter(t=>this._validForTileScale(t,e))}_validForTileScale(e,t){const r=t-t/4,s=t+t/2;return(!e.minScale||e.minScale>=r)&&(!e.maxScale||e.maxScale<=s)}}e.LabelMatcher=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/MapMatcher":function(){define(["exports","./Matcher"],function(e,t){"use strict";class r extends t.FeatureMatcher{constructor(e,t){super(),this._defaultSymbolSortKey=0,this._nullResult=null,this._resultsMap=new Map,this._fields=[],this._fields=e,this._separator=t||""}static async fromMatcherSchema(e,t){const s=t.expression?[e.storage.createComputedField({expression:t.expression})]:[t.field?e.storage.createComputedField({field:t.field}):null,t.field2?e.storage.createComputedField({field:t.field2}):null,t.field3?e.storage.createComputedField({field:t.field3}):null],i=(await Promise.all(s)).filter(e=>!!e),n=new r(i,t.fieldDelimiter),o=await e.createMeshWriters(t.defaultSymbol);n.setDefault(o);const a=await e.createMeshWriters(t.backgroundFill);return n.setBackgroundFill(a),await Promise.all(t.map.map(async(t,r)=>{const s=await e.createMeshWriters(t.symbol);"<Null>"===t.value?n.setNullResult(s):n.add(t.value,s,r+1)})),n}setNullResult(e){this._nullResult=e}getSortKey(e,t){const r=this._getValueFromFields(e,t);if(null==r||""===r||"<Null>"===r)return 0;const s=this._resultsMap.get(r.toString());return s?s.sortKey:this._defaultSymbolSortKey}add(e,t,r){this._resultsMap.set(e.toString(),{meshWriters:t,sortKey:r}),this._defaultSymbolSortKey=Math.max(this._defaultSymbolSortKey,r+1)}size(){return super.size()+this._resultsMap.size}hasArcadeDependency(e){return this._fields.some(t=>t.hasArcadeDependency(e))||[...this._resultsMap.values()].some(t=>t.meshWriters.some(t=>t.hasArcadeDependency(e)))||this._nullResult?.some(t=>t.hasArcadeDependency(e))||!1}doMatch(e,t){const r=this._getValueFromFields(e,t);if(null!==this._nullResult&&(null==r||""===r||"<Null>"===r))return this._nullResult;if(null==r)return null;const s=r.toString();return this._resultsMap.get(s)?.meshWriters}_getValueFromFields(e,t){const r=[];for(const s of this._fields){const i=s.read(e,t);null==i||""===i?r.push("<Null>"):r.push(i)}return r.join(this._separator)}}e.MapMatcher=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/factories/ResourceProxy":function(){define(["exports","../../../../../../core/string","../../urlUtils","../../shaderGraph/techniques/mesh/AResourceProxy"],function(e,t,r,s){"use strict";class i extends s.AResourceProxy{constructor(e){super(),this._fetcher=e,this._controller=new AbortController,this._pendingIds=new Set,this._pendingRequests=[],this._resourceIdToResource=new Map}destroy(){this._controller.abort()}get _abortOptions(){return{signal:this._controller.signal}}enqueueRequest(e){const s=r.discardUrlIfHasUrlHash(e.resource),i=t.numericHash(JSON.stringify(s));return this._pendingIds.has(i)||(this._pendingIds.add(i),this._pendingRequests.push({...e,resourceId:i})),i}async fetchEnqueuedResources(){const e=this._pendingRequests;if(this._pendingIds.clear(),this._pendingRequests=[],0===e.length)return;const t=await this._fetcher.fetch(e,this._abortOptions);for(let r=0;r<t.length;r++){const s=e[r].resourceId;this._resourceIdToResource.set(s,t[r])}}async fetchResourceImmediate(e){const t=await this._fetcher.fetch([e]);if(1!==t.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch resources");return t[0]}async fetchDictionaryResourceImmediate(e){const t=await this._fetcher.fetchDictionary([e]);if(1!==t.length)throw new Error("FeaturePipelineResourceProxy: failed to fetch dictionary resources");return t[0]}getResource(e){return this._resourceIdToResource.get(e)}}e.ResourceProxy=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/urlUtils":function(){define(["exports"],function(e){"use strict";e.discardUrlIfHasUrlHash=function(e){return"url"in e&&"urlHash"in e?{...e,url:""}:e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AResourceProxy":function(){define(["exports"],function(e){"use strict";e.AResourceProxy=class{},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterRegistry":function(){define(["exports","../animated/AnimatedMarkerMeshWriter","../animated/AnimatedPolyMeshWriters","../dotDensity/DotDensityMeshWriter","../fill/ComplexFillMeshWriter","../fill/ComplexOutlineFillMeshWriter","../fill/FillMeshWriter","../fill/GradientFillMeshWriter","../fill/OutlineFillMeshWriter","../fill/PatternFillMeshWriter","../fill/PatternOutlineFillMeshWriter","../heatmap/HeatmapMeshWriter","../labels/LabelMeshWriter","../line/GradientStrokeMeshWriter","../line/LineMeshWriter","../line/TexturedLineMeshWriter","../markers/MarkerMeshWriter","./MeshWriterInputEvaluator","../pieChart/PieChartMeshWriter","../text/TextMeshWriter"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_,b){"use strict";e.MeshWriterRegistry=class{async createMeshWriter(e,t,r,s,i){const n=this._getMeshWriter(s.techniqueType),o=await y.MeshWriterInputEvaluator.create(e,t,s.inputParams,i),a=new n(s.id,o,s.optionalAttributes,r);return await a.loadDependencies(),a}_getMeshWriter(e){switch(e){case 9:return o.FillMeshWriter;case 8:return s.DotDensityMeshWriter;case 6:return i.ComplexFillMeshWriter;case 21:return c.PatternFillMeshWriter;case 10:return a.GradientFillMeshWriter;case 19:return l.OutlineFillMeshWriter;case 22:return u.PatternOutlineFillMeshWriter;case 7:return n.ComplexOutlineFillMeshWriter;case 17:return g.MarkerMeshWriter;case 23:return _.PieChartMeshWriter;case 25:return b.TextMeshWriter;case 15:return f.LineMeshWriter;case 26:return m.TexturedLineMeshWriter;case 11:return p.GradientStrokeMeshWriter;case 13:return h.HeatmapMeshWriter;case 14:return d.LabelMeshWriter;case 2:return t.AnimatedMarkerMeshWriter;case 3:return t.AnimatedMarkerShiftMeshWriter;case 0:return r.AnimatedFillMeshWriter;case 1:return r.AnimatedLineMeshWriter;default:throw new Error("Internal Error: Mesh writer not in the registry")}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMarkerMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/constants","../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper","../../../definitions","./AnimatedMeshWriter","./attributes","./ComputedAnimatedParams","../shaders/constants"],function(e,t,r,s,i,n,o,a,l,c){"use strict";class u extends o.AAnimatedMeshWriter{get vertexSpec(){return{createComputedParams:l.createComputedAnimatedMeshParams,optionalAttributes:{zoomRange:a.zoomRange,value1Position2Value2:a.value1Position2Value2,lineLength:a.lineLength},attributes:{id:a.id,bitset:a.bitset,pos:a.pos,offset:a.offset.marker,uv:a.uv.marker,animationPointerAndBaseSizeAndReferenceSize:a.animationPointerAndBaseSizeAndReferenceSize,sizing:a.sizing,angle:a.angle}}}_write(e,t){const r=this.evaluatedMeshParams.sprite,{textureBinding:s}=r;e.recordStart(this.instanceId,this.attributeLayout,s);const i=t.getDisplayId();if(this.shift&&"esriGeometryPolyline"===t.geometryType)this._writeParticles(e,t);else if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(e,t);else if("esriGeometryPolygon"===t.geometryType){const r=t.readCentroidForDisplay();if(!r)return;const[s,n]=r.coords;this._writeQuad(e,i,s,n)}else if("esriGeometryPoint"===t.geometryType){const r=t.readXForDisplay(),s=t.readYForDisplay();this._writeQuad(e,i,r,s)}else{const r=t.readGeometryForDisplay();r&&r.forEachVertex((t,r)=>{this._writeQuad(e,i,t,r)})}e.recordEnd()}_writePlacedMarkers(e,n){const o=r.GeometryCursor.fromFeatureSetReaderCIM(n)?.clone();if(!o)return;const a=i.CIMMarkerPlacementHelper.getPlacement(o,-1,this.evaluatedMeshParams.placement,t.pt2px(1),e.id);if(!a)return;const l=n.getDisplayId();let c=a.next(),u=null;for(;null!=c;){const t=c.tx,r=-c.ty;if(Math.abs(t)>s.maxTileCoordValue||Math.abs(r)>s.maxTileCoordValue){c=a.next();continue}const i=-c.getAngle();e.recordBounds(t,r,64,64),this.shift?u&&this._writeQuad(e,l,u[0],u[1],void 0,i):this._writeQuad(e,l,t,r,void 0,i),u=[t,r],c=a.next()}}_writeParticles(e,t){const r=t.getDisplayId(),s=t.readGeometryForDisplay();if(!s)return;const i=[];s.forEachVertex((e,t)=>{i.push([e,t])});const n=function(e){const t=[];let r=0;for(let s=1;s<e.length;s++){const i=e[s-1],n=e[s],o=n[0]-i[0],a=n[1]-i[1],l=Math.sqrt(o*o+a*a),c=o/l,u=a/l;t.push({a:{position:i,distance:r,direction:[c,u]},b:{position:n,distance:r+l,direction:[c,u]}}),r+=l}return t}(i);let o=0;for(let e=1;e<i.length;e++){const t=i[e][0]-i[e-1][0],r=i[e][1]-i[e-1][1],s=Math.sqrt(t*t+r*r);o+=s}const a=t=>{for(const s of n){const{a:i,b:n}=s;this._writeQuad(e,r,i.position[0],i.position[1],[i.distance-t,n.position[0],n.position[1],n.distance-t],this.evaluatedMeshParams.angleToLine?Math.atan2(i.direction[1],i.direction[0]):0,o,!0)}},{placement:l}=this.evaluatedMeshParams;if(!l||"placementTemplate"in l||"CIMMarkerPlacementOnVertices"===l.type){let e;if(l&&"CIMMarkerPlacementOnVertices"!==l.type)e=l.placementTemplate;else{e=[0];for(const t of n){const{a:r,b:s}=t,i=r.position[0]-s.position[0],n=r.position[1]-s.position[1],o=Math.sqrt(i*i+n*n);e.push(o)}}let t=-1*o;for(;t<2*o;)for(const r of e)t+=r,a(t)}else"CIMMarkerPlacementAtExtremities"===l.type?"JustBegin"===l.extremityPlacement?a(1):"JustEnd"===l.extremityPlacement?(a(o-1),a(-1)):"Both"===l.extremityPlacement&&(a(1),a(o-1)):"CIMMarkerPlacementOnLine"===l.type&&a(o/2)}_writeQuad(e,t,r,s,i,o=0,a=0,l=!1){const u=this.evaluatedMeshParams.sprite,{rect:h}=u,d=h.x+n.spritePadding,p=h.y+n.spritePadding,f=h.x+h.width-n.spritePadding,m=h.y+h.height-n.spritePadding,g=e.vertexCount();l||e.recordBounds(r,s,64,64);const y={texXmin:d,texYmin:p,texXmax:f,texYmax:m,value1Position2Value2:i,angle:o/c.c256ToRad,lineLength:a};for(let i=0;i<4;i++)this._writeVertex(e,t,r,s,y);e.indexEnsureSize(6),e.indexWrite(g),e.indexWrite(g+1),e.indexWrite(g+2),e.indexWrite(g+1),e.indexWrite(g+3),e.indexWrite(g+2)}}e.AnimatedMarkerMeshWriter=class extends u{constructor(){super(...arguments),this.shift=!1}},e.AnimatedMarkerShiftMeshWriter=class extends u{constructor(){super(...arguments),this.shift=!0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/GeometryCursor":function(){define(["exports","../core/lang","./geometryCursorCollectUtils","./support/jsonUtils","../layers/graphics/OptimizedGeometry"],function(e,t,r,s,i){"use strict";class n{static fromOptimized(e,t,r=!1,s=!1,i=1){return(new o).initialize(e,t,r,s,i)}static fromJSON(e,t=!1,r=!1){const[s,i]=l(e);return(new c).initialize(s,i,t,r,1)}static fromOptimizedCIM(e,t,r=!1,s=!1,i=1){return(new u).initialize(e,t,r,s,i)}static fromJSONCIM(e,t=!1,r=!1,s=1){const[i,n]=l(e);return(new h).initialize(i,n,t,r,s)}static fromFeatureSetReader(e){const t=e.readGeometryForDisplay(),r=e.geometryType;return t&&r?this.fromOptimized(t,r):null}static fromFeatureSetReaderCIM(e){const t=e.readGeometryForDisplay(),r=e.geometryType;return t&&r?this.fromOptimizedCIM(t,r):null}static createEmptyOptimized(e,t=!1,r=!1,s=1){return(new o).initialize(new i,e,t,r,s)}static createEmptyJSON(e,t=!1,r=!1){return(new c).initialize([],e,t,r,1)}static createEmptyOptimizedCIM(e,t=!1,r=!1,s=1){return(new u).initialize(new i,e,t,r,s)}static createEmptyJSONCIM(e,t=!1,r=!1,s=1){return(new h).initialize([],e,t,r,s)}asJSON(){const e=r.collectMultipath(this);return"esriGeometryEnvelope"===this.geometryType?{xmin:e[0][0][0],ymin:e[0][0][1],xmax:e[0][2][0],ymax:e[0][2][1]}:"esriGeometryMultipoint"===this.geometryType?{points:e.flat()}:"esriGeometryPoint"===this.geometryType?{x:e[0][0][0],y:e[0][0][1]}:"esriGeometryPolygon"===this.geometryType?{rings:e}:{paths:e}}getCurrentRingArea(){if(this.pathSize<3)return 0;let e,t,r=0;if(this.seekPathStart(),!this.nextPoint())return 0;e=this.x,t=this.y;const s=e,i=t;for(;this.nextPoint();)r+=(e-this.x)*(t+this.y),e=this.x,t=this.y;return r+=(e-s)*(t+i),-.5*r}invertY(){this.yFactor*=-1}}class o extends n{constructor(){super(...arguments),this._end=-1}initialize(e,t,r,s,i){return this.hasZ=r,this.hasM=s,this.geometryType=t,this._stride=2+Number(r)+Number(s),this._geometry=e,this._pathIndex=-1,this._pathOffset=0,this._pointOffset=-this._stride,this._end=-1,this.yFactor=i,this}reset(){this.initialize(this._geometry,this.geometryType,this.hasZ,this.hasM,this.yFactor)}seekPath(e){if(e>=0&&e<this.totalSize){if(this._pathIndex<e)for(;this._pathIndex<e&&this.nextPath(););else if(this._pathIndex>e)for(;this._pathIndex>e&&this.prevPath(););return!0}return!1}seekPathStart(){this._pointOffset=this._pathOffset-this._stride}seekPathEnd(){this._pointOffset=this._end}seekInPath(e){const t=this._pathOffset+e*this._stride;return t>=0&&t<this._end&&(this._pointOffset=t,!0)}nextPoint(){return(this._pointOffset+=this._stride)<this._end}prevPoint(){return(this._pointOffset-=this._stride)>=this._pathOffset}nextPath(){return!(this.pathIndex>=this.totalSize-1||(this._pathIndex>=0&&(this._pathOffset+=this._stride*this.pathSize),this._pathIndex++,this._pointOffset=this._pathOffset-this._stride,this._end=this._pointOffset+this._stride+this._stride*this.pathSize,0))}prevPath(){return!(this.pathIndex<=0||(this._pathIndex--,this._end=this._pathOffset,this._pathOffset-=this._stride*this.pathSize,this._pointOffset=this._pathOffset-this._stride,0))}getCurrentPath(){const e=this._end,t=this._geometry.coords,r=this._pathOffset;return(new o).initialize(new i([this.pathSize],t.slice(r,e)),this.geometryType,this.hasZ,this.hasM,this.yFactor)}pathLength(){const e=this._end,t=this._stride,r=this._geometry.coords;let s=0;for(let i=this._pathOffset+t;i<e;i+=t){const e=r[i-t],n=r[i-t+1],o=r[i]-e,a=r[i+1]-n;s+=Math.sqrt(o*o+a*a)}return s}startPath(){this._geometry.lengths.push(0)}pushPath(e){this.startPath(),this.pushPoints(e)}pushPoint(e){for(let t=0;t<this._stride;++t)this._geometry.coords.push(e[t]);this._geometry.lengths[this.totalSize-1]++}pushXY(e,t){this._geometry.coords.push(e,t),this._geometry.lengths[this.totalSize-1]++}pushPoints(e){for(const t of e)for(let e=0;e<this._stride;++e)this._geometry.coords.push(t[e]);this._geometry.lengths[this.totalSize-1]+=e.length}pushCursor(e){const t=e.asOptimized();this._geometry.coords.push(...t.coords),this._geometry.lengths.push(...t.lengths)}asOptimized(){const e=this._geometry.clone();if(1!==this.yFactor)for(let t=1;t<e.coords.length;t+=this._stride)e.coords[t]*=this.yFactor;return"esriGeometryPoint"===this.geometryType&&(e.lengths.length=0),e}isClosed(){const e=this._geometry.coords,t=this._pathOffset,r=this._end-this._stride;for(let s=0;s<this._stride;s++)if(e[t+s]!==e[r+s])return!1;return!0}clone(){return(new o).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._geometry.isPoint?1:this._geometry.lengths.reduce((e,t)=>e+t)}get pathSize(){const{lengths:e}=this._geometry;return this._geometry.isPoint?1:this._pathIndex<0||this._pathIndex>e.length-1?0:e[this._pathIndex]}get totalSize(){return this._geometry.isPoint?1:this._geometry.lengths.length}get x(){return this._geometry.coords[this._pointOffset]}set x(e){this._geometry.coords[this._pointOffset]=e}get y(){return this.yFactor*this._geometry.coords[this._pointOffset+1]}set y(e){this._geometry.coords[this._pointOffset+1]=this.yFactor*e}get z(){return this._geometry.coords[this._pointOffset+2]}set z(e){this._geometry.coords[this._pointOffset+2]=e}get m(){const e=this.hasZ?3:2;return this._geometry.coords[this._pointOffset+e]}set m(e){this._geometry.coords[this._pointOffset+3]=e}get pathIndex(){return this._pathIndex}get _coordIndex(){return this._pointOffset/this._stride}}function a(e){const t=[e.x,e.y];return e.z&&t.push(e.z),e.m&&t.push(e.m),t}function l(e){return s.isPolygon(e)?[e.rings,"esriGeometryPolygon"]:s.isPolyline(e)?[e.paths,"esriGeometryPolyline"]:s.isMultipoint(e)?[[e.points],"esriGeometryMultipoint"]:s.isExtent(e)?[[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]],"esriGeometryEnvelope"]:s.isPoint(e)?[[[a(e)]],"esriGeometryPoint"]:[[],"esriGeometryPolyline"]}class c extends n{initialize(e,t,r,s,i){return this._paths=e,this.geometryType=t,this.hasZ=r,this.hasM=s,this._pathIndex=this._pointIndex=-1,this.yFactor=i,this._mIndex=this.hasZ?3:2,this}reset(){this._pathIndex=this._pointIndex=-1}seekPath(e){return this._pathIndex=e,this._pointIndex=-1,e>=0&&e<this.totalSize&&(this._currentPath=this._paths[e],!0)}seekPathStart(){this._pointIndex=-1}seekPathEnd(){this._pointIndex=this._currentPath.length}seekInPath(e){return e>=0&&e<this._currentPath.length&&(this._pointIndex=e,this._currentPoint=this._currentPath[this._pointIndex],!0)}nextPoint(){return this._currentPoint=this._currentPath[++this._pointIndex],this._pointIndex<this._currentPath.length}prevPoint(){return this._currentPoint=this._currentPath[--this._pointIndex],this._pointIndex>=0}nextPath(){return this._pointIndex=-1,this._currentPath=this._paths[++this._pathIndex],this._pathIndex<this.totalSize}prevPath(){return this.pathIndex>0&&(this._pointIndex=-1,this._pathIndex--,this._currentPath=this._paths[this._pathIndex],!0)}pathLength(){const e=this._currentPath.length,t=this._currentPath;let r=0;for(let s=1;s<e;s++){const e=t[s-1],i=t[s],n=e[0],o=e[1],a=i[0]-n,l=i[1]-o;r+=Math.sqrt(a*a+l*l)}return r}startPath(){this._paths.push([])}getCurrentPath(){return(new c).initialize([this._currentPath],this.geometryType,this.hasZ,this.hasM,this.yFactor)}pushPath(e){this._paths.push(e)}pushPoint(e){this._paths[this.totalSize-1].push(e)}pushXY(e,t){this._paths[this.totalSize-1].push([e,t])}pushPoints(e){this._paths[this.totalSize-1].push(...e)}pushCursor(e){const t=r.collectMultipath(e);for(const e of t)this.pushPath(e)}asOptimized(){const e=new i;if("esriGeometryPoint"===this.geometryType)e.coords.push(...this._paths[0][0]),e.lengths.length=0;else for(const t of this._paths){for(const r of t)e.coords.push(r[0]),e.coords.push(r[1]*this.yFactor),this.hasZ&&e.coords.push(r[2]),this.hasM&&e.coords.push(r[this._mIndex]);e.lengths.push(t.length)}return e}isClosed(){const e=this._currentPath[0],t=this._currentPath[this._currentPath.length-1];for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}clone(){return(new c).initialize(t.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}get totalPoints(){return this._paths.map(e=>e.length).reduce((e,t)=>e+t)}get pathSize(){return this._pathIndex<0||this._pathIndex>this.totalSize-1?-1:this._paths[this._pathIndex].length}get totalSize(){return this._paths.length}get x(){return this._currentPoint[0]}set x(e){this._currentPoint[0]=e}get y(){return this.yFactor*this._currentPoint[1]}set y(e){this._currentPoint[1]=this.yFactor*e}get z(){return this._currentPoint[2]}set z(e){this._currentPoint[2]=e}get m(){return this._currentPoint[this._mIndex]}set m(e){this._currentPoint[this._mIndex]=e}get pathIndex(){return this._pathIndex}}class u extends o{initialize(e,t,r,s,i){return super.initialize(e,t,r,s,i),this._controlPoints||(this._controlPoints=this._controlPoints=new Array(this.totalSize).fill(void 0).map(e=>new Set)),this}startPath(){super.startPath(),this._controlPoints.push(new Set)}clone(){const e=(new u).initialize(this._geometry.clone(),this.geometryType,this.hasZ,this.hasM,this.yFactor);return e._controlPoints=this._controlPoints,e}setControlPoint(){this._controlPoints[this.pathIndex].add(this._coordIndex)}getControlPoint(){return this._controlPoints[this.pathIndex].has(this._coordIndex)}setControlPointAt(e){this._controlPoints[this.pathIndex].add(e)}getControlPointAt(e){return this._controlPoints[this.pathIndex].has(e)}}class h extends c{initialize(e,t,r,s,i){return super.initialize(e,t,r,s,i)}clone(){return(new h).initialize(t.clone(this._paths),this.geometryType,this.hasZ,this.hasM,this.yFactor)}setControlPoint(){this._paths[this.pathIndex][this._pointIndex][4]=1}getControlPoint(){return 1===this._paths[this.pathIndex][this._pointIndex][4]}setControlPointAt(e){this._paths[this.pathIndex][e][4]=1}getControlPointAt(e){return 1===this._paths[this.pathIndex][e][4]}}e.GeometryCursor=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedGeometry":function(){define(["../../core/memoryEstimations"],function(e){"use strict";class t{constructor(e=[],t=[]){this.lengths=e??[],this.coords=t??[]}static fromJSON(e){return new t(e.lengths,e.coords)}static fromRect(e){const[r,s,i,n]=e,o=i-r,a=n-s;return new t([5],[r,s,o,0,0,a,-o,0,0,-a])}get isPoint(){return 0===this.lengths.length&&this.coords.length>=2}get maxLength(){return Math.max(...this.lengths)}get size(){return this.lengths.reduce((e,t)=>e+t)}get usedMemory(){return 64+e.estimateNumberArrayMemory(this.lengths,this.coords)}area(){let e=0,t=0;if(!this.lengths.length)return 0;for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];if(s<3)continue;let i=this.coords[2*t],n=this.coords[2*t+1];for(let r=1;r<s;r+=1){const s=this.coords[2*(r+t)],o=this.coords[2*(r+t)+1];e+=-.5*(s-i)*(o+n),i=s,n=o}t+=s}return e}forEachVertex(e){let t=0;this.lengths.length||e(this.coords[0],this.coords[1]);for(let r=0;r<this.lengths.length;r++){const s=this.lengths[r];for(let r=0;r<s;r++)e(this.coords[2*(r+t)],this.coords[2*(r+t)+1]);t+=s}}deltaDecode(){const e=this.clone(),{coords:t,lengths:r}=e;let s=0;for(const e of r){for(let r=1;r<e;r++)t[2*(s+r)]+=t[2*(s+r)-2],t[2*(s+r)+1]+=t[2*(s+r)-1];s+=e}return e}clone(e){if(0===this.lengths.length)return new t([],[this.coords[0],this.coords[1]]);const r=2*(0===this.lengths.length?1:this.lengths.reduce((e,t)=>e+t)),s=this.coords.slice(0,r);return e?(e.set(s),new t(this.lengths,e)):new t(Array.from(this.lengths),Array.from(s))}}return t})},"esri/symbols/cim/constants":function(){define(["exports","./defaultCIMValues"],function(e,t){"use strict";const r={outlineWidth:.75,referenceWidth:.75,cap:t.defaultCIMValues.CIMSolidStroke.capstyle,join:t.defaultCIMValues.CIMSolidStroke.joinstyle,miterLimit:t.defaultCIMValues.CIMSolidStroke.miterlimit};e.antialiasingOutlineFillSettings=r,e.dashRadius=15.5,e.dashSdfDistanceNormalization=64,e.dashSdfRasterizationScale=4,e.maxTileCoordValue=1024,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/defaultCIMValues":function(){define(["exports"],function(e){"use strict";e.defaultCIMColor={color:[128,128,128,1],outlinecolor:[0,0,0,1],backgroundcolor:[128,128,128,1],borderlinecolor:[0,0,0,1],tintcolor:[255,255,255,1]},e.defaultCIMValues={CIMVectorMarker:{scalesymbolsproportionally:!1,respectframe:!0,anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMPictureMarker:{scalex:1,texturefilter:"Draft",anchorpointunits:"Relative",offsetx:0,offsety:0,rotateclockwise:!1,rotation:0,size:10,enable:!0,colorlocked:!1},CIMTextSymbol:{angle:0,anglex:0,angley:0,halosize:1,height:10,horizontalalignment:"Left",kerning:!0,letterspacing:0,letterwidth:100,ligatures:!0,linegap:0,offsetx:0,offsety:0,strikethrough:!1,textcase:"Normal",textstring:"",underline:!1,verticalalignment:"Bottom",enable:!0,colorlocked:!1},CIMSolidStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMPictureStroke:{texturefilter:"Draft",capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1},CIMGradientStroke:{capstyle:"Round",joinstyle:"Round",miterlimit:4,width:4,enable:!0,colorlocked:!1,gradientMethod:"AcrossLine",gradientSize:75,gradientSizeUnits:0,gradientType:"Discrete",interval:5},CIMSolidFill:{enable:!0,colorlocked:!1},CIMPictureFill:{offsetx:0,offsety:0,rotation:0,scalex:1,height:10,texturefilter:"Draft",enable:!0,colorlocked:!1},CIMHatchFill:{offsetx:0,offsety:0,rotation:0,separation:4,enable:!0,colorlocked:!1},CIMGradientFill:{enable:!0,angle:90,gradientMethod:"Linear",gradientSize:75,gradientSizeUnits:0,gradientType:"Discrete",interval:5},CIMGeometricEffectAddControlPoints:{angletolerance:120},CIMGeometricEffectArrow:{arrowtype:"OpenEnded",width:5},CIMGeometricEffectBuffer:{size:1},CIMGeometricEffectCut:{begincut:1,endcut:1,middlecut:0,invert:!1},CIMGeometricEffectDashes:{customendingoffset:0,linedashending:"NoConstraint",offsetalongline:0},CIMGeometricEffectDonut:{method:"Mitered",option:"Accurate",width:2},CIMGeometricEffectJog:{angle:225,length:20,position:50},CIMGeometricEffectControlMeasureLine:{rule:"FullGeometry"},CIMGeometricEffectMove:{offsetx:1,offsety:-1},CIMGeometricEffectOffset:{method:"Square",offset:1,option:"Fast"},CIMGeometricEffectRadial:{angle:0,length:5},CIMGeometricEffectRotate:{angle:15},CIMGeometricEffectScale:{xscalefactor:1.15,yscalefactor:1.15},CIMGeometricEffectWave:{amplitude:2,period:3,seed:1,waveform:"Sinus"},CIMMarkerPlacementAlongLine:{customendingoffset:0,endings:"WithHalfGap",offsetalongline:0,placeperpart:!0,angletoline:!0,offset:0},CIMMarkerPlacementAtExtremities:{extremityplacement:"Both",offsetalongline:0,angletoline:!0,offset:0},CIMMarkerPlacementAtRatioPositions:{beginposition:0,endposition:0,flipfirst:!0,angletoline:!0,offset:0},CIMMarkerPlacementInsidePolygon:{gridangle:0,gridtype:"Fixed",offsetx:0,offsety:0,randomness:100,seed:0,shiftoddrows:!1,stepx:16,stepy:16,clipping:"ClipAtBoundary"},CIMMarkerPlacementOnLine:{relativeto:"LineMiddle",startpointoffset:0,angletoline:!0,offset:0},CIMMarkerPlacementOnVertices:{placeperpart:!0,placeoncontrolpoints:!0,placeonendpoints:!0,placeonregularvertices:!0,angletoline:!0,offset:0},CIMMarkerPlacementPolygonCenter:{method:"OnPolygon",offsetx:0,offsety:0,clipatboundary:!1},CIMAnimatedSymbolProperties:{playanimation:!1,reverseanimation:!1,randomizestarttime:!1,randomizestartseed:0,starttimeoffset:0,duration:3,endingduration:3,useendingduration:!1,repeattype:"Loop",repeatdelay:0,easing:"Linear"},CIMSymbolAnimationSize:{tosize:10},CIMSymbolAnimationScale:{scalefactor:1},CIMSymbolAnimationColor:{tocolor:[255,255,255,1]},CIMSymbolAnimationTransparency:{totransparency:0},CIMSymbolAnimationRotation:{torotation:0,rotateclockwise:!1},CIMSymbolAnimationOffset:{offsetx:0,offsety:0},CIMSymbolAnimationMoveAlongLine:{speed:30,distanceAlong:100}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/CIMMarkerPlacementHelper":function(){define(["exports","../CIMOperators"],function(e,t){"use strict";e.CIMMarkerPlacementHelper=class{static getPlacement(e,r,s,i,n){const o=t.getPlacementOperator(s);return o?(-1===r&&e.invertY(),o.execute(e,s,i,n)):null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMOperators":function(){define(["exports","./effects/EffectAddControlPoints","./effects/EffectArrow","./effects/EffectBuffer","./effects/EffectControlMeasureLine","./effects/EffectCut","./effects/EffectDashes","./effects/EffectDonut","./effects/EffectEnclosingPolygon","./effects/EffectJog","./effects/EffectMove","./effects/EffectOffset","./effects/EffectRadial","./effects/EffectReverse","./effects/EffectRotate","./effects/EffectScale","./effects/EffectSuppress","./effects/EffectTaperedPolygon","./effects/EffectWave","./placements/PlacementAlongLineSameSize","./placements/PlacementAtExtremities","./placements/PlacementAtRatioPositions","./placements/PlacementInsidePolygon","./placements/PlacementOnLine","./placements/PlacementOnVertices","./placements/PlacementPolygonCenter"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_,b,S,x,w,v,M,I){"use strict";e.getEffectOperator=function(e){if(!e)return null;switch(e.type){case"CIMGeometricEffectAddControlPoints":return t.EffectAddControlPoints.local();case"CIMGeometricEffectArrow":return r.EffectArrow.local();case"CIMGeometricEffectBuffer":return s.EffectBuffer.local();case"CIMGeometricEffectControlMeasureLine":return i.EffectControlMeasureLine.local();case"CIMGeometricEffectCut":return n.EffectCut.local();case"CIMGeometricEffectDashes":return o.EffectDashes.local();case"CIMGeometricEffectDonut":return a.EffectDonut.local();case"CIMGeometricEffectJog":return c.EffectJog.local();case"CIMGeometricEffectMove":return u.EffectMove.local();case"CIMGeometricEffectOffset":return h.EffectOffset.local();case"CIMGeometricEffectRadial":return d.EffectRadial.local();case"CIMGeometricEffectReverse":return p.EffectReverse.local();case"CIMGeometricEffectRotate":return f.EffectRotate.local();case"CIMGeometricEffectScale":return m.EffectScale.local();case"CIMGeometricEffectSuppress":return g.EffectSuppress.local();case"CIMGeometricEffectTaperedPolygon":return y.EffectTaperedPolygon.local();case"CIMGeometricEffectWave":return _.EffectWave.local();case"CIMGeometricEffectEnclosingPolygon":return l.EffectEnclosingPolygon.local()}return null},e.getPlacementOperator=function(e){if(!e)return null;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":return b.PlacementAlongLineSameSize.local();case"CIMMarkerPlacementAtExtremities":return S.PlacementAtExtremities.local();case"CIMMarkerPlacementAtRatioPositions":return x.PlacementAtRatioPositions.local();case"CIMMarkerPlacementInsidePolygon":return w.PlacementInsidePolygon.local();case"CIMMarkerPlacementOnLine":return v.PlacementOnLine.local();case"CIMMarkerPlacementOnVertices":return M.PlacementOnVertices.local();case"CIMMarkerPlacementPolygonCenter":return I.PlacementPolygonCenter.local()}return null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectAddControlPoints":function(){define(["exports"],function(e){"use strict";class t{static{this.instance=null}static local(){return null===t.instance&&(t.instance=new t),t.instance}execute(e,t){return new r(e,t)}}class r{constructor(e,t){this._inputGeometries=e,this._angleTolerance=void 0!==t.angleTolerance?t.angleTolerance:120,this._maxCosAngle=Math.cos((1-Math.abs(this._angleTolerance)/180)*Math.PI)}next(){let e=this._inputGeometries.next();if(!e)return null;for(;e;){if("esriGeometryPolygon"===e.geometryType)this._isClosed=!0;else if("esriGeometryPolyline"===e.geometryType)this._isClosed=!1;else{if("esriGeometryEnvelope"!==e.geometryType){e=this._inputGeometries.next();continue}if(this._maxCosAngle)return e;this._isClosed=!0}for(;e.nextPath();)this._processPath(e);return e.reset(),e}return null}_processPath(e){if(e.nextPoint()){const t=e.x,r=e.y;let s=t,i=r,n=e.pathSize,o=0,a=0,l=0,c=0,u=0,h=0;this._isClosed&&++n;for(let d=1;e.nextPoint()||d<n;++d){let p,f;this._isClosed&&d===n-1?(p=t,f=r):(p=e.x,f=e.y);const m=p-s,g=f-i,y=Math.sqrt(m*m+g*g);d>1&&y>0&&l>0&&(o*m+a*g)/y/l<=this._maxCosAngle&&e.setControlPointAt(d-1),1===d&&(c=m,u=g,h=y),y>0&&(s=p,i=f,o=m,a=g,l=y)}this._isClosed&&l>0&&h>0&&(o*c+a*u)/h/l<=this._maxCosAngle&&e.setControlPointAt(0)}}}e.EffectAddControlPoints=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectArrow":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../CurveHelper"],function(e,t,r,s,i){"use strict";const n=1.7320508075688772;class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r){return new a(e,t,r)}}class a extends s.PathEffectCursor{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new i.CurveHelper,this._width=(void 0!==t.width?t.width:5)*r,this._arrowType=void 0!==t.geometricEffectArrowType?t.geometricEffectArrowType:void 0!==t.arrowType?t.arrowType:"OpenEnded",this._offsetFlattenError=i.pixelTolerance*r}processPath(e){const r=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);switch(this._arrowType){case"OpenEnded":default:this._constructSimpleArrow(r,e,!0);break;case"Block":this._constructSimpleArrow(r,e,!1);break;case"Crossed":this._constructCrossedArrow(r,e)}return r}_constructSimpleArrow(e,t,s){const i=t.pathLength();let n=this._width;i<2*n&&(n=i/2);const o=this._curveHelper.getSubCurve(t,0,i-n);if(!o||!o.nextPath())return;o.seekPathStart();const a=n/2;if(this._curveHelper.isEmpty(o))return;const l=r.collectPath(o),c=this._constructOffset(l,-a);if(!c)return;const u=this._constructOffset(l,a);if(!u)return;const h=this._constructArrowBasePoint(c,-a/2);if(!h)return;const d=this._constructArrowBasePoint(u,a/2);if(!d)return;t.seekInPath(t.pathSize-1);const p=[t.x,t.y];e.pushPath(u),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(d),e.nextPoint(),e.setControlPoint(),e.pushPoint(p),e.nextPoint(),e.setControlPoint(),e.pushPoint(h),e.nextPoint(),e.setControlPoint(),e.pushPoints(c.reverse()),e.setControlPoint(),s||(e.setControlPointAt(0),e.setControlPointAt(e.pathSize-1),e.pushPoint(u[0])),e.reset()}_constructCrossedArrow(e,t){const s=t.pathLength();let i=this._width;s<i*(1+n+1)&&(i=s/(1+n+1)),t.seekPathStart();const o=this._curveHelper.getSubCurve(t,0,s-i*(1+n));if(!o)return;o.nextPath();const a=i/2;if(this._curveHelper.isEmpty(o))return;const l=r.collectPath(o),c=this._constructOffset(l,a);if(!c)return;const u=this._constructOffset(l,-a);if(!u)return;const h=this._curveHelper.getSubCurve(t,0,s-i);if(!h)return;if(h.nextPath(),this._curveHelper.isEmpty(h))return;const d=r.collectPath(h),p=this._constructOffset(d,a);if(!p)return;const f=this._constructOffset(d,-a);if(!f)return;const m=p[p.length-1],g=this._constructArrowBasePoint(p,a/2);if(!g)return;const y=f[f.length-1],_=this._constructArrowBasePoint(f,-a/2);if(!_)return;t.seekInPath(t.pathSize-1);const b=[t.x,t.y];e.pushPath(c),e.nextPath(),e.nextPoint(),e.setControlPoint(),e.pushPoint(y),e.nextPoint(),e.setControlPoint(),e.pushPoint(_),e.nextPoint(),e.setControlPoint(),e.pushPoint(b),e.nextPoint(),e.setControlPoint(),e.pushPoint(g),e.nextPoint(),e.setControlPoint(),e.pushPoint(m),e.nextPoint(),e.setControlPoint(),e.pushPoints(u.reverse()),e.nextPoint(),e.setControlPoint(),e.reset()}_constructOffset(e,t){return this._curveHelper.offset(e,t,"Rounded",4,this._offsetFlattenError)}_constructArrowBasePoint(e,t){if(!e||e.length<2)return null;const r=e[e.length-2],s=e[e.length-1],i=[s[0]-r[0],s[1]-r[1]];return this._curveHelper.normalize(i),[s[0]+i[1]*t,s[1]-i[0]*t]}}e.EffectArrow=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMCursor":function(){define(["exports","./CIMPlacements"],function(e,t){"use strict";e.PathEffectCursor=class{constructor(e,t,r,s=0){this.isClosed=!1,this.inputGeometries=e,this.acceptPolygon=t,this.acceptPolyline=r,this.geomUnitsPerPoint=s,this.iteratePath=!1,this.multiPathCursor=null}next(){for(;;){if(!this.multiPathCursor){let e=this.inputGeometries.next();for(;e&&(this.isClosed=this.acceptPolygon&&"esriGeometryPolygon"===e.geometryType||"esriGeometryEnvelope"===e.geometryType,this.multiPathCursor=e,!this.multiPathCursor);)e=this.inputGeometries.next();if(!this.multiPathCursor)return null}for(;this.iteratePath||this.multiPathCursor.nextPath();){this.multiPathCursor.seekPathStart();const e=this.processPath(this.multiPathCursor);if(e)return e}this.multiPathCursor=null}}},e.PathTransformationCursor=class{constructor(e,r=!0,s=!0,i=0){this.isClosed=!1,this.geometryCursor=null,this.geometryCursor=!r&&"esriGeometryPolygon"===e.geometryType||!s&&"esriGeometryPolyline"===e.geometryType?null:e,this.geomUnitsPerPoint=i,this.iterateMultiPath=!1,this.iteratePath=!1,this.internalPlacement=new t.Placement}next(){if(!this.geometryCursor)return null;const e=this.processMultiPath(this.geometryCursor);return this.iterateMultiPath&&e||(this.geometryCursor=null),e}processMultiPath(e){for(;this.iteratePath||e.pathIndex<e.totalSize-1;){this.iteratePath||e.nextPath(),this.iterateMultiPath=!0;const t=this.processPath(e);if(t)return t}return this.iterateMultiPath=!1,null}},e.setId=function(e,t){e[4]=t},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMPlacements":function(){define(["exports"],function(e){"use strict";e.Placement=class{constructor(){this.setIdentity()}getAngle(){return(null==this.rz||0===this.rz&&1!==this.rzCos&&0!==this.rzSin)&&(this.rz=Math.atan2(this.rzSin,this.rzCos)),this.rz}setIdentity(){this.tx=0,this.ty=0,this.tz=0,this.s=1,this.rx=0,this.ry=0,this.rz=0,this.rzCos=1,this.rzSin=0}setTranslate(e,t){this.tx=e,this.ty=t}setTranslateZ(e){this.tz=e}setRotateCS(e,t){this.rz=void 0,this.rzCos=e,this.rzSin=t}setRotate(e){this.rz=e,this.rzCos=void 0,this.rzSin=void 0}setRotateY(e){this.ry=e}setScale(e){this.s=e}setMeasure(e){this.m=e}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CurveHelper":function(){define(["exports","../../geometry/GeometryCursor"],function(e,t){"use strict";e.CurveHelper=class{constructor(e=0,t=!1){}isEmpty(e){if(!e.nextPoint())return!0;let t,r,s,i;for(t=e.x,r=e.y;e.nextPoint();t=r,r=i)if(s=e.x,i=e.y,s!==t||i!==r)return e.seekPathStart(),!1;return e.seekPathStart(),!0}normalize(e){const t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);0!==t&&(e[0]/=t,e[1]/=t)}getLength(e,t,r,s){const i=r-e,n=s-t;return Math.sqrt(i*i+n*n)}getSegLength(e){const[[t,r],[s,i]]=e;return this.getLength(t,r,s,i)}getCoord2D(e,t,r,s,i){return[e+(r-e)*i,t+(s-t)*i]}getSegCoord2D(e,t){const[[r,s],[i,n]]=e;return this.getCoord2D(r,s,i,n,t)}getAngle(e,t,r,s,i){const n=r-e,o=s-t;return Math.atan2(o,n)}getAngleCS(e,t,r,s,i,n){null==e&&(e=[0,0]);const o=s-t,a=i-r,l=Math.sqrt(o*o+a*a);return 0!==l?(e[0]=o/l,e[1]=a/l,e):(e[0]=1,e[1]=0,e)}getSegAngleCS(e,t,r){const[[s,i],[n,o]]=t;return this.getAngleCS(e,s,i,n,o,r)}cut(e,t,r,s,i,n){return[i<=0?[e,t]:this.getCoord2D(e,t,r,s,i),n>=1?[r,s]:this.getCoord2D(e,t,r,s,n)]}getSubCurve(e,r,s){const i=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return this.appendSubCurve(i,e,r,s)?i:null}appendSubCurve(e,t,r,s){e.startPath(),t.seekPathStart();let i=0,n=!0;if(!t.nextPoint())return!1;let o=t.x,a=t.y;for(;t.nextPoint();){const l=this.getLength(o,a,t.x,t.y);if(0!==l){if(n){if(i+l>r){const c=(r-i)/l;let u=1,h=!1;i+l>=s&&(u=(s-i)/l,h=!0);const d=this.cut(o,a,t.x,t.y,c,u);if(d&&e.pushPoints(d),h)break;n=!1}}else{if(i+l>s){const r=this.cut(o,a,t.x,t.y,0,(s-i)/l);r&&e.pushPoint(r[1]);break}e.pushXY(t.x,t.y)}i+=l,o=t.x,a=t.y}else o=t.x,a=t.y}return!0}getCIMPointAlong(e,t){if(!e.nextPoint())return null;let r,s,i,n,o=0;for(r=e.x,s=e.y;e.nextPoint();r=i,s=n){i=e.x,n=e.y;const a=this.getLength(r,s,i,n);if(0!==a){if(o+a>t){const e=(t-o)/a;return this.getCoord2D(r,s,i,n,e)}o+=a}}return null}offset(e,t,r,s,i){if(!e||e.length<2)return null;let n=0,o=e[n++],a=n;for(;n<e.length;){const t=e[n];t[0]===o[0]&&t[1]===o[1]||(n!==a&&(e[a]=e[n]),o=e[a++]),n++}const l=e[0][0]===e[a-1][0]&&e[0][1]===e[a-1][1];if(l&&--a,a<(l?3:2))return null;const c=[];o=l?e[a-1]:null;let u=e[0];for(let i=0;i<a;i++){const n=i===a-1?l?e[0]:null:e[i+1];if(o)if(n){const e=[n[0]-u[0],n[1]-u[1]];this.normalize(e);const i=[u[0]-o[0],u[1]-o[1]];this.normalize(i);const a=i[0]*e[1]-i[1]*e[0],l=i[0]*e[0]+i[1]*e[1];if(0===a&&1===l){u=n;continue}if(a>=0==t<=0){if(l<1){const r=[e[0]-i[0],e[1]-i[1]];this.normalize(r);const n=Math.sqrt((1+l)/2);if(n>1/s){const e=-Math.abs(t)/n;c.push([u[0]-r[0]*e,u[1]-r[1]*e])}}}else switch(r){case"Mitered":{const r=Math.sqrt((1+l)/2);if(r>0&&1/r<s){const s=[e[0]-i[0],e[1]-i[1]];this.normalize(s);const n=Math.abs(t)/r;c.push([u[0]-s[0]*n,u[1]-s[1]*n]);break}}case"Bevelled":c.push([u[0]+i[1]*t,u[1]-i[0]*t]),c.push([u[0]+e[1]*t,u[1]-e[0]*t]);break;case"Rounded":if(l<1){c.push([u[0]+i[1]*t,u[1]-i[0]*t]);const r=Math.floor(2.5*(1-l));if(r>0){const s=1/r;let n=s;for(let o=1;o<r;o++,n+=s){const r=[i[1]*(1-n)+e[1]*n,-i[0]*(1-n)-e[0]*n];this.normalize(r),c.push([u[0]+r[0]*t,u[1]+r[1]*t])}}c.push([u[0]+e[1]*t,u[1]-e[0]*t])}break;default:if(a<0)c.push([u[0]+(i[1]+i[0])*t,u[1]+(i[1]-i[0])*t]),c.push([u[0]+(e[1]-e[0])*t,u[1]-(e[0]+e[1])*t]);else{const r=Math.sqrt((1+Math.abs(l))/2),s=[e[0]-i[0],e[1]-i[1]];this.normalize(s);const n=t/r;c.push([u[0]-s[0]*n,u[1]-s[1]*n])}}}else{const e=[u[0]-o[0],u[1]-o[1]];this.normalize(e),c.push([u[0]+e[1]*t,u[1]-e[0]*t])}else{const e=[n[0]-u[0],n[1]-u[1]];this.normalize(e),c.push([u[0]+e[1]*t,u[1]-e[0]*t])}o=u,u=n}return c.length<(l?3:2)?null:(l&&c.push([c[0][0],c[0][1]]),c)}},e.pixelTolerance=.03,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectBuffer":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/SpatialReference","../CIMEffects","../CurveHelper"],function(e,t,r,s,i,n){"use strict";class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,s,i,n){return new a(e,t,r,s,i,n)}}class a{constructor(e,t,r,s,i,o){this._preventClipping=o,this._inputGeometries=e,this._tileKey=s,this._curveHelper=new n.CurveHelper,this._size=(void 0!==t.size?t.size:1)*r,this._maxInflateSize=i*r,this._offsetFlattenError=n.pixelTolerance*r}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._size)return e;if("esriGeometryEnvelope"===e.geometryType)if(this._size>0){const s=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType),i=r.collectMultipath(e)[0],n=this._curveHelper.offset(i,this._size,"Rounded",4,this._offsetFlattenError);if(n)return s.pushPath(n),s}else if(this._size<0){const r=e.asJSON();if(Math.min(r.xmax-r.xmin,r.ymax-r.ymin)+2*this._size>0)return t.GeometryCursor.fromJSONCIM({xmin:r.xmin-this._size,xmax:r.xmax+this._size,ymin:r.ymin-this._size,ymax:r.ymax+this._size})}const n=!this._preventClipping&&this._tileKey?i.clipCursorToTileExtent(e,this._maxInflateSize,!0):e;if(!n)continue;const o=i.lazyBufferOperator.module,a={...n.asJSON(),spatialReference:{wkid:s.WebMercator.wkid}},l=o.execute(a,this._size);return l?t.GeometryCursor.fromJSONCIM(l):null}return null}}e.EffectBuffer=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMEffects":function(){define(["require","exports","../../geometry/GeometryCursor","../../geometry/support/TileClipper","./utils"],function(e,t,r,s,i){"use strict";const n=i.importLazily(()=>new Promise((t,r)=>e(["../../geometry/operators/json/bufferOperator"],t,r))),o=i.importLazily(()=>new Promise((t,r)=>e(["../../geometry/operators/json/convexHullOperator"],t,r))),a=i.importLazily(()=>new Promise((t,r)=>e(["../../geometry/operators/json/lengthOperator"],t,r))),l=i.importLazily(()=>new Promise((t,r)=>e(["../../geometry/operators/json/generalizeOperator"],t,r))),c=i.importLazily(()=>new Promise((t,r)=>e(["../../geometry/operators/json/offsetOperator"],t,r))),u=i.importLazily(()=>new Promise((t,r)=>e(["../../geometry/operators/json/simplifyOperator"],t,r)));let h;t.SimpleEffectCursor=class{constructor(e){this._geometry=e}next(){const e=this._geometry;return this._geometry=null,e}},t.clipCursorToTileExtent=function(e,t,i){if(!e)return null;h||(h=new s.TileClipper(0,0,0,1));const n=i?-1:1,o="esriGeometryPolygon"===e.geometryType,a=o?3:2,l=o?3:2;let c,u;for(h.reset(a),h.setPixelMargin(t+1),h.setExtent(512);e.nextPath();)if(!(e.pathSize<l)){for(e.nextPoint(),c=e.x,u=n*e.y,h.moveTo(c,u);e.nextPoint();)c=e.x,u=n*e.y,h.lineTo(c,u);o&&h.close()}const d=h.result(!1);if(d){const t=r.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);for(const e of d){t.startPath();for(const r of e)t.pushXY(r.x,n*r.y)}return t.reset(),t}return null},t.lazyBufferOperator=n,t.lazyConvexHullOperator=o,t.lazyGeneralizeOperator=l,t.lazyLengthOperator=a,t.lazyOffsetOperator=c,t.lazySimplifyOperator=u,t.loadGeometryOperatorsForEffect=function(e){switch(e.type){case"CIMGeometricEffectDonut":case"CIMGeometricEffectBuffer":return n.getImportPromise();case"CIMGeometricEffectEnclosingPolygon":return o.getImportPromise();case"CIMGeometricEffectOffset":return c.getImportPromise();case"CIMGeometricEffectTaperedPolygon":return Promise.all([u.getImportPromise(),a.getImportPromise(),l.getImportPromise()]);default:return Promise.resolve()}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/utils":function(){define(["require","exports","./defaultCIMValues"],function(e,t,r){"use strict";function s(e){return"function"==typeof e}function i(e){let t=e.length;for(;t--;)if(!" /-,\n".includes(e.charAt(t)))return!1;return!0}function n(e,t){switch("string"!=typeof e&&(e=String(e)),t){case"LowerCase":return e.toLowerCase();case"Allcaps":return e.toUpperCase();default:return e}}function o(e){return e?[e[0],e[1],e[2],e[3]/255]:[0,0,0,0]}function a(e){return null!=e&&("CIMMarkerPlacementAlongLineRandomSize"===e.type||"CIMMarkerPlacementAlongLineSameSize"===e.type||"CIMMarkerPlacementAlongLineVariableSize"===e.type||"CIMMarkerPlacementAtExtremities"===e.type||"CIMMarkerPlacementAtMeasuredUnits"===e.type||"CIMMarkerPlacementAtRatioPositions"===e.type||"CIMMarkerPlacementOnLine"===e.type||"CIMMarkerPlacementOnVertices"===e.type)}class l{constructor(e){this._import=e}getImportPromise(){return null==this._promise&&(this._promise=this._import().then(e=>this.module=e)),this._promise}}function c(e){return new l(e)}const u=c(()=>new Promise((t,r)=>e(["../../geometry/geometryEngineJSON"],t,r)));function h(e){return e?e.charAt(0).toLowerCase()+e.slice(1):e}function d(e,t){if("color"===t||"outlinecolor"===t||"backgroundcolor"===t||"borderlinecolor"===t||"tintcolor"===t)return[...r.defaultCIMColor[t]];const s=r.defaultCIMValues[e];if(!s)throw new Error(`InternalError: default value for type ${e}.`);return s[t]}function p(e){return e.split(" ").map(e=>Number(e))}function f(e){return"string"==typeof e?p(e):e}function m(e,t){if(null!==t){const r=t.get(e);return r?r.name:e}return e}function g(e,t,r,s,i){const n=r*Math.PI/180;if(n){const r=Math.cos(n);return(Math.sin(n)*e+r*t)*s+i}return t*s+i}function y(e,t,r,s,i){const n=r*Math.PI/180;return n?(Math.cos(n)*e-Math.sin(n)*t)*s+i:e*s+i}function _(e,t,r){return t?r-e:r+e}t.adjustTextCase=n,t.analyzeTextParts=function(e,t){const r=[];let s=0,n=-1;do{if(n=e.indexOf("[",s),n>=s){if(n>s){const t=e.slice(s,n);r.push([t,null,i(t)])}if(s=n+1,n=e.indexOf("]",s),n>=s){if(n>s){const i=t[e.slice(s,n)];i&&r.push([null,i,!1])}s=n+1}}}while(-1!==n);if(s<e.length){const t=e.slice(s);r.push([t,null,i(t)])}return r},t.applyParentTransform=function(e,t,r,s,i,n,o=!0){const{infos:a}=n;let l=1,c=0,u=0,h=0,d=1;for(const{absoluteAnchorPoint:e,offsetX:t,offsetY:r,rotation:s,size:i,frameHeight:n,rotateClockWise:p,scaleSymbolsProportionally:f}of a)d=e?1:l,u=y(t,r,c,d,u),h=g(t,r,c,d,h),n&&(f||o)&&(l*=i/n),c=_(s,p,c);const p=y(s,i,c,d,u),f=g(s,i,c,d,h);return{size:e*l,rotation:_(t,r,c),offsetX:p,offsetY:f}},t.assignTextValuesFromFeature=function(e,t,r,s){let i="",o=null;for(const s of t){const[t,n,a]=s;if(null!=t&&""!==t)a?o=t:(null!=o&&(i+=o,o=null),i+=t);else{let t=n;null!=r&&(t=m(n,r));const s=e.attributes[t];null!=s&&""!==s&&(null!=o&&(i+=o,o=null),i+=s)}}return n(i,s)},t.attributesToFields=function(e){return(e?Object.keys(e):[]).map(t=>({name:t,alias:t,type:"string"==typeof e[t]?"esriFieldTypeString":"esriFieldTypeDouble"}))},t.colorToArray=function(e){return[e.r,e.g,e.b,e.a]},t.evaluateValueOrFunction=function(e,t,r,i){return s(e)?e(t,r,i):e},t.fromCIMFontDecoration=function(e){return e.underline?"underline":e.strikethrough?"line-through":"none"},t.fromCIMFontStyle=function(e){let t="normal",r="normal";if(e){const s=e.toLowerCase();s.includes("italic")?t="italic":s.includes("oblique")&&(t="oblique"),s.includes("bold")?r="bold":s.includes("light")&&(r="lighter")}return{style:t,weight:r}},t.fromCIMHorizontalAlignment=function(e){switch(e){case"Left":default:return"left";case"Right":return"right";case"Center":case"Justify":return"center"}},t.fromCIMVerticalAlignment=function(e){switch(e){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}},t.getDefaultCIMValue=d,t.getEnum=(e,t)=>e??t,t.getFieldName=m,t.getFillColor=function e(t){if(!t)return null;switch(t.type){case"CIMPolygonSymbol":if(t.symbolLayers)for(const r of t.symbolLayers){const t=e(r);if(null!=t)return t}break;case"CIMTextSymbol":return e(t.symbol);case"CIMSolidFill":return t.color}return null},t.getFontStyle=function(e){if(!e)return"normal";switch(e.toLowerCase()){case"italic":return"italic";case"oblique":return"oblique";default:return"normal"}},t.getFontWeight=function(e){if(!e)return"normal";switch(e.toLowerCase()){case"bold":return"bold";case"bolder":return"bolder";case"lighter":return"lighter";default:return"normal"}},t.getNumericValue=(e,t=0)=>null==e||isNaN(e)?t:e,t.getProcessParam=function(e,t,r){const s="Color"===r||"TintColor"===r||"ToColor"===r,i="Rotation"===r||"Angle"===r||"ToRotation"===r;let n=t[h(r)];if(null!=n&&(s?n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255]:i&&(n*=Math.PI/180)),null==n&&(n=d(t.type,r.toLowerCase()),null!=n&&(s?n=[n[0]/255,n[1]/255,n[2]/255,n[3]]:i&&(n*=Math.PI/180))),null!=t.primitiveName){const o=e[t.primitiveName];if(null!=o){const e=o[r];null==e||("string"==typeof e||"number"==typeof e||Array.isArray(e)?(n=e,null!=n&&(s?n=[n[0]/255,n[1]/255,n[2]/255,n[3]/255]:i&&(n*=Math.PI/180))):(n={valueExpressionInfo:e,defaultValue:n},null!=n&&(s?n={type:"Process",op:"ArcadeColor",value:n}:i&&(n={type:"Process",op:"Divide",left:n,right:180/Math.PI}))))}}if(null==n)throw new Error(`Failed to derive a value or an expression for "${r}".`);return n},t.getRelativeGradientSize=function(e,t){return Math.max(Math.min((e??t)/100,1),0)},t.getSize=function(e){if(e)switch(e.type){case"CIMTextSymbol":return e.height;case"CIMPointSymbol":{let t=0;if(e.symbolLayers)for(const s of e.symbolLayers)if(s)switch(s.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=s.size??r.defaultCIMValues.CIMVectorMarker.size;e>t&&(t=e);break}}return t}case"CIMLineSymbol":case"CIMPolygonSymbol":{let t=0;if(e.symbolLayers)for(const s of e.symbolLayers)if(s)switch(s.type){case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=s.width;null!=e&&e>t&&(t=e);break}case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":if(s.markerPlacement&&a(s.markerPlacement)){const e=s.size??r.defaultCIMValues.CIMVectorMarker.size;e>t&&(t=e)}break;case"CIMPictureFill":{const e=s.height;null!=e&&e>t&&(t=e)}}return t}}},t.getStrokeColor=function e(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":{const r=t.symbolLayers;if(r)for(const t of r){const r=e(t);if(null!=r)return r}break}case"CIMTextSymbol":return e(t.symbol);case"CIMSolidStroke":return t.color}},t.getStrokeWidth=function e(t){if(t)switch(t.type){case"CIMPolygonSymbol":case"CIMLineSymbol":if(t.symbolLayers)for(const r of t.symbolLayers){const t=e(r);if(void 0!==t)return t}break;case"CIMTextSymbol":return e(t.symbol);case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return t.width}},t.getTextCasing=function e(t){if(null==t)return"Normal";switch(t.type){case"CIMTextSymbol":return t.textCase??"Normal";case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=t.symbolLayers;if(!r)return"Normal";for(const t of r)if("CIMVectorMarker"===t.type)return e(t)}break;case"CIMVectorMarker":{const r=t.markerGraphics;if(!r)return"Normal";for(const t of r)if(t.symbol)return e(t.symbol)}}return"Normal"},t.getTextValuesFromFeatureHandle=function(e,t,r){let s="",i=null;for(const r of t){const[t,n,o]=r;if(null!=t&&""!==t)o?i=t:(null!=i&&(s+=i,i=null),s+=t);else{const t=e.readAttribute(n);null!=t&&""!==t&&(null!==i&&(s+=i,i=null),s+=t)}}return n(s,r)},t.getTintColor=e=>e.tintColor?o(e.tintColor):[255,255,255,1],t.getValue=(e,t)=>null!=e?e:t,t.hasProcessParam=function(e,t,r){if(null!=t[h(r)])return!0;if(null!=t.primitiveName){const s=e[t.primitiveName];if(null!=s&&null!=s[r])return!0}return!1},t.hasStrokeLayer=function(e){for(const t of e)if(t.enable)switch(t.type){case"CIMSolidStroke":case"CIMGradientStroke":case"CIMPictureStroke":return!0}return!1},t.importLazily=c,t.isCIMFill=function(e){return null!=e&&("CIMGradientFill"===e.type||"CIMHatchFill"===e.type||"CIMPictureFill"===e.type||"CIMSolidFill"===e.type||"CIMWaterFill"===e.type)},t.isCIMMarker=function(e){return"CIMVectorMarker"===e.type||"CIMPictureMarker"===e.type||"CIMBarChartMarker"===e.type||"CIMCharacterMarker"===e.type||"CIMPieChartMarker"===e.type||"CIMStackedBarChartMarker"===e.type},t.isCIMMarkerStrokePlacement=a,t.isCIMStroke=function(e){return"CIMGradientStroke"===e.type||"CIMPictureStroke"===e.type||"CIMSolidStroke"===e.type},t.isFeatureValueFn=s,t.isSVGImage=e=>e.includes("data:image/svg+xml"),t.isValidCIMValue=function e(t){if(null==t)return!1;if(Array.isArray(t))return t.every(t=>e(t));switch(typeof t){case"string":return!!t;case"number":return!isNaN(t)}},t.lazyGeometryEngine=u,t.mapCIMSymbolToGeometryType=function(e){if(!e)return null;switch(e.type){case"CIMPointSymbol":case"CIMTextSymbol":return"esriGeometryPoint";case"CIMLineSymbol":return"esriGeometryPolyline";case"CIMPolygonSymbol":return"esriGeometryPolygon";default:return null}},t.normalizeAlpha=o,t.normalizeDashEffectTemplate=function(e){return e?.dashTemplate&&(e.dashTemplate=f(e.dashTemplate)),e},t.normalizeDashTemplate=f,t.normalizePrimitiveOverrideProps=function(e){return e.map(e=>({...e,propertyName:h(e.propertyName)}))},t.parseDashTemplate=p,t.resampleHermite=function(e,t,r,s,i,n,o=!0){const a=t/i,l=r/n,c=Math.ceil(a/2),u=Math.ceil(l/2);for(let r=0;r<n;r++)for(let h=0;h<i;h++){const d=4*(h+(o?n-r-1:r)*i);let p=0,f=0,m=0,g=0,y=0,_=0,b=0;const S=(r+.5)*l;for(let s=Math.floor(r*l);s<(r+1)*l;s++){const r=Math.abs(S-(s+.5))/u,i=(h+.5)*a,n=r*r;for(let r=Math.floor(h*a);r<(h+1)*a;r++){let o=Math.abs(i-(r+.5))/c;const a=Math.sqrt(n+o*o);a>=-1&&a<=1&&(p=2*a*a*a-3*a*a+1,p>0&&(o=4*(r+s*t),b+=p*e[o+3],m+=p,e[o+3]<255&&(p=p*e[o+3]/250),g+=p*e[o],y+=p*e[o+1],_+=p*e[o+2],f+=p))}}s[d]=g/f,s[d+1]=y/f,s[d+2]=_/f,s[d+3]=b/m}},t.toCIMSymbolJSON=function(e){return e.data?.symbol??null},t.toLowerCaseProps=function(e){const t={};for(const r in e){const s=e[r];t[h(r)]=s}return t},t.uncapitalize=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectControlMeasureLine":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/support/coordsUtils","../CIMCursor"],function(e,t,r,s,i){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,r){return new o(e,t,r)}}class o{constructor(e,t,r){this._defaultPointSize=20,this._inputGeometries=e,this._geomUnitsPerPoint=r,this._rule=t.rule??"FullGeometry",this._defaultSize=this._defaultPointSize*r}next(){let e;for(;e=this._inputGeometries.next();){const s=this._processGeom(r.collectMultipath(e));if(s?.length)return t.GeometryCursor.fromJSONCIM({paths:s})}return null}_clone(e){return[e[0],e[1]]}_mid(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}_mix(e,t,r,s){return[e[0]*t+r[0]*s,e[1]*t+r[1]*s]}_add(e,t){return[e[0]+t[0],e[1]+t[1]]}_add2(e,t,r){return[e[0]+t,e[1]+r]}_sub(e,t){return[e[0]-t[0],e[1]-t[1]]}_dist(e,t){return Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]))}_norm(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}_normalize(e,t=1){const r=t/this._norm(e);e[0]*=r,e[1]*=r}_leftPerpendicular(e){const t=-e[1],r=e[0];e[0]=t,e[1]=r}_leftPerp(e){return[-e[1],e[0]]}_rightPerpendicular(e){const t=e[1],r=-e[0];e[0]=t,e[1]=r}_rightPerp(e){return[e[1],-e[0]]}_dotProduct(e,t){return e[0]*t[0]+e[1]*t[1]}_crossProduct(e,t){return e[0]*t[1]-e[1]*t[0]}_rotateDirect(e,t,r){const s=e[0]*t-e[1]*r,i=e[0]*r+e[1]*t;e[0]=s,e[1]=i}_makeCtrlPt(e){const t=[e[0],e[1]];return i.setId(t,1),t}_addAngledTicks(e,t,r,s){const i=this._sub(r,t);this._normalize(i);const n=this._crossProduct(i,this._sub(s,t));let o;o=n>0?this._rightPerp(i):this._leftPerp(i);const a=Math.abs(n)/2,l=[];l.push([t[0]+(o[0]-i[0])*a,t[1]+(o[1]-i[1])*a]),l.push(t),l.push(r),l.push([r[0]+(o[0]+i[0])*a,r[1]+(o[1]+i[1])*a]),e.push(l)}_addBezier2(e,t,r,s,i){if(0===i--)return void e.push(s);const n=this._mid(t,r),o=this._mid(r,s),a=this._mid(n,o);this._addBezier2(e,t,n,a,i),this._addBezier2(e,a,o,s,i)}_addBezier3(e,t,r,s,i,n){if(0===n--)return void e.push(i);const o=this._mid(t,r),a=this._mid(r,s),l=this._mid(s,i),c=this._mid(o,a),u=this._mid(a,l),h=this._mid(c,u);this._addBezier3(e,t,o,c,h,n),this._addBezier3(e,h,u,l,i,n)}_add90DegArc(e,t,r,s,i){const n=i??this._crossProduct(this._sub(r,t),this._sub(s,t))>0,o=this._mid(t,r),a=this._sub(o,t);n?this._leftPerpendicular(a):this._rightPerpendicular(a),o[0]+=a[0],o[1]+=a[1],this._addBezier3(e,t,this._mix(t,.33333,o,.66667),this._mix(r,.33333,o,.66667),r,4)}_addArrow(e,t,r){const s=t[0],i=t[1],n=t[t.length-1],o=this._sub(s,i),a=this._norm(o);this._normalize(o);const l=Math.abs(this._crossProduct(o,this._sub(n,i)));let c=this._dotProduct(o,this._sub(n,i));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=.5*l,h=this._leftPerp(o),d=[i[0]+o[0]*c,i[1]+o[1]*c],p=t.length-1,f=[];f.push(r?[-h[0],-h[1]]:h);let m=[-o[0],-o[1]];for(let e=1;e<p-1;e++){const r=this._sub(t[e+1],t[e]);this._normalize(r);const s=this._dotProduct(r,m),i=this._crossProduct(r,m),n=Math.sqrt((1+s)/2),o=this._sub(r,m);this._normalize(o),o[0]/=n,o[1]/=n,f.push(i<0?[-o[0],-o[1]]:o),m=r}f.push(this._rightPerp(m));for(let r=f.length-1;r>0;r--)e.push([t[r][0]+f[r][0]*u,t[r][1]+f[r][1]*u]);e.push([d[0]+f[0][0]*u,d[1]+f[0][1]*u]),e.push([d[0]+f[0][0]*l,d[1]+f[0][1]*l]),e.push(s),e.push([d[0]-f[0][0]*l,d[1]-f[0][1]*l]),e.push([d[0]-f[0][0]*u,d[1]-f[0][1]*u]);for(let r=1;r<f.length;r++)e.push([t[r][0]-f[r][0]*u,t[r][1]-f[r][1]*u])}_addDash(e,t,r){const s=this._norm(r)/7;this._normalize(r);let i=[];for(let n=0;n<=7;n++)i.push([t[0]+r[0]*n*s,t[1]+r[1]*n*s]),1&n&&(e.push(i),i=[])}_cp2(e,t,r){return e.length>=2?e[1]:this._add2(e[0],t*this._defaultSize,r*this._defaultSize)}_cp3(e,t,r,s){if(e.length>=3)return e[2];const i=this._mix(e[0],1-r,t,r),n=this._sub(t,e[0]);return this._normalize(n),this._rightPerpendicular(n),[i[0]+n[0]*s*this._defaultSize,i[1]+n[1]*s*this._defaultSize]}_arrowPath(e){if(e.length>2)return e;const t=e[0],r=this._cp2(e,-4,0),s=this._sub(t,r);this._normalize(s);const i=this._rightPerp(s);return[t,r,[t[0]+(i[0]-s[0])*this._defaultSize,t[1]+(i[1]-s[1])*this._defaultSize]]}_arrowLastSeg(e){const t=e[0],r=this._cp2(e,-4,0);let s;if(e.length>=3)s=e[e.length-1];else{const e=this._sub(t,r);this._normalize(e);const i=this._rightPerp(e);s=[t[0]+(i[0]-e[0])*this._defaultSize,t[1]+(i[1]-e[1])*this._defaultSize]}return[r,s]}_processGeom(e){if(!e)return null;const t=[];for(const r of e){const e=r.length>1&&s.getPathLength(r)<this._defaultSize;if(!r||0===r.length||e)continue;const n=r.length;let o=r[0];switch(this._rule){case"PerpendicularFromFirstSegment":{const e=this._cp2(r,0,-1),s=this._cp3(r,e,.5,4),i=[];i.push(s),i.push(this._mid(o,e)),t.push(i);break}case"ReversedFirstSegment":{const e=this._cp2(r,0,-1);t.push([e,o]);break}case"PerpendicularToSecondSegment":{if(r.length<3)return[];const e=this._cp2(r,-4,1),s=this._cp3(r,e,.882353,-1.94),i=[];i.push(this._mid(e,s)),i.push(o),t.push(i);break}case"SecondSegmentWithTicks":{if(r.length<3)return[];const e=this._cp2(r,-4,1),s=this._cp3(r,e,.882353,-1.94),i=this._sub(s,e);let n;n=this._crossProduct(i,this._sub(o,e))>0?this._rightPerp(i):this._leftPerp(i);const a=[];a.push([e[0]+(n[0]-i[0])/3,e[1]+(n[1]-i[1])/3]),a.push(e),a.push(s),a.push([s[0]+(n[0]+i[0])/3,s[1]+(n[1]+i[1])/3]),t.push(a);break}case"DoublePerpendicular":{const e=this._cp2(r,0,-1),s=this._cp3(r,e,.5,3),i=this._mid(o,e),n=this._sub(i,s);this._normalize(n);const a=this._crossProduct(n,this._sub(o,s));this._leftPerpendicular(n);const l=[];l.push(o),l.push([s[0]+n[0]*a,s[1]+n[1]*a]),t.push(l);const c=[];c.push([s[0]-n[0]*a,s[1]-n[1]*a]),c.push(e),t.push(c);break}case"OppositeToFirstSegment":{const e=this._cp2(r,0,-1),s=this._cp3(r,e,.5,3),i=this._mid(o,e),n=this._sub(i,s);this._normalize(n);const a=this._crossProduct(n,this._sub(o,s));this._leftPerpendicular(n);const l=[];l.push([s[0]+n[0]*a,s[1]+n[1]*a]),l.push([s[0]-n[0]*a,s[1]-n[1]*a]),t.push(l);break}case"TriplePerpendicular":{const e=this._cp2(r,0,-1),s=this._cp3(r,e,.5,4),i=this._mid(o,e),n=this._sub(i,s);this._normalize(n);const a=this._crossProduct(n,this._sub(o,s));this._leftPerpendicular(n);const l=[];l.push([s[0]+n[0]*a*.8,s[1]+n[1]*a*.8]),l.push([i[0]+.8*(o[0]-i[0]),i[1]+.8*(o[1]-i[1])]),t.push(l),t.push([s,i]);const c=[];c.push([s[0]-n[0]*a*.8,s[1]-n[1]*a*.8]),c.push([i[0]+.8*(e[0]-i[0]),i[1]+.8*(e[1]-i[1])]),t.push(c);break}case"HalfCircleFirstSegment":{const e=this._cp2(r,0,-1),s=this._cp3(r,e,.5,4),i=this._mid(o,e);let n=this._sub(e,o);const a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18),c=Math.sqrt((1+a)/2),u=Math.sqrt((1-a)/2),h=[];let d;this._crossProduct(n,this._sub(s,o))>0?(h.push(o),n=this._sub(o,i),d=e):(h.push(e),n=this._sub(e,i),d=o),this._rotateDirect(n,c,u),n[0]/=c,n[1]/=c;for(let e=1;e<=18;e++)h.push(this._add(i,n)),this._rotateDirect(n,a,l);h.push(d),t.push(h);break}case"HalfCircleSecondSegment":{const e=this._cp2(r,0,-1),s=this._cp3(r,e,1,-1);let i=this._sub(o,e);this._normalize(i);const n=this._crossProduct(i,this._sub(s,e))/2;this._leftPerpendicular(i);const a=[e[0]+i[0]*n,e[1]+i[1]*n];i=this._sub(e,a);const l=Math.cos(Math.PI/18);let c=Math.sin(Math.PI/18);n>0&&(c=-c);const u=[e];for(let e=1;e<=18;e++)this._rotateDirect(i,l,c),u.push(this._add(a,i));t.push(u);break}case"HalfCircleExtended":{const e=this._cp2(r,0,-2),s=this._cp3(r,e,1,-1);let i;if(n>=4)i=r[3];else{const t=this._sub(o,e);i=this._add(s,t)}const a=this._dist(e,s)/2/.75,l=this._sub(e,o);this._normalize(l,a);const c=this._sub(s,i);this._normalize(c,a);const u=[i,s];t.push(u);const h=[this._clone(s)];this._addBezier3(h,s,this._add(s,c),this._add(e,l),e,4),h.push(o),t.push(h);break}case"OpenCircle":{const e=this._cp2(r,-2,0),s=this._sub(e,o),i=Math.cos(Math.PI/18),n=-Math.sin(Math.PI/18),a=[e];for(let e=1;e<=33;e++)this._rotateDirect(s,i,n),a.push(this._add(o,s));t.push(a);break}case"CoverageEdgesWithTicks":{const e=this._cp2(r,0,-1);let s,i;if(n>=3)s=r[2];else{const t=this._sub(e,o),r=this._leftPerp(t);s=[o[0]+r[0]-.25*t[0],o[1]+r[1]-.25*t[1]]}if(n>=4)i=r[3];else{const t=this._mid(o,e),r=this._sub(o,e);this._normalize(r),this._leftPerpendicular(r);const n=this._crossProduct(r,this._sub(s,t));this._rightPerpendicular(r),i=[s[0]+r[0]*n*2,s[1]+r[1]*n*2]}const a=this._sub(e,o);let l,c;l=this._crossProduct(a,this._sub(s,o))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push(s),c.push(o),c.push([o[0]+(l[0]-a[0])/3,o[1]+(l[1]-a[1])/3]),t.push(c),l=this._crossProduct(a,this._sub(i,e))>0?this._rightPerp(a):this._leftPerp(a),c=[],c.push([e[0]+(l[0]+a[0])/3,e[1]+(l[1]+a[1])/3]),c.push(e),c.push(i),t.push(c);break}case"GapExtentWithDoubleTicks":{const e=this._cp2(r,0,2),s=this._cp3(r,e,0,1);let i;if(n>=4)i=r[3];else{const t=this._sub(e,o);i=this._add(s,t)}this._addAngledTicks(t,o,e,this._mid(s,i)),this._addAngledTicks(t,s,i,this._mid(o,e));break}case"GapExtentMidline":{const e=this._cp2(r,2,0),s=this._cp3(r,e,0,1);let i;if(n>=4)i=r[3];else{const t=this._sub(e,o);i=this._add(s,t)}const a=[];a.push(this._mid(o,s)),a.push(this._mid(e,i)),t.push(a);break}case"Chevron":{const e=this._cp2(r,-1,-1);let s;if(n>=3)s=r[2];else{const t=this._sub(e,o);this._leftPerpendicular(t),s=this._add(o,t)}t.push([e,this._makeCtrlPt(o),s]);break}case"PerpendicularWithArc":{const e=this._cp2(r,0,-2),s=this._cp3(r,e,.5,-1),i=this._sub(e,o),a=this._norm(i);i[0]/=a,i[1]/=a;const l=this._crossProduct(i,this._sub(s,o));let c=this._dotProduct(i,this._sub(s,o));c<.05*a?c=.05*a:c>.95*a&&(c=.95*a);const u=[o[0]+i[0]*c,o[1]+i[1]*c];let h=this._leftPerp(i),d=[];if(d.push([u[0]-h[0]*l,u[1]-h[1]*l]),d.push([u[0]+h[0]*l,u[1]+h[1]*l]),t.push(d),n>=4){const e=r[3];let s=this._dotProduct(i,this._sub(e,o));s<.1*a?s=.1*a:s>.9*a&&(s=.9*a);const n=[o[0]+i[0]*s,o[1]+i[1]*s],l=this._crossProduct(i,this._sub(e,o)),c=[];c.push([n[0]-h[0]*l,n[1]-h[1]*l]),c.push([n[0]+h[0]*l,n[1]+h[1]*l]),t.push(c)}const p=[e[0]+h[0]*l,e[1]+h[1]*l];h=this._sub(e,p);const f=Math.cos(Math.PI/18);let m=Math.sin(Math.PI/18);l<0&&(m=-m),d=[o,e];for(let e=1;e<=9;e++)this._rotateDirect(h,f,m),d.push(this._add(p,h));t.push(d);break}case"ClosedHalfCircle":{const e=this._cp2(r,2,0),s=this._mid(o,e),i=this._sub(e,s),n=Math.cos(Math.PI/18),a=Math.sin(Math.PI/18),l=[o,e];for(let e=1;e<=18;e++)this._rotateDirect(i,n,a),l.push(this._add(s,i));t.push(l);break}case"TripleParallelExtended":{const e=this._cp2(r,0,-2),s=this._cp3(r,e,1,-2),n=this._mid(o,e),a=this._sub(s,e);this._normalize(a);const l=Math.abs(this._crossProduct(a,this._sub(n,e)))/2,c=this._dist(e,s),u=[e,o];u.push([o[0]+a[0]*c*.5,o[1]+a[1]*c*.5]),t.push(u);const h=[];h.push([n[0]-a[0]*l,n[1]-a[1]*l]),h.push([n[0]+a[0]*c*.375,n[1]+a[1]*c*.375]),i.setId(h[h.length-1],1),h.push([n[0]+a[0]*c*.75,n[1]+a[1]*c*.75]),t.push(h);const d=[e,s];t.push(d);break}case"ParallelWithTicks":{const e=this._cp2(r,3,0),s=this._cp3(r,e,.5,-1),i=this._sub(s,e);this._normalize(i);const n=this._crossProduct(i,this._sub(s,o));this._leftPerpendicular(i),this._addAngledTicks(t,o,e,s),this._addAngledTicks(t,this._mix(o,1,i,n),this._mix(e,1,i,n),this._mid(o,e));break}case"Parallel":{const e=this._cp2(r,3,0),s=this._cp3(r,e,.5,-1),i=this._sub(e,o);this._normalize(i);const n=this._leftPerp(i),a=this._crossProduct(i,this._sub(s,o));let l=[o,e];t.push(l),l=[],l.push([o[0]+n[0]*a,o[1]+n[1]*a]),l.push([e[0]+n[0]*a,e[1]+n[1]*a]),t.push(l);break}case"PerpendicularToFirstSegment":{const e=this._cp2(r,3,0),s=this._cp3(r,e,.5,-1),i=this._mid(o,e),n=this._sub(e,o);this._normalize(n);const a=this._crossProduct(n,this._sub(s,o));this._leftPerpendicular(n);const l=[];l.push([i[0]-n[0]*a*.25,i[1]-n[1]*a*.25]),l.push([i[0]+n[0]*a*1.25,i[1]+n[1]*a*1.25]),t.push(l);break}case"ParallelOffset":{const e=this._cp2(r,3,0),s=this._cp3(r,e,.5,-1),i=this._sub(e,o);this._normalize(i);const n=this._crossProduct(i,this._sub(s,o));this._leftPerpendicular(i);const a=[];a.push([o[0]-i[0]*n,o[1]-i[1]*n]),a.push([e[0]-i[0]*n,e[1]-i[1]*n]),t.push(a);const l=[];l.push([o[0]+i[0]*n,o[1]+i[1]*n]),l.push([e[0]+i[0]*n,e[1]+i[1]*n]),t.push(l);break}case"OffsetOpposite":{const e=this._cp2(r,3,0),s=this._cp3(r,e,.5,-1),i=this._sub(e,o);this._normalize(i);const n=this._crossProduct(i,this._sub(s,o));this._leftPerpendicular(i);const a=[];a.push([o[0]-i[0]*n,o[1]-i[1]*n]),a.push([e[0]-i[0]*n,e[1]-i[1]*n]),t.push(a);break}case"OffsetSame":{const e=this._cp2(r,3,0),s=this._cp3(r,e,.5,-1),i=this._sub(e,o);this._normalize(i);const n=this._crossProduct(i,this._sub(s,o));this._leftPerpendicular(i);const a=[];a.push([o[0]+i[0]*n,o[1]+i[1]*n]),a.push([e[0]+i[0]*n,e[1]+i[1]*n]),t.push(a);break}case"CircleWithArc":{let e=this._cp2(r,3,0);const s=this._cp3(r,e,.5,-1);let a,l;if(n>=4)a=r[3],l=this._crossProduct(this._sub(a,e),this._sub(s,e))>0;else{a=e,l=this._crossProduct(this._sub(a,o),this._sub(s,o))>0;const t=24*this._geomUnitsPerPoint,r=this._sub(a,o);this._normalize(r,t);const i=Math.sqrt(2)/2;this._rotateDirect(r,i,l?i:-i),e=this._add(o,r)}const c=this._sub(e,o),u=Math.cos(Math.PI/18),h=Math.sin(Math.PI/18),d=[e];for(let e=1;e<=36;e++)this._rotateDirect(c,u,h),d.push(this._add(o,c));this._add90DegArc(d,e,a,s,l),i.setId(d[d.length-8],1),t.push(d);break}case"DoubleJog":{let e,s=this._cp2(r,-3,1),i=this._cp3(r,s,-1,-.5);if(n>=4)e=r[3];else{const t=o;o=s,e=i;const r=this._dist(o,t),n=this._dist(e,t);let a=30*this._geomUnitsPerPoint;.5*r<a&&(a=.5*r),.5*n<a&&(a=.5*n),s=this._mix(o,a/r,t,(r-a)/r),i=this._mix(e,a/n,t,(n-a)/n)}const a=this._mid(o,s),l=this._mid(e,i),c=this._dist(o,s),u=this._dist(i,e);let h=Math.min(c,u)/8;h=Math.min(h,24*this._geomUnitsPerPoint);const d=Math.cos(Math.PI/4);let p=this._sub(o,s);this._normalize(p,h),this._crossProduct(p,this._sub(e,s))>0?this._rotateDirect(p,d,-d):this._rotateDirect(p,d,d);let f=[];f.push(s),f.push(this._add(a,p)),f.push(this._sub(a,p)),f.push(o),t.push(f),p=this._sub(e,i),this._normalize(p,h),this._crossProduct(p,this._sub(o,i))<0?this._rotateDirect(p,d,d):this._rotateDirect(p,d,-d),f=[],f.push(i),f.push(this._add(l,p)),f.push(this._sub(l,p)),f.push(e),t.push(f);break}case"PerpendicularOffset":{const e=this._cp2(r,-4,1),s=this._cp3(r,e,.882353,-1.94),i=this._sub(s,e);this._crossProduct(i,this._sub(o,e))>0?this._rightPerpendicular(i):this._leftPerpendicular(i);const n=[i[0]/8,i[1]/8],a=this._sub(this._mid(e,s),n);t.push([a,o]);break}case"LineExcludingLastSegment":{const e=this._arrowPath(r),s=[];let i=e.length-2;for(;i--;)s.push(e[i]);t.push(s);break}case"MultivertexArrow":{const e=this._arrowPath(r),s=[];this._addArrow(s,e,!1),t.push(s);break}case"CrossedArrow":{const e=this._arrowPath(r),s=[];this._addArrow(s,e,!0),t.push(s);break}case"ChevronArrow":{const[e,s]=this._arrowLastSeg(r),i=10*this._geomUnitsPerPoint,n=this._sub(o,e),a=this._norm(n);this._normalize(n);const l=this._crossProduct(n,this._sub(s,e));let c=this._dotProduct(n,this._sub(s,e));c<.05*a?c=.05*a:c>.95*a-i&&(c=.95*a-i);const u=[e[0]+n[0]*c,e[1]+n[1]*c],h=this._leftPerp(n),d=[];d.push([u[0]+h[0]*l+n[0]*i,u[1]+h[1]*l+n[1]*i]),d.push(o),d.push([u[0]-h[0]*l+n[0]*i,u[1]-h[1]*l+n[1]*i]),t.push(d);break}case"ChevronArrowOffset":{const[e,s]=this._arrowLastSeg(r),i=this._sub(o,e),n=this._norm(i);this._normalize(i);const a=this._crossProduct(i,this._sub(s,e));let l=this._dotProduct(i,this._sub(s,e));l<.05*n?l=.05*n:l>.95*n&&(l=.95*n);const c=[e[0]+i[0]*l,e[1]+i[1]*l];this._leftPerpendicular(i);const u=[];u.push([c[0]+i[0]*a*.5,c[1]+i[1]*a*.5]),u.push(this._mid(c,o)),u.push([c[0]-i[0]*a*.5,c[1]-i[1]*a*.5]),t.push(u);break}case"PartialFirstSegment":{const[e,s]=this._arrowLastSeg(r),i=this._sub(o,e),n=this._norm(i);this._normalize(i);let a=this._dotProduct(i,this._sub(s,e));a<.05*n?a=.05*n:a>.95*n&&(a=.95*n);const l=[e[0]+i[0]*a,e[1]+i[1]*a];t.push([e,l]);break}case"Arch":{const e=this._cp2(r,0,-1),s=this._cp3(r,e,.5,1),i=this._sub(o,e),n=this._mix(s,1,i,.55),a=this._mix(s,1,i,-.55),l=[o];this._addBezier2(l,o,n,s,4),this._addBezier2(l,s,a,e,4),t.push(l);break}case"CurvedParallelTicks":{const e=this._cp2(r,-4,1),s=this._cp3(r,e,.882353,-1.94),i=this._sub(s,e);this._crossProduct(i,this._sub(o,e))>0?this._rightPerpendicular(i):this._leftPerpendicular(i);const n=[i[0]/8,i[1]/8],a=this._sub(this._mid(e,s),n),l=this._sub(this._mix(e,.75,s,.25),n),c=this._sub(this._mix(e,.25,s,.75),n),u=[e];this._addBezier2(u,e,l,a,3),this._addBezier2(u,a,c,s,3),t.push(u);for(let e=0;e<8;e++){const r=u[2*e+1],s=[this._clone(r)];s.push(this._add(r,[i[0]/4,i[1]/4])),t.push(s)}break}case"Arc90Degrees":{const e=this._cp2(r,0,-1),s=this._cp3(r,e,.5,1),i=[e];this._add90DegArc(i,e,o,s),t.push(i);break}case"TipWithPerpendicularAndTicks":{const[e,s]=this._arrowLastSeg(r),i=10*this._geomUnitsPerPoint,n=this._sub(o,e),a=this._norm(n);this._normalize(n);let l=this._crossProduct(n,this._sub(s,e)),c=this._dotProduct(n,this._sub(s,e));c<.05*a?c=.05*a:c>.95*a-i&&(c=.95*a-i);const u=this._leftPerp(n),h=[o[0]-n[0]*i,o[1]-n[1]*i],d=.5*Math.max(a-c-i,i);l=Math.abs(l);const p=[];p.push([h[0]+u[0]*(l+d)-n[0]*d,h[1]+u[1]*(l+d)-n[1]*d]),p.push([h[0]+u[0]*l,h[1]+u[1]*l]),p.push([h[0]-u[0]*l,h[1]-u[1]*l]),p.push([h[0]-u[0]*(l+d)-n[0]*d,h[1]-u[1]*(l+d)-n[1]*d]),t.push(p),t.push([h,o]);break}case"ConcentricCircles":{const e=this._cp2(r,1,0),s=this._cp3(r,e,2,0),a=Math.cos(Math.PI/18),l=Math.sin(Math.PI/18);let c=this._dist(e,o),u=[c,0],h=[];for(let e=0;e<=36;e++)h.push(this._add(o,u)),this._rotateDirect(u,a,l);if(t.push(h),n>=4){h=[];const e=r[3];c=this._dist(e,o),u=[c,0];for(let e=0;e<=36;e++)h.push(this._add(o,u)),0===e&&(h.push(this._add(o,u)),i.setId(h[1],1)),this._rotateDirect(u,a,l);t.push(h)}h=[],c=this._dist(s,o),u=[c,0];for(let e=0;e<=36;e++)h.push(this._add(o,u)),this._rotateDirect(u,a,l);t.push(h);break}case"DoubleJogArrow":{o=this._arrowPath(r)[0];const[e,s]=this._arrowLastSeg(r),i=this._sub(o,e),n=this._norm(i);this._normalize(i);const a=Math.abs(this._crossProduct(i,this._sub(s,o)));let l=Math.abs(this._dotProduct(i,this._sub(s,o)));l<.05*n?l=.05*n:l>.95*n&&(l=.95*n);const c=Math.max(a,l),u=this._leftPerp(i);let h=[];const d=[o[0]-i[0]*l*.5+u[0]*a*.5,o[1]-i[1]*l*.5+u[1]*a*.5];h.push([d[0],d[1]]),d[0]+=i[0]*c*.5+u[0]*c*.4,d[1]+=i[1]*c*.5+u[1]*c*.4,h.push([d[0],d[1]]),d[0]-=u[0]*c*.25,d[1]-=u[1]*c*.25,h.push([d[0],d[1]]),d[0]+=i[0]*c*.5+u[0]*c*.4,d[1]+=i[1]*c*.5+u[1]*c*.4,h.push([d[0],d[1]]),t.push(h),h=[],d[0]=o[0]-i[0]*l*.5-u[0]*a*.5,d[1]=o[1]-i[1]*l*.5-u[1]*a*.5,h.push([d[0],d[1]]),d[0]+=i[0]*c*.5-u[0]*c*.4,d[1]+=i[1]*c*.5-u[1]*c*.4,h.push([d[0],d[1]]),d[0]+=u[0]*c*.25,d[1]+=u[1]*c*.25,h.push([d[0],d[1]]),d[0]+=i[0]*c*.5-u[0]*c*.4,d[1]+=i[1]*c*.5-u[1]*c*.4,h.push([d[0],d[1]]),t.push(h);break}case"LinkedChevrons":{const e=this._cp2(r,-5,0),s=this._cp3(r,e,-.2,1),i=this._sub(o,e);this._normalize(i);const n=this._leftPerp(i),a=Math.abs(this._crossProduct(i,this._sub(s,e)));t.push([e,o]);const l=[];l.push([o[0]-i[0]*a+n[0]*a,o[1]-i[1]*a+n[1]*a]),l.push(o),l.push([o[0]-i[0]*a-n[0]*a,o[1]-i[1]*a-n[1]*a]),t.push(l),this._addDash(t,e,[-i[0]*a+n[0]*a,-i[1]*a+n[1]*a]),this._addDash(t,e,[-i[0]*a-n[0]*a,-i[1]*a-n[1]*a]);break}case"SegmentThenHalfCircle":{const e=this._cp2(r,2,0),s=this._cp3(r,e,1.5,0);let i;i=n>=4?r[3]:this._cp3(r,e,1.25,-.5);const a=this._sub(e,o);this._normalize(a);const l=.5*this._dist(e,s),c=this._crossProduct(a,this._sub(i,o))>0,u=Math.cos(Math.PI/18);let h=Math.sin(Math.PI/18);c&&(h=-h);const d=[o,e];a[0]*=l,a[1]*=l;const p=this._add(e,a);a[0]=-a[0],a[1]=-a[1];for(let e=1;e<=18;e++)this._rotateDirect(a,u,h),d.push(this._add(p,a));t.push(d);break}case"LineWithStraightTicks":{const e=this._cp2(r,-2,1),s=this._cp3(r,e,-1,-.5),i=this._sub(s,e);this._normalize(i);const n=this._dotProduct(i,this._sub(e,o)),a=this._dotProduct(i,this._sub(s,o));let l=[o];l.push([o[0]+i[0]*n,o[1]+i[1]*n]),l.push(e),t.push(l),l=[o],l.push([o[0]+i[0]*a,o[1]+i[1]*a]),l.push(s),t.push(l);break}case"DoubleCurve":{const e=this._cp2(r,-5,-1),s=this._cp3(r,e,2,0),n=Math.atan2(1,5),a=Math.cos(n),l=Math.sin(n),c=this._sub(e,o),u=this._dist(o,e);this._normalize(c),this._rotateDirect(c,a,-l);const h=[o];h.push([o[0]+c[0]*u*.5,o[1]+c[1]*u*.5]),i.setId(h[1],1),h.push([o[0]+c[0]*u*.8,o[1]+c[1]*u*.8]),this._addBezier2(h,h[2],[o[0]+c[0]*u,o[1]+c[1]*u],e,3);const d=this._sub(s,e),p=this._dist(e,s);this._normalize(d),this._rotateDirect(d,a,-l),this._addBezier2(h,e,[s[0]-d[0]*p,s[1]-d[1]*p],[s[0]-d[0]*p*.8,s[1]-d[1]*p*.8],3),h.push(s),t.push(h);break}case"ParallelWithTicksByWidth":{const e=this._cp2(r,0,-1),s=this._cp3(r,e,.5,3),i=this._sub(e,o);this._normalize(i);const n=this._crossProduct(i,this._sub(s,o));this._leftPerpendicular(i),n>0?(this._addAngledTicks(t,o,[o[0]+i[0]*n,o[1]+i[1]*n],e),this._addAngledTicks(t,e,[e[0]+i[0]*n,e[1]+i[1]*n],o)):(this._addAngledTicks(t,[o[0]+i[0]*n,o[1]+i[1]*n],o,e),this._addAngledTicks(t,[e[0]+i[0]*n,e[1]+i[1]*n],o,e));break}case"EnclosingRoundedRectangle":{const e=this._cp2(r,3,-2),t=[Math.min(o[0],e[0]),Math.max(o[1],e[1])],s=[Math.max(o[0],e[0]),Math.min(o[1],e[1])],i=s[0]-t[0],n=t[1]-s[1],a=Math.min(i,n)/10,l=[];l.push([t[0]+a+.75*(i-2*a),t[1]]),l.push([s[0]-a,t[1]]),this._add90DegArc(l,[s[0]-a,t[1]],[s[0],t[1]-a],[s[0],t[1]]),l.push([s[0],s[1]+a]),this._add90DegArc(l,[s[0],s[1]+a],[s[0]-a,s[1]],s),l.push([t[0]+a,s[1]]),this._add90DegArc(l,[t[0]+a,s[1]],[t[0],s[1]+a],[t[0],s[1]]),l.push([t[0],t[1]-a]),this._add90DegArc(l,[t[0],t[1]-a],[t[0]+a,t[1]],t),l.push([t[0]+a+.75*(i-2*a),t[1]]);break}default:t.push(r)}}return t}}e.EffectControlMeasureLine=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectCut":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(e,t,r,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r){return new n(e,t,r)}}class n extends r.PathEffectCursor{constructor(e,t,r){super(e,!0,!0),this._curveHelper=new s.CurveHelper,this._beginCut=(void 0!==t.beginCut?t.beginCut:1)*r,this._endCut=(void 0!==t.endCut?t.endCut:1)*r,this._middleCut=(void 0!==t.middleCut?t.middleCut:0)*r,this._invert=void 0!==t.invert&&t.invert,this._beginCut<0&&(this._beginCut=0),this._endCut<0&&(this._endCut=0),this._middleCut<0&&(this._middleCut=0)}processPath(e){const{_beginCut:r,_endCut:s,_middleCut:i}=this,n=e.pathLength(),o=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._invert){if(0!==r||0!==s||0!==i)if(r+s+i>=n)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else this._curveHelper.appendSubCurve(o,e,0,r),this._curveHelper.appendSubCurve(o,e,.5*(n-i),.5*(n+i)),this._curveHelper.appendSubCurve(o,e,n-s,s)}else if(0===r&&0===s&&0===i)for(o.startPath();e.nextPoint();)o.pushXY(e.x,e.y);else r+s+i<n&&(0===i?this._curveHelper.appendSubCurve(o,e,r,n-s):(this._curveHelper.appendSubCurve(o,e,r,.5*(n-i)),this._curveHelper.appendSubCurve(o,e,.5*(n+i),n-s)));return 0===o.totalSize?null:o}}e.EffectCut=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDashes":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMCursor","../GeometryWalker","../utils"],function(e,t,r,s,i,n){"use strict";class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r){return new a(e,t,r)}}class a extends s.PathEffectCursor{constructor(e,t,r){super(e,!0,!0),this._firstCurve=null,this._walker=new i.GeometryWalker,this._walker.updateTolerance(r),this._endings=t.lineDashEnding,this._customDashPos=-(t.offsetAlongLine??0)*r,this._offsetAtEnd=(t.customEndingOffset??0)*r;let s=n.normalizeDashEffectTemplate(t).dashTemplate;null==s&&(s=[]),s.length%2&&(s=[...s,...s]),this._pattern=new i.DashPattern,this._pattern.init(s,!0),this._pattern.scale(r)}processPath(e){if(0===this._pattern.length()){this.iteratePath=!1;const s=r.collectPath(e);return t.GeometryCursor.fromJSONCIM({paths:[s]})}if(!this.iteratePath){let s=!0;switch(this._endings){case"HalfPattern":case"HalfGap":default:this._pattern.extPtGap=0;break;case"FullPattern":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.firstValue());break;case"FullGap":this.isClosed||(this._pattern.extPtGap=.5*this._pattern.lastValue());break;case"NoConstraint":this.isClosed||(s=!1);break;case"Custom":this.isClosed||(this._pattern.extPtGap=.5*this._offsetAtEnd)}const i=e.pathLength();if(this._pattern.isEmpty()||i<.1*this._pattern.length()){const s=r.collectPath(e);return t.GeometryCursor.fromJSONCIM({paths:[s]})}if(!this._walker.init(e,this._pattern,s)){const s=r.collectPath(e);return t.GeometryCursor.fromJSONCIM({paths:[s]})}}let s;if(this.iteratePath)s=this._pattern.nextValue();else{let e;switch(this._endings){case"HalfPattern":default:e=.5*this._pattern.firstValue();break;case"HalfGap":e=.5*-this._pattern.lastValue();break;case"FullGap":e=-this._pattern.lastValue();break;case"FullPattern":e=0;break;case"NoConstraint":case"Custom":e=-this._customDashPos}let t=e/this._pattern.length();t-=Math.floor(t),e=t*this._pattern.length(),this._pattern.reset(),s=this._pattern.nextValue();let r=!1;for(;e>=s;)e-=s,s=this._pattern.nextValue(),r=!r;s-=e,r?(this._walker.nextPosition(s),s=this._pattern.nextValue()):this.isClosed&&(this._firstCurve=this._walker.nextCurve(s),s=this._pattern.nextValue(),this._walker.nextPosition(s),s=this._pattern.nextValue())}let i=this._walker.nextCurve(s);if(i)if(this._walker.isPathEnd()){if(this.iteratePath=!1,this._firstCurve){for(this._firstCurve.nextPath();this._firstCurve.nextPoint();)i.pushXY(this._firstCurve.x,this._firstCurve.y);this._firstCurve=null}}else s=this._pattern.nextValue(),!this._walker.nextPosition(s)||this._walker.isPathEnd()?(this.iteratePath=!1,this._firstCurve&&(i.pushCursor(this._firstCurve),this._firstCurve=null)):this.iteratePath=!0;else this.iteratePath=!1,i=this._firstCurve,this._firstCurve=null;return i?.reset(),i}}e.EffectDashes=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/GeometryWalker":function(){define(["exports","../../geometry/GeometryCursor","./CurveHelper"],function(e,t,r){"use strict";class s{constructor(){this.reset()}reset(){this.segment=null,this.segmentLength=0,this.abscissa=0,this.isPathEnd=!1,this.isPartEnd=!1}isValid(){return null!==this.segment}copyTo(e){e.segment=this.segment,e.segmentLength=this.segmentLength,e.abscissa=this.abscissa,e.isPathEnd=this.isPathEnd,e.isPartEnd=this.isPartEnd}}class i extends r.CurveHelper{constructor(e=0,t=!1){super(e,t),this._tempPos=new s,this._tempPt=[0,0],this._tolerance=r.pixelTolerance,this._currentPosition=new s}updateTolerance(e){this._tolerance=r.pixelTolerance*e}init(e,t,r=!0){return r?(this._patternLength=t.length(),this._partExtPtGap=t.extPtGap,this._partCtrlPtGap=t.ctrlPtGap):(this._patternLength=0,this._partExtPtGap=0,this._partCtrlPtGap=0),this._currentPosition.reset(),this._partSegCount=0,this._pathCursor=e,this._seg=-1,this._setPosAtNextPart()}curPositionIsValid(){return this._currentPosition.isValid()}nextPosition(e,t=0){const r=new s;return!!this._nextPosition(e,r,null,t)&&(r.copyTo(this._currentPosition),!0)}curPointAndAngle(e){e.pt=this._getPoint(this._currentPosition);const[t,r]=this._getAngleCS(this._tempPt,this._currentPosition);e.ca=t,e.sa=r}nextPointAndAngle(e,t,r=0){const s=this._tempPos;if(!this._nextPosition(e,s,null,r))return!1;s.copyTo(this._currentPosition),t.pt=this._getPoint(s);const[i,n]=this._getAngleCS(this._tempPt,s);return t.ca=i,t.sa=n,!0}nextCurve(e){if(0===e)return null;const r=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");r.startPath(),r.nextPath();const i=new s;return this._nextPosition(e,i,r,1)?(i.copyTo(this._currentPosition),r):null}isPathEnd(){return this._currentPosition.isPathEnd}getPathEnd(){return this._currentPosition.segment[1]}getPt(e){return this._pathCursor.seekInPath(e),[this._pathCursor.x,this._pathCursor.y]}getSeg(e){return[this.getPt(e),this.getPt(e+1)]}_nextPosition(e,t,r,s){if(this._currentPosition.isPathEnd)return!1;let i=this._currentPosition.abscissa;for(this._currentPosition.segmentLength>0&&(i/=this._currentPosition.segmentLength),this._currentPosition.copyTo(t);t.abscissa+e*this._partLengthRatio>t.segmentLength+this._tolerance;){if(r){if(0===r.pathSize)if(0===i){const e=t.segment[0];r.pushXY(e[0],e[1])}else r.pushPoint(this.getSegCoord2D(t.segment,i));const e=t.segment[1];r.pushXY(e[0],e[1])}if(i=0,e-=(t.segmentLength-t.abscissa)/this._partLengthRatio,this._partSegCount)t.segment=this._nextSegment(),t.segmentLength=this.getSegLength(t.segment),t.abscissa=0,this._partSegCount--;else{if(!this._setPosAtNextPart())return 0!==s&&(t.segmentLength=this.getSegLength(t.segment),t.isPartEnd=!0,1===s?(t.abscissa=t.segmentLength,t.isPathEnd=!0):t.abscissa=t.segmentLength+e,!0);this._currentPosition.copyTo(t)}}if(t.abscissa+=e*this._partLengthRatio,r){0===r.pathSize&&(0===i?r.pushPoint(t.segment[0]):r.pushPoint(this.getSegCoord2D(t.segment,i)));const e=t.abscissa/t.segmentLength;1===e?r.pushPoint(t.segment[1]):r.pushPoint(this.getSegCoord2D(t.segment,e))}return this._partSegCount||Math.abs(t.abscissa-t.segmentLength)<this._tolerance&&(t.isPathEnd=this._partIsLast,t.isPartEnd=!0),!0}_getPoint(e){const t=e.segmentLength<=0?0:e.abscissa/e.segmentLength;return this.getSegCoord2D(this._currentPosition.segment,t)}_getAngleCS(e,t){const r=t.segmentLength<=0?0:t.abscissa/t.segmentLength;return this.getSegAngleCS(e,this._currentPosition.segment,r)}_setPosAtNextPart(){for(;this._partSegCount;)this._hasNextSegment()&&this._nextSegment(),this._partSegCount--;if(!this._hasNextSegment())return!1;for(this._partLength=0,this._partIsLast=!0,this._partSegCount=0;this._hasNextSegment();)if(this._partLength+=this.getSegLength(this._nextSegment()),this._partSegCount++,this._pathCursor.getControlPointAt(this._getEndPointIndex())){this._partIsLast=!this._hasNextSegment();break}let e=this._partSegCount;for(;e;)this._previousSegment(),--e;this._currentPosition.segment=this._nextSegment(),this._currentPosition.segmentLength=this.getSegLength(this._currentPosition.segment),this._currentPosition.abscissa=0,this._currentPosition.isPathEnd=this._currentPosition.isPartEnd=!1,--this._partSegCount;const t=this._getStartPointIndex();this._ctrlPtBegin=this._pathCursor.getControlPointAt(t);let r=t+this._partSegCount+1;if(r>=this._pathCursor.pathSize&&(r=0),this._ctrlPtEnd=this._pathCursor.getControlPointAt(r),this._patternLength>0){const e=this._ctrlPtBegin?this._partCtrlPtGap:this._partExtPtGap,t=this._ctrlPtEnd?this._partCtrlPtGap:this._partExtPtGap;let r=Math.round((this._partLength-(e+t))/this._patternLength);r<=0&&(r=e+t>0?0:1),this._partLengthRatio=this._partLength/(e+t+r*this._patternLength),this._partLengthRatio<.01&&(this._partLengthRatio=1)}else this._partLengthRatio=1;return!0}_hasNextSegment(){return this._seg<this._pathCursor.pathSize-2}_previousSegment(){return this.getSeg(--this._seg)}_nextSegment(){return this.getSeg(++this._seg)}_getStartPointIndex(){return this._seg}_getEndPointIndex(){return this._seg+1}}e.DashPattern=class{constructor(){this._values=[],this.extPtGap=0,this.ctrlPtGap=0,this._length=0,this._currentValue=0}isEmpty(){return 0===this._values.length}size(){return this._values.length}init(e,t,r=!0){if(this._setEmpty(),!e||0===e.length)return!1;for(let t=0;t<e.length;t++){let s=Math.abs(e[t]);r&&s<1e-7&&(s=1e-7),this._values.push(s),this._length+=s}return t&&1&e.length&&(this._length*=2),0!==this._length&&(this.ctrlPtGap=this.extPtGap=0,this._currentValue=-1,!0)}scale(e){const t=this._values?this._values.length:0;for(let r=0;r<t;++r)this._values[r]*=e;this._length*=e,this.extPtGap*=e,this.ctrlPtGap*=e}addValue(e){this._length+=e,this._values.push(e)}firstValue(){return this._values[0]}lastValue(){return this._values[this._values.length-1]}nextValue(){return this._currentValue++,this._currentValue===this._values.length&&(this._currentValue=0),this._values[this._currentValue]}reset(){this._currentValue=-1}length(){return this._length}_setEmpty(){this.extPtGap=this.ctrlPtGap=this._length=0,this._currentValue=-1,this._values.length=0}},e.GeometryWalker=i,e.Pos=class{constructor(){this.pt=null,this.ca=0,this.sa=0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectDonut":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../CIMEffects"],function(e,t,r,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r,s,i,o){return new n(e,t,r,s,i,o)}}class n{constructor(e,t,r,s,i,n){this._preventClipping=n,this._inputGeometries=e,this._tileKey=s,this._maxInflateSize=i*r,this._width=(void 0!==t.width?t.width:2)*r,t.method,this._option=t.option}next(){let e;for(;e=this._inputGeometries.next();){if("esriGeometryEnvelope"===e.geometryType&&this._width>0){const r=e.asJSON();return Math.min(r.xmax-r.xmin,r.ymax-r.ymin)-2*this._width<0?e:t.GeometryCursor.fromJSONCIM({paths:[[[r.xmin+this._width,r.ymin+this._width],[r.xmax-this._width,r.ymin+this._width],[r.xmax-this._width,r.ymax-this._width],[r.xmin+this._width,r.ymax-this._width],[r.xmin+this._width,r.ymin+this._width]],[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]})}if("esriGeometryPolygon"===e.geometryType){if(0===this._width)return e.clone();const t=s.lazyBufferOperator.module,i=!this._preventClipping&&this._tileKey?s.clipCursorToTileExtent(e,this._maxInflateSize,!0):e.clone();if(!i)continue;const n={...i.asJSON(),spatialReference:{wkid:r.WebMercator.wkid}},o=t.execute(n,-this._width);if(o)for(const e of o.rings)if(e){i.startPath();for(const t of e.reverse())i.pushXY(t[0],i.yFactor*t[1])}return i}}return null}}e.EffectDonut=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectEnclosingPolygon":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../../../geometry/support/boundsUtils","../CIMEffects"],function(e,t,r,s,i){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t){return new o(e,t)}}class o{constructor(e,t){this._inputGeometries=e,this._medhod=t.method}next(){let e=this._inputGeometries.next();const t=this._medhod;for(;null!=e;){if(e.totalSize>0)switch(t){case"RectangularBox":return a(e);case"ConvexHull":return this._constructConvexHull(e);default:return l(e)}e=this._inputGeometries.next()}return null}_constructConvexHull(e){switch(e.geometryType){case"esriGeometryPolyline":case"esriGeometryPolygon":{const s=i.lazyConvexHullOperator.module,n={...e.asJSON(),spatialReference:{wkid:r.WebMercator.wkid}},o=s.execute(n);return o?t.GeometryCursor.fromJSONCIM(o):null}case"esriGeometryEnvelope":return e;default:return null}}}function a(e){const r=s.getCursorBoundsXY(e),i={xmin:r[0],ymin:r[1],xmax:r[2],ymax:r[3]};return t.GeometryCursor.fromJSONCIM(i)}function l(e){switch(e.geometryType){case"esriGeometryPolyline":{const r=[];for(;e.nextPath();)c(e,r);return t.GeometryCursor.fromJSONCIM({rings:r})}case"esriGeometryPolygon":case"esriGeometryEnvelope":return e;default:return null}}function c(e,t){if(e.seekPathStart(),!e.nextPoint())return;const r=e.x,s=e.y,i=[[r,s]];for(t.push(i);e.nextPoint();)i.push([e.x,e.y]);i.push([r,s])}e.EffectEnclosingPolygon=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectJog":function(){define(["exports","../../../geometry/GeometryCursor","../CIMCursor","../CurveHelper"],function(e,t,r,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r){return new n(e,t,r)}}class n extends r.PathEffectCursor{constructor(e,t,r){super(e,!1,!0),this._curveHelper=new s.CurveHelper,this._length=(void 0!==t.length?t.length:20)*r,this._angle=void 0!==t.angle?t.angle:225,this._position=void 0!==t.position?t.position:50,this._length<0&&(this._length=-this._length),this._position<20&&(this._position=20),this._position>80&&(this._position=80),this._mirror=!1}processPath(e){const r=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");if(this._curveHelper.isEmpty(e))return null;e.seekInPath(0);const s=e.x,i=e.y;e.seekInPath(e.pathSize-1);const n=e.x,o=e.y,a=[n-s,o-i];this._curveHelper.normalize(a);const l=s+(n-s)*this._position/100,c=i+(o-i)*this._position/100,u=Math.cos((90-this._angle)/180*Math.PI);let h=Math.sin((90-this._angle)/180*Math.PI);this._mirror&&(h=-h),this._mirror=!this._mirror;const d=[l-this._length/2*u,c-this._length/2*h],p=[l+this._length/2*u,c+this._length/2*h];return r.pushPath([[s,i],d,p,[n,o]]),r}}e.EffectJog=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectMove":function(){define(["exports"],function(e){"use strict";class t{static{this.instance=null}static local(){return null===t.instance&&(t.instance=new t),t.instance}execute(e,t,s){return new r(e,t,s)}}class r{constructor(e,t,r){this._inputGeometries=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0}next(){let e=this._inputGeometries.next();for(;e;){if(e.totalSize>0)return this._move(e.clone(),this._offsetX,this._offsetY);e=this._inputGeometries.next()}return null}_move(e,t,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=e.x+t,e.y=e.y+r;return e.reset(),e}}e.EffectMove=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectOffset":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../../../geometry/SpatialReference","../../../geometry/support/jsonUtils","../CIMEffects","../CurveHelper"],function(e,t,r,s,i,n,o){"use strict";class a{static{this.instance=null}static local(){return null===a.instance&&(a.instance=new a),a.instance}execute(e,t,r,s,i,n){return new l(e,t,r,s,i,n)}}class l{constructor(e,t,r,s,i,n){this._preventClipping=n,this._inputGeometries=e,this._tileKey=s,this._curveHelper=new o.CurveHelper,this._offset=(t.offset??1)*r,this._method=t.method,this._maxInflateSize=Math.max(Math.abs(i*r),10),this._option=t.option,this._offsetFlattenError=o.pixelTolerance*r}next(){let e;for(;e=this._inputGeometries.next();){if(0===this._offset)return e.clone();if("esriGeometryEnvelope"===e.geometryType){if("Rounded"===this._method&&this._offset>0){const s=r.collectPath(e),i=this._curveHelper.offset(s,-this._offset,this._method,4,this._offsetFlattenError);if(i){const r=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);return r.pushPath(i),r}return null}const s=e.asJSON();if(i.isExtent(s)&&Math.min(s.xmax-s.xmin,s.ymax-s.ymin)+2*this._offset>0)return t.GeometryCursor.fromJSONCIM({xmin:s.xmin-this._offset,xmax:s.xmax+this._offset,ymin:s.ymin-this._offset,ymax:s.ymax+this._offset})}const o=!this._preventClipping&&this._tileKey?n.clipCursorToTileExtent(e,this._maxInflateSize,!0):e.clone();if(!o)continue;const a=n.lazyOffsetOperator.module,l={...o.asJSON(),spatialReference:{wkid:s.WebMercator.wkid}},u=a.execute(l,-this._offset,{joins:c(this._method),flattenError:this._offsetFlattenError,miterLimit:4});return u?t.GeometryCursor.fromJSONCIM(u):null}return null}}function c(e){switch(e){case"Rounded":return"round";case"Bevelled":return"bevel";case"Mitered":return"miter";case"Square":return"square"}}e.EffectOffset=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRadial":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/support/centroid","../defaultCIMValues"],function(e,t,r,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r){return new n(e,t,r)}}class n{constructor(e,t,r){this._inputGeometries=e,this._length=(void 0!==t.length?t.length:s.defaultCIMValues.CIMGeometricEffectRadial.length)*r,this._angle=void 0!==t.angle?t.angle*Math.PI/180:s.defaultCIMValues.CIMGeometricEffectRadial.angle,this._lx=Math.cos(this._angle)*this._length,this._ly=Math.sin(this._angle)*this._length}next(){let e=this._inputGeometries.next();for(;e;){if("esriGeometryPoint"===e.geometryType||"esriGeometryMultipoint"===e.geometryType){const r=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return e.nextPath()&&e.nextPoint()&&r.pushPath([[e.x,e.y],[e.x+this._lx,e.y+this._ly]]),r}if("esriGeometryPolygon"===e.geometryType){const s=r.ringsCentroidCursor(e);if(!s)return null;const i=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolyline");return i.pushPath([[s[0],s[1]],[s[0]+this._lx,s[1]+this._ly]]),i}e=this._inputGeometries.next()}return null}}e.EffectRadial=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectReverse":function(){define(["exports"],function(e){"use strict";class t{static{this.instance=null}static local(){return null===t.instance&&(t.instance=new t),t.instance}execute(e,t,s){return new r(e,t,s)}}class r{constructor(e,t,r){this._inputGeometries=e,this._reverse=void 0===t.reverse||t.reverse}next(){let e=this._inputGeometries.next();for(;e;){if(!this._reverse)return e;if("esriGeometryPolyline"===e.geometryType)return s(e.clone());e=this._inputGeometries.next()}return null}}function s(e){for(;e.nextPath();)for(let t=0;t<e.pathSize/2;t++){e.seekInPath(t);const r=e.x,s=e.y;e.seekInPath(e.pathSize-t-1);const i=e.x,n=e.y;e.x=r,e.y=s,e.seekInPath(t),e.x=i,e.y=n}return e.reset(),e}e.EffectReverse=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectRotate":function(){define(["exports","../../../geometry/support/boundsUtils"],function(e,t){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,r){return new s(e,t,r)}}class s{constructor(e,t,r){this._inputGeometries=e,this._rotateAngle=void 0!==t.angle?t.angle*Math.PI/180:0}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._rotateAngle||"esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const r=t.getCursorBoundsXY(e),s=(r[2]+r[0])/2,i=(r[3]+r[1])/2;return e.reset(),this._rotate(e.clone(),s,i)}e=this._inputGeometries.next()}return null}_rotate(e,t,r){const s=Math.cos(this._rotateAngle),i=Math.sin(this._rotateAngle);for(;e.nextPath();)for(;e.nextPoint();){const n=e.x-t,o=e.y-r;e.x=t+n*s-o*i,e.y=r+n*i+o*s}return e.reset(),e}}e.EffectRotate=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectScale":function(){define(["exports","../../../geometry/support/boundsUtils"],function(e,t){"use strict";class r{static{this.instance=null}static local(){return null===r.instance&&(r.instance=new r),r.instance}execute(e,t,r){return new s(e,t,r)}}class s{constructor(e,t,r){this._inputGeometries=e,this._xFactor=void 0!==t.xScaleFactor?t.xScaleFactor:1.15,this._yFactor=void 0!==t.yScaleFactor?t.yScaleFactor:1.15}next(){const e=this._inputGeometries.next();if(e){if(1===this._xFactor&&1===this._yFactor)return e;if("esriGeometryPoint"===e.geometryType)return e;if(e.totalSize>0){const r=t.getCursorBoundsXY(e),s=(r[2]+r[0])/2,i=(r[3]+r[1])/2;return e.reset(),this._scaleCursor(e.clone(),s,i)}}return null}_scaleCursor(e,t,r){for(;e.nextPath();)for(;e.nextPoint();)e.x=t+(e.x-t)*this._xFactor,e.y=r+(e.y-r)*this._yFactor;return e.reset(),e}}e.EffectScale=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectSuppress":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/support/PolylineBuilder","../CIMCursor"],function(e,t,r,s){"use strict";class i{static{this.instance=null}static local(){return null===i.instance&&(i.instance=new i),i.instance}execute(e,t,r){return new n(e,t,r)}}class n extends s.PathEffectCursor{constructor(e,t,r){super(e,!1,!0),this._suppress=void 0!==t.suppress&&t.suppress,this._invert=void 0!==t.invert&&t.invert}processPath(e){if(e.totalSize<=0)return null;if(!this._suppress){const r=t.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolygon",!1,!1,e.yFactor);for(e.seekPathEnd();e.nextPoint();)r.pushXY(e.x,e.y);return r}const s=[],i=new Array(e.pathSize);let n=0;for(e.seekPathStart();e.nextPoint();)i[n++]=e.getControlPoint(),s.push([e.x,e.y]);let o=!0,a=!0,l=!1,c=!this._invert;n=0;const u=new r;let h=s[0];for(;n<s.length;){const e=s[n+1],t=i[n],r=i[n+1];n++,a&&(c=t||r?this._invert:!this._invert,a=!1),c?(u.addSegment(h,e,o),o=!1):l=!0,h=e,r&&(c?(c=!1,o=!0):c=!0)}const d=u.getGeometry();if(0===d.length)return null;if(!l&&s[0][0]===s[s.length-1][0]&&s[0][1]===s[s.length-1][1]){const e=d[d.length-1];return e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]||e.push([e[0][0],e[0][1]]),t.GeometryCursor.fromJSONCIM({paths:d})}const p=d[d.length-1];return u.getPointCount()>1&&"esriGeometryPolygon"===e.geometryType&&p[0][0]===p[p.length-1][0]&&p[0][1]===p[p.length-1][1]&&d.length>1&&(d[d.length-1].push(...d[0]),d.splice(0,1)),t.GeometryCursor.fromJSONCIM({paths:d})}}e.EffectSuppress=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/PolylineBuilder":function(){define(function(){"use strict";return class{constructor(){this._polyline=[]}beginPath(e){this._polyline.push([e])}lineTo(e){if(0===this._polyline.length)throw new Error("No path started. Call beginPath first.");this._polyline[this._polyline.length-1].push(e)}getPointCount(){return this._polyline.reduce((e,t)=>e+t.length,0)}addSegment(e,t,r){r&&this.beginPath(e),this.lineTo(t)}getXY(e){let t=0;for(const r of this._polyline){if(e<t+r.length)return r[e-t];t+=r.length}return null}getGeometry(){return this._polyline}}})},"esri/symbols/cim/effects/EffectTaperedPolygon":function(){define(["exports","../../../core/Error","../../../core/Logger","../../../geometry/GeometryCursor","../../../geometry/SpatialReference","../../../geometry/support/jsonUtils","../../../geometry/support/PolylineBuilder","../../../geometry/support/TileClipper","../CIMCursor","../CIMEffects"],function(e,t,r,s,i,n,o,a,l,c){"use strict";const u=()=>r.getLogger("esri.symbols.cim.effects.EffectTaperedPolygon");class h{static{this.instance=null}static local(){return null===h.instance&&(h.instance=new h),h.instance}execute(e,t,r){return new d(e,t,r)}}class d extends l.PathEffectCursor{constructor(e,t,r){super(e,!1,!0),this._slopeS=0,this._slopeC=1,this._lastTangent1=new a.Point(NaN,NaN),this._lastWidth=0,this._geomUnitsPerPoint=r,this._halfFromWidth=Math.abs(void 0!==t.fromWidth?t.fromWidth:0)*r*.5,this._halfToWidth=Math.abs(void 0!==t.toWidth?t.toWidth:1)*r*.5,this._originalLength=(void 0!==t.length?t.length:0)*r,this._length=0}processPath(e){if(e.totalSize<=0)return null;if(this._halfFromWidth<=0&&this._halfToWidth<=0){const t=s.GeometryCursor.createEmptyOptimizedCIM("esriGeometryPolygon",!1,!1,e.yFactor);for(e.seekPathEnd();e.prevPoint();)t.pushXY(e.x,e.y);for(e.seekPathStart();e.nextPoint();)t.pushXY(e.x,e.y);return t}const r=e.asJSON();e.seekPath(e.totalSize-1);const a=c.lazyGeneralizeOperator.module.execute(r,.25*this._geomUnitsPerPoint,{removeDegenerateParts:!0}),l=null==a?null:n.isPolygon(a)?a.rings:n.isPolyline(a)?a.paths:null;if(!l)return u().error(new t("mapview-bad-resource","Unable to process geometry")),null;const h=c.lazyLengthOperator.module.execute(a);if((0===this._originalLength||this._originalLength>h)&&h>0){this._length=h;const e=(this._halfToWidth-this._halfFromWidth)/this._length;if(Math.abs(e)<1){const t=e*e;this._slopeC=Math.sqrt(1/(1+t)),this._slopeS=Math.sqrt(t/(1+t)),e<0&&(this._slopeS=-this._slopeS)}else this._slopeC=this._slopeS=.7071}else this._length=this._originalLength,this._slopeC=1,this._slopeS=0;const d=[];for(const e of l){const t=new o,r=new o;let s=0;this._setFromOffset(e.slice(0,2),t,r);for(let i=0,n=3;n<=e.length;++i,++n)s=this._setOffset(e.slice(i,n),s,t,r);this._setToOffset(e.slice(-2),s,t,r);const[i]=t.getGeometry(),[n]=r.getGeometry();d.push([...i,...n.reverse()])}const p={rings:d,spatialReference:{wkid:i.WebMercator.wkid}},f=c.lazySimplifyOperator.module.execute(p);return s.GeometryCursor.fromJSONCIM(f)}_setFromOffset([[e,t],[r,s]],i,n){const o=this._halfFromWidth,l=new a.Point(r-e,s-t).normalize().scale(o);i.beginPath([e-l.y,t+l.x]),n.beginPath([e+l.y,t-l.x])}_setToOffset([[e,t],[r,s]],i,n,o){let l;l=(i+=Math.sqrt((r-e)**2+(s-t)**2))>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*i/this._length;const c=new a.Point(r-e,s-t).normalize().scale(l);n.lineTo([r-c.y,s+c.x]),o.lineTo([r+c.y,s-c.x])}_setOffset([[e,r],[s,i],[n,o]],l,c,h){const d=Math.sqrt((s-e)**2+(i-r)**2);let p;p=l+d>=this._length?this._halfToWidth:this._halfFromWidth+(this._halfToWidth-this._halfFromWidth)*(l+d)/this._length,l+=d;const f=new a.Point(s,i),m=new a.Point(s-e,i-r).normalize(),g=new a.Point(n-s,o-i).normalize(),y=a.Point.sub(g,m),_=c.getPointCount(),b=h.getPointCount();m.leftPerpendicular(),g.leftPerpendicular();const S=m.x*g.x+m.y*g.y;if(S>.99){const e=a.Point.add(m,g).scale(p/2),t=e.clone().rotate(this._slopeC,this._slopeS);c.lineTo([f.x+t.x,f.y+t.y]);const r=e.rotateReverse(this._slopeC,this._slopeS);h.lineTo([f.x-r.x,f.y-r.y])}else{const s=m.x*g.y-m.y*g.x;if(y.scale(1/s),s<0){y.scale(-p).rotateReverse(this._slopeC,this._slopeS);const e=h.getXY(b-1);e||u().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const r=a.Point.add(f,y).sub(a.Point.fromArray(e));if(m.x*r.y-m.y*r.x>0){const e=m.clone().scale(-p).rotateReverse(this._slopeC,this._slopeS),t=g.clone().scale(-p).rotateReverse(this._slopeC,this._slopeS);h.lineTo([f.x+e.x,f.y+e.y]),h.lineTo([f.x,f.y]),h.lineTo([f.x+t.x,f.y+t.y])}else h.lineTo([f.x+y.x,f.y+y.y])}else{y.scale(p).rotate(this._slopeC,this._slopeS);const e=c.getXY(_-1);e||u().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const r=a.Point.add(f,y).sub(a.Point.fromArray(e));if(m.x*r.y-m.y*r.x>0){const e=m.clone().scale(p).rotate(this._slopeC,this._slopeS),t=g.clone().scale(p).rotate(this._slopeC,this._slopeS);c.lineTo([f.x+e.x,f.y+e.y]),c.lineTo([f.x,f.y]),c.lineTo([f.x+t.x,f.y+t.y])}else c.lineTo([f.x+y.x,f.y+y.y])}const i=Math.acos(S);let n=1;if(p>.25){const e=2*Math.acos(1-.25/p);e<i&&(n=Math.round(i/e))}const o=Math.cos(i/n),l=Math.sin(i/n),d=m.clone();if(s<0){d.rotate(this._slopeC,this._slopeS);const s=c.getXY(_-1);s||u().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const i=a.Point.add(f,d.clone().scale(this._lastWidth)),n=a.Point.sub(i,a.Point.fromArray(s)),o=m.x*n.y-m.y*n.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&o>0){const t=new a.Point(e,r),s=this._lastTangent1.clone().scale(this._lastWidth);s.rotate(this._slopeC,this._slopeS);const i=m.clone().scale(this._lastWidth);i.rotate(this._slopeC,this._slopeS),c.lineTo([t.x+s.x,t.y+s.y]),c.lineTo([t.x,t.y]),c.lineTo([t.x+i.x,t.y+i.y])}}else{d.scale(-1).rotateReverse(this._slopeC,this._slopeS);const s=h.getXY(b-1);s||u().error(new t("mapview-bad-resource","Unable to process geometry, index out of scope"));const i=a.Point.add(f,d.clone().scale(this._lastWidth)),n=a.Point.sub(i,a.Point.fromArray(s)),o=m.x*n.y-m.y*n.x;if(!isNaN(this._lastTangent1.x)&&!isNaN(this._lastTangent1.y)&&o>0){const t=new a.Point(e,r),s=this._lastTangent1.clone().scale(-this._lastWidth);s.rotateReverse(this._slopeC,this._slopeS);const i=m.clone().scale(-this._lastWidth);i.rotateReverse(this._slopeC,this._slopeS),h.lineTo([t.x+s.x,t.y+s.y]),h.lineTo([t.x,t.y]),h.lineTo([t.x+i.x,t.y+i.y])}}d.scale(p);for(let e=0;e<=n;e++)s<0?(c.lineTo([f.x+d.x,f.y+d.y]),d.rotateReverse(o,l)):(h.lineTo([f.x+d.x,f.y+d.y]),d.rotate(o,l))}return this._lastTangent1.setCoords(m.x,m.y),this._lastWidth=p,l}}e.EffectTaperedPolygon=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/EffectWave":function(){define(["exports","../../../geometry/GeometryCursor","../GeometryWalker"],function(e,t,r){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r){return new i(e,t,r)}}class i{constructor(e,t,s){this._inputGeometries=e,this._height=(void 0!==t.amplitude?t.amplitude:2)*s,this._period=(void 0!==t.period?t.period:3)*s,this._style=t.waveform,this._height<=0&&(this._height=Math.abs(this._height)),this._period<=0&&(this._period=Math.abs(this._period)),this._pattern=new r.DashPattern,this._pattern.addValue(this._period),this._pattern.addValue(this._period),this._walker=new r.GeometryWalker,this._walker.updateTolerance(s)}next(){let e=this._inputGeometries.next();for(;e;){if(0===this._height||0===this._period)return e;const t=this._processGeom(e);if(t)return t;e=this._inputGeometries.next()}return null}_processGeom(e){const r=t.GeometryCursor.createEmptyOptimizedCIM(e.geometryType);for(;e.nextPath();){r.startPath();const t=e.pathLength();if(this._walker.init(e,this._pattern))switch(this._style){case"Sinus":default:this._constructCurve(r,t,!1);break;case"Square":this._constructSquare(r,t);break;case"Triangle":this._constructTriangle(r,t);break;case"Random":this._constructCurve(r,t,!0)}else for(;e.nextPoint();)r.pushXY(e.x,e.y)}return r}_constructCurve(e,t,s){let i=Math.round(t/this._period);0===i&&(i=1);const n=16*i+1,o=t/i,a=this._period/16,l=1/n,c=2*Math.PI*t/o,u=2*Math.PI*Math.random(),h=2*Math.PI*Math.random(),d=2*Math.PI*Math.random(),p=.75-Math.random()/2,f=.75-Math.random()/2,m=new r.Pos;this._walker.curPointAndAngle(m),e.pushPoint(m.pt);let g=0;for(;;){if(!this._walker.nextPointAndAngle(a,m)){e.pushPoint(this._walker.getPathEnd());break}{const t=g;let r;if(g+=l,s){const e=this._height/2*(1+.3*Math.sin(p*c*t+u));r=e*Math.sin(c*t+h),r+=e*Math.sin(f*c*t+d),r/=2}else r=.5*this._height*Math.sin(.5*c*t);e.pushXY(m.pt[0]-r*m.sa,m.pt[1]+r*m.ca)}}}_constructSquare(e,t){Math.round(t/this._period);let s=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i=new r.Pos;this._walker.curPointAndAngle(i);const n=new r.Pos;if(this._walker.nextPointAndAngle(this._period,n)){const o=new r.Pos;this._walker.nextPointAndAngle(this._period,o)&&(s?(e.pushPoint(i.pt),s=!1):e.pushPoint(i.pt),e.pushXY(i.pt[0]-this._height/2*i.sa,i.pt[1]+this._height/2*i.ca),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(n.pt[0]+this._height/2*n.sa,n.pt[1]-this._height/2*n.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}_constructTriangle(e,t){Math.round(t/this._period);let s=!0;for(;;){let t=!1;if(this._walker.curPositionIsValid()){const i=new r.Pos;this._walker.curPointAndAngle(i);const n=new r.Pos;if(this._walker.nextPointAndAngle(this._period/2,n)){const o=new r.Pos;this._walker.nextPointAndAngle(this._period,o)&&(this._walker.nextPosition(this._period/2)&&(s?(e.pushPoint(i.pt),s=!1):e.pushPoint(i.pt),e.pushXY(n.pt[0]-this._height/2*n.sa,n.pt[1]+this._height/2*n.ca),e.pushXY(o.pt[0]+this._height/2*o.sa,o.pt[1]-this._height/2*o.ca)),t=!0)}}if(!t){e.pushPoint(this._walker.getPathEnd());break}}}}e.EffectWave=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAlongLineSameSize":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(e,t,r){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r){return new i(e,t,r)}}class i extends t.PathTransformationCursor{constructor(e,t,s){super(e),this._geometryWalker=new r.GeometryWalker,this._geometryWalker.updateTolerance(s),this._angleToLine=t.angleToLine??!0,this._offset=(t.offset?t.offset:0)*s,this._originalEndings=t.endings,this._offsetAtEnd=(t.customEndingOffset?t.customEndingOffset:0)*s,this._position=-(t.offsetAlongLine?t.offsetAlongLine:0)*s,this._pattern=new r.DashPattern,this._pattern.init(t.placementTemplate,!1),this._pattern.scale(s),this._endings=this._originalEndings}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath)t=this._pattern.nextValue();else{"WithFullGap"===this._originalEndings&&this.isClosed?this._endings="WithMarkers":this._endings=this._originalEndings,this._pattern.extPtGap=0;let r,s=!0;switch(this._endings){case"NoConstraint":r=-this._position,r=this._adjustPosition(r),s=!1;break;case"WithHalfGap":default:r=-this._pattern.lastValue()/2;break;case"WithFullGap":r=-this._pattern.lastValue(),this._pattern.extPtGap=this._pattern.lastValue();break;case"WithMarkers":r=0;break;case"Custom":r=-this._position,r=this._adjustPosition(r),this._pattern.extPtGap=.5*this._offsetAtEnd}if(!this._geometryWalker.init(e,this._pattern,s))return null;this._pattern.reset();let i=0;for(;r>i;)r-=i,i=this._pattern.nextValue();i-=r,t=i,this.iteratePath=!0}const s=new r.Pos;return this._geometryWalker.nextPointAndAngle(t,s)?"WithFullGap"===this._endings&&this._geometryWalker.isPathEnd()?(this.iteratePath=!1,null):"WithMarkers"===this._endings&&this._geometryWalker.isPathEnd()&&(this.iteratePath=!1,this.isClosed)?null:(this.internalPlacement.setTranslate(s.pt[0]-this._offset*s.sa,s.pt[1]+this._offset*s.ca),this._angleToLine&&this.internalPlacement.setRotateCS(s.ca,s.sa),this.internalPlacement):(this.iteratePath=!1,null)}_adjustPosition(e){let t=e/this._pattern.length();return t-=Math.floor(t),t*this._pattern.length()}}e.PlacementAlongLineSameSize=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtExtremities":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,t,r){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r){return new i(e,t,r)}}class i extends t.PathTransformationCursor{constructor(e,t,s){super(e,!1,!0),this._curveHelper=new r.CurveHelper,this._placePerPart=t.placePerPart??!1,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*s:0,this._type=t.extremityPlacement,this._position=void 0!==t.offsetAlongLine?t.offsetAlongLine*s:0,this._beginProcessed=!1}processMultiPath(e){return this._placePerPart?super.processMultiPath(e):this.processPath(e)}processPath(e){let t;switch(this._type){case"Both":default:this._beginProcessed?(t=this._atExtremities(e,this._position,!1),this._beginProcessed=!1,this.iterateMultiPath=!1,this.iteratePath=!1):(t=this._atExtremities(e,this._position,!0),this._beginProcessed=!0,this.iterateMultiPath=!0,this.iteratePath=!0);break;case"JustBegin":t=this._atExtremities(e,this._position,!0);break;case"JustEnd":t=this._atExtremities(e,this._position,!1);case"None":}return t}_atExtremities(e,t,r){if(this._placePerPart||(r?e.seekPath(0):e.seekPath(e.totalSize-1)),r||e.seekPathEnd(),r?e.nextPoint():e.prevPoint()){let s=0,[i,n]=[0,0],[o,a]=[e.x,e.y];const l=[0,0];for(;r?e.nextPoint():e.prevPoint();){i=o,n=a,o=e.x,a=e.y;const r=this._curveHelper.getLength(i,n,o,a);if(s+r>t){const e=(t-s)/r,[c,u]=this._curveHelper.getAngleCS(l,i,n,o,a,e),h=this._curveHelper.getCoord2D(i,n,o,a,e);return this.internalPlacement.setTranslate(h[0]-this._offset*u,h[1]+this._offset*c),this._angleToLine&&this.internalPlacement.setRotateCS(-c,-u),this.internalPlacement}s+=r}}return null}}e.PlacementAtExtremities=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementAtRatioPositions":function(){define(["exports","../CIMCursor","../GeometryWalker"],function(e,t,r){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r){return new i(e,t,r)}}class i extends t.PathTransformationCursor{constructor(e,t,s){super(e),this._walker=new r.GeometryWalker,this._walker.updateTolerance(s),this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*s:0,this._beginGap=void 0!==t.beginPosition?t.beginPosition*s:0,this._endGap=void 0!==t.endPosition?t.endPosition*s:0,this._flipFirst=void 0===t.flipFirst||t.flipFirst,this._pattern=new r.DashPattern,this._pattern.init(t.positionArray,!1,!1),this._subPathLen=0,this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0}processPath(e){if(this._pattern.isEmpty())return null;let t;if(this.iteratePath){const e=this._pattern.nextValue()*this._subPathLen,r=this._beginGap+e;t=r-this._prevPos,this._prevPos=r}else{if(this._posCount=this._pattern.size(),this._isFirst=!0,this._prevPos=0,this._subPathLen=e.pathLength()-this._beginGap-this._endGap,this._subPathLen<0)return this.iteratePath=!1,null;if(!this._walker.init(e,this._pattern,!1))return null;this._pattern.reset();const r=this._pattern.nextValue()*this._subPathLen,s=this._beginGap+r;t=s-this._prevPos,this._prevPos=s,this.iteratePath=!0}const s=new r.Pos;if(!this._walker.nextPointAndAngle(t,s,1))return this.iteratePath=!1,null;this.internalPlacement.setTranslate(s.pt[0]-this._offset*s.sa,s.pt[1]+this._offset*s.ca);const i=this._isFirst&&this._flipFirst;let n,o;return this._angleToLine?(n=s.ca,o=s.sa):(n=1,o=0),i&&(n=-n,o=-o),this.internalPlacement.setRotateCS(n,o),this._isFirst=!1,this._posCount--,0===this._posCount&&(this.iteratePath=!1),this.internalPlacement}}e.PlacementAtRatioPositions=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementInsidePolygon":function(){define(["exports","../../../core/RandomLCG","../CIMPlacements"],function(e,t,r){"use strict";const s=512,i=24,n=1e-6;class o{static{this.instance=null}static local(){return null===o.instance&&(o.instance=new o),o.instance}execute(e,t,r,s){return new a(e,t,r,s)}}class a{constructor(e,i,n,o){if(this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,this._currentX=0,this._currentY=0,this._accelerationMap=null,this._testInsidePolygon=!1,this._verticalSubdivision=!0,this._stepX=Math.abs(i.stepX??16)*n,this._stepY=Math.abs(i.stepY??16)*n,this._stepX=Math.round(128*this._stepX)/128,this._stepY=Math.round(128*this._stepY)/128,0!==this._stepX&&0!==this._stepY){if(this._gridType=i.gridType??"Fixed","Random"===this._gridType){const e=i.seed??13,r=1;this._randomLCG=new t(e*r),this._randomness=(i.randomness??100)/100,this._gridAngle=0,this._shiftOddRows=!1,this._cosAngle=1,this._sinAngle=0,this._offsetX=0,this._offsetY=0,this._buildRandomValues()}else{if(this._randomness=0,this._gridAngle=i.gridAngle??0,this._shiftOddRows=i.shiftOddRows??!1,this._offsetX=(i.offsetX??0)*n,this._offsetY=(i.offsetY??0)*n,this._cosAngle=Math.cos(this._gridAngle/180*Math.PI),this._sinAngle=-Math.sin(this._gridAngle/180*Math.PI),this._stepX)if(this._offsetX<0)for(;this._offsetX<-.5*this._stepX;)this._offsetX+=this._stepX;else for(;this._offsetX>=.5*this._stepX;)this._offsetX-=this._stepX;if(this._stepY)if(this._offsetY<0)for(;this._offsetY<-.5*this._stepY;)this._offsetY+=this._stepY;else for(;this._offsetY>=.5*this._stepY;)this._offsetY-=this._stepY}if(this._graphicOriginX=0,this._graphicOriginY=0,null!=o){const[e,t,r,i]=o.split("/"),n=parseFloat(e),a=parseFloat(t),l=parseFloat(r),c=parseFloat(i);this._graphicOriginX=-(c*2**n+l)*s,this._graphicOriginY=a*s,this._testInsidePolygon=!0}this._internalPlacement=new r.Placement,this._calculateMinMax(e),this._geometryCursor=e}}next(){return this._geometryCursor?this._nextInside():null}_buildRandomValues(){if(!a._randValues){a._randValues=[];for(let e=0;e<i;e++)for(let e=0;e<i;e++)a._randValues.push(this._randomLCG.getFloat()),a._randValues.push(this._randomLCG.getFloat())}}_calculateMinMax(e){let t,r,i,n,o,a,l,c,u,h,d,p,f,m;this._xMin=0,this._xMax=0,this._yMin=0,this._yMax=0,l=c=f=d=Number.MAX_VALUE,u=h=m=p=-Number.MAX_VALUE;const g=1!==this._cosAngle;for(e.reset();e.nextPath();)for(;e.nextPoint();)a=e.x,o=e.y,t=a-this._graphicOriginX-this._offsetX,r=o-this._graphicOriginY-this._offsetY,g?(i=this._cosAngle*t-this._sinAngle*r,n=this._sinAngle*t+this._cosAngle*r):(i=t,n=r),l=Math.min(l,i),u=Math.max(u,i),c=Math.min(c,n),h=Math.max(h,n),d=Math.min(d,o),p=Math.max(p,o),f=Math.min(f,a),m=Math.max(m,a);d=d!==Number.MAX_VALUE?d:-512-this._stepY,p=p!==-Number.MAX_VALUE?p:this._stepY,f=f!==Number.MAX_VALUE?f:-this._stepX,m=m!==-Number.MAX_VALUE?m:s+this._stepX;const y=p-d,_=m-f;if(this._verticalSubdivision=y>=_,this._polygonMin=this._verticalSubdivision?d:f,this._testInsidePolygon){let e=0-this._graphicOriginX-this._offsetX-this._stepX,t=s-this._graphicOriginX-this._offsetX+this._stepX,r=-512-this._graphicOriginY-this._offsetY-this._stepY,i=0-this._graphicOriginY-this._offsetY+this._stepY;if(g){const s=[[e,r],[e,i],[t,r],[t,i]];e=r=Number.MAX_VALUE,t=i=-Number.MAX_VALUE;for(const n of s){const s=this._cosAngle*n[0]-this._sinAngle*n[1],o=this._sinAngle*n[0]+this._cosAngle*n[1];e=Math.min(e,s),t=Math.max(t,s),r=Math.min(r,o),i=Math.max(i,o)}}l=l!==Number.MAX_VALUE?Math.max(l,e):e,c=c!==Number.MAX_VALUE?Math.max(c,r):r,u=u!==-Number.MAX_VALUE?Math.min(u,t):t,h=h!==-Number.MAX_VALUE?Math.min(h,i):i}this._xMin=Math.round(l/this._stepX),this._xMax=Math.round(u/this._stepX),this._yMin=Math.round(c/this._stepY),this._yMax=Math.round(h/this._stepY),this._currentX=this._xMax+1,this._currentY=this._yMin-1,this._buildAccelerationMap(e,f,m,d,p)}_buildAccelerationMap(e,t,r,i,n){e.reset();const o=new Map,a=this._verticalSubdivision,c=a?n-i:r-t;let u=Math.ceil(c/10);if(u<=1)return;const h=Math.floor(c/u);let d,p,f,m,g,y,_,b,S,x,w;for(u++,this._delta=h,a?(S=-512-2*this._stepY,x=2*this._stepY,w=i):(S=-2*this._stepX,x=s+2*this._stepX,w=t);e.nextPath();)if(!(e.pathSize<2)&&e.nextPoint())for(d=e.x,p=e.y;e.nextPoint();d=f,p=m){if(f=e.x,m=e.y,a){if(p===m||p<S&&m<S||p>x&&m>x)continue;g=Math.min(p,m),y=Math.max(p,m)}else{if(d===f||d<S&&f<S||d>x&&f>x)continue;g=Math.min(d,f),y=Math.max(d,f)}for(;g<y;)_=Math.floor((g-w)/h),l(_,d,p,f,m,o),g+=h;b=Math.floor((y-w)/h),b>_&&l(b,d,p,f,m,o)}this._accelerationMap=o}_nextInside(){for(;;){if(this._currentX>this._xMax){if(this._currentY++,this._currentY>this._yMax)return null;this._currentX=this._xMin,this._shiftOddRows&&this._currentY%2&&this._currentX--}let e=this._currentX*this._stepX+this._offsetX;this._shiftOddRows&&this._currentY%2&&(e+=.5*this._stepX);const t=this._currentY*this._stepY+this._offsetY;let r,s;if(this._currentX++,"Random"===this._gridType){const n=(this._currentX%i+i)%i,o=(this._currentY%i+i)%i;r=this._graphicOriginX+e+this._stepX*this._randomness*(.5-a._randValues[o*i+n])*2/3,s=this._graphicOriginY+t+this._stepY*this._randomness*(.5-a._randValues[o*i+n+1])*2/3}else r=this._graphicOriginX+this._cosAngle*e+this._sinAngle*t,s=this._graphicOriginY-this._sinAngle*e+this._cosAngle*t;if(!this._testInsidePolygon||this._isInsidePolygon(r,s,this._geometryCursor))return this._internalPlacement.setTranslate(r,s),this._internalPlacement}}_isInsidePolygon(e,t,r){if(null==this._accelerationMap)return function(e,t,r){let s,i,o,a,l=0;for(e+=n,t+=n,r.reset();r.nextPath();)if(r.nextPoint())for(s=r.x,i=r.y;r.nextPoint();s=o,i=a)o=r.x,a=r.y,i>t!=a>t&&((o-s)*(t-i)-(a-i)*(e-s)>0?l++:l--);return 0!==l}(e,t,r);e+=n,t+=n;const s=this._verticalSubdivision,i=s?t:e,o=Math.floor((i-this._polygonMin)/this._delta),a=this._accelerationMap.get(o);if(!a)return!1;let l,c,u,h=0;for(const r of a){if(l=r[0],c=r[1],s){if(l[1]>t==c[1]>t)continue;u=(c[0]-l[0])*(t-l[1])-(c[1]-l[1])*(e-l[0])}else{if(l[0]>e==c[0]>e)continue;u=(c[1]-l[1])*(e-l[0])-(c[0]-l[0])*(t-l[1])}u>0?h++:h--}return 0!==h}}function l(e,t,r,s,i,n){let o=n.get(e);o||(o=[],n.set(e,o)),o.push([[t,r],[s,i]])}e.PlacementInsidePolygon=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnLine":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,t,r){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r){return new i(e,t,r)}}class i extends t.PathTransformationCursor{constructor(e,t,s){super(e),this._curveHelper=new r.CurveHelper,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*s:0,this._relativeTo=t.relativeTo,this._position=void 0!==t.startPointOffset?t.startPointOffset*s:0,this._epsilon=.001*s}processPath(e){const t=this._position;if("SegmentMidpoint"===this._relativeTo){if(this.iteratePath||(this.iteratePath=!0),e.nextPoint()){let[t,r]=[e.x,e.y],[s,i]=[0,0];const n=[0,0];for(;e.nextPoint();){s=e.x,i=e.y;const o=this._curveHelper.getLength(t,r,s,i);if(o<this._epsilon){t=s,r=i;continue}const a=.5+this._position/o,[l,c]=this._curveHelper.getAngleCS(n,t,r,s,i,a),u=this._curveHelper.getCoord2D(t,r,s,i,a);return this.internalPlacement.setTranslate(u[0]-this._offset*c,u[1]+this._offset*l),this._angleToLine&&this.internalPlacement.setRotateCS(l,c),this.internalPlacement}}return this.iteratePath=!1,null}const r="LineEnd"===this._relativeTo;return this.onLine(e,t,r)}onLine(e,t,r){let s,i=!1;switch(this._relativeTo){case"LineMiddle":default:e.seekPathStart(),s=e.pathLength()/2+t;break;case"LineBeginning":s=t;break;case"LineEnd":s=t,i=!0}r?e.seekPathEnd():e.seekPathStart();let n=0;if(r?e.prevPoint():e.nextPoint()){let[t,o]=[e.x,e.y],[a,l]=[0,0];const c=[0,0];for(;r?e.prevPoint():e.nextPoint();){a=e.x,l=e.y;const r=this._curveHelper.getLength(t,o,a,l);if(n+r>s){const e=(s-n)/r,[u,h]=this._curveHelper.getAngleCS(c,t,o,a,l,e),d=this._curveHelper.getCoord2D(t,o,a,l,e),p=i?-this._offset:this._offset;return this.internalPlacement.setTranslate(d[0]-p*h,d[1]+p*u),this._angleToLine&&(i?this.internalPlacement.setRotateCS(-u,-h):this.internalPlacement.setRotateCS(u,h)),this.internalPlacement}t=a,o=l,n+=r}}return null}}e.PlacementOnLine=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementOnVertices":function(){define(["exports","../CIMCursor","../CurveHelper"],function(e,t,r){"use strict";class s{static{this.instance=null}static local(){return null===s.instance&&(s.instance=new s),s.instance}execute(e,t,r){return new i(e,t,r)}}class i extends t.PathTransformationCursor{constructor(e,t,s){super(e),this._curveHelper=new r.CurveHelper,this._angleToLine=void 0===t.angleToLine||t.angleToLine,this._offset=void 0!==t.offset?t.offset*s:0,this._endPoints=void 0===t.placeOnEndPoints||t.placeOnEndPoints,this._controlPoints=void 0===t.placeOnControlPoints||t.placeOnControlPoints,this._regularVertices=void 0===t.placeOnRegularVertices||t.placeOnRegularVertices,this._tags=[],this._tagIterator=0}processPath(e){if(this.iteratePath||(this._preparePath(e),this.iteratePath=!0),this._tagIterator>=this._tags.length)return this._tags.length=0,this._tagIterator=0,this.iteratePath=!1,null;const t=this._tags[this._tagIterator];this._angleToLine&&this.internalPlacement.setRotate(t[2]);let r=t[0],s=t[1];if(0!==this._offset){const e=Math.cos(t[2]),i=Math.sin(t[2]);r-=this._offset*i,s+=this._offset*e}return this.internalPlacement.setTranslate(r,s),this._tagIterator++,this.internalPlacement}_preparePath(e){this._tags.length=0,this._tagIterator=0,e.seekPathStart();const t=e.isClosed();let r=0,s=!1,i=0,o=0;if(e.seekPathStart(),e.nextPoint()){let a=e.x,l=e.y,c=e.getControlPoint(),u=!0,h=e.nextPoint();for(;h;){const d=e.x,p=e.y,f=e.getControlPoint();(this._angleToLine||0!==this._offset)&&(i=this._curveHelper.getAngle(a,l,d,p,0)),u?(u=!1,t?(r=i,s=c):(this._endPoints||this._controlPoints&&c)&&this._tags.push([a,l,i])):c?this._controlPoints&&this._tags.push([a,l,n(o,i)]):this._regularVertices&&this._tags.push([a,l,n(o,i)]),(this._angleToLine||0!==this._offset)&&(o=this._curveHelper.getAngle(a,l,d,p,1)),h=e.nextPoint(),h||(t?f||s?this._controlPoints&&this._tags.push([d,p,n(o,r)]):this._regularVertices&&this._tags.push([d,p,n(o,r)]):(this._endPoints||this._controlPoints&&f)&&this._tags.push([d,p,o])),a=d,l=p,c=f}}this._tagIterator=0}}function n(e,t){const r=Math.PI;for(;Math.abs(t-e)>r+2e-15;)t-e>r?t-=2*r:t+=2*r;return(e+t)/2}e.PlacementOnVertices=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/placements/PlacementPolygonCenter":function(){define(["exports","../../../geometry/support/boundsUtils","../../../geometry/support/centroid","../../../geometry/support/labelPoint","../CIMPlacements"],function(e,t,r,s,i){"use strict";class n{static{this.instance=null}static local(){return null===n.instance&&(n.instance=new n),n.instance}execute(e,t,r){return new o(e,t,r)}}class o{constructor(e,t,r){this._geometryCursor=e,this._offsetX=void 0!==t.offsetX?t.offsetX*r:0,this._offsetY=void 0!==t.offsetY?t.offsetY*r:0,this._method=void 0!==t.method?t.method:"OnPolygon",this._placementPerPart=void 0!==t.placePerPart&&t.placePerPart,this._internalPlacement=new i.Placement}next(){const e=this._geometryCursor;if(!e)return null;if(!this._placementPerPart)return this._geometryCursor=null,this._polygonCenter(e);for(;e.nextPath();)if(!(e.getCurrentRingArea()<0))return this._polygonCenter(e.getCurrentPath());return this._geometryCursor=null,null}_polygonCenter(e){let i=!1;switch(this._method){case"CenterOfMass":{const t=r.weightedAreaCentroid(e);t&&(this._internalPlacement.setTranslate(t[0]+this._offsetX,t[1]+this._offsetY),i=!0)}break;case"BoundingBoxCenter":{const r=t.getCursorBoundsXY(e);r&&(this._internalPlacement.setTranslate((r[2]+r[0])/2+this._offsetX,(r[3]+r[1])/2+this._offsetY),i=!0)}break;default:{const t=s.getLabelPoint(e);null!==t&&(this._internalPlacement.setTranslate(t[0]+this._offsetX,t[1]+this._offsetY),i=!0)}}return i?this._internalPlacement:null}}e.PlacementPolygonCenter=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/labelPoint":function(){define(["exports","../../core/PriorityQueue","./aaBoundingRect","./boundsUtils","./centroid","./coordsUtils","./intersectsBase"],function(e,t,r,s,i,n,o){"use strict";function a(e,t){let r,s,i,n,o=0;for(t.reset();t.nextPath()&&t.nextPoint();)for(r=t.x,s=t.y;t.nextPoint();r=i,s=n)i=t.x,n=t.y,s>e[1]!=n>e[1]&&((i-r)*(e[1]-s)-(n-s)*(e[0]-r)>0?o++:o--);return 0!==o}function l(e,t,r){if(r&&a(e,t))return{coord:e,distance:0};let s=1/0,i=0,o=0,l=[0,0],c=[0,0];const u=[0,0];for(t.reset();t.nextPath()&&t.nextPoint();)if(!(t.pathSize<2))for(l[0]=t.x,l[1]=t.y;t.nextPoint();l=c){c=[t.x,t.y],n.projectPointOnLineSeg(u,e,l,c);const r=_(e,u);r<s&&(s=r,i=u[0],o=u[1])}return{coord:[i,o],distance:Math.sqrt(s)}}function c(e,t,s,i){const n=[t,0];let a=1/0,l=1/0,c=!1,h=!1;const d=[[t,i[1]-1],[t,i[3]+1]],p=[0,0],f=[0,0],g=[0,0],y=[[0,0],[0,0]],_=r.create();for(e.reset();e.nextPath()&&e.nextPoint();)if(!(e.pathSize<2))for(y[0][0]=e.x,y[0][1]=e.y;e.nextPoint();y[0][0]=y[1][0],y[0][1]=y[1][1]){if(y[1][0]=e.x,y[1][1]=e.y,null===u(_,y))continue;if(f[0]=d[0][0],f[1]=d[0][1],g[0]=d[1][0],g[1]=d[1][1],0===m(_,f,g))continue;if(!o.segmentIntersects(d[0],d[1],y[0],y[1],p))continue;const t=p[1];a>l?t<a&&(a=t,c=!0):t<l&&(l=t,h=!0)}return c&&h?n[1]=(a+l)/2:n[0]=n[1]=NaN,n}function u(e,t){if(t.length<2)return null;e||(e=r.create());const[s,i]=t[0],[n,o]=t[1];return e[0]=Math.min(s,n),e[1]=Math.min(i,o),e[2]=Math.max(s,n),e[3]=Math.max(i,o),e}const h=1,d=4,p=3,f=12;function m(e,t,r){let s=g(t,e),i=g(r,e);const n=e[0],o=e[1],a=e[2],l=e[3];if(s&i)return 0;if(!(s|i))return 4;const c=(s?1:0)|(i?2:0);do{const c=r[0]-t[0],u=r[1]-t[1];if(c>u)s&p?(s&h?(t[1]+=u*(n-t[0])/c,t[0]=n):(t[1]+=u*(a-t[0])/c,t[0]=a),s=g(t,e)):i&p?(i&h?(r[1]+=u*(n-r[0])/c,r[0]=n):(r[1]+=u*(a-r[0])/c,r[0]=a),i=g(r,e)):s?(s&d?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),s=g(t,e)):(i&d?(r[0]+=c*(o-r[1])/u,r[1]=o):(r[0]+=c*(l-r[1])/u,r[1]=l),i=g(r,e));else if(s&f?(s&d?(t[0]+=c*(o-t[1])/u,t[1]=o):(t[0]+=c*(l-t[1])/u,t[1]=l),s=g(t,e)):i&f?(i&d?(r[0]+=c*(o-r[1])/u,r[1]=o):(r[0]+=c*(l-r[1])/u,r[1]=l),i=g(r,e)):s?(s&h?(t[1]+=u*(n-t[0])/c,t[0]=n):(t[1]+=u*(a-t[0])/c,t[0]=a),s=g(t,e)):(i&h?(r[1]+=u*(n-r[0])/c,r[0]=n):(r[1]+=u*(a-r[0])/c,r[0]=a),i=g(r,e)),s&i)return 0}while(s|i);return c}function g(e,t){return(e[0]<t[0]?1:0)|(e[0]>t[2]?1:0)<<1|(e[1]<t[1]?1:0)<<2|(e[1]>t[3]?1:0)<<3}function y(e,t,r){return e+(t-e)*r}function _(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function b(e,t){if(e<t)return-1;if(e>t)return 1;if(e===t)return 0;const r=isNaN(e),s=isNaN(t);return r<s?-1:r>s?1:0}class S{constructor(e,t,r,s){this.x=e,this.y=t,this.cellSize=r,this.distancefromCellCenter=n.distanceFromPointToPolygon(e,t,s),this.maxDistanceToPolygon=this.distancefromCellCenter+this.cellSize*Math.SQRT2}}e.getLabelPoint=function(e){if(0===e.totalSize)return null;const t=s.getCursorBoundsXY(e);if(!t)return null;const n=4*(Math.abs(t[0])+Math.abs(t[2])+Math.abs(t[1])+Math.abs(t[3])+1)*222045e-19;let o=0,u=0;e.reset();for(let t=0;e.nextPath();t++){const r=e.getCurrentRingArea();r>u&&(u=r,o=t)}if(e.seekPath(o),0===e.pathSize)return null;e.seekPathStart();const h=s.getCursorPathBounds(e);if(Math.abs(u)<=2*n*n)return[(h[0]+h[2])/2,(h[1]+h[3])/2];e.seekPathStart();const d=i.ringCentroidCursorXY(e,r.create());if(null===d)return null;if(e.totalPoints<4)return d;const p=[[NaN,NaN],[NaN,NaN],[NaN,NaN],[NaN,NaN]],f=[NaN,NaN,NaN,NaN],m=[NaN,NaN,NaN,NaN];let g=!1,S=l(d,e,!0);0===S.distance&&(g=!0,p[0][0]=d[0],p[0][1]=d[1],S=l(d,e,!1)),f[0]=S.distance,m[0]=0;const x=[NaN,NaN];let w=!1,v=.25,M=-1,I=NaN;do{if(I=NaN,p[1]=c(e,y(h[0],h[2],v),0,t),isNaN(p[1][0])||isNaN(p[1][1])||(S=l(p[1],e,!1),I=S.distance),!isNaN(I)&&I>n&&a(p[1],e))w=!0,f[1]=I,m[1]=_(p[1],d);else if(!isNaN(I)&&I>M&&(M=I,x[0]=p[1][0],x[1]=p[1][1]),v-=.01,v<.1){if(!(M>=0))break;w=!0,f[1]=M,p[1][0]=x[0],p[1][1]=x[1],m[1]=_(p[1],d)}}while(!w);w=!1,v=.5,M=-1;let P=.01,T=1;do{if(I=NaN,p[2]=c(e,y(h[0],h[2],v),0,t),isNaN(p[2][0])||isNaN(p[2][1])||(S=l(p[2],e,!1),I=S.distance),!isNaN(I)&&I>n&&a(p[2],e))w=!0,f[2]=I,m[2]=_(p[2],d);else if(!isNaN(I)&&I>M)M=I,x[0]=p[2][0],x[1]=p[2][1];else if(I>M&&(M=I,x[0]=p[2][0],x[1]=p[2][1]),v=.5+P*T,P+=.01,T*=-1,v<.3||v>.7){if(!(M>=0))break;w=!0,f[2]=M,p[2][0]=x[0],p[2][1]=x[1],m[2]=_(p[2],d)}}while(!w);w=!1,v=.75,M=-1;do{if(I=NaN,p[3]=c(e,y(h[0],h[2],v),0,t),isNaN(p[3][0])||isNaN(p[3][1])||(S=l(p[3],e,!1),I=S.distance),!isNaN(I)&&I>n&&a(p[3],e))w=!0,f[3]=I,m[3]=_(p[3],d);else if(I>M&&(M=I,x[0]=p[3][0],x[1]=p[3][1]),v+=.01,v>.9){if(!(M>=0))break;w=!0,f[3]=M,p[3][0]=x[0],p[3][1]=x[1],m[3]=_(p[3],d)}}while(!w);const C=[0,1,2,3],F=g?0:1;let k;for(let e=F;e<4;e++)for(let e=F;e<3;e++){const t=m[e],r=m[e+1];b(t,r)>0&&(k=C[e],C[e]=C[e+1],C[e+1]=k,m[e]=r,m[e+1]=t)}let A=F,O=0,E=0;for(let e=F;e<4;e++){switch(e){case 0:E=2*f[C[e]];break;case 1:E=1.66666666*f[C[e]];break;case 2:E=1.33333333*f[C[e]];break;case 3:E=f[C[e]]}E>O&&(O=E,A=C[e])}return p[A]},e.getPolylabelPoint=function(e){if(!e.nextPath()||!e.pathSize)return null;const r=s.getCursorPathBounds(e),n=r[2]-r[0],o=r[3]-r[1];if(0===n||0===o)return[r[0]+n/2,r[1]+o/2];const a=Math.max(Math.min(n,o)/100,1),l=new t((e,t)=>t.maxDistanceToPolygon-e.maxDistanceToPolygon),c=Math.min(n,o);let u=c/2,h=0,d=0;for(h=r[0];h<r[2];h+=c)for(d=r[1];d<r[3];d+=c)l.enqueue(new S(h+u,d+u,u,e));e.reset(),e.nextPath();const p=i.ringsCentroidCursor(e);if(null===p)return null;let f,m=new S(p[0],p[1],0,e);for(;l.size>0;)f=l.dequeue(),f.distancefromCellCenter>m.distancefromCellCenter&&(m=f),f.maxDistanceToPolygon-m.distancefromCellCenter<=a||(u=f.cellSize/2,l.enqueue(new S(f.x-u,f.y-u,u,e)),l.enqueue(new S(f.x+u,f.y-u,u,e)),l.enqueue(new S(f.x-u,f.y+u,u,e)),l.enqueue(new S(f.x+u,f.y+u,u,e)));return[m.x,m.y]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/PriorityQueue":function(){define(function(){"use strict";const e=(e,t)=>e<t?-1:e>t?1:0;return class{constructor(t=e){this._data=[],this._compare=t}get size(){return this._data.length}enqueue(e){if(null==e)return;const{_data:t,_compare:r}=this;t.push(e);let s=t.length-1>>>0;const i=t[s];for(;s>0;){const e=s-1>>1,n=t[e];if(!(r(n,i)<=0))break;t[e]=i,t[s]=n,s=e}}dequeue(){const{_data:e,_compare:t}=this,r=e[0],s=e.pop();if(0===e.length)return r;e[0]=s;let i=0;const n=e.length,o=e[0];let a,l,c=null;for(;;){const r=2*i+1,s=2*i+2;if(c=null,r<n&&(a=e[r],t(a,o)>0&&(c=r)),s<n&&(l=e[s],(null===c&&t(l,o)<=0||null!==c&&t(l,a)<=0)&&(c=s)),null===c)break;e[i]=e[c],e[c]=o,i=c}return r}}})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedMeshWriter":function(){define(["exports","../fill/meshWriterUtils","../markers/markerConstants","../mesh/MeshWriter"],function(e,t,r,s){"use strict";class i extends s.MeshWriter{}e.AAnimatedMeshWriter=i,e.packAnimatedBitset=function(e){const{sprite:s,isMapAligned:i,colorLocked:n,scaleSymbolsProportionally:o,isStroke:a}=e;let l=0;return i&&(l|=t.getBitMask(r.MarkerConstants.bitset.isMapAligned)),n&&(l|=t.getBitMask(r.MarkerConstants.bitset.colorLocked)),s.sdf&&(l|=t.getBitMask(r.MarkerConstants.bitset.isSDF)),o&&(l|=t.getBitMask(r.MarkerConstants.bitset.scaleSymbolsProportionally)),a&&(l|=t.getBitMask(r.MarkerConstants.bitset.isStroke)),l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/meshWriterUtils":function(){define(["exports","../../../../../../../Color","../../../../../../../core/Error","../../../../../../../core/Logger"],function(e,t,r,s){"use strict";e.getBitMask=function(e){return 1<<e},e.getMinMaxZoom=function(e,t){return[!!e?.minScale&&t.scaleToZoom(e.minScale)||0,!!e?.maxScale&&t.scaleToZoom(e.maxScale)||100]},e.packBitset=function(e){let t=0;for(const[r,s]of e)s&&(t|=1<<r);return t},e.packByteSqrt=function(e,t){return Math.round(Math.min(Math.sqrt(e*t),255))},e.packRounded=function(e,t){return Math.round(e*t)/t},e.processColorInput=function(e){let i;if(!e)return[0,0,0,0];if("string"==typeof e){const n=t.fromString(e);if(!n)return s.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils").errorOnce(new r("mapview:mesh-processing","Unable to parse string into color",{color:e})),[0,0,0,0];i=n.toArray()}else i=e;const[n,o,a,l]=i;return[n*(l/255),o*(l/255),a*(l/255),l]},e.processLineCapInput=function(e){switch(e){case"butt":case"Butt":return 0;case"round":case"Round":return 1;case"square":case"Square":return 2}},e.processLineJoinInput=function(e){switch(e){case"bevel":case"Bevel":return 0;case"miter":case"Miter":return 2;case"round":case"Round":return 1}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/markerConstants":function(){define(["exports"],function(e){"use strict";e.MarkerConstants={bitset:{isSDF:0,isMapAligned:1,scaleSymbolsProportionally:2,overrideOutlineColor:3,colorLocked:4,isStroke:5}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/CIMEffects","../../../../../../../symbols/cim/effects/CIMEffectHelper","./MeshWriterVertexPack"],function(e,t,r,s,i){"use strict";e.MeshWriter=class{constructor(e,t,r,s){this._instanceId=e,this._evaluator=t,this._enabledOptionalAttributes=r,this._viewParams=s,this._evaluator.evaluator=e=>this.vertexSpec.createComputedParams(e)}get _vertexPack(){if(!this._cachedVertexPack){const e=i.MeshWriterVertexPack.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||e.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=e}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return!!this.evaluatedMeshParams.effects}get effectInfos(){return this._evaluator.inputMeshParams.effects?.effectInfos}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}get _preventEffectClipping(){return!1}setReferences(e){this._references=e}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){for(const{effect:e}of this.effectInfos||[])await r.loadGeometryOperatorsForEffect(e)}enqueueRequest(e,t,r){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(e,t,r)}write(e,t,r,s,i){this.ensurePacked(t,r,s);const n=this.evaluatedMeshParams.effects;if(!n||0===n.length)return void this._write(e,r,void 0,i);const o=this.getEffectCursor(e,r,n);if(!o)return;let a;for(;a=o.next();)a.invertY(),this._write(e,r,a,i)}ensurePacked(e,t,r){if(!this._evaluator.hasDynamicProperties)return;const s=this._evaluator.evaluateMeshParams(e,t,r);this._vertexPack.pack(s,this._viewParams)}hasArcadeDependency(e){return this._evaluator.hasArcadeDependency(e)}_writeVertex(e,t,r,s,i){const n=this.evaluatedMeshParams;this._vertexPack.writeVertex(e,t,r,s,n,i)}getEffectCursor(e,r,i){const n=r.readGeometryForDisplay()?.clone();if(!n)return;const o=t.GeometryCursor.fromOptimizedCIM(n,r.geometryType);o.invertY();const a=e.id||"";return s.CIMEffectHelper.executeEffects(i,o,a,this._preventEffectClipping)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/effects/CIMEffectHelper":function(){define(["exports","../../../geometry/GeometryCursor","../../../geometry/geometryCursorCollectUtils","../CIMEffects","../CIMOperators","../CIMSymbolHelper"],function(e,t,r,s,i,n){"use strict";const o=96/72;e.CIMEffectHelper=class{static executeEffects(e,t,r,a){const l=o,c=n.getEffectsInflateSize(e);let u=new s.SimpleEffectCursor(t);for(const t of e){const e=i.getEffectOperator(t);e&&(u=e.execute(u,t,l,r,c,a))}return u}static applyEffects(e,o){if(!e)return o;const a=n.getEffectsInflateSize(e);let l,c=new s.SimpleEffectCursor(t.GeometryCursor.fromJSONCIM(o));for(const t of e){const e=i.getEffectOperator(t);e&&(c=e.execute(c,t,1,null,a,!1))}const u=[];let h=null;for(;l=c.next();)u.push(...r.collectMultipath(l)),h=l.geometryType;return 0===u.length||null===h?null:"esriGeometryPolygon"===h?{rings:u}:{paths:u}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolHelper":function(){define(["exports","../../core/BidiText","../../core/has","../../core/lang","../../core/Logger","../../core/RandomLCG","../../core/screenUtils","../../geometry/support/aaBoundingRect","../../geometry/support/boundsUtils","../Font","./CIMEffects","./CIMPlacements","./CIMSymbolDrawHelper","./defaultCIMValues","./utils","../support/defaults","../../views/2d/engine/vectorTiles/GeometryUtils","../../views/2d/engine/webgl/definitions","../../views/2d/engine/webgl/mesh/templates/shapingUtils","../../views/2d/layers/graphics/graphicsUtils"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_,b){"use strict";const S=Math.PI,x=S/2,w=Math.PI/180,v=96/72,M=()=>i.getLogger("esri.symbols.cim.CIMSymbolHelper");function I(e,t,r){switch(t.type){case"CIMSymbolReference":return I(e,t.symbol,r);case"CIMPointSymbol":null==r&&(r={x:0,y:0}),e.drawSymbol(t,r);break;case"CIMLineSymbol":null==r&&(r={paths:[[[0,0],[10,0]]]}),e.drawSymbol(t,r);break;case"CIMPolygonSymbol":null==r&&(r={rings:[[[0,0],[0,10],[10,10],[10,0],[0,0]]]}),e.drawSymbol(t,r);break;case"CIMTextSymbol":{const r={x:0,y:0};e.drawSymbol(t,r);break}case"CIMVectorMarker":{const r=new h.Placement;e.drawMarker(t,r);break}}return e.envelope()}function P(e){if(!e)return 0;switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAtExtremities":case"CIMMarkerPlacementAtMeasuredUnits":case"CIMMarkerPlacementAtRatioPositions":case"CIMMarkerPlacementOnLine":case"CIMMarkerPlacementOnVertices":return Math.abs(e.offset);default:return 0}}function T(e){if(!e)return 0;switch(e.type){case"CIMGeometricEffectArrow":return Math.abs(.5*e.width);case"CIMGeometricEffectBuffer":return Math.abs(e.size);case"CIMGeometricEffectControlMeasureLine":return 500;case"CIMGeometricEffectExtension":case"CIMGeometricEffectRadial":return Math.abs(e.length);case"CIMGeometricEffectJog":return Math.abs(.5*e.length);case"CIMGeometricEffectMove":return Math.max(Math.abs(f.getNumericValue(e.offsetX)),Math.abs(f.getNumericValue(e.offsetY)));case"CIMGeometricEffectOffset":case"CIMGeometricEffectOffsetTangent":return Math.abs(e.offset);case"CIMGeometricEffectRegularPolygon":return Math.abs(e.radius);case"CIMGeometricEffectRotate":case"CIMGeometricEffectScale":default:return 0;case"CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(e.fromWidth),Math.abs(e.toWidth));case"CIMGeometricEffectWave":return Math.abs(e.amplitude);case"CIMGeometricEffectDonut":return Math.abs(e.width)}}function C(e){if(!e)return 0;let t=0;for(const r of e)t+=T(r);return t}class F{static getEnvelope(e,t,r){if(!e)return null;const s=new d.EnvDrawHelper(r);if(Array.isArray(e)){let r;for(const i of e)r?r.union(I(s,i,t)):r=I(s,i,t);return r}return I(s,e,t)}static getTextureInfo(e,t,r,s,i){const n=s??this.getEnvelope(e,null,t);if(!n)return[0,0,0,0,1];const o=Math.max(n.width,n.height)*v;let a=null!=i?Math.max(i/o,1):1;a*=v,n.x*=a,n.y*=a,n.width*=a,n.height*=a,n.width=Math.max(Math.ceil(n.x+n.width)-Math.floor(n.x),1)-1,n.height=Math.max(Math.ceil(n.y+n.height)-Math.floor(n.y),1)-1;let l=n.x+.5*n.width,c=n.y+.5*n.height;return l+=n.x-Math.floor(n.x),c+=n.y-Math.floor(n.y),s||(n.width+=r,n.height+=r,l+=r/2,c+=r/2),[n.width,n.height,l,c,a]}static getTextureAnchor(e,t,r){const[s,i,n,o,a]=this.getTextureInfo(e,t,2,null,r);return[-n/s,-o/i,i/a*v]}static rasterize(e,t,r,s,i=!0,n){const[o,a,l,c,u]=this.getTextureInfo(t,s,2,r,n);e.width=o,e.height=a;const p=e.getContext("2d",{willReadFrequently:!0}),f=d.Transformation.createScale(u,-u);f.translate(.5*o-l,.5*a+c);const m=new d.CanvasDrawHelper(p,s,f);switch(t.type){case"CIMPointSymbol":{const e={type:"point",x:0,y:0};m.drawSymbol(t,e);break}case"CIMVectorMarker":{const e=new h.Placement;m.drawMarker(t,e);break}}const g=p.getImageData(0,0,e.width,e.height),y=new Uint8Array(g.data);if(i){let e;for(let t=0;t<y.length;t+=4)e=y[t+3]/255,y[t]=y[t]*e,y[t+1]=y[t+1]*e,y[t+2]=y[t+2]*e}return[y,e.width,e.height,-l/o,-c/a]}static fromTextSymbol(e){const{text:t}=e;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:F.createCIMTextSymbolfromTextSymbol(e),textString:t}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}}static fromPictureFillSymbol(e){const{height:t,outline:r,width:s,xoffset:i,xscale:n,yoffset:o,yscale:a}=e,l=[],c={type:"CIMPolygonSymbol",symbolLayers:l};if(r){const e=U(r);e&&l.push(e)}let u=e.url;"esriPFS"===e.type&&e.imageData&&(u=e.imageData);const h="angle"in e?e.angle??0:0,d=(s??0)*(n||1),p=(t??0)*(a||1);return l.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture",tintColor:null,url:u,height:p,width:d,offsetX:f.getNumericValue(i),offsetY:f.getNumericValue(o),rotation:f.getNumericValue(-h),colorSubstitutions:null}),c}static fromSimpleFillSymbol(e){const{color:t,style:r,outline:i}=e,n=[],a={type:"CIMPolygonSymbol",symbolLayers:n};if(i){const e=U(i);e&&n.push(e)}if(r&&"solid"!==r&&"none"!==r&&"esriSFSSolid"!==r&&"esriSFSNull"!==r){const e={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:R(t),capStyle:"Butt",joinStyle:"Miter",width:.75}]};let i=0;const a=o.px2pt(B(r)?8:10);switch(r){case"vertical":case"esriSFSVertical":i=90;break;case"forward-diagonal":case"esriSFSForwardDiagonal":case"diagonal-cross":case"esriSFSDiagonalCross":i=-45;break;case"backward-diagonal":case"esriSFSBackwardDiagonal":i=45;break;case"cross":case"esriSFSCross":i=0}n.push({type:"CIMHatchFill",lineSymbol:e,offsetX:0,offsetY:0,rotation:i,separation:a}),"cross"===r||"esriSFSCross"===r?n.push({type:"CIMHatchFill",lineSymbol:s.clone(e),offsetX:0,offsetY:0,rotation:90,separation:a}):"diagonal-cross"!==r&&"esriSFSDiagonalCross"!==r||n.push({type:"CIMHatchFill",lineSymbol:s.clone(e),offsetX:0,offsetY:0,rotation:45,separation:a})}else!r||"solid"!==r&&"esriSFSSolid"!==r||n.push({type:"CIMSolidFill",enable:!0,color:R(t)});return a}static fromSimpleLineSymbol(e){const{cap:t,color:r,join:s,marker:i,miterLimit:n,style:o,width:a}=e;let l=null;"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(l=[{type:"CIMGeometricEffectDashes",dashTemplate:G(o,t),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const c=[];if(i){let e;switch(i.placement){case"begin-end":e="Both";break;case"begin":e="JustBegin";break;case"end":e="JustEnd";break;default:e="None"}const t=F.fromSimpleMarker(i,a,r).symbolLayers[0];t.markerPlacement={type:"CIMMarkerPlacementAtExtremities",placePerPart:!1,angleToLine:!0,offset:0,extremityPlacement:e,offsetAlongLine:0},c.push(t)}return c.push({type:"CIMSolidStroke",color:"none"!==o&&"esriSLSNull"!==o?R(r):[0,0,0,0],capStyle:A(t),joinStyle:O(s),miterLimit:n,width:a,effects:l}),{type:"CIMLineSymbol",symbolLayers:c}}static fromPictureMarker(e){const{angle:t,height:r,width:s,xoffset:i,yoffset:n}=e;let o=e.url;return"esriPMS"===e.type&&e.imageData&&(o=e.imageData),{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture",tintColor:null,url:o,size:r,width:s,offsetX:f.getNumericValue(i),offsetY:f.getNumericValue(n),rotation:f.getNumericValue(-t)}]}}static createCIMTextSymbolfromTextSymbol(e){const{angle:r,color:s,font:i,haloColor:n,haloSize:o,horizontalAlignment:a,kerning:l,lineWidth:c,text:u,verticalAlignment:h,xoffset:d,yoffset:p,backgroundColor:m,borderLineColor:g,borderLineSize:y}=e;let _,b,S,x,w,v;i&&(_=i.family,b=i.style,S=i.weight,x=i.size,w=i.decoration);let M=!1;return u&&(M=t.bidiText(u)[1]),(m||y)&&(v={type:"CIMBackgroundCallout",margin:null,backgroundSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",color:R(m)},{type:"CIMSolidStroke",color:R(g),width:y}]},accentBarSymbol:null,gap:null,leaderLineSymbol:null,lineStyle:null}),{type:"CIMTextSymbol",angle:r,blockProgression:2,depth3D:1,extrapolateBaselines:!0,fontEffects:0,fontEncoding:1,fontFamilyName:_||"Arial",fontStyleName:L(b,S),fontType:0,haloSize:o,height:x,hinting:1,horizontalAlignment:E(a??"center"),kerning:l,letterWidth:100,ligatures:!0,lineGapType:"Multiple",lineWidth:c,offsetX:f.getNumericValue(d),offsetY:f.getNumericValue(p),strikethrough:"line-through"===w,underline:"underline"===w,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:R(s)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:R(n)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:M?1:0,verticalAlignment:z(h??"baseline"),verticalGlyphOrientation:0,wordSpacing:100,billboardMode3D:2,callout:v}}static createPictureMarkerRasterizationParam(e){const{angle:t,height:r,width:s,xoffset:i,yoffset:n}=e,o=e.url??e.source?.url??e.source?.imageData;return o?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:"Picture",tintColor:null,url:o,size:r,width:s,offsetX:f.getNumericValue(i),offsetY:f.getNumericValue(n),rotation:f.getNumericValue(-t)}}:null}static createPictureFillRasterizationParam(e){const{width:t,height:r,xoffset:s,yoffset:i,url:n}=e;return n?{type:"sprite-rasterization-param",overrides:[],resource:{type:"CIMPictureFill",scaleX:1,textureFilter:"Picture",tintColor:null,url:n,width:t,height:r,offsetX:f.getNumericValue(s),offsetY:f.getNumericValue(i),rotation:0}}:null}static fromSimpleMarker(e,t,r){const{style:s}=e,i=e.color??r;if("path"===s||"esriSMSPath"===s){const t=[];if("outline"in e&&e.outline){const r=e.outline;t.push({type:"CIMSolidStroke",enable:!0,width:r.width,color:R(r.color),path:e.path})}t.push({type:"CIMSolidFill",enable:!0,color:R(i),path:e.path});const[r,s]=q("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:-f.getNumericValue(e.angle),size:f.getNumericValue(e.size||6),offsetX:f.getNumericValue(e.xoffset),offsetY:f.getNumericValue(e.yoffset),scaleSymbolsProportionally:!1,frame:r,markerGraphics:[{type:"CIMMarkerGraphic",geometry:s,symbol:{type:"CIMPolygonSymbol",symbolLayers:t}}]}]}}const n=[];let o,a,l=e.size;if("outline"in e&&e.outline&&"none"!==e.outline.style&&"esriSLSNull"!==e.outline.style){const t=e.outline,r="solid"!==t.style&&"esriSLSSolid"!==t.style;[o,a]=r?q(s,e.size):q(s);const i=t.width??m.defaultPolylineSymbol2D.width;if(r){const t=i/e.size,r=(o.xmax-o.xmin)*t/2,s=(o.ymax-o.ymin)*t/2;o.xmin-=r,o.xmax+=r,o.ymin-=s,o.ymax+=s,l&&(l+=i)}const c="cross"!==e.style&&"x"!==e.style||"dot"===e?.outline.style||"short-dot"===e?.outline.style?"HalfGap":"FullPattern",u=r?[{type:"CIMGeometricEffectAddControlPoints"},{type:"CIMGeometricEffectDashes",dashTemplate:G(t.style,null).map(e=>t.width&&t.width>0?e*t.width:e),lineDashEnding:c,controlPointEnding:"FullPattern"}]:void 0;n.push({type:"CIMSolidStroke",capStyle:r?"Round":"Butt",enable:!0,width:i,color:R(t.color),effects:u})}else!t||"line-marker"!==e.type||"cross"!==e.style&&"x"!==e.style?[o,a]=q(s):([o,a]=q(s),n.push({type:"CIMSolidStroke",enable:!0,width:t,color:R(i)}));n.push({type:"CIMSolidFill",enable:!0,color:R(i)});const c={type:"CIMPolygonSymbol",symbolLayers:n};return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:f.getNumericValue(-e.angle),size:f.getNumericValue(l||6*t),offsetX:f.getNumericValue(e.xoffset),offsetY:f.getNumericValue(e.yoffset),scaleSymbolsProportionally:!1,frame:o,markerGraphics:[{type:"CIMMarkerGraphic",geometry:a,symbol:c}]}]}}static fromCIMHatchFill(e,t){const r=t*(e.separation??p.defaultCIMValues.CIMHatchFill.separation),i=r/2,n=s.clone(e.lineSymbol);n.symbolLayers?.forEach(e=>{switch(e.type){case"CIMSolidStroke":null!=e.width&&(e.width*=t),e.effects?.forEach(e=>{if("CIMGeometricEffectDashes"===e.type){const r=e.dashTemplate;e.dashTemplate=r?.map(e=>e*t)}});break;case"CIMVectorMarker":{null!=e.size&&(e.size*=t);const r=e.markerPlacement;null!=r&&"placementTemplate"in r&&(r.placementTemplate=r.placementTemplate.map(e=>e*t));break}}});let o=this._getLineSymbolPeriod(n)||4;for(;o<4;)o*=2;const a=o/2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-i,ymax:i},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:n}],size:r}}static fetchResources(e,t,r,s=null){if(!e||!t)return r;switch(e.type){case"CIMMeshSymbol":case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":for(const t of e.effects||[])r.push(u.loadGeometryOperatorsForEffect(t))}return k(e,e=>{for(const t of e.effects||[])r.push(u.loadGeometryOperatorsForEffect(t));"url"in e&&e.url&&r.push(t.fetchResource(e.url,{signal:s}))}),r}static fetchFonts(e,t,r){if(e&&t)if("symbolLayers"in e&&e.symbolLayers){for(const s of e.symbolLayers)if("CIMVectorMarker"===s.type&&s.markerGraphics)for(const e of s.markerGraphics)e?.symbol&&F.fetchFonts(e.symbol,t,r)}else if("CIMTextSymbol"===e.type){const{fontFamilyName:s,fontStyleName:i}=e;if(!s||"calcitewebcoreicons"===s.toLowerCase())return;const{style:n,weight:o}=f.fromCIMFontStyle(i),a=f.fromCIMFontDecoration(e),l=new c({family:s,style:n,weight:o,decoration:a});r.push(t.loadFont(l).catch(()=>{M().error(`Unsupported font ${s} in CIM symbol`)}))}}static _getLineSymbolPeriod(e){if(e){const t=this._getEffectsRepeat(e.effects);if(t)return t;if(e.symbolLayers)for(const t of e.symbolLayers)if(t){const e=this._getEffectsRepeat(t.effects);if(e)return e;switch(t.type){case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":case"CIMObjectMarker3D":case"CIMglTFMarker3D":{const e=this._getPlacementRepeat(t.markerPlacement);if(e)return e}}}}return 0}static _getEffectsRepeat(e){if(e)for(const t of e)if(t)switch(t.type){case"CIMGeometricEffectDashes":{const e=t.dashTemplate;if(e&&e.length){let t=0;for(const r of e)t+=r;return 1&e.length&&(t*=2),t}break}case"CIMGeometricEffectWave":return t.period;default:M().error(`unsupported geometric effect type ${t.type}`)}return 0}static _getPlacementRepeat(e){if(e)switch(e.type){case"CIMMarkerPlacementAlongLineSameSize":case"CIMMarkerPlacementAlongLineRandomSize":case"CIMMarkerPlacementAlongLineVariableSize":{const t=e.placementTemplate;if(t&&t.length){let e=0;for(const r of t)e+=+r;return 1&t.length&&(e*=2),e}break}}return 0}static fromCIMInsidePolygon(e){const t=e.markerPlacement,r={...e};r.markerPlacement=null,r.anchorPoint=null;const s=Math.abs(t.stepX),i=Math.abs(t.stepY),a=(t.randomness??100)/100;let l,c,u,h;if("Random"===t.gridType){const e=o.px2pt(y.randomInsidePolygonTextureSize),r=Math.max(Math.floor(e/s),1),d=Math.max(Math.floor(e/i),1);l=r*s/2,c=d*i/2,u=2*c;const p=new n(t.seed),f=a*s/1.5,m=a*i/1.5;h=[];for(let e=0;e<r;e++)for(let t=0;t<d;t++){const r=e*s-l+f*(.5-p.getFloat()),n=t*i-c+m*(.5-p.getFloat());h.push({x:r,y:n}),0===e&&h.push({x:r+2*l,y:n}),0===t&&h.push({x:r,y:n+2*c})}}else!0===t.shiftOddRows?(l=s/2,c=i,u=2*i,h=[{x:-l,y:0},{x:l,y:0},{x:0,y:c},{x:0,y:-c}]):(l=s/2,c=i/2,u=i,h=[{x:-s,y:0},{x:0,y:-i},{x:-s,y:-i},{x:0,y:0},{x:s,y:0},{x:0,y:i},{x:s,y:i},{x:-s,y:i},{x:s,y:-i}]);return{type:"CIMVectorMarker",frame:{xmin:-l,xmax:l,ymin:-c,ymax:c},markerGraphics:h.map(e=>({type:"CIMMarkerGraphic",geometry:e,symbol:{type:"CIMPointSymbol",symbolLayers:[r]}})),size:u}}}function k(e,t){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":{const r=e.symbolLayers;if(!r)return;for(const e of r)if(t(e),"CIMVectorMarker"===e.type){const r=e.markerGraphics;if(!r)continue;for(const e of r)if(e){const r=e.symbol;r&&k(r,t)}}break}}}const A=e=>{if(!e)return"Butt";switch(e){case"butt":return"Butt";case"square":return"Square";case"round":return"Round"}},O=e=>{if(!e)return"Miter";switch(e){case"miter":return"Miter";case"round":return"Round";case"bevel":return"Bevel"}},E=e=>{if(null==e)return"Center";switch(e){case"left":return"Left";case"right":return"Right";case"center":return"Center"}},z=e=>{if(null==e)return"Center";switch(e){case"baseline":return"Baseline";case"top":return"Top";case"middle":return"Center";case"bottom":return"Bottom"}},R=e=>{if(!e)return[0,0,0,0];const{r:t,g:r,b:s,a:i}=e;return[t,r,s,255*i]},L=(e,t)=>{const r=D(t),s=N(e);return r&&s?`${r}-${s}`:`${r}${s}`},D=e=>{if(!e)return"";switch(e.toLowerCase()){case"bold":case"bolder":return"bold"}return""},N=e=>{if(!e)return"";switch(e.toLowerCase()){case"italic":case"oblique":return"italic"}return""},G=(e,t)=>{const s=r("safari")?.001:0,i="butt"===t;switch(e){case"dash":case"esriSLSDash":return i?[4,3]:[3,4];case"dash-dot":case"esriSLSDashDot":return i?[4,3,1,3]:[3,4,s,4];case"dot":case"esriSLSDot":return i?[1,3]:[s,4];case"long-dash":case"esriSLSLongDash":return i?[8,3]:[7,4];case"long-dash-dot":case"esriSLSLongDashDot":return i?[8,3,1,3]:[7,4,s,4];case"long-dash-dot-dot":case"esriSLSDashDotDot":return i?[8,3,1,3,1,3]:[7,4,s,4,s,4];case"short-dash":case"esriSLSShortDash":return i?[4,1]:[3,2];case"short-dash-dot":case"esriSLSShortDashDot":return i?[4,1,1,1]:[3,2,s,2];case"short-dash-dot-dot":case"esriSLSShortDashDotDot":return i?[4,1,1,1,1,1]:[3,2,s,2,s,2];case"short-dot":case"esriSLSShortDot":return i?[1,1]:[s,2];case"solid":case"esriSLSSolid":case"none":return M().error("Unexpected: style does not require rasterization"),[0,0];default:return M().error(`Tried to rasterize SLS, but found an unexpected style: ${e}!`),[0,0]}},q=(e,t=100)=>{const r=t/2;let s,i;const n=e;if("circle"===n||"esriSMSCircle"===n){const e=.25;let t=Math.acos(1-e/r),n=Math.ceil(S/t/4);0===n&&(n=1),t=x/n,n*=4;const o=[];o.push([r,0]);for(let e=1;e<n;e++)o.push([r*Math.cos(e*t),-r*Math.sin(e*t)]);o.push([r,0]),s={rings:[o]},i={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if("cross"===n||"esriSMSCross"===n){const e=0;s={paths:[[[e,r],[e,-r]],[[r,e],[-r,e]]]},i={xmin:-r,ymin:-r,xmax:r,ymax:r}}else if("diamond"===n||"esriSMSDiamond"===n)s={rings:[[[-r,0],[0,r],[r,0],[0,-r],[-r,0]]]},i={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("square"===n||"esriSMSSquare"===n)s={rings:[[[-r,-r],[-r,r],[r,r],[r,-r],[-r,-r]]]},i={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("x"===n||"esriSMSX"===n)s={paths:[[[r,r],[-r,-r]],[[r,-r],[-r,r]]]},i={xmin:-r,ymin:-r,xmax:r,ymax:r};else if("triangle"===n||"esriSMSTriangle"===n){const e=.5773502691896257*t,r=-e,n=2/3*t,o=n-t;s={rings:[[[r,o],[0,n],[e,o],[r,o]]]},i={xmin:r,ymin:o,xmax:e,ymax:n}}else"arrow"===n&&(s={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},i={xmin:-r,ymin:-r,xmax:r,ymax:r});return[i,s]},B=e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e;function U(e){if(!e)return null;let t=null;const{cap:r,color:s,join:i,miterLimit:n,style:o,width:a}=e;return"solid"!==o&&"none"!==o&&"esriSLSSolid"!==o&&"esriSLSNull"!==o&&(t=[{type:"CIMGeometricEffectDashes",dashTemplate:G(o,r),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]),{type:"CIMSolidStroke",color:"esriSLSNull"!==o&&"none"!==o?R(s):[0,0,0,0],capStyle:A(r),joinStyle:O(i),miterLimit:n,width:a,effects:t}}e.CIMSymbolHelper=F,e.CIMSymbolInflatedSizeHelper=class{static getSymbolInflateSize(e,t,r,s,i){return e||(e=[0,0,0,0]),t?this._getInflateSize(e,t,r,s,i):e}static safeSize(e){const t=Math.max(Math.abs(e[0]),Math.abs(e[2])),r=Math.max(Math.abs(e[1]),Math.abs(e[3]));return Math.sqrt(t*t+r*r)}static _vectorMarkerBounds(e,t,r,s){let i=!0;const n=a.create();if(t?.markerGraphics)for(const o of t.markerGraphics){const t=[0,0,0,0];o.geometry&&(l.getBoundsXY(n,o.geometry),t[0]=0,t[1]=0,t[2]=0,t[3]=0,this.getSymbolInflateSize(t,o.symbol,r,0,s),n[0]+=t[0],n[1]+=t[1],n[2]+=t[2],n[3]+=t[3],i?(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],i=!1):(e[0]=Math.min(e[0],n[0]),e[1]=Math.min(e[1],n[1]),e[2]=Math.max(e[2],n[2]),e[3]=Math.max(e[3],n[3])))}return e}static _getInflateSize(e,t,r,s,i){if(void 0!==t.symbolLayers){const n=this._getLayersInflateSize(e,t.symbolLayers,r,s,i),o=C(t.effects);return o>0&&(n[0]-=o,n[1]-=o,n[2]+=o,n[3]+=o),n}return this._getTextInflatedSize(e,t,i)}static _getLayersInflateSize(e,t,r,s,i){let n=!0;if(!t)return e;for(const o of t){if(!o)continue;let t=[0,0,0,0];switch(o.type){case"CIMSolidFill":case"CIMPictureFill":case"CIMHatchFill":case"CIMGradientFill":break;case"CIMSolidStroke":case"CIMPictureStroke":case"CIMGradientStroke":{const e=o;let r=e.width;null!=r&&("Square"===e.capStyle||"Miter"===e.joinStyle?r/=1.4142135623730951:r/=2,t[0]=-r,t[1]=-r,t[2]=r,t[3]=r);break}case"CIMCharacterMarker":case"CIMVectorMarker":case"CIMPictureMarker":{const e=o;if("CIMVectorMarker"===o.type){const e=o;if(t=this._vectorMarkerBounds(t,e,r,i),e.frame){const r=(e.frame.xmin+e.frame.xmax)/2,s=(e.frame.ymin+e.frame.ymax)/2;if(t[0]-=r,t[1]-=s,t[2]-=r,t[3]-=s,null!=e.size){const r=e.size/(e.frame.ymax-e.frame.ymin);t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r}}}else if("CIMPictureMarker"===o.type){const s=o,i=r.getResource(s.url);let n=1;if(null!=i&&i.height&&(n=i.width/i.height),null!=e.size){const r=e.size/2,i=e.size*n*s.scaleX/2;t=[-i,-r,i,r]}}else if(null!=e.size){const r=e.size/2;t=[-r,-r,r,r]}if(e.anchorPoint){let r,s;"Absolute"===e.anchorPointUnits?(r=e.anchorPoint.x,s=e.anchorPoint.y):(r=e.anchorPoint.x*(t[2]-t[0]),s=e.anchorPoint.y*(t[3]-t[1]));const i=1.25*Math.sqrt(r*r+s*s);t[0]-=i,t[1]-=i,t[2]+=i,t[3]+=i}let n=f.getNumericValue(e.rotation);if(e.rotateClockwise&&(n=-n),s&&(n-=s),n){const e=w*n,r=Math.cos(e),s=Math.sin(e),i=a.create([g.cInfinity,g.cInfinity,-g.cInfinity,-g.cInfinity]);a.expandPointInPlace(i,[t[0]*r-t[1]*s,t[0]*s+t[1]*r]),a.expandPointInPlace(i,[t[0]*r-t[3]*s,t[0]*s+t[3]*r]),a.expandPointInPlace(i,[t[2]*r-t[1]*s,t[2]*s+t[1]*r]),a.expandPointInPlace(i,[t[2]*r-t[3]*s,t[2]*s+t[3]*r]),t=i}let l=f.getNumericValue(e.offsetX),c=f.getNumericValue(e.offsetY);if(s){const e=w*s,t=Math.cos(e),r=Math.sin(e),i=l*r+c*t;l=l*t-c*r,c=i}t[0]+=l,t[1]+=c,t[2]+=l,t[3]+=c;const u=P(e.markerPlacement);u>0&&(t[0]-=u,t[1]-=u,t[2]+=u,t[3]+=u);break}}const l=C(o.effects);l>0&&(t[0]-=l,t[1]-=l,t[2]+=l,t[3]+=l),n?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],n=!1):(e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[2]),e[3]=Math.max(e[3],t[3]))}return e}static _getTextInflatedSize(e,t,r){const s=b.roundPtToWholePixel(t.height??p.defaultCIMValues.CIMTextSymbol.height);if(e[0]=-s/2,e[1]=-s/2,e[2]=s/2,e[3]=s/2,!r)return e;const i=r.get(t);if(!i)return e;if(!i.glyphMosaicItems.glyphs.length)return e;const{lineGapType:n,lineGap:o}=t,a=n?d.lineGapType2LineHeight(n,o??0,s):0,l="CIMBackgroundCallout"===t.callout?.type,c=_.shapeGlyphs(i.glyphMosaicItems,{scale:s/y.glyphSize,angle:f.getNumericValue(t.angle),xOffset:f.getNumericValue(t.offsetX),yOffset:f.getNumericValue(t.offsetY),horizontalAlignment:t.horizontalAlignment,verticalAlignment:t.verticalAlignment,maxLineWidth:b.getLineWidth(t.lineWidth),lineHeight:y.magicLabelLineHeight*Math.max(.25,Math.min(a||1,4)),decoration:t.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}).boundsT,u=Math.sqrt(c.width*c.width+c.height*c.height);return e[0]-=c.x+u,e[1]-=c.y-u,e[2]+=c.x+u,e[3]+=-c.y+u,e}},e.capTypeToEnum=A,e.getEffectsInflateSize=C,e.slsDashToTemplateArray=G,e.symbolToCIM=function(e){let t;switch(e.type){case"cim":return e.data;case"web-style":return e;case"simple-marker":{const r=F.fromSimpleMarker(e);if(!r)throw new Error("InternalError: Cannot convert symbol to CIM");t=r;break}case"picture-marker":t=F.fromPictureMarker(e);break;case"simple-line":t=F.fromSimpleLineSymbol(e);break;case"simple-fill":t=F.fromSimpleFillSymbol(e);break;case"picture-fill":t=F.fromPictureFillSymbol(e);break;case"text":t=F.fromTextSymbol(e)}return{type:"CIMSymbolReference",symbol:t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/BidiText":function(){define(["exports","./BidiEngine"],function(e,t){"use strict";const r=new t;e.bidiText=function(e){if(null==e)return["",!1];if(!r.hasBidiChar(e))return[e,!1];let t;return t="rtl"===r.checkContextual(e)?"IDNNN":"ICNNN",[r.bidiTransform(e,t,"VLYSN"),!0]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/Font":function(){define(["exports","../chunks/tslib.es6","../core/JSONSupport","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./support/textUtils"],function(e,t,r,s,i,n,o,a,l,c){"use strict";var u;return e.default=u=class extends r.JSONSupport{constructor(e){super(e),this.decoration="none",this.family="sans-serif",this.size=9,this.style="normal",this.weight="normal"}castSize(e){return s.toPt(e)}clone(){return new u({decoration:this.decoration,family:this.family,size:this.size,style:this.style,weight:this.weight})}hash(){return`${this.decoration}.${this.family}.${this.size}.${this.style}.${this.weight}`}},t.__decorate([i.property({type:c.fontDecorations,json:{default:"none",write:!0}})],e.default.prototype,"decoration",void 0),t.__decorate([i.property({type:String,json:{write:!0}})],e.default.prototype,"family",void 0),t.__decorate([i.property({type:Number,json:{write:{overridePolicy:(e,t,r)=>({enabled:!r||!r.textSymbol3D})}}})],e.default.prototype,"size",void 0),t.__decorate([n.cast("size")],e.default.prototype,"castSize",null),t.__decorate([i.property({type:c.fontStyles,json:{default:"normal",write:!0}})],e.default.prototype,"style",void 0),t.__decorate([i.property({type:c.fontWeights,json:{default:"normal",write:!0}})],e.default.prototype,"weight",void 0),e.default=u=t.__decorate([l.subclass("esri.symbols.Font")],e.default),e.default})},"esri/symbols/support/textUtils":function(){define(["exports","../../core/mathUtils","../../core/accessorSupport/ensureType"],function(e,t,r){"use strict";const s={type:Number,cast:e=>{const s=r.ensureNumber(e);return 0===s?1:t.clamp(s,.1,4)},nonNullable:!0},i=["left","right","center"],n=["baseline","top","middle","bottom"],o={type:i,nonNullable:!0},a={type:n,nonNullable:!0};e.backgroundPadding=8,e.fontDecorations=["none","underline","line-through"],e.fontStyles=["normal","italic","oblique"],e.fontWeights=["normal","lighter","bold","bolder"],e.horizontalAlignmentProperty=o,e.horizontalAlignments=i,e.lineHeightProperty=s,e.verticalAlignmentProperty=a,e.verticalAlignments=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMSymbolDrawHelper":function(){define(["exports","../../core/fontUtils","../../core/has","../../core/lang","../../core/Logger","../../core/mathUtils","../../core/ObjectPool","../../core/screenUtils","../../geometry/GeometryCursor","../../geometry/support/aaBoundingRect","../../geometry/support/boundsUtils","../../geometry/support/centroid","../../geometry/support/jsonUtils","./CIMEffects","./CIMImageColorSubstitutionHelper","./CIMOperators","./CIMPlacements","./defaultCIMValues","./imageUtils","./mathUtils","./rasterizingUtils","./Rect","./TextRasterizer","./utils","../../views/2d/engine/svgUtils","../../views/2d/engine/webgl/definitions","../../views/2d/engine/webgl/mesh/templates/shapingUtils","../../views/2d/layers/graphics/graphicsUtils"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_,b,S,x,w,v,M,I,P,T){"use strict";const C=Math.PI/180,F=()=>i.getLogger("esri.symbols.cim.CIMSymbolDrawHelper");class k{constructor(e){this._t=e}static createIdentity(){return new k([1,0,0,0,1,0])}clone(){const e=this._t;return new k(e.slice())}transform(e){const t=this._t;return[t[0]*e[0]+t[1]*e[1]+t[2],t[3]*e[0]+t[4]*e[1]+t[5]]}static createScale(e,t){return new k([e,0,0,0,t,0])}scale(e,t){const r=this._t;return r[0]*=e,r[1]*=e,r[2]*=e,r[3]*=t,r[4]*=t,r[5]*=t,this}scaleRatio(){return Math.sqrt(this._t[0]*this._t[0]+this._t[1]*this._t[1])}static createTranslate(e,t){return new k([0,0,e,0,0,t])}translate(e,t){const r=this._t;return r[2]+=e,r[5]+=t,this}static createRotate(e){const t=Math.cos(e),r=Math.sin(e);return new k([t,-r,0,r,t,0])}rotate(e){return k.multiply(this,k.createRotate(e),this)}angle(){const e=this._t[0],t=this._t[3],r=Math.sqrt(e*e+t*t);return[e/r,t/r]}static multiply(e,t,r){const s=e._t,i=t._t,n=s[0]*i[0]+s[3]*i[1],o=s[1]*i[0]+s[4]*i[1],a=s[2]*i[0]+s[5]*i[1]+i[2],l=s[0]*i[3]+s[3]*i[4],c=s[1]*i[3]+s[4]*i[4],u=s[2]*i[3]+s[5]*i[4]+i[5],h=r._t;return h[0]=n,h[1]=o,h[2]=a,h[3]=l,h[4]=c,h[5]=u,r}invert(){const e=this._t;let t=e[0]*e[4]-e[1]*e[3];if(0===t)return new k([0,0,0,0,0,0]);t=1/t;const r=(e[1]*e[5]-e[2]*e[4])*t,s=(e[2]*e[3]-e[0]*e[5])*t,i=e[4]*t,n=-e[1]*t,o=-e[3]*t,a=e[0]*t;return new k([i,n,r,o,a,s])}}class A{constructor(e,t){this._resourceManager=e,this._transfos=[],this._sizeTransfos=[],this._geomUnitsPerPoint=1,this._placementPool=new o(g.Placement,void 0,void 0,100),this._earlyReturn=!1,this._mapRotation=0,this._transfos.push(t||k.createIdentity()),this._sizeTransfos.push(t?t.scaleRatio():1)}setTransform(e,t){this._transfos=[e||k.createIdentity()],this._sizeTransfos=[t||(e?e.scaleRatio():1)]}setGeomUnitsPerPoint(e){this._geomUnitsPerPoint=e}transformPt(e){return this._transfos[this._transfos.length-1].transform(e)}transformSize(e){return e*this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformPt(e){return this._transfos[this._transfos.length-1].invert().transform(e)}reverseTransformSize(e){return e/this._sizeTransfos[this._sizeTransfos.length-1]}reverseTransformScalar(e){return e/this._transfos[this._transfos.length-1].scaleRatio()}getTransformAngle(){return this._transfos[this._transfos.length-1].angle()}geomUnitsPerPoint(){return this.isEmbedded()?1:this._geomUnitsPerPoint}prevGeomUnitsPerPoint(){return this._transfos.length>2?1:this._geomUnitsPerPoint}isEmbedded(){return this._transfos.length>1}back(){return this._transfos[this._transfos.length-1]}push(e,t){const r=t?e.scaleRatio():1;k.multiply(e,this.back(),e),this._transfos.push(e),this._sizeTransfos.push(this._sizeTransfos[this._sizeTransfos.length-1]*r)}pop(){this._transfos.splice(-1,1),this._sizeTransfos.splice(-1,1)}drawSymbol(e,t,r){if(e)switch(e.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":this.drawMultiLayerSymbol(e,t);break;case"CIMTextSymbol":this.drawTextSymbol(e,t,r)}}drawMultiLayerSymbol(e,t){if(!e||!t)return;const r=e.symbolLayers;if(!r)return;const s=e.effects;if(s&&s.length>0){const e=this.executeEffects(s,t);if(e){let t=e.next();for(;t;)this.drawSymbolLayers(r,t.asJSON()),t=e.next()}}else this.drawSymbolLayers(r,t)}executeEffects(e,t){let r=new p.SimpleEffectCursor(l.GeometryCursor.fromJSONCIM(t));for(const t of e){const e=m.getEffectOperator(t);e&&(r=e.execute(r,t,this.geomUnitsPerPoint(),null))}return r}drawSymbolLayers(e,t){let r=e.length;for(;r--;){const s=e[r];if(!s||!1===s.enable)continue;const i=s.effects;if(i&&i.length>0){const e=this.executeEffects(i,t);if(e){let t=null;for(;(t=e.next())&&(this.drawSymbolLayer(s,t.asJSON()),!this._earlyReturn););}}else this.drawSymbolLayer(s,t);if(this._earlyReturn)return}}drawSymbolLayer(e,t){switch(e.type){case"CIMSolidFill":this.drawSolidFill(t,e.color,e.path);break;case"CIMHatchFill":this.drawHatchFill(t,e);break;case"CIMPictureFill":this.drawPictureFill(t,e);break;case"CIMGradientFill":this.drawGradientFill(t,e);break;case"CIMSolidStroke":this.drawSolidStroke(t,e.color,e.width,e.capStyle,e.joinStyle,e.miterLimit,e.path);break;case"CIMPictureStroke":this.drawPictureStroke(t,e);break;case"CIMGradientStroke":this.drawGradientStroke(t,e);break;case"CIMCharacterMarker":case"CIMPictureMarker":case"CIMVectorMarker":this.drawMarkerLayer(e,t)}}drawHatchFill(e,t){const r=function(e,t,r){let s=v.getNumericValue(e.separation,y.defaultCIMValues.CIMHatchFill.separation)*r,i=v.getNumericValue(e.rotation);if(0===s)return null;s<0&&(s=-s);let n=0;const o=.5*s;for(;n>o;)n-=s;for(;n<-o;)n+=s;const a=c.create();u.getBoundsXY(a,t),a[0]-=o,a[1]-=o,a[2]+=o,a[3]+=o;const l=[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]];for(;i>180;)i-=180;for(;i<0;)i+=180;const h=Math.cos(i*C),d=Math.sin(i*C),p=-s*d,f=s*h;let m,g,_,b;n=v.getNumericValue(e.offsetX)*r*d-v.getNumericValue(e.offsetY)*r*h,m=_=Number.MAX_VALUE,g=b=-Number.MAX_VALUE;for(const e of l){const t=e[0],r=e[1],s=h*t+d*r,i=-d*t+h*r;m=Math.min(m,s),_=Math.min(_,i),g=Math.max(g,s),b=Math.max(b,i)}_=Math.floor(_/s)*s;let S=h*m-d*_-p*n/s,x=d*m+h*_-f*n/s,w=h*g-d*_-p*n/s,M=d*g+h*_-f*n/s;const I=1+Math.round((b-_)/s),P=[];for(let e=0;e<I;e++)S+=p,x+=f,w+=p,M+=f,P.push([[S,x],[w,M]]);return{paths:P}}(t,e,this.geomUnitsPerPoint());r&&(this.pushClipPath(e),this.drawMultiLayerSymbol(t.lineSymbol,r),this.popClipPath())}drawPictureFill(e,t){}drawGradientFill(e,t){}drawPictureStroke(e,t){}drawGradientStroke(e,t){}drawMarkerLayer(e,t){const r=e.markerPlacement;if(r){const s=m.getPlacementOperator(r);if(s){const i="CIMMarkerPlacementInsidePolygon"===r.type||"CIMMarkerPlacementPolygonCenter"===r.type&&r.clipAtBoundary;i&&this.pushClipPath(t);const n=s.execute(l.GeometryCursor.fromJSONCIM(t),r,this.geomUnitsPerPoint(),null);if(n){let t=null;for(;(t=n.next())&&(this.drawMarker(e,t),!this._earlyReturn););}i&&this.popClipPath()}}else{const r=this._placementPool.acquire();if(d.isPoint(t))r.tx=t.x,r.ty=t.y,this.drawMarker(e,r);else if(d.isPolygon(t)){const s=h.polygonCentroid(t);s&&([r.tx,r.ty]=s,this.drawMarker(e,r))}else if(d.isPolyline(t)){for(const s of t.paths)for(const t of s)if(r.tx=t[0],r.ty=t[1],this.drawMarker(e,r),this._earlyReturn)break}else for(const s of t.points)if(r.tx=s[0],r.ty=s[1],this.drawMarker(e,r),this._earlyReturn)break;this._placementPool.release(r)}}drawMarker(e,t){switch(e.type){case"CIMCharacterMarker":case"CIMPictureMarker":this.drawPictureMarker(e,t);break;case"CIMVectorMarker":this.drawVectorMarker(e,t)}}drawPictureMarker(e,t){if(!e)return;const r=this._resourceManager.getResource(e.url),s=v.getNumericValue(e.size,y.defaultCIMValues.CIMPictureMarker.size);if(null==r||s<=0)return;const i=r.width,n=r.height;if(!i||!n)return;const o=i/n,a=v.getNumericValue(e.scaleX,1),l=k.createIdentity(),c=e.anchorPoint;if(c){let t=c.x,r=c.y;"Absolute"!==e.anchorPointUnits&&(t*=s*o*a,r*=s),l.translate(-t,-r)}let u=v.getNumericValue(e.rotation);e.rotateClockwise&&(u=-u),this._mapRotation&&(u+=this._mapRotation),u&&l.rotate(u*C);let h=v.getNumericValue(e.offsetX),d=v.getNumericValue(e.offsetY);if(h||d){if(this._mapRotation){const e=C*this._mapRotation,t=Math.cos(e),r=Math.sin(e),s=h*r+d*t;h=h*t-d*r,d=s}l.translate(h,d)}const p=this.geomUnitsPerPoint();1!==p&&l.scale(p,p);const f=t.getAngle();f&&l.rotate(f),l.translate(t.tx,t.ty),this.push(l,!1),this.drawImage(e,s),this.pop()}drawVectorMarker(e,t){if(!e)return;const r=e.markerGraphics;if(!r)return;const s=v.getNumericValue(e.size,y.defaultCIMValues.CIMVectorMarker.size),i=e.frame,n=i?i.ymax-i.ymin:0,o=s&&n?s/n:1,a=k.createIdentity();i&&a.translate(.5*-(i.xmax+i.xmin),.5*-(i.ymax+i.ymin));const l=e.anchorPoint;if(l){let t=l.x,r=l.y;"Absolute"!==e.anchorPointUnits?i&&(t*=i.xmax-i.xmin,r*=i.ymax-i.ymin):(t/=o,r/=o),a.translate(-t,-r)}1!==o&&a.scale(o,o);let c=v.getNumericValue(e.rotation);e.rotateClockwise&&(c=-c),this._mapRotation&&(c+=this._mapRotation),c&&a.rotate(c*C);let u=v.getNumericValue(e.offsetX),h=v.getNumericValue(e.offsetY);if(u||h){if(this._mapRotation){const e=C*this._mapRotation,t=Math.cos(e),r=Math.sin(e),s=u*r+h*t;u=u*t-h*r,h=s}a.translate(u,h)}const d=this.geomUnitsPerPoint();1!==d&&a.scale(d,d);const p=t.getAngle();p&&a.rotate(p),a.translate(t.tx,t.ty),this.push(a,e.scaleSymbolsProportionally);for(const e of r){e?.symbol&&e.geometry||F().error("Invalid marker graphic",e);let t=e.textString;if("number"==typeof t&&(t=t.toString()),this.drawSymbol(e.symbol,e.geometry,t),this._earlyReturn)break}this.pop()}drawTextSymbol(e,t,r){if(!e)return;if(!d.isPoint(t))return;if(v.getNumericValue(e.height,y.defaultCIMValues.CIMTextSymbol.height)<=0)return;const s=k.createIdentity();let i=v.getNumericValue(e.angle);i=-i,i&&s.rotate(i*C);const n=v.getNumericValue(e.offsetX),o=v.getNumericValue(e.offsetY);(n||o)&&s.translate(n,o);const a=this.geomUnitsPerPoint();1!==a&&s.scale(a,a),s.translate(t.x,t.y),this.push(s,!1),this.drawText(e,r),this.pop()}}function O(e,t,r){for(const s of t){const t=s.length;for(let i=1;i<t;i++){const t=s[i-1],n=s[i];let o=(n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1]);if(0===o)continue;o=Math.sqrt(o);const a=((n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0]))/o;if(Math.abs(a)<r){const s=((n[0]-t[0])*(e[0]-t[0])+(n[1]-t[1])*(e[1]-t[1]))/o;if(s>-r&&s<o+r)return!0}}}return!1}function E(e,t){const r=t[0]-e[0],s=t[1]-e[1];return 180/Math.PI*Math.atan2(s,r)}const z=e=>e?{spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:null,R=(e,t,r)=>{switch(e){case"ExtraLeading":return 1+t/r;case"Multiple":return t;case"Exact":return t/r}};function L(e,r=1){const s=v.fromCIMFontDecoration(e),i=v.fromCIMFontStyle(e.fontStyleName),n=e.fontFamilyName??t.defaultFontFamily,{weight:o,style:a}=i,l=r*(e.height||5),c=v.fromCIMHorizontalAlignment(e.horizontalAlignment),u=v.fromCIMVerticalAlignment(e.verticalAlignment),h=v.getFillColor(e),d=v.getFillColor(e.haloSymbol),p=null!=d?r*(e.haloSize??0):0,f=v.getStrokeColor(e.symbol),m=r*(v.getStrokeWidth(e.symbol)||0),g="CIMBackgroundCallout"===e.callout?.type?e.callout.backgroundSymbol:null,y=v.getFillColor(g),_=v.getStrokeWidth(g),b=v.getStrokeColor(g);return{color:h,size:l,horizontalAlignment:c,verticalAlignment:u,font:{family:n,style:v.getFontStyle(a),weight:v.getFontWeight(o),decoration:s},outline:{size:m||0,color:f},halo:{size:p||0,color:d,style:a},backgroundColor:y,borderLine:null!=_&&null!=b?{size:_,color:b}:null,pixelRatio:1,premultiplyColors:!0}}function D(e){let t,r,s,i,n,o=e[0],a=1;for(;a<e.length;)t=e[a][0]-o[0],r=e[a][1]-o[1],i=0!==t?r/t:Math.PI/2,void 0!==s&&Math.abs(i-s)<=1e-4?(e.splice(a-1,1),o=n):(n=o,o=e[a],a++),s=i}e.CIMSymbolDrawHelper=A,e.CanvasDrawHelper=class extends A{constructor(e,t,r,s){super(t,r),this._applyAdditionalRenderProps=s,this._colorSubstitutionHelper=new f,this._ctx=e}drawSolidFill(e,t){if(!e)return;if(d.isPolygon(e))this._buildPath(e.rings,!0);else if(d.isPolyline(e))this._buildPath(e.paths,!0);else if(d.isExtent(e))this._buildPath(z(e).rings,!0);else{if(!d.isMultipoint(e))return;console.log("CanvasDrawHelper.drawSolidFill - No implementation!")}const r=this._ctx;r.fillStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",r.fill("evenodd")}drawSolidStroke(e,t,r,s,i,n){if(!e||!t||0===r)return;if(d.isPolygon(e))this._buildPath(e.rings,!0);else if(d.isPolyline(e))this._buildPath(e.paths,!1);else{if(!d.isExtent(e))return void console.log("CanvasDrawHelper.drawSolidStroke isn't implemented!");this._buildPath(z(e).rings,!0)}const o=this._ctx;o.strokeStyle="string"==typeof t?t:"rgba("+Math.round(t[0])+","+Math.round(t[1])+","+Math.round(t[2])+","+(t[3]??255)/255+")",o.lineWidth=Math.max(this.transformSize(r),.5),this._setCapStyle(s),this._setJoinStyle(i),o.miterLimit=n,o.stroke()}pushClipPath(e){if(this._ctx.save(),d.isPolygon(e))this._buildPath(e.rings,!0);else if(d.isPolyline(e))this._buildPath(e.paths,!0);else{if(!d.isExtent(e))return;this._buildPath(z(e).rings,!0)}this._ctx.clip("evenodd")}popClipPath(){this._ctx.restore()}drawImage(e,t){const{colorSubstitutions:r,url:s,tintColor:i}=e,n=v.getNumericValue(e.scaleX,1),o=this._resourceManager.getResource(s);if(null==o)return;let a=t*(o.width/o.height),l=t;t||(a=o.width,l=o.height);const c=v.isSVGImage(s)||"src"in o&&v.isSVGImage(o.src);let u="getFrame"in o?_.getFirstFrame(o):o;r&&(u=this._colorSubstitutionHelper.applyColorSubstitution(u,r)),this._applyAdditionalRenderProps&&!c&&i&&(u=this._colorSubstitutionHelper.tintImageData(u,i));const h=this.transformPt([0,0]),[d,p]=this.getTransformAngle(),f=this.transformSize(1),m=this._ctx;m.save(),m.setTransform({m11:n*f*d,m12:n*f*p,m21:-f*p,m22:f*d,m41:h[0],m42:h[1]}),m.drawImage(u,-a/2,-l/2,a,l),m.restore()}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new w);const r=L(e,this.transformSize(a.px2pt(1))),s=this._textRasterizer.rasterizeText(t,r);if(!s)return;const{size:i,anchorX:n,anchorY:o,canvas:l}=s,c=i[0]*(n+.5),u=i[1]*(o-.5),h=this._ctx,d=this.transformPt([0,0]),[p,f]=this.getTransformAngle();h.save(),h.setTransform({m11:1*p,m12:1*f,m21:-1*f,m22:1*p,m41:d[0]-1*c,m42:d[1]+1*u}),h.drawImage(l,0,0),h.restore()}drawPictureFill(e,t){if(!e)return;let{colorSubstitutions:r,height:s,offsetX:i,offsetY:n,rotation:o,scaleX:a,tintColor:l,url:c}=t;const u=this._resourceManager.getResource(c);if(null==u)return;if(d.isPolygon(e))this._buildPath(e.rings,!0);else if(d.isPolyline(e))this._buildPath(e.paths,!0);else if(d.isExtent(e))this._buildPath(z(e).rings,!0);else{if(!d.isMultipoint(e))return;console.log("CanvasDrawHelper.drawPictureFill - No implementation!")}const h=this._ctx,p=v.isSVGImage(c)||"src"in u&&v.isSVGImage(u.src);let f,m="getFrame"in u?_.getFirstFrame(u):u;if(r&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,r)),this._applyAdditionalRenderProps){p||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)),f=h.createPattern(m,"repeat");const e=this.transformSize(1);o||(o=0),i?i*=e:i=0,n?n*=e:n=0,s&&(s*=e);const t=s?s/u.height:1,r=a&&s?a*s/u.width:1;if(0!==o||1!==t||1!==r||0!==i||0!==n){const e=new DOMMatrix;e.rotateSelf(0,0,-o).translateSelf(i,n).scaleSelf(r,t,1),f.setTransform(e)}}else f=h.createPattern(m,"repeat");h.save(),h.fillStyle=f,h.fill("evenodd"),h.restore()}drawPictureStroke(e,t){if(!e)return;let{colorSubstitutions:r,capStyle:i,joinStyle:n,miterLimit:o,tintColor:l,url:c,width:u}=t;const h=this._resourceManager.getResource(c);if(null==h)return;let p;if(d.isPolygon(e))p=e.rings;else if(d.isPolyline(e))p=e.paths;else{if(!d.isExtent(e))return d.isMultipoint(e)?void console.log("CanvasDrawHelper.drawPictureStroke - No implementation!"):void 0;p=z(e).rings}u||(u=h.width);const f=v.isSVGImage(c)||"src"in h&&v.isSVGImage(h.src);let m="getFrame"in h?_.getFirstFrame(h):h;r&&(m=this._colorSubstitutionHelper.applyColorSubstitution(m,r)),this._applyAdditionalRenderProps&&(f||l&&(m=this._colorSubstitutionHelper.tintImageData(m,l)));const g=Math.max(this.transformSize(a.pt2px(u)),.5),y=g/m.width,b=this._ctx,S=b.createPattern(m,"repeat-y");let x,w;b.save(),this._setCapStyle(i),this._setJoinStyle(n),void 0!==o&&(b.miterLimit=o),b.lineWidth=g;for(let e of p)if(e=s.clone(e),D(e),e&&!(e.length<=1)){x=this.transformPt(e[0]);for(let t=1;t<e.length;t++){w=this.transformPt(e[t]);const r=E(x,w),s=new DOMMatrix;s.translateSelf(0,x[1]-g/2).scaleSelf(y,y,1).rotateSelf(0,0,90-r),S.setTransform(s),b.strokeStyle=S,b.beginPath(),b.moveTo(x[0],x[1]),b.lineTo(w[0],w[1]),b.stroke(),x=w}}b.restore()}drawGradientFill(e,t){if(!e)return;let r;if(d.isPolygon(e))r=e.rings;else if(d.isPolyline(e))r=e.paths;else{if(!d.isExtent(e))return void F().error("Unable to draw gradient fill");r=z(e).rings}this._buildPath(r,!0);const{angle:s,gradientMethod:i,gradientSize:o,gradientSizeUnits:l}=t,u=y.defaultCIMValues.CIMGradientFill,h=t.gradientType??u.gradientType,p=-n.deg2rad(s??0),f=c.empty();for(const e of r){const t=e?e.length:0;if(t>1)for(let r=0;r<t;r++){let t=this.transformPt(e[r]);"Linear"!==i&&"Rectangular"!==i||(t=b.rotate(t,-p)),c.expandPointInPlace(f,t)}}const[m,g,_,x]=f,w=this._ctx;switch(w.save(),i){case"Buffered":F().error(`Gradient method "${i}" currently unsupported.`);break;case"Linear":{const e=(g+x)/2,r="Absolute"===l?this.transformSize(a.pt2px(o)):v.getRelativeGradientSize(o,u.gradientSize)*(_-m),[s,i]="Discrete"===h?[_,_-r]:[m+r,m],n=b.rotate([s,e],p),c=b.rotate([i,e],p),d=w.createLinearGradient(n[0],n[1],c[0],c[1]);S.addColorStops(d,t),w.fillStyle=d,w.fill("evenodd");break}case"Circular":{const e=c.center(f),r=c.diagonal(f)/2,s="Absolute"===l?this.transformSize(a.pt2px(o)):v.getRelativeGradientSize(o,u.gradientSize)*r,[i,n]="Discrete"===h?[r,r-s]:[s,0],d=w.createRadialGradient(e[0],e[1],i,e[0],e[1],n);S.addColorStops(d,t),w.fillStyle=d,w.fill("evenodd");break}case"Rectangular":{const r=c.center(f),s=r[0],i=r[1],n=b.rotate(r,p),d=(r,s,i,o,a,l,c,u)=>{w.save(),this.pushClipPath(e);const h=b.rotate([a,l],p),d=b.rotate([c,u],p);w.beginPath(),w.moveTo(n[0],n[1]),w.lineTo(h[0],h[1]),w.lineTo(d[0],d[1]),w.lineTo(n[0],n[1]),w.clip();const f=b.rotate([r,s],p),m=b.rotate([i,o],p),g=w.createLinearGradient(f[0],f[1],m[0],m[1]);S.addColorStops(g,t),w.fillStyle=g,w.fill("evenodd"),w.restore()};let y="Absolute"===l?this.transformSize(a.pt2px(o)):v.getRelativeGradientSize(o,u.gradientSize)*(c.width(f)/2),[M,I]="Discrete"===h?[_,_-y]:[s+y,s];d(M,i,I,i,_,g,_,x),[M,I]="Discrete"===h?[m,m+y]:[s-y,s],d(M,i,I,i,m,x,m,g),y="Absolute"===l?this.transformSize(a.pt2px(o)):v.getRelativeGradientSize(o,u.gradientSize)*(c.height(f)/2);let[P,T]="Discrete"===h?[x,x-y]:[i+y,i];d(s,P,s,T,_,x,m,x),[P,T]="Discrete"===h?[g,g+y]:[i-y,i],d(s,P,s,T,m,g,_,g);break}}w.restore()}drawGradientStroke(e,t){const{capStyle:r,gradientMethod:i,gradientSize:n,gradientSizeUnits:o,joinStyle:l,miterLimit:c,width:u}=t;if(!e||0===u)return;let h;if(d.isPolygon(e))h=e.rings;else if(d.isPolyline(e))h=e.paths;else{if(!d.isExtent(e))return void F().error("Unable to draw gradient stroke");h=z(e).rings}const p=t.gradientType??y.defaultCIMValues.CIMGradientStroke.gradientType,f=Math.max(this.transformSize(a.pt2px(u)),.5),m=this._ctx;let g,_;m.save(),this._setCapStyle(r),this._setJoinStyle(l),void 0!==c&&(m.miterLimit=c),m.lineWidth=f;for(let e of h){if(e=s.clone(e),D(e),!e||e.length<=1)continue;let r=0;g=this.transformPt(e[0]);for(let t=1;t<e.length;t++){_=this.transformPt(e[t]);const s=_[0]-g[0],i=_[1]-g[1];r+=Math.sqrt(s*s+i*i),g=_}const l="Absolute"===o?this.transformSize(a.pt2px(n)):v.getRelativeGradientSize(n,y.defaultCIMValues.CIMGradientStroke.gradientSize)*("AcrossLine"===i?f:r);let c=0;g=this.transformPt(e[0]);for(let s=1;s<e.length;s++){_=this.transformPt(e[s]);const n=_[0]-g[0],o=_[1]-g[1],a=Math.sqrt(n*n+o*o);let u,h,d,y;switch(i){case"AcrossLine":{const[e,t]=b.rotate([n/a,o/a],-Math.PI/2),r=f/2,s="Discrete"===p?r:l-r;u=(g[0]+_[0])/2+e*s,h=(g[1]+_[1])/2+t*s,d=u-e*l,y=h-t*l;break}case"AlongLine":{const e=n/a,t=o/a;"Discrete"===p?(u=g[0]-e*c,h=g[1]-t*c,d=u+e*l,y=h+t*l):(d=g[0]+e*(r-c),y=g[1]+t*(r-c),u=d-e*l,h=y-t*l);break}default:return F().error("Unrecognized gradient method:",i),void m.restore()}const x=m.createLinearGradient(u,h,d,y);S.addColorStops(x,t),m.strokeStyle=x,m.beginPath(),m.moveTo(g[0],g[1]),m.lineTo(_[0],_[1]),m.stroke(),c+=a,g=_}}m.restore()}_buildPath(e,t){const r=this._ctx;if(r.beginPath(),e)for(const s of e){const e=s?s.length:0;if(e>1){let i=this.transformPt(s[0]);r.moveTo(i[0],i[1]);for(let t=1;t<e;t++)i=this.transformPt(s[t]),r.lineTo(i[0],i[1]);t&&r.closePath()}}}_setCapStyle(e){switch(e){case"Butt":this._ctx.lineCap="butt";break;case"Round":this._ctx.lineCap="round";break;case"Square":this._ctx.lineCap="square"}}_setJoinStyle(e){switch(e){case"Bevel":this._ctx.lineJoin="bevel";break;case"Round":this._ctx.lineJoin="round";break;case"Miter":this._ctx.lineJoin="miter"}}},e.EnvDrawHelper=class extends A{constructor(e,t){super(e,t),this.reset()}reset(){this._xmin=this._ymin=1/0,this._xmax=this._ymax=-1/0,this._clipCount=0}envelope(){return new x(this._xmin,this._ymin,this._xmax-this._xmin,this._ymax-this._ymin)}bounds(){return c.fromValues(this._xmin,this._ymin,this._xmax,this._ymax)}drawSolidFill(e){if(e&&!(this._clipCount>0))if(d.isPolygon(e))this._processPath(e.rings,0);else if(d.isPolyline(e))this._processPath(e.paths,0);else if(d.isExtent(e)){const t=z(e);t&&this._processPath(t.rings,0)}else console.error("drawSolidFill Unexpected geometry type!")}drawSolidStroke(e,t,r){if(!e||this._clipCount>0||null==r||r<=0)return;const s=Math.max(.5*this.transformSize(v.getNumericValue(r,y.defaultCIMValues.CIMSolidStroke.width)),.25);if(d.isPolygon(e))this._processPath(e.rings,s);else if(d.isPolyline(e))this._processPath(e.paths,s);else if(d.isExtent(e)){const t=z(e);t&&this._processPath(t.rings,s)}else console.error("drawSolidStroke unexpected geometry type!")}drawMarkerLayer(e,t){d.isPolygon(t)&&e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._processPath(t.rings,0):super.drawMarkerLayer(e,t)}drawHatchFill(e,t){this.drawSolidFill(e)}drawPictureFill(e,t){this.drawSolidFill(e)}drawGradientFill(e,t){this.drawSolidFill(e)}drawPictureStroke(e,t){this.drawSolidStroke(e,null,t.width)}drawGradientStroke(e,t){this.drawSolidStroke(e,null,t.width)}pushClipPath(e){this.drawSolidFill(e),this._clipCount++}popClipPath(){this._clipCount--}drawImage(e,t){const{url:r}=e,s=v.getNumericValue(e.scaleX,1);let i=s*t,n=t;const o=this._resourceManager.getResource(r);if(null!=o){const e=o.height/o.width;i=s*(t?e>1?t:t/e:o.width),n=t?e>1?t*e:t:o.height}this._merge(this.transformPt([-i/2,-n/2]),0),this._merge(this.transformPt([-i/2,n/2]),0),this._merge(this.transformPt([i/2,-n/2]),0),this._merge(this.transformPt([i/2,n/2]),0)}drawText(e,t){if(!t||0===t.length)return;this._textRasterizer||(this._textRasterizer=new w);const r=L(e);let[s,i]=this._textRasterizer.computeTextSize(t,r);s=a.px2pt(s),i=a.px2pt(i);const n=this.transformSize(1)*this.reverseTransformScalar(1);s*=n,i*=n;let o=0;switch(e.horizontalAlignment){case"Left":o=s/2;break;case"Right":o=-s/2}let l=0;switch(e.verticalAlignment){case"Bottom":l=i/2;break;case"Top":l=-i/2;break;case"Baseline":l=i/6}this._merge(this.transformPt([-s/2+o,-i/2+l]),0),this._merge(this.transformPt([-s/2+o,i/2+l]),0),this._merge(this.transformPt([s/2+o,-i/2+l]),0),this._merge(this.transformPt([s/2+o,i/2+l]),0)}_processPath(e,t){if(e)for(const r of e){const e=r?r.length:0;if(e>1){this._merge(this.transformPt(r[0]),t);for(let s=1;s<e;s++)this._merge(this.transformPt(r[s]),t)}}}_merge(e,t){e[0]-t<this._xmin&&(this._xmin=e[0]-t),e[0]+t>this._xmax&&(this._xmax=e[0]+t),e[1]-t<this._ymin&&(this._ymin=e[1]-t),e[1]+t>this._ymax&&(this._ymax=e[1]+t)}},e.HittestDrawHelper=class extends A{constructor(){super(...arguments),this._searchPoint=[0,0],this._searchDistPoint=0,this._textInfo=null,this._svg=null,this._path=null,this._canvas=null}destroy(){this._svg=M.destroyHiddenSvg(this._svg),this._path=null,this._canvas=null}hitTest(e,t,s,i,n,o){const l=o*a.pt2px(1);this.setTransform(),this.setGeomUnitsPerPoint(l),this._searchPoint=[(e[0]+e[2])/2,(e[1]+e[3])/2],this._searchDistPoint=(e[2]-e[0])/2/l,this._textInfo=i;const c=t&&("CIMPointSymbol"===t.type&&"Map"!==t.angleAlignment||"CIMTextSymbol"===t.type);if(this._mapRotation=c?n:0,!r("esri-mobile")){const e=a.px2pt(I.hittestToleranceSmallSymbol*window.devicePixelRatio),r=a.px2pt(I.hittestSmallSymbolThreshold);("CIMLineSymbol"!==t?.type&&"CIMPolygonSymbol"!==t?.type||!t.symbolLayers?.some(v.isCIMFill))&&"CIMMeshSymbol"!==t?.type&&(v.getSize(t)??0)<r&&(this._searchDistPoint=e)}return this._earlyReturn=!1,this.drawSymbol(t,s),this._earlyReturn}executeEffects(e,t){return"CIMGeometricEffectDashes"===e.at(-1)?.type&&(e=e.slice(0,-1)),super.executeEffects(e,t)}drawSolidFill(e,t,r){null!=r?this._hittestSvgPath(e,r,!0):this._hitTestFill(e)}drawHatchFill(e,t){this._hitTestFill(e)}drawPictureFill(e,t){this._hitTestFill(e)}drawGradientFill(e,t){this._hitTestFill(e)}drawSolidStroke(e,t,r,s,i,n,o){null!=o?this._hittestSvgPath(e,o,!1,r):this._hitTestStroke(e,r)}drawPictureStroke(e,t){this._hitTestStroke(e,t.width)}drawGradientStroke(e,t){this._hitTestStroke(e,t.width)}drawMarkerLayer(e,t){e.markerPlacement&&("CIMMarkerPlacementInsidePolygon"===e.markerPlacement.type||"CIMMarkerPlacementPolygonCenter"===e.markerPlacement.type&&e.markerPlacement.clipAtBoundary)?this._hitTestFill(t):super.drawMarkerLayer(e,t)}pushClipPath(e){}popClipPath(){}drawImage(e,t){const{url:r}=e,s=v.getNumericValue(e.scaleX,1),i=this._resourceManager.getResource(r);if(null==i||0===i.height||0===t)return;const n=t*this.geomUnitsPerPoint(),o=n*s*(i.width/i.height),a=this.reverseTransformPt(this._searchPoint),l=this._searchDistPoint;Math.abs(a[0])<o/2+l&&Math.abs(a[1])<n/2+l&&(this._earlyReturn=!0)}drawText(e,t){const r=this._textInfo;if(!r)return;const s=r.get(e);if(!s)return;if(!s.glyphMosaicItems.glyphs.length)return;const i=T.roundPtToWholePixel(v.getNumericValue(e.height,y.defaultCIMValues.CIMTextSymbol.height)),{lineGapType:n,lineGap:o}=e,a=n?R(n,v.getNumericValue(o),i):0,l="CIMBackgroundCallout"===e.callout?.type,c=P.shapeGlyphs(s.glyphMosaicItems,{scale:i/I.glyphSize,angle:0,xOffset:0,yOffset:0,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,maxLineWidth:T.getLineWidth(e.lineWidth),lineHeight:I.magicLabelLineHeight*Math.max(.25,Math.min(a||1,4)),decoration:e.font.decoration||"none",useCIMAngleBehavior:!0,hasBackground:l}),u=this.reverseTransformPt(this._searchPoint),h=u[0],d=u[1];for(const e of c.glyphs)if(h>e.xTopLeft&&h<e.xBottomRight&&d>-e.yBottomRight&&d<-e.yTopLeft){this._earlyReturn=!0;break}}_hitTestFill(e){let t=null;if(d.isExtent(e)){const r=e;t=[[[r.xmin,r.ymin],[r.xmin,r.ymax],[r.xmax,r.ymax],[r.xmax,r.ymin],[r.xmin,r.ymin]]]}else if(d.isPolygon(e))t=e.rings;else{if(!d.isPolyline(e))return;t=e.paths}const r=this.reverseTransformPt(this._searchPoint);(function(e,t){let r=0;for(const s of t){const t=s.length;for(let i=1;i<t;i++){const t=s[i-1],n=s[i];t[1]>e[1]!=n[1]>e[1]&&((n[0]-t[0])*(e[1]-t[1])-(n[1]-t[1])*(e[0]-t[0])>0?r++:r--)}}return 0!==r})(r,t)&&(this._earlyReturn=!0),this._earlyReturn||O(r,t,this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}_getSvgPath(){return null!=this._svg&&null!=this._path||(this._svg??=M.createHiddenSvg(),this._path??=M.createSvgElement("path"),this._svg.appendChild(this._path)),this._path}_getCanvasContext(e,t){return this._canvas??=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t,this._canvas.getContext("2d",{willReadFrequently:!0})}_hittestSvgPath(e,t,r,s=0){const i=this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint(),n=this.reverseTransformPt(this._searchPoint),o=c.create();u.getBoundsXY(o,e);const a=o[0],l=o[1],h=o[2]-o[0],d=o[3]-o[1],p=this._getSvgPath();p.setAttribute("d",t);const f=p.getBBox();let m=Math.max(f.width/h,f.height/d),g=1;const y=2*i*m;y<1&&(g=2/y,m*=g,f.x*=g,f.y*=g,f.width*=g,f.height*=g);const _=1+s*m/2,b=this._getCanvasContext(f.width+2*_,f.height+2*_);b.setTransform(g,0,0,g,-f.x+_,-f.y+_);const S=new Path2D(t);r?b.fill(S):(b.lineWidth=s*(m/g),b.stroke(S));const x=(h*m-f.width)/2,w=(d*m-f.height)/2,v=Math.floor((n[0]-a-i)*m-x+_),M=Math.floor((d-(n[1]-l)-i)*m+w+_),I=Math.ceil(2*i*m),P=Math.ceil(2*i*m),T=b.getImageData(v,M,I,P).data;for(let e=3;e<T.length;e+=4)if(T[e]>127.5)return void(this._earlyReturn=!0)}_hitTestStroke(e,t){let r=null;if(d.isExtent(e)){const t=e;r=[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]}else if(d.isPolygon(e))r=e.rings;else{if(!d.isPolyline(e))return;r=e.paths}O(this.reverseTransformPt(this._searchPoint),r,v.getNumericValue(t,y.defaultCIMValues.CIMSolidStroke.width)*this.geomUnitsPerPoint()/2+this.reverseTransformScalar(this._searchDistPoint)*this.prevGeomUnitsPerPoint())&&(this._earlyReturn=!0)}},e.Transformation=k,e.cDegToRad=C,e.lineGapType2LineHeight=R,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/fontUtils":function(){define(["exports","../config"],function(e,t){"use strict";const r="arial-unicode-ms",s="woff2",i=new Map,n=new Set;class o{constructor(e,t){this.fontFace=e,this.promise=t}}function a(e){if(!e)return r;const t=e.toLowerCase().split(" ").join("-");switch(t){case"serif":return"noto-serif";case"sans-serif":return"arial-unicode-ms";case"monospace":return"ubuntu-mono";case"fantasy":return"cabin-sketch";case"cursive":return"redressed";default:return t}}function l(e){const t=c(e)+u(e);return a(e.family)+(t.length>0?t:"-regular")}function c(e){if(!e.weight)return"";switch(e.weight.toLowerCase()){case"bold":case"bolder":return"-bold"}return""}function u(e){if(!e.style)return"";switch(e.style.toLowerCase()){case"italic":case"oblique":return"-italic"}return""}e.clearFonts=function(){const e=document.fonts;i.forEach(t=>{e.delete(t.fontFace)}),i.clear(),n.clear()},e.defaultFontFamily=r,e.getFontFamily=a,e.getFullyQualifiedFontName=l,e.isCachedFontFace=function(e){return n.has(e)},e.loadFont=async function(e){const a=function(e){const t=c(e)+u(e);return(e.family||r)+(t.length>0?t:"-regular")}(e),h=l(e),d=i.get(a);if(d)return d.promise;const p=new FontFace(e.family,`url('${t.fontsUrl}/woff2/${h}.${s}') format('${s}')`,{style:e.style,weight:e.weight}),f=document.fonts;if(f.has(p)&&"loading"===p.status)return p.loaded;const m=p.load().then(()=>(f.add(p),p));return i.set(a,new o(p,m)),n.add(p),m},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/CIMImageColorSubstitutionHelper":function(){define(function(){"use strict";return class{applyColorSubstitution(e,t){if(!t)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,i=this._rasterizationCanvas,n=i.getContext("2d",{willReadFrequently:!0});e!==i&&(i.width=r,i.height=s,n.drawImage(e,0,0,r,s));const o=n.getImageData(0,0,r,s).data;if(t)for(const e of t)if(e&&e.oldColor&&4===e.oldColor.length&&e.newColor&&4===e.newColor.length){const[t,r,s,i]=e.oldColor,[n,a,l,c]=e.newColor;if(t===n&&r===a&&s===l&&i===c)continue;for(let e=0;e<o.length;e+=4)t===o[e]&&r===o[e+1]&&s===o[e+2]&&i===o[e+3]&&(o[e]=n,o[e+1]=a,o[e+2]=l,o[e+3]=c)}const a=new ImageData(o,r,s);return n.putImageData(a,0,0),i}tintImageData(e,t){if(!t||t.length<4)return e;this._rasterizationCanvas||(this._rasterizationCanvas=document.createElement("canvas"));const{width:r,height:s}=e,i=this._rasterizationCanvas,n=i.getContext("2d",{willReadFrequently:!0});e!==i&&(i.width=r,i.height=s,n.drawImage(e,0,0,r,s));const o=n.getImageData(0,0,r,s),a=new Uint8Array(o.data),l=[t[0]/255,t[1]/255,t[2]/255,t[3]/255];for(let e=0;e<a.length;e+=4)a[e]*=l[0],a[e+1]*=l[1],a[e+2]*=l[2],a[e+3]*=l[3];const c=new ImageData(new Uint8ClampedArray(a.buffer),r,s);return n.putImageData(c,0,0),i}}})},"esri/symbols/cim/imageUtils":function(){define(["exports"],function(e){"use strict";e.getFirstFrame=function(e){const t=e.getFrame(0);if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)return t;const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const s=r.getContext("2d");return t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0),r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/mathUtils":function(){define(["exports"],function(e){"use strict";e.rotate=function(e,t=0){if(0===t)return e;const r=Math.cos(t),s=Math.sin(t),[i,n]=e;return[i*r+n*-s,i*s+n*r]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/rasterizingUtils":function(){define(["exports","../../core/floatRGBA","../../core/Logger","../../core/mathUtils","./constants","./defaultCIMValues","../../views/2d/engine/webgl/definitions"],function(e,t,r,s,i,n,o){"use strict";const a=()=>r.getLogger("esri.symbols.cim.rasterizingUtils");let l;function c(e){const t=[];switch(e.type){case"CIMPolarContinuousColorRamp":case"CIMLinearContinuousColorRamp":{"CIMPolarContinuousColorRamp"===e.type&&a().warnOnce("CIMPolarContinuousColorRamp is currently unsupported. Falling back to CIMLinearContinuousColorRamp.");const r=e;t.push({offset:0,color:[r.fromColor[0],r.fromColor[1],r.fromColor[2],r.fromColor[3]/255]}),t.push({offset:1,color:[r.toColor[0],r.toColor[1],r.toColor[2],r.toColor[3]/255]});break}case"CIMFixedColorRamp":{const r=e,s=1/(r.colors.length-1);let i=0;for(const e of r.colors)t.push({offset:i,color:[e[0],e[1],e[2],e[3]/255]}),i+=s;break}case"CIMMultipartColorRamp":{const r=e,s=r.weights.reduce((e,t)=>e+t,0);let i=0;for(let e=0;e<r.colorRamps.length;e++){const n=r.colorRamps[e],o=r.weights[e],a=c(n);for(const e of a)t.push({offset:(i+e.offset*o)/s,color:e.color});i+=o}break}default:a().error(`Color ramp "${e.type}" currently unsupported.`)}return t}function u(e,t){const r=[],s=(e.length-1)/(t-1);for(let i=0;i<t;i++){const n=e[Math.round(i*s)].color;r.push({offset:i/t,color:n}),r.push({offset:(i+1)/t,color:n})}return r}function h(e,t,r=0){for(const{offset:s,color:i}of t)e.addColorStop(Math.min(Math.max(s,r),1-r),`rgba(${i[0]}, ${i[1]}, ${i[2]}, ${i[3]})`)}function d(e,t,r,s,i){const n=r+2*i;e.width=n,e.height=s;const o=(i+1)/n,a=e.getContext("2d",{willReadFrequently:!0});if(t.length>0){const e=a.createLinearGradient(0,0,n,s);h(e,t,o),a.fillStyle=e}else a.fillStyle="rgba(128, 128, 128, 1)";a.fillRect(0,0,n,s)}function p(e){const{width:t,height:r}=e,s=e.getContext("2d").getImageData(0,0,t,r),i=new Uint8Array(s.data);for(let e=0;e<i.length;e+=4){const t=i[e+3]/255;i[e]*=t,i[e+1]*=t,i[e+2]*=t}return[i,t,r]}e.addColorStops=function(e,t){const{colorRamp:r,gradientType:s}=t,i=c(r),o="CIMFixedColorRamp"===r.type;if("Continuous"===s&&!o)return h(e,i);const a=t.interval??n.defaultCIMValues.CIMGradientFill.interval;if(o)return h(e,u(i,a));const p=[];l??=document.createElement("canvas"),d(l,i,a,1,0);const f=l.getContext("2d").getImageData(0,0,a,1).data;for(let e=0,t=0;e<a;e++,t=4*e){const r=[f[t+0],f[t+1],f[t+2],f[t+3]];p.push({offset:e/a,color:r}),p.push({offset:(e+1)/a,color:r})}return h(e,p)},e.rasterizeDash=function(e,r){null==e&&(e=[]);const s="Butt"===r,n="Square"===r,o=!s&&!n;e.length%2==1&&(e=[...e,...e]);const a=i.dashRadius,l=2*a;let c=0;for(const t of e)c+=t;const u=Math.round(c*a),h=new Float32Array(u*l),d=.5*a;let p=0,f=0,m=.5,g=!0;for(const t of e){for(p=f,f+=t*a;m<=f;){let e=.5;for(;e<l;){const t=(e-.5)*u+m-.5,r=o?(e-a)*(e-a):Math.abs(e-a);h[t]=g?s?Math.max(Math.max(p+d-m,r),Math.max(m-f+d,r)):r:o?Math.min((m-p)*(m-p)+r,(m-f)*(m-f)+r):n?Math.min(Math.max(m-p,r),Math.max(f-m,r)):Math.min(Math.max(m-p+d,r),Math.max(f+d-m,r)),e++}m++}g=!g}const y=h.length,_=new Uint8Array(4*y);for(let e=0;e<y;++e){const r=(o?Math.sqrt(h[e]):h[e])/a;t.packFloatRGBA(r,_,4*e)}return[_,u,l]},e.rasterizeDash1D=function(e){e.length%2==1&&(e=[...e,...e]);const r=e.reduce((e,t)=>e+t,0),s=Math.round(r*i.dashSdfRasterizationScale),n=new Float32Array(1*s);let o=0,a=0,l=.5,c=!0;for(const t of e){for(o=a,a+=t*i.dashSdfRasterizationScale;l<=a;){const e=l-.5,t=Math.min(Math.abs(l-o),Math.abs(l-a));n[e]=c?-t:t,l++}c=!c}const u=n.length,h=new Uint8Array(4*u);for(let e=0;e<u;++e){const r=n[e]/i.dashSdfRasterizationScale/i.dashSdfDistanceNormalization*.5+.5;t.packFloatRGBA(r,h,4*e)}return[h,s,1]},e.rasterizeFillStyle=function(e,t,r){const i=t.style,n=s.nextPowerOfTwo(Math.ceil(r)),o=(e=>"vertical"===e||"horizontal"===e||"cross"===e||"esriSFSCross"===e||"esriSFSVertical"===e||"esriSFSHorizontal"===e)(i)?8*n:16*n,a=2*n;e.width=o,e.height=o;const l=e.getContext("2d");l.strokeStyle="#ffffff",l.lineWidth=n,l.beginPath(),"vertical"!==i&&"cross"!==i&&"esriSFSCross"!==i&&"esriSFSVertical"!==i||(l.moveTo(o/2,-a),l.lineTo(o/2,o+a)),"horizontal"!==i&&"cross"!==i&&"esriSFSCross"!==i&&"esriSFSHorizontal"!==i||(l.moveTo(-a,o/2),l.lineTo(o+a,o/2)),"backward-diagonal"!==i&&"diagonal-cross"!==i&&"esriSFSDiagonalCross"!==i&&"esriSFSBackwardDiagonal"!==i||(l.moveTo(-a,-a),l.lineTo(o+a,o+a),l.moveTo(o-a,-a),l.lineTo(o+a,a),l.moveTo(-a,o-a),l.lineTo(a,o+a)),"forward-diagonal"!==i&&"diagonal-cross"!==i&&"esriSFSForwardDiagonal"!==i&&"esriSFSDiagonalCross"!==i||(l.moveTo(o+a,-a),l.lineTo(-a,o+a),l.moveTo(a,-a),l.lineTo(-a,a),l.moveTo(o+a,o-a),l.lineTo(o-a,o+a)),l.stroke();const c=l.getImageData(0,0,e.width,e.height),u=new Uint8Array(c.data);let h;for(let e=0;e<u.length;e+=4)h=u[e+3]/255,u[e]=u[e]*h,u[e+1]=u[e+1]*h,u[e+2]=u[e+2]*h;return[u,e.width,e.height,n]},e.rasterizeGradient=function(e,t){const{colorRamp:r,gradientType:s}=t,i="CIMFixedColorRamp"===r.type,a=t.interval||n.defaultCIMValues.CIMGradientFill.interval;let l=c(r);return i&&(l=u(l,a)),"Discrete"===s||i?function(e,t,r){return d(e,t,r,1,o.gradientTextureExternalPadding),p(e)}(e,l,a):function(e,t){return d(e,t,32,1,o.gradientTextureExternalPadding),p(e)}(e,l)},e.scale=function(e,t){const r=function(e){const t=e[0]?.[0]?.[0]??0,r=e[0]?.[0]?.[1]??0,s={ymin:r,xmin:t,ymax:r,xmax:t,width:0,height:0};for(let t=0;t<e.length;t++){const r=e[t];for(let e=0;e<r.length;e++){const t=r[e][0],i=r[e][1];t<s.xmin&&(s.xmin=t),t>s.xmax&&(s.xmax=t),i<s.ymin&&(s.ymin=i),i>s.ymax&&(s.ymax=i)}}return s.width=Math.abs(s.xmax-s.xmin),s.height=Math.abs(s.ymax-s.ymin),s}(e),s=0===r.width?1:r.width,i=0===r.height?1:r.height,n=[];for(let o=0;o<e.length;o++){const a=e[o],l=[];for(let e=0;e<a.length;e++){let n=Math.round(a[e][0]-r.xmin),o=Math.round(a[e][1]-r.ymin);if(n=t.xmin+n*t.width/s,o=t.ymin+o*t.height/i,isNaN(n)||isNaN(o))throw new Error("Scaled shape has NaN values");l.push([n,o])}n.push(l)}return n},e.translate=function(e,t,r){const s=[];for(let i=0;i<e.length;i++){const n=e[i],o=[];for(let e=0;e<n.length;e++){const s=n[e][0]+t,i=n[e][1]+r;if(isNaN(s)||isNaN(i))throw new Error("Scaled shape has NaN values");o.push([s,i])}s.push(o)}return s},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(e,t){"use strict";function r(e,t=0){let r=0;for(let s=0;s<4;s++)r+=e[t+s]*i[s];return r}const s=[1,256,65536,16777216],i=[1/256,1/65536,1/16777216,1/4294967296],n=r(new Uint8ClampedArray([255,255,255,255])),o=r(new Uint8ClampedArray([255,255,255,0]));function a(e){return e-Math.floor(e)}e.maxRgbFloat=o,e.maxRgbaFloat=n,e.packFloatRGB=function(e,r,i=0){const n=t.clamp(e,0,o);for(let e=0;e<3;e++)r[i+e]=Math.floor(256*a(n*s[e]))},e.packFloatRGBA=function(e,r,i=0){const o=t.clamp(e,0,n);for(let e=0;e<4;e++)r[i+e]=Math.floor(256*a(o*s[e]))},e.unpackFloatRGBA=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/Rect":function(){define(function(){"use strict";class e{constructor(e=0,t=0,r=0,s=0){this.x=e,this.y=t,this.width=r,this.height=s}static fromExtent(t){return new e(t.xmin,-t.ymax,t.xmax-t.xmin,t.ymax-t.ymin)}get isEmpty(){return this.width<=0||this.height<=0}union(e){this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.width=Math.max(this.width,e.width),this.height=Math.max(this.height,e.height)}}return e})},"esri/symbols/cim/TextRasterizer":function(){define(["../../core/screenUtils","../support/textUtils"],function(e,t){"use strict";function r(e){return`rgba(${e.slice(0,3).toString()},${e[3]})`}function s(t,r){const s=Math.max(r.size,.5),i=r.font,n=`${i.style} ${i.weight} ${e.pt2px(s).toFixed(1)}px ${i.family}, sans-serif`;let o;switch(t.font=n,t.textBaseline="top",r.horizontalAlignment){case"left":default:o="left";break;case"right":o="right";break;case"center":o="center"}t.textAlign=o}return class{constructor(e){e&&(this._textRasterizationCanvas=e)}rasterizeText(e,i){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const n=this._textRasterizationCanvas,o=n.getContext("2d",{willReadFrequently:!0});s(o,i),this._parameters=i,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const{decoration:a,weight:l}=i.font;this._lineThroughWidthOffset=a&&"line-through"===a?.1*this._lineHeight:0;const c=null!=i.backgroundColor||null!=i.borderLine,u=c?t.backgroundPadding:0,h=this._computeTextWidth(o,i)+2*u,d=this._lineHeight*this._textLines.length+2*u;if(n.width=h+2*this._lineThroughWidthOffset,n.height=d,0===n.width||0===n.height)return n.width=n.height=1,{size:[0,0],image:new Uint32Array(0),sdf:!1,simplePattern:!1,anchorX:0,anchorY:0,canvas:n};this._renderedLineHeight=Math.round(this._lineHeight),this._renderedOutlineSize=(i.outline.size||0)*i.pixelRatio,this._renderedHaloSize=(i.halo.size||0)*i.pixelRatio,this._renderedWidth=h,this._renderedHeight=d,this._lineThroughWidthOffset*=i.pixelRatio;const p=(i.outline&&i.outline.color)??[0,0,0,0],f=i.color??[0,0,0,0],m=i.halo&&i.halo.color?i.halo.color:[0,0,0,0];this._fillStyle=r(f),this._outlineStyle=r(p),this._haloStyle=`rgb(${m.slice(0,3).toString()})`;const g=this._renderedLineHeight,y=this._renderedOutlineSize,_=this._renderedHaloSize;o.save(),o.clearRect(0,0,n.width,n.height),s(o,i);const b=u*i.pixelRatio,S=function(e,t,r){return"center"===e?.5*t:"right"===e?t-r:r}(o.textAlign,this._renderedWidth-2*b,this._renderedHaloSize+this._renderedOutlineSize)+b,x=_+y+b,w=_>0;let v=this._lineThroughWidthOffset,M=0;if(c){o.save();const e=i.backgroundColor??[0,0,0,0],t=i.borderLine?.color??[0,0,0,0],s=2*(i.borderLine?.size??0);o.fillStyle=r(e),o.strokeStyle=r(t),o.lineWidth=s,o.fillRect(0,0,n.width,n.height),o.strokeRect(0,0,n.width,n.height),o.restore()}w&&this._renderHalo(o,S,x,v,M,i),y>0&&this._renderOutline(o,S,x,v,M,i),M+=x,v+=S;for(const e of this._textLines)w?(o.globalCompositeOperation="destination-out",o.fillStyle="rgb(0, 0, 0)",o.fillText(e,v,M),o.globalCompositeOperation="source-over",o.fillStyle=this._fillStyle,o.fillText(e,v,M)):(o.fillStyle=this._fillStyle,o.fillText(e,v,M)),a&&"none"!==a&&this._renderDecoration(o,v,M,a,l),M+=g;o.restore();const I=this._renderedWidth+2*this._lineThroughWidthOffset,P=this._renderedHeight,T=o.getImageData(0,0,I,P),C=new Uint8Array(T.data);if(i.premultiplyColors){let e;for(let t=0;t<C.length;t+=4)e=C[t+3]/255,C[t]=C[t]*e,C[t+1]=C[t+1]*e,C[t+2]=C[t+2]*e}let F,k;switch(i.horizontalAlignment){case"left":F=-.5;break;case"right":F=.5;break;default:F=0}switch(i.verticalAlignment){case"bottom":k=-.5;break;case"top":k=.5;break;case"baseline":k=-1/6;break;default:k=0}return{size:[I,P],image:new Uint32Array(C.buffer),sdf:!1,simplePattern:!1,anchorX:F,anchorY:k,canvas:n}}_renderHalo(e,t,r,i,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=a,this._outlineRasterizationCanvas.height=l;const c=this._outlineRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),s(u,o);const{decoration:h,weight:d}=o.font;u.fillStyle=this._haloStyle,u.strokeStyle=this._haloStyle,u.lineJoin="round",this._renderOutlineNative(u,t,r,h,d,this._renderedHaloSize+this._renderedOutlineSize),e.globalAlpha=this._parameters.halo.color[3],e.drawImage(c,0,0,a,l,i,n,a,l),e.globalAlpha=1}_renderOutline(e,t,r,i,n,o){const a=this._renderedWidth,l=this._renderedHeight;this._outlineRasterizationCanvas||(this._outlineRasterizationCanvas=document.createElement("canvas")),this._outlineRasterizationCanvas.width=a,this._outlineRasterizationCanvas.height=l;const c=this._outlineRasterizationCanvas,u=c.getContext("2d");u.clearRect(0,0,a,l),s(u,o);const{decoration:h,weight:d}=o.font;u.fillStyle=this._outlineStyle,u.strokeStyle=this._outlineStyle,u.lineJoin="round",this._renderOutlineNative(u,t,r,h,d,this._renderedOutlineSize),e.globalAlpha=this._parameters.outline.color[3],e.drawImage(c,0,0,a,l,i,n,a,l),e.globalAlpha=1}_renderOutlineNative(e,t,r,s,i,n){const o=this._renderedLineHeight;for(const a of this._textLines){const l=2*n,c=5,u=.1;for(let n=0;n<c;n++){const o=(1-(c-1)*u+n*u)*l;e.lineWidth=o,e.strokeText(a,t,r),s&&"none"!==s&&this._renderDecoration(e,t,r,s,i,o)}r+=o}}computeTextSize(e,t){this._textRasterizationCanvas||(this._textRasterizationCanvas=document.createElement("canvas"));const r=this._textRasterizationCanvas,i=r.getContext("2d");s(i,t),this._parameters=t,this._textLines=e.split(/\r?\n/),this._lineHeight=this._computeLineHeight();const n=this._computeTextWidth(i,t),o=this._lineHeight*this._textLines.length;return r.width=n,r.height=o,[n*t.pixelRatio,o*t.pixelRatio]}_computeTextWidth(t,r){let s=0;for(const e of this._textLines)s=Math.max(s,t.measureText(e).width);const i=r.font;return("italic"===i.style||"oblique"===i.style||"string"==typeof i.weight&&("bold"===i.weight||"bolder"===i.weight)||"number"==typeof i.weight&&i.weight>600)&&(s+=.3*t.measureText("w").width),s+=2*e.pt2px(this._parameters.halo.size),Math.round(s)}_computeLineHeightBase(){return 1.275*this._parameters.size}_computeLineHeight(){let t=this._computeLineHeightBase();const r=this._parameters.font.decoration;return r&&"underline"===r&&(t*=1.3),Math.round(t+2*e.pt2px(this._parameters.halo.size))}_renderDecoration(e,t,r,s,i,n){let o=.9*this._lineHeight;const a="bold"===i?.06:"bolder"===i?.09:.04;switch(e.textAlign){case"center":t-=this._renderedWidth/2;break;case"right":t-=this._renderedWidth}const l=e.textBaseline;if("underline"===s)switch(o=.9*this._computeLineHeightBase(),l){case"top":r+=o;break;case"middle":r+=o/2}else if("line-through"===s)switch(l){case"top":r+=o/1.5;break;case"middle":r+=o/3}const c=n?1.5*n:Math.ceil(o*a);e.save(),e.beginPath(),e.strokeStyle=e.fillStyle,e.lineWidth=c,e.moveTo(t-this._lineThroughWidthOffset,r),e.lineTo(t+this._renderedWidth+2*this._lineThroughWidthOffset,r),e.stroke(),e.restore()}}})},"esri/views/2d/engine/svgUtils":function(){define(["exports"],function(e){"use strict";function t(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}e.createHiddenSvg=function(){const e=t("svg");return e.setAttribute("style","position: absolute;"),e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttribute("aria-hidden","true"),e.setAttribute("role","presentation"),document.body.appendChild(e),e},e.createSvgElement=t,e.destroyHiddenSvg=function(e){return null!=e&&document.body.removeChild(e),null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/shapingUtils":function(){define(["exports","../../../../../../core/libs/gl-matrix-2/math/mat2d","../../../../../../core/libs/gl-matrix-2/factories/mat2df32","../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../core/libs/gl-matrix-2/factories/vec2f32","../../alignmentUtils","../../Rect","../../collisions/BoundingBox"],function(e,t,r,s,i,n,o,a){"use strict";const l=Math.PI/180;class c{constructor(e,t,s,i){this._rotationT=r.create(),this._xBounds=0,this._yBounds=0,this.minZoom=0,this.maxZoom=255,this._bounds=null;const n=s.rect,o=new Float32Array(8);e*=i,t*=i;const a=s.code?n.width*i:s.metrics.width,l=s.code?n.height*i:s.metrics.height;this.width=a,this.height=l,o[0]=e,o[1]=t,o[2]=e+a,o[3]=t,o[4]=e,o[5]=t+l,o[6]=e+a,o[7]=t+l,this._data=o,this._setTextureCoords(n),this._scale=i,this._mosaic=s,this.x=e,this.y=t,this.maxOffset=Math.max(e+a,t+l)}get mosaic(){return this._mosaic}set angle(e){this._angle=e,t.fromRotation(this._rotationT,-e),this._setOffsets()}get angle(){return this._angle}get xTopLeft(){return this._data[0]}get yTopLeft(){return this._data[1]}get xBottomRight(){return this._data[6]}get yBottomRight(){return this._data[7]}get texcoords(){return this._texcoords}get textureBinding(){return this._mosaic.textureBinding}get offsets(){return this._offsets||this._setOffsets(),this._offsets}get char(){return String.fromCharCode(this._mosaic.code)}get code(){return this._mosaic.code}get bounds(){if(!this._bounds){const{height:e,width:s}=this._mosaic.metrics,i=s*this._scale,n=Math.abs(e)*this._scale,o=new Float32Array(8);o[0]=this.x,o[1]=this.y,o[2]=this.x+i,o[3]=this.y,o[4]=this.x,o[5]=this.y+n,o[6]=this.x+i,o[7]=this.y+n;const l=t.multiply(r.create(),this._rotationT,this._transform);r.transformMany(o,o,l);let c=1/0,u=1/0,h=-1/0,d=-1/0;for(let e=0;e<4;e++){const t=o[2*e],r=o[2*e+1];c=Math.min(c,t),u=Math.min(u,r),h=Math.max(h,t),d=Math.max(d,r)}const p=h-c,f=d-u,m=c+p/2,g=u+f/2;this._bounds=new a(m,g,p,f)}return this._bounds}setTransform(e){this._transform=e,this._offsets=null}_setOffsets(){this._offsets||(this._offsets={topLeft:[0,0],topRight:[0,0],bottomLeft:[0,0],bottomRight:[0,0]});const e=t.multiply(r.create(),this._rotationT,this._transform);this._offsets.topLeft[0]=this._data[0],this._offsets.topLeft[1]=this._data[1],this._offsets.topRight[0]=this._data[2],this._offsets.topRight[1]=this._data[3],this._offsets.bottomLeft[0]=this._data[4],this._offsets.bottomLeft[1]=this._data[5],this._offsets.bottomRight[0]=this._data[6],this._offsets.bottomRight[1]=this._data[7],s.transformMat2d(this._offsets.topLeft,this._offsets.topLeft,e),s.transformMat2d(this._offsets.topRight,this._offsets.topRight,e),s.transformMat2d(this._offsets.bottomLeft,this._offsets.bottomLeft,e),s.transformMat2d(this._offsets.bottomRight,this._offsets.bottomRight,e)}_setTextureCoords({x:e,y:t,width:r,height:s}){this._texcoords={topLeft:[e,t],topRight:[e+r,t],bottomLeft:[e,t+s],bottomRight:[e+r,t+s]}}}const u=(e,t)=>({code:0,page:0,sdf:!0,rect:new o(0,0,11,8),textureBinding:t,metrics:{advance:0,height:4,width:e,left:0,top:0}});function h(e,t){return e.forEach(e=>s.transformMat2d(e,e,t)),{topLeft:e[0],topRight:e[1],bottomLeft:e[2],bottomRight:e[3]}}class d{constructor(e,t,r){this._rotation=0,this._decorate(e,t,r),this.glyphs=e,this.bounds=this._createBounds(e),this.isMultiline=t.length>1,this._hasRotation=0!==r.angle,this._transform=this._createGlyphTransform(this.bounds,r),this._borderLineSizePx=r.borderLineSizePx,(r.borderLineSizePx||r.hasBackground)&&([this.bounds,this.textBox]=this.shapeBackground(this._transform));for(const t of e)t.setTransform(this._transform)}setRotation(e){if(0===e&&0===this._rotation)return;this._rotation=e;const s=this._transform,i=t.fromRotation(r.create(),e);t.multiply(s,i,s);for(const e of this.glyphs)e.setTransform(this._transform)}_decorate(e,t,r){if(!r.decoration||"none"===r.decoration||!e.length)return;const s=r.scale,i="underline"===r.decoration?26:16,n=e[0].textureBinding;for(const r of t){const t=r.startX*s,o=r.startY*s,a=(r.width+r.glyphWidthEnd)*s;e.push(new c(t,o+i*s,u(a,n),1))}}shapeBackground(e){const t=(1.5+(this._borderLineSizePx||0))/2,r=this._borderLineSizePx?t:0,{xmin:s,ymin:i,xmax:n,ymax:o,x:l,y:c,width:u,height:d}=this.bounds,p=[s-8,i-8],f=[n+8,i-8],m=[s-8,o+8],g=[n+8,o+8],y=h([[p[0]-t,p[1]-t],[f[0]+t,f[1]-t],[p[0]+r,p[1]+r],[f[0]-r,f[1]+r]],e),_=h([[m[0]+r,m[1]-r],[g[0]-r,g[1]-r],[m[0]-t,m[1]+t],[g[0]+t,g[1]+t]],e),b=h([[p[0]-t,p[1]-t],[p[0]+r,p[1]+r],[m[0]-t,m[1]+t],[m[0]+r,m[1]-r]],e),S=h([[f[0]-r,f[1]+r],[f[0]+t,f[1]-t],[g[0]-r,g[1]-r],[g[0]+t,g[1]+t]],e),x={main:h([p,f,m,g],e),top:y,bot:_,left:b,right:S};return[new a(l,c,u+2*t,d+2*t),x]}get boundsT(){const e=this.bounds,t=s.set(i.create(),e.x,e.y);if(s.transformMat2d(t,t,this._transform),this._hasRotation){const r=Math.max(e.width,e.height);return new a(t[0],t[1],r,r)}return new a(t[0],t[1],e.width,e.height)}_createBounds(e){let t=1/0,r=1/0,s=0,i=0;for(const n of e)t=Math.min(t,n.xTopLeft),r=Math.min(r,n.yTopLeft),s=Math.max(s,n.xBottomRight),i=Math.max(i,n.yBottomRight);const n=s-t,o=i-r;return new a(t+n/2,r+o/2,n,o)}_createGlyphTransform(e,n){const o=l*n.angle,a=r.create(),c=i.create();return t.translate(a,a,s.set(c,n.xOffset,-n.yOffset)),n.useCIMAngleBehavior?t.rotate(a,a,o):(t.translate(a,a,s.set(c,e.x,e.y)),t.rotate(a,a,o),t.translate(a,a,s.set(c,-e.x,-e.y))),a}}class p{constructor(e,t,r,s,i,n){this.glyphWidthEnd=0,this.startX=0,this.startY=0,this.start=Math.max(0,Math.min(t,r)),this.end=Math.max(0,Math.max(t,r)),this.end<e.length&&(this.glyphWidthEnd=e[this.end].metrics.width),this.width=s,this.yMin=i,this.yMax=n}}const f=e=>10===e,m=e=>32===e;e.ShapedGlyph=c,e.ShapingInfo=d,e.shapeGlyphs=function(e,t){const r=t.scale,s=new Array,{glyphs:i,isRightToLeft:o}=e,a=function(e,t,r){const s=new Array,i=1/r.scale,n=r.maxLineWidth*i,o=t?e.length-1:0,a=t?-1:e.length,l=t?-1:1;let c=o,u=0,h=0,d=c,g=d,y=0,_=1/0,b=0;for(;c!==a;){const{code:t,metrics:r}=e[c],i=Math.abs(r.top);if(f(t)||m(t)||(_=Math.min(_,i),b=Math.max(b,i+r.height)),f(t))c!==o&&(s.push(new p(e,d,c-l,u,_===1/0?0:_,b)),_=1/0,b=0),u=0,d=c+l,g=c+l,h=0;else if(m(t))g=c+l,h=0,y=r.advance,u+=r.advance;else if(u>n){if(g!==d){const t=g-2*l;u-=y,s.push(new p(e,d,t,u-h,_,b)),_=1/0,b=0,d=g,u=h}else s.push(new p(e,d,c-l,u,_,b)),_=1/0,b=0,d=c,g=c,u=0;u+=r.advance,h+=r.advance}else u+=r.advance,h+=r.advance;c+=l}const S=new p(e,d,c-l,u,_,b);return S.start>=0&&S.end<e.length&&s.push(S),s}(i,o,t),l=a.length?function(e,t){let r=0;for(let t=0;t<e.length;t++){const{width:s}=e[t];r=Math.max(s,r)}const s="underline"===t.decoration?4:0,i=e[0].yMin;return{x:0,y:i,height:e[e.length-1].yMax+t.lineHeight*(e.length-1)+s-i,width:r}}(a,t):{y:0,height:0},u=n.getXAnchorDirection(t.horizontalAlignment),h=n.getYAnchorDirection(t.verticalAlignment),g=2===h?1:0,y=g?0:h-1,_=(1-g)*-l.y+y*(l.height/2)+-22*(g?1:0);for(let n=0;n<a.length;n++){const{start:o,end:l,width:h}=a[n];let d=-1*(u+1)*(h/2)-3;const p=(e.isRightToLeft?a.length-1-n:n)*t.lineHeight+_-3;a[n].startX=d,a[n].startY=p;for(let e=o;e<=l;e++){const t=i[e];if(f(t.code))continue;const n=new c(d+t.metrics.left,p-t.metrics.top,t,r);d+=t.metrics.advance,s.push(n)}}return new d(s,a,t)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["exports","./common"],function(e,t){"use strict";function r(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function s(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function i(e,t,r,s,i,n,o){return e[0]=t,e[1]=r,e[2]=s,e[3]=i,e[4]=n,e[5]=o,e}function n(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5];let l=r*n-s*i;return l?(l=1/l,e[0]=n*l,e[1]=-s*l,e[2]=-i*l,e[3]=r*l,e[4]=(i*a-n*o)*l,e[5]=(s*o-r*a)*l,e):null}function o(e){return e[0]*e[3]-e[1]*e[2]}function a(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1],h=r[2],d=r[3],p=r[4],f=r[5];return e[0]=s*c+n*u,e[1]=i*c+o*u,e[2]=s*h+n*d,e[3]=i*h+o*d,e[4]=s*p+n*f+a,e[5]=i*p+o*f+l,e}function l(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=Math.sin(r),u=Math.cos(r);return e[0]=s*u+n*c,e[1]=i*u+o*c,e[2]=s*-c+n*u,e[3]=i*-c+o*u,e[4]=a,e[5]=l,e}function c(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=s*c,e[1]=i*c,e[2]=n*u,e[3]=o*u,e[4]=a,e[5]=l,e}function u(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=r[0],u=r[1];return e[0]=s,e[1]=i,e[2]=n,e[3]=o,e[4]=s*c+n*u+a,e[5]=i*c+o*u+l,e}function h(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=-r,e[3]=s,e[4]=0,e[5]=0,e}function d(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function p(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function f(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function m(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+1)}function g(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e}function y(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}function _(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e}function b(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e}function S(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function x(e,r){const s=e[0],i=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=r[0],u=r[1],h=r[2],d=r[3],p=r[4],f=r[5],m=t.getEpsilon();return Math.abs(s-c)<=m*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(i-u)<=m*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(n-h)<=m*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(o-d)<=m*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(a-p)<=m*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(l-f)<=m*Math.max(1,Math.abs(l),Math.abs(f))}const w=a,v=y,M=Object.freeze(Object.defineProperty({__proto__:null,add:g,copy:r,determinant:o,equals:x,exactEquals:S,frob:m,fromRotation:h,fromScaling:d,fromTranslation:p,identity:s,invert:n,mul:w,multiply:a,multiplyScalar:_,multiplyScalarAndAdd:b,rotate:l,scale:c,set:i,str:f,sub:v,subtract:y,translate:u},Symbol.toStringTag,{value:"Module"}));e.add=g,e.copy=r,e.determinant=o,e.equals=x,e.exactEquals=S,e.frob=m,e.fromRotation=h,e.fromScaling=d,e.fromTranslation=p,e.identity=s,e.invert=n,e.mat2d=M,e.mul=w,e.multiply=a,e.multiplyScalar=_,e.multiplyScalarAndAdd=b,e.rotate=l,e.scale=c,e.set=i,e.str=f,e.sub=v,e.subtract=y,e.translate=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["exports"],function(e){"use strict";function t(){const e=new Float32Array(6);return e[0]=1,e[3]=1,e}function r(e){const t=new Float32Array(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function s(e,t,r,s,i,n){const o=new Float32Array(6);return o[0]=e,o[1]=t,o[2]=r,o[3]=s,o[4]=i,o[5]=n,o}function i(e,t,r,s){const i=t[s],n=t[s+1];e[s]=r[0]*i+r[2]*n+r[4],e[s+1]=r[1]*i+r[3]*n+r[5]}function n(e,t,r,s=0,n=0,o=2){const a=n||t.length/o;for(let n=s;n<a;n++)i(e,t,r,n*o)}const o=Object.freeze(Object.defineProperty({__proto__:null,clone:r,create:t,fromValues:s,transform:i,transformMany:n},Symbol.toStringTag,{value:"Module"}));e.clone=r,e.create=t,e.fromValues=s,e.mat2df32=o,e.transform=i,e.transformMany=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["exports"],function(e){"use strict";function t(){return new Float32Array(2)}function r(e){const t=new Float32Array(2);return t[0]=e[0],t[1]=e[1],t}function s(e,t){const r=new Float32Array(2);return r[0]=e,r[1]=t,r}function i(){return t()}function n(){return s(1,1)}function o(){return s(1,0)}function a(){return s(0,1)}const l=i(),c=n(),u=o(),h=a(),d=Object.freeze(Object.defineProperty({__proto__:null,ONES:c,UNIT_X:u,UNIT_Y:h,ZEROS:l,clone:r,create:t,fromValues:s,ones:n,unitX:o,unitY:a,zeros:i},Symbol.toStringTag,{value:"Module"}));e.ONES=c,e.UNIT_X=u,e.UNIT_Y=h,e.ZEROS=l,e.clone=r,e.create=t,e.fromValues=s,e.ones=n,e.unitX=o,e.unitY=a,e.vec2f32=d,e.zeros=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/alignmentUtils":function(){define(["exports","../../../../core/Logger"],function(e,t){"use strict";e.getAlignmentFromPlacement=function(e){switch(e){case"above-left":case"esriServerPointLabelPlacementAboveLeft":return["right","bottom"];case"above-center":case"above-along":case"esriServerPointLabelPlacementAboveCenter":case"esriServerLinePlacementAboveAlong":return["center","bottom"];case"above-right":case"esriServerPointLabelPlacementAboveRight":return["left","bottom"];case"center-left":case"esriServerPointLabelPlacementCenterLeft":return["right","middle"];case"center-center":case"center-along":case"esriServerPointLabelPlacementCenterCenter":case"esriServerLinePlacementCenterAlong":case"always-horizontal":case"esriServerPolygonPlacementAlwaysHorizontal":return["center","middle"];case"center-right":case"esriServerPointLabelPlacementCenterRight":return["left","middle"];case"below-left":case"esriServerPointLabelPlacementBelowLeft":return["right","top"];case"below-center":case"below-along":case"esriServerPointLabelPlacementBelowCenter":case"esriServerLinePlacementBelowAlong":return["center","top"];case"below-right":case"esriServerPointLabelPlacementBelowRight":return["left","top"];default:return console.debug(`Found invalid placement type ${e}`),["center","middle"]}},e.getXAnchorDirection=function(e){if(!e)return 0;switch(e){case"Left":case"left":return-1;case"Right":case"right":return 1;case"Justify":return t.getLogger("esri.views.2d.engine.webgl.alignmentUtils").warnOnce("Horizontal alignment 'justify' is not implemented. Falling back to 'center'."),0;case"Center":case"center":return 0}},e.getXDirection=function(e){switch(e){case 1:case"right":return-1;case 0:case"center":return 0;case-1:case"left":return 1;default:return console.debug(`Found invalid horizontal alignment ${e}`),0}},e.getYAnchorDirection=function(e){if(!e)return 0;switch(e){case"Top":case"top":return 1;case"Center":case"middle":return 0;case"Baseline":case"baseline":return 2;case"Bottom":case"bottom":return-1}},e.getYDirection=function(e){switch(e){case 1:case"top":return 1;case 0:case"middle":return 0;case-1:case 2:case"baseline":case"bottom":return-1;default:return console.debug(`Found invalid vertical alignment ${e}`),0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/BoundingBox":function(){define(["../../../../../core/libs/gl-matrix-2/factories/vec2f32"],function(e){"use strict";class t{constructor(t,r,s,i){this.transformedX=0,this.transformedY=0,this.center=e.fromValues(t,r),this.centerT=e.create(),this.halfWidth=s/2,this.halfHeight=i/2,this.width=s,this.height=i}get x(){return this.center[0]}get y(){return this.center[1]}get blX(){return this.center[0]+this.halfWidth}get blY(){return this.center[1]+this.halfHeight}get trX(){return this.center[0]-this.halfWidth}get trY(){return this.center[1]-this.halfHeight}get xmin(){return this.x-this.halfWidth}get xmax(){return this.x+this.halfWidth}get ymin(){return this.y-this.halfHeight}get ymax(){return this.y+this.halfHeight}set x(e){this.center[0]=e}set y(e){this.center[1]=e}clone(){return new t(this.x,this.y,this.width,this.height)}serialize(e){return e.writeF32(this.center[0]),e.writeF32(this.center[1]),e.push(this.width),e.push(this.height),e}findCollisionDelta(e,t=4){const r=Math.abs(e.centerT[0]-this.centerT[0]),s=Math.abs(e.centerT[1]-this.centerT[1]),i=(e.halfWidth+this.halfWidth+t)/r,n=(e.halfHeight+this.halfHeight+t)/s,o=Math.min(i,n);return Math.log2(o)}extend(e){const t=Math.min(this.xmin,e.xmin),r=Math.min(this.ymin,e.ymin),s=Math.max(this.xmax,e.xmax)-t,i=Math.max(this.ymax,e.ymax)-r,n=t+s/2,o=r+i/2;this.width=s,this.height=i,this.halfWidth=s/2,this.halfHeight=i/2,this.x=n,this.y=o}static deserialize(e){const r=e.readF32(),s=e.readF32(),i=e.readInt32(),n=e.readInt32();return new t(r,s,i,n)}}return t})},"esri/views/2d/layers/graphics/graphicsUtils":function(){define(["exports","../../../../core/screenUtils","../../../../geometry/Polygon","../../engine/webgl/definitions"],function(e,t,r,s){"use strict";e.getLineWidth=function(e){const r=t.px2pt(s.minTextLineWidth),i=t.px2pt(s.maxTextLineWidth);return Math.max(r,Math.min(e||i,i))},e.pixelBuffer=50,e.polygonFromExtent=function(e){if(!e)return null;const{xmin:t,ymin:s,xmax:i,ymax:n,spatialReference:o}=e;return new r({rings:[[[t,s],[t,n],[i,n],[i,s],[t,s]]],spatialReference:o})},e.roundPtToWholePixel=function(e){return t.px2pt(Math.round(t.pt2px(e)))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults":function(){define(["exports","../../core/has","../SimpleFillSymbol","../SimpleLineSymbol","../SimpleMarkerSymbol","../TextSymbol","./defaultsJSON"],function(e,t,r,s,i,n,o){"use strict";const a=i.fromJSON(o.defaultPointSymbolJSON),l=s.fromJSON(o.defaultPolylineSymbolJSON),c=r.fromJSON(o.defaultPolygonSymbolJSON),u=n.fromJSON(o.defaultTextSymbolJSON),h=i.fromJSON(o.errorPointSymbolJSON),d=s.fromJSON(o.errorPolylineSymbolJSON),p=r.fromJSON(o.errorPolygonSymbolJSON);e.defaultPointSymbol2D=a,e.defaultPolygonSymbol2D=c,e.defaultPolylineSymbol2D=l,e.defaultTextSymbol2D=u,e.errorPointSymbol2D=h,e.errorPolygonSymbol2D=p,e.errorPolylineSymbol2D=d,e.getDefaultSymbol2D=function(e){if(null==e)return null;switch(e.type){case"mesh":return null;case"point":case"multipoint":return a;case"polyline":return l;case"polygon":case"extent":return c}return null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/SimpleFillSymbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/jsonMap","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./FillSymbol","./SimpleLineSymbol"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";var d;const p=new s.JSONMap({esriSFSSolid:"solid",esriSFSNull:"none",esriSFSHorizontal:"horizontal",esriSFSVertical:"vertical",esriSFSForwardDiagonal:"forward-diagonal",esriSFSBackwardDiagonal:"backward-diagonal",esriSFSCross:"cross",esriSFSDiagonalCross:"diagonal-cross"});return e.default=d=class extends u{constructor(...e){super(...e),this.color=new r([0,0,0,.25]),this.outline=new h,this.type="simple-fill",this.style="solid"}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const s={};return e&&(s.style=e),t&&(s.outline=t),r&&(s.color=r),s}clone(){return new d({color:i.clone(this.color),outline:this.outline&&this.outline.clone(),style:this.style})}hash(){return`${super.hash()}${this.style}.${this.color&&this.color.hash()}`}},t.__decorate([n.property()],e.default.prototype,"color",void 0),t.__decorate([n.property()],e.default.prototype,"outline",void 0),t.__decorate([l.enumeration({esriSFS:"simple-fill"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([n.property({type:p.apiValues,json:{read:p.read,write:p.write}})],e.default.prototype,"style",void 0),e.default=d=t.__decorate([c.subclass("esri.symbols.SimpleFillSymbol")],e.default),e.default})},"esri/symbols/FillSymbol":function(){define(["exports","../chunks/tslib.es6","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./SimpleLineSymbol","./Symbol"],function(e,t,r,s,i,n,o,a,l){"use strict";return e.default=class extends l{constructor(e){super(e),this.outline=null,this.type=null}hash(){return`${this.type}.${this.outline?.hash()}`}},t.__decorate([r.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":a}},json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),t.__decorate([r.property({type:["simple-fill","picture-fill"],readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([o.subclass("esri.symbols.FillSymbol")],e.default),e.default})},"esri/symbols/SimpleLineSymbol":function(){define(["exports","../chunks/tslib.es6","../core/jsonMap","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./LineSymbol","./LineSymbolMarker"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";var d;const p=new r.JSONMap({esriSLSSolid:"solid",esriSLSDash:"dash",esriSLSDot:"dot",esriSLSDashDot:"dash-dot",esriSLSDashDotDot:"long-dash-dot-dot",esriSLSNull:"none",esriSLSShortDash:"short-dash",esriSLSShortDot:"short-dot",esriSLSShortDashDot:"short-dash-dot",esriSLSShortDashDotDot:"short-dash-dot-dot",esriSLSLongDash:"long-dash",esriSLSLongDashDot:"long-dash-dot"});return e.default=d=class extends u{constructor(...e){super(...e),this.type="simple-line",this.style="solid",this.cap="round",this.join="round",this.marker=null,this.miterLimit=2}normalizeCtorArgs(e,t,r,s,n,o){if(e&&"string"!=typeof e)return e;const a={};return null!=e&&(a.style=e),null!=t&&(a.color=t),null!=r&&(a.width=i.toPt(r)),null!=s&&(a.cap=s),null!=n&&(a.join=n),null!=o&&(a.miterLimit=i.toPt(o)),a}clone(){return new d({color:s.clone(this.color),style:this.style,width:this.width,cap:this.cap,join:this.join,miterLimit:this.miterLimit,marker:this.marker?.clone()})}hash(){return`${super.hash()}.${this.color?.hash()}.${this.style}.${this.cap}.${this.join}.${this.miterLimit}.${this.marker?.hash()}`}},t.__decorate([l.enumeration({esriSLS:"simple-line"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([n.property({type:p.apiValues,json:{read:p.read,write:p.write}})],e.default.prototype,"style",void 0),t.__decorate([n.property({type:["butt","round","square"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&null==r?.origin})}}})],e.default.prototype,"cap",void 0),t.__decorate([n.property({type:["miter","round","bevel"],json:{write:{overridePolicy:(e,t,r)=>({enabled:"round"!==e&&null==r?.origin})}}})],e.default.prototype,"join",void 0),t.__decorate([n.property({types:{key:"type",base:null,defaultKeyValue:"line-marker",typeMap:{"line-marker":h}},json:{write:!0,origins:{"web-scene":{write:!1}}}})],e.default.prototype,"marker",void 0),t.__decorate([n.property({type:Number,json:{read:!1,write:!1}})],e.default.prototype,"miterLimit",void 0),e.default=d=t.__decorate([c.subclass("esri.symbols.SimpleLineSymbol")],e.default),e.default})},"esri/symbols/LineSymbol":function(){define(["exports","../chunks/tslib.es6","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","./Symbol"],function(e,t,r,s,i,n,o,a,l,c){"use strict";return e.default=class extends c{constructor(e){super(e),this.type="simple-line",this.width=.75}hash(){return`${this.type}.${this.width}`}},t.__decorate([a.enumeration({esriSLS:"simple-line"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:Number,cast:r.toPt,json:{write:!0}})],e.default.prototype,"width",void 0),e.default=t.__decorate([l.subclass("esri.symbols.LineSymbol")],e.default),e.default})},"esri/symbols/Symbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/jsonMap","../core/JSONSupport","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/RandomLCG","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";const h=new s.JSONMap({esriSMS:"simple-marker",esriPMS:"picture-marker",esriSLS:"simple-line",esriSFS:"simple-fill",esriPFS:"picture-fill",esriTS:"text",esriSHD:"shield-label-symbol",PointSymbol3D:"point-3d",LineSymbol3D:"line-3d",PolygonSymbol3D:"polygon-3d",WebStyleSymbol:"web-style",MeshSymbol3D:"mesh-3d",LabelSymbol3D:"label-3d",CIMSymbolReference:"cim"});let d=0;return e.default=class extends i.JSONSupport{constructor(e){super(e),this.id="sym"+d++,this.type=null,this.color=new r([0,0,0,1])}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}async collectRequiredFields(e,t){}hash(){return JSON.stringify(this.toJSON())}clone(){}},t.__decorate([n.property({type:h.apiValues,readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0,writer:h.write,isRequired:!0}}})],e.default.prototype,"type",void 0),t.__decorate([n.property({type:r,json:{write:{allowNull:!0}}})],e.default.prototype,"color",void 0),t.__decorate([c.reader("color")],e.default.prototype,"readColor",null),e.default=t.__decorate([u.subclass("esri.symbols.Symbol")],e.default),e.default})},"esri/symbols/LineSymbolMarker":function(){define(["../chunks/tslib.es6","../Color","../core/JSONSupport","../core/lang","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/reader","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./support/lineMarkers"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";var d;let p=d=class extends r.JSONSupport{constructor(e){super(e),this.placement="begin-end",this.type="line-marker",this.style="arrow"}writeStyle(e,t,r,s){t[r]="web-map"===s?.origin?"arrow":e}set color(e){this._set("color",e)}readColor(e){return null!=e?.[0]?[e[0],e[1],e[2],e[3]/255]:e}writeColor(e,t,r,s){"web-map"===s?.origin||(t[r]=e)}clone(){return new d({color:s.clone(this.color),placement:this.placement,style:this.style})}hash(){return`${this.placement}.${this.color?.hash()}.${this.style}`}};return e.__decorate([i.property({type:["begin","end","begin-end"],json:{write:!0}})],p.prototype,"placement",void 0),e.__decorate([a.enumeration({"line-marker":"line-marker"},{readOnly:!0}),i.property({json:{origins:{"web-map":{write:!1}}}})],p.prototype,"type",void 0),e.__decorate([i.property({type:h.lineMarkerStyles})],p.prototype,"style",void 0),e.__decorate([u.writer("style")],p.prototype,"writeStyle",null),e.__decorate([i.property({type:t,value:null,json:{write:{allowNull:!0}}})],p.prototype,"color",null),e.__decorate([l.reader("color")],p.prototype,"readColor",null),e.__decorate([u.writer("color")],p.prototype,"writeColor",null),p=d=e.__decorate([c.subclass("esri.symbols.LineSymbolMarker")],p),p})},"esri/symbols/support/lineMarkers":function(){define(["exports"],function(e){"use strict";e.lineMarkerPlacements=["begin","end","begin-end"],e.lineMarkerStyles=["arrow","circle","square","diamond","cross","x"],Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/SimpleMarkerSymbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/jsonMap","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/has","../core/Logger","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./MarkerSymbol","./SimpleLineSymbol"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p){"use strict";var f;const m=new s.JSONMap({esriSMSCircle:"circle",esriSMSSquare:"square",esriSMSCross:"cross",esriSMSX:"x",esriSMSDiamond:"diamond",esriSMSTriangle:"triangle",esriSMSPath:"path"});return e.default=f=class extends d{constructor(...e){super(...e),this.color=new r([255,255,255,.25]),this.type="simple-marker",this.size=12,this.style="circle",this.outline=new p}normalizeCtorArgs(e,t,r,s){if(e&&"string"!=typeof e)return e;const i={};return e&&(i.style=e),null!=t&&(i.size=n.toPt(t)),r&&(i.outline=r),s&&(i.color=s),i}writeColor(e,t){e&&"x"!==this.style&&"cross"!==this.style&&(t.color=e.toJSON()),null===e&&(t.color=null)}set path(e){this.style="path",this._set("path",e)}clone(){return new f({angle:this.angle,color:i.clone(this.color),outline:this.outline&&this.outline.clone(),path:this.path,size:this.size,style:this.style,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${super.hash()}.${this.color&&this.color.hash()}.${this.path}.${this.style}.${this.outline?.hash()}`}},t.__decorate([o.property()],e.default.prototype,"color",void 0),t.__decorate([h.writer("color")],e.default.prototype,"writeColor",null),t.__decorate([c.enumeration({esriSMS:"simple-marker"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([o.property()],e.default.prototype,"size",void 0),t.__decorate([o.property({type:m.apiValues,json:{read:m.read,write:m.write}})],e.default.prototype,"style",void 0),t.__decorate([o.property({type:String,json:{write:!0}})],e.default.prototype,"path",null),t.__decorate([o.property({types:{key:"type",base:null,defaultKeyValue:"simple-line",typeMap:{"simple-line":p}},json:{default:null,write:!0}})],e.default.prototype,"outline",void 0),e.default=f=t.__decorate([u.subclass("esri.symbols.SimpleMarkerSymbol")],e.default),e.default})},"esri/symbols/MarkerSymbol":function(){define(["exports","../chunks/tslib.es6","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/ensureType","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./Symbol"],function(e,t,r,s,i,n,o,a,l){"use strict";return e.default=class extends l{constructor(e){super(e),this.angle=0,this.type=null,this.xoffset=0,this.yoffset=0,this.size=9}hash(){return`${this.type}.${this.angle}.${this.size}.${this.xoffset}.${this.yoffset}`}},t.__decorate([s.property({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],e.default.prototype,"angle",void 0),t.__decorate([s.property({type:["simple-marker","picture-marker"],readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([s.property({type:Number,cast:r.toPt,json:{write:!0}})],e.default.prototype,"xoffset",void 0),t.__decorate([s.property({type:Number,cast:r.toPt,json:{write:!0}})],e.default.prototype,"yoffset",void 0),t.__decorate([s.property({cast:e=>"auto"===e?e:i.ensureNumber(r.toPt(e)),json:{write:!0}})],e.default.prototype,"size",void 0),e.default=t.__decorate([a.subclass("esri.symbols.MarkerSymbol")],e.default),e.default})},"esri/symbols/TextSymbol":function(){define(["exports","../chunks/tslib.es6","../Color","../core/lang","../core/screenUtils","../core/accessorSupport/decorators/property","../core/accessorSupport/decorators/cast","../core/accessorSupport/decorators/enumeration","../core/accessorSupport/decorators/subclass","../core/accessorSupport/decorators/writer","./Font","./Symbol","./support/textUtils"],function(e,t,r,s,i,n,o,a,l,c,u,h,d){"use strict";var p;return e.default=p=class extends h{constructor(...e){super(...e),this.backgroundColor=null,this.borderLineColor=null,this.borderLineSize=null,this.font=new u,this.horizontalAlignment="center",this.kerning=!0,this.haloColor=null,this.haloSize=null,this.rightToLeft=null,this.rotated=!1,this.text="",this.type="text",this.verticalAlignment="baseline",this.xoffset=0,this.yoffset=0,this.angle=0,this.width=null,this.lineWidth=192,this.lineHeight=1}normalizeCtorArgs(e,t,r){if(e&&"string"!=typeof e)return e;const s={};return e&&(s.text=e),t&&(s.font=t),r&&(s.color=r),s}writeLineWidth(e,t,r,s){s&&"string"!=typeof s?s.origin:t[r]=e}castLineWidth(e){return i.toPt(e)}writeLineHeight(e,t,r,s){s&&"string"!=typeof s?s.origin:t[r]=e}clone(){return new p({angle:this.angle,backgroundColor:s.clone(this.backgroundColor),borderLineColor:s.clone(this.borderLineColor),borderLineSize:this.borderLineSize,color:s.clone(this.color),font:this.font&&this.font.clone(),haloColor:s.clone(this.haloColor),haloSize:this.haloSize,horizontalAlignment:this.horizontalAlignment,kerning:this.kerning,lineHeight:this.lineHeight,lineWidth:this.lineWidth,rightToLeft:this.rightToLeft,rotated:this.rotated,text:this.text,verticalAlignment:this.verticalAlignment,width:this.width,xoffset:this.xoffset,yoffset:this.yoffset})}hash(){return`${this.backgroundColor?.hash()}.${this.borderLineColor}.${this.borderLineSize}.${this.color?.hash()}.${this.font&&this.font.hash()}.${this.haloColor?.hash()}.${this.haloSize}.${this.horizontalAlignment}.${this.kerning}.${this.rightToLeft}.${this.rotated}.${this.text}.${this.verticalAlignment}.${this.width}.${this.xoffset}.${this.yoffset}.${this.lineHeight}.${this.lineWidth}.${this.angle}`}},t.__decorate([n.property({type:r,json:{write:!0}})],e.default.prototype,"backgroundColor",void 0),t.__decorate([n.property({type:r,json:{write:!0}})],e.default.prototype,"borderLineColor",void 0),t.__decorate([n.property({type:Number,json:{write:!0},cast:i.toPt})],e.default.prototype,"borderLineSize",void 0),t.__decorate([n.property({type:u,json:{write:!0}})],e.default.prototype,"font",void 0),t.__decorate([n.property({...d.horizontalAlignmentProperty,json:{write:!0}})],e.default.prototype,"horizontalAlignment",void 0),t.__decorate([n.property({type:Boolean,json:{write:!0}})],e.default.prototype,"kerning",void 0),t.__decorate([n.property({type:r,json:{write:!0}})],e.default.prototype,"haloColor",void 0),t.__decorate([n.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"haloSize",void 0),t.__decorate([n.property({type:Boolean,json:{write:!0}})],e.default.prototype,"rightToLeft",void 0),t.__decorate([n.property({type:Boolean,json:{write:!0}})],e.default.prototype,"rotated",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"text",void 0),t.__decorate([a.enumeration({esriTS:"text"},{readOnly:!0})],e.default.prototype,"type",void 0),t.__decorate([n.property({...d.verticalAlignmentProperty,json:{write:!0}})],e.default.prototype,"verticalAlignment",void 0),t.__decorate([n.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"xoffset",void 0),t.__decorate([n.property({type:Number,cast:i.toPt,json:{write:!0}})],e.default.prototype,"yoffset",void 0),t.__decorate([n.property({type:Number,json:{read:e=>e&&-1*e,write:(e,t)=>t.angle=e&&-1*e}})],e.default.prototype,"angle",void 0),t.__decorate([n.property({type:Number,json:{write:!0}})],e.default.prototype,"width",void 0),t.__decorate([n.property({type:Number})],e.default.prototype,"lineWidth",void 0),t.__decorate([c.writer("lineWidth")],e.default.prototype,"writeLineWidth",null),t.__decorate([o.cast("lineWidth")],e.default.prototype,"castLineWidth",null),t.__decorate([n.property(d.lineHeightProperty)],e.default.prototype,"lineHeight",void 0),t.__decorate([c.writer("lineHeight")],e.default.prototype,"writeLineHeight",null),e.default=p=t.__decorate([l.subclass("esri.symbols.TextSymbol")],e.default),e.default})},"esri/symbols/support/defaultsJSON":function(){define(["exports"],function(e){"use strict";const t=[252,146,31,255],r={type:"esriSMS",style:"esriSMSCircle",size:6,color:t,outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[153,153,153,255]}},s={type:"esriSLS",style:"esriSLSSolid",width:.75,color:t};e.defaultColor=t,e.defaultOutlineColor=[153,153,153,255],e.defaultPointSymbolJSON=r,e.defaultPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[252,146,31,196],outline:{type:"esriSLS",style:"esriSLSSolid",width:.75,color:[255,255,255,191]}},e.defaultPolylineSymbolJSON=s,e.defaultTextSymbolJSON={type:"esriTS",color:[255,255,255,255],font:{family:"arial-unicode-ms",size:10,weight:"bold"},horizontalAlignment:"center",kerning:!0,haloColor:[0,0,0,255],haloSize:1,rotated:!1,text:"",xoffset:0,yoffset:0,angle:0},e.errorPointSymbolJSON={type:"esriSMS",style:"esriSMSCircle",color:[0,0,0,255],outline:null,size:10.5},e.errorPolygonSymbolJSON={type:"esriSFS",style:"esriSFSSolid",color:[0,0,0,255],outline:null},e.errorPolylineSymbolJSON={type:"esriSLS",style:"esriSLSSolid",color:[0,0,0,255],width:1.5},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterVertexPack":function(){define(["exports","../../../number","./AlignedVertexSpec","./dataViewUtils"],function(e,t,r,s){"use strict";class i{static fromVertexSpec(e,t){const s=r.AlignedVertexSpec.fromVertexSpec(e,t);return new i(s)}constructor(e){this._spec=e,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer)}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(e,t,r,s,i,n){for(let e=0;e<this._spec.packVertexCount;e++){const o=e*this._spec.stride;this._packPosition(r,s,o),this._packId(t,o);const a=this._spec.bitset;if(n){if(a.packTessellation){const e=a.packTessellation(n,i,r,s);this._pack(e,a,o)}for(const e of this._spec.standardAttributes)if(null!=e.packTessellation){const t=e.packTessellation(n,i,r,s);this._pack(t,e,o)}else if(e.packAlternating?.packTessellation){const t=e.packAlternating.packTessellation(n,i,r,s);for(let r=0;r<this._spec.packVertexCount;r++){const s=t[r];this._pack(s,e,r*this._spec.stride)}}}}e.vertexWriteRegion(this._packedU32View)}pack(e,t){for(const r of this._spec.standardAttributes)if(r.pack&&"string"!=typeof r.pack){const s=r.pack(e,t);for(let e=0;e<this._spec.packVertexCount;e++)this._pack(s,r,e*this._spec.stride)}else if(r.packAlternating?.pack){const s=r.packAlternating.pack(e,t);for(let e=0;e<this._spec.packVertexCount;e++){const t=s[e];this._pack(t,r,e*this._spec.stride)}}}_packPosition(e,r,s){const{offset:i}=this._spec.position,n=this._spec.position.packPrecisionFactor??1,o=t.i1616to32(e*n,r*n);this._dataView.setUint32(s+i,o,!0)}_packId(e,t){const r=e*(this._spec.id.packPrecisionFactor??1),s=4278190080&this._dataView.getUint32(t+this._spec.id.offset,!0);this._dataView.setUint32(t+this._spec.id.offset,r|s,!0)}_pack(e,t,r){s.packDataView(this._dataView,e,t,r)}}e.MeshWriterVertexPack=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/number":function(){define(["exports"],function(e){"use strict";const t=new Float32Array(1),r=new Uint32Array(t.buffer);function s(e,t,r){return Math.round(Math.max(Math.min(e,r),t))}function i(e){return t[0]=e,r[0]}e.fromUint16=function(e){let t=e>>>15,r=e>>10&31,s=1023&e;return t=t?-1:1,r-=15,s/=1024,r>-15?s+=1:r=-14,t*2**r*s},e.i16=function(e){return s(e,-32768,32767)},e.i1616to32=function(e,t){return 65535&e|t<<16},e.i32=function(e){return s(e,-2147483648,2147483647)},e.i8=function(e){return s(e,-128,127)},e.i8816to32=function(e,t,r){return 255&e|(255&t)<<8|r<<16},e.i8888to32=function(e,t,r,s){return 255&e|(255&t)<<8|(255&r)<<16|s<<24},e.numTo32=function(e){return 0|e},e.toFloat32=function(e){return r[0]=e,t[0]},e.toUint16=function(e){const t=i(e),r=t>>>31;let s=t>>>23&255,n=8388607&t;return s-=127,s>15?r<<15|31744:s<-25?0:(s<-14&&(n+=8388608,n/=2**(-14-s),s=-15),s+=15,n/=8192,n=function(e){const t=Math.floor(e),r=e-t;return t<1023&&(r>.5||.5===r&&t%2==1)?t+1:t}(n),r<<15|s<<10|n)},e.toUint32=i,e.u16=function(e){return s(e,0,65535)},e.u32=function(e){return s(e,0,4294967295)},e.u32to4Xu8=function(e){return[255&e,(65280&e)>>>8,(16711680&e)>>>16,(4278190080&e)>>>24]},e.u4u4to8=function(e,t){return 15&e|(15&t)<<4},e.u8=function(e){return s(e,0,255)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/AlignedVertexSpec":function(){define(["exports","../../../../../../../core/has","./utils","../../../../../../webgl/enums"],function(e,t,r,s){"use strict";function i(e){switch(e){case s.DataType.BYTE:case s.DataType.UNSIGNED_BYTE:return 1;case s.DataType.SHORT:case s.DataType.UNSIGNED_SHORT:case s.DataType.HALF_FLOAT:return 2;case s.DataType.FLOAT:case s.DataType.INT:case s.DataType.UNSIGNED_INT:return 4}}function n(e){const t=[],r=[],s=[];for(const n of e){const e=i(n.type)*n.count;switch(e%2||e%4||4){case 4:t.push(n);continue;case 2:r.push(n);continue;case 1:s.push(n);continue;default:throw new Error("Found unexpected dataType byte count")}}return t.push(...r),t.push(...s),t}class o{static fromVertexSpec(e,t){const{attributes:r,optionalAttributes:s}=e;let a,l,c;const u=[];for(const e in r){if(r[e].otherSource)continue;const t=r[e];"position"===t.pack?a={...t,name:e,offset:0}:"id"===t.pack?l={...t,name:e,offset:4}:"bitset"===e?c={...t,name:e,offset:7}:u.push({...t,name:e})}for(const e in s)if(!0===t[e]){const t=s[e];u.push({...t,name:e})}const h=n(u),d=[];let p=8,f=1;for(const e of h)d.push({...e,offset:p}),p+=i(e.type)*e.count,e.packAlternating&&(f=Math.max(e.packAlternating.count,f));const m=Uint32Array.BYTES_PER_ELEMENT,g=p%m;return new o(a,l,c,d,p+(g?m-g:0),f)}constructor(e,t,r,s,i,n){this.position=e,this.id=t,this.bitset=r,this.standardAttributes=s,this.stride=i,this.packVertexCount=n,s.push(r),this._attributes=[e,t,r,...s]}get attributeLayout(){if(!this._attributeLayout){const e=r.vertexLayoutHash(this._attributes),t=this._attributes.map(e=>({name:e.name,count:e.count,offset:e.offset,type:e.type,packPrecisionFactor:e.packPrecisionFactor,normalized:e.normalized??!1}));this._attributeLayout={attributes:t,hash:e,stride:this.stride}}return this._attributeLayout}}e.AlignedVertexSpec=o,e.sortByAlignment=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/utils":function(){define(["exports","../../../../../../../core/string"],function(e,t){"use strict";e.applyComputedValue=function e(t,r,s,i,n,o,a){if(t.primitiveName===r){let e=i?.readWithDefault(n,o,t[s]&&a);return"text"===t.type&&(e=e.toString()),void(t[s]=e)}if("type"in t&&null!=t.type){if(t.effects)for(const l of t.effects)e(l,r,s,i,n,o,a);switch(t.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":if(t.symbolLayers)for(const l of t.symbolLayers)e(l,r,s,i,n,o,a);break;case"CIMTextSymbol":t.symbol&&e(t.symbol,r,s,i,n,o,a);break;case"CIMHatchFill":t.lineSymbol&&e(t.lineSymbol,r,s,i,n,o,a);break;case"CIMPictureMarker":case"CIMCharacterMarker":case"CIMVectorMarker":if(t.markerPlacement&&e(t.markerPlacement,r,s,i,n,o,a),"CIMVectorMarker"===t.type&&t.markerGraphics)for(const l of t.markerGraphics)e(l,r,s,i,n,o,a),e(l.symbol,r,s,i,n,o,a)}}},e.getLineClippingMargin=function(e){const t=Math.max(1.25*e.width,20);return null!=e.effects&&e.effects.length>0?400:t},e.vertexLayoutHash=function(e){const r=e.map(({name:e,count:t,type:r})=>`${e}.${t}.${r}`).join(",");return t.numericHash(r)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/dataViewUtils":function(){define(["exports","../../../number","../../../../../../webgl/enums"],function(e,t,r){"use strict";e.packDataView=function(e,s,i,n){const o=i.packPrecisionFactor??1;switch(i.type){case r.DataType.BYTE:if(1===i.count)e.setInt8(n+i.offset,s*o);else for(let t=0;t<i.count;t++){const r=t*Int8Array.BYTES_PER_ELEMENT;e.setInt8(n+i.offset+r,s[t]*o)}break;case r.DataType.UNSIGNED_BYTE:if(1===i.count)e.setUint8(n+i.offset,s*o);else for(let t=0;t<i.count;t++){const r=t*Uint8Array.BYTES_PER_ELEMENT;e.setUint8(n+i.offset+r,s[t]*o)}break;case r.DataType.SHORT:if(1===i.count)e.setInt16(n+i.offset,s*o,!0);else for(let t=0;t<i.count;t++){const r=t*Int16Array.BYTES_PER_ELEMENT;e.setInt16(n+i.offset+r,s[t]*o,!0)}break;case r.DataType.UNSIGNED_SHORT:if(1===i.count)e.setUint16(n+i.offset,s*o,!0);else for(let t=0;t<i.count;t++){const r=t*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(n+i.offset+r,s[t]*o,!0)}break;case r.DataType.INT:if(1===i.count)e.setInt32(n+i.offset,s*o,!0);else for(let t=0;t<i.count;t++){const r=t*Int32Array.BYTES_PER_ELEMENT;e.setInt32(n+i.offset+r,s[t]*o,!0)}break;case r.DataType.UNSIGNED_INT:if(1===i.count)e.setUint32(n+i.offset,s*o,!0);else for(let t=0;t<i.count;t++){const r=t*Uint32Array.BYTES_PER_ELEMENT;e.setUint32(n+i.offset+r,s[t]*o,!0)}break;case r.DataType.FLOAT:if(1===i.count)e.setFloat32(n+i.offset,s*o,!0);else for(let t=0;t<i.count;t++){const r=t*Float32Array.BYTES_PER_ELEMENT;e.setFloat32(n+i.offset+r,s[t]*o,!0)}break;case r.DataType.HALF_FLOAT:if(1===i.count)e.setUint16(n+i.offset,t.toUint16(s*o),!0);else for(let r=0;r<i.count;r++){const a=r*Uint16Array.BYTES_PER_ELEMENT;e.setUint16(n+i.offset+a,t.toUint16(s[r]*o),!0)}}},e.unpackDataView=function(e,s,i){switch(s.type){case r.DataType.BYTE:{if(1===s.count)return e.getInt8(i+s.offset);const t=[];for(let r=0;r<s.count;r++){const n=r*Int8Array.BYTES_PER_ELEMENT;t.push(e.getInt8(i+s.offset+n))}return t}case r.DataType.UNSIGNED_BYTE:{if(1===s.count)return e.getUint8(i+s.offset);const t=[];for(let r=0;r<s.count;r++){const n=r*Uint8Array.BYTES_PER_ELEMENT;t.push(e.getUint8(i+s.offset+n))}return t}case r.DataType.SHORT:{if(1===s.count)return e.getInt16(i+s.offset,!0);const t=[];for(let r=0;r<s.count;r++){const n=r*Int16Array.BYTES_PER_ELEMENT;t.push(e.getInt16(i+s.offset+n,!0))}return t}case r.DataType.UNSIGNED_SHORT:{if(1===s.count)return e.getUint16(i+s.offset,!0);const t=[];for(let r=0;r<s.count;r++){const n=r*Uint16Array.BYTES_PER_ELEMENT;t.push(e.getUint16(i+s.offset+n,!0))}return t}case r.DataType.INT:{if(1===s.count)return e.getInt32(i+s.offset,!0);const t=[];for(let r=0;r<s.count;r++){const n=r*Int32Array.BYTES_PER_ELEMENT;t.push(e.getInt32(i+s.offset+n,!0))}return t}case r.DataType.UNSIGNED_INT:{if(1===s.count)return e.getUint32(i+s.offset,!0);const t=[];for(let r=0;r<s.count;r++){const n=r*Uint32Array.BYTES_PER_ELEMENT;t.push(e.getUint32(i+s.offset+n,!0))}return t}case r.DataType.FLOAT:{if(1===s.count)return e.getFloat32(i+s.offset,!0);const t=[];for(let r=0;r<s.count;r++){const n=r*Float32Array.BYTES_PER_ELEMENT;t.push(e.getFloat32(i+s.offset+n,!0))}return t}case r.DataType.HALF_FLOAT:{if(1===s.count)return t.fromUint16(e.getUint16(i+s.offset,!0));const r=[];for(let n=0;n<s.count;n++){const o=n*Uint16Array.BYTES_PER_ELEMENT;r.push(t.fromUint16(e.getUint16(i+s.offset+o,!0)))}return r}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/attributes":function(){define(["exports","../../../definitions","../../../animations/utils","./AnimatedMeshWriter","../fill/meshWriterUtils","../../../../../../webgl/enums"],function(e,t,r,s,i,n){"use strict";const o={type:n.DataType.SHORT,count:2,packPrecisionFactor:t.minMaxZoomPrecisionFactor,pack:({scaleInfo:e},{tileInfo:t})=>i.getMinMaxZoom(e,t)},a={type:n.DataType.FLOAT,count:4,packPrecisionFactor:1,packTessellation:({value1Position2Value2:e})=>(r.assert(e),e)},l={type:n.DataType.FLOAT,count:4,packPrecisionFactor:1,packTessellation:()=>[0,0,0,1]},c={type:n.DataType.FLOAT,count:1,packPrecisionFactor:1,pack:()=>0},u={type:n.DataType.FLOAT,count:1,packPrecisionFactor:1,packTessellation:({lineLength:e})=>e},h={type:n.DataType.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},d={type:n.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]},p={type:n.DataType.FLOAT,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[e,t]},f={type:n.DataType.UNSIGNED_BYTE,count:3,pack:"id"},m={type:n.DataType.UNSIGNED_BYTE,count:1,pack:s.packAnimatedBitset},g={type:n.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:1},y={marker:{type:n.DataType.FLOAT,count:2,packAlternating:{count:4,pack:({texelDimensions:e})=>[[-.5*e[0],-.5*e[1]],[.5*e[0],-.5*e[1]],[-.5*e[0],.5*e[1]],[.5*e[0],.5*e[1]]]}},line:{type:n.DataType.FLOAT,count:2,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t},{baseSize:r})=>[e*r/2,t*r/2]},fill:{type:n.DataType.FLOAT,count:2,packTessellation:()=>[0,0]}},_={marker:{type:n.DataType.SHORT,count:2,packPrecisionFactor:1,packAlternating:{count:4,packTessellation:({texXmax:e,texXmin:t,texYmax:r,texYmin:s})=>[[t,s],[e,s],[t,r],[e,r]]}}},b={type:n.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{const{rect:r,width:s,height:i}=e,n=r.x+t.spritePadding,o=r.y+t.spritePadding;return[n+1,o+1,n+s-1,o+i-1]}},S={type:n.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:4,pack:({animations:e,baseSize:t,referenceSize:r})=>[e.dataColumn,e.dataRow,t,r]},x={type:n.DataType.UNSIGNED_SHORT,count:4,packPrecisionFactor:8,pack:({strokeWidth:e,pixelDimensions:t,baseSize:r,sprite:s,sizeRatio:i})=>{const n=Math.max(r*s.width/s.height,r),o=s.sdfDecodeCoeff*n*i;return[t[0],t[1],e,o]}},w={type:n.DataType.BYTE,count:1,packTessellation:({angle:e})=>e};e.accumulatedDistance=h,e.angle=w,e.animationPointerAndBaseSizeAndReferenceSize=S,e.bitset=m,e.id=f,e.lineLength=u,e.noLineLength=c,e.noTiming=l,e.normal=p,e.offset=y,e.pos=g,e.segmentDirection=d,e.sizing=x,e.tlbr=b,e.uv=_,e.value1Position2Value2=a,e.zoomRange=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/utils":function(){define(["exports","../../../../../Color","../grouping","./infos","./instructions"],function(e,t,r,s,i){"use strict";function n(e){const t=[],r=[];let s=0;for(const n of e){const o=[...n.encode(),...i.instructions.ret.encode()];t.push([s+e.length,0,0,0]),r.push(...o),s+=o.length}return[...t,...r]}function o(e,s,i){const n=e;let l;if("number"==typeof n||"string"==typeof n||"boolean"==typeof n)l=n;else if(Array.isArray(n))l=n.map(e=>o(e,s,i));else if("object"==typeof n)if("type"in n&&null!=n.type&&"Process"===n.type)switch(n.op){case"ArcadeColor":{const e=o(n.value,s,i);a(Array.isArray(e)&&4===e.length),l=[e[0]/255,e[1]/255,e[2]/255,e[3]]}break;case"Transparency":{const e=o(n.value,s,i);a("number"==typeof e),l=1-e/100}break;case"Divide":case"Multiply":case"Add":{const e=o(n.left,s,i);a("number"==typeof e);const t=o(n.right,s,i);switch(a("number"==typeof t),n.op){case"Divide":l=e/t;break;case"Multiply":l=e*t;break;case"Add":l=e+t}}break;case"Random":{const e=o(n.seed,s,i),t=o(n.min,s,i),a=o(n.max,s,i),c=s.getObjectId(),u=r.getStartGroup(c||0);l=t+r.getRandomValue(u,e)*(a-t)}break;case"Cond":{const e=o(n.condition,s,i),t=o(n.ifTrue,s,i),r=o(n.ifFalse,s,i);l=e?t:r}break;case"MatchWinding":{const e=o(n.sign,s,i);let t=o(n.angle,s,i);if(e>0)for(;t<0;)t+=2*Math.PI;else for(;t>0;)t-=2*Math.PI;l=t}}else if("computed"in n)l=function(e){if(!("computed"in e))return e;let r=e.computed.readWithDefault(s,i,[255*e.defaultValue[0],255*e.defaultValue[1],255*e.defaultValue[2],e.defaultValue[3]]);if("string"==typeof r){const e=t.fromString(r);e&&(r=[e.r,e.g,e.b,e.a])}return r}(n);else{l={};for(const e in n)l[e]=o(n[e],s,i)}return l}function a(e){if(!e)throw new Error("Assertion failed.")}e.assert=a,e.compileAnimationParam=async function e(t,r){const s=t;let i;if("number"==typeof s||"string"==typeof s||"boolean"==typeof s)i=s;else if(Array.isArray(s))i=await Promise.all(s.map(t=>e(t,r)));else if("object"==typeof s)if("valueExpressionInfo"in s){const{valueExpressionInfo:e}=s,{expression:t}=e;i={...s,computed:await r.createComputedField({expression:t})}}else{i={};for(const t in s)i[t]=await e(s[t],r)}return i},e.createParamList=function(e){const t=[];return t.push(e.transform),t.push(e.fromColor),t.push(e.toColor),t.push(e.colorMix),t.push(e.toOpacity),t.push(e.opacityMix),e?.shift?t.push(e?.shift):t.push([1,1,1,1]),t},e.encodeParamList=n,e.fromJSON=function(e){return n(e.map(e=>o(e)).map(e=>s.hydrate(e).simplify()))},e.getAnimationExpressions=function*e(t){const r=t;if(Array.isArray(r))for(const t of r)yield*e(t);else if("object"==typeof r)if("type"in r&&null!=r.type&&"Process"===r.type)switch(r.op){case"ArcadeColor":case"Transparency":yield*e(r.value);break;case"Divide":case"Multiply":case"Add":yield*e(r.left),yield*e(r.right);break;case"Random":yield*e(r.seed),yield*e(r.min),yield*e(r.max);break;case"Cond":yield*e(r.condition),yield*e(r.ifTrue),yield*e(r.ifFalse);break;case"MatchWinding":yield*e(r.sign),yield*e(r.angle)}else if("computed"in r)yield r.computed;else for(const t in r)yield*e(r[t])},e.resolveToAnimationInfo=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/grouping":function(){define(["exports","../../../../core/string"],function(e,t){"use strict";function r(e,r){let s;if("string"==typeof e)s=t.numericHash(e+`-seed(${r})`);else{let t=12;s=e^r;do{s=107*(s>>8^s)+t|0}while(0!==--t)}return(1+s/(1<<31))/2}e.getRandomValue=r,e.getStartGroup=function(e){return Math.floor(10*r(e,53290320))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/infos":function(){define(["exports","./instructions"],function(e,t){"use strict";function r(e){return e instanceof s?e:"object"==typeof e&&"type"in e?l[e.type].hydrate(e):new i(e)}class s{constructor(e){this.inputs=e}encode(){const e=[];for(const t of this.inputs)e.push(...t.encode());return e.push(...this.instructions),e}}class i extends s{constructor(e){super([]),this.value=e}simplify(){return this}get instructions(){if(Array.isArray(this.value)){const[e,r,s,i]=this.value;return null!=i?t.instructions.vector4.encode([e,r||0,s||0,i]):t.instructions.vector3.encode([e,r||0,s||0])}return t.instructions.scalar.encode(this.value)}}class n extends s{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new n(e,r(e.parent))}simplify(){if(this._config.relativeTranslation||this._config.absoluteScale)return this;const e=this._parent.simplify();if(!(e instanceof i))return this;const[t,r,s,o]=e.value,a=this._config.translation.from[0],l=this._config.translation.from[1],c=this._config.rotation.from,u=this._config.scale.from;if(a===this._config.translation.to[0]&&l===this._config.translation.to[1]&&c===this._config.rotation.to&&u===this._config.scale.to){const e=s+c,n=o*u,h=Math.sin(s),d=Math.cos(s);return new i([d*o*a-h*o*l+t,h*o*a+d*o*l+r,e,n])}return new n(this._config,e)}get instructions(){return t.instructions.animatedTransform.encode(this._config)}}class o extends s{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new o(e,r(e.parent))}simplify(){const e=this._parent.simplify();if(!(e instanceof i))return this;const[t,r,s,n]=e.value,a=this._config.color.from[0],l=this._config.color.from[1],c=this._config.color.from[2];let u=this._config.color.from[3];const h=this._config.opacity.from;return a===this._config.color.to[0]&&l===this._config.color.to[1]&&c===this._config.color.to[2]&&u===this._config.color.to[3]&&h===this._config.opacity.to?(u*=h,new i([t*a,r*l,s*c,n*u])):new o(this._config,e)}get instructions(){return t.instructions.animatedColor.encode(this._config)}}class a extends s{constructor(e,t){super([t]),this._config=e,this._parent=t}static hydrate(e){return new a(e,r(e.parent))}simplify(){const e=this._parent.simplify();return e instanceof i?new a(this._config,e):this}get instructions(){return t.instructions.animatedShift.encode(this._config)}}const l={AnimatedTransform:n,AnimatedColor:o,AnimatedShift:a};e.AAnimationInfo=s,e.AnimatedColor=o,e.AnimatedShift=a,e.AnimatedTransform=n,e.Constant=i,e.hydrate=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/animations/instructions":function(){define(["exports"],function(e){"use strict";class t{generateSource(e){const t=[];for(let r=1;r<this.length;r++)t.push(`vec4 atom${r} = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;");for(let e=0;e<this.ins;e++)t.push("top--;"),t.push(`vec4 in${this.ins-e-1} = stack[top];`);for(let e=0;e<this.outs;e++)t.push(`vec4 out${e};`);const{microcode:r}=this;for(const e of r)t.push(e);for(let e=0;e<this.outs;e++)t.push(`stack[top] = out${e};`),t.push("top++;"),t.push(`if (top >= ${g}) { top = ${g-1}; }`);return t}}let r=128;class s extends t{constructor(){super(...arguments),this.opcode=++r,this.length=1,this.ins=0,this.outs=0,this.microcode=["break;"]}encode(){return[[this.opcode,0,0,0]]}}class i extends t{constructor(){super(...arguments),this.opcode=++r,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.y, atom0.y, atom0.y, atom0.y);"]}encode(e){return[[this.opcode,e,0,0]]}}class n extends t{constructor(){super(...arguments),this.opcode=++r,this.length=1,this.ins=0,this.outs=1,this.microcode=["out0 = vec4(atom0.yzw, 0.0);"]}encode(e){return[[this.opcode,e[0]||0,e[1]||0,e[2]||0]]}}class o extends t{constructor(){super(...arguments),this.opcode=++r,this.length=2,this.ins=0,this.outs=1,this.microcode=["out0 = atom1;"]}encode(e){return[[this.opcode,0,0,0],e]}}function a(e){return[`float duration = clamp(${e.duration}, 0.05, 3600.0);`,`float startTimeOffset = ${e.startTimeOffset};`,`float repeatDelay = ${e.repeatDelay};`,`float timeOriginSelector = ${e.timeOriginSelector};`,`float repeatType = ${e.repeatType};`,`float easing = ${e.easing};`,`float playAnimation = ${e.playAnimation} * (1.0 - step(0.0, -${e.duration}));`,`float reverseAnimation = ${e.reverseAnimation};`,"float time = globalTime - (timeOriginSelector == 1.0 ? localTimeOrigin : 0.0);","time *= playAnimation;","time *= 1.0 - reverseAnimation * 2.0;","float period = duration + repeatDelay;","time += reverseAnimation == 1.0 ? (period - startTimeOffset - 0.001) : startTimeOffset + 0.001;","float omega = time / period;","float oi = floor(omega);","omega = repeatType == 1.0 || repeatType == 3.0 ? omega - oi : omega;","float of = omega * period;","of = (clamp(of, reverseAnimation * repeatDelay, period - (1.0 - reverseAnimation) * repeatDelay) - reverseAnimation * repeatDelay) / duration;","of = easing == 2.0 ? pow(of, 3.0) : of;","of = easing == 3.0 ? 1.0 - pow(1.0 - of, 3.0) : of;","of = easing == 4.0 ? of < 0.5 ? 4.0 * pow(of, 3.0) : 1.0 - pow(-2.0 * of + 2.0, 3.0) / 2.0 : of;","bool oscillate = repeatType == 3.0 && mod(oi, 2.0) == 1.0;",`${e.out} = oscillate ? 1.0 - of : of;`]}const l={Linear:1,EaseIn:2,EaseOut:3,EaseInOut:4},c={Loop:1,None:2,Oscillate:3},u={Local:1,Global:2};function h(e){const t=l[e.easing],r=c[e.repeatType],s=u[e.timeOriginSelector];return[[e.duration,e.startTimeOffset,e.repeatDelay,s],[r,t,e.playAnimation,e.reverseAnimation]]}class d extends t{constructor(){super(...arguments),this.opcode=++r,this.length=10,this.ins=1,this.outs=1,this.microcode=["vec2 fromTranslation = atom1.xy;","vec2 toTranslation = atom1.zw;","float fromRotation = atom2.x;","float toRotation = atom2.y;","float fromScale = atom2.z;","float toScale = atom2.w;","bool relativeTranslation = atom9.x == 1.0;","bool absoluteScale = atom9.y == 1.0;","vec2 translationMultiplier = relativeTranslation ? pixelDimensions : vec2(1.0, 1.0);","float scaleDivisor = absoluteScale ? pixelDimensions.y : 1.0;","float fTranslation;","{",...a({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fTranslation"}),"}","float fRotation;","{",...a({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fRotation"}),"}","float fScale;","{",...a({duration:"atom7.x",startTimeOffset:"atom7.y",repeatDelay:"atom7.z",timeOriginSelector:"atom7.w",repeatType:"atom8.x",easing:"atom8.y",playAnimation:"atom8.z",reverseAnimation:"atom8.w",out:"fScale"}),"}","vec2 aTranslation = mix(fromTranslation, toTranslation, fTranslation);","float aRotation = mix(fromRotation, toRotation, fRotation);","float aScale = mix(fromScale, toScale, fScale);","vec2 pTranslation = in0.xy;","float pRotation = in0.z;","float pScale = in0.w;","aTranslation *= translationMultiplier;","aScale /= scaleDivisor;","float rotation = pRotation + aRotation;","float scale = pScale * aScale;","float sin1 = sin(pRotation);","float cos1 = cos(pRotation);","float s1 = pScale;","float x1 = pTranslation.x;","float y1 = pTranslation.y;","float x2 = aTranslation.x;","float y2 = aTranslation.y;","\n    vec2 translation = vec2(\n      cos1 * s1 * x2 - sin1 * s1 * y2 + x1,\n      sin1 * s1 * x2 + cos1 * s1 * y2 + y1\n    );\n    ","out0 = vec4(translation, rotation, scale);"]}encode(e){return[[this.opcode,0,0,0],[e.translation.from[0],e.translation.from[1],e.translation.to[0],e.translation.to[1]],[e.rotation.from,e.rotation.to,e.scale.from,e.scale.to],...h(e.translation.timing),...h(e.rotation.timing),...h(e.scale.timing),[e.relativeTranslation?1:0,e.absoluteScale?1:0,0,0]]}}class p extends t{constructor(){super(...arguments),this.opcode=++r,this.length=7,this.ins=1,this.outs=1,this.microcode=["float fromOpacity = atom0.y;","float toOpacity = atom0.z;","vec4 fromColor = atom1;","vec4 toColor = atom2;","float fColor;","{",...a({duration:"atom3.x",startTimeOffset:"atom3.y",repeatDelay:"atom3.z",timeOriginSelector:"atom3.w",repeatType:"atom4.x",easing:"atom4.y",playAnimation:"atom4.z",reverseAnimation:"atom4.w",out:"fColor"}),"}","float fOpacity;","{",...a({duration:"atom5.x",startTimeOffset:"atom5.y",repeatDelay:"atom5.z",timeOriginSelector:"atom5.w",repeatType:"atom6.x",easing:"atom6.y",playAnimation:"atom6.z",reverseAnimation:"atom6.w",out:"fOpacity"}),"}","vec4 aColor = mix(fromColor, toColor, fColor);","aColor.a *= mix(fromOpacity, toOpacity, fOpacity);","vec4 pColor = in0;","out0 = aColor * pColor;"]}encode(e){return[[this.opcode,e.opacity.from,e.opacity.to,0],[e.color.from[0],e.color.from[1],e.color.from[2],e.color.from[3]],[e.color.to[0],e.color.to[1],e.color.to[2],e.color.to[3]],...h(e.color.timing),...h(e.opacity.timing)]}}class f extends t{constructor(){super(...arguments),this.opcode=++r,this.length=4,this.ins=1,this.outs=1,this.microcode=["float fromShift = atom0.y;","float toShift = atom0.z;","float duration = atom1.x;","bool multiplyByLineLength = atom3.x == 1.0;","float fShift;","{",...a({duration:"duration",startTimeOffset:"atom1.y",repeatDelay:"atom1.z",timeOriginSelector:"atom1.w",repeatType:"atom2.x",easing:"atom2.y",playAnimation:"atom2.z",reverseAnimation:"atom2.w",out:"fShift"}),"}","toShift *= multiplyByLineLength ? lineLength : 1.0;","float aShift = mix(fromShift, toShift, fShift);","vec4 pShift = in0;","out0 = mod(aShift + pShift, lineLength);"]}encode(e){return[[this.opcode,e.shift.from,e.shift.to,0],...h(e.shift.timing),[e.multiplyByLineLength?1:0,0,0,0]]}}const m={scalar:new i,vector3:new n,vector4:new o,animatedTransform:new d,animatedColor:new p,animatedShift:new f,ret:new s},g=4;function y(e){const t=[];t.push(`float globalTime = ${e.globalTime};`),t.push(`float localTimeOrigin = ${e.localTimeOrigin};`),t.push(`float lineLength = ${e.lineLength};`),t.push(`vec2 pointer = ${e.animationPointer};`),t.push(`vec2 size = ${e.animationTextureSize};`),t.push("int top = 0;"),t.push(`vec4 stack[${g}];`),t.push("for (int counter = 0; counter < 40; counter++) {"),t.push(`vec4 atom0 = texture(${e.animationTexture}, (pointer + 0.5) / size);`),t.push("pointer.x += 1.0;"),t.push(`vec2 pixelDimensions = ${e.pixelDimensions};`),t.push("if (false) {");for(const r in m){const s=m[r];t.push(`} else if (int(atom0.x) == ${s.opcode}) {`);for(const r of s.generateSource(e))t.push(r)}return t.push("} // End if-else."),t.push("} // End for."),t.push(`${e.out} = top > 0 ? stack[top - 1] : vec4(0.0);`),t.join("\n")}e.AAnimationInstruction=t,e.AnimatedColorInstruction=p,e.AnimatedShiftInstruction=f,e.AnimatedTransformInstruction=d,e.RetInstruction=s,e.ScalarInstruction=i,e.Vector3Instruction=n,e.Vector4Instruction=o,e.easingCodes=l,e.generateGetValueSource=function(e,t){return`\n    vec4 ${e}(int valueIndex) {\n      vec2 thePointer = ${t.animationPointer};\n      float jump = texture(${t.animationTexture}, (0.5 + vec2(thePointer.x + float(valueIndex), thePointer.y)) / ${t.animationTextureSize}).x;\n      thePointer = vec2(thePointer.x + jump, thePointer.y);\n      vec4 theResult;\n      ${y({...t,out:"theResult",animationPointer:"thePointer"})}\n      return theResult;\n    }\n  `},e.generateVirtualMachineSource=y,e.getTweenFactor=a,e.instructions=m,e.repeatTypeCodes=c,e.timeOriginSelectorCodes=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/ComputedAnimatedParams":function(){define(["exports","../../../../../../../core/screenUtils"],function(e,t){"use strict";e.createComputedAnimatedMeshParams=function(e){let{pixelDimensions:r,texelDimensions:s,baseSize:i,referenceSize:n,strokeWidth:o,sizeRatio:a}=e;if(r||(r=e.sprite.sdf?[0,0]:[e.sprite.width,e.sprite.height]),s||(s=e.sprite.sdf?[0,0]:r),null!=e.patternHeight){const t=e.patternHeight/r[1];r[1]*=t,r[0]*=t}-1===i&&(i=r[1]),i=t.pt2px(i),n=t.pt2px(n),o=t.pt2px(o);const l=(e.sprite.sdfDecodeCoeff??1)*a;return{...e,pixelDimensions:r,texelDimensions:s,baseSize:i,referenceSize:n,strokeWidth:o,sdfDecodeCoeff:l}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/constants":function(){define(["exports"],function(e){"use strict";e.attrVvColor=1,e.attrVvOpacity=2,e.attrVvRotation=3,e.attrVvSize=0,e.bitsetFillRandomPatternOffset=2,e.bitsetGenericConsiderAlphaOnly=4,e.bitsetGenericLockColor=1,e.bitsetLineIsSdf=3,e.bitsetLineScaleDash=2,e.bitsetMarkerAlignmentMap=0,e.bitsetMarkerOutlineAllowColorOverride=2,e.bitsetMarkerScaleSymbolsProportionally=3,e.bitsetOutlineUsesColorVV=1,e.bitsetTextIsBackground=0,e.bitsetTextIsMapAligned=3,e.bitsetTypeFillOutline=0,e.c256ToRad=3.14159265359/128,e.cDegToRad=3.14159265359/180,e.cRadToDeg=180/3.141592654,e.epsilon=1e-5,e.epsilonHitTest=.05,e.extrudeScalePlacementPadding=1/4,e.fillPositionPrecision=1,e.magnifierBarrelFactor=1.1,e.maxFilterCount=2,e.maxRepresentableInt=16777216,e.maxSdfDistance=8,e.nanMagicNumber=1e-30,e.offsetPrecision=1/8,e.outlineScale=.2,e.packPrecision=16,e.placementPadding=8,e.positionPrecision=1/8,e.sdfFontSize=24,e.signedToUnsignedByte=128,e.softEdgeRatio=1,e.thinLineHalfWidth=1,e.thinLineWidthFactor=1.1,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/animated/AnimatedPolyMeshWriters":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../TurboLine","../../../mesh/templates/templateUtils","./AnimatedMeshWriter","./attributes","./ComputedAnimatedParams","../fill/meshWriterUtils","../line/LineMeshWriter"],function(e,t,r,s,i,n,o,a,l,c){"use strict";class u extends n.AAnimatedMeshWriter{_write(e,t,s){const i=s??r.GeometryCursor.fromFeatureSetReaderCIM(t);if(!i)return;const n=this.evaluatedMeshParams.sprite,{textureBinding:o}=n;e.recordStart(this.instanceId,this.attributeLayout,o);const a=t.getDisplayId();this._writePoly(e,a,i.asOptimized()),e.recordEnd()}}class h{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0}}e.AAnimatedPolyMeshWriter=u,e.AnimatedFillMeshWriter=class extends u{constructor(){super(...arguments),this.vertexSpec={createComputedParams:a.createComputedAnimatedMeshParams,attributes:{id:o.id,bitset:o.bitset,pos:o.pos,offset:o.offset.fill,tlbr:o.tlbr,animationPointerAndBaseSizeAndReferenceSize:o.animationPointerAndBaseSizeAndReferenceSize,sizing:o.sizing},optionalAttributes:{zoomRange:o.zoomRange,value1Position2Value2:o.noTiming,lineLength:o.noLineLength}}}_writePoly(e,t,r){const s=[];if(!i.triangulate(s,r))return;const n=e.vertexCount();r.forEachVertex((r,s)=>{this._writeVertex(e,t,r,s)}),e.indexEnsureSize(s.length);for(const t of s)e.indexWrite(n+t)}},e.AnimatedLineMeshWriter=class extends u{constructor(){super(...arguments),this.vertexSpec={createComputedParams:a.createComputedAnimatedMeshParams,attributes:{id:o.id,bitset:o.bitset,pos:o.pos,offset:o.offset.line,tlbr:o.tlbr,animationPointerAndBaseSizeAndReferenceSize:o.animationPointerAndBaseSizeAndReferenceSize,sizing:o.sizing,accumulatedDistance:o.accumulatedDistance,normal:o.normal,segmentDirection:o.segmentDirection},optionalAttributes:{zoomRange:o.zoomRange,value1Position2Value2:o.noTiming,lineLength:o.lineLength}},this._tessParams=new c.LineTessellationParams,this._currentWrite=new h,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:65535,textured:!1},this._lineLength=0,this._lineTessellator=new s.LineTessellation((e,t,r,s,i,n,o,a,l,c,u)=>this._writeTesselatedVertex(e,t,r,s,i,n,o,a,l,c,u,this._lineLength),this._writeTriangle.bind(this),!1)}_writePoly(e,s,n){const o=i.clipLinesMarshall(r.GeometryCursor.fromOptimized(n,"esriGeometryPolyline"),64);if(null==o)return;const{_currentWrite:a,_tessellationOptions:c}=this,{baseSize:u,capType:h,joinType:d,miterLimit:p}=this.evaluatedMeshParams,f=t.pt2px(.5*u);c.halfWidth=f,c.capType=l.processLineCapInput(h||"Round"),c.joinType=l.processLineJoinInput(d||"Round"),c.miterLimit=p||2,a.out=e,a.id=s,a.vertexCount=0,a.indexCount=0,a.vertexFrom=e.vertexCount(),a.vertexBounds=1;for(const{line:e,start:t,pathLength:r}of o){c.initialDistance=t%65535,a.pathLength=r,this._lineLength=0;for(let t=1;t<e.length;t++){const r=e[t].x-e[t-1].x,s=e[t].y-e[t-1].y;this._lineLength+=Math.sqrt(r*r+s*s)}this._lineTessellator.tessellate(e,c,!1)}}_writeTesselatedVertex(e,t,r,s,i,n,o,a,l,c,u,h){const{out:d,id:p,vertexBounds:f,pathLength:m}=this._currentWrite;return this.hasEffects&&d.recordBounds(e,t,f,f),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=l,this._tessParams.normalY=c,this._tessParams.directionX=i,this._tessParams.directionY=n,this._tessParams.distance=u,this._tessParams.pathLength=m,this._tessParams.lineLength=h,this._writeVertex(d,p,e,t,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(e,t,r){const{out:s}=this._currentWrite;s.indexEnsureSize(3),s.indexWrite(e),s.indexWrite(t),s.indexWrite(r),this._currentWrite.indexCount+=3}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/templateUtils":function(){define(["exports","../../../../../../chunks/earcut","../../../../../../geometry/libtess","../../../../../../geometry/support/TileClipper","../../../../../../layers/graphics/OptimizedGeometry","../../definitions","../bufcut"],function(e,t,r,s,i,n,o){"use strict";const a=new s.TileClipper(0,0,0,1,0),l=new s.TileClipper(0,0,0,1,0);function c(e,t,r){let s=0;for(let i=1;i<r;i++){const r=e[2*(t+i-1)],n=e[2*(t+i-1)+1];s+=(e[2*(t+i)]-r)*(e[2*(t+i)+1]+n)}return s}function u(e,t,r,s,i){let n=0;for(let o=r;o<s;o+=3){const r=2*(e[o]-i),s=2*(e[o+1]-i),a=2*(e[o+2]-i);n+=Math.abs((t[r]-t[a])*(t[s+1]-t[r+1])-(t[r]-t[s])*(t[a+1]-t[r+1]))}return n}a.setExtent(n.tileSize),l.setExtent(n.tileSize),e.area=c,e.clipLinesMarshall=function(e,t){l.setPixelMargin(t);const r=l,s=-t,i=n.tileSize+t;let o=[],a=!1;if(!e.nextPath())return null;let c=e.pathLength(),u=!0;for(;u;){e.seekPathStart();const t=[];if(!e.pathSize)return null;r.reset(2),e.nextPoint();let n=e.x,l=e.y;if(a)r.moveTo(n,l);else{if(n<s||n>i||l<s||l>i){a=!0;continue}t.push({x:n,y:l})}let h=!1;for(;e.nextPoint();)if(n=e.x,l=e.y,a)r.lineTo(n,l);else{if(n<s||n>i||l<s||l>i){h=!0;break}t.push({x:n,y:l})}if(h)a=!0;else{if(a){const e=r.resultWithStarts();if(e)for(const t of e)o.push({...t,pathLength:c})}else o.push({line:t,start:0,pathLength:c});u=e.nextPath(),c=u?e.pathLength():0,a=!1}}return o=o.filter(e=>e.line.length>1),0===o.length?null:o},e.clipMarshall=function(e,t){if(null==e)return null;if(!function(e,t,r){let s=0;for(let t=0;t<e.lengths.length;t++){const i=e.lengths[t];for(let t=0;t<i;t++){const i=e.coords[2*(t+s)],n=e.coords[2*(t+s)+1];if(i<-128||i>r||n<-128||n>r)return!0}s+=i}return!1}(e,0,n.tileSize+128))return e;a.setPixelMargin(t),a.reset(3);let r=0;for(let t=0;t<e.lengths.length;t++){const s=e.lengths[t];let i=e.coords[2*(0+r)],n=e.coords[2*(0+r)+1];a.moveTo(i,n);for(let t=1;t<s;t++)i=e.coords[2*(t+r)],n=e.coords[2*(t+r)+1],a.lineTo(i,n);a.close(),r+=s}const s=a.result(!1);if(!s)return null;const o=[],l=[];for(const e of s){let t=0;for(const r of e)l.push(r.x),l.push(r.y),t++;o.push(t)}return new i(o,l)},e.triangleAreaArray=u,e.triangulate=function(e,t){const{coords:r,lengths:s}=t,i=e;let n=0;for(let e=0;e<s.length;){let t=e,a=s[e],l=c(r,n,a);const h=[];for(;++t<s.length;){const e=s[t],i=c(r,n+a,e);if(!(i>0))break;l+=i,h.push(n+a),a+=e}const d=i.length;o.bufcut(i,r,n,n+a,h,2,0);const p=u(i,r,d,i.length,0),f=Math.abs(l);if(Math.abs((p-f)/Math.max(1e-7,f))>1e-5)return i.length=0,!1;e=t,n+=a}return!0},e.triangulateEarcut=function(e,r,s){const{coords:i,lengths:n}=r;let o=0;for(let a=0;a<n.length;){let l=a,u=n[a];const h=[];for(;++l<n.length;){const e=n[l];if(!(c(i,o+u,e)>0))break;h.push(o+u-o),u+=e}const d=o+u,p=r.coords.slice(2*o,2*d),f=t.earcut(p,h,2);for(const t of f)e.push(t+s+o);a=l,o+=u}return!0},e.triangulateLibtess=function(e){const{coords:t,lengths:s}=e,{buffer:i}=r.triangulate(t,s);return i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/bufcut":function(){define(["exports","../../../../../core/has"],function(e,t){"use strict";function r(e,t,r,s,i,n,o){let c;if(o===function(e,t,r,s,i,n){let o=0;for(let r=s,a=i-n;r<i;r+=n)o+=(e[a+t*n]-e[r+t*n])*(e[r+1+t*n]+e[a+1+t*n]),a=r;return o}(e,t,0,s,i,n)>0)for(let r=s;r<i;r+=n)c=a(r+t*n,e[r+t*n],e[r+1+t*n],c);else for(let r=i-n;r>=s;r-=n)c=a(r+t*n,e[r+t*n],e[r+1+t*n],c);return c&&y(c,c.next)&&(l(c),c=c.next),c}function s(e,t=e){if(!e)return e;let r,s=e;do{if(r=!1,s.steiner||!y(s,s.next)&&0!==d(s.prev,s,s.next))s=s.next;else{if(l(s),s=t=s.prev,s===s.next)break;r=!0}}while(r||s!==t);return t}function i(e,t,r,a,c,u,d,p){if(!e)return;!p&&u&&(e=h(e,a,c,u));let f=e;for(;e.prev!==e.next;){const h=e.prev,m=e.next;if(u?o(e,a,c,u):n(e))t.push(h.index/r+d),t.push(e.index/r+d),t.push(m.index/r+d),l(e),e=m.next,f=m.next;else if((e=m)===f){p?1===p?i(e=b(e,t,r,d),t,r,a,c,u,d,2):2===p&&S(e,t,r,a,c,u,d):i(s(e),t,r,a,c,u,d,1);break}}}function n(e){const t=e.prev,r=e,s=e.next;if(d(t,r,s)>=0)return!1;let i=e.next.next;const n=i;let o=0;for(;i!==e.prev&&(0===o||i!==n);){if(o++,f(t.x,t.y,r.x,r.y,s.x,s.y,i.x,i.y)&&d(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function o(e,t,r,s){const i=e.prev,n=e,o=e.next;if(d(i,n,o)>=0)return!1;const a=i.x<n.x?i.x<o.x?i.x:o.x:n.x<o.x?n.x:o.x,l=i.y<n.y?i.y<o.y?i.y:o.y:n.y<o.y?n.y:o.y,c=i.x>n.x?i.x>o.x?i.x:o.x:n.x>o.x?n.x:o.x,u=i.y>n.y?i.y>o.y?i.y:o.y:n.y>o.y?n.y:o.y,h=g(a,l,t,r,s),p=g(c,u,t,r,s);let m=e.prevZ,y=e.nextZ;for(;m&&m.z>=h&&y&&y.z<=p;){if(m!==e.prev&&m!==e.next&&f(i.x,i.y,n.x,n.y,o.x,o.y,m.x,m.y)&&d(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,y!==e.prev&&y!==e.next&&f(i.x,i.y,n.x,n.y,o.x,o.y,y.x,y.y)&&d(y.prev,y,y.next)>=0)return!1;y=y.nextZ}for(;m&&m.z>=h;){if(m!==e.prev&&m!==e.next&&f(i.x,i.y,n.x,n.y,o.x,o.y,m.x,m.y)&&d(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;y&&y.z<=p;){if(y!==e.prev&&y!==e.next&&f(i.x,i.y,n.x,n.y,o.x,o.y,y.x,y.y)&&d(y.prev,y,y.next)>=0)return!1;y=y.nextZ}return!0}function a(e,t,r,s){const i=v.create(e,t,r);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function c(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function u(e,t){const r=function(e,t){let r=t;const s=e.x,i=e.y;let n,o=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const e=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=s&&e>o){if(o=e,e===s){if(i===r.y)return r;if(i===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(s===o)return n.prev;const a=n,l=n.x,c=n.y;let u,h=1/0;for(r=n.next;r!==a;)s>=r.x&&r.x>=l&&s!==r.x&&f(i<c?s:o,i,l,c,i<c?o:s,i,r.x,r.y)&&(u=Math.abs(i-r.y)/(s-r.x),(u<h||u===h&&r.x>n.x)&&m(r,e)&&(n=r,h=u)),r=r.next;return n}(e,t);if(!r)return t;const i=w(r,e);return s(i,i.next),s(r,r.next)}function h(e,t,r,s){let i;for(;i!==e;i=i.next){if(i=i||e,null===i.z&&(i.z=g(i.x,i.y,t,r,s)),i.prev.next!==i||i.next.prev!==i)return i.prev.next=i,i.next.prev=i,h(e,t,r,s);i.prevZ=i.prev,i.nextZ=i.next}return e.prevZ.nextZ=null,e.prevZ=null,function(e){let t,r=1;for(;;){let s,i=e;e=null,t=null;let n=0;for(;i;){n++,s=i;let o=0;for(;o<r&&s;o++)s=s.nextZ;let a=r;for(;o>0||a>0&&s;){let r;0===o?(r=s,s=s.nextZ,a--):0!==a&&s?i.z<=s.z?(r=i,i=i.nextZ,o--):(r=s,s=s.nextZ,a--):(r=i,i=i.nextZ,o--),t?t.nextZ=r:e=r,r.prevZ=t,t=r}i=s}if(t.nextZ=null,r*=2,n<2)return e}}(e)}function d(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function p(e,t,r,s){return!!(y(e,t)&&y(r,s)||y(e,s)&&y(r,t))||d(e,t,r)>0!=d(e,t,s)>0&&d(r,s,e)>0!=d(r,s,t)>0}function f(e,t,r,s,i,n,o,a){return(i-o)*(t-a)-(e-o)*(n-a)>=0&&(e-o)*(s-a)-(r-o)*(t-a)>=0&&(r-o)*(n-a)-(i-o)*(s-a)>=0}function m(e,t){return d(e.prev,e,e.next)<0?d(e,t,e.next)>=0&&d(e,e.prev,t)>=0:d(e,t,e.prev)<0||d(e,e.next,t)<0}function g(e,t,r,s,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function y(e,t){return e.x===t.x&&e.y===t.y}function _(e,t){return e.x-t.x}function b(e,t,r,s){let i=e;do{const n=i.prev,o=i.next.next;!y(n,o)&&p(n,i,i.next,o)&&m(n,o)&&m(o,n)&&(t.push(n.index/r+s),t.push(i.index/r+s),t.push(o.index/r+s),l(i),l(i.next),i=e=o),i=i.next}while(i!==e);return i}function S(e,t,r,n,o,a,l){let c=e;do{let e=c.next.next;for(;e!==c.prev;){if(c.index!==e.index&&x(c,e)){let u=w(c,e);return c=s(c,c.next),u=s(u,u.next),i(c,t,r,n,o,a,l,0),void i(u,t,r,n,o,a,l,0)}e=e.next}c=c.next}while(c!==e)}function x(e,t){return e.next.index!==t.index&&e.prev.index!==t.index&&!function(e,t){let r=e;do{if(r.index!==e.index&&r.next.index!==e.index&&r.index!==t.index&&r.next.index!==t.index&&p(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&m(e,t)&&m(t,e)&&function(e,t){let r=e,s=!1;const i=(e.x+t.x)/2,n=(e.y+t.y)/2;do{r.y>n!=r.next.y>n&&r.next.y!==r.y&&i<(r.next.x-r.x)*(n-r.y)/(r.next.y-r.y)+r.x&&(s=!s),r=r.next}while(r!==e);return s}(e,t)}function w(e,t){const r=v.create(e.index,e.x,e.y),s=v.create(t.index,t.x,t.y),i=e.next,n=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,s.next=r,r.prev=s,n.next=s,s.prev=n,s}class v{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(e,t,r){const s=I<M.length?M[I++]:new v;return s.index=e,s.x=t,s.y=r,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const M=[];let I=0;for(let e=0;e<8096;e++)M.push(new v);e.bufcut=function(e,t,s,n,o,a,l){I=0;const h=(n-s)*a,d=o&&o.length,p=d?(o[0]-s)*a:h;let f,m,g,y,b,S=r(t,s,0,0,p,a,!0);if(S&&S.next!==S.prev){if(d&&(S=function(e,t,s,i,n,o){const a=new Array;for(let n=0,l=i.length;n<l;n++){const u=r(e,t,0,i[n]*o,n<l-1?i[n+1]*o:s*o,o,!1);u===u.next&&(u.steiner=!0),a.push(c(u))}a.sort(_);for(const e of a)n=u(e,n);return n}(t,s,n,o,S,a)),h>80*a){f=g=t[0+s*a],m=y=t[1+s*a];for(let e=a;e<p;e+=a){const r=t[e+s*a],i=t[e+1+s*a];f=Math.min(f,r),m=Math.min(m,i),g=Math.max(g,r),y=Math.max(y,i)}b=Math.max(g-f,y-m),b=0!==b?1/b:0}i(S,e,a,f,m,b,l,0)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/LineMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../definitions","../../../TurboLine","../../../mesh/templates/templateUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../mesh/utils","../../../../../../webgl/enums"],function(e,t,r,s,i,n,o,a,l,c){"use strict";class u{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0,this.pathLength=0,this.distanceOffset=0,this.lineLength=0}}const h={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:c.DataType.SHORT,count:2,packPrecisionFactor:s.minMaxZoomPrecisionFactor,pack:({scaleInfo:e},{tileInfo:t})=>o.getMinMaxZoom(e,t)}},attributes:{id:{type:c.DataType.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:c.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:c.DataType.UNSIGNED_BYTE,count:1},color:{type:c.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>o.processColorInput(e)},offset:{type:c.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[o.packRounded(e,16),o.packRounded(t,16)]},normal:{type:c.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:e,normalY:t})=>[o.packRounded(e,16),o.packRounded(t,16)]},halfWidth:{type:c.DataType.HALF_FLOAT,count:1,pack:({width:e})=>t.pt2px(.5*e)},referenceHalfWidth:{type:c.DataType.HALF_FLOAT,count:1,pack:({referenceWidth:e})=>t.pt2px(.5*e)}}};class d{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0,this.pathLength=0,this.distanceOffset=0}}const p=65535;class f extends a.MeshWriter{constructor(e,t,r,s){super(e,t,r,s),this.vertexSpec=h,this._currentWrite=new d,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:p,textured:!1},this._tessParams=new u,this._initializeTessellator()}writeLineVertices(e,t,r){const s=this._getLines(t);null!=s&&this._writeVertices(e,r,s)}_initializeTessellator(){this._lineTessellator=new i.LineTessellation(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0)}_write(e,t,s){const i=s??r.GeometryCursor.fromFeatureSetReaderCIM(t);i&&this._writeGeometry(e,t,i)}_writeGeometry(e,t,r,s){e.recordStart(this.instanceId,this.attributeLayout,s),this.writeLineVertices(e,r,t),e.recordEnd()}_getLines(e){return n.clipLinesMarshall(e,l.getLineClippingMargin(this.evaluatedMeshParams))}_writeVertices(e,r,i){const{_currentWrite:n,_tessellationOptions:a,evaluatedMeshParams:l}=this,{width:c,capType:u,joinType:h,miterLimit:d,hasSizeVV:f}=l,m=t.pt2px(.5*c);a.halfWidth=m,a.capType=o.processLineCapInput(u),a.joinType=o.processLineJoinInput(h),a.miterLimit=d;const g=!f;n.out=e,n.id=r.getDisplayId(),n.vertexCount=0,n.indexCount=0,n.vertexFrom=e.vertexCount(),n.vertexBounds=g&&m<s.thinLineHalfWidthThreshold?0:1;for(const{line:e,start:t,pathLength:r}of i)a.initialDistance=t%p,n.pathLength=r,n.distanceOffset=Math.floor(t/p)*p,this._lineTessellator.tessellate(e,a,g)}_writeTesselatedVertex(e,t,r,s,i,n,o,a,l,c,u){const{out:h,id:d,vertexBounds:p,pathLength:f,distanceOffset:m}=this._currentWrite;return this.hasEffects&&h.recordBounds(e,t,p,p),this._tessParams.extrusionOffsetX=o,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=l,this._tessParams.normalY=c,this._tessParams.directionX=i,this._tessParams.directionY=n,this._tessParams.distance=u,this._tessParams.pathLength=f,this._tessParams.distanceOffset=m,this._writeVertex(h,d,e,t,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(e,t,r){const{out:s}=this._currentWrite;s.indexEnsureSize(3),s.indexWrite(e),s.indexWrite(t),s.indexWrite(r),this._currentWrite.indexCount+=3}}e.LineMeshWriter=f,e.LineTessellationParams=u,e.LineVertexSpec=h,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter":function(){define(["exports","../fill/AFillMeshWriter","../../../../../../webgl/enums"],function(e,t,r){"use strict";const s={createComputedParams:e=>e,optionalAttributes:{},attributes:{id:{type:r.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:r.DataType.UNSIGNED_BYTE,count:1},pos:{type:r.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:r.DataType.FLOAT,count:1,packTessellation:({inverseArea:e})=>e}}};class i extends t.AFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=s}createTesselationParams(e){return{inverseArea:1/e.readGeometryArea()}}}e.DotDensityMeshWriter=i,e.dotDensityVertexSpec=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/AFillMeshWriter":function(){define(["exports","../../../../../../../core/has","../../../../../../../geometry/libtess","../../../mesh/templates/templateUtils","../mesh/MeshWriter"],function(e,t,r,s,i){"use strict";const n=t("featurelayer-fast-triangulation-enabled");class o extends i.MeshWriter{async loadDependencies(){await Promise.all([super.loadDependencies(),r.loadLibtess()])}_write(e,t,r){const s=r?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(s);i&&(e.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(e,t,i),e.recordEnd())}_clip(e){if(!e)return null;const t=this.hasEffects?256:8;return s.clipMarshall(e,t)}_writeGeometry(e,t,r){const i=r.maxLength>100,o=[],a=this.createTesselationParams(t);if(!i&&n&&s.triangulate(o,r))return void(o.length&&this._writeVertices(e,t,r.coords,a,o));const l=s.triangulateLibtess(r);this._writeVertices(e,t,l,a)}_writeVertices(e,t,r,s,i){const n=t.getDisplayId(),o=e.vertexCount(),a=this.hasEffects;let l=0;if(i)for(const t of i){const i=r[2*t],o=r[2*t+1];a&&e.recordBounds(i,o,0,0),this._writeVertex(e,n,i,o,s),l++}else for(let t=0;t<r.length;t+=2){const i=Math.round(r[t]),o=Math.round(r[t+1]);a&&e.recordBounds(i,o,0,0),this._writeVertex(e,n,i,o,s),l++}e.indexEnsureSize(l);for(let t=0;t<l;t++)e.indexWrite(t+o)}}e.AFillMeshWriter=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../vectorTiles/GeometryUtils","./meshWriterUtils","./PatternFillMeshWriter","../shaders/constants","../../../../../../webgl/enums"],function(e,t,r,s,i,n,o){"use strict";function a(e){const{sprite:r,aspectRatio:s,scaleProportionally:i}=e,n=t.pt2px(e.height),o=n>0?n:r.height;let a=n*s;return a<=0?a=r.width:i&&(a*=r.width/r.height),{width:a,height:o}}function l(e){const{applyRandomOffset:t,sampleAlphaOnly:r}=e;return s.packBitset([[n.bitsetFillRandomPatternOffset,t],[n.bitsetGenericConsiderAlphaOnly,r]])}const c={createComputedParams:e=>e,optionalAttributes:i.patternFillVertexSpec.optionalAttributes,attributes:{...i.patternFillVertexSpec.attributes,bitset:{count:1,type:o.DataType.UNSIGNED_BYTE,pack:l},width:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>a(e).width},height:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>a(e).height},offset:{count:2,type:o.DataType.HALF_FLOAT,pack:({offsetX:e,offsetY:r})=>[t.pt2px(e),-t.pt2px(r)]},scale:{count:2,type:o.DataType.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:e,scaleY:t})=>[e,t]},angle:{count:1,type:o.DataType.UNSIGNED_BYTE,pack:({angle:e})=>r.degToByte(e)}}};class u extends i.PatternFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=c}}e.ComplexFillMeshWriter=u,e.complexFillVertexSpec=c,e.getPatternSize=a,e.packComplexFillBitset=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter":function(){define(["exports","../../../definitions","./FillMeshWriter","../../../../../../webgl/enums"],function(e,t,r,s){"use strict";const i={createComputedParams:e=>e,optionalAttributes:r.fillVertexSpec.optionalAttributes,attributes:{...r.fillVertexSpec.attributes,tlbr:{count:4,type:s.DataType.UNSIGNED_SHORT,pack:({sprite:e})=>{const{rect:r,width:s,height:i}=e,n=r.x+t.spritePadding,o=r.y+t.spritePadding;return[n,o,n+s,o+i]}},inverseRasterizationScale:{count:1,type:s.DataType.BYTE,packPrecisionFactor:16,pack:({sprite:e})=>1/e.rasterizationScale}}};class n extends r.FillMeshWriter{constructor(){super(...arguments),this.vertexSpec=i}_write(e,t,r){const s=r?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(s);if(!i)return;const n=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(e,t,i),e.recordEnd()}}e.PatternFillMeshWriter=n,e.patternFillVertexSpec=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/FillMeshWriter":function(){define(["exports","../../../definitions","./AFillMeshWriter","./meshWriterUtils","../../../../../../webgl/enums"],function(e,t,r,s,i){"use strict";const n={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:i.DataType.SHORT,count:2,packPrecisionFactor:t.minMaxZoomPrecisionFactor,pack:({scaleInfo:e},{tileInfo:t})=>s.getMinMaxZoom(e,t)}},attributes:{id:{type:i.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:i.DataType.UNSIGNED_BYTE,count:1},pos:{type:i.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:i.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>s.processColorInput(e)}}};class o extends r.AFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=n}createTesselationParams(e){return null}}e.FillMeshWriter=o,e.fillVertexSpec=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","./ComplexFillMeshWriter","./meshWriterUtils","./OutlineFillMeshWriter","../shaders/constants","../../../../../../webgl/enums"],function(e,t,r,s,i,n,o){"use strict";const a=r.complexFillVertexSpec,l=i.outlineFillVertexSpec_Outline,c={createComputedParams:e=>e,optionalAttributes:a.optionalAttributes,attributes:{...a.attributes,bitset:{type:o.DataType.UNSIGNED_BYTE,count:1,pack:e=>r.packComplexFillBitset(e)},aux1:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>r.getPatternSize(e).width},aux2:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>r.getPatternSize(e).height},aux3:{count:2,type:o.DataType.HALF_FLOAT,pack:({offsetX:e,offsetY:r})=>[t.pt2px(e),t.pt2px(r)]},aux4:{count:2,type:o.DataType.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:t})=>[e*n.packPrecision,t*n.packPrecision]}}},u={createComputedParams:e=>e,optionalAttributes:a.optionalAttributes,attributes:{...a.attributes,color:l.attributes.color,bitset:{type:o.DataType.UNSIGNED_BYTE,count:1,pack:e=>s.packBitset([[n.bitsetTypeFillOutline,!0]])},aux1:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>t.pt2px(.5*e.width)},aux2:{count:1,type:o.DataType.HALF_FLOAT,pack:e=>t.pt2px(.5*e.referenceWidth)},aux3:{count:2,type:o.DataType.HALF_FLOAT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[e,t]},aux4:{count:2,type:o.DataType.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:t})=>[e*n.packPrecision+n.signedToUnsignedByte,t*n.packPrecision+n.signedToUnsignedByte]}}};class h extends i.OutlineFillOutlineMeshWriter{constructor(){super(...arguments),this.vertexSpec=u}}class d extends i.OutlineFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=c}_createOutlineWriter(e,t,r,s){return new h(e,t,r,s)}write(e,t,r,s,i){this.ensurePacked(t,r,s);const n=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,n),this._write(e,r),e.recordEnd()}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._lineMeshWriter.ensurePacked(e,t,r)}enqueueRequest(e,t,r){super.enqueueRequest(e,t,r),this._lineMeshWriter.enqueueRequest(e,t,r)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}e.ComplexOutlineFillMeshWriter=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter":function(){define(["exports","../../../../../../../geometry/GeometryCursor","../../../mesh/templates/templateUtils","./FillMeshWriter","./meshWriterUtils","../line/LineMeshWriter","../mesh/utils","../shaders/constants","../../../../../../webgl/enums"],function(e,t,r,s,i,n,o,a,l){"use strict";const c={createComputedParams:e=>e,optionalAttributes:n.LineVertexSpec.optionalAttributes,attributes:{...n.LineVertexSpec.attributes,bitset:{type:l.DataType.UNSIGNED_BYTE,count:1,pack:e=>0},color:{type:l.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>i.processColorInput(e)}}},u={createComputedParams:e=>e,optionalAttributes:n.LineVertexSpec.optionalAttributes,attributes:{...n.LineVertexSpec.attributes,bitset:{type:l.DataType.UNSIGNED_BYTE,count:1,pack:e=>i.packBitset([[a.bitsetTypeFillOutline,!0],[a.bitsetOutlineUsesColorVV,e.outlineUsesColorVV]])},color:{type:l.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>i.processColorInput(e)}}};class h extends n.LineMeshWriter{constructor(){super(...arguments),this.vertexSpec=u}}class d extends s.FillMeshWriter{constructor(e,t,r,s){super(e,t,r,s),this.vertexSpec=c,this._lineMeshWriter=this._createOutlineWriter(e,t,r,s)}_createOutlineWriter(e,t,r,s){return new h(e,t,r,s)}_write(e,t){const r=this.evaluatedMeshParams.effects,s=this.evaluatedMeshParams.outlineEffects;if(r?.length||s?.length){if(r?.length){const s=this.getEffectCursor(e,t,r);if(s){let r;for(;r=s?.next();)r.invertY(),this._writeFill(e,t,r)}}else this._writeFill(e,t);if(s?.length){const r=this.getEffectCursor(e,t,s);if(r){let s;for(;s=r?.next();)s.invertY(),this._writeOutline(e,t,s)}}else this._writeOutline(e,t)}else this._writeSimpleOutlineFill(e,t)}_writeSimpleOutlineFill(e,r){const s=r.readGeometryForDisplay(),i=this._clip(s);i&&(this._writeGeometry(e,r,i),this._lineMeshWriter.writeLineVertices(e,t.GeometryCursor.fromOptimizedCIM(i,"esriGeometryPolyline"),r))}_writeFill(e,t,r){const s=r?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(s);i&&this._writeGeometry(e,t,i)}_writeOutline(e,r,s){const i=s?.asOptimized()??r.readGeometryForDisplay(),n=this._clip(i);n&&this._lineMeshWriter.writeLineVertices(e,t.GeometryCursor.fromOptimizedCIM(n,"esriGeometryPolyline"),r)}_clip(e){return e?r.clipMarshall(e,o.getLineClippingMargin(this.evaluatedMeshParams)):null}get effectInfos(){return[...this._evaluator.inputMeshParams.effects?.effectInfos??[],...this._evaluator.inputMeshParams.outlineEffects?.effectInfos??[]]}write(e,t,r,s,i){this.ensurePacked(t,r,s),e.recordStart(this.instanceId,this.attributeLayout),this._write(e,r),e.recordEnd()}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._lineMeshWriter.ensurePacked(e,t,r)}enqueueRequest(e,t,r){super.enqueueRequest(e,t,r),this._lineMeshWriter.enqueueRequest(e,t,r)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}get hasEffects(){return!!this.evaluatedMeshParams.outlineEffects}}e.OutlineFillMeshWriter=d,e.OutlineFillOutlineMeshWriter=h,e.outlineFillVertexSpec_Fill=c,e.outlineFillVertexSpec_Outline=u,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientFillMeshWriter":function(){define(["exports","../../../definitions","./AFillMeshWriter","./FillMeshWriter","./gradientFillConstants","./GradientSizeHelper","./meshWriterUtils","../../../../../../webgl/enums"],function(e,t,r,s,i,n,o,a){"use strict";const l={createComputedParams:e=>e,optionalAttributes:s.fillVertexSpec.optionalAttributes,attributes:{...s.fillVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({gradientSizeUnits:e,gradientType:t})=>{let r=0;return 1===e&&(r|=o.getBitMask(i.bitset.isAbsolute)),"discrete"===t.toLowerCase()&&(r|=o.getBitMask(i.bitset.isDiscrete)),r}},tlbr:{count:4,type:a.DataType.UNSIGNED_SHORT,pack:({sprite:e})=>{const{rect:r,width:s,height:i}=e,n=r.x+t.spritePadding+t.gradientTextureExternalPadding,o=r.y+t.spritePadding;return[n,o,n+s-2*t.gradientTextureExternalPadding,o+i]}},relativePosition:{count:2,type:a.DataType.HALF_FLOAT,packTessellation:({gradientStats:e},t,r,s)=>e?.getRelativePosition(r,s)??[0,0]},relativeGradientSize:{count:2,type:a.DataType.HALF_FLOAT,packTessellation:({gradientStats:e})=>e?.relativeSize??[1,1]},gradientMethod:{count:1,type:a.DataType.UNSIGNED_BYTE,pack:({gradientMethod:e})=>{switch(e.toLowerCase()){case"rectangular":return i.gradientFillMethods.rectangular;case"circular":return i.gradientFillMethods.circular;default:return i.gradientFillMethods.linear}}}}};class c extends r.AFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=l}get _preventEffectClipping(){return!0}createTesselationParams(e){return{gradientStats:n.getGradientSizeHelper(this._unclippedGeometry,this.evaluatedMeshParams)}}_write(e,t,r){const s=r?.asOptimized()??t.readGeometryForDisplay();this._unclippedGeometry=s;const i=this._clip(s);if(!i)return void(this._unclippedGeometry=null);const n=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(e,t,i),this._unclippedGeometry=null,e.recordEnd()}}e.GradientFillMeshWriter=c,e.gradientFillVertexSpec=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/gradientFillConstants":function(){define(["exports"],function(e){"use strict";e.bitset={isAbsolute:0,isDiscrete:1},e.gradientFillMethods={linear:0,rectangular:1,circular:2},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/GradientSizeHelper":function(){define(["exports","../../../../../../../core/Logger","../../../../../../../core/mathUtils","../../../../../../../core/screenUtils"],function(e,t,r,s){"use strict";class i{constructor(e,t){this._size=e,this._sizeUnits=t,this._relativeSize=null}get relativeSize(){return this._relativeSize??=this.calculateRelativeSize(),this._relativeSize}calculateRelativeSize(){if(0===this._sizeUnits){const e=Math.min(this._size/100,1);return[e,e]}return this.calculateRelativeSizeFromAbsolute()}}class n extends i{constructor(e,t,r,s){super(t,r),this.rotationMatrix00=1,this.rotationMatrix01=0,this.rotationMatrix10=0,this.rotationMatrix11=1,this.bounds={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0},this.rotationMatrix00=Math.cos(s),this.rotationMatrix01=-Math.sin(s),this.rotationMatrix10=-this.rotationMatrix01,this.rotationMatrix11=this.rotationMatrix00;const{bounds:i,rotationMatrix00:n,rotationMatrix01:o,rotationMatrix10:a,rotationMatrix11:l}=this;e.forEachVertex((e,t)=>{const r=e*n+t*o,s=e*a+t*l;i.xmin=Math.min(i.xmin,r),i.ymin=Math.min(i.ymin,s),i.xmax=Math.max(i.xmax,r),i.ymax=Math.max(i.ymax,s)}),this.center=[(i.xmin+i.xmax)/2,(i.ymin+i.ymax)/2]}}class o extends n{constructor(e,t,r,s){super(e,t,r,s),this.method="linear"}getRelativePosition(e,t){const{rotationMatrix00:r,rotationMatrix01:s,bounds:i}=this,{xmin:n,xmax:o}=i;return[(e*r+t*s-n)/(o-n),0]}calculateRelativeSizeFromAbsolute(){const{_size:e,bounds:t}=this,{xmin:r,xmax:i}=t;return[s.pt2px(e)/(i-r),0]}}class a extends n{constructor(e,t,r,s){super(e,t,r,s),this.method="rectangular"}getRelativePosition(e,t){const{bounds:r,center:s,rotationMatrix00:i,rotationMatrix01:n,rotationMatrix10:o,rotationMatrix11:a}=this,l=e*o+t*a,c=e*i+t*n-s[0],u=l-s[1];return[c*(2/(r.xmax-r.xmin)),-u*(2/(r.ymax-r.ymin))]}calculateRelativeSizeFromAbsolute(){const{_size:e,bounds:t}=this,{xmin:r,ymin:i,xmax:n,ymax:o}=t;return[s.pt2px(2*e)/(n-r),s.pt2px(2*e)/(o-i)]}}class l extends n{constructor(e,t,r){super(e,t,r,0),this.method="circular";const{xmin:s,xmax:i,ymin:n,ymax:o}=this.bounds,a=i-s,l=o-n;this.radius=Math.sqrt(a*a+l*l)/2}getRelativePosition(e,t){const{center:r,radius:s}=this;return[(e-r[0])/s,-(t-r[1])/s]}calculateRelativeSizeFromAbsolute(){const{_size:e}=this;return[s.pt2px(e)/this.radius,0]}}e.AGradientSizeHelper=i,e.getGradientSizeHelper=function(e,s){if(null==e)return null;const i=r.deg2rad(s.angle),n=s.gradientSize,c=s.gradientSizeUnits;switch(s.gradientMethod.toLowerCase()){case"linear":return new o(e,n,c,i);case"rectangular":return new a(e,n,c,i);case"circular":return new l(e,n,c);default:return t.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.fill.GradientSizeHelper").errorOnce(`Gradient fill method "${s.gradientMethod}" currently unsupported.`),null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter":function(){define(["exports","./OutlineFillMeshWriter","./PatternFillMeshWriter"],function(e,t,r){"use strict";const s={optionalAttributes:r.patternFillVertexSpec.optionalAttributes,createComputedParams:e=>e,attributes:{...r.patternFillVertexSpec.attributes,...t.outlineFillVertexSpec_Fill.attributes}},i={optionalAttributes:r.patternFillVertexSpec.optionalAttributes,createComputedParams:e=>e,attributes:{...r.patternFillVertexSpec.attributes,...t.outlineFillVertexSpec_Outline.attributes}};class n extends t.OutlineFillOutlineMeshWriter{constructor(){super(...arguments),this.vertexSpec=i}}class o extends t.OutlineFillMeshWriter{constructor(){super(...arguments),this.vertexSpec=s}_createOutlineWriter(e,t,r,s){return new n(e,t,r,s)}write(e,t,r,s,i){this.ensurePacked(t,r,s);const n=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,n),this._write(e,r),e.recordEnd()}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._lineMeshWriter.ensurePacked(e,t,r)}enqueueRequest(e,t,r){super.enqueueRequest(e,t,r),this._lineMeshWriter.enqueueRequest(e,t,r)}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()])}}e.PatternOutlineFillMeshWriter=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter":function(){define(["exports","../mesh/MeshWriter","../../../../../../webgl/enums"],function(e,t,r){"use strict";const s={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:r.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:r.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:r.DataType.UNSIGNED_BYTE,count:1},offset:{type:r.DataType.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class i extends t.MeshWriter{constructor(){super(...arguments),this.vertexSpec=s}_write(e,t){e.recordStart(this.instanceId,this.attributeLayout);const r=t.getDisplayId();if("esriGeometryPoint"===t.geometryType){const s=t.readXForDisplay(),i=t.readYForDisplay();this._writeQuad(e,r,s,i)}else if("esriGeometryMultipoint"===t.geometryType){const s=t.readGeometryForDisplay();s?.forEachVertex((t,s)=>{t>=0&&t<=512&&s>=0&&s<=512&&this._writeQuad(e,r,t,s)})}e.recordEnd()}_writeQuad(e,t,r,s){const i=e.vertexCount();this._writeVertex(e,t,r,s),e.indexWrite(i+0),e.indexWrite(i+1),e.indexWrite(i+2),e.indexWrite(i+1),e.indexWrite(i+3),e.indexWrite(i+2)}}e.HeatmapMeshWriter=i,e.heatmapVertexSpec=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/labels/LabelMeshWriter":function(){define(["exports","../../../../../../../core/MapUtils","../../../../../../../core/screenUtils","../../../../../../../core/string","../../../../../../../core/libs/gl-matrix-2/math/mat2d","../../../../../../../core/libs/gl-matrix-2/factories/mat2df32","../../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../../core/libs/gl-matrix-2/factories/vec2f32","../../../../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../../../../geometry/GeometryCursor","../../../../../../../layers/graphics/featureConversionUtils","../../../../../../../layers/graphics/OptimizedGeometry","../../../definitions","../../../collisions/BoundingBox","../../../collisions/LabelMetric","../../../mesh/templates/segmentUtils","../fill/meshWriterUtils","../text/TextMeshWriter"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y){"use strict";function _(e,t){return s.numericHash(`${e}${t}`)}function b(e,t,r){return s.numericHash(`${e}${t}${r}`)}function S(e,t,r,i){const n=r*2**(y.maxLabelZoom-i);return s.numericHash(`${e}${t}${n}`)}function x(e,t,r,i,n){const o=r*2**(y.maxLabelZoom-i);return s.numericHash(`${e}${n}${t}${o}`)}const w=t.memoize(e=>{let t=0;if(0===e)return 1/0;for(;!(e%2);)t++,e/=2;return t});class v extends y.TextMeshWriter{constructor(){super(...arguments),this._zoomLevel=0}_write(e,t,r,s){if(this._zoomLevel=s||0,null!=r)throw new Error("InternalError: EffectGeometry not support for LabelMeshWriter");switch(t.geometryType){case"esriGeometryPoint":{const r=t.readXForDisplay(),s=t.readYForDisplay();this._writePoint(e,r,s,0,t);break}case"esriGeometryEnvelope":case"esriGeometryPolygon":{const r=t.readCentroidForDisplay();if(!r)return;const[s,i]=r.coords;this._writePoint(e,s,i,0,t);break}case"esriGeometryMultipoint":{let r=0;const s=c.GeometryCursor.fromFeatureSetReader(t);if(s?.nextPath())for(;s.nextPoint();)this._writePoint(e,s.x,s.y,r++,t);break}case"esriGeometryPolyline":this._writeLines(e,t)}}_getMetricDir(){const{horizontalAlignment:e,verticalAlignment:t}=this.evaluatedMeshParams;return["center"===e?0:"right"===e?-1:1,"middle"===t?0:"bottom"===t?-1:1]}_createLineLabelMetric(e,t,r,s,i,n){const[o,a]=this._getMetricDir(),l=this.evaluatedMeshParams.scaleInfo?.maxScale??0,c=this.evaluatedMeshParams.scaleInfo?.minScale??0,u=this.evaluatedMeshParams.labelClassId;return new f.LabelMetric(e,u,t,r,s,i,o,a,l,c,n)}_writePoint(e,t,r,s,i){if(t<0||t>d.tileSize||r<0||r>d.tileSize)return;const n=this._getShaping();if(!n)return;const o=i.getDisplayId(),a=this.evaluatedMeshParams.labelClassId,l=_(i.getObjectId(),s),c=b(i.getObjectId(),a,s),[u,h]=this._getMetricDir(),p=this.evaluatedMeshParams.scaleInfo?.maxScale??0,m=this.evaluatedMeshParams.scaleInfo?.minScale??0,g=this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0};e.metricStart(new f.LabelMetric(o,a,l,c,t,r,u,h,p,m,g)),this._writeGlyphs(e,o,t,r,n,0,g,void 0,!1),e.metricBoxWrite(n.boundsT),e.metricEnd()}_getPointReferenceBounds(){if(!this._references)return null;for(const e of this._references){const t=e.getBoundsInfo();if(t)return t}return null}_writeLines(e,t){const{scaleInfo:r,verticalAlignment:s}=this.evaluatedMeshParams,i=this.evaluatedMeshParams.repeatLabelDistance||128,n=this._getShaping("middle");if(!n)return;const o=(e,t,r,s)=>this._placeSubdivGlyphs(e,t,r,s),a=(n.bounds.width+i)/2;this._current={out:e,id:t.getDisplayId(),objId:t.getObjectId(),shaping:n,zoomRange:g.getMinMaxZoom(r,this.getTileInfo()),referenceBounds:this._getPointReferenceBounds()||{offsetX:0,offsetY:0,size:0},offsetDirection:null,pathIndex:0},this._verticalPlacement="bottom"===s?"above":"top"===s?"below":null,this._verticalPlacement?this._writeAboveAndBelowAlong(t,o,a):this._writeCenterAlong(t,o,a)}_writeAboveAndBelowAlong(e,t,r){const{repeatLabel:s}=this.evaluatedMeshParams,{shaping:i}=this._current,n=i.bounds.halfHeight,o=e.readGeometryForDisplay();if(!o)return;const a=new h;u.generalizeOptimizedGeometry(a,o,!1,!1,"esriGeometryPolyline",1);const l=M(new h,a,n),c=M(new h,a,-n),d=u.convertToGeometry(c,"esriGeometryPolyline",!1,!1),p=u.convertToGeometry(l,"esriGeometryPolyline",!1,!1),f=m.smoothPaths(p.paths,i.bounds.width),g=m.smoothPaths(d.paths,i.bounds.width);this._current.offsetDirection="above";for(let e=0;e<f.length;e++)this._current.pathIndex=e,m.pathDivide(f[e],r,t,!!s);this._current.offsetDirection="below";for(let e=0;e<g.length;e++)this._current.pathIndex=e,m.pathDivide(g[e],r,t,!!s)}_writeCenterAlong(e,t,r){const{repeatLabel:s}=this.evaluatedMeshParams,{shaping:i}=this._current,n=m.smoothPaths(e.readLegacyGeometryForDisplay().paths,i.bounds.width);for(let e=0;e<n.length;e++)this._current.pathIndex=e,m.pathDivide(n[e],r,t,!!s)}_placeSubdivGlyphs(e,t,r,s){const{allowOverrun:i,labelPosition:n,repeatLabelDistance:o}=this.evaluatedMeshParams,a=this._current.zoomRange[0],l=w(t),c=this._current.shaping.bounds.width/2,u=Math.sqrt(o||128)/2,h=Math.min(r,s-r),d=this._current.shaping.isMultiline?y.maxLabelZoom:Math.log2(h/(u+c/2)),p=0===t?d:Math.min(l,d),f=Math.max(a,this._zoomLevel+1-p),m=this._zoomLevel-f,g=this._current.shaping.bounds.width/2*2**m,_=S(this._current.objId,this._current.pathIndex,t,this._zoomLevel),b=x(this._current.objId,this._current.pathIndex,t,this._zoomLevel,this.evaluatedMeshParams.labelClassId);this._current.shaping.isMultiline?0===t&&this._placeStraight(e,f,_,b):i&&m<0?this._placeStraightAlong(e,a,_,b):"parallel"===n?this._placeStraightAlong(e,f,_,b):"curved"===n&&this._placeCurved(e,f,g,_,b)}_placeStraight(e,t,r,s){const{out:i,id:n,shaping:o,referenceBounds:a}=this._current,{x:l,y:c}=e;i.metricStart(this._createLineLabelMetric(n,r,s,l,c)),i.metricBoxWrite(o.boundsT);const u=e.angle*(180/Math.PI)%360,h=(e.angle*(180/Math.PI)+180)%360,d={clipAngle:u,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(i,n,l,c,o,0,a,d,!1);const p={clipAngle:h,mapAligned:!0,isLineLabel:!0,minZoom:t};this._writeGlyphs(i,n,l,c,o,0,a,p,!1),i.metricEnd()}_placeCurved(e,t,r,s,i){const{out:n,id:o}=this._current;n.metricStart(this._createLineLabelMetric(o,s,i,e.x,e.y));const a=e.clone(),l=e.angle*(180/Math.PI)%360,c=(e.angle*(180/Math.PI)+180)%360;this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||(this._placeFirst(a,t,1,l),this._placeBack(e,a,t,r,1,l),this._placeForward(e,a,t,r,1,l)),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||(this._placeFirst(a,t,0,c),this._placeBack(e,a,t,r,0,c),this._placeForward(e,a,t,r,0,c)),n.metricEnd()}_placeStraightAlong(e,t,s,o){const{out:l,id:c,shaping:u,zoomRange:h,referenceBounds:d}=this._current,{boxBorderLineColor:p,boxBackgroundColor:f}=this.evaluatedMeshParams,m=e.clone(),g=e.angle*(180/Math.PI)%360,_=(e.angle*(180/Math.PI)+180)%360,b=u.glyphs.length>0&&!(!p&&!f);if(l.metricStart(this._createLineLabelMetric(c,s,o,e.x,e.y)),b){const s=Math.max(t,h[0],0),o=Math.min(y.maxLabelZoom,h[1]),p=i.fromRotation(n.create(),-e.angle),f={minZoom:s,maxZoom:o,clipAngle:g,mapAligned:!0,isLineLabel:!0},m=r.pt2px(this.evaluatedMeshParams.offsetX),b=r.pt2px(this.evaluatedMeshParams.offsetY);if(!this._verticalPlacement||this._verticalPlacement===this._current.offsetDirection){const t=a.fromValues(m,-1*b),[r,s]=u.shapeBackground(i.translate(n.create(),p,t));l.recordStart(this.instanceId,this.attributeLayout,u.glyphs[0].textureBinding),this._writeTextBox(l,c,e.x,e.y,s,d,f),l.recordEnd()}if(!this._verticalPlacement||this._verticalPlacement!==this._current.offsetDirection){const t=a.fromValues(m,b),[r,s]=u.shapeBackground(i.translate(n.create(),p,t));f.clipAngle=_,l.recordStart(this.instanceId,this.attributeLayout,u.glyphs[0].textureBinding),this._writeTextBox(l,c,e.x,e.y,s,d,f),l.recordEnd()}}this._verticalPlacement&&this._verticalPlacement!==this._current.offsetDirection||this._placeFirst(m,t,1,g,!0),this._verticalPlacement&&this._verticalPlacement===this._current.offsetDirection||this._placeFirst(m,t,0,_,!0),l.metricEnd()}_placeBack(e,t,r,s,i,n){const o=e.clone();let a=e.backwardLength+0;for(;o.prev()&&!(a>=s);)this._placeOnSegment(o,t,a,r,-1,i,n),a+=o.length+0}_placeForward(e,t,r,s,i,n){const o=e.clone();let a=e.remainingLength+0;for(;o.next()&&!(a>=s);)this._placeOnSegment(o,t,a,r,1,i,n),a+=o.length+0}_placeFirst(e,t,s,l,c=!1){const{out:u,id:h,shaping:d,zoomRange:f,referenceBounds:m}=this._current,g=d.glyphs,_=r.pt2px(this.evaluatedMeshParams.offsetX),b=r.pt2px(this.evaluatedMeshParams.offsetY),S=a.fromValues(_,b),x=i.fromRotation(n.create(),-e.angle);o.transformMat2d(S,S,x);for(const r of g){const i=r.x>d.bounds.x?s:1-s,n=i*e.remainingLength+(1-i)*e.backwardLength,o=Math.abs(r.x+r.width/2-d.bounds.x),a=Math.max(0,this._zoomLevel+Math.log2(o/(n+0))),g=Math.max(t,c?0:a);if(r.maxZoom=Math.min(f[1],y.maxLabelZoom),r.angle=e.angle+(1-s)*Math.PI,r.minZoom=Math.max(f[0],g),this._writeLineGlyph(u,h,e.x,e.y,r,l,m,!0),(s||this._current.offsetDirection)&&this._isVisible(r.minZoom,r.maxZoom)){const e=new p(r.bounds.x+S[0],r.bounds.y+S[1],r.bounds.width,r.bounds.height);u.metricBoxWrite(e)}}}_placeOnSegment(e,t,s,l,c,u,h){const{out:d,id:f,shaping:m,referenceBounds:g}=this._current,y=m.glyphs,_=e.dx/e.length,b=e.dy/e.length,S={x:e.x+s*-c*_,y:e.y+s*-c*b},x=r.pt2px(this.evaluatedMeshParams.offsetX),w=r.pt2px(this.evaluatedMeshParams.offsetY),v=a.fromValues(x,w),M=i.fromRotation(n.create(),-e.angle);o.transformMat2d(v,v,M);for(const t of y){const r=t.x>m.bounds.x?u:1-u;if(!(r&&1===c||!r&&-1===c))continue;const i=Math.abs(t.x+t.width/2-m.bounds.x),n=Math.max(0,this._zoomLevel+Math.log2(i/s)-.1),o=Math.max(l,this._zoomLevel+Math.log2(i/(s+e.length+0)));if(0!==n&&(t.angle=e.angle+(1-u)*Math.PI,t.minZoom=o,t.maxZoom=n,this._writeLineGlyph(d,f,S.x,S.y,t,h,g,!0),(u||this._current.offsetDirection)&&this._isVisible(t.minZoom,t.maxZoom))){const e=new p(t.bounds.x+v[0],t.bounds.y+v[1],t.bounds.width,t.bounds.height);d.metricBoxWrite(e)}}}_writeLineGlyph(e,t,r,s,i,n,o,a){if(r<0||r>d.tileSize||s<0||s>d.tileSize)return;e.recordStart(this.instanceId,this.attributeLayout,i.textureBinding);const{texcoords:l,offsets:c}=i,{fontSize:u,haloSize:h,outlineSize:p}=this._textMeshTransformProps;this._writeQuad(e,t,r,s,{texcoords:l,offsets:c,fontSize:u,haloSize:h,outlineSize:p,color:g.processColorInput(this.evaluatedMeshParams.color),isBackground:!1,referenceBounds:o,minZoom:Math.max(this._current.zoomRange[0],i.minZoom),maxZoom:Math.min(this._current.zoomRange[1],i.maxZoom),clipAngle:n,mapAligned:a,isLineLabel:!0}),e.recordEnd()}_packedZoom(e){return Math.floor(e*d.minMaxZoomPrecisionFactor)/d.minMaxZoomPrecisionFactor}_isVisible(e,t){let r=Math.max(this._current.zoomRange[0],e),s=Math.min(this._current.zoomRange[1],t);r=this._packedZoom(r),s=this._packedZoom(s);const i=this._packedZoom(this._zoomLevel);return r<=i&&i<=s}}function M(e,t,r){const{coords:s,lengths:i}=t,n=l.create(),a=l.create(),c=l.create(),u=l.create(),h=l.create(),d=l.create();let p=0;for(let t=0;t<i.length;t++){const l=i[t];for(let t=0;t<l;t++){const i=2*(t+p-1),f=2*(t+p),m=2*(t+p+1);t>0?o.set(n,s[i],s[i+1]):o.set(n,0,0),o.set(a,s[f],s[f+1]),t<l-1?o.set(c,s[m],s[m+1]):o.set(c,0,0),0===t?o.set(u,0,0):(o.sub(u,a,n),o.normalize(u,u),o.set(u,u[1],-u[0])),t===l-1?o.set(h,0,0):(o.sub(h,c,a),o.normalize(h,h),o.set(h,h[1],-h[0])),o.add(d,u,h),o.normalize(d,d);const g=d[0]*h[0]+d[1]*h[1];0!==g&&o.scale(d,d,g),o.scale(d,d,r),e.coords.push(a[0]+d[0],a[1]+d[1])}e.lengths.push(l),p+=l}return e}e.LabelMeshWriter=v,e.labelIdHash=_,e.labelMetricHash=b,e.lineLabelIdHash=S,e.lineLabelMetricHash=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/vec2f64":function(){define(["exports"],function(e){"use strict";function t(){return[0,0]}function r(e){return[e[0],e[1]]}function s(e,t){return[e,t]}function i(e,t){return[e,t]}function n(e,t=[0,0]){const r=Math.min(2,e.length);for(let s=0;s<r;++s)t[s]=e[s];return t}function o(){return[0,0]}function a(){return s(1,1)}function l(){return s(1,0)}function c(){return s(0,1)}const u=[0,0],h=a(),d=l(),p=c(),f=Object.freeze(Object.defineProperty({__proto__:null,ONES:h,UNIT_X:d,UNIT_Y:p,ZEROS:u,clone:r,create:t,freeze:i,fromArray:n,fromValues:s,ones:a,unitX:l,unitY:c,zeros:o},Symbol.toStringTag,{value:"Module"}));e.ONES=h,e.UNIT_X=d,e.UNIT_Y=p,e.ZEROS=u,e.clone=r,e.create=t,e.freeze=i,e.fromArray=n,e.fromValues=s,e.ones=a,e.unitX=l,e.unitY=c,e.vec2f64=f,e.zeros=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/featureConversionUtils":function(){define(["exports","../../core/Error","../../core/Logger","../../core/maybe","../../geometry/support/aaBoundingBox","../../geometry/support/aaBoundingRect","../../geometry/support/jsonUtils","./OptimizedFeature","./OptimizedFeatureSet","./OptimizedGeometry","./data/createFeatureId"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";function h(e,t){return e?t?4:3:t?3:2}const d=()=>r.getLogger("esri.layers.graphics.featureConversionUtils"),p={esriGeometryPoint:0,esriGeometryPolyline:2,esriGeometryPolygon:3,esriGeometryMultipoint:0,esriGeometryMultiPatch:3,esriGeometryEnvelope:0},f=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n},m=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[s+2]},g=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[s+3]},y=(e,t,r,s,i,n)=>{e[r]=i,e[r+1]=n,e[r+2]=t[s+2],e[r+3]=t[s+3]};function _(e,t,r,s){if(e){if(r)return t&&s?y:m;if(t&&s)return g}else if(t&&s)return m;return f}function b({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function S({scale:e,translate:t},r){return Math.round((t[1]-r)/e[1])}function x({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function w({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function v({scale:e,translate:t},r,s){return r*e[s]+t[s]}function M(e){const t=e.coords;return{x:t[0],y:t[1]}}function I(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e}function P(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2]}}function T(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e}function C(e){const t=e.coords;return{x:t[0],y:t[1],m:t[2]}}function F(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.m,e}function k(e){const t=e.coords;return{x:t[0],y:t[1],z:t[2],m:t[3]}}function A(e,t){return e.coords[0]=t.x,e.coords[1]=t.y,e.coords[2]=t.z,e.coords[3]=t.m,e}function O(e,t){return e&&t?A:e?T:t?F:I}function E(e,t,r,s,i){const n=O(r,s);for(const r of t){const t=null!=r.geometry?n(new c,r.geometry):null;e.push(new a.OptimizedFeature(t,r.attributes,null,u.createFeatureId(r,i)))}return e}function z(e,t,r=O(null!=t.z,null!=t.m)){return r(e,t)}function R(e,t,r,s){for(const{geometry:i,attributes:n}of t)e.push({attributes:n,geometry:null!=i?L(i,r,s):null});return e}function L(e,t,r){if(null==e)return null;const s=h(t,r),i=[];for(let t=0;t<e.coords.length;t+=s){const r=[];for(let i=0;i<s;i++)r.push(e.coords[t+i]);i.push(r)}return t?r?{points:i,hasZ:t,hasM:r}:{points:i,hasZ:t}:r?{points:i,hasM:r}:{points:i}}function D(e,t,r,s,i){const n=h(r,s);for(const r of t){const t=null!=r.geometry?N(new c,r.geometry,n):null;e.push(new a.OptimizedFeature(t,r.attributes,null,u.createFeatureId(r,i)))}return e}function N(e,t,r=h(t.hasZ,t.hasM)){e.lengths[0]=t.points.length;const s=e.coords;let i=0;for(const e of t.points)for(let t=0;t<r;t++)s[i++]=e[t];return e}function G(e,t,r){if(!e)return null;const s=h(t,r),{coords:i,lengths:n}=e,o=[];let a=0;for(const e of n){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(i[a++]);t.push(e)}o.push(t)}return t?r?{paths:o,hasZ:t,hasM:r}:{paths:o,hasZ:t}:r?{paths:o,hasM:r}:{paths:o}}function q(e,t,r,s,i){const n=h(r,s);for(const r of t){const t=null!=r.geometry?B(new c,r.geometry,n):null,s=null!=r.centroid?z(new c,r.centroid):null;e.push(new a.OptimizedFeature(t,r.attributes,s,u.createFeatureId(r,i)))}return e}function B(e,t,r=h(t.hasZ,t.hasM)){const{lengths:s,coords:i}=e;let n=0;for(const e of t.paths){for(const t of e)for(let e=0;e<r;e++)i[n++]=t[e];s.push(e.length)}return e}function U(e,t,r){if(!e)return null;const s=h(t,r),{coords:i,lengths:n}=e,o=[];let a=0;for(const e of n){const t=[];for(let r=0;r<e;r++){const e=[];for(let t=0;t<s;t++)e.push(i[a++]);t.push(e)}o.push(t)}return t?r?{rings:o,hasZ:t,hasM:r}:{rings:o,hasZ:t}:r?{rings:o,hasM:r}:{rings:o}}function j(e,t,r=t.hasZ,s=t.hasM){return V(e,t.rings,r,s)}function V(e,t,r,s){const i=h(r,s),{lengths:n,coords:o}=e;let a=0;re(e);for(const e of t){for(const t of e)for(let e=0;e<i;e++)o[a++]=t[e];n.push(e.length)}return e}const W=[],Y=[];function H(e,r,s,i,n,o){if(se(e),!s){for(const t of r){const r=u.createFeatureId(t,o);e.push(new a.OptimizedFeature(null,t.attributes,null,r))}return e}switch(s){case"esriGeometryPoint":return E(e,r,i,n,o);case"esriGeometryMultipoint":return D(e,r,i,n,o);case"esriGeometryPolyline":return q(e,r,i,n,o);case"esriGeometryPolygon":case"esriGeometryMultiPatch":return function(e,t,r,s,i){for(const n of t){const t=null!=n.geometry?j(new c,n.geometry,r,s):null,o=u.createFeatureId(n,i);null!=n.centroid?e.push(new a.OptimizedFeature(t,n.attributes,I(new c,n.centroid),o)):e.push(new a.OptimizedFeature(t,n.attributes,null,o))}return e}(e,r,i,n,o);default:d().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${s}'`)),se(e)}return e}function $(e,r,s,i){const n=e&&("coords"in e?e:e.geometry);if(null==n)return null;switch(r){case"esriGeometryPoint":{let e=M;return s&&i?e=k:s?e=P:i&&(e=C),e(n)}case"esriGeometryMultipoint":return L(n,s,i);case"esriGeometryPolyline":return G(n,s,i);case"esriGeometryPolygon":return U(n,s,i);default:return d().error("convertToGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${r}'`)),null}}function X(e,r,s,i,n){if(se(e),null==s)return function(e,t){for(const r of t)e.push({attributes:r.attributes});return e}(e,r);switch(s){case"esriGeometryPoint":return function(e,t,r,s){let i=M;r&&s?i=k:r?i=P:s&&(i=C);for(const r of t){const{geometry:t,attributes:s}=r,n=null!=t?i(t):null;e.push({attributes:s,geometry:n})}return e}(e,r,i,n);case"esriGeometryMultipoint":return R(e,r,i,n);case"esriGeometryPolyline":return function(e,t,r,s){for(const{geometry:i,attributes:n}of t)e.push({attributes:n,geometry:null!=i?G(i,r,s):null});return e}(e,r,i,n);case"esriGeometryPolygon":return function(e,t,r,s){for(const{geometry:i,attributes:n,centroid:o}of t){const t=null!=i?U(i,r,s):null;if(null!=o){const r=M(o);e.push({attributes:n,centroid:r,geometry:t})}else e.push({attributes:n,geometry:t})}return e}(e,r,i,n);default:d().error("convertToFeatureSet:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${s}'`))}return e}function Q(e,t,r,s,i,n,o=r,a=s){if(re(e),!t?.coords.length)return null;const l=p[i],{coords:c,lengths:u}=t,d=h(r,s),f=h(r&&o,s&&a),m=_(r,s,o,a);if(!u.length)return m(e.coords,c,0,0,b(n,c[0]),S(n,c[1])),re(e,d,0),e;let g,y,x,w,v=0,M=0,I=M;for(const t of u){if(t<l)continue;let r=0;M=I,x=g=b(n,c[v]),w=y=S(n,c[v+1]),m(e.coords,c,M,v,x,w),r++,v+=d,M+=f;for(let s=1;s<t;s++,v+=d)x=b(n,c[v]),w=S(n,c[v+1]),x===g&&w===y||(m(e.coords,c,M,v,x-g,w-y),M+=f,r++,g=x,y=w);r>=l&&(e.lengths.push(r),I=M)}return se(e.coords,I),e.coords.length?e:null}function Z(e,t,r,s){const i=e[t],n=e[t+1],o=e[r],a=e[r+1],l=e[s],c=e[s+1];let u=o,h=a,d=l-u,p=c-h;if(0!==d||0!==p){const e=((i-u)*d+(n-h)*p)/(d*d+p*p);e>1?(u=l,h=c):e>0&&(u+=d*e,h+=p*e)}return d=i-u,p=n-h,d*d+p*p}function J(e,t,r,s,i,n,o){let a,l=s,c=0;for(let e=n+r;e<o;e+=r)a=Z(t,e,n,o),a>l&&(c=e,l=a);l>s&&(c-n>r&&J(e,t,r,s,i,n,c),i(e,t,e.length,c,t[c],t[c+1]),o-c>r&&J(e,t,r,s,i,c,o))}function K(e,t,r,i,n){const{coords:o,lengths:a}=t,l=h(r,i);if(!o.length)return e!==t&&re(e),e;s.assertIsSome(n);const{originPosition:c,scale:u,translate:d}=n,p=ie;p.originPosition=c;const f=p.scale;f[0]=u[0]??1,f[1]=-(u[1]??1),f[2]=u[2]??1,f[3]=u[3]??1;const m=p.translate;if(m[0]=d[0]??0,m[1]=d[1]??0,m[2]=d[2]??0,m[3]=d[3]??0,!a.length){for(let t=0;t<l;++t)e.coords[t]=v(p,o[t],t);return e!==t&&re(e,l,0),e}let g=0;for(let t=0;t<a.length;t++){const r=a[t];e.lengths[t]=r;for(let t=0;t<l;++t)e.coords[g+t]=v(p,o[g+t],t);let s=e.coords[g],i=e.coords[g+1];g+=l;for(let t=1;t<r;t++,g+=l){s+=o[g]*f[0],i+=o[g+1]*f[1],e.coords[g]=s,e.coords[g+1]=i;for(let t=2;t<l;++t)e.coords[g+t]=v(p,o[g+t],t)}}return e!==t&&re(e,o.length,a.length),e}function ee(e,t,r,s){let i=0,n=e[s*t],o=e[s*(t+1)];for(let a=1;a<r;a++){const r=n+e[s*(t+a)],l=o+e[s*(t+a)+1],c=(r-n)*(l+o);n=r,o=l,i+=c}return.5*i}function te(e,t,r,s){return 0===e*s-r*t&&e*r+t*s>0}function re(e,t=0,r=0){se(e.lengths,r),se(e.coords,t)}function se(e,t=0){e.length!==t&&(e.length=t)}const ie={originPosition:"lowerLeft",scale:[1,1,1,1],translate:[0,0,0,0]};e.convertFromFeature=function(e,t,r,s,i){W[0]=e;const[n]=H(Y,W,t,r,s,i);return se(W),se(Y),n},e.convertFromFeatureSet=function(e,t){const r=new l,{hasM:s,hasZ:i,features:n,spatialReference:o,geometryType:a,exceededTransferLimit:c,transform:u,fields:h}=e;return h&&(r.fields=h),r.geometryType=a??null,r.spatialReference=o??null,n&&H(r.features,n,a,i,s,t),c&&(r.exceededTransferLimit=c),s&&(r.hasM=s),i&&(r.hasZ=i),u&&(r.transform=u),r},e.convertFromFeatures=H,e.convertFromGeometry=function(e,r,s){if(null==e)return null;const i=new c;return"hasZ"in e&&null==r&&(r=e.hasZ),"hasM"in e&&null==s&&(s=e.hasM),o.isPoint(e)?O(null!=r?r:null!=e.z,null!=s?s:null!=e.m)(i,e):o.isPolygon(e)?j(i,e,r,s):o.isPolyline(e)?B(i,e,h(r,s)):o.isMultipoint(e)?N(i,e,h(r,s)):void d().error("convertFromGeometry:unknown-geometry",new t("internal:geometry",`Unable to parse unknown geometry type '${e}'`))},e.convertFromMultipoint=N,e.convertFromMultipointFeatures=D,e.convertFromNestedArray=V,e.convertFromPoint=z,e.convertFromPointFeatures=E,e.convertFromPolygon=j,e.convertFromPolyline=B,e.convertFromPolylineFeatures=q,e.convertToFeature=function(e,t,r,s){Y[0]=e,X(W,Y,t,r,s);const i=W[0];return se(W),se(Y),i},e.convertToFeatureSet=function(e){const{spatialReference:t,transform:r,fields:s,hasM:i,hasZ:n,features:o,geometryType:a,exceededTransferLimit:l,queryGeometry:c,queryGeometryType:u}=e,h={features:X([],o,a,n,i),fields:s,geometryType:a,spatialReference:t,queryGeometry:$(c,u,!1,!1)};return r&&(h.transform=r),l&&(h.exceededTransferLimit=l),i&&(h.hasM=i),n&&(h.hasZ=n),h},e.convertToFeatures=X,e.convertToGeometry=$,e.convertToMultipoint=L,e.convertToMultipointFeatures=R,e.convertToPoint=function(e,t,r){return e?t?r?k(e):P(e):r?C(e):M(e):null},e.convertToPolygon=U,e.convertToPolyline=G,e.generalizeOptimizedGeometry=function(e,t,r,s,i,n,o=r,a=s){if(re(e),!t?.coords.length)return null;const l=p[i],{coords:c,lengths:u}=t,d=h(r,s),f=h(r&&o,s&&a),m=_(r,s,o,a);if(!u.length)return m(e.coords,c,0,0,c[0],c[1]),re(e,d,0),e;let g=0;const y=n*n;for(const t of u){if(t<l){g+=t*d;continue}const r=e.coords.length/f,s=g,i=g+(t-1)*d;m(e.coords,c,e.coords.length,s,c[s],c[s+1]),J(e.coords,c,d,y,m,s,i),m(e.coords,c,e.coords.length,i,c[i],c[i+1]);const n=e.coords.length/f-r;n>=l?e.lengths.push(n):se(e.coords,r*f),g+=t*d}return e.coords.length?e:null},e.getBoundsOptimizedGeometry=function(e,t,r,s){if(!t?.coords?.length)return null;const o=h(r,s);let a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(t&&t.coords){const e=t.coords;for(let t=0;t<e.length;t+=o){const r=e[t],s=e[t+1];a=Math.min(a,r),c=Math.max(c,r),l=Math.min(l,s),u=Math.max(u,s)}}return i.is(e)?i.fromRectValues(e,a,l,c,u):n.fromValues(a,l,c,u,e),e},e.getQuantizedArea=function(e,t){const{coords:r,lengths:s}=e;let i=0,n=0;for(let e=0;e<s.length;e++){const o=s[e];n+=ee(r,i,o,t),i+=o}return Math.abs(n)},e.getQuantizedBoundsOptimizedGeometry=function(e,t,r,s){const i=h(r,s),{lengths:n,coords:o}=t;let a=Number.POSITIVE_INFINITY,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,u=Number.NEGATIVE_INFINITY,d=0;for(const e of n){let t=o[d],r=o[d+1];a=Math.min(t,a),l=Math.min(r,l),c=Math.max(t,c),u=Math.max(r,u),d+=i;for(let s=1;s<e;s++,d+=i){const e=o[d],s=o[d+1];t+=e,r+=s,e<0&&(a=Math.min(a,t)),e>0&&(c=Math.max(c,t)),s<0?l=Math.min(l,r):s>0&&(u=Math.max(u,r))}}return e[0]=a,e[1]=l,e[2]=c,e[3]=u,e},e.getSignedQuantizedRingArea=ee,e.quantizeForDisplay=function(e,t,r,s,i){const n=h(s,i);if(!e.lengths.length){if(e.coords.length<2)return null;const[r,s]=e.coords,i=x(t,r),n=w(t,s);return new c([],[i,n])}const o=new c([],[0,0]),a=p[r],l="esriGeometryPolygon"===r||"esriGeometryPolyline"===r;let u=0,d=0;for(let r=0;r<e.lengths.length;r++){const s=e.lengths[r],i=d;let c=x(t,e.coords[n*u]),h=w(t,e.coords[n*u+1]);o.coords[d++]=c,o.coords[d++]=h;let p=0,f=0,m=1;for(let r=1;r<s;r++){const s=x(t,e.coords[n*(r+u)]),i=w(t,e.coords[n*(r+u)+1]);if(s!==c||i!==h){const e=s-c,t=i-h;l&&te(p,f,e,t)?(o.coords[d-2]+=e,o.coords[d-1]+=t,c+=e,h+=t):(o.coords[d++]=s,o.coords[d++]=i,c=s,h=i,p=e,f=t,m+=1)}}m<a?d=i:o.lengths.push(m),u+=s}return 0===o.lengths.length?null:o},e.quantizeOptimizedFeatureSet=function(e,t){const{geometryType:r,features:s,hasM:i,hasZ:n}=t;if(!e)return t;for(let t=0;t<s.length;t++){const o=s[t],a=o.weakClone();a.geometry=new c,Q(a.geometry,o.geometry,i,n,r,e),o.centroid&&(a.centroid=new c,Q(a.centroid,o.centroid,i,n,"esriGeometryPoint",e)),s[t]=a}return t.transform=e,t},e.quantizeOptimizedGeometry=Q,e.quantizeX=b,e.quantizeY=S,e.removeCollinearVertices=function(e,t,r,s,i){if(!t?.coords?.length)return null;const n=p[r],{coords:o,lengths:a}=t,l=_(s,i,s,i),c=h(s,i);let u=0,d=0,f=0,m=0;for(const t of a){d=m,l(e.coords,o,d,u,o[u],o[u+1]),u+=c;let r=o[u],s=o[u+1],i=r,a=s,h=s/r;d+=c,l(e.coords,o,d,u,i,a),u+=c;for(let n=2;n<t;n++){r=o[u],s=o[u+1];const t=s/r,n=h===t||!isFinite(h)&&!isFinite(t),p=n&&isFinite(t)?h>=0&&t>=0||h<=0&&t<=0:a>=0&&s>=0||a<=0&&s<=0;n&&p?(i+=r,a+=s):(i=r,a=s,d+=c),l(e.coords,o,d,u,i,a),u+=c,h=t}d+=c;const p=(d-m)/c;p>=n&&(e.lengths[f]=p,m=d,f++)}return e.coords.length>m&&(e.coords.length=m),e.lengths.length>f&&(e.lengths.length=f),e.coords.length&&e.lengths.length?e:null},e.removeZMValues=function(e,t,r,s,i,n){if(re(e),e.lengths.push(...t.lengths),r===i&&s===n)for(let r=0;r<t.coords.length;r++)e.coords.push(t.coords[r]);else{const o=h(r,s),a=_(r,s,i,n),l=t.coords;for(let t=0;t<l.length;t+=o)a(e.coords,l,e.coords.length,t,l[t],l[t+1])}return e},e.unquantizeOptimizedFeatureSet=function(e){const{transform:t,features:r,hasM:s,hasZ:i}=e;if(!t)return e;for(const e of r)null!=e.geometry&&K(e.geometry,e.geometry,s,i,t),null!=e.centroid&&K(e.centroid,e.centroid,s,i,t);return e.transform=null,e},e.unquantizeOptimizedGeometry=K,e.unquantizeValue=v,e.unquantizeX=function(e,t){return v(e,t,0)},e.unquantizeY=function(e,t){return v(e,-t,1)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../Extent","./aaBoundingRect","./DoubleArray"],function(e,t,r,s){"use strict";function i(e=m){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function n(e,t,r,s,n,o,a=i()){return a[0]=e,a[1]=t,a[2]=r,a[3]=s,a[4]=n,a[5]=o,a}function o(e,t,r,s=i()){return d(s,f),a(s,e,t,r),s}function a(e,t,r=0,s=t.length/3){let i=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];for(let e=0;e<s;e++)i=Math.min(i,t[r+3*e]),n=Math.min(n,t[r+3*e+1]),o=Math.min(o,t[r+3*e+2]),a=Math.max(a,t[r+3*e]),l=Math.max(l,t[r+3*e+1]),c=Math.max(c,t[r+3*e+2]);e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c}function l(e){return e[0]>=e[3]?0:e[3]-e[0]}function c(e){return e[1]>=e[4]?0:e[4]-e[1]}function u(e){return e[2]>=e[5]?0:e[5]-e[2]}function h(e,t){return Math.max(t[0],e[0])<=Math.min(t[3],e[3])&&Math.max(t[1],e[1])<=Math.min(t[4],e[4])&&Math.max(t[2],e[2])<=Math.min(t[5],e[5])}function d(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function p(e){return 6===e.length}const f=[1/0,1/0,1/0,-1/0,-1/0,-1/0],m=[0,0,0,0,0,0],g=i();e.allFinite=function(e){for(let t=0;t<6;t++)if(!isFinite(e[t]))return!1;return!0},e.center=function(e,t=[0,0,0]){return t[0]=e[0]+l(e)/2,t[1]=e[1]+c(e)/2,t[2]=e[2]+u(e)/2,t},e.contains=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[3]<=e[3]&&t[4]<=e[4]&&t[5]<=e[5]},e.containsPoint=function(e,t){return t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]&&t[0]<=e[3]&&t[1]<=e[4]&&t[2]<=e[5]},e.containsPointWithMargin=function(e,t,r){return t[0]>=e[0]-r&&t[1]>=e[1]-r&&t[2]>=e[2]-r&&t[0]<=e[3]+r&&t[1]<=e[4]+r&&t[2]<=e[5]+r},e.create=i,e.depth=c,e.diameter=function(e){const t=l(e),r=u(e),s=c(e);return Math.sqrt(t*t+r*r+s*s)},e.empty=function(e){return e?d(e,f):i(f)},e.equals=function(e,t,r){if(null==e||null==t)return e===t;if(!p(e)||!p(t))return!1;if(r){for(let s=0;s<e.length;s++)if(!r(e[s],t[s]))return!1}else for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0},e.expandWithAABB=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])},e.expandWithBuffer=a,e.expandWithNestedArray=function(e,t,r){const s=t.length;let i=e[0],n=e[1],o=e[2],a=e[3],l=e[4],c=e[5];if(r)for(let e=0;e<s;e++){const r=t[e];i=Math.min(i,r[0]),n=Math.min(n,r[1]),o=Math.min(o,r[2]),a=Math.max(a,r[0]),l=Math.max(l,r[1]),c=Math.max(c,r[2])}else for(let e=0;e<s;e++){const r=t[e];i=Math.min(i,r[0]),n=Math.min(n,r[1]),a=Math.max(a,r[0]),l=Math.max(l,r[1])}e[0]=i,e[1]=n,e[2]=o,e[3]=a,e[4]=l,e[5]=c},e.expandWithOffset=function(e,t,r,s){e[0]=Math.min(e[0],e[0]+t),e[3]=Math.max(e[3],e[3]+t),e[1]=Math.min(e[1],e[1]+r),e[4]=Math.max(e[4],e[4]+r),e[2]=Math.min(e[2],e[2]+s),e[5]=Math.max(e[5],e[5]+s)},e.expandWithRect=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[3]=Math.max(e[3],t[2]),e[4]=Math.max(e[4],t[3])},e.expandWithVec3=function(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])},e.fromBuffer=function(e,t=i()){return o(e,0,e.length/3,t)},e.fromExtent=function(e,t=i()){return t[0]=e.xmin,t[1]=e.ymin,t[2]=e.hasZ?e.zmin:-1/0,t[3]=e.xmax,t[4]=e.ymax,t[5]=e.hasZ?e.zmax:1/0,t},e.fromMinMax=function(e,t,r=i()){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=t[0],r[4]=t[1],r[5]=t[2],r},e.fromRect=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e},e.fromRectValues=function(e,t,r,s,i){return e[0]=t,e[1]=r,e[2]=Number.NEGATIVE_INFINITY,e[3]=s,e[4]=i,e[5]=Number.POSITIVE_INFINITY,e},e.fromSubBuffer=o,e.fromValues=n,e.getMax=function(e,t){return t[0]=e[3],t[1]=e[4],t[2]=e[5],t},e.getMin=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},e.height=u,e.intersects=h,e.intersectsClippingArea=function(e,t){return null==t||h(e,t)},e.intersectsSegment=function(e,t,r){let s=0,i=1;for(let n=0;n<3;++n){const o=e[n],a=e[n+3],l=t[n],c=r[n],u=c<l,h=u?c:l,d=u?l:c,p=Math.max(o,h),f=Math.min(a,d);if(p>f)return!1;if(d===h)break;const m=d-h,g=(p-h)/m,y=(f-h)/m;if(s=Math.max(s,u?1-y:g),i=Math.min(i,u?1-g:y),s>i)return!1}return!0},e.is=p,e.isPoint=function(e){return 0===l(e)&&0===c(e)&&0===u(e)},e.maximumDimension=function(e){return Math.max(l(e),u(e),c(e))},e.negativeInfinity=f,e.offset=function(e,t,r,s,i=e){return i[0]=e[0]+t,i[1]=e[1]+r,i[2]=e[2]+s,i[3]=e[3]+t,i[4]=e[4]+r,i[5]=e[5]+s,i},e.positiveInfinity=[-1/0,-1/0,-1/0,1/0,1/0,1/0],e.scale=function(e,t,r=e){const s=e[0]+l(e)/2,i=e[1]+c(e)/2,n=e[2]+u(e)/2;return r[0]=s+(e[0]-s)*t,r[1]=i+(e[1]-i)*t,r[2]=n+(e[2]-n)*t,r[3]=s+(e[3]-s)*t,r[4]=i+(e[4]-i)*t,r[5]=n+(e[5]-n)*t,r},e.set=d,e.setMax=function(e,t,r=e){return r[3]=t[0],r[4]=t[1],r[5]=t[2],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2]),e},e.setMin=function(e,t,r=e){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r!==e&&(r[3]=e[3],r[4]=e[4],r[5]=e[5]),r},e.size=function(e,t=[0,0,0]){return t[0]=l(e),t[1]=c(e),t[2]=u(e),t},e.toCorners=function(e,t=s.newDoubleArray(24)){const[r,i,n,o,a,l]=e;return t[0]=r,t[1]=i,t[2]=n,t[3]=r,t[4]=i,t[5]=l,t[6]=r,t[7]=a,t[8]=n,t[9]=r,t[10]=a,t[11]=l,t[12]=o,t[13]=i,t[14]=n,t[15]=o,t[16]=i,t[17]=l,t[18]=o,t[19]=a,t[20]=n,t[21]=o,t[22]=a,t[23]=l,t},e.toExtent=function(e,r){const s=isFinite(e[2])||isFinite(e[5]);return new t(s?{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],zmin:e[2],zmax:e[5],spatialReference:r}:{xmin:e[0],xmax:e[3],ymin:e[1],ymax:e[4],spatialReference:r})},e.toRect=function(e,t){return t||(t=r.create()),t[0]=e[0],t[1]=e[1],t[2]=e[3],t[3]=e[4],t},e.width=l,e.wrap=function(e,t,r,s,i,o){return n(e,t,r,s,i,o,g)},e.zero=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/DoubleArray":function(){define(["exports","../../core/typedArrayUtil"],function(e,t){"use strict";e.copyInto=function(e,t){for(let r=0;r<t.length;++r)e[r]=t[r];return e},e.doubleArrayFrom=function(e){return(t.isTypedArray(e)?e.byteLength/8:e.length)<=t.nativeArrayMaxSize?Array.from(e):new Float64Array(e)},e.doubleSubArray=function(e,t,r){return Array.isArray(e)?e.slice(t,t+r):e.subarray(t,t+r)},e.ensurePackedArray=function(e){return[...e]},e.newDoubleArray=function(e,r=!1){return e<=t.nativeArrayMaxSize?r?new Array(e).fill(0):new Array(e):new Float64Array(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeature":function(){define(["exports","../../core/memoryEstimations","./centroid","./OptimizedGeometry"],function(e,t,r,s){"use strict";class i{constructor(e=null,t={},r,s,i=0){this.geometry=e,this.attributes=t,this.centroid=r,this.objectId=s,this.displayId=i}static fromJSON(e){const t=e.geometry?s.fromJSON(e.geometry):null,r=e.centroid?s.fromJSON(e.centroid):null,n=e.objectId;return new i(t,e.attributes,r,n)}weakClone(){const e=new i(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),t=new i(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t}ensureCentroid(e){return this.centroid??=r.getCentroidOptimizedGeometry(new s,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+t.estimateAttributesMemory(this.attributes)+(this.geometry?.usedMemory??0)}}e.OptimizedFeature=i,e.OptimizedFeatureWithGeometry=class extends i{},e.hasGeometry=function(e){return!!e.geometry?.coords?.length},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,s,i,n,o){const a=t(n,o);let l=s,c=s+a,u=0,h=0,d=0,p=0,f=0;for(let t=0,s=i-1;t<s;t++,l+=a,c+=a){const t=r[l],s=r[l+1],i=r[l+2],o=r[c],a=r[c+1],m=r[c+2];let g=t*a-o*s;p+=g,u+=(t+o)*g,h+=(s+a)*g,n&&(g=t*m-o*i,d+=(i+m)*g,f+=g),t<e[0]&&(e[0]=t),t>e[1]&&(e[1]=t),s<e[2]&&(e[2]=s),s>e[3]&&(e[3]=s),n&&(i<e[4]&&(e[4]=i),i>e[5]&&(e[5]=i))}if(p>0&&(p*=-1),f>0&&(f*=-1),!p)return null;const m=[u,h,.5*p];return n&&(m[3]=d,m[4]=.5*f),m}function s(e,r,s,l,c){const u=t(l,c);let h=r,d=r+u,p=0,f=0,m=0,g=0;for(let t=0,r=s-1;t<r;t++,h+=u,d+=u){const t=e[h],r=e[h+1],s=e[h+2],c=e[d],u=e[d+1],y=e[d+2],_=l?n(t,r,s,c,u,y):i(t,r,c,u);if(_)if(p+=_,l){const e=a(t,r,s,c,u,y);f+=_*e[0],m+=_*e[1],g+=_*e[2]}else{const e=o(t,r,c,u);f+=_*e[0],m+=_*e[1]}}return p>0?l?[f/p,m/p,g/p]:[f/p,m/p]:s>0?l?[e[r],e[r+1],e[r+2]]:[e[r],e[r+1]]:null}function i(e,t,r,s){const i=r-e,n=s-t;return Math.sqrt(i*i+n*n)}function n(e,t,r,s,i,n){const o=s-e,a=i-t,l=n-r;return Math.sqrt(o*o+a*a+l*l)}function o(e,t,r,s){return[e+.5*(r-e),t+.5*(s-t)]}function a(e,t,r,s,i,n){return[e+.5*(s-e),t+.5*(i-t),r+.5*(n-r)]}e.getCentroidOptimizedGeometry=function(e,i,n,o){if(!i?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const a=e.coords,l=[],c=n?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:u,coords:h}=i,d=t(n,o);let p=0;for(const e of u){const t=r(c,h,p,e,n,o);t&&l.push(t),p+=e*d}if(l.sort((e,t)=>{let r=e[2]-t[2];return 0===r&&n&&(r=e[4]-t[4]),r}),l.length){let e=6*l[0][2];a[0]=l[0][0]/e,a[1]=l[0][1]/e,n&&(e=6*l[0][4],a[2]=0!==e?l[0][3]/e:0),(a[0]<c[0]||a[0]>c[1]||a[1]<c[2]||a[1]>c[3]||n&&(a[2]<c[4]||a[2]>c[5]))&&(a.length=0)}if(!a.length){const e=i.lengths[0]?s(h,0,u[0],n,o):null;if(!e)return null;a[0]=e[0],a[1]=e[1],n&&e.length>2&&(a[2]=e[2])}return e},e.lineCentroid=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/OptimizedFeatureSet":function(){define(function(){"use strict";class e{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const t=new e;return t.globalIdFieldName=this.globalIdFieldName,t.geohashFieldName=this.geohashFieldName,t.geometryProperties=this.geometryProperties,t.geometryType=this.geometryType,t.spatialReference=this.spatialReference,t.hasZ=this.hasZ,t.hasM=this.hasM,t.features=this.features,t.fields=this.fields,t.transform=this.transform,t.exceededTransferLimit=this.exceededTransferLimit,t.uniqueIdField=this.uniqueIdField,t.queryGeometry=this.queryGeometry,t.queryGeometryType=this.queryGeometryType,t}}return e})},"esri/layers/graphics/data/createFeatureId":function(){define(["exports"],function(e){"use strict";e.createFeatureId=function(e,t){switch(t.type){case"object-id":case"unique-id-simple":return e.attributes[t.fieldName];case"unique-id-composite":{const r=[];for(const s of t.fieldNames)r.push(e.attributes[s]??null);return JSON.stringify(r)}}},e.createFeatureIdFromLayer=function(e,t){if("uniqueIdFields"in t&&t.uniqueIdFields?.length){if(1===t.uniqueIdFields.length)return e.attributes?.[t.uniqueIdFields[0]];const r=t.uniqueIdFields.map(t=>e.attributes?.[t]);return JSON.stringify(r)}return"objectIdField"in t&&t.objectIdField?e.attributes?.[t.objectIdField]:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/collisions/LabelMetric":function(){define(["exports","../definitions","./BoundingBox","../util/serializationUtils"],function(e,t,r,s){"use strict";class i{constructor(e,t,r,s,i,n,o,a,l,c,u,h=[],d=0,p=0){this.displayId=e,this.labelClassId=t,this.labelIdHash=r,this.hash=s,this.anchorX=i,this.anchorY=n,this.directionX=o,this.directionY=a,this.maxScale=l,this.minScale=c,this.referenceBounds=u,this.bounds=h,this.recordStart=d,this.recordCount=p,this.priority=0,this._colliders=null,this.uniqueSymbol=null,this.selectedForRendering=!1}get xTile(){return this.anchorX}get yTile(){return this.anchorY}colliders(e){if(!this._colliders){const r=e.attributeView,s=t.labelPlacementOffsetPadding;let i=this.referenceBounds?.size??0;const n=e.layerView.labelingCollisionInfos[0].vvEvaluators[0];if(null!=n){const e=n(r.getVisualVariableData(this.displayId,0));i=isNaN(e)||null==e||e===1/0?i:e}const o=this.minScale?e.layerView.view.featuresTilingScheme.scaleToZoom(this.minScale):0,a=this.maxScale?e.layerView.view.featuresTilingScheme.scaleToZoom(this.maxScale):25,l=this.directionX*(s+i/2),c=this.directionY*(s+i/2);this._colliders=this.bounds.map(e=>({labelId:this.labelIdHash,xTile:this.anchorX,yTile:this.anchorY,dxPixels:e.x-e.halfWidth+l,dyPixels:e.y-e.halfHeight+c,hard:!0,partIndex:1,width:e.width+2,height:e.height+2,angle:0,xScreen:0,yScreen:0,dxScreen:0,dyScreen:0,enabled:!0,minLod:o,maxLod:a}))}return this._colliders}get id(){return this.displayId}serialize(e){e.push(this.displayId),e.push(this.labelClassId),e.push(this.labelIdHash),e.push(this.hash),e.push(this.recordStart),e.push(this.recordCount),e.writeF32(this.anchorX),e.writeF32(this.anchorY),e.writeF32(this.directionX),e.writeF32(this.directionY),e.writeF32(this.maxScale),e.writeF32(this.minScale),this.referenceBounds?(e.writeF32(this.referenceBounds.size),e.writeF32(this.referenceBounds.offsetX),e.writeF32(this.referenceBounds.offsetY)):(e.writeF32(0),e.writeF32(0),e.writeF32(0)),s.serializeList(e,this.bounds)}static deserialize(e){const t=e.readInt32(),n=e.readInt32(),o=e.readInt32(),a=e.readInt32(),l=e.readInt32(),c=e.readInt32(),u=e.readF32(),h=e.readF32(),d=e.readF32(),p=e.readF32(),f=e.readF32(),m=e.readF32(),g=e.readF32(),y=e.readF32(),_=e.readF32(),b=s.deserializeList(e,r)??[];return new i(t,n,o,a,u,h,d,p,f,m,{size:g,offsetX:y,offsetY:_},b,l,c)}}e.LabelMetric=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/mesh/templates/segmentUtils":function(){define(["exports","../../definitions"],function(e,t){"use strict";function r(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function s(e,t){return Math.sqrt(e*e+t*t)}function i(e){const t=s(e[0],e[1]);e[0]/=t,e[1]/=t}function n(e,t){return s(e[0]-t[0],e[1]-t[1])}function o(e,t){return e[t+1]}function a(e){return e.length-1}function l(e){let t=0;for(let r=0;r<a(e);r++)t+=c(e,r);return t}function c(e,t,r=1){let[s,i]=o(e,t);return[s,i]=[Math.round(s),Math.round(i)],Math.sqrt(s*s+i*i)*r}class u{constructor(e,t,r,s,i){this._segments=e,this._index=t,this._distance=r,this._xStart=s,this._yStart=i,this._done=!1}static create(e){return new u(e,0,0,e[0][0],e[0][1])}clone(){return new u(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(e){return this._index===e._index||e._index===this._index-1&&(0===this._distance||1===e._distance)||e._index===this._index+1&&(1===this._distance||0===e._distance)}leq(e){return this._index<e._index||this._index===e._index&&this._distance<=e._distance}geq(e){return this._index>e._index||this._index===e._index&&this._distance>=e._distance}get _segment(){return this._segments[this._index+1]}get angle(){const e=this.dy,t=(0*e+-1*-this.dx)/(1*this.length);let r=Math.acos(t);return e>0&&(r=2*Math.PI-r),r}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:e,dy:t}=this;return Math.sqrt(e*e+t*t)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<a(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(e,t){const r=this.backwardLength;if(e<=r)return this._distance=(r-e)/this.length,this;let s=this.backwardLength;for(;this.prev();){if(s+this.length>e)return this._seekBackwards(e-s);s+=this.length}return this._distance=0,t?this:null}seek(e,t=!1){if(e<0)return this._seekBackwards(Math.abs(e),t);if(e<=this.remainingLength)return this._distance=(this.backwardLength+e)/this.length,this;let r=this.remainingLength;for(;this.next();){if(r+this.length>e)return this.seek(e-r,t);r+=this.length}return this._distance=1,t?this:null}}function h(e,t,r,s,i){if(r<t)return;const n=s.clone().seek(r/2);if(null==n)return;e(n.clone(),r,i),r=(r-t)/2;const o=n.seek(t/2);h(e,t,r,s,i+1),h(e,t,r,o,i+1)}function d(e,t){const s=1e-6;if(t<=0)return;const o=e.length;if(o<3)return;const a=[];let l=0;a.push(0);for(let t=1;t<o;t++)l+=n(e[t],e[t-1]),a.push(l);t=Math.min(t,.2*l);const c=[];c.push(e[0][0]),c.push(e[0][1]);const u=e[o-1][0],h=e[o-1][1],d=r([0,0],e[0],e[1]);i(d),e[0][0]+=t*d[0],e[0][1]+=t*d[1],r(d,e[o-1],e[o-2]),i(d),e[o-1][0]+=t*d[0],e[o-1][1]+=t*d[1];for(let e=1;e<o;e++)a[e]+=t;a[o-1]+=t;const p=.5*t;for(let r=1;r<o-1;r++){let i=0,n=0,l=0;for(let o=r-1;o>=0&&!(a[o+1]<a[r]-p);o--){const c=p+a[o+1]-a[r],u=a[o+1]-a[o],h=a[r]-a[o]<p?1:c/u;if(Math.abs(h)<s)break;const d=h*h,f=h*c-.5*d*u,m=h*u/t,g=e[o+1],y=e[o][0]-g[0],_=e[o][1]-g[1];i+=m/f*(g[0]*h*c+.5*d*(c*y-u*g[0])-d*h*u*y/3),n+=m/f*(g[1]*h*c+.5*d*(c*_-u*g[1])-d*h*u*_/3),l+=m}for(let c=r+1;c<o&&!(a[c-1]>a[r]+p);c++){const o=p-a[c-1]+a[r],u=a[c]-a[c-1],h=a[c]-a[r]<p?1:o/u;if(Math.abs(h)<s)break;const d=h*h,f=h*o-.5*d*u,m=h*u/t,g=e[c-1],y=e[c][0]-g[0],_=e[c][1]-g[1];i+=m/f*(g[0]*h*o+.5*d*(o*y-u*g[0])-d*h*u*y/3),n+=m/f*(g[1]*h*o+.5*d*(o*_-u*g[1])-d*h*u*_/3),l+=m}c.push(i/l),c.push(n/l)}c.push(u),c.push(h);for(let t=0,r=0;t<o;t++)e[t][0]=c[r++],e[t][1]=c[r++]}e.SegmentCursor=u,e.pathDivide=function(e,r,s,i=!0){const n=l(e),o=u.create(e),a=n/2;if(!i)return o.seek(a),void(o.x<t.tileSize&&o.y<t.tileSize&&o.x>=0&&o.y>=0&&s(o.clone(),0,a+0*r,n));const c=Math.max((n-r)/2,0),h=Math.floor(c/r),d=a-h*r;o.seek(d);for(let e=-h;e<=h;e++)o.x<t.tileSize&&o.y<t.tileSize&&o.x>=0&&o.y>=0&&s(o.clone(),e,a+e*r,n),o.seek(r)},e.pathLength=l,e.pathSubdivide=function(e,t,r){h(r,t,l(e),u.create(e),0)},e.segmentAt=o,e.segmentCount=a,e.segmentLength=c,e.smoothPaths=function(e,t){const r=t;for(let t=0;t<e.length;t++){let s=e[t];d(s,r);const i=[];i.push(s[0]);for(let e=1;e<s.length;e++){const[t,r]=s[e-1],[n,o]=s[e],a=n-t,l=o-r;i.push([a,l])}e[t]=i,s=i}return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextMeshWriter":function(){define(["exports","../../../../../../../core/mathUtils","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper","../../../alignmentUtils","../../../definitions","../../../mesh/templates/shapingUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../shaders/constants","./TextParams","../../../../../../webgl/enums"],function(e,t,r,s,i,n,o,a,l,c,u,h,d){"use strict";const p=[4,4],f=[16,4],m={topLeft:f,topRight:f,bottomLeft:f,bottomRight:f},g=[4,2],y=[4,6],_={topLeft:g,topRight:g,bottomLeft:y,bottomRight:y},b={topLeft:g,topRight:y,bottomLeft:g,bottomRight:y},S={topLeft:y,topRight:y,bottomLeft:p,bottomRight:p},x={topLeft:p,topRight:p,bottomLeft:y,bottomRight:y},w={topLeft:y,topRight:p,bottomLeft:y,bottomRight:p},v={topLeft:p,topRight:y,bottomLeft:p,bottomRight:y},M={createComputedParams:e=>e,optionalAttributes:{zoomRange:{type:d.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:o.minMaxZoomPrecisionFactor,packTessellation:({minZoom:e,maxZoom:t})=>[e||0,t||28]},clipAngle:{type:d.DataType.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:e})=>P(e||0)},referenceSymbol:{type:d.DataType.BYTE,count:4,packPrecisionFactor:1,packTessellation:(e,t)=>{const s=e.isLineLabel||!e.referenceBounds,i=n.getXDirection(s?"center":t.horizontalAlignment),o=n.getYDirection(s?"middle":t.verticalAlignment),{offsetX:a,offsetY:l,size:c}=s?{offsetX:0,offsetY:0,size:0}:e.referenceBounds;return[r.pt2px(a),-r.pt2px(l),Math.round(r.pt2px(c)),i+1<<2|o+1]}},visibility:{type:d.DataType.FLOAT,count:1,otherSource:!0}},attributes:{pos:{type:d.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:d.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:d.DataType.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:e,mapAligned:t})=>l.packBitset([[u.bitsetTextIsBackground,e],[u.bitsetTextIsMapAligned,!!t]])},offset:{type:d.DataType.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:e})=>{const{bottomLeft:t,bottomRight:r,topLeft:s,topRight:i}=e;return[s,i,t,r]}}},textureUV:{type:d.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:e})=>{const{bottomLeft:t,bottomRight:r,topLeft:s,topRight:i}=e;return[s,i,t,r]}}},color:{type:d.DataType.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:e})=>e},fontAndReferenceSize:{type:d.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({fontSize:e},{referenceSize:t})=>[Math.round(r.pt2px(e)),Math.round(r.pt2px(t??e))]},outlineColor:{type:d.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>l.processColorInput(e)},haloColor:{type:d.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:e})=>l.processColorInput(e)},outlineAndHaloSize:{type:d.DataType.UNSIGNED_SHORT,count:2,packPrecisionFactor:4,packTessellation:({outlineSize:e,haloSize:t})=>[Math.round(r.pt2px(e)),Math.round(r.pt2px(t))]}}};class I extends c.MeshWriter{constructor(){super(...arguments),this.vertexSpec=M,this._textMeshParamsPropsInitialized=!1}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new h.TextMeshTransformProps(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0)}_write(e,t,r){const s=this._getShaping();if(!s)return;const i=t.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(e,t,s,r);if(r?.nextPath())return r.nextPoint(),this._writeGlyphs(e,i,r.x,r.y,s,0);if("esriGeometryPolygon"===t.geometryType){const r=t.readCentroidForDisplay();if(!r)return;const[n,o]=r.coords;return this._writeGlyphs(e,i,n,o,s,0)}if("esriGeometryMultipoint"===t.geometryType){const r=t.readGeometryForDisplay();return void r?.forEachVertex((t,r)=>this._writeGlyphs(e,i,t,r,s,0))}const n=t.readXForDisplay(),o=t.readYForDisplay();return this._writeGlyphs(e,i,n,o,s,0)}_writePlacedTextMarkers(e,t,n,o){const a=o??s.GeometryCursor.fromFeatureSetReaderCIM(t);if(!a)return;const l=i.CIMMarkerPlacementHelper.getPlacement(a,-1,this.evaluatedMeshParams.placement,r.pt2px(1),e.id);if(!l)return;const c=t.getDisplayId();let u=l.next();for(;null!=u;){const t=u.tx,r=-u.ty,s=-u.getAngle();this._writeGlyphs(e,c,t,r,n,s),u=l.next()}}_getShaping(e){const s=this._textMeshTransformProps,i=this.evaluatedMeshParams;if(!i.glyphs?.glyphs.length)return null;const n=r.pt2px(s.fontSize),l=r.pt2px(s.offsetX),c=r.pt2px(s.offsetY),u=t.clamp(r.pt2px(i.lineWidth),o.minTextLineWidth,o.maxTextLineWidth),h=o.magicLabelLineHeight*t.clamp(i.lineHeightRatio,.25,4);return a.shapeGlyphs(i.glyphs,{scale:n/o.glyphSize,angle:s.postAngle,xOffset:l,yOffset:c,horizontalAlignment:i.horizontalAlignment,verticalAlignment:e||i.verticalAlignment,maxLineWidth:u,lineHeight:h,decoration:i.decoration,borderLineSizePx:r.pt2px(i.boxBorderLineSize),hasBackground:!!i.boxBackgroundColor,useCIMAngleBehavior:i.useCIMAngleBehavior})}_writeGlyphs(e,t,s,i,n,o,a,c,u=!0){const h=this.evaluatedMeshParams,d=this._textMeshTransformProps,p=r.pt2px(d.fontSize),f=d.haloSize,m=d.outlineSize,g=r.pt2px(d.offsetX),y=r.pt2px(d.offsetY),[_,b]=l.getMinMaxZoom(h.scaleInfo,this.getTileInfo());0!==o&&n.setRotation(o);const S=n.bounds,x=s+S.x+g,w=i+S.y-y,v=2*(h.minPixelBuffer?h.minPixelBuffer/p:1),M=Math.max(S.width,S.height)*v;n.textBox&&(e.recordStart(this.instanceId,this.attributeLayout,n.glyphs[0].textureBinding),u&&e.recordBounds(x,w,M,M),this._writeTextBox(e,t,s,i,n.textBox,a,c),e.recordEnd());for(const r of n.glyphs){e.recordStart(this.instanceId,this.attributeLayout,r.textureBinding),u&&e.recordBounds(x,w,M,M);const{texcoords:n,offsets:o}=r;this._writeQuad(e,t,s,i,{texcoords:n,offsets:o,fontSize:p,haloSize:f,outlineSize:m,color:l.processColorInput(h.color),isBackground:!1,referenceBounds:a,minZoom:_,maxZoom:b,...c}),e.recordEnd()}0!==o&&n.setRotation(-o)}_writeTextBox(e,t,r,s,i,n,o){const a=this.evaluatedMeshParams,{fontSize:c,haloSize:u,outlineSize:h}=this._textMeshTransformProps,{boxBackgroundColor:d,boxBorderLineColor:p}=a,f={isBackground:!0,fontSize:c,haloSize:u,outlineSize:h,referenceBounds:n,...o};d&&(this._writeQuad(e,t,r,s,{texcoords:m,offsets:i.main,color:l.processColorInput(d),...f}),p||(this._writeQuad(e,t,r,s,{texcoords:S,offsets:i.top,color:l.processColorInput(d),...f}),this._writeQuad(e,t,r,s,{texcoords:x,offsets:i.bot,color:l.processColorInput(d),...f}),this._writeQuad(e,t,r,s,{texcoords:w,offsets:i.left,color:l.processColorInput(d),...f}),this._writeQuad(e,t,r,s,{texcoords:v,offsets:i.right,color:l.processColorInput(d),...f}))),p&&(this._writeQuad(e,t,r,s,{texcoords:_,offsets:i.top,color:l.processColorInput(p),...f}),this._writeQuad(e,t,r,s,{texcoords:_,offsets:i.bot,color:l.processColorInput(p),...f}),this._writeQuad(e,t,r,s,{texcoords:b,offsets:i.left,color:l.processColorInput(p),...f}),this._writeQuad(e,t,r,s,{texcoords:b,offsets:i.right,color:l.processColorInput(p),...f}))}_writeQuad(e,t,r,s,i){const n=e.vertexCount();this._writeVertex(e,t,r,s,i),e.indexWrite(n+0),e.indexWrite(n+1),e.indexWrite(n+2),e.indexWrite(n+1),e.indexWrite(n+3),e.indexWrite(n+2)}}const P=e=>Math.round(e*(254/360));e.TextMeshWriter=I,e.TextVertexSpec=M,e.maxLabelZoom=28,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/text/TextParams":function(){define(["exports","../../../../../../../symbols/cim/utils"],function(e,t){"use strict";e.TextMeshTransformProps=class{constructor(e){const{offsetX:r,offsetY:s,postAngle:i,fontSize:n,haloSize:o,outlineSize:a,scaleFactor:l,transforms:c}=e;if(this.offsetX=r,this.offsetY=s,this.postAngle=i,this.fontSize=Math.min(n,96),this.haloSize=o??0,this.outlineSize=a??0,this.transforms=c,c&&c.infos.length>1){const e=t.applyParentTransform(n,i,!1,r,s,c,!1);this.fontSize=Math.min(e.size,96);const o=e.size/n;this.haloSize*=o,this.outlineSize*=o,this.postAngle=e.rotation,this.offsetX=e.offsetX,this.offsetY=e.offsetY}l&&(this.fontSize*=l,this.offsetX*=l,this.offsetY*=l)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/GradientStrokeMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../definitions","../fill/meshWriterUtils","./gradientStrokeConstants","./LineMeshWriter","../../../../../../webgl/enums"],function(e,t,r,s,i,n,o,a){"use strict";const l={createComputedParams:e=>e,optionalAttributes:o.LineVertexSpec.optionalAttributes,attributes:{...o.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({gradientMethod:e,gradientSizeUnits:t,gradientType:r})=>i.packBitset([[n.bitset.isAlongLine,"alongline"===e.toLowerCase()],[n.bitset.isAbsoluteSize,1===t],[n.bitset.isDiscrete,"discrete"===r.toLowerCase()]])},tlbr:{type:a.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{const{rect:t,width:r,height:i}=e,n=t.x+s.spritePadding+s.gradientTextureExternalPadding,o=t.y+s.spritePadding;return[n,o,n+r-2*s.gradientTextureExternalPadding,o+i]}},accumulatedDistance:{type:a.DataType.HALF_FLOAT,count:1,packTessellation:({distance:e,pathLength:t,distanceOffset:r})=>(r+e)/t},gradientSize:{type:a.DataType.HALF_FLOAT,count:1,pack:({gradientSize:e,gradientSizeUnits:r})=>0===r?e/100:t.pt2px(e)},totalLength:{type:a.DataType.HALF_FLOAT,count:1,packTessellation:({pathLength:e})=>e},segmentDirection:{type:a.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]}}};class c extends o.LineMeshWriter{get _preventEffectClipping(){return!0}constructor(e,t,r,s){super(e,t,r,s),this.vertexSpec=l,this._tessellationOptions.textured=!0}_write(e,t,s){const i=s??r.GeometryCursor.fromFeatureSetReaderCIM(t);if(!i)return;const{sprite:n}=this.evaluatedMeshParams;this._writeGeometry(e,t,i,n?.textureBinding)}}e.GradientStrokeMeshWriter=c,e.GradientStrokeVertexSpec=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/gradientStrokeConstants":function(){define(["exports"],function(e){"use strict";e.bitset={isAlongLine:0,isAbsoluteSize:1,isDiscrete:2},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../geometry/GeometryCursor","../../../definitions","../fill/meshWriterUtils","./LineMeshWriter","../shaders/constants","../../../../../../webgl/enums"],function(e,t,r,s,i,n,o,a){"use strict";const l={createComputedParams:e=>e,optionalAttributes:n.LineVertexSpec.optionalAttributes,attributes:{...n.LineVertexSpec.attributes,bitset:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:e,shouldScaleDash:t,isSDF:r})=>i.packBitset([[o.bitsetGenericConsiderAlphaOnly,e],[o.bitsetLineScaleDash,t],[o.bitsetLineIsSdf,r]])},tlbr:{type:a.DataType.UNSIGNED_SHORT,count:4,pack:({sprite:e})=>{const{rect:t,width:r,height:i}=e,n=t.x+s.spritePadding,o=t.y+s.spritePadding;return[n,o,n+r,o+i]}},accumulatedDistance:{type:a.DataType.UNSIGNED_SHORT,count:1,packTessellation:({distance:e})=>e},segmentDirection:{type:a.DataType.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:e,directionY:t})=>[e,t]},offsetAlongLine:{type:a.DataType.HALF_FLOAT,count:1,pack:({offsetAlongLine:e})=>t.pt2px(e)},capType:{type:a.DataType.UNSIGNED_BYTE,count:1,pack:({capType:e})=>{switch(e){case"Butt":case"butt":default:return 0;case"Square":case"square":return 1;case"Round":case"round":return 2}}}}};class c extends n.LineMeshWriter{constructor(e,t,r,s){super(e,t,r,s),this.vertexSpec=l,this._tessellationOptions.textured=!0}_write(e,t,s){const i=s??r.GeometryCursor.fromFeatureSetReaderCIM(t);if(!i)return;const{sprite:n}=this.evaluatedMeshParams;this._writeGeometry(e,t,i,n?.textureBinding)}}e.TexturedLineMeshWriter=c,e.texturedLineVertexSpec=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../core/libs/gl-matrix-2/math/mat2d","../../../../../../../core/libs/gl-matrix-2/factories/mat2df32","../../../../../../../core/libs/gl-matrix-2/math/vec2","../../../../../../../geometry/GeometryCursor","../../../../../../../symbols/cim/CIMEffects","../../../../../../../symbols/cim/constants","../../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper","../../../definitions","../fill/meshWriterUtils","./ComputedMarkerParams","./markerConstants","../mesh/MeshWriter","../../../../../../webgl/enums"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f){"use strict";const m=128/Math.PI,g={createComputedParams:e=>h.ComputedMarkerParams.from(e),optionalAttributes:{zoomRange:{type:f.DataType.SHORT,count:2,packPrecisionFactor:c.minMaxZoomPrecisionFactor,pack:({scaleInfo:e},{tileInfo:t})=>u.getMinMaxZoom(e,t)}},attributes:{pos:{type:f.DataType.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:f.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:f.DataType.UNSIGNED_BYTE,count:1,pack:({sprite:e,alignment:t,scaleSymbolsProportionally:r,overrideOutlineColor:s,colorLocked:i})=>{let n=0;return e.sdf&&(n|=u.getBitMask(d.MarkerConstants.bitset.isSDF)),1===t&&(n|=u.getBitMask(d.MarkerConstants.bitset.isMapAligned)),r&&(n|=u.getBitMask(d.MarkerConstants.bitset.scaleSymbolsProportionally)),s&&(n|=u.getBitMask(d.MarkerConstants.bitset.overrideOutlineColor)),i&&(n|=u.getBitMask(d.MarkerConstants.bitset.colorLocked)),n}},offset:{type:f.DataType.HALF_FLOAT,count:2,packAlternating:{count:4,pack:({angle:e,computedWidth:t,computedHeight:n,anchorX:o,anchorY:a,offsetX:l,offsetY:c,rotateClockwise:u})=>{const h=function(e,t,i,n,o=!1){const a=s.create(),l=o?1:-1;return r.identity(a),(t||i)&&r.translate(a,a,[t,-i]),n&&r.rotate(a,a,.017453292519944444*l*-n),a}(0,l,c,-e,u),d=-(.5+o)*t,p=-(.5-a)*n,f=[d,p],m=[d+t,p],g=[d,p+n],y=[d+t,p+n];return i.transformMat2d(f,f,h),i.transformMat2d(m,m,h),i.transformMat2d(g,g,h),i.transformMat2d(y,y,h),[f,m,g,y]}}},textureUV:{type:f.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:e,texXmin:t,texYmax:r,texYmin:s})=>[[t,s],[e,s],[t,r],[e,r]]}},color:{type:f.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>u.processColorInput(e)},outlineColor:{type:f.DataType.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>u.processColorInput(e)},sizing:{type:f.DataType.UNSIGNED_BYTE,count:4,pack:({rawWidth:e,rawHeight:t,outlineSize:r,referenceSize:s})=>{const i=Math.max(e,t);return[u.packByteSqrt(i,128),u.packByteSqrt(r,128),u.packByteSqrt(s,128),0]}},placementAngle:{type:f.DataType.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:e})=>{return t=e*m,t%=256,Math.abs(t>=0?t:t+256);var t}},sdfDecodeCoeff:{type:f.DataType.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sdfDecodeCoeff:e})=>e}}};class y extends p.MeshWriter{constructor(){super(...arguments),this.vertexSpec=g}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(e,t,r){const s=this.evaluatedMeshParams.sprite?.textureBinding,i=t.getDisplayId();e.recordStart(this.instanceId,this.attributeLayout,s);const n=this.evaluatedMeshParams.minPixelBuffer,l=Math.max(this.evaluatedMeshParams.computedWidth,n),c=Math.max(this.evaluatedMeshParams.computedHeight,n),u=-this.evaluatedMeshParams.anchorX*this.evaluatedMeshParams.computedWidth,h=this.evaluatedMeshParams.anchorY*this.evaluatedMeshParams.computedHeight,d=this.evaluatedMeshParams.offsetX+u,p=-this.evaluatedMeshParams.offsetY+h;if(null!=this.evaluatedMeshParams.placement){let s=null;if(null!=r){const e=Math.max(this.evaluatedMeshParams.computedWidth,this.evaluatedMeshParams.computedHeight);if(s=o.clipCursorToTileExtent(r,2*e,!1),null===s)return}this._writePlacedMarkers(e,t,s,l,c)}else if(r?.nextPath()){r.nextPoint();const t=r.x,s=r.y;e.recordBounds(t+d,s+p,l,c),this._writeQuad(e,i,t,s)}else if("esriGeometryPolygon"===t.geometryType){const r=t.readCentroidForDisplay();if(!r)return;const[s,n]=r.coords;e.recordBounds(s+d,n+p,l,c),this._writeQuad(e,i,s,n)}else if("esriGeometryPoint"===t.geometryType){const r=t.readXForDisplay(),s=t.readYForDisplay();e.recordBounds(r+d,s+p,l,c),this._writeQuad(e,i,r,s)}else{const r=t.readGeometryForDisplay();r?.forEachVertex((t,r)=>{e.recordBounds(t+d,r+p,l,c),Math.abs(t)>a.maxTileCoordValue||Math.abs(r)>a.maxTileCoordValue||this._writeQuad(e,i,t,r)})}e.recordEnd()}_writePlacedMarkers(e,r,s,i,o){const c=s??n.GeometryCursor.fromFeatureSetReaderCIM(r);if(!c)return;const u=l.CIMMarkerPlacementHelper.getPlacement(c,-1,this.evaluatedMeshParams.placement,t.pt2px(1),e.id);if(!u)return;const h=r.getDisplayId();let d=u.next();const p=this.evaluatedMeshParams.offsetX,f=-this.evaluatedMeshParams.offsetY;for(;null!=d;){const t=d.tx,r=-d.ty;if(Math.abs(t)>a.maxTileCoordValue||Math.abs(r)>a.maxTileCoordValue){d=u.next();continue}const s=-d.getAngle();e.recordBounds(t+p,r+f,i,o),this._writeQuad(e,h,t,r,s),d=u.next()}}_writeQuad(e,t,r,s,i){const n=e.vertexCount(),o=null==i?null:{placementAngle:i};this._writeVertex(e,t,r,s,o),e.indexWrite(n+0),e.indexWrite(n+1),e.indexWrite(n+2),e.indexWrite(n+1),e.indexWrite(n+3),e.indexWrite(n+2)}}e.MarkerMeshWriter=y,e.MarkerVertexSpec=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/markers/ComputedMarkerParams":function(){define(["exports","../../../../../../../core/screenUtils","../../../../../../../symbols/cim/utils","../../../definitions"],function(e,t,r,s){"use strict";class i{static from(e){return"width"in e?this.fromSimpleMeshParams(e):this.fromComplexMeshParams(e)}static fromSimpleMeshParams(e){const r=new i(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects),{type:s,width:n,height:o,angle:a,alignment:l,outlineSize:c,referenceSize:u,sprite:h,overrideOutlineColor:d}=e;return r.rawWidth=t.pt2px(n),r.rawHeight=t.pt2px(o),r.angle=a,r.alignment=l,r.outlineSize=t.pt2px(c),r.referenceSize=t.pt2px(u),r.overrideOutlineColor=d,r.offsetX=t.pt2px(e.offsetX),r.offsetY=t.pt2px(e.offsetY),"simple"!==s||h.sdf||(r.rawWidth=h.width,r.rawHeight=h.height),r._computeSize(e,!1),r}static fromComplexMeshParams(e){const s=new i(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects);let{alignment:n,transforms:o,size:a,scaleX:l,anchorX:c,anchorY:u,angle:h,colorLocked:d,frameHeight:p,widthRatio:f,offsetX:m,offsetY:g,outlineSize:y,referenceSize:_,scaleFactor:b,sizeRatio:S,isAbsoluteAnchorPoint:x,rotateClockwise:w,scaleSymbolsProportionally:v,sprite:M}=e;if(o&&o.infos.length>0){const e=r.applyParentTransform(a,h,w,m,g,o);a=e.size,h=e.rotation,m=e.offsetX,g=e.offsetY,w=!1}b&&(a*=b,m*=b,g*=b);const I=l*(M.width/M.height);s.alignment=n,s.rawHeight=t.pt2px(a),s.rawWidth=s.rawHeight*I,s.referenceSize=t.pt2px(_),s.sizeRatio=S,s.sdfDecodeCoeff=(M.sdfDecodeCoeff??1)*S,s.angle=h,s.rotateClockwise=w,s.anchorX=c,s.anchorY=u,s.offsetX=t.pt2px(m),s.offsetY=t.pt2px(g),x&&a&&(M.sdf?s.anchorX=c/(a*f):s.anchorX=c/(a*I),s.anchorY=u/a);const P=v&&p?a/p:1;return s.outlineSize=0===y||isNaN(y)?0:t.pt2px(y)*P,s.scaleSymbolsProportionally=v,s.colorLocked=d,s._computeSize(e,!0),s}constructor(e,t,r,s,i,n,o){this.sprite=e,this.color=t,this.outlineColor=r,this.minPixelBuffer=s,this.placement=i,this.scaleInfo=n,this.effects=o,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.sdfDecodeCoeff=1,this.alignment=0,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0}get boundsInfo(){return{size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(e,t){const{sprite:r,hasSizeVV:i}=e,a=!!r.sdf,l=r.sdfPaddingRatio??.5,{rawWidth:c,rawHeight:u,sizeRatio:h,outlineSize:d}=this,p=r.rect;let f=c*h,m=u*h,g=0,y=0;if(a){const e=1/(1-l);if(f*=e,m*=e,i)this.computedWidth=f,this.computedHeight=m;else{const e=t&&c>u?f:c,s=u,i=d+2;this.computedWidth=Math.min(e+i,f),this.computedHeight=Math.min(s+i,m);const n=Math.max(r.width,r.height)/Math.max(f,m);g=(this.computedWidth-f)*n,y=(this.computedHeight-m)*n}}else this.computedWidth=f*(p.width/r.width),this.computedHeight=m*(p.height/r.height),g=2*s.spritePadding,y=2*s.spritePadding;const _=p.x+s.spritePadding-g/2,b=p.y+s.spritePadding-y/2,S=_+r.width+g,x=b+r.height+y;this.texXmin=n(_),this.texYmin=n(b),this.texXmax=o(S),this.texYmax=o(x),this.computedWidth*=(this.texXmax-this.texXmin)/(S-_),this.computedHeight*=(this.texYmax-this.texYmin)/(x-b),this.anchorX*=f/this.computedWidth,this.anchorY*=m/this.computedHeight}}function n(e,t=1e-7){const r=Math.ceil(e);return r-e<t?r:Math.floor(e)}function o(e,t=1e-7){const r=Math.floor(e);return e-r<t?r:Math.ceil(e)}e.ComputedMarkerParams=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/mesh/MeshWriterInputEvaluator":function(){define(["exports","../../../../../../../core/arrayUtils","../../../../../../../core/Error","../../../../../../../core/lang","../../../../../../../core/Logger","../../../../../../../support/ArcadeExpression","../../../grouping","../../../animations/infos","../../../animations/utils","./utils","../../../../../layers/features/support/DictionaryValue"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";const h=()=>i.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.mesh.MeshWriterInputEvaluator");async function d(e,t,r,s){const{defaultValue:i,valueExpressionInfo:n,value:o}=t;if(n){if("dictionary-template"===n.type)return{...t,computed:e.createDictionaryTemplateField(n,r),defaultValue:i};const{expression:o}=n,a=await e.createComputedField({expression:o},s);return a?{...t,computed:a,defaultValue:i}:null}return{...t,computed:new u.DictionaryValue(o),defaultValue:i}}async function p(e,t,r){const{valueExpressionInfo:s}=t,i="dictionary-template"===s.type?e.createDictionaryTemplateField(s,r):await e.createComputedField({expression:s.expression});return i?{...t,computed:i}:null}function f(e){return"object"==typeof e&&null!=e&&(!(!("valueExpressionInfo"in e)||!e.valueExpressionInfo)||"type"in e&&"Process"===e.type&&"op"in e&&"Random"===e.op)}function m(e){if(Array.isArray(e))for(const t of e)if(m(t))return!0;if("object"==typeof e){if(f(e))return!0;for(const t in e)if(m(e[t]))return!0}return!1}class g{static async create(e,r,s,i){const n={},o=new Map,a=new Map,c=new Map,u=new Map,h=new Map,y=new Map;for(const g in s){const _=s[g];if(null!=_&&"object"==typeof _)if(Array.isArray(_)){if("object"==typeof _[0])throw new Error(`InternalError: Cannot handle ${g}. Nested array params are not supported`);n[g]=_}else{if("valueExpressionInfo"in _){if(_.value){n[g]=_.value;continue}const t=await p(e,_,i);if(!t){n[g]=_.defaultValue;continue}o.set(g,t),n[g]=null;continue}switch(_.type){case"cim-effect-infos":if(_.effectInfos.some(e=>e.overrides.length)){a.set(g,{effects:await Promise.all(_.effectInfos.map(async r=>{const s=r.overrides.map(t=>d(e,t,i,!1));return{effect:r.effect,compiledOverrides:(await Promise.all(s)).filter(t.isSome)}}))});break}n[g]=_.effectInfos.map(e=>e.effect);break;case"cim-marker-placement-param":_.overrides.length&&c.set(g,{placementInfo:_,compiledOverrides:(await Promise.all(_.overrides.map(t=>d(e,t,i,!1)))).filter(t.isSome)}),n[g]=_.placement;break;case"text-rasterization-param":{if(_.overrides.length){const r=_.overrides.map(t=>d(e,t,i,_.useLegacyLabelEvaluationRules??!1));u.set(g,{compiledOverrides:(await Promise.all(r)).filter(t.isSome),rasterizationParam:_,objectIdToResourceId:new Map});continue}const s={type:"cim-rasterization-info",resource:_.resource};n[g]=await r.fetchResourceImmediate(s)??null;break}case"sprite-rasterization-param":{if(_.overrides.length){const r=_.overrides.map(t=>d(e,t,i,!1));u.set(g,{compiledOverrides:(await Promise.all(r)).filter(t.isSome),rasterizationParam:_,objectIdToResourceId:new Map});continue}if("animated"===_.resource.type){u.set(g,{compiledOverrides:[],rasterizationParam:_,objectIdToResourceId:new Map});continue}const s={type:"cim-rasterization-info",resource:_.resource};n[g]=await r.fetchResourceImmediate(s)??null;break}case"cim-marker-transform-param":{const{params:t}=_;if(m(t)){const r={compiledMarkerInfos:[]};await Promise.all(t.map(async t=>{const s={props:{}};for(const r in t)if(f(t[r])){const n=await p(e,t[r],i);s.compiledExpressionMap||(s.compiledExpressionMap=new Map);const o=s.compiledExpressionMap;n&&o.set(r,n)}else s.props[r]=t[r];r.compiledMarkerInfos.push(s)})),h.set(g,r)}else n[g]={type:"cim-marker-transform-info",infos:t};break}case"animation-params":{const{params:t}=_,s=l.createParamList(t);if(m(s)){const t=await Promise.all(s.map(t=>l.compileAnimationParam(t,e)));y.set(g,{params:t,propertyIdToResourceId:new Map,key:g})}else{const e=l.fromJSON(s),t=await r.fetchResourceImmediate({type:"animation-info",resource:e});null!=t&&"sprite"===t.type&&(n[g]={dataRow:t.rect.y,dataColumn:t.rect.x})}break}default:n[g]=_}}else n[g]=_}return new g(s,n,o,a,c,u,h,y)}constructor(e,t,r,s,i,o,a,l){this.inputMeshParams=e,this._resolvedMeshParams=t,this._dynamicProperties=r,this._dynamicEffectProperties=s,this._dynamicPlacementProperties=i,this._dynamicAsyncProperties=o,this._dynamicTransformProperties=a,this._dynamicAsyncAnimations=l,this.evaluator=e=>e,this._arcadeDependencies=new Set;for(const e of this._expressions())n.collectExpressionDependencies(this._arcadeDependencies,e)}get hasDynamicProperties(){return!!(this._dynamicProperties.size||this._dynamicAsyncProperties.size||this._dynamicEffectProperties.size||this._dynamicTransformProperties.size||this._dynamicPlacementProperties.size||this._dynamicAsyncAnimations.size)}get evaluatedMeshParams(){return this._evaluatedMeshParams||(this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams)),this._evaluatedMeshParams}enqueueRequest(e,t,i){for(const n of this._dynamicAsyncProperties.values()){const a=s.clone(n.rasterizationParam.resource);"animated"===n.rasterizationParam.resource.type&&n.rasterizationParam.resource.randomizeStartTime&&(a.primitiveName="__RESERVED__PRIMITIVE__NAME__",a.startGroup=o.getStartGroup(t.getObjectId()||0));for(const{primitiveName:e,propertyName:s,computed:o,defaultValue:l,valueExpressionInfo:u}of n.compiledOverrides)try{const r="animated"===n.rasterizationParam.resource.type?a.primitiveName:e;c.applyComputedValue(a,r,s,o,t,i,l)}catch(e){h().errorOnce(new r("invalid-arcade-expression","Encountered an error when evaluating the arcade expression",{error:e,valueExpressionInfo:u}))}const l=e.enqueueRequest({type:"cim-rasterization-info",resource:a});n.objectIdToResourceId.set(t.getObjectId(),l)}for(const r of this._dynamicAsyncAnimations.values()){const s=r.params.map(e=>l.resolveToAnimationInfo(e,t,i)).map(a.hydrate).map(e=>e.simplify()),n=l.encodeParamList(s),o=e.enqueueRequest({type:"animation-info",resource:n});r.propertyIdToResourceId.set(t.getObjectId()+"."+r.key,o)}}evaluateMeshParams(e,t,r){for(const[e,s]of this._dynamicProperties.entries())this._resolvedMeshParams[e]=s.computed.readWithDefault(t,r,s.defaultValue);for(const[e,s]of this._dynamicPlacementProperties.entries())for(const{computed:i,defaultValue:n,propertyName:o}of s.compiledOverrides){const a=i.readWithDefault(t,r,n);s.placementInfo.placement[o]=a,this._resolvedMeshParams[e]=s.placementInfo.placement}for(const[e,s]of this._dynamicEffectProperties.entries())for(const i of s.effects){for(const{computed:e,defaultValue:s,propertyName:n}of i.compiledOverrides){const o=e.readWithDefault(t,r,s);i.effect[n]=o}this._resolvedMeshParams[e]=s.effects.map(e=>e.effect)}for(const[e,s]of this._dynamicTransformProperties.entries()){const i={type:"cim-marker-transform-info",infos:[]};for(const e of s.compiledMarkerInfos){const s={...e.props};if(e.compiledExpressionMap)for(const[i,n]of e.compiledExpressionMap){const e=n.computed.readWithDefault(t,r,n.defaultValue);s[i]="number"==typeof e||"boolean"==typeof e?e:n.defaultValue}i.infos.push(s)}this._resolvedMeshParams[e]=i}for(const[r,s]of this._dynamicAsyncProperties.entries()){const i=s.objectIdToResourceId.get(t.getObjectId());if(null==i)continue;const n=e.getResource(i);this._resolvedMeshParams[r]=n}for(const[r,s]of this._dynamicAsyncAnimations.entries()){const i=s.propertyIdToResourceId.get(t.getObjectId()+"."+r);if(null==i)continue;const n=e.getResource(i);this._resolvedMeshParams[r]={dataRow:n.rect.y,dataColumn:n.rect.x}}return this._evaluatedMeshParams=this.evaluator(this._resolvedMeshParams),this.evaluatedMeshParams}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}*_expressions(){for(const e of this._dynamicProperties.values())yield e.computed;for(const e of this._dynamicEffectProperties.values())for(const t of e.effects)for(const e of t.compiledOverrides)yield e.computed;for(const e of this._dynamicPlacementProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicAsyncProperties.values())for(const t of e.compiledOverrides)yield t.computed;for(const e of this._dynamicTransformProperties.values())for(const t of e.compiledMarkerInfos)if(null!=t.compiledExpressionMap)for(const e of t.compiledExpressionMap.values())yield e.computed;for(const e of this._dynamicAsyncAnimations.values())for(const t of e.params)yield*l.getAnimationExpressions(t)}}e.MeshWriterInputEvaluator=g,e.hasExpression=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DictionaryValue":function(){define(["exports","./AComputedField"],function(e,t){"use strict";class r extends t.AComputedField{constructor(e){super(),this._value=e}resize(e){}read(e,t){return this._value}readWithDefault(e,t,r){return this._value}hasArcadeDependency(e){return!1}}e.DictionaryValue=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AComputedField":function(){define(["exports"],function(e){"use strict";e.AComputedField=class{destroy(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter":function(){define(["exports","../../../../../../../core/screenUtils","../fill/meshWriterUtils","../mesh/MeshWriter","../../../../../../webgl/enums"],function(e,t,r,s,i){"use strict";const n={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:i.DataType.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:i.DataType.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:i.DataType.UNSIGNED_BYTE,count:1,pack:e=>0},offset:{type:i.DataType.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:e})=>{const r=t.pt2px(e),s=-r/2,i=-r/2;return[[s,i],[s+r,i],[s,i+r],[s+r,i+r]]}}},texCoords:{type:i.DataType.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:i.DataType.UNSIGNED_BYTE,count:2,pack:({size:e})=>[e,e]},referenceSize:{type:i.DataType.UNSIGNED_BYTE,count:1,pack:({size:e})=>t.pt2px(e)},zoomRange:{type:i.DataType.UNSIGNED_BYTE,count:2,pack:({scaleInfo:e},{tileInfo:t})=>r.getMinMaxZoom(e,t)}}};class o extends s.MeshWriter{constructor(){super(...arguments),this.vertexSpec=n}_write(e,r){const s=r.getDisplayId(),i=this.evaluatedMeshParams.minPixelBuffer,n=Math.max(t.pt2px(this.evaluatedMeshParams.size),i);let o,a;if("esriGeometryPoint"===r.geometryType)o=r.readXForDisplay(),a=r.readYForDisplay();else{const e=r.readCentroidForDisplay();if(!e)return;o=e?.coords[0],a=e?.coords[1]}e.recordStart(this.instanceId,this.attributeLayout),e.recordBounds(o,a,n,n);const l=e.vertexCount();this._writeVertex(e,s,o,a),e.indexWrite(l+0),e.indexWrite(l+1),e.indexWrite(l+2),e.indexWrite(l+1),e.indexWrite(l+3),e.indexWrite(l+2),e.recordEnd()}}e.PieChartMeshWriter=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/MatcherContext":function(){define(["exports"],function(e){"use strict";e.MatcherContext=class{constructor(e,t,r,s,i){this.storage=e,this.proxy=t,this.viewParams=r,this.registry=s,this.fieldsMap=i}async createMeshWriters(e){const t=e.map(e=>this.registry.createMeshWriter(this.storage,this.proxy,this.viewParams,e,this.fieldsMap));return Promise.all(t)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/ProcessorTileMessageQueue":function(){define(["exports","../../../../core/QueueProcessor"],function(e,t){"use strict";e.ProcessorTileMessageQueue=class{constructor(e){this._outstandingMessages=[],this._queue=new t.QueueProcessor({concurrency:e.concurrency,process:t=>e.process(t)})}async push(e){if(e.end)return await Promise.all(this._outstandingMessages),await this._queue.push(e),void(this._outstandingMessages=[]);const t=this._queue.push(e);return this._outstandingMessages.push(t),t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/QueueProcessor":function(){define(["exports","./maybe","./promiseUtils","./Queue","./ReactiveMap","./scheduling","./signal"],function(e,t,r,s,i,n,o){"use strict";class a{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}e.QueueProcessor=class{constructor(e){this._schedule=null,this._deferreds=new i,this._controllers=new i,this._processingItems=new i,this._pausedSignal=o.signal(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new s(e.peeker),this.process=e.process}destroy(){this.clear(),this._schedule=t.removeMaybe(this._schedule)}get updating(){return this.running}get length(){return this._processingItems.size+this._queue.length}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(t=>e.push(t)),this._controllers.clear(),e.forEach(e=>e.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((t,r)=>e(r))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const s=this.get(e);if(s)return s;const i=new AbortController;let n=null;t&&(n=r.onAbort(t,()=>i.abort()));const o=()=>{a.remove(),null!=n&&n.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},a=r.onAbortOrThrow(i.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),l.reject(r.createAbortError())}),l=r.createResolver();return this._deferreds.set(e,l),this._controllers.set(e,i),l.promise.then(o,o),this._queue.push(e),this._scheduleNext(),l.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject(r.createAbortError()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._pausedSignal.value||this._schedule||(this._schedule=n.schedule(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const s=new AbortController,i=new a(e,s);this._processingItems.set(e,i);try{t=this.process(e,s.signal)}catch(e){this._processError(i,e)}r.isPromiseLike(t)?(i.promise=t,t.then(e=>this._processResult(i,e),e=>this._processError(i,e))):this._processResult(i,t)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/BinningStrategy":function(){define(["exports","../../../../../geometry/SpatialReference","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/graphics/data/projectionSupport","../../../../../layers/support/FieldsIndex","../aggregation/ComputedAggregateField","./AAggregateStrategy","./AProcessorStrategy","../sources/FeatureSourceMessage","../support/ComputedAttributeStorage","../support/FeatureFilterEvaluator","../support/FeatureMetadata","../support/FeatureSetReaderJSON","../../../tiling/TileKey"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f){"use strict";class m extends l.ASendState{constructor(e,t){super(e),this.bins=new Map,this.featureCache=new Map,this.done=!1,this._store=t}reset(){this.destroy(),this.done=!1}destroy(){const e=this.subscription.tile.key.level;for(const t of this.featureCache.keys())this._store.releaseDisplayIdForObjectId(`${t}.${e}`);this.bins.clear(),this.featureCache.clear(),this.handledChunks.clear()}get tile(){return this.subscription.tile}*featuresWorldSpace(){for(const e of this.featureCache.values()){const t=e.clone();t.geometry&&r.unquantizeOptimizedGeometry(t.geometry,t.geometry,!1,!1,this.subscription.tile.transform),yield t}}}class g extends a.AAggregateStrategy{static async create(e,r,s,n,a,l){const c=new u.ComputedAttributeStorage({spatialReference:r}),d=await Promise.all(e.fields.map(async e=>o.ComputedAggregateField.create(c,e))),p=e.featureFilter?await h.create({geometryType:s.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:s.metadata.timeInfo,fieldsIndex:s.metadata.fieldsIndex,spatialReference:r,filterJSON:e.featureFilter}):null;return"geohash"===e.index.type&&await i.checkProjectionSupport(r,t.WGS84),new g(e,p,a,d,r,s,n,l)}constructor(e,t,r,s,i,o,a,l){super(o,a,i,s,l),this._schema=e,this._featureFilter=t,this._arcadeContextInfo=r,this._metadata=d.FeatureMetadata.createFeature({geometryType:"esriGeometryPolygon",featureIdInfo:{type:"object-id",fieldName:"aggregateId"},fieldsIndex:new n(e.fields).toJSON(),globalIdField:null,spatialReference:o.metadata.spatialReference,outSpatialReference:o.metadata.outSpatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null})}createState(e){return new m(e,this._attributeStore)}async*applyOverrideUpdate(e){for(const e of this._sendStates.values()){e.reset();const t=new c.FeatureTileAppendMessage(e.subscription,p.FeatureSetReaderJSON.empty(this._source.metadata),!0,!1,{});yield t}}displayMap(e,t,r){const s=new Map(e.map(e=>[t(e),e])),i=[];for(const e of this._sendStates.values())for(const t of e.featuresWorldSpace()){const{objectId:e,displayId:n}=t,o=s.get(e);if(null!=o){const t=r(n,o,e);i.push(t),s.delete(e)}}return i}getDisplayFeatures(e){const t=new Set(e),s=new Set,i=[];for(const e of this._sendStates.values())for(const n of e.featuresWorldSpace())t.has(n.displayId)&&!s.has(n.objectId)&&(n.geometry&&i.push({...r.convertToFeature(n,this._metadata.geometryType,!1,!1),displayId:n.displayId}),s.add(n.objectId));return{features:[],aggregates:i,tracks:[]}}getFeatureObjectIdsForAggregate(e){for(const t of this._sendStates.values())for(const r of t.bins.values())if(r.id===e)return Array.from(r.containedObjectIds);return[]}async*updateChunks(){for(const e of this._sendStates.values())yield*this._update(e,this._source)}forEachAggregateWorldSpace(e){const t=new Set;for(const r of this._sendStates.values())for(const s of r.featuresWorldSpace())t.has(s.objectId)||(e(s),t.add(s.objectId))}_createIndexOptions(e){switch(this._schema.index.type){case"geohash":return{type:"geohash",fields:this.aggregateFields,featureFilter:this._featureFilter,geohashLevel:this._schema.index.fixBinLevel,spatialReference:this.spatialReference,arcadeContextInfo:this._arcadeContextInfo,scale:e.scale,sqlOptions:this._sqlOptions};case"grid":{const t=this._schema.index.fixedBinLevel,r=null!=t?e.tileInfoView.getLODInfoAt(t).scale:e.scale;return{type:"grid",fields:this.aggregateFields,cellSize:this._schema.index.size,featureFilter:this._featureFilter,spatialReference:this.spatialReference,arcadeContextInfo:this._arcadeContextInfo,scale:r,sqlOptions:this._sqlOptions}}}}async*_update(e,t){const{handledChunks:r,subscription:i,bins:n,featureCache:o}=e,a=i.tile;if(e.done)return;for(const s of t.chunks()){if(r.has(s.chunkId))continue;r.add(s.chunkId);const t=s.queryInfo;if("tileId"in t){const e=new f(t.tileId);if(e.level!==a.level||e.world!==a.key.world)continue}s.getAggregateIndex(this._createIndexOptions(e.tile)).putBounded(n,e.tile.extent,e.tile.resolution)}const l=[],u=i.tile.transform,h=i.tile.key.level;for(const e of n.values()){let t=o.get(e.id);if(t)t.attributes=e.getAttributes();else{const r=e.getGeometry(this.spatialReference,u);t=new s.OptimizedFeature(r,e.getAttributes(),null,e.id),r||(t.centroid=e.getGeometricCentroid(this.spatialReference,u)),t.displayId=this._attributeStore.createDisplayIdForObjectId(`${t.objectId}.${h}`),o.set(e.id,t)}l.push(t)}this.events.emit("changed"),e.done=!t.updateTracking.updating;const d=p.FeatureSetReaderJSON.fromOptimizedFeatures(l,this._metadata,u),m=d.getCursor(),g=e.subscription.tile.createArcadeEvaluationOptions(this._arcadeContextInfo);for(;m.next();)this._attributeStore.setAttributeData(m.getDisplayId(),m,g,this._sqlOptions);const y=new c.FeatureTileUpdateMessage(e.subscription,d,[],e.done,{});yield y}}e.BinningState=m,e.BinningStrategy=g,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define(["exports","../../../core/arrayUtils","../../../core/promiseUtils","../../../geometry/projectionUtils","../../../geometry/geometryAdapters/json","../../../geometry/support/spatialReferenceUtils","../../../geometry/support/webMercatorUtils"],function(e,t,r,s,i,n,o){"use strict";const a=[0,0];function l(e,t){if(!t)return null;if("x"in t){const r={x:0,y:0};return[r.x,r.y]=e(t.x,t.y,a),null!=t.z&&(r.z=t.z),null!=t.m&&(r.m=t.m),r}if("xmin"in t){const r={xmin:0,ymin:0,xmax:0,ymax:0};return[r.xmin,r.ymin]=e(t.xmin,t.ymin,a),[r.xmax,r.ymax]=e(t.xmax,t.ymax,a),t.hasZ&&(r.zmin=t.zmin,r.zmax=t.zmax,r.hasZ=!0),t.hasM&&(r.mmin=t.mmin,r.mmax=t.mmax,r.hasM=!0),r}return"rings"in t?{rings:c(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:c(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:u(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function c(e,t){const r=[];for(const s of e)r.push(u(s,t));return r}function u(e,t){const r=[];for(const s of e){const e=t(s[0],s[1],[0,0]);r.push(e),s.length>2&&e.push(s[2]),s.length>3&&e.push(s[3])}return r}const h=l.bind(null,o.lngLatToXY),d=l.bind(null,o.xyToLngLat),p=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,s,i){if(!e?.length||!t||!s||n.equals(t,s))return e;const o={geometries:e,inSpatialReference:t,outSpatialReference:s,geographicTransformation:i,resolve:r.createResolver()};return this._jobs.push(o),this._timer??=setTimeout(this._process,10),o.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:r,outSpatialReference:a,resolve:l,geographicTransformation:c}=e;o.canProject(r,a)?n.isWebMercator(a)?l(t.map(h)):l(t.map(d)):l(s.projectMany(i.jsonAdapter,t,r,a,c,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};e.checkProjectionSupport=async function(e,r){if(!e||!r)return;const i=Array.isArray(e)?e.map(e=>null!=e.geometry?e.geometry.spatialReference:null).filter(t.isSome):[e];await s.initializeProjection(i.map(e=>({source:e,dest:r})))},e.project=function(e,t,r,a){if(!e)return null;if(r||(r=t,t=e.spatialReference),!n.isValid(t)||!n.isValid(r)||n.equals(t,r))return e;if(o.canProject(t,r)){const t=n.isWebMercator(r)?h(e):d(e);return t.spatialReference=r,t}return s.projectMany(i.jsonAdapter,[e],t,r,null,a)[0]},e.projectMany=function(e,t,r,s){return p.push(e,t,r,s)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(e){"use strict";const t={convertToGEGeometry:function(e,t){return null==t?null:e.convertJSONToGeometry(t)},exportPoint:function(e,t,s){const i=new r(e.getPointX(t),e.getPointY(t),s),n=e.hasZ(t),o=e.hasM(t);return n&&(i.z=e.getPointZ(t)),o&&(i.m=e.getPointM(t)),i},exportPolygon:function(e,t,r){return new s(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportPolyline:function(e,t,r){return new i(e.exportPaths(t),r,e.hasZ(t),e.hasM(t))},exportMultipoint:function(e,t,r){return new n(e.exportPoints(t),r,e.hasZ(t),e.hasM(t))},exportExtent:function(e,t,r){const s=e.hasZ(t),i=e.hasM(t),n=new o(e.getXMin(t),e.getYMin(t),e.getXMax(t),e.getYMax(t),r);if(s){const r=e.getZExtent(t);n.zmin=r.vmin,n.zmax=r.vmax}if(i){const r=e.getMExtent(t);n.mmin=r.vmin,n.mmax=r.vmax}return n}};class r{constructor(e,t,r){this.x=e,this.y=t,this.spatialReference=r,this.z=void 0,this.m=void 0}}class s{constructor(e,t,r,s){this.rings=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class i{constructor(e,t,r,s){this.paths=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class n{constructor(e,t,r,s){this.points=e,this.spatialReference=t,this.hasZ=void 0,this.hasM=void 0,r&&(this.hasZ=r),s&&(this.hasM=s)}}class o{constructor(e,t,r,s,i){this.xmin=e,this.ymin=t,this.xmax=r,this.ymax=s,this.spatialReference=i,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}e.jsonAdapter=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/ComputedAggregateField":function(){define(["exports","../support/DictionaryValue"],function(e,t){"use strict";class r{static async create(e,s){if("count"===s.statisticType){const e=new t.DictionaryValue(1);return new r(s.name,s.alias,s.type,s.statisticType,e)}const i=await e.createComputedField({expression:s.onStatisticExpression?.expression,field:s.onStatisticField});return new r(s.name,s.alias,s.type,s.statisticType,i)}constructor(e,t,r,s,i){this.name=e,this.alias=t,this.type=r,this.statisticType=s,this.computed=i}}e.ComputedAggregateField=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/AAggregateStrategy":function(){define(["exports","../../../../../core/Evented","../../../../../geometry/support/aaBoundingBox","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter","../../../../../layers/graphics/data/QueryEngine","../../../../../support/ArcadeExpression","./AProcessorStrategy"],function(e,t,r,s,i,n,o,a){"use strict";class l extends a.AProcessorStrategy{constructor(e,r,s,n,a){super(e,r,a),this.spatialReference=s,this.aggregateFields=n,this._arcadeDependencies=new Set,this.events=new t.EventEmitter,this.featureAdapter=i.optimizedFeatureQueryEngineAdapter;for(const e of n)o.collectExpressionDependencies(this._arcadeDependencies,e.computed)}get aggregateQueryEngine(){return this._aggregateQueryEngine||(this._aggregateQueryEngine=new n.QueryEngine({featureStore:this,fieldsIndex:this._metadata.fieldsIndex,geometryType:this._metadata.geometryType,featureIdInfo:this._metadata.featureIdInfo,spatialReference:this.spatialReference})),this._aggregateQueryEngine}get isAggregate(){return!0}removeChunks(e){}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}forEach(e){return this.forEachAggregateWorldSpace(e)}forEachInBounds(e,t){}forEachBounds(e,t){const i=r.create();for(const r of e){const e=s.getBoundsOptimizedGeometry(i,r.geometry,!1,!1);e&&t(e)}}}e.AAggregateStrategy=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../OptimizedFeature"],function(e,t){"use strict";const r={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,r)=>new t.OptimizedFeature(r,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)};e.optimizedFeatureQueryEngineAdapter=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define(["exports","../../../core/arrayUtils","../../../core/compilerUtils","../../../core/Error","../../../core/has","../../../core/lang","../../../core/maybe","../../../core/promiseUtils","../../../core/unitUtils","../../../core/support/jsonUtils","../../../geometry/projectionUtils","../../../geometry/support/aaBoundingBox","../../../geometry/support/aaBoundingRect","../../../geometry/support/boundsUtils","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../featureConversionUtils","./attributeSupport","./geometryUtils","./projectionSupport","./QueryEngineCache","./QueryEngineCapabilities","./QueryEngineResult","./queryUtils","./queryValidationUtils","./spatialQuerySupport","./timeSupport","../../support/FieldsIndex","../../../views/support/Scheduler"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_,b,S,x,w,v,M,I,P,T,C){"use strict";function F(e){if(I.canQueryWithRBush(e)){if(f.isExtent(e))return[d.fromValues(Math.min(e.xmin,e.xmax),Math.min(e.ymin,e.ymax),Math.max(e.xmin,e.xmax),Math.max(e.ymin,e.ymax))];if(f.isPolygon(e))return e.rings.map(e=>d.fromValues(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1])))}return[p.getBoundsXY(d.create(),e)]}function k(e,t,r,s,i){const n={xmin:e[0],ymin:e[1],xmax:e[3],ymax:e[4],spatialReference:_.cleanFromGeometryEngine(s)};i&&isFinite(e[2])&&isFinite(e[5])&&(n.zmin=e[2],n.zmax=e[5],n.hasZ=!0);const o=b.project(n,t,r);if(o.spatialReference=_.cleanFromGeometryEngine(r),o.xmax-o.xmin===0){const e=l.getMetersPerUnitForSR(o.spatialReference);o.xmin-=e,o.xmax+=e}if(o.ymax-o.ymin===0){const e=l.getMetersPerUnitForSR(o.spatialReference);o.ymin-=e,o.ymax+=e}if(i&&null!=o.zmin&&null!=o.zmax&&o.zmax-o.zmin===0){const e=l.getMetersPerUnitForSR(o.spatialReference);o.zmin-=e,o.zmax+=e}return o}e.Feature=class{constructor(e,t=null,r,s,i){this.attributes=e,this.geometry=r,this.centroid=s,this.filterFlags=i,this.groupId=-1,this.displayId=t}},e.QueryEngine=class{constructor(e){this._changeHandle=null,this.capabilities={query:x.queryCapabilities},this.geometryType=e.geometryType,this.hasM=!!e.hasM,this.hasZ=!!e.hasZ,this.spatialReference=e.spatialReference,this.definitionExpression=e.definitionExpression,this.featureStore=e.featureStore,this.aggregateAdapter=e.aggregateAdapter,this._cache=e.cache??new S.QueryEngineCache,this.timeInfo=e.timeInfo,this.featureIdInfo=e.featureIdInfo,"object-id"===e.featureIdInfo.type&&(this.objectIdField=e.featureIdInfo.fieldName),this._changeHandle=this.featureStore.events.on("changed",()=>this._clearCache()),this.fieldsIndex=c.isSerializable(e.fieldsIndex)?e.fieldsIndex:T.fromJSON(e.fieldsIndex),!e.availableFields||1===e.availableFields.length&&"*"===e.availableFields[0]?this.availableFields=new Set(this.fieldsIndex.fields.map(e=>e.name)):this.availableFields=new Set(e.availableFields.map(e=>this.fieldsIndex.get(e)?.name).filter(e=>null!=e)),e.scheduler&&e.priority&&(this._frameTask=e.scheduler.registerTask(e.priority))}destroy(){this._changeHandle=o.removeMaybe(this._changeHandle),this._frameTask=o.removeMaybe(this._frameTask),this._clearCache(),o.destroyMaybe(this._cache)}get featureAdapter(){return this.featureStore.featureAdapter}_clearCache(){this._cache.clear(),this._allFeaturesPromise=null,this._timeExtentPromise=null,this._fullExtentPromise=null}async executeQuery(e,t){const r=a.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{},r);return await t.createQueryResponse()}catch(t){if(t!==v.queryEngineEmptyResult)throw t;return new w.QueryEngineResult([],e,this).createQueryResponse()}}async executeQueryForCount(e={},t){const r=a.signalFromSignalOrOptions(t);try{return(await this._executeQuery(e,{returnGeometry:!1,returnCentroid:!1,outSR:null},r)).createQueryResponseForCount()}catch(e){if(e!==v.queryEngineEmptyResult)throw e;return 0}}async executeQueryForExtent(e,t){const r=a.signalFromSignalOrOptions(t),s=e.outSR;try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),i=t.size;return i?{count:i,extent:await this._getBounds(t.items,t.spatialReference,s||this.spatialReference)}:{count:0,extent:null}}catch(e){if(e===v.queryEngineEmptyResult)return{count:0,extent:null};throw e}}async executeQueryForIds(e,t){return this.executeQueryForIdSet(e,t).then(e=>Array.from(e))}async executeQueryForIdSet(e,t){const r=a.signalFromSignalOrOptions(t);try{const t=await this._executeQuery(e,{returnGeometry:!0,returnCentroid:!1,outSR:null},r),s=t.items,i=new Set;return await this.reschedule(()=>{for(const e of s)i.add(t.featureAdapter.getObjectId(e))},r),i}catch(e){if(e===v.queryEngineEmptyResult)return new Set;throw e}}async executeQueryForLatestObservations(e,t){const r=a.signalFromSignalOrOptions(t);if(!this.timeInfo?.trackIdField)throw new s("unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:e,timeInfo:this.timeInfo});try{const t=await this._executeQuery(e,{},r);return await this.reschedule(()=>this._filterLatest(t),r),await t.createQueryResponse()}catch(t){if(t!==v.queryEngineEmptyResult)throw t;return new w.QueryEngineResult([],e,this).createQueryResponse()}}async executeQueryForOpaqueFeatures(e,t){const r=a.signalFromSignalOrOptions(t);return(await this._executeQuery(e,{},r)).items}async executeAttributeBinsQuery(e,t){const r=a.signalFromSignalOrOptions(t);let s;e=n.clone(e);try{e=await this.schedule(()=>v.normalizeAttributeBinsQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>M.validateAttributeBinsQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r);const t=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r);s=await this.reschedule(()=>this._executeGeometryQuery(e,t,r),r),await this.reschedule(()=>this._executeAggregateIdsQuery(s),r),await this.reschedule(()=>this.executeObjectIdsQuery(s),r),await this.reschedule(()=>this.executeTimeQuery(s),r),await this.reschedule(()=>this.executeAttributesQuery(s),r)}catch(t){if(t!==v.queryEngineEmptyResult)throw t;s=new w.QueryEngineResult([],e,this)}return s.createQueryBinsResponse(e)}async executeQueryForSummaryStatistics(e={},t,r){const s=a.signalFromSignalOrOptions(r),{field:i,normalizationField:n,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:n,valueExpression:o},s)).createSummaryStatisticsResponse(t)}async executeQueryForUniqueValues(e={},t,r){const s=a.signalFromSignalOrOptions(r),{field:i,field2:n,field3:o,valueExpression:l}=t;return(await this._executeQueryForStatistics(e,{field:i,field2:n,field3:o,valueExpression:l},s)).createUniqueValuesResponse(t)}async executeQueryForClassBreaks(e={},t,r){const s=a.signalFromSignalOrOptions(r),{field:i,normalizationField:n,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:n,valueExpression:o},s)).createClassBreaksResponse(t)}async executeQueryForHistogram(e={},t,r){const s=a.signalFromSignalOrOptions(r),{field:i,normalizationField:n,valueExpression:o}=t;return(await this._executeQueryForStatistics(e,{field:i,normalizationField:n,valueExpression:o},s)).createHistogramResponse(t)}async fetchRecomputedExtents(e){const t=a.signalFromSignalOrOptions(e);this._timeExtentPromise||=P.getTimeExtent(this.timeInfo,this.featureStore);const[r,s]=await Promise.all([this._getFullExtent(),this._timeExtentPromise]);return a.throwIfAborted(t),{fullExtent:r,timeExtent:s}}async _getBounds(e,t,r){const s=h.set(h.create(),h.negativeInfinity);return await this.featureStore.forEachBounds(e,e=>h.expandWithAABB(s,e)),k(s,t,r,this.spatialReference,this.hasZ)}_getFullExtent(){return this._fullExtentPromise||="getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getAllFeatures().then(e=>this._getBounds(e,this.spatialReference,this.spatialReference)),this._fullExtentPromise}async schedule(e,t){return this._frameTask?.schedule(e,t)??e(C.noBudget)}async reschedule(e,t){return this._frameTask?.reschedule(e,t)??e(C.noBudget)}async _getAllFeaturesQueryEngineResult(e){return new w.QueryEngineResult(await this._getAllFeatures(),e,this)}async _getAllFeatures(){if(null==this._allFeaturesPromise){const e=[];this._allFeaturesPromise=(async()=>await this.featureStore.forEach(t=>e.push(t)))().then(()=>r.toConst(e))}const e=this._allFeaturesPromise,t=await e;return e===this._allFeaturesPromise?t.slice():this._getAllFeatures()}async _executeQuery(e,t,r){e=n.clone(e),e=await this.schedule(()=>v.normalizeQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>M.validateQuery(e,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r),e={...e,...t};const s=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r),i=await this.reschedule(()=>this._executeGeometryQuery(e,s,r),r);return await this.reschedule(()=>this._executeAggregateIdsQuery(i),r),await this.reschedule(()=>this.executeObjectIdsQuery(i),r),await this.reschedule(()=>this.executeTimeQuery(i),r),await this.reschedule(()=>this.executeAttributesQuery(i),r),i}async _executeSceneFilterQuery(e,t){if(null==e.sceneFilter)return null;const{outSR:r,returnGeometry:s,returnCentroid:i}=e,n=this.featureStore.featureSpatialReference,o=e.sceneFilter.geometry,a=null==n||m.equals(n,o.spatialReference)?o:b.project(o,n);if(!a)return null;const l=s||i,c=m.isValid(r)&&!m.equals(this.spatialReference,r)&&l?async e=>this._project(e,r):e=>e,u=this.featureAdapter,h=await this.reschedule(()=>this.searchFeatures(F(a)),t);if("disjoint"===e.sceneFilter.spatialRelationship){if(!h.length)return null;const r=new Set;for(const e of h)r.add(u.getObjectId(e));const s=await this.reschedule(()=>this._getAllFeatures(),t);return c(await this.reschedule(async()=>{const i=await I.getSpatialQueryOperator("esriSpatialRelDisjoint",a,this.geometryType,this.hasZ,this.hasM),n=await this.runSpatialFilter(s,e=>!r.has(u.getObjectId(e))||i(u.getGeometry(e)),t);return new w.QueryEngineResult(n,e,this)},t))}if(!h.length)return new w.QueryEngineResult([],e,this);if(this._canExecuteSinglePass(a,e))return c(new w.QueryEngineResult(h,e,this));const d=await I.getSpatialQueryOperator("esriSpatialRelContains",a,this.geometryType,this.hasZ,this.hasM),p=await this.runSpatialFilter(h,e=>d(u.getGeometry(e)),t);return c(new w.QueryEngineResult(p,e,this))}async _executeGeometryQuery(e,r,s){if(null!=r&&0===r.items.length)return r;const{geometry:i,outSR:n,returnGeometry:o,returnCentroid:a}=e,l=r?null:this._getCacheKey(e),c=l?this._cache.get(l):null;if(c)return new w.QueryEngineResult(c,e,this);const u=m.isValid(n)&&!m.equals(this.spatialReference,n),h=o||a,d=async e=>(u&&h&&await this._project(e,n),l&&this._cache.put(l,e.items),e),p=this.featureStore.featureSpatialReference,f=!i||null==p||m.equals(p,i.spatialReference)?i:b.project(i,p);if(!f)return d(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const g=this.featureAdapter;let y=await this.reschedule(()=>this.searchFeatures(F(i)),s);const _=e.spatialRel??"esriSpatialRelIntersects";if("esriSpatialRelDisjoint"===_){if(!y.length)return d(null!=r?r:await this._getAllFeaturesQueryEngineResult(e));const t=new Set;for(const e of y)t.add(g.getObjectId(e));const i=null!=r?r.items:await this.reschedule(()=>this._getAllFeatures(),s);return d(await this.reschedule(async()=>{const r=await I.getSpatialQueryOperator(_,f,this.geometryType,this.hasZ,this.hasM),n=await this.runSpatialFilter(i,e=>!t.has(g.getObjectId(e))||r(g.getGeometry(e)),s);return new w.QueryEngineResult(n,e,this)},s))}if(null!=r){const e=new t.PositionHint;y=y.filter(s=>t.indexOf(r.items,s,r.items.length,e)>=0)}if(!y.length){const t=new w.QueryEngineResult([],e,this);return l&&this._cache.put(l,t.items),t}if(this._canExecuteSinglePass(f,e))return d(new w.QueryEngineResult(y,e,this));const S=await I.getSpatialQueryOperator(_,f,this.geometryType,this.hasZ,this.hasM),x=await this.runSpatialFilter(y,e=>S(g.getGeometry(e)),s);return d(new w.QueryEngineResult(x,e,this))}_executeAggregateIdsQuery(e){if(0===e.items.length||!e.query.aggregateIds?.length||null==this.aggregateAdapter)return;const t=new Set;for(const r of e.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(r).forEach(e=>t.add(e));const r=this.featureAdapter.getObjectId;e.items=e.items.filter(e=>t.has(r(e)))}executeObjectIdsQuery(e){if(0===e.items.length||!e.query.objectIds?.length)return;const t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter(e=>t.has(r(e)))}executeTimeQuery(e){if(0===e.items.length)return;const t=P.getTimeOperator(this.timeInfo,e.query.timeExtent,this.featureAdapter);null!=t&&(e.items=e.items.filter(t))}executeAttributesQuery(e){if(0===e.items.length)return;const t=y.getWhereClause(e.query.where,this.fieldsIndex);if(t){if(!t.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter(e=>t.testFeature(e,this.featureAdapter))}}async runSpatialFilter(e,t,r){if(!t)return e;if(null==this._frameTask)return e.filter(e=>t(e));let s=0;const i=new Array,n=async o=>{for(;s<e.length;){const a=e[s++];t(a)&&(i.push(a),o.madeProgress()),o.done&&await this.reschedule(e=>n(e),r)}};return this.reschedule(e=>n(e),r).then(()=>i)}_filterLatest(e){const{trackIdField:t,startTimeField:r,endTimeField:s}=this.timeInfo,i=s||r,n=new Map,o=this.featureAdapter.getAttribute;for(const r of e.items){const e=o(r,t),s=o(r,i),a=n.get(e);(!a||s>o(a,i))&&n.set(e,r)}e.items=Array.from(n.values())}_getCacheKey(e){const{geometry:t,spatialRel:r,returnGeometry:s,returnCentroid:i,outSR:n,resultType:o,cacheHint:a}=e;if("tile"!==o&&!a)return null;const l=s||i;return m.isValid(n)&&!m.equals(this.spatialReference,n)&&l?JSON.stringify([t,r,n]):JSON.stringify([t,r])}_canExecuteSinglePass(e,t){const{spatialRel:r}=t;return I.canQueryWithRBush(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r))}async _project(e,t){if(!t||m.equals(this.spatialReference,t))return e;const s=this.featureAdapter;let i;try{const e=await this._getFullExtent();i=u.getTransformation(this.spatialReference,t,e)}catch{}const n=await b.projectMany(e.items.map(e=>_.getGeometry(this.geometryType,this.hasZ,this.hasM,s.getGeometry(e))),this.spatialReference,t,i);return e.items=r.toConst(n.map((t,r)=>s.cloneWithGeometry(e.items[r],g.convertFromGeometry(t,this.hasZ,this.hasM)))),e}async searchFeatures(e){const t=new Set;await Promise.all(e.map(e=>this.featureStore.forEachInBounds(e,e=>t.add(e))));const r=Array.from(t.values());return t.clear(),r}async _executeQueryForStatistics(e,t,r){e=n.clone(e);try{e=await this.schedule(()=>v.normalizeQuery(e,this.definitionExpression,this.spatialReference),r),e=await this.reschedule(()=>M.validateStatisticsQuery(e,t,{availableFields:this.availableFields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,spatialReference:this.spatialReference}),r);const s=await this.reschedule(()=>this._executeSceneFilterQuery(e,r),r),i=await this.reschedule(()=>this._executeGeometryQuery(e,s,r),r);return await this.reschedule(()=>this._executeAggregateIdsQuery(i),r),await this.reschedule(()=>this.executeObjectIdsQuery(i),r),await this.reschedule(()=>this.executeTimeQuery(i),r),await this.reschedule(()=>this.executeAttributesQuery(i),r),i}catch(t){if(t!==v.queryEngineEmptyResult)throw t;return new w.QueryEngineResult([],e,this)}}get test(){}},e.getQueryBBoxes=F,e.getQueryResultExtent=k,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache","../../support/fieldType"],function(e,t,r,s){"use strict";const i=new r.WhereClauseCache(50,500),n="unsupported-query",o=" as ",a=new Set(["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeBigInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"]),l=new Set(["esriFieldTypeDate","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"]),c=new Set(["esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...a,...l]);function u(e,r,s={}){const o=h(r,e);if(!o){const s=i.getError(r,e);throw new t(n,"invalid SQL expression",{expression:r,error:s})}const a=s.expressionName||"expression";if(s.validateStandardized&&!o.isStandardized)throw new t(n,`${a} is not standard`,{expression:r});if(s.validateAggregate&&!o.isAggregate)throw new t(n,`${a} does not contain a valid aggregate function`,{expression:r});return o.fieldNames}function h(e,t){return e?i.get(e,t):null}function d(e){return/\((.*?)\)/.test(e)?e:e.split(o)[0]}function p(e,r,s,i={}){const o=new Map;if(function(e,t,r,s,i){const n=i.includes("*")?[...r,...i.filter(e=>"*"!==e)]:i;for(const i of n)if(t.get(i))f(e,t,r,s,i);else try{const n=u(t,d(i),{validateStandardized:!0});for(const i of n)f(e,t,r,s,i)}catch(t){e.set(i,{type:"expression-error",expression:i,error:t})}}(o,e,r,i.allowedFieldTypes??c,s),o.size){const e=i.expressionName??"expression";throw new t(n,`${e} contains invalid or missing fields`,{errors:Array.from(o.values()),query:i.query})}}function f(e,t,r,i,n){const o=t.get(n);o?r.has(o.name)?"all"!==i&&!1===i?.has(o.type)&&e.set(n,{type:"invalid-type",fieldName:o.name,fieldType:s.kebabDict.fromJSON(o.type),allowedFieldTypes:Array.from(i,e=>s.kebabDict.fromJSON(e))}):e.set(n,{type:"missing-field",fieldName:o.name}):e.set(n,{type:"invalid-field",fieldName:n})}e.allDateAndTimeFieldTypes=l,e.getAliasFromFieldName=function(e){return e.split(o)[1]},e.getExpressionFromFieldName=d,e.getWhereClause=h,e.numericFieldTypes=a,e.validateFields=p,e.validateHaving=function(e,r,s,i,o){if(!s)return!0;const a="having clause",l=u(e,s,{validateAggregate:!0,expressionName:a});p(e,r,l,{expressionName:a,query:o});const c=h(s,e),d=c?.getExpressions().every(t=>{const{aggregateType:r,field:s}=t,n=e.get(s)?.name;return i.some(t=>{const{onStatisticField:s,statisticType:i}=t,o=e.get(s)?.name;return o===n&&i.toLowerCase().trim()===r})});if(!d)throw new t(n,"expressions in having clause should also exist in outStatistics",{having:s});return!0},e.validateWhere=function(e,t,r,s){if(!r)return!0;const i="where clause";return p(e,t,u(e,r,{validateStandardized:!0,expressionName:i}),{expressionName:i,query:s}),!0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../LRUCache","./WhereClause"],function(e,t,r){"use strict";e.WhereClauseCache=class{constructor(e,r){this._cache=new t.LRUCache(e),this._invalidCache=new t.LRUCache(r)}get(e,t){const s=`${t?.uid}:${e}`,i=this._cache.get(s);if(i)return i;if(null!=this._invalidCache.get(s))return null;try{const i=r.create(e,{fieldsIndex:t});return this._cache.put(s,i),i}catch(e){return this._invalidCache.put(s,e),null}}getError(e,t){const r=`${t?.uid}:${e}`;return this._invalidCache.get(r)??null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/LRUCache":function(){define(["exports","./MemCache"],function(e,t){"use strict";e.LRUCache=class{constructor(e,r){this.removeFunc=r,this._storage=new t.MemCacheStorage,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy(),this._storage=null}put(e,t,r=1){this._storage.put(this,e,t,r,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/MemCache":function(){define(["exports","./has"],function(e,t){"use strict";const r=!!t("esri-tests-disable-gpu-memory-measurements");class s{constructor(e,t,r,s=0){this.name=e,this._storage=t,this.removeFunc=r,this._defaultPriority=s,this.id=`${i++}${o}`,this.size=0,this._hit=0,this._miss=0,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage=null}get hitRate(){return this._hit/(this._hit+this._miss)}get storageSize(){return this._storage.size}getSize(e){return this._storage.getSize(this,e)}set maxSize(e){this._storage.setMaxSize(this,e)}resetHitRate(){this._hit=this._miss=0}put(e,t,r=this._defaultPriority){this._storage.put(this,e,t,t.cachedMemory,r)}pop(e){const t=this._storage.pop(this,e);return void 0===t?++this._miss:++this._hit,t}get(e){const t=this._storage.get(this,e);return void 0===t?++this._miss:++this._hit,t}peek(e){return this._storage.peek(this,e)}updateSize(e,t){this._storage.updateSize(this,e,t,t.cachedMemory)}clear(){this._storage.clear(this)}clearAll(){this._storage.clearAll()}*[Symbol.iterator](){yield*this._storage.values(this)}get performanceInfo(){return this._storage.performanceInfo}resetStats(){this._storage.resetStats()}}let i=0;class n{constructor(e,t,r){this.entry=e,this.size=t,this.lifetime=r,this.lives=r}}const o=":";e.MemCache=s,e.MemCacheStorage=class{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear(),this._db=null}register(e){this._users.set(e.id.slice(0,-1),e)}deregister(e){this.clear(e),this._sizeLimits.delete(e),this._users.delete(e.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const r=this._db.get(e.id+t);return r?.size??0}put(e,t,s,i,o){t=e.id+t;const a=this._db.get(t);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(t),a.entry!==s&&this._notifyRemove(t,a.entry,a.size,0)),i>this._maxSize)return void this._notifyRemove(t,s,i,0);if(void 0===s)return void console.warn("Refusing to cache undefined entry ");if(!i||i<0)return r||console.warn(`Refusing to cache entry with size ${i} for key ${t}`),void this._notifyRemove(t,s,0,0);const l=1+Math.max(o,-4)- -3;this._db.set(t,new n(s,i,l)),this._size+=i,e.size+=i,this._checkSize()}updateSize(e,t,r,s){t=e.id+t;const i=this._db.get(t);if(i&&i.entry===r){for(this._size-=i.size,e.size-=i.size;s>this._maxSize;){const e=this._notifyRemove(t,r,s,1);if(!(null!=e&&e>0))return void this._db.delete(t);s=e}i.size=s,this._size+=s,e.size+=s,this._checkSize()}}pop(e,t){t=e.id+t;const r=this._db.get(t);if(r)return this._size-=r.size,e.size-=r.size,this._db.delete(t),++this._hit,r.entry;++this._miss}get(e,t){t=e.id+t;const r=this._db.get(t);if(void 0!==r)return this._db.delete(t),r.lives=r.lifetime,this._db.set(t,r),++this._hit,r.entry;++this._miss}peek(e,t){const r=this._db.get(e.id+t);return r?++this._hit:++this._miss,r?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},r=new Array;this._db.forEach((e,s)=>{const i=e.lifetime;r[i]=(r[i]||0)+e.size,this._users.forEach(r=>{const{id:i,name:n}=r;if(s.startsWith(i)){const r=t[n]||0;t[n]=r+e.size}})});const s={};this._users.forEach(e=>{const r=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const i=t[r]||0;t[r]=i,s[r]=Math.round(100*e.hitRate)+"%"}else s[r]="0%"});const i=Object.keys(t);i.sort((e,r)=>t[r]-t[e]),i.forEach(r=>e[r]=Math.round(t[r]/2**20)+"MB / "+s[r]);for(let t=r.length-1;t>=0;--t){const s=r[t];s&&(e["Priority "+(t+-3-1)]=Math.round(s/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEach(e=>e.resetHitRate())}clear(e){const t=e.id;this._db.forEach((e,r)=>{r.startsWith(t)&&(this._size-=e.size,this._db.delete(r),this._notifyRemove(r,e.entry,e.size,0))}),e.size=0}clearAll(){this._db.forEach((e,t)=>this._notifyRemove(t,e.entry,e.size,0)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}*values(e){for(const[t,r]of this._db)t.startsWith(e.id)&&(yield r.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,r,s){const i=this._users.get(e.split(o)[0])?.removeFunc,n=i?.(t,s,r);return"number"==typeof n?n:null}_checkSize(){this._sizeLimits.forEach((e,t)=>this._checkSizeLimits(e,t)),this._checkSizeLimits(this.maxSize)}setMaxSize(e,t){null==t||t<=0?this._sizeLimits.delete(e):this._sizeLimits.set(e,t)}_checkSizeLimits(e,t){const r=t??this;if(r.size<=e)return;const s=t?.id;let i=!0;for(;i;){i=!1;for(const[n,a]of this._db)if(0===a.lifetime&&(!s||n.startsWith(s))){const s=t??this._users.get(n.split(o)[0]);if(this._purgeItem(n,a,s),r.size<=.9*e)return;i||=this._db.has(n)}}for(const[i,n]of this._db)if(!s||i.startsWith(s)){const s=t??this._users.get(i.split(o)[0]);if(this._purgeItem(i,n,s),r.size<=.9*e)return}}_purgeItem(e,t,r){if(this._db.delete(e),t.lives<=1){this._size-=t.size,r&&(r.size-=t.size);const s=this._notifyRemove(e,t.entry,t.size,1);null!=s&&s>0&&(this._size+=s,r&&(r.size+=s),t.lives=t.lifetime,t.size=s,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}},e.MinPriority=-3,e.NoPriority=-4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/geometryUtils":function(){define(["exports","../featureConversionUtils","../OptimizedGeometry"],function(e,t,r){"use strict";const s=new r,i=new r,n=new r,o={esriGeometryPoint:t.convertToPoint,esriGeometryPolyline:t.convertToPolyline,esriGeometryPolygon:t.convertToPolygon,esriGeometryMultipoint:t.convertToMultipoint},a="_geVersion",l=(e,t)=>e===a?void 0:t;e.cleanFromGeometryEngine=function(e){return e&&a in e?JSON.parse(JSON.stringify(e,l)):e},e.getGeometry=function(e,r,a,l,c,u,h=r,d=a){const p=r&&h,f=a&&d,m=null!=l?"coords"in l?l:l.geometry:null;if(null==m)return null;if(c){let s=t.generalizeOptimizedGeometry(i,m,r,a,e,c,h,d);return u&&(s=t.quantizeOptimizedGeometry(n,s,p,f,e,u)),o[e]?.(s,p,f)??null}if(u){const s=t.quantizeOptimizedGeometry(n,m,r,a,e,u,h,d);return o[e]?.(s,p,f)??null}return t.removeZMValues(s,m,r,a,h,d),o[e]?.(s,p,f)??null},e.transformCentroid=function(e,r,s,i=e.hasZ,o=e.hasM){if(null==r)return null;const a=e.hasZ&&i,l=e.hasM&&o;if(s){const c=t.quantizeOptimizedGeometry(n,r,e.hasZ,e.hasM,"esriGeometryPoint",s,i,o);return t.convertToPoint(c,a,l)}return t.convertToPoint(r,a,l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCache":function(){define(["exports","../../../core/has"],function(e,t){"use strict";let r=0;class s{constructor(e){this.items=e,this.time=performance.now(),this.id=r++}}e.QueryEngineCache=class{constructor(){this._storage=new Map,this._purgeInterval=5,this._sweep=()=>{if(this._timer=void 0,!this._storage)return;const e=1e3*this._purgeInterval,t=performance.now()-e;for(const[r,s]of this._storage){if(!(s.time<t))return void(this._storage.size>0&&(this._timer=setTimeout(this._sweep,e)));this._storage.delete(r)}}}destroy(){this._storage?.clear(),this._storage=null,clearTimeout(this._timer)}put(e,t){this._storage?.set(e,new s(t)),this._scheduleSweep()}get(e){const t=this._storage?.get(e);if(t)return this._storage?.delete(e),t.time=performance.now(),this._storage?.set(e,t),t.items}clear(){this._storage?.clear()}_scheduleSweep(){this._storage&&(this._timer??=setTimeout(this._sweep,1e3*this._purgeInterval))}get test(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(e){"use strict";e.queryBinsCapabilities={supportsDate:!0,supportsFixedInterval:!0,supportsAutoInterval:!0,supportsFixedBoundaries:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!0,supportedStatistics:{count:!0,sum:!0,avg:!0,var:!0,stddev:!0,min:!0,max:!0,percentileContinuous:!0,percentileDiscrete:!0,envelope:!0,centroid:!0,convexHull:!0},supportedNormalizationTypes:{field:!0,log:!0,naturalLog:!0,percentOfTotal:!0,squareRoot:!0}},e.queryCapabilities={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!0,supportsCurrentUser:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsPaginationOnAggregatedQueries:!1,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!0,supportsReturnMesh:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByAnonymous:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0,supportsTrueCurve:!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define(["require","exports","../../../core/lang","../../../geometry/support/centroid","../../../geometry/support/extentUtils","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","./AttributesBuilder","./geometryUtils","./projectionSupport","./queryUtils","./SnappingCandidate","../../support/fieldUtils","../../../rest/support/AutoIntervalBinParameters","../../../rest/support/DateBinParameters","../../../rest/support/DateBinUtils","../../../rest/support/FixedBoundariesBinParameters","../../../rest/support/FixedIntervalBinParameters","../../../statistics/utils","../../../time/constants","../../../chunks/datetime"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_,b,S){"use strict";const x="bin";function w(e,t,r,s){const i=s.x-r.x,n=s.y-r.y,o=t.x-r.x,a=t.y-r.y,l=i*i+n*n;if(0===l)return!1;const c=o*i+a*n,u=Math.min(1,Math.max(0,c/l));return e.x=r.x+i*u,e.y=r.y+n*u,!0}function v(e,t){return e?t?4:3:t?3:2}class M{constructor(e,t){this.coords=e,this.coordsIndex=t}get x(){return this.coords[this.coordsIndex]}get y(){return this.coords[this.coordsIndex+1]}get z(){return this.coords[this.coordsIndex+2]}}const I=[1];t.QueryEngineResult=class{constructor(e,t,r){this.items=e,this.query=t,this.geometryType=r.geometryType,this.hasM=r.hasM,this.hasZ=r.hasZ,this.fieldsIndex=r.fieldsIndex,this.objectIdField=r.objectIdField,this.spatialReference=r.spatialReference,this.featureAdapter=r.featureAdapter}get size(){return this.items.length}createQueryResponseForCount(){const e=new a(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return e.countDistinctValues(this.items);const{groupByFieldsForStatistics:t,having:r,outStatistics:s}=this.query,i=t?.length;if(!i)return 1;const n=new Map,o=new Map,l=new Set;for(const i of s){const{statisticType:s}=i,a="exceedslimit"!==s?i.onStatisticField:void 0;if(!o.has(a)){const r=[];for(const s of t){const t=this._getAttributeValues(e,s,this.items,n);r.push(t)}o.set(a,this._calculateUniqueValues(r,this.items,e.returnDistinctValues))}const c=o.get(a);for(const t in c){const{data:s,items:i}=c[t],n=s.join(",");r&&!e.validateItems(i,r)||l.add(n)}}return l.size}async createQueryResponse(){let e;if(e=this.query.outStatistics?this.query.outStatistics.some(e=>"exceedslimit"===e.statisticType)?this._createExceedsLimitQueryResponse():await this._createStatisticsQueryResponse(this.query,this.items):this._createFeatureQueryResponse(this.query),this.query.returnQueryGeometry){const t=this.query.geometry;o.isValid(this.query.outSR)&&!o.equals(t.spatialReference,this.query.outSR)?e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...c.project(t,t.spatialReference,this.query.outSR)}):e.queryGeometry=l.cleanFromGeometryEngine({spatialReference:this.query.outSR,...t})}return e}createSnappingResponse(e,t,r){const s=this.featureAdapter,i=v(this.hasZ,this.hasM),{point:n,mode:o}=e,a="number"==typeof e.distance?e.distance:e.distance.x,l="number"==typeof e.distance?e.distance:e.distance.y,c={candidates:[]},u="esriGeometryPolygon"===this.geometryType,d="esriGeometryPolyline"===this.geometryType||"esriGeometryPoint"===this.geometryType,p=this._getPointCreator(o,t,this.spatialReference,r),f=new M(null,0),m=new M(null,0),g={x:0,y:0,z:0};for(const t of this.items){const r=s.getGeometry(t);if(null==r)continue;const{coords:o}=r,y=r.isPoint?I:r.lengths;if(f.coords=o,m.coords=o,e.returnEdge){let e=0;for(let r=0;r<y.length;r++){const o=y[r],d=e;for(let r=0;r<o;r++,e+=i){if(!u&&r===o-1)continue;const y=f;y.coordsIndex=e;const _=m;_.coordsIndex=r===o-1?d:e+i;const b=g;if(!w(g,n,y,_))continue;const S=(n.x-b.x)/a,x=(n.y-b.y)/l,v=S*S+x*x;v<=1&&c.candidates.push(h.makeEdgeCandidate(s.getObjectId(t),p(b),Math.sqrt(v),p(y),p(_)))}}}if("all"===e.vertexMode){let e=0;for(let r=0;r<y.length;r++){const o=y[r],d=e,g=m;g.coordsIndex=d;for(let r=0;r<o;r++,e+=i){const i=f;if(i.coordsIndex=e,u&&r===o-1&&i.x===g.x&&i.y===g.y)continue;const d=(n.x-i.x)/a,m=(n.y-i.y)/l,y=d*d+m*m;y<=1&&c.candidates.push(h.makeVertexCandidate(s.getObjectId(t),p(i),Math.sqrt(y)))}}}else if(d&&"ends"===e.vertexMode){let e=0;const r=[];for(let t=0;t<y.length;t++){r.push(e);const s=y[t];e+=s*i,!u&&s>1&&r.push(e-i)}for(const e of r){const r=f;r.coordsIndex=e;const i=(n.x-r.x)/a,o=(n.y-r.y)/l,u=i*i+o*o;u<=1&&c.candidates.push(h.makeVertexCandidate(s.getObjectId(t),p(r),Math.sqrt(u)))}}}return c.candidates.sort((e,t)=>e.distance-t.distance),c}_getPointCreator(e,t,r,s){const i=null==s||o.equals(r,s)?e=>e:e=>c.project(e,r,s),{hasZ:n}=this;return"3d"===e?n&&t?({x:e,y:t,z:r})=>i({x:e,y:t,z:r}):({x:e,y:t})=>i({x:e,y:t,z:0}):({x:e,y:t})=>i({x:e,y:t})}async createSummaryStatisticsResponse(e){const{field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,minValue:o,maxValue:a,scale:l,timeZone:c,outStatisticTypes:u}=e,h=this.fieldsIndex.get(t),p=d.isDateField(h)||d.isDateOnlyField(h)||d.isTimestampOffsetField(h),f=await this._getDataValues({field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,scale:l,timeZone:c},this.items),m=_.isNullCountSupported({normalizationType:i,normalizationField:s,minValue:o,maxValue:a}),g={value:.5,fieldType:h?.type},y=d.isStringField(h)?_.calculateStringStatistics({values:f,supportsNullCount:m,percentileParams:g,outStatisticTypes:u}):_.calculateStatistics({values:f,minValue:o,maxValue:a,useSampleStdDev:!i,supportsNullCount:m,percentileParams:g,outStatisticTypes:u});return _.processSummaryStatisticsResult(y,u,p)}async createUniqueValuesResponse(e){const{field:t,valueExpression:r,domains:s,returnAllCodedValues:i,scale:n,timeZone:o}=e,a=await this._getDataValues({field:t,field2:e.field2,field3:e.field3,fieldDelimiter:e.fieldDelimiter,valueExpression:r,scale:n,timeZone:o},this.items,!1),l=_.calculateUniqueValuesCount(a);return _.createUVResult(l,s,i,e.fieldDelimiter)}async createClassBreaksResponse(e){const{field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:c,numClasses:u,scale:h,timeZone:d}=e,p=await this._getDataValues({field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,scale:h,timeZone:d},this.items),f=_.calculateClassBreaks(p,{field:t,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:c,numClasses:u});return _.resolveCBResult(f,o)}async createHistogramResponse(e){const{field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:c,numBins:u,scale:h,timeZone:d}=e,p=await this._getDataValues({field:t,valueExpression:r,normalizationField:s,normalizationType:i,normalizationTotal:n,scale:h,timeZone:d},this.items);return _.calculateHistogram(p,{field:t,normalizationField:s,normalizationType:i,normalizationTotal:n,classificationMethod:o,standardDeviationInterval:a,minValue:l,maxValue:c,numBins:u})}_sortFeatures(e,t,r){if(e.length>1&&t?.length)for(const s of t.slice().reverse()){const t=s.split(" "),i=t[0],n=this.fieldsIndex.get(i),o=!!t[1]&&"desc"===t[1].toLowerCase(),a=_.getAttributeComparator(n?.type,o);e.sort((e,t)=>{const s=r(e,i,n),o=r(t,i,n);return a(s,o)})}}_createFeatureQueryResponse(e){const{items:t,geometryType:r,hasM:s,hasZ:i,objectIdField:o,spatialReference:a}=this,{outFields:c,outSR:u,quantizationParameters:h,resultRecordCount:d,resultOffset:p,returnZ:f,returnM:m}=e,g=null!=d&&t.length>(p||0)+d,y=c&&(c.includes("*")?[...this.fieldsIndex.fields]:c.map(e=>this.fieldsIndex.get(e)));return{exceededTransferLimit:g,features:this._createFeatures(e,t),fields:y,geometryType:r,hasM:s&&m,hasZ:i&&f,objectIdFieldName:o,spatialReference:l.cleanFromGeometryEngine(u||a),transform:h&&n.toQuantizationTransform(h)||null}}_createFeatures(e,t){const r=new a(e,this.featureAdapter,this.fieldsIndex),{hasM:s,hasZ:i}=this,{orderByFields:o,quantizationParameters:c,returnGeometry:u,returnCentroid:h,maxAllowableOffset:d,resultOffset:p,resultRecordCount:f,returnZ:m=!1,returnM:g=!1}=e,y=i&&m,_=s&&g;let b=[],S=0;const x=[...t];if(this._sortFeatures(x,o,(e,t,s)=>r.getFieldValue(e,t,s)),this.geometryType&&(u||h)){const e=n.toQuantizationTransform(c)??void 0,t="esriGeometryPolygon"===this.geometryType||"esriGeometryPolyline"===this.geometryType;if(u&&!h)for(const s of x){const i=this.featureAdapter.getGeometry(s),n={attributes:r.getAttributes(s),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,i,d,e,y,_),metadata:this.featureAdapter.getMetadata?.(s)};t&&i&&!n.geometry&&(n.centroid=l.transformCentroid(this,this.featureAdapter.getCentroid(s,this),e)),b[S++]=n}else if(!u&&h)for(const t of x)b[S++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e)};else for(const t of x)b[S++]={attributes:r.getAttributes(t),centroid:l.transformCentroid(this,this.featureAdapter.getCentroid(t,this),e),geometry:l.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(t),d,e,y,_),metadata:this.featureAdapter.getMetadata?.(t)}}else for(const e of x){const t=r.getAttributes(e);t&&(b[S++]={attributes:t})}const w=p||0;if(null!=f){const e=w+f;b=b.slice(w,Math.min(b.length,e))}return b}_createExceedsLimitQueryResponse(){let e=!1,t=Number.POSITIVE_INFINITY,r=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY;for(const e of this.query.outStatistics??[])if("exceedslimit"===e.statisticType){t=null!=e.maxPointCount?e.maxPointCount:Number.POSITIVE_INFINITY,r=null!=e.maxRecordCount?e.maxRecordCount:Number.POSITIVE_INFINITY,s=null!=e.maxVertexCount?e.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)e=this.items.length>t;else if(this.items.length>r)e=!0;else{const t=v(this.hasZ,this.hasM),r=this.featureAdapter;e=this.items.reduce((e,t)=>{const s=r.getGeometry(t);return e+(null!=s&&s.coords.length||0)},0)/t>s}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(e)}}]}}async _createStatisticsQueryResponse(e,t,r={attributes:{}}){const s=[],i=new Map,n=new Map,o=new Map,l=new Map,c=new a(e,this.featureAdapter,this.fieldsIndex),u=e.outStatistics,{groupByFieldsForStatistics:h,having:p,orderByFields:f,resultRecordCount:m}=e,g=h?.length,y=!!g,_=y?h[0]:null,b=y&&!this.fieldsIndex.get(_);for(const e of u??[]){const{outStatisticFieldName:a,statisticType:u}=e,f=e,m="exceedslimit"!==u?e.onStatisticField:void 0,S="percentile_disc"===u||"percentile_cont"===u,x="EnvelopeAggregate"===u||"CentroidAggregate"===u||"ConvexHullAggregate"===u,w=y&&1===g&&(m===_||b)&&"count"===u;if(y){if(!o.has(m)){const e=[];for(const r of h){const s=this._getAttributeValues(c,r,t,i);e.push(s)}o.set(m,this._calculateUniqueValues(e,t,!x&&c.returnDistinctValues))}const e=o.get(m);if(!e)continue;const r=Object.keys(e);for(const s of r){const{count:r,data:n,items:o,itemPositions:u}=e[s],d=n.join(",");if(!p||c.validateItems(o,p)){const e=l.get(d)||{attributes:{}};if(x){e.aggregateGeometries||(e.aggregateGeometries={});const{aggregateGeometries:t,outStatisticFieldName:r}=await this._getAggregateGeometry(f,o);e.aggregateGeometries[r]=t}else{let s=null;if(w)s=r;else{const e=this._getAttributeValues(c,m,t,i),r=u.map(t=>e[t]);s=S&&"statisticParameters"in f?this._getPercentileValue(f,r):this._getStatisticValue(f,r,null,c.returnDistinctValues)}e.attributes[a]=s}let s=0;h.forEach((t,r)=>e.attributes[this.fieldsIndex.get(t)?t:"EXPR_"+ ++s]=n[r]),l.set(d,e)}}}else if(x){r.aggregateGeometries||(r.aggregateGeometries={});const{aggregateGeometries:e,outStatisticFieldName:s}=await this._getAggregateGeometry(f,t);r.aggregateGeometries[s]=e}else{const e=this._getAttributeValues(c,m,t,i);r.attributes[a]=S&&"statisticParameters"in f?this._getPercentileValue(f,e):this._getStatisticValue(f,e,n,c.returnDistinctValues)}const v="min"!==u&&"max"!==u||!d.isStringField(this.fieldsIndex.get(m))&&!this._isAnyDateField(m)?null:this.fieldsIndex.get(m)?.type;s.push({name:a,alias:a,type:v||"esriFieldTypeDouble"})}const S=y?Array.from(l.values()):[r];return this._sortFeatures(S,f,(e,t)=>e.attributes[t]),m&&(S.length=Math.min(m,S.length)),{fields:s,features:S}}_isAnyDateField(e){const t=this.fieldsIndex.get(e);return d.isDateField(t)||d.isDateOnlyField(t)||d.isTimestampOffsetField(t)||d.isTimeOnlyField(t)}async _getAggregateGeometry(t,r){const{convexHull:n,union:o}=await new Promise((t,r)=>e(["../../../geometry/geometryEngineJSON"],t,r)),{statisticType:a,outStatisticFieldName:c}=t,{featureAdapter:u,spatialReference:h,geometryType:d,hasZ:p,hasM:f}=this,m=r.map(e=>l.getGeometry(d,p,f,u.getGeometry(e))),g=n(h,m,!0)[0],y={aggregateGeometries:null,outStatisticFieldName:null};if("EnvelopeAggregate"===a){const e=g?i.getPolygonExtent(g):i.getGeometryExtent(o(h,m));y.aggregateGeometries={...e,spatialReference:h},y.outStatisticFieldName=c||"extent"}else if("CentroidAggregate"===a){const e=g?s.polygonCentroid(g):s.extentCentroid(i.getGeometryExtent(o(h,m)));y.aggregateGeometries={x:e[0],y:e[1],spatialReference:h},y.outStatisticFieldName=c||"centroid"}else"ConvexHullAggregate"===a&&(y.aggregateGeometries=g,y.outStatisticFieldName=c||"convexHull");return y}_getStatisticValue(e,t,r,s){const{onStatisticField:i,statisticType:n}=e;let o=null;return o=r?.has(i)?r.get(i):d.isStringField(this.fieldsIndex.get(i))||this._isAnyDateField(i)?_.calculateStringStatistics({values:t,returnDistinct:s}):_.calculateStatistics({values:s?[...new Set(t)]:t,minValue:null,maxValue:null,useSampleStdDev:!0}),r&&r.set(i,o),o["var"===n?"variance":n]}_getPercentileValue(e,t){const{onStatisticField:r,statisticParameters:s,statisticType:i}=e,{value:n,orderBy:o}=s,a=this.fieldsIndex.get(r),l={value:n,orderBy:o,fieldType:a?.type,isDiscrete:"percentile_disc"===i};return _.calculatePercentile(t,l)}_getAttributeValues(e,t,r,s){if(s.has(t))return s.get(t);const i=this.fieldsIndex.get(t),n=r.map(r=>e.getFieldValue(r,t,i));return s.set(t,n),n}_calculateUniqueValues(e,t,r){const s={},i=t.length;for(let n=0;n<i;n++){const i=t[n],o=[];for(const t of e)o.push(t[n]);const a=o.join(",");null==s[a]?s[a]={count:1,data:o,items:[i],itemPositions:[n]}:(r||s[a].count++,s[a].items.push(i),s[a].itemPositions.push(n))}return s}async _getDataValues(e,t,s=!0){const i=new a(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:n,scale:o,timeZone:l}=e;return n?i.getExpressionValues(t,n,{viewingMode:"map",scale:o,spatialReference:this.query.outSR||this.spatialReference},{geometryType:this.geometryType,hasZ:this.hasZ,hasM:this.hasM},l):i.getDataValues(t,r.clone(e),s)}_calculateHistogramBins(e,t,r){if(null==t.min&&null==t.max)return[];const s=t.intervals,i=t.min??0,n=t.max??0,o=s.map(([e,t])=>({minValue:e,maxValue:t,count:0,items:[]}));for(let t=0;t<e.length;t++){const a=e[t],l=r[t];if(null!=a&&a>=i&&a<=n){const e=_.binIndex(s,a);e>-1&&(o[e].count++,o[e].items.push(l))}}return o}async createQueryBinsResponse(e){const t=e.bin?.splitBy;if(!t)return this._createBinsResponse(e);const{value:r,outAlias:s,valueType:i}=t,n=[],o=[{name:s??r,alias:s??r,type:i??"esriFieldTypeString"},{name:x,alias:x,type:"esriFieldTypeInteger"}],l=new a(e,this.featureAdapter,this.fieldsIndex),c=new Map,u=[...this.items];this._sortFeatures(u,[r],(e,t,r)=>l.getFieldValue(e,t,r));const h=this._getAttributeValues(l,r,u,c),d=this._calculateUniqueValues([h],u,l.returnDistinctValues);for(const t in d){const{items:i}=d[t],a=await this._createBinsResponse(e,i);if(n.push(...a.features.map(e=>({...e,attributes:{...e.attributes,[s??r]:t}}))),a.fields)for(const e of a.fields)o.some(t=>t.name===e.name)||o.push(e)}return{fields:o,features:n}}async _createBinsResponse(e,t){const r=e.bin;switch(t=t??this.items,r.type){case"autoIntervalBin":return this._createAutoIntervalBinsResponse(p.fromJSON(r),e,t);case"dateBin":return this._createDateBinsResponse(f.fromJSON(r),e,t);case"fixedBoundariesBin":return this._createFixedBoundariesBinsResponse(g.fromJSON(r),e,t);case"fixedIntervalBin":return this._createFixedIntervalBinsResponse(y.fromJSON(r),e,t)}}async _createAutoIntervalBinsResponse(e,t,r){const{field:s,normalizationField:i,numBins:n,normalizationType:o,normalizationTotal:a,start:l,end:c}=e,h=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),d=_.getBinParams(h,{field:s,normalizationField:i,normalizationType:o,normalizationTotal:a,numBins:n,minValue:u.getDateInNumber(l,!1),maxValue:u.getDateInNumber(c,!1)}),p=this._calculateHistogramBins(h,d,r);return this._createFeaturesFromHistogramBins(p,t)}async _createDateBinsResponse(e,t,r){const{field:s,interval:i,start:n,end:o,snapToData:a,returnFullIntervalBin:l}=e,c=i.unit,h=await this._getDataValues({field:e.field,timeZone:t.outTimeReference?.ianaTimeZone},r),p=d.isTimeOnlyField(this.fieldsIndex.get(s)),f=m.unitsDict.toJSON(c),g=h.filter(Boolean).sort((e,t)=>e-t),y=null!=n?u.getDateInNumber(n,p):g[0],_=null!=o?u.getDateInNumber(o,p):g[g.length-1],x={zone:t.outTimeReference?.ianaTimeZone??b.utc},w=S.DateTime.fromMillis(y,x),v=S.DateTime.fromMillis(_,x),M=[];if("last"===a){let e=v;for(;e>w;){const t=e.minus({[f]:i.value});if(t<w){M.unshift([l?t.toMillis():w.toMillis(),e.toMillis()]);break}M.unshift([t.toMillis(),e.toMillis()]),e=t}}else{let e="first"===a?w:w.startOf(f);for(;e<=v;){const t=e.plus({[f]:i.value});if(t>v){M.push([e.toMillis(),l?t.toMillis():v.toMillis()]);break}M.push([e.toMillis(),t.toMillis()]),e=t}}const I=this._calculateHistogramBins(h,{intervals:M,min:y,max:_},r);return this._createFeaturesFromHistogramBins(I,t)}async _createFixedBoundariesBinsResponse(e,t,r){const{field:s}=e,i=await this._getDataValues({field:s,timeZone:t.outTimeReference?.ianaTimeZone},r),n=d.isTimeOnlyField(this.fieldsIndex.get(s)),o=e.boundaries.map(e=>u.getDateInNumber(e,n)).sort((e,t)=>e-t),a=[];for(let e=0;e<o.length-1;e++)a.push([o[e],o[e+1]]);const l={intervals:a,min:o.at(0),max:o.at(-1)},c=this._calculateHistogramBins(i,l,r);return this._createFeaturesFromHistogramBins(c,t)}async _createFixedIntervalBinsResponse(e,t,r){const{field:s,interval:i,start:n,end:o}=e,a=await this._getDataValues({field:e.field,normalizationField:e.normalizationField,normalizationType:e.normalizationType,normalizationTotal:e.normalizationTotal,timeZone:t.outTimeReference?.ianaTimeZone},r),l=d.isTimeOnlyField(this.fieldsIndex.get(s)),c=_.getBinParams(a,{field:s,classificationMethod:"defined-interval",definedInterval:i,minValue:u.getDateInNumber(n,l),maxValue:u.getDateInNumber(o,l)},!0),h=this._calculateHistogramBins(a,c,r);return this._createFeaturesFromHistogramBins(h,t)}async _createFeaturesFromHistogramBins(e,t){const{upperBoundaryAlias:r,lowerBoundaryAlias:s}=t,i=s||"lowerBoundary",n=r||"upperBoundary",o=[],a=[{name:i,alias:i,type:"esriFieldTypeDouble"},{name:n,alias:n,type:"esriFieldTypeDouble"}],l=t.bin?.stackBy?.value,c=t.bin?.stackBy?.outAlias;l&&a.push({name:x,alias:x,type:"esriFieldTypeInteger"},{name:c??l,alias:c??l,type:"esriFieldTypeString"});let u=0;const h="dateBin"===t.bin.type,d=t.outTimeReference?.ianaTimeZone;for(const r of e){const{minValue:e,maxValue:s,items:p}=r,f={attributes:{}};let m;if(f.attributes[i]=h&&d&&null!=e?S.DateTime.fromMillis(e,{zone:d}).toISO():e,f.attributes[n]=h&&d&&null!=s?S.DateTime.fromMillis(s,{zone:d}).toISO():s,l?(m=await this._createStatisticsQueryResponse({...t,groupByFieldsForStatistics:[l],orderByFields:[l]},p),f.attributes[x]=++u,"flat"===t.bin.jsonStyle?o.push(...m.features.map(({attributes:{EXPR_1:e,...t},...r})=>({...r,attributes:c??e?{...t,[c??e]:e,...f.attributes}:{...t,...f.attributes}}))):(f.stackedAttributes=m.features.map(({attributes:{EXPR_1:e,...t}})=>c??e?{...t,[c??e]:e}:t),o.push(f))):(t.bin?.splitBy&&(f.attributes[x]=++u),m=await this._createStatisticsQueryResponse(t,p,f),o.push(f)),m.fields)for(const e of m.fields)a.some(t=>t.name===e.name)||a.push(e)}return"desc"===t.binOrder&&o.reverse(),{fields:a,features:o}}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(e,t){"use strict";function r(e){if(function(e){return"lowerLeft"===e.originPosition&&4===e.scale.length&&4===e.translate.length}(e))return e;const{originPosition:t,scale:r,translate:s}=e,i=r[0]??1,n=r[1]??1;return{originPosition:"lowerLeft",scale:[i,"lowerLeft"===t?n:-n,r[2]??1,r[3]??1],translate:[s[0]??0,s[1]??0,s[2]??0,s[3]??0]}}function s({scale:e,translate:t},r){return Math.round((r-t[0])/e[0])}function i({scale:e,translate:t},r){return Math.round((r-t[1])/e[1])}function n({scale:e,translate:t},r){return Math.round(((r??0)-t[2])/e[2])}function o({scale:e,translate:t},r){return r?Math.round((r-t[3])/e[3]):0}function a(e,t){return e&&t?h:e&&!t?c:!e&&t?u:l}const l=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let o=s(e,n[0]),a=i(e,n[1]);r.push([o,a]);for(let n=1;n<t.length;n++){const[l,c]=t[n],u=s(e,l),h=i(e,c);u===o&&h===a||r.push([u-o,h-a]),o=u,a=h}return r},c=(e,t)=>{const r=[];if(!t.length)return null;const o=t[0];let a=s(e,o[0]),l=i(e,o[1]),c=n(e,o[2]);r.push([a,l,c]);for(let o=1;o<t.length;o++){const[u,h,d]=t[o],p=s(e,u),f=i(e,h),m=n(e,d);p===a&&f===l&&m===c||r.push([p-a,f-l,m]),a=p,l=f,c=m}return r},u=(e,t)=>{const r=[];if(!t.length)return null;const n=t[0];let a=s(e,n[0]),l=i(e,n[1]),c=o(e,n[2]);r.push([a,l,c]);for(let n=1;n<t.length;n++){const[u,h,d]=t[n],p=s(e,u),f=i(e,h),m=o(e,d);p===a&&f===l&&m===c||r.push([p-a,f-l,m]),a=p,l=f,c=m}return r},h=(e,t)=>{const r=[];if(!t.length)return null;const a=t[0];let l=s(e,a[0]),c=i(e,a[1]),u=n(e,a[2]),h=o(e,a[3]);r.push([l,c,u,h]);for(let a=1;a<t.length;a++){const[d,p,f,m]=t[a],g=s(e,d),y=i(e,p),_=n(e,f),b=o(e,m);g===l&&y===c&&_===u&&b===h||r.push([g-l,y-c,_,b]),l=g,c=y,u=_,h=b}return r};function d({scale:e,translate:t},r){return r*e[0]+t[0]}function p({scale:e,translate:t},r){return r*e[1]+t[1]}function f({scale:e,translate:t},r){return(r??0)*e[2]+t[2]}function m({scale:e,translate:t},r){return r?r*e[3]+t[3]:0}function g(e,t){return e&&t?S:e&&!t?_:!e&&t?b:y}const y=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=d(e,s[0]),n=p(e,s[1]);r[0]=[i,n];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let e=1;e<t.length;e++){const[s,o]=t[e];i+=l*s,n+=c*o,r[e]=[i,n]}return r},_=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=d(e,s[0]),n=p(e,s[1]);r[0]=[i,n,f(e,s[2])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let s=1;s<t.length;s++){const[o,a,u]=t[s];i+=l*o,n+=c*a,r[s]=[i,n,f(e,u)]}return r},b=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=d(e,s[0]),n=p(e,s[1]);r[0]=[i,n,m(e,s[2])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let s=1;s<t.length;s++){const[o,a,u]=t[s];i+=l*o,n+=c*a,r[s]=[i,n,m(e,u)]}return r},S=(e,t)=>{const r=new Array(t.length);if(!t.length)return r;const s=t[0];let i=d(e,s[0]),n=p(e,s[1]);r[0]=[i,n,f(e,s[2]),m(e,s[3])];const{scale:o,originPosition:a}=e,l=o[0],c="lowerLeft"===a?o[1]:-o[1];for(let s=1;s<t.length;s++){const[o,a,u,h]=t[s];i+=l*o,n+=c*a,r[s]=[i,n,f(e,u),m(e,h)]}return r};function x(e,t,r){const s=new Array(r.length);for(let i=0;i<r.length;i++)s[i]=t(e,r[i]);return s}function w(e,t,r){let[s,i]=r[0],n=Math.min(s,t[0]),o=Math.min(i,t[1]),a=Math.max(s,t[2]),l=Math.max(i,t[3]);for(let e=1;e<r.length;e++){const[t,c]=r[e];s+=t,i+=c,t<0&&(n=Math.min(n,s)),t>0&&(a=Math.max(a,s)),c<0?o=Math.min(o,i):c>0&&(l=Math.max(l,i))}return e[0]=n,e[1]=o,e[2]=a,e[3]=l,e}function v(e,t){if(!t.length)return null;e[0]=e[1]=Number.POSITIVE_INFINITY,e[2]=e[3]=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++)w(e,e,t[r]);return e}function M(e,t,a){const l=r(e);return t.xmin=s(l,a.xmin),t.ymin=i(l,a.ymin),t.xmax=s(l,a.xmax),t.ymax=i(l,a.ymax),a.hasZ&&(t.zmin=n(l,a.zmin),t.zmax=n(l,a.zmax)),a.hasM&&(t.mmin=o(l,a.mmin),t.mmax=o(l,a.mmax)),t.hasZ=a.hasZ??!1,t.hasM=a.hasM??!1,t}function I(e,t,s){const i=r(e);return t.points=a(s.hasZ,s.hasM)(i,s.points)??[],t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t}function P(e,t,a){const l=r(e);return t.x=s(l,a.x),t.y=i(l,a.y),null!=a.z&&(t.z=n(l,a.z)),null!=a.m&&(t.m=o(l,a.m)),t}function T(e,t,s){const i=function(e,t,r,s){const i=[],n=a(r,s);for(let r=0;r<t.length;r++){const s=n(e,t[r]);s&&s.length>=3&&i.push(s)}return i.length?i:null}(r(e),s.rings,s.hasZ,s.hasM);return i?(t.rings=i,t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t):null}function C(e,t,s){const i=function(e,t,r,s){const i=[],n=a(r,s);for(let r=0;r<t.length;r++){const s=n(e,t[r]);s&&s.length>=2&&i.push(s)}return i.length?i:null}(r(e),s.paths,s.hasZ,s.hasM);return i?(t.paths=i,t.hasZ=s.hasZ??!1,t.hasM=s.hasM??!1,t):null}e.getQuantizedBoundsCoordsArray=w,e.getQuantizedBoundsCoordsArrayArray=v,e.getQuantizedBoundsPaths=function(e){return v([0,0,0,0],e)},e.getQuantizedBoundsPoints=function(e){const t=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return w(t,t,e)},e.getQuantizedBoundsRings=function(e){return v([0,0,0,0],e)},e.normalizeTransform=r,e.quantizeBounds=function(e,t,n){const o=r(e);return t[0]=s(o,n[0]),t[3]=i(o,n[1]),t[2]=s(o,n[2]),t[1]=i(o,n[3]),t},e.quantizeCoordsArrayXY=l,e.quantizeCoordsArrayXYM=u,e.quantizeCoordsArrayXYZ=c,e.quantizeCoordsArrayXYZM=h,e.quantizeExtent=M,e.quantizeGeometry=function(e,r){return e&&r?t.isPoint(r)?P(e,{},r):t.isPolyline(r)?C(e,{},r):t.isPolygon(r)?T(e,{},r):t.isMultipoint(r)?I(e,{},r):t.isExtent(r)?M(e,{},r):null:null},e.quantizeM=o,e.quantizeMultipoint=I,e.quantizePoint=P,e.quantizePolygon=T,e.quantizePolyline=C,e.quantizeX=s,e.quantizeY=i,e.quantizeZ=n,e.toQuantizationTransform=function(e){return e?{originPosition:"upper-left"===e.originPosition?"upperLeft":"lower-left"===e.originPosition?"lowerLeft":e.originPosition,scale:e.tolerance?[e.tolerance,e.tolerance,1,1]:[1,1,1,1],translate:null!=e.extent?[e.extent.xmin,e.extent.ymax,e.extent.zmin??0,e.extent.mmin??0]:[0,0,0,0]}:null},e.unquantizeBounds=function(e,t,s){const i=r(e);return s?(t[0]=d(i,s[0]),t[1]=p(i,s[3]),t[2]=d(i,s[2]),t[3]=p(i,s[1]),t):[d(i,t[0]),p(i,t[3]),d(i,t[2]),p(i,t[1])]},e.unquantizeCoordsArrayArray=x,e.unquantizeCoordsArrayXY=y,e.unquantizeCoordsArrayXYM=b,e.unquantizeCoordsArrayXYZ=_,e.unquantizeCoordsArrayXYZM=S,e.unquantizeExtent=function(e,t,s,i=s.hasZ??!1,n=s.hasM??!1){const o=r(e);return t.xmin=d(o,s.xmin),t.xmax=d(o,s.xmax),t.ymin=p(o,s.ymin),t.ymax=p(o,s.ymax),i&&(t.zmin=f(o,s.zmin),t.zmax=f(o,s.zmax)),n&&(t.mmin=m(o,s.mmin),t.mmax=m(o,s.mmax)),t.hasZ=i,t.hasM=n,t},e.unquantizeM=m,e.unquantizeMultipoint=function(e,t,s,i=s?.hasZ??!1,n=s?.hasM??!1){if(null!=s){const o=r(e);t.points=g(i,n)(o,s.points),t.hasZ=i,t.hasM=n}return t},e.unquantizePoint=function(e,t,s,i=null!=s?.z,n=null!=s?.m){if(null==s)return t;const o=r(e);return t.x=d(o,s.x),t.y=p(o,s.y),i&&(t.z=f(o,s.z)),n&&(t.m=m(o,s.m)),t},e.unquantizePolygon=function(e,t,s,i=s?.hasZ??!1,n=s?.hasM??!1){if(null!=s){const o=r(e);t.rings=x(o,g(i,n),s.rings),t.hasZ=i,t.hasM=n}return t},e.unquantizePolyline=function(e,t,s,i=s?.hasZ??!1,n=s?.hasM??!1){if(null!=s){const o=r(e);t.paths=x(o,g(i,n),s.paths),t.hasZ=i,t.hasM=n}return t},e.unquantizeX=d,e.unquantizeY=p,e.unquantizeZ=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["./attributeSupport","./geometryUtils","../../support/fieldUtils","../../../smartMapping/statistics/support/utils","../../../statistics/utils","../../../support/loadArcade"],function(e,t,r,s,i,n){"use strict";return class{constructor(t,r,s){this._fieldDataCache=new Map,this._returnDistinctMap=new Map,this.returnDistinctValues=t.returnDistinctValues??!1,this.fieldsIndex=s,this.featureAdapter=r;const i=t.outFields;if(i&&!i.includes("*")){this.outFields=i;let t=0;for(const r of i){const i=e.getExpressionFromFieldName(r),n=this.fieldsIndex.get(i),o=n?null:e.getWhereClause(i,s),a=n?n.name:e.getAliasFromFieldName(r)||"FIELD_EXP_"+t++;this._fieldDataCache.set(r,{alias:a,clause:o})}}}countDistinctValues(e){return this.returnDistinctValues?(e.forEach(e=>this.getAttributes(e)),this._returnDistinctMap.size):e.length}getAttributes(e){const t=this._processAttributesForOutFields(e);return this._processAttributesForDistinctValues(t)}getFieldValue(t,r,s){const i=s?s.name:r;let n=null;return this._fieldDataCache.has(i)?n=this._fieldDataCache.get(i)?.clause:s||(n=e.getWhereClause(r,this.fieldsIndex),this._fieldDataCache.set(i,{alias:i,clause:n})),s?this.featureAdapter.getAttribute(t,i):n?.calculateValue(t,this.featureAdapter)}getDataValues(e,t,n=!0){const o=t.normalizationType,a=t.normalizationTotal,l=this.fieldsIndex.get(t.field),c=r.isDateOnlyField(l)||r.isTimestampOffsetField(l),u=r.isTimeOnlyField(l);return e.map(e=>{let r=t.field&&this.getFieldValue(e,t.field,this.fieldsIndex.get(t.field));if(t.field2?(r=`${i.processNullValue(r)}${t.fieldDelimiter}${i.processNullValue(this.getFieldValue(e,t.field2,this.fieldsIndex.get(t.field2)))}`,t.field3&&(r=`${r}${t.fieldDelimiter}${i.processNullValue(this.getFieldValue(e,t.field3,this.fieldsIndex.get(t.field3)))}`)):"string"==typeof r&&n&&(c?r=r?new Date(r).getTime():null:u&&(r=r?s.timeOnlyToMilliseconds(r):null)),o&&Number.isFinite(r)){const s="field"===o&&t.normalizationField?this.getFieldValue(e,t.normalizationField,this.fieldsIndex.get(t.normalizationField)):null;r=i.getNormalizedValue(r,o,s,a)}return r})}async getExpressionValues(e,r,s,i,o){const{arcadeUtils:a}=await n.loadArcade(),l=a.hasGeometryOperations(r);l&&await a.enableGeometryOperations();const c=a.createFunction(r),u=a.getViewInfo(s),h={fields:this.fieldsIndex.fields};return e.map(e=>{const r={attributes:this.featureAdapter.getAttributes(e),layer:h,geometry:l?{...t.getGeometry(i.geometryType,i.hasZ,i.hasM,this.featureAdapter.getGeometry(e)),spatialReference:s?.spatialReference}:null},n=a.createExecContext(r,u,o);return a.executeFunction(c,n)})}validateItem(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testFeature(t,this.featureAdapter)??!1}validateItems(t,r){return this._fieldDataCache.has(r)||this._fieldDataCache.set(r,{alias:r,clause:e.getWhereClause(r,this.fieldsIndex)}),this._fieldDataCache.get(r)?.clause?.testSet(t,this.featureAdapter)??!1}_processAttributesForOutFields(e){const t=this.outFields;if(!t?.length)return this.featureAdapter.getAttributes(e);const r={};for(const s of t){const{alias:t,clause:i}=this._fieldDataCache.get(s);r[t]=i?i.calculateValue(e,this.featureAdapter):this.featureAdapter.getAttribute(e,t)}return r}_processAttributesForDistinctValues(e){if(null==e||!this.returnDistinctValues)return e;const t=this.outFields,r=[];if(t)for(const s of t){const{alias:t}=this._fieldDataCache.get(s);r.push(e[t])}else for(const t in e)r.push(e[t]);const s=`${(t||["*"]).join(",")}=${r.join(",")}`;let i=this._returnDistinctMap.get(s)||0;return this._returnDistinctMap.set(s,++i),i>1?null:e}}})},"esri/smartMapping/statistics/support/utils":function(){define(["exports","../../../core/Error","../../../core/screenUtils","../../../core/timeUtils","../../../geometry/Point","../../../geometry/SpatialReference","../../../geometry/support/quantizationUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/support/fieldUtils","../../../renderers/support/heatmapUtils","../../support/utils","../../../statistics/utils","../../../support/loadArcade"],function(e,t,r,s,i,n,o,a,l,c,u,h,d){"use strict";let p=null;const f=/^(?<hh>([01][0-9])|(2[0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?(\.(?<ms>\d+))?$/;function m(e){const t=f.exec(e);if(!t)return null;const{hh:r,mm:i,ss:n,ms:o}=t.groups;return Number(r)*s.millisecondsPerTimeUnit.hours+Number(i)*s.millisecondsPerTimeUnit.minutes+Number(n)*s.millisecondsPerTimeUnit.seconds+Number(o||0)}function g(e,t){let r=null!=e?e:"";return null!=t&&t&&(r=r?"("+r+") AND ("+t+")":t),r}e.calculateHeatmapStats=function(e,t=18,s,i,n){const o=new Float64Array(i*n);t=Math.round(r.pt2px(t));let a=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;const u=c.createValueFunction(s);for(const{geometry:r,attributes:s}of e){const{x:e,y:h}=r,d=Math.max(0,e-t),p=Math.max(0,h-t),f=Math.min(n,h+t),m=Math.min(i,e+t),g=+u(s);for(let r=p;r<f;r++)for(let s=d;s<m;s++){const n=r*i+s,u=c.evaluateDensityKernel(s-e,r-h,t)*g,d=o[n]+=u;a=Math.min(a,d),l=Math.max(l,d)}}return{min:a,max:l}},e.getDataValues=async function(e,t,r=!0){if(!t)return[];const{field:s,field2:i,field3:o,fieldDelimiter:a,fieldInfos:c,timeZone:f}=e,g=s&&c?.find(e=>e.name.toLowerCase()===s.toLowerCase()),y=!!g&&l.isTimeOnlyField(g),_=!!g&&u.isAnyDateField(g),b=e.valueExpression,S=e.normalizationType,x=e.normalizationField,w=e.normalizationTotal,v=[],M=e.viewInfoParams;let I=null,P=null;if(b){if(!p){const{arcadeUtils:e}=await d.loadArcade();p=e}p.hasGeometryOperations(b)&&await p.enableGeometryOperations(),I=p.createFunction(b),P=M?p.getViewInfo({viewingMode:M.viewingMode,scale:M.scale,spatialReference:new n(M.spatialReference)}):null}const T=e.fieldInfos,C=t[0]&&"declaredClass"in t[0]&&"esri.Graphic"===t[0].declaredClass||!T?null:{fields:T};return t.forEach(e=>{const t=e.attributes;let n;if(b){const t=C?Object.assign({},e,{layer:C}):e,r=p.createExecContext(t,P,f);n=p.executeFunction(I,r)}else t&&(n=t[s],i?(n=`${h.processNullValue(n)}${a}${h.processNullValue(t[i])}`,o&&(n=`${n}${a}${h.processNullValue(t[o])}`)):"string"==typeof n&&r&&(_?n=n?new Date(n).getTime():null:y&&(n=n?m(n):null)));if(S&&"number"==typeof n&&isFinite(n)){const e=t&&parseFloat(t[x]);n=h.getNormalizedValue(n,S,e,w)}v.push(n)}),v},e.getRangeExpr=function(e,t,r){const s=null!=t?e+" >= "+t:"",i=null!=r?e+" <= "+r:"";let n="";return n=s&&i?g(s,i):s||i,n?"("+n+")":""},e.getSQLFilterForNormalization=function(e){const t=e.field,r=e.normalizationType,s=e.normalizationField;let i;return"field"===r?i="(NOT "+s+" = 0)":"log"!==r&&"natural-log"!==r&&"square-root"!==r||(i=`(${t} > 0)`),i},e.getSumOfAttributesExpr=function(e,t,r){const s=[],i=[],n=[],o=[],a=[];e.forEach((e,t)=>{const l=e.field?"field":"expression",c=e.field||e.valueExpression;e.field?(a.push(c),i.push(`var ${l}${t} = Number($feature["${c}"]);`)):(s.push(`function getValueForExpr${t}() {\n  ${c} \n}`),i.push(`var ${l}${t} = Number(getValueForExpr${t}());`)),r||n.push(`${l}${t} = IIf(${l}${t} < 0, 0, ${l}${t});`),o.push(`${l}${t}`)});const l=s.length?null:a.reduce((e,t)=>`${e} + ${t}`);let c=null;return t||r?t?r||l&&(c=`(( ${l} ) >= 0)`):l&&(c=`(( ${l} ) <> 0)`):l&&(c=`(( ${l} ) > 0)`),{valueExpression:[s.length?s.join("\n"):"",i.join("\n"),n.join("\n"),`var total = ${o.join(" + ")};`,"return total;"].filter(Boolean).join("\n\n"),sqlExpression:l,sqlWhere:c}},e.mergeWhereClauses=g,e.quantizeFeatures=function(e,t,r,s){const n=a.isWrappable(r)?a.getInfo(r):null,l=n?Math.round((n.valid[1]-n.valid[0])/t.scale[0]):null;return e.map(e=>{const r=new i(e.geometry);return o.quantizePoint(t,r,r),e.geometry=n?function(e,t,r){return e.x<0?e.x+=t:e.x>r&&(e.x-=t),e}(r,l??0,s[0]):r,e})},e.timeOnlyToMilliseconds=m,e.verifyBasicFieldValidity=function(e,r,s){const i=function(e){const t=e.layer;return e.fields.filter(e=>!t.getField(e))}({layer:e,fields:r});if(i.length)return new t(s,"Unknown fields: "+i.join(", ")+". You can only use fields defined in the layer schema");const n=function(e){const t=e.layer;return e.fields.filter(e=>{const r=t.getFieldUsageInfo(e);return!r||!r.supportsStatistics})}({layer:e,fields:r});return n.length?new t(s,"Unsupported fields: "+n.join(", ")+". You can only use fields that can be fetched i.e. AdapterFieldUsageInfo.supportsStatistics must be true"):void 0},e.verifyFieldType=function(e,r,s,i){let n;return r?r.name!==e.objectIdField&&i.includes(r.type)||(n=new t(s,"'field' should be one of these types: "+i.join(","))):n=new t(s,"'field' is not defined in the layer schema"),n},e.verifyFilterValidity=function(e,r){if(e&&"intersects"!==e.spatialRelationship)return new t(r,"Only 'intersects' spatialRelationship is supported for featureFilter")},e.verifyNumericField=function(e,r,s){let i;return r?r.name!==e.objectIdField&&l.isNumericField(r)||(i=new t(s,"'field' should be one of these numeric types: "+l.numericTypes.join(","))):i=new t(s,"'field' is not defined in the layer schema"),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/heatmapUtils":function(){define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec42","../../core/libs/gl-matrix-2/factories/vec4f64"],function(e,t,r,s,i){"use strict";function n(e,r,i,n){let{color:o,ratio:a}=r,{color:l,ratio:c}=i;if(c===a){const e=1e-6;1===c?a-=e:c+=e}const u=t.clamp((n-a)/(c-a),0,1);s.lerp(e,o.toArray(),l.toArray(),u)}e.createValueFunction=function(e){return"function"==typeof e?e:e?t=>+t[e]:()=>1},e.evaluateDensityKernel=function(e,t,r){const s=Math.sqrt(e**2+t**2)/r;return s>1?0:3/(Math.PI*r**2)*(1-s**2)**2},e.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(e){return r.px2pt(2.4*e)},e.generateGradient=function(e){const t=new Uint8ClampedArray(2048);if((e=e.filter(({ratio:e})=>e>=0&&e<=1).sort((e,t)=>e.ratio-t.ratio).map(({color:e,ratio:t})=>({color:e,ratio:Math.max(t,.001)}))).length<1)return t;let r=e[0],s=e[0],o=1;const a=i.create();for(let i=0;i<512;i++){const l=(i+.5)/512;for(;l>s.ratio&&o<e.length;)r=s,s=e[o++];n(a,r,s,l),t.set(a,4*i)}return t},e.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(e){return r.pt2px(e)/2.4},e.magicKernelDensityRadiusInflationFactor=2.4,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/smartMapping/support/utils":function(){define(["exports","../../intl/date","../../layers/support/fieldUtils","../../support/basemapUtils","../../support/loadArcade","../../time/constants","../../time/timeZoneUtils"],function(e,t,r,s,i,n,o){"use strict";const a={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},l={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},c=new Set(["integer","small-integer"]);let u=null;function h(e){return String(e).padStart(2,"0")}function d(e,t,r){let s;return"date"===t||"number"===t?("number"===t&&(e=new Date(e)),s=`TIMESTAMP'${r?e.getFullYear():e.getUTCFullYear()}-${h((r?e.getMonth():e.getUTCMonth())+1)}-${h(r?e.getDate():e.getUTCDate())} ${h(r?e.getHours():e.getUTCHours())}:${h(r?e.getMinutes():e.getUTCMinutes())}:${h(r?e.getSeconds():e.getUTCSeconds())}'`):s=e,s}function p(e,t){if(t instanceof Date)return"date";if("number"==typeof t)return"number";if("string"==typeof t){const s=e.getField(t);if("<now>"===t.toLowerCase())return;if(r.isDateField(s))return"field"}}e.castIntegerFieldToFloat=function(e){return`cast(${e} as float)`},e.dateTypes=["date","date-only","timestamp-offset"],e.defaultBasemapGroups=a,e.defaultStatisticTypes={exclude:["median"]},e.fieldDelimiter=",",e.formatAnyDate=function(e,r){const{format:s,timeZoneOptions:i,fieldType:a}=r??{};let l,c;if(i&&({timeZone:l,timeZoneName:c}=o.getTimeZoneFormattingOptions(i.layerTimeZone,i.datesInUnknownTimezone,i.viewTimeZone,t.convertDateFormatToIntlOptions(s||"short-date-short-time"),a)),"string"==typeof e&&isNaN(Date.parse("time-only"===a?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const r=t.convertDateFormatToIntlOptions(s||"short-date");return"string"==typeof e?t.formatDateOnly(e,{...r}):t.formatDate(e,{...r,timeZone:n.utc})}case"time-only":{const r=t.convertDateFormatToIntlOptions(s||"short-time");return"string"==typeof e?t.formatTimeOnly(e,r):t.formatDate(e,{...r,timeZone:n.utc})}case"timestamp-offset":{if(!l&&"string"==typeof e&&new Date(e).toISOString()!==e)return e;const r=s||i?t.convertDateFormatToIntlOptions(s||"short-date-short-time"):void 0,n=r?{...r,timeZone:l,timeZoneName:c}:void 0;return"string"==typeof e?t.formatTimestamp(e,n):t.formatDate(e,n)}default:{const r=s||i?t.convertDateFormatToIntlOptions(s||"short-date-short-time"):void 0;return t.formatDate("string"==typeof e?new Date(e):e,r?{...r,timeZone:l,timeZoneName:c}:void 0)}}},e.getBasemapGroup=function(e,t=a){for(const r in t)if(t[r].includes(e))return r},e.getBasemapId=function(e,t,r=!0){let i=null;return e&&("string"==typeof e?t.includes(e)&&(i=e):i=s.getWellKnownBasemapId(e)),r?i||"gray":i},e.getDateDiffSQL=function(e,t,r,s){const{hasQueryEngine:i}=e,n=`(${d(r,p(e,r),i)} - ${d(t,p(e,t),i)})`;let o=l[s],a="/";return o<1&&(o=1/o,a="*"),{sqlExpression:1===o?n:`(${n} ${a} ${o})`,sqlWhere:null}},e.getDateType=p,e.getFieldsList=async function(e){const{field:t,field2:r,field3:s,normalizationField:n,valueExpression:o}=e;let a=[];if(o){if(!u){const{arcadeUtils:e}=await i.loadArcade();u=e}a=u.extractFieldNames(o)}return t&&a.push(t),r&&a.push(r),s&&a.push(s),n&&a.push(n),a},e.getNormalizationType=function(e){let t=e.normalizationType;return t||(e.normalizationField?t="field":null!=e.normalizationTotal&&(t="percent-of-total")),t??void 0},e.isAnyDateField=function(e){return r.isDateField(e)||r.isDateOnlyField(e)||r.isTimestampOffsetField(e)},e.isIntegerField=function(e,t){const r=t&&e.getField(t);return!!r&&c.has(r.type)},e.unitValueInDays=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapUtils":function(){define(["exports","../core/Collection","../core/maybe","../core/urlUtils","../layers/effects/utils","./basemapDefinitions"],function(e,t,r,s,i,n){"use strict";let o;function a(e){if(o)return o(e);let t=null;const r=h(e),s=!r?.baseLayers.length;for(const e in n.esriBasemapDefinitions){const i=y(r,m(n.esriBasemapDefinitions[e]),{mustMatchReferences:s});if("equal"===i){t=e;break}"base-layers-equal"===i&&(t=e)}return t}function l(e){if(u(e.url))return!0;if("vector-tile"===e.type)for(const t in e.sourceNameToSource){const r=e.sourceNameToSource[t];if(u(r?.sourceUrl))return!0}return!1}const c=/^(basemaps|ibasemaps).*-api\.arcgis\.com$/i;function u(e){if(!e)return!1;const t=new s.Url(s.makeAbsolute(e));return!!t.authority&&c.test(t.authority)}function h(e){return e?!e.loaded&&e.resourceInfo?m(e.resourceInfo.data):{baseLayers:d(e.baseLayers),referenceLayers:d(e.referenceLayers)}:null}function d(e){return(t.isCollection(e)?e.toArray():e).map(p)}function p(e){return{type:e.type,effect:"effect"in e?e.effect:void 0,url:S("urlTemplate"in e&&e.urlTemplate||e.url||"styleUrl"in e&&e.styleUrl||""),minScale:"minScale"in e&&null!=e.minScale?e.minScale:0,maxScale:"maxScale"in e&&null!=e.maxScale?e.maxScale:0,opacity:null!=e.opacity?e.opacity:1,visible:null==e.visible||!!e.visible,sublayers:"map-image"!==e.type&&"wms"!==e.type||null==e.sublayers?void 0:e.sublayers?.map(e=>({id:e.id,visible:e.visible})),activeLayerId:"wmts"===e.type?e.activeLayer?.id:void 0}}function f(e){return e.isReference||"ArcGISSceneServiceLayer"===e.layerType}function m(e){return e?{baseLayers:g((e.baseMapLayers??[]).filter(e=>!f(e))),referenceLayers:g((e.baseMapLayers??[]).filter(e=>f(e)))}:null}function g(e){return e.map(e=>function(e){let t;switch(e.layerType){case"VectorTileLayer":t="vector-tile";break;case"ArcGISTiledMapServiceLayer":t="tile";break;case"ArcGISSceneServiceLayer":t="scene";break;default:t="unknown"}return{type:t,effect:e.effect,url:S(e.templateUrl||e.urlTemplate||e.styleUrl||e.url),minScale:e.minScale??0,maxScale:e.maxScale??0,opacity:e.opacity??1,visible:null==e.visibility||!!e.visibility,sublayers:void 0,activeLayerId:void 0}}(e))}function y(e,t,r){return null!=e!=(null!=t)?"not-equal":e&&t?_(e.baseLayers,t.baseLayers)?_(e.referenceLayers,t.referenceLayers)?"equal":r.mustMatchReferences?"not-equal":"base-layers-equal":"not-equal":"equal"}function _(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!b(e[r],t[r]))return!1;return!0}function b(e,t){if(e.type!==t.type||e.url!==t.url||e.minScale!==t.minScale||e.maxScale!==t.maxScale||e.visible!==t.visible||e.opacity!==t.opacity)return!1;if(!i.effectEquals(e.effect,t.effect))return!1;if(null!=e.activeLayerId||null!=t.activeLayerId)return e.activeLayerId===t.activeLayerId;if(null!=e.sublayers||null!=t.sublayers){if(null==e.sublayers||null==t.sublayers||e.sublayers.length!==t.sublayers.length)return!1;for(let r=0;r<e.sublayers.length;r++){const s=e.sublayers.at(r),i=t.sublayers.at(r);if(s?.id!==i?.id||s?.visible!==i?.visible)return!1}}return!0}function S(e){return e?s.normalize(e).replace(/^\s*https?:/i,"").toLowerCase():""}function x(e){return"portalItem"in e?e.portalItem?.thumbnailUrl:void 0}e.contentEquals=function(e,t){return e===t||null!=e?.portalItem?.id&&e.portalItem.id===t?.portalItem?.id||"equal"===y(h(e),h(t),{mustMatchReferences:!0})},e.findSpatialReference=function(e,t){if(null==t||null==e)return{spatialReference:null,updating:!1};if("not-loaded"===t.loadStatus)return t.load(),{spatialReference:null,updating:!0};if(t.spatialReference)return{spatialReference:t.spatialReference,updating:!1};if(0===t.baseLayers.length)return{spatialReference:null,updating:!1};const r=t.baseLayers.at(0);switch(r.loadStatus){case"not-loaded":r.load();case"loading":return{spatialReference:null,updating:!0};case"failed":return{spatialReference:null,updating:!1}}const s=(("supportedSpatialReferences"in r?r.supportedSpatialReferences:null)||["tileInfo"in r?r.tileInfo?.spatialReference:r.spatialReference]).filter(Boolean),i=e.spatialReference;return i?{spatialReference:s.find(e=>i.equals(e))??s[0]??null,updating:!1}:{spatialReference:s[0],updating:!1}},e.getBasemapThumbnailUrl=function(e){if(!e)return null;const{thumbnailUrl:t}=e;if(t)return t;const s=a(e);return s?n.esriBasemapDefinitions[s].thumbnailUrl:r.mappedFind(e.baseLayers,x)},e.getWellKnownBasemapId=a,e.hasDeveloperBasemapLayer=function(e){return!!e?.baseLayers.concat(e.referenceLayers).some(l)},e.isBasemap3D=function(e){return"Web Scene"===e.portalItem?.type||e.referenceLayers.some(e=>"scene"===e.type)},e.isBasemapInBeta=function(e){return!!e?.portalItem?.tags?.some(e=>"beta"===e.toLowerCase())},e.isBasemapLayerView=function(e,t){const r=e.allLayerViews.find(e=>e.uid===t);return r?.layer.parent===e.map?.basemap},e.isDeveloperBasemapLayer=l,e.layerDefinitionEquals=b,e.layerToDefinition=p,e.overrideGetWellKnownBasemapId=function(e){o=e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/utils":function(){define(["exports","./effects"],function(e,t){"use strict";e.canInterpolateEffects=function(e,t){const r=e.length>t.length?e:t;return(e.length>t.length?t:e).every((e,t)=>e.type===r[t].type)},e.effectEquals=function(e,t){return JSON.stringify(e??null)===JSON.stringify(t??null)},e.isEffectFunctions=function(e){const t=e[0];return!!t&&"type"in t},e.normalizeEffects=function(e,r){const s=e.length>r.length?e:r,i=e.length>r.length?r:e;for(let e=i.length;e<s.length;e++)i.push(t.createEffectWithInitialValues(s[e]))},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/effects":function(){define(["exports","../../colorUtils","../../core/screenUtils","../../core/libs/gl-matrix-2/factories/mat4f32","./colorMatrixFunctions"],function(e,t,r,s,i){"use strict";class n{constructor(e,t,r){this.strength=e,this.radius=t,this.threshold=r,this.type="bloom"}interpolate(e,t,r){this.strength=h(e.strength,t.strength,r),this.radius=h(e.radius,t.radius,r),this.threshold=h(e.threshold,t.threshold,r)}clone(){return new n(this.strength,this.radius,this.threshold)}toJSON(){return{type:"bloom",radius:d(this.radius),strength:this.strength,threshold:this.threshold}}}class o{constructor(e){this.radius=e,this.type="blur"}interpolate(e,t,r){this.radius=Math.round(h(e.radius,t.radius,r))}clone(){return new o(this.radius)}toJSON(){return{type:"blur",radius:d(this.radius)}}}class a{constructor(e,t){this.type=e,this.amount=t,"invert"!==this.type&&"grayscale"!==this.type&&"sepia"!==this.type||(this.amount=Math.min(this.amount,1))}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.amount=h(e.amount,t.amount,r),this._updateMatrix()}clone(){return new a(this.type,this.amount)}toJSON(){return{type:this.type,amount:this.amount}}_updateMatrix(){const e=this._colorMatrix||s.create();switch(this.type){case"brightness":this._colorMatrix=i.brightness(e,this.amount);break;case"contrast":this._colorMatrix=i.contrast(e,this.amount);break;case"grayscale":this._colorMatrix=i.grayscale(e,this.amount);break;case"invert":this._colorMatrix=i.invert(e,this.amount);break;case"saturate":this._colorMatrix=i.saturate(e,this.amount);break;case"sepia":this._colorMatrix=i.sepia(e,this.amount)}}}class l{constructor(e,t,r,s){this.offsetX=e,this.offsetY=t,this.blurRadius=r,this.color=s,this.type="drop-shadow"}interpolate(e,t,r){this.offsetX=h(e.offsetX,t.offsetX,r),this.offsetY=h(e.offsetY,t.offsetY,r),this.blurRadius=h(e.blurRadius,t.blurRadius,r),this.color[0]=Math.round(h(e.color[0],t.color[0],r)),this.color[1]=Math.round(h(e.color[1],t.color[1],r)),this.color[2]=Math.round(h(e.color[2],t.color[2],r)),this.color[3]=h(e.color[3],t.color[3],r)}clone(){return new l(this.offsetX,this.offsetY,this.blurRadius,[...this.color])}toJSON(){const e=[...this.color];return e[3]*=255,{type:"drop-shadow",xoffset:d(this.offsetX),yoffset:d(this.offsetY),blurRadius:d(this.blurRadius),color:e}}}class c{constructor(e){this.angle=e,this.type="hue-rotate"}get colorMatrix(){return this._colorMatrix||this._updateMatrix(),this._colorMatrix}interpolate(e,t,r){this.angle=h(e.angle,t.angle,r),this._updateMatrix()}clone(){return new c(this.angle)}toJSON(){return{type:"hue-rotate",angle:this.angle}}_updateMatrix(){const e=this._colorMatrix||s.create();this._colorMatrix=i.rotateHue(e,this.angle)}}class u{constructor(e){this.amount=e,this.type="opacity",this.amount=Math.min(this.amount,1)}interpolate(e,t,r){this.amount=h(e.amount,t.amount,r)}clone(){return new u(this.amount)}toJSON(){return{type:"opacity",amount:this.amount}}}function h(e,t,r){return e+(t-e)*r}function d(e){return Math.round(1e3*r.px2pt(e))/1e3}e.BloomEffect=n,e.BlurEffect=o,e.ColorMatrixEffect=a,e.DropShadowEffect=l,e.HueRotateEffect=c,e.OpacityEffect=u,e.createEffectWithInitialValues=function(e){switch(e.type){case"grayscale":case"sepia":case"invert":return new a(e.type,0);case"saturate":case"brightness":case"contrast":return new a(e.type,1);case"opacity":return new u(1);case"hue-rotate":return new c(0);case"blur":return new o(0);case"drop-shadow":return new l(0,0,0,[...t.getNamedColor("transparent")]);case"bloom":return new n(0,0,1)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["exports"],function(e){"use strict";function t(){const e=new Float32Array(16);return e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function r(e){const t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function s(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m){const g=new Float32Array(16);return g[0]=e,g[1]=t,g[2]=r,g[3]=s,g[4]=i,g[5]=n,g[6]=o,g[7]=a,g[8]=l,g[9]=c,g[10]=u,g[11]=h,g[12]=d,g[13]=p,g[14]=f,g[15]=m,g}const i=t(),n=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:i,clone:r,create:t,fromValues:s},Symbol.toStringTag,{value:"Module"}));e.IDENTITY=i,e.clone=r,e.create=t,e.fromValues=s,e.mat4f32=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/effects/colorMatrixFunctions":function(){define(["exports","../../core/libs/gl-matrix-2/math/mat4"],function(e,t){"use strict";e.brightness=(e,r)=>{const s=t.set(e,r,0,0,0,0,r,0,0,0,0,r,0,0,0,0,1);return t.transpose(s,s)},e.contrast=(e,r)=>{const s=t.set(e,r,0,0,.5-.5*r,0,r,0,.5-.5*r,0,0,r,.5-.5*r,0,0,0,1);return t.transpose(s,s)},e.grayscale=(e,r)=>{const s=1-r,i=t.set(e,.2126+.7874*s,.7152-.7152*s,.0722-.0722*s,0,.2126-.2126*s,.7152+.2848*s,.0722-.0722*s,0,.2126-.2126*s,.7152-.7152*s,.0722+.9278*s,0,0,0,0,1);return t.transpose(i,i)},e.invert=(e,r)=>{const s=1-2*r,i=r,n=t.set(e,s,0,0,i,0,s,0,i,0,0,s,i,0,0,0,1);return t.transpose(n,n)},e.rotateHue=(e,r)=>{const s=Math.sin(r*Math.PI/180),i=Math.cos(r*Math.PI/180),n=t.set(e,.213+.787*i-.213*s,.715-.715*i-.715*s,.072-.072*i+.928*s,0,.213-.213*i+.143*s,.715+.285*i+.14*s,.072-.072*i-.283*s,0,.213-.213*i-.787*s,.715-.715*i+.715*s,.072+.928*i+.072*s,0,0,0,0,1);return t.transpose(n,n)},e.saturate=(e,r)=>{const s=r,i=t.set(e,.213+.787*s,.715-.715*s,.072-.072*s,0,.213-.213*s,.715+.285*s,.072-.072*s,0,.213-.213*s,.715-.715*s,.072+.928*s,0,0,0,0,1);return t.transpose(i,i)},e.sepia=(e,r)=>{const s=1-r,i=t.set(e,.393+.607*s,.769-.769*s,.189-.189*s,0,.349-.349*s,.686+.314*s,.168-.168*s,0,.272-.272*s,.534-.534*s,.131+.869*s,0,0,0,0,1);return t.transpose(i,i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["exports","../factories/vec3f64","./common"],function(e,t,r){"use strict";function s(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function i(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g){return e[0]=t,e[1]=r,e[2]=s,e[3]=i,e[4]=n,e[5]=o,e[6]=a,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=p,e[13]=f,e[14]=m,e[15]=g,e}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function o(e,t){if(e===t){const r=t[1],s=t[2],i=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=s,e[9]=n,e[11]=t[14],e[12]=i,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function a(e,t){return l(e,t)||n(e),e}function l(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15],_=r*a-s*o,b=r*l-i*o,S=r*c-n*o,x=s*l-i*a,w=s*c-n*a,v=i*c-n*l,M=u*m-h*f,I=u*g-d*f,P=u*y-p*f,T=h*g-d*m,C=h*y-p*m,F=d*y-p*g;let k=_*F-b*C+S*T+x*P-w*I+v*M;return k?(k=1/k,e[0]=(a*F-l*C+c*T)*k,e[1]=(i*C-s*F-n*T)*k,e[2]=(m*v-g*w+y*x)*k,e[3]=(d*w-h*v-p*x)*k,e[4]=(l*P-o*F-c*I)*k,e[5]=(r*F-i*P+n*I)*k,e[6]=(g*S-f*v-y*b)*k,e[7]=(u*v-d*S+p*b)*k,e[8]=(o*C-a*P+c*M)*k,e[9]=(s*P-r*C-n*M)*k,e[10]=(f*w-m*S+y*_)*k,e[11]=(h*S-u*w-p*_)*k,e[12]=(a*I-o*T-l*M)*k,e[13]=(r*T-s*I+i*M)*k,e[14]=(m*b-f*x-g*_)*k,e[15]=(u*x-h*b+d*_)*k,e):null}function c(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],p=t[11],f=t[12],m=t[13],g=t[14],y=t[15];return e[0]=a*(d*y-p*g)-h*(l*y-c*g)+m*(l*p-c*d),e[1]=-(s*(d*y-p*g)-h*(i*y-n*g)+m*(i*p-n*d)),e[2]=s*(l*y-c*g)-a*(i*y-n*g)+m*(i*c-n*l),e[3]=-(s*(l*p-c*d)-a*(i*p-n*d)+h*(i*c-n*l)),e[4]=-(o*(d*y-p*g)-u*(l*y-c*g)+f*(l*p-c*d)),e[5]=r*(d*y-p*g)-u*(i*y-n*g)+f*(i*p-n*d),e[6]=-(r*(l*y-c*g)-o*(i*y-n*g)+f*(i*c-n*l)),e[7]=r*(l*p-c*d)-o*(i*p-n*d)+u*(i*c-n*l),e[8]=o*(h*y-p*m)-u*(a*y-c*m)+f*(a*p-c*h),e[9]=-(r*(h*y-p*m)-u*(s*y-n*m)+f*(s*p-n*h)),e[10]=r*(a*y-c*m)-o*(s*y-n*m)+f*(s*c-n*a),e[11]=-(r*(a*p-c*h)-o*(s*p-n*h)+u*(s*c-n*a)),e[12]=-(o*(h*g-d*m)-u*(a*g-l*m)+f*(a*d-l*h)),e[13]=r*(h*g-d*m)-u*(s*g-i*m)+f*(s*d-i*h),e[14]=-(r*(a*g-l*m)-o*(s*g-i*m)+f*(s*l-i*a)),e[15]=r*(a*d-l*h)-o*(s*d-i*h)+u*(s*l-i*a),e}function u(e){const t=e[0],r=e[1],s=e[2],i=e[3],n=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],p=e[12],f=e[13],m=e[14],g=e[15];return(t*o-r*n)*(h*g-d*m)-(t*a-s*n)*(u*g-d*f)+(t*l-i*n)*(u*m-h*f)+(r*a-s*o)*(c*g-d*p)-(r*l-i*o)*(c*m-h*p)+(s*l-i*a)*(c*f-u*p)}function h(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],p=t[10],f=t[11],m=t[12],g=t[13],y=t[14],_=t[15];let b=r[0],S=r[1],x=r[2],w=r[3];return e[0]=b*s+S*a+x*h+w*m,e[1]=b*i+S*l+x*d+w*g,e[2]=b*n+S*c+x*p+w*y,e[3]=b*o+S*u+x*f+w*_,b=r[4],S=r[5],x=r[6],w=r[7],e[4]=b*s+S*a+x*h+w*m,e[5]=b*i+S*l+x*d+w*g,e[6]=b*n+S*c+x*p+w*y,e[7]=b*o+S*u+x*f+w*_,b=r[8],S=r[9],x=r[10],w=r[11],e[8]=b*s+S*a+x*h+w*m,e[9]=b*i+S*l+x*d+w*g,e[10]=b*n+S*c+x*p+w*y,e[11]=b*o+S*u+x*f+w*_,b=r[12],S=r[13],x=r[14],w=r[15],e[12]=b*s+S*a+x*h+w*m,e[13]=b*i+S*l+x*d+w*g,e[14]=b*n+S*c+x*p+w*y,e[15]=b*o+S*u+x*f+w*_,e}function d(e,t,r){const s=r[0],i=r[1],n=r[2];if(t===e)e[12]=t[0]*s+t[4]*i+t[8]*n+t[12],e[13]=t[1]*s+t[5]*i+t[9]*n+t[13],e[14]=t[2]*s+t[6]*i+t[10]*n+t[14],e[15]=t[3]*s+t[7]*i+t[11]*n+t[15];else{const r=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7],p=t[8],f=t[9],m=t[10],g=t[11];e[0]=r,e[1]=o,e[2]=a,e[3]=l,e[4]=c,e[5]=u,e[6]=h,e[7]=d,e[8]=p,e[9]=f,e[10]=m,e[11]=g,e[12]=r*s+c*i+p*n+t[12],e[13]=o*s+u*i+f*n+t[13],e[14]=a*s+h*i+m*n+t[14],e[15]=l*s+d*i+g*n+t[15]}return e}function p(e,t,r){const s=r[0],i=r[1],n=r[2];return e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e[3]=t[3]*s,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,i,n){let o=n[0],a=n[1],l=n[2],c=Math.sqrt(o*o+a*a+l*l);if(c<=r.getEpsilon())return void s(e,t);c=1/c,o*=c,a*=c,l*=c;const u=Math.sin(i),h=Math.cos(i),d=1-h,p=t[0],f=t[1],m=t[2],g=t[3],y=t[4],_=t[5],b=t[6],S=t[7],x=t[8],w=t[9],v=t[10],M=t[11],I=o*o*d+h,P=a*o*d+l*u,T=l*o*d-a*u,C=o*a*d-l*u,F=a*a*d+h,k=l*a*d+o*u,A=o*l*d+a*u,O=a*l*d-o*u,E=l*l*d+h;e[0]=p*I+y*P+x*T,e[1]=f*I+_*P+w*T,e[2]=m*I+b*P+v*T,e[3]=g*I+S*P+M*T,e[4]=p*C+y*F+x*k,e[5]=f*C+_*F+w*k,e[6]=m*C+b*F+v*k,e[7]=g*C+S*F+M*k,e[8]=p*A+y*O+x*E,e[9]=f*A+_*O+w*E,e[10]=m*A+b*O+v*E,e[11]=g*A+S*O+M*E,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15])}function m(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*i+c*s,e[5]=o*i+u*s,e[6]=a*i+h*s,e[7]=l*i+d*s,e[8]=c*i-n*s,e[9]=u*i-o*s,e[10]=h*i-a*s,e[11]=d*i-l*s,e}function g(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i-c*s,e[1]=o*i-u*s,e[2]=a*i-h*s,e[3]=l*i-d*s,e[8]=n*s+c*i,e[9]=o*s+u*i,e[10]=a*s+h*i,e[11]=l*s+d*i,e}function y(e,t,r){const s=Math.sin(r),i=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*i+c*s,e[1]=o*i+u*s,e[2]=a*i+h*s,e[3]=l*i+d*s,e[4]=c*i-n*s,e[5]=u*i-o*s,e[6]=h*i-a*s,e[7]=d*i-l*s,e}function _(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function b(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t,s){if(0===t)return n(e);let i=s[0],o=s[1],a=s[2],l=Math.sqrt(i*i+o*o+a*a);if(l<=r.getEpsilon())return null;l=1/l,i*=l,o*=l,a*=l;const c=Math.sin(t),u=Math.cos(t),h=1-u;return e[0]=i*i*h+u,e[1]=o*i*h+a*c,e[2]=a*i*h-o*c,e[3]=0,e[4]=i*o*h-a*c,e[5]=o*o*h+u,e[6]=a*o*h+i*c,e[7]=0,e[8]=i*a*h+o*c,e[9]=o*a*h-i*c,e[10]=a*a*h+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function x(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function w(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function v(e,t){const r=Math.sin(t),s=Math.cos(t);return e[0]=s,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function M(e,t,r){const s=t[0],i=t[1],n=t[2],o=t[3],a=s+s,l=i+i,c=n+n,u=s*a,h=s*l,d=s*c,p=i*l,f=i*c,m=n*c,g=o*a,y=o*l,_=o*c;return e[0]=1-(p+m),e[1]=h+_,e[2]=d-y,e[3]=0,e[4]=h-_,e[5]=1-(u+m),e[6]=f+g,e[7]=0,e[8]=d+y,e[9]=f-g,e[10]=1-(u+p),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function I(e,t){const r=P,s=-t[0],i=-t[1],n=-t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],h=s*s+i*i+n*n+o*o;return h>0?(r[0]=2*(a*o+u*s+l*n-c*i)/h,r[1]=2*(l*o+u*i+c*s-a*n)/h,r[2]=2*(c*o+u*n+a*i-l*s)/h):(r[0]=2*(a*o+u*s+l*n-c*i),r[1]=2*(l*o+u*i+c*s-a*n),r[2]=2*(c*o+u*n+a*i-l*s)),M(e,t,r),e}const P=t.create();function T(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function C(e,t){const r=t[0],s=t[1],i=t[2],n=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+s*s+i*i),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function F(e,t){const r=t[0]+t[5]+t[10];let s=0;return r>0?(s=2*Math.sqrt(r+1),e[3]=.25*s,e[0]=(t[6]-t[9])/s,e[1]=(t[8]-t[2])/s,e[2]=(t[1]-t[4])/s):t[0]>t[5]&&t[0]>t[10]?(s=2*Math.sqrt(1+t[0]-t[5]-t[10]),e[3]=(t[6]-t[9])/s,e[0]=.25*s,e[1]=(t[1]+t[4])/s,e[2]=(t[8]+t[2])/s):t[5]>t[10]?(s=2*Math.sqrt(1+t[5]-t[0]-t[10]),e[3]=(t[8]-t[2])/s,e[0]=(t[1]+t[4])/s,e[1]=.25*s,e[2]=(t[6]+t[9])/s):(s=2*Math.sqrt(1+t[10]-t[0]-t[5]),e[3]=(t[1]-t[4])/s,e[0]=(t[8]+t[2])/s,e[1]=(t[6]+t[9])/s,e[2]=.25*s),e}function k(e,t,r,s){const i=t[0],n=t[1],o=t[2],a=t[3],l=i+i,c=n+n,u=o+o,h=i*l,d=i*c,p=i*u,f=n*c,m=n*u,g=o*u,y=a*l,_=a*c,b=a*u,S=s[0],x=s[1],w=s[2];return e[0]=(1-(f+g))*S,e[1]=(d+b)*S,e[2]=(p-_)*S,e[3]=0,e[4]=(d-b)*x,e[5]=(1-(h+g))*x,e[6]=(m+y)*x,e[7]=0,e[8]=(p+_)*w,e[9]=(m-y)*w,e[10]=(1-(h+f))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function A(e,t,r,s,i){const n=t[0],o=t[1],a=t[2],l=t[3],c=n+n,u=o+o,h=a+a,d=n*c,p=n*u,f=n*h,m=o*u,g=o*h,y=a*h,_=l*c,b=l*u,S=l*h,x=s[0],w=s[1],v=s[2],M=i[0],I=i[1],P=i[2],T=(1-(m+y))*x,C=(p+S)*x,F=(f-b)*x,k=(p-S)*w,A=(1-(d+y))*w,O=(g+_)*w,E=(f+b)*v,z=(g-_)*v,R=(1-(d+m))*v;return e[0]=T,e[1]=C,e[2]=F,e[3]=0,e[4]=k,e[5]=A,e[6]=O,e[7]=0,e[8]=E,e[9]=z,e[10]=R,e[11]=0,e[12]=r[0]+M-(T*M+k*I+E*P),e[13]=r[1]+I-(C*M+A*I+z*P),e[14]=r[2]+P-(F*M+O*I+R*P),e[15]=1,e}function O(e,t){const r=t[0],s=t[1],i=t[2],n=t[3],o=r+r,a=s+s,l=i+i,c=r*o,u=s*o,h=s*a,d=i*o,p=i*a,f=i*l,m=n*o,g=n*a,y=n*l;return e[0]=1-h-f,e[1]=u+y,e[2]=d-g,e[3]=0,e[4]=u-y,e[5]=1-c-f,e[6]=p+m,e[7]=0,e[8]=d+g,e[9]=p-m,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function E(e,t,r,s,i,n,o){const a=1/(r-t),l=1/(i-s),c=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(i+s)*l,e[10]=(o+n)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*c,e[15]=0,e}function z(e,t,r,s,i){const n=1/Math.tan(t/2);let o;return e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(s-i),e[10]=(i+s)*o,e[14]=2*i*s*o):(e[10]=-1,e[14]=-2*s),e}function R(e,t,r,s){const i=Math.tan(t.upDegrees*Math.PI/180),n=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),a=Math.tan(t.rightDegrees*Math.PI/180),l=2/(o+a),c=2/(i+n);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-(o-a)*l*.5,e[9]=(i-n)*c*.5,e[10]=s/(r-s),e[11]=-1,e[12]=0,e[13]=0,e[14]=s*r/(r-s),e[15]=0,e}function L(e,t,r,s,i,n,o){const a=1/(t-r),l=1/(s-i),c=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+s)*l,e[14]=(o+n)*c,e[15]=1,e}function D(e,t,s,i){const o=t[0],a=t[1],l=t[2];let c=o-s[0],u=a-s[1],h=l-s[2];const d=r.getEpsilon();if(Math.abs(c)<d&&Math.abs(u)<d&&Math.abs(h)<d)return void n(e);let p=1/Math.sqrt(c*c+u*u+h*h);c*=p,u*=p,h*=p;const f=i[0],m=i[1],g=i[2];let y=m*h-g*u,_=g*c-f*h,b=f*u-m*c;p=Math.sqrt(y*y+_*_+b*b),p?(p=1/p,y*=p,_*=p,b*=p):(y=0,_=0,b=0);let S=u*b-h*_,x=h*y-c*b,w=c*_-u*y;p=Math.sqrt(S*S+x*x+w*w),p?(p=1/p,S*=p,x*=p,w*=p):(S=0,x=0,w=0),e[0]=y,e[1]=S,e[2]=c,e[3]=0,e[4]=_,e[5]=x,e[6]=u,e[7]=0,e[8]=b,e[9]=w,e[10]=h,e[11]=0,e[12]=-(y*o+_*a+b*l),e[13]=-(S*o+x*a+w*l),e[14]=-(c*o+u*a+h*l),e[15]=1}function N(e,t,r,s){const i=t[0],n=t[1],o=t[2],a=s[0],l=s[1],c=s[2];let u=i-r[0],h=n-r[1],d=o-r[2],p=u*u+h*h+d*d;p>0&&(p=1/Math.sqrt(p),u*=p,h*=p,d*=p);let f=l*d-c*h,m=c*u-a*d,g=a*h-l*u;return p=f*f+m*m+g*g,p>0&&(p=1/Math.sqrt(p),f*=p,m*=p,g*=p),e[0]=f,e[1]=m,e[2]=g,e[3]=0,e[4]=h*g-d*m,e[5]=d*f-u*g,e[6]=u*m-h*f,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=i,e[13]=n,e[14]=o,e[15]=1,e}function G(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function q(e){return Math.sqrt(e[0]**2+e[1]**2+e[2]**2+e[3]**2+e[4]**2+e[5]**2+e[6]**2+e[7]**2+e[8]**2+e[9]**2+e[10]**2+e[11]**2+e[12]**2+e[13]**2+e[14]**2+e[15]**2)}function B(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e[4]=t[4]+r[4],e[5]=t[5]+r[5],e[6]=t[6]+r[6],e[7]=t[7]+r[7],e[8]=t[8]+r[8],e[9]=t[9]+r[9],e[10]=t[10]+r[10],e[11]=t[11]+r[11],e[12]=t[12]+r[12],e[13]=t[13]+r[13],e[14]=t[14]+r[14],e[15]=t[15]+r[15],e}function U(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}function j(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*r,e[9]=t[9]*r,e[10]=t[10]*r,e[11]=t[11]*r,e[12]=t[12]*r,e[13]=t[13]*r,e[14]=t[14]*r,e[15]=t[15]*r,e}function V(e,t,r,s){return e[0]=t[0]+r[0]*s,e[1]=t[1]+r[1]*s,e[2]=t[2]+r[2]*s,e[3]=t[3]+r[3]*s,e[4]=t[4]+r[4]*s,e[5]=t[5]+r[5]*s,e[6]=t[6]+r[6]*s,e[7]=t[7]+r[7]*s,e[8]=t[8]+r[8]*s,e[9]=t[9]+r[9]*s,e[10]=t[10]+r[10]*s,e[11]=t[11]+r[11]*s,e[12]=t[12]+r[12]*s,e[13]=t[13]+r[13]*s,e[14]=t[14]+r[14]*s,e[15]=t[15]+r[15]*s,e}function W(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function Y(e,t){if(e===t)return!0;const s=e[0],i=e[1],n=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],y=e[14],_=e[15],b=t[0],S=t[1],x=t[2],w=t[3],v=t[4],M=t[5],I=t[6],P=t[7],T=t[8],C=t[9],F=t[10],k=t[11],A=t[12],O=t[13],E=t[14],z=t[15],R=r.getEpsilon();return Math.abs(s-b)<=R*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(i-S)<=R*Math.max(1,Math.abs(i),Math.abs(S))&&Math.abs(n-x)<=R*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(o-w)<=R*Math.max(1,Math.abs(o),Math.abs(w))&&Math.abs(a-v)<=R*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(l-M)<=R*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(c-I)<=R*Math.max(1,Math.abs(c),Math.abs(I))&&Math.abs(u-P)<=R*Math.max(1,Math.abs(u),Math.abs(P))&&Math.abs(h-T)<=R*Math.max(1,Math.abs(h),Math.abs(T))&&Math.abs(d-C)<=R*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(p-F)<=R*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(f-k)<=R*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(m-A)<=R*Math.max(1,Math.abs(m),Math.abs(A))&&Math.abs(g-O)<=R*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(y-E)<=R*Math.max(1,Math.abs(y),Math.abs(E))&&Math.abs(_-z)<=R*Math.max(1,Math.abs(_),Math.abs(z))}function H(e){const t=r.getEpsilon(),s=e[0],i=e[1],n=e[2],o=e[4],a=e[5],l=e[6],c=e[8],u=e[9],h=e[10];return Math.abs(1-(s*s+o*o+c*c))<=t&&Math.abs(1-(i*i+a*a+u*u))<=t&&Math.abs(1-(n*n+l*l+h*h))<=t}function $(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[8]&&0===e[9]&&1===e[10]}const X=h,Q=U,Z=Object.freeze(Object.defineProperty({__proto__:null,add:B,adjoint:c,copy:s,determinant:u,equals:Y,exactEquals:W,frob:q,fromQuat:O,fromQuat2:I,fromRotation:S,fromRotationTranslation:M,fromRotationTranslationScale:k,fromRotationTranslationScaleOrigin:A,fromScaling:b,fromTranslation:_,fromXRotation:x,fromYRotation:w,fromZRotation:v,frustum:E,getRotation:F,getScale:C,getTranslation:T,hasIdentityRotation:$,identity:n,invert:l,invertOrIdentity:a,isOrthoNormal:H,lookAt:D,mul:X,multiply:h,multiplyScalar:j,multiplyScalarAndAdd:V,ortho:L,perspective:z,perspectiveFromFieldOfView:R,rotate:f,rotateX:m,rotateY:g,rotateZ:y,scale:p,set:i,str:G,sub:Q,subtract:U,targetTo:N,translate:d,transpose:o},Symbol.toStringTag,{value:"Module"}));e.add=B,e.adjoint=c,e.copy=s,e.determinant=u,e.equals=Y,e.exactEquals=W,e.frob=q,e.fromQuat=O,e.fromQuat2=I,e.fromRotation=S,e.fromRotationTranslation=M,e.fromRotationTranslationScale=k,e.fromRotationTranslationScaleOrigin=A,e.fromScaling=b,e.fromTranslation=_,e.fromXRotation=x,e.fromYRotation=w,e.fromZRotation=v,e.frustum=E,e.getRotation=F,e.getScale=C,e.getTranslation=T,e.hasIdentityRotation=$,e.identity=n,e.invert=l,e.invertOrIdentity=a,e.isOrthoNormal=H,e.lookAt=D,e.mat4=Z,e.mul=X,e.multiply=h,e.multiplyScalar=j,e.multiplyScalarAndAdd=V,e.ortho=L,e.perspective=z,e.perspectiveFromFieldOfView=R,e.rotate=f,e.rotateX=m,e.rotateY=g,e.rotateZ=y,e.scale=p,e.set=i,e.str=G,e.sub=Q,e.subtract=U,e.targetTo=N,e.translate=d,e.transpose=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/basemapDefinitions":function(){define(["exports","../assets","../intl/messages"],function(e,t,r){"use strict";const s={satellite:{id:"satellite",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/satellite.jpg")},baseMapLayers:[{id:"satellite-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1}]},hybrid:{id:"hybrid",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/hybrid.jpg")},baseMapLayers:[{id:"hybrid-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Imagery",showLegend:!1,visibility:!0,opacity:1},{id:"hybrid-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/30d6b8271e1849cd9c3042060001f425/resources/styles/root.json",layerType:"VectorTileLayer",title:"Hybrid Reference Layer",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},terrain:{id:"terrain",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/terrain.jpg")},baseMapLayers:[{id:"terrain-base-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Terrain Base",showLegend:!1,visibility:!0,opacity:1},{id:"terrain-reference-layer",url:"//services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Reference Overlay",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},oceans:{id:"oceans",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/oceans.jpg")},baseMapLayers:[{id:"oceans-base-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Base",showLegend:!1,visibility:!0,opacity:1},{id:"oceans-reference-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Ocean Reference",isReference:!0,showLegend:!1,visibility:!0,opacity:1}]},osm:{id:"osm",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm.jpg")},baseMapLayers:[{id:"osm-base-layer",layerType:"OpenStreetMap",title:"Open Street Map",showLegend:!1,visibility:!0,opacity:1}]},"dark-gray-vector":{id:"dark-gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/dark-gray-vector.jpg")},baseMapLayers:[{id:"dark-gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/5e9b3685f4c24d8781073dd928ebda50/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Base",visibility:!0,opacity:1},{id:"dark-gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/747cb7a5329c478cbe6981076cc879c5/resources/styles/root.json",layerType:"VectorTileLayer",title:"Dark Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get"dark-gray"(){return{...this["dark-gray-vector"],id:"dark-gray"}},"gray-vector":{id:"gray-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-vector.jpg")},baseMapLayers:[{id:"gray-base-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/291da5eab3a0412593b66d384379f89f/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Base",visibility:!0,opacity:1},{id:"gray-reference-layer",styleUrl:"https://cdn.arcgis.com/sharing/rest/content/items/1768e8369a214dfab4e2167d5c5f2454/resources/styles/root.json",layerType:"VectorTileLayer",title:"Light Gray Reference",isReference:!0,visibility:!0,opacity:1}]},get gray(){return{...this["gray-vector"],id:"gray"}},"streets-vector":{id:"streets-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-vector.jpg")},baseMapLayers:[{id:"streets-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/de26a3cf4cc9451298ea173c4b324736/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets",visibility:!0,opacity:1}]},get streets(){return{...this["streets-vector"],id:"streets"}},"topo-vector":{id:"topo-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-vector.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"topo-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/7dc6cea0b1764a1f9af2e679f642f0f5/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Topo",visibility:!0,opacity:1}]},get topo(){return{...this["topo-vector"],id:"topo"}},"streets-night-vector":{id:"streets-night-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-night.jpg")},baseMapLayers:[{id:"streets-night-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/86f556a2d1fd468181855a35e344567f/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Night",visibility:!0,opacity:1}]},"streets-relief-vector":{id:"streets-relief-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-relief.jpg")},baseMapLayers:[{id:"world-hillshade-layer",url:"//services.arcgisonline.com/arcgis/rest/services/Elevation/World_Hillshade/MapServer",layerType:"ArcGISTiledMapServiceLayer",title:"World Hillshade",showLegend:!1,visibility:!0,opacity:1},{id:"streets-relief-vector-base-layer",styleUrl:"//www.arcgis.com/sharing/rest/content/items/b266e6d17fc345b498345613930fbd76/resources/styles/root.json",title:"World Streets Relief",layerType:"VectorTileLayer",visibility:!0,opacity:1}]},"streets-navigation-vector":{id:"streets-navigation-vector",classic:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-navigation.jpg")},baseMapLayers:[{id:"streets-navigation-vector-base-layer",styleUrl:"//cdn.arcgis.com/sharing/rest/content/items/63c47b7177f946b49902c24129b87252/resources/styles/root.json",layerType:"VectorTileLayer",title:"World Streets Navigation",visibility:!0,opacity:1}]},"topo-3d":{id:"topo-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/topo-3d.png")},baseMapLayers:[{id:"topo-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/1e7d1784d1ef4b79ba6764d0bd6c3150/resources/styles/root.json",layerType:"VectorTileLayer",title:"Topographic",visibility:!0,opacity:1},{id:"topo-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"topo-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-3d":{id:"navigation-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/navigation-3d.jpg")},baseMapLayers:[{id:"navigation-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/ccc904ff872b4144b94934e55e32784b/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation",visibility:!0,opacity:1},{id:"navigation-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-3d":{id:"streets-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/streets-3d.png")},baseMapLayers:[{id:"streets-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/198298c4c64c4cb19de5b46aa00c198d/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"streets-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"streets-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"osm-3d":{id:"osm-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/osm-3d.png")},baseMapLayers:[{id:"osm-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/8628d259c9d14bdc848771c23c513940/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap",visibility:!0,opacity:1},{id:"osm-3d-trees",title:"Trees",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Trees_Thematic_v1/SceneServer",itemId:"f75fef56b2d944fe92ef9f7737b4f953",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"osm-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"gray-3d":{id:"gray-3d",is3d:!0,get thumbnailUrl(){return t.getAssetUrl("esri/images/basemap/gray-3d.png")},baseMapLayers:[{id:"gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/01a14b466345455ba4176d2e6390db92/resources/styles/root.json",layerType:"VectorTileLayer",title:"Streets",visibility:!0,opacity:1},{id:"gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_DarkLabels_v1/SceneServer",itemId:"a84404ad39c64c328d0596e361ec459b",layerType:"ArcGISSceneServiceLayer"},{id:"gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"navigation-dark-3d":{id:"navigation-dark-3d",itemId:"5a1365328b4943f09a54cf5fd1205707",is3d:!0,baseMapLayers:[{id:"navigation-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/451a1777ab3f4bf095fae24a117439d9/resources/styles/root.json",layerType:"VectorTileLayer",title:"Navigation Dark"},{id:"navigation-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"navigation-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"streets-dark-3d":{id:"streets-dark-3d",itemId:"8a4efa2c20484ec9b4557895e65736ff",is3d:!0,baseMapLayers:[{id:"streets-dark-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/bc599b6d741a4ac084b7eea7bf8c5938/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Streets Night (for 3D)"},{id:"streets-dark-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"streets-dark-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]},"dark-gray-3d":{id:"dark-gray-3d",itemId:"a8b7322a5fe94002bb0f5e0eeb0c5c18",is3d:!0,baseMapLayers:[{id:"dark-gray-3d-base-layer",styleUrl:"https://www.arcgis.com/sharing/rest/content/items/4178f71acb934fb89f169e7d667c20c6/resources/styles/root.json",layerType:"VectorTileLayer",title:"OpenStreetMap Dark Gray Canvas (for 3D)"},{id:"dark-gray-3d-places-and-labels",title:"Places and Labels",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_LightLabels_v1/SceneServer/layers/0",itemId:"f364b70b012a4da5a4b5921e193eac4a",layerType:"ArcGISSceneServiceLayer"},{id:"dark-gray-3d-buildings",title:"Buildings",url:"https://basemaps3d.arcgis.com/arcgis/rest/services/OpenStreetMap3D_Buildings_v1/SceneServer",itemId:"ca0470dbbddb4db28bad74ed39949e25",layerType:"ArcGISSceneServiceLayer"}]}};e.esriBasemapDefinitions=s,e.getBasemapTitle=async function(e){if(!e)return;const t=e.includes("-vector")?e.slice(0,e.indexOf("-vector")):e.includes("-3d")?e.slice(0,e.indexOf("-3d")):e,s=await r.fetchMessageBundle("esri/t9n/basemaps");return s[e]||s[t]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl/messages":function(){define(["exports","../core/Error","../core/handleUtils","../core/promiseUtils","./locale"],function(e,t,r,s,i){"use strict";const n={ar:!0,bg:!0,bs:!0,ca:!0,cs:!0,da:!0,de:!0,el:!0,en:!0,es:!0,et:!0,fi:!0,fr:!0,he:!0,hr:!0,hu:!0,id:!0,it:!0,ja:!0,ko:!0,lt:!0,lv:!0,nb:"no",nl:!0,no:!0,nn:"no",pl:!0,pt:"pt-BR","pt-BR":!0,"pt-PT":!0,ro:!0,ru:!0,sk:!0,sl:!0,sr:!0,sv:!0,th:!0,tr:!0,uk:!0,vi:!0,zh:"zh-CN","zh-CN":!0,"zh-HK":!0,"zh-TW":!0};function o(e){if(function(e){return e in n}(e)){const t=n[e];return!0===t?e:t}return null}const a=[],l=new Map;function c(e){for(const t of l.keys())u(e.pattern,t)&&l.delete(t)}function u(e,t){return"string"==typeof e?t.startsWith(e):e.test(t)}i.beforeLocaleChange(()=>{l.clear()});const h=new class{constructor(){this._numLoading=0,this._dfd=null}async waitForAll(){this._dfd&&await this._dfd.promise}add(e){return this._increase(),e.then(()=>this._decrease(),()=>this._decrease()),this.waitForAll()}_increase(){this._numLoading++,this._dfd||(this._dfd=s.createResolver())}_decrease(){this._numLoading=Math.max(this._numLoading-1,0),this._dfd&&0===this._numLoading&&(this._dfd.resolve(),this._dfd=null)}},d={cache:l,loaders:a};e.fetchMessageBundle=async function(e){const r=i.getLocale();l.has(e)||l.set(e,async function(e,r){const s=[];for(const t of a)if(u(t.pattern,e))try{return await t.fetchMessageBundle(e,r)}catch(e){s.push(e)}if(s.length)throw new t("intl:message-bundle-error",`Errors occurred while loading "${e}"`,{errors:s});throw new t("intl:no-message-bundle-loader",`No loader found for message bundle "${e}"`)}(e,r));const s=l.get(e);return s&&await h.add(s),s},e.messageBundlesLocaleMap=n,e.normalizeMessageBundleLocale=function(e){const t=i.getLocaleLanguage(e);return t?o(e)??o(t):null},e.registerMessageBundleLoader=function(e){return a.includes(e)||(c(e),a.unshift(e)),r.makeHandle(()=>{const t=a.indexOf(e);t>-1&&(a.splice(t,1),c(e))})},e.test=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(e,t,r){"use strict";const s=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,i=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),n=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),o=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function a(e){return null==e||"string"==typeof e&&!e?"<Null>":e}function l(e){const t=null!=e.normalizationField||null!=e.normalizationType,r=null!=e.minValue||null!=e.maxValue,s=!!e.sqlExpression&&e.supportsSQLExpression;return!t&&!r&&!s}function c(e){const{values:t,useSampleStdDev:r,supportsNullCount:s,outStatisticTypes:i}=e;let n=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=null,l=null,c=null,h=null,d=0;const p=null==e.minValue?-1/0:e.minValue,f=null==e.maxValue?1/0:e.maxValue;for(const e of t)Number.isFinite(e)?e>=p&&e<=f&&(a=null===a?e:a+e,n=Math.min(n,e),o=Math.max(o,e),d++):"string"==typeof e&&d++;if(d&&null!=a){l=a/d;let e=0;for(const r of t)Number.isFinite(r)&&r>=p&&r<=f&&(e+=(r-l)**2);h=r?d>1?e/(d-1):0:d>0?e/d:0,c=Math.sqrt(h)}else n=null,o=null;const m={avg:l,count:d,max:o,min:n,stddev:c,sum:a,variance:h};return s&&(m.nullcount=t.length-d),!e.percentileParams||i?.include?.length&&!i.include.includes("median")||i?.exclude?.length&&i.exclude.includes("median")||(m.median=u(t,e.percentileParams)),m}function u(e,t){const{fieldType:r,value:s,orderBy:i,isDiscrete:n}=t,o=h(r,"desc"===i);if(0===(e=[...e].filter(e=>null!=e).sort((e,t)=>o(e,t))).length)return null;if(s<=0)return e[0];if(s>=1)return e[e.length-1];const a=(e.length-1)*s,l=Math.floor(a),c=l+1,u=a%1,d=e[l],p=e[c];return c>=e.length||n||"string"==typeof d||"string"==typeof p?d:d*(1-u)+p*u}function h(e,t){if(e){if(i.has(e))return w(t);if(n.has(e))return b(t,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?g:m}(t);const r=b(t,!0);if("esriFieldTypeString"===e)return r;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,t)=>r(v(e),v(t))}const r=t?1:-1,s=w(t),o=b(t,!0),a=f(t);return(e,t)=>"number"==typeof e&&"number"==typeof t?s(e,t):"string"==typeof e&&"string"==typeof t?o(e,t):a(e,t)??r}const d=(e,t)=>null==e?null==t?0:1:null==t?-1:null,p=(e,t)=>null==e?null==t?0:-1:null==t?1:null;function f(e){return e?d:p}const m=(e,t)=>p(e,t)??(e===t?0:new Date(e).getTime()-new Date(t).getTime()),g=(e,t)=>d(e,t)??(e===t?0:new Date(t).getTime()-new Date(e).getTime()),y=(e,t)=>p(e,t)??(e===t?0:e<t?-1:1),_=(e,t)=>d(e,t)??(e===t?0:e<t?1:-1);function b(e,t){if(!t)return e?_:y;const r=f(e);return e?(e,t)=>{const s=r(e,t);return null!=s?s:(e=e.toUpperCase())>(t=t.toUpperCase())?-1:e<t?1:0}:(e,t)=>{const s=r(e,t);return null!=s?s:(e=e.toUpperCase())<(t=t.toUpperCase())?-1:e>t?1:0}}const S=(e,t)=>d(e,t)??t-e,x=(e,t)=>p(e,t)??e-t;function w(e){return e?S:x}function v(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function M(e){return"coded-value"!==e?.type?[]:e.codedValues.map(e=>e.code)}function I(e,t,s){const i=P({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,definedInterval:t.definedInterval,breakCount:t.numClasses||5});return e=function(e,t,r){const s=t??-1/0,i=r??1/0;return e.filter(e=>Number.isFinite(e)&&e>=s&&e<=i)}(e,t.minValue,t.maxValue),r.createGenerateRendererClassBreaks({definition:i,values:e,normalizationTotal:t.normalizationTotal},s)}function P(e){const{breakCount:r,field:s,normalizationField:i,normalizationType:n}=e,o=e.classificationMethod||"equal-interval",a="standard-deviation"===o?e.standardDeviationInterval||1:void 0,l="defined-interval"===o?e.definedInterval:void 0;return new t({breakCount:r,classificationField:s,classificationMethod:o,normalizationField:"field"===n?i:void 0,normalizationType:n,standardDeviationInterval:a,definedInterval:l})}function T(e,t,r=!1){const{field:s,classificationMethod:i,standardDeviationInterval:n,definedInterval:o,normalizationType:a,normalizationField:u,normalizationTotal:h,minValue:d,maxValue:p}=t,f=t.numBins||10;let m=null,g=null,y=null;if(i&&"equal-interval"!==i||a){const{classBreaks:t}=I(e,{field:s,normalizationType:a,normalizationField:u,normalizationTotal:h,classificationMethod:i,standardDeviationInterval:n,definedInterval:o,minValue:d,maxValue:p,numClasses:f},null!=d&&null!=p?[d,p]:void 0);m=t[0]?.minValue,g=t[t.length-1]?.maxValue,y=t.map(e=>[e.minValue,e.maxValue])}else{if(null!=d&&null!=p)m=d,g=p;else{const t=c({values:e,minValue:d,maxValue:p,useSampleStdDev:!a,supportsNullCount:l({normalizationType:a,normalizationField:u,minValue:d,maxValue:p})});m=t.min??null,g=t.max??null}y=F(m??0,g??0,f)}if(r&&y.length){const e=y.at(-1)[1];y.push([e,e])}return{min:m,max:g,intervals:y}}function C(e,t){let r=-1;for(let s=e.length-1;s>=0;s--)if(t>=e[s][0]){r=s;break}return r}function F(e,t,r){const s=(t-e)/r,i=[];let n,o=e;for(let e=1;e<=r;e++)n=o+s,n=Number(n.toFixed(16)),i.push([o,e===r?t:n]),o=n;return i}e.binIndex=C,e.calculateClassBreaks=I,e.calculateHistogram=function(e,t){const r=T(e,t);if(null==r.min&&null==r.max)return{bins:[],minValue:r.min,maxValue:r.max,normalizationTotal:t.normalizationTotal};const s=r.intervals,i=r.min??0,n=r.max??0,o=s.map((e,t)=>({minValue:s[t][0],maxValue:s[t][1],count:0}));for(const t of e)if(null!=t&&t>=i&&t<=n){const e=C(s,t);e>-1&&o[e].count++}return{bins:o,minValue:i,maxValue:n,normalizationTotal:t.normalizationTotal}},e.calculatePercentile=u,e.calculateStatistics=c,e.calculateStringStatistics=function(e){const{outStatisticTypes:t}=e,r=e.returnDistinct?[...new Set(e.values)]:e.values,s=r.filter(e=>null!=e).sort(),i=s.length,n={count:i,min:s[0],max:s[i-1]};return e.supportsNullCount&&(n.nullcount=r.length-i),!e.percentileParams||t?.include?.length&&!t.include.includes("median")||t?.exclude?.length&&t.exclude.includes("median")||(n.median=u(r,e.percentileParams)),n},e.calculateUniqueValuesCount=function(e){const t={};for(let r of e)(null==r||"string"==typeof r&&""===r.trim())&&(r=null),null==t[r]?t[r]={count:1,data:r}:t[r].count++;return{count:t}},e.createClassBreaksDefinition=P,e.createUVResult=function(e,t,r,s){const i=e.count,n=[];if(r&&t){const e=[],r=M(t[0]);for(const i of r)if(t[1]){const r=M(t[1]);for(const n of r)if(t[2]){const r=M(t[2]);for(const t of r)e.push(`${a(i)}${s}${a(n)}${s}${a(t)}`)}else e.push(`${a(i)}${s}${a(n)}`)}else e.push(i);for(const t of e)i.hasOwnProperty(t)||(i[t]={data:t,count:0})}for(const e in i){const t=i[e];n.push({value:t.data,count:t.count,label:t.label})}return{uniqueValueInfos:n}},e.getAttributeComparator=h,e.getBinParams=T,e.getEqualIntervalBins=F,e.getNormalizedValue=function(e,t,r,s){let i=null;switch(t){case"log":0!==e&&(i=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(s)&&0!==s&&(i=e/s*100);break;case"field":Number.isFinite(r)&&0!==r&&(i=e/r);break;case"natural-log":e>0&&(i=Math.log(e));break;case"square-root":e>0&&(i=e**.5)}return i},e.isNullCountSupported=l,e.processNullValue=a,e.processSummaryStatisticsResult=function(e,t,r){let s;for(s in e)t?.include?.length&&!t.include.includes(s)||t?.exclude?.length&&t.exclude.includes(s)?delete e[s]:o.includes(s)&&(Number.isFinite(e[s])||(e[s]=null));return r?(["avg","stddev","variance"].forEach(t=>{null!=e[t]&&(e[t]=Math.ceil(e[t]??0))}),e):e},e.resolveCBResult=function(e,t){let r=e.classBreaks;const i=r.length,n=r[0]?.minValue,o=r[i-1]?.maxValue,a="standard-deviation"===t,l=s;return r=r.map(e=>{const t=e.label,r={minValue:e.minValue,maxValue:e.maxValue,label:t};if(a&&t){const e=t.match(l),s=e?.map(e=>+e.trim())??[];2===s.length?(r.minStdDev=s[0],r.maxStdDev=s[1],s[0]<0&&s[1]>0&&(r.hasAvg=!0)):1===s.length&&(t.includes("<")?(r.minStdDev=null,r.maxStdDev=s[0]):t.includes(">")&&(r.minStdDev=s[0],r.maxStdDev=null))}return r}),{minValue:n,maxValue:o,classBreakInfos:r,normalizationTotal:e.normalizationTotal}},e.statisticTypes=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a,l,c){"use strict";const u=new r.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"}),h=new r.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});return e.default=class extends s.JSONSupport{constructor(e){super(e),this.type="class-breaks-definition",this.breakCount=null,this.classificationField=null,this.classificationMethod=null,this.normalizationField=null,this.normalizationType=null}set standardDeviationInterval(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}set definedInterval(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}},t.__decorate([l.enumeration({classBreaksDef:"class-breaks-definition"})],e.default.prototype,"type",void 0),t.__decorate([i.property({json:{write:!0}})],e.default.prototype,"breakCount",void 0),t.__decorate([i.property({json:{write:!0}})],e.default.prototype,"classificationField",void 0),t.__decorate([i.property({type:String,json:{read:u.read,write:u.write}})],e.default.prototype,"classificationMethod",void 0),t.__decorate([i.property({json:{write:!0}})],e.default.prototype,"normalizationField",void 0),t.__decorate([i.property({json:{read:h.read,write:h.write}})],e.default.prototype,"normalizationType",void 0),t.__decorate([i.property({value:null,json:{write:!0}})],e.default.prototype,"standardDeviationInterval",null),t.__decorate([i.property({value:null,json:{write:!0}})],e.default.prototype,"definedInterval",null),e.default=t.__decorate([c.subclass("esri.rest.support.ClassBreaksDefinition")],e.default),e.default})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(e,t){"use strict";function r(e,t){return Number(e.toFixed(t))}function s(e,t,r){let s=null;return s=e===t?r&&"percent-of-total"===r?e+"%":e.toString():r&&"percent-of-total"===r?e+"% - "+t+"%":e+" - "+t,s}function i(e){const t=[],r=[];let s=Number.MIN_VALUE,i=1,n=-1;for(let o=0;o<e.length;o++){const a=e[o];a===s?(i++,r[n]=i):null!==a&&(t.push(a),s=a,i=1,r.push(i),n++)}return{uniqueValues:t,valueFrequency:r}}function n(e,t,r,s){let i=[],n=[],a=[],l=0;const c=[],u=[];for(let i=0;i<s;i++){const s=o(i,e,t,r);c.push(s.sbMean),u.push(s.sbSdcm),l+=u[i]}let h,d=l,p=!0;for(;p||l<d;){p=!1,i=[];for(let t=0;t<s;t++)i.push(e[t]);for(let r=0;r<s;r++)for(let i=e[r]+1;i<=e[r+1];i++)if(h=t[i],r>0&&i!==e[r+1]&&Math.abs(h-c[r])>Math.abs(h-c[r-1]))e[r]=i;else if(r<s-1&&e[r]!==i-1&&Math.abs(h-c[r])>Math.abs(h-c[r+1])){e[r+1]=i-1;break}d=l,l=0,n=[],a=[];for(let i=0;i<s;i++){n.push(c[i]),a.push(u[i]);const s=o(i,e,t,r);c[i]=s.sbMean,u[i]=s.sbSdcm,l+=u[i]}}if(l>d){for(let t=0;t<s;t++)e[t]=i[t],c[t]=n[t],u[t]=a[t];l=d}return{mean:c,sdcm:u}}function o(e,r,s,i){let n=0,o=0;for(let t=r[e]+1;t<=r[e+1];t++){const e=i[t];n+=s[t]*e,o+=e}o<=0&&t.getLogger("esri.rest.support.generateRendererUtils").warn("Exception in Natural Breaks calculation");const a=n/o;let l=0;for(let t=r[e]+1;t<=r[e+1];t++)l+=i[t]*(s[t]-a)**2;return{sbMean:a,sbSdcm:l}}e.createGenerateRendererClassBreaks=function(e,t){const{normalizationTotal:a}=e;return{classBreaks:function(e,t){const a=e.definition,{classificationMethod:l,normalizationType:c,definedInterval:u}=a,h=a.breakCount??1,d=[];let p=e.values;if(0===p.length)return[];p=p.sort((e,t)=>e-t);const[f,m]=t??[p.at(0),p.at(-1)];if("equal-interval"===l)if(p.length>=h){const e=(m-f)/h;let t=f;for(let i=1;i<h;i++){const n=r(f+i*e,6);d.push({minValue:t,maxValue:n,label:s(t,n,c)}),t=n}d.push({minValue:t,maxValue:m,label:s(t,m,c)})}else p.forEach(e=>{d.push({minValue:e,maxValue:e,label:s(e,e,c)})});else if("natural-breaks"===l){const t=i(p),a=e.valueFrequency||t.valueFrequency,l=function(e,t,r){const s=e.length,i=[];r>s&&(r=s);for(let e=0;e<r;e++)i.push(Math.round(e*s/r-1));i.push(s-1);let a=n(i,e,t,r);return function(e,t,r,s,i,n){let a=0,l=0,c=0,u=0,h=!0;for(let d=0;d<2&&h;d++){0===d&&(h=!1);for(let d=0;d<n-1;d++)for(;r[d+1]+1!==r[d+2];){r[d+1]=r[d+1]+1;const n=o(d,r,s,i);c=n.sbMean,a=n.sbSdcm;const p=o(d+1,r,s,i);if(u=p.sbMean,l=p.sbSdcm,!(a+l<t[d]+t[d+1])){r[d+1]=r[d+1]-1;break}t[d]=a,t[d+1]=l,e[d]=c,e[d+1]=u,h=!0}for(let d=n-1;d>0;d--)for(;r[d]!==r[d-1]+1;){r[d]=r[d]-1;const n=o(d-1,r,s,i);c=n.sbMean,a=n.sbSdcm;const p=o(d,r,s,i);if(u=p.sbMean,l=p.sbSdcm,!(a+l<t[d-1]+t[d])){r[d]=r[d]+1;break}t[d-1]=a,t[d]=l,e[d-1]=c,e[d]=u,h=!0}}return h}(a.mean,a.sdcm,i,e,t,r)&&(a=n(i,e,t,r)),i}(t.uniqueValues,a,h);let u=f;for(let e=1;e<h;e++)if(t.uniqueValues.length>e){const i=r(t.uniqueValues[l[e]],6);d.push({minValue:u,maxValue:i,label:s(u,i,c)}),u=i}d.push({minValue:u,maxValue:m,label:s(u,m,c)})}else if("quantile"===l)if(p.length>=h&&f!==m){let e=f,t=Math.ceil(p.length/h),r=0;for(let i=1;i<h;i++){let n=t+r-1;n>p.length&&(n=p.length-1),n<0&&(n=0),d.push({minValue:e,maxValue:p[n],label:s(e,p[n],c)}),e=p[n],r+=t,t=Math.ceil((p.length-r)/(h-i))}d.push({minValue:e,maxValue:m,label:s(e,m,c)})}else{let e=-1;for(let t=0;t<p.length;t++){const r=p[t];r!==e&&(e=r,d.push({minValue:e,maxValue:r,label:s(e,r,c)}),e=r)}}else if("standard-deviation"===l){const e=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r];return t/=e.length,t}(p),t=function(e,t){let r=0;for(let s=0;s<e.length;s++){const i=e[s];r+=(i-t)*(i-t)}return r/=e.length,Math.sqrt(r)}(p,e);if(0===t)d.push({minValue:p[0],maxValue:p[0],label:s(p[0],p[0],c)});else{const i=function(e,t,r,s,i){let n=Math.max(s-e,t-s)/i/r;return n=n>=1?1:n>=.5?.5:.25,n}(f,m,h,e,t),n=i*t;let o=0,a=f;for(let t=h;t>=1;t--){const i=r(e-(t-.5)*n,6);d.push({minValue:a,maxValue:i,label:s(a,i,c)}),a=i,o++}let l=r(e+.5*n,6);d.push({minValue:a,maxValue:l,label:s(a,l,c)}),a=l,o++;for(let t=1;t<=h;t++)l=o===2*h?m:r(e+(t+.5)*n,6),d.push({minValue:a,maxValue:l,label:s(a,l,c)}),a=l,o++}}else if("defined-interval"===l){if(!u)return d;const[e,i]=t??[p.at(0),p.at(-1)],n=Math.ceil((i-e)/u);let o=e;for(let t=1;t<n;t++){const i=r(e+t*u,6);d.push({minValue:o,maxValue:i,label:s(o,i,c)}),o=i}d.push({minValue:o,maxValue:i,label:s(o,i,c)})}return d}(e,t),normalizationTotal:a}},e.createGenerateRendererUniqueValues=function(e){const t=i(e),r=[],s=t.uniqueValues.length;for(let e=0;e<s;e++){const s=t.uniqueValues[e],i=t.valueFrequency[e],n=s.toString();r.push({value:s,count:i,label:n})}return{uniqueValues:r}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/queryUtils":function(){define(["require","exports","../../../core/Error","../../../core/jsonMap","../../../core/unitUtils","../../../geometry/projectionUtils","../../../geometry/support/extentUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","./projectionSupport"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";const h=new s.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),d=Object.freeze({});async function p(e,t,r){const{outFields:s,orderByFields:i,groupByFieldsForStatistics:n,outStatistics:o}=e;if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(i)for(let e=0;e<i.length;e++)i[e]=i[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(o)for(let e=0;e<o.length;e++)o[e].onStatisticField&&(o[e].onStatisticField=o[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),f(e,t,r)}async function f(t,s,n){if(!t)return null;let{where:p}=t;if(t.where=p=p?.trim(),(!p||/^1 *= *1$/.test(p)||s&&s===p)&&(t.where=null),!t.geometry)return t;let f=await async function(t){const{distance:s,units:n}=t,o=t.geometry;if(null==s||"vertexAttributes"in o)return o;const l=o.spatialReference,d=n?h.fromJSON(n):i.getUnitString(l),p=l&&(c.isGeographic(l)||c.isWebMercator(l))?o:await u.checkProjectionSupport(l,c.wgs84).then(()=>u.project(o,c.wgs84)),f=await new Promise((t,r)=>e(["../../../geometry/operators/json/geodesicBufferOperator"],t,r));await f.load();const m=f.execute(p,s||1,{unit:d})??void 0;if(!m||!a.isPolygon(m)||0===m.rings.length)throw new r("unsupported-query:invalid-parameters","Invalid parameters for query by distance");return m}(t);if(t.distance=0,t.units=null,"esriSpatialRelEnvelopeIntersects"===t.spatialRel){const{spatialReference:e}=t.geometry;f=o.getGeometryExtent(f),f.spatialReference=e}if(f){await u.checkProjectionSupport(f.spatialReference,n),f=function(e,t){const r=e.spatialReference;return m(e,t)&&a.isExtent(e)?{spatialReference:r,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(f,n);const e=(await l.normalizeCentralMeridian(a.fromJSON(f)))[0];if(null==e)throw d;const r="quantizationParameters"in t&&t.quantizationParameters?.tolerance||"maxAllowableOffset"in t&&t.maxAllowableOffset||0,s=r&&m(f,n)?{densificationStep:8*r}:void 0,i=e.toJSON(),o=u.project(i,i.spatialReference,n,s);if(!o)throw d;o.spatialReference=n,t.geometry=o}return t}function m(e,t){if(!e)return!1;const r=e.spatialReference;return(a.isExtent(e)||a.isPolygon(e)||a.isPolyline(e))&&!c.equals(r,t)&&!n.canProjectWithoutEngine(r,t)}t.getDateInNumber=function(e,t){return null==e?null:"string"==typeof e?t?new Date(`1970-01-01T${e}Z`).getTime():new Date(e).getTime():e instanceof Date?e.getTime():e},t.normalizeAttributeBinsQuery=async function(e,t,r){const s=e.bin;return s.onField&&(s.onField=s.onField.trim()),s.onExpression?.value&&(s.onExpression.value=s.onExpression.value.trim()),s.splitBy&&(s.splitBy.value&&(s.splitBy.value=s.splitBy.value.trim()),s.splitBy.outAlias&&(s.splitBy.outAlias=s.splitBy.outAlias.trim())),s.stackBy&&(s.stackBy.value&&(s.stackBy.value=s.stackBy.value.trim()),s.stackBy.outAlias&&(s.stackBy.outAlias=s.stackBy.outAlias.trim())),"normalizationField"in s.parameters&&s.parameters.normalizationField&&(s.parameters.normalizationField=s.parameters.normalizationField.trim()),e.outStatistics?.length||(e.outStatistics=[{statisticType:"count",onStatisticField:"1",outStatisticFieldName:"frequency"}]),p(e,t,r)},t.normalizeQuery=p,t.normalizeQueryLike=f,t.queryEngineEmptyResult=d,t.unitsKebabDict=h,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtils":function(){define(["exports","../../config","../../core/Error","../../core/Logger","../Polygon","../Polyline","./normalizeUtilsCommon","./spatialReferenceUtils","./webMercatorUtils","../../rest/geometryService/cut","../../rest/geometryService/simplify"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";const h=()=>s.getLogger("esri.geometry.support.normalizeUtils");function d(e){return"polygon"===e[0].type}function p(e){return"polyline"===e[0].type}function f(e){const t=[];let r=0,s=0;for(let i=0;i<e.length;i++){const n=e[i];let o=null;for(let e=0;e<n.length;e++)o=n[e],t.push(o),0===e?(r=o[0],s=r):(r=Math.min(r,o[0]),s=Math.max(s,o[0]));o&&t.push([(r+s)/2,0])}return t}function m(e,t){if(!(e instanceof n||e instanceof i)){const e="straightLineDensify: the input geometry is neither polyline nor polygon";throw h().error(e),new r("internal:geometry",e)}const s=o.getGeometryParts(e),a=[];for(const e of s){const r=[];a.push(r),r.push([e[0][0],e[0][1]]);for(let s=0;s<e.length-1;s++){const i=e[s][0],n=e[s][1],o=e[s+1][0],a=e[s+1][1],l=Math.sqrt((o-i)*(o-i)+(a-n)*(a-n)),c=(a-n)/l,u=(o-i)/l,h=l/t;if(h>1){for(let e=1;e<=h-1;e++){const s=e*t,o=u*s+i,a=c*s+n;r.push([o,a])}const e=(l+Math.floor(h-1)*t)/2,s=u*e+i,o=c*e+n;r.push([s,o])}r.push([o,a])}}return function(e){return"polygon"===e.type}(e)?new i({rings:a,spatialReference:e.spatialReference}):new n({paths:a,spatialReference:e.spatialReference})}function g(e,t,r){if(t){const t=m(e,1e6);e=l.webMercatorToGeographic(t,!0)}return r&&(e=o.updatePolyGeometry(e,r)),e}function y(e,t,r){if(Array.isArray(e)){const s=e[0];if(s>t){const r=o.offsetMagnitude(s,t);e[0]=s+r*(-2*t)}else if(s<r){const t=o.offsetMagnitude(s,r);e[0]=s+t*(-2*r)}}else{const s=e.x;if(s>t){const r=o.offsetMagnitude(s,t);e=e.clone().offset(r*(-2*t),0)}else if(s<r){const t=o.offsetMagnitude(s,r);e=e.clone().offset(t*(-2*r),0)}}return e}e.getClosestDenormalizedXToReference=function(e,t,r){const s=a.getInfo(r);if(null==s)return e;const[i,n]=s.valid,o=2*n;let l=0,c=0;t>n?l=Math.ceil(Math.abs(t-n)/o):t<i&&(l=-Math.ceil(Math.abs(t-i)/o)),e>n?c=Math.ceil(Math.abs(e-n)/o):e<i&&(c=-Math.ceil(Math.abs(e-i)/o));let u=e+(l-c)*o;const h=u-t;return h>n?u-=o:h<i&&(u+=o),u},e.getDenormalizedExtent=function(e){if(!e)return null;const t=e.extent;if(!t)return null;const r=e.spatialReference&&a.getInfo(e.spatialReference);if(!r)return t;const[s,i]=r.valid,n=2*i,{width:o}=t;let l,{xmin:c,xmax:u}=t;if([c,u]=[u,c],"extent"===e.type||0===o||o<=i||o>n||c<s||u>i)return t;switch(e.type){case"polygon":if(!(e.rings.length>1))return t;l=f(e.rings);break;case"polyline":if(!(e.paths.length>1))return t;l=f(e.paths);break;case"multipoint":l=e.points}const h=t.clone();for(let e=0;e<l.length;e++){let t=l[e][0];t<0?(t+=i,u=Math.max(t,u)):(t-=i,c=Math.min(t,c))}return h.xmin=c,h.xmax=u,h.width<o?(h.xmin-=i,h.xmax-=i,h):t},e.normalizeCentralMeridian=async function e(r,s,f){if(!Array.isArray(r))return e([r],s);s&&"string"!=typeof s&&h().warn("normalizeCentralMeridian()","The url object is deprecated, use the url string instead");const m="string"==typeof s?s:s?.url??t.geometryServiceUrl;let _,b,S,x,w,v,M,I,P=0;const T=[],C=[];for(const e of r)if(null!=e)if(_||(_=e.spatialReference,b=a.getInfo(_),S=_.isWebMercator,v=S?102100:4326,x=o.cutParams[v].maxX,w=o.cutParams[v].minX,M=o.cutParams[v].plus180Line,I=o.cutParams[v].minus180Line),b)if("mesh"===e.type)C.push(e);else if("point"===e.type)C.push(y(e.clone(),x,w));else if("multipoint"===e.type){const t=e.clone();t.points=t.points.map(e=>y(e,x,w)),C.push(t)}else if("extent"===e.type){const t=e.clone()._normalize(!1,!1,b);C.push(t.rings?new i(t):t)}else if(e.extent){const t=e.extent,r=o.offsetMagnitude(t.xmin,w)*(2*x);let s=0===r?e.clone():o.updatePolyGeometry(e.clone(),r);t.offset(r,0);let{xmin:i,xmax:n}=t;i=Number(i.toFixed(9)),n=Number(n.toFixed(9)),t.intersects(M)&&n!==x?(P=n>P?n:P,s=g(s,S),T.push(s),C.push("cut")):t.intersects(I)&&i!==w?(P=n*(2*x)>P?n*(2*x):P,s=g(s,S,360),T.push(s),C.push("cut")):C.push(s)}else C.push(e.clone());else C.push(e);else C.push(e);let F=o.offsetMagnitude(P,x),k=-90;const A=F,O=new n;for(;F>0;){const e=360*F-180;O.addPath([[e,k],[e,-1*k]]),k*=-1,F--}if(T.length>0&&A>0){const e=function(e,t){let r=-1;for(let s=0;s<t.cutIndexes.length;s++){const i=t.cutIndexes[s],n=t.geometries[s],a=o.getGeometryParts(n);for(let e=0;e<a.length;e++){const t=a[e];t.some(r=>{if(r[0]<180)return!0;{let r=0;for(let e=0;e<t.length;e++){const s=t[e][0];r=s>r?s:r}r=Number(r.toFixed(9));const s=-360*o.offsetMagnitude(r,180);for(let r=0;r<t.length;r++){const t=n.getPoint(e,r);n.setPoint(e,r,t.clone().offset(s,0))}return!0}})}if(i===r){if(d(e))for(const t of o.getGeometryParts(n))e[i]=e[i].addRing(t);else if(p(e))for(const t of o.getGeometryParts(n))e[i]=e[i].addPath(t)}else r=i,e[i]=n}return e}(T,await c.cut(m,T,O,f)),t=[],s=[];for(let i=0;i<C.length;i++){const n=C[i];if("cut"!==n)s.push(n);else{const n=e.shift(),o=r[i];null!=o&&"polygon"===o.type&&o.rings&&o.rings.length>1&&n.rings.length>=o.rings.length?(t.push(n),s.push("simplify")):s.push(S?l.geographicToWebMercator(n):n)}}if(!t.length)return s;const i=await u.simplify(m,t,f),n=[];for(let e=0;e<s.length;e++){const t=s[e];"simplify"!==t?n.push(t):n.push(S?l.geographicToWebMercator(i.shift()):i.shift())}return n}const E=[];for(let e=0;e<C.length;e++){const t=C[e];if("cut"!==t)E.push(t);else{const e=T.shift();E.push(!0===S?l.geographicToWebMercator(e):e)}}return E},e.normalizeMapX=function(e,t){const r=a.getInfo(t);if(r){const[t,s]=r.valid,i=s-t;if(e<t)for(;e<t;)e+=i;if(e>s)for(;e>s;)e-=i}return e},e.straightLineDensify=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsCommon":function(){define(["exports","../Polyline","../SpatialReference","./jsonUtils"],function(e,t,r,s){"use strict";const i={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:new t({paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator}),minus180Line:new t({paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:r.WebMercator})},4326:{maxX:180,minX:-180,plus180Line:new t({paths:[[[180,-180],[180,180]]],spatialReference:r.WGS84}),minus180Line:new t({paths:[[[-180,-180],[-180,180]]],spatialReference:r.WGS84})}};function n(e){return s.isPolygon(e)?e.rings:e.paths}e.cutParams=i,e.getGeometryParts=n,e.offsetMagnitude=function(e,t){return Math.ceil((e-t)/(2*t))},e.updatePolyGeometry=function(e,t){const r=n(e);for(const e of r)for(const r of e)r[0]+=t;return e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/cut":function(){define(["exports","../../request","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","../utils"],function(e,t,r,s,i){"use strict";e.cut=async function(e,n,o,a){const l=i.parseUrl(e),c=n[0].spatialReference,u={...a,responseType:"json",query:{...l.query,f:"json",sr:s.srToRESTValue(c),target:JSON.stringify({geometryType:r.getJsonType(n[0]),geometries:n}),cutter:JSON.stringify(o)}},h=await t(l.path+"/cut",u),{cutIndexes:d,geometries:p=[]}=h.data;return{cutIndexes:d,geometries:p.map(e=>{const t=r.fromJSON(e);return t.spatialReference=c,t})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/utils":function(){define(["require","exports","../config","../kernel","../core/lang","../core/urlUtils","../support/apiKeyUtils"],function(e,t,r,s,i,n,o){"use strict";const a=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"}));function l(e,t){return e?t&&o.supportsApiKey(e)?t:o.getApiKey(e)??s.id?.findCredential(e)?.token:null}t.asValidOptions=function(e,t){return t?{...t,query:{...e??{},...t.query}}:{query:e}},t.encode=function e(t,r,s){const i={};for(const n in t){if("declaredClass"===n)continue;const o=t[n];if(null!=o&&"function"!=typeof o)if(Array.isArray(o))i[n]=o.map(t=>e(t));else if("object"==typeof o)if(o.toJSON){const e=o.toJSON(s?.[n]);i[n]=r?e:JSON.stringify(e)}else i[n]=r?o:JSON.stringify(o);else i[n]=o}return i},t.findToken=l,t.getToken=async function(t,i,n){const o=l(t,i);if(o)return o;!s.id&&r.request.useIdentity&&await new Promise((t,r)=>e(["../identity/IdentityManager"],e=>t(a(e)),r));const c=await s.id.getCredential(t,n);return c?.token},t.parseUrl=function(e){return"string"==typeof e?n.urlToObject(e):i.clone(e)},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/simplify":function(){define(["exports","../../request","../../core/urlUtils","../../geometry/support/jsonUtils","../../geometry/support/spatialReferenceUtils","./utils"],function(e,t,r,s,i,n){"use strict";e.simplify=async function(e,o,a){const l="string"==typeof e?r.urlToObject(e):e,c=o[0].spatialReference,u=s.getJsonType(o[0]),h={...a,query:{...l.query,f:"json",sr:i.srToRESTValue(c),geometries:JSON.stringify(n.encodeGeometries(o))}},{data:d}=await t(l.path+"/simplify",h);return n.decodeGeometries(d.geometries,u,c)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],function(e,t){"use strict";e.decodeGeometries=function(e,r,s){const i=t.getGeometryType(r);return e.map(e=>{const t=i.fromJSON(e);return t.spatialReference=s,t})},e.encodeGeometries=function(e){return{geometryType:t.getJsonType(e[0]),geometries:e.map(e=>e.toJSON())}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(e){"use strict";e.makeEdgeCandidate=function(e,t,r,s,i,n=!1){return{objectId:e,target:t,distance:r,type:"edge",start:s,end:i,draped:n}},e.makeVertexCandidate=function(e,t,r){return{objectId:e,target:t,distance:r,type:"vertex"}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/AutoIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";function h(e,t,s){r.setDeepValue(s,e instanceof Date?e.getTime():e,t)}return e.default=class extends(u.NormalizationBinParametersMixin(c)){constructor(e){super(e),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}},t.__decorate([s.property({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],e.default.prototype,"numBins",void 0),t.__decorate([s.property({json:{name:"parameters.end",write:{writer:h}}})],e.default.prototype,"end",void 0),t.__decorate([s.property({json:{name:"parameters.start",write:{writer:h}}})],e.default.prototype,"start",void 0),t.__decorate([a.enumeration({autoIntervalBin:"auto-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.AutoIntervalBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/rest/support/BinParametersBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./AttributeBinsGrouping"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";const d=new s.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),p=new s.JSONMap({naturalLog:"natural-log",squareRoot:"square-root"});return e.default=class extends(r.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}},t.__decorate([n.property({type:String,json:{name:"onExpression.value",write:!0}})],e.default.prototype,"expression",void 0),t.__decorate([c.enumeration(d,{name:"onExpression.valueType"})],e.default.prototype,"expressionValueType",void 0),t.__decorate([n.property({type:String,json:{name:"onField",write:!0}})],e.default.prototype,"field",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"firstDayOfWeek",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"hideUpperBound",void 0),t.__decorate([n.property({type:h,json:{write:{overridePolicy(){return{enabled:null!=this.splitBy?.value||null!=this.splitBy?.type}}}}})],e.default.prototype,"splitBy",void 0),t.__decorate([n.property({type:h,json:{write:{target:{stackBy:{type:h},jsonStyle:{type:String}},writer:(e,t)=>{e&&(t.stackBy=e.toJSON(),null!=e.responseType&&(t.jsonStyle=e.responseType))},overridePolicy(){return{enabled:null!=this.stackBy?.value||null!=this.stackBy?.type}}},read:{source:["stackBy","jsonStyle"],reader:(e,t)=>h.fromJSON({...t.stackBy,responseType:t.jsonStyle})}}})],e.default.prototype,"stackBy",void 0),t.__decorate([c.enumeration(p)],e.default.prototype,"transformation",void 0),e.default=t.__decorate([u.subclass("esri.rest.support.BinParametersBase")],e.default),e.default})},"esri/rest/support/AttributeBinsGrouping":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a,l,c){"use strict";const u=new r.JSONMap({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let h=class extends(t.ClonableMixin(s.JSONSupport)){constructor(e){super(e),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};e.__decorate([i.property({type:String,json:{name:"outAlias",write:!0}})],h.prototype,"alias",void 0),e.__decorate([i.property({type:String})],h.prototype,"responseType",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],h.prototype,"type",void 0),e.__decorate([i.property({type:String,json:{write:!0}})],h.prototype,"value",void 0),e.__decorate([l.enumeration(u)],h.prototype,"valueType",void 0),h=e.__decorate([c.subclass("esri.rest.support.AttributeBinsGrouping")],h);const d=h;return h.from=n.ensureType(h),d})},"esri/rest/support/NormalizationBinParametersMixin":function(){define(["exports","../../chunks/tslib.es6","../../core/jsonMap","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a,l){"use strict";const c=r.strict()({naturalLog:"natural-log",squareRoot:"square-root",percentOfTotal:"percent-of-total",log:"log",field:"field"}),u="percent-of-total",h="field";e.NormalizationBinParametersMixin=e=>{const r=e;let n=class extends r{constructor(){super(...arguments),this.normalizationField=null,this.normalizationMaxValue=null,this.normalizationMinValue=null,this.normalizationTotal=null}get normalizationType(){let e=this._get("normalizationType");const t=!!this.normalizationField,r=null!=this.normalizationTotal;return t||r?(e=t&&h||r&&u||null,t&&r&&s.getLogger(this).warn("warning: both normalizationField and normalizationTotal are set!")):e!==h&&e!==u||(e=null),e}set normalizationType(e){this._set("normalizationType",e)}};return t.__decorate([i.property({type:String,json:{name:"parameters.normalizationField",write:!0}})],n.prototype,"normalizationField",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.normalizationMaxValue",write:!0}})],n.prototype,"normalizationMaxValue",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.normalizationMinValue",write:!0}})],n.prototype,"normalizationMinValue",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.normalizationTotal",write:!0}})],n.prototype,"normalizationTotal",void 0),t.__decorate([a.enumeration(c,{name:"parameters.normalizationType"})],n.prototype,"normalizationType",null),n=t.__decorate([l.subclass("esri.rest.support.NormalizationBinParametersMixin")],n),n},e.normalizationTypeJsonMap=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/DateBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./DateBinTimeInterval"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";function h(e,t,s){r.setDeepValue(s,"string"==typeof e?e:e?.getTime(),t)}function d(e,t){const r=e.parameters[t];return r?"string"==typeof r?r:new Date(r):null}return e.default=class extends c{constructor(e){super(e),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=!1,this.start=null,this.snapToData=null,this.type="date"}},t.__decorate([s.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.end",read:{reader:(e,t)=>d(t,"end")},write:{writer:h}}})],e.default.prototype,"end",void 0),t.__decorate([s.property({type:u,json:{name:"parameters",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([s.property({type:u,json:{name:"parameters.offset",write:!0}})],e.default.prototype,"offset",void 0),t.__decorate([s.property({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],e.default.prototype,"returnFullIntervalBin",void 0),t.__decorate([s.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.start",read:{reader:(e,t)=>d(t,"start")},write:{writer:h}}})],e.default.prototype,"start",void 0),t.__decorate([s.property({type:String,json:{name:"parameters.snapToData",write:!0}})],e.default.prototype,"snapToData",void 0),t.__decorate([a.enumeration({dateBin:"date"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.DateBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/rest/support/DateBinTimeInterval":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./DateBinUtils"],function(e,t,r,s,i,n,o,a,l,c){"use strict";let u=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.value=null,this.unit=null}};e.__decorate([s.property({type:Number,json:{name:"number",write:!0}})],u.prototype,"value",void 0),e.__decorate([a.enumeration(c.unitsDict)],u.prototype,"unit",void 0),u=e.__decorate([l.subclass("esri.rest.support.DateBinTimeInterval")],u);const h=u;return u.from=i.ensureType(u),h})},"esri/rest/support/DateBinUtils":function(){define(["exports","../../core/jsonMap"],function(e,t){"use strict";const r=t.strict()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"});e.unitsDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/FixedBoundariesBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase"],function(e,t,r,s,i,n,o,a,l,c){"use strict";return e.default=class extends c{constructor(e){super(e),this.boundaries=[],this.type="fixed-boundaries"}},t.__decorate([s.property({json:{name:"parameters.boundaries",write:{writer:function(e,t,s){r.setDeepValue(s,e&&e[0]instanceof Date?e.map(e=>e.getTime()):e,t)}}}})],e.default.prototype,"boundaries",void 0),t.__decorate([a.enumeration({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedBoundariesBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/rest/support/FixedIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";function h(e,t,s){r.setDeepValue(s,e instanceof Date?e.getTime():e,t)}return e.default=class extends(u.NormalizationBinParametersMixin(c)){constructor(e){super(e),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}},t.__decorate([s.property({json:{name:"parameters.end",write:{writer:h}}})],e.default.prototype,"end",void 0),t.__decorate([s.property({type:Number,json:{name:"parameters.interval",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([s.property({json:{name:"parameters.start",write:{writer:h}}})],e.default.prototype,"start",void 0),t.__decorate([a.enumeration({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedIntervalBinParameters")],e.default),e.default.from=i.ensureType(e.default),e.default})},"esri/layers/graphics/data/queryValidationUtils":function(){define(["exports","../../../core/Error","./attributeSupport","./projectionSupport","./spatialQuerySupport","../../../support/loadArcade"],function(e,t,r,s,i,n){"use strict";const o="unsupported-query";async function a(e,{fieldsIndex:n,geometryType:a,spatialReference:u,availableFields:h}){if(null!=e.geometryPrecision||e.multipatchOption&&"xyFootprint"!==e.multipatchOption||e.pixelSize||e.relationParam||e.text)throw new t(o,"Unsupported query options",{query:e});return l(n,h,e),function(e,s,i){const{outStatistics:n,groupByFieldsForStatistics:a,having:l}=i,u=a?.length,h=n?.length;if(l){if(!u||!h)throw new t(o,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:i});r.validateHaving(e,s,l,n,i)}if(h){if(!function(e){return null!=e&&e.every(e=>"exceedslimit"!==e.statisticType)}(n))return;const l=n.map(e=>e.onStatisticField).filter(Boolean);r.validateFields(e,s,l,{expressionName:"onStatisticFields",query:i}),u&&r.validateFields(e,s,a,{expressionName:"groupByFieldsForStatistics",query:i});for(const a of n){const{onStatisticField:n,statisticType:l}=a;if("percentile_disc"!==l&&"percentile_cont"!==l||!("statisticParameters"in a))e.get(n)&&"count"!==l&&"min"!==l&&"max"!==l&&r.validateFields(e,s,[n],{expressionName:`outStatistics with '${l}' statistic type`,allowedFieldTypes:c,query:i});else{const{statisticParameters:e}=a;if(!e)throw new t(o,"statisticParameters should be set for percentile type",{definition:a,query:i})}}}}(n,h,e),Promise.all([i.checkSpatialQuerySupport(e,a,u),s.checkProjectionSupport(u,e.outSR)]).then(()=>e)}function l(e,s,i){const{returnDistinctValues:n,outStatistics:a}=i,l=a?a.map(e=>e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if("orderByFields"in i&&i.orderByFields&&i.orderByFields.length>0){const t=" asc",n=" desc",o=i.orderByFields.map(e=>{const r=e.toLowerCase();return r.includes(t)?r.split(t)[0]:r.includes(n)?r.split(n)[0]:e}).filter(e=>!l.includes(e));r.validateFields(e,s,o,{expressionName:"orderByFields",query:i})}if("outFields"in i)if(i.outFields?.length)r.validateFields(e,s,i.outFields,{expressionName:"outFields",query:i,allowedFieldTypes:"all"});else if(n)throw new t(o,"outFields should be specified for returnDistinctValues",{query:i});r.validateWhere(e,s,i.where,i)}const c=new Set([...r.numericFieldTypes,...r.allDateAndTimeFieldTypes]);async function u(e,s,i,a){let l=[];if(i.valueExpression){const{arcadeUtils:e}=await n.loadArcade();l=e.extractFieldNames(i.valueExpression)}if(i.field&&l.push(i.field),i.field2&&l.push(i.field2),i.field3&&l.push(i.field3),i.normalizationField&&l.push(i.normalizationField),!l.length&&!i.valueExpression)throw new t(o,"field or valueExpression is required",{params:i});r.validateFields(e,s,l,{expressionName:"statistics",query:a})}e.validateAttributeBinsQuery=async function(e,r){const s=e.bin;if(!s.onField&&!s.onExpression?.value||"autoIntervalBin"===s.type&&null==s.parameters.numberOfBins||"dateBin"===s.type&&(null==s.parameters.number||null==s.parameters.unit)||"fixedBoundariesBin"===s.type&&null==s.parameters.boundaries||"fixedIntervalBin"===s.type&&null==s.parameters.interval)throw new t(o,"Unsupported query options",{query:e});return a(e,r)},e.validateQuery=a,e.validateStatisticsQuery=async function(e,r,{fieldsIndex:n,geometryType:a,spatialReference:c,availableFields:h}){if(null!=e.geometryPrecision||e.multipatchOption||e.pixelSize||e.relationParam||e.text||e.outStatistics||e.groupByFieldsForStatistics||e.having||e.orderByFields)throw new t(o,"Unsupported query options",{query:e});return l(n,h,e),Promise.all([u(n,h,r,e),i.checkSpatialQuerySupport(e,a,c),s.checkProjectionSupport(c,e.outSR)]).then(()=>e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define(["require","exports","../../../core/Error","../../../geometry/support/contains","../../../geometry/support/intersects","../../../geometry/support/jsonUtils","../../../geometry/support/spatialReferenceUtils","../contains","../featureConversionUtils","../OptimizedGeometry","./geometryUtils","./projectionSupport"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";const d="unsupported-query",p={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},f={esriGeometryPoint:!0,esriGeometryMultiPatch:!1,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},m={esriGeometryPoint:!0,esriGeometryMultiPatch:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1},g={esriSpatialRelIntersects:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/intersectsOperator"],t,r)),esriSpatialRelContains:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/containsOperator"],t,r)),esriSpatialRelCrosses:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/crossesOperator"],t,r)),esriSpatialRelDisjoint:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/disjointOperator"],t,r)),esriSpatialRelEnvelopeIntersects:null,esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/overlapsOperator"],t,r)),esriSpatialRelTouches:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/touchesOperator"],t,r)),esriSpatialRelWithin:()=>new Promise((t,r)=>e(["../../../geometry/operators/json/withinOperator"],t,r)),esriSpatialRelRelation:null};t.canQueryWithRBush=function(e){if(n.isExtent(e))return!0;if(n.isPolygon(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1},t.checkSpatialQuerySupport=async function(e,t,s){const{spatialRel:i,geometry:a}=e;if(a){if(null==(l=i)||!0!==p[l])throw new r(d,"Unsupported query spatial relationship",{query:e});var l;if(o.isValid(a.spatialReference)&&o.isValid(s)){if(!function(e){return null!=e&&!0===f[n.getJsonType(e)]}(a))throw new r(d,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===m[e]}(t))throw new r(d,"Unsupported layer geometry type",{query:e});if(e.outSR)return h.checkProjectionSupport(e.geometry?.spatialReference,e.outSR)}}},t.getSpatialQueryOperator=async function(e,t,r,o,h){if(n.isPolygon(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=l.convertFromPolygon(new c,t,!1,!1);return t=>a.polygonContainsPoint(e,!1,!1,t)}if("esriGeometryMultipoint"===r){const r=l.convertFromPolygon(new c,t,!1,!1);if("esriSpatialRelContains"===e)return e=>a.polygonContainsMultipoint(r,!1,!1,e,o,h)}}if(n.isExtent(t)){if("esriGeometryPoint"===r&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return e=>s.extentContainsPoint(t,u.getGeometry(r,o,h,e));if("esriGeometryMultipoint"===r&&"esriSpatialRelContains"===e)return e=>s.extentContainsMultipoint(t,u.getGeometry(r,o,h,e));if("esriSpatialRelIntersects"===e){const e=i.getExtentIntersector(r);return s=>e(t,u.getGeometry(r,o,h,s))}}"esriSpatialRelEnvelopeIntersects"===e&&(e="esriSpatialRelIntersects");const d=await function(e){const t=g[e];if(null==t)throw new Error(`Cannot load unsupported spatial operator: ${e}`);return t()}(e);return e=>d.execute(t,u.getGeometry(r,o,h,e))},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(e,t){"use strict";e.extentIntersectsExtent=t.extentIntersectsExtent,e.extentIntersectsMultipoint=t.extentIntersectsMultipoint,e.extentIntersectsPoint=t.extentIntersectsPoint,e.extentIntersectsPolygon=t.extentIntersectsPolygon,e.extentIntersectsPolyline=t.extentIntersectsPolyline,e.getFeatureExtentIntersector=t.getFeatureExtentIntersector,e.isSelfIntersecting=t.isSelfIntersecting,e.segmentIntersects=t.segmentIntersects,e.getExtentIntersector=function(e){return"mesh"===e?t.extentIntersectsExtent:t.getFeatureExtentIntersector(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(e){"use strict";function t(e,t){return e?t?4:3:t?3:2}function r(e,r,i,n,o){if(!e)return!1;const a=t(r,i),{coords:l,lengths:c}=e;let u=!1,h=0;for(const e of c)u=s(u,l,a,h,e,n,o),h+=e*a;return u}function s(e,t,r,s,i,n,o){let a=e,l=s;for(let e=s,c=s+i*r;e<c;e+=r){l=e+r,l===c&&(l=s);const i=t[e],u=t[e+1],h=t[l],d=t[l+1];(u<o&&d>=o||d<o&&u>=o)&&i+(o-u)/(d-u)*(h-i)<n&&(a=!a)}return a}e.polygonContainsCoords=r,e.polygonContainsMultipoint=function(e,s,i,n,o,a){const l=t(o,a),{coords:c,lengths:u}=n;if(!u)return!1;for(let t=0,n=0;t<u.length;t++,n+=l)if(!r(e,s,i,c[n],c[n+1]))return!1;return!0},e.polygonContainsPoint=function(e,t,s,i){return r(e,t,s,i.coords[0],i.coords[1])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports","../../../core/compilerUtils"],function(e,t){"use strict";e.getTimeExtent=async function(e,r){if(!e)return null;const s=r.featureAdapter,{startTimeField:i,endTimeField:n}=e;let o=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(i&&n)await r.forEach(e=>{const r=s.getAttribute(t.toConst(e),i),l=s.getAttribute(t.toConst(e),n);null==r||isNaN(r)||(o=Math.min(o,r)),null==l||isNaN(l)||(a=Math.max(a,l))});else{const e=i||n;await r.forEach(r=>{const i=s.getAttribute(t.toConst(r),e);null==i||isNaN(i)||(o=Math.min(o,i),a=Math.max(a,i))})}return{start:o,end:a}},e.getTimeOperator=function(e,t,r){if(!t||!e)return null;const{startTimeField:s,endTimeField:i}=e;if(!s&&!i)return null;const{start:n,end:o}=t;if(null===n&&null===o)return null;if(void 0===n&&void 0===o)return()=>!1;const a=r.getAttributeAsTimestamp?.bind(r)??r.getAttribute.bind(r);return s&&i?function(e,t,r,s,i){return null!=s&&null!=i?n=>{const o=e(n,t),a=e(n,r);return(null==o||o<=i)&&(null==a||a>=s)}:null!=s?t=>{const i=e(t,r);return null==i||i>=s}:null!=i?r=>{const s=e(r,t);return null==s||s<=i}:void 0}(a,s,i,n,o):function(e,t,r,s){return null!=r&&null!=s&&r===s?s=>e(s,t)===r:null!=r&&null!=s?i=>{const n=e(i,t);return null!=n&&n>=r&&n<=s}:null!=r?s=>{const i=e(s,t);return null!=i&&i>=r}:null!=s?r=>{const i=e(r,t);return null!=i&&i<=s}:void 0}(a,s||i,n,o)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Scheduler":function(){define(["exports","../../core/arrayUtils","../../core/Handles","../../core/has","../../core/Logger","../../core/maybe","../../core/PerformanceSampler","../../core/promiseUtils","../../core/reactiveUtils","../../core/signal","../../core/time","../../layers/support/PromiseQueue","./debugFlags","./Yield"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p){"use strict";const f={RESOURCE_CONTROLLER_IMMEDIATE:"immediate",RESOURCE_CONTROLLER:"schedule",SLIDE:"slide",STREAM_DATA_LOADER:"stream loader",ELEVATION_QUERY:"elevation query",TERRAIN_SURFACE:"terrain",SURFACE_GEOMETRY_UPDATES:"surface geometry updates",LOD_RENDERER:"LoD renderer",GRAPHICS_CORE:"Graphics3D",I3S_CONTROLLER:"I3S",POINT_CLOUD_LAYER:"point cloud",FEATURE_TILE_FETCHER:"feature fetcher",STREAM_CONTROLLER:"stream controller",OVERLAY:"overlay",OVERLAY_RENDERER:"overlay renderer",STAGE:"stage",GRAPHICS_DECONFLICTOR:"graphics deconflictor",FILTER_VISIBILITY:"Graphics3D filter visibility",SCALE_VISIBILITY:"Graphics3D scale visibility",FRUSTUM_VISIBILITY:"Graphics3D frustum visibility",POINT_OF_INTEREST_FREQUENT:"POI frequent",POINT_OF_INTEREST_INFREQUENT:"POI infrequent",LABELER:"labeler",FEATURE_QUERY_ENGINE:"feature query",FEATURE_TILE_TREE:"feature tile tree",FEATURE_TILE_TREE_ACTIVE:"fast feature tile tree",ELEVATION_ALIGNMENT:"elevation alignment",ELEVATION_ALIGNMENT_SCENE:"elevation alignment scene",TEXT_TEXTURE_ATLAS:"text texture atlas",TEXTURE_UNLOAD:"texture unload",LINE_OF_SIGHT_TOOL:"line of sight tool",LINE_OF_SIGHT_TOOL_INTERACTIVE:"interactive line of sight tool",ELEVATION_PROFILE:"elevation profile",SNAPPING:"snapping",SHADOW_ACCUMULATOR:"shadow accumulator",CLOUDS_GENERATOR:"clouds generator",FLOW_GENERATOR:"flow generator",MAPVIEW_FETCH_QUEUE:"mapview fetch queue",MAPVIEW_LAYERVIEW_UPDATE:"mapview layerview update",MAPVIEW_VECTOR_TILE_PARSING_QUEUE:"mapview vector tile parsing queue",NONE:0,TEST_PRIO:1},m=new Map([[f.RESOURCE_CONTROLLER_IMMEDIATE,0],[f.RESOURCE_CONTROLLER,4],[f.SLIDE,0],[f.STREAM_DATA_LOADER,0],[f.ELEVATION_QUERY,0],[f.TERRAIN_SURFACE,1],[f.SURFACE_GEOMETRY_UPDATES,1],[f.LOD_RENDERER,2],[f.GRAPHICS_CORE,2],[f.I3S_CONTROLLER,2],[f.POINT_CLOUD_LAYER,2],[f.FEATURE_TILE_FETCHER,2],[f.STREAM_CONTROLLER,2],[f.CLOUDS_GENERATOR,2],[f.OVERLAY,4],[f.OVERLAY_RENDERER,4],[f.STAGE,4],[f.GRAPHICS_DECONFLICTOR,4],[f.FILTER_VISIBILITY,4],[f.SCALE_VISIBILITY,4],[f.FRUSTUM_VISIBILITY,4],[f.POINT_OF_INTEREST_FREQUENT,6],[f.POINT_OF_INTEREST_INFREQUENT,30],[f.LABELER,8],[f.FEATURE_QUERY_ENGINE,8],[f.FEATURE_TILE_TREE,16],[f.FEATURE_TILE_TREE_ACTIVE,0],[f.ELEVATION_ALIGNMENT,12],[f.ELEVATION_ALIGNMENT_SCENE,14],[f.TEXT_TEXTURE_ATLAS,12],[f.TEXTURE_UNLOAD,12],[f.LINE_OF_SIGHT_TOOL,16],[f.LINE_OF_SIGHT_TOOL_INTERACTIVE,0],[f.SNAPPING,0],[f.SHADOW_ACCUMULATOR,30],[f.FLOW_GENERATOR,12],[f.MAPVIEW_FETCH_QUEUE,0],[f.MAPVIEW_LAYERVIEW_UPDATE,2],[f.MAPVIEW_VECTOR_TILE_PARSING_QUEUE,0]]);function g(e){return m.has(e)?m.get(e):"number"==typeof e?e:1}const y=u.Milliseconds(6.5),_=u.Milliseconds(1),b=u.Milliseconds(30),S=u.Milliseconds(1e3/30),x=u.Milliseconds(100);class w{get updating(){return this._updating.value}_updatingChanged(){this._updating.value=this._tasks.some(e=>e.needsUpdate)}constructor(){this._updating=c.signal(!0),this._microTaskQueued=!1,this._frameNumber=0,this.performanceInfo={total:new o("total"),tasks:new Map},this._frameTaskTimes=new Map,this._budget=new M,this._state=1,this._tasks=new Array,this._runQueue=new Array,this._load=0,this._idleStateCallbacks=new Array,this._idleUpdatesStartFired=!1,this._forceTask=!1,this._debug=!1,this._debugHandle=l.watch(()=>d.SCHEDULER_LOG_SLOW_TASKS,e=>this._debug=e,l.initial);for(const e of Object.keys(f))this.performanceInfo.tasks.set(f[e],new o(String(f[e])))}destroy(){this._tasks.forEach(e=>e.remove()),this._tasks.length=0,this._idleStateCallbacks.length=0,this._runQueue.length=0,n.removeMaybe(this._debugHandle),this._microTaskQueued=!1,this._updatingChanged()}taskRunningChanged(e){this._updatingChanged(),e&&this._budget.remaining>0&&!this._microTaskQueued&&(this._microTaskQueued=!0,queueMicrotask(()=>{this._microTaskQueued&&(this._microTaskQueued=!1,this._budget.remaining>0&&this._schedule()&&this._runFrame())}))}registerTask(e,t){const r=new v(this,e,t);return this._tasks.push(r),this._updatingChanged(),this.performanceInfo.tasks.has(e)||this.performanceInfo.tasks.set(e,new o(e)),r}registerIdleStateCallbacks(e,t){const r={idleBegin:e,idleEnd:t};this._idleStateCallbacks.push(r),2===this.state&&this._idleUpdatesStartFired&&r.idleBegin();const s=this;return{remove:()=>this._removeIdleStateCallbacks(r),set idleBegin(e){s._idleUpdatesStartFired&&(r.idleEnd(),2===s._state&&e()),r.idleBegin=e},set idleEnd(e){r.idleEnd=e}}}get load(){return this._load}set state(e){this._state!==e&&(this._state=e,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forEach(e=>e.idleEnd())))}get state(){return this._state}frame(e){this._startFrameTaskTimes();const t=this._updateBudget(e);if(t){const e=this._budget.now();this._runFrame(),this._recordFrameTaskTimes(this._budget.now()-e)}else this._recordFrameTaskTimes(0);return t}_updateBudget(e){this._test&&(this._test.usedBudget=0),++this._frameNumber;let t=y,r=e.frameDuration,s=_;switch(this.state){case 2:t=u.Milliseconds(0),r=u.Milliseconds(Math.max(x,e.frameDuration)),s=b;break;case 1:r=u.Milliseconds(Math.max(S,e.frameDuration))}return r=u.Milliseconds(r-e.elapsedFrameTime-t),2!==this.state&&r<_&&!this._forceTask?(this._forceTask=!0,!1):(r=u.Milliseconds(Math.max(r,s)),this._budget.reset(r),this._updateLoad(),this._schedule())}_runFrame(){switch(this._forceTask=!1,this._microTaskQueued=!1,this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forEach(e=>e.idleBegin())),this._runIdle();break;case 1:this._runInteracting();break;default:this._runAnimating()}this._test&&(this._test.usedBudget=this._budget.elapsed)}stopFrame(){this._budget.reset(u.Milliseconds(0)),this._budget.madeProgress()}_removeIdleStateCallbacks(e){this._idleUpdatesStartFired&&e.idleEnd(),t.removeUnordered(this._idleStateCallbacks,e)}removeTask(e){t.removeUnordered(this._tasks,e),t.removeUnordered(this._runQueue,e),this._updatingChanged()}_updateTask(e){this._tasks.forEach(t=>{t.name===e&&t.setPriority(e)})}_getState(e){if(this._runQueue.some(t=>t.name===e))return"s";let t="i";return this._tasks.forEach(r=>{r.name===e&&r.needsUpdate&&(r.schedulePriority<=1?t="r":"r"!==t&&(t="w"))}),t}_getRuntime(e){let t=0;return this._tasks.forEach(r=>{r.name===e&&(t+=r.runtime)}),t}_resetRuntimes(){this._tasks.forEach(e=>e.runtime=0)}_getRunning(){const e=new Map;if(this._tasks.forEach(t=>{t.needsUpdate&&e.set(t.name,(e.get(t.name)||0)+1)}),0===e.size)return null;let t="";return e.forEach((e,r)=>{t+=e>1?` ${e}x ${r}`:` ${r}`}),t}_runIdle(){this._run()}_runInteracting(){this._run()}_runAnimating(){this._run()}_updateLoad(){const e=this._tasks.reduce((e,t)=>t.needsUpdate?++e:e,0);this._load=.9*this._load+e*(1-.9)}_schedule(){for(t.filterInPlace(this._runQueue,e=>!!e.needsUpdate||(e.schedulePriority=e.basePriority,!1)),this._tasks.forEach(e=>{0===e.basePriority&&e.needsUpdate&&!this._runQueue.includes(e)&&e.blockFrame!==this._frameNumber&&this._runQueue.unshift(e)});0===this._runQueue.length;){let e=!1,t=0;if(this._tasks.forEach(r=>{r.needsUpdate&&0!==r.schedulePriority&&0!==r.basePriority&&r.blockFrame!==this._frameNumber&&(e=!0,t=Math.max(t,r.basePriority),1===r.schedulePriority?(r.schedulePriority=0,this._runQueue.push(r)):--r.schedulePriority)}),!e)return this._updatingChanged(),!1}return this._updatingChanged(),!0}_run(){do{for(;this._runQueue.length>0;){const e=this._budget.now(),t=this._runQueue.pop();this._budget.resetProgress();try{t.task.runTask(this._budget)===p.Yield&&(t.blockFrame=this._frameNumber)}catch(e){i.getLogger("esri.views.support.Scheduler").error(`Exception in task "${t.name}"`,e),t.blockFrame=this._frameNumber}!this._budget.hasProgressed&&t.blockFrame!==this._frameNumber&&t.needsUpdate&&(t.name,t.blockFrame=this._frameNumber),t.schedulePriority=t.basePriority;const r=this._budget.now()-e;if(t.runtime+=r,this._frameTaskTimes.set(t.priority,this._frameTaskTimes.get(t.priority)+r),this._budget.remaining<=0)return void this._updatingChanged()}}while(this._schedule());this._updatingChanged()}_startFrameTaskTimes(){for(const e of Object.keys(f))this._frameTaskTimes.set(f[e],0)}_recordFrameTaskTimes(e){this._frameTaskTimes.forEach((e,t)=>this.performanceInfo.tasks.get(t).push(e)),this.performanceInfo.total.push(e)}get test(){return this._test}}class v{get task(){return this._task.value}get readyToRun(){return this._queue.readyToRun}get updating(){return this._queue.updating}constructor(e,t,s){this._scheduler=e,this.name=t,this.blockFrame=0,this.runtime=0,this._queue=new h.PromiseQueue,this._handles=new r,this._basePriority=g(t),this.schedulePriority=this._basePriority,this._task=c.signal(null!=s?s:this._queue),this._handles.add(l.when(()=>this.task.readyToRun,t=>e.taskRunningChanged(t)))}remove(){this.processQueue(I),this._scheduler.removeTask(this),this.schedule=P.schedule,this.reschedule=P.reschedule,this.scheduleGenerator=P.scheduleGenerator,this.rescheduleGenerator=P.rescheduleGenerator,this._handles.destroy()}get basePriority(){return this._basePriority}setPriority(e){if(this.name===e)return;this.name=e;const t=g(e);0!==this._basePriority&&0===this.schedulePriority||(this.schedulePriority=t),this._basePriority=t}get priority(){return this.name}set priority(e){this.setPriority(e)}get needsUpdate(){return this.readyToRun||!this.task.destroyed&&this.task.readyToRun}schedule(e,t,r){return this._queue.push(e,t,r)}reschedule(e,t,r){return this._queue.unshift(e,t,r)}scheduleGenerator(e,t,r){return this._queue.pushGenerator(e,t,r)}rescheduleGenerator(e,t,r){return this._queue.unshiftGenerator(e,t,r)}processQueue(e){return this._queue.runTask(e)}}class M{constructor(){this._begin=performance?.now()??0,this._budget=0,this._done=!1,this._progressed=!1,this._enabled=!0}run(e){return!this.done&&(!0===e()&&this.madeProgress(),!0)}get done(){return this._done}get budget(){return this._budget}madeProgress(){return this._progressed=!0,this._done=this.elapsed>=this._budget&&this._enabled,this._done}get enabled(){return this._enabled}set enabled(e){this._enabled=e}reset(e){this._begin=this.now(),this._budget=e,this.resetProgress()}get remaining(){return Math.max(this._budget-this.elapsed,0)}now(){return performance.now()}get elapsed(){return this.now()-this._begin}resetProgress(){this._progressed=!1,this._done=!1}get hasProgressed(){return this._progressed}}const I=new M;I.enabled=!1;const P=new class{remove(){}processQueue(){}schedule(e,t,r){try{if(a.isAborted(t)){const e=a.createAbortError();return r?Promise.resolve(r(e)):Promise.reject(e)}return a.when(e(I))}catch(e){return Promise.reject(e)}}reschedule(e,t,r){return this.schedule(e,t,r)}async scheduleGenerator(e,t,r){if(a.isAborted(t)){const e=a.createAbortError();if(r)return r(e);throw e}const s=e(I);for(;;){const e=s.next(I),i=a.isPromiseLike(e)?await e:e;if(a.isAborted(t)){const e=a.createAbortError();if(r)return r(e);throw e}if(i.done)return i.value}}rescheduleGenerator(e,t,r){return this.rescheduleGenerator(e,t,r)}};e.ImmediateTask=P,e.TaskPriority=f,e.getTaskPriority=g,e.makeBudget=function(e){const t=new M;return t.reset(e),t},e.newScheduler=function(){return new w},e.noBudget=I,e.taskPriorities=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PromiseQueue":function(){define(["exports","../../core/compilerUtils","../../core/Logger","../../core/promiseUtils","../../core/signal","../../views/support/Yield"],function(e,t,r,s,i,n){"use strict";function o(e){s.isPromiseLike(e)?e.then(a):a(e)}function a(e){e.done||r.getLogger("esri.layers.support.PromiseQueue").warn("Generator iterator was aborted, but it is not done.")}class l{constructor(e,t,r=void 0,s=void 0){this.resolve=e,this.reject=t,this.signal=r,this.abortCallback=s}}class c extends l{constructor(e,t,r,s,i){super(e,t,s,i),this.callback=r,this.type=0}}class u extends l{constructor(e,t,r,s,i,n){super(e,t,s,i),this.generatorFunction=r,this.scheduleFunction=n,this.type=1}}class h extends l{constructor(e,t,r,s,i,n){super(e,t,s,i),this.iterator=r,this.scheduleFunction=n,this.type=2}}e.PromiseQueue=class{constructor(){this._tasks=new Array,this._numPendingTasks=i.signal(0),this._readyToRun=i.signal(!1)}get length(){return this._tasks.length}get updating(){return this._numPendingTasks.value>0}get readyToRun(){return this._readyToRun.value}_updateReadyToRun(){this._readyToRun.value=this._tasks.length>0}destroy(){this.cancelAll()}runTask(e){if(0===this.length)return n.Yield;for(;!e.done&&this._process(e);)e.madeProgress()}push(e,t,r){return this._addTask((s,i)=>new c(s,i,e,t,r),Array.prototype.push)}unshift(e,t,r){return this._addTask((s,i)=>new c(s,i,e,t,r),Array.prototype.unshift)}pushGenerator(e,t,r){const s=Array.prototype.push;return this._addTask((i,n)=>new u(i,n,e,t,r,s),s)}unshiftGenerator(e,t,r){const s=Array.prototype.unshift;return this._addTask((i,n)=>new u(i,n,e,t,r,s),s)}_process(e){if(0===this._tasks.length)return!1;const r=this._tasks.shift();this._updateReadyToRun();try{if(s.isAborted(r.signal))this._cancelTask(r,s.createAbortError());else switch(r.type){case 0:this._processSimple(r,e);break;case 1:this._processGenerator(r,e);break;case 2:this._processIterator(r,e);break;default:t.neverReached(r)}}catch(e){r.reject(e)}return!0}cancelAll(){const e=s.createAbortError();for(const t of this._tasks)this._cancelTask(t,e);this._tasks.length=0,this._updateReadyToRun()}_cancelTask(e,t){if(e.abortCallback){const r=e.abortCallback(t);2===e.type&&e.iterator.return&&o(e.iterator.return()),s.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}else 2===e.type&&e.iterator.throw&&o(e.iterator.throw(t)),e.reject(t)}_onIteratorResult(e,t){t.done?e.resolve(t.value):(e.scheduleFunction.call(this._tasks,e),this._updateReadyToRun())}_processSimple(e,t){const r=e.callback(t);s.isPromiseLike(r)?r.then(e.resolve,e.reject):e.resolve(r)}_processGenerator(e,t){const r=e.generatorFunction(t),s=new h(e.resolve,e.reject,r,e.signal,e.abortCallback,e.scheduleFunction);this._processIterator(s,t)}_processIterator(e,t){const r=e.iterator.next(t);s.isPromiseLike(r)?r.then(t=>this._onIteratorResult(e,t),e.reject):this._onIteratorResult(e,r)}_addTask(e,t){return new Promise((r,s)=>{const i=e(r,s);t.call(this._tasks,i),++this._numPendingTasks.value,this._updateReadyToRun()}).finally(()=>--this._numPendingTasks.value)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/Yield":function(){define(["exports"],function(e){"use strict";const t=Symbol("Yield");e.Yield=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/debugFlags":function(){define(["../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o){"use strict";let a=class extends t{constructor(){super(...arguments),this.SCHEDULER_LOG_SLOW_TASKS=!1,this.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES=!1}};return e.__decorate([r.property()],a.prototype,"SCHEDULER_LOG_SLOW_TASKS",void 0),e.__decorate([r.property()],a.prototype,"FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES",void 0),a=e.__decorate([o.subclass("esri.views.support.debugFlags")],a),new a})},"esri/views/2d/layers/features/processor/AProcessorStrategy":function(){define(["exports"],function(e){"use strict";e.AProcessorStrategy=class{constructor(e,t,r){this._source=e,this._attributeStore=t,this._sqlOptions=r,this._sendStates=new Map}destroy(){}get enablePixelBuffering(){return!0}get isAggregate(){return!1}onSubscribe(e){const t=this.createState(e);this._sendStates.set(e.key.id,t),this.updateChunks()}onUnsubscribe(e){this._sendStates.get(e.key.id)?.destroy(),this._sendStates.delete(e.key.id)}get hasSubscribers(){return this._sendStates.size>0}requiresInvalidation(){return!1}invalidate(){const e=Array.from(this._sendStates.values());this._sendStates.clear();for(const t of e)t.destroy(),this.onSubscribe(t.subscription)}invalidateAttributeData(e){}hasArcadeDependency(e){return!1}getFeatureObjectIdsForAggregate(e){throw new Error("InternalError: AggregateId lookup not supported")}getDisplayIds(e){return this.displayMap(e,e=>e,e=>e)}getDisplayAndObjectIds(e){return this.displayMap(e,e=>e,(e,t,r)=>[e,r])}afterUpdateChunks(){}},e.ASendState=class{constructor(e){this.subscription=e,this.handledChunks=new Set}destroy(){}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSourceMessage":function(){define(["exports"],function(e){"use strict";e.FeatureTileAppendMessage=class{constructor(e,t,r,s,i){this.subscription=e,this.reader=t,this.clear=r,this.end=s,this.debugInfo=i,this.type="append"}get id(){return this.subscription.tile.id}createMessage(e,t,r){return{type:"append",clear:this.clear,id:this.id,append:e,end:this.end,debugInfo:this.debugInfo,subscriptionVesrion:this.subscription.version,version:t,attributeEpoch:r}}},e.FeatureTileUpdateMessage=class{constructor(e,t,r,s,i){this.subscription=e,this.reader=t,this.remove=r,this.end=s,this.debugInfo=i,this.type="update"}get id(){return this.subscription.tile.id}createMessage(e,t,r){return{type:"update",id:this.id,modify:e,debugInfo:this.debugInfo,remove:this.remove,version:t,subscriptionVesrion:this.subscription.version,end:this.end,attributeEpoch:r}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedAttributeStorage":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../geometry/support/aaBoundingBox","../../../engine/webgl/DisplayId","./CachedField","./ComputedExpression","./ComputedLegacyLabelExpression","./DictionaryTemplate","./NormalizedField","./StaticBitSet","./whereUtils"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";const d=()=>r.getLogger("esri.views.2d.layers.features.support.ComputedAttributeStorage"),p=4294967295;function f(e,t,r){if(!(e.length>t))for(;e.length<=t;)e.push(r)}e.ComputedAttributeStorage=class{constructor(e){this._numerics=[],this._strings=[],this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[],this._dirtyBitset=this.getBitset(this.createBitset()),this.compilationOptions=e}createBitset(){const e=this._bitsets.length;return this._bitsets.push(u.StaticBitSet.create(this._allocatedSize,i.displayIdTexelMask)),e+1}createDictionaryTemplateField(e,t){return new l.ComputedDictionaryTemplate(e,t)}async createComputedField(e,r=!1){if(e.expression)try{if(!this.compilationOptions)throw new Error("InternalError: Compilation options not defined");return r?await a.ComputedLegacyLabelExpression.create(e.expression,this.compilationOptions):await o.ComputedExpression.create(e.expression,this.compilationOptions)}catch(r){const s=new t("featurelayer","Failed to compile arcade expression",{error:r,expression:e.expression});return d().error(s),null}if(e.normalizationType||e.normalizationField)return new c.NormalizedField(e.field,e);if(e.field)return new n.CachedField(e.field);const s=new t("featurelayer","Unable to create computed field. No expression or field found",{info:e});return d().error(s),null}async createWhereClause(e){return e?h.createWhereClause(e,this.compilationOptions.fields):null}getBitset(e){return this._bitsets[e-1]}getComputedNumeric(e,t){return this.getComputedNumericAtIndex(e&i.displayIdTexelMask,0)}setComputedNumeric(e,t,r){return this.setComputedNumericAtIndex(e&i.displayIdTexelMask,r,0)}getComputedString(e,t){return this.getComputedStringAtIndex(e&i.displayIdTexelMask,0)}setComputedString(e,t,r){return this.setComputedStringAtIndex(e&i.displayIdTexelMask,0,r)}getComputedNumericAtIndex(e,t){const r=e&i.displayIdTexelMask;return this._ensureNumeric(t,r),this._numerics[t][r]}setComputedNumericAtIndex(e,t,r){const s=e&i.displayIdTexelMask;this._ensureNumeric(t,s),this._numerics[t][s]=r}getPackedChunkId(e){const t=e&i.displayIdTexelMask;return this._ensureInstanceId(t),this._instanceIds[t]}setPackedChunkId(e,t){const r=e&i.displayIdTexelMask;this._ensureInstanceId(r),this._instanceIds[r]=t}getComputedStringAtIndex(e,t){const r=e&i.displayIdTexelMask;return this._ensureString(t,r),this._strings[t][r]}setComputedStringAtIndex(e,t,r){const s=e&i.displayIdTexelMask;this._ensureString(t,s),this._strings[t][s]=r}getXMin(e){return this._bounds[4*(e&i.displayIdTexelMask)]}getYMin(e){return this._bounds[4*(e&i.displayIdTexelMask)+1]}getXMax(e){return this._bounds[4*(e&i.displayIdTexelMask)+2]}getYMax(e){return this._bounds[4*(e&i.displayIdTexelMask)+3]}setBounds(e,t,r=!1){const s=e&i.displayIdTexelMask;if(!r&&!this._dirtyBitset.has(e))return this._bounds[4*s]!==p;this._dirtyBitset.unset(e);const n=t.readGeometryWorldSpace();if(f(this._bounds,4*s+4,0),!n||!n.coords.length)return this._bounds[4*s]=p,this._bounds[4*s+1]=p,this._bounds[4*s+2]=p,this._bounds[4*s+3]=p,!1;let o=1/0,a=1/0,l=-1/0,c=-1/0;return n.forEachVertex((e,t)=>{o=Math.min(o,e),a=Math.min(a,t),l=Math.max(l,e),c=Math.max(c,t)}),this._bounds[4*s]=o,this._bounds[4*s+1]=a,this._bounds[4*s+2]=l,this._bounds[4*s+3]=c,!0}getBounds(e,t){const r=this.getXMin(t),i=this.getYMin(t),n=this.getXMax(t),o=this.getYMax(t);return s.fromRectValues(e,r,i,n,o),r!==p}_ensureNumeric(e,t){this._numerics[e]||(this._numerics[e]=[]),f(this._numerics[e],t,0)}_ensureInstanceId(e){f(this._instanceIds,e,0)}_ensureString(e,t){this._strings[e]||(this._strings[e]=[]),f(this._strings[e],t,null)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DisplayId":function(){define(["exports"],function(e){"use strict";const t=8388607,r=8388608,s=e=>(e&r)>>>23;e.aggregateValidFiltersMask=254,e.createDisplayId=function(e,t){return((t?r:0)|e)>>>0},e.displayIdTexelMask=t,e.displayIdTypeAggregate=1,e.displayIdTypeFeature=0,e.displayIdTypeMask=r,e.getDisplayIdFilterMask=e=>1===s(e)?254:255,e.getDisplayIdTexel=e=>e&t,e.getDisplayIdType=s,e.isAggregateId=function(e){return 1===s(e)},e.nonAggregateValidFiltersMask=255,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/CachedField":function(){define(["exports","./AComputedField"],function(e,t){"use strict";class r extends t.AComputedField{constructor(e){super(),this._field=e}resize(e){throw new Error("Method not implemented.")}read(e,t){return e.readAttribute(this._field)}readWithDefault(e,t){return e.readAttribute(this._field)}hasArcadeDependency(e){return!1}}e.CachedField=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedExpression":function(){define(["exports","../../../../../core/string","../../../../../support/ArcadeExpression","../../../arcade/callExpressionWithCursor","./AComputedField"],function(e,t,r,s,i){"use strict";class n extends i.AComputedField{static async create(e,s){const i=await r.createRendererExpression(e,s.spatialReference),o=t.numericHash(e);return new n(i,o)}constructor(e,t){super(),this._compiled=e,this._cacheKey=t}resize(e){}read(e,t){return this.hasArcadeDependency("scale")||"system"!==t.$view.timeZone?s.callExpressionWithCursor(this._compiled,e,t):this._readCached(e,t)}readWithDefault(e,t,r){return this.hasArcadeDependency("scale")||"system"!==t.$view.timeZone?s.callExpressionWithCursorWithDefault(this._compiled,e,t,r):this._readWithDefaultCached(e,t,r)}hasArcadeDependency(e){return this._compiled?.references(e)??!1}_getCacheKey(e){if(!this._compiled?.references("timeProperties"))return this._cacheKey;const{currentStart:t,currentEnd:r}=e.$view.timeProperties;return this._cacheKey+function(e,t){const r=43758.5453*Math.sin(12.9898*e+78.233*t);return r-Math.floor(r)}(t??1,r??1)}_readCached(e,t){if(e.setCache(this._getCacheKey(t)),e.hasCachedValue())return e.getCachedValue();const r=s.callExpressionWithCursor(this._compiled,e,t);return e.setCachedValue(r),r}_readWithDefaultCached(e,t,r){if(e.setCache(this._getCacheKey(t)),e.hasCachedValue())return e.getCachedValue();const i=s.callExpressionWithCursorWithDefault(this._compiled,e,t,r);return e.setCachedValue(i),i}}e.ComputedExpression=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithCursor":function(){define(["exports","../../../core/has","../../../core/Logger"],function(e,t,r){"use strict";function s(e){return null==e||e===1/0||e===-1/0||"number"==typeof e&&isNaN(e)}e.callExpressionWithCursor=function(e,t,s){if(null==e)return null;const i=t.readArcadeFeature();t.contextTimeZone=s.$view?.timeZone;try{return e.evaluate(i,s)}catch(e){return r.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}},e.callExpressionWithCursorWithDefault=function(e,t,r,i){if(null==e)return null!=i?i:null;const n=t.readArcadeFeature();t.contextTimeZone=r.$view?.timeZone;const o=e.evaluate(n,r);return s(o)?null!=i?i:null:o},e.isBadArcadeResult=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/ComputedLegacyLabelExpression":function(){define(["exports","../../../../../layers/support/labelFormatUtils","../../../../../layers/support/labelUtils","../../../arcade/callExpressionWithCursor","./AComputedField"],function(e,t,r,s,i){"use strict";class n extends i.AComputedField{static async create(e,s){const i=r.sqlToTemplateString(e);return new n(e=>i.replaceAll(/{[^}]*}/g,r=>{const s=r.slice(1,-1),i=e.metadata.fieldsIndex.get(s);if(null==i)return r;const n=e.readAttribute(s);return null==n?"":t.formatField(n,i)}))}constructor(e){super(),this._evaluator=e}resize(e){}read(e,t){return this._evaluator(e)}readWithDefault(e,t,r){const i=this._evaluator(e);return s.isBadArcadeResult(i)?r:i}hasArcadeDependency(e){return!1}}e.ComputedLegacyLabelExpression=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define(["exports","../../core/Error","../../core/Logger","../../core/sql","../../intl/date","../../intl/number","./domainUtils","./fieldUtils","./labelUtils","../../support/ArcadeExpression","../../support/arcadeExpressionUtils"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";const h=()=>r.getLogger("esri.layers.support.labelFormatUtils"),d={type:"simple",evaluate:()=>null},p={getAttribute:(e,t)=>e.field(t)};function f(e,t){if(null==e)return"";const r=t.domain;if(r)if("codedValue"===r.type||"coded-value"===r.type){const t=e;for(const e of r.codedValues)if(e.code===t)return e.name}else if("range"===r.type){const{max:s,min:i}=o.getDomainRange(t),n=+e;if(null!=i&&null!=s&&i<=n&&n<=s)return r.name}let s=e;return a.isDateField(t)?s=i.formatDate(s,i.convertDateFormatToIntlOptions("short-date")):a.isNumericField(t)&&(s=n.formatNumber(+s)),s||""}e.createLabelFunction=async function(e,r,i){if(!e||!e.symbol||!r)return d;const n=e.where,o=l.getLabelExpression(e);let m;if("arcade"===o.type){const e=u.getFieldNameFromSimpleExpression(o.expression),s=r.get(e);if(s&&(a.isIntegerField(s)||a.isNumericField(s)||a.isStringField(s)))m={type:"simple",evaluate(e){const t="attributes"in e?e.attributes?.[s.name]:e.field(s.name);return null==t?"":t.toString()}};else{const e=await c.createLabelExpression(o.expression,i);if(null==e)return d;m={type:"arcade",evaluate(s,i){try{const t="attributes"in s?e.repurposeFeature(s,r):s;t.contextTimeZone=i??null;const n=e.evaluate(t,{$view:{timeZone:i}});if(null!=n)return n.toString()}catch(e){h().error(new t("arcade-expression-error","Encountered an error when evaluating label expression for feature",{error:e,feature:s,expression:o}))}return null},needsHydrationToEvaluate:()=>null==l.getSingleFieldArcadeExpression(o.expression)}}}else m={type:"simple",evaluate:e=>o.expression.replaceAll(/{[^}]*}/g,t=>{const s=t.slice(1,-1),i=r.get(s);if(!i)return t;let n=null;return n="attributes"in e?e?.attributes?.[i.name]:e.field(i.name),null==n?"":f(n,i)})};if(n){let e;try{e=await s.parseWhereClause(n,r)}catch(e){return h().error(new t("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:n,error:e})),d}const i=m.evaluate;m.evaluate=(r,s)=>{const o="attributes"in r?void 0:p;try{if(e.testFeature(r,o))return i(r,s)}catch(e){h().error(new t("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:n,feature:r,error:e}))}return null}}return m},e.formatField=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/intl/number":function(){define(["exports","./locale"],function(e,t){"use strict";const r={ar:"ar-u-nu-latn",bs:"sr-Latn-CS",nn:"no-NN"};let s=new WeakMap,i={};function n(e){const n=e||i;if(!s.has(n)){const i=t.getLocaleLanguage(),o=i&&r[i]||t.normalizeLocale();s.set(n,new Intl.NumberFormat(o,e))}return s.get(n)}t.beforeLocaleChange(()=>{s=new WeakMap,i={}});const o=new Map;e.convertNumberFormatToIntlOptions=function(e={}){const t={};return null!=e.digitSeparator&&(t.useGrouping=e.digitSeparator),null!=e.places&&(t.minimumFractionDigits=t.maximumFractionDigits=e.places),t},e.formatNumber=function(e,t){return Object.is(e,-0)&&(e=0),n(t).format(e)},e.getFormatter=n,e.parseNumber=function(e,r=t.getLocale()){if(!e)return null;let s=o.get(r);if(!s){const e=n().formatToParts(12345.6),t=[...n({useGrouping:!1}).format(9876543210)].reverse(),i=new Map(t.map((e,t)=>[e,t])),a=new RegExp(`[${e.find(e=>"group"===e.type)?.value}]`,"g"),l=new RegExp(`[${e.find(e=>"decimal"===e.type)?.value}]`),c=new RegExp(`[${t.join("")}]`,"g"),u=/[\u200E\u200F\u202A\u202B\u202C\u202D\u202E\u2066\u2067\u2068\u2069\u061C]/g,h=/[-\u2212\u2013\u2014\u2015]/g;s=e=>{if(""===(e=e.trim().replaceAll(a,"").replace(l,".").replace(c,e=>String(i.get(e))).replaceAll(u,"").replaceAll(h,"-")))return null;const t=Number(e);return isNaN(t)?null:t},o.set(r,s)}return s(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/labelUtils":function(){define(["exports","../../core/string"],function(e,t){"use strict";const r="__begin__",s="__end__",i=new RegExp(r,"ig"),n=new RegExp(s,"ig"),o=new RegExp("^"+r,"i"),a=new RegExp(s+"$","i");function l(e){return e.replaceAll(new RegExp("\\[","g"),"{").replaceAll(new RegExp("\\]","g"),"}")}function c(e){const t={expression:"",type:"none"};return e.labelExpressionInfo?e.labelExpressionInfo.value?(t.expression=e.labelExpressionInfo.value,t.type="conventional"):e.labelExpressionInfo.expression&&(t.expression=e.labelExpressionInfo.expression,t.type="arcade"):null!=e.labelExpression&&(t.expression=l(e.labelExpression),t.type="conventional"),t}function u(e){let l;return e?(l=t.replace(e,e=>r+'$feature["'+e+'"]'+s),l=o.test(l)?l.replace(o,""):'"'+l,l=a.test(l)?l.replace(a,""):l+'"',l=l.replaceAll(i,'" + ').replaceAll(n,' + "')):l='""',l}const h=/^\s*\{([^}]+)\}\s*$/i;function d(e){const t=e?.match(h);return t?.[1].trim()||null}const p=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*$/i,f=/^\s*(?:(?:\$feature\.(\w+))|(?:\$feature\[(["'])(.+)(\2)\]));?\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(\1|\3)(\5)\s*\));?\s*$/i,m=/^\s*(?:DomainName\(\s*\$feature\s*,\s*(["'])(.+)(\1)\s*\));?\s*$/i;function g(e){if(!e)return null;let t=p.exec(e)||f.exec(e);return t?t[1]||t[3]:(t=m.exec(e),t?t[2]:null)}e.convertTemplatedStringToArcade=u,e.getLabelExpression=c,e.getLabelExpressionArcade=function(e){const t=c(e);if(!t)return null;switch(t.type){case"conventional":return u(t.expression);case"arcade":return t.expression}return null},e.getLabelExpressionSingleField=function(e){const t=c(e);if(!t)return null;switch(t.type){case"conventional":return d(t.expression);case"arcade":return g(t.expression)}return null},e.getSingleFieldArcadeExpression=g,e.getSingleFieldTemplatedString=d,e.sqlToTemplateString=l,e.templateStringToSql=function(e){return e.replaceAll(new RegExp("\\{","g"),"[").replaceAll(new RegExp("\\}","g"),"]")},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DictionaryTemplate":function(){define(["exports","../../../../../symbols/cim/utils","./AComputedField"],function(e,t,r){"use strict";class s extends r.AComputedField{constructor(e,r){super(),this._template=e,this._parts=t.analyzeTextParts(e.template,r)}resize(e){}read(e,r){return t.getTextValuesFromFeatureHandle(e,this._parts,this._template.textCase)}readWithDefault(e,r,s){return t.getTextValuesFromFeatureHandle(e,this._parts,this._template.textCase)}hasArcadeDependency(e){return!1}}e.ComputedDictionaryTemplate=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/NormalizedField":function(){define(["exports","./AComputedField"],function(e,t){"use strict";class r extends t.AComputedField{constructor(e,t){super(),this._field=e,this._normalizationInfo=t}resize(e){throw new Error("Method not implemented.")}read(e,t){return this._readNormalized(e)}readWithDefault(e,t){return this._readNormalized(e)}hasArcadeDependency(e){return!1}_readNormalized(e){const t=e.readAttribute(this._field);if(null==t)return null;const{normalizationField:r,normalizationTotal:s,normalizationType:i}=this._normalizationInfo,n=e.readAttribute(r);switch(i??"esriNormalizeByField"){case"esriNormalizeByField":return n?n?t/n:void 0:null;case"esriNormalizeByLog":return Math.log(t)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return s?t/s*100:null}}}e.NormalizedField=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/StaticBitSet":function(){define(["exports"],function(e){"use strict";class t{static fromBuffer(e,r){return new t(e,r)}static create(e,r=4294967295){const s=new Uint32Array(Math.ceil(e/32));return new t(s,r)}constructor(e,t){this._mask=0,this._buf=e,this._mask=t}_getIndex(e){return Math.floor(e/32)}has(e){const t=this._mask&e;return!!(this._buf[this._getIndex(t)]&1<<t%32)}hasRange(e,t){let r=e,s=t;for(;r%32&&r!==s;){if(this.has(r))return!0;r++}for(;s%32&&r!==s;){if(this.has(r))return!0;s--}if(r===s)return!1;for(let e=r/32;e!==s/32;e++)if(this._buf[e])return!0;return!1}set(e){const t=this._mask&e,r=this._getIndex(t),s=1<<t%32;this._buf[r]|=s}setRange(e,t){let r=e,s=t;for(;r%32&&r!==s;)this.set(r++);for(;s%32&&r!==s;)this.set(s--);if(r!==s)for(let e=r/32;e!==s/32;e++)this._buf[e]=4294967295}unset(e){const t=this._mask&e,r=this._getIndex(t),s=1<<t%32;this._buf[r]&=4294967295^s}resize(e){const t=this._buf,r=new Uint32Array(Math.ceil(e/32));r.set(t),this._buf=r}or(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=e._buf[t];return this}and(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=e._buf[t];return this}xor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=e._buf[t];return this}ior(e){for(let t=0;t<this._buf.length;t++)this._buf[t]|=~e._buf[t];return this}iand(e){for(let t=0;t<this._buf.length;t++)this._buf[t]&=~e._buf[t];return this}ixor(e){for(let t=0;t<this._buf.length;t++)this._buf[t]^=~e._buf[t];return this}any(){for(let e=0;e<this._buf.length;e++)if(this._buf[e])return!0;return!1}copy(e){for(let t=0;t<this._buf.length;t++)this._buf[t]=e._buf[t];return this}clone(){return new t(this._buf.slice(),this._mask)}clear(){for(let e=0;e<this._buf.length;e++)this._buf[e]=0;return this}forEachSet(e){for(let t=0;t<this._buf.length;t++){let r=this._buf[t],s=32*t;if(r)for(;r;)1&r&&e(s),r>>>=1,s++}}countSet(){let e=0;return this.forEachSet(t=>{e++}),e}}e.StaticBitSet=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/whereUtils":function(){define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/sql"],function(e,t,r,s){"use strict";const i=()=>r.getLogger("esri.views.2d.layers.FeatureLayerView2D"),n={getAttribute:(e,t)=>e.readAttribute(t)};e.createWhereClause=async function(e,r){try{const o=await s.parseWhereClause(e,r);return o.isStandardized||i().error(new t("sql-parse-error","expression is not standardized",{where:e})),(r,s)=>{const a=r.readArcadeFeature();try{return o.testFeatureCompiled(a,n,s.currentUser)}catch(r){return i().warn(new t("sql-runtime-error","Encountered an error when evaluating where clause",{where:e,error:r})),!0}}}catch(r){return i().warn(new t("sql-runtime-error","Encountered an error when evaluating where clause",{where:e,error:r})),e=>!0}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureFilterEvaluator":function(){define(["../../../../../core/Error","../../../../../core/Logger","../../../../../geometry/support/aaBoundingRect","../../../../../geometry/support/boundsUtils","../../../../../layers/graphics/data/queryUtils","../../../../../layers/graphics/data/spatialQuerySupport","../../../../../layers/graphics/data/timeSupport","../../../../../rest/support/Query","../FeatureStoreQueryAdapter","./whereUtils"],function(e,t,r,s,i,n,o,a,l,c){"use strict";class u{constructor(e){this._geometryBounds=r.create(),this._idToVisibility=new Map,this._serviceInfo=e}static async create(e){const t=new u(e);return await t.update(e.filterJSON,e.spatialReference),t}get hash(){return this._hash}check(e,t){return this._applyFilter(e,t)}invalidate(){this._idToVisibility.forEach((e,t)=>{this._idToVisibility.set(t,0)})}setKnownIds(e){for(const t of e)this._idToVisibility.set(t,1)}setTrue(e){const t=[],r=[],s=new Set(e);return this._idToVisibility.forEach((e,i)=>{const n=!!(1&this._idToVisibility.get(i)),o=s.has(i);!n&&o?t.push(i):n&&!o&&r.push(i),this._idToVisibility.set(i,o?3:0)}),{show:t,hide:r}}createQuery(){const{geometry:e,spatialRel:t,where:r,timeExtent:s,objectIds:i}=this;return a.fromJSON({geometry:e,spatialRel:t,where:r,timeExtent:s,objectIds:i})}async update(e,t){this._hash=JSON.stringify(e);const r=await i.normalizeQueryLike(e,null,t);await Promise.all([this._setGeometryFilter(r),this._setIdFilter(r),this._setAttributeFilter(r),this._setTimeFilter(r)])}async _setAttributeFilter(e){if(!e?.where)return this._clause=null,void(this.where=null);this._clause=await c.createWhereClause(e.where,this._serviceInfo.fieldsIndex),this.where=e.where}_setIdFilter(e){this._idsToShow=e?.objectIds&&new Set(e.objectIds),this._idsToHide=e?.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e?.objectIds}async _setGeometryFilter(e){if(!e?.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const t=e.geometry,r=e.spatialRel??"esriSpatialRelIntersects",i=await n.getSpatialQueryOperator(r,t,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);s.getBoundsXY(this._geometryBounds,t),this._spatialQueryOperator=i,this.geometry=t,this.spatialRel=r}_setTimeFilter(r){if(this.timeExtent=this._timeOperator=null,r?.timeExtent){if(!this._serviceInfo.timeInfo){const s=new e("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",r.timeExtent);return void t.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter").error(s)}this.timeExtent=r.timeExtent,this._timeOperator=o.getTimeOperator(this._serviceInfo.timeInfo,r.timeExtent,l.FeatureStoreQueryAdapter.Shared)}}_applyFilter(e,t){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e,t)}_filterByExpression(e,t){return!this.where||this._clause(e,t)}_filterById(e){return(!this._idsToHide?.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow?.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const t=e.readGeometryWorldSpace();return!!t&&this._spatialQueryOperator(t)}_filterByTime(e){return null==this._timeOperator||this._timeOperator(e)}}return u})},"esri/views/2d/layers/features/FeatureStoreQueryAdapter":function(){define(["exports","../../../../layers/graphics/OptimizedFeature","./support/FeatureSetReaderJSON"],function(e,t,r){"use strict";class s{static{this.Shared=new s}getObjectId(e){return e.getObjectId()}getAttributes(e){return e.readAttributes()}getAttribute(e,t){return e.readAttribute(t)}getAttributeAsTimestamp(e,t){return e.readAttributeAsTimestamp(t)}cloneWithGeometry(e,s){const i=e.readAttributes(),n=new t.OptimizedFeature(s,i,null,e.getObjectId(),e.getDisplayId()),o=r.FeatureSetReaderJSON.fromOptimizedFeatures([n],e.metadata);return o.setIndex(0),o}getGeometry(e){return e.readGeometryWorldSpace()}getCentroid(e,t){return e.readCentroidForDisplay()}}e.FeatureStoreQueryAdapter=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderJSON":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/support/FieldsIndex","./FeatureSetReader"],function(e,t,r,s,i){"use strict";class n extends i.FeatureSetReader{static fromFeatures(e,r){const{geometryType:s}=r,i=t.convertFromFeatures([],e,s,!1,!1,r.featureIdInfo);for(let t=0;t<i.length;t++)i[t].displayId=e[t].displayId;return n.fromOptimizedFeatures(i,r)}static fromFeatureSet(e,r){const s=t.convertFromFeatureSet(e,r.featureIdInfo);return n.fromOptimizedFeatureSet(s,r)}static fromOptimizedFeatureSet(e,t){const r=n.fromOptimizedFeatures(e.features,t);return r._exceededTransferLimit=e.exceededTransferLimit,r._transform=e.transform,r._fieldsIndex=new s(e.fields),r}static fromOptimizedFeatures(e,t,r){const s=new n(e,t);return s._fieldsIndex=t.fieldsIndex,s._transform=r,s}static empty(e){return new n([],e)}constructor(e,t){super(t),this._exceededTransferLimit=!1,this._featureIndex=-1,this._fieldsIndex=null,this._geometryType=t.geometryType,this._features=e}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}get usedMemory(){return this._current.usedMemory}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let e="";for(const t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}copy(){const e=new n(this._features,this.metadata);return this.copyInto(e),e}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return r.hasGeometry(this._current)?t.getQuantizedArea(this._current.geometry,2):0}_readX(){return r.hasGeometry(this._current)?this._current.geometry.coords[0]:0}_readY(){return r.hasGeometry(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return r.hasGeometry(this._current)?this._current.geometry??null:null}_readServerCentroid(){return this._current.centroid}_readAttribute(e,t){if(!this._fieldsIndex){const t=this._current.attributes[e];if(void 0!==t)return t;const r=e.toLowerCase();for(const e in this._current.attributes)if(e.toLowerCase()===r)return this._current.attributes[e];return}const r=this._fieldsIndex.get(e);if(!r)return;const s=this._current.attributes[r.name];return null==s?s:t&&this.fields.isDateField(e)?new Date(s):s}_readAttributes(){return this._current.attributes}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._fieldsIndex=this._fieldsIndex}}e.FeatureSetReaderJSON=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReader":function(){define(["exports","../../../../../arcade/ArcadeDate","../../../../../core/has","../../../../../core/sql/DateOnly","../../../../../core/sql/TimeOnly","../../../../../geometry/GeometryCursor","../../../../../geometry/support/aaBoundingBox","../../../../../geometry/support/jsonUtils","../../../../../geometry/support/labelPoint","../../../../../geometry/support/quantizationUtils","../../../../../layers/graphics/centroid","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/graphics/OptimizedGeometry","../../../../../time/constants","./FeatureSetCache"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m){"use strict";const g=r("featurelayer-simplify-thresholds")??[.5,.5,.5,.5],y=g[0],_=g[1],b=g[2],S=g[3],x=r("featurelayer-simplify-payload-size-factors")??[1,2,4],w=x[0],v=x[1],M=x[2],I=r("featurelayer-simplify-mobile-factor")??2,P=r("esri-mobile"),T=4294967295;class C{constructor(e){this.metadata=e,this.type="FeatureSetReader",this._overrides=null,this._joined=[],this._objectIdToIndex=null,this._boundsBuffer=[],this._caches=new Map,this.arcadeDeclaredClass="esri.arcade.Feature",this._contextTimeZone=null}destroy(){}[Symbol.dispose](){this.destroy()}getAreaSimplificationThreshold(e,t){let r=1;const s=P?I:1;t>4e6?r=M*s:t>1e6?r=v*s:t>5e5?r=w*s:t>1e5&&(r=s);let i=0;return e>4e3?i=S*r:e>2e3?i=b*r:e>100?i=_:e>15&&(i=y),i}getBounds(e){!function(e,t){if(!(e.length>t))for(;e.length<=t;)e.push(0)}(this._boundsBuffer,4*this.getIndex()+4);const t=this.getBoundsXMin();if(t===T||!isFinite(t))return!1;if(0===this.getBoundsXMin()){const t=this.readGeometryWorldSpace();if(t?.isPoint&&0===t.coords[0]&&0===t.coords[1])return o.fromRectValues(e,0,0,0,0),!0;if(!t)return this.setBoundsXMin(T),!1;let r=1/0,s=1/0,i=-1/0,n=-1/0;return t.forEachVertex((e,t)=>{r=Math.min(r,e),s=Math.min(s,t),i=Math.max(i,e),n=Math.max(n,t)}),this.setBoundsXMin(r),this.setBoundsYMin(s),this.setBoundsXMax(i),this.setBoundsYMax(n),o.fromRectValues(e,r,s,i,n),!0}const r=this.getBoundsXMin(),s=this.getBoundsYMin(),i=this.getBoundsXMax(),n=this.getBoundsYMax();return o.fromRectValues(e,r,s,i,n),!0}getBoundsXMin(){return this._boundsBuffer[4*this.getIndex()]}setBoundsXMin(e){this._boundsBuffer[4*this.getIndex()]=e}getBoundsYMin(){return this._boundsBuffer[4*this.getIndex()+1]}setBoundsYMin(e){this._boundsBuffer[4*this.getIndex()+1]=e}getBoundsXMax(){return this._boundsBuffer[4*this.getIndex()+2]}setBoundsXMax(e){this._boundsBuffer[4*this.getIndex()+2]=e}getBoundsYMax(){return this._boundsBuffer[4*this.getIndex()+3]}setBoundsYMax(e){this._boundsBuffer[4*this.getIndex()+3]=e}readAttributeAsTimestamp(e){const t=this.readAttribute(e);return"string"==typeof t?new Date(t).getTime():"number"==typeof t||null==t?t:null}readAttribute(e,t=!1){const r=this._readAttribute(e,t);if(void 0!==r)return r;for(const r of this._joined){r.setIndex(this.getIndex());const s=r._readAttribute(e,t);if(void 0!==s)return s}}readAttributes(){const e=this._readAttributes();for(const t of this._joined){t.setIndex(this.getIndex());const r=t._readAttributes();for(const t of Object.keys(r))e[t]=r[t]}return e}joinAttributes(e){this._joined.push(e)}registerOverrides(e){this._overrides=e}withoutOverrides(){const e=this.copy();return e._overrides=null,e}readOptimizedFeatureWorldSpace(){const e=this.readGeometryWorldSpace(),t=this.readAttributes(),r=this.readCentroidWorldSpace();return new d.OptimizedFeature(e,t,r,this.getObjectId(),this.getDisplayId())}readLegacyFeatureForDisplay(){const e=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null}}readLegacyFeatureWorldSpace(){const e=this.readCentroidWorldSpace();return{attributes:this.readAttributes(),geometry:this._readLegacyGeometryWorldSpace(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null}}readLegacyGeometryForDisplay(){const e=this.readGeometryForDisplay();return h.convertToGeometry(e,this.geometryType,!1,!1)}readXForDisplay(){return this._readX()}readYForDisplay(){return this._readY()}readXWorldSpace(){const e=this._readX(),t=this.getInTransform();return null==t?e:e*t.scale[0]+t.translate[0]}readYWorldSpace(){const e=this._readY(),t=this.getInTransform();return null==t?e:t.translate[1]-e*t.scale[1]}readGeometryForDisplay(){const e=this._readGeometryDeltaDecoded(!0);if(!e){const e=this._createDeltaQuantizedGeometryFromServerCentroid();return e?e.deltaDecode():null}return e}readGeometryForDisplayTransformed(e){let t=this.readGeometryForDisplay();if(t&&"esriGeometryPolyline"===this.metadata.geometryType&&(t=h.generalizeOptimizedGeometry(new p,t,this.hasZ,this.hasM,this.metadata.geometryType,e.scale[0])),t&&(t=h.quantizeForDisplay(t,e,this.metadata.geometryType,this.hasZ,this.hasM)),!t){const t=this.readCentroidForDisplay();if(!t)return null;const r=c.quantizeX(e,t.coords[0]),s=c.quantizeY(e,t.coords[1]);return this._createDeltaQuantizedExtrudedGeometry(r,s).deltaDecode()}return t}readGeometryWorldSpace(){let e=this._readGeometry();if(e||(e=this._createDeltaQuantizedGeometryFromServerCentroid()),!e)return null;const t=e.clone(),r=this.getInTransform();return null!=r&&h.unquantizeOptimizedGeometry(t,t,this.hasZ,this.hasM,r),t}readCentroidForDisplay(){const e=this.readGeometryForDisplay();return e?this._computeDisplayCentroid(e):this._readServerCentroid()}readCentroidWorldSpace(){const e=this.readGeometryForDisplay(),t=e?this._computeDisplayCentroid(e):this._readServerCentroid();if(!t)return null;const r=t.clone(),s=this.getInTransform();return null!=s&&h.unquantizeOptimizedGeometry(r,r,this.hasZ,this.hasM,s),r}setCache(e){let t=this._caches.get(e);null==t&&(t=new m.FeatureSetCache(this.getSize()),this._caches.set(e,t)),this._activeCache=t}setCachedValue(e){this._activeCache.set(this.getIndex(),e)}hasCachedValue(){return this._activeCache.has(this.getIndex())}getCachedValue(){return this._activeCache.get(this.getIndex())}_readGeometryDeltaDecoded(e){const t=this._readGeometry(e);return"esriGeometryPoint"!==this.geometryType&&t&&this.getInTransform()?t.deltaDecode():t}get contextTimeZone(){return this._contextTimeZone}set contextTimeZone(e){this._contextTimeZone=e}readArcadeFeature(){return this}hasField(e){return this.fields.has(e)||this._joined.some(t=>t.hasField(e))}geometry(){const e=this.readGeometryWorldSpace(),t=h.convertToGeometry(e,this.geometryType,this.hasZ,this.hasM),r=a.fromJSON(t);if(r){if(!this.metadata.outSpatialReference)throw new Error("InternalError: Expected spatial reference to be defined");r.spatialReference=this.metadata.outSpatialReference}return r}autocastArcadeDate(e,r){return r&&r instanceof Date?this.isUnknownDateTimeField(e)?t.ArcadeDate.unknownDateJSToArcadeDate(r):t.ArcadeDate.dateJSAndZoneToArcadeDate(r,this.contextTimeZone??f.system):r}isUnknownDateTimeField(e){return this.metadata.fieldsIndex.getTimeZone(e)===f.unknown}field(e){let r=this.fields.get(e);if(r)switch(r.type){case"date-only":case"esriFieldTypeDateOnly":return s.DateOnly.fromReader(this.readAttribute(e,!1));case"time-only":case"esriFieldTypeTimeOnly":return i.TimeOnly.fromReader(this.readAttribute(e,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return t.ArcadeDate.fromReaderAsTimeStampOffset(this.readAttribute(e,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(e,this.readAttribute(e,!0));default:return this.readAttribute(e,!1)}for(const n of this._joined)if(n.setIndex(this.getIndex()),r=n.fields.get(e),r)switch(r.type){case"date-only":case"esriFieldTypeDateOnly":return s.DateOnly.fromReader(n._readAttribute(e,!1));case"time-only":case"esriFieldTypeTimeOnly":return i.TimeOnly.fromReader(n._readAttribute(e,!1));case"esriFieldTypeTimestampOffset":case"timestamp-offset":return t.ArcadeDate.fromReaderAsTimeStampOffset(n._readAttribute(e,!1));case"date":case"esriFieldTypeDate":return this.autocastArcadeDate(e,n._readAttribute(e,!0));default:return this.readAttribute(e,!1)}throw new Error(`Field ${e} does not exist`)}setField(e,t){throw new Error("Unable to update feature attribute values, feature is readonly")}keys(){return this.fields.fields.map(e=>e.name)}castToText(e=!1){if(!e)return JSON.stringify(this.readLegacyFeatureForDisplay());const t=this.readLegacyFeatureForDisplay();if(!t)return JSON.stringify(null);const r={geometry:t.geometry,attributes:{...t.attributes??{}}};for(const e in r.attributes){const t=r.attributes[e];t instanceof Date&&(r.attributes[e]=t.getTime())}return JSON.stringify(r)}gdbVersion(){return null}fullSchema(){return this.metadata.arcadeSchema}castAsJson(e=null){return{attributes:this._readAttributes(),geometry:!0===e?.keepGeometryType?this.geometry():this.geometry()?.toJSON()??null}}castAsJsonAsync(e=null,t=null){return Promise.resolve(this.castAsJson(t))}_getExists(){if(this._overrides){const e=this.getObjectId();return!this._overrides.hasOverride(e)}return!0}_computeDisplayCentroid(e){if(null==this.getInTransform())return u.getCentroidOptimizedGeometry(new p,e,this.hasM,this.hasZ);const t=n.GeometryCursor.fromOptimized(e,this.geometryType);t.yFactor*=-1;const r=l.getLabelPoint(t);return r?(r[1]*=-1,new p([],r)):null}copyInto(e){e._joined=this._joined,e._overrides=this._overrides,e._objectIdToIndex=this._objectIdToIndex,e._boundsBuffer=this._boundsBuffer,e._activeCache=this._activeCache,e._caches=this._caches,e._contextTimeZone=this._contextTimeZone}_readLegacyGeometryWorldSpace(){const e=this.readGeometryWorldSpace();return h.convertToGeometry(e,this.geometryType,!1,!1)}_createDeltaQuantizedGeometryFromServerCentroid(){const e=this._readServerCentroid();if(!e)return null;const[t,r]=e.coords;return this._createDeltaQuantizedExtrudedGeometry(t,r)}_createDeltaQuantizedExtrudedGeometry(e,t){return"esriGeometryPolyline"===this.geometryType?this._createDeltaQuantizedExtrudedLine(e,t):this._createDeltaQuantizedExtrudedQuad(e,t)}_createDeltaQuantizedExtrudedQuad(e,t){return new p([5],[e-1,t,1,-1,1,1,-1,1,-1,-1])}_createDeltaQuantizedExtrudedLine(e,t){return new p([2],[e-1,t+1,1,-1])}}e.FeatureSetReader=C,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetCache":function(){define(["exports","./StaticBitSet"],function(e,t){"use strict";e.FeatureSetCache=class{constructor(e){this._valid=t.StaticBitSet.create(e),this._data=new Array(e)}has(e){return this._valid.has(e)}set(e,t){this._valid.set(e),this._data[e]=t}get(e){return this._data[e]}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureMetadata":function(){define(["exports","../../../../../geometry/SpatialReference","../../../../../layers/support/FieldsIndex"],function(e,t,r){"use strict";class s{static minimal(e,t,i=[]){return new s({geometryType:e,fieldsIndex:new r(i).toJSON(),featureIdInfo:{type:"object-id",fieldName:t},subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,outSpatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null})}static createFeature(e){return new s(e)}constructor(e){let s;this._options=e,this._fieldsIndex=r.fromJSON(e.fieldsIndex),e.spatialReference&&(this._spatialReference=t.fromJSON(e.spatialReference)),e.outSpatialReference&&(this._outSpatialReference=t.fromJSON(e.outSpatialReference)),"object-id"===e.featureIdInfo.type&&(s=e.featureIdInfo.fieldName),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:s,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0,datesInUnknownTimezone:this._options.timeReferenceUnknownClient??void 0,dateFieldsTimeZone:this._options.dateFieldsTimeZone??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get featureIdInfo(){return this._options.featureIdInfo}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get outSpatialReference(){return this._outSpatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}weakCloneWithAdditionalFields(e){return new s({fieldsIndex:{fields:[...this._fieldsIndex.fields,...e],timeZoneByFieldName:null},geometryType:this.geometryType,globalIdField:this.globalIdField,featureIdInfo:this.featureIdInfo,spatialReference:this.spatialReference,outSpatialReference:this.outSpatialReference,subtypeField:this.subtypeField,subtypes:this._options.subtypes,timeInfo:this.timeInfo,timeReferenceUnknownClient:this.timeReferenceUnknownClient,dateFieldsTimeZone:this._options.dateFieldsTimeZone,typeIdField:this._options.typeIdField,types:this._options.types})}}class i extends s{static createGraphics(e){return new i({fieldsIndex:(new r).toJSON(),featureIdInfo:{type:"object-id",fieldName:"uid"},geometryType:null,spatialReference:e,outSpatialReference:e,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null})}}e.FeatureMetadata=s,e.GraphicsMetadata=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/ClusterStrategy":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/graphics/OptimizedGeometry","../../../../../layers/support/FieldsIndex","../../../engine/webgl/definitions","../aggregation/ComputedAggregateField","../aggregation/GridCell","../aggregation/GridSpatialIndex","./AAggregateStrategy","./AProcessorStrategy","./support/WithDisplayId","../sources/FeatureSourceMessage","../support/ComputedAttributeStorage","../support/FeatureFilterEvaluator","../support/FeatureMetadata","../support/FeatureSetReaderJSON","../../../tiling/TileKey"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y){"use strict";class _ extends u.ASendState{constructor(e){super(e),this.didSend=!1,this.done=!1}}class b{constructor(e,t,r,s,i){this._level=e,this._scale=t,this._indexOptions=r,this._clusterRadius=s,this._store=i,this._cells=new Map,this._handledChunks=new Set,this._statistics=new Map,this._clusters=new Map}destroy(){this._clearClusters()}_clearClusters(){for(const e of this._clusters.values())this._store.releaseDisplayIdForObjectId(e.inner.id);this._clusters.clear()}*aggregatesWorldSpace(){for(const e of this._clusters.values()){const t=e.inner.getCentroid(null),s=new r.OptimizedFeature(t,e.inner.getAttributes(),null,e.inner.id,e.displayId);yield s}}clusters(){return this._clusters.values()}updateChunks(e,t){let r=!1;for(const t of e){const e=t.queryInfo;"tileId"in e&&new y(e.tileId).level!==this._level||this._handledChunks.has(t.normalizedChunkId)||(this._handledChunks.add(t.normalizedChunkId),r=!0,t.getAggregateIndex({...this._indexOptions,scale:this._scale}).put(this._cells))}const s={xMin:1/0,yMin:1/0,xMax:-1/0,yMax:-1/0},i=l.pixelsPerMapUnit(this._indexOptions.spatialReference,this._scale),n=this._indexOptions.cellSize;for(const{subscription:e}of t){const t=e.tile.bounds,r=Math.floor(t[0]*i/n),o=Math.floor(t[1]*i/n),a=Math.ceil(t[2]*i/n),l=Math.ceil(t[3]*i/n);s.xMin=Math.min(s.xMin,r),s.yMin=Math.min(s.yMin,o),s.xMax=Math.max(s.xMax,a),s.yMax=Math.max(s.yMax,l)}return null!=this._lastCellBounds&&s.xMin===this._lastCellBounds.xMin&&s.yMin===this._lastCellBounds.yMin&&s.yMin===this._lastCellBounds.yMin&&s.yMax===this._lastCellBounds.yMax||(r=!0,this._lastCellBounds=s),r&&this._clusterCells(s),r}async updateStatistics(e){let t=!1;for(const e of this._clusters.values())e.inner.count>1&&(t=this._updateAggregateStatistics(this._statistics,e.inner)||t);if(t){const t=Array.from(this._statistics.entries()).map(([e,t])=>({fieldName:e,minValue:t.minValue,maxValue:t.maxValue}));await e.container.updateStatistics(this._level,t)}}createAggregateFeatures(e,t){const i=e.subscription,o=[],a=i.tile.transform;for(const e of this._clusters.values()){let t=e.inner.getCentroidX(a);const l=e.inner.getCentroidY(a),c=i.tile.lod,u=c.wrap?c.worldSize[0]:null,h=1===e.inner.count?e.inner.firstObjectId:e.inner.id,d=e.displayId;if(null!=u)if(1===u){const i=new s([],[t,l]),a=new r.OptimizedFeature(i,e.inner.getAttributes(),null,h,d);a.geometry.coords[0]-=n.tileSize,o.push(a);const c=new s([],[t,l]),u=new r.OptimizedFeature(c,e.inner.getAttributes(),null,h,d);u.geometry.coords[0]+=n.tileSize,o.push(u)}else t>n.tileSize+n.tileSize/2?t-=u*n.tileSize:t<-256&&(t+=u*n.tileSize);if(t<n.tileSize+128&&t>=-128&&l<n.tileSize+128&&l>=-128){const i=new s([],[t,l]),n=new r.OptimizedFeature(i,e.inner.getAttributes(),null,h,d);o.push(n)}}return g.FeatureSetReaderJSON.fromOptimizedFeatures(o,t,i.tile.transform)}_clusterCells(e){let t=Array.from(this._cells.values());t=t.sort((e,t)=>t.count-e.count);const r=[];for(const e of this._clusters.values())r.push(e.inner.id);this._clusters.clear();const s=this._clusterRadius*(1/l.pixelsPerMapUnit(this._indexOptions.spatialReference,this._scale)),i=1+this._clusterRadius/this._indexOptions.cellSize,n=new Set;for(const r of t){if(n.has(r.id))continue;if(r.gridX<e.xMin||r.gridX>e.xMax||r.gridY<e.yMin||r.gridY>e.yMax)continue;const t=this._store.createDisplayIdForObjectId(r.id),o=new h.WithDisplayId(r.clone(),t);n.add(r.id),this._clusters.set(r.id,o);const l=r.centroidXWorld,c=r.centroidYWorld;for(let e=r.gridY-i;e<=r.gridY+i;e++)for(let t=r.gridX-i;t<=r.gridX+i;t++){if(e===r.gridY&&t===r.gridX)continue;const i=this._cells.get(a.GridCell.createId(t,e));if(!i||n.has(i.id))continue;const u=Math.abs(i.centroidXWorld-l),h=Math.abs(i.centroidYWorld-c);u<s&&h<s&&(o.inner.merge(i),n.add(i.id))}}for(const e of r)this._store.releaseDisplayIdForObjectId(e)}_updateAggregateStatistics(e,t){let r=!1;for(const s of t.statistics.values()){if("esriFieldTypeString"===s.field.type)continue;const t=s.value,i=s.field,n=e.get(i.name);if(n){const{minValue:e,maxValue:s}=n,i=Math.min(n.minValue,t),o=Math.max(n.maxValue,t);e===i&&s===o||(n.minValue=i,n.maxValue=o,r=!0);continue}e.set(i.name,{minValue:t,maxValue:t}),r=!0}return r}}class S extends c.AAggregateStrategy{static async create(e,t,r,s,i,n,a){const l=new p.ComputedAttributeStorage({spatialReference:r}),c={type:"grid",fields:await Promise.all(t.fields.map(async e=>o.ComputedAggregateField.create(l,e))),spatialReference:r,featureFilter:t.featureFilter?await f.create({geometryType:s.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:s.metadata.timeInfo,fieldsIndex:s.metadata.fieldsIndex,spatialReference:r,filterJSON:t.featureFilter}):null,cellSize:t.clusterRadius/4,arcadeContextInfo:n,sqlOptions:a};return new S(e,t.clusterRadius,c,t.fields,s,i,a)}constructor(e,t,r,s,n,o,a){super(n,o,r.spatialReference,r.fields,a),this._connection=e,this._clusterRadius=t,this._indexOptions=r,this._cellsPerScale=new Map,this._metadata=m.FeatureMetadata.createFeature({geometryType:"esriGeometryPoint",featureIdInfo:{type:"object-id",fieldName:"aggregateId"},fieldsIndex:new i([...s,...this._source.metadata.fieldsIndex.fields,{name:"aggregateId",alias:"aggregateId",type:"esriFieldTypeOID"}]).toJSON(),globalIdField:null,spatialReference:n.metadata.spatialReference,outSpatialReference:n.metadata.outSpatialReference,subtypeField:null,subtypes:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null})}get enablePixelBuffering(){return!1}invalidate(){super.invalidate();for(const e of this._cellsPerScale.values())e.destroy();this._cellsPerScale.clear()}onSubscribe(e){super.onSubscribe(e),this._requiredLevel=e.tile.level,this._requiredScale=e.tile.scale}createState(e){return new _(e)}async*applyOverrideUpdate(e){for(const e of this._cellsPerScale.values())e.destroy();this._cellsPerScale.clear();for(const e of this._sendStates.values())e.done=!1}displayMap(e,t,r){const s=new Map(e.map(e=>[t(e),e])),i=[],n=this._getClusterState(this._requiredLevel,this._requiredScale);for(const e of n.clusters()){const t=s.get(e.inner.id);if(null!=t){const n=r(e.displayId,t,e.inner.id);i.push(n),s.delete(e.inner.id);continue}if(1===e.inner.count){const{firstObjectId:t}=e.inner,n=t?s.get(t):null;if(null!=n){const o=r(e.displayId,n,t);i.push(o),s.delete(t)}}}return i}getDisplayFeatures(e){const r=new Set(e),s=new Set,i=[],n=[],o=this._getClusterState(this._requiredLevel,this._requiredScale);for(const e of o.aggregatesWorldSpace())if(r.has(e.displayId)&&!s.has(e.displayId)){const r=t.convertToFeature(e,this._metadata.geometryType,!1,!1);if(s.add(e.displayId),1===r.attributes.cluster_count){i.push({...r,displayId:e.displayId});continue}n.push({...r,displayId:e.displayId})}return{features:i,aggregates:n,tracks:[]}}getFeatureObjectIdsForAggregate(e){const t=this._getClusterState(this._requiredLevel,this._requiredScale);for(const r of t.clusters())if(r.inner.id===e)return Array.from(r.inner.containedObjectIds);return[]}async*updateChunks(){const e=this._source.chunks();if(!e.length)return;const t=this._getClusterState(this._requiredLevel,this._requiredScale),r=Array.from(this._sendStates.values()).filter(e=>e.subscription.tile.level===this._requiredLevel);if(t.updateChunks(e,r)||!this._source.updateTracking.updating)for(const e of r)e.subscription.tile.level===this._requiredLevel&&(e.didSend=!1,e.done=!1);const s=Array.from(this._sendStates.values()).filter(e=>e.done).map(e=>e.subscription.tile.key),i=new Set(s);for(const e of this._sendStates.values()){if(this._source.updateTracking.updating){if(s.some(t=>t.containsChild(e.subscription.tile.key)))continue;if(e.subscription.tile.key.getChildKeys().every(e=>i.has(e)))continue}e.didSend||e.subscription.tile.level!==this._requiredLevel||(e.didSend=!0,yield*this._update(e,t,this._source))}await t.updateStatistics(this._connection)}forEachAggregateWorldSpace(e){if(null==this._requiredLevel||null==this._requiredScale)return;const t=this._getClusterState(this._requiredLevel,this._requiredScale);for(const r of t.aggregatesWorldSpace())e(r)}_getClusterState(e,t){if(null==e||null==t)throw new Error("InternalError: Level and scale must be defined");let r=this._cellsPerScale.get(t);return r||(r=new b(e,t,this._indexOptions,this._clusterRadius,this._attributeStore),this._cellsPerScale.set(t,r)),r}async*_update(e,t,r){if(e.done)return;const s=t.createAggregateFeatures(e,this._metadata);this.events.emit("changed"),e.done=!r.updateTracking.updating;const i=s.getCursor(),n=e.subscription.tile.createArcadeEvaluationOptions(this._indexOptions.arcadeContextInfo);for(;i.next();)this._attributeStore.setAttributeData(i.getDisplayId(),i,n,this._sqlOptions);const o=new d.FeatureTileAppendMessage(e.subscription,s,!0,e.done,{});yield o}}e.ClusterState=_,e.ClusterStrategy=S,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/GridCell":function(){define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedGeometry","./AAggregateCell","./AccumulatedStatistics"],function(e,t,r,s,i){"use strict";class n extends s.AAggregateCell{static createId(e,t){return`${e}.${t}`}static create(e,t,r,s){return new n(e,t,i.AccumulatedStatistics.create(r),s)}constructor(e,t,r,s){super(r),this.gridX=e,this.gridY=t,this._worldUnitsPerCell=s,this._count=0,this._xWorldTotal=0,this._yWorldTotal=0,this._objectIds=new Set}get id(){return n.createId(this.gridX,this.gridY)}get containedObjectIds(){return this._objectIds}get count(){return this._count}get firstObjectId(){return this._objectIds.values().next().value}get centroidXWorld(){return this._xWorldTotal/this._count}get centroidYWorld(){return this._yWorldTotal/this._count}clone(){const e=new n(this.gridX,this.gridY,this._statistics.clone(),this._worldUnitsPerCell);return e._count=this._count,e._xWorldTotal=this._xWorldTotal,e._yWorldTotal=this._yWorldTotal,e._firstFeatureAttributes=this._firstFeatureAttributes,e._objectIds=new Set(this._objectIds),e}insert(e,t,r,s){0===this._count?this._firstFeatureAttributes=e.readAttributes():this._firstFeatureAttributes=null,this._count+=1,this._xWorldTotal+=r,this._yWorldTotal+=s,this._statistics.insert(e,t),this._objectIds.add(e.getObjectId())}merge(e){if(0!==e._count){this._count+=e._count,this._firstFeatureAttributes=e._firstFeatureAttributes,this._xWorldTotal+=e._xWorldTotal,this._yWorldTotal+=e._yWorldTotal,this._statistics.merge(e._statistics);for(const t of e._objectIds.values())this._objectIds.add(t)}}getCentroidX(e){return null==e?this.centroidXWorld:t.quantizeX(e,this.centroidXWorld)}getCentroidY(e){return null==e?this.centroidYWorld:t.quantizeY(e,this.centroidYWorld)}getGeometry(e,s){const i=this.gridX*this._worldUnitsPerCell,n=this.gridY*this._worldUnitsPerCell,o=new r([4],[i,n,i+this._worldUnitsPerCell,n,i+this._worldUnitsPerCell,n+this._worldUnitsPerCell,i,n+this._worldUnitsPerCell]);if(null!=s){const e=new r;return t.quantizeOptimizedGeometry(e,o,!1,!1,"esriGeometryPolygon",s)}return o}getCentroid(e){const s=new r([],[this.centroidXWorld,this.centroidYWorld]);if(null!=e){const i=new r;return t.quantizeOptimizedGeometry(i,s,!1,!1,"esriGeometryPoint",e)}return s}getGeometricCentroid(e,s){const i=this.gridX*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,n=this.gridY*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,o=new r([],[i,n]);if(null!=s){const e=new r;return t.quantizeOptimizedGeometry(e,o,!1,!1,"esriGeometryPoint",s)}return o}getAttributes(){const e={aggregateId:this.id};for(const t of this._statistics.values())e[t.field.name]=t.value;return null!=this._firstFeatureAttributes?{...e,...this._firstFeatureAttributes}:e}}e.GridCell=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/AAggregateCell":function(){define(["exports"],function(e){"use strict";e.AAggregateCell=class{constructor(e){this._statistics=e}get statistics(){return this._statistics}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/AccumulatedStatistics":function(){define(["exports","../../../arcade/callExpressionWithCursor"],function(e,t){"use strict";const r=Math.PI/180;class s{static create(e){return new s(e.map(e=>function(e){switch(e.statisticType){case"min":return new n(e);case"max":return new o(e);case"avg":return new l(e);case"avg_angle":return new c(e);case"sum":case"count":return new a(e);case"mode":return new u(e)}}(e)))}constructor(e){this._statistics=e}values(){return this._statistics.values()}insert(e,t){for(const r of this._statistics)r.insert(e,t)}merge(e){for(let t=0;t<this._statistics.length;t++){const r=this._statistics[t],s=e._statistics[t];if(r.field.name!==s.field.name)throw new Error("InternalError: Tried to merge incompatible statistics");r.merge(s)}}clone(){return new s(this._statistics.map(e=>e.clone()))}}class i{constructor(e){this.field=e}insert(e,r){if(!this.field.computed)return;const s=this.field.computed.read(e,r);t.isBadArcadeResult(s)||this._insertValue(s)}}class n extends i{constructor(){super(...arguments),this.type="min",this.value=Number.MAX_VALUE}_insertValue(e){this.value=Math.min(this.value,e)}merge(e){this.value=Math.min(this.value,e.value)}clone(){const e=new n(this.field);return e.value=this.value,e}}class o extends i{constructor(){super(...arguments),this.type="max",this.value=Number.MIN_VALUE}_insertValue(e){this.value=Math.max(this.value,e)}merge(e){this.value=Math.max(this.value,e.value)}clone(){const e=new o(this.field);return e.value=this.value,e}}class a extends i{constructor(){super(...arguments),this.type="sum",this.value=0}_insertValue(e){this.value+=e}merge(e){this.value+=e.value}clone(){const e=new a(this.field);return e.value=this.value,e}}class l extends i{constructor(){super(...arguments),this.type="avg",this._total=0,this._count=0}get value(){return this._total/this._count}_insertValue(e){this._total+=e,this._count+=1}merge(e){this._total+=e._total,this._count+=e._count}clone(){const e=new l(this.field);return e._total=this._total,e._count=this._count,e}}class c extends i{constructor(){super(...arguments),this.type="avg_angle",this._x=0,this._y=0,this._count=0}get value(){const e=this._x/this._count,t=this._y/this._count,r=180/Math.PI;return Math.atan2(t,e)*r}_insertValue(e){this._x=this._x+Math.cos(e*r),this._y=this._y+Math.sin(e*r),this._count+=1}merge(e){this._x+=e._x,this._y+=e._y,this._count+=e._count}clone(){const e=new c(this.field);return e._x=this._x,e._y=this._y,e._count=this._count,e}}class u extends i{constructor(){super(...arguments),this._frequencies=new Map}get value(){let e,t=0;for(const[r,s]of this._frequencies.entries())s>t&&(t=s,e=r);return e}_insertValue(e){const t=this._frequencies.get(e);null!=t?this._frequencies.set(e,t+1):this._frequencies.set(e,1)}merge(e){for(const[t,r]of e._frequencies.entries()){const e=this._frequencies.get(t);null!=e?this._frequencies.set(t,e+r):this._frequencies.set(t,r)}}clone(){const e=new u(this.field);return e._frequencies=new Map(this._frequencies),e}}e.AccumulatedStatistics=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/GridSpatialIndex":function(){define(["exports","../../../../../core/unitUtils","./AAggregateSpatialIndex","./GridCell"],function(e,t,r,s){"use strict";function i(e,r){return t.getMetersPerUnitForSR(e)*t.inchesPerMeter*96/r}class n extends r.AAggregateSpatialIndex{constructor(e){super(e),this._cells=new Map,this._pixelsPerMapUnit=i(e.spatialReference,e.scale)}put(e){for(const t of this._cells.values()){const r=e.get(t.id);r?r.merge(t):e.set(t.id,t.clone())}}putBounded(e,t,r){const s=[t.xmin,t.ymin,t.xmax,t.ymax],[i,n,o,a]=s,l=Math.floor(i*this._pixelsPerMapUnit/this._options.cellSize),c=Math.floor(n*this._pixelsPerMapUnit/this._options.cellSize),u=Math.ceil(o*this._pixelsPerMapUnit/this._options.cellSize),h=Math.ceil(a*this._pixelsPerMapUnit/this._options.cellSize);for(let t=c;t<=h;t++)for(let r=l;r<=u;r++){const s=`${r}.${t}`,i=this._cells.get(s);if(!i)continue;const n=e.get(i.id);n?i&&!e.has(i.id)&&n.merge(i):e.set(i.id,i.clone())}}_insert(e,t,r,s){const i=t*this._pixelsPerMapUnit,n=r*this._pixelsPerMapUnit,o=Math.floor(i/this._options.cellSize),a=Math.floor(n/this._options.cellSize);this._getCellOrCreate(o,a).insert(e,s,t,r)}_getCellOrCreate(e,t){const r=s.GridCell.createId(e,t);let i=this._cells.get(r);if(!i){const n=1*this._options.cellSize/this._pixelsPerMapUnit;i=s.GridCell.create(e,t,this._options.fields,n),this._cells.set(r,i)}return i}}e.GridSpatialIndex=n,e.pixelsPerMapUnit=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/aggregation/AAggregateSpatialIndex":function(){define(["exports","../../../engine/webgl/definitions","../support/arcadeUtils"],function(e,t,r){"use strict";e.AAggregateSpatialIndex=class{constructor(e){this._options=e}insert(e,t){const s=e.getCursor(),{arcadeContextInfo:i,scale:n}=this._options,o=r.createArcadeEvaluationOptions(n,i);for(;s.next();)this._insertFeature(s,o,this._options.sqlOptions,t)}_insertFeature(e,r,s,i){const{featureFilter:n}=this._options;if(null!==n&&!n.check(e,s))return;let o=0,a=0;if("esriGeometryPoint"===e.geometryType)o=e.readXWorldSpace(),a=e.readYWorldSpace();else{if(i){const r=e.readCentroidForDisplay();if(null==r)return;const[s,i]=r.coords;if(s<0||s>t.tileSize||i<0||i>t.tileSize)return}const r=e.readCentroidWorldSpace();if(null==r)return;o=r.coords[0],a=r.coords[1]}this._insert(e,o,a,r)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/arcadeUtils":function(){define(["exports"],function(e){"use strict";e.createArcadeEvaluationOptions=function(e,{timeZone:t,timeExtent:r}){return{$view:{scale:e,timeZone:t,timeProperties:{currentStart:r?.start,currentEnd:r?.end}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/support/WithDisplayId":function(){define(["exports"],function(e){"use strict";e.WithDisplayId=class{constructor(e,t){this.inner=e,this.displayId=t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/FeatureUpdateStrategy":function(){define(["exports","../../../../../core/has","./AProcessorStrategy","../sources/FeatureSourceMessage","../sources/strategies/chunks/Overrides","../support/arcadeUtils","../support/FeatureSetReaderJSON"],function(e,t,r,s,i,n,o){"use strict";class a extends r.ASendState{}class l extends r.AProcessorStrategy{constructor(e,t,r,s){super(e,t,s),this._arcadeContextInfo=r,this.handledChunks=new Set,this.handledChunksForIdCreation=new Set,this.handledChunksForAttributeData=new Set,this._streamLayerDeferredObjectIdsToRemove=[]}destroy(){super.destroy();for(const e of this._source.chunks())this._cleanupChunkIds(e)}invalidateAttributeData(e){this.handledChunksForAttributeData.clear(),this._arcadeContextInfo=e,null!=this._evalOptions&&(this._evalOptions=n.createArcadeEvaluationOptions(this._evalOptions.$view.scale,e))}onSubscribe(e){super.onSubscribe(e),this._evalOptions=e.tile.createArcadeEvaluationOptions(this._arcadeContextInfo)}createState(e){return new a(e)}get aggregateQueryEngine(){return null}displayMap(e,t,r){const s=new Map(e.map(e=>[t(e),e])),i=[];for(const e of this._source.chunks()){const t=e.reader.getCursor();for(;t.next();){const e=t.getObjectId(),n=t.getDisplayId(),o=s.get(e);if(null!=o){const t=r(n,o,e);i.push(t),s.delete(e)}}}return i}getDisplayFeatures(e){const t=new Set(e),r=new Set,s=[];for(const e of this._source.chunks()){const i=e.reader.getCursor();for(;i.next();){const e=i.getObjectId(),n=i.getDisplayId();t.has(n)&&!r.has(e)&&(s.push({...i.readLegacyFeatureWorldSpace(),displayId:n}),r.add(e))}}return{features:s,aggregates:[],tracks:[]}}async*applyOverrideUpdate(e){const r=[];for(const t of e.modified){const e=this._attributeStore.createDisplayIdForObjectId(t.objectId);t.displayId=e,r.push(e)}const n=o.FeatureSetReaderJSON.fromOptimizedFeatures(e.modified,this._source.metadata).getCursor();for(;n.next();)this._attributeStore.setAttributeData(n.getDisplayId(),n,this._evalOptions,this._sqlOptions);const a=[];for(const t of e.removed){const e=this._attributeStore.getDisplayIdForObjectId(t);null!=e&&a.push(e)}t("esri-2d-update-debug")&&console.debug("FeatureUpdateStrategy.applyLocalEdit",{message:e,modifiedDisplayIds:r,removedDisplayIds:a});const l=i.OverrideChunk.fromFeatures(e.modified,this._source.metadata);this.handledChunks.add(l.chunkId),this.handledChunksForAttributeData.add(l.chunkId),this.handledChunksForIdCreation.add(l.chunkId);for(const e of this._sendStates.values())e.handledChunks.add(l.chunkId),yield new s.FeatureTileUpdateMessage(e.subscription,null,r,!1,l.queryInfo);for(const e of this._sendStates.values()){const t=l.getTileReader(e.subscription.tile);yield new s.FeatureTileUpdateMessage(e.subscription,t,a,!1,l.queryInfo)}for(const t of e.removed)this._attributeStore.releaseDisplayIdForObjectId(t)}async*updateChunks(){if(this._source.chunks().length){this._updateAttributeData();for(const e of this._sendStates.values())yield*this._update(e)}}removeChunks(e){for(const t of e)this.handledChunks.delete(t.chunkId),this.handledChunksForAttributeData.delete(t.chunkId),this._cleanupChunkIds(t)}afterUpdateChunks(){for(const e of this._streamLayerDeferredObjectIdsToRemove)this._attributeStore.releaseDisplayIdForObjectId(e);this._streamLayerDeferredObjectIdsToRemove=[]}_cleanupChunkIds(e){if(this.handledChunksForIdCreation.has(e.chunkId)){const t=e.reader.getCursor();for(;t.next();){const e=t.getObjectId();this._source.isStream?this._streamLayerDeferredObjectIdsToRemove.push(e):this._attributeStore.releaseDisplayIdForObjectId(e)}this.handledChunksForIdCreation.delete(e.chunkId)}}_updateAttributeData(){for(const e of this._source.chunks()){const{chunkId:t,reader:r}=e;if(!this.handledChunksForIdCreation.has(t)){this.handledChunksForIdCreation.add(t);const e=r.getCursor();for(;e.next();){const t=this._attributeStore.createDisplayIdForObjectId(e.getObjectId());e.setDisplayId(t)}}}for(const e of this._source.chunks())if(!this.handledChunksForAttributeData.has(e.chunkId)){this.handledChunksForAttributeData.add(e.chunkId);const t=e.reader.getCursor();for(;t.next();){const e=t.getDisplayId();this._attributeStore.setAttributeData(e,t,this._evalOptions,this._sqlOptions)}}}*_update(e){const{subscription:t,handledChunks:r}=e;for(const i of this._source.chunks()){const{chunkId:n}=i;if(r.has(n)||!this.handledChunksForIdCreation.has(n)||!this.handledChunksForAttributeData.has(n))continue;r.add(n);const o=i.getTileReader(t.tile);o&&(yield new s.FeatureTileAppendMessage(e.subscription,o,!1,i.end,i.queryInfo))}}}e.DefaultSendState=a,e.FeatureUpdateStrategy=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/Overrides":function(){define(["exports","./ASourceChunk","../../../support/FeatureSetReaderJSON"],function(e,t,r){"use strict";class s{constructor(){this.modified=[],this.removed=[]}modify(e){this.modified.push(e)}remove(e){this.removed.push(e)}get isEmpty(){return 0===this.modified.length&&0===this.removed.length}}class i extends t.ASourceChunk{constructor(e){super(),this._reader=e,this.chunkId="override",this.normalizedChunkId="override"}static fromFeatures(e,t){const s=r.FeatureSetReaderJSON.fromOptimizedFeatures(e,t);return new i(s)}get reader(){return this._reader}get queryInfo(){return{}}get first(){return!1}get end(){return!1}get isTiled(){return!1}getTileReader(e){if(!this._reader.getSize())return null;const t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}class n{constructor(e,t){this.inner=e,this.isWeak=t,this.lastWeak=null}get isStrong(){return!this.isWeak}}e.OverrideChunk=i,e.OverrideState=class{constructor(){this._overrides=new Map,this._update=new s,this._lastCleanup=0}hasOverride(e){return this._overrides.has(e)}onChunkInsert(e){if(this._overrides.size){const t=e.reader.getCursor();for(;t.next();){const e=t.getObjectId(),r=this._overrides.get(e);if(r?.lastWeak&&(r.lastWeak=null),r?.isWeak){const e=t.readOptimizedFeatureWorldSpace();r.inner=e,this._update.modify(e),this.invalidate()}}}e.registerOverrides(this)}apply(e,t){const{updateWeak:r,removeWeak:s,update:i,remove:o,release:a}=e.commands;this.invalidate();for(const e of r){const t=new n(e,!0),r=this._overrides.get(e.objectId);r?.isStrong?r.lastWeak=t:(this._overrides.set(e.objectId,t),this._update.modify(e))}for(const e of i){const t=new n(e,!1),r=this._overrides.get(e.objectId);t.lastWeak=r?.isWeak?r:r?.lastWeak??null,this._overrides.set(e.objectId,t),this._update.modify(e)}for(const e of s){const t=new n(null,!0),r=this._overrides.get(e);r?.isStrong?r.lastWeak=t:(this._overrides.set(e,t),this._update.remove(e))}for(const e of o){const t=new n(null,!1),r=this._overrides.get(e);t.lastWeak=r?.isWeak?r:r?.lastWeak??null,this._overrides.set(e,t),this._update.remove(e)}if(a.length){const e=new Set;for(const t of a){const r=this._overrides.get(t);r?.lastWeak?(this._overrides.set(t,r.lastWeak),null==r.lastWeak.inner?this._update.remove(t):this._update.modify(r.lastWeak.inner)):r&&!r.isWeak&&(this._overrides.delete(t),e.add(t))}t.forEachUnsafe(t=>{const r=t.getObjectId();e.has(r)&&(this._update.modify(t.readOptimizedFeatureWorldSpace()),e.delete(r))});for(const t of e.values())this._update.remove(t)}}clearWeakOverrides(){for(const[e,t]of this._overrides.entries())t.isWeak&&this._overrides.delete(e);this.invalidate()}cleanup(e){if(this._overrides.size<1e4)return;const t=performance.now();if(t-this._lastCleanup<1e3)return;this._lastCleanup=t;const r=this._getWeakDeletions();if(!(r.size<1e4)){for(const t of e){const e=t.reader.withoutOverrides().getCursor();for(;e.next();){const t=e.getObjectId();r.delete(t)}}for(const e of r)this._overrides.delete(e);r.size&&this.invalidate()}}takeOverrideUpdate(){const e=this._update;return e.isEmpty?null:(this._update=new s,e)}asChunk(e){if(!this._chunk){const t=[];for(const e of this._overrides.values())null!=e.inner&&t.push(e.inner);this._chunk=i.fromFeatures(t,e)}return this._chunk}invalidate(){this._chunk=null}putWeakObjectIdsFromGlobalIds(e,t,r){for(const[s,i]of this._overrides.entries()){if(i.isWeak&&null!=i.inner){const n=i.inner.attributes[r];n&&t.has(n)&&!e.has(n)&&e.set(n,s);continue}if(null!=i.lastWeak&&null!=i.lastWeak.inner){const n=i.lastWeak.inner.attributes[r];n&&t.has(n)&&!e.has(n)&&e.set(n,s)}}}_getWeakDeletions(){const e=new Set;for(const[t,r]of this._overrides.entries())r.isWeak&&null==r.inner&&e.add(t);return e}},e.OverrideUpdate=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/ASourceChunk":function(){define(["exports","../../../FeatureSpatialIndex","../../../aggregation/GeohashSpatialIndex","../../../aggregation/GridSpatialIndex","../../../support/FeatureSetReaderIndirect"],function(e,t,r,s,i){"use strict";e.ASourceChunk=class{size(){return this.reader.getSize()}get fields(){return this.reader.fields}invalidate(){this._aggregateIndex=null,this._aggregateIndexHash=null,this._spatialIndex=null}registerOverrides(e){this.reader.registerOverrides(e),this.invalidate()}queryFeaturesInBounds(e){const t=this._getSpatialIndex().search(e);return i.FeatureSetReaderIndirect.from(this.reader,t)}getAggregateIndex(e){const t=JSON.stringify(e);if(t!==this._aggregateIndexHash){switch(this._aggregateIndexHash=t,e.type){case"grid":this._aggregateIndex=new s.GridSpatialIndex(e);break;case"geohash":this._aggregateIndex=new r.GeohashSpatialIndex(e)}this._aggregateIndex.insert(this.reader,this.isTiled)}return this._aggregateIndex}_getSpatialIndex(){return this._spatialIndex||(this._spatialIndex=t.FeatureSpatialIndex.fromReader(this.reader)),this._spatialIndex}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureSpatialIndex":function(){define(["exports","../../../../chunks/rbush","../../../../geometry/support/aaBoundingBox"],function(e,t,r){"use strict";class s{static fromReader(e){const i=[],n=e.copy(),o=r.create();for(;n.next();)n.getBounds(o)&&i.push(n.getIndex());const a=t.rbush(9,e=>(n.setIndex(e),{minX:n.getBoundsXMin(),minY:n.getBoundsYMin(),maxX:n.getBoundsXMax(),maxY:n.getBoundsYMax()}));return a.load(i),new s(a)}constructor(e){this._index=e}search(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}e.FeatureSpatialIndex=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/rbush":function(){define(["exports","./quickselect"],function(e,t){"use strict";function r(e,t){if(!(this instanceof r))return new r(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this.toBBox=t:this._initFormat(t)),this.clear()}function s(e,t,r){if(!r)return t.indexOf(e);for(var s=0;s<t.length;s++)if(r(e,t[s]))return s;return-1}function i(e,t){n(e,0,e.children.length,t,e)}function n(e,t,r,s,i){i||(i=m(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var n,a=t;a<r;a++)n=e.children[a],o(i,e.leaf?s(n):n);return i}function o(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function a(e,t){return e.minX-t.minX}function l(e,t){return e.minY-t.minY}function c(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function u(e){return e.maxX-e.minX+(e.maxY-e.minY)}function h(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function d(e,t){var r=Math.max(e.minX,t.minX),s=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),n=Math.min(e.maxY,t.maxY);return Math.max(0,i-r)*Math.max(0,n-s)}function p(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function f(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function g(e,r,s,i,n){for(var o,a=[r,s];a.length;)(s=a.pop())-(r=a.pop())<=i||(o=r+Math.ceil((s-r)/i/2)*i,t.quickselect(e,o,r,s,n),a.push(r,o,o,s))}r.prototype={all:function(){return this._all(this.data,[])},search:function(e){var t=this.data,r=[],s=this.toBBox;if(!f(e,t))return r;for(var i,n,o,a,l=[];t;){for(i=0,n=t.children.length;i<n;i++)o=t.children[i],f(e,a=t.leaf?s(o):o)&&(t.leaf?r.push(o):p(e,a)?this._all(o,r):l.push(o));t=l.pop()}return r},collides:function(e){var t=this.data,r=this.toBBox;if(!f(e,t))return!1;for(var s,i,n,o,a=[];t;){for(s=0,i=t.children.length;s<i;s++)if(n=t.children[s],f(e,o=t.leaf?r(n):n)){if(t.leaf||p(e,o))return!0;a.push(n)}t=a.pop()}return!1},load:function(e){if(!e||!e.length)return this;if(e.length<this._minEntries){for(var t=0,r=e.length;t<r;t++)this.insert(e[t]);return this}var s=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===s.height)this._splitRoot(this.data,s);else{if(this.data.height<s.height){var i=this.data;this.data=s,s=i}this._insert(s,this.data.height-s.height-1,!0)}else this.data=s;return this},insert:function(e){return null!=e&&this._insert(e,this.data.height-1),this},clear:function(){return this.data=m([]),this},remove:function(e,t){if(null==e)return this;for(var r,i,n,o,a=this.data,l=this.toBBox(e),c=[],u=[];a||c.length;){if(a||(a=c.pop(),i=c[c.length-1],r=u.pop(),o=!0),a.leaf&&-1!==(n=s(e,a.children,t)))return a.children.splice(n,1),c.push(a),this._condense(c),this;o||a.leaf||!p(a,l)?i?(r++,a=i.children[r],o=!1):a=null:(c.push(a),u.push(r),r=0,i=a,a=a.children[0])}return this},toBBox:function(e){return e},compareMinX:a,compareMinY:l,toJSON:function(){return this.data},fromJSON:function(e){return this.data=e,this},_all:function(e,t){for(var r=[];e;)e.leaf?t.push.apply(t,e.children):r.push.apply(r,e.children),e=r.pop();return t},_build:function(e,t,r,s){var n,o=r-t+1,a=this._maxEntries;if(o<=a)return i(n=m(e.slice(t,r+1)),this.toBBox),n;s||(s=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,s-1))),(n=m([])).leaf=!1,n.height=s;var l,c,u,h,d=Math.ceil(o/a),p=d*Math.ceil(Math.sqrt(a));for(g(e,t,r,p,this.compareMinX),l=t;l<=r;l+=p)for(g(e,l,u=Math.min(l+p-1,r),d,this.compareMinY),c=l;c<=u;c+=d)h=Math.min(c+d-1,u),n.children.push(this._build(e,c,h,s-1));return i(n,this.toBBox),n},_chooseSubtree:function(e,t,r,s){for(var i,n,o,a,l,u,d,p;s.push(t),!t.leaf&&s.length-1!==r;){for(d=p=1/0,i=0,n=t.children.length;i<n;i++)l=c(o=t.children[i]),(u=h(e,o)-l)<p?(p=u,d=l<d?l:d,a=o):u===p&&l<d&&(d=l,a=o);t=a||t.children[0]}return t},_insert:function(e,t,r){var s=this.toBBox,i=r?e:s(e),n=[],a=this._chooseSubtree(i,this.data,t,n);for(a.children.push(e),o(a,i);t>=0&&n[t].children.length>this._maxEntries;)this._split(n,t),t--;this._adjustParentBBoxes(i,n,t)},_split:function(e,t){var r=e[t],s=r.children.length,n=this._minEntries;this._chooseSplitAxis(r,n,s);var o=this._chooseSplitIndex(r,n,s),a=m(r.children.splice(o,r.children.length-o));a.height=r.height,a.leaf=r.leaf,i(r,this.toBBox),i(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)},_splitRoot:function(e,t){this.data=m([e,t]),this.data.height=e.height+1,this.data.leaf=!1,i(this.data,this.toBBox)},_chooseSplitIndex:function(e,t,r){var s,i,o,a,l,u,h,p;for(u=h=1/0,s=t;s<=r-t;s++)a=d(i=n(e,0,s,this.toBBox),o=n(e,s,r,this.toBBox)),l=c(i)+c(o),a<u?(u=a,p=s,h=l<h?l:h):a===u&&l<h&&(h=l,p=s);return p},_chooseSplitAxis:function(e,t,r){var s=e.leaf?this.compareMinX:a,i=e.leaf?this.compareMinY:l;this._allDistMargin(e,t,r,s)<this._allDistMargin(e,t,r,i)&&e.children.sort(s)},_allDistMargin:function(e,t,r,s){e.children.sort(s);var i,a,l=this.toBBox,c=n(e,0,t,l),h=n(e,r-t,r,l),d=u(c)+u(h);for(i=t;i<r-t;i++)a=e.children[i],o(c,e.leaf?l(a):a),d+=u(c);for(i=r-t-1;i>=t;i--)a=e.children[i],o(h,e.leaf?l(a):a),d+=u(h);return d},_adjustParentBBoxes:function(e,t,r){for(var s=r;s>=0;s--)o(t[s],e)},_condense:function(e){for(var t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1].children).splice(t.indexOf(e[r]),1):this.clear():i(e[r],this.toBBox)},_initFormat:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},e.rbush=r})},"esri/chunks/quickselect":function(){define(["exports"],function(e){"use strict";function t(e,s,i,n,o){for(;n>i;){if(n-i>600){var a=n-i+1,l=s-i+1,c=Math.log(a),u=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*u*(a-u)/a)*(l-a/2<0?-1:1);t(e,s,Math.max(i,Math.floor(s-l*u/a+h)),Math.min(n,Math.floor(s+(a-l)*u/a+h)),o)}var d=e[s],p=i,f=n;for(r(e,i,s),o(e[n],d)>0&&r(e,i,n);p<f;){for(r(e,p,f),p++,f--;o(e[p],d)<0;)p++;for(;o(e[f],d)>0;)f--}0===o(e[i],d)?r(e,i,f):r(e,++f,n),f<=s&&(i=f+1),s<=f&&(n=f-1)}}function r(e,t,r){var s=e[t];e[t]=e[r],e[r]=s}function s(e,t){return e<t?-1:e>t?1:0}e.quickselect=function(e,r,i,n,o){t(e,r,i||0,n||e.length-1,o||s)}})},"esri/views/2d/layers/features/aggregation/GeohashSpatialIndex":function(){define(["exports","../../../../../geohash/GeohashTree","../../../../../geohash/geohashUtils","./AAggregateSpatialIndex"],function(e,t,r,s){"use strict";class i extends s.AAggregateSpatialIndex{constructor(e){super(e),this._tree=new t.GeohashTree(this._options.fields)}put(e){throw new Error("Geohash tree does not support put")}putBounded(e,t,s){const{geohashLevel:i,spatialReference:n}=this._options,o=r.getGeohashBounds(t,s,i,n);null!=o&&this._tree.putBins(e,o)}_insert(e,t,s,i){const{geohashLevel:n,spatialReference:o}=this._options,a=r.getGeohash(t,s,n,o);a&&this._tree.insert(e,t,s,a[0],a[1],n,i)}}e.GeohashSpatialIndex=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/GeohashTree":function(){define(["exports","./GeohashCell"],function(e,t){"use strict";e.GeohashTree=class{constructor(e){this._fields=e,this._size=0,this._depth=0,this._root=t.GeohashCell.create(this._fields,0,0,0)}destroy(){}get size(){return this._size}get depth(){return this._depth}find(e,t,r){return this._root.find(e,t,r,0,0,0)}insert(e,r,s,i,n,o,a){let l=this._root,c=0,u=0,h=0;for(;null!==l;){if(l.insert(e,r,s,i,n,a),c>=o)return;const d=Math.ceil((c+1)/2),p=Math.floor((c+1)/2),f=1-c%2,m=30-(3*d+2*p),g=30-(2*d+3*p),y=(i&7*f+3*(1-f)<<m)>>m,_=(n&3*f+7*(1-f)<<g)>>g,b=y+_*(8*f+4*(1-f));u=u<<3*f+2*(1-f)|y,h=h<<2*f+3*(1-f)|_,null==l.children[b]&&(l.children[b]=t.GeohashCell.create(this._fields,u,h,c+1),this._depth=Math.max(this._depth,c+1),this._size+=1),c+=1,l=l.children[b]}}putBins(e,t){for(const r of this.getNodes(t)){const t=e.get(r.id);t?t.merge(r):e.set(r.id,r.clone())}}getNodes(e){const t=[],{geohashBounds:r,level:s}=e;let i=this._root;for(;null!==i;){const e=i.depth,n=i.xNode,o=i.yNode;if(e>=s){t.push(i),i=i.next;continue}const a=Math.ceil((e+1)/2),l=Math.floor((e+1)/2),c=1-e%2,u=30-(3*a+2*l),h=30-(2*a+3*l),d=~((1<<u)-1),p=~((1<<h)-1),f=(r.xLL&d)>>u,m=(r.yLL&p)>>h,g=(r.xTR&d)>>u,y=(r.yTR&p)>>h,_=n<<3*c+2*(1-c),b=o<<2*c+3*(1-c),S=_+8*c+4*(1-c),x=b+4*c+8*(1-c),w=Math.max(_,f),v=Math.max(b,m),M=Math.min(S,g),I=Math.min(x,y);let P=null,T=null;for(let e=v;e<=I;e++)for(let t=w;t<=M;t++){const r=t-_+(e-b)*(8*c+4*(1-c)),s=i.children[r];s&&(P||(P=s,P.next=i.next),T&&(T.next=s),T=s,s.next=i.next)}i=P||i.next}return t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/GeohashCell":function(){define(["exports","./geohashUtils","../geometry/SpatialReference","../layers/graphics/featureConversionUtils","../layers/graphics/OptimizedGeometry","../layers/graphics/data/projectionSupport","../views/2d/layers/features/aggregation/AAggregateCell","../views/2d/layers/features/aggregation/AccumulatedStatistics"],function(e,t,r,s,i,n,o,a){"use strict";class l extends o.AAggregateCell{static create(e,t,r,s){const i=a.AccumulatedStatistics.create(e),n=new Array(32);for(let e=0;e<n.length;e++)n[e]=null;return new l(i,t,r,s,n)}constructor(e,t,r,s,i){super(e),this.xNode=t,this.yNode=r,this.depth=s,this.children=i,this._objectIds=new Set,this._count=0,this._xWorldTotal=0,this._yWorldTotal=0,this._xGeohashTotal=0,this._yGeohashTotal=0,this.next=null}get id(){return`${this.xNode}.${this.yNode}`}get containedObjectIds(){return this._objectIds}get count(){return this._count}clone(){const e=new l(this._statistics.clone(),this.xNode,this.yNode,this.depth,this.children);return e._count=this._count,e._xWorldTotal=this._xWorldTotal,e._yWorldTotal=this._yWorldTotal,e._xGeohashTotal=this._xGeohashTotal,e._yGeohashTotal=this._yGeohashTotal,e.next=this.next,e._objectIds=new Set(this._objectIds),e}insert(e,t,r,s,i,n){this._count+=1,this._xWorldTotal+=t,this._yWorldTotal+=r,this._xGeohashTotal+=s,this._yGeohashTotal+=i,this._statistics.insert(e,n),this._objectIds.add(e.getObjectId())}merge(e){if(0!==e._count){this._count+=e._count,this._xWorldTotal+=e._xWorldTotal,this._yWorldTotal+=e._yWorldTotal,this._xGeohashTotal+=e._xWorldTotal,this._yGeohashTotal+=e._yWorldTotal,this._statistics.merge(e._statistics);for(const t of e._objectIds.values())this._objectIds.add(t)}}getCentroid(e){throw new Error("getCentroid not supported for GeohashNode")}getGeometry(e,t){const o=this._getLngLatBounds(),[a,l,c,u]=o,h={rings:[[[a,l],[a,u],[c,u],[c,l],[a,l]]]},d=n.project(h,r.WGS84,e),p=s.convertFromPolygon(new i,d,!1,!1);return null!=t?s.quantizeOptimizedGeometry(new i,p,!1,!1,"esriGeometryPolygon",t,!1,!1):p}getGeometricCentroid(e,t){const o=this._getLngLatBounds(),[a,l,c,u]=o,h={x:(a+c)/2,y:(l+u)/2},d=n.project(h,r.WGS84,e),p=s.convertFromPoint(new i,d);return null!=t?s.quantizeOptimizedGeometry(new i,p,!1,!1,"esriGeometryPoint",t,!1,!1):p}getAttributes(){const e={aggregateId:this.id};for(const t of this._statistics.values())e[t.field.name]=t.value;return e.aggregateCount=this._count,e}find(e,t,r,s,i,n){if(s>=r)return this;const o=1-s%2,a=3*o+2*(1-o),l=2*o+3*(1-o),c=30-i-a,u=30-n-l,h=((e&7*o+3*(1-o)<<c)>>c)+((t&3*o+7*(1-o)<<u)>>u)*(8*o+4*(1-o)),d=this.children[h];return null==d?null:d.find(e,t,r,s+1,i+a,n+l)}_getLngLatBounds(){const e=this.depth,r=Math.ceil(e/2),s=Math.floor(e/2),i=30-(3*r+2*s),n=30-(2*r+3*s),o=this.xNode<<i,a=this.yNode<<n;return t.decodeGeohashXY({geohashX:o,geohashY:a},this.depth)}}e.GeohashCell=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geohash/geohashUtils":function(){define(["exports","../core/has","../core/mathUtils","../core/libs/gl-matrix-2/math/vec2","../core/libs/gl-matrix-2/factories/vec2f64","../geometry/Polygon","../geometry/SpatialReference","../geometry/support/aaBoundingRect","../geometry/support/Ellipsoid","../layers/graphics/featureConversionUtils","../layers/graphics/OptimizedGeometry","../layers/graphics/data/projectionSupport"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";const d=16,p=i.create(),f=i.create();function m(e,t,s,i){if(i.isWebMercator){const i=r.rad2deg(e/l.earth.radius),n=i-360*Math.floor((i+180)/360),o=[0,0];return x(o,0,r.rad2deg(Math.PI/2-2*Math.atan(Math.exp(-t/l.earth.radius))),n,s),o}const n={x:e,y:t},a=h.project(n,i,o.WGS84);if(!a)return null;const c=[0,0];return x(c,0,a.y,a.x,s),c}function g(e){return e<=57?e-48:e<=104?e-88:e<=107?e-89:e<=110?e-90:e-91}function y(e){return"0123456789bcdefghjkmnpqrstuvwxyz"[e]}function _(e){return(e[0]+e[1])/2}function b(e,t){const r=_(e),s=t,i=!t;e[0]=i*e[0]+s*r,e[1]=i*r+s*e[1]}function S(e,t){const r=t>_(e);return b(e,r),r}function x(e,t,r,s,i){i%2&&(i+=1);let n=0,o=0,a=-90,l=90,c=-180,u=180;for(let e=0;e<i/2;e++){for(let t=0;t<5;t++){const r=(c+u)/2,i=s>r?1:0;n|=i<<29-(t+5*e),c=(1-i)*c+i*r,u=(1-i)*r+i*u}for(let t=0;t<5;t++){const s=(a+l)/2,i=r>s?1:0;o|=i<<29-(t+5*e),a=(1-i)*a+i*s,l=(1-i)*s+i*l}}e[2*t]=n,e[2*t+1]=o}function w(e,t){return t?1&e|(4&e)>>1|(d&e)>>2:(2&e)>>1|(8&e)>>2}function v(e,t){return t?(2&e)>>1|(8&e)>>2:1&e|(4&e)>>1|(d&e)>>2}e.convertGeohash32ToXY=function(e,t){let r=0,s=0,i=30,n=30;for(let e=0;e<t.length;e++){const o=g(t.charCodeAt(e)),a=e%2==0;i-=a?3:2,n-=a?2:3,r|=w(o,a)<<i,s|=v(o,a)<<n}return{geohashX:r,geohashY:s}},e.decodeBase32Char=g,e.decodeGeohash=function(e,t){const r=s.set(p,-90,90),i=s.set(f,-180,180);for(let e=0;e<t.length;e++){const s=g(t.charCodeAt(e));e%2==0?(b(i,!!(d&s)),b(i,!!(4&s)),b(i,!!(1&s)),b(r,!!(8&s)),b(r,!!(2&s))):(b(r,!!(d&s)),b(r,!!(4&s)),b(r,!!(1&s)),b(i,!!(8&s)),b(i,!!(2&s)))}return e[0]=_(r),e[1]=_(i),e},e.decodeGeohashXY=function(e,t){let r=-90,s=90,i=-180,n=180;for(let o=0;o<t;o++){const t=Math.ceil((o+1)/2),a=Math.floor((o+1)/2),l=1-o%2,c=30-(3*t+2*a),u=30-(2*t+3*a),h=3*l+2*(1-l),d=2*l+3*(1-l),p=3*l+7*(1-l)<<u,f=(7*l+3*(1-l)<<c&e.geohashX)>>c,m=(p&e.geohashY)>>u;for(let e=h-1;e>=0;e--){const t=(i+n)/2,r=f&1<<e?1:0;i=(1-r)*i+r*t,n=(1-r)*t+r*n}for(let e=d-1;e>=0;e--){const t=(r+s)/2,i=m&1<<e?1:0;r=(1-i)*r+i*t,s=(1-i)*t+i*s}}return[i,r,n,s]},e.encodeBase32Char=y,e.encodeGeohash=function(e,t,r){let i="";const n=s.set(p,-90,90),o=s.set(f,-180,180);for(let s=0;s<r;s++){let r=0;s%2?(r|=S(n,e)<<4,r|=S(o,t)<<3,r|=S(n,e)<<2,r|=S(o,t)<<1,r|=0|S(n,e)):(r|=S(o,t)<<4,r|=S(n,e)<<3,r|=S(o,t)<<2,r|=S(n,e)<<1,r|=0|S(o,t)),i+=y(r)}return i},e.getGeohash=m,e.getGeohashBounds=function(e,t,r,s){const i=[e.xmin,e.ymin,e.xmax,e.ymax],l=n.fromExtent(a.toExtent(i,s)),d=h.project(l,s,o.WGS84,{densificationStep:64*t});if(!d)return null;const p=c.convertFromPolygon(new u,d,!1,!1),f=p.coords.filter((e,t)=>!(t%2)),g=p.coords.filter((e,t)=>t%2),y=Math.min(...f),_=Math.min(...g),b=Math.max(...f),S=Math.max(...g),x=m(y,_,r,o.WGS84),w=m(b,S,r,o.WGS84);return x&&w?{bounds:i,geohashBounds:{xLL:x[0],yLL:x[1],xTR:w[0],yTR:w[1]},level:r}:null},e.getRelativeGeohash=function e(t,r,s){const i=!((t.length-1)%2),n=t.slice(0,-1),o=g(t.charCodeAt(t.length-1));let a=0,l=0,c=0,u=0;i?(a=8,l=4,c=1&o|(4&o)>>1|(d&o)>>2,u=(2&o)>>1|(8&o)>>2):(a=4,l=8,u=1&o|(4&o)>>1|(d&o)>>2,c=(2&o)>>1|(8&o)>>2);const h=c+r,p=u+s,f=Math.floor(h/a),m=Math.floor(p/l),_=y(function(e,t,r){return r?1&e|(1&t)<<1|(2&e)<<1|(2&t)<<2|(4&e)<<2:1&t|(1&e)<<1|(2&t)<<1|(2&e)<<2|(4&t)<<2}(h-f*a,p-m*l,i));return t.length>1&&(f||m)?e(n,f,m)+_:n+_},e.setGeohashBuf=x,e.setGeohashXY=function(e,t,r,s){s%2&&(s+=1);let i=0,n=0,o=-90,a=90,l=-180,c=180;for(let e=0;e<s/2;e++){for(let t=0;t<5;t++){const s=(l+c)/2,n=r>s?1:0;i|=n<<29-(t+5*e),l=(1-n)*l+n*s,c=(1-n)*s+n*c}for(let r=0;r<5;r++){const s=(o+a)/2,i=t>s?1:0;n|=i<<29-(r+5*e),o=(1-i)*o+i*s,a=(1-i)*s+i*a}}e.geohashX=i,e.geohashY=n},e.unpackXBits=w,e.unpackYBits=v,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderIndirect":function(){define(["exports","../../../../../core/memoryEstimations","../../../../../geometry/support/quantizationUtils","../../../../../layers/graphics/featureConversionUtils","./FeatureSetReader"],function(e,t,r,s,i){"use strict";class n extends i.FeatureSetReader{static from(e,t){if(e instanceof this){const r=new Set(t),s=e._indices.filter(e=>r.has(e));return new n(e._reader,s)}return new n(e.copy(),t)}constructor(e,t){super(e.metadata),this._currentIndex=-1,this._displayTransform=null,this._reader=e,this._indices=t}setTransformForDisplay(e){const t=this._reader.getInTransform();if(null==t)return void(this._displayTransform=r.normalizeTransform(e));const s=r.normalizeTransform(t),i=r.normalizeTransform(e),[n,o]=s.scale,[a,l]=s.translate,[c,u]=i.scale,[h,d]=i.translate,p=n/c,f=o/u,m=(a-h)/c,g=(l-d)/u;this._displayTransform={originPosition:"lowerLeft",scale:[1/p,1/f,1,1],translate:[-m/p,-g/f,0,0]}}getInTransform(){return this._reader.getInTransform()}get fields(){return this._reader.fields}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const e=new n(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e._displayTransform=this._displayTransform,e._processorAttributes=this._processorAttributes,e}get contextTimeZone(){return this._reader.contextTimeZone}set contextTimeZone(e){this._reader.contextTimeZone=e}get usedMemory(){return t.baseObjectMemory+this._reader.usedMemory}setProcessorAttributes(e){this._processorAttributes=Object.assign(this._processorAttributes??{},e)}_nextIndex(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}readXForDisplay(){return this._displayTransform?r.quantizeX(this._displayTransform,this._reader.readXForDisplay()):this._reader.readXForDisplay()}readYForDisplay(){return this._displayTransform?r.quantizeY(this._displayTransform,this._reader.readYForDisplay()):this._reader.readYForDisplay()}readGeometryForDisplay(){return this._displayTransform?this._reader.readGeometryForDisplayTransformed(this._displayTransform):this._reader.readGeometryForDisplay()}readCentroidForDisplay(){const e=this._reader.readCentroidForDisplay()?.clone();if(e){const[t,s]=e.coords;this._displayTransform?(e.coords[0]=r.quantizeX(this._displayTransform,t),e.coords[1]=r.quantizeY(this._displayTransform,s)):(e.coords[0]=t,e.coords[1]=s)}return e}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}readAttribute(e,t=!1){const r=this._reader.readAttribute(e,t);return null==r&&this._processorAttributes?this._processorAttributes[e]:r}readAttributes(){return{...this._processorAttributes??{},...this._reader.readAttributes()}}joinAttributes(e){return this._reader.joinAttributes(e)}getBounds(e){return this._reader.getBounds(e)}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(e){return this._reader.setDisplayId(e)}setIndex(e){return this._reader.setIndex(e)}getIndex(){return this._reader.getIndex()}readXWorldSpace(){return this._reader.readXWorldSpace()}readYWorldSpace(){return this._reader.readYWorldSpace()}_readX(){return this._reader.readXForDisplay()}_readY(){return this._reader.readYForDisplay()}_readServerCentroid(){return this._reader._readServerCentroid()}readLegacyFeatureForDisplay(){const e=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null}}readLegacyGeometryForDisplay(){const e=this.readGeometryForDisplay();return s.convertToGeometry(e,this.geometryType,!1,!1)}readGeometryArea(){return this._displayTransform?this._reader.readGeometryForDisplayTransformed(this._displayTransform)?.area()??0:this._reader.readGeometryArea()}readGeometryWorldSpace(){return this._reader.readGeometryWorldSpace()}_readGeometry(){return this._reader._readGeometry()}_readAttribute(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}_readAttributes(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(e){return this._reader.field(e)}hasField(e){return this._reader.hasField(e)}setField(e,t){return this._reader.setField(e,t)}keys(){return this._reader.keys()}castToText(e=!1){return this._reader.castToText(e)}}e.FeatureSetReaderIndirect=n,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/processor/TrackStrategy":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/Logger","../../../../../core/maybe","../../../../../geometry/operators/gx/operatorGeodeticDensify","../../../../../geometry/operators/support/geodeticCurveType","../../../../../geometry/support/aaBoundingRect","../../../../../geometry/support/normalizeUtils","../../../../../geometry/support/normalizeUtilsSync","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/graphics/OptimizedGeometry","../../../../../layers/support/streamLayerUtils","../../../engine/webgl/definitions","../aggregation/AccumulatedStatistics","../aggregation/ComputedAggregateField","./AAggregateStrategy","./AProcessorStrategy","../sources/FeatureSourceMessage","../support/arcadeUtils","../support/ComputedAttributeStorage","../support/FeatureFilterEvaluator","../support/FeatureMetadata","../support/FeatureSetReaderIndirect","../support/FeatureSetReaderJSON"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_,b,S,x,w,v,M,I){"use strict";let P;class T{constructor(e,t,r,s,i){this.chunkIndex=e,this.featureIndex=t,this.objectId=r,this.displayId=s,this.time=i}}class C{static getOid(e){return p.externalTrackLineOidPrefix+e}constructor(e,t,r,s,i,n,o,a){this._schema=e,this.trackId=t,this.objectId=r,this.displayId=s,this._fields=i,this._spatialReference=n,this._metadata=o,this._isStream=a,this._maxDisplayDuration=this._schema.maxDisplayDuration>0?this._schema.maxDisplayDuration:1/0,this._maxDisplayObservationsPerTrack=this._schema.maxDisplayObservationsPerTrack>=1?this._schema.maxDisplayObservationsPerTrack:1/0,this._observationRecords=[],this._nextObservationRecords=[],this._trackLinePath=[],this._bounds=[],this._trackLineGeometry=new d}get _trackLineAttributes(){const e={...this._latestObservationFeature?.attributes??{},aggregateId:this.objectId,[p.internalTrackPartField]:0};if(null!=this._statistics)for(const t of this._statistics.values())e[t.field.name]=t.value;return e}get _startTimeField(){return this._metadata.timeInfo?.startTimeField}get length(){return this._observationRecords.length}*observations(){yield*this._observationRecords}*previousObservations(){for(let e=0;e<this._observationRecords.length-1;e++)yield this._observationRecords[e]}get latestObservationFeature(){return this._latestObservationFeature}get latestObservationRecord(){return this._latestObservationRecord}stageObservation(e,t){this._nextObservationRecords.push(new T(e,t.getIndex(),t.getObjectId(),t.getDisplayId(),null!=this._startTimeField?t.readAttributeAsTimestamp(this._startTimeField):null))}commitObservations(e,t,r){const s=new Set(this._nextObservationRecords.map(e=>e.objectId)),d=this._observationRecords.filter(e=>!s.has(e.objectId)).map(e=>e.objectId);let f,m;switch(this._observationRecords=[],this._trackLinePath=[],this._isStream||null==this._startTimeField||this._nextObservationRecords.sort((e,t)=>{const r=e.time,s=t.time;return null!=r&&null!=s?r-s:0}),this._schema.timeField){case"startTimeField":f=this._metadata.timeInfo?.startTimeField;break;case"endTimeField":f=this._metadata.timeInfo?.endTimeField;break;case"timeReceived":f=this._isStream?p.internalTimeReceivedField:null}m=this._isStream?r?.end??Date.now():r?.end??-1/0;const g=t.map(e=>e.reader.getCursor());let y;for(let e=this._nextObservationRecords.length-1;e>=0&&!(this._observationRecords.length>=this._maxDisplayObservationsPerTrack);e--){const t=this._nextObservationRecords[e],r=g[t.chunkIndex];i.assertIsSome(r),r.setIndex(t.featureIndex);const s=null!=f?r.readAttributeAsTimestamp(f):null;(null!=s?m-s:0)>=this._maxDisplayDuration||(this._commitObservation(t,r),y??=t)}if(null!=y){const{chunkIndex:t,featureIndex:r}=y,s=`${y.objectId}.latest`,n=e.createDisplayIdForObjectId(s),o=g[t];i.assertIsSome(o),o.setIndex(r);const a=new h.OptimizedFeature(o.readGeometryWorldSpace(),{...o.readAttributes(),[p.internalTrackPartField]:1},null,s,n);this._latestObservationFeature&&d.push(this._latestObservationFeature.objectId),this._latestObservationFeature=a,this._latestObservationRecord=y}else this._latestObservationFeature=null;return this._trackLineGeometry=function(e,t,r){if(t.length<2)return u.convertFromNestedArray(e,[t],!1,!1);if(r.isWrappable){let s=!1;for(let e=1;e<t.length;e++){const i=t[e][0],n=l.getClosestDenormalizedXToReference(i,t[e-1][0],r);i!==n&&(t[e][0]=n,s=!0)}if(s){const s=c.normalizeCentralMeridianForDisplay({paths:[t],spatialReference:r});if(null!=s)return u.convertFromNestedArray(e,s.paths,!1,!1)}return u.convertFromNestedArray(e,[t],!1,!1)}const s=P.fromGeometryToGXGeometry({hasM:!1,hasZ:!1,paths:[t]}),i=P.fromSpatialReference(r);if(null!=i){const t=n.execute(s,1e6,i,o.geodeticCurveType.geodesic);if(null!=t){const r=P.toGeometry(t,i);if(null!=r&&"paths"in r)return u.convertFromNestedArray(e,r.paths,!1,!1)}}return u.convertFromNestedArray(e,[t],!1,!1)}(this._trackLineGeometry,this._trackLinePath,this._spatialReference),this._bounds=function(e){const{lengths:t,coords:r}=e;if(!t.length)return[a.empty()];const s=[];let i=0;for(let e=0;e<t.length;e++){const n=t[e],o=a.empty();s.push(o);for(let e=0;e<n;e++){const t=r[2*(e+i)],s=r[2*(e+i)+1];a.expandPointInPlace(o,[t,s])}i+=n}return s}(this._trackLineGeometry),this._nextObservationRecords=[],d}updateStatistics(e,t){this._statistics=m.AccumulatedStatistics.create(this._fields);const r=e.map(e=>e.reader.getCursor());for(const{chunkIndex:e,featureIndex:s}of this._observationRecords){const n=r[e];i.assertIsSome(n),n.setIndex(s),this._statistics.insert(n,t)}}overlapsTile(e){for(const t of this._bounds)if(a.intersectsWithMargin(t,e.bounds,32))return!0;return!1}getLatestObservationFeatureForTile(e){if(null==this._latestObservationFeature)return null;const{objectId:t,displayId:r,geometry:s,attributes:i}=this._latestObservationFeature,n=new d;u.quantizeOptimizedGeometry(n,s,!1,!1,this._metadata.geometryType,e.subscription.tile.transform);const o=a.fromValues(1/0,1/0,-1/0,-1/0);return function(e,t){const{coords:r,lengths:s}=e;if(!s.length)return void t(r[0],r[1]);let i=0;for(let e=0;e<s.length;e++){const n=s[e];let o=0,a=0;for(let e=0;e<n;e++)o+=r[2*(e+i)],a+=r[2*(e+i)+1],t(o,a);i+=n}}(n,(e,t)=>a.expandPointInPlace(o,[e,t])),a.intersects(o,a.fromValues(0,0,f.tileSize,f.tileSize))?new h.OptimizedFeature(n,i,null,t,r):null}getTrackLineFeatureForTile(e){const t=new d;return u.quantizeOptimizedGeometry(t,this._trackLineGeometry,!1,!1,"esriGeometryPolyline",e.subscription.tile.transform),new h.OptimizedFeature(t,this._trackLineAttributes,null,this.objectId,this.displayId)}getTrackLineOptimizedFeature(){return new h.OptimizedFeature(this._trackLineGeometry,this._trackLineAttributes,null,this.objectId,this.displayId)}getTrackLineDisplayFeature(){const{_trackLineGeometry:e,_trackLineAttributes:t,displayId:r}=this;return{geometry:u.convertToGeometry(e,"esriGeometryPolyline",!1,!1),attributes:t,displayId:r}}_commitObservation(e,t){const r=t.readCentroidWorldSpace();let s=r?.coords[0],i=r?.coords[1];null==r&&(s=t.readXWorldSpace(),i=t.readYWorldSpace()),null!=s&&null!=i&&(this._observationRecords.unshift(e),this._trackLinePath.unshift([s,i]))}}class F extends _.ASendState{constructor(e){super(e),this.done=!1}}class k extends y.AAggregateStrategy{static async create(t,r,s,i,o,a){const l=new x.ComputedAttributeStorage({spatialReference:r}),c=await Promise.all(t.fields.map(async e=>g.ComputedAggregateField.create(l,e))),u=t.featureFilter?await w.create({geometryType:s.metadata.geometryType,hasM:!1,hasZ:!1,timeInfo:s.metadata.timeInfo,fieldsIndex:s.metadata.fieldsIndex,spatialReference:r,filterJSON:t.featureFilter}):null;return r.isWrappable||n.isLoaded()||await Promise.all([new Promise((t,r)=>e(["../../../../../geometry/operators/support/apiConverter"],t,r)),new Promise((t,r)=>e(["../../../../../geometry/operators/support/jsonConverter"],t,r)),n.load()]).then(([e,t,r])=>{P={fromGeometryToGXGeometry:t.fromGeometryToGXGeometry,toGeometry:t.toGeometry,fromSpatialReference:e.fromSpatialReference}}),new k(t,s,i,r,c,u,o,a)}constructor(e,t,r,s,i,n,o,a){super(t,r,s,i,a),this._schema=e,this._featureFilter=n,this._arcadeContextInfo=o,this._tracks=new Map,this._handledChunks=new Set,this._metadata=t.metadata.weakCloneWithAdditionalFields([{name:p.internalTrackPartField,alias:"trackPart",type:"esriFieldTypeSmallInteger"}]),this._trackLineMetadata=v.FeatureMetadata.createFeature({geometryType:"esriGeometryPolyline",featureIdInfo:{type:"object-id",fieldName:"aggregateId"},fieldsIndex:{fields:[...this._source.metadata.fieldsIndex.fields,...this.aggregateFields,{name:p.internalTrackPartField,alias:"trackPart",type:"esriFieldTypeSmallInteger"},{name:"aggregateId",alias:"aggregateId",type:"esriFieldTypeOID"}],timeZoneByFieldName:null},globalIdField:null,spatialReference:t.metadata.spatialReference,outSpatialReference:t.metadata.outSpatialReference,subtypeField:null,subtypes:null,timeInfo:t.metadata.timeInfo,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null})}destroy(){super.destroy();for(const e of this._tracks.values())this._removeTrack(e);this._tracks.clear()}get _isStream(){return this._source.isStream}get enablePixelBuffering(){return!0}get isAggregate(){return!1}requiresInvalidation(){const e=new Set(this._source.chunks().map(e=>e.chunkId));for(const t of e)if(!this._handledChunks.has(t))return!0;for(const t of this._handledChunks)if(!e.has(t))return!0;return!1}invalidate(){this._handledChunks.clear(),super.invalidate()}createState(e){return new F(e)}async*applyOverrideUpdate(e){s.getLogger("esri.views.2d.layers.features.processor.TrackStrategy").error("Applying override to tracks is not supported")}displayMap(e,t,r){const s=new Map(e.map(e=>[t(e),e])),i=[];for(const e of this._tracks.values()){const t=s.get(e.objectId);if(null!=t){const n=r(e.displayId,t,e.objectId);i.push(n),s.delete(e.objectId);continue}const n=e.latestObservationFeature;if(n?.objectId){const e=s.get(n.objectId);if(null!=e){const t=r(n.displayId,e,n.objectId);i.push(t),s.delete(n.objectId);continue}}for(const t of e.observations()){const e=s.get(t.objectId);if(null!=e){const n=r(t.displayId,e,t.objectId);i.push(n),s.delete(t.objectId)}}}return i}getDisplayFeatures(e){const t=new Set(e),r=[],s=[],i=this._source.chunks().map(e=>e.reader.getCursor());for(const e of this._tracks.values()){if(t.has(e.displayId)&&s.push(e.getTrackLineDisplayFeature()),null!=e.latestObservationFeature&&t.has(e.latestObservationFeature.displayId)){const{displayId:t,chunkIndex:s,featureIndex:n}=e.latestObservationRecord,o=i[s];o.setIndex(n),r.push({displayId:t,...o.readLegacyFeatureWorldSpace()})}for(const{displayId:s,chunkIndex:n,featureIndex:o}of e.observations())if(t.has(s)){const e=i[n];e.setIndex(o),r.push({displayId:s,...e.readLegacyFeatureWorldSpace()})}}return{features:r,aggregates:[],tracks:s}}getFeatureObjectIdsForAggregate(e){for(const t of this._tracks.values())if(t.objectId===e)return Array.from(t.observations(),e=>e.objectId);return[]}async*updateChunks(){0===this._handledChunks.size&&this._rebuildTracks();for(const e of this._sendStates.values())yield*this._update(e)}forEachAggregateWorldSpace(e){for(const t of this._tracks.values())e(t.getTrackLineOptimizedFeature())}_rebuildTracks(){const e=this._source.chunks();if(!e.length)return;const t=this._metadata.timeInfo?.trackIdField;if(null==t)return;const r=new Set;for(let s=0;s<e.length;s++){const i=e[s];this._handledChunks.add(i.chunkId);const n=i.reader.getCursor();for(;n.next();){const e=n.readAttribute(t),i=n.getObjectId();if(null!=e&&null!=i&&(null===this._featureFilter||this._featureFilter.check(n,this._sqlOptions))){if(n.getDisplayId()||n.setDisplayId(this._attributeStore.createDisplayIdForObjectId(i)),!this._tracks.has(e)){const t=C.getOid(e),r=this._attributeStore.createDisplayIdForObjectId(t),s=new C(this._schema,e,t,r,this.aggregateFields,this.spatialReference,this._source.metadata,this._isStream);this._tracks.set(e,s)}this._tracks.get(e).stageObservation(s,n),r.add(e)}}}for(const t of this._tracks.values())if(r.has(t.trackId)){const r=t.commitObservations(this._attributeStore,e,this._featureFilter?.timeExtent);for(const e of r)this._attributeStore.releaseDisplayIdForObjectId(e);t.updateStatistics(e,S.createArcadeEvaluationOptions(1,this._arcadeContextInfo))}else this._removeTrack(t)}_removeTrack(e){this._tracks.delete(e.trackId),this._attributeStore.releaseDisplayIdForObjectId(e.objectId);for(const{objectId:t}of e.observations())this._attributeStore.releaseDisplayIdForObjectId(t);null!=e.latestObservationFeature&&this._attributeStore.releaseDisplayIdForObjectId(e.latestObservationFeature.objectId)}*_update(e){if(e.done)return;e.done=!this._source.updateTracking.updating;const t=[],s=[];for(const r of this._tracks.values())if(r.length>0){if(this._schema.showLatestObservation){const s=r.getLatestObservationFeatureForTile(e);null!=s&&t.push(s)}this._schema.showTrackLine&&r.overlapsTile(e.subscription.tile)&&s.push(r.getTrackLineFeatureForTile(e))}const i=I.FeatureSetReaderJSON.fromOptimizedFeatures(t,this._metadata,e.subscription.tile.transform),n=I.FeatureSetReaderJSON.fromOptimizedFeatures(s,this._trackLineMetadata,e.subscription.tile.transform);let o=[];if(this._schema.showPreviousObservations){const t=this._source.chunks().map(()=>[]);for(const e of this._tracks.values())for(const{chunkIndex:r,featureIndex:s}of e.previousObservations())t[r].push(s);o=this._source.chunks().map((r,s)=>{const i=r.getTileReader(e.subscription.tile);if(null==i)return null;const n=M.FeatureSetReaderIndirect.from(i,t[s]);return n.setProcessorAttributes({[p.internalTrackPartField]:2}),"esriGeometryPoint"!==n.geometryType&&null!=n.getInTransform()||n.setTransformForDisplay(e.subscription.tile.transform),n}).filter(r.isSome)}this.events.emit("changed");const a=e.subscription.tile.createArcadeEvaluationOptions(this._arcadeContextInfo),l=n.getCursor();for(;l.next();)this._attributeStore.setAttributeData(l.getDisplayId(),l,a,this._sqlOptions);for(const e of o){const t=e.getCursor();for(;t.next();)this._attributeStore.setAttributeData(t.getDisplayId(),t,a,this._sqlOptions)}const c=i.getCursor();for(;c.next();)this._attributeStore.setAttributeData(c.getDisplayId(),c,a,this._sqlOptions);yield new b.FeatureTileAppendMessage(e.subscription,n,!1,!1,{});for(const t of o)yield new b.FeatureTileAppendMessage(e.subscription,t,!1,!1,{});yield new b.FeatureTileAppendMessage(e.subscription,i,!1,e.done,{})}}t.TrackStrategy=k,Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/operators/gx/operatorGeodeticDensify":function(){define(["require","exports","../../../chunks/SimpleGeometryCursor","../../../chunks/pe"],function(e,t,r,s){"use strict";let i;function n(){return!!i&&s.isLoaded()}t.execute=function(e,t,r,s){return i.execute(e,t,r,s,null)},t.executeMany=function(e,t,s,n){const o=i.executeMany(new r.SimpleGeometryCursor(e),t,s,n,null);return Array.from(o)},t.isLoaded=n,t.load=async function(){if(!n()){const[t,r]=await Promise.all([new Promise((t,r)=>e(["../../../chunks/OperatorGeodeticDensifyByLength"],t,r)),new Promise((t,r)=>e(["../../../chunks/ProjectionTransformation"],t,r)).then(e=>e.SpatialReference).then(({injectPe:e})=>e),s.load()]);i=new t.OperatorGeodeticDensifyByLength,r(s.pe)}},t.supportsCurves=function(){return i.supportsCurves()},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleGeometryCursor":function(){define(["exports"],function(e){"use strict";class t{*[Symbol.iterator](){let e=this.next();for(;e;)yield e,e=this.next()}}e.GeometryCursor=t,e.OverlayGeometryCursor=class extends t{},e.SimpleGeometryCursor=class extends t{constructor(e){super(),this.m_iGeom=-1,this.m_aGeoms=e?e.slice():[]}next(){if(this.m_iGeom<this.m_aGeoms.length-1){const e=this.m_aGeoms[++this.m_iGeom];return this.m_aGeoms[this.m_iGeom]=null,e}return null}tock(){return!1}getGeometryID(){return this.m_iGeom}getRank(){return 1}}})},"esri/geometry/operators/support/geodeticCurveType":function(){define(["exports"],function(e){"use strict";e.geodeticCurveType={geodesic:0,loxodrome:1,"great-elliptic":2,"normal-section":3,"shape-preserving":4},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/normalizeUtilsSync":function(){define(["exports","../../core/support/jsonUtils","./aaBoundingRect","./boundsUtils","./coordsUtils","./jsonUtils","./normalizeUtilsCommon","./spatialReferenceUtils"],function(e,t,r,s,i,n,o,a){"use strict";function l(e,r){if(null==e)return null;const i=e.spatialReference,l=a.getInfo(i),d=t.isSerializable(e)?e.toJSON():e;if(!l)return d;const g=a.isWebMercator(i)?102100:4326,y=o.cutParams[g].maxX,_=o.cutParams[g].minX;if(n.isPoint(d))return c(d,y,_);if(n.isMultipoint(d))return d.points=d.points.map(e=>c(e,y,_)),d;if(n.isExtent(d))return function(e,t){if(!t)return e;const r=function(e,t){const r=[],{ymin:s,ymax:i,xmin:n,xmax:o}=e,a=e.xmax-e.xmin,[l,c]=t.valid,{x:d,frameId:p}=u(e.xmin,t),{x:m,frameId:g}=u(e.xmax,t),y=d===m&&a>0;if(a>2*c){const e={xmin:n<o?d:m,ymin:s,xmax:c,ymax:i},t={xmin:l,ymin:s,xmax:n<o?m:d,ymax:i},a={xmin:0,ymin:s,xmax:c,ymax:i},u={xmin:l,ymin:s,xmax:0,ymax:i},y=[],_=[];h(e,a)&&y.push(p),h(e,u)&&_.push(p),h(t,a)&&y.push(g),h(t,u)&&_.push(g);for(let e=p+1;e<g;e++)y.push(e),_.push(e);r.push(new f(e,[p]),new f(t,[g]),new f(a,y),new f(u,_))}else d>m||y?r.push(new f({xmin:d,ymin:s,xmax:c,ymax:i},[p]),new f({xmin:l,ymin:s,xmax:m,ymax:i},[g])):r.push(new f({xmin:d,ymin:s,xmax:m,ymax:i},[p]));return r}(e,t).map(e=>e.extent);return r.length<2?r[0]||e:r.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:r.map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}}(d,l);if(n.isPolygon(d)||n.isPolyline(d)){const e=s.getBoundsXY(m,d),t={xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3]},i=o.offsetMagnitude(t.xmin,_)*(2*y),n=0===i?d:o.updatePolyGeometry(d,i);return t.xmin+=i,t.xmax+=i,t.xmax>y?p(n,y,r):t.xmin<_?p(n,_,r):n}return d}function c(e,t,r){if(Array.isArray(e)){const s=e[0];if(s>t){const r=o.offsetMagnitude(s,t);e[0]=s+r*(-2*t)}else if(s<r){const t=o.offsetMagnitude(s,r);e[0]=s+t*(-2*r)}}else{const s=e.x;if(s>t){const r=o.offsetMagnitude(s,t);e.x+=r*(-2*t)}else if(s<r){const t=o.offsetMagnitude(s,r);e.x+=t*(-2*r)}}return e}function u(e,t){const[r,s]=t.valid,i=2*s;let n,o=0;return e>s?(n=Math.ceil(Math.abs(e-s)/i),e-=n*i,o=n):e<r&&(n=Math.ceil(Math.abs(e-r)/i),e+=n*i,o=-n),{x:e,frameId:o}}function h(e,t){const{xmin:r,ymin:s,xmax:i,ymax:n}=t;return d(e,r,s)&&d(e,r,n)&&d(e,i,n)&&d(e,i,s)}function d(e,t,r){return t>=e.xmin&&t<=e.xmax&&r>=e.ymin&&r<=e.ymax}function p(e,t,r=!0){const s=!n.isPolyline(e);if(s&&i.closeRings(e),r)return(new g).cut(e,t);const o=s?e.rings:e.paths,a=s?4:2,l=o.length,c=-2*t;for(let e=0;e<l;e++){const t=o[e];if(t&&t.length>=a){const e=[];for(const r of t)e.push([r[0]+c,r[1]]);o.push(e)}}return s?e.rings=o:e.paths=o,e}class f{constructor(e,t){this.extent=e,this.frameIds=t}}const m=r.create();class g{constructor(){this._linesIn=[],this._linesOut=[]}cut(e,t){let r;if(this._xCut=t,e.rings)this._closed=!0,r=e.rings,this._minPts=4;else{if(!e.paths)return null;this._closed=!1,r=e.paths,this._minPts=2}for(const e of r){if(!e||e.length<this._minPts)continue;let t=!0;for(const r of e)t?(this.moveTo(r),t=!1):this.lineTo(r);this._closed&&this.close()}this._pushLineIn(),this._pushLineOut(),r=[];for(const e of this._linesIn)e&&e.length>=this._minPts&&r.push(e);const s=-2*this._xCut;for(const e of this._linesOut)if(e&&e.length>=this._minPts){for(const t of e)t[0]+=s;r.push(e)}return this._closed?e.rings=r:e.paths=r,e}moveTo(e){this._pushLineIn(),this._pushLineOut(),this._prevSide=this._side(e[0]),this._moveTo(e[0],e[1],this._prevSide),this._prevPt=e,this._firstPt=e}lineTo(e){const t=this._side(e[0]);if(t*this._prevSide===-1){const r=this._intersect(this._prevPt,e);this._lineTo(this._xCut,r,0),this._prevSide=0,this._lineTo(e[0],e[1],t)}else this._lineTo(e[0],e[1],t);this._prevSide=t,this._prevPt=e}close(){const e=this._firstPt,t=this._prevPt;e[0]===t[0]&&e[1]===t[1]||this.lineTo(e),this._checkClosingPt(this._lineIn),this._checkClosingPt(this._lineOut)}_moveTo(e,t,r){this._closed?(this._lineIn.push([r<=0?e:this._xCut,t]),this._lineOut.push([r>=0?e:this._xCut,t])):(r<=0&&this._lineIn.push([e,t]),r>=0&&this._lineOut.push([e,t]))}_lineTo(e,t,r){this._closed?(y(this._lineIn,r<=0?e:this._xCut,t),y(this._lineOut,r>=0?e:this._xCut,t)):r<0?(0===this._prevSide&&this._pushLineOut(),this._lineIn.push([e,t])):r>0?(0===this._prevSide&&this._pushLineIn(),this._lineOut.push([e,t])):this._prevSide<0?(this._lineIn.push([e,t]),this._lineOut.push([e,t])):this._prevSide>0&&(this._lineOut.push([e,t]),this._lineIn.push([e,t]))}_checkClosingPt(e){const t=e.length;t>3&&e[0][0]===this._xCut&&e[t-2][0]===this._xCut&&e[1][0]===this._xCut&&(e[0][1]=e[t-2][1],e.pop())}_side(e){return e<this._xCut?-1:e>this._xCut?1:0}_intersect(e,t){const r=(this._xCut-e[0])/(t[0]-e[0]);return e[1]+r*(t[1]-e[1])}_pushLineIn(){this._lineIn&&this._lineIn.length>=this._minPts&&this._linesIn.push(this._lineIn),this._lineIn=[]}_pushLineOut(){this._lineOut&&this._lineOut.length>=this._minPts&&this._linesOut.push(this._lineOut),this._lineOut=[]}}function y(e,t,r){const s=e.length;s>1&&e[s-1][0]===t&&e[s-2][0]===t?e[s-1][1]=r:e.push([t,r])}e.CutVertical=g,e.normalizeCentralMeridianForDisplay=function(e){return l(e,!1)},e.normalizeCentralMeridianSync=function(e){return l(e,!0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/AttributeStore":function(){define(["exports","../../../../../core/Error","../../../../../core/has","../../../../../core/Logger","../../../../../core/accessorSupport/diffUtils","../../../../../support/ArcadeExpression","../../../engine/webgl/definitions","../../../engine/webgl/DisplayId","../../../engine/webgl/Utils","../../../engine/webgl/shaderGraph/techniques/shaders/constants","../../../engine/webgl/util/debug","./DisplayIdGenerator","./FeatureFilterEvaluator","../../../../webgl/enums"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p){"use strict";function f(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e}const m=()=>s.getLogger("esri.views.layers.2d.features.support.AttributeStore"),g=u.createDebugLogger(u.DEBUG_ATTR_UPDATES,m()),y=r("esri-shared-array-buffer");r("esri-atomics");class _{constructor(e,t,r){this.size=0,this.texelSize=4,this.dirtyStart=0,this.dirtyEnd=0;const{pixelType:s,layout:i,textureOnly:n}=t;this.textureOnly=n||!1,this.pixelType=s,this.layout=i,this._resetRange(),this.size=e,this.isLocal=r,n||(this.data=this._initData(s,e))}get buffer(){return this.data?.buffer}unsetComponentAllTexels(e,t){const r=this.data;for(let s=0;s<this.size*this.size;s++)r[s*this.texelSize+e]&=~t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,t){const r=this.data;for(let s=0;s<this.size*this.size;s++)r[s*this.texelSize+e]|=255&t;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,t,r){const s=this.data;for(const i of r)s[i*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,i),this.dirtyEnd=Math.max(this.dirtyEnd,i)}setComponentTexel(e,t,r){this.data[r*this.texelSize+e]|=t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}unsetComponentTexel(e,t,r){this.data[r*this.texelSize+e]&=~t,this.dirtyStart=Math.min(this.dirtyStart,r),this.dirtyEnd=Math.max(this.dirtyEnd,r)}getData(e,t){const r=a.getDisplayIdTexel(e);return this.data[r*this.texelSize+t]}setData(e,t,r){const s=a.getDisplayIdTexel(e),i=1<<t;0!==(this.layout&i)?null!=this.data&&(this.data[s*this.texelSize+t]=r,this.dirtyStart=Math.min(this.dirtyStart,s),this.dirtyEnd=Math.max(this.dirtyEnd,s)):m().error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}expand(e){if(this.size=e,!this.textureOnly){const t=this._initData(this.pixelType,e),r=this.data;t.set(r),this.data=t}}toMessage(){const e=this.dirtyStart,t=this.dirtyEnd,r=this.texelSize;if(e>t)return null;this._resetRange();const s=!this.isLocal,i=this.pixelType,n=this.layout,o=this.data;return{start:e,end:t,data:s&&o.slice(e*r,(t+1)*r)||null,pixelType:i,layout:n}}_initData(e,t){const r=ArrayBuffer,s=l.getPixelArrayCtor(e),i=new s(new r(t*t*4*s.BYTES_PER_ELEMENT));for(let e=0;e<i.length;e+=4)i[e+1]=255;return i}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}e.AttributeStore=class{constructor(e){this._client=e,this._filters=[],this._blocks=new Array,this._attributeComputeInfo=null,this._abortController=new AbortController,this._size=o.attributeStoreInitialSize,this._idsToHighlight=new Map,this._arcadeDependencies=new Set,this._initialized=!1,this.version=0,this._idGenerator=new h.DisplayIdGenerator,this._epoch=1}destroy(){this._abortController.abort()}_initialize(){if(null!=this._blockDescriptors)return;const e=p.PixelType.FLOAT;g(`Creating AttributeStore ${y?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:p.PixelType.UNSIGNED_BYTE,layout:1},{pixelType:p.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:p.PixelType.UNSIGNED_BYTE,layout:15,textureOnly:!0},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:e,layout:15},{pixelType:p.PixelType.FLOAT,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}get hasHighlight(){return this._idsToHighlight.size>0}createDisplayIdForObjectId(e){return this._idGenerator.createIdForObjectId(e)}releaseDisplayIdForObjectId(e){return this._idGenerator.releaseIdForObjectId(e)}getDisplayIdForObjectId(e){return this._idGenerator.getDisplayIdForObjectId(e)}incrementDisplayIdGeneration(){this._idGenerator.incrementGeneration()}hasArcadeDependency(e){return this._arcadeDependencies.has(e)}releaseAllIds(){this._idGenerator.releaseAll()}async update(e,t,s,n=0){const o=i.diff(this._schema,e);if(this.version=n,o&&(r("esri-2d-update-debug")&&console.debug(`Version[${n}] AttributeStore.update`,{changed:o}),this._schema=e,this._attributeComputeInfo=null,this._initialize(),null!=e))if(s&&(this._filters=await Promise.all(e.filters.map(e=>e?d.create({geometryType:s.geometryType,hasM:!1,hasZ:!1,timeInfo:s.timeInfo,fieldsIndex:s.fieldsIndex,spatialReference:s.outSpatialReference,filterJSON:e}):null))),"multi"!==e.type)this._attributeComputeInfo={type:"feature",map:new Map},await Promise.all(e.bindings.map(async e=>{const r=await this._bind(t,e);this._updateReferences(r)}));else{this._attributeComputeInfo={type:"multi",keyField:e.keyField,map:new Map};for(const r in e.bindings){const s=e.bindings[r];await Promise.all(s.map(async e=>{const s=await this._bind(t,e,parseInt(r,10));this._updateReferences(s)}))}}}setHighlight(e,t){let r=null;0===e.length&&0===t.length&&(r=this._getBlock(0),r.unsetComponentAllTexels(0,(1<<o.maxHighlightReasons)-1));for(const{displayId:t,highlightFlags:s}of e){if(null==t||-1===t)continue;r||(r=this._getBlock(0),r.unsetComponentAllTexels(0,(1<<o.maxHighlightReasons)-1));const e=a.getDisplayIdTexel(t);r.setComponent(0,s,[e])}this._idsToHighlight.clear();for(const{objectId:t,highlightFlags:r}of e)this._idsToHighlight.set(t,r);for(const{objectId:e,highlightFlags:r}of t)this._idsToHighlight.set(e,r)}setData(e,t,r,s){const i=a.getDisplayIdTexel(e);this._ensureSizeForTexel(i),this._getBlock(t).setData(e,r,s)}getData(e,t,r){return this._getBlock(t).getData(e,r)}getHighlightFlags(e){return this._idsToHighlight.get(e)||0}unsetAttributeData(e){const t=a.getDisplayIdTexel(e);this._getBlock(0).setData(t,0,0)}setAttributeData(e,t,r,s){const i=a.getDisplayIdTexel(e);this._ensureSizeForTexel(i),this._getBlock(0).setData(i,0,this.getFilterFlags(t,s));const n=this._attributeComputeInfo;let o=null;n&&(o="multi"===n.type?n.map.get(t.readAttribute(n.keyField)):n.map,o?.size&&o.forEach((e,s)=>{const n=1*s%4,o=Math.floor(1*s/4),a=this._getBlock(o+3);let l=e.field?.read(t,r);e.valueRepresentation&&(l=f(l,e.valueRepresentation)),(null===l||isNaN(l)||l===1/0||l===-1/0)&&(l=c.nanMagicNumber),a.setData(i,n,l)}))}get epoch(){return this._epoch}sendUpdates(){const e=this._blocks.map(e=>null!=e?e.toMessage():null),t=this._getInitArgs();r("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.start"),this._client.update({initArgs:t,blockData:e,version:this.version,sendUpdateEpoch:this._epoch}),this._epoch+=1,r("esri-2d-log-updating")&&console.log("AttributeStore: _doSendUpdate.end")}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}async _bind(e,t,r){const s=await e.createComputedField(t),{valueRepresentation:i}=t,n=this._attributeComputeInfo;if("multi"===n.type){const e=n.map.get(r)??new Map;e.set(t.binding,{field:s,valueRepresentation:i}),n.map.set(r,e)}else n.map.set(t.binding,{field:s,valueRepresentation:i});return s}_getInitArgs(){return this._initialized?null:(this._initialized=!0,this._getBlock(1),this._getBlock(2),this._getBlock(7),{blockSize:this._size,blockDescriptors:this._blocks.map(e=>null!=e?{textureOnly:e.textureOnly,buffer:e.buffer,pixelType:e.pixelType}:null)})}_getBlock(e){const t=this._blocks[e];if(null!=t)return t;g(`Initializing AttributeBlock at index ${e}`);const r=new _(this._size,this._blockDescriptors[e],this._client.isLocal);return this._blocks[e]=r,this._initialized=!1,r}_expand(){if(this._size<this._schema.capabilities.maxTextureSize){const e=this._size<<=1;g("Expanding block size to",e,this._blocks);for(const t of this._blocks)t?.expand(e);return this._initialized=!1,this._size=e,0}return m().error(new t("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}_updateReferences(e){n.collectExpressionDependencies(this._arcadeDependencies,e)}isVisible(e){return!!(this._getBlock(0).getData(e,0)&1<<o.maxHighlightReasons)}getFilterFlags(e,t){let r=0;for(let s=0;s<this._filters.length;s++){const i=!!(1<<s),n=this._filters[s];r|=(!i||null==n||n.check(e,t)?1:0)<<s}let s=0;if(this._idsToHighlight.size){const t=e.getObjectId();s=this.getHighlightFlags(t)}return r<<o.maxHighlightReasons|s}},e.getVisualVariableSizeValueRepresentationRatio=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Utils":function(){define(["exports","../../../../core/Error","../../../../core/Logger","../../../webgl/enums","../../../webgl/getDataTypeBytes","../../../webgl/VertexElementDescriptor"],function(e,t,r,s,i,n){"use strict";const o=()=>r.getLogger("esri.views.2d.engine.webgl.Utils");function a(e){let t=0;const r=e.map(e=>{const r=new n.VertexElementDescriptor(e.name,e.count,e.type,t,0,e.normalized||!1);return t+=e.count*i.getDataTypeBytes(e.type),r});return r.forEach(e=>e.stride=t),r}const l=new Map;e.charCodes=function(e){const t=[];for(let r=0;r<e.length;r++)t.push(e.charCodeAt(r));return t},e.createAttributeLayout=a,e.createProgramDescriptor=(e,t)=>{if(!l.has(e)){const r={bufferLayout:a(t),attributes:(e=>{const t=new Map;for(const r of e)t.set(r.name,r.location);return t})(t)};l.set(e,r)}return l.get(e)},e.getCIMMarkerPlacementHash=function(e){if(null==e)return"";const{type:t}=e;switch(t){case"CIMMarkerPlacementAlongLineRandomSize":return`${t}-${e.seed}-${e.randomization}`;case"CIMMarkerPlacementAlongLineVariableSize":return`${t}-${e.maxRandomOffset}-${e.numberOfSizes}-${e.seed}-${e.variationMethod}`;case"CIMMarkerPlacementAtExtremities":return`${t}-${e.extremityPlacement}-${e.offsetAlongLine}`;case"CIMMarkerPlacementAtRatioPositions":return`${t}-${e.beginPosition}-${e.endPosition}-${e.flipFirst}-${JSON.stringify(e.positionArray)}`;case"CIMMarkerPlacementAtMeasuredUnits":return`${t}-${e.interval}-${e.skipMarkerRate}-${e.placeAtExtremities}`;case"CIMMarkerPlacementInsidePolygon":return`${t}-${e.stepX}-${e.stepY}-${e.randomness}-${e.gridType}-${e.seed}-${e.shiftOddRows}`;case"CIMMarkerPlacementOnLine":return`${t}-${e.relativeTo}-${e.startPointOffset}`;case"CIMMarkerPlacementOnVertices":return`${t}-${e.placeOnControlPoints}-${e.placeOnEndPoints}-${e.placeOnRegularVertices}`;case"CIMMarkerPlacementPolygonCenter":return`${t}-${e.method}`;default:return`${t}`}},e.getPixelArrayCtor=function(e){switch(e){case s.PixelType.UNSIGNED_BYTE:return Uint8Array;case s.PixelType.UNSIGNED_SHORT_4_4_4_4:return Uint16Array;case s.PixelType.FLOAT:return Float32Array;default:return void o().error(new t("webgl-utils",`Unable to handle type ${e}`))}},e.getPixelBytes=function(e){switch(e){case s.PixelType.UNSIGNED_BYTE:return 1;case s.PixelType.UNSIGNED_SHORT_4_4_4_4:return 2;case s.PixelType.FLOAT:return 4;default:return void o().error(new t("webgl-utils",`Unable to handle type ${e}`))}},e.getStrideFromLayout=function(e){return e[0]?.stride??0},e.isSVGImage=e=>e.includes("data:image/svg+xml"),e.isValidSVG=e=>!!e&&(e=e.trim(),!!(/^[mzlhvcsqta]\s*[-+.0-9][^mlhvzcsqta]+/i.test(e)&&/[\dz]$/i.test(e)&&e.length>4)),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/getDataTypeBytes":function(){define(["exports","./enums"],function(e,t){"use strict";e.getDataTypeBytes=function(e){switch(e){case t.DataType.BYTE:case t.DataType.UNSIGNED_BYTE:return 1;case t.DataType.SHORT:case t.DataType.UNSIGNED_SHORT:case t.DataType.HALF_FLOAT:return 2;case t.DataType.FLOAT:case t.DataType.INT:case t.DataType.UNSIGNED_INT:return 4}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/util/debug":function(){define(["exports"],function(e){"use strict";e.DEBUG_ATTR_UPDATES=!1,e.createDebugLogger=(e,t)=>e&&((...e)=>t.warn("DEBUG:",...e))||(()=>null),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/DisplayIdGenerator":function(){define(["exports","../../../engine/webgl/DisplayId"],function(e,t){"use strict";class r{constructor(e){this.data=e,this._referenceCount=0}increment(){this._referenceCount+=1}decrement(){this._referenceCount-=1}empty(){return 0===this._referenceCount}}e.DisplayIdGenerator=class{constructor(){this._freeIdsGenerationA=[],this._freeIdsGenerationB=[],this._idCounter=1,this._freeIds=this._freeIdsGenerationA,this._objectIdToDisplayId=new Map}createIdForObjectId(e){let s=this._objectIdToDisplayId.get(e);return s?s.increment():(s=new r(t.createDisplayId(this._getFreeId(),!1)),s.increment(),this._objectIdToDisplayId.set(e,s)),s.data}releaseIdForObjectId(e){const t=this._objectIdToDisplayId.get(e);t&&(t.decrement(),t.empty()&&(this._objectIdToDisplayId.delete(e),this._freeIds.push(t.data)))}getDisplayIdForObjectId(e){const t=this._objectIdToDisplayId.get(e);return null!=t?t.data:null}releaseAll(){for(const e of this._objectIdToDisplayId.values())this._freeIds.push(e.data);this._objectIdToDisplayId.clear()}incrementGeneration(){this._freeIds=this._freeIds===this._freeIdsGenerationA?this._freeIdsGenerationB:this._freeIdsGenerationA}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSource":function(){define(["exports","../../../../../request","../../../../../core/has","../../../../../core/promiseUtils","../../../../../core/accessorSupport/diffUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/graphics/data/QueryEngine","../../../../../rest/query/operations/query","../../../../../rest/support/StatisticDefinition","../FeatureStoreStatistics","./FeatureSourceQueryInfo","./StreamMessenger","./strategies/DrillDownTileLoadStrategy","./strategies/PagedTileLoadStrategy","./strategies/ParquetSnapshotLoadStrategy","./strategies/ParquetTileLoadStrategy","./strategies/SnapshotLoadStrategy","./strategies/StreamLoadStrategy","./strategies/chunks/SourceChunkStore","../support/FeatureMetadata","../../support/UpdateTracking2D"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g,y,_,b,S){"use strict";e.FeatureSource=class{constructor(e,t,r,s,i){this.service=e,this._aggregateAdapter=t,this._subscriptions=r,this._connection=s,this._cachedObjectIds=i,this._updateTracking=new S.UpdateTracking2D({debugName:"FeatureSource"}),this._didInvalidateData=!1,this._metadata=b.FeatureMetadata.createFeature(e.metadata),this._store=new _.FeatureSourceChunkStore(this._metadata)}destroy(){this._strategy?.destroy(),this._store.destroy(),this._streamMessenger?.destroy(),"memory"===this.service.type&&this.service.source.map(e=>e.close())}get metadata(){if(!this._metadata)throw new Error("InternalError: Metadata not defined. Was update called?");return this._metadata}get store(){return this._store}get streamMessenger(){return null==this._streamMessenger&&this._initStreamMessenger(),this._streamMessenger}get statistics(){return c.FeatureStoreStatistics.from(this._store)}get updateTracking(){return this._updateTracking}get queryEngine(){if(!this._queryEngine){if(!this._schema)return null;const{dataFilter:e}=this._schema.mutable,t=this._schema.mutable.availableFields,r=this._metadata;this._queryEngine=new o.QueryEngine({featureStore:this._store,fieldsIndex:r.fieldsIndex,geometryType:r.geometryType,featureIdInfo:r.featureIdInfo,hasM:!1,hasZ:!1,spatialReference:this.service.outSpatialReference,aggregateAdapter:this._aggregateAdapter,timeInfo:r.timeInfo,definitionExpression:e.definitionExpression,availableFields:t})}return this._queryEngine}get isStream(){return"stream"===this._schema.type}get hasDisplayFilter(){return!!this._schema&&"displayFilterInfo"in this._schema.mutable&&null!=this._schema.mutable.displayFilterInfo}chunks(){return Array.from(this._store.chunks())}prepareCacheUpdate(e,t){const r=new Set,s=new Set;for(const t of e)this._cachedObjectIds.has(t)||(this._cachedObjectIds.add(t),r.add(t));for(const e of t)this._cachedObjectIds.delete(e),s.add(e);this.hasDisplayFilter&&this._strategy.prepareCacheUpdate(r,s)}async applyCacheUpdate(){this.hasDisplayFilter&&await this._updateTracking.addPromise(this._strategy.applyCacheUpdate())}cleanup(){return this._store.cleanup()}onSubscribe(e){if(this._connection.onEvent({type:"subscribe",tile:e.tile.id}),!this._strategy)return;const t=this._strategy.load(e);t.then(()=>this._connection.onEvent({type:"loaded",tile:e.tile.id})).catch(t=>this._connection.onEvent({type:"error",tile:e.tile.id,error:t})),this._updateTracking.addPromise(t)}onResume(e){this._updateTracking.addPromise(s.ignoreAbortErrors(this._strategy?.load(e)))}onUnsubscribe(e){this._connection.onEvent({type:"unsubscribe",tile:e.tile.id}),this._strategy?.unload(e)}applyOverride(e){this._didInvalidateData=!0,this._store.applyOverride(e)}takeOverrideUpdate(){return this._store.takeOverrideUpdate()}async update(e,t){const s=e.source,n=i.diff(this._schema?.mutable,s.mutable);if(!n)return!1;if(r("esri-2d-update-debug")&&console.debug(`Version[${t}] FeatureSource.update`,{changes:n}),this._schema=s,this._queryEngine?.destroy(),this._queryEngine=null,"feature-service"===this.service.type&&null!=this.service.queryMetadata.lastEditDate&&(this._lastEditDate=this.service.queryMetadata.lastEditDate),null==this._streamMessenger&&"stream"===this._schema.type&&this._initStreamMessenger(),i.hasRootDiffOnly(n,"sourceRefreshVersion")&&this._strategy?.refresh)return this._strategy.refresh();if(("feature"===s.type||"parquet"===s.type)&&i.hasRootDiffOnly(n,"availableFields")){if(await this._queryLastEditDateChanged()||this._didInvalidateData)this._didInvalidateData=!1,await this._updateStrategy(t);else{this._connection.onEvent({type:"updateFieldsStart"});try{await this._strategy.updateFields(s.mutable.availableFields),this._connection.onEvent({type:"updateFieldsEnd"})}catch(e){this._connection.onEvent({type:"updateFieldsError",error:e})}}return!1}return!!(i.hasRootDiff(n,"dataFilter")||i.hasRootDiff(n,"sourceRefreshVersion")||this._strategy.about.supportsDisplayFilter&&i.hasRootDiff(n,"displayFilterInfo"))&&(await this._updateStrategy(t),!0)}async addParquetFile(e){await this._strategy.addParquetFile(e)}unsafeSetQueryHistoricMoment(e){"feature"===this._schema.type&&(this._schema.mutable.dataFilter.historicMoment=e,this._strategy.unsafeSetQueryHistoricMoment(new Date(e)))}_initStreamMessenger(){null==this._streamMessenger&&(this._streamMessenger=new h.StreamMessenger(this._connection))}async normalizeOverrides(e){const t={historicMoment:e.historicMoment,commands:{updateWeak:e.commands.updateWeak.map(n.OptimizedFeature.fromJSON),removeWeak:e.commands.removeWeak,update:e.commands.update.map(n.OptimizedFeature.fromJSON),remove:e.commands.remove,release:e.commands.release}},r=e.commands.updateByIdWeak,s=await this._queryOptimizedFeatures(r);return t.commands.updateWeak.push(...s),t}async _queryOptimizedFeatures(e){if(0===e.length)return[];const t=[],r=(await this._strategy.queryByObjectId(e)).getCursor();for(;r.next();)t.push(r.readOptimizedFeatureWorldSpace());return t}getObjectIdsFromGlobalIds(e){const t=this.metadata.globalIdField;if(null==t)throw new Error("InternalError: Recieved an edit with globalIds, but not supported by the service");const r=this._store.mapObjectIdsFromGlobalIds(e,t).values();return Array.from(r)}async _queryLastEditDateChanged(){if(null==this._lastEditDate)return!1;const e=this.service.source,r={...e.query,f:"json"},s=(await t(e.path,{query:r,responseType:"json"})).data.editingInfo.lastEditDate;return s!==this._lastEditDate&&(this._lastEditDate=s,!0)}async _createStrategy(){const e="isSourceHosted"in this.service&&this.service.isSourceHosted,t=Array.isArray(this.service.source),r=this.service.source&&"collection"in this.service.source,s=e||t||r;if("stream"===this._schema.type){const e=new y.StreamLoadStrategy(this.service,this._schema.mutable.dataFilter,this._store,{outSR:this.service.outSpatialReference},this.metadata);return this._streamMessenger.strategy=e,e}if("parquet"===this._schema.type){const e=this.service;return null!=e.geometryInfo.displayOptimization?new m.ParquetTileLoadStrategy(e,this._metadata,this._schema,this._store):new f.ParquetSnapshotLoadStrategy(e,this._metadata,this._schema,this._store)}const i=this.service,n=u.FeatureSourceQueryInfo.fromSchema(i,this._schema,this._metadata),o=await this._supportSnapshotMode(i,n);return o?new g.SnapshotLoadStrategy(i,n,this._store,o,this.metadata,this._connection):s?new p.PagedTileLoadStrategy(i,n,this._store,this.metadata,this._connection):new d.DrillDownTileLoadStrategy(i,n,this._store,this.metadata,this._connection)}async _updateStrategy(e){const t=await this._createStrategy();this._connection.onEvent({type:"updateStrategyStart",about:t.about});const i=!!this._strategy;this._store.clear(),this._strategy?.destroy(),this._strategy=t,r("esri-2d-update-debug")&&console.debug(`Version[${e}] FeatureSource.updateStrategy`,{strategy:t});const n=Array.from(this._subscriptions.values());if(!n.length)return void this._connection.onEvent({type:"updateStrategyEnd"});const o=Promise.all(n.map(e=>this._strategy.load(e).then(()=>this._connection.onEvent({type:"loaded",tile:e.tile.id})).catch(t=>this._connection.onEvent({type:"error",tile:e.tile.id,error:t}))));this._updateTracking.addPromise(o),this._strategy.prepareCacheUpdate(this._cachedObjectIds);try{i&&await o}catch(e){s.throwIfNotAbortError(e)}this._connection.onEvent({type:"updateStrategyEnd"}),r("esri-2d-update-debug")&&console.debug(`Version[${e}] FeatureSource.updateStrategyEnd`,{strategy:t})}async _supportSnapshotMode(e,t){const{queryMetadata:r}=e,s=r.snapshotInfo;return s?await this._executeExceedsLimitQuery(e,t,s)?null:s:null}async _executeExceedsLimitQuery(e,t,r){if(!r.supportsExceedsLimit)return this._executeExceedsLimitFallbackQuery(e,t,r);try{const s=e.source,i=t.createQuery();i.inner.orderByFields=[],i.inner.returnGeometry=!1;const n=new l;n.statisticType="exceedslimit",n.maxPointCount=r.maxFeatureCount,n.maxRecordCount=r.maxFeatureCount,n.outStatisticFieldName="exceedslimit",r.maxVertexCount&&(n.maxVertexCount=r.maxVertexCount),i.inner.outStatistics=[n],i.inner.cacheHint=!0;const o=await a.executeQuery(s,i.inner,void 0,{query:i.customParameters}),c=o.data.features[0]?.attributes.exceedslimit;return!(0===c)}catch(e){return!0}}async _executeExceedsLimitFallbackQuery(e,t,r){if(r.maxVertexCount)return!0;const s=e.source,i=t.createQuery();i.inner.orderByFields=[],i.inner.returnGeometry=!1,i.inner.cacheHint=!0;try{return(await a.executeQueryForCount(s,i.inner,{query:i.customParameters})).data.count>r.maxFeatureCount}catch(e){return!0}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/query":function(){define(["exports","../../../request","../../../core/urlUtils","../../../geometry/support/jsonUtils","../../../geometry/support/normalizeUtils","../../../geometry/support/spatialReferenceUtils","../../operations/urlUtils","./pbfQueryUtils","./queryZScale"],function(e,t,r,s,i,n,o,a,l){"use strict";const c="Layer does not support extent calculation.";function u(e,t){if(t&&"extent"===e.type)return`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`;if(t&&"point"===e.type)return`${e.x},${e.y}`;const r=e.toJSON();return delete r.spatialReference,JSON.stringify(r)}function h(e,t,r){const i=e.geometry,o=e.toJSON();delete o.compactGeometryEnabled,delete o.defaultSpatialReferenceEnabled;const a=o;let l,c,h;if(i&&(c=i.spatialReference,h=n.srToRESTValue(c),a.geometryType=s.getJsonType(i),a.geometry=u(i,e.compactGeometryEnabled),a.inSR=h),o.groupByFieldsForStatistics&&(a.groupByFieldsForStatistics=o.groupByFieldsForStatistics.join(",")),o.objectIds)switch(r?.uniqueIdFields?.length){case void 0:a.objectIds=o.objectIds.join(",");break;case 1:a.uniqueIds=JSON.stringify(o.objectIds),delete a.objectIds;break;default:a.uniqueIds=JSON.stringify(o.objectIds.map(e=>JSON.parse(e))),delete a.objectIds}if(o.orderByFields&&(a.orderByFields=o.orderByFields.join(",")),!o.outFields||!o.returnDistinctValues&&(t?.returnCountOnly||t?.returnExtentOnly||t?.returnIdsOnly)?delete a.outFields:o.outFields.includes("*")?a.outFields="*":a.outFields=o.outFields.join(","),o.outSR?(a.outSR=n.srToRESTValue(o.outSR),l=e.outSpatialReference):i&&(o.returnGeometry||o.returnCentroid)&&(a.outSR=a.inSR,l=c),o.returnGeometry&&delete o.returnGeometry,o.outStatistics&&(a.outStatistics=JSON.stringify(o.outStatistics)),o.fullText&&(a.fullText=JSON.stringify(o.fullText)),o.pixelSize&&(a.pixelSize=JSON.stringify(o.pixelSize)),o.quantizationParameters&&(e.defaultSpatialReferenceEnabled&&null!=c&&null!=e.quantizationParameters?.extent&&c.equals(e.quantizationParameters.extent.spatialReference)&&delete o.quantizationParameters.extent.spatialReference,a.quantizationParameters=JSON.stringify(o.quantizationParameters)),o.parameterValues&&(a.parameterValues=JSON.stringify(o.parameterValues)),o.rangeValues&&(a.rangeValues=JSON.stringify(o.rangeValues)),o.dynamicDataSource&&(a.layer=JSON.stringify({source:o.dynamicDataSource}),delete o.dynamicDataSource),o.timeExtent){const e=o.timeExtent,{start:t,end:r}=e;null==t&&null==r||(a.time=t===r?t:`${t??"null"},${r??"null"}`),delete o.timeExtent}return e.defaultSpatialReferenceEnabled&&null!=c&&null!=l&&c.equals(l)&&(a.defaultSR=a.inSR,delete a.inSR,delete a.outSR),a}function d(e,t,r,s){return f(e,t,"pbf",r,void 0,s)}function p(e,t){if(!e.returnIdsOnly||!t.uniqueIdFields)return e;const r={...e,returnUniqueIdsOnly:!0};return delete r.returnIdsOnly,r}async function f(e,s,n,a={},l={},c={}){const u="string"==typeof e?r.urlToObject(e):e,d=s.geometry?[s.geometry]:[],f=await i.normalizeCentralMeridian(d,null,{signal:a.signal}),m=f?.[0];null!=m&&((s=s.clone()).geometry=m);const g=o.mapParameters({...u.query,f:n,...p(l,c),...h(s,l,c)});return t(r.join(u.path,function(e,t){return null!=e.formatOf3DObjects&&!(t.returnCountOnly||t.returnExtentOnly||t.returnIdsOnly)}(s,l)?"query3d":"query"),{...a,responseType:"pbf"===n?"array-buffer":"json",query:{...g,...a.query}})}e.encodeGeometry=u,e.executeQuery=async function(e,t,r,s,i){const n=t.timeExtent?.isEmpty?{data:{features:[]}}:await f(e,t,"json",s,void 0,i);return l.applyFeatureSetZUnitScaling(t,r,n.data),n},e.executeQueryForCount=function(e,t,r,s){return t.timeExtent?.isEmpty?Promise.resolve({data:{count:0}}):f(e,t,"json",r,{returnIdsOnly:!0,returnCountOnly:!0},s)},e.executeQueryForExtent=async function(e,t,r){if(t.timeExtent?.isEmpty)return{data:{count:0,extent:null}};const s=await f(e,t,"json",r,{returnExtentOnly:!0,returnCountOnly:!0}),i=s.data;if(i.hasOwnProperty("extent"))return s;if(i.features)throw new Error(c);if(i.hasOwnProperty("count"))throw new Error(c);return s},e.executeQueryForIds=function(e,t,r,s){return t.timeExtent?.isEmpty?Promise.resolve({data:{objectIds:[]}}):f(e,t,"json",r,{returnIdsOnly:!0},s)},e.executeQueryPBF=async function(e,t,r,s,i){if(t.timeExtent?.isEmpty)return{data:r.createFeatureResult()};const n=await d(e,t,s,i),o=n;return o.data=a.parsePBFFeatureQuery(n.data,r),o},e.executeQueryPBFBuffer=d,e.queryToQueryStringParameters=h,e.runQuery=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/urlUtils":function(){define(["exports"],function(e){"use strict";e.mapParameters=function e(t){const r={};for(const s in t){if("declaredClass"===s)continue;const i=t[s];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){r[s]=[];for(let t=0;t<i.length;t++)r[s][t]=e(i[t])}else"object"==typeof i?i.toJSON&&(r[s]=JSON.stringify(i)):r[s]=i}return r},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfQueryUtils":function(){define(["exports","./pbfFeatureServiceParser"],function(e,t){"use strict";e.parsePBFFeatureQuery=function(e,r){const s=t.parseFeatureQuery(e,r),i=s.queryResult.featureResult,n=s.queryResult.queryGeometry,o=s.queryResult.queryGeometryType;if(i&&i.features&&i.features.length&&i.objectIdFieldName){const e=i.objectIdFieldName;for(const t of i.features)t.attributes&&(t.objectId=t.attributes[e])}return i&&(i.queryGeometry=n,i.queryGeometryType=o),i},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfFeatureServiceParser":function(){define(["exports","../../../core/Error","../../../core/pbf","../../../layers/graphics/OptimizedGeometry","./pbfOptimizedFeatureSet"],function(e,t,r,s,i){"use strict";const n=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeBigInteger","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],o=["sqlTypeBigInt","sqlTypeBinary","sqlTypeBit","sqlTypeChar","sqlTypeDate","sqlTypeDecimal","sqlTypeDouble","sqlTypeFloat","sqlTypeGeometry","sqlTypeGUID","sqlTypeInteger","sqlTypeLongNVarchar","sqlTypeLongVarbinary","sqlTypeLongVarchar","sqlTypeNChar","sqlTypeNVarchar","sqlTypeOther","sqlTypeReal","sqlTypeSmallInt","sqlTypeSqlXml","sqlTypeTime","sqlTypeTimestamp","sqlTypeTimestamp2","sqlTypeTinyInt","sqlTypeVarbinary","sqlTypeVarchar"],a=["upperLeft","lowerLeft"];function l(e){return e>=n.length?null:n[e]}function c(e){return e>=o.length?null:o[e]}function u(e){return e>=a.length?null:a[e]}function h(e,t){return t>=e.geometryTypes.length?null:e.geometryTypes[t]}function d(e,t,r){const s=e.asUnsafe(),i=t.createPointGeometry(r);for(;s.next();)switch(s.tag()){case 3:{const e=s.getUInt32(),r=s.pos()+e;let n=0;for(;s.pos()<r;)t.addCoordinatePoint(i,s.getSInt64(),n++);break}default:s.skip()}return i}function p(e,t,r){const s=e.asUnsafe(),i=t.createGeometry(r),n=2+(r.hasZ?1:0)+(r.hasM?1:0);for(;s.next();)switch(s.tag()){case 2:{const e=s.getUInt32(),r=s.pos()+e;let n=0;for(;s.pos()<r;)t.addLength(i,s.getUInt32(),n++);break}case 3:{const e=s.getUInt32(),r=s.pos()+e;let o=0;for(t.allocateCoordinates(i);s.pos()<r;)t.addCoordinate(i,s.getSInt64(),o),o++,o===n&&(o=0);break}default:s.skip()}return i}function f(e){const t=e.asUnsafe(),r=new s;let n="esriGeometryPoint";for(;t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),s=t.pos()+e;for(;t.pos()<s;)r.lengths.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),s=t.pos()+e;for(;t.pos()<s;)r.coords.push(t.getSInt64());break}case 1:n=i.optimizedGeometryTypes[t.getEnum()];break;default:t.skip()}return{queryGeometry:r,queryGeometryType:n}}function m(e){const t=e.asUnsafe();for(;t.next();)switch(t.tag()){case 1:return t.getString();case 2:return t.getFloat();case 3:return t.getDouble();case 4:return t.getSInt32();case 5:return t.getUInt32();case 6:return t.getInt64();case 7:return t.getUInt64();case 8:return t.getSInt64();case 9:return t.getBool();default:return t.skip(),null}return null}function g(e){const t=e.asUnsafe(),r={type:l(0)};for(;t.next();)switch(t.tag()){case 1:r.name=t.getString();break;case 2:r.type=l(t.getEnum());break;case 3:r.alias=t.getString();break;case 4:r.sqlType=c(t.getEnum());break;case 5:default:t.skip();break;case 6:r.defaultValue=t.getString()}return r}function y(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.name=r.getString();break;case 2:t.isSystemMaintained=r.getBool();break;default:r.skip()}return t}function _(e,t,r,s){const i=t.createFeature(r);let n=0;for(;e.next();)switch(e.tag()){case 1:{const t=s[n++].name;i.attributes[t]=e.processMessage(m);break}case 2:i.geometry=e.processMessageWithArgs(p,t,r);break;case 4:i.centroid=e.processMessageWithArgs(d,t,r);break;default:e.skip()}return i}function b(e){const t=[1,1,1,1],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function S(e){const t=[0,0,0,0],r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t[0]=r.getDouble();break;case 2:t[1]=r.getDouble();break;case 4:t[2]=r.getDouble();break;case 3:t[3]=r.getDouble();break;default:r.skip()}return t}function x(e){const t={originPosition:u(0)},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.originPosition=u(r.getEnum());break;case 2:t.scale=r.processMessage(b);break;case 3:t.translate=r.processMessage(S);break;default:r.skip()}return t}function w(e){const t={},r=e.asUnsafe();for(;r.next();)switch(r.tag()){case 1:t.shapeAreaFieldName=r.getString();break;case 2:t.shapeLengthFieldName=r.getString();break;case 3:t.units=r.getString();break;default:r.skip()}return t}function v(e,t){const r=t.createSpatialReference();for(;e.next();)switch(e.tag()){case 1:r.wkid=e.getUInt32();break;case 5:r.wkt=e.getString();break;case 2:r.latestWkid=e.getUInt32();break;case 3:r.vcsWkid=e.getUInt32();break;case 4:r.latestVcsWkid=e.getUInt32();break;default:e.skip()}return r}function M(e,t){const r=t.createFeatureResult(),s=e.asUnsafe();r.geometryType=h(t,0);let i=!1;for(;s.next();)switch(s.tag()){case 1:r.objectIdFieldName=s.getString();break;case 3:r.globalIdFieldName=s.getString();break;case 4:r.geohashFieldName=s.getString();break;case 5:r.geometryProperties=s.processMessage(w);break;case 7:r.geometryType=h(t,s.getEnum());break;case 8:r.spatialReference=s.processMessageWithArgs(v,t);break;case 10:r.hasZ=s.getBool();break;case 11:r.hasM=s.getBool();break;case 12:r.transform=s.processMessage(x);break;case 9:r.exceededTransferLimit=s.getBool();break;case 13:t.addField(r,s.processMessage(g));break;case 15:i||(t.prepareFeatures(r),i=!0),t.addFeature(r,s.processMessageWithArgs(_,t,r,r.fields));break;case 2:r.uniqueIdField=s.processMessage(y);break;default:s.skip()}return t.finishFeatureResult(r),r}function I(e,t){const r={};let s=null;for(;e.next();)switch(e.tag()){case 4:s=e.processMessageWithArgs(f);break;case 1:r.featureResult=e.processMessageWithArgs(M,t);break;default:e.skip()}return null!=s&&r.featureResult&&t.addQueryGeometry(r,s),r}e.parseFeatureQuery=function(e,s){try{const t=2,i=new r(new Uint8Array(e),new DataView(e)),n={};for(;i.next();)i.tag()===t?n.queryResult=i.processMessageWithArgs(I,s):i.skip();return n}catch(e){throw new t("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e})}},e.parseField=g,e.parseFieldType=l,e.parseTransform=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/pbfOptimizedFeatureSet":function(){define(["exports","../../../core/unitUtils","../../../geometry/support/spatialReferenceUtils","../../../layers/graphics/OptimizedFeature","../../../layers/graphics/OptimizedFeatureSet","../../../layers/graphics/OptimizedGeometry"],function(e,t,r,s,i,n){"use strict";const o=["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline","esriGeometryPolygon"];e.OptimizedFeatureSetParserContext=class{constructor(e){this._options=e,this.geometryTypes=o,this._coordinatePtr=0,this._vertexDimension=0}createFeatureResult(){return new i}prepareFeatures(e){this._vertexDimension=2,e.hasZ&&this._vertexDimension++,e.hasM&&this._vertexDimension++}finishFeatureResult(e){if(!e?.features||!e.hasZ||!this._options.sourceSpatialReference||!e.spatialReference||r.equals(e.spatialReference,this._options.sourceSpatialReference)||e.spatialReference.vcsWkid)return;const i=t.getMetersPerVerticalUnitForSR(this._options.sourceSpatialReference)/t.getMetersPerVerticalUnitForSR(e.spatialReference);if(1!==i)for(const t of e.features){if(!s.hasGeometry(t))continue;const e=t.geometry.coords;for(let t=2;t<e.length;t+=3)e[t]*=i}}addFeature(e,t){e.features.push(t)}createFeature(){return new s.OptimizedFeature(null,{},null,0)}createSpatialReference(){return{wkid:0}}createGeometry(){return new n}addField(e,t){e.fields.push(t)}allocateCoordinates(e){e.coords.length=e.lengths.reduce((e,t)=>e+t,0)*this._vertexDimension,this._coordinatePtr=0}addCoordinate(e,t){e.coords[this._coordinatePtr++]=t}addCoordinatePoint(e,t){e.coords.push(t)}addLength(e,t){e.lengths.push(t)}addQueryGeometry(e,t){e.queryGeometry=t.queryGeometry,e.queryGeometryType=t.queryGeometryType}createPointGeometry(){return new n}},e.optimizedGeometryTypes=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/query/operations/queryZScale":function(){define(["exports","../../../geometry/support/zscale"],function(e,t){"use strict";e.applyFeatureSetZUnitScaling=function(e,r,s){if(!s?.features||!s.hasZ)return;const i=t.getGeometryZScaler(s.geometryType,r,e.outSpatialReference);if(null!=i)for(const e of s.features)i(e.geometry)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureStoreStatistics":function(){define(["exports"],function(e){"use strict";class t{static from(e){let r=0,s=0,i=0;return e.forEach(e=>{const t=e._readGeometry();t&&(s+=t.isPoint?1:t.lengths.reduce((e,t)=>e+t,0),i+=t.isPoint?1:t.lengths.length,r+=1)}),new t(r,s,i)}constructor(e,t,r){this.featureCount=e,this.vertexCount=t,this.ringCount=r}toJSON(){return{featureCount:this.featureCount,ringCount:this.featureCount,vertexCount:this.featureCount}}}e.FeatureStoreStatistics=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureSourceQueryInfo":function(){define(["exports","../../../../../core/has","../../../../../core/sql","../../../../../geometry/SpatialReference","../../../../../layers/support/arcgisLayerUrl","../../../../../layers/support/displayFilterUtils","../../../../../rest/support/Query","../../../../../chunks/TimeExtent"],function(e,t,r,s,i,n,o,a){"use strict";class l{static fromSchema(e,t,r){const n="feature"===t.type?t.mutable.dataFilter.queryScaleRanges:[],o=t.mutable.displayFilterInfo;return new l(function(e,t,r){const n=function(e){switch(e.type){case"object-id":case"unique-id-simple":return`${e.fieldName} ASC`;case"unique-id-composite":return`${e.fieldNames.join(",")} ASC`}}(r.featureIdInfo),o=e.source,l={returnCentroid:!(null!==o&&"object"==typeof o&&"path"in o&&i.isHostedAgolService(o.path))&&"esriGeometryPolygon"===r.serviceGeometryType,returnGeometry:!0,timeReferenceUnknownClient:r.timeReferenceUnknownClient??void 0,outSpatialReference:s.fromJSON(e.outSpatialReference),orderByFields:"memory"===e.type?[]:[n],where:t.mutable.dataFilter.definitionExpression??"1=1",outFields:t.mutable.availableFields,multipatchOption:"esriGeometryMultiPatch"===r.serviceGeometryType?"xyFootprint":null};if("feature"===t.type){const{gdbVersion:e,historicMoment:r,timeExtent:s}=t.mutable.dataFilter;return{...l,gdbVersion:e,historicMoment:r?new Date(r):null,timeExtent:s?a.TimeExtent.fromJSON(s):null,outFields:t.mutable.availableFields}}return l}(e,t,r),o,n,r.subtypeField,t.mutable.dataFilter.customParameters,r.geometryType,e.queryMetadata)}constructor(e,t,r,s,i,n,o){this._queryParams=e,this._displayFilter=t,this._queryScaleRanges=r,this._subtypeField=s,this._customParameters=i,this._geometryType=n,this._queryMetadata=o}get pageSize(){if(null==this._queryMetadata)throw new Error("InternalError: Service does not support paged queries");const e=this._queryMetadata.supportsMaxRecordCountFactor?4:null,t=(this._queryMetadata.maxRecordCount??8e3)*(e??1);return Math.min(8e3,t)}get objectIdsQueryPageSize(){return this._queryMetadata?.maxRecordCount??2e3}updateHistoricMoment(e){this._queryParams.historicMoment=e}updateFields(e){this._queryParams.outFields=e}createPatchFieldsQuery(e,r,s){if(!r.getSize())return null;const i=e.clone();if("*"===this._queryParams.outFields[0]){if("*"===(i.outFields??[])[0])return null;i.outFields=this._queryParams.outFields}else{const e=new Set(this._queryParams.outFields),t=[];for(const s of e)r.hasField(s)||t.push(s);if(0===t.length)return null;i.outFields=t}i.returnGeometry=!1,i.returnCentroid=!1,i.quantizationParameters=null,i.cacheHint=!0;const n={inner:i,customParameters:this._customParameters};if(t("esri-tiles-debug")&&null!=s){const e=s.chunkId.toString().replaceAll("/",".");n.customParameters=n.customParameters?{...n.customParameters,chunkId:e}:{chunkId:e}}return n}createQuery(e={}){if(!this._queryParams)throw new Error("InternalError: queryInfo should be defined");return{inner:new o({...this._queryParams,...e}),customParameters:this._customParameters}}createTileQuery(e,s){if(null==this._queryMetadata)throw new Error("InternalError: Service does not support tile queries");const i=this.createQuery(s),o=i.inner;if(this._queryScaleRanges.length){const t=this._queryScaleRanges.filter(t=>(!t.minScale||t.minScale>=e.maxScale)&&(!t.maxScale||t.maxScale<=e.minScale)).map(e=>e.subtypeCode);if(t.length){const e=`${this._subtypeField} IN (${t})`;o.where=r.sqlAnd(o.where,e)}}if(this._displayFilter&&(o.where=r.sqlAnd(o.where,n.getClauseForScaleRange(this._displayFilter,e.minScale,e.maxScale))),o.quantizationParameters=s.quantizationParameters??e.getQuantizationParameters(),o.resultType="tile",o.geometry=e.extent,this._queryMetadata.supportsQuantization?"esriGeometryPolyline"===this._geometryType&&(o.maxAllowableOffset=e.resolution*t("feature-polyline-generalization-factor")):"esriGeometryPolyline"!==this._geometryType&&"esriGeometryPolygon"!==this._geometryType||(o.maxAllowableOffset=e.resolution,"esriGeometryPolyline"===this._geometryType&&(o.maxAllowableOffset*=t("feature-polyline-generalization-factor"))),o.defaultSpatialReferenceEnabled=this._queryMetadata.supportsDefaultSpatialReference,o.compactGeometryEnabled=this._queryMetadata.supportsCompactGeometry,this._queryMetadata.supportsMaxRecordCountFactor&&(o.maxRecordCountFactor=4),t("esri-tiles-debug")){const t=e.id.replaceAll("/",".");i.customParameters=i.customParameters?{...i.customParameters,tileId:t}:{tileId:t}}return i}createPagedTileQuery(e,t){const r=this.pageSize;return this.createTileQuery(e,{start:r*t,num:r,returnExceededLimitFeatures:!0})}createPagedQuery(e,t){const r=this.pageSize;return this.createQuery({start:r*e,num:r,returnExceededLimitFeatures:!0,maxRecordCountFactor:4,quantizationParameters:t,cacheHint:!0})}createObjectIdsQuery(e){return this.createQuery({objectIds:e,outFields:["*"]})}}e.FeatureSourceQueryInfo=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/displayFilterUtils":function(){define(["exports","../../core/mathUtils","../../core/sql"],function(e,t,r){"use strict";function*s(e,t,r){if("manual"===n(e)){const t=e.filters.find(t=>t.id===e.activeFilterId);t&&(yield t)}else{"object"==typeof t&&(t=t.scale);for(const s of e.filters)i(s.minScale,s.maxScale,t,r)&&(yield s)}}function i(e,r,s,i){return e=o(e),s=o(s),r=a(r),!(!t.floatEqualAbsolute(s,e)&&(i??s)>e||t.floatGreaterThanOrEqual(r,s)||void 0!==i&&t.floatEqualAbsolute(i,e))}function n(e){return"mode"in e?e.mode:e.filterMode}function o(e){return e||Number.POSITIVE_INFINITY}function a(e){return e||0}e.createDisplayFilterJSONContext=function(e,t){return{...t,filterMode:e.mode}},e.getClauseForScaleRange=function(e,i,l){const c=function(e){if("manual"===n(e))return null;const t=[Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY];for(const{minScale:r,maxScale:s}of e.filters)t[0]=Math.max(t[0],o(r)),t[1]=Math.min(t[1],a(s));return t}(e);if(c&&(t.floatGreaterThan(i,c[0])||t.floatLessThan(l,c[1])))return"";const u=Array.from(s(e,i,l)),h=function(e,r,s){if(0===e.length)return!0;const i=o(e.at(0)?.minScale),n=a(e.at(-1)?.maxScale);if(t.floatLessThan(i,r)||t.floatGreaterThan(n,s))return!0;for(let r=0;r<e.length-1;r++){const s=e[r],i=e[r+1];if(t.floatLessThan(o(i.minScale),a(s.maxScale)))return!0}return!1}(u,i,l)?"1=1":u.map(e=>e.where||"1=1").reduce((e,t)=>r.sqlOr(e,t),"");return h&&"1=1"!==h?h:""},e.getEffectiveDisplayFilter=function(e,t){return s(e,t).next().value??null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamMessenger":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/reactiveUtils","../../../../../core/accessorSupport/decorators/property","../../../../../core/has","../../../../../core/Logger","../../../../../core/RandomLCG","../../../../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a,l){"use strict";e.StreamMessenger=class extends r{constructor(e){super(),this._connection=e,this._enabledEventTypes=new Set,this._updateInfo={websocket:0,client:0},this._lastTime=performance.now(),this._queuedCommands=[],this.addHandles([s.watch(()=>this._strategy?.connectionStatus??"disconnected",e=>{this._layerView.setProperty({propertyName:"pipelineConnectionStatus",value:e})},{initial:!0}),s.watch(()=>this._strategy?.errorString||null,e=>this._layerView.setProperty({propertyName:"pipelineErrorString",value:e}),{initial:!0})])}destroy(){this._strategy=null,this.removeAllHandles()}get _layerView(){return this._connection.layerView}set strategy(e){null==this._strategy&&this._resetUpdateInfo(performance.now());const t="event-handles";this.removeHandles(t),null!=e&&(this.addHandles([e.events.on("data-received",e=>this._onFeature(e)),e.events.on("message-received",e=>this._onWebSocketMessage(e)),e.events.on("features-updated",e=>this._onUpdate(e)),e.events.on("tick",()=>this._onTick())],t),this._queuedCommands.forEach(t=>t(e)),this._queuedCommands=[]),this._strategy=e}updateCustomParameters(e){null!=e&&this._callOrEnqueue(t=>t.updateCustomParameters(e))}sendMessageToSocket(e){this._callOrEnqueue(t=>t.sendMessageToSocket(e))}sendMessageToClient(e){this._callOrEnqueue(t=>t.sendMessageToClient(e))}enableEvent(e,t){t?this._enabledEventTypes.add(e):this._enabledEventTypes.delete(e)}disconnect(){this._strategy?.disconnect()}connect(){this._strategy?.connect()}clear(){this._strategy?.clear()}_onWebSocketMessage(e){this._enabledEventTypes.has("message-received")&&this._layerView.emitEvent({name:"message-received",event:e})}_onFeature(e){this._updateInfo.websocket++,this._enabledEventTypes.has("data-received")&&this._layerView.emitEvent({name:"data-received",event:{attributes:e.attributes,centroid:e.centroid,geometry:e.geometry}})}_onUpdate(e){this._updateInfo.client+=e}_onTick(){const e=performance.now(),t=e-this._lastTime;if(t>2500){const r=Math.round(this._updateInfo.client/(t/1e3)),s=Math.round(this._updateInfo.websocket/(t/1e3));this._resetUpdateInfo(e),this._layerView.emitEvent({name:"update-rate",event:{client:r,websocket:s}})}}_resetUpdateInfo(e){this._lastTime=e,this._updateInfo.client=0,this._updateInfo.websocket=0}_callOrEnqueue(e){null!=this._strategy?e(this._strategy):this._queuedCommands.push(e)}},t.__decorate([i.property()],e.StreamMessenger.prototype,"_strategy",void 0),e.StreamMessenger=t.__decorate([l.subclass("esri.views.2d.layers.features.sources.StreamMessenger")],e.StreamMessenger),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/DrillDownTileLoadStrategy":function(){define(["exports","../../../../../../core/handleUtils","../../../../../../core/has","../../../../../../core/promiseUtils","./ATileLoadStrategy","./chunks/DrillDownTileSourceChunk","../../support/FeatureSetReaderJSON"],function(e,t,r,s,i,n,o){"use strict";class a{constructor(e,r){this.subscription=e,this._tileIdToResult=new Map,this._controller=new AbortController,this._handles=t.handlesGroup([s.onAbort(e.signal,()=>this._controller.abort()),s.onAbort(r,()=>this._controller.abort())])}destroy(){this._controller.abort(),this._handles.remove()}get(e){return this._tileIdToResult.get(e)}set(e,t){this._tileIdToResult.set(e,t)}get options(){return{signal:this._controller.signal}}}class l extends i.ATileLoadStrategy{constructor(){super(...arguments),this._loadStates=new Map}destroy(){super.destroy();for(const e of this._loadStates.values())e.destroy();this._loadStates.clear()}get about(){return{supportsDisplayFilter:!0,willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(e){this._loadStates.has(e.key.id)||this._loadStates.set(e.key.id,new a(e,this._options));const t=this._loadStates.get(e.key.id);let r;try{for await(const r of this._fetchChunkInfos(t,e.tile,0)){const{queryJSON:e,reader:i,sourceTile:o,sourceTileDepth:a,tile:l}=r,c=new n.DrillDownTileSourceChunk(i,e,l,o,a,!1);s.throwIfAborted(t.options),this._addChunk(c)}}catch(e){r=e}const i=new n.DrillDownTileSourceChunk(o.FeatureSetReaderJSON.empty(this._metadata),null,e.tile,null,-1,!0);if(this._addChunk(i),r)throw r}unload(e){super.unload(e),this._loadStates.get(e.key.id)?.destroy(),this._loadStates.delete(e.key.id)}async*_fetchChunkInfos(e,t,s){let i=e.get(t.id);const n=!!i;if(i||(i=await this._fetchChunkInfo(e,t,s),e.set(t.id,i)),i.reader.exceededTransferLimit&&s<r("featurelayer-query-max-depth"))for(const r of t.createChildTiles())yield*this._fetchChunkInfos(e,r,s+1);else n||(yield i)}async _fetchChunkInfo(e,t,r){const s=e.subscription.tile.getQuantizationParameters(),i=this._queryInfo.createTileQuery(t,{returnExceededLimitFeatures:!1,quantizationParameters:s});return{reader:await this._fetch(i,e.options,{chunkId:t.id}),queryJSON:i.inner.toJSON(),tile:e.subscription.tile,sourceTile:t,sourceTileDepth:r}}}e.DrillDownTileLoadStrategy=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ATileLoadStrategy":function(){define(["exports","../../../../../../core/has","../FeatureCache","./AFetchLoadStrategy"],function(e,t,r,s){"use strict";class i extends s.AFetchLoadStrategy{constructor(e,t,s,i,n){super(e,t,s,i,n),this._chunksById=new Map,this._featureCache=new r.FeatureCache(s,t,this._options,this._fetch.bind(this))}prepareCacheUpdate(e,t){return this._featureCache.prepareCacheUpdate(e,t)}applyCacheUpdate(){return this._featureCache.applyCacheUpdate()}unload(e){this._removeChunks(e.tile)}_addChunk(e){const r=e.tile.id;this._chunksById.has(r)||this._chunksById.set(r,[]);const s=e.size();(s||e.first||e.end)&&(t("esri-2d-update-debug")&&console.debug(`Chunk[${e.chunkId}] ATileLoadStrategy.addChunk [count=${s}]`),this._chunksById.get(r).push(e),this._store.insert(e))}_removeChunks(e){const r=this._chunksById.get(e.key.id)??[];for(const s of r)t("esri-2d-update-debug")&&console.debug(`Tile[${e.key.id}] Chunk[${s.chunkId}] ATileLoadStrategy.removeChunk`),this._store.remove(s);this._chunksById.delete(e.key.id)}}e.ATileLoadStrategy=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureCache":function(){define(["exports","../../../../../core/Error","../../../../../core/has","../../../../../core/Logger","../../../../../core/promiseUtils","../../../../../core/uuid","./strategies/support/snapshotUtils"],function(e,t,r,s,i,n,o){"use strict";e.FeatureCache=class{constructor(e,r,a,l){this.store=e,this.queryInfo=r,this._options=a,this._fetch=l,this._nextBatch=new Set,this._fetchFeatures=i.debounce(async()=>{if(0===this._nextBatch.size||this._options.signal?.aborted)return;const e=Array.from(this._nextBatch);this._nextBatch.clear(),e.length>8e3&&s.getLogger("esri.views.2d.layers.FeatureLayerView2D").warn(new t("highlight-too-many-features","highlight is limited to 8000 features on large layers configured with a display filter to avoid performance issues"));const r=this.queryInfo.objectIdsQueryPageSize,i=Math.ceil(8e3/r),a=Math.min(i,Math.ceil(e.length/r)),l=Array.from({length:a},(t,s)=>{const i=s*r,n=Math.min(i+r,e.length);return{num:s,query:this.queryInfo.createObjectIdsQuery(e.slice(i,n))}});try{await o.fetchPages({chunkPrefix:"cache."+n.generateUUID(),fetch:this._fetch},this.store,l,this._options)}catch(e){}})}prepareCacheUpdate(e,t){if(t)for(const e of t)this._nextBatch.delete(e);for(const t of e)this._nextBatch.add(t)}applyCacheUpdate(){return 0===this._nextBatch.size||this._options.signal?.aborted?null:this._fetchFeatures().catch(()=>{})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/uuid":function(){define(["exports"],function(e){"use strict";const t="randomUUID"in crypto;function r(){if(t)return crypto.randomUUID();const e=crypto.getRandomValues(new Uint16Array(8));e[3]=4095&e[3]|16384,e[4]=16383&e[4]|32768;const r=t=>e[t].toString(16).padStart(4,"0");return r(0)+r(1)+"-"+r(2)+"-"+r(3)+"-"+r(4)+"-"+r(5)+r(6)+r(7)}e.generateBracedUUID=function(){return`{${r().toUpperCase()}}`},e.generateLowercaseBracedUUID=function(){return`{${r()}}`},e.generateUUID=r,e.normalizeGlobalID=function(e){const t=e.toUpperCase();return e.startsWith("{")?t:`{${t}}`},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/support/snapshotUtils":function(){define(["exports","../../../../../../../core/Error","../../../../../../../core/promiseUtils","../chunks/FeatureSnapshotSourceChunk"],function(e,t,r,s){"use strict";e.fetchPages=async function(e,i,n,o={}){const a=(await Promise.allSettled(n.map(t=>async function(e,t,i,n={}){const o=`${e.chunkPrefix??""}${i.num}`,a=await e.fetch(i.query,n,{chunkId:o}),l=new s.FeatureSnapshotSourceChunk(a,i.query.inner.toJSON(),i.num,!1);l.chunkId=l.normalizedChunkId=o,r.throwIfAborted(n),t.insert(l)}(e,i,t,o)))).filter(e=>"rejected"===e.status).map(e=>e.reason);if(a.length)throw new t("featurelayer-query","Encountered errors when downloading data",{errors:a})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/FeatureSnapshotSourceChunk":function(){define(["exports","./ASourceChunk"],function(e,t){"use strict";class r extends t.ASourceChunk{constructor(e,t,r,s){super(),this._reader=e,this._queryJSON=t,this._page=r,this._end=s,this.chunkId=`${this._page}${this.end?"e":""}`,this.normalizedChunkId=this.chunkId}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get queryInfo(){return{type:"snapshot",chunkId:this.chunkId,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get isTiled(){return!1}getTileReader(e){const t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}e.FeatureSnapshotSourceChunk=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/AFetchLoadStrategy":function(){define(["exports","../../../../../../core/Error","../../../../../../core/Logger","../../../../../../core/QueueProcessor","../../../../../../rest/support/Query","./ALoadStrategy","./support/queryAdapters","../../support/FeatureSetReaderJSON"],function(e,t,r,s,i,n,o,a){"use strict";class l extends n.ALoadStrategy{constructor(e,t,r,i,n){super(r),this._serviceInfo=e,this._queryInfo=t,this._metadata=i,this._connection=n,this._queue=new s.QueueProcessor({concurrency:32,process:async e=>{const t={signal:e.options?.signal,query:e.query.customParameters,useRequestQueue:!0};return this._adapter.executeQuery(e.query.inner,t)}}),this._adapter=o.createQueryAdapter(e,i)}unsafeSetQueryHistoricMoment(e){this._queryInfo.updateHistoricMoment(e)}async updateFields(e){this._queryInfo.updateFields(e);const r=Array.from(this._store.chunks()).map(async e=>{const t=i.fromJSON(e.queryInfo.queryJSON);if(t)try{return await this._tryUpdateFields(e.reader,t,{chunkId:e.chunkId}),null}catch(e){return e}}),s=(await Promise.all(r)).filter(e=>e);if(s.length)throw new t("featurelayer-query","Encountered errors when downloading fields",{errors:s})}async queryByObjectId(e){if(0===e.length)return a.FeatureSetReaderJSON.empty(this._metadata);const t=this._queryInfo.createQuery({objectIds:e});return this._fetch(t,null,null)}async _fetch(e,t,r){const s=await this._enqueue(e,t);return await this._tryUpdateFields(s,e.inner,r),s}async _tryUpdateFields(e,s,i){const n=this._queryInfo.createPatchFieldsQuery(s,e,i);if(!n)return;const o=await this._enqueue(n,this._options);o.getSize()===e.getSize()?e.joinAttributes(o):r.getLogger("esri.views.2d.layers.features.sources.strategies.AFetchLoadStrategy").error(new t("featurelayer-query",`Failed to join features. Expected a count of ${e.getSize()} features, but got ${o.getSize()}`,{query:n.inner.toJSON(),debugInfo:i}))}async _enqueue(e,t){return this._connection.onEvent({type:"fetchStart"}),this._queue.push({query:e,options:t}).finally(()=>{this._connection.onEvent({type:"fetchEnd",done:0===this._queue.length})})}}e.AFetchLoadStrategy=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ALoadStrategy":function(){define(["exports"],function(e){"use strict";e.ALoadStrategy=class{constructor(e){this._store=e,this._controller=new AbortController}destroy(){this._controller.abort()}get _options(){return{signal:this._controller.signal}}get _signal(){return this._controller.signal}unsafeSetQueryHistoricMoment(e){throw new Error("InternalError: LoadStrategy does not support query info")}async queryByObjectId(e){throw new Error("InternalError: LoadStrategy does not support fetching")}async addParquetFile(e){throw new Error("InternalError: LoadStrategy does not support loading blobs")}prepareCacheUpdate(e,t){}applyCacheUpdate(){return null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/support/queryAdapters":function(){define(["exports","../../../../../../../core/has","../../../../../../../core/workers/Connection","../../../../../../../geometry/support/quantizationUtils","../../../../../../../layers/graphics/featureConversionUtils","../../../../../../../layers/ogc/ogcFeatureUtils","../../../../../../../rest/query/operations/query","../../../support/FeatureSetReaderJSON","../../../support/FeatureSetReaderPBF"],function(e,t,r,s,i,n,o,a,l){"use strict";class c{constructor(e,t){this.service=e,this._metadata=t}destroy(){}}class u extends c{constructor(e,t){super(e,t),this._portsOpen=async function(e){const t=new r;return await t.open(e,{}),t}(e.source).then(e=>this.client=e)}destroy(){this.client.close(),this.client=null}async executeQuery(e,t){await this._portsOpen;const r=await this.client.invoke("queryFeatures",e.toJSON(),t);return a.FeatureSetReaderJSON.fromFeatureSet(r,this._metadata)}}class h extends c{async executeQuery(e,t){const{data:r}=await o.executeQueryPBFBuffer(this.service.source,e,t),s=!e.quantizationParameters;return l.FeatureSetReaderPBF.fromBuffer(r,this._metadata,s)}}class d extends c{async executeQuery(e,t){const{source:r,queryMetadata:n}=this.service;if(null!=e.quantizationParameters&&!n.supportsQuantization){const n=e.clone(),l=s.toQuantizationTransform(n.quantizationParameters);n.quantizationParameters=null;const{data:c}=await o.executeQuery(r,n,this._metadata.spatialReference,t),u=i.convertFromFeatureSet(c,this._metadata.featureIdInfo);return i.quantizeOptimizedFeatureSet(l,u),a.FeatureSetReaderJSON.fromOptimizedFeatureSet(u,this._metadata)}const{data:l}=await o.executeQuery(r,e,this._metadata.spatialReference,t);return"esriGeometryPoint"===this._metadata.geometryType&&(l.features=l.features?.filter(e=>{if(null!=e.geometry){const t=e.geometry;return Number.isFinite(t.x)&&Number.isFinite(t.y)}return!0})),a.FeatureSetReaderJSON.fromFeatureSet(l,this._metadata)}}class p extends c{async executeQuery(e,t){if(e.quantizationParameters&&!this.service.queryMetadata.supportsQuantization){const r=e.clone(),o=s.toQuantizationTransform(r.quantizationParameters);r.quantizationParameters=null;const l=await n.queryOptimizedFeatureSet(this.service.source,e,t);return i.quantizeOptimizedFeatureSet(o,l),a.FeatureSetReaderJSON.fromOptimizedFeatureSet(l,this._metadata)}const r=await n.queryOptimizedFeatureSet(this.service.source,e,t);return a.FeatureSetReaderJSON.fromOptimizedFeatureSet(r,this._metadata)}}e.SourceAdapter=c,e.createQueryAdapter=function(e,r){switch(e.type){case"memory":return new u(e,r);case"ogc":return new p(e,r);case"feature-service":return e.queryMetadata.supportsFormatPBF&&t("featurelayer-pbf")?new h(e,r):new d(e,r)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/Connection":function(){define(["../handleUtils","../has","../promiseUtils","../Queue","./connectionRegistry","./InvokeHandler","./RemoteClient"],function(e,t,r,s,i,n,o){"use strict";return class{constructor(){this._inUseClients=new Array,this._clients=new Array,this._clientPromises=new Array,this._ongoingJobsQueue=new s,this._ongoingLowPriorityJobsQueue=new s}destroy(){this.close()}get closed(){return!this._clients?.length}open(e,t){return new Promise((s,i)=>{let n=!0;const a=e=>{r.throwIfAborted(t.signal),n&&(n=!1,e())};this._clients.length=e.length,this._clientPromises.length=e.length,this._inUseClients.length=e.length;for(let n=0;n<e.length;++n){const l=e[n];r.isPromiseLike(l)?this._clientPromises[n]=l.then(e=>(this._clients[n]=new o(e,t,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),a(s),this._clients[n]),()=>(a(i),null)):(this._clients[n]=new o(l,t,this._ongoingJobsQueue,this._ongoingLowPriorityJobsQueue),this._clientPromises[n]=Promise.resolve(this._clients[n]),a(s))}})}broadcast(e,t,r){const s=new Array(this._clientPromises.length);for(let i=0;i<this._clientPromises.length;++i){const n=this._clientPromises[i];s[i]=n.then(s=>s?.invoke(e,t,r))}return s}close(){let e;for(;e=this._ongoingJobsQueue.pop();)e.resolver.reject(r.createAbortError(`Worker closing, aborting job calling '${e.methodName}'`));for(;e=this._ongoingLowPriorityJobsQueue.pop();)e.resolver.reject(r.createAbortError(`Worker closing, aborting job calling '${e.methodName}'`));for(const e of this._clientPromises)e.then(e=>e?.close());this._clients.length=0,this._clientPromises.length=0,this._inUseClients.length=0,i.unregister(this)}invoke(e,t,r){return this.apply(e,[t],r)}apply(e,t,s){const i=r.createResolver();("low"===s?.priority?this._ongoingLowPriorityJobsQueue:this._ongoingJobsQueue).push({methodName:e,data:t,invokeOptions:s,resolver:i});for(let e=0;e<this._clientPromises.length;e++){const t=this._clients[e];t?t.jobAdded():this._clientPromises[e].then(e=>e?.jobAdded())}return i.promise}createInvokeProxy(e){return n.createInvokeProxy(this,e)}on(t,r){return Promise.all(this._clientPromises).then(()=>e.handlesGroup(this._clients.map(e=>e.on(t,r))))}openPorts(){return new Promise(e=>{const t=new Array(this._clientPromises.length);let r=t.length;for(let s=0;s<this._clientPromises.length;++s)this._clientPromises[s].then(i=>{i&&(t[s]=i.openPort()),0===--r&&e(t)})})}get test(){}}})},"esri/core/workers/connectionRegistry":function(){define(["exports"],function(e){"use strict";const t=new FinalizationRegistry(e=>{e.close()});e.register=function(e,r){t.register(e,r,r)},e.unregister=function(e){t.unregister(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/ogc/ogcFeatureUtils":function(){define(["exports","../../request","../../core/Error","../../core/Logger","../../core/urlUtils","../../geometry/SpatialReference","../../geometry/support/spatialReferenceUtils","../../geometry/support/webMercatorUtils","../graphics/featureConversionUtils","../graphics/OptimizedFeatureSet","../graphics/sources/geojson/geojson","../graphics/sources/support/clientSideDefaults","../graphics/sources/support/sourceUtils","../support/FieldsIndex","../support/fieldType","../../time/constants"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m){"use strict";const g=()=>s.getLogger("esri.layers.ogc.ogcFeatureUtils"),y="startindex",_=new Set([y,"offset"]),b="http://www.opengis.net/def/crs/",S=`${b}OGC/1.3/CRS84`;async function x(e,s,h){const{collection:{links:f,landingPage:{url:m}},layerDefinition:g,maxRecordCount:y,queryParameters:{apiKey:_,customParameters:b},spatialReference:S,supportedCrs:x}=e,I=M(f,"items","application/geo+json")||M(f,"http://www.opengis.net/def/rel/ogc/1.0/items","application/geo+json");if(null==I)throw new r("ogc-feature-layer:missing-items-page","Missing items url");const{geometry:P,num:T,start:C,timeExtent:F,where:k}=s;if(s.objectIds)throw new r("ogc-feature-layer:query-by-objectids-not-supported","Queries with object ids are not supported");const A=n.fromJSON(S),O=s.outSpatialReference??A,E=O.isWGS84?null:w(O,x),z=function(e,t){if(!function(e){return null!=e&&"extent"===e.type}(e))return null;const{spatialReference:r}=e;if(!r||r.isWGS84)return{bbox:v(e)};const s=w(r,t);return null!=s?{bbox:v(e),"bbox-crs":s}:r.isWebMercator?{bbox:v(a.project(e,n.WGS84))}:null}(P,x),R=function(e){if(null==e)return null;const{start:t,end:r}=e;return`${null!=t?t.toISOString():".."}/${null!=r?r.toISOString():".."}`}(F),L=function(e){return null!=e&&e&&"1=1"!==e?e:null}(k),D=T??(null==C?y:10),N=0===C?void 0:C,{fields:G,geometryType:q,hasZ:B,objectIdField:U,paginationParameter:j}=g,V=i.makeAbsolute(I.href,m),{data:W}=await t(V,{...h,query:{...b,...z,crs:E,datetime:R,query:L,limit:D,[j]:N,token:_},headers:{accept:"application/geo+json"}}),Y=u.createOptimizedFeatures(W,{geometryType:q,hasZ:B,objectIdField:U}),H=Y.length===D&&!!M(W.links??[],"next","application/geo+json"),$=new p(G);for(const e of Y){const t={};d.mixAttributes($,t,e.attributes,!0);for(const e of $.fields)e.nullable&&!(e.name in t)&&(t[e.name]=null);t[U]=e.attributes[U],e.attributes=t}if(!E&&O.isWebMercator)for(const e of Y)if(null!=e.geometry&&null!=q){const t=l.convertToGeometry(e.geometry,q,B,!1);t.spatialReference=n.WGS84,e.geometry=l.convertFromGeometry(a.project(t,O))}for(const e of Y)e.objectId=e.attributes[U];const X=E||!E&&O.isWebMercator?O.toJSON():o.wgs84,Q=new c;return Q.exceededTransferLimit=H,Q.features=Y,Q.fields=G,Q.geometryType=q,Q.hasZ=B,Q.spatialReference=X,Q}function w(e,t){const{isWebMercator:r,wkid:s}=e;if(!s)return null;const i=r?t[3857]??t[102100]??t[102113]??t[900913]:t[e.wkid];return i?`${b}${i}`:null}function v(e){if(null==e)return"";const{xmin:t,ymin:r,xmax:s,ymax:i}=e;return`${t},${r},${s},${i}`}function M(e,t,r){return e.find(({rel:e,type:s})=>e===t&&s===r)??e.find(({rel:e,type:r})=>e===t&&!r)}e.crsDefault=S,e.crsPrefix=b,e.getCollectionDefinition=async function(e,s,o={},a=5){const{links:l}=e,c=M(l,"items","application/geo+json")||M(l,"http://www.opengis.net/def/rel/ogc/1.0/items","application/geo+json");if(null==c)throw new r("ogc-feature-layer:missing-items-page","Missing items url");const{apiKey:d,customParameters:b,signal:S}=o,x=i.makeAbsolute(c.href,e.landingPage.url),w={limit:a,...b,token:d},v=i.addQueryParameters(x,w),{data:I}=await t(v,{signal:S,headers:{accept:"application/geo+json"}}),P=function(e,t,r){if(!r)return;const s=M(r,"next","application/geo+json"),n=i.urlToObject(s?.href)?.query;if(!n)return;const o=i.urlToObject(e).query,a=Object.keys(o??{}),l=Object.entries(n).filter(([e])=>!a.includes(e)).find(([e,r])=>_.has(e.toLowerCase())&&Number.parseInt(r,10)===t),c=l?.[0];return c}(v,a,I.links)??y;u.validateGeoJSON(I);const T=u.inferLayerProperties(I,{geometryType:s.geometryType}),C=s.fields||T.fields||[],F=null!=s.hasZ?s.hasZ:T.hasZ,k=T.geometryType,A=s.objectIdField||T.objectIdFieldName||"OBJECTID";let O=s.timeInfo;const E=C.find(({name:e})=>e===A);if(E)E.editable=!1,E.nullable=!1;else{if(!T.objectIdFieldType)throw new r("ogc-feature-layer:missing-feature-id","Collection geojson require a feature id as a unique identifier");C.unshift({name:A,alias:A,type:"number"===T.objectIdFieldType?"esriFieldTypeOID":"esriFieldTypeString",editable:!1,nullable:!1})}if(A!==T.objectIdFieldName){const e=C.find(({name:e})=>e===T.objectIdFieldName);e&&(e.type="esriFieldTypeInteger")}C===T.fields&&T.unknownFields.length>0&&g().warn({name:"ogc-feature-layer:unknown-field-types",message:"Some fields types couldn't be inferred from the features and were dropped",details:{unknownFields:T.unknownFields}});for(const e of C){if(null==e.name&&(e.name=e.alias),null==e.alias&&(e.alias=e.name),"esriFieldTypeOID"!==e.type&&"esriFieldTypeGlobalID"!==e.type&&(e.editable=null==e.editable||!!e.editable,e.nullable=null==e.nullable||!!e.nullable),!e.name)throw new r("ogc-feature-layer:invalid-field-name","field name is missing",{field:e});if(!f.kebabDict.jsonValues.includes(e.type))throw new r("ogc-feature-layer:invalid-field-type",`invalid type for field "${e.name}"`,{field:e})}if(O){const e=new p(C);if(O.startTimeField){const t=e.get(O.startTimeField);t?(O.startTimeField=t.name,t.type="esriFieldTypeDate"):O.startTimeField=null}if(O.endTimeField){const t=e.get(O.endTimeField);t?(O.endTimeField=t.name,t.type="esriFieldTypeDate"):O.endTimeField=null}if(O.trackIdField){const t=e.get(O.trackIdField);t?O.trackIdField=t.name:(O.trackIdField=null,g().warn({name:"ogc-feature-layer:invalid-timeInfo-trackIdField",message:"trackIdField is missing",details:{timeInfo:O}}))}O.timeReference||={timeZoneIANA:m.utc},O.startTimeField||O.endTimeField||(g().warn({name:"ogc-feature-layer:invalid-timeInfo",message:"startTimeField and endTimeField are missing",details:{timeInfo:O}}),O=void 0)}const z=k?h.createDrawingInfo(k):null,R=function(e){const t=e.extent?.spatial;if(!t)return null;const r=t.bbox[0],s=4===r.length,[i,o]=r,a=s?void 0:r[2];return{xmin:i,ymin:o,xmax:s?r[2]:r[3],ymax:s?r[3]:r[4],zmin:a,zmax:s?void 0:r[5],spatialReference:n.WGS84.toJSON()}}(e);return{drawingInfo:z,extent:R,geometryType:k,fields:C,hasZ:!!F,objectIdField:A,paginationParameter:P,timeInfo:O}},e.getServerCollections=async function(e,s={}){const{links:n,url:o}=e,a=M(n,"data","application/json")||M(n,"http://www.opengis.net/def/rel/ogc/1.0/data","application/json");if(null==a)throw new r("ogc-feature-layer:missing-collections-page","Missing collections url");const{apiKey:l,customParameters:c,signal:u}=s,h=i.makeAbsolute(a.href,o),{data:d}=await t(h,{signal:u,headers:{accept:"application/json"},query:{...c,token:l}});for(const t of d.collections)t.landingPage=e;return d},e.getServerConformance=async function(e,s={}){const{links:n,url:o}=e,a=M(n,"conformance","application/json")||M(n,"http://www.opengis.net/def/rel/ogc/1.0/conformance","application/json");if(null==a)throw new r("ogc-feature-layer:missing-conformance-page","Missing conformance url");const{apiKey:l,customParameters:c,signal:u}=s,h=i.makeAbsolute(a.href,o),{data:d}=await t(h,{signal:u,headers:{accept:"application/json"},query:{...c,token:l}});return d},e.getServerLandingPage=async function(e,r={}){const{apiKey:s,customParameters:i,signal:n}=r,{data:o}=await t(e,{signal:n,headers:{accept:"application/json"},query:{...i,token:s}});return o.url=e,o},e.getServerOpenApi=async function(e,r={}){const{links:s,url:n}=e,o=M(s,"service-desc","application/vnd.oai.openapi+json;version=3.0");if(null==o)return g().warn("ogc-feature-layer:missing-openapi-page","The OGC API-Features server does not have an OpenAPI page."),null;const{apiKey:a,customParameters:l,signal:c}=r,u=i.makeAbsolute(o.href,n),{data:h}=await t(u,{signal:c,headers:{accept:"application/vnd.oai.openapi+json;version=3.0"},query:{...l,token:a}});return h},e.getSpatialReferenceWkid=function(e){const t=/^http:\/\/www\.opengis.net\/def\/crs\/(?<authority>.*)\/(?<version>.*)\/(?<code>.*)$/i.exec(e),r=t?.groups;if(!r)return null;const{authority:s,code:i}=r;switch(s.toLowerCase()){case"ogc":switch(i.toLowerCase()){case"crs27":return n.GCS_NAD_1927.wkid;case"crs83":return 4269;case"crs84":case"crs84h":return n.WGS84.wkid;default:return null}case"esri":case"epsg":{const e=Number.parseInt(i,10);return Number.isNaN(e)?null:e}default:return null}},e.queryFeatureSetJSON=async function(e,t,r){const s=await x(e,t,r);return l.convertToFeatureSet(s)},e.queryOptimizedFeatureSet=x,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/geojson/geojson":function(){define(["exports","../../../../core/date","../../../../core/Error","../../../../geometry/support/spatialReferenceUtils","../../OptimizedFeature","../../OptimizedGeometry","../../../support/fieldUtils"],function(e,t,r,s,i,n,o){"use strict";const a={LineString:"esriGeometryPolyline",MultiLineString:"esriGeometryPolyline",MultiPoint:"esriGeometryMultipoint",Point:"esriGeometryPoint",Polygon:"esriGeometryPolygon",MultiPolygon:"esriGeometryPolygon"};function l(e){return a[e]}function*c(e){switch(e.type){case"Feature":yield e;break;case"FeatureCollection":for(const t of e.features)t&&(yield t)}}function*u(e){if(e)switch(e.type){case"Point":yield e.coordinates;break;case"LineString":case"MultiPoint":yield*e.coordinates;break;case"MultiLineString":case"Polygon":for(const t of e.coordinates)yield*t;break;case"MultiPolygon":for(const t of e.coordinates)for(const e of t)yield*e}}function h(e){for(const t of e)if(t.length>2)return!0;return!1}function d(e){let t=0;for(let r=0;r<e.length;r++){const s=e[r],i=e[(r+1)%e.length];t+=s[0]*i[1]-i[0]*s[1]}return t<=0}function p(e){const t=e[0],r=e[e.length-1];return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]||e.push(t),e}function f(e,t,r){switch(t.type){case"LineString":case"MultiPoint":return function(e,t,r){return y(e,t.coordinates,r),e}(e,t,r);case"MultiLineString":return function(e,t,r){for(const s of t.coordinates)y(e,s,r);return e}(e,t,r);case"MultiPolygon":return function(e,t,r){for(const s of t.coordinates){m(e,s[0],r);for(let t=1;t<s.length;t++)g(e,s[t],r)}return e}(e,t,r);case"Point":return function(e,t,r){return b(e,t.coordinates,r),e}(e,t,r);case"Polygon":return function(e,t,r){const s=t.coordinates;m(e,s[0],r);for(let t=1;t<s.length;t++)g(e,s[t],r);return e}(e,t,r)}}function m(e,t,r){const s=p(t);d(s)?y(e,s,r):_(e,s,r)}function g(e,t,r){const s=p(t);d(s)?_(e,s,r):y(e,s,r)}function y(e,t,r){for(const s of t)b(e,s,r);e.lengths.push(t.length)}function _(e,t,r){for(let s=t.length-1;s>=0;s--)b(e,t[s],r);e.lengths.push(t.length)}function b(e,t,r){const[s,i,n]=t;e.coords.push(s,i),r.hasZ&&e.coords.push(n||0)}function S(e){switch(typeof e){case"string":return t.isISO8601Date(e)?"esriFieldTypeDate":"esriFieldTypeString";case"number":return"esriFieldTypeDouble";default:return"unknown"}}e.createOptimizedFeatures=function(e,t){return Array.from(function*(e,t={}){const{geometryType:r,objectIdField:s}=t;for(const o of e){const{geometry:e,properties:a,id:c}=o;if(e&&l(e.type)!==r)continue;const u=a||{};let h;s&&(h=u[s],null==c||h||(u[s]=h=c));const d=new i.OptimizedFeature(e?f(new n,e,t):null,u,null,h);yield d}}(c(e),t))},e.getGeometryType=l,e.inferLayerProperties=function(e,t={}){const r=[],s=new Set,i=new Set;let n,a=!1,d=null,p=!1,{geometryType:f=null}=t;for(const t of c(e)){const{geometry:e,properties:c,id:m}=t;if((!e||(f||(f=l(e.type)),l(e.type)===f))&&(a||(a=h(u(e))),p||(p=null!=m,p&&(n=typeof m,c&&(d=Object.keys(c).filter(e=>c[e]===m)))),c&&d&&p&&null!=m&&(d.length>1?d=d.filter(e=>c[e]===m):1===d.length&&(d=c[d[0]]===m?d:[])),c))for(const e in c){if(s.has(e))continue;const t=S(c[e]);if("unknown"===t){i.add(e);continue}i.delete(e),s.add(e);const n=o.normalizeFieldName(e);n&&r.push({name:n,alias:e,type:t})}}const m=o.normalizeFieldName(1===d?.length&&d[0]||null)??void 0;if(m)for(const e of r)if(e.name===m&&o.isNumericField(e)){e.type="esriFieldTypeOID";break}return{fields:r,geometryType:f,hasZ:a,objectIdFieldName:m,objectIdFieldType:n,unknownFields:Array.from(i)}},e.validateGeoJSON=function(e,t=4326){if(!e)throw new r("geojson-layer:empty","GeoJSON data is empty");if("Feature"!==e.type&&"FeatureCollection"!==e.type)throw new r("geojson-layer:unsupported-geojson-object","missing or not supported GeoJSON object type",{data:e});const{crs:i}=e;if(!i)return;const n="string"==typeof i?i:"name"===i.type?i.properties.name:"EPSG"===i.type?i.properties.code:null,o=s.isWGS84({wkid:t})?new RegExp(".*(CRS84H?|4326)$","i"):new RegExp(`.*(${t})$`,"i");if(!n||!o.test(n))throw new r("geojson:unsupported-crs","unsupported GeoJSON 'crs' member",{crs:i})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/date":function(){define(["exports"],function(e){"use strict";function t(e){const t=new Date(e);return function(e,t){if(Number.isNaN(e.getTime()))return!1;let r=!0;if(n&&/\d+\W*$/.test(t)){const e=t.match(/[a-zA-Z]{2,}/);if(e){let t=!1,s=0;for(;!t&&s<=e.length;)t=!i.test(e[s]),s++;r=!t}}return r}(t,e)?Number.isNaN(t.getTime())?null:t.getTime()-6e4*t.getTimezoneOffset():null}function r(e){const t=s.exec(e);if(!t?.groups)return null;const r=t.groups,i=+r.year,n=+r.month-1,o=+r.day,a=+(r.hours??"0"),l=+(r.minutes??"0"),c=+(r.seconds??"0");if(a>23)return null;if(l>59)return null;if(c>59)return null;const u=r.ms??"0",h=u?+u.padEnd(3,"0").slice(0,3):0;let d;if(r.isUTC||!r.offsetSign)d=Date.UTC(i,n,o,a,l,c,h);else{const e=+r.offsetHours,t=+r.offsetMinutes;d=6e4*("+"===r.offsetSign?-1:1)*(60*e+t)+Date.UTC(i,n,o,a,l,c,h)}return Number.isNaN(d)?null:d}const s=/^(?:(?<year>-?\d{4,})-(?<month>\d{2})-(?<day>\d{2}))(?:T(?<hours>\d{2}):(?<minutes>\d{2}):(?<seconds>\d{2})(?:\.(?<ms>\d+))?)?(?:(?<isUTC>Z)|(?:(?<offsetSign>\+|-)(?<offsetHours>\d{2}):(?<offsetMinutes>\d{2})))?$/,i=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,n=!Number.isNaN(new Date("technology 10").getTime());e.isDateString=function(e){return null!=r(e)||null!=t(e)},e.isISO8601Date=function(e){return s.test(e)},e.parseDate=function(e){return r(e)??t(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/clientSideDefaults":function(){define(["exports","../../../../core/has","../../../../core/lang","../../data/QueryEngineCapabilities","../../../../symbols/support/defaultsJSON"],function(e,t,r,s,i){"use strict";const n=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let o=1;function a(e){return n.test(e)?`.${e}`:`["${e}"]`}e.createCapabilities=function(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.queryCapabilities,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:s.queryBinsCapabilities,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}},e.createDefaultAttributesFunction=function(e,r){if(t("esri-csp-restrictions"))return()=>({[r]:null,...e});try{let t=`this${a(r)} = null;`;for(const r in e)t+=`this${a(r)} = ${JSON.stringify(e[r])};`;const s=new Function(`\n      return class AttributesClass$${o++} {\n        constructor() {\n          ${t};\n        }\n      }\n    `)();return()=>new s}catch(t){return()=>({[r]:null,...e})}},e.createDefaultTemplate=function(e={}){return[{name:"New Feature",description:"",prototype:{attributes:r.clone(e)}}]},e.createDrawingInfo=function(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?i.defaultPointSymbolJSON:"esriGeometryPolyline"===e?i.defaultPolylineSymbolJSON:i.defaultPolygonSymbolJSON}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/support/sourceUtils":function(){define(["require","exports","../../../../core/date","../../../../geometry/support/spatialReferenceUtils","../../../support/fieldUtils"],function(e,t,r,s,i){"use strict";class n{constructor(e){this.description=e,this.code=null}}class o{constructor(e){this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error=new n(e)}}function a(e){return new o(e)}class l{constructor(e){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=e}}const c=new Set;function u(e,t){let s=t;return i.isNumericField(e)&&"string"==typeof t?s=parseFloat(t):i.isStringField(e)&&null!=t&&"string"!=typeof t?s=String(t):i.isDateField(e)&&"string"==typeof t&&(s=r.parseDate(t)),i.sanitizeNullFieldValue(s)}let h;t.createFeatureEditErrorResult=a,t.createFeatureEditSuccessResult=function(e){return new l(e)},t.loadGeometryEngineForSimplify=async function(t,r){!s.isValid(t)||"esriGeometryPolygon"!==r&&"esriGeometryPolyline"!==r||await async function(){return null==h&&(h=await new Promise((t,r)=>e(["../../../../geometry/geometryEngineJSON"],t,r))),h}()},t.mixAttributes=function(e,t,r,s=!1){c.clear();for(const n in r){const o=e.get(n);if(!o)continue;const l=u(o,r[n]);if(c.add(o.name),o&&(s||o.editable)){const e=i.validateFieldValue(o,l);if(e)return a(i.validationErrorToString(e,o,l));t[o.name]=l}}for(const t of e.requiredFields??[])if(!c.has(t.name))return a(`missing required field "${t.name}"`);return null},t.queryBinsCapabilities={supportsAutoIntervalBin:!0,supportsFixedIntervalBin:!0,supportsFixedBoundariesBin:!0,supportsDateBin:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsNormalization:!0,supportedStatisticTypes:["COUNT","SUM","AVG","VAR","STDDEV","MIN","MAX","PERCENTILE_CONT","PERCENTILE_DISC","CentroidAggregate","EnvelopeAggregate","ConvexHullAggregate"],supportedNormalizationTypes:["field","log","naturalLog","percentOfTotal","squareRoot"]},t.simplify=function(e,t){if(!e||!s.isValid(t))return e;if("rings"in e||"paths"in e){if(null==h)throw new TypeError("geometry engine not loaded");return h.simplify(t,e)}return e},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderPBF":function(){define(["exports","../../../../../core/Error","../../../../../core/has","../../../../../core/Logger","../../../../../core/maybe","../../../../../core/memoryEstimations","../../../../../core/pbf","../../../../../layers/graphics/OptimizedGeometry","./FeatureSetCache","./FeatureSetReader","./FeatureSetReaderPBFHeader"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";const h=268435455,d=128e3,p={small:{delta:new Int32Array(128),decoded:new Int32Array(128)},small64:{delta:new Float64Array(0),decoded:new Float64Array(0)},large:{delta:new Int32Array(d),decoded:new Int32Array(d)},large64:{delta:new Float64Array(0),decoded:new Float64Array(0)}};function f(e,t){return t?e<=p.small64.delta.length?p.small64:(e<=p.large64.delta.length||(p.large64.delta=new Float64Array(Math.round(1.25*e)),p.large64.decoded=new Float64Array(Math.round(1.25*e))),p.large64):e<=p.small.delta.length?p.small:(e<=p.large.delta.length||(p.large.delta=new Int32Array(Math.round(1.25*e)),p.large.decoded=new Int32Array(Math.round(1.25*e))),p.large)}function m(e){for(;e.next();){if(1===e.tag())return e.getMessage();e.skip()}return null}function g(e,t,r,s,i){return!!e&&0===t*i-s*r&&t*s+r*i>0}class y extends c.FeatureSetReader{static fromBuffer(e,r,i=!1){const n=r.geometryType,a=function(e){try{const t=2,r=new o(new Uint8Array(e),new DataView(e));for(;r.next();){if(r.tag()===t)return m(r.getMessage());r.skip()}}catch(e){const r=new t("query:parsing-pbf","Error while parsing FeatureSet PBF payload",{error:e});s.getLogger("esri.view.2d.layers.features.support.FeatureSetReaderPBF").error(r)}return null}(e),l=u.parseHeader(a,"esriGeometryPoint"===n,r.featureIdInfo,i);return new y(a,l,r,i)}constructor(e,t,r,s){super(r),this._use64Bit=s,this._hasNext=!1,this._isPoints=!1,this._featureIndex=-1,this._featureOffset=0,this._cache={area:0,unquantGeometry:void 0,geometry:void 0},this._parseCaches=new Array,this._geometryType=r.geometryType,this._reader=e,this._header=t,this._hasNext=t.hasFeatures,this._isPoints="esriGeometryPoint"===r.geometryType}get _size(){return this._header.featureCount}get fields(){return this._header.fields}get geometryType(){return this._geometryType}get hasZ(){return!1}get hasM(){return!1}get hasFeatures(){return this._header.hasFeatures}get hasNext(){return this._hasNext}get exceededTransferLimit(){return this._header.exceededTransferLimit}getSize(){return this._size}getInTransform(){return this._header.transform}getCursor(){return this.copy()}getIndex(){return this._featureIndex}setIndex(e){this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0,this._featureIndex=e}getAttributeHash(){let e="";for(const t of this._header.fields.fields)e+=this._readAttributeAtIndex(t.index)+".";return e}getObjectId(){if(1===this._header.idFieldIndices.length)return this._readAttributeAtIndex(this._header.idFieldIndices[0]);const e=this._header.idFieldIndices.map(e=>this._readAttributeAtIndex(e));return JSON.stringify(e)}getDisplayId(){return this._header.displayIds[this._featureIndex]}setDisplayId(e){this._header.displayIds[this._featureIndex]=e}readGeometryArea(){return this._cache.area||this._readGeometry(!0),this._cache.area}copy(){const e=this._reader.clone(),t=new y(e,this._header,this.metadata,this._use64Bit);return this.copyInto(t),t}next(){for(this._cache.area=0,this._cache.unquantGeometry=void 0,this._cache.geometry=void 0;++this._featureIndex<this._size&&!this._getExists(););return this._featureIndex<this._size}get usedMemory(){return n.baseObjectMemory+(this._cache.geometry?.usedMemory??0)}_readX(){return this._header.centroid[2*this._featureIndex]}_readY(){return this._header.centroid[2*this._featureIndex+1]}_readServerCentroid(){const e=this._header.centroid[2*this._featureIndex],t=this._header.centroid[2*this._featureIndex+1];return e===h?null:new a([],[e,t])}_readGeometry(e=!1){if(void 0===this._cache.geometry){let t=null;if(this._isPoints){if(this._header.centroid[2*this._featureIndex]===h)return null;const e=this._header.centroid[2*this._featureIndex],r=this._header.centroid[2*this._featureIndex+1];t=new a([],[e,r])}else{const r=this._header.offsets.geometry[this._featureIndex],s=this._reader;if(0===r)return null;s.move(r);try{t=e?this._parseGeometryForDisplay(s):this._parseGeometry(s)}catch(e){return null}}return 0===t?.coords.length&&(t=null),this._cache.geometry=t,t}return this._cache.geometry}_readAttribute(e,t){const r=this._header.fields.get(e);if(null==r)return;const s=this._readAttributeAtIndex(r.index),i=this._header.fields.isDateField(r.name);return t?null==s?s:i?new Date(s):s:s}_readAttributes(){const e={};for(const t of this._header.fields.fields)e[t.name]=this._readAttributeAtIndex(t.index);return e}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._featureOffset=this._featureOffset,e._hasNext=this._hasNext,e._parseCaches=this._parseCaches}_readAttributeAtIndex(e){let t=this._parseCaches[e];if(t||(t=new l.FeatureSetCache(this.getSize()),this._parseCaches[e]=t),t.has(this._featureIndex))return t.get(this._featureIndex);const r=this._header.offsets.attributes[this._featureIndex*this._header.fieldCount+e],s=this._reader;s.move(r);const i=function(e){const t=e.getLength(),r=e.pos()+t;for(;e.pos()<r&&e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getSInt32();case 5:return e.getUInt32();case 6:return e.getInt64();case 7:return e.getUInt64();case 8:return e.getSInt64();case 9:return e.getBool();default:return e.skip(),null}return null}(s);return t.set(this._featureIndex,i),i}_readGeometryDeltaDecoded(e=!1){if(void 0===this._cache.unquantGeometry){const t=this._readGeometry(e);if(!t)return this._cache.unquantGeometry=void 0,null;if(!this.getInTransform())return this._cache.unquantGeometry=t,t;const r=f(t.coords.length,this._use64Bit).decoded,s=t.clone(r),i=s.coords;let n=0;for(const e of s.lengths){for(let t=1;t<e;t++){const e=2*(n+t),r=2*(n+t-1);i[e]+=i[r],i[e+1]+=i[r+1]}n+=e}return this._cache.unquantGeometry=s,s}return this._cache.unquantGeometry}_parseGeometry(e){const t=e.asUnsafe(),r=t.getLength(),s=t.pos()+r,i=[],n=[];for(;t.pos()<s&&t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),r=t.pos()+e;for(;t.pos()<r;)n.push(t.getUInt32());break}case 3:{const e=t.getUInt32(),r=t.pos()+e;for(i.push(t.getSInt64()),i.push(t.getSInt64()),this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64();t.pos()<r;)i.push(t.getSInt64()),i.push(t.getSInt64()),this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64();break}default:t.skip()}return new a(n,i)}_parseGeometryForDisplay(e){const t=e.asUnsafe(),r=t.getLength(),s=t.pos()+r,n=[],o=[];let l=0,c=0,u=null,h=0;const d="esriGeometryPolygon"===this.geometryType,p="esriGeometryPolyline"===this.geometryType,m=d?3:p?2:1,y=d||p;for(;t.pos()<s&&t.next();)switch(t.tag()){case 2:{const e=t.getUInt32(),r=t.pos()+e;for(;t.pos()<r;){const e=t.getUInt32();n.push(e),l+=e}u=f(2*l,this._use64Bit).delta;break}case 3:{t.getUInt32();const e=2+(this.hasZ?1:0)+(this.hasM?1:0);i.assertIsSome(u);for(const r of n){if(c+e*r>u.length){for(let e=0;e<r;e++)t.getSInt64(),t.getSInt64(),this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64();continue}let s=0,i=t.getSInt64(),n=t.getSInt64();this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64(),u[c++]=i,u[c++]=n,s+=1;for(let e=1;e<r;e++){const e=t.getSInt64(),r=t.getSInt64(),o=i+e,a=n+r;h+=-.5*(o-i)*(a+n),this.hasZ&&t.getSInt64(),this.hasM&&t.getSInt64(),0===e&&0===r||g(y,u[c-2],u[c-1],e,r)?(u[c-2]+=e,u[c-1]+=r):(u[c++]=e,u[c++]=r,s+=1),i=o,n=a}s>=m?o.push(s):c-=s*e}break}default:t.skip()}return this._cache.area=h,o.length?new a(o,u):null!=u?this._createDeltaQuantizedExtrudedGeometry(u[0],u[1]):null}}e.FeatureSetReaderPBF=y,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderPBFHeader":function(){define(["exports","../../../../../layers/graphics/data/FeatureIdInfo","../../../../../layers/support/FieldsIndex","../../../../../rest/query/operations/pbfFeatureServiceParser"],function(e,t,r,s){"use strict";const i=268435455;class n{constructor(){this.hasFeatures=!1,this.exceededTransferLimit=!1,this.fieldCount=0,this.featureCount=0,this.idFieldIndices=[],this.vertexCount=0,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}}e.FeatureSetHeader=n,e.parseHeader=function(e,o,a,l=!1){const c=e.asUnsafe(),u=c.pos(),h=new n;let d=0,p=0,f=null,m=!1;const g=[];for(;c.next();)switch(c.tag()){case 12:f=c.processMessage(s.parseTransform);break;case 9:if(h.exceededTransferLimit=c.getBool(),h.exceededTransferLimit){h.offsets.geometry=l?new Float64Array(8e3):new Int32Array(8e3),h.centroid=l?new Float64Array(16e3):new Int32Array(16e3);for(let e=0;e<h.centroid.length;e++)h.centroid[e]=i}break;case 13:{const e=c.processMessage(s.parseField);e.index=d++,g.push(e);break}case 15:{const e=c.getLength(),t=c.pos()+e;if(!h.exceededTransferLimit){const e=h.offsets.geometry,t=h.centroid;e.push(0),t.push(i),t.push(i)}!m&&h.exceededTransferLimit&&(m=!0,h.offsets.attributes=l?new Float64Array(8e3*d):new Uint32Array(8e3*d));let r=p*d;for(;c.pos()<t&&c.next();)switch(c.tag()){case 1:{m?h.offsets.attributes[r++]=c.pos():h.offsets.attributes.push(c.pos());const e=c.getLength();c.skipLen(e);break}case 2:if(o){const e=c.getLength(),t=c.pos()+e;for(;c.pos()<t&&c.next();)switch(c.tag()){case 3:{c.getUInt32();const e=c.getSInt64(),t=c.getSInt64();h.centroid[2*p]=e,h.centroid[2*p+1]=t;break}default:c.skip()}}else{h.offsets.geometry[p]=c.pos();const e=c.getLength();h.vertexCount+=e,c.skipLen(e)}break;case 4:{const e=c.getLength(),t=c.pos()+e;for(;c.pos()<t&&c.next();)switch(c.tag()){case 3:{c.getUInt32();const e=c.getSInt64(),t=c.getSInt64();h.centroid[2*p]=e,h.centroid[2*p+1]=t;break}default:c.skip()}break}default:c.skip()}p++,h.hasFeatures=!0;break}default:c.skip()}h.fields=new r(g),h.featureCount=p,h.fieldCount=d;const y=t.getFeatureIdInfoFieldNames(a);return h.idFieldIndices=Array.from(y,e=>h.fields.get(e)?.index),h.transform=f,h.displayIds=new Uint32Array(h.featureCount),h.groupIds=new Uint16Array(h.featureCount),c.move(u),h},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/FeatureIdInfo":function(){define(["exports"],function(e){"use strict";e.getFeatureIdInfoFieldNames=function*(e){switch(e.type){case"object-id":case"unique-id-simple":return void(yield e.fieldName);case"unique-id-composite":return void(yield*e.fieldNames)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/DrillDownTileSourceChunk":function(){define(["exports","./ASourceChunk"],function(e,t){"use strict";class r extends t.ASourceChunk{constructor(e,t,r,s,i,n){super(),this._reader=e,this._queryJSON=t,this._tile=r,this._sourceTile=s,this._sourceTileDepth=i,this._end=n,this.chunkId=`${this._tile.key.id}.${this._sourceTile?.key.id}${this._end?"e":""}`,this.normalizedChunkId=`${this._tile.key.normalizedId}.${this._sourceTile?.key.normalizedId}${this._end?"e":""}`}get queryInfo(){return{type:"drill-down-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,sourceTileDepth:this._sourceTileDepth,sourceTileId:this._sourceTile?.key.id,size:this.size(),end:this.end}}get first(){return 0===this._sourceTileDepth}get reader(){return this._reader}get end(){return this._end}get tile(){return this._tile}get isTiled(){return!0}getTileReader(e){return this._tile.key.id===e.key.id?this.reader:null}}e.DrillDownTileSourceChunk=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/PagedTileLoadStrategy":function(){define(["exports","../../../../../../core/handleUtils","../../../../../../core/has","../../../../../../core/MapUtils","../../../../../../core/promiseUtils","./ATileLoadStrategy","./chunks/PagedTileSourceChunk","../../support/FeatureSetReaderJSON"],function(e,t,r,s,i,n,o,a){"use strict";class l{constructor(e,r){this.subscription=e,this._pages=new Set,this._controller=new AbortController,this._done=!1,this._handles=t.handlesGroup([i.onAbort(e.signal,()=>this._controller.abort()),i.onAbort(r,()=>this._controller.abort())])}destroy(){this._controller.abort(),this._handles.remove()}get pageStart(){let e=-1;for(const t of this._pages.values())e=Math.max(e,t);return e+1}get done(){return this._done}get options(){return{signal:this._controller.signal}}add(e,t){this._pages.add(e),this._done=this._done||t}}class c extends n.ATileLoadStrategy{constructor(){super(...arguments),this._loadStates=new Map}destroy(){super.destroy();for(const e of this._loadStates.values())e.destroy();this._loadStates.clear()}get about(){return{supportsDisplayFilter:!0,willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}async load(e){const t=s.getOrCreateMapValue(this._loadStates,e.key.id,()=>new l(e,this._options));for await(const e of this._fetchPages(t))this._addChunk(e)}unload(e){super.unload(e),this._loadStates.get(e.key.id)?.destroy(),this._loadStates.delete(e.key.id)}async*_fetchPages(e){let t;try{for await(const t of this._concurrentPageStream(e))i.throwIfAborted(e.options),0!==t.size()&&(yield t)}catch(e){t=e}if(t&&i.isAbortError(t)||(yield new o.PagedTileSourceChunk(a.FeatureSetReaderJSON.empty(this._metadata),null,e.subscription.tile,-1,!0)),t)throw t}async*_concurrentPageStream(e){const t=r("featurelayer-query-tile-concurrency"),s=this._pageStreamAll(e),i=[];let n=!1,o=1;for(;!n;){const e=[];for(;!n&&i.length<o;){const t=s.next();if(!t.value){n=!0;break}const r=t.value;r.then(e=>{e.reader.exceededTransferLimit||(n=!0)}).catch(e=>{n=!0}).finally(()=>{i.splice(i.indexOf(r),1)}),i.push(r),e.push(r)}for(const t of e)yield t;i.length&&await Promise.race(i),o<t&&(o+=1)}}*_pageStreamAll(e){const t=Math.ceil(r("featurelayer-query-tile-max-features")/this._queryInfo.pageSize);for(let r=0;r<t;r++)yield this._downloadPage(r,e)}async _downloadPage(e,t){i.throwIfAborted(t.options);const r=t.subscription.tile,s=this._queryInfo.createPagedTileQuery(r,e),n=await this._fetch(s,t.options,{chunkId:`${r.id}-${e}`});return i.throwIfAborted(t.options),new o.PagedTileSourceChunk(n,s.inner.toJSON(),r,e,!1)}}e.PagedTileLoadStrategy=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/PagedTileSourceChunk":function(){define(["exports","./ASourceChunk"],function(e,t){"use strict";class r extends t.ASourceChunk{constructor(e,t,r,s,i){super(),this._reader=e,this._queryJSON=t,this._tile=r,this._page=s,this._end=i,this.chunkId=`${this._tile.key.id}.${this._page}${this.end?"e":""}`,this.normalizedChunkId=`${this._tile.key.normalizedId}.${this._page}${this.end?"e":""}`}get queryInfo(){return{type:"paged-tile",chunkId:this.chunkId,tileId:this._tile.key.id,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get page(){return this._page}get tile(){return this._tile}get isTiled(){return!0}getTileReader(e){return this._tile.key.id===e.key.id?this.reader:null}}e.PagedTileSourceChunk=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ParquetSnapshotLoadStrategy":function(){define(["exports","../../../../../../core/promiseUtils","../../../../../../core/SetUtils","../../../../../../layers/support/FieldsIndex","../../../../../../libs/parquet/parquet","./ALoadStrategy","./chunks/FeatureSnapshotSourceChunk","../../support/FeatureSetReaderJSON","../../support/FeatureSetReaderParquet"],function(e,t,r,s,i,n,o,a,l){"use strict";class c extends n.ALoadStrategy{constructor(e,t,r,s){super(s),this._service=e,this._metadata=t,this._schema=r,this._chunkId=0,this._files=[],this._availableFields=new Set(r.mutable.availableFields)}destroy(){super.destroy();for(const e of this._files)e.free()}get about(){return{supportsDisplayFilter:!1,willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}async updateFields(e){await this._promise;const t=new Set(e),s=r.difference(t,this._availableFields);this._availableFields=r.union(s,this._availableFields);const i=this._fieldsIndex;if(null==i)return;const n=Array.from(s).map(e=>i.get(e)?.column);if(s.size)for(const e of this._files)await e.ensureFields(new Uint32Array(n))}async load(e){return null==this._promise&&(this._promise=this._download()),this._promise}unload(e){}async addParquetFile(e){this._insert(e)}async _insert(e){const r=await i.createParquetFile(e,{geometryInfo:this._service.geometryInfo,outSpatialReference:this._service.outSpatialReference,getCustomParameters:()=>this._schema.mutable.dataFilter.customParameters});this._files.push(r),t.throwIfAborted(this._options);const n=r.fields().map(e=>({name:e.name,alias:e.name,type:e.type,column:r.columnForFieldName(e.name)})),{timeZoneByFieldName:a}=this._service.metadata.fieldsIndex,c=s.fromJSON({fields:n,timeZoneByFieldName:a});this._fieldsIndex=c;const u=new Uint32Array(Array.from(this._availableFields.values()).map(e=>c.get(e)?.column).filter(e=>null!=e));await r.readAllChunks(u,this._signal,e=>{if(this._signal.aborted)return;const t=this._chunkId++,r=new l.FeatureSetReaderParquet(this._metadata,c,e,t),s=new o.FeatureSnapshotSourceChunk(r,null,t,!1);this._store.insert(s)})}async _download(){try{await Promise.all(this._service.source.urls.map(e=>this._insert(e)));const e=new o.FeatureSnapshotSourceChunk(a.FeatureSetReaderJSON.empty(this._metadata),null,-1,!0);this._store.insert(e)}catch(e){throw console.error(e),e}}}e.ParquetSnapshotLoadStrategy=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/libs/parquet/parquet":function(){define(["exports","../../request","../../core/Error","./loadParquetModule","../../chunks/bundle"],function(e,t,r,s,i){"use strict";function n(e,t){const s=e.spatialReference.wkid,n=t.wkid;if(!s||!n)throw new r("parquet","Unable to create ParquetFile, in and out wkid must be specified");const o=function(e){switch(e){case"esriGeometryPoint":return i.GeometryType.Point;case"esriGeometryPolygon":return i.GeometryType.Polygon;case"esriGeometryPolyline":return i.GeometryType.Polyline;case"esriGeometryMultipoint":return i.GeometryType.Multipoint;default:throw new r("parquet",`Found unexpected GeometryType: ${e}`)}}(e.geometryType),a=function(e){switch(e.encoding.type){case"wkb":return i.PrimaryGeometryField.fromWkb(e.encoding.primaryFieldName);case"location":{const{latitudeFieldName:t,longitudeFieldName:r}=e.encoding;return i.PrimaryGeometryField.fromLocation(t,r)}}}(e),l=[];if("xz"===e.displayOptimization?.mode){const t=e.displayOptimization.multiscale;for(const e of t.levels??[]){const[t,r]=e.transform.translate,[s,n]=e.transform.scale,o=new Float64Array([t,r]),a=new Float64Array([s,n]);l.push(i.MultiscaleGeometryField.new(e.level,e.column,o,a))}}return i.GeometryInfo.new(o,s,n,a,l)}e.createParquetFile=async function(e,r={}){const{ParquetFile:i}=await s.loadParquetModule(),o=(a=r.getCustomParameters,async function(e,r,s,i){const n=a?.(),o=n?{...n,debug:i}:{debug:i},{data:l}=await t(e,{responseType:"array-buffer",query:o,headers:{range:`bytes=${r}-${s}`}});return l});var a;const l=(e=>async function(r){const{data:s}=await t(r,{responseType:"native",method:"head",query:e?.()}),i=s.headers.get("Content-Length");if(null==i)throw new Error("Unable to parse content length");return parseInt(i,10)})(r.getCustomParameters),c=r.geometryInfo?n(r.geometryInfo,r.outSpatialReference??r.geometryInfo.spatialReference):null;return i.fromUrl(e,o,l,c)},e.createParquetFileFromBytes=async function(e,t={}){const{ParquetFile:r}=await s.loadParquetModule(),i=t.geometryInfo?n(t.geometryInfo,t.outSpatialReference):null;return r.fromBinary(e,i)},e.readEsriMetadata=function(e){const t=e.keyValueMetadata("esri");return null!=t?JSON.parse(t):null},e.readGeoMetadata=function(e){const t=e.keyValueMetadata("geo");return null!=t?JSON.parse(t):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/libs/parquet/loadParquetModule":function(){define(["require","exports","../../assets"],function(e,t,r){"use strict";let s=null;t.loadParquetModule=async function(){return s||(s=async function(){const t=await new Promise((t,r)=>e(["../../chunks/bundle"],t,r));return await t.default({module_or_path:r.getAssetUrl("esri/libs/parquet/pkg/bundle_bg.wasm")}),t}()),s},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/bundle":function(){define(["exports"],function(e){"use strict";let t;function r(e){const r=t.__externref_table_alloc();return t.__wbindgen_export_2.set(r,e),r}function s(e,s){try{return e.apply(this,s)}catch(e){const s=r(e);t.__wbindgen_exn_store(s)}}Symbol.dispose||(Symbol.dispose=Symbol("Symbol.dispose"));const i="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&i.decode();let n=null;function o(){return null!==n&&0!==n.byteLength||(n=new Uint8Array(t.memory.buffer)),n}function a(e,t){return e>>>=0,i.decode(o().subarray(e,e+t))}let l=0;const c="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},u="function"==typeof c.encodeInto?function(e,t){return c.encodeInto(e,t)}:function(e,t){const r=c.encode(e);return t.set(r),{read:e.length,written:r.length}};function h(e,t,r){if(void 0===r){const r=c.encode(e),s=t(r.length,1)>>>0;return o().subarray(s,s+r.length).set(r),l=r.length,s}let s=e.length,i=t(s,1)>>>0;const n=o();let a=0;for(;a<s;a++){const t=e.charCodeAt(a);if(t>127)break;n[i+a]=t}if(a!==s){0!==a&&(e=e.slice(a)),i=r(i,s,s=a+3*e.length,1)>>>0;const t=o().subarray(i+a,i+s);a+=u(e,t).written,i=r(i,s,a,1)>>>0}return l=a,i}let d=null;function p(){return(null===d||!0===d.buffer.detached||void 0===d.buffer.detached&&d.buffer!==t.memory.buffer)&&(d=new DataView(t.memory.buffer)),d}function f(e){return null==e}const m="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>{t.__wbindgen_export_6.get(e.dtor)(e.a,e.b)});let g=null;function y(){return null!==g&&0!==g.byteLength||(g=new Float64Array(t.memory.buffer)),g}let _=null;function b(){return null!==_&&0!==_.byteLength||(_=new Uint32Array(t.memory.buffer)),_}function S(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function x(e,r){e>>>=0;const s=p(),i=[];for(let n=e;n<e+4*r;n+=4)i.push(t.__wbindgen_export_2.get(s.getUint32(n,!0)));return t.__externref_drop_slice(e,r),i}function w(e,t){const r=t(8*e.length,8)>>>0;return y().set(e,r/8),l=e.length,r}function v(e,t){const r=t(4*e.length,4)>>>0;return b().set(e,r/4),l=e.length,r}function M(e,r,s){t.closure83_externref_shim(e,r,s)}const I=Object.freeze({Point:0,0:"Point",Polygon:1,1:"Polygon",Polyline:2,2:"Polyline",Multipoint:3,3:"Multipoint"}),P=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeBigInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],T="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_columndescriptor_free(e>>>0,1));class C{static __wrap(e){e>>>=0;const t=Object.create(C.prototype);return t.__wbg_ptr=e,T.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,T.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_columndescriptor_free(e,0)}[Symbol.dispose](){this.free()}name(){let e,r;try{const s=t.columndescriptor_name(this.__wbg_ptr);return e=s[0],r=s[1],a(s[0],s[1])}finally{t.__wbindgen_free(e,r,1)}}physicalType(){let e,r;try{const s=t.columndescriptor_physicalType(this.__wbg_ptr);return e=s[0],r=s[1],a(s[0],s[1])}finally{t.__wbindgen_free(e,r,1)}}logicalType(){const e=t.columndescriptor_logicalType(this.__wbg_ptr);let r;return 0!==e[0]&&(r=a(e[0],e[1]).slice(),t.__wbindgen_free(e[0],1*e[1],1)),r}encodings(){const e=t.columndescriptor_encodings(this.__wbg_ptr);var r=x(e[0],e[1]).slice();return t.__wbindgen_free(e[0],4*e[1],4),r}pageEncodings(){const e=t.columndescriptor_pageEncodings(this.__wbg_ptr);let r;return 0!==e[0]&&(r=x(e[0],e[1]).slice(),t.__wbindgen_free(e[0],4*e[1],4)),r}numValues(){return t.columndescriptor_numValues(this.__wbg_ptr)}compression(){let e,r;try{const s=t.columndescriptor_compression(this.__wbg_ptr);return e=s[0],r=s[1],a(s[0],s[1])}finally{t.__wbindgen_free(e,r,1)}}compressedSize(){return t.columndescriptor_compressedSize(this.__wbg_ptr)}uncompressedSize(){return t.columndescriptor_uncompressedSize(this.__wbg_ptr)}nullCount(){const e=t.columndescriptor_nullCount(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}distinctCount(){const e=t.columndescriptor_distinctCount(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}minValue(){return t.columndescriptor_minValue(this.__wbg_ptr)}maxValue(){return t.columndescriptor_maxValue(this.__wbg_ptr)}}const F="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_fieldmetadata_free(e>>>0,1));class k{static __wrap(e){e>>>=0;const t=Object.create(k.prototype);return t.__wbg_ptr=e,F.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,F.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_fieldmetadata_free(e,0)}[Symbol.dispose](){this.free()}get column(){return t.__wbg_get_fieldmetadata_column(this.__wbg_ptr)>>>0}set column(e){t.__wbg_set_fieldmetadata_column(this.__wbg_ptr,e)}get name(){let e,r;try{const s=t.fieldmetadata_name(this.__wbg_ptr);return e=s[0],r=s[1],a(s[0],s[1])}finally{t.__wbindgen_free(e,r,1)}}get type(){const e=t.fieldmetadata_esri_type(this.__wbg_ptr);return P[e]}get physicalType(){const e=t.fieldmetadata_physical_type(this.__wbg_ptr);let r;return 0!==e[0]&&(r=a(e[0],e[1]).slice(),t.__wbindgen_free(e[0],1*e[1],1)),r}get logicalType(){const e=t.fieldmetadata_logical_type(this.__wbg_ptr);let r;return 0!==e[0]&&(r=a(e[0],e[1]).slice(),t.__wbindgen_free(e[0],1*e[1],1)),r}}const A="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_geometryinfo_free(e>>>0,1));class O{static __wrap(e){e>>>=0;const t=Object.create(O.prototype);return t.__wbg_ptr=e,A.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,A.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_geometryinfo_free(e,0)}[Symbol.dispose](){this.free()}static new(e,s,i,n,o){S(n,U);var a=n.__destroy_into_raw();const c=function(e,t){const s=t(4*e.length,4)>>>0;for(let t=0;t<e.length;t++){const i=r(e[t]);p().setUint32(s+4*t,i,!0)}return l=e.length,s}(o,t.__wbindgen_malloc),u=l,h=t.geometryinfo_new(e,s,i,a,c,u);return O.__wrap(h)}}const E="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_multiscalegeometryfield_free(e>>>0,1));class z{static __wrap(e){e>>>=0;const t=Object.create(z.prototype);return t.__wbg_ptr=e,E.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof z?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,E.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_multiscalegeometryfield_free(e,0)}[Symbol.dispose](){this.free()}get level(){return t.__wbg_get_multiscalegeometryfield_level(this.__wbg_ptr)}set level(e){t.__wbg_set_multiscalegeometryfield_level(this.__wbg_ptr,e)}static new(e,r,s,i){const n=h(r,t.__wbindgen_malloc,t.__wbindgen_realloc),o=l,a=w(s,t.__wbindgen_malloc),c=l,u=w(i,t.__wbindgen_malloc),d=l,p=t.multiscalegeometryfield_new(e,n,o,a,c,u,d);return z.__wrap(p)}has_field(e){const r=h(e,t.__wbindgen_malloc,t.__wbindgen_realloc),s=l;return 0!==t.multiscalegeometryfield_has_field(this.__wbg_ptr,r,s)}}const R="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_pageencodingdescriptor_free(e>>>0,1));class L{static __wrap(e){e>>>=0;const t=Object.create(L.prototype);return t.__wbg_ptr=e,R.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,R.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_pageencodingdescriptor_free(e,0)}[Symbol.dispose](){this.free()}pageType(){let e,r;try{const s=t.pageencodingdescriptor_pageType(this.__wbg_ptr);return e=s[0],r=s[1],a(s[0],s[1])}finally{t.__wbindgen_free(e,r,1)}}encoding(){let e,r;try{const s=t.pageencodingdescriptor_encoding(this.__wbg_ptr);return e=s[0],r=s[1],a(s[0],s[1])}finally{t.__wbindgen_free(e,r,1)}}count(){return t.pageencodingdescriptor_count(this.__wbg_ptr)}}const D="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_parquetchunk_free(e>>>0,1));class N{static __wrap(e){e>>>=0;const t=Object.create(N.prototype);return t.__wbg_ptr=e,D.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,D.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_parquetchunk_free(e,0)}[Symbol.dispose](){this.free()}size(){return t.parquetchunk_size(this.__wbg_ptr)>>>0}isEmpty(e){return 0!==t.parquetchunk_isEmpty(this.__wbg_ptr,e)}rowId(e){return t.parquetchunk_rowId(this.__wbg_ptr,e)}readX(e){const r=t.parquetchunk_readX(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}readY(e){const r=t.parquetchunk_readY(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}readCoords(e){const r=t.parquetchunk_readCoords(this.__wbg_ptr,e);let s;var i,n;return 0!==r[0]&&(s=(i=r[0],n=r[1],i>>>=0,y().subarray(i/8,i/8+n)).slice(),t.__wbindgen_free(r[0],8*r[1],8)),s}readLengths(e){const r=t.parquetchunk_readLengths(this.__wbg_ptr,e);let s;var i,n;return 0!==r[0]&&(s=(i=r[0],n=r[1],i>>>=0,b().subarray(i/4,i/4+n)).slice(),t.__wbindgen_free(r[0],4*r[1],4)),s}transformGeometry(e,r,s,i,n,o){S(e,V);const a=t.parquetchunk_transformGeometry(this.__wbg_ptr,e.__wbg_ptr,r,s,i,n,o);return 16777215===a?void 0:0!==a}boundsXMin(e){const r=t.parquetchunk_boundsXMin(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}boundsYMin(e){const r=t.parquetchunk_boundsYMin(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}boundsXMax(e){const r=t.parquetchunk_boundsXMax(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}boundsYMax(e){const r=t.parquetchunk_boundsYMax(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}readAttribute(e,r){return t.parquetchunk_readAttribute(this.__wbg_ptr,e,r)}}const G="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_parquetfile_free(e>>>0,1));class q{static __wrap(e){e>>>=0;const t=Object.create(q.prototype);return t.__wbg_ptr=e,G.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,G.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_parquetfile_free(e,0)}[Symbol.dispose](){this.free()}static fromUrl(e,r,s,i){const n=h(e,t.__wbindgen_malloc,t.__wbindgen_realloc),o=l;let a=0;return f(i)||(S(i,O),a=i.__destroy_into_raw()),t.parquetfile_fromUrl(n,o,r,s,a)}static fromBinary(e,r){const s=function(e,t){const r=t(1*e.length,1)>>>0;return o().set(e,r/1),l=e.length,r}(e,t.__wbindgen_malloc),i=l;let n=0;return f(r)||(S(r,O),n=r.__destroy_into_raw()),t.parquetfile_fromBinary(s,i,n)}version(){return t.parquetfile_version(this.__wbg_ptr)}numRows(){return t.parquetfile_numRows(this.__wbg_ptr)>>>0}numFields(){return t.parquetfile_numFields(this.__wbg_ptr)>>>0}numColumns(){return t.parquetfile_numColumns(this.__wbg_ptr)>>>0}createdBy(){const e=t.parquetfile_createdBy(this.__wbg_ptr);let r;return 0!==e[0]&&(r=a(e[0],e[1]).slice(),t.__wbindgen_free(e[0],1*e[1],1)),r}keyValueMetadata(e){const r=h(e,t.__wbindgen_malloc,t.__wbindgen_realloc),s=l,i=t.parquetfile_keyValueMetadata(this.__wbg_ptr,r,s);let n;return 0!==i[0]&&(n=a(i[0],i[1]).slice(),t.__wbindgen_free(i[0],1*i[1],1)),n}keys(){const e=t.parquetfile_keys(this.__wbg_ptr);let r;return 0!==e[0]&&(r=x(e[0],e[1]).slice(),t.__wbindgen_free(e[0],4*e[1],4)),r}columnForFieldName(e){const r=h(e,t.__wbindgen_malloc,t.__wbindgen_realloc),s=l,i=t.parquetfile_columnForFieldName(this.__wbg_ptr,r,s);return 4294967297===i?void 0:i}fields(){const e=t.parquetfile_fields(this.__wbg_ptr);var r=x(e[0],e[1]).slice();return t.__wbindgen_free(e[0],4*e[1],4),r}rowGroups(){const e=t.parquetfile_rowGroups(this.__wbg_ptr);var r=x(e[0],e[1]).slice();return t.__wbindgen_free(e[0],4*e[1],4),r}ensureFields(e){const r=v(e,t.__wbindgen_malloc),s=l;return t.parquetfile_ensureFields(this.__wbg_ptr,r,s)}readFirstChunk(e){const r=v(e,t.__wbindgen_malloc),s=l;return t.parquetfile_readFirstChunk(this.__wbg_ptr,r,s)}readChunk(e,r,s,i,n){const o=v(s,t.__wbindgen_malloc),a=l;return t.parquetfile_readChunk(this.__wbg_ptr,e,r,o,a,i,n)}readAllChunks(e,r,s){const i=v(e,t.__wbindgen_malloc),n=l;return t.parquetfile_readAllChunks(this.__wbg_ptr,i,n,r,s)}queryZChunks(e,r,s,i){const n=v(r,t.__wbindgen_malloc),o=l;return t.parquetfile_queryZChunks(this.__wbg_ptr,e,n,o,s,i)}queryXZChunks(e,r,s){return t.parquetfile_queryXZChunks(this.__wbg_ptr,e,r,s)}}const B="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_primarygeometryfield_free(e>>>0,1));class U{static __wrap(e){e>>>=0;const t=Object.create(U.prototype);return t.__wbg_ptr=e,B.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,B.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_primarygeometryfield_free(e,0)}[Symbol.dispose](){this.free()}static fromNative(e){const r=h(e,t.__wbindgen_malloc,t.__wbindgen_realloc),s=l,i=t.primarygeometryfield_fromNative(r,s);return U.__wrap(i)}static fromWkb(e){const r=h(e,t.__wbindgen_malloc,t.__wbindgen_realloc),s=l,i=t.primarygeometryfield_fromWkb(r,s);return U.__wrap(i)}static fromLocation(e,r){const s=h(e,t.__wbindgen_malloc,t.__wbindgen_realloc),i=l,n=h(r,t.__wbindgen_malloc,t.__wbindgen_realloc),o=l,a=t.primarygeometryfield_fromLocation(s,i,n,o);return U.__wrap(a)}}const j="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_quantizedgeometrybuffer_free(e>>>0,1));class V{static __wrap(e){e>>>=0;const t=Object.create(V.prototype);return t.__wbg_ptr=e,j.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,j.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_quantizedgeometrybuffer_free(e,0)}[Symbol.dispose](){this.free()}static new(){const e=t.quantizedgeometrybuffer_new();return V.__wrap(e)}readCoordsUnsafe(){return t.quantizedgeometrybuffer_readCoordsUnsafe(this.__wbg_ptr)}readLengthsUnsafe(){return t.quantizedgeometrybuffer_readLengthsUnsafe(this.__wbg_ptr)}}const W="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_rangeproviderjs_free(e>>>0,1));class Y{static __wrap(e){e>>>=0;const t=Object.create(Y.prototype);return t.__wbg_ptr=e,W.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,W.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_rangeproviderjs_free(e,0)}[Symbol.dispose](){this.free()}static new(e,r){const s=t.rangeproviderjs_new(e,r);return Y.__wrap(s)}static withFetch(){const e=t.rangeproviderjs_withFetch();return Y.__wrap(e)}}const H="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_rowgroup_free(e>>>0,1));class ${static __wrap(e){e>>>=0;const t=Object.create($.prototype);return t.__wbg_ptr=e,H.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,H.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_rowgroup_free(e,0)}[Symbol.dispose](){this.free()}columnDescriptorForAttribute(e){const r=t.rowgroup_columnDescriptorForAttribute(this.__wbg_ptr,e);return C.__wrap(r)}}function X(){const e={wbg:{}};return e.wbg.__wbg_aborted_c078e36031795a9a=function(e){return e.aborted},e.wbg.__wbg_apply_36be6a55257c99bf=function(){return s(function(e,t,r){return e.apply(t,r)},arguments)},e.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return e.buffer},e.wbg.__wbg_call_672a4d21634d4a24=function(){return s(function(e,t){return e.call(t)},arguments)},e.wbg.__wbg_call_7cccdd69e0791ae2=function(){return s(function(e,t,r){return e.call(t,r)},arguments)},e.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,r){let s,i;try{s=e,i=r,console.error(a(e,r))}finally{t.__wbindgen_free(s,i,1)}},e.wbg.__wbg_fieldmetadata_new=function(e){return k.__wrap(e)},e.wbg.__wbg_get_67b2ba62fc30de12=function(){return s(function(e,t){return Reflect.get(e,t)},arguments)},e.wbg.__wbg_length_6ca527665d89694d=function(e){return e.length},e.wbg.__wbg_length_a446193dc22c12f8=function(e){return e.length},e.wbg.__wbg_multiscalegeometryfield_unwrap=function(e){return z.__unwrap(e)},e.wbg.__wbg_new_23a2665fac83c611=function(e,r){try{var s={a:e,b:r};const i=new Promise((e,r)=>{const i=s.a;s.a=0;try{return function(e,r,s,i){t.closure9_externref_shim(e,r,s,i)}(i,s.b,e,r)}finally{s.a=i}});return i}finally{s.a=s.b=0}},e.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},e.wbg.__wbg_new_a12002a7f91c75be=function(e){return new Uint8Array(e)},e.wbg.__wbg_new_e3b321dcfef89fc7=function(e){return new Uint32Array(e)},e.wbg.__wbg_newnoargs_105ed471475aaf50=function(e,t){return new Function(a(e,t))},e.wbg.__wbg_newwithbyteoffsetandlength_f1dead44d1fc7212=function(e,t,r){return new Uint32Array(e,t>>>0,r>>>0)},e.wbg.__wbg_newwithbyteoffsetandlength_f254047f7e80e7ff=function(e,t,r){return new Int16Array(e,t>>>0,r>>>0)},e.wbg.__wbg_newwithlength_c4c419ef0bc8a1f8=function(e){return new Array(e>>>0)},e.wbg.__wbg_pageencodingdescriptor_new=function(e){return L.__wrap(e)},e.wbg.__wbg_parquetchunk_new=function(e){return N.__wrap(e)},e.wbg.__wbg_parquetfile_new=function(e){return q.__wrap(e)},e.wbg.__wbg_queueMicrotask_98e746b9f850fe3d=function(e){queueMicrotask(e)},e.wbg.__wbg_queueMicrotask_c847cc8372bec908=function(e){return e.queueMicrotask},e.wbg.__wbg_resolve_4851785c9c5f573d=function(e){return Promise.resolve(e)},e.wbg.__wbg_rowgroup_new=function(e){return $.__wrap(e)},e.wbg.__wbg_set_37837023f3d740e8=function(e,t,r){e[t>>>0]=r},e.wbg.__wbg_set_65595bdd868b3009=function(e,t,r){e.set(t,r>>>0)},e.wbg.__wbg_set_d23661d19148b229=function(e,t,r){e.set(t,r>>>0)},e.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,r){const s=h(r.stack,t.__wbindgen_malloc,t.__wbindgen_realloc),i=l;p().setInt32(e+4,i,!0),p().setInt32(e+0,s,!0)},e.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const e="undefined"==typeof global?null:global;return f(e)?0:r(e)},e.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const e="undefined"==typeof globalThis?null:globalThis;return f(e)?0:r(e)},e.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const e="undefined"==typeof self?null:self;return f(e)?0:r(e)},e.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const e="undefined"==typeof window?null:window;return f(e)?0:r(e)},e.wbg.__wbg_then_44b73946d2fb3e7d=function(e,t){return e.then(t)},e.wbg.__wbg_then_48b406749878a531=function(e,t,r){return e.then(t,r)},e.wbg.__wbg_valueOf_fdbb54fcdfe33477=function(e){return e.valueOf()},e.wbg.__wbindgen_array_new=function(){return[]},e.wbg.__wbindgen_array_push=function(e,t){e.push(t)},e.wbg.__wbindgen_bigint_from_i64=function(e){return e},e.wbg.__wbindgen_cb_drop=function(e){const t=e.original;return 1==t.cnt--&&(t.a=0,!0)},e.wbg.__wbindgen_closure_wrapper1683=function(e,r,s){const i=function(e,r,s,i){const n={a:e,b:r,cnt:1,dtor:84},o=(...e)=>{n.cnt++;const r=n.a;n.a=0;try{return i(r,n.b,...e)}finally{0===--n.cnt?(t.__wbindgen_export_6.get(n.dtor)(r,n.b),m.unregister(n)):n.a=r}};return o.original=n,m.register(o,n,n),o}(e,r,0,M);return i},e.wbg.__wbindgen_init_externref_table=function(){const e=t.__wbindgen_export_2,r=e.grow(4);e.set(0,void 0),e.set(r+0,void 0),e.set(r+1,null),e.set(r+2,!0),e.set(r+3,!1)},e.wbg.__wbindgen_is_function=function(e){return"function"==typeof e},e.wbg.__wbindgen_is_undefined=function(e){return void 0===e},e.wbg.__wbindgen_memory=function(){return t.memory},e.wbg.__wbindgen_number_get=function(e,t){const r="number"==typeof t?t:void 0;p().setFloat64(e+8,f(r)?0:r,!0),p().setInt32(e+0,!f(r),!0)},e.wbg.__wbindgen_number_new=function(e){return e},e.wbg.__wbindgen_string_new=function(e,t){return a(e,t)},e.wbg.__wbindgen_throw=function(e,t){throw new Error(a(e,t))},e.wbg.__wbindgen_uint8_array_new=function(e,r){var s,i,n=(s=e,i=r,s>>>=0,o().subarray(s/1,s/1+i)).slice();return t.__wbindgen_free(e,1*r,1),n},e}function Q(e,r){return t=e.exports,Z.__wbindgen_wasm_module=r,d=null,g=null,_=null,n=null,t.__wbindgen_start(),t}async function Z(e){if(void 0!==t)return t;void 0!==e&&(Object.getPrototypeOf(e)===Object.prototype?({module_or_path:e}=e):console.warn("using deprecated parameters for the initialization function; pass a single object instead"));const r=X();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:s,module:i}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}(await e,r);return Q(s,i)}e.ColumnDescriptor=C,e.FieldMetadata=k,e.GeometryInfo=O,e.GeometryType=I,e.MultiscaleGeometryField=z,e.PageEncodingDescriptor=L,e.ParquetChunk=N,e.ParquetFile=q,e.PrimaryGeometryField=U,e.QuantizedGeometryBuffer=V,e.RangeProviderJs=Y,e.RowGroup=$,e.default=Z,e.enableTracing=function(){t.enableTracing()},e.initSync=function(e){if(void 0!==t)return t;void 0!==e&&(Object.getPrototypeOf(e)===Object.prototype?({module:e}=e):console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const r=X();return e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e)),Q(new WebAssembly.Instance(e,r),e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/FeatureSetReaderParquet":function(){define(["exports","../../../../../core/has","../../../../../core/memoryEstimations","../../../../../layers/graphics/OptimizedGeometry","../../../../../chunks/bundle","./FeatureSetReader"],function(e,t,r,s,i,n){"use strict";let o;class a extends n.FeatureSetReader{constructor(e,t,s,i,n=new Uint32Array(s.size())){super(e),this._fields=t,this._inner=s,this._chunkId=i,this._displayIds=n,this._index=-1,this.usedMemory=r.baseObjectMemory,this._size=this._inner.size(),e.featureIdInfo.type,this._chunkId>65535&&console.error("Exceeded max allowed parquet reader size")}destroy(){super.destroy(),this._inner.free()}get fields(){return this._fields}get geometryType(){return this.metadata.geometryType}get hasFeatures(){return!0}get hasNext(){throw new Error("Method not implemented.")}get exceededTransferLimit(){return!1}get hasZ(){return!1}get hasM(){return!1}getInTransform(){return null}getSize(){return this._size}getCursor(){return this.copy()}getAttributeHash(){let e="";for(const t of this.fields.fields)e+=this._readAttribute(t.name,!1)+".";return e}getObjectId(){return this._inner.rowId(this._index)}getDisplayId(){return this._displayIds[this._index]}setDisplayId(e){this._displayIds[this._index]=e}setIndex(e){this._index=e}getBoundsXMin(){return this._inner.boundsXMin(this._index)}getBoundsYMin(){return this._inner.boundsYMin(this._index)}getBoundsXMax(){return this._inner.boundsXMax(this._index)}getBoundsYMax(){return this._inner.boundsYMax(this._index)}setBoundsXMin(e){throw new Error("InternalError: Setting bounds is unsupported")}setBoundsYMin(e){throw new Error("InternalError: Setting bounds is unsupported")}setBoundsXMax(e){throw new Error("InternalError: Setting bounds is unsupported")}setBoundsYMax(e){throw new Error("InternalError: Setting bounds is unsupported")}getIndex(){return this._index}next(){for(;++this._index<this._size&&!this._getExists(););return this._index<this._size}readGeometryArea(){return this.readGeometryForDisplay()?.area()??0}copy(){const e=new a(this.metadata,this._fields,this._inner,this._chunkId,this._displayIds);return this.copyInto(e),e}copyInto(e){super.copyInto(e),e._index=this._index}readGeometryForDisplayTransformed(e){const[t,r]=e.translate,[n,a]=e.scale;return o||(o=i.QuantizedGeometryBuffer.new()),this._inner.transformGeometry(o,t,r,n,a,this._index)?new s(o.readLengthsUnsafe(),o.readCoordsUnsafe()):null}_readGeometry(e){const t=this._inner.readCoords(this._index),r=this._inner.readLengths(this._index);return t&&r?new s(r,t):null}_readX(){return this._inner.readX(this._index)}_readY(){return this._inner.readY(this._index)}_readServerCentroid(){return null}_readAttribute(e,t){const r=this.fields.get(e);if(!r)return;if(null==r.column)return this.getObjectId();const s=this._inner.readAttribute(this._index,r.column);if(null==s)return s;const i=this.fields.isDateField(r.name);return t?null==s?s:i?new Date(s):s:s}_readAttributes(){const e={};for(const t of this._fields.fields)null!=t.column&&(this._inner.isEmpty(t.column)||(e[t.name]=this._readAttribute(t.name,!1)));return e.__OBJECTID=this.getObjectId(),e}}e.FeatureSetReaderParquet=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/ParquetTileLoadStrategy":function(){define(["exports","../../../../../../core/QueueProcessor","../../../../../../core/SetUtils","../../../../../../geometry/Polygon","../../../../../../geometry/SpatialReference","../../../../../../geometry/support/aaBoundingRect","../../../../../../layers/graphics/featureConversionUtils","../../../../../../layers/graphics/OptimizedGeometry","../../../../../../layers/graphics/data/projectionSupport","../../../../../../layers/support/FieldsIndex","../../../../../../libs/parquet/parquet","./ALoadStrategy","./chunks/ParquetSourceChunk","../../support/FeatureSetReaderParquet"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p){"use strict";class f extends h.ALoadStrategy{constructor(e,t,r,s){super(s),this._metadata=t,this._schema=r,this._files=[];const i=new Set(r.mutable.availableFields);if(!e.geometryInfo.displayOptimization)throw new Error("InternalError: ParquetTileLoadStrategy only supports XZ-enabled parquet files");this._index=m.create(t,e,i,s,()=>this._schema.mutable.dataFilter.customParameters)}destroy(){super.destroy();for(const e of this._files)e.free()}get about(){return{supportsDisplayFilter:!1,willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}async load(e){const t=await this._index;await t.ensureLoaded(e)}unload(e){this._index.then(t=>t.unload(e.tile))}async updateFields(e){return(await this._index).updateFields(e)}async addParquetFile(e){throw new Error("Impl!")}}class m{static async create(e,t,r,s,i){const n=await Promise.all(t.source.urls.map(e=>u.createParquetFile(e,{geometryInfo:t.geometryInfo,outSpatialReference:t.outSpatialReference,getCustomParameters:i}))),[o]=n,a=o.fields().map(e=>({name:e.name,alias:e.name,type:e.type,column:o.columnForFieldName(e.name)})),{timeZoneByFieldName:l}=t.metadata.fieldsIndex,h=c.fromJSON({fields:a,timeZoneByFieldName:l}),d=new Uint32Array(Array.from(r.values()).map(e=>h.get(e)?.column).filter(e=>null!=e)),p=t.geometryInfo.displayOptimization;if(!p)throw new Error("InternalError: tiled parquet load requires display optimization");return new m(e,await Promise.all(n),h,d,s,r,p)}constructor(e,r,s,i,n,o,a){this._metadata=e,this._files=r,this._fieldsIndex=s,this._fieldIndices=i,this._store=n,this._availableFields=o,this._displayOptimization=a,this._queue=new t.QueueProcessor({concurrency:1,process:e=>this._ensureLoaded(e)}),this._tileIdToChunkId=new Map}get file(){return this._files[0]}async ensureLoaded(e){return this._queue.push(e)}unload(e){const t=this._tileIdToChunkId.get(e.id);if(null!=t){for(const e of t)this._store.removeById(e);this._tileIdToChunkId.delete(e.id)}}async _ensureLoaded(e){const t=this._metadata.outSpatialReference,r=e.tile,{xmin:c,ymin:u,xmax:h,ymax:f}=function(e,t){const r=[e.xmin,e.ymin,e.xmax,e.ymax],c=s.fromExtent(n.toExtent(r,t)),u=l.project(c,t,i.WGS84);if(!u)return null;const h=o.convertFromPolygon(new a,u,!1,!1),d=h.coords.filter((e,t)=>!(t%2)),p=h.coords.filter((e,t)=>t%2);return{xmin:Math.min(...d),ymin:Math.min(...p),xmax:Math.max(...d),ymax:Math.max(...p)}}(r.extent,t);let m=0;const g={extent:r.extent,extent_lat_lng:{xmin:c,ymin:u,xmax:h,ymax:f},tile_level:r.level,attributes:this._fieldIndices};if("z"===this._displayOptimization.mode?await this.file.queryZChunks(g.extent_lat_lng,this._fieldIndices,e.signal,t=>{if(e.signal.aborted)return;const s=new p.FeatureSetReaderParquet(this._metadata,this._fieldsIndex,t,m),i=new d.ParquetSourceChunk(this._metadata,s,r,m++,!1);this._insertChunk(r,i)}):await this.file.queryXZChunks(g,e.signal,t=>{if(e.signal.aborted)return;const s=new p.FeatureSetReaderParquet(this._metadata,this._fieldsIndex,t,m),i=new d.ParquetSourceChunk(this._metadata,s,r,m++,!1);this._insertChunk(r,i)}),e.signal.aborted)return;const y=new d.ParquetSourceChunk(this._metadata,null,r,m++,!0);this._insertChunk(r,y)}_insertChunk(e,t){let r=this._tileIdToChunkId.get(e.id);null==r&&(r=[],this._tileIdToChunkId.set(e.id,r)),r.push(t.chunkId),this._store.insert(t)}async updateFields(e){const t=new Set(e),s=r.difference(t,this._availableFields);if(this._availableFields=r.union(s,this._availableFields),s.size)for(const e of this._files){const t=Array.from(s).map(e=>this._fieldsIndex.get(e)?.column);await e.ensureFields(new Uint32Array(t))}}}e.ParquetTileLoadStrategy=f,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/ParquetSourceChunk":function(){define(["exports","./ASourceChunk","../../../support/FeatureSetReaderIndirect","../../../support/FeatureSetReaderJSON"],function(e,t,r,s){"use strict";class i extends t.ASourceChunk{constructor(e,t,r,s,i){super(),this._metadata=e,this._reader=t,this._tile=r,this._page=s,this._end=i,this.chunkId=`${this._tile.key.id}.${this._page}${this.end?"e":""}`,this.normalizedChunkId=`${this._tile.key.normalizedId}.${this._page}${this.end?"e":""}`}get reader(){return this._reader??s.FeatureSetReaderJSON.empty(this._metadata)}get first(){return 0===this._page}get end(){return this._end}get tile(){return this.tile}get queryInfo(){return{type:"parquet",chunkId:this.chunkId,queryJSON:null,page:this._page,size:this.size(),tileId:this._tile.id,end:this.end}}get isTiled(){return!0}getTileReader(e){if(this._tile.key.id===e.key.id){const t=[];for(let e=0;e<this.reader.getSize();e++)t.push(e);const s=r.FeatureSetReaderIndirect.from(this.reader,t);return s.setTransformForDisplay(e.transform),s}return null}}e.ParquetSourceChunk=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/SnapshotLoadStrategy":function(){define(["exports","../../../../../../core/Error","../../../../../../core/has","../../../../../../core/promiseUtils","../../../../../../rest/support/QuantizationParameters","./AFetchLoadStrategy","./chunks/FeatureSnapshotSourceChunk","../../support/FeatureSetReaderJSON"],function(e,t,r,s,i,n,o,a){"use strict";class l extends n.AFetchLoadStrategy{constructor(e,t,r,s,i,n){super(e,t,r,i,n),this._snapshotInfo=s}get about(){return{supportsDisplayFilter:!1,willQueryAllFeatures:!0,willQueryFullResolutionGeometry:!0}}load(e){return null==this._promise&&(this._promise=this._download()),this._promise}unload(e){}async _download(){const e=this._snapshotInfo.initialTolerance,t=e?new i({mode:"view",originPosition:"upper-left",tolerance:e}):null;await this._downloadStreaming(t),null!=t&&await this._downloadRefresh()}async _downloadStreaming(e){try{for await(const t of this._fetchPages(e))this._store.insert(t)}catch(e){throw new t("featurelayer-query","Encountered error when downloading data",{error:e})}}async _downloadRefresh(){try{const e=[];for await(const t of this._fetchPages(null))e.push(t);this._store.clear();for(const t of e)this._store.insert(t);this._store.refresh()}catch(e){throw new t("featurelayer-query","Encountered error when downloading data",{error:e})}}async*_fetchPages(e){let t;try{for await(const t of this._concurrentPageStream(e))0!==t.size()&&(yield t)}catch(e){t=e}if(t&&s.isAbortError(t)||(yield new o.FeatureSnapshotSourceChunk(a.FeatureSetReaderJSON.empty(this._metadata),null,-1,!0)),t)throw t}async*_concurrentPageStream(e){const t=r("featurelayer-snapshot-concurrency"),s=this._pageStreamAll(e),i=[];let n=!1,o=1;for(;!n;){const e=[];for(;!n&&i.length<o;){const t=s.next();if(!t.value){n=!0;break}const r=t.value;r.then(e=>{e.reader.exceededTransferLimit||(n=!0)}).catch(e=>{n=!0}).finally(()=>{i.splice(i.indexOf(r),1)}),i.push(r),e.push(r)}for(const t of e)yield t;i.length&&await Promise.race(i),o<t&&(o+=1)}}*_pageStreamAll(e){const t=Math.ceil(this._snapshotInfo.maxFeatureCount/this._queryInfo.pageSize);for(let r=0;r<t;r++)yield this._downloadPage(r,e)}async _downloadPage(e,t){s.throwIfAborted(this._options);const r=this._queryInfo.createPagedQuery(e,t),i=await this._fetch(r,this._options,{chunkId:e.toString()}),n=new o.FeatureSnapshotSourceChunk(i,r.inner.toJSON(),e,!1);return s.throwIfAborted(this._options),n}}e.SnapshotLoadStrategy=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/StreamLoadStrategy":function(){define(["exports","../../../../../../core/Evented","../../../../../../core/handleUtils","../../../../../../core/has","../../../../../../core/maybe","../../../../../../layers/graphics/data/StreamFeatureManager","../../../../../../layers/graphics/sources/connections/createConnection","../../../../../../layers/support/streamLayerUtils","../StreamConnectionState","../StreamFeatureStore","./ALoadStrategy","./chunks/StreamSourceChunk"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";class d extends u.ALoadStrategy{constructor(e,r,s,i,o){super(s),this._service=e,this._dataFilter=r,this._streamOptions=i,this._metadata=o,this._connectionState=new l.StreamConnectionState,this._forceRefresh=!1,this.events=new t.EventEmitter;const{timeInfo:u}=this._metadata,{purgeOptions:h}=r;this._stagingStore=new c.StreamFeatureStore(this._metadata.weakCloneWithAdditionalFields([{name:a.internalTimeReceivedField,alias:"timeReceived",type:"esriFieldTypeDate"}]),e=>this.events.emit("features-updated",e)),this._manager=new n.StreamFeatureManager(this._stagingStore,o.featureIdInfo,u,h),this.connect()}destroy(){super.destroy(),this.disconnect()}get about(){return{supportsDisplayFilter:!1,willQueryAllFeatures:!1,willQueryFullResolutionGeometry:!1}}get connectionStatus(){return this._connectionState.connectionStatus}get errorString(){return this._connectionState?.errorString}async refresh(){const e=null!=this._chunk;return this._manager.checkForUpdates()||!e||this._forceRefresh?(this._chunk&&this._store.remove(this._chunk),this._forceRefresh=!1,this._chunk=new h.StreamSourceChunk(this._stagingStore.reader),this._store.insert(this._chunk),this.events.emit("tick"),!0):(this.events.emit("tick"),!1)}async updateFields(e){throw new Error("Updating available fields not supported for StreamLayer")}async load(e){}unload(e){}disconnect(){this._connection=i.destroyMaybe(this._connection),this._connectionState.connection=null,this._handlesGroup?.remove()}connect(){if(null!=this._connection)return;const{geometryType:e,spatialReference:t}=this._metadata,{maxReconnectionAttempts:s,maxReconnectionInterval:i,geometryDefinition:n,definitionExpression:a,customParameters:l}=this._dataFilter;this._connection=o.createConnection(this._service.source,t,this._streamOptions.outSR,e,a,n,s,i,l),this._handlesGroup=r.handlesGroup([this._connection.on("data-received",e=>this._onFeature(e)),this._connection.on("message-received",e=>this._onWebSocketMessage(e))]),this._connectionState.connection=this._connection}clear(){this._manager.checkForUpdates(),this._stagingStore.clear(),this._forceRefresh=!0}updateCustomParameters(e){this._connection?.updateCustomParameters(e)}sendMessageToSocket(e){this._connection?.sendMessageToSocket(e)}sendMessageToClient(e){this._connection?.sendMessageToClient(e)}_onWebSocketMessage(e){if("type"in e)switch(e.type){case"delete":if(e.objectIds)for(const t of e.objectIds)this._manager.removeById(t);if(e.trackIds)for(const t of e.trackIds)this._manager.removeByTrackId(t);break;case"clear":this.clear()}this.events.emit("message-received",e)}_onFeature(e){try{this._manager.add(e),this.events.emit("data-received",e)}catch(e){}}}e.StreamLoadStrategy=d,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/StreamFeatureManager":function(){define(["exports","../../../core/CircularArray","../../../core/Error","../../../core/mathUtils","../../support/streamLayerUtils"],function(e,t,r,s,i){"use strict";e.StreamFeatureManager=class{constructor(e,t,s,n,o=128){if(this._trackIdToObservations=new Map,this._idCounter=0,this._lastPurge=performance.now(),this._addOrUpdated=new Map,this._removed=[],this._maxAge=0,this._timeInfo=s,this._purgeOptions=n,this.store=e,"unique-id-composite"===t.type)throw new r("stream-layer","composite uniqueIds are not supported");this.idField=t.fieldName,this.purgeInterval=o,this._useGeneratedIds=this.idField===i.defaultStreamIdField}removeById(e){this._removed.push(e)}removeByTrackId(e){const t=this._trackIdToObservations.get(e);if(t)for(const e of t.entries)this._removed.push(e)}add(e){if(this._useGeneratedIds){const t=this._nextId();e.attributes[this.idField]=t,e.objectId=t}else e.objectId=e.attributes[this.idField];const r=e.objectId;if(this._addOrUpdated.set(r,e),this._maxAge=Math.max(this._maxAge,e.attributes[this._timeInfo.startTimeField]),!this._timeInfo.trackIdField)return null==this._trackIdLessObservations&&(this._trackIdLessObservations=new t(1e5)),void this._trackIdLessObservations.enqueue(r);const i=e.attributes[this._timeInfo.trackIdField];if(!this._trackIdToObservations.has(i)){const e=null!=this._purgeOptions?.maxObservations?this._purgeOptions.maxObservations:1e3,r=s.clamp(e,0,1e3);this._trackIdToObservations.set(i,new t(r))}const n=this._trackIdToObservations.get(i),o=n?.enqueue(r);null!=o&&(this._addOrUpdated.has(o)?this._addOrUpdated.delete(o):this._removed.push(o))}checkForUpdates(){const e=this._getToAdd(),t=this._getToRemove(),r=performance.now(),s=r-this._lastPurge,n=Date.now();s>=this.purgeInterval&&(this._purge(r),this._lastPurge=r);const o=[];if(null!=t)for(const e of t){const t=this.store.removeById(e);null!=t&&o.push(t)}const a=[];if(null!=e){const s=new Set(t??[]);for(const t of e)s.has(t.objectId)||(t.attributes[i.esriTimestamp]=r,t.attributes[i.internalTimeReceivedField]=n,this.store.add(t),a.push(t))}return!(!a.length&&!o?.length||(this.store.update(a,o),0))}_getToAdd(){if(!this._addOrUpdated.size)return null;const e=new Array(this._addOrUpdated.size);let t=0;return this._addOrUpdated.forEach(r=>e[t++]=r),this._addOrUpdated.clear(),e}_getToRemove(){const e=this._removed;return this._removed.length?(this._removed=[],e):null}_nextId(){const e=this._idCounter;return this._idCounter=(this._idCounter+1)%4294967294+1,e}_purge(e){const t=this._purgeOptions;null!=t&&(this._purgeSomeByDisplayCount(t),this._purgeByAge(t),this._purgeByAgeReceived(e,t),this._purgeTracks())}_purgeSomeByDisplayCount(e){if(!e.displayCount)return;let t=this.store.size;if(t>e.displayCount){if(this._timeInfo.trackIdField)for(const r of this._trackIdToObservations.values())if(t>e.displayCount&&r.size){const e=r.dequeue();this._removed.push(e),t--}if(null!=this._trackIdLessObservations){let r=t-e.displayCount;for(;r-- >0;){const e=this._trackIdLessObservations.dequeue();null!=e&&this._removed.push(e)}}}}_purgeByAge(e){const t=this._timeInfo?.startTimeField;if(!e.age||!t)return;const r=60*e.age*1e3,s=this._maxAge-r;this.store.forEach(e=>{e.attributes[t]<s&&this._removed.push(e.objectId)})}_purgeByAgeReceived(e,t){if(!t.ageReceived)return;const r=e-60*t.ageReceived*1e3;this.store.forEach(e=>{e.attributes[i.esriTimestamp]<r&&this._removed.push(e.objectId)})}_purgeTracks(){this._trackIdToObservations.forEach((e,t)=>{0===e.size&&this._trackIdToObservations.delete(t)})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/CircularArray":function(){define(function(){"use strict";return class{constructor(e){this.size=0,this._start=0,this.maxSize=e,this._buffer=new Array(e)}get entries(){return this._buffer}enqueue(e){if(this.size===this.maxSize){const t=this._buffer[this._start];return this._buffer[this._start]=e,this._start=(this._start+1)%this.maxSize,t}return this._buffer[(this._start+this.size++)%this.maxSize]=e,null}dequeue(){if(0===this.size)return null;const e=this._buffer[this._start];return this._buffer[this._start]=null,this.size--,this._start=(this._start+1)%this.maxSize,e}peek(){return 0===this.size?null:this._buffer[this._start]}peekLast(){return 0===this.size?null:this._buffer[(this._start+(this.size-1))%this.maxSize]}find(e){if(0===this.size)return null;for(const t of this._buffer)if(null!=t&&e(t))return t;return null}clear(e){let t=this.dequeue();for(;null!=t;)e&&e(t),t=this.dequeue()}}})},"esri/layers/graphics/sources/connections/createConnection":function(){define(["exports","./GeoEventConnection","./WebSocketConnection","../../../support/ClientSideConnection"],function(e,t,r,s){"use strict";function i(e,t){if(null==e&&null==t)return null;const r={};return null!=t&&(r.geometry=t),null!=e&&(r.where=e),r}e.createConnection=function(e,n,o,a,l,c,u,h,d){const p={source:e,sourceSpatialReference:n,spatialReference:o,geometryType:a,filter:i(l,c),maxReconnectionAttempts:u,maxReconnectionInterval:h,customParameters:d};return e?e.path.startsWith("wss://")||e.path.startsWith("ws://")?new r.WebSocketConnection(p):new t(p):new s.ClientSideConnection(p)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/sources/connections/GeoEventConnection":function(){define(["require","exports","../../../../chunks/tslib.es6","../../../../request","../../../../core/Error","../../../../core/Logger","../../../../core/promiseUtils","../../../../core/urlUtils","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/SpatialReference","../../../../geometry/support/jsonUtils","./WebSocketConnection","../../../../rest/query/operations/query","../../../../rest/support/Query"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m){"use strict";const g=e=>Object.freeze(Object.defineProperty({__proto__:null,default:e},Symbol.toStringTag,{value:"Module"})),y={maxQueryDepth:5,maxRecordCountFactor:3};return t.default=class extends p.WebSocketConnection{constructor(e){super({...y,...e}),this._buddyServicesQuery=null,this._relatedFeatures=null}async _open(){const e=await this._fetchServiceDefinition(this._config.source);e.timeInfo.trackIdField||n.getLogger(this).warn("GeoEvent service was configured without a TrackIdField. This may result in certain functionality being disabled. The purgeOptions.maxObservations property will have no effect.");const t=this._fetchWebSocketUrl(e.streamUrls,this._config.spatialReference);this._buddyServicesQuery||(this._buddyServicesQuery=this._queryBuddyServices()),await this._buddyServicesQuery,await this._tryCreateWebSocket(t);const{filter:r,outFields:s}=this._config;this.destroyed||this._setFilter(r,s)}_onMessage(e){if("attributes"in e){let t;try{t=this._enrich(e),null!=this._featureZScaler&&this._featureZScaler(t.geometry)}catch(e){return void n.getLogger(this).error(new i("geoevent-connection","Failed to parse message",e))}this.onFeature(t)}else this.onMessage(e)}async _fetchServiceDefinition(e){const t={f:"json",...this._config.customParameters},r=s(e.path,{query:t,responseType:"json"}),i=(await r).data;return this._serviceDefinition=i,i}_fetchWebSocketUrl(e,t){const r=e[0],{urls:s,token:i}=r,n=this._inferWebSocketBaseUrl(s);return a.addQueryParameters(`${n}/subscribe`,{outSR:""+t.wkid,token:i})}_inferWebSocketBaseUrl(e){if(1===e.length)return e[0];for(const t of e)if(t.includes("wss"))return t;return n.getLogger(this).error(new i("geoevent-connection","Unable to infer WebSocket url",e)),null}async _setFilter(e,t){const r=this._websocket;if(null==r||null==e&&null==t)return;const s=JSON.stringify({filter:this._serializeFilter(e,t)});let a=!1;const l=o.createResolver();return r.onmessage=e=>{const t=JSON.parse(e.data);t.filter&&(t.error&&(n.getLogger(this).error(new i("geoevent-connection","Failed to set service filter",t.error)),this._set("errorString",`Could not set service filter - ${t.error}`),l.reject(t.error)),this._setWebSocketJSONParseHandler(r),a=!0,l.resolve())},r.send(s),setTimeout(()=>{a||(this.destroyed||this._websocket!==r||n.getLogger(this).error(new i("geoevent-connection","Server timed out when setting filter")),l.reject())},1e4),l.promise}_serializeFilter(e,t){const r={};if(null==e&&null==t)return r;if(e?.geometry)try{const t=d.fromJSON(e.geometry);if("extent"!==t.type)throw new i("geoevent-connection",`Expected extent but found type ${t.type}`);r.geometry=JSON.stringify(t.shiftCentralMeridian())}catch(e){n.getLogger(this).error(new i("geoevent-connection","Encountered an error when setting connection geometryDefinition",e))}return e?.where&&"1 = 1"!==e.where&&"1=1"!==e.where&&(r.where=e.where),null!=t&&(r.outFields=t.join(",")),r}_enrich(e){if(!this._relatedFeatures)return e;const t=this._serviceDefinition.relatedFeatures.joinField,r=e.attributes[t],s=this._relatedFeatures.get(r);if(!s)return n.getLogger(this).warn("geoevent-connection","Feature join failed. Is the join field configured correctly?",e),e;const{attributes:o,geometry:a}=s;for(const t in o)e.attributes[t]=o[t];return a&&(e.geometry=a),e.geometry||e.centroid||n.getLogger(this).error(new i("geoevent-connection","Found malformed feature - no geometry found",e)),e}async _queryBuddyServices(){try{const{relatedFeatures:e,keepLatestArchive:t}=this._serviceDefinition,r=this._queryRelatedFeatures(e),s=this._queryArchive(t);await r;const i=await s;if(!i)return;for(const e of i.features)this.onFeature(this._enrich(e))}catch(e){n.getLogger(this).error(new i("geoevent-connection","Encountered an error when querying buddy services",{error:e}))}}async _queryRelatedFeatures(e){if(!e)return;const t=await this._queryBuddy(e.featuresUrl);this._addRelatedFeatures(t)}async _queryArchive(e){if(e)return this._queryBuddy(e.featuresUrl)}async _queryBuddy(t){const r=new((await new Promise((t,r)=>e(["../../../FeatureLayer"],e=>t(g(e)),r))).default)({url:t}),{capabilities:s}=await r.load(),i=s.query.supportsMaxRecordCountFactor,n=s.query.supportsPagination,o=s.query.supportsCentroid,a=this._config.maxRecordCountFactor,l=r.capabilities.query.maxRecordCount,c=i?l*a:l,u=new m;if(u.outFields=this._config.outFields??["*"],u.where=this._config.filter?.where??"1=1",u.returnGeometry=!0,u.returnExceededLimitFeatures=!0,u.outSpatialReference=h.fromJSON(this._config.spatialReference),o&&(u.returnCentroid=!0),i&&(u.maxRecordCountFactor=a),n)return u.num=c,r.destroy(),this._queryPages(t,u);const d=await f.executeQuery(t,u,this._config.sourceSpatialReference);return r.destroy(),d.data}async _queryPages(e,t,r=[],s=0){t.start=null!=t.num?s*t.num:null;const{data:i}=await f.executeQuery(e,t,this._config.sourceSpatialReference);return i.exceededTransferLimit&&s<(this._config.maxQueryDepth??0)?(i.features.forEach(e=>r.push(e)),this._queryPages(e,t,r,s+1)):(r.forEach(e=>i.features.push(e)),i)}_addRelatedFeatures(e){const t=new Map,r=e.features,s=this._serviceDefinition.relatedFeatures.joinField;for(const e of r){const r=e.attributes[s];t.set(r,e)}this._relatedFeatures=t}},t.default=r.__decorate([u.subclass("esri.layers.graphics.sources.connections.GeoEventConnection")],t.default),t.default})},"esri/layers/graphics/sources/connections/WebSocketConnection":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Error","../../../../core/Logger","../../../../core/promiseUtils","../../../../core/urlUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/support/zscale","../../../support/StreamConnection"],function(e,t,r,s,i,n,o,a,l,c,u,h){"use strict";e.WebSocketConnection=class extends h{constructor(e){super({}),this._outstandingMessages=[],this.errorString=null;const{geometryType:t,spatialReference:r,sourceSpatialReference:s}=e;this._config=e,this._featureZScaler=u.getGeometryZScaler(t,s,r),this._open()}normalizeCtorArgs(){return{}}async _open(){await this._tryCreateWebSocket(),this.destroyed||await this._handshake()}destroy(){super.destroy(),null!=this._websocket&&(this._websocket.onopen=null,this._websocket.onclose=null,this._websocket.onerror=null,this._websocket.onmessage=null,this._websocket.close()),this._websocket=null}get connectionStatus(){if(null==this._websocket)return"disconnected";switch(this._websocket.readyState){case 0:case 1:return"connected";case 2:case 3:return"disconnected"}}sendMessageToSocket(e){null!=this._websocket?this._websocket.send(JSON.stringify(e)):this._outstandingMessages.push(e)}sendMessageToClient(e){this._onMessage(e)}updateCustomParameters(e){this._config.customParameters=e,null!=this._websocket&&this._websocket.close()}async _tryCreateWebSocket(e=this._config.source.path,t=1e3,o=0){try{if(this.destroyed)return;const t=n.addQueryParameters(e,this._config.customParameters??{});this._websocket=await this._createWebSocket(t),this.notifyChange("connectionStatus")}catch(n){const a=t/1e3;return this._config.maxReconnectionAttempts&&o>=this._config.maxReconnectionAttempts?(s.getLogger(this).error(new r("websocket-connection","Exceeded maxReconnectionAttempts attempts. No further attempts will be made")),void this.destroy()):(s.getLogger(this).error(new r("websocket-connection",`Failed to connect. Attempting to reconnect in ${a}s`,n)),await i.after(t),this._tryCreateWebSocket(e,Math.min(1.5*t,1e3*this._config.maxReconnectionInterval),o+1))}}_setWebSocketJSONParseHandler(e){e.onmessage=e=>{try{const t=JSON.parse(e.data);this._onMessage(t)}catch(e){return void s.getLogger(this).error(new r("websocket-connection","Failed to parse message, invalid JSON",{error:e}))}}}_createWebSocket(e){return new Promise((t,r)=>{const s=new WebSocket(e);s.onopen=()=>{if(s.onopen=null,this.destroyed)return s.onclose=null,void s.close();s.onclose=e=>this._onClose(e),s.onerror=e=>this._onError(e),this._setWebSocketJSONParseHandler(s),t(s)},s.onclose=e=>{s.onopen=s.onclose=null,r(e)}})}async _handshake(e=1e4){const t=this._websocket;if(null==t)return;const n=i.createResolver(),o=t.onmessage,{filter:a,outFields:l,spatialReference:c}=this._config;return n.timeout(e),t.onmessage=e=>{let i=null;try{i=JSON.parse(e.data)}catch(e){}i&&"object"==typeof i||(s.getLogger(this).error(new r("websocket-connection","Protocol violation. Handshake failed - malformed message",e.data)),n.reject(),this.destroy()),i.spatialReference?.wkid!==c?.wkid&&(s.getLogger(this).error(new r("websocket-connection",`Protocol violation. Handshake failed - expected wkid of ${c.wkid}`,e.data)),n.reject(),this.destroy()),"json"!==i.format&&(s.getLogger(this).error(new r("websocket-connection","Protocol violation. Handshake failed - format is not set",e.data)),n.reject(),this.destroy()),a&&i.filter!==a&&s.getLogger(this).error(new r("websocket-connection","Tried to set filter, but server doesn't support it")),l&&i.outFields!==l&&s.getLogger(this).error(new r("websocket-connection","Tried to set outFields, but server doesn't support it")),t.onmessage=o;for(const e of this._outstandingMessages)t.send(JSON.stringify(e));this._outstandingMessages=[],n.resolve()},t.send(JSON.stringify({filter:a,outFields:l,format:"json",spatialReference:{wkid:c.wkid}})),n.promise}_onMessage(e){if(this.onMessage(e),"type"in e)switch(e.type){case"features":case"featureResult":for(const t of e.features)null!=this._featureZScaler&&this._featureZScaler(t.geometry),this.onFeature(t)}}_onError(e){const t="Encountered an error over WebSocket connection";this._set("errorString",t),s.getLogger(this).error("websocket-connection",t)}_onClose(e){this._websocket=null,this.notifyChange("connectionStatus"),1e3!==e.code&&s.getLogger(this).error("websocket-connection",`WebSocket closed unexpectedly with error code ${e.code}`),this.destroyed||this._open()}},t.__decorate([o.property()],e.WebSocketConnection.prototype,"connectionStatus",null),t.__decorate([o.property()],e.WebSocketConnection.prototype,"errorString",void 0),e.WebSocketConnection=t.__decorate([c.subclass("esri.layers.graphics.sources.connections.WebSocketConnection")],e.WebSocketConnection),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/StreamConnection":function(){define(["exports","../../chunks/tslib.es6","../../core/Error","../../core/Evented","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a,l){"use strict";return e.default=class extends s.EventedAccessor{destroy(){this.emit("destroy")}get connectionError(){return this.errorString?new r("stream-connection",this.errorString):null}onFeature(e){this.emit("data-received",e)}onMessage(e){this.emit("message-received",e)}},t.__decorate([i.property({readOnly:!0})],e.default.prototype,"connectionError",null),e.default=t.__decorate([l.subclass("esri.layers.support.StreamConnection")],e.default),e.default})},"esri/layers/support/ClientSideConnection":function(){define(["exports","../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/support/zscale","./StreamConnection"],function(e,t,r,s,i,n,o,a,l){"use strict";e.ClientSideConnection=class extends l{constructor(e){super({}),this.connectionStatus="connected",this.errorString=null;const{geometryType:t,spatialReference:r,sourceSpatialReference:s}=e;this._featureZScaler=a.getGeometryZScaler(t,s,r)}normalizeCtorArgs(){return{}}updateCustomParameters(e){}sendMessageToSocket(e){}sendMessageToClient(e){if("type"in e)switch(e.type){case"features":case"featureResult":for(const t of e.features)null!=this._featureZScaler&&this._featureZScaler(t.geometry),this.onFeature(t)}this.onMessage(e)}},t.__decorate([r.property()],e.ClientSideConnection.prototype,"connectionStatus",void 0),t.__decorate([r.property()],e.ClientSideConnection.prototype,"errorString",void 0),e.ClientSideConnection=t.__decorate([o.subclass("esri.layers.support.ClientSideConnection")],e.ClientSideConnection),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamConnectionState":function(){define(["exports","../../../../../chunks/tslib.es6","../../../../../core/Accessor","../../../../../core/accessorSupport/decorators/property","../../../../../core/accessorSupport/decorators/subclass"],function(e,t,r,s,i){"use strict";e.StreamConnectionState=class extends r{constructor(e){super(e)}get connectionStatus(){return this.connection?.connectionStatus}get errorString(){return this.connection?.errorString}},t.__decorate([s.property()],e.StreamConnectionState.prototype,"connection",void 0),t.__decorate([s.property()],e.StreamConnectionState.prototype,"connectionStatus",null),t.__decorate([s.property()],e.StreamConnectionState.prototype,"errorString",null),e.StreamConnectionState=t.__decorate([i.subclass("esri.views.2d.layers.features.sources.StreamConnectionState")],e.StreamConnectionState),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/StreamFeatureStore":function(){define(["exports","../support/FeatureSetReaderJSON"],function(e,t){"use strict";e.StreamFeatureStore=class{constructor(e,t){this._metadata=e,this._onUpdate=t,this._objectIdToFeature=new Map}get size(){return this._objectIdToFeature.size}get reader(){return t.FeatureSetReaderJSON.fromFeatures([...this._objectIdToFeature.values()],this._metadata)}add(e){this._objectIdToFeature.set(e.objectId,e)}forEach(e){this._objectIdToFeature.forEach(e)}removeById(e){const t=this._objectIdToFeature.get(e);return t?(this._objectIdToFeature.delete(e),t):null}clear(){this._objectIdToFeature=new Map}update(e,t){this._onUpdate(e?.length??0)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/StreamSourceChunk":function(){define(["exports","./ASourceChunk"],function(e,t){"use strict";class r extends t.ASourceChunk{constructor(e){super(),this._reader=e,this.chunkId="stream-chunk",this.normalizedChunkId="stream-chunk"}get reader(){return this._reader}get first(){return!0}get end(){return!0}get queryInfo(){return{type:"stream",chunkId:this.chunkId,size:this.size(),end:this.end}}get isTiled(){return!1}getTileReader(e){const t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}e.StreamSourceChunk=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/strategies/chunks/SourceChunkStore":function(){define(["exports","../../../../../../../core/Evented","../../../../../../../core/has","../../../../../../../geometry/support/aaBoundingBox","../../../FeatureStoreQueryAdapter","./Overrides"],function(e,t,r,s,i,n){"use strict";e.FeatureSourceChunkStore=class{constructor(e){this._metadata=e,this._chunks=new Map,this._chunksToRemove=[],this._overrides=new n.OverrideState,this.events=new t.EventEmitter,this.featureAdapter=new i.FeatureStoreQueryAdapter}destroy(){this.clear()}clear(){for(const e of this._chunks.values())this._chunksToRemove.push(e);this._chunks.clear(),this._overrides.clearWeakOverrides()}*chunks(){this._overrides&&(yield this._overrides.asChunk(this._metadata)),yield*this._chunks.values()}insert(e){r("esri-2d-update-debug")&&console.debug(`Chunk[${e.chunkId}] SourceChunkStore.insert`),this._overrides.onChunkInsert(e),this._chunks.set(e.chunkId,e),this.events.emit("changed")}remove(e){r("esri-2d-update-debug")&&console.debug(`Chunk[${e.chunkId}] SourceChunkStore.remove`),this._chunks.delete(e.chunkId),this._chunksToRemove.push(e)}removeById(e){r("esri-2d-update-debug")&&console.debug(`Chunk[${e}] SourceChunkStore.remove`);const t=this._chunks.get(e);this._chunks.delete(e),t&&this._chunksToRemove.push(t)}cleanup(){const e=this._chunksToRemove;return this._chunksToRemove=[],this._overrides.cleanup(this._chunks.values()),e}applyOverride(e){this._overrides.apply(e,this),this.events.emit("changed");for(const e of this._chunks.values())e.invalidate()}takeOverrideUpdate(){return this._overrides.takeOverrideUpdate()}refresh(){this.events.emit("refresh")}forEach(e){const t=new Set;for(const r of this.chunks()){const s=r.reader.getCursor();for(;s.next();){const r=s.getObjectId();t.has(r)||(e(s.copy()),t.add(r))}}}forEachUnsafe(e){const t=new Set;for(const r of this.chunks()){const s=r.reader.getCursor();for(;s.next();){const r=s.getObjectId();t.has(r)||(e(s),t.add(r))}}}mapObjectIdsFromGlobalIds(e,t){const r=new Map,s=new Set(e);return this._overrides.putWeakObjectIdsFromGlobalIds(r,s,t),this._forEachUnsafeIgnoreOverrides(e=>{const i=e.readAttribute(t);if(i&&s.has(i)&&!r.has(i)){const t=e.getObjectId();r.set(i,t)}}),r}forEachInBounds(e,t){const r=new Set;for(const s of this.chunks()){const i=s.queryFeaturesInBounds(e);for(;i.next();){const e=i.getObjectId();r.has(e)||(t(i.copy()),r.add(e))}}}forEachBounds(e,t){const r=s.create();for(const s of e)s.getBounds(r)&&t(r)}_forEachUnsafeIgnoreOverrides(e){const t=new Set;for(const r of this._chunks.values()){const s=r.reader.withoutOverrides().getCursor();for(;s.next();){const r=s.getObjectId();t.has(r)||(e(s),t.add(r))}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/UpdateTracking2D":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/has","../../../../core/ReactiveMap","../../../../core/reactiveUtils","../../../../core/accessorSupport/decorators/property","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../core/support/UpdatingHandles"],function(e,t,r,s,i,n,o,a,l,c,u){"use strict";e.UpdateTracking2D=class extends r{constructor(e){super(e),this.debugName="",this._updatingHandles=new u.UpdatingHandles,this._idToUpdatingState=new i}get updating(){const e=this._updatingHandles.updating||Array.from(this._idToUpdatingState.values()).some(e=>e);if(s("esri-2d-log-updating")){const t=Array.from(this._idToUpdatingState.entries()).map(([e,t])=>`-> ${e}: ${t}`).join("\n");console.log(`${this.debugName}: Updating: ${e}\n-> Handles: ${this._updatingHandles.updating}\n${t}`)}return e}addUpdateTracking(e,t){const r=n.watch(()=>t.updating,t=>this._idToUpdatingState.set(e,t),{sync:!0});this.addHandles(r)}addPromise(e){return this._updatingHandles.addPromise(e)}},t.__decorate([o.property({constructOnly:!0})],e.UpdateTracking2D.prototype,"debugName",void 0),t.__decorate([o.property({readOnly:!0})],e.UpdateTracking2D.prototype,"updating",null),e.UpdateTracking2D=t.__decorate([c.subclass("esri.views.2d.layers.support.UpdateTracking2D")],e.UpdateTracking2D),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/core/support/UpdatingHandles":function(){define(["exports","../../chunks/tslib.es6","../Accessor","../handleUtils","../reactiveUtils","../scheduling","../accessorSupport/decorators/property","../accessorSupport/decorators/subclass"],function(e,t,r,s,i,n,o,a){"use strict";e.UpdatingHandles=class extends r{constructor(){super(...arguments),this.updating=!1,this._handleId=0,this._scheduleHandleId=0,this._pendingPromises=new Set}destroy(){this.removeAll()}add(e,t,r={}){return this._installWatch(e,t,r,i.watch)}addWhen(e,t,r={}){return this._installWatch(e,t,r,i.when)}addOnCollectionChange(e,t,{initial:r=!1,final:n=!1}={}){const o=++this._handleId;return this.addHandles([i.on(e,"after-changes",this._createSyncUpdatingCallback(),i.sync),i.on(e,"change",t,{onListenerAdd:r?e=>t({added:e.toArray(),removed:[]}):void 0,onListenerRemove:n?e=>t({added:[],removed:e.toArray()}):void 0})],o),s.makeHandle(()=>this.removeHandles(o))}addPromise(e){if(null==e)return e;const t=++this._handleId;this.addHandles(s.makeHandle(()=>{this._pendingPromises.delete(e)&&(0!==this._pendingPromises.size||this.hasHandles(l)||this._set("updating",!1))}),t),this._pendingPromises.add(e),this._set("updating",!0);const r=()=>this.removeHandles(t);return e.then(r,r),e}removeAll(){this._pendingPromises.clear(),this.removeAllHandles(),this._set("updating",!1)}_installWatch(e,t,r={},i){const n=++this._handleId;r.sync||this._installSyncUpdatingWatch(e,n);const o=i(e,t,r);return this.addHandles(o,n),s.makeHandle(()=>this.removeHandles(n))}_installSyncUpdatingWatch(e,t){const r=this._createSyncUpdatingCallback(),s=i.watch(e,r,{sync:!0,equals:()=>!1});return this.addHandles(s,t),s}_createSyncUpdatingCallback(){return()=>{this.removeHandles(l),++this._scheduleHandleId;const e=this._scheduleHandleId;this._get("updating")||this._set("updating",!0),this.addHandles(n.schedule(()=>{e===this._scheduleHandleId&&(this._set("updating",this._pendingPromises.size>0),this.removeHandles(l))}),l)}}},t.__decorate([o.property({readOnly:!0})],e.UpdatingHandles.prototype,"updating",void 0),e.UpdatingHandles=t.__decorate([a.subclass("esri.core.support.UpdatingHandles")],e.UpdatingHandles);const l=-42;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/sources/FeatureTileSubscription":function(){define(["exports"],function(e){"use strict";e.FeatureTileSubscription=class{constructor(e,t){this.tile=e,this.version=t,this._abortController=new AbortController}get key(){return this.tile.key}get signal(){return this._abortController.signal}abort(){this._abortController.abort()}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/support/Tile":function(){define(["exports","../../../../../core/ArrayPool","../../../../../geometry/support/aaBoundingRect","../../../../../rest/support/QuantizationParameters","./arcadeUtils","../../../tiling/TileKey"],function(e,t,r,s,i,n){"use strict";class o{constructor(e,t){this.key=new n(0,0,0,0),this.bounds=r.create(),this.objectIds=new Set,this.key.set(t);const s=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=s.resolution,this.level=s.level,this.scale=s.scale,this.minScale=e.zoomToScale(s.level-1),this.maxScale=e.zoomToScale(s.level+1)}get lod(){return this.tileInfoView.getLODInfoAt(this.key)}get id(){return this.key.id}get extent(){return r.toExtent(this.bounds,this.tileInfoView.tileInfo.spatialReference)}get transform(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}}createArcadeEvaluationOptions(e){return i.createArcadeEvaluationOptions(this.scale,e)}createChildTiles(){const e=this.key.getChildKeys(),r=t.acquire();for(let t=0;t<e.length;t++)r[t]=new o(this.tileInfoView,e[t]);return r}getQuantizationParameters(){return s.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})}}e.Tile=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["../../../../core/Error","../../../../core/handleUtils","../../../../core/has","../../../../core/nextTick","../../../../core/promiseUtils","../../../../core/RandomLCG","../../../../core/reactiveUtils","../../../../core/screenUtils","../../../../core/workers/utils","../../../../layers/support/TileInfo","../../engine/webgl/definitions","./PipelineConnectionHandlers","./Processor","./sources/FeatureSource","./sources/FeatureTileSubscription","./support/Tile","../../tiling/TileInfoView"],function(e,t,r,s,i,n,o,a,l,c,u,h,d,p,f,m,g){"use strict";class y{constructor(e){this.inner=e,this.resolver=i.createResolver()}}return class{constructor(){this._aggregateAdapter={getFeatureObjectIds:e=>this._processor.getFeatureObjectIdsForAggregate(e)},this._subscriptions=new Map,this._cachedObjectIds=new Set,this._updateRequested=!1,this._didSourceRefresh=!1,this._updateSubscriptionRequests=[],this._updateHighlightRequests=[]}destroy(){this._subscriptions.clear(),this._processor?.destroy(),this._source?.destroy(),this._handles?.remove(),this._updateOverridesRequest=null,this._tileInfoView=null}onAttach(e){r("esri-2d-update-debug")&&console.debug("Pipeline.onAttach");const s=this._connection,n=c.fromJSON(e.tileInfoJSON);this._tileInfoView=new g(n),this._source=new p.FeatureSource(e.service,this._aggregateAdapter,this._subscriptions,s,this._cachedObjectIds),this._processor=new d(s,this._source),this._handles=t.handlesGroup([this._source.store.events.on("changed",()=>this._requestUpdate()),this._source.store.events.on("refresh",()=>this._requestRefresh()),o.watch(()=>this._source.updateTracking.updating,()=>{this._requestUpdate(),i.ignoreAbortErrors(this._connection.layerView.setUpdating({source:this._source.updateTracking.updating,pipeline:!0}))})])}onDetach(){r("esri-2d-update-debug")&&console.debug("Pipeline.onDetach"),this.destroy()}set remoteClient(e){this._connection=new h.PipelineConnectionHandlers(e)}get features(){const t=this._source?.queryEngine;if(!t)throw new e("no-queryEngine","No query engine defined");return t}get aggregates(){const t=this._processor?.aggregateQueryEngine;if(!t)throw new e("no-queryEngine","No aggregate query engine defined");return t}get processor(){return this._processor}get streamMessenger(){return this._source.streamMessenger}getDisplayFeatures(e){return this._processor.getDisplayFeatures(e)}getDisplayIds(e){return this._processor.getDisplayIds(e)}getObjectIdsFromGlobalIds(e){return this._source.getObjectIdsFromGlobalIds(e)}async updateSchema(e,t){return r("esri-2d-update-debug")&&this._updateSchemaRequest&&console.error("InternalError: Schema already updating"),this._updateSchemaRequest=new y({schema:e,version:t}),this._requestUpdate(),this._updateSchemaRequest.resolver.promise}updateSubscriptions(e){const t=new y(e);return this._updateSubscriptionRequests.push(t),this._requestUpdate(),t.resolver.promise}updateHighlight(e){const t=new y(e);return this._updateHighlightRequests.push(t),this._requestUpdate(),t.resolver.promise}async addParquetFile(e){return this._source.addParquetFile(e)}async onOverride(t){if(null!=this._updateOverridesRequest)throw new e("featurelayer","InternalError - Already processing an edit");this._updateOverridesRequest=new y(t);const r=this._updateOverridesRequest.resolver.promise;return this._requestUpdate(),r}queryStatistics(){return this._source.statistics.toJSON()}async queryVisibleFeatures(e,t){return this.features.executeQuery(e,t)}async queryHeatmapStatistics(e){const t=Math.round(a.pt2px(e.radius));let r=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const i="string"==typeof e.fieldOffset,n=e.fieldOffset??0,o=Array.from(this._subscriptions.values()),l=this._source.chunks(),c=t**2,h=3/(Math.PI*c),d=2*t,p=Math.ceil(u.tileSize/d);for(const t of o){const o=t.tile,a=new Float64Array(p*p);for(const t of l){const r=t.getTileReader(o);if(!r)continue;const s=r.getCursor();for(;s.next();){let t=1;if(null!=e.field){const r=s.readAttribute(e.field);t=i?-1*+r:+r+n}const r=s.readXForDisplay()/d,o=s.readYForDisplay()/d,l=Math.floor(r),u=Math.floor(o);if(l<0||u<0||l>=p||u>=p)continue;const f=((.5+l-r)*d)**2+((.5+u-o)*d)**2;if(f>c)continue;const m=t*(h*(1-f/c)**2);a[u+l*p]+=m}}for(let e=0;e<a.length;e++)r=Math.min(r,a[e]),s=Math.max(s,a[e])}return{max:s,min:r}}async getSampleFeatures(e){const t=this._source.chunks();if(t.reduce((e,t)=>e+t.size(),0)<=e.minFeatureCount){if(!this._source.updateTracking.updating){const e=[];return this._source.store.forEachUnsafe(t=>e.push(t.readLegacyFeatureWorldSpace())),e}return null}const r=new Set,s=[],i=t.map(e=>e.reader.getCursor()),o=new n,a=3*e.sampleSize;for(let n=0;n<a&&s.length<e.sampleSize;n++){const e=i[o.getIntRange(0,t.length-1)];if(0===e.getSize())continue;const n=o.getIntRange(0,e.getSize()-1);e.setIndex(n);const a=e.getObjectId();r.has(a)||(r.add(a),s.push(e.readLegacyFeatureWorldSpace()))}return s.length>=e.sampleSize?s:null}_requestUpdate(){this._updateRequested||(this._updateRequested=!0,s.nextTick(()=>this._scheduleNextUpdate()))}_requestRefresh(){this._didSourceRefresh=!0,this._requestUpdate()}_scheduleNextUpdate(){this._updateRequested&&(this._ongoingUpdate||(this._ongoingUpdate=l.ignoreConnectionErrors(this._doUpdate()).finally(()=>{this._ongoingUpdate=null,this._scheduleNextUpdate()}),this._updateRequested=!1))}_subscribe(e){const t=e.tileId;if(this._subscriptions.has(t))return;r("esri-2d-update-debug")&&console.debug(`Tile[${t}] Pipeline.subscribe`);const s=new m.Tile(this._tileInfoView,t),i=new f.FeatureTileSubscription(s,e.version);this._subscriptions.set(t,i),this._source.onSubscribe(i),this._processor.onSubscribe(i)}_unsubscribe(e){const t=this._subscriptions.get(e);t&&(r("esri-2d-update-debug")&&console.debug(`Tile[${e}] Pipeline.unsubscribe`),t.abort(),this._source.onUnsubscribe(t),this._processor.onUnsubscribe(t),this._subscriptions.delete(t.key.id))}async _doUpdate(){if(r("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateStart"),await this._connection.layerView.setUpdating({source:this._source.updateTracking.updating,pipeline:!0}),this._updateSubscriptionRequests.length){const e=this._updateSubscriptionRequests;this._updateSubscriptionRequests=[];for(const t of e)this._doUpdateSubscriptions(t.inner),t.resolver.resolve()}if(this._updateHighlightRequests.length){const e=this._updateHighlightRequests,t=new Set,r=new Set;for(const s of e)for(const{objectId:e,highlightFlags:i}of s.inner.highlights)i?(t.add(e),r.delete(e)):(r.add(e),t.delete(e));this._source.prepareCacheUpdate(t,r)}const e=this._updateSchemaRequest;this._updateSchemaRequest=null;let t=!1;if(null!=e){const{schema:r,version:s}=e.inner;t=await this._doUpdateSchema(r,s)}this._processor.requiresInvalidation()&&(t=!0),this._didSourceRefresh&&(t=!0,this._didSourceRefresh=!1),t&&(this._processor.invalidate(),await this._connection.container.updateRenderState(this._processor.version));const s=this._updateOverridesRequest;if(this._updateOverridesRequest=null,null!=s){r("esri-2d-update-debug")&&console.debug("Pipeline.applyOverride",s.inner),null!=s.inner.historicMoment&&this._source.unsafeSetQueryHistoricMoment(s.inner.historicMoment);const e=await this._source.normalizeOverrides(s.inner);this._source.applyOverride(e),r("esri-2d-update-debug")&&console.debug("Pipeline.endOverride",s.inner)}if(await this._source.applyCacheUpdate(),this._updateHighlightRequests.length){const e=this._updateHighlightRequests;this._updateHighlightRequests=[];for(const t of e)this._processor.updateHighlight(t.inner),t.resolver.resolve()}const n=this._source.cleanup();this._processor.removeChunks(n);try{const e=this._source.takeOverrideUpdate();if(null!=e&&this._subscriptions.size){r("esri-2d-update-debug")&&console.debug("Pipeline.applyOverrideChangesStart"),await this._connection.container.lockForOverrides();try{await this._processor.applyOverrideUpdate(e)}catch(e){r("esri-2d-update-debug")&&console.debug("InternalError",e)}await this._connection.container.unlockForOverrides(),r("esri-2d-update-debug")&&console.debug("Pipeline.applyOverrideChangesEnd")}this._subscriptions.size&&(r("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksStart"),await this._processor.updateChunks(),r("esri-2d-update-debug")&&console.debug("Pipeline.updateChunksEnd"))}catch(e){i.throwIfNotAbortError(e)}null!=s&&s.resolver.resolve(),null!=e&&e.resolver.resolve(),null==e&&t&&await this._connection.container.trySwapRenderState(),this._updateRequested?(r("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested=true]"),await this._connection.layerView.setUpdating({source:this._source.updateTracking.updating,pipeline:!0})):(r("esri-2d-update-debug")&&console.debug("Pipeline._doUpdateEnd [updateRequested=false, After flush]"),await this._connection.layerView.setUpdating({source:this._source.updateTracking.updating,pipeline:this._updateRequested}))}async _doUpdateSchema(e,t){r("esri-2d-update-debug")&&console.debug(`Version[${t}] Pipeline.updateStart`,{schema:e});const s={tileInfo:this._tileInfoView?.tileInfo},i=await this._source.update(e,t),n=Array.from(this._subscriptions.values()),o=this._processor.update(e,t,s,i,n);return r("esri-2d-update-debug")&&console.debug(`Version[${t}] Pipeline.updateEnd`),o}_doUpdateSubscriptions(e){r("esri-2d-update-debug")&&console.debug("Pipeline.updateSubscriptions",e);for(const t of e.subscribe)this._subscribe(t);for(const t of e.unsubscribe)this._unsubscribe(t)}}});