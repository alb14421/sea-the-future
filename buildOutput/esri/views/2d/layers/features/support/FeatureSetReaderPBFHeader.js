// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../layers/graphics/data/FeatureIdInfo","../../../../../layers/support/FieldsIndex","../../../../../rest/query/operations/pbfFeatureServiceParser"],function(e,t,s,r){"use strict";const n=268435455;class a{constructor(){this.hasFeatures=!1,this.exceededTransferLimit=!1,this.fieldCount=0,this.featureCount=0,this.idFieldIndices=[],this.vertexCount=0,this.offsets={attributes:new Array,geometry:new Array},this.centroid=new Array}}e.FeatureSetHeader=a,e.parseHeader=function(e,o,i,c=!1){const d=e.asUnsafe(),f=d.pos(),u=new a;let p=0,g=0,l=null,h=!1;const y=[];for(;d.next();)switch(d.tag()){case 12:l=d.processMessage(r.parseTransform);break;case 9:if(u.exceededTransferLimit=d.getBool(),u.exceededTransferLimit){u.offsets.geometry=c?new Float64Array(8e3):new Int32Array(8e3),u.centroid=c?new Float64Array(16e3):new Int32Array(16e3);for(let e=0;e<u.centroid.length;e++)u.centroid[e]=n}break;case 13:{const e=d.processMessage(r.parseField);e.index=p++,y.push(e);break}case 15:{const e=d.getLength(),t=d.pos()+e;if(!u.exceededTransferLimit){const e=u.offsets.geometry,t=u.centroid;e.push(0),t.push(n),t.push(n)}!h&&u.exceededTransferLimit&&(h=!0,u.offsets.attributes=c?new Float64Array(8e3*p):new Uint32Array(8e3*p));let s=g*p;for(;d.pos()<t&&d.next();)switch(d.tag()){case 1:{h?u.offsets.attributes[s++]=d.pos():u.offsets.attributes.push(d.pos());const e=d.getLength();d.skipLen(e);break}case 2:if(o){const e=d.getLength(),t=d.pos()+e;for(;d.pos()<t&&d.next();)switch(d.tag()){case 3:{d.getUInt32();const e=d.getSInt64(),t=d.getSInt64();u.centroid[2*g]=e,u.centroid[2*g+1]=t;break}default:d.skip()}}else{u.offsets.geometry[g]=d.pos();const e=d.getLength();u.vertexCount+=e,d.skipLen(e)}break;case 4:{const e=d.getLength(),t=d.pos()+e;for(;d.pos()<t&&d.next();)switch(d.tag()){case 3:{d.getUInt32();const e=d.getSInt64(),t=d.getSInt64();u.centroid[2*g]=e,u.centroid[2*g+1]=t;break}default:d.skip()}break}default:d.skip()}g++,u.hasFeatures=!0;break}default:d.skip()}u.fields=new s(y),u.featureCount=g,u.fieldCount=p;const w=t.getFeatureIdInfoFieldNames(i);return u.idFieldIndices=Array.from(w,e=>u.fields.get(e)?.index),u.transform=l,u.displayIds=new Uint32Array(u.featureCount),u.groupIds=new Uint16Array(u.featureCount),d.move(f),u},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});