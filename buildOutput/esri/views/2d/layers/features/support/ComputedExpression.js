// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/string","../../../../../support/ArcadeExpression","../../../arcade/callExpressionWithCursor","./AComputedField"],function(e,t,r,s,a){"use strict";class i extends a.AComputedField{static async create(e,s){const a=await r.createRendererExpression(e,s.spatialReference),c=t.numericHash(e);return new i(a,c)}constructor(e,t){super(),this._compiled=e,this._cacheKey=t}resize(e){}read(e,t){return this.hasArcadeDependency("scale")||"system"!==t.$view.timeZone?s.callExpressionWithCursor(this._compiled,e,t):this._readCached(e,t)}readWithDefault(e,t,r){return this.hasArcadeDependency("scale")||"system"!==t.$view.timeZone?s.callExpressionWithCursorWithDefault(this._compiled,e,t,r):this._readWithDefaultCached(e,t,r)}hasArcadeDependency(e){return this._compiled?.references(e)??!1}_getCacheKey(e){if(!this._compiled?.references("timeProperties"))return this._cacheKey;const{currentStart:t,currentEnd:r}=e.$view.timeProperties;return this._cacheKey+function(e,t){const r=43758.5453*Math.sin(12.9898*e+78.233*t);return r-Math.floor(r)}(t??1,r??1)}_readCached(e,t){if(e.setCache(this._getCacheKey(t)),e.hasCachedValue())return e.getCachedValue();const r=s.callExpressionWithCursor(this._compiled,e,t);return e.setCachedValue(r),r}_readWithDefaultCached(e,t,r){if(e.setCache(this._getCacheKey(t)),e.hasCachedValue())return e.getCachedValue();const a=s.callExpressionWithCursorWithDefault(this._compiled,e,t,r);return e.setCachedValue(a),a}}e.ComputedExpression=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});