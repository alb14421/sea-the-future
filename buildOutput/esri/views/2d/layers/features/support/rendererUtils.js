// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../core/Error","../../../../../core/Logger","../../../../../core/screenUtils","../../../../webgl/capabilities"],function(e,o,t,r,l){"use strict";const s=()=>t.getLogger("esri.views.2d.layers.features.support.rendererUtils");function n(e,o,t){return(1-t)*e+t*o}e.isRendererSupported=function(e){if(!e)return!0;switch(e.type){case"dot-density":break;case"heatmap":if(!function(){const{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:o,supportsColorBufferHalfFloat:t}=l.getWebGLCapabilities();return e&&o||t}()){const e=l.getWebGLCapabilities(),t=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter(o=>!e[o]).join(", ");return s().errorOnce(new o("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${t}`)),!1}}return!0},e.simplifyVisualVariables=function(e){return e.map(e=>function(e){return("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}(e)?function(e){return e.stops=(o=e.type,(t=e.stops??[]).length<=8?t:(s().warn(`Found ${t.length} Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified.`),t.length>16?function(e,o){const[t,...l]=o,s=l.pop(),a=l[0].value,i=l[l.length-1].value,u=(i-a)/6,p=[];for(let t=a;t<i;t+=u){let s=0;for(;t>=l[s].value;)s++;const a=l[s],i=o[s-1],u=t-i.value,c=a.value===i.value?1:u/(a.value-i.value);if("color"===e){const e=l[s],r=o[s-1],a=e.color.clone();a.r=n(r.color.r,a.r,c),a.g=n(r.color.g,a.g,c),a.b=n(r.color.b,a.b,c),a.a=n(r.color.a,a.a,c),p.push({value:t,color:a,label:e.label})}else if("size"===e){const e=l[s],a=o[s-1],i=r.toPt(e.size),u=n(r.toPt(a.size),i,c);p.push({value:t,size:u,label:e.label})}else{const e=l[s],r=n(o[s-1].opacity,e.opacity,c);p.push({value:t,opacity:r,label:e.label})}}return[t,...p,s]}(o,t):function(e){const[o,...t]=e,r=t.pop();for(;t.length>6;){let e=0,o=0;for(let r=1;r<t.length;r++){const l=t[r-1],s=t[r],n=Math.abs(s.value-l.value);n>o&&(o=n,e=r)}t.splice(e,1)}return[o,...t,r]}(t))),e;var o,t}(e.clone()):e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});