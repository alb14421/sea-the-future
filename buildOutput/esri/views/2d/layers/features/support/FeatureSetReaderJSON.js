// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../../layers/graphics/featureConversionUtils","../../../../../layers/graphics/OptimizedFeature","../../../../../layers/support/FieldsIndex","./FeatureSetReader"],function(e,t,r,s,n){"use strict";class i extends n.FeatureSetReader{static fromFeatures(e,r){const{geometryType:s}=r,n=t.convertFromFeatures([],e,s,!1,!1,r.featureIdInfo);for(let t=0;t<n.length;t++)n[t].displayId=e[t].displayId;return i.fromOptimizedFeatures(n,r)}static fromFeatureSet(e,r){const s=t.convertFromFeatureSet(e,r.featureIdInfo);return i.fromOptimizedFeatureSet(s,r)}static fromOptimizedFeatureSet(e,t){const r=i.fromOptimizedFeatures(e.features,t);return r._exceededTransferLimit=e.exceededTransferLimit,r._transform=e.transform,r._fieldsIndex=new s(e.fields),r}static fromOptimizedFeatures(e,t,r){const s=new i(e,t);return s._fieldsIndex=t.fieldsIndex,s._transform=r,s}static empty(e){return new i([],e)}constructor(e,t){super(t),this._exceededTransferLimit=!1,this._featureIndex=-1,this._fieldsIndex=null,this._geometryType=t.geometryType,this._features=e}get fields(){return this._fieldsIndex}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}get _current(){return this._features[this._featureIndex]}get usedMemory(){return this._current.usedMemory}getSize(){return this._features.length}getCursor(){return this.copy()}getInTransform(){return this._transform}getAttributeHash(){let e="";for(const t in this._current.attributes)e+=this._current.attributes[t];return e}getIndex(){return this._featureIndex}setIndex(e){this._featureIndex=e}getObjectId(){return this._current?.objectId}getDisplayId(){return this._current.displayId}setDisplayId(e){this._current.displayId=e}copy(){const e=new i(this._features,this.metadata);return this.copyInto(e),e}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readGeometryArea(){return r.hasGeometry(this._current)?t.getQuantizedArea(this._current.geometry,2):0}_readX(){return r.hasGeometry(this._current)?this._current.geometry.coords[0]:0}_readY(){return r.hasGeometry(this._current)?this._current.geometry.coords[1]:0}_readGeometry(){return r.hasGeometry(this._current)?this._current.geometry??null:null}_readServerCentroid(){return this._current.centroid}_readAttribute(e,t){if(!this._fieldsIndex){const t=this._current.attributes[e];if(void 0!==t)return t;const r=e.toLowerCase();for(const e in this._current.attributes)if(e.toLowerCase()===r)return this._current.attributes[e];return}const r=this._fieldsIndex.get(e);if(!r)return;const s=this._current.attributes[r.name];return null==s?s:t&&this.fields.isDateField(e)?new Date(s):s}_readAttributes(){return this._current.attributes}copyInto(e){super.copyInto(e),e._featureIndex=this._featureIndex,e._transform=this._transform,e._fieldsIndex=this._fieldsIndex}}e.FeatureSetReaderJSON=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});