// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/MediaElementView":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/Polygon","../../geometry/projectionUtils","../../geometry/support/aaBoundingRect","../../geometry/support/normalizeUtilsSync"],function(e,t,r,i,s,o,n,a,l,c,h,p){"use strict";e.MediaElementView=class extends r{constructor(e){super(e)}get bounds(){const e=this.coords;return null==e?.extent?null:h.fromExtent(e.extent)}get coords(){const e=this.element.georeference?.coords;return c.projectOrLoad(e,this.spatialReference).geometry}get normalizedCoords(){return l.fromJSON(p.normalizeCentralMeridianSync(this.coords))}get normalizedBounds(){const e=null!=this.normalizedCoords?this.normalizedCoords.extent:null;return null!=e?h.fromExtent(e):null}},t.__decorate([i.property()],e.MediaElementView.prototype,"spatialReference",void 0),t.__decorate([i.property()],e.MediaElementView.prototype,"element",void 0),t.__decorate([i.property()],e.MediaElementView.prototype,"bounds",null),t.__decorate([i.property()],e.MediaElementView.prototype,"coords",null),t.__decorate([i.property()],e.MediaElementView.prototype,"normalizedCoords",null),t.__decorate([i.property()],e.MediaElementView.prototype,"normalizedBounds",null),e.MediaElementView=t.__decorate([a.subclass("esri.layers.support.MediaElementView")],e.MediaElementView),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Overlay":function(){define(["../../../../core/Error","../../../../core/events","../../../../core/Handles","../../../../core/Logger","../../../../core/maybe","../../../../core/perspectiveUtils","../../../../core/reactiveUtils","../../../../core/libs/gl-matrix-2/factories/mat3f64","../../../../core/libs/gl-matrix-2/math/vec2","../../../../core/libs/gl-matrix-2/factories/vec2f64","../../../../support/mediaLayerUtils","../DisplayObject","./animatedFormats/utils","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,r,i,s,o,n,a,l,c,h,p,d,u,m){"use strict";const g=[1,1],y=a.create(),f={none:"None",loop:"Loop",oscillate:"Oscillate"};class _ extends p.DisplayObject{constructor(o){super(),this.elementView=o,this.isWrapAround=!1,this.wrapAroundShift=0,this.perspectiveTransform=c.create(),this._handles=new r,this._vertices=new Float32Array(8),this._indices=new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1]),this._handles.add([n.watch(()=>this.elementView.element.opacity,e=>this.opacity=e,n.initial),n.watch(()=>[this.elementView.coords],()=>{this.requestRender()},n.initial),n.watch(()=>["animationOptions"in this.elementView.element&&this.elementView.element.animationOptions],()=>{this._handles.remove("play"),this.texture=s.disposeMaybe(this.texture),this.requestRender()},n.initial),n.when(()=>this.elementView.element.loaded,()=>{const e=this.elementView.element;this.ready(),h.isVideoElement(e)&&null!=e.content&&(this._handles.add([t.on(e.content,"play",()=>this.requestRender()),t.on(e.content,"loadeddata",()=>this.requestRender()),t.on(e.content,"loaded",()=>this.requestRender())]),"requestVideoFrameCallback"in e.content?e.content.requestVideoFrameCallback(()=>this.requestRender()):this._handles.add([t.on(e.content,"seeked",()=>this.requestRender())]),this.requestRender())},n.initial)]),o.element.load().catch(t=>{i.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new e("element-load-error","Element cannot be displayed",{element:o,error:t}))})}getMesh(e){throw new Error("Method not implemented.")}destroy(){super.destroy(),this._handles.destroy(),this.texture=s.disposeMaybe(this.texture)}get textureSize(){return g}get dvsMat3(){return this.parent.dvsMat3}beforeRender(e){const{context:t}=e,r=this.elementView.element.content;if(null!=r){const e=r instanceof HTMLImageElement,s=r instanceof HTMLVideoElement,o=e?r.naturalWidth:s?r.videoWidth:r.width,n=e?r.naturalHeight:s?r.videoHeight:r.height;if(this._updatePerspectiveTransform(o,n),this.texture){if(s)if(r.readyState>=r.HAVE_CURRENT_DATA)this._updateTextureAndRequestRender(r);else{const e=()=>{this._updateTextureAndRequestRender(r),r.removeEventListener("canplay",e),r.removeEventListener("seeked",e)};r.addEventListener("canplay",e),r.addEventListener("seeked",e)}}else{const e=new m.TextureDescriptor(o,n);if(e.wrapMode=33071,e.preMultiplyAlpha=!0,"getFrame"in r){const s=r=>{this.texture?this.texture.setData(r):this.texture=new u.Texture(t,e,r),this.requestRender()};"animationOptions"in this.elementView.element&&this._handles.add(d.play(r,(i=this.elementView.element.animationOptions)?{type:"CIMAnimatedSymbolProperties",...i,playAnimation:i.playing,repeatType:i.repeatType?f[i.repeatType]:void 0}:{type:"CIMAnimatedSymbolProperties"},null,s),"play")}else this.texture=new u.Texture(t,e,r);this.texture.generateMipmap(),s&&("requestVideoFrameCallback"in r?r.requestVideoFrameCallback(()=>this.requestRender()):r.paused||this.requestRender())}}var i;super.beforeRender(e)}_updateTextureAndRequestRender(e){this.texture.setData(e),this.texture.generateMipmap(),"requestVideoFrameCallback"in e?e.requestVideoFrameCallback(()=>this.requestRender()):e.paused||this.requestRender()}_createTransforms(){return null}draw(e,t){this.isReady&&null!=this.texture?t.render(e,{transform:{dvs:this.dvsMat3},config:{perspective:this.perspectiveTransform,texSize:g,wrapAroundShift:this.wrapAroundShift,isWrapAround:this.isWrapAround,opacity:this.opacity,texture:{texture:this.texture,unit:0}},position:this._vertices,tex:this._indices}):this.requestRender()}updateDrawCoords(e,t,r,i){const{coords:s,bounds:o}=this.elementView;if(null==s||null==o)return;const[n,a,l,c]=s.rings[0],h=this._vertices,{x:p,y:d}=e;h.set([a[0]-p,a[1]-d,n[0]-p,n[1]-d,l[0]-p,l[1]-d,c[0]-p,c[1]-d]);let u=t;if(i){const[e,,t]=o,{worldWidth:r,xBounds:s}=i,[n,a]=s;e<n&&t>n?u=r:t>a&&e<a&&(u=-r)}this.wrapAroundShift=u,this.isWrapAround=0!==u}_updatePerspectiveTransform(e,t){const r=this._vertices;o.getProjectiveTransform(y,[0,0,e,0,0,t,e,t],[r[0],r[1],r[4],r[5],r[2],r[3],r[6],r[7]]),l.set(this.perspectiveTransform,y[6]/y[8]*e,y[7]/y[8]*t)}}return _})},"esri/core/perspectiveUtils":function(){define(["exports","./libs/gl-matrix-2/math/mat3","./libs/gl-matrix-2/factories/mat3f64","./libs/gl-matrix-2/math/vec2","../chunks/vec32","./libs/gl-matrix-2/factories/vec3f64"],function(e,t,r,i,s,o){"use strict";const n=o.create(),a=r.create(),l=r.create(),c=r.create();function h(e,r,i,o,l,c,h,p,d){t.set(e,r,o,c,i,l,h,1,1,1),s.set(n,p,d,1),t.adjoint(a,e);const[u,m,g]=s.transformMat3(n,n,t.transpose(a,a));return t.set(a,u,0,0,0,m,0,0,0,g),t.multiply(e,a,e)}e.getProjectiveTransform=function(e,r,i){return h(l,r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]),h(c,i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]),t.multiply(e,t.adjoint(l,l),c),0!==e[8]&&(e[0]/=e[8],e[1]/=e[8],e[2]/=e[8],e[3]/=e[8],e[4]/=e[8],e[5]/=e[8],e[6]/=e[8],e[7]/=e[8],e[8]/=e[8]),e},e.transformProjective=function(e,r,o){return s.set(n,r[0],r[1],1),s.transformMat3(n,n,t.transpose(a,o)),0===n[2]?i.set(e,n[0],n[1]):i.set(e,n[0]/n[2],n[1]/n[2])},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/mediaLayerUtils":function(){define(["exports"],function(e){"use strict";const t=Symbol("ImageElementInstance"),r=Symbol("VideoElementInstance");function i(e){return null!=e&&"object"==typeof e&&t in e}function s(e){return null!=e&&"object"==typeof e&&r in e}e.ImageElementSymbol=t,e.VideoElementSymbol=r,e.isImageElement=i,e.isMediaElement=function(e){return i(e)||s(e)},e.isVideoElement=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/OverlayContainer":function(){define(["../../../../core/libs/gl-matrix-2/math/common","../../../../core/libs/gl-matrix-2/math/mat3","../../../../core/libs/gl-matrix-2/factories/mat3f32","../../../../core/libs/gl-matrix-2/factories/vec2f32","../../../../core/libs/gl-matrix-2/factories/vec3f32","../../../../geometry/support/normalizeUtils","../../../../geometry/support/spatialReferenceUtils","../../viewpointUtils","./WGLContainer","./shaderGraph/techniques/overlay/OverlayTechnique"],function(e,t,r,i,s,o,n,a,l,c){"use strict";return class extends l{constructor(){super(...arguments),this._viewStateId=-1,this._dvsMat3=r.create(),this._overlayTechnique=new c.OverlayTechnique}get dvsMat3(){return this._dvsMat3}beforeRender(e){this._updateMatrices(e),this._updateOverlays(e,this.children);for(const t of this.children)t.beforeRender(e)}doRender(e){if(1!==e.drawPhase||!this.visible)return;super.doRender(e);const t=this._overlayTechnique;for(const r of this.children)r.draw(e,t)}onDetach(){this._overlayTechnique.shutdown()}_updateMatrices(r){const{state:n}=r,{id:a,size:l,pixelRatio:c,resolution:h,rotation:p,viewpoint:d,displayMat3:u}=n;if(this._viewStateId===a)return;const m=e.toRadian(p),g=c*l[0],y=c*l[1];this._localOrigin=d.targetGeometry.clone();const{x:f,y:_}=this._localOrigin,w=o.normalizeMapX(f,n.spatialReference);this._localOrigin.x=w,this._localOrigin.y=_;const v=h*g,b=h*y,S=t.identity(this._dvsMat3);t.multiply(S,S,u),t.translate(S,S,i.fromValues(g/2,y/2)),t.scale(S,S,s.fromValues(g/v,-y/b,1)),t.rotate(S,S,-m),this._viewStateId=a}_updateOverlays(t,r){const{state:i}=t,{rotation:s,spatialReference:o,worldScreenWidth:l,size:c,viewpoint:h}=i,p=this._localOrigin;let d,u=0;const m=n.getInfo(o);if(m&&o.isWrappable){const t=c[0],r=c[1],n=e.toRadian(s),p=Math.abs(Math.cos(n)),g=Math.abs(Math.sin(n)),y=Math.round(t*p+r*g),[f,_]=m.valid,w=a.getWorldWidth(o),{x:v,y:b}=h.targetGeometry,S=[v,b],x=[0,0];i.toScreen(x,S);const M=[0,0];let R;R=y>l?.5*l:.5*y;const C=Math.floor((v+.5*w)/w),E=f+C*w,T=_+C*w,V=[x[0]+R,0];i.toMap(M,V),M[0]>T&&(u=w),V[0]=x[0]-R,i.toMap(M,V),M[0]<E&&(u=-w),d={worldWidth:w,xBounds:[f,_]}}for(const e of r)e.updateDrawCoords(p,u,i,d)}}})},"esri/views/2d/engine/webgl/shaderGraph/techniques/overlay/OverlayTechnique":function(){define(["exports","../../../../../../../core/maybe","../../../meshing/Mesh","../../utils","../Technique","../shaders/OverlayShader","../../../../../../webgl/enums","../../../../../../webgl/VertexElementDescriptor"],function(e,t,r,i,s,o,n,a){"use strict";class l extends s.Technique{constructor(){super(...arguments),this.type=20,this._mesh=null,this.shaders={overlay:new o.OverlayShader}}render(e,t){const{context:r,painter:s}=e,o=this._getMesh(e,t);s.setPipelineState(i.simplePipelineState);const{isWrapAround:n,wrapAroundShift:a}=t.config,l={...t.config,wrapAroundShift:0},c={shader:this.shaders.overlay,uniforms:{transform:t.transform,config:l},defines:null,optionalAttributes:null,useComputeBuffer:!1};s.setPipelineState({...i.simplePipelineState,stencil:{write:!1,test:{compare:514,op:{fail:7680,zFail:7680,zPass:7681},ref:0,mask:255}}}),s.submitDrawMeshUntyped(r,c,o),n&&(l.wrapAroundShift=a,s.submitDrawMeshUntyped(r,c,o))}shutdown(){t.destroyMaybe(this._mesh)}_getMesh(e,t){const{context:i}=e;if(this._mesh){const e=this._mesh.vertexBuffers.get("positions");if(!e)throw new Error("Buffer not found");e.setData(t.position)}else{const e=null!=t.index?t.index.length:t.position.length/2;this._mesh=new r.Mesh(i,{vertex:{positions:{data:t.position,layout:[new a.VertexElementDescriptor("pos",2,n.DataType.FLOAT,0,8)]},uvs:{data:t.tex,layout:[new a.VertexElementDescriptor("uv",2,n.DataType.UNSIGNED_SHORT,0,4)]}},index:null!=t.index?{index:{data:t.index}}:void 0,groups:[{index:null!=t.index?"index":void 0,primitive:n.PrimitiveType.TRIANGLE_STRIP}],parts:[{group:0,start:0,count:e}]})}return this._mesh}}e.OverlayTechnique=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/shaders/OverlayShader":function(){define(["exports","../../../../../../../chunks/tslib.es6","../../GraphShaderModule","../../graph/glsl"],function(e,t,r,i){"use strict";class s extends r.VertexInput{}t.__decorate([r.location(0,i.Vec2)],s.prototype,"pos",void 0),t.__decorate([r.location(1,i.Vec2)],s.prototype,"uv",void 0);class o extends r.FragmentInput{}class n extends r.UniformGroup{}t.__decorate([r.uniform(i.Mat3)],n.prototype,"dvs",void 0);class a extends r.UniformGroup{}t.__decorate([r.uniform(i.Vec2)],a.prototype,"perspective",void 0),t.__decorate([r.uniform(i.Vec2)],a.prototype,"texSize",void 0),t.__decorate([r.uniform(i.Float)],a.prototype,"wrapAroundShift",void 0),t.__decorate([r.uniform(i.Float)],a.prototype,"opacity",void 0),t.__decorate([r.uniform(i.Sampler2D)],a.prototype,"texture",void 0);class l extends r.GraphShaderModule{constructor(){super(...arguments),this.type="OverlayShader"}vertex(e){const t=e.uv.divide(this.config.texSize),r=new i.Float(1).add(i.dot(t,this.config.perspective)),s=new i.Vec3(e.pos.add(new i.Vec2(this.config.wrapAroundShift,0)),1),o=this.transform.dvs.multiply(s);return{uv:t,glPosition:new i.Vec4(o.xy.multiply(r),0,r)}}fragment(e){const t=i.texture2D(this.config.texture,e.uv).multiply(this.config.opacity),s=new r.FragmentOutput;return s.fragColor=t,s}}t.__decorate([r.uniform(n)],l.prototype,"transform",void 0),t.__decorate([r.uniform(a)],l.prototype,"config",void 0),t.__decorate([t.__param(0,r.input(s))],l.prototype,"vertex",null),t.__decorate([t.__param(0,r.input(o))],l.prototype,"fragment",null),e.OverlayShader=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Collection","../../../core/collectionUtils","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../linkChart/utils","../engine/Container","./support/HighlightCounter","./support/util","../support/highlightOptionsUtils","../../layers/support/ClipRect","../../layers/support/Geometry","../../layers/support/Path","../../support/HighlightOptions","../../support/layerViewUtils"],function(e,t,r,i,s,o,n,a,l,c,h,p,d,u,m,g,y,f,_,w,v){"use strict";const b=r.ofType({key:"type",base:null,typeMap:{rect:y,path:_,geometry:f}}),S=new(r.ofType(w));e.LayerView2DMixin=e=>{const a=e;let l=class extends a{constructor(){super(...arguments),this._highlightCounter=new u.HighlightCounter,this.attached=!1,this.clips=new b,this.highlights=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const e=this.view?.spatialReferenceLocked??!0,t=this.view?.spatialReference;t&&e&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new s("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new d.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([o.watch(()=>this.suspended,e=>{this.container&&(this.container.visible=!e)},o.syncAndInitial),o.watch(()=>this.updateSuspended,e=>{this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},o.syncAndInitial),o.watch(()=>this.layer?.opacity??1,e=>{this.container&&(this.container.opacity=e)},o.syncAndInitial),o.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",e=>{this.container&&(this.container.blendMode=e)},o.syncAndInitial),o.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,e=>{this.container&&(this.container.effect=e)},o.syncAndInitial),o.watch(()=>this._mergedHighlights.items.map(e=>({name:e.name,options:{fillColor:e.color,haloColor:e.haloColor,fillOpacity:e.fillOpacity,haloOpacity:e.haloOpacity,haloWidth:e.haloWidth,haloBlur:e.haloBlur}})),()=>{this.container.highlightGradient=m.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)},o.syncAndInitial),o.watch(()=>this._mergedHighlights.items.map(e=>e.name),()=>{this._processHighlight()}),o.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},o.syncAndInitial),o.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:e,scaleRange:t})=>{const r=v.isInEffectiveScaleRange(t,e);r!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=r)},o.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get highlightOptions(){return g.getDefaultHighlightOptions(this)}set highlightOptions(e){g.setDefaultHighlightOptions(this,e)}get hasHighlight(){return this._highlightCounter.size>0}get _mergedHighlights(){if(!this.view)return S;if(!this.highlights)return this.view.highlights;const e=this.view.highlights.clone();for(const t of this.highlights){const r=e.find(e=>e.name===t.name);r&&r.assignFrom(t)}return e}get highlightIds(){return Array.from(this._highlightCounter.objectIds)}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;switch(this.layer?.type){case"link-chart":case"knowledge-graph-sublayer":case"graphics":break;default:if(p.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const e=super.getSuspendInfo(),t=!this.spatialReferenceSupported;return t&&(e.spatialReferenceNotSupported=t),e}addAttachHandles(e){this.addHandles(e,"attach")}_addHighlights(e,t){this._highlightCounter.add(e,t)&&this._processHighlight()}_removeHighlights(e,t){this._highlightCounter.delete(e,t)&&this._processHighlight()}_processHighlight(){}_getHighlights(){const e=[];for(const[t,r]of this._highlightCounter.highlightNamesByObjectId){const i=this._getHighlightBits(r);e.push({objectId:t,highlightFlags:i})}return e}_getHighlightBits(e){const t=new Set(e);let r=1,i=0;if(!this.view)return 0;const s=this._mergedHighlights;for(const{name:e}of s)t.delete(e)&&(i=r),r<<=1;return i}};return t.__decorate([n.property()],l.prototype,"attached",void 0),t.__decorate([n.property({type:b,set(e){const t=i.referenceSetter(e,this._get("clips"),b);this._set("clips",t)}})],l.prototype,"clips",void 0),t.__decorate([n.property()],l.prototype,"container",void 0),t.__decorate([n.property({type:w})],l.prototype,"highlightOptions",null),t.__decorate([n.property({type:r.ofType(w)})],l.prototype,"highlights",void 0),t.__decorate([n.property()],l.prototype,"_mergedHighlights",null),t.__decorate([n.property()],l.prototype,"moving",void 0),t.__decorate([n.property({readOnly:!0})],l.prototype,"spatialReferenceSupported",null),t.__decorate([n.property({readOnly:!0})],l.prototype,"updateParameters",void 0),t.__decorate([n.property()],l.prototype,"updateRequested",void 0),t.__decorate([n.property()],l.prototype,"updating",null),t.__decorate([n.property()],l.prototype,"view",void 0),t.__decorate([n.property()],l.prototype,"_visibleAtCurrentScale",void 0),t.__decorate([n.property({readOnly:!0})],l.prototype,"visibleAtCurrentScale",null),l=t.__decorate([h.subclass("esri.views.2d.layers.LayerView2D")],l),l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/linkChart/utils":function(){define(["exports"],function(e){"use strict";e.isLinkChartView=function(e){return null!=e&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/MapUtils","../../../../core/ReactiveMap","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,o,n,a,l,c){"use strict";e.HighlightCounter=class extends r{constructor(){super(...arguments),this._idToCounters=new s}get size(){return this._idToCounters.size}get objectIds(){return this._idToCounters.keys()}get highlightNamesByObjectId(){return function*(e){for(const[t,r]of e)yield[t,r.keys()]}(this._idToCounters)}add(e,t){let r=!1;for(const s of e){const e=i.getOrCreateMapValue(this._idToCounters,s,()=>(r=!0,new Map)),o=e.get(t)??0;o||(r=!0),e.set(t,o+1)}return r}delete(e,t){let r=!1;for(const i of e){const e=this._idToCounters.get(i);if(!e)continue;let s=e.get(t);null!=s&&(s--,s>0?e.set(t,s):(e.delete(t),r=!0),0===e.size&&(this._idToCounters.delete(i),r=!0))}return r}},e.HighlightCounter=t.__decorate([c.subclass("esri.views.2d.layers.support.HighlightCounter")],e.HighlightCounter),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],function(e,t,r,i,s,o,n,a){"use strict";var l;return e.default=l=class extends a{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}},t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"left",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"right",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"top",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"bottom",void 0),e.default=l=t.__decorate([n.subclass("esri.views.layers.support.ClipRect")],e.default),e.default})},"esri/views/layers/support/ClipArea":function(){define(["exports","../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,o,n,a){"use strict";return e.default=class extends r.JSONSupport{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}},t.__decorate([i.property({readOnly:!0})],e.default.prototype,"version",null),e.default=t.__decorate([a.subclass("esri.views.layers.support.ClipArea")],e.default),e.default})},"esri/views/layers/support/Geometry":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Extent","../../../geometry/Geometry","../../../geometry/Polygon","../../../geometry/support/jsonUtils","./ClipArea"],function(e,t,r,i,s,o,n,a,l,c,h,p){"use strict";var d;const u={base:l,key:"type",typeMap:{extent:a,polygon:c}};return e.default=d=class extends p{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){return new d({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}},t.__decorate([r.property({types:u,json:{read:h.fromJSON,write:!0}})],e.default.prototype,"geometry",void 0),e.default=d=t.__decorate([n.subclass("esri.views.layers.support.Geometry")],e.default),e.default})},"esri/views/layers/support/Path":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],function(e,t,r,i,s,o,n,a){"use strict";return e.default=class extends a{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}},t.__decorate([r.property({type:[[[Number]]],json:{write:!0}})],e.default.prototype,"path",void 0),e.default=t.__decorate([n.subclass("esri.views.layers.support.Path")],e.default),e.default})},"esri/views/layers/MediaLayerView":function(){define(["../../chunks/tslib.es6","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../3d/layers/support/MediaLayerInteractionOptions"],function(e,t,r,i,s,o,n){"use strict";return r=>{const i=r;let s=class extends i{constructor(...e){super(...e),this.layer=null,this.interactive=!1,this.interactionOptions=new n.MediaLayerInteractionOptions,this.selectedElement=null}highlight(e,t){throw new Error("missing implementation")}};return e.__decorate([t.property()],s.prototype,"layer",void 0),e.__decorate([t.property()],s.prototype,"interactive",void 0),e.__decorate([t.property({type:n.MediaLayerInteractionOptions})],s.prototype,"interactionOptions",void 0),e.__decorate([t.property()],s.prototype,"selectedElement",void 0),s=e.__decorate([o.subclass("esri.views.layers.MediaLayerView")],s),s}})},"esri/views/3d/layers/support/MediaLayerInteractionOptions":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,o,n,a){"use strict";let l=class extends r{constructor(e){super(e),this.editSourcePoints=!1}};t.__decorate([i.property()],l.prototype,"editSourcePoints",void 0),l=t.__decorate([a.subclass("esri.views.3d.layers.support.MediaLayerInteractionOptions.ReshapeOptions")],l),e.MediaLayerInteractionOptions=class extends r{constructor(e){super(e),this.tool="transform",this.reshapeOptions=new l}},t.__decorate([i.property()],e.MediaLayerInteractionOptions.prototype,"tool",void 0),t.__decorate([i.property({type:l})],e.MediaLayerInteractionOptions.prototype,"reshapeOptions",void 0),e.MediaLayerInteractionOptions=t.__decorate([a.subclass("esri.views.3d.layers.support.MediaLayerInteractionOptions")],e.MediaLayerInteractionOptions),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["require","../../../chunks/tslib.es6","../../../Graphic","../../../core/Collection","../../../core/Error","../../../core/has","../../../core/Logger","../../../core/MapUtils","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Extent","../../../geometry/support/aaBoundingRect","../../../geometry/support/contains","../../../geometry/support/intersectsBase","../../../layers/support/MediaElementView","../../../renderers/SimpleRenderer","../../../symbols/SimpleFillSymbol","../../../core/scheduling","../../../Color","../../../core/mathUtils","../../../config","../../../core/floatRGBA","../../../geometry/Geometry","../../../geometry/Multipoint","../../../geometry/Point","../../../geometry/Polygon","../../../geometry/Polyline","../../../symbols/Font","../../../core/ObjectPool","../../../geometry/support/spatialReferenceUtils","../../../symbols/cim/effects/EffectAddControlPoints","../../../symbols/cim/effects/EffectArrow","../../../symbols/cim/effects/EffectBuffer","../../../symbols/cim/effects/EffectControlMeasureLine","../../../symbols/cim/effects/EffectCut","../../../symbols/cim/effects/EffectDashes","../../../symbols/cim/effects/EffectDonut","../../../symbols/cim/effects/EffectEnclosingPolygon","../../../symbols/cim/effects/EffectJog","../../../symbols/cim/effects/EffectMove","../../../symbols/cim/effects/EffectOffset","../../../symbols/cim/effects/EffectRadial","../../../symbols/cim/effects/EffectReverse","../../../symbols/cim/effects/EffectRotate","../../../symbols/cim/effects/EffectScale","../../../symbols/cim/effects/EffectSuppress","../../../symbols/cim/effects/EffectTaperedPolygon","../../../symbols/cim/effects/EffectWave","../../../symbols/cim/placements/PlacementAlongLineSameSize","../../../symbols/cim/placements/PlacementAtExtremities","../../../symbols/cim/placements/PlacementAtRatioPositions","../../../symbols/cim/placements/PlacementInsidePolygon","../../../symbols/cim/placements/PlacementOnLine","../../../symbols/cim/placements/PlacementOnVertices","../../../symbols/cim/placements/PlacementPolygonCenter","../../../symbols/cim/constants","../../../core/libs/gl-matrix-2/factories/vec2f32","../../../symbols/support/defaults","../../../symbols/cim/OverrideHelper","../../../layers/effects/EffectView","../../../core/Accessor","../engine/transitions/FadeTransition","../../../core/libs/gl-matrix-2/factories/vec4f32","../../webgl/enums","../engine/webgl/shaders/BackgroundPrograms","../../webgl/Program","../../webgl/checkWebGLError","../../webgl/VertexAttributeLayouts","../../webgl/BufferObject","../engine/webgl/AFeatureTile","../engine/webgl/DisplayEntity","../engine/webgl/shaderGraph/techniques/featureTechniqueUtils","../engine/webgl/cpuMapped/MappedMesh","../engine/webgl/number","../engine/webgl/shaders/TileInfoPrograms","../../webgl/Texture","../engine/webgl/shaders/BitBlitPrograms","../../../request","../../../core/urlUtils","../../../core/pbf","../engine/webgl/shaders/StencilPrograms","../engine/webgl/shaderGraph/techniques/shaders/BlendShader","../engine/webgl/shaderGraph/techniques/shaders/OpacityShader","../engine/webgl/shaders/HighlightPrograms","../../webgl/FramebufferObject","../engine/webgl/meshing/SimpleMesh","../../webgl/Renderbuffer","../engine/webgl/PooledUint32Array","../engine/webgl/Profiler","../engine/webgl/shaderGraph/techniques/TechniqueRegistry","../engine/webgl/shaderGraph/techniques/animated/attributes","../engine/webgl/mesh/templates/templateUtils","../engine/webgl/shaderGraph/techniques/line/LineMeshWriter","../engine/webgl/shaderGraph/techniques/dotDensity/DotDensityMeshWriter","../engine/webgl/shaderGraph/techniques/fill/ComplexFillMeshWriter","../engine/webgl/shaderGraph/techniques/fill/ComplexOutlineFillMeshWriter","../engine/webgl/shaderGraph/techniques/fill/FillMeshWriter","../engine/webgl/shaderGraph/techniques/fill/GradientFillMeshWriter","../engine/webgl/shaderGraph/techniques/fill/OutlineFillMeshWriter","../engine/webgl/shaderGraph/techniques/fill/PatternFillMeshWriter","../engine/webgl/shaderGraph/techniques/fill/PatternOutlineFillMeshWriter","../engine/webgl/shaderGraph/techniques/heatmap/HeatmapMeshWriter","../../../geometry/support/aaBoundingBox","../engine/webgl/shaderGraph/techniques/text/TextMeshWriter","../engine/webgl/shaderGraph/techniques/line/GradientStrokeMeshWriter","../engine/webgl/shaderGraph/techniques/line/TexturedLineMeshWriter","../engine/webgl/shaderGraph/techniques/markers/MarkerMeshWriter","../../../core/sql/UnknownTimeZone","../../../intl/locale","../../../layers/support/fieldUtils","../../../time/constants","../engine/webgl/animations/instructions","../engine/webgl/shaderGraph/techniques/pieChart/PieChartMeshWriter","../../webgl/renderState","../../3d/webgl-engine/core/shaderModules/glsl","../../webgl/testSVGPremultipliedAlpha","../../../chunks/pe","../engine/webgl/meshing/definitions","../engine/webgl/shaderGraph/techniques/shaders/VideoScreenShader","../LabelManager","./graphics/GraphicsView2D","../../../chunks/earcut","../../../core/libs/gl-matrix-2/factories/vec3f32","../../../geometry/support/normalizeUtilsCommon","../../../geometry/SpatialReference","../../../geometry/support/Ellipsoid","../../../kernel","./support/util","../navigation/MapViewNavigation","../../../core/asyncUtils","../../../core/support/UpdatingHandles","../engine/webgl/shaderGraph/techniques/shaders/MagnifierShader","../../../core/unitUtils","../../../geometry/ellipsoidUtils","../../../geometry/projection/projectors","../engine/webgl/shaderGraph/techniques/shaders/GridShader","../../../geometry/support/geodesicConstants","../tiling/TileInfoView","../tiling/TileKey","../tiling/TileQueue","../tiling/TileStrategy","../engine/webgl/Overlay","../engine/webgl/OverlayContainer","./LayerView2D","../../layers/LayerView","../../layers/MediaLayerView","../../support/Scheduler"],function(e,t,r,i,s,o,n,a,l,c,h,p,d,u,m,g,y,f,_,w,v,b,S,x,M,R,C,E,T,V,O,q,P,A,L,G,I,U,H,k,D,j,W,z,F,B,N,Q,J,K,X,Z,Y,$,ee,te,re,ie,se,oe,ne,ae,le,ce,he,pe,de,ue,me,ge,ye,fe,_e,we,ve,be,Se,xe,Me,Re,Ce,Ee,Te,Ve,Oe,qe,Pe,Ae,Le,Ge,Ie,Ue,He,ke,De,je,We,ze,Fe,Be,Ne,Qe,Je,Ke,Xe,Ze,Ye,$e,et,tt,rt,it,st,ot,nt,at,lt,ct,ht,pt,dt,ut,mt,gt,yt,ft,_t,wt,vt,bt,St,xt,Mt,Rt,Ct,Et,Tt,Vt,Ot,qt,Pt,At,Lt,Gt,It,Ut,Ht,kt,Dt,jt){"use strict";let Wt=class extends(Ht.LayerView2DMixin(Dt(kt))){constructor(){super(...arguments),this._overlayContainer=null,this._fetchQueue=null,this._tileStrategy=null,this._elementReferences=new Map,this._debugGraphicsView=null,this._interaction=null,this.layer=null,this.elements=new i}initialize(){this.addHandles([c.watch(()=>[this.interactive,this.suspended],async()=>{if(this.interactive&&!this._interaction){const{MediaLayerInteraction:t}=await new Promise((t,r)=>e(["./support/MediaLayerInteraction"],t,r));this._interaction=new t({view:this.view,layer:this.layer}),this.selectedElement!==this._interaction.selectedElement&&(this._interaction.selectedElement=this.selectedElement),this.interactionOptions!==this._interaction.options&&(this._interaction.options=this.interactionOptions)}this._interaction&&(this._interaction.enabled=!this.suspended&&this.interactive)},c.syncAndInitial),c.watch(()=>this.interactionOptions,e=>{this._interaction&&(this._interaction.options=e)},c.syncAndInitial),c.watch(()=>this.selectedElement,e=>{this._interaction&&(this._interaction.selectedElement=e)},c.syncAndInitial)])}attach(){this.addAttachHandles([c.on(()=>this.layer.effectiveSource,"refresh",()=>{this._tileStrategy.refresh(e=>this._updateTile(e)),this.requestUpdate()}),c.on(()=>this.layer.effectiveSource,"change",({element:e})=>this._elementUpdateHandler(e))]),this._overlayContainer=new Ut,this.container.addChild(this._overlayContainer),this._fetchQueue=new Lt({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(e,t)=>this._queryElements(e,t),scheduler:this.scheduler,priority:jt.TaskPriority.MAPVIEW_FETCH_QUEUE}),this._tileStrategy=new Gt({cachePolicy:"purge",resampling:!0,acquireTile:e=>this._acquireTile(e),releaseTile:e=>this._releaseTile(e),tileInfoView:this.view.featuresTilingScheme}),this.requestUpdate()}detach(){this.elements.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.destroy(),this._overlayContainer.removeAllChildren(),this.container.removeAllChildren(),this._elementReferences.clear(),this._debugGraphicsView?.destroy()}supportsSpatialReference(e){return!0}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}update(e){this._tileStrategy.update(e),this._debugGraphicsView?.update(e)}async hitTest(e,t){const r=[],i=e.normalize(),s=[i.x,i.y];for(const{elementView:{normalizedCoords:t,element:i}}of this._elementReferences.values())null!=t&&g.ringsContainsCoords(t.rings,s)&&r.push({type:"media",element:i,layer:this.layer,mapPoint:e,sourcePoint:i.toSource(e)});return r.reverse()}canResume(){return null!=this.layer.source&&super.canResume()}async doRefresh(){this._fetchQueue.reset(),this._tileStrategy.refresh(e=>this._updateTile(e))}_acquireTile(e){const t=new Nt(e.clone());return this._updateTile(t),t}_updateTile(e){this._updatingHandles.addPromise(this._fetchQueue.push(e.key).then(t=>{const[r,i]=e.setElements(t);this._referenceElements(e,r),this._dereferenceElements(e,i),this.requestUpdate()},e=>{l.isAbortError(e)||n.getLogger(this).error(e)}))}_releaseTile(e){this._fetchQueue.abort(e.key.id),e.elements&&this._dereferenceElements(e,e.elements),this.requestUpdate()}async _queryElements(e,t){const r=this.layer.effectiveSource;if(null==r)return[];this.view.featuresTilingScheme.getTileBounds(zt,e,!0);const i=new u({xmin:zt[0],ymin:zt[1],xmax:zt[2],ymax:zt[3],spatialReference:this.view.spatialReference});return r.queryElements(i,t)}_referenceElements(e,t){if(null!=this.layer.source)for(const r of t)this._referenceElement(e,r)}_referenceElement(e,t){a.getOrCreateMapValue(this._elementReferences,t.uid,()=>{const e=new f.MediaElementView({element:t,spatialReference:this.view.spatialReference}),r=new It(e);return this._overlayContainer.addChild(r),this.elements.add(t),this._updatingHandles.addPromise(t.load().catch(e=>{n.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new s("element-load-error","Element cannot be displayed",{element:t,error:e}))})),{debugGraphic:null,elementView:e,overlay:r,tiles:new Set}}).tiles.add(e)}_dereferenceElements(e,t){for(const r of t)this._dereferenceElement(e,r)}_dereferenceElement(e,t){const r=this._elementReferences.get(t.uid);r.tiles.delete(e),r.tiles.size||(this._overlayContainer.removeChild(r.overlay),r.overlay.destroy(),r.elementView.destroy(),this._elementReferences.delete(t.uid),this.elements.remove(t),this._debugGraphicsView?.graphics.remove(r.debugGraphic))}_elementUpdateHandler(e){let t=this._elementReferences.get(e.uid);if(t){const r=t.elementView.normalizedCoords;if(null==r)return this._overlayContainer.removeChild(t.overlay),t.overlay.destroy(),t.elementView.destroy(),this._elementReferences.delete(e.uid),this.elements.remove(e),void this._debugGraphicsView?.graphics.remove(t.debugGraphic);const i=[],s=[];for(const e of this._tileStrategy.tiles){const o=Bt(this.view.featuresTilingScheme,e,r);t.tiles.has(e)?o||s.push(e):o&&i.push(e)}for(const t of i)this._referenceElement(t,e);for(const t of s)this._dereferenceElement(t,e);return t=this._elementReferences.get(e.uid),void(t?.debugGraphic&&(t.debugGraphic.geometry=t.elementView.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:t.debugGraphic,property:"geometry"})))}const r=new f.MediaElementView({element:e,spatialReference:this.view.spatialReference}).normalizedCoords;if(null!=r)for(const t of this._tileStrategy.tiles)Bt(this.view.featuresTilingScheme,t,r)&&this._referenceElement(t,e)}};t.__decorate([h.property()],Wt.prototype,"layer",void 0),t.__decorate([h.property({readOnly:!0})],Wt.prototype,"elements",void 0),Wt=t.__decorate([d.subclass("esri.views.2d.layers.MediaLayerView2D")],Wt);const zt=m.create(),Ft={xmin:0,ymin:0,xmax:0,ymax:0};function Bt(e,t,r){return e.getTileBounds(zt,t.key,!0),Ft.xmin=zt[0],Ft.ymin=zt[1],Ft.xmax=zt[2],Ft.ymax=zt[3],y.extentIntersectsPolygon(Ft,r)}class Nt{constructor(e){this.key=e,this.elements=null,this.isReady=!1,this.visible=!0}setElements(e){const t=[],r=new Set(this.elements);this.elements=e;for(const i of e)r.has(i)?r.delete(i):t.push(i);return this.isReady=!0,[t,Array.from(r)]}destroy(){}}return Wt});