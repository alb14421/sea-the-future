// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/graphic/isVectorTileGraphicOrigin":function(){define(["exports"],function(e){"use strict";const t=Symbol("isVectorTileGraphicOrigin");e.isVectorTileGraphicOrigin=function(e){return!!e&&t in e},e.isVectorTileGraphicOriginSymbol=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/TileHandler":function(){define(["exports","../../../../core/maybe","../../../../core/promiseUtils","../../../../core/urlUtils","../../../../core/workers/workers","./GlyphMosaic","./GlyphSource","./SpriteMosaic","../../tiling/TileKey"],function(e,t,i,r,s,a,n,o,l){"use strict";e.TileHandler=class{constructor(e,t,i,r){this._layer=e,this._styleRepository=t,this.devicePixelRatio=i,this._sourceDataMaxLOD=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._spriteSourceAbortController=null,this._startOptionsInputSignal=null,this._inputSignalEventListener=null}destroy(){this._connection?.close(),this._connection=null,this._styleRepository=null,this._layer=null,this._spriteMosaic?.destroy(),this._spriteMosaic=null,this._glyphMosaic=null,this._spriteSourceAbortController=t.abortMaybe(this._spriteSourceAbortController),this._spriteSourcePromise=null,this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,this._inputSignalEventListener=null}get spriteMosaic(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}get glyphMosaic(){return this._glyphMosaic}async start(e){this._requestSprite(e);const t=this._layer.currentStyleInfo.glyphsUrl,o=new n(t?r.addQueryParameters(t,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new a(1024,1024,o),this._broadcastPromise=s.open("WorkerTileHandler",{client:this,schedule:e.schedule,signal:e.signal}).then(t=>{if(this._layer&&(this._connection?.close(),this._connection=t,this._layer&&!this._connection.closed)){const r=t.broadcast("setStyle",{style:this._layer.currentStyleInfo.style,sourceDataMaxLOD:this._sourceDataMaxLOD},e);Promise.all(r).catch(e=>i.throwIfNotAbortError(e))}})}_requestSprite(e){this._spriteSourceAbortController?.abort();const t=new AbortController;this._spriteSourceAbortController=t;const r=e?.signal;this._inputSignalEventListener&&this._startOptionsInputSignal?.removeEventListener("abort",this._inputSignalEventListener),this._startOptionsInputSignal=null,r&&(this._inputSignalEventListener=function(e){return()=>e.abort()}(t),r.addEventListener("abort",this._inputSignalEventListener,{once:!0}));const{signal:s}=t,a={...e,signal:s};this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,a),this._spriteSourcePromise.then(e=>{i.throwIfAbortError(s),this._spriteMosaic=new o(1024,1024,250),this._spriteMosaic.setSpriteSource(e)})}async updateStyle(e){const t=[];for(const i of e)4===i.type?t.push({type:4,data:{spriteSource:null}}):t.push(i);return await this._broadcastPromise,this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",t)),this._broadcastPromise}setSpriteSource(e){const t=new o(1024,1024,250);return t.setSpriteSource(e),this._spriteMosaic=t,this._spriteSourcePromise=Promise.resolve(e),this._spriteSourceAbortController=null,t}async setStyle(e,t,i){await this._broadcastPromise,this._styleRepository=e,this._sourceDataMaxLOD=i,this._requestSprite();const s=new n(this._layer.currentStyleInfo.glyphsUrl?r.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);return this._glyphMosaic=new a(1024,1024,s),this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",{style:t,sourceDataMaxLOD:this._sourceDataMaxLOD})),this._broadcastPromise}async fetchTileData(e,t){const i=await this._getRefKeys(e,t);return this._getSourcesData(Object.keys(this._layer.sourceNameToSource),i,t)}async fetchTilePBFs(e){const t=Object.keys(this._layer.sourceNameToSource),i={},r=await this._getRefKeys(e,i),s=[],a=[];for(let e=0;e<r.length;e++)if(null==r[e].value||null==t[e])a.push(null);else{const n=r[e].value,o=this._getTilePayload(n,t[e],i);o.then(e=>{s.push({...e,key:n})}),a.push(o)}return Promise.all(a).then(()=>s)}async parseTileData(e,t){const i=e&&e.data;if(!i)return null;const{sourceName2DataAndRefKey:r,transferList:s}=i;return 0===Object.keys(r).length?null:this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:e.key.id,sourceName2DataAndRefKey:r,styleLayerUIDs:e.styleLayerUIDs},{...t,transferList:s}))}async getSprites(e){return await this._spriteSourcePromise,this._spriteMosaic.getSpriteItems(e)}getGlyphs(e){return this._glyphMosaic.getGlyphItems(e.font,e.codePoints)}async _getTilePayload(e,t,r){const s=l.pool.acquire(e.id),a=this._layer.sourceNameToSource[t],{level:n,row:o,col:c}=s;l.pool.release(s);try{return{protobuff:await a.requestTile(n,o,c,r),sourceName:t}}catch(e){if(i.isAbortError(e))throw e;return{protobuff:null,sourceName:t}}}async _getRefKeys(e,t){const r=this._layer.sourceNameToSource,s=new Array;for(const i in r){const a=r[i].getRefKey(e,t);s.push(a)}return i.eachAlways(s)}_getSourcesData(e,t,r){const s=[];for(let i=0;i<t.length;i++)if(null==t[i].value||null==e[i])s.push(null);else{const a=t[i].value,n=this._getTilePayload(a,e[i],r);s.push(n)}return i.eachAlways(s).then(e=>{const i={},r=[];for(let s=0;s<e.length;s++){const a=e[s].value;if(a&&a.protobuff&&a.protobuff.byteLength>0){const e=t[s].value.id;i[a.sourceName]={refKey:e,protobuff:a.protobuff},r.push(a.protobuff)}}return{sourceName2DataAndRefKey:i,transferList:r}})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack","../webgl/Rect","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,i,r){"use strict";return class{constructor(t,i,r){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,this.width=t,this.height=i,this._glyphSource=r,this._binPack=new e(t-4,i-4),this._glyphData.push(new Uint8Array(t*i)),this._dirties.push(!0),this._textures.push(void 0)}getGlyphItems(i,r){const s=[],a=this._glyphSource,n=new Set,o=1/256;for(const e of r){const t=Math.floor(e*o);n.add(t)}const l=[];return n.forEach(e=>{const t=i+e;if(this._rangePromises.has(t))l.push(this._rangePromises.get(t));else{const r=a.getRange(i,e).then(()=>{this._rangePromises.delete(t)},()=>{this._rangePromises.delete(t)});this._rangePromises.set(t,r),l.push(r)}}),Promise.all(l).then(()=>{let n=this._glyphIndex[i];n||(n={},this._glyphIndex[i]=n);for(const o of r){const r=n[o];if(r){s[o]={sdf:!0,rect:r.rect,metrics:r.metrics,page:r.page,code:o};continue}const l=a.getGlyph(i,o);if(!l?.metrics)continue;const c=l.metrics;let h;if(0===c.width)h=new t(0,0,0,0);else{const t=3,i=c.width+2*t,r=c.height+2*t;let s=i%4?4-i%4:4,a=r%4?4-r%4:4;1===s&&(s=5),1===a&&(a=5),h=this._binPack.allocate(i+s,r+a),h.isEmpty&&(this._dirties[this._currentPage]||(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new e(this.width-4,this.height-4),h=this._binPack.allocate(i+s,r+a));const n=this._glyphData[this._currentPage],o=l.bitmap;let u,p;if(o)for(let e=0;e<r;e++){u=i*e,p=this.width*(h.y+e+1)+h.x;for(let e=0;e<i;e++)n[p+e+1]=o.at(u+e)}}n[o]={rect:h,metrics:c,tileIDs:null,page:this._currentPage},s[o]={sdf:!0,rect:h,metrics:c,page:this._currentPage,code:o},this._dirties[this._currentPage]=!0}return s})}removeGlyphs(e){for(const t in this._glyphIndex){const i=this._glyphIndex[t];if(!i)continue;let r;for(const t in i)if(r=i[t],r.tileIDs.delete(e),0===r.tileIDs.size){const e=this._glyphData[r.page],s=r.rect;let a,n;for(let t=0;t<s.height;t++)for(a=this.width*(s.y+t)+s.x,n=0;n<s.width;n++)e[a+n]=0;delete i[t],this._dirties[r.page]=!0}}}bind(e,t,s,a=0){if(!this._textures[s]){const t=new r.TextureDescriptor(this.width,this.height);t.pixelFormat=6406,t.wrapMode=33071,this._textures[s]=new i.Texture(e,t,new Uint8Array(this.width*this.height))}const n=this._textures[s];n.setSamplingMode(t),this._dirties[s]&&n.setData(this._glyphData[s]),e.bindTexture(n,a),this._dirties[s]=!1}destroy(){this.dispose()}dispose(){this._glyphData.length=0,this._binPack=null;for(const e of this._textures)e&&e.dispose();this._textures.length=0}}})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../webgl/Rect"],function(e){"use strict";return class{constructor(t,i){this._width=0,this._height=0,this._free=[],this._width=t,this._height=i,this._free.push(new e(0,0,t,i))}get width(){return this._width}get height(){return this._height}allocate(t,i){if(t>this._width||i>this._height)return new e;let r=null,s=-1;for(let e=0;e<this._free.length;++e){const a=this._free[e];t<=a.width&&i<=a.height&&(null===r||a.y<=r.y&&a.x<=r.x)&&(r=a,s=e)}return null===r?new e:(this._free.splice(s,1),r.width<r.height?(r.width>t&&this._free.push(new e(r.x+t,r.y,r.width-t,i)),r.height>i&&this._free.push(new e(r.x,r.y+i,r.width,r.height-i))):(r.width>t&&this._free.push(new e(r.x+t,r.y,r.width-t,r.height)),r.height>i&&this._free.push(new e(r.x,r.y+i,t,r.height-i))),new e(r.x,r.y,t,i))}release(e){for(let t=0;t<this._free.length;++t){const i=this._free[t];if(i.y===e.y&&i.height===e.height&&i.x+i.width===e.x)i.width+=e.width;else if(i.x===e.x&&i.width===e.width&&i.y+i.height===e.y)i.height+=e.height;else if(e.y===i.y&&e.height===i.height&&e.x+e.width===i.x)i.x=e.x,i.width+=e.width;else{if(e.x!==i.x||e.width!==i.width||e.y+e.height!==i.y)continue;i.y=e.y,i.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)}}})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(e,t){"use strict";class i{constructor(e){if(this._metrics=[],!e)return void(this._allBitmaps=null);const t=new Map;let i=0;for(;e.next();)switch(e.tag()){case 1:{const r=e.getMessage();for(;r.next();)switch(r.tag()){case 3:{const e=r.getMessage();let s,a,n,o,l,c,h;for(;e.next();)switch(e.tag()){case 1:s=e.getUInt32();break;case 2:a=e.getBytes();break;case 3:n=e.getUInt32();break;case 4:o=e.getUInt32();break;case 5:l=e.getSInt32();break;case 6:c=e.getSInt32();break;case 7:h=e.getUInt32();break;default:e.skip()}if(e.release(),s){const e=a?.length??0;this._metrics[s]={width:n,height:o,left:l,top:c,advance:h,startOffset:i,length:e},t.set(s,a),i+=e}break}default:r.skip()}r.release();break}default:e.skip()}const r=new Uint8Array(i),s=this._metrics;for(const[e,i]of t){const{startOffset:t,length:a}=s[e];if(i)for(let e=0;e<a;++e)r[t+e]=i[e]}this._allBitmaps=r}getMetrics(e){return this._metrics[e]}getBitmap(e){if(!this._allBitmaps)return;const t=this._metrics[e];if(void 0===t)return;const{startOffset:i,length:r}=t;return 0!==r?new s(this._allBitmaps,i,r):void 0}}class r{constructor(){this._ranges=[]}get ranges(){return this._ranges}getRange(e){return this._ranges[e]}addRange(e,t){this._ranges[e]=t}}class s{constructor(e,t,i){this._array=e,this._start=t,this.length=i}at(e){return 0<=e&&e<this.length?this._array[this._start+e]:void 0}}return class{constructor(e){this._glyphInfo={},this._baseURL=e}getRange(r,s){const a=this._getFontStack(r);if(a.getRange(s))return Promise.resolve();const n=256*s,o=n+255;if(this._baseURL){const l=this._baseURL.replace("{fontstack}",r).replace("{range}",n+"-"+o);return e(l,{responseType:"array-buffer"}).then(e=>{a.addRange(s,new i(new t(new Uint8Array(e.data),new DataView(e.data))))}).catch(()=>{a.addRange(s,new i)})}return a.addRange(s,new i),Promise.resolve()}getGlyph(e,t){const i=this._getFontStack(e);if(!i)return;const r=Math.floor(t/256),s=i.getRange(r);return s?{metrics:s.getMetrics(t),bitmap:s.getBitmap(t)}:void 0}_getFontStack(e){let t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new r),t}}})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define(["../../../../core/has","../../../../symbols/cim/rasterizingUtils","./RectangleBinPack","../webgl/Rect","../../../webgl/Texture","../../../webgl/TextureDescriptor"],function(e,t,i,r,s,a){"use strict";class n{constructor(e,t,r=0){this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,t<=0&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,r>0&&(this._maxItemSize=r),this._binPack=new i(e-4,t-4)}destroy(){this.dispose()}dispose(){this._binPack=null,this._mosaicsData.length=0,this._mosaicRects={};for(const e of this._textures)e&&e.dispose();this._textures.length=0}getWidth(e){return e>=this._size.length?-1:this._size[e][0]}getHeight(e){return e>=this._size.length?-1:this._size[e][1]}getPageSize(e){return e>=this._size.length?null:this._size[e]}setSpriteSource(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new i(this._pageWidth-4,this._pageHeight-4);const e=Math.floor(this._pageWidth),t=Math.floor(this._pageHeight),r=new Uint32Array(e*t);this._mosaicsData[0]=r,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e}getSpriteItem(e,t=!1){let i,r,s=this._mosaicRects[e];if(s)return s;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;if(e&&e.startsWith("dasharray-")?([i,r]=this._rasterizeDash(e),t=!0):i=this._sprites.getSpriteInfo(e),!i?.width||!i.height||i.width<0||i.height<0)return null;const a=i.width,n=i.height,[o,l,c]=this._allocateImage(a,n);return o.width<=0?null:(this._copy(o,i,l,c,t,r),s={type:"sprite",rect:o,width:a,height:n,sdf:i.sdf,simplePattern:!1,rasterizationScale:i.pixelRatio??1,samplingMode:"Linear",page:l},this._mosaicRects[e]=s,s)}getSpriteItems(e){const t={};for(const i of e)t[i.name]=this.getSpriteItem(i.name,i.repeat);return t}getMosaicItemPosition(e,t){const i=this.getSpriteItem(e,t),r=i?.rect;if(!r)return null;r.width=i.width,r.height=i.height;const s=i.width,a=i.height;return{tl:[r.x+2,r.y+2],br:[r.x+2+s,r.y+2+a],page:i.page}}bind(e,t,i=0,r=0){if(i>=this._size.length||i>=this._mosaicsData.length)return;if(!this._textures[i]){const t=new a.TextureDescriptor(this._size[i][0],this._size[i][1]);t.wrapMode=33071,this._textures[i]=new s.Texture(e,t,new Uint8Array(this._mosaicsData[i].buffer))}const n=this._textures[i];n.setSamplingMode(t),this._dirties[i]&&n.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(n,r),this._dirties[i]=!1}static _copyBits(e,t,i,r,s,a,n,o,l,c,h){let u=r*t+i,p=o*a+n;if(h){p-=a;for(let n=-1;n<=c;n++,u=((n+c)%c+r)*t+i,p+=a)for(let t=-1;t<=l;t++)s[p+t]=e[u+(t+l)%l]}else for(let i=0;i<c;i++){for(let t=0;t<l;t++)s[p+t]=e[u+t];u+=t,p+=a}}_copy(e,t,i,r,s,a){if(!this._sprites||"loaded"!==this._sprites.loadStatus||i>=this._mosaicsData.length)return;const o=new Uint32Array(a?a.buffer:this._sprites.image.buffer),l=this._mosaicsData[i],c=a?t.width:this._sprites.width;n._copyBits(o,c,t.x,t.y,l,r[0],e.x+2,e.y+2,t.width,t.height,s),this._dirties[i]=!0}_allocateImage(e,t){e+=2,t+=2;const s=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<s){const i=new r(0,0,e,t);return this._mosaicsData.push(new Uint32Array(e*t)),this._dirties.push(!0),this._size.push([e,t]),this._textures.push(void 0),[i,this._mosaicsData.length-1,[e,t]]}let a=e%4?4-e%4:4,n=t%4?4-t%4:4;1===a&&(a=5),1===n&&(n=5);const o=this._binPack.allocate(e+a,t+n);return o.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new i(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[o,this._currentPage,[this._pageWidth,this._pageHeight]]}_rasterizeDash(e){const i=e.match(/\[(.*?)\]/);if(!i)return null;const r=i[1].split(",").map(Number),s=e.slice(e.lastIndexOf("-")+1),[a,n,o]=t.rasterizeDash(r,s);return[{x:0,y:0,width:n,height:o,sdf:!0,pixelRatio:1},new Uint8Array(a.buffer)]}}return n})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/LRUCache","../../../../geometry/support/aaBoundingRect","./constants","../../tiling/TileCoverage","../../tiling/TileKey"],function(e,t,i,r,s,a){"use strict";const n=(e,t)=>e+1/(1<<2*t);function o(e){const[t,i,r,s]=e.split("/"),a=parseInt(t,10);return 0===a?null:`${a-1}/${parseInt(i,10)>>1}/${parseInt(r,10)>>1}/${parseInt(s,10)}`}e.TileManager=class{constructor(e,i){this._tiles=new Map,this._tileCache=new t.LRUCache(40,e=>e.dispose()),this._viewSize=[0,0],this._visibleTiles=new Map,this.acquireTile=e.acquireTile,this.releaseTile=e.releaseTile,this.tileInfoView=e.tileInfoView,this._container=i}destroy(){for(const e of this._tiles.values())e.dispose();this._tiles=null,this._tileCache.clear(),this._tileCache=null}update(e){this._updateCacheSize(e);const t=this.tileInfoView,i=t.getTileCoverage(e.state,0,!0,"smallest");if(!i)return!0;const{spans:r,lodInfo:n}=i,{level:o}=n,l=this._tiles,c=new Set,h=new Set;for(const{row:e,colFrom:t,colTo:i}of r)for(let r=t;r<=i;r++){const t=a.getId(o,e,n.normalizeCol(r),n.getWorldForColumn(r)),i=this._getOrAcquireTile(t);c.add(t),i.processed()?this._addToContainer(i):h.add(new a(t))}for(const[e,t]of l)t.isCoverage=c.has(e);for(const e of h)this._findPlaceholdersForMissingTiles(e,c);let u=!1;for(const[e,r]of l)r.neededForCoverage=c.has(e),r.neededForCoverage||r.isHoldingForFade&&t.intersects(i,r.key)&&c.add(e),r.isFading&&(u=!0);for(const e of this._tiles.keys())c.has(e)||this._releaseTile(e);return s.pool.release(i),!u}clear(){this._tiles.clear(),this._tileCache.clear(),this._visibleTiles.clear()}clearCache(){this._tileCache.clear()}getIntersectingTiles(e,t,r,s,a){const n=[0,0],o=[0,0];s.toMap(n,e-r,t+r),s.toMap(o,e+r,t-r);const l=Math.min(n[0],o[0]),c=Math.min(n[1],o[1]),h=Math.max(n[0],o[0]),u=Math.max(n[1],o[1]),p=i.fromValues(l,c,h,u),y=i.create(),d=[];for(const e of this._visibleTiles.values())this.tileInfoView.getTileBounds(y,e.key),i.intersects(p,y)&&d.push(e);if(null!=a&&a.length>0){const e=new Set(d.map(e=>e.id)),t=a.filter(t=>!e.has(t.tileKey.id)).map(e=>this._visibleTiles.get(e.tileKey.id)).filter(e=>void 0!==e);d.push(...t)}return d}_findPlaceholdersForMissingTiles(e,t){const i=[];for(const r of this._tiles.values())this._addPlaceholderChild(i,r,e,t);const r=i.reduce(n,0);Math.abs(1-r)<1e-6||this._addPlaceholderParent(e.id,t)}_addPlaceholderChild(e,t,i,r){t.key.level<=i.level||!t.hasData()||function(e,t){const i=t.level-e.level;return e.row===t.row>>i&&e.col===t.col>>i&&e.world===t.world}(i,t.key)&&(this._addToContainer(t),r.add(t.id),e.push(t.key.level-i.level))}_addPlaceholderParent(e,t){const i=this._tiles;let r=e;for(;;){if(r=o(r),!r||t.has(r))return;const e=i.get(r);if(e?.hasData())return this._addToContainer(e),void t.add(e.id)}}_getOrAcquireTile(e){let t=this._tiles.get(e);return t||(t=this._tileCache.pop(e),t||(t=this.acquireTile(new a(e))),this._tiles.set(e,t),t)}_releaseTile(e){const t=this._tiles.get(e);this.releaseTile(t),this._removeFromContainer(t),this._tiles.delete(e),t.hasData()?this._tileCache.put(e,t,1):t.dispose()}_addToContainer(e){let t;const i=[],r=this._container;if(r.contains(e))return;const s=this._visibleTiles;for(const r of s.values())this._canConnectDirectly(e,r)&&i.push(r),null==t&&this._canConnectDirectly(r,e)&&(t=r);if(null!=t){for(const r of i)t.childrenTiles.delete(r),e.childrenTiles.add(r),r.parentTile=e;t.childrenTiles.add(e),e.parentTile=t}else for(const t of i)e.childrenTiles.add(t),t.parentTile=e;s.set(e.id,e),r.addChild(e)}_removeFromContainer(e){if(this._visibleTiles.delete(e.id),this._container.removeChild(e),null!=e.parentTile){e.parentTile.childrenTiles.delete(e);for(const t of e.childrenTiles)null!=e.parentTile&&e.parentTile.childrenTiles.add(t)}for(const t of e.childrenTiles)t.parentTile=e.parentTile;e.parentTile=null,e.childrenTiles.clear()}_canConnectDirectly(e,t){const i=e.key;let{level:r,row:s,col:a,world:n}=t.key;const o=this._visibleTiles;for(;r>0;){if(r--,s>>=1,a>>=1,i.level===r&&i.row===s&&i.col===a&&i.world===n)return!0;if(o.has(`${r}/${s}/${a}/${n}`))return!1}return!1}_updateCacheSize(e){const t=e.state.size;if(t[0]===this._viewSize[0]&&t[1]===this._viewSize[1])return;const i=Math.ceil(t[0]/r.tilePixelSize)+1,s=Math.ceil(t[1]/r.tilePixelSize)+1;this._viewSize[0]=t[0],this._viewSize[1]=t[1],this._tileCache.maxSize=5*i*s}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define(["exports","../../../../geometry/support/aaBoundingRect","../../../../layers/support/TileInfo","./constants","./decluttering/SymbolFader","./decluttering/util","../webgl/RenderableTile","../webgl/TileContainer","../../tiling/TileCoverage","../../tiling/TileKey"],function(e,t,i,r,s,a,n,o,l,c){"use strict";const h=1e-6;function u(e,t){if(e){const i=e.getLayoutProperty("visibility");if(!i||1!==i.getValue()&&(void 0===e.minzoom||e.minzoom<t+h)&&(void 0===e.maxzoom||e.maxzoom>=t-h))return!0}return!1}e.VectorTileContainer=class extends o{constructor(e){super(e),this._backgroundTiles=[],this._computeDisplayInfoView(e)}destroy(){super.destroy(),this.removeAllChildren(),this._spriteMosaic?.dispose(),this._spriteMosaic=null,this._glyphMosaic?.dispose(),this._glyphMosaic=null,null!=this._symbolFader&&(this._symbolFader.clear(),this._symbolFader=null),this._styleRepository=null,this._backgroundTiles=[]}get fading(){return this._symbolFader?.fading??!1}get symbolFader(){return this._symbolFader}get symbolRepository(){return this._symbolFader?.symbolRepository}setStyleResources(e,t,i,n){if(this._spriteMosaic=e,this._glyphMosaic=t,this._styleRepository=i,this.tileInfoView=n,this._computeDisplayInfoView(n),null==this._symbolFader){const e=(e,t)=>{e.allSymbolsFadingOut=!0,e.lastOpacityUpdate=t,a.writeOpacityToBuffers(e,t,!0),e.decluttered=!0,e.requestRender()};this._symbolFader=new s.SymbolFader("vector-tile",this._styleRepository,e,this.children,r.tileCoordSize)}this._symbolFader.styleRepository=i}setSpriteMosaic(e){this._spriteMosaic?.dispose(),this._spriteMosaic=e}deleteStyleLayers(e){null!=this._symbolFader&&this._symbolFader.deleteStyleLayers(e)}createRenderParams(e){return{...super.createRenderParams(e),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}}doRender(e){!this.visible||1!==e.drawPhase&&64!==e.drawPhase||void 0===this._spriteMosaic||super.doRender(e)}addChild(e){return super.addChild(e),null!=this._symbolFader?this._symbolFader.addTile(e):e.decluttered=!0,this.requestRender(),e}removeChild(e){return null!=this._symbolFader&&this._symbolFader.removeTile(e),this.requestRender(),super.removeChild(e)}renderChildren(e){const{drawPhase:t}=e;64!==t?this._doRender(e):super.renderChildren(e)}removeAllChildren(){for(let e=0;e<this.children.length;e++){const t=this.children[e];null!=this._symbolFader&&this._symbolFader.removeTile(t),t.dispose()}super.removeAllChildren()}getStencilTarget(){return this.children.filter(e=>e.neededForCoverage&&e.hasData())}restartDeclutter(){null!=this._symbolFader&&this._symbolFader.restartDeclutter()}_doRender(e){const{context:t,state:i}=e,r=this._styleRepository;if(!r)return;const s=r.layers,a=this._displayInfo.scaleToZoom(i.scale);r.backgroundBucketIds.length>0&&(e.renderPass="background",this._renderBackgroundLayers(e,r.backgroundBucketIds,a)),super.renderChildren(e),1===e.drawPhase&&this._fade(a,i);const n=this.children.filter(e=>e.visible&&e.hasData());if(!n||0===n.length)return t.bindVAO(null),t.setStencilTestEnabled(!0),void t.setBlendingEnabled(!0);for(const e of n)e.triangleCount=0;t.setStencilWriteMask(0),t.setColorMask(!0,!0,!0,!0),t.setStencilOp(7680,7680,7681),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!1),t.setDepthTestEnabled(!0),t.setDepthWriteEnabled(!0),t.setDepthFunction(515),t.setClearDepth(1),t.clear(256),e.renderPass="opaque";for(let t=s.length-1;t>=0;t--)this._renderStyleLayer(s[t],e,n);t.setDepthWriteEnabled(!1),t.setBlendingEnabled(!0),t.setBlendFunctionSeparate(1,771,1,771),e.renderPass="translucent";for(let t=0;t<s.length;t++)this._renderStyleLayer(s[t],e,n);t.bindVAO(null),t.setStencilTestEnabled(!0),t.setBlendingEnabled(!0);for(const e of n)e.debugInfo.display.triangleCount=e.triangleCount}_fade(e,t){null!=this._symbolFader&&(this._symbolFader.update(e,t)||this.requestRender())}_renderStyleLayer(e,t,i){const{displayLevel:r,painter:s,renderPass:a}=t;if(void 0===e)return;const n=e.getLayoutProperty("visibility");if(n&&1===n.getValue())return;let o;switch(e.type){case 0:return;case 1:if("opaque"!==a&&"translucent"!==t.renderPass)return;o="vtlFill";break;case 2:if("translucent"!==a)return;o="vtlLine";break;case 4:if("translucent"!==a)return;o="vtlCircle";break;case 3:if("translucent"!==a)return;o="vtlSymbol"}if(i=3===e.type?i.filter(e=>e.decluttered):i.filter(e=>e.neededForCoverage),"vtlSymbol"!==o&&(0===i.length||void 0!==e.minzoom&&e.minzoom>=r+h||void 0!==e.maxzoom&&e.maxzoom<r-h))return;const l=e.uid;t.styleLayerUID=l,t.styleLayer=e;for(const e of i)if(e.layerData.has(l)){s.renderObjects(t,i,o);break}}_renderBackgroundLayers(e,i,s){const{context:a,painter:o,state:h}=e,p=this._styleRepository;let y=!1;for(const e of i)if(0===p.getLayerById(e).type&&u(p.getLayerById(e),s)){y=!0;break}if(!y)return;const d=this.tileInfoView,g=d.getTileCoverage(e.state,0,!0,"smallest"),{spans:f,lodInfo:_}=g,{level:m}=_,b=t.create(),T=[];if(this._renderPasses){const t=this._renderPasses[0];null!=this._clippingInfos&&(t.brushes[0].prepareState(e),t.brushes[0].drawMany(e,this._clippingInfos))}const w=this._backgroundTiles;let v,x=0;for(const{row:e,colFrom:i,colTo:s}of f)for(let a=i;a<=s;a++){if(x<w.length)v=w[x],v.key.set(m,e,_.normalizeCol(a),_.getWorldForColumn(a)),d.getTileBounds(b,v.key,!1),v.x=b[0],v.y=b[3],v.resolution=d.getTileResolution(m);else{const i=new c(m,e,_.normalizeCol(a),_.getWorldForColumn(a)),s=d.getTileBounds(t.create(),i),o=d.getTileResolution(m);v=new n.RenderableTile(i,o,s[0],s[3],r.tilePixelSize,r.tilePixelSize,r.tileCoordSize,r.tileCoordSize),w.push(v)}v.setTransform(h),T.push(v),x++}a.setStencilWriteMask(0),a.setColorMask(!0,!0,!0,!0),a.setStencilOp(7680,7680,7681),a.setStencilFunction(514,0,255),a.setStencilTestEnabled(!0);for(const t of i){const i=p.getLayerById(t);0===i.type&&u(i,s)&&(e.styleLayerUID=i.uid,e.styleLayer=i,o.renderObjects(e,T,"vtlBackground"))}l.pool.release(g)}_computeDisplayInfoView(e){let t=e.tileInfo.lods[0].scale;const s=Math.max(25,e.tileInfo.lods.length),a=[];for(let e=0;e<=s;e++)a.push(t),t/=2;this._displayInfo=i.create({scales:a,size:r.tilePixelSize,spatialReference:e.spatialReference,numLODs:s})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports","../../../../core/libs/gl-matrix-2/factories/mat3f32","./TiledDisplayObject"],function(e,t,i){"use strict";class r extends i.TiledDisplayObject{_createTransforms(){return{displayViewScreenMat3:t.create(),tileMat3:t.create()}}}e.RenderableTile=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileFeatureIndex":function(){define(["../../../../Graphic","../../../../core/MapUtils","../../../../core/pbf","../../../../core/libs/rbush/PooledRBush","../../../../graphic/VectorTileGraphicOrigin","./constants","./Feature","./GeometryUtils","./SourceLayerData","./style/StyleLayer"],function(e,t,i,r,s,a,n,o,l,c){"use strict";const h=(e,t)=>{const i=e.vtlSymbol.sourceTile,r=t.vtlSymbol.sourceTile;return i.level!==r.level?i.level-r.level:i.row!==r.row?i.row-r.row:i.col!==r.col?i.col-r.col:e.styleLayerUID-t.styleLayerUID};class u{constructor(e,t,i,r,s){this.tileKey=e,this._tileLayerData=t,this._styleRepository=i,this._tileHandler=r,this._parentLayer=s,this._index=null,this._tileKeyToPBF=new Map}static create(e,t,i,r,s){return new u(e,t,i,r,s)}clear(){this._index?.clear(),this._tileKeyToPBF.clear()}async queryAttributes(e,t,i,s,a){if(0===this._tileLayerData.size||!this._styleRepository||!this._tileHandler)return[];null===this._index&&(this._index=new r.PooledRBush(100,p),await this._indexLayers());const n=[];return this._queryIndex(n,e,t,i,this.tileKey.level,s),a&&a?.length>0&&await this._getSymbolsAttributes(n,a),n}async _indexLayers(){const e=this.tileKey,t=this._styleRepository.layers,i=await this._getTilePayload(e);for(const[r,s]of this._tileLayerData){const a=t[r],n=i.find(e=>e.sourceName===a.source);if(!n)continue;const{protobuff:o,key:l}=n;if(3!==s.type){const t=1<<e.level-l.level,i=e.row-l.row*t,r=e.col-l.col*t;this._indexLayer(a,o,e.level,t,i,r)}}}_indexLayer(e,t,r,s,h,u){const p=e.sourceLayer,y=e.getFeatureFilter(),d=r,g=r+1,f=o.getTileMargins(d),_=new i(new Uint8Array(t),new DataView(t));for(;_.next();)switch(_.tag()){case 3:{const t=_.getMessage(),i=new l(t);if(t.release(),i.name!==p)continue;const o=i.getData(),m=i.extent/s,b=m*u-f,T=m*h-f,w=b+m+2*f,v=T+m+2*f,x=m/a.tilePixelSize,S=a.tileCoordSize/m,P=m*u,D=m*h;for(;o.nextTag(2);){const t=o.getMessage(),s=new n(t,i);if(t.release(),y&&!y.filter(s,r))continue;const a=s.values||{},l=a._minzoom,h=a._maxzoom;if(l&&l>=10*g||h&&h<=10*d)continue;const u=e.getFeatureInflatedBounds(s,d,i.extent,x);null==u||u[0]>w||u[1]>v||u[2]<b||u[3]<T||(u[0]=(u[0]-P)*S,u[1]=(u[1]-D)*S,u[2]=(u[2]-P)*S,u[3]=(u[3]-D)*S,this._index.insert(new c.IndexItem(e,s,u,S,P,D)))}break}default:_.skip()}_.release()}async _getSymbolsAttributes(e,t){if(!t||0===t.length)return e;const i=[];if(t.sort(h),t.length>0){let e=0,{styleLayerUID:r}=t[0];for(let s=1;s<t.length;s++){const{styleLayerUID:a}=t[s];a!==r&&(i.push({from:e,to:s,styleLayerUID:r,sourceTileKey:t[s-1].vtlSymbol.sourceTile}),e=s,r=a)}const s=t.length-1;i.push({from:e,to:t.length,styleLayerUID:r,sourceTileKey:t[s].vtlSymbol.sourceTile})}const r=this._styleRepository.layers;for(const s of i){const i=await this._getTilePayload(s.sourceTileKey),a=r[s.styleLayerUID],n=!!a&&i.find(e=>e.sourceName===a.source);n&&this._addSymbolsAttributes(e,t.slice(s.from,s.to).map(e=>e.vtlSymbol.featureIndex),s.styleLayerUID,n)}return e}_addSymbolsAttributes(t,i,r,a){const n=this._styleRepository.layers,o=a.key,l=this.tileKey,c=1<<l.level-o.level,h=l.row-o.row*c,u=l.col-o.col*c;this._getSymbolAttributes(a.protobuff,i,r,c,h,u).forEach(i=>{const{attributes:a,tilePoint:o}=i;t.push({layerId:n[r].id,layerIndex:r,graphic:new e({attributes:a,origin:new s(this._parentLayer,n[r].id,r)}),tilePoint:o})})}_getSymbolAttributes(e,t,r,s,o,c){const h=[],u=this._styleRepository.layers;let p=0;t.sort((e,t)=>e-t);const y=new i(new Uint8Array(e),new DataView(e));for(;y.next();)switch(y.tag()){case 3:{const e=y.getMessage(),i=new l(e);if(e.release(),i.name!==u[r].sourceLayer)continue;const d=i.getData(),g=i.extent/s,f=a.tileCoordSize/g,_=g*c,m=g*o;let b=0;for(;d.nextTag(2);){const e=d.getMessage();if(b++===t[p]){const t=new n(e,i),r=t.values,s=t.getGeometry(),a=null!=s?[f*(s[0][0].x-_),f*(s[0][0].y-m)]:null;h.push({attributes:r,tilePoint:a}),p++}if(e.release(),p===t.length)return h}break}default:y.skip()}return y.release(),h}_queryIndex(t,i,r,n,o,l){const c=a.tilePixelRatio*n*(window.devicePixelRatio||1);return this._index?.search({minX:i-c,minY:r-c,maxX:i+c,maxY:r+c},a=>{const{layer:c,feature:h}=a;c.isIntersectingFeature(i,r,n,h,o,l,a)&&t.push({layerId:c.id,layerIndex:c.uid,tilePoint:null,graphic:new e({attributes:h.values,origin:new s(this._parentLayer,a.layer.id,a.layer.uid)})})}),t}async _getTilePayload(e){return t.getOrCreateMapValue(this._tileKeyToPBF,e.id,()=>this._tileHandler.fetchTilePBFs(e)).then(e=>e)}}const p=e=>({minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]});return u})},"esri/core/libs/rbush/PooledRBush":function(){define(["exports","../../arrayUtils","../../compilerUtils","../../has","../../PooledArray","../../../chunks/quickselect"],function(e,t,i,r,s,a){"use strict";function n(e,t){let r=e;for(T.clear();r;){if(!0===r.leaf)for(const e of r.children)t(i.toConst(e));else T.pushArray(r.children);r=T.pop()??null}}function o(e,t){l(e,0,e.children.length,t,e)}function l(e,t,i,r,s){s||(s=new P([])),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let a,n=t;n<i;n++)a=e.children[n],c(s,e.leaf?r(a):a);return s}function c(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function h(e,t){return e.minX-t.minX}function u(e,t){return e.minY-t.minY}function p(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function y(e){return e.maxX-e.minX+(e.maxY-e.minY)}function d(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function g(e,t){const i=Math.max(e.minX,t.minX),r=Math.max(e.minY,t.minY),s=Math.min(e.maxX,t.maxX),a=Math.min(e.maxY,t.maxY);return Math.max(0,s-i)*Math.max(0,a-r)}function f(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function m(e,t,i,r,s){const n=[t,i];for(;n.length;){const t=n.pop(),i=n.pop();if(t-i<=r)continue;const o=i+Math.ceil((t-i)/r/2)*r;a.quickselect(e,o,i,t,s),n.push(i,o,o,t)}}const b=new s,T=new s,w=new s,v=new s({deallocator:void 0});class x{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class S extends x{constructor(){super(...arguments),this.height=1,this.indexHint=new t.PositionHint}}class P extends S{constructor(e){super(),this.children=e,this.leaf=!0}}class D extends S{constructor(e){super(),this.children=e,this.leaf=!1}}e.BBox=x,e.PooledRBush=class{constructor(e=9,t){this._compareMinX=h,this._compareMinY=u,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),b.prune(),T.prune(),w.prune(),v.prune()}all(e){n(this._data,e)}search(e,t){let i=this._data;const r=this._toBBox;if(_(e,i))for(b.clear();i;){for(let s=0,a=i.children.length;s<a;s++){const a=i.children[s],o=i.leaf?r(a):a;_(e,o)&&(i.leaf?t(a):f(e,o)?n(a,t):b.push(a))}i=b.pop()}}collides(e){let t=this._data;const i=this._toBBox;if(!_(e,t))return!1;for(b.clear();t;){for(let r=0,s=t.children.length;r<s;r++){const s=t.children[r],a=t.leaf?i(s):s;if(_(e,a)){if(t.leaf||f(e,a))return!0;b.push(s)}}t=b.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new P([]),this}remove(e){if(!e)return this;let r,s=this._data,a=null,n=0,o=!1;const l=this._toBBox(e);for(w.clear(),v.clear();s||w.length>0;){if(s||(s=w.pop(),a=w.data[w.length-1],n=v.pop()??0,o=!0),s.leaf&&(r=t.indexOf(s.children,i.toConst(e),s.children.length,s.indexHint),-1!==r))return s.children.splice(r,1),w.push(s),this._condense(w),this;o||s.leaf||!f(s,l)?a?(n++,s=a.children[n],o=!1):s=null:(w.push(s),v.push(n),n=0,a=s,s=s.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,i,r){const s=i-t+1;let a=this._maxEntries;if(s<=a){const r=new P(e.slice(t,i+1));return o(r,this._toBBox),r}r||(r=Math.ceil(Math.log(s)/Math.log(a)),a=Math.ceil(s/a**(r-1)));const n=new D([]);n.height=r;const l=Math.ceil(s/a),c=l*Math.ceil(Math.sqrt(a));m(e,t,i,c,this._compareMinX);for(let s=t;s<=i;s+=c){const t=Math.min(s+c-1,i);m(e,s,t,l,this._compareMinY);for(let i=s;i<=t;i+=l){const s=Math.min(i+l-1,t);n.children.push(this._build(e,i,s,r-1))}}return o(n,this._toBBox),n}_insert(e,t,i){const r=this._toBBox,s=i?e:r(e);w.clear();const a=function(e,t,i,r){for(;r.push(t),!0!==t.leaf&&r.length-1!==i;){let i,r=1/0,s=1/0;for(let a=0,n=t.children.length;a<n;a++){const n=t.children[a],o=p(n),l=d(e,n)-o;l<s?(s=l,r=o<r?o:r,i=n):l===s&&o<r&&(r=o,i=n)}t=i||t.children[0]}return t}(s,this._data,t,w);for(a.children.push(e),c(a,s);t>=0&&w.data[t].children.length>this._maxEntries;)this._split(w,t),t--;!function(e,t,i){for(let r=i;r>=0;r--)c(t.data[r],e)}(s,w,t)}_split(e,t){const i=e.data[t],r=i.children.length,s=this._minEntries;this._chooseSplitAxis(i,s,r);const a=this._chooseSplitIndex(i,s,r);if(!a)return;const n=i.children.splice(a,i.children.length-a),l=i.leaf?new P(n):new D(n);l.height=i.height,o(i,this._toBBox),o(l,this._toBBox),t?e.data[t-1].children.push(l):this._splitRoot(i,l)}_splitRoot(e,t){this._data=new D([e,t]),this._data.height=e.height+1,o(this._data,this._toBBox)}_chooseSplitIndex(e,t,i){let r,s,a;r=s=1/0;for(let n=t;n<=i-t;n++){const t=l(e,0,n,this._toBBox),o=l(e,n,i,this._toBBox),c=g(t,o),h=p(t)+p(o);c<r?(r=c,a=n,s=h<s?h:s):c===r&&h<s&&(s=h,a=n)}return a}_chooseSplitAxis(e,t,i){const r=e.leaf?this._compareMinX:h,s=e.leaf?this._compareMinY:u;this._allDistMargin(e,t,i,r)<this._allDistMargin(e,t,i,s)&&e.children.sort(r)}_allDistMargin(e,t,i,r){e.children.sort(r);const s=this._toBBox,a=l(e,0,t,s),n=l(e,i-t,i,s);let o=y(a)+y(n);for(let r=t;r<i-t;r++){const t=e.children[r];c(a,e.leaf?s(t):t),o+=y(a)}for(let r=i-t-1;r>=t;r--){const t=e.children[r];c(n,e.leaf?s(t):t),o+=y(n)}return o}_condense(e){for(let i=e.length-1;i>=0;i--){const r=e.data[i];if(0===r.children.length)if(i>0){const s=e.data[i-1],a=s.children;a.splice(t.indexOf(a,r,a.length,s.indexHint),1)}else this.clear();else o(r,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}},e.cleanupPooledRBush=function(){b.prune(),T.prune(),w.prune(),v.prune()},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/graphic/VectorTileGraphicOrigin":function(){define(["./GraphicOrigin","./isVectorTileGraphicOrigin"],function(e,t){"use strict";var i;class r extends e{static{i=t.isVectorTileGraphicOriginSymbol}constructor(e,t,r){super(),this[i]=!0,this.type="vector-tile",this.layer=e,this.layerId=t,this.layerIndex=r}}return r})},"esri/views/2d/engine/vectorTiles/Feature":function(){define(["../../../../geometry/support/TileClipper"],function(e){"use strict";return class{constructor(e,t,i=0){this.values={},this._geometry=void 0,this._pbfGeometry=null,this.featureIndex=i;const r=t.keys,s=t.values,a=e.asUnsafe();for(;a.next();)switch(a.tag()){case 1:this.id=a.getUInt64();break;case 2:{const e=a.getMessage().asUnsafe(),t=this.values;for(;!e.empty();){const i=e.getUInt32(),a=e.getUInt32();t[r[i]]=s[a]}e.release();break}case 3:this.type=a.getUInt32();break;case 4:this._pbfGeometry=a.getMessage();break;default:a.skip()}}getGeometry(t){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;const i=this._pbfGeometry.asUnsafe();let r,s;this._pbfGeometry=null,t?t.reset(this.type):r=[];let a,n=1,o=0,l=0,c=0;for(;!i.empty();){if(0===o){const e=i.getUInt32();n=7&e,o=e>>3}switch(o--,n){case 1:l+=i.getSInt32(),c+=i.getSInt32(),t?t.moveTo(l,c):r&&(s&&r.push(s),s=[],s.push(new e.Point(l,c)));break;case 2:l+=i.getSInt32(),c+=i.getSInt32(),t?t.lineTo(l,c):s&&s.push(new e.Point(l,c));break;case 7:t?t.close():s&&!s[0].equals(l,c)&&s.push(s[0].clone());break;default:throw i.release(),new Error("Invalid path operation")}}return t?a=t.result():r&&(s&&r.push(s),a=r),i.release(),this._geometry=a,a}}})},"esri/views/2d/engine/vectorTiles/SourceLayerData":function(){define(["./constants"],function(e){"use strict";class t{constructor(i){this.extent=e.tileCoordSize,this.keys=[],this.values=[],this._pbfLayer=i.clone();const r=i.asUnsafe();for(;r.next();)switch(r.tag()){case 1:this.name=r.getString();break;case 3:this.keys.push(r.getString());break;case 4:this.values.push(r.processMessage(t._parseValue));break;case 5:this.extent=r.getUInt32();break;default:r.skip()}}getData(){return this._pbfLayer}static _parseValue(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getInt64();case 5:return e.getUInt64();case 6:return e.getSInt64();case 7:return e.getBool();default:e.skip()}return null}}return t})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define(["exports","../../../../../geometry/support/aaBoundingRect","../constants","../GeometryUtils","../shaders/VTLBackgroundMaterial","../shaders/VTLCircleMaterial","../shaders/VTLFillMaterial","../shaders/VTLLineMaterial","../shaders/VTLSymbolMaterial","./Filter","./StyleDefinition","./StyleProperty","../../webgl/definitions"],function(e,t,i,r,s,a,n,o,l,c,h,u,p){"use strict";class y{constructor(e,t,i,r){switch(this.type=e,this.typeName=t.type,this.id=t.id,this.source=t.source,this.sourceLayer=t["source-layer"],this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,this.filter=t.filter,this.layout=t.layout,this.paint=t.paint,this.z=i,this.uid=r,e){case 0:this._layoutDefinition=h.StyleDefinition.backgroundLayoutDefinition,this._paintDefinition=h.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=h.StyleDefinition.fillLayoutDefinition,this._paintDefinition=h.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=h.StyleDefinition.lineLayoutDefinition,this._paintDefinition=h.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=h.StyleDefinition.symbolLayoutDefinition,this._paintDefinition=h.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=h.StyleDefinition.circleLayoutDefinition,this._paintDefinition=h.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout),this._paintProperties=this._parsePaint(this.paint)}getFeatureFilter(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=c.createFilter(this.filter)}getLayoutProperty(e){return this._layoutProperties[e]}getPaintProperty(e){return this._paintProperties[e]}getLayoutValue(e,t,i){let r;const s=this._layoutProperties[e];return s&&(r=s.getValue(t,i)),void 0===r&&(r=this._layoutDefinition[e].default),r}getPaintValue(e,t,i){let r;const s=this._paintProperties[e];return s&&(r=s.getValue(t,i)),void 0===r&&(r=this._paintDefinition[e].default),r}isPainterDataDriven(){const e=this._paintProperties;if(e)for(const t in e)if(e[t].isDataDriven)return!0;return!1}isIntersectingFeature(e,t,i,r,s,a,n){return!1}getFeatureInflatedBounds(e,t,i,r){return null}_parseLayout(e){const t={};for(const i in e){const r=this._layoutDefinition[i];r&&(t[i]=new u(r,e[i]))}return t}_parsePaint(e){const t={};for(const i in e){const r=this._paintDefinition[i];r&&(t[i]=new u(r,e[i]))}return t}computeAttributesKey(e,t,i,r){let s=0,a=0;for(const e of t){let t=3;if(!e||e!==r){const r=i[e],{isLayout:s,isOptional:a}=r,n=s?this.getLayoutProperty(e):this.getPaintProperty(e);t=n?.interpolator?2:n?.isDataDriven?1:a&&!n?3:0}a|=t<<s,s+=2}return a<<3|e}}function d(e){const i=e?.getGeometry();if(null==i)return null;let r=1/0,s=1/0,a=-1/0,n=-1/0;for(const e of i)if(e)for(const t of e)r=Math.min(r,t.x),s=Math.min(s,t.y),a=Math.max(a,t.x),n=Math.max(n,t.y);return t.fromValues(r,s,a,n)}e.BackgroundStyleLayer=class extends y{constructor(e,t,i,r){super(e,t,i,r),this.backgroundMaterial=new s.VTLBackgroundMaterial(this.computeAttributesKey(0,s.VTLBackgroundMaterial.ATTRIBUTES,s.VTLBackgroundMaterial.ATTRIBUTES_INFO))}},e.CircleStyleLayer=class extends y{constructor(e,t,i,r){super(e,t,i,r),this.circleMaterial=new a.VTLCircleMaterial(this.computeAttributesKey(5,a.VTLCircleMaterial.ATTRIBUTES,a.VTLCircleMaterial.ATTRIBUTES_INFO))}getFeatureInflatedBounds(e,t,r,s){const a=d(e);if(!a)return null;const n=this.getPaintValue("circle-translate",t,e),o=Math.max(n[0],n[1]);a[0]-=o,a[2]-=o,a[1]+=o,a[3]+=o;const l=s*(i.tilePixelRatio*(this.getPaintValue("circle-radius",t,e)+this.getPaintValue("circle-stroke-width",t,e))/2);return a[0]-=l,a[1]-=l,a[2]+=l,a[3]+=l,a}isIntersectingFeature(e,t,s,a,n,o,l){const c=a.getGeometry();if(!c)return!1;const h=i.tilePixelRatio/l.normalizationRatio;e=e/l.normalizationRatio+l.normalizationOffsetX,t=t/l.normalizationRatio+l.normalizationOffsetY,s*=h;const u=r.translateAnchor(this.getPaintValue("circle-translate",n,a),this.getPaintValue("circle-translate-anchor",n,a),o,h),p=h*(this.getPaintValue("circle-radius",n,a)+this.getPaintValue("circle-stroke-width",n,a));let y,d;for(const i of c)if(i)for(const r of i)if(y=r.x+u.x,d=r.y+u.y,Math.sqrt((e-y)*(e-y)+(t-d)*(t-d))-s<=p)return!0;return!1}},e.FillStyleLayer=class extends y{constructor(e,t,i,r){super(e,t,i,r);const s=this.getPaintProperty("fill-color"),a=this.getPaintProperty("fill-opacity"),o=this.getPaintProperty("fill-pattern");this.hasDataDrivenColor=s?.isDataDriven,this.hasDataDrivenOpacity=a?.isDataDriven,this.hasDataDrivenFill=this.hasDataDrivenColor||this.hasDataDrivenOpacity||o?.isDataDriven;const l=this.getPaintProperty("fill-outline-color");this.outlineUsesFillColor=!l,this.hasDataDrivenOutlineColor=l?.isDataDriven,this.hasDataDrivenOutline=l?l.isDataDriven:!!s&&s.isDataDriven,this.hasDataDrivenOutline=(l?this.hasDataDrivenOutlineColor:this.hasDataDrivenColor)||this.hasDataDrivenOpacity,this.fillMaterial=new n.VTLFillMaterial(this.computeAttributesKey(1,n.VTLFillMaterial.ATTRIBUTES,n.VTLFillMaterial.ATTRIBUTES_INFO)),this.outlineMaterial=new n.VTLOutlineMaterial(this.computeAttributesKey(2,this.outlineUsesFillColor?n.VTLOutlineMaterial.ATTRIBUTES_FILL:n.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,this.outlineUsesFillColor?n.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:n.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),this.outlineUsesFillColor)}getFeatureInflatedBounds(e,t,i,r){const s=d(e);if(!s)return null;const a=this.getPaintValue("fill-translate",t,e),n=r*Math.max(a[0],a[1]);return s[0]-=n,s[2]-=n,s[1]+=n,s[3]+=n,s}isIntersectingFeature(e,t,s,a,n,o,l){const c=a.getGeometry();if(!c)return!1;const h=i.tilePixelRatio/l.normalizationRatio;e=e/l.normalizationRatio+l.normalizationOffsetX,t=t/l.normalizationRatio+l.normalizationOffsetY;const u=r.translateAnchor(this.getPaintValue("fill-translate",n,a),this.getPaintValue("fill-translate-anchor",n,a),o,i.tilePixelRatio);return e-=h*u.x,t-=h*u.y,!!r.pointInPolygon(e,t,c)||r.distanceFromToPolylineWithinThreshold(e,t,c,h*s)}},e.IconLayout=class{constructor(e,t,i){let r;this.allowOverlap=e.getLayoutValue("icon-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("icon-ignore-placement",t),this.keepUpright=e.getLayoutValue("icon-keep-upright",t),this.optional=e.getLayoutValue("icon-optional",t),this.rotationAlignment=e.getLayoutValue("icon-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=i?0:1),r=e.getLayoutProperty("icon-anchor"),r?.isDataDriven?this._anchorProp=r:this.anchor=e.getLayoutValue("icon-anchor",t),r=e.getLayoutProperty("icon-offset"),r?.isDataDriven?this._offsetProp=r:this.offset=e.getLayoutValue("icon-offset",t),r=e.getLayoutProperty("icon-padding"),r?.isDataDriven?this._paddingProp=r:this.padding=e.getLayoutValue("icon-padding",t),r=e.getLayoutProperty("icon-rotate"),r?.isDataDriven?this._rotateProp=r:this.rotate=e.getLayoutValue("icon-rotate",t),r=e.getLayoutProperty("icon-size"),r?.isDataDriven?this._sizeProp=r:this.size=e.getLayoutValue("icon-size",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t))}},e.IndexItem=class{constructor(e,t,i,r,s,a){this.layer=e,this.feature=t,this.bounds=i,this.normalizationRatio=r,this.normalizationOffsetX=s,this.normalizationOffsetY=a}},e.LineStyleLayer=class extends y{constructor(e,t,i,r){super(e,t,i,r);const s=this.getPaintProperty("line-pattern");if(this.lineMaterial=new o.VTLLineMaterial(this.computeAttributesKey(3,o.VTLLineMaterial.ATTRIBUTES,o.VTLLineMaterial.ATTRIBUTES_INFO,s?"line-dasharray":"")),this.hasDataDrivenLine=this.getPaintProperty("line-blur")?.isDataDriven||this.getPaintProperty("line-color")?.isDataDriven||this.getPaintProperty("line-gap-width")?.isDataDriven||this.getPaintProperty("line-offset")?.isDataDriven||this.getPaintProperty("line-opacity")?.isDataDriven||this.getPaintProperty("line-pattern")?.isDataDriven||this.getPaintProperty("line-dasharray")?.isDataDriven||this.getLayoutProperty("line-cap")?.isDataDriven||this.getPaintProperty("line-width")?.isDataDriven,this.canUseThinTessellation=!1,!this.hasDataDrivenLine){const e=this.getPaintProperty("line-width");if(!e||"number"==typeof e&&.5*e<p.thinLineHalfWidthThreshold){const e=this.getPaintProperty("line-offset");(!e||"number"==typeof e&&0===e)&&(this.canUseThinTessellation=!0)}}}getDashKey(e,t){let i;switch(t){case 0:default:i="Butt";break;case 1:i="Round";break;case 2:i="Square"}return`dasharray-[${e.toString()}]-${i}`}getFeatureInflatedBounds(e,t,i,r){const s=d(e);if(!s)return null;const a=this.getPaintValue("line-translate",t,e),n=r*Math.max(a[0],a[1]);s[0]-=n,s[2]-=n,s[1]+=n,s[3]+=n;const o=r*Math.abs(this.getPaintValue("line-offset",t,e)||0),l=r*(this.getPaintValue("line-width",t,e)/2);return s[0]-=o+l,s[1]-=o+l,s[2]+=o+l,s[3]+=o+l,s}isIntersectingFeature(e,t,s,a,n,o,l){let c=a.getGeometry();if(!c)return!1;const h=i.tilePixelRatio/l.normalizationRatio;e=e/l.normalizationRatio+l.normalizationOffsetX,t=t/l.normalizationRatio+l.normalizationOffsetY;const u=r.translateAnchor(this.getPaintValue("line-translate",n,a),this.getPaintValue("line-translate-anchor",n,a),o,i.tilePixelRatio);e-=h*u.x,t-=h*u.y;const p=h*this.getPaintValue("line-offset",n,a)||0;0!==p&&(c=r.offsetLine(c,-p));const y=this.getPaintValue("line-width",n,a)/2;return r.distanceFromToPolylineWithinThreshold(e,t,c,h*(s+y))}},e.StyleLayer=y,e.SymbolStyleLayer=class extends y{constructor(e,t,i,r){super(e,t,i,r),this.iconMaterial=new l.VTLIconMaterial(this.computeAttributesKey(4,l.VTLIconMaterial.ATTRIBUTES,l.VTLIconMaterial.ATTRIBUTES_INFO)),this.textMaterial=new l.VTLTextMaterial(this.computeAttributesKey(6,l.VTLTextMaterial.ATTRIBUTES,l.VTLTextMaterial.ATTRIBUTES_INFO)),this.hasDataDrivenIcon=this.getPaintProperty("icon-color")?.isDataDriven||this.getPaintProperty("icon-halo-blur")?.isDataDriven||this.getPaintProperty("icon-halo-color")?.isDataDriven||this.getPaintProperty("icon-halo-width")?.isDataDriven||this.getPaintProperty("icon-opacity")?.isDataDriven||this.getLayoutProperty("icon-size")?.isDataDriven,this.hasDataDrivenText=this.getPaintProperty("text-color")?.isDataDriven||this.getPaintProperty("text-halo-blur")?.isDataDriven||this.getPaintProperty("text-halo-color")?.isDataDriven||this.getPaintProperty("text-halo-width")?.isDataDriven||this.getPaintProperty("text-opacity")?.isDataDriven||this.getLayoutProperty("text-size")?.isDataDriven}},e.TextLayout=class{constructor(e,t,i){let r;this.allowOverlap=e.getLayoutValue("text-allow-overlap",t),this.ignorePlacement=e.getLayoutValue("text-ignore-placement",t),this.keepUpright=e.getLayoutValue("text-keep-upright",t),this.optional=e.getLayoutValue("text-optional",t),this.rotationAlignment=e.getLayoutValue("text-rotation-alignment",t),2===this.rotationAlignment&&(this.rotationAlignment=i?0:1),r=e.getLayoutProperty("text-anchor"),r?.isDataDriven?this._anchorProp=r:this.anchor=e.getLayoutValue("text-anchor",t),r=e.getLayoutProperty("text-justify"),r?.isDataDriven?this._justifyProp=r:this.justify=e.getLayoutValue("text-justify",t),r=e.getLayoutProperty("text-letter-spacing"),r?.isDataDriven?this._letterSpacingProp=r:this.letterSpacing=e.getLayoutValue("text-letter-spacing",t),r=e.getLayoutProperty("text-line-height"),r?.isDataDriven?this._lineHeightProp=r:this.lineHeight=e.getLayoutValue("text-line-height",t),r=e.getLayoutProperty("text-max-angle"),r?.isDataDriven?this._maxAngleProp=r:this.maxAngle=e.getLayoutValue("text-max-angle",t),r=e.getLayoutProperty("text-max-width"),r?.isDataDriven?this._maxWidthProp=r:this.maxWidth=e.getLayoutValue("text-max-width",t),r=e.getLayoutProperty("text-offset"),r?.isDataDriven?this._offsetProp=r:this.offset=e.getLayoutValue("text-offset",t),r=e.getLayoutProperty("text-padding"),r?.isDataDriven?this._paddingProp=r:this.padding=e.getLayoutValue("text-padding",t),r=e.getLayoutProperty("text-rotate"),r?.isDataDriven?this._rotateProp=r:this.rotate=e.getLayoutValue("text-rotate",t),r=e.getLayoutProperty("text-size"),r?.isDataDriven?this._sizeProp=r:this.size=e.getLayoutValue("text-size",t),r=e.getLayoutProperty("text-writing-mode"),r?.isDataDriven?this._writingModeProp=r:this.writingMode=e.getLayoutValue("text-writing-mode",t)}update(e,t){this._anchorProp&&(this.anchor=this._anchorProp.getValue(e,t)),this._justifyProp&&(this.justify=this._justifyProp.getValue(e,t)),this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(e,t)),this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(e,t)),this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(e,t)),this._maxWidthProp&&(this.maxWidth=this._maxWidthProp.getValue(e,t)),this._offsetProp&&(this.offset=this._offsetProp.getValue(e,t)),this._paddingProp&&(this.padding=this._paddingProp.getValue(e,t)),this._rotateProp&&(this.rotate=this._rotateProp.getValue(e,t)),this._sizeProp&&(this.size=this._sizeProp.getValue(e,t)),this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(e,t))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";class s extends t.VTLMaterial{static{this.ATTRIBUTES=[]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.BYTE,0,2)]}static{this.ATTRIBUTES_INFO={}}constructor(e){super(e),this.baseGeometryLayout=s.GEOMETRY_LAYOUT,this.attributes=s.ATTRIBUTES,this.attributesInfo=s.ATTRIBUTES_INFO}}e.VTLBackgroundMaterial=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define(["exports","../MemoryBuffer","../../../../webgl/enums","../../../../webgl/VertexAttributeLocations","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r,s){"use strict";class a{constructor(e){this._key=e}get key(){return this._key}get type(){return 7&this._key}defines(){return[]}getStride(){return this._geometryLayout||this._buildAttributesInfo(),this._stride}getAttributeLocations(){return this._geometryLayout||this._buildAttributesInfo(),this._locations}get geometryLayout(){return this._geometryLayout||this._buildAttributesInfo(),this._geometryLayout}getEncodingInfos(){return this._propertyEncodingInfo||this._buildAttributesInfo(),this._propertyEncodingInfo}getUniforms(){return this._uniforms||this._buildAttributesInfo(),this._uniforms}getShaderHeader(){return this._shaderHeader||this._buildAttributesInfo(),this._shaderHeader}getShaderMain(){return this._shaderMain||this._buildAttributesInfo(),this._shaderMain}setDataUniforms(e,t,i,r,s){const a=this.getUniforms();for(const n of a){const{name:a,type:o,getValue:l}=n,c=l(i,t,r,s);if(null!==c)switch(o){case"float":e.setUniform1f(a,c);break;case"vec2":e.setUniform2fv(a,c);break;case"vec4":e.setUniform4fv(a,c)}}}encodeAttributes(e,t,i,r){const s=this.attributesInfo,a=this.getEncodingInfos(),n=[];let o=0,l=0;for(const c of Object.keys(a)){const h=a[c],{type:u,precisionFactor:p,isLayout:y}=s[c],d=y?i.getLayoutProperty(c):i.getPaintProperty(c),g=d.interpolator?.getInterpolationRange(t);let f=0;for(const i of h){const{offset:s,bufferElementsToAdd:a}=i;if(a>0){for(let e=0;e<a;e++)n.push(0);o+=l,l=i.bufferElementsToAdd}const c=r??d.getValue(g?g[f]:t,e);switch(u){case 0:case 1:n[o]|=this._encodeByte(c*(p||1),8*s);break;case 2:case 3:n[o]|=this._encodeShort(c*(p||1),8*s);break;case 4:case 5:n[o]|=this._encodeByte(c*(p||1),8*s),n[o]|=this._encodeByte(c*(p||1),8*s+8);break;case 6:case 7:n[o]|=this._encodeShort(c*(p||1),8*s),n[o]|=this._encodeShort(c*(p||1),8*s+16);break;case 8:case 9:n[o]|=this._encodeByte(c*(p||1),8*s),n[o]|=this._encodeByte(c*(p||1),8*s+8),n[o]|=this._encodeByte(c*(p||1),8*s+16),n[o]|=this._encodeByte(c*(p||1),8*s+24);break;case 10:n[o]=this._encodeColor(c);break;case 11:case 12:this._encodePattern(o,n,c);break;default:throw new Error("Unsupported encoding type")}f++}}return n}getAtributeState(e){let t=0;const i=3+2*e;return t|=this._bit(i),t|=this._bit(i+1)<<1,t}static{this._encodingInfo={0:{dataType:i.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},1:{dataType:i.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},2:{dataType:i.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},3:{dataType:i.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},4:{dataType:i.DataType.BYTE,bytesPerElement:1,count:2,normalized:!1},5:{dataType:i.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},6:{dataType:i.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},7:{dataType:i.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},8:{dataType:i.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},9:{dataType:i.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},10:{dataType:i.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},11:{dataType:i.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},12:{dataType:i.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}}}_buildAttributesInfo(){const e=[],t={},{attributesInfo:r,attributes:s}=this,n={};let o=-1,l=-1;for(const i of s){l++;const s=this.getAtributeState(l);if(0===s||3===s)continue;const c=r[i],h=[];t[i]=h;const u=c.type;for(let t=0;t<s;t++){const{dataType:t,bytesPerElement:i,count:r,normalized:s}=a._encodingInfo[u],l=i*r,c=`${t}-${!0===s}`;let p=n[c],y=0;if(!p||p.count+r>4)o++,p={dataIndex:o,count:0,offset:0},4!==r&&(n[c]=p),e.push({location:-1,name:"a_data_"+o,count:r,type:t,normalized:s}),y=Math.ceil(Math.max(l/4,1));else{const t=e[p.dataIndex];t.count+=r,y=Math.ceil(Math.max(t.count*i/4,1))-Math.ceil(Math.max(p.offset/4,1))}h.push({dataIndex:p.dataIndex,offset:p.offset,bufferElementsToAdd:y}),p.offset+=l,p.count+=r}}for(const t of e)switch(t.type){case i.DataType.BYTE:case i.DataType.UNSIGNED_BYTE:t.count=4;break;case i.DataType.SHORT:case i.DataType.UNSIGNED_SHORT:t.count+=t.count%2}this._buildVertexBufferLayout(e),this._buildShaderInfo(e,t),this._propertyEncodingInfo=t}_buildVertexBufferLayout(e){const t=this.baseGeometryLayout;let i=t[0].stride;if(0===e.length)this._geometryLayout=t;else{const r=[];let a=i;for(const t of e)i+=n(t.type)*t.count;for(const e of t)r.push(new s.VertexElementDescriptor(e.name,e.count,e.type,e.offset,i,e.normalized));for(const t of e)r.push(new s.VertexElementDescriptor(t.name,t.count,t.type,a,i,t.normalized)),a+=n(t.type)*t.count;this._geometryLayout=r}this.opacityLayout?this._locations=r.fromLayouts([this._geometryLayout,this.opacityLayout]):this._locations=r.fromLayout(this._geometryLayout),this._stride=i}_buildShaderInfo(e,t){let i="\n",r="\n";const s=[];for(const t of e)i+=`attribute ${this._getType(t.count)} ${t.name};\n`;const{attributesInfo:n,attributes:l}=this;let c=-1;for(const e of l){c++;const{name:l,type:h,precisionFactor:u,isLayout:p}=n[e],y=u&&1!==u?" * "+1/u:"",{bytesPerElement:d,count:g}=a._encodingInfo[h],f=e=>`a_data_${e.dataIndex}${o(g,e.offset,d)}`;switch(this.getAtributeState(c)){case 0:{const t=this._getType(g),a=`u_${l}`;s.push({name:a,type:t,getValue:(t,i,r,s)=>{const a=p?t.getLayoutValue(e,i):t.getPaintValue(e,i);if(11===h){const e=t.getDashKey(a,t.getLayoutValue("line-cap",i)),r=s.getMosaicItemPosition(e,!1);if(null==r)return null;const{tl:n,br:o}=r;return[n[0],o[1],o[0],n[1]]}if(12===h){const t=s.getMosaicItemPosition(a,!e.includes("line-"));if(null==t)return null;const{tl:i,br:r}=t;return[i[0],r[1],r[0],i[1]]}if(10===h){const e=a[3];return[e*a[0],e*a[1],e*a[2],e]}return a}}),i+=`uniform ${t} ${a};\n`,r+=`${t} ${l} = ${a};\n`}break;case 1:{const i=f(t[e][0]);r+=`${this._getType(g)} ${l} = ${i}${y};\n`}break;case 2:{const a=`u_t_${l}`;s.push({name:a,type:"float",getValue:(t,i,r,s)=>(p?t.getLayoutProperty(e):t.getPaintProperty(e)).interpolator.interpolationUniformValue(r,i)}),i+=`uniform float ${a};\n`;const n=f(t[e][0]),o=f(t[e][1]);r+=`${this._getType(g)} ${l} = mix(${n}${y}, ${o}${y}, ${a});\n`}}}this._shaderHeader=i,this._shaderMain=r,this._uniforms=s}_bit(e){return(this._key&1<<e)>>e}_getType(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw new Error("Invalid count")}_encodeColor(e){const i=255*e[3];return t.i8888to32(e[0]*i,e[1]*i,e[2]*i,i)}_encodePattern(e,t,i){if(!i?.rect)return;const r=i.rect,s=i.width,a=i.height;t[e]=this._encodeShort(r.x+2,0),t[e]|=this._encodeShort(r.y+2+a,16),t[e+1]=this._encodeShort(r.x+2+s,0),t[e+1]|=this._encodeShort(r.y+2,16)}_encodeByte(e,t){return(255&e)<<t}_encodeShort(e,t){return(65535&e)<<t}}const n=e=>{switch(e){case i.DataType.FLOAT:case i.DataType.INT:case i.DataType.UNSIGNED_INT:return 4;case i.DataType.SHORT:case i.DataType.UNSIGNED_SHORT:case i.DataType.HALF_FLOAT:return 2;case i.DataType.BYTE:case i.DataType.UNSIGNED_BYTE:return 1}},o=(e,t,i)=>{const r=t/i;if(1===e)switch(r){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===e)switch(r){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===e)switch(r){case 0:return".xyz";case 1:return".yzw"}return""};e.VTLMaterial=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../core/has"],function(e){"use strict";return class{constructor(e){this._array=[],this._stride=e}get array(){return this._array}get index(){return 4*this._array.length/this._stride}get itemSize(){return this._stride}get sizeInBytes(){return 4*this._array.length}reset(){this.array.length=0}toBuffer(){return new Uint32Array(this._array).buffer}static i1616to32(e,t){return 65535&e|t<<16}static i8888to32(e,t,i,r){return 255&e|(255&t)<<8|(255&i)<<16|r<<24}static i8816to32(e,t,i){return 255&e|(255&t)<<8|i<<16}}})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";class s extends t.VTLMaterial{static{this.ATTRIBUTES=["circle-radius","circle-color","circle-opacity","circle-stroke-width","circle-stroke-color","circle-stroke-opacity","circle-blur"]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,4)]}static{this.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:1},"circle-color":{name:"color",type:10},"circle-opacity":{name:"opacity",type:1,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:1,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:10},"circle-stroke-opacity":{name:"stroke_opacity",type:1,precisionFactor:100},"circle-blur":{name:"blur",type:1,precisionFactor:32}}}constructor(e){super(e),this.baseGeometryLayout=s.GEOMETRY_LAYOUT,this.attributes=s.ATTRIBUTES,this.attributesInfo=s.ATTRIBUTES_INFO}}e.VTLCircleMaterial=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";class s extends t.VTLMaterial{static{this.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,4)]}static{this.ATTRIBUTES_INFO={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100},"fill-pattern":{name:"tlbr",type:12,isOptional:!0}}}constructor(e){super(e),this.baseGeometryLayout=s.GEOMETRY_LAYOUT,this.attributes=s.ATTRIBUTES,this.attributesInfo=s.ATTRIBUTES_INFO}}class a extends t.VTLMaterial{static{this.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"]}static{this.ATTRIBUTES_FILL=["fill-color","fill-opacity"]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,8),new r.VertexElementDescriptor("a_offset",2,i.DataType.BYTE,4,8),new r.VertexElementDescriptor("a_xnormal",2,i.DataType.BYTE,6,8)]}static{this.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}}}static{this.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:10},"fill-opacity":{name:"opacity",type:1,precisionFactor:100}}}constructor(e,t){super(e),this.baseGeometryLayout=a.GEOMETRY_LAYOUT,this.attributes=t?a.ATTRIBUTES_FILL:a.ATTRIBUTES_OUTLINE,this.attributesInfo=t?a.ATTRIBUTES_INFO_FILL:a.ATTRIBUTES_INFO_OUTLINE}}e.VTLFillMaterial=s,e.VTLOutlineMaterial=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";class s extends t.VTLMaterial{static{this.ATTRIBUTES=["line-blur","line-color","line-gap-width","line-offset","line-opacity","line-width","line-pattern","line-dasharray"]}static{this.GEOMETRY_LAYOUT=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,16),new r.VertexElementDescriptor("a_extrude_offset",4,i.DataType.BYTE,4,16),new r.VertexElementDescriptor("a_dir_normal",4,i.DataType.BYTE,8,16),new r.VertexElementDescriptor("a_accumulatedDistance",2,i.DataType.UNSIGNED_SHORT,12,16)]}static{this.ATTRIBUTES_INFO={"line-width":{name:"width",type:1,precisionFactor:2},"line-gap-width":{name:"gap_width",type:1,precisionFactor:2},"line-offset":{name:"offset",type:0,precisionFactor:2},"line-color":{name:"color",type:10},"line-opacity":{name:"opacity",type:1,precisionFactor:100},"line-blur":{name:"blur",type:1,precisionFactor:4},"line-pattern":{name:"tlbr",type:12,isOptional:!0},"line-dasharray":{name:"tlbr",type:11,isOptional:!0}}}constructor(e){super(e),this.baseGeometryLayout=s.GEOMETRY_LAYOUT,this.attributes=s.ATTRIBUTES,this.attributesInfo=s.ATTRIBUTES_INFO}}e.VTLLineMaterial=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define(["exports","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(e,t,i,r){"use strict";const s=[new r.VertexElementDescriptor("a_pos",2,i.DataType.SHORT,0,16),new r.VertexElementDescriptor("a_vertexOffset",2,i.DataType.SHORT,4,16),new r.VertexElementDescriptor("a_texAngleRange",4,i.DataType.UNSIGNED_BYTE,8,16),new r.VertexElementDescriptor("a_levelInfo",4,i.DataType.UNSIGNED_BYTE,12,16)],a=[new r.VertexElementDescriptor("a_opacityInfo",1,i.DataType.UNSIGNED_BYTE,0,1)];class n extends t.VTLMaterial{static{this.ATTRIBUTES=["icon-color","icon-opacity","icon-halo-blur","icon-halo-color","icon-halo-width","icon-size"]}static{this.ATTRIBUTES_INFO={"icon-color":{name:"color",type:10},"icon-opacity":{name:"opacity",type:1,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:10},"icon-halo-width":{name:"halo_width",type:1,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"icon-size":{name:"size",type:1,precisionFactor:32,isLayout:!0}}}constructor(e){super(e),this.baseGeometryLayout=s,this.opacityLayout=a,this.attributes=n.ATTRIBUTES,this.attributesInfo=n.ATTRIBUTES_INFO}}class o extends t.VTLMaterial{static{this.ATTRIBUTES=["text-color","text-opacity","text-halo-blur","text-halo-color","text-halo-width","text-size"]}static{this.ATTRIBUTES_INFO={"text-color":{name:"color",type:10},"text-opacity":{name:"opacity",type:1,precisionFactor:100},"text-halo-color":{name:"halo_color",type:10},"text-halo-width":{name:"halo_width",type:1,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:1,precisionFactor:4},"text-size":{name:"size",type:1,isLayout:!0}}}constructor(e){super(e),this.baseGeometryLayout=s,this.opacityLayout=a,this.attributes=o.ATTRIBUTES,this.attributesInfo=o.ATTRIBUTES_INFO}}e.VTLIconMaterial=n,e.VTLTextMaterial=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(e,t){"use strict";class i{constructor(e){this._expression=e}filter(e,t){if(!this._expression)return!0;try{return this._expression.evaluate(e,t)}catch(e){return console.log(e.message),!0}}static createFilter(r){if(!r)return null;this.isLegacyFilter(r)&&(r=this.convertLegacyFilter(r));try{const s=e.createExpression(r,null,t.booleanType);return new i(s)}catch(e){return console.log(e.message),null}}static isLegacyFilter(e){if(!Array.isArray(e))return!0;if(0===e.length)return!0;switch(e[0]){case"==":case"!=":case">":case"<":case">=":case"<=":return 3===e.length&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"in":return e.length>=3&&"string"==typeof e[1]&&!Array.isArray(e[2]);case"!in":case"none":case"!has":return!0;case"any":case"all":for(let t=1;t<e.length;t++)if(this.isLegacyFilter(e[t]))return!0;return!1;case"has":return 2===e.length&&("$id"===e[1]||"$type"===e[1]);default:return!1}}static convertLegacyFilter(e){if(!Array.isArray(e)||0===e.length)return!0;const t=e[0];if(1===e.length)return"any"!==t;switch(t){case"==":return i.convertComparison("==",e[1],e[2]);case"!=":return i.negate(i.convertComparison("==",e[1],e[2]));case">":case"<":case">=":case"<=":return i.convertComparison(t,e[1],e[2]);case"in":return i.convertIn(e[1],e.slice(2));case"!in":return i.negate(i.convertIn(e[1],e.slice(2)));case"any":case"all":case"none":return i.convertCombining(t,e.slice(1));case"has":return i.convertHas(e[1]);case"!has":return i.negate(i.convertHas(e[1]));default:throw new Error("Unexpected legacy filter.")}}static convertComparison(e,t,i){switch(t){case"$type":return[e,["geometry-type"],i];case"$id":return[e,["id"],i];default:return[e,["get",t],i]}}static convertIn(e,t){switch(e){case"$type":return["in",["geometry-type"],["literal",t]];case"$id":return["in",["id"],["literal",t]];default:return["in",["get",e],["literal",t]]}}static convertHas(e){switch(e){case"$type":return!0;case"$id":return["has-id"];default:return["has",e]}}static convertCombining(e,t){return[e].concat(t.map(this.convertLegacyFilter))}static negate(e){return["!",e]}}return i})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define(["exports","../../../../../Color","../../../../../core/colorUtils","../../../unitBezier","../GeometryUtils","./types"],function(e,t,i,r,s,a){"use strict";class n{constructor(e){this._parent=e,this._vars={}}add(e,t){this._vars[e]=t}get(e){return this._vars[e]?this._vars[e]:this._parent?this._parent.get(e):null}}class o{constructor(){this.type=a.valueType}static parse(e){if(e.length>1)throw new Error('"id" does not expect arguments');return new o}evaluate(e,t){return e?.id}}class l{constructor(){this.type=a.stringType}static parse(e){if(e.length>1)throw new Error('"geometry-type" does not expect arguments');return new l}evaluate(e,t){if(!e)return null;switch(e.type){case 1:return"Point";case 2:return"LineString";case 3:return"Polygon";default:return null}}}class c{constructor(){this.type=a.objectType}static parse(e){if(e.length>1)throw new Error('"properties" does not expect arguments');return new c}evaluate(e,t){return e?.values}}class h{constructor(){this.type=a.numberType}static parse(e){if(e.length>1)throw new Error('"zoom" does not expect arguments');return new h}evaluate(e,t){return t}}class u{constructor(e,t,i){this._lhs=e,this._rhs=t,this._compare=i,this.type=a.booleanType}static parse(e,t,i){if(3!==e.length&&4!==e.length)throw new Error(`"${e[0]}" expects 2 or 3 arguments`);if(4===e.length)throw new Error(`"${e[0]}" collator not supported`);return new u(ee(e[1],t),ee(e[2],t),i)}evaluate(e,t){return this._compare(this._lhs.evaluate(e,t),this._rhs.evaluate(e,t))}}class p extends u{static parse(e,t){return u.parse(e,t,(e,t)=>e===t)}}class y extends u{static parse(e,t){return u.parse(e,t,(e,t)=>e!==t)}}class d extends u{static parse(e,t){return u.parse(e,t,(e,t)=>e<t)}}class g extends u{static parse(e,t){return u.parse(e,t,(e,t)=>e<=t)}}class f extends u{static parse(e,t){return u.parse(e,t,(e,t)=>e>t)}}class _ extends u{static parse(e,t){return u.parse(e,t,(e,t)=>e>=t)}}class m{constructor(e){this._arg=e,this.type=a.booleanType}static parse(e,t){if(2!==e.length)throw new Error('"!" expects 1 argument');return new m(ee(e[1],t))}evaluate(e,t){return!this._arg.evaluate(e,t)}}class b{constructor(e){this._args=e,this.type=a.booleanType}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(ee(e[r],t));return new b(i)}evaluate(e,t){for(const i of this._args)if(!i.evaluate(e,t))return!1;return!0}}class T{constructor(e){this._args=e,this.type=a.booleanType}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(ee(e[r],t));return new T(i)}evaluate(e,t){for(const i of this._args)if(i.evaluate(e,t))return!0;return!1}}class w{constructor(e){this._args=e,this.type=a.booleanType}static parse(e,t){const i=[];for(let r=1;r<e.length;r++)i.push(ee(e[r],t));return new w(i)}evaluate(e,t){for(const i of this._args)if(i.evaluate(e,t))return!1;return!0}}class v{constructor(e,t,i){this.type=e,this._args=t,this._fallback=i}static parse(e,t,i){if(e.length<4)throw new Error('"case" expects at least 3 arguments');if(e.length%2==1)throw new Error('"case" expects an odd number of arguments');let r;const s=[];for(let a=1;a<e.length-1;a+=2){const n=ee(e[a],t),o=ee(e[a+1],t,i);r||(r=o.type),s.push({condition:n,output:o})}const a=ee(e[e.length-1],t,i);return r||(r=a.type),new v(r,s,a)}evaluate(e,t){for(const i of this._args)if(i.condition.evaluate(e,t))return i.output.evaluate(e,t);return this._fallback.evaluate(e,t)}}class x{constructor(e,t){this.type=e,this._args=t}static parse(e,t){if(e.length<2)throw new Error('"coalesce" expects at least 1 argument');let i;const r=[];for(let s=1;s<e.length;s++){const a=ee(e[s],t);i||(i=a.type),r.push(a)}return new x(i,r)}evaluate(e,t){for(const i of this._args){const r=i.evaluate(e,t);if(null!==r)return r}return null}}class S{constructor(e,t,i,r,s){this.type=e,this._input=t,this._labels=i,this._outputs=r,this._fallback=s}static parse(e,t){if(e.length<3)throw new Error('"match" expects at least 3 arguments');if(e.length%2==0)throw new Error('"case" expects an even number of arguments');let i;const r=ee(e[1],t),s=[],a={};let n;for(let r=2;r<e.length-1;r+=2){let o=e[r];Array.isArray(o)||(o=[o]);for(const e of o){const t=typeof e;if("string"!==t&&"number"!==t)throw new Error('"match" requires string or number literal as labels');if(n){if(t!==n)throw new Error('"match" requires labels to have the same type')}else n=t;a[e]=s.length}const l=ee(e[r+1],t);i||(i=l.type),s.push(l)}return new S(i,r,a,s,ee(e[e.length-1],t))}evaluate(e,t){const i=this._input.evaluate(e,t);return(this._outputs[this._labels[i]]||this._fallback).evaluate(e,t)}}class P{constructor(e,t,i,r,s){this._operator=e,this.type=t,this.interpolation=i,this.input=r,this._stops=s}static parse(e,t,i){const r=e[0];if(e.length<5)throw new Error(`"${r}" expects at least 4 arguments`);const s=e[1];if(!Array.isArray(s)||0===s.length)throw new Error(`"${s}" is not a valid interpolation`);switch(s[0]){case"linear":if(1!==s.length)throw new Error("Linear interpolation cannot have parameters");break;case"exponential":if(2!==s.length||"number"!=typeof s[1])throw new Error("Exponential interpolation requires one numeric argument");break;case"cubic-bezier":if(5!==s.length)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(let e=1;e<5;e++){const t=s[e];if("number"!=typeof t||t<0||t>1)throw new Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1")}break;default:throw new Error(`"${e[0]}" unknown interpolation type "${s[0]}"`)}if(e.length%2!=1)throw new Error(`"${r}" expects an even number of arguments`);const n=ee(e[2],t,a.numberType);let o;"interpolate-hcl"===r||"interpolate-lab"===r?o=a.colorType:i&&"value"!==i.kind&&(o=i);const l=[];for(let i=3;i<e.length;i+=2){const s=e[i];if("number"!=typeof s)throw new Error(`"${r}" requires stop inputs as literal numbers`);if(l.length&&l[l.length-1][0]>=s)throw new Error(`"${r}" requires strictly ascending stop inputs`);const a=ee(e[i+1],t,o);o||(o=a.type),l.push([s,a])}if(o&&o!==a.colorType&&o!==a.numberType&&("array"!==o.kind||o.itemType!==a.numberType))throw new Error(`"${r}" cannot interpolate type ${a.typeToString(o)}`);return new P(r,o,s,n,l)}evaluate(e,r){const n=this._stops;if(1===n.length)return n[0][1].evaluate(e,r);const o=this.input.evaluate(e,r);if(o<=n[0][0])return n[0][1].evaluate(e,r);if(o>=n[n.length-1][0])return n[n.length-1][1].evaluate(e,r);let l=0;for(;++l<n.length&&!(o<n[l][0]););const c=n[l-1][0],h=n[l][0],u=P.interpolationRatio(this.interpolation,o,c,h),p=n[l-1][1].evaluate(e,r),y=n[l][1].evaluate(e,r);if("interpolate"===this._operator){if("array"===this.type.kind&&Array.isArray(p)&&Array.isArray(y))return p.map((e,t)=>s.interpolate(e,y[t],u));if("color"===this.type.kind&&p instanceof t&&y instanceof t){const e=new t(p),i=new t(y);return new t([s.interpolate(e.r,i.r,u),s.interpolate(e.g,i.g,u),s.interpolate(e.b,i.b,u),s.interpolate(e.a,i.a,u)])}if("number"===this.type.kind&&"number"==typeof p&&"number"==typeof y)return s.interpolate(p,y,u);throw new Error(`"${this._operator}" cannot interpolate type ${a.typeToString(this.type)}`)}if("interpolate-hcl"===this._operator){const e=i.toLCH(p),r=i.toLCH(y),a=r.h-e.h,n=i.toRGB({h:e.h+u*(a>180||a<-180?a-360*Math.round(a/360):a),c:s.interpolate(e.c,r.c,u),l:s.interpolate(e.l,r.l,u)});return new t({a:s.interpolate(p.a,y.a,u),...n})}if("interpolate-lab"===this._operator){const e=i.toLAB(p),r=i.toLAB(y),a=i.toRGB({l:s.interpolate(e.l,r.l,u),a:s.interpolate(e.a,r.a,u),b:s.interpolate(e.b,r.b,u)});return new t({a:s.interpolate(p.a,y.a,u),...a})}throw new Error(`Unexpected operator "${this._operator}"`)}interpolationUniformValue(e,t){const i=this._stops;if(1===i.length)return 0;if(e>=i[i.length-1][0])return 0;let r=0;for(;++r<i.length&&!(e<i[r][0]););const s=i[r-1][0],a=i[r][0];return P.interpolationRatio(this.interpolation,t,s,a)}getInterpolationRange(e){const t=this._stops;if(1===t.length){const e=t[0][0];return[e,e]}const i=t[t.length-1][0];if(e>=i)return[i,i];let r=0;for(;++r<t.length&&!(e<t[r][0]););return[t[r-1][0],t[r][0]]}static interpolationRatio(e,t,i,s){let a=0;return"linear"===e[0]?a=P._exponentialInterpolationRatio(t,1,i,s):"exponential"===e[0]?a=P._exponentialInterpolationRatio(t,e[1],i,s):"cubic-bezier"===e[0]&&(a=r.unitBezier(e[1],e[2],e[3],e[4])(P._exponentialInterpolationRatio(t,1,i,s),1e-5)),a<0?a=0:a>1&&(a=1),a}static _exponentialInterpolationRatio(e,t,i,r){const s=r-i;if(0===s)return 0;const a=e-i;return 1===t?a/s:(t**a-1)/(t**s-1)}}class D{constructor(e,t,i){this.type=e,this._input=t,this._stops=i}static parse(e,t){if(e.length<5)throw new Error('"step" expects at least 4 arguments');if(e.length%2!=1)throw new Error('"step" expects an even number of arguments');const i=ee(e[1],t,a.numberType);let r;const s=[];s.push([-1/0,ee(e[2],t)]);for(let i=3;i<e.length;i+=2){const a=e[i];if("number"!=typeof a)throw new Error('"step" requires stop inputs as literal numbers');if(s.length&&s[s.length-1][0]>=a)throw new Error('"step" requires strictly ascending stop inputs');const n=ee(e[i+1],t);r||(r=n.type),s.push([a,n])}return new D(r,i,s)}evaluate(e,t){const i=this._stops;if(1===i.length)return i[0][1].evaluate(e,t);const r=this._input.evaluate(e,t);let s=0;for(;++s<i.length&&!(r<i[s][0]););return this._stops[s-1][1].evaluate(e,t)}}class L{constructor(e,t){this.type=e,this._output=t}static parse(e,t,i){if(e.length<4)throw new Error('"let" expects at least 3 arguments');if(e.length%2==1)throw new Error('"let" expects an odd number of arguments');const r=new n(t);for(let i=1;i<e.length-1;i+=2){const s=e[i];if("string"!=typeof s)throw new Error(`"let" requires a string to define variable names - found ${s}`);r.add(s,ee(e[i+1],t))}const s=ee(e[e.length-1],r,i);return new L(s.type,s)}evaluate(e,t){return this._output.evaluate(e,t)}}class I{constructor(e,t){this.type=e,this.output=t}static parse(e,t,i){if(2!==e.length||"string"!=typeof e[1])throw new Error('"var" requires just one literal string argument');const r=t.get(e[1]);if(!r)throw new Error(`${e[1]} must be defined before being used in a "var" expression`);return new I(i||a.valueType,r)}evaluate(e,t){return this.output.evaluate(e,t)}}class M{constructor(e,t,i){this.type=e,this._index=t,this._array=i}static parse(e,t){if(3!==e.length)throw new Error('"at" expects 2 arguments');const i=ee(e[1],t,a.numberType),r=ee(e[2],t);return new M(r.type.itemType,i,r)}evaluate(e,t){const i=this._index.evaluate(e,t),r=this._array.evaluate(e,t);if(i<0||i>=r.length)throw new Error('"at" index out of bounds');if(i!==Math.floor(i))throw new Error('"at" index must be an integer');return r[i]}}class R{constructor(e,t){this._key=e,this._obj=t,this.type=a.valueType}static parse(e,t){let i,r;switch(e.length){case 2:return i=ee(e[1],t),new R(i);case 3:return i=ee(e[1],t),r=ee(e[2],t),new R(i,r);default:throw new Error('"get" expects 1 or 2 arguments')}}evaluate(e,t){const i=this._key.evaluate(e,t);return this._obj?this._obj.evaluate(e,t)[i]:e?.values[i]}}class E{constructor(e,t){this._key=e,this._obj=t,this.type=a.booleanType}static parse(e,t){let i,r;switch(e.length){case 2:return i=ee(e[1],t),new E(i);case 3:return i=ee(e[1],t),r=ee(e[2],t),new E(i,r);default:throw new Error('"has" expects 1 or 2 arguments')}}evaluate(e,t){const i=this._key.evaluate(e,t);return this._obj?i in this._obj.evaluate(e,t):!!e?.values[i]}}class k{constructor(e,t){this._key=e,this._vals=t,this.type=a.booleanType}static parse(e,t){if(3!==e.length)throw new Error('"in" expects 2 arguments');return new k(ee(e[1],t),ee(e[2],t))}evaluate(e,t){const i=this._key.evaluate(e,t);return this._vals.evaluate(e,t).includes(i)}}class V{constructor(e,t,i){this._item=e,this._array=t,this._from=i,this.type=a.numberType}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"index-of" expects 3 or 4 arguments');const i=ee(e[1],t),r=ee(e[2],t);if(4===e.length){const s=ee(e[3],t,a.numberType);return new V(i,r,s)}return new V(i,r)}evaluate(e,t){const i=this._item.evaluate(e,t),r=this._array.evaluate(e,t);if(this._from){const s=this._from.evaluate(e,t);if(s!==Math.floor(s))throw new Error('"index-of" index must be an integer');return r.indexOf(i,s)}return r.indexOf(i)}}class C{constructor(e){this._arg=e,this.type=a.numberType}static parse(e,t){if(2!==e.length)throw new Error('"length" expects 2 arguments');const i=ee(e[1],t);return new C(i)}evaluate(e,t){const i=this._arg.evaluate(e,t);if("string"==typeof i)return i.length;if(Array.isArray(i))return i.length;throw new Error('"length" expects string or array')}}class A{constructor(e,t,i,r){this.type=e,this._array=t,this._from=i,this._to=r}static parse(e,t){if(e.length<3||e.length>4)throw new Error('"slice" expects 2 or 3 arguments');const i=ee(e[1],t),r=ee(e[2],t,a.numberType);if(r.type!==a.numberType)throw new Error('"slice" index must return a number');if(4===e.length){const s=ee(e[3],t,a.numberType);if(s.type!==a.numberType)throw new Error('"slice" index must return a number');return new A(i.type,i,r,s)}return new A(i.type,i,r)}evaluate(e,t){const i=this._array.evaluate(e,t);if(!Array.isArray(i)&&"string"!=typeof i)throw new Error('"slice" input must be an array or a string');const r=this._from.evaluate(e,t);if(r<0||r>=i.length)throw new Error('"slice" index out of bounds');if(r!==Math.floor(r))throw new Error('"slice" index must be an integer');if(this._to){const s=this._to.evaluate(e,t);if(s<0||s>=i.length)throw new Error('"slice" index out of bounds');if(s!==Math.floor(s))throw new Error('"slice" index must be an integer');return i.slice(r,s)}return i.slice(r)}}class B{constructor(){this.type=a.booleanType}static parse(e){if(1!==e.length)throw new Error('"has-id" expects no arguments');return new B}evaluate(e,t){return void 0!==e?.id}}class O{constructor(e,t){this._args=e,this._calculate=t,this.type=a.numberType}static parse(e,t,i){const r=e.slice(1).map(e=>ee(e,t));return new O(r,i)}evaluate(e,t){let i;return this._args&&(i=this._args.map(i=>i.evaluate(e,t))),this._calculate(i)}}class U extends O{static parse(e,t){switch(e.length){case 2:return O.parse(e,t,e=>-e[0]);case 3:return O.parse(e,t,e=>e[0]-e[1]);default:throw new Error('"-" expects 1 or 2 arguments')}}}class z extends O{static parse(e,t){return O.parse(e,t,e=>{let t=1;for(const i of e)t*=i;return t})}}class F extends O{static parse(e,t){if(3===e.length)return O.parse(e,t,e=>e[0]/e[1]);throw new Error('"/" expects 2 arguments')}}class H extends O{static parse(e,t){if(3===e.length)return O.parse(e,t,e=>e[0]%e[1]);throw new Error('"%" expects 2 arguments')}}class N extends O{static parse(e,t){if(3===e.length)return O.parse(e,t,e=>e[0]**e[1]);throw new Error('"^" expects 1 or 2 arguments')}}class G extends O{static parse(e,t){return O.parse(e,t,e=>{let t=0;for(const i of e)t+=i;return t})}}class q{constructor(e,t){this._args=e,this._calculate=t,this.type=a.numberType}static{this.ops={abs:e=>Math.abs(e[0]),acos:e=>Math.acos(e[0]),asin:e=>Math.asin(e[0]),atan:e=>Math.atan(e[0]),ceil:e=>Math.ceil(e[0]),cos:e=>Math.cos(e[0]),e:()=>Math.E,floor:e=>Math.floor(e[0]),ln:e=>Math.log(e[0]),ln2:()=>Math.LN2,log10:e=>Math.log(e[0])/Math.LN10,log2:e=>Math.log(e[0])/Math.LN2,max:e=>Math.max(...e),min:e=>Math.min(...e),pi:()=>Math.PI,round:e=>Math.round(e[0]),sin:e=>Math.sin(e[0]),sqrt:e=>Math.sqrt(e[0]),tan:e=>Math.tan(e[0])}}static parse(e,t){const i=e.slice(1).map(e=>ee(e,t));return new q(i,q.ops[e[0]])}evaluate(e,t){let i;return this._args&&(i=this._args.map(i=>i.evaluate(e,t))),this._calculate(i)}}class Y{constructor(e){this._args=e,this.type=a.stringType}static parse(e,t){return new Y(e.slice(1).map(e=>ee(e,t)))}evaluate(e,t){return this._args.map(i=>i.evaluate(e,t)).join("")}}class ${constructor(e,t){this._arg=e,this._calculate=t,this.type=a.stringType}static{this.ops={downcase:e=>e.toLowerCase(),upcase:e=>e.toUpperCase()}}static parse(e,t){if(2!==e.length)throw new Error(`${e[0]} expects 1 argument`);const i=ee(e[1],t);return new $(i,$.ops[e[0]])}evaluate(e,t){return this._calculate(this._arg.evaluate(e,t))}}class j{constructor(e){this._args=e,this.type=a.colorType}static parse(e,t){if(4!==e.length)throw new Error('"rgb" expects 3 arguments');const i=e.slice(1).map(e=>ee(e,t));return new j(i)}evaluate(e,i){const r=this._validate(this._args[0].evaluate(e,i)),s=this._validate(this._args[1].evaluate(e,i)),a=this._validate(this._args[2].evaluate(e,i));return new t({r,g:s,b:a})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}}class Q{constructor(e){this._args=e,this.type=a.colorType}static parse(e,t){if(5!==e.length)throw new Error('"rgba" expects 4 arguments');const i=e.slice(1).map(e=>ee(e,t));return new Q(i)}evaluate(e,i){const r=this._validate(this._args[0].evaluate(e,i)),s=this._validate(this._args[1].evaluate(e,i)),a=this._validate(this._args[2].evaluate(e,i)),n=this._validateAlpha(this._args[3].evaluate(e,i));return new t({r,g:s,b:a,a:n})}_validate(e){if("number"!=typeof e||e<0||e>255)throw new Error(`${e}: invalid color component`);return Math.round(e)}_validateAlpha(e){if("number"!=typeof e||e<0||e>1)throw new Error(`${e}: invalid alpha color component`);return e}}class X{constructor(e){this._color=e,this.type=a.arrayType(a.numberType,4)}static parse(e,t){if(2!==e.length)throw new Error('"to-rgba" expects 1 argument');const i=ee(e[1],t);return new X(i)}evaluate(e,i){return new t(this._color.evaluate(e,i)).toRgba()}}class K{constructor(e,t){this.type=e,this._args=t}static parse(e,t){const i=e[0];if(e.length<2)throw new Error(`${i} expects at least one argument`);let r,s=1;if("array"===i){if(e.length>2){switch(e[1]){case"string":r=a.stringType;break;case"number":r=a.numberType;break;case"boolean":r=a.booleanType;break;default:throw new Error('"array" type argument must be string, number or boolean')}s++}else r=a.valueType;let t;if(e.length>3){if(t=e[2],null!==t&&("number"!=typeof t||t<0||t!==Math.floor(t)))throw new Error('"array" length argument must be a positive integer literal');s++}r=a.arrayType(r,t)}else switch(i){case"string":r=a.stringType;break;case"number":r=a.numberType;break;case"boolean":r=a.booleanType;break;case"object":r=a.objectType}const n=[];for(;s<e.length;s++){const i=ee(e[s],t);n.push(i)}return new K(r,n)}evaluate(e,t){let i;for(const r of this._args){const s=r.evaluate(e,t);if(i=a.getType(s),a.matchType(i,this.type))return s}throw new Error(`Expected ${a.typeToString(this.type)} but got ${a.typeToString(i)}`)}}class W{static{this.types={"to-boolean":a.booleanType,"to-color":a.colorType,"to-number":a.numberType,"to-string":a.stringType}}constructor(e,t){this.type=e,this._args=t}static parse(e,t){const i=e[0],r=W.types[i];if(r===a.booleanType||r===a.stringType){if(2!==e.length)throw new Error(`${i} expects one argument`)}else if(e.length<2)throw new Error(`${i} expects at least one argument`);const s=[];for(let i=1;i<e.length;i++){const r=ee(e[i],t);s.push(r)}return new W(r,s)}evaluate(e,i){if(this.type===a.booleanType)return Boolean(this._args[0].evaluate(e,i));if(this.type===a.stringType)return a.valueToString(this._args[0].evaluate(e,i));if(this.type===a.numberType){for(const t of this._args){const r=Number(t.evaluate(e,i));if(!isNaN(r))return r}return null}if(this.type===a.colorType){for(const r of this._args)try{const s=W.toColor(r.evaluate(e,i));if(s instanceof t)return s}catch{}return null}}static toBoolean(e){return Boolean(e)}static toString(e){return a.valueToString(e)}static toNumber(e){const t=Number(e);if(isNaN(t))throw new Error(`"${e}" is not a number`);return t}static toColor(e){if(e instanceof t)return e;if("string"==typeof e){const i=t.fromString(e);if(i)return i;throw new Error(`"${e}" is not a color`)}if(Array.isArray(e))return t.fromArray(e);throw new Error(`"${e}" is not a color`)}}class Z{constructor(e){this._val=e,this.type=a.getType(e)}static parse(e){if(2!==e.length)throw new Error('"literal" expects 1 argument');return new Z(e[1])}evaluate(e,t){return this._val}}class J{constructor(e){this._arg=e,this.type=a.stringType}static parse(e,t){if(2!==e.length)throw new Error('"typeof" expects 1 argument');return new J(ee(e[1],t))}evaluate(e,t){return a.typeToString(a.getType(this._arg.evaluate(e,t)))}}function ee(e,t,i){const r=typeof e;if("string"===r||"boolean"===r||"number"===r||null===e){if(i)switch(i.kind){case"string":"string"!==r&&(e=W.toString(e));break;case"number":"number"!==r&&(e=W.toNumber(e));break;case"color":e=W.toColor(e)}e=["literal",e]}if(!Array.isArray(e)||0===e.length)throw new Error("Expression must be a non empty array");const s=e[0];if("string"!=typeof s)throw new Error("First element of expression must be a string");const a=te[s];if(void 0===a)throw new Error(`Invalid expression operator "${s}"`);if(!a)throw new Error(`Unimplemented expression operator "${s}"`);return a.parse(e,t,i)}const te={array:K,boolean:K,collator:null,format:null,image:null,literal:Z,number:K,"number-format":null,object:K,string:K,"to-boolean":W,"to-color":W,"to-number":W,"to-string":W,typeof:J,accumulated:null,"feature-state":null,"geometry-type":l,id:o,"line-progress":null,properties:c,at:M,get:R,has:E,in:k,"index-of":V,length:C,slice:A,"!":m,"!=":y,"<":d,"<=":g,"==":p,">":f,">=":_,all:b,any:T,case:v,coalesce:x,match:S,within:null,interpolate:P,"interpolate-hcl":P,"interpolate-lab":P,step:D,let:L,var:I,concat:Y,downcase:$,"is-supported-script":null,"resolved-locale":null,upcase:$,rgb:j,rgba:Q,"to-rgba":X,"-":U,"*":z,"/":F,"%":H,"^":N,"+":G,abs:q,acos:q,asin:q,atan:q,ceil:q,cos:q,e:q,floor:q,ln:q,ln2:q,log10:q,log2:q,max:q,min:q,pi:q,round:q,sin:q,sqrt:q,tan:q,zoom:h,"heatmap-density":null,"has-id":B,none:w};e.ALL=b,e.ANY=T,e.Add=G,e.Assert=K,e.At=M,e.Calculate=q,e.Case=v,e.Coalesce=x,e.Coerce=W,e.Concat=Y,e.Div=F,e.EQ=p,e.GE=_,e.GT=f,e.GeomType=l,e.Get=R,e.Has=E,e.HasID=B,e.ID=o,e.In=k,e.IndexOf=V,e.Interpolate=P,e.LE=g,e.LT=d,e.Length=C,e.Let=L,e.Literal=Z,e.Match=S,e.Mod=H,e.Mul=z,e.NE=y,e.NONE=w,e.NOT=m,e.Pow=N,e.Properties=c,e.Rgb=j,e.Rgba=Q,e.Slice=A,e.Step=D,e.String=$,e.Sub=U,e.ToRgba=X,e.TypeOf=J,e.Var=I,e.Zoom=h,e.createExpression=ee,e.ops=te,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(e,t){"use strict";const i={kind:"null"},r={kind:"number"},s={kind:"string"},a={kind:"boolean"},n={kind:"color"},o={kind:"object"},l={kind:"value"};function c(e,t){return{kind:"array",itemType:e,n:t}}const h=[i,r,s,a,n,o,c(l)];e.arrayType=c,e.booleanType=a,e.colorType=n,e.getType=function e(h){if(null===h)return i;if("string"==typeof h)return s;if("boolean"==typeof h)return a;if("number"==typeof h)return r;if(h instanceof t)return n;if(Array.isArray(h)){let t;for(const i of h){const r=e(i);if(t){if(t!==r){t=l;break}}else t=r}return c(t||l,h.length)}return"object"==typeof h?o:l},e.matchType=function e(t,i){if("array"===i.kind)return"array"===t.kind&&(0===t.n&&"value"===t.itemType.kind||e(t.itemType,i.itemType))&&("number"!=typeof i.n||i.n===t.n);if("value"===i.kind)for(const i of h)if(e(t,i))return!0;return i.kind===t.kind},e.nullType=i,e.numberType=r,e.objectType=o,e.stringType=s,e.typeToString=function e(t){if("array"===t.kind){const i=e(t.itemType);return"number"==typeof t.n?`array<${i}, ${t.n}>`:"value"===t.itemType.kind?"array":`array<${i}>`}return t.kind},e.valueToString=function(e){if(null===e)return"";const i=typeof e;return"string"===i?e:"number"===i||"boolean"===i?String(e):e instanceof t?e.toString():JSON.stringify(e)},e.valueType=l,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports"],function(e){"use strict";class t{static{this.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}}}static{this.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}}}static{this.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"line-cap":{type:"enum",values:["butt","round","square"],default:0},"line-join":{type:"enum",values:["bevel","round","miter"],default:2},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}}}static{this.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:0},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",default:!1},"icon-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"],default:0},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto","left","center","right"],default:2},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:2},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:0},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:[0]}}}static{this.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:0}}}static{this.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}}}static{this.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:0}}}static{this.linePaintDefinition={"line-blur":{type:"number",minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"line-width":{type:"number",minimum:0,default:1}}}static{this.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:0},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:0}}}static{this.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}}}static{this.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:0}}}}e.StyleDefinition=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../../../../../colorUtils","../GeometryUtils","../expression/expression","../expression/types"],function(e,t,i,r,s){"use strict";class a{constructor(e,t){let i;switch(this.isDataDriven=!1,this.interpolator=null,e.type){case"number":case"color":i=!0;break;case"array":i="number"===e.value;break;default:i=!1}if((null==t||""===t&&"color"===e.type)&&(t=e.default),Array.isArray(t)&&t.length>0&&r.ops[t[0]]){const i={number:s.numberType,color:s.colorType,string:s.stringType,boolean:s.booleanType,enum:s.stringType};try{const a="array"===e.type?s.arrayType(i[e.value]||s.valueType,e.length):i[e.type],n=r.createExpression(t,null,a);this.getValue=this._buildExpression(n,e),this.isDataDriven=!0,n instanceof r.Interpolate&&n.input instanceof r.Zoom&&(this.interpolator=n)}catch(t){console.log(t.message),this.getValue=this._buildSimple(e.default)}return}i&&"interval"===t.type&&(i=!1);const a=t?.stops&&t.stops.length>0;if(a)for(const i of t.stops)i[1]=this._validate(i[1],e);if(this.isDataDriven=!!t&&!!t.property,this.isDataDriven)if(void 0!==t.default&&(t.default=this._validate(t.default,e)),a)switch(t.type){case"identity":this.getValue=this._buildIdentity(t,e);break;case"categorical":this.getValue=this._buildCategorical(t,e);break;default:this.getValue=i?this._buildInterpolate(t,e):this._buildInterval(t,e)}else this.getValue=this._buildIdentity(t,e);else a?this.getValue=i?this._buildZoomInterpolate(t):this._buildZoomInterval(t):(t=this._validate(t,e),this.getValue=this._buildSimple(t))}_validate(e,t){if("number"===t.type){if(null!=t.minimum&&e<t.minimum)return t.minimum;if(null!=t.maximum&&e>t.maximum)return t.maximum}else"color"===t.type?e=a._parseColor(e):"enum"===t.type?"string"==typeof e&&(e=t.values.indexOf(e)):"array"===t.type&&"enum"===t.value?e=e.map(e=>"string"==typeof e?t.values.indexOf(e):e):"string"===t.type&&(e=s.valueToString(e));return e}_buildSimple(e){return()=>e}_buildExpression(e,t){return(i,r)=>{try{const s=e.evaluate(r,i);return void 0===s?t.default:this._validate(s,t)}catch(e){return console.log(e.message),t.default}}}_buildIdentity(e,t){return(i,r)=>{let s;return r&&(s=r.values[e.property]),void 0!==s&&(s=this._validate(s,t)),null!=s?s:void 0!==e.default?e.default:t.default}}_buildCategorical(e,t){return(i,r)=>{let s;return r&&(s=r.values[e.property]),s=this._categorical(s,e.stops),void 0!==s?s:void 0!==e.default?e.default:t.default}}_buildInterval(e,t){return(i,r)=>{let s;return r&&(s=r.values[e.property]),"number"==typeof s?this._interval(s,e.stops):void 0!==e.default?e.default:t.default}}_buildInterpolate(e,t){return(i,r)=>{let s;return r&&(s=r.values[e.property]),"number"==typeof s?this._interpolate(s,e.stops,e.base||1):void 0!==e.default?e.default:t.default}}_buildZoomInterpolate(e){return t=>this._interpolate(t,e.stops,e.base||1)}_buildZoomInterval(e){return t=>this._interval(t,e.stops)}_categorical(e,t){const i=t.length;for(let r=0;r<i;r++)if(t[r][0]===e)return t[r][1]}_interval(e,t){const i=t.length;let r=0;for(let s=0;s<i&&t[s][0]<=e;s++)r=s;return t[r][1]}_interpolate(e,t,r){let s,a;const n=t.length;for(let i=0;i<n;i++){const r=t[i];if(!(r[0]<=e)){a=r;break}s=r}if(s&&a){const t=a[0]-s[0],n=e-s[0],o=1===r?n/t:(r**n-1)/(r**t-1);if(Array.isArray(s[1])){const e=s[1],t=a[1],r=[];for(let s=0;s<e.length;s++)r.push(i.interpolate(e[s],t[s],o));return r}return i.interpolate(s[1],a[1],o)}return s?s[1]:a?a[1]:void 0}static _isEmpty(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0}static _parseColor(i){return Array.isArray(i)?i:"string"==typeof i?t.parseToUnitRgba(i)??void 0:i instanceof e&&!this._isEmpty(i)?e.toUnitRGBA(i):void 0}}return a})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["../../../../../core/lang","./StyleLayer"],function(e,t){"use strict";class i{constructor(t,i=!0){if(this.backgroundBucketIds=[],this._uidToLayer=new Map,this._layerByName={},this._runningId=0,this._style=i?e.clone(t):t,this._style.layers||(this._style.layers=[]),this.version=parseFloat(this._style.version),this.layers=this._style.layers.map((e,t,i)=>this._create(e,t,i)).filter(e=>!!e),this.layers)for(let e=0;e<this.layers.length;e++){const t=this.layers[e];this._layerByName[t.id]=t,this._uidToLayer.set(t.uid,t),0===t.type&&this.backgroundBucketIds.push(t.id)}this._identifyRefLayers()}getLayerStyleProperties(e,t){const i=this.getStyleLayerByUID(e),r=0!==i?.getLayoutValue("symbol-placement",t);let s=i?.getLayoutValue("icon-rotation-alignment",t);2===s&&(s=r?0:1);let a=i?.getLayoutValue("text-rotation-alignment",t);2===a&&(a=r?0:1);const n=i?.getPaintValue("icon-translate",t),o=i?.getPaintValue("icon-translate-anchor",t),l=i?.getPaintValue("text-translate",t),c=i?.getPaintValue("text-translate-anchor",t);return{geometryType:null,iconAllowOverlap:i?.getLayoutValue("icon-allow-overlap",t),iconIgnorePlacement:i?.getLayoutValue("icon-ignore-placement",t),textAllowOverlap:i?.getLayoutValue("text-allow-overlap",t),textIgnorePlacement:i?.getLayoutValue("text-ignore-placement",t),iconRotationAlignment:s,textRotationAlignment:a,iconTranslateAnchor:o,iconTranslate:n,textTranslateAnchor:c,textTranslate:l}}isPainterDataDriven(e){const t=this._layerByName[e];return!!t&&t.isPainterDataDriven()}getStyleLayerId(e){return e>=this.layers.length?null:this.layers[e].id}getStyleLayerByUID(e){return this._uidToLayer.get(e)??null}getStyleLayerIndex(e){const t=this._layerByName[e];return t?this.layers.indexOf(t):-1}setStyleLayer(e,t){if(!e?.id)return;const r=this._style;null!=t&&t>=this.layers.length&&(t=this.layers.length-1);let s,a=!0;const n=this._layerByName[e.id];if(n){const o=this.layers.indexOf(n);t||(t=o),t===o?(a=!1,s=i._recreateLayer(e,n),this.layers[t]=s,r.layers[t]=e):(this.layers.splice(o,1),r.layers.splice(o,1),s=this._create(e,t,this.layers),this.layers.splice(t,0,s),r.layers.splice(t,0,e))}else s=this._create(e,t,this.layers),!t||t>=this.layers.length?(this.layers.push(s),r.layers.push(e)):(this.layers.splice(t,0,s),r.layers.splice(t,0,e));this._layerByName[e.id]=s,this._uidToLayer.set(s.uid,s),a&&this._recomputeZValues(),this._identifyRefLayers()}getStyleLayer(e){const t=this._layerByName[e];return t?{type:t.typeName,id:t.id,source:t.source,"source-layer":t.sourceLayer,minzoom:t.minzoom,maxzoom:t.maxzoom,filter:t.filter,layout:t.layout,paint:t.paint}:null}deleteStyleLayer(e){const t=this._layerByName[e];if(t){delete this._layerByName[e],this._uidToLayer.delete(t.uid);const i=this.layers.indexOf(t);this.layers.splice(i,1),this._style.layers.splice(i,1),this._recomputeZValues(),this._identifyRefLayers()}}getLayerById(e){return this._layerByName[e]}getLayoutProperties(e){const t=this._layerByName[e];return t?t.layout:null}getPaintProperties(e){const t=this._layerByName[e];return t?t.paint:null}setPaintProperties(e,t){const r=this._layerByName[e];if(!r)return;const s={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:r.layout,paint:t},a=i._recreateLayer(s,r),n=this.layers.indexOf(r);this.layers[n]=a,this._style.layers[n].paint=t,this._layerByName[r.id]=a,this._uidToLayer.set(r.uid,a)}setLayoutProperties(e,t){const r=this._layerByName[e];if(!r)return;const s={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:t,paint:r.paint},a=i._recreateLayer(s,r),n=this.layers.indexOf(r);this.layers[n]=a,this._style.layers[n].layout=t,this._layerByName[r.id]=a,this._uidToLayer.set(r.uid,a)}setStyleLayerVisibility(e,t){const r=this._layerByName[e];if(!r)return;const s=r.layout||{};s.visibility=t;const a={type:r.typeName,id:r.id,source:r.source,"source-layer":r.sourceLayer,minzoom:r.minzoom,maxzoom:r.maxzoom,filter:r.filter,layout:s,paint:r.paint},n=i._recreateLayer(a,r),o=this.layers.indexOf(r);this.layers[o]=n,this._style.layers[o].layout=s,this._layerByName[r.id]=n,this._uidToLayer.set(r.uid,n)}getStyleLayerVisibility(e){const t=this._layerByName[e];if(!t)return"none";const i=t.layout;return i?.visibility??"visible"}_recomputeZValues(){const e=this.layers,t=1/(e.length+1);for(let i=0;i<e.length;i++)e[i].z=1-(1+i)*t}_identifyRefLayers(){const e=[],t=[];let i=0;for(const r of this.layers){const s=r.layout;if(1===r.type){const t=r;let a=r.source+"|"+r.sourceLayer;a+="|"+(s?.visibility??""),a+="|"+r.minzoom,a+="|"+r.maxzoom,a+="|"+JSON.stringify(r.filter),(t.hasDataDrivenFill||t.hasDataDrivenOutline)&&(a+="|"+i),e.push({key:a,layer:r})}else if(2===r.type){const e=r,a=r.paint,n=null!=a&&(null!=a["line-pattern"]||null!=a["line-dasharray"]);let o=r.source+"|"+r.sourceLayer;o+="|"+(s?.visibility??""),o+="|"+r.minzoom,o+="|"+r.maxzoom,o+="|"+JSON.stringify(r.filter),o+="|"+(void 0!==s?s["line-cap"]:""),o+="|"+(void 0!==s?s["line-join"]:""),(e.hasDataDrivenLine||n)&&(o+="|"+i),t.push({key:o,layer:r})}++i}this._assignRefLayers(e),this._assignRefLayers(t)}_assignRefLayers(e){let t,i;e.sort((e,t)=>e.key<t.key?-1:e.key>t.key?1:0);const r=e.length;for(let s=0;s<r;s++){const a=e[s];if(a.key===t)a.layer.refLayerId=i;else if(t=a.key,i=a.layer.id,1===a.layer.type){if(!a.layer.getPaintProperty("fill-outline-color"))for(let n=s+1;n<r;n++){const r=e[n];if(r.key!==t)break;if(r.layer.getPaintProperty("fill-outline-color")){e[s]=r,e[n]=a,i=r.layer.id;break}}}else if(2===a.layer.type){let n=a.layer;for(let o=s+1;o<r;o++){const r=e[o];if(r.key!==t)break;const l=r.layer;(n.canUseThinTessellation&&!l.canUseThinTessellation||!n.canUseThinTessellation&&(l.getPaintProperty("line-pattern")||l.getPaintProperty("line-dasharray")))&&(n=l,e[s]=r,e[o]=a,i=r.layer.id)}}}}_create(e,i,r){const s=1-(1+i)*(1/(r.length+1)),a=this._runningId++;switch(e.type){case"background":return new t.BackgroundStyleLayer(0,e,s,a);case"fill":return new t.FillStyleLayer(1,e,s,a);case"line":return new t.LineStyleLayer(2,e,s,a);case"symbol":return new t.SymbolStyleLayer(3,e,s,a);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new t.CircleStyleLayer(4,e,s,a)}return null}static _recreateLayer(e,i){switch(e.type){case"background":return new t.BackgroundStyleLayer(0,e,i.z,i.uid);case"fill":return new t.FillStyleLayer(1,e,i.z,i.uid);case"line":return new t.LineStyleLayer(2,e,i.z,i.uid);case"symbol":return new t.SymbolStyleLayer(3,e,i.z,i.uid);case"raster":return console.warn(`Unsupported vector tile raster layer ${e.id}`),null;case"circle":return new t.CircleStyleLayer(4,e,i.z,i.uid)}return null}}return i})},"esri/views/2d/layers/LayerView2D":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Collection","../../../core/collectionUtils","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../linkChart/utils","../engine/Container","./support/HighlightCounter","./support/util","../support/highlightOptionsUtils","../../layers/support/ClipRect","../../layers/support/Geometry","../../layers/support/Path","../../support/HighlightOptions","../../support/layerViewUtils"],function(e,t,i,r,s,a,n,o,l,c,h,u,p,y,d,g,f,_,m,b,T){"use strict";const w=i.ofType({key:"type",base:null,typeMap:{rect:f,path:m,geometry:_}}),v=new(i.ofType(b));e.LayerView2DMixin=e=>{const o=e;let l=class extends o{constructor(){super(...arguments),this._highlightCounter=new y.HighlightCounter,this.attached=!1,this.clips=new w,this.highlights=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const e=this.view?.spatialReferenceLocked??!0,t=this.view?.spatialReference;t&&e&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new s("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new p.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([a.watch(()=>this.suspended,e=>{this.container&&(this.container.visible=!e)},a.syncAndInitial),a.watch(()=>this.updateSuspended,e=>{this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},a.syncAndInitial),a.watch(()=>this.layer?.opacity??1,e=>{this.container&&(this.container.opacity=e)},a.syncAndInitial),a.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",e=>{this.container&&(this.container.blendMode=e)},a.syncAndInitial),a.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,e=>{this.container&&(this.container.effect=e)},a.syncAndInitial),a.watch(()=>this._mergedHighlights.items.map(e=>({name:e.name,options:{fillColor:e.color,haloColor:e.haloColor,fillOpacity:e.fillOpacity,haloOpacity:e.haloOpacity,haloWidth:e.haloWidth,haloBlur:e.haloBlur}})),()=>{this.container.highlightGradient=d.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)},a.syncAndInitial),a.watch(()=>this._mergedHighlights.items.map(e=>e.name),()=>{this._processHighlight()}),a.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},a.syncAndInitial),a.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:e,scaleRange:t})=>{const i=T.isInEffectiveScaleRange(t,e);i!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=i)},a.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get highlightOptions(){return g.getDefaultHighlightOptions(this)}set highlightOptions(e){g.setDefaultHighlightOptions(this,e)}get hasHighlight(){return this._highlightCounter.size>0}get _mergedHighlights(){if(!this.view)return v;if(!this.highlights)return this.view.highlights;const e=this.view.highlights.clone();for(const t of this.highlights){const i=e.find(e=>e.name===t.name);i&&i.assignFrom(t)}return e}get highlightIds(){return Array.from(this._highlightCounter.objectIds)}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;switch(this.layer?.type){case"link-chart":case"knowledge-graph-sublayer":case"graphics":break;default:if(u.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const e=super.getSuspendInfo(),t=!this.spatialReferenceSupported;return t&&(e.spatialReferenceNotSupported=t),e}addAttachHandles(e){this.addHandles(e,"attach")}_addHighlights(e,t){this._highlightCounter.add(e,t)&&this._processHighlight()}_removeHighlights(e,t){this._highlightCounter.delete(e,t)&&this._processHighlight()}_processHighlight(){}_getHighlights(){const e=[];for(const[t,i]of this._highlightCounter.highlightNamesByObjectId){const r=this._getHighlightBits(i);e.push({objectId:t,highlightFlags:r})}return e}_getHighlightBits(e){const t=new Set(e);let i=1,r=0;if(!this.view)return 0;const s=this._mergedHighlights;for(const{name:e}of s)t.delete(e)&&(r=i),i<<=1;return r}};return t.__decorate([n.property()],l.prototype,"attached",void 0),t.__decorate([n.property({type:w,set(e){const t=r.referenceSetter(e,this._get("clips"),w);this._set("clips",t)}})],l.prototype,"clips",void 0),t.__decorate([n.property()],l.prototype,"container",void 0),t.__decorate([n.property({type:b})],l.prototype,"highlightOptions",null),t.__decorate([n.property({type:i.ofType(b)})],l.prototype,"highlights",void 0),t.__decorate([n.property()],l.prototype,"_mergedHighlights",null),t.__decorate([n.property()],l.prototype,"moving",void 0),t.__decorate([n.property({readOnly:!0})],l.prototype,"spatialReferenceSupported",null),t.__decorate([n.property({readOnly:!0})],l.prototype,"updateParameters",void 0),t.__decorate([n.property()],l.prototype,"updateRequested",void 0),t.__decorate([n.property()],l.prototype,"updating",null),t.__decorate([n.property()],l.prototype,"view",void 0),t.__decorate([n.property()],l.prototype,"_visibleAtCurrentScale",void 0),t.__decorate([n.property({readOnly:!0})],l.prototype,"visibleAtCurrentScale",null),l=t.__decorate([h.subclass("esri.views.2d.layers.LayerView2D")],l),l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/linkChart/utils":function(){define(["exports"],function(e){"use strict";e.isLinkChartView=function(e){return null!=e&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/MapUtils","../../../../core/ReactiveMap","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass"],function(e,t,i,r,s,a,n,o,l,c){"use strict";e.HighlightCounter=class extends i{constructor(){super(...arguments),this._idToCounters=new s}get size(){return this._idToCounters.size}get objectIds(){return this._idToCounters.keys()}get highlightNamesByObjectId(){return function*(e){for(const[t,i]of e)yield[t,i.keys()]}(this._idToCounters)}add(e,t){let i=!1;for(const s of e){const e=r.getOrCreateMapValue(this._idToCounters,s,()=>(i=!0,new Map)),a=e.get(t)??0;a||(i=!0),e.set(t,a+1)}return i}delete(e,t){let i=!1;for(const r of e){const e=this._idToCounters.get(r);if(!e)continue;let s=e.get(t);null!=s&&(s--,s>0?e.set(t,s):(e.delete(t),i=!0),0===e.size&&(this._idToCounters.delete(r),i=!0))}return i}},e.HighlightCounter=t.__decorate([c.subclass("esri.views.2d.layers.support.HighlightCounter")],e.HighlightCounter),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],function(e,t,i,r,s,a,n,o){"use strict";var l;return e.default=l=class extends o{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}},t.__decorate([i.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"left",void 0),t.__decorate([i.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"right",void 0),t.__decorate([i.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"top",void 0),t.__decorate([i.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"bottom",void 0),e.default=l=t.__decorate([n.subclass("esri.views.layers.support.ClipRect")],e.default),e.default})},"esri/views/layers/support/ClipArea":function(){define(["exports","../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,i,r,s,a,n,o){"use strict";return e.default=class extends i.JSONSupport{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}},t.__decorate([r.property({readOnly:!0})],e.default.prototype,"version",null),e.default=t.__decorate([o.subclass("esri.views.layers.support.ClipArea")],e.default),e.default})},"esri/views/layers/support/Geometry":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Extent","../../../geometry/Geometry","../../../geometry/Polygon","../../../geometry/support/jsonUtils","./ClipArea"],function(e,t,i,r,s,a,n,o,l,c,h,u){"use strict";var p;const y={base:l,key:"type",typeMap:{extent:o,polygon:c}};return e.default=p=class extends u{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){return new p({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}},t.__decorate([i.property({types:y,json:{read:h.fromJSON,write:!0}})],e.default.prototype,"geometry",void 0),e.default=p=t.__decorate([n.subclass("esri.views.layers.support.Geometry")],e.default),e.default})},"esri/views/layers/support/Path":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],function(e,t,i,r,s,a,n,o){"use strict";return e.default=class extends o{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}},t.__decorate([i.property({type:[[[Number]]],json:{write:!0}})],e.default.prototype,"path",void 0),e.default=t.__decorate([n.subclass("esri.views.layers.support.Path")],e.default),e.default})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(e,t,i){"use strict";return class extends t{constructor(){super(...arguments),this._fullCacheLodInfos=null,this._levelByScale={}}getTileParentId(e){const t=i.pool.acquire(e),r=0===t.level?null:i.getId(t.level-1,t.row>>1,t.col>>1,t.world);return i.pool.release(t),r}getTileCoverage(e,t,i=!0,r){const s=super.getTileCoverage(e,t,i,r);if(!s)return s;const a=1<<s.lodInfo.level;return s.spans=s.spans.filter(e=>e.row>=0&&e.row<a),s}scaleToLevel(e){if(this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos),this._levelByScale[e])return this._levelByScale[e];{const t=this._fullCacheLodInfos;if(e>t[0].scale)return t[0].level;let i,r;for(let s=0;s<t.length-1;s++)if(r=t[s+1],e>r.scale)return i=t[s],i.level+(i.scale-e)/(i.scale-r.scale);return t[t.length-1].level}}_initializeFullCacheLODs(t){let i;if(0===t[0].level)i=t.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale}));else{const t=this.tileInfo.size[0],r=this.tileInfo.spatialReference;i=e.create({size:t,spatialReference:r}).lods.map(e=>({level:e.level,resolution:e.resolution,scale:e.scale}))}for(let e=0;e<i.length;e++)this._levelByScale[i[e].scale]=i[e].level;this._fullCacheLodInfos=i}}})},"esri/views/layers/RefreshableLayerView":function(){define(["exports","../../chunks/tslib.es6","../../core/Logger","../../core/promiseUtils","../../core/reactiveUtils","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/subclass"],function(e,t,i,r,s,a,n,o,l){"use strict";e.RefreshableLayerView=e=>{const a=e;let n=class extends a{initialize(){this.addHandles(s.on(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(e=>{r.isAbortError(e)||i.getLogger(this).error(e)})}),"RefreshableLayerView")}};return n=t.__decorate([l.subclass("esri.views.layers.RefreshableLayerView")],n),n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["../../../chunks/tslib.es6","../../../core/lang","../../../core/Logger","../../../core/maybe","../../../core/promiseUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/accessorSupport/decorators/subclass","../../../core/accessorSupport/diffUtils","../../../geometry/Point","../../../geometry/support/aaBoundingRect","../../../geometry/support/spatialReferenceUtils","../../../graphic/isVectorTileGraphicOrigin","../engine/vectorTiles/TileHandler","../engine/vectorTiles/TileManager","../engine/vectorTiles/VectorTile","../engine/vectorTiles/VectorTileContainer","../engine/vectorTiles/VectorTileFeatureIndex","../engine/vectorTiles/style/StyleRepository","./LayerView2D","../tiling/TileInfoViewPOT","../tiling/TileQueue","../../layers/LayerView","../../layers/RefreshableLayerView","../../support/Scheduler"],function(e,t,i,r,s,a,n,o,l,c,h,u,p,y,d,g,f,_,m,b,T,w,v,x,S){"use strict";let P=class extends(x.RefreshableLayerView(b.LayerView2DMixin(v))){constructor(){super(...arguments),this._styleChanges=[],this._fetchQueue=null,this._parseQueue=null,this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._styeChanged=!1,this._spriteSourceChanged=!1}get fading(){return this._vectorTileContainer?.fading??!1}get hasVisibleFeatures(){const e=this._vectorTileContainer.children;for(const t of e)if(t.hasFeatures())return!0;return!1}get spriteSourceChanged(){return this._spriteSourceChanged}get styleChanged(){return this._styeChanged}async hitTest(e,t){const i=this._tileHandlerPromise,r=this._vectorTileContainer?.symbolFader;if(!i||!this._isTileHandlerReady||!r)return;await i;let s=null;const a=this._vectorTileContainer?.symbolRepository;a&&(s=a.querySymbols(t,2,r.decluttererOffset,{}));const n=this.view.state,o=this._tileManager.getIntersectingTiles(t.x,t.y,2,n,s);if((!o||0===o.length)&&0===s?.length)return null;e=e.clone().normalize();const l=[],c=[];for(const t of o)l.push(this._queryTile(c,e,2,this.view.state.rotation,t,s?.filter(e=>e.tileKey.id===t.id)));return await Promise.all(l),c}update(e){if(this._tileHandlerPromise&&this._isTileHandlerReady)return e.pixelRatio!==this._tileHandler.devicePixelRatio?(this._tileHandler.devicePixelRatio=e.pixelRatio,void this._loadStyle()):void(this._styleChanges.length>0?this._tileHandlerPromise=this._applyStyleChanges():(this._pauseQueues(),this._fetchQueue.state=e.state,this._parseQueue.state=e.state,this._tileManager.update(e)||this.requestUpdate(),this._resumeQueues()))}attach(){const{style:e}=this.layer.currentStyleInfo;this._styleRepository=new m(e),this._tileInfoView=new T(this.layer.tileInfo,this.layer.fullExtent),this._vectorTileContainer=new f.VectorTileContainer(this._tileInfoView),this._tileHandler=new y.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1,this.layer.tileInfo.lods.length-1),this.container.addChild(this._vectorTileContainer),this._start(),this.addAttachHandles([this.layer.on("paint-change",e=>{if(this._styeChanged=!0,e.isDataDriven)this._styleChanges.push({type:0,data:e}),this.requestUpdate();else{const t=this._styleRepository,i=t.getLayerById(e.layer);if(!i)return;const r=3===i.type;t.setPaintProperties(e.layer,e.paint),r&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender()}}),this.layer.on("layout-change",e=>{const t=this._styleRepository,i=t.getLayerById(e.layer);if(!i)return;this._styeChanged=!0;const r=l.diff(i.layout,e.layout);if(null!=r){if(l.hasDiff(r,"visibility")&&1===function(e){if(null==e)return 0;switch(e.type){case"partial":return Object.keys(e.diff).length;case"complete":return Math.max(Object.keys(e.oldValue).length,Object.keys(e.newValue).length);case"collection":return Object.keys(e.added).length+Object.keys(e.changed).length+Object.keys(e.removed).length}}(r))return t.setLayoutProperties(e.layer,e.layout),3===i.type&&this._vectorTileContainer?.restartDeclutter(),void this._vectorTileContainer?.requestRender();this._styleChanges.push({type:1,data:e}),this.requestUpdate()}}),this.layer.on("style-layer-visibility-change",e=>{const t=this._styleRepository,i=t.getLayerById(e.layer);i&&(this._styeChanged=!0,t.setStyleLayerVisibility(e.layer,e.visibility),3===i.type&&this._vectorTileContainer?.restartDeclutter(),this._vectorTileContainer?.requestRender())}),this.layer.on("style-layer-change",e=>{this._styleChanges.push({type:2,data:e}),this._styeChanged=!0,this.requestUpdate()}),this.layer.on("delete-style-layer",e=>{this._styleChanges.push({type:3,data:e}),this._styeChanged=!0,this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",e=>{this._spriteSourceChanged=!0,this._styleChanges.push({type:4,data:e});const t=this._styleRepository.layers;for(const e of t)switch(e.type){case 3:e.getLayoutProperty("icon-image")&&this._styleChanges.push({type:1,data:{layer:e.id,layout:e.layout}});break;case 2:e.getPaintProperty("line-pattern")&&this._styleChanges.push({type:0,data:{layer:e.id,paint:e.paint,isDataDriven:e.isPainterDataDriven()}});break;case 1:e.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:0,data:{layer:e.id,paint:e.paint,isDataDriven:e.isPainterDataDriven()}})}this.requestUpdate()})])}detach(){this._stop(),this.container.removeAllChildren(),this._vectorTileContainer=r.destroyMaybe(this._vectorTileContainer),this._tileHandler=r.destroyMaybe(this._tileHandler)}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return u.equals(this.layer.tileInfo?.spatialReference,e)}canResume(){let e=super.canResume();const{currentStyleInfo:t}=this.layer;if(e&&t?.layerDefinition){const i=this.view.scale,{minScale:r,maxScale:s}=t.layerDefinition;t?.layerDefinition&&(r&&r<i&&(e=!1),s&&s>i&&(e=!1))}return e}isUpdating(){return this.fading}acquireTile(e){const t=this._createVectorTile(e);return this._updatingHandles.addPromise(this._fetchQueue.push(t.key).then(e=>this._parseQueue.push({key:t.key,data:e})).then(e=>{t.once("attach",()=>this.requestUpdate()),t.setData(e),this.requestUpdate()}).catch(e=>{s.isAbortError(e)||i.getLogger(this).error(e)})),t}releaseTile(e){const t=e.key.id;this._fetchQueue.abort(t),this._parseQueue.abort(t),this.requestUpdate()}async doRefresh(){if(!this.attached)return;if(this.suspended)return this._tileManager.clear(),void this.requestUpdate();this._isTileHandlerReady=!1,this._pauseQueues(),this._clearQueues(),this._tileManager.clearCache(),this._resumeQueues();const e=this._vectorTileContainer.children,t=[];try{for(const i of e){const e=this._updatingHandles.addPromise(this._fetchQueue.push(i.key).then(e=>this._parseQueue.push({key:i.key,data:e})).then(e=>i.setData(e)).finally(()=>i.featureIndex=null));t.push(e)}await Promise.all(t)}catch(e){i.getLogger(this).error("error refreshing vector-tiles layer-view",e),this._resumeQueues(),this._isTileHandlerReady=!0}this._isTileHandlerReady=!0,this.requestUpdate()}_start(){if(this._stop(),this._tileManager=new d.TileManager({acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView},this._vectorTileContainer),!this.layer.currentStyleInfo)return;const e=new AbortController,t=this._tileHandler.start({signal:e.signal}).then(()=>{this._fetchQueue=new w({tileInfoView:this._tileInfoView,process:(e,t)=>this._getTileData(e,t),concurrency:15,scheduler:this.scheduler,priority:S.TaskPriority.MAPVIEW_FETCH_QUEUE}),this._parseQueue=new w({tileInfoView:this._tileInfoView,process:(e,t)=>this._parseTileData(e,t),concurrency:8,scheduler:this.scheduler,priority:S.TaskPriority.MAPVIEW_VECTOR_TILE_PARSING_QUEUE}),this.requestUpdate(),this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(e=>{this._vectorTileContainer.setStyleResources(e,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView),this.requestUpdate()}),this._tileHandlerAbortController=e,this._tileHandlerPromise=t}_stop(){if(!this._tileHandlerAbortController||!this._vectorTileContainer)return;const e=this._tileHandlerAbortController;e&&e.abort(),this._tileHandlerPromise=null,this._isTileHandlerReady=!1,this._fetchQueue=r.destroyMaybe(this._fetchQueue),this._parseQueue=r.destroyMaybe(this._parseQueue),this._tileManager=r.destroyMaybe(this._tileManager),this._vectorTileContainer.removeAllChildren()}async _getTileData(e,t){return this._tileHandler.fetchTileData(e,t)}async _parseTileData(e,t){return this._tileHandler.parseTileData(e,t)}async _applyStyleChanges(){this._isTileHandlerReady=!1,this._pauseQueues(),this._clearQueues(),this._tileManager.clearCache();const e=this._styleChanges;try{await this._tileHandler.updateStyle(e)}catch(e){i.getLogger(this).error("error applying vector-tiles style update",e.message),this._resumeQueues(),this._isTileHandlerReady=!0}const t=this._styleRepository,r=new Set;e.forEach(e=>{if(3!==e.type)return;const i=e.data,s=t.getLayerById(i.layer);s&&r.add(s.uid)});const s=new Set;e.forEach(e=>{let i;switch(e.type){case 0:t.setPaintProperties(e.data.layer,e.data.paint),i=e.data.layer;break;case 1:t.setLayoutProperties(e.data.layer,e.data.layout),i=e.data.layer;break;case 3:return void t.deleteStyleLayer(e.data.layer);case 2:t.setStyleLayer(e.data.layer,e.data.index),i=e.data.layer.id;break;case 4:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(e.data.spriteSource))}if(i){const e=t.getLayerById(i);e&&s.add(e.uid)}});const a=this._vectorTileContainer.children;if(r.size>0){const e=Array.from(r);this._vectorTileContainer.deleteStyleLayers(e);for(const t of a)t.deleteLayerData(e)}if(this._resumeQueues(),s.size>0){const e=Array.from(s),t=[];for(const i of a){const r=this._updatingHandles.addPromise(this._fetchQueue.push(i.key).then(t=>this._parseQueue.push({key:i.key,data:t,styleLayerUIDs:e})).then(e=>i.setData(e)).finally(()=>i.featureIndex=null));t.push(r)}await Promise.all(t)}this._styleChanges=[],this._isTileHandlerReady=!0,this.requestUpdate()}async _loadStyle(){const{style:e}=this.layer.currentStyleInfo,i=t.clone(e);this._isTileHandlerReady=!1,this._pauseQueues(),this._clearQueues(),this._styleRepository=new m(i),this._vectorTileContainer.destroy(),this._tileManager.clear(),this._tileHandlerAbortController.abort(),this._tileHandlerAbortController=new AbortController;const{signal:r}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,i,this.layer.tileInfo.lods.length-1),await this._tileHandlerPromise}catch(e){if(!s.isAbortError(e))throw e}if(r.aborted)return this._resumeQueues(),this._isTileHandlerReady=!0,this._styeChanged=!1,this._spriteSourceChanged=!1,void this.requestUpdate();const a=await this._tileHandler.spriteMosaic,n=this._vectorTileContainer;this._tileInfoView=new T(this.layer.tileInfo,this.layer.fullExtent),n.setStyleResources(a,this._tileHandler.glyphMosaic,this._styleRepository,this._tileInfoView),this._tileManager=new d.TileManager({acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView},this._vectorTileContainer),this._resumeQueues(),this._isTileHandlerReady=!0,this.requestUpdate(),this._styeChanged=!1,this._spriteSourceChanged=!1}_createVectorTile(e){const t=this._tileInfoView.getTileBounds(h.create(),e),i=this._tileInfoView.getTileResolution(e.level);return new g.VectorTile(e,i,t[0],t[3],512,512,this._styleRepository)}async _queryTile(e,t,i,r,s,a){if(0===s.layerData.size)return;const n=this._ensureTileIndex(s),o=this._tileInfoView.getTileBounds(h.create(),s.key,!0),l=(t.x-o[0])/(o[2]-o[0])*4096,c=4096*(1-(t.y-o[1])/(o[3]-o[1])),u=await n.queryAttributes(l,c,i,r,a);for(const i of u)i.graphic.geometry=this._tileToMapPoint(i.tilePoint,s.transforms.tileUnitsToPixels),e.push({type:"graphic",layer:this.layer,graphic:i.graphic,mapPoint:t.clone()});e.sort((e,t)=>(p.isVectorTileGraphicOrigin(t.graphic.origin)?t.graphic.origin.layerIndex:0)-(p.isVectorTileGraphicOrigin(e.graphic.origin)?e.graphic.origin.layerIndex:0))}_tileToMapPoint(e,t){if(!e)return null;const i=e[0]*t[0]+e[1]*t[3]+t[6],r=e[0]*t[1]+e[1]*t[4]+t[7],s=this.view.state,a=[0,0];return s.toMap(a,[i,r]),new c({x:a[0],y:a[1],spatialReference:s.spatialReference})}_ensureTileIndex(e){let t=e.featureIndex;return t||(t=_.create(e.key,e.layerData,this._styleRepository,this._tileHandler,this.layer),e.featureIndex=t),t}_pauseQueues(){this._fetchQueue.pause(),this._parseQueue.pause()}_resumeQueues(){this._fetchQueue.resume(),this._parseQueue.resume()}_clearQueues(){this._fetchQueue.clear(),this._parseQueue.clear()}};return e.__decorate([a.property()],P.prototype,"_isTileHandlerReady",void 0),P=e.__decorate([o.subclass("esri.views.2d.layers.VectorTileLayerView2D")],P),P});