// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/promiseUtils","../../../../core/QueueProcessor","./UpdateTracking2D"],function(e,r,s,t){"use strict";class i{constructor(){this.type="override-batch",this.messages=[],this._resovler=r.createResolver()}get promise(){return this._resovler.promise}resolve(){this._resovler.resolve()}add(e){this.messages.push(e)}}e.FeatureCommandQueue=class{constructor(e){this.updateTracking=new t.UpdateTracking2D({debugName:"FeatureCommandQueue"}),this.process=e.process,this._queueProcessor=new s.QueueProcessor({concurrency:1,process:async e=>{if("override-batch"===e.type){const e=this._nextOverrideBatch;if(null==e)throw new Error("InternalError: Override should be defined");return this._nextOverrideBatch=null,await this.process(e),void e.resolve()}return this.process(e)}})}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear()}clear(){this._queueProcessor.clear()}async push(e){return r.ignoreAbortErrors(this.updateTracking.addPromise(this._doPush(e)))}async _doPush(e){const r=this._queueProcessor,s=r.last();switch(e.type){case"update":case"highlight":if(s?.type===e.type)return;return r.push(e);case"override":case"edit":return this._pushOverride(e)}}_pushOverride(e){return null==this._nextOverrideBatch&&(this._nextOverrideBatch=new i,this._queueProcessor.push(this._nextOverrideBatch)),this._nextOverrideBatch.add(e),this._nextOverrideBatch.promise}},e.OverrideBatch=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});