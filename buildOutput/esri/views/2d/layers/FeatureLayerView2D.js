// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
require({cache:{"esri/AggregateGraphic":function(){define(["./chunks/tslib.es6","./Graphic","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/RandomLCG","./core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n){"use strict";let o=class extends t{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.sourceLayer?.featureReduction;return t&&"popupTemplate"in t&&t.popupEnabled?t.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};return e.__decorate([r.property({type:Boolean})],o.prototype,"isAggregate",void 0),o=e.__decorate([n.subclass("esri.AggregateGraphic")],o),o})},"esri/TrackGraphic":function(){define(["./chunks/tslib.es6","./Graphic","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/RandomLCG","./core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n){"use strict";let o=class extends t{constructor(){super(...arguments),this.isAggregate=!0}getEffectivePopupTemplate(e=!1){if(this.popupTemplate)return this.popupTemplate;const t=this.sourceLayer?.trackInfo;return t?.enabled&&t.popupEnabled?t.popupTemplate:null}getObjectId(){return this.attributes.aggregateId}};return e.__decorate([r.property({type:Boolean})],o.prototype,"isAggregate",void 0),o=e.__decorate([n.subclass("esri.TrackGraphic")],o),o})},"esri/layers/effects/FeatureEffectView":function(){define(["exports","../../chunks/tslib.es6","../../core/Accessor","../../core/has","../../core/accessorSupport/decorators/property","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","./EffectView"],function(e,t,r,i,s,a,n,o,l){"use strict";return e.default=class extends r{constructor(e){super(e),this._filter=null,this.duration=i("mapview-transitions-duration"),this._excludedEffectView=new l.EffectView(e),this._includedEffectView=new l.EffectView(e)}get excludedEffects(){return this._excludedEffectView.effects}set featureEffect(e){this._get("featureEffect")!==e&&this._transitionTo(e)}get filter(){return this._filter||this.featureEffect?.filter||null}get hasEffects(){return this._excludedEffectView.hasEffects||this._includedEffectView.hasEffects}get includedEffects(){return this._includedEffectView.effects}set scale(e){this._set("scale",e),this._excludedEffectView.scale=e,this._includedEffectView.scale=e}get transitioning(){return this._excludedEffectView.transitioning||this._includedEffectView.transitioning}get transitioningToEmpty(){return!this._excludedEffectView.final&&!this._includedEffectView.final}transitionStep(e,t){this._set("scale",t),this.transitioning?(this._includedEffectView.transitionStep(e,t),this._excludedEffectView.transitionStep(e,t),this.transitioning||(this._filter=null)):(this._excludedEffectView.scale=t,this._includedEffectView.scale=t)}endTransition(){this._includedEffectView.endTransition(),this._excludedEffectView.endTransition(),this._filter=null}_transitionTo(e){const t=this._get("featureEffect"),r=e,i=r?.includedEffect,s=r?.excludedEffect,a=this._includedEffectView.canTransitionTo(i)&&this._excludedEffectView.canTransitionTo(s);this._includedEffectView.effect=i,this._excludedEffectView.effect=s,this._set("featureEffect",r),this._filter=r?.filter||t?.filter||null,a||this.endTransition()}},t.__decorate([s.property()],e.default.prototype,"_filter",void 0),t.__decorate([s.property()],e.default.prototype,"_excludedEffectView",void 0),t.__decorate([s.property()],e.default.prototype,"_includedEffectView",void 0),t.__decorate([s.property()],e.default.prototype,"duration",void 0),t.__decorate([s.property()],e.default.prototype,"excludedEffects",null),t.__decorate([s.property()],e.default.prototype,"featureEffect",null),t.__decorate([s.property()],e.default.prototype,"filter",null),t.__decorate([s.property()],e.default.prototype,"hasEffects",null),t.__decorate([s.property()],e.default.prototype,"includedEffects",null),t.__decorate([s.property({value:0})],e.default.prototype,"scale",null),t.__decorate([s.property()],e.default.prototype,"transitioning",null),t.__decorate([s.property()],e.default.prototype,"transitioningToEmpty",null),e.default=t.__decorate([o.subclass("esri.layers.effects.FeatureEffectView")],e.default),e.default})},"esri/layers/support/timeSupport":function(){define(["exports","../../support/timeUtils"],function(e,t){"use strict";e.combineTimeExtent=function(e,r,i){if(null==e?.timeInfo)return null;const{datesInUnknownTimezone:s=!1,timeOffset:a,useViewTime:n}=e;let o=e.timeExtent;s&&(o=t.toLocalTimeExtent(o));let l=n?r&&o?r.intersection(o):r||o:o;return!l||l.isEmpty||l.isAllTime?l:(a&&(l=l.offset(-a.value,a.unit)),s&&(l=t.toUTCTimeExtent(l)),l.equals(i)?i:l)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/timeUtils":function(){define(["exports","../core/arrayUtils","../core/lang","../core/timeUtils","../chunks/TimeExtent","../webmap/utils","../webscene/utils"],function(e,t,r,i,s,a,n){"use strict";function o(e){return void 0!==e.timeInfo}async function l(e,r){if(0===e.length)return s.TimeExtent.allTime;await Promise.all(e.map(e=>e.load({signal:r})));const i=e.filter(o),a=e.filter(e=>!o(e)&&null!=e.visibilityTimeExtent);if(0===i.length&&0===a.length)return s.TimeExtent.allTime;const n=[],l=[];for(const e of i)"feature"!==e?.type&&"map-image"!==e?.type||!e.timeInfo?.hasLiveData?l.push(e):n.push(e);const u=e=>null==e||e.isAllTime,c=[...l.map(e=>{const t=e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:r}=e;return t?.intersection(r)??r}),...a.map(e=>e.visibilityTimeExtent)];if(c.some(u))return s.TimeExtent.allTime;const d=n.map(async e=>{const t=(await e.fetchRecomputedExtents({signal:r}))?.timeExtent??e.timeInfo?.fullTimeExtent,{visibilityTimeExtent:i}=e;return t?.intersection(i)??i}),p=(await Promise.allSettled(d)).map(e=>"fulfilled"===e.status?e.value:null);if(p.some(u))return s.TimeExtent.allTime;const f=[...p,...c].filter(t.isSome);return 0===f.length?s.TimeExtent.allTime:f.reduce((e,t)=>e.union(t))}e.getTimeExtentFromLayers=l,e.getTimeSliderSettingsFromWebDocument=async function(e,t){if(!a.isWebMap(e)&&!n.isWebScene(e))return null;await e.load({signal:t});const i=e?.widgets?.timeSlider;if(!i)return null;const o=await async function(e,t){return e.widgets?.timeSlider?.fullTimeExtent??l(e.allLayers,t)}(e,t),u=i.loop,c=function(e){const t=e.numThumbs??2,r=e.currentTimeExtent;if(r){const{start:e,end:i}=r;return null!=e&&null!=i&&e.getTime()===i.getTime()?"instant":2===t?"time-window":null==e||0===e.getTime()?"cumulative-from-start":"cumulative-from-end"}return 2===t?"time-window":"cumulative-from-start"}(i),d=i.stopDelay??2e3,p=function(e){const{numStops:t,stopInterval:i,stops:s}=e;return s?{dates:r.clone(s)}:i?{interval:i.clone()}:{count:t??5}}(i),f=function(e,t){const r=e.currentTimeExtent;if(!r)return null;const{start:i,end:a}=r,n=i??a??null;switch(t){case"time-window":return new s.TimeExtent({start:i,end:a});case"cumulative-from-start":return new s.TimeExtent({start:null,end:n});case"cumulative-from-end":return new s.TimeExtent({start:n,end:null});case"instant":return new s.TimeExtent({start:n,end:n})}}(i,c);return{fullTimeExtent:o,loop:u,mode:c,playRate:d,stops:p,timeExtent:f}},e.toLocalTimeExtent=function(e){if(!e)return e;const{start:t,end:r}=e;return new s.TimeExtent({start:null!=t?i.offsetDate(t,t.getTimezoneOffset(),"minutes"):t,end:null!=r?i.offsetDate(r,r.getTimezoneOffset(),"minutes"):r})},e.toUTCTimeExtent=function(e){if(!e)return e;const{start:t,end:r}=e;return new s.TimeExtent({start:null!=t?i.offsetDate(t,-t.getTimezoneOffset(),"minutes"):t,end:null!=r?i.offsetDate(r,-r.getTimezoneOffset(),"minutes"):r})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/utils":function(){define(["exports","../support/tagSymbols"],function(e,t){"use strict";e.isWebScene=function(e){return null!=e&&"object"==typeof e&&t.WebSceneTag in e},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/support/tagSymbols":function(){define(["exports"],function(e){"use strict";const t=Symbol("WebScene");e.WebSceneTag=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/AggregateFeatureSet":function(){define(["exports","../../chunks/tslib.es6","../../AggregateGraphic","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","../../geometry/SpatialReference","./FeatureSet"],function(e,t,r,i,s,a,n,o,l,u,c){"use strict";return e.default=class extends c{constructor(){super(...arguments),this.features=[]}readFeatures(e,t){const i=u.fromJSON(t.spatialReference),s=[];for(let t=0;t<e.length;t++){const a=e[t],n=r.fromJSON(a),o=a.geometry?.spatialReference;null==n.geometry||o||(n.geometry.spatialReference=i);const l=a.aggregateGeometries,u=n.aggregateGeometries;if(l&&null!=u)for(const e in u){const t=u[e],r=l[e],s=r?.spatialReference;null==t||s||(t.spatialReference=i)}s.push(n)}return s}},t.__decorate([i.property({type:[r],json:{write:!0}})],e.default.prototype,"features",void 0),t.__decorate([o.reader("features")],e.default.prototype,"readFeatures",null),e.default=t.__decorate([l.subclass("esri.rest.support.AggregateFeatureSet")],e.default),e.default})},"esri/rest/support/AttributeBinsFeatureSet":function(){define(["exports","../../chunks/tslib.es6","../../AttributeBinsGraphic","../../core/Clonable","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/reader","../../core/accessorSupport/decorators/subclass","./FeatureSet"],function(e,t,r,i,s,a,n,o,l,u,c){"use strict";return e.default=class extends(i.ClonableMixin(c)){constructor(e){super(e),this.features=[]}readFeatures(e,t){return this.readFeaturesWithClass(e,t,r)}},t.__decorate([s.property({type:[r],json:{write:!0}})],e.default.prototype,"features",void 0),t.__decorate([l.reader("features")],e.default.prototype,"readFeatures",null),e.default=t.__decorate([u.subclass("esri.rest.support.AttributeBinsFeatureSet")],e.default),e.default})},"esri/AttributeBinsGraphic":function(){define(["exports","./chunks/tslib.es6","./Graphic","./core/Clonable","./core/lang","./core/accessorSupport/decorators/property","./core/has","./core/Logger","./core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n,o,l){"use strict";var u;return e.default=class extends(i.ClonableMixin(r)){static{u=this}constructor(e){super(e),this.stackedAttributes=null}cloneShallow(){return new u(Object.assign({stackedAttributes:this.stackedAttributes},super.cloneShallow()))}toJSON(){return{...super.toJSON(),stackedAttributes:s.clone(this.stackedAttributes)}}},t.__decorate([a.property()],e.default.prototype,"stackedAttributes",void 0),e.default=u=t.__decorate([l.subclass("esri.AttributeBinsGraphic")],e.default),e.default})},"esri/rest/support/AttributeBinsQuery":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/Logger","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","../../geometry/SpatialReference","../../geometry/support/jsonUtils","../../geometry/support/typeUtils","../../layers/graphics/data/queryUtils","./AutoIntervalBinParameters","./BinParametersBase","./DateBinParameters","./FixedBoundariesBinParameters","./FixedIntervalBinParameters","./spatialRelationships","./StatisticDefinition","../../chunks/TimeExtent","../../time/timeZoneUtils"],function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g,m,b,_,w,S,v,F,I){"use strict";const x=new i.JSONMap({asc:"ascending",desc:"descending"}),V={base:m,key:"type",typeMap:{"auto-interval":g,date:b,"fixed-boundaries":_,"fixed-interval":w}};return e.default=class extends(r.ClonableMixin(s.JSONSupport)){constructor(e){super(e),this.binParameters=null,this.binOrder="ascending",this.cacheHint=void 0,this.datumTransformation=null,this.defaultSpatialReference=null,this.distance=void 0,this.geometry=null,this.lowerBoundaryAlias=null,this.outSpatialReference=null,this.outStatistics=null,this.returnDistinctValues=null,this.spatialRelationship="intersects",this.timeExtent=null,this.upperBoundaryAlias=null,this.units=null,this.where="1=1"}set outTimeZone(e){this._set("outTimeZone",e),e&&!I.isTimeZoneValid(e)&&a.getLogger(this).warn("#outTimeZone",`the parsed value '${e}' may not be a valid IANA time zone`)}},t.__decorate([n.property({types:V,json:{name:"bin",write:!0}})],e.default.prototype,"binParameters",void 0),t.__decorate([c.enumeration(x)],e.default.prototype,"binOrder",void 0),t.__decorate([n.property({type:Boolean,json:{write:!0}})],e.default.prototype,"cacheHint",void 0),t.__decorate([n.property({json:{write:!0}})],e.default.prototype,"datumTransformation",void 0),t.__decorate([n.property({type:p,json:{name:"defaultSR",write:!0}})],e.default.prototype,"defaultSpatialReference",void 0),t.__decorate([n.property({type:Number,json:{write:{overridePolicy:e=>({enabled:e>0})}}})],e.default.prototype,"distance",void 0),t.__decorate([n.property({types:y.geometryTypes,json:{read:f.fromJSON,write:!0}})],e.default.prototype,"geometry",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"lowerBoundaryAlias",void 0),t.__decorate([n.property({type:p,json:{name:"outSR",write:!0}})],e.default.prototype,"outSpatialReference",void 0),t.__decorate([n.property({type:[v],json:{write:{enabled:!0,overridePolicy(){return{enabled:null!=this.outStatistics&&this.outStatistics.length>0}}}}})],e.default.prototype,"outStatistics",void 0),t.__decorate([n.property({value:null,json:{name:"outTimeReference",read:{reader:e=>e.ianaTimeZone},write:{writer:(e,t,r)=>{e&&(t[r]={ianaTimeZone:e})}}}})],e.default.prototype,"outTimeZone",null),t.__decorate([n.property({type:Boolean,json:{write:!0}})],e.default.prototype,"returnDistinctValues",void 0),t.__decorate([c.enumeration(S.spatialRelKebabDict,{name:"spatialRel"})],e.default.prototype,"spatialRelationship",void 0),t.__decorate([n.property({type:F.TimeExtent,json:{write:!0}})],e.default.prototype,"timeExtent",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"upperBoundaryAlias",void 0),t.__decorate([n.property({type:String,json:{read:h.unitsKebabDict.read,write:{writer:h.unitsKebabDict.write,overridePolicy(e){return{enabled:null!=e&&null!=this.distance}}}}})],e.default.prototype,"units",void 0),t.__decorate([n.property({type:String,json:{write:!0}})],e.default.prototype,"where",void 0),e.default=t.__decorate([d.subclass("esri.rest.support.AttributeBinsQuery")],e.default),e.default.from=o.ensureType(e.default),e.default})},"esri/rest/support/AutoIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,i,s,a,n,o,l,u,c){"use strict";function d(e,t,i){r.setDeepValue(i,e instanceof Date?e.getTime():e,t)}return e.default=class extends(c.NormalizationBinParametersMixin(u)){constructor(e){super(e),this.numBins=null,this.end=null,this.start=null,this.type="auto-interval"}},t.__decorate([i.property({type:Number,json:{name:"parameters.numberOfBins",write:!0}})],e.default.prototype,"numBins",void 0),t.__decorate([i.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([o.enumeration({autoIntervalBin:"auto-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.AutoIntervalBinParameters")],e.default),e.default.from=s.ensureType(e.default),e.default})},"esri/rest/support/BinParametersBase":function(){define(["exports","../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./AttributeBinsGrouping"],function(e,t,r,i,s,a,n,o,l,u,c,d){"use strict";const p=new i.JSONMap({esriFieldTypeSmallInteger:"small-integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"single",esriFieldTypeDouble:"double",esriFieldTypeLong:"long",esriFieldTypeDate:"date",esriFieldTypeDateOnly:"date-only",esriFieldTypeTimeOnly:"time-only",esriFieldTypeTimestampOffset:"timestamp-offset"}),f=new i.JSONMap({naturalLog:"natural-log",squareRoot:"square-root"});return e.default=class extends(r.ClonableMixin(s.JSONSupport)){constructor(e){super(e),this.expression=null,this.expressionValueType=null,this.field=null,this.firstDayOfWeek=null,this.hideUpperBound=null,this.splitBy=null,this.stackBy=null,this.transformation=null}},t.__decorate([a.property({type:String,json:{name:"onExpression.value",write:!0}})],e.default.prototype,"expression",void 0),t.__decorate([u.enumeration(p,{name:"onExpression.valueType"})],e.default.prototype,"expressionValueType",void 0),t.__decorate([a.property({type:String,json:{name:"onField",write:!0}})],e.default.prototype,"field",void 0),t.__decorate([a.property({type:String,json:{write:!0}})],e.default.prototype,"firstDayOfWeek",void 0),t.__decorate([a.property({type:String,json:{write:!0}})],e.default.prototype,"hideUpperBound",void 0),t.__decorate([a.property({type:d,json:{write:{overridePolicy(){return{enabled:null!=this.splitBy?.value||null!=this.splitBy?.type}}}}})],e.default.prototype,"splitBy",void 0),t.__decorate([a.property({type:d,json:{write:{target:{stackBy:{type:d},jsonStyle:{type:String}},writer:(e,t)=>{e&&(t.stackBy=e.toJSON(),null!=e.responseType&&(t.jsonStyle=e.responseType))},overridePolicy(){return{enabled:null!=this.stackBy?.value||null!=this.stackBy?.type}}},read:{source:["stackBy","jsonStyle"],reader:(e,t)=>d.fromJSON({...t.stackBy,responseType:t.jsonStyle})}}})],e.default.prototype,"stackBy",void 0),t.__decorate([u.enumeration(f)],e.default.prototype,"transformation",void 0),e.default=t.__decorate([c.subclass("esri.rest.support.BinParametersBase")],e.default),e.default})},"esri/rest/support/AttributeBinsGrouping":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/jsonMap","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n,o,l,u){"use strict";const c=new r.JSONMap({esriFieldTypeInteger:"integer",esriFieldTypeString:"string"});let d=class extends(t.ClonableMixin(i.JSONSupport)){constructor(e){super(e),this.alias=null,this.responseType=null,this.type=null,this.value=null,this.valueType=null}};e.__decorate([s.property({type:String,json:{name:"outAlias",write:!0}})],d.prototype,"alias",void 0),e.__decorate([s.property({type:String})],d.prototype,"responseType",void 0),e.__decorate([s.property({type:String,json:{write:!0}})],d.prototype,"type",void 0),e.__decorate([s.property({type:String,json:{write:!0}})],d.prototype,"value",void 0),e.__decorate([l.enumeration(c)],d.prototype,"valueType",void 0),d=e.__decorate([u.subclass("esri.rest.support.AttributeBinsGrouping")],d);const p=d;return d.from=a.ensureType(d),p})},"esri/rest/support/DateBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./DateBinTimeInterval"],function(e,t,r,i,s,a,n,o,l,u,c){"use strict";function d(e,t,i){r.setDeepValue(i,"string"==typeof e?e:e?.getTime(),t)}function p(e,t){const r=e.parameters[t];return r?"string"==typeof r?r:new Date(r):null}return e.default=class extends u{constructor(e){super(e),this.end=null,this.interval=null,this.offset=null,this.returnFullIntervalBin=!1,this.start=null,this.snapToData=null,this.type="date"}},t.__decorate([i.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.end",read:{reader:(e,t)=>p(t,"end")},write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({type:c,json:{name:"parameters",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([i.property({type:c,json:{name:"parameters.offset",write:!0}})],e.default.prototype,"offset",void 0),t.__decorate([i.property({type:Boolean,json:{name:"parameters.returnFullIntervalBin",write:!0}})],e.default.prototype,"returnFullIntervalBin",void 0),t.__decorate([i.property({cast:e=>null!=e?"string"==typeof e?e:new Date(e):null,json:{name:"parameters.start",read:{reader:(e,t)=>p(t,"start")},write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([i.property({type:String,json:{name:"parameters.snapToData",write:!0}})],e.default.prototype,"snapToData",void 0),t.__decorate([o.enumeration({dateBin:"date"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.DateBinParameters")],e.default),e.default.from=s.ensureType(e.default),e.default})},"esri/rest/support/DateBinTimeInterval":function(){define(["../../chunks/tslib.es6","../../core/Clonable","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./DateBinUtils"],function(e,t,r,i,s,a,n,o,l,u){"use strict";let c=class extends(t.ClonableMixin(r.JSONSupport)){constructor(e){super(e),this.value=null,this.unit=null}};e.__decorate([i.property({type:Number,json:{name:"number",write:!0}})],c.prototype,"value",void 0),e.__decorate([o.enumeration(u.unitsDict)],c.prototype,"unit",void 0),c=e.__decorate([l.subclass("esri.rest.support.DateBinTimeInterval")],c);const d=c;return c.from=s.ensureType(c),d})},"esri/rest/support/DateBinUtils":function(){define(["exports","../../core/jsonMap"],function(e,t){"use strict";const r=t.strict()({year:"years",quarter:"quarters",month:"months",week:"weeks",day:"days",hour:"hours",minute:"minutes",second:"seconds"});e.unitsDict=r,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/FixedBoundariesBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase"],function(e,t,r,i,s,a,n,o,l,u){"use strict";return e.default=class extends u{constructor(e){super(e),this.boundaries=[],this.type="fixed-boundaries"}},t.__decorate([i.property({json:{name:"parameters.boundaries",write:{writer:function(e,t,i){r.setDeepValue(i,e&&e[0]instanceof Date?e.map(e=>e.getTime()):e,t)}}}})],e.default.prototype,"boundaries",void 0),t.__decorate([o.enumeration({fixedBoundariesBin:"fixed-boundaries"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedBoundariesBinParameters")],e.default),e.default.from=s.ensureType(e.default),e.default})},"esri/rest/support/FixedIntervalBinParameters":function(){define(["exports","../../chunks/tslib.es6","../../core/object","../../core/accessorSupport/decorators/property","../../core/accessorSupport/ensureType","../../core/has","../../core/RandomLCG","../../core/accessorSupport/decorators/enumeration","../../core/accessorSupport/decorators/subclass","./BinParametersBase","./NormalizationBinParametersMixin"],function(e,t,r,i,s,a,n,o,l,u,c){"use strict";function d(e,t,i){r.setDeepValue(i,e instanceof Date?e.getTime():e,t)}return e.default=class extends(c.NormalizationBinParametersMixin(u)){constructor(e){super(e),this.end=null,this.interval=null,this.start=null,this.type="fixed-interval"}},t.__decorate([i.property({json:{name:"parameters.end",write:{writer:d}}})],e.default.prototype,"end",void 0),t.__decorate([i.property({type:Number,json:{name:"parameters.interval",write:!0}})],e.default.prototype,"interval",void 0),t.__decorate([i.property({json:{name:"parameters.start",write:{writer:d}}})],e.default.prototype,"start",void 0),t.__decorate([o.enumeration({fixedIntervalBin:"fixed-interval"},{readOnly:!0})],e.default.prototype,"type",void 0),e.default=t.__decorate([l.subclass("esri.rest.support.FixedIntervalBinParameters")],e.default),e.default.from=s.ensureType(e.default),e.default})},"esri/views/2d/layers/LayerView2D":function(){define(["exports","../../../chunks/tslib.es6","../../../core/Collection","../../../core/collectionUtils","../../../core/Error","../../../core/reactiveUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../linkChart/utils","../engine/Container","./support/HighlightCounter","./support/util","../support/highlightOptionsUtils","../../layers/support/ClipRect","../../layers/support/Geometry","../../layers/support/Path","../../support/HighlightOptions","../../support/layerViewUtils"],function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g,m,b,_,w){"use strict";const S=r.ofType({key:"type",base:null,typeMap:{rect:g,path:b,geometry:m}}),v=new(r.ofType(_));e.LayerView2DMixin=e=>{const o=e;let l=class extends o{constructor(){super(...arguments),this._highlightCounter=new f.HighlightCounter,this.attached=!1,this.clips=new S,this.highlights=null,this.lastUpdateId=-1,this.moving=!1,this.updateRequested=!1,this._visibleAtCurrentScale=!0}initialize(){const e=this.view?.spatialReferenceLocked??!0,t=this.view?.spatialReference;t&&e&&!this.spatialReferenceSupported?this.addResolvingPromise(Promise.reject(new s("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new p.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([a.watch(()=>this.suspended,e=>{this.container&&(this.container.visible=!e)},a.syncAndInitial),a.watch(()=>this.updateSuspended,e=>{this.view&&!e&&this.updateRequested&&this.view.requestUpdate()},a.syncAndInitial),a.watch(()=>this.layer?.opacity??1,e=>{this.container&&(this.container.opacity=e)},a.syncAndInitial),a.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",e=>{this.container&&(this.container.blendMode=e)},a.syncAndInitial),a.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,e=>{this.container&&(this.container.effect=e)},a.syncAndInitial),a.watch(()=>this._mergedHighlights.items.map(e=>({name:e.name,options:{fillColor:e.color,haloColor:e.haloColor,fillOpacity:e.fillOpacity,haloOpacity:e.haloOpacity,haloWidth:e.haloWidth,haloBlur:e.haloBlur}})),()=>{this.container.highlightGradient=y.createOrReuseHighlightGradient(this.container.highlightGradient,this._mergedHighlights.items)},a.syncAndInitial),a.watch(()=>this._mergedHighlights.items.map(e=>e.name),()=>{this._processHighlight()}),a.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)},a.syncAndInitial),a.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:e,scaleRange:t})=>{const r=w.isInEffectiveScaleRange(t,e);r!==this._visibleAtCurrentScale&&(this._visibleAtCurrentScale=r)},a.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(e=>{e===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))}destroy(){this.processDetach(),this.updateRequested=!1}get highlightOptions(){return h.getDefaultHighlightOptions(this)}set highlightOptions(e){h.setDefaultHighlightOptions(this,e)}get hasHighlight(){return this._highlightCounter.size>0}get _mergedHighlights(){if(!this.view)return v;if(!this.highlights)return this.view.highlights;const e=this.view.highlights.clone();for(const t of this.highlights){const r=e.find(e=>e.name===t.name);r&&r.assignFrom(t)}return e}get highlightIds(){return Array.from(this._highlightCounter.objectIds)}get scheduler(){return this.view.scheduler}get spatialReferenceSupported(){const e=this.view?.spatialReference;return null==e||this.supportsSpatialReference(e)}get updating(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this._updatingHandles?.updating||this.container.transitioning)}get visibleAtCurrentScale(){return this._visibleAtCurrentScale}processAttach(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())}processDetach(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)}requestUpdate(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.updateSuspended||this.view.requestUpdate())}processUpdate(e){!this.isFulfilled()||this.isResolved()?(this._set("updateParameters",e),this.updateRequested&&!this.updateSuspended&&(this.updateRequested=!1,this.update(e))):this.updateRequested=!1}hitTest(e,t){return Promise.resolve(null)}supportsSpatialReference(e){return!0}canResume(){if(!this.spatialReferenceSupported)return!1;switch(this.layer?.type){case"link-chart":case"knowledge-graph-sublayer":case"graphics":break;default:if(d.isLinkChartView(this.view)&&!this.view.inGeographicLayout)return!1}return!!super.canResume()&&this.visibleAtCurrentScale}getSuspendInfo(){const e=super.getSuspendInfo(),t=!this.spatialReferenceSupported;return t&&(e.spatialReferenceNotSupported=t),e}addAttachHandles(e){this.addHandles(e,"attach")}_addHighlights(e,t){this._highlightCounter.add(e,t)&&this._processHighlight()}_removeHighlights(e,t){this._highlightCounter.delete(e,t)&&this._processHighlight()}_processHighlight(){}_getHighlights(){const e=[];for(const[t,r]of this._highlightCounter.highlightNamesByObjectId){const i=this._getHighlightBits(r);e.push({objectId:t,highlightFlags:i})}return e}_getHighlightBits(e){const t=new Set(e);let r=1,i=0;if(!this.view)return 0;const s=this._mergedHighlights;for(const{name:e}of s)t.delete(e)&&(i=r),r<<=1;return i}};return t.__decorate([n.property()],l.prototype,"attached",void 0),t.__decorate([n.property({type:S,set(e){const t=i.referenceSetter(e,this._get("clips"),S);this._set("clips",t)}})],l.prototype,"clips",void 0),t.__decorate([n.property()],l.prototype,"container",void 0),t.__decorate([n.property({type:_})],l.prototype,"highlightOptions",null),t.__decorate([n.property({type:r.ofType(_)})],l.prototype,"highlights",void 0),t.__decorate([n.property()],l.prototype,"_mergedHighlights",null),t.__decorate([n.property()],l.prototype,"moving",void 0),t.__decorate([n.property({readOnly:!0})],l.prototype,"spatialReferenceSupported",null),t.__decorate([n.property({readOnly:!0})],l.prototype,"updateParameters",void 0),t.__decorate([n.property()],l.prototype,"updateRequested",void 0),t.__decorate([n.property()],l.prototype,"updating",null),t.__decorate([n.property()],l.prototype,"view",void 0),t.__decorate([n.property()],l.prototype,"_visibleAtCurrentScale",void 0),t.__decorate([n.property({readOnly:!0})],l.prototype,"visibleAtCurrentScale",null),l=t.__decorate([c.subclass("esri.views.2d.layers.LayerView2D")],l),l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/linkChart/utils":function(){define(["exports"],function(e){"use strict";e.isLinkChartView=function(e){return null!=e&&"object"==typeof e&&"2d"===e.type&&"linkchart"===e.view2dType},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/HighlightCounter":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/MapUtils","../../../../core/ReactiveMap","../../../../core/Logger","../../../../core/has","../../../../core/RandomLCG","../../../../core/Error","../../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n,o,l,u){"use strict";e.HighlightCounter=class extends r{constructor(){super(...arguments),this._idToCounters=new s}get size(){return this._idToCounters.size}get objectIds(){return this._idToCounters.keys()}get highlightNamesByObjectId(){return function*(e){for(const[t,r]of e)yield[t,r.keys()]}(this._idToCounters)}add(e,t){let r=!1;for(const s of e){const e=i.getOrCreateMapValue(this._idToCounters,s,()=>(r=!0,new Map)),a=e.get(t)??0;a||(r=!0),e.set(t,a+1)}return r}delete(e,t){let r=!1;for(const i of e){const e=this._idToCounters.get(i);if(!e)continue;let s=e.get(t);null!=s&&(s--,s>0?e.set(t,s):(e.delete(t),r=!0),0===e.size&&(this._idToCounters.delete(i),r=!0))}return r}},e.HighlightCounter=t.__decorate([u.subclass("esri.views.2d.layers.support.HighlightCounter")],e.HighlightCounter),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],function(e,t,r,i,s,a,n,o){"use strict";var l;return e.default=l=class extends o{constructor(e){super(e),this.type="rect",this.left=null,this.right=null,this.top=null,this.bottom=null}clone(){return new l({left:this.left,right:this.right,top:this.top,bottom:this.bottom})}commitVersionProperties(){this.commitProperty("left"),this.commitProperty("right"),this.commitProperty("top"),this.commitProperty("bottom")}},t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"left",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"right",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"top",void 0),t.__decorate([r.property({type:[Number,String],json:{write:!0}})],e.default.prototype,"bottom",void 0),e.default=l=t.__decorate([n.subclass("esri.views.layers.support.ClipRect")],e.default),e.default})},"esri/views/layers/support/ClipArea":function(){define(["exports","../../../chunks/tslib.es6","../../../core/JSONSupport","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n,o){"use strict";return e.default=class extends r.JSONSupport{get version(){return this.commitVersionProperties(),(this._get("version")||0)+1}},t.__decorate([i.property({readOnly:!0})],e.default.prototype,"version",null),e.default=t.__decorate([o.subclass("esri.views.layers.support.ClipArea")],e.default),e.default})},"esri/views/layers/support/Geometry":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","../../../geometry/Extent","../../../geometry/Geometry","../../../geometry/Polygon","../../../geometry/support/jsonUtils","./ClipArea"],function(e,t,r,i,s,a,n,o,l,u,c,d){"use strict";var p;const f={base:l,key:"type",typeMap:{extent:o,polygon:u}};return e.default=p=class extends d{constructor(e){super(e),this.type="geometry",this.geometry=null}clone(){return new p({geometry:this.geometry?.clone()??null})}commitVersionProperties(){this.commitProperty("geometry")}},t.__decorate([r.property({types:f,json:{read:c.fromJSON,write:!0}})],e.default.prototype,"geometry",void 0),e.default=p=t.__decorate([n.subclass("esri.views.layers.support.Geometry")],e.default),e.default})},"esri/views/layers/support/Path":function(){define(["exports","../../../chunks/tslib.es6","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./ClipArea"],function(e,t,r,i,s,a,n,o){"use strict";return e.default=class extends o{constructor(e){super(e),this.type="path",this.path=[]}commitVersionProperties(){this.commitProperty("path")}},t.__decorate([r.property({type:[[[Number]]],json:{write:!0}})],e.default.prototype,"path",void 0),e.default=t.__decorate([n.subclass("esri.views.layers.support.Path")],e.default),e.default})},"esri/views/2d/layers/features/FeatureContainer":function(){define(["exports","../../../../core/has","../../../../core/promiseUtils","../../../../core/support/UpdatingHandles","../../engine/AFeatureContainer","../../engine/webgl/shaderGraph/techniques/FeatureInstanceStore","../../engine/webgl/shaderGraph/techniques/TechniqueRegistry","./RenderState","../support/util"],function(e,t,r,i,s,a,n,o,l){"use strict";class u{constructor(e,t){this.id=e,this.version=t,this._resolver=r.createResolver(),this._done=!1}get done(){return this._done}get promise(){return this._resolver.promise}end(){this._resolver.resolve(),this._done=!0}destroy(){this._resolver.reject()}}class c extends s.AFeatureContainer{constructor(e){super(e.view.featuresTilingScheme),this.updatingHandles=new i.UpdatingHandles,this._hitTestsRequests=[],this._store=new a,this._visibleTiles=new Set,this._subscriptions=new Map,this._updateStatisticsRequests=[],this._lockStatisticUpdates=!1,this._shouldUnlockAttributeView=!1,this._layerView=e,this.addTransitionable(this._layerView.featureEffectView)}renderChildren(e){if(this._updateAttributeView(),this._renderState?.update(this.attributeView.currentEpoch),this._layerView.requestUpdate(),this._renderState){const e=Array.from(this._renderState.tiles()).filter(e=>e.needsUpload);e.length&&(e[Math.floor(Math.random()*e.length)].upload(),e.length>=2&&this.requestRender());for(const e of this._renderState.tiles())e.tryReady(this.attributeView.currentEpoch)&&(this._subscriptions.get(e.key.id)?.end(),this._layerView.requestUpdate(),this.hasLabels&&this._layerView.view.labelManager.requestUpdate(),this._layerView.view.labelManager.symbolFader.restartDeclutter(),this.requestRender())}const t=this._layerView.subscriptionManager.updateVisibility();this.setVisibleTiles(t);for(const t of this.children)t.setTransform(e.state);switch(super.renderChildren(e),e.drawPhase){case 1:return this._renderMapPhase(e);case 16:return this._renderHighlightPhase(e);case 2:return this._renderLabelPhase(e)}}subscriptions(){return this._subscriptions.values()}get _instanceStore(){return this._store}get instanceStore(){return this._store}get layerView(){return this._layerView}get hasLabels(){return this._layerView.labelingCollisionInfos.length>0}get hasHighlight(){return this._layerView.hasHighlight}get _layer(){return this._layerView.layer}_getHeatmapInstance(e){if(null==this._instanceStore||!(e.drawPhase&n.Techniques.heatmap.drawPhase))return null;for(const e of this._instanceStore.values())if(d(e))return e;return null}get tiles(){return this._renderState?.tiles()}get children(){return this._renderState?Array.from(this._renderState.tiles()).filter(e=>this._visibleTiles.has(e.key.id)):[]}updateAttributeView(e){this.requestRender(),this.attributeView.requestUpdate(e),this.hasLabels&&(this._layerView.view.labelManager.requestUpdate(),this._layerView.view.labelManager.symbolFader.restartDeclutter())}updateSubscriptions(e){for(const{tileId:t,version:r}of e.subscribe){if(!this._subscriptions.has(t)){const e=new u(t,r);this._subscriptions.set(t,e),this.updatingHandles.addPromise(e.promise);continue}this._subscriptions.get(t).version=r}for(const t of e.unsubscribe){const e=this._subscriptions.get(t);e?.destroy(),this._subscriptions.delete(t),this.removeTile(t)}}isDone(e){return!!this._renderState&&this._renderState.isTileDone(e)}async updateRenderState(e){t("esri-2d-update-debug")&&console.debug(`Version[${e}] FeatureContainer.updateRenderState`),this._renderStateNext=new o.RenderState(()=>this._stage,e=>this._subscriptions.get(e)?.version,e,this.layerView.view.labelManager.symbolFader,this,this.tileInfoView)}getDisplayStatistics(e,t){const r=this._statisticsByLevel.get(e);return r?r.get(t):null}updateStatistics(e,t){if(this._lockStatisticUpdates)return void this._updateStatisticsRequests.push({level:e,statistics:t});let r=this._statisticsByLevel.get(e);r||(r=new Map,this._statisticsByLevel.set(e,r));for(const e of t)r.set(e.fieldName,{minValue:e.minValue,maxValue:e.maxValue})}lockForOverrides(){this._renderState?.lockUploads(),this._lockStatisticUpdates=!0,this.attributeView.locked||(this.attributeView.lockTextureUploads(),this._shouldUnlockAttributeView=!0)}unlockForOverrides(){this._renderState?.unlockUploads(),this._shouldUnlockAttributeView&&(this.attributeView.unlockTextureUploads(),this._shouldUnlockAttributeView=!1),this._lockStatisticUpdates=!1;for(const e of this._updateStatisticsRequests)this.updateStatistics(e.level,e.statistics);this._updateStatisticsRequests=[],this._renderState?.flush(),this.requestRender()}trySwapRenderState(){if(this._renderStateNext){t("esri-2d-update-debug")&&console.debug(`Version[${this._renderStateNext.version}] FeatureContainer.update.swapRenderState`);const e=new Map;for(const t of this._renderState?.tiles()||[])e.set(t.id,t.metricsVisibility);this._renderState?.destroy(),this._renderState=this._renderStateNext,this._renderState.flush();for(const t of this._renderState.tiles())t.copyMetricsVisibility(e.get(t.id)||new Set);this._renderStateNext=null}this.requestRender()}setVisibleTiles(e){this._visibleTiles=e;for(const t of this.tiles??[])t.rendering=e.has(t.key.id)}async onMessage(e,i){r.throwIfAborted(i);const s=e.inner;if(!this._subscriptions.has(s.id))return;const a=this._subscriptions.get(s.id);if(a.version!==s.subscriptionVesrion){if(t("esri-2d-update-debug")){const e=`${s.subscriptionVesrion} != ${a.version}`;console.debug(`Version[${e}] Tile[${s.id}] FeatureContainer - Dropping message, outdated version]`,s)}return}const n=this._renderStateNext??this._renderState;if(!n)throw new Error("InternalError: No renderState defined");n.version!==s.version&&console.error(`InternalError: Version mismatch. [renderState: ${n.version}, message: ${s.version}]`),n.enqueueUpdate(e),this.requestRender(),this._layerView.view.labelManager.requestUpdate(),this._layerView.requestUpdate()}removeTile(e){(this._renderState||this._renderStateNext)&&(this._renderState&&this._renderState.removeTile(e),this._renderStateNext&&this._renderStateNext.removeTile(e))}hitTest(e){let t=this._hitTestsRequests.find(({x:t,y:r})=>t===e.x&&r===e.y);const i=r.createResolver();return t?t.resolvers.push(i):(t={x:e.x,y:e.y,resolvers:[i]},this._hitTestsRequests.push(t)),this.requestRender(),i.promise}getSortKeys(e){const t=new Set(e),r=new Map;for(const e of this.children)if(e.getSortKeys(t).forEach((e,t)=>r.set(t,e)),r.size===t.size)break;return r}get hasAnimation(){return this.hasLabels}doRender(e){const{minScale:t,maxScale:r}=this._layer.effectiveScaleRange,i=e.state.scale;i<=(t||1/0)&&i>=r&&super.doRender(e)}afterRender(e){super.afterRender(e),this._hitTestsRequests.length&&this.requestRender()}setStencilReference(e){if(null==this._getHeatmapInstance(e))super.setStencilReference(e);else for(const e of this.children)e.stencilRef=n.Techniques.heatmap.getStencilReference(e)}_renderMapPhase(e){this._layerView.featureEffectView.hasEffects?(this._renderOutsideEffect(e),this._renderInsideEffect(e)):this._renderFeatures(e,0),this._hitTestsRequests.length>0&&this._renderHittest(e)}_renderHighlightPhase(e){this.hasHighlight&&l.renderHighlight(e,!1,e=>{this._renderFeatures(e,1)})}_renderLabelPhase(e){this._renderFeatures(e,0)}_renderInsideEffect(e){const t=e.painter.effects.insideEffect;t.bind(e),this._renderFeatures(e,2),t.draw(e,this._layerView.featureEffectView.includedEffects),t.unbind()}_renderOutsideEffect(e){const t=e.painter.effects.outsideEffect;t.bind(e),this._renderFeatures(e,3),t.draw(e,this._layerView.featureEffectView.excludedEffects),t.unbind()}_renderHittest(e){const{context:t}=e,r=e.painter.effects.hittest,i=t.getBoundFramebufferObject(),s=t.getViewport(),a=e.passOptions,n=e.drawPhase;r.bind(e),e.passOptions=r.createOptions(e,this._hitTestsRequests),e.drawPhase=8;const{distance:o,smallSymbolDistance:l}=e.passOptions,u=Math.max(o,l);for(const t of this.children)t.visible&&t.containsScreenPoint(e.state,e.passOptions.position,2*u)&&this._renderTile(t,e,0);r.draw(e),r.unbind(),t.bindFramebuffer(i),t.restoreViewport(s),e.passOptions=a,e.drawPhase=n}_renderFeatures(e,t){const r=this._getHeatmapInstance(e);null!=r?this._renderHeatmapFeatures(e,t,r):this._renderGeometryFeatures(e,t)}_renderGeometryFeatures(e,t){for(const r of this.children)r.visible&&this._renderTile(r,e,t)}_renderHeatmapFeatures(e,t,r){for(const r of this.children)r.visible&&this._renderTile(r,e,t,13);r.techniqueRef.renderResolvePass(e,r)}_renderTile(e,r,i,s){const a=t("featurelayer-strict-draw-order")?1:t("featurelayer-force-marker-text-draw-order")?2:0,n=e.getDisplayList(this._instanceStore,a);r.selection=i,n?.render(r,s)}}function d(e){return 13===e.techniqueRef.type}e.FeatureContainer=c,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/shaderGraph/techniques/FeatureInstanceStore":function(){define(["../../../../../../core/string","./TechniqueInstance","./mesh/instanceIdUtils"],function(e,t,r){"use strict";return class{constructor(){this._instanceById=new Map}destroy(){this._instanceById.clear()}get size(){return this._instanceById.size}entries(){return this._instanceById.entries()}find(e){for(const t of this.values())if(t.techniqueRef.type===e)return t;return null}updateStart(e){e&&(this._instanceByIdNext=new Map,this._shaderCountByMesh=new Map,this._shaderIndices=new Map)}updateEnd(e){if(e){if(!this._instanceByIdNext)throw new Error("InternalError: Found updateEnd call without corresponding updateStart");for(const e of this._instanceById.keys())this._instanceByIdNext.has(e)||this._instanceById.delete(e);for(const[e,t]of this._instanceByIdNext.entries()){const r=this._instanceById.get(e);r?r.setInput(t.getInput()):this._instanceById.set(e,t)}this._instanceByIdNext=null,this._shaderCountByMesh=null,this._shaderIndices=null}}values(){return this._instanceById.values()}ensureInstance(i,s){let a;if("object"==typeof s&&"optionalAttributes"in s&&"uniforms"in s){const e=`${i.type}.${JSON.stringify(s.optionalAttributes)}`,t=e+`.${JSON.stringify(s.uniforms)}`;let r=0;null!=this._instanceByIdNext&&(this._shaderIndices.has(t)?r=this._shaderIndices.get(t):(r=this._shaderCountByMesh.get(e)??0,this._shaderCountByMesh.set(e,r+1),this._shaderIndices.set(t,r))),a=e+`.${r}`}else a=`${i.type}.${JSON.stringify(s)}`;const n=e.numericHash(a);if(this._instanceByIdNext){const e=new t.FeatureTechniqueInstance(r.castInstanceId(n),i,s);return this._instanceByIdNext.set(n,e),e}if(!this._instanceById.has(n)){const e=new t.FeatureTechniqueInstance(r.castInstanceId(n),i,s);this._instanceById.set(n,e)}return this._instanceById.get(n)}getInstance(e){const t=this._instanceById.get(e);if(null==t)throw new Error(`InternalError: Unable to get instance for ${e}`);return t}}})},"esri/views/2d/layers/features/RenderState":function(){define(["exports","../../../../core/CircularArray","../../../../core/Error","../../../../core/has","../../../../core/Logger","../../../../geometry/support/aaBoundingRect","../../tiling/TileInfoView","../../tiling/TileKey","../../tiling/TileQueue","../../tiling/TileStrategy","../../engine/webgl/FeatureTile"],function(e,t,r,i,s,a,n,o,l,u,c){"use strict";e.RenderState=class{constructor(e,r,i,s,a,n){this.getStage=e,this.getSubscriptionVersion=r,this.version=i,this._fader=s,this._container=a,this._tileInfoView=n,this._pendingUpdates=new t(1e3),this._locked=!1,this._tiles=new Map}destroy(){for(const e of this.tiles())e.destroy();this._pendingUpdates.clear(),this._tiles.clear()}tiles(){return this._tiles.values()}size(){return this._tiles.size}getTile(e){return this._tiles.get(e)}setTiles(e){this._tiles.clear();for(const t of e)this._tiles.set(t.key.id,t)}lockUploads(){this._locked=!0}unlockUploads(){this._locked=!1,this.flush()}enqueueUpdate(e){this._pendingUpdates.enqueue(e)}update(e){if(!this._locked)for(;this._pendingUpdates.size;){const t=this._pendingUpdates.peek();if(null==t||t.inner.attributeEpoch>e)break;this._updateTile(t),this._pendingUpdates.dequeue()}}removeTile(e){const t=this._tiles.get(e);i("esri-2d-update-debug")&&console.debug(`Tile[${e}] RenderState.removeTile`),t&&(this._fader.unregisterFeatureTile(t),t.destroy()),this._tiles.delete(e)}isTileDone(e){const t=this._tiles.get(e.id);return!!t&&t.isReady&&t.decluttered}flush(){for(;this._pendingUpdates.size;){const e=this._pendingUpdates.dequeue();null!=e&&this._updateTile(e)}for(const e of this._tiles.values())e.upload()}_updateTile(e){const{inner:t,objectIdMap:r}=e,s=this.getSubscriptionVersion(t.id);if(s!==t.subscriptionVesrion){if(i("esri-2d-update-debug")){const e=`${t.subscriptionVesrion} != ${s}`;console.debug(`Version[${e}] Tile[${t.id}] FeatureContainer - Dropping message, outdated version]`,t)}return}if(i("esri-2d-update-debug")){const e=t.debugInfo?.chunkId??"<EnsureEnd>";console.debug(`Version[${t.version}] Tile[${t.id}] Chunk[${e}] RenderState.updateTile [${t.type}]`,t)}const a=this._ensureTile(t.id);if("update"===t.type){const[e,...i]=t.modify;a.onMessage({type:"update",modify:e,remove:t.remove,end:t.end,attributeEpoch:t.attributeEpoch,objectIdMap:r});for(const e of i){const i=this._tiles.get(e.tileId);i&&i.onMessage({type:"update",modify:e,remove:t.remove,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:r})}return}if(null==t.append)return void a.onMessage({type:"append",clear:t.clear,debugInfo:t.debugInfo,end:t.end,attributeEpoch:t.attributeEpoch,objectIdMap:r});const[n,...o]=t.append;a.onMessage({type:"append",clear:t.clear,append:n,debugInfo:t.debugInfo,end:t.end,attributeEpoch:t.attributeEpoch,objectIdMap:r});for(const e of o){const t=this._tiles.get(e.tileId);t&&t.onMessage({type:"update",modify:e,remove:[],sort:!1,end:!1,isPixelBuffer:!0,attributeEpoch:null,objectIdMap:r})}}_ensureTile(e){if(!this._tiles.has(e)){const t=this._createTile(e);this._copyPixelBufferedEntitiesInto(t),this._tiles.set(e,t)}return this._tiles.get(e)}_createTile(e){i("esri-2d-update-debug")&&console.debug(`Version[${this.version}] Tile[${e}] RenderState.createTile`);const t=new o(e),n=this._tileInfoView.getTileBounds(a.create(),t),l=n[0],u=n[3],d=this._tileInfoView.getTileResolution(t.level),p=this._container.instanceStore.find(14)?.instanceId,f=new c.FeatureTile(t,d,l,u,this._fader,p,!0);if(this._fader.registerFeatureTile(f),f.stage=this.getStage(),!f.stage){const e=new r("featurelayerview:webgl","Cannot create tile with empty stage");s.getLogger("esri.views.2d.layers.features.RenderState").error(e)}return f}_copyPixelBufferedEntitiesInto(e){let t=7;const r=this._tileInfoView.getLODInfoAt(e.key);for(let i=-1;i<=1;i++)for(let s=-1;s<=1;s++){if(0===i&&0===s)continue;const a=e.key.getNormalizedNeighbor(s,i,r).id,n=this._tiles.get(a);if(null!=n){const r=1<<t;e.copyPixelBufferedEntitesFrom(n,r,s,i)}t--}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeaturePipelineWorkerProxy":function(){define(["exports","../../../../core/workers/workers"],function(e,t){"use strict";class r{constructor(e){this._connection=e,this.pipeline=this._connection.createInvokeProxy(),this.features=this._connection.createInvokeProxy("features"),this.aggregates=this._connection.createInvokeProxy("aggregates"),this.streamMessenger=this._connection.createInvokeProxy("streamMessenger")}destroy(){this._connection.destroy()}get closed(){return this._connection.closed}}e.FeaturePipelineWorkerProxy=r,e.createFeaturePipelineWorkerProxy=async function(e){const i=await t.open("FeaturePipelineWorker",{client:e,strategy:"dedicated"});return new r(i)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/FeatureSourceEventLog":function(){define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/CircularArray","../../../../core/Evented","../../../../core/ReactiveMap","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n,o,l,u,c){"use strict";e.FeatureSourceEventLog=class extends r{constructor(){super(...arguments),this.events=new s.EventEmitter,this._updatingStrategy=!0,this._tileToEvent=new a,this._fetchStatus={outstanding:0,done:0}}get hasAllData(){return!this._updatingStrategy&&this._hasAllTileData()}get willQueryAllFeatures(){return this._strategyInfo?.willQueryAllFeatures??!1}get willQueryFullResolutionGeometry(){return this._strategyInfo?.willQueryAllFeatures??!1}onEvent(e){switch(e.type){case"subscribe":case"unsubscribe":case"loaded":case"error":this._handleTileEvent(e);break;case"updateStrategyStart":this._updatingStrategy=!0,this._fetchStatus={done:0,outstanding:0},this._strategyInfo=e.about;break;case"updateStrategyEnd":this._updatingStrategy=!1;break;case"updateFieldsStart":this._fetchStatus={done:0,outstanding:0};break;case"updateFieldsEnd":break;case"updateFieldsError":this.events.emit("error",e);break;case"fetchStart":this._fetchStatus.outstanding+=1,this.events.emit("status",this._fetchStatus);break;case"fetchEnd":this._fetchStatus.done+=1,this.events.emit("status",this._fetchStatus),e.done&&(this._fetchStatus={done:0,outstanding:0})}}_hasAllTileData(){for(const e of this._tileToEvent.values()){const t=e.peekLast();if("loaded"!==t?.type)return!1}return!0}_handleTileEvent(e){switch(e.type){case"subscribe":{const t=new i(10);t.enqueue(e),this._tileToEvent.set(e.tile,t);break}case"unsubscribe":this._tileToEvent.delete(e.tile);break;case"loaded":{const t=this._tileToEvent.get(e.tile);if(!t)return;t.enqueue(e),this._tileToEvent.set(e.tile,t);break}case"error":{const t=this._tileToEvent.get(e.tile);if(!t)return;t.enqueue(e),this._tileToEvent.set(e.tile,t),this.events.emit("error",e);break}}}},t.__decorate([n.property({readOnly:!0})],e.FeatureSourceEventLog.prototype,"hasAllData",null),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"willQueryAllFeatures",null),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"willQueryFullResolutionGeometry",null),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"_updatingStrategy",void 0),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"_strategyInfo",void 0),t.__decorate([n.property()],e.FeatureSourceEventLog.prototype,"_tileToEvent",void 0),e.FeatureSourceEventLog=t.__decorate([c.subclass("esri.views.2d.layers.features.FeatureSourceEventLog")],e.FeatureSourceEventLog),Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/CatalogFootprintLayerAdapter":function(){define(["exports","../../../../../core/lang","../../../../../graphic/CatalogGraphicOrigin","../../../../../layers/support/arcgisLayerUrl","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,s,a,n,o,l){"use strict";e.CatalogFootprintLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=a.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:a.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const r=this.layer,{capabilities:a,editingInfo:n,objectIdField:o,globalIdField:l,datesInUnknownTimezone:u,dateFieldsTimeZone:c,orderBy:d,parsedUrl:p}=r,f=r.fieldsIndex.toJSON(),y=s.getServiceGeometryType(r),h=r.timeInfo?.toJSON(),g=r.spatialReference.toJSON(),m=t.clone(p);let b=o;if(d?.length){const e=!d[0].valueExpression&&d[0].field;e&&(b=e)}const _=i.isHostedAgolService(m.path),w=e.spatialReference.toJSON();return{type:"feature-service",source:m,isSourceHosted:_,orderByFields:b,outSpatialReference:w,metadata:{timeReferenceUnknownClient:u,dateFieldsTimeZone:c,globalIdField:l,fieldsIndex:f,geometryType:y,featureIdInfo:{type:"object-id",fieldName:o},timeInfo:h,spatialReference:g,outSpatialReference:w,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:n?.lastEditDate?.getTime(),snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:i,customParameters:s,timeExtent:a,apiKey:o}=this.layer,l={definitionExpression:r,displayFilterInfo:i,customParameters:s,timeExtent:a};return n.createFeatureSourceSchema(l,e,t,o)}createProcessorSchema(e,t,r){const{fields:i,geometryType:s,orderBy:a,objectIdField:n,renderer:l,labelingInfo:u,labelsVisible:c}=this.layer,d={featureReduction:null,labelingInfoSource:this.layer.id,fields:i.map(e=>e.toJSON()),geometryType:s,labelingInfo:u,labelsVisible:c,objectIdField:n,orderBy:a??"default",renderer:l?.clone()};return o.createSimpleProcessorSchema(e,t,d,r)}get hasRequiredSupport(){return l.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>this.layer.outFields,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy]}setGraphicOrigin(e){e.origin=new r(this.layer)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/graphic/CatalogGraphicOrigin":function(){define(["./GraphicOrigin","./isCatalogGraphicOrigin"],function(e,t){"use strict";var r;class i extends e{static{r=t.isCatalogGraphicOriginSymbol}constructor(e){super(),this[r]=!0,this.type="catalog",this.layer=e}}return i})},"esri/graphic/isCatalogGraphicOrigin":function(){define(["exports"],function(e){"use strict";const t=Symbol("isCatalogGraphicOrigin");e.isCatalogGraphicOrigin=function(e){return!!e&&t in e},e.isCatalogGraphicOriginSymbol=t,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/geometryUtils":function(){define(["exports"],function(e){"use strict";e.getServiceGeometryType=function(e){switch(e.geometryType){case"point":return"esriGeometryPoint";case"polyline":return"esriGeometryPolyline";case"mesh":case"polygon":return"esriGeometryPolygon";case"multipatch":return"esriGeometryMultiPatch";case"multipoint":return"esriGeometryMultipoint";default:return null}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/labelingUtils":function(){define(["exports","../../../../../core/screenUtils","./featureReductionUtils","../../support/visualVariableSimpleUtils"],function(e,t,r,i){"use strict";function s(e){return r=>t.pt2px(i.getSizeForValueSimple(r,e))}e.createLabelVVEvaluator=function(e){const t=null!=e&&"visualVariables"in e&&e.visualVariables;if(!t)return null;for(const e of t)if("size"===e.type)return s(e);return null},e.getFeatureReductionDeconflictionEnabled=function(e,t){const i=r.getEffectiveFeatureReduction(e,t);if(i?.labelsVisible&&i.labelingInfo?.length)return i.labelingInfo.every(e=>"none"!==e.deconflictionStrategy)},e.getLayerDeconflictionEnabled=function(e){return(e.labelsVisible&&e.labelingInfo?.every(e=>"none"!==e.deconflictionStrategy))??!1},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/featureReductionUtils":function(){define(["exports"],function(e){"use strict";e.getEffectiveFeatureReduction=function(e,t){const r=e.featureReduction;return r&&"selection"!==r.type&&(!("maxScale"in r)||!r.maxScale||r.maxScale<t.scale)?r:null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/visualVariableSimpleUtils":function(){define(["exports","../../../../core/mathUtils","../../../../renderers/support/lengthUtils"],function(e,t,r){"use strict";const i=Math.PI;function s(e,s){switch(s.transformationType){case"additive":return function(e,t){return e+(a(t.minSize,e)||t.minDataValue)}(e,s);case"constant":return function(e,t){const r=e.stops;let i=r?.length&&r[0].size;return null==i&&(i=e.minSize),a(i,t)}(s,e);case"clamped-linear":return function(e,t){const r=t.minDataValue,i=t.maxDataValue,s=(e-r)/(i-r),n=a(t.minSize,e),o=a(t.maxSize,e);return e<=r?n:e>=i?o:n+s*(o-n)}(e,s);case"proportional":return function(e,r){const i=e/r.minDataValue,s=a(r.minSize,e),n=a(r.maxSize,e);let o=null;return o=i*s,t.clamp(o,s,n)}(e,s);case"stops":return function(e,t){const[r,i,s]=function(e,t){if(!t)return;let r=0,i=t.length-1;return t.some((t,s)=>e<t?(i=s,!0):(r=s,!1)),[r,i,(e-t[r])/(t[i]-t[r])]}(e,t.cache.ipData);if(r===i)return a(t.stops[r].size,e);{const n=a(t.stops[r].size,e);return n+(a(t.stops[i].size,e)-n)*s}}(e,s);case"real-world-size":return function(e,s){const n=r.meterIn[s.valueUnit],o=a(s.minSize,e),l=a(s.maxSize,e),{valueRepresentation:u}=s;let c=null;return c="area"===u?2*Math.sqrt(e/i)/n:"radius"===u||"distance"===u?2*e/n:e/n,t.clamp(c,o,l)}(e,s);case"identity":return e;case"unknown":return null}}function a(e,t){return"number"==typeof e?e:s(t,e)}e.getSizeForValueSimple=s,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/SourceSchema":function(){define(["exports","../../../../../core/sql"],function(e,t){"use strict";e.createFeatureSourceSchema=function(e,r,i,s){const a=null!=e.subtypeCode?`${e.subtypeField} = ${e.subtypeCode}`:null,n=t.sqlAnd(e.definitionExpression,a),o=e.customParameters??{},l=r.displayFilterEnabled&&e.displayFilterInfo?e.displayFilterInfo.toJSON():null;return s&&(o.token=s),{type:"feature",mutable:{sourceRefreshVersion:i,availableFields:r.availableFields,displayFilterInfo:l,dataFilter:{definitionExpression:n,customParameters:o,gdbVersion:e.gdbVersion,historicMoment:e.historicMoment?.getTime(),queryScaleRanges:e.queryScaleRanges??[],timeExtent:e.timeExtent?.toJSON()}}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SimpleProcessorSchema":function(){define(["exports","../../../../../../core/screenUtils","../../../../../../layers/support/OrderByInfo","./LabelMatcherSchema","./MatcherSchema","./StorageSchema","./VisualVariablesSchema"],function(e,t,r,i,s,a,n){"use strict";function o(e,t){return e.fields.map(e=>({...e.toJSON(),type:l(e,t)}))}function l(e,t){const{onStatisticExpression:r,onStatisticField:i,statisticType:s}=e;switch(s){case"min":case"max":case"avg":case"avg_angle":case"sum":case"count":return"esriFieldTypeDouble";case"mode":{if(r){const{returnType:e}=r;return e?"string"===e?"esriFieldTypeString":"esriFieldTypeDouble":"esriFieldTypeString"}const e=t.find(e=>e.name===i);return e?e.type:"esriFieldTypeString"}}}function u(e){return 2===e.techniqueType}function c(e){if("simple"===e.type&&e.meshes.some(u))return!0;if("interval"===e.type){if(e.intervals.some(e=>e.meshes.some(u)))return!0;if(e.backgroundFill.some(u))return!0}if("map"===e.type){if(e.map.some(e=>e.symbol.some(u)))return!0;if(e.backgroundFill.some(u))return!0}return!1}e.createSimpleProcessorSchema=async function(e,l,u,d){const p=u.featureReduction;if(p)switch(p.type){case"binning":return async function(e,r,l,u,d){const p=o(e,u.fields),f=e.renderer,y=await s.createMatcherSchema(r,f),h=a.createStorageSchema(f,[null,null]),g=n.createVisualVariableUniforms(f),m=await i.createLabelMatcherSchema(r,{geometryType:"polygon",labelingInfoSource:u.labelingInfoSource+"-binning",labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible},g),b=c(y),_="geohash"===e.binType?{type:"geohash",fixBinLevel:e.fixedBinLevel??3}:{type:"grid",size:t.pt2px(e.size),fixedBinLevel:e.fixedBinLevel};return{storage:h,mesh:{properties:{sortKey:null,timeZone:l.timeZone,returnMeshObjectId:b,displayRefreshVersion:d,currentUser:l.currentUser},strategy:{type:"binning",fields:p,index:_,featureFilter:l.filters[0]},factory:{labels:m,symbology:y}},expressionProperties:{timeExtent:l.timeExtent?.toJSON()}}}(p,e,l,u,d);case"cluster":return async function(e,r,l,u,d){const p=o(e,u.fields),f={type:"cluster",feature:await s.createMatcherSchema(r,e.effectiveFeatureRenderer),cluster:await s.createMatcherSchema(r,e.effectiveClusterRenderer)},y=n.createVisualVariableUniforms(e.effectiveFeatureRenderer),h={type:"cluster",feature:await i.createLabelMatcherSchema(r,u,y),cluster:await i.createLabelMatcherSchema(r,{geometryType:"point",labelingInfoSource:u.labelingInfoSource+"-clusters",labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible},y)},g=a.createStorageSchema(e.effectiveFeatureRenderer,[null,null]),m=c(f);return{storage:g,mesh:{properties:{sortKey:null,timeZone:l.timeZone,displayRefreshVersion:d,returnMeshObjectId:m,currentUser:l.currentUser},strategy:{type:"cluster",fields:p,featureFilter:l.filters[0],clusterRadius:t.pt2px(e.clusterRadius/2)},factory:{labels:h,symbology:f}},expressionProperties:{timeExtent:l.timeExtent?.toJSON()}}}(p,e,l,u,d)}if(u.trackInfo?.enabled)return async function(e,t,r,l,u){const d=o(e,l.fields),p={type:"track",previousObservation:await s.createMatcherSchema(t,e.previousObservations.renderer),latestObservation:await s.createMatcherSchema(t,e.latestObservations.renderer),trackLine:await s.createMatcherSchema(t,e.trackLines.renderer)},f={type:"track",previousObservation:await i.createLabelMatcherSchema(t,{geometryType:l.geometryType,labelingInfoSource:l.labelingInfoSource+"-track-prev",labelingInfo:e.previousObservations.labelingInfo,labelsVisible:e.previousObservations.labelsVisible},n.createVisualVariableUniforms(e.previousObservations.renderer)),latestObservation:await i.createLabelMatcherSchema(t,{geometryType:l.geometryType,labelingInfoSource:l.labelingInfoSource+"-track-latest",labelingInfo:e.latestObservations.labelingInfo,labelsVisible:e.latestObservations.labelsVisible},n.createVisualVariableUniforms(e.latestObservations.renderer)),trackLine:await i.createLabelMatcherSchema(t,{geometryType:"polyline",labelingInfoSource:l.labelingInfoSource+"-track-line",labelingInfo:e.trackLines.labelingInfo,labelsVisible:e.trackLines.labelsVisible},n.createVisualVariableUniforms(e.trackLines.renderer))},y=a.createTrackStorageSchema(e,[null,null]),h=c(p);return{storage:y,mesh:{properties:{sortKey:null,timeZone:r.timeZone,returnMeshObjectId:h,displayRefreshVersion:u,currentUser:r.currentUser},strategy:{type:"track",featureFilter:r.filters[0],fields:d,maxDisplayDuration:e.maxDisplayDuration?.toMilliseconds()??0,maxDisplayObservationsPerTrack:e.maxDisplayObservationsPerTrack,showLatestObservation:e.latestObservations.visible,showPreviousObservations:e.previousObservations.visible,showTrackLine:e.trackLines.visible,timeField:e.timeField},factory:{labels:f,symbology:p}},expressionProperties:{timeExtent:r.timeExtent?.toJSON()}}}(u.trackInfo,e,l,u,d);const f=function(e,t,i){const s=null!=t&&"unique-value"===t.type&&t.orderByClassesEnabled;if("default"!==e||s||(e=[new r({field:i,order:"descending"})]),"default"!==e&&e?.length){e.length;const t=e[0],r="ascending"===t.order?"asc":"desc";return t.field?{field:t.field,order:r}:t.valueExpression?{expression:t.valueExpression,order:r}:null}return s?{byRenderer:!0,order:"asc"}:null}(u.orderBy,u.renderer,u.objectIdField),y=a.createStorageSchema(u.renderer,l.filters),h=await async function(e,t){const r=t.renderer,a=n.createVisualVariableUniforms(r);return{symbology:await s.createMatcherSchema(e,r),labels:await i.createLabelMatcherSchema(e,t,a)}}(e,u),g=c(h.symbology);return{storage:y,mesh:{properties:{sortKey:f,timeZone:l.timeZone,returnMeshObjectId:g,displayRefreshVersion:d,currentUser:l.currentUser},strategy:{type:"feature"},factory:h},expressionProperties:{timeExtent:l.timeExtent?.toJSON()}}},e.getAggregateFields=o,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/LabelMatcherSchema":function(){define(["exports","../../../../../../core/string","../../../../../../layers/support/labelingInfo","../../layerAdapters/geometryUtils","./symbols/SymbolSchema"],function(e,t,r,i,s){"use strict";e.createLabelMatcherSchema=async function(e,a,n){const o=a.labelsVisible&&a.labelingInfo||[],l=i.getServiceGeometryType(a),u=r.validateLabelingInfo(o,l);return{type:"label",classes:await Promise.all(u.map((r,i)=>async function(e,r,i,a,n,o,l){const u=t.numericHash(`${a} ${n}`),c=await s.createSymbolMeshSchemas(r,{schemaOptions:e,uniforms:l,labelClassId:u});return{maxScale:r.maxScale,minScale:r.minScale,deconflictionEnabled:"none"!==r.deconflictionStrategy&&i,expression:r.labelExpressionInfo?.expression??r.labelExpression,where:r.where,meshes:c,labelClassId:u,geometryType:o}}(e,r,a.labelsVisible,a.labelingInfoSource,i,l,n)))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/symbols/SymbolSchema":function(){define(["exports","../../../../../../../core/Logger","../../../../../../../core/screenUtils","../../../../../../../renderers/support/heatmapUtils","../../../../../../../symbols/SimpleFillSymbol","../../../../../../../symbols/SimpleLineSymbol","../../../../../../../symbols/SimpleMarkerSymbol","../../../../../../../symbols/cim/CIMSymbolHelper","../../../../../../../symbols/cim/SDFHelper","../../../../../engine/webgl/alignmentUtils","../../../../../engine/webgl/color","../../../../../engine/webgl/definitions","../../../../../engine/webgl/shaderGraph/techniques/TechniqueRegistry","../schemaUtils","../VisualVariablesSchema","./ComplexSymbolSchema","./utils"],function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g){"use strict";async function m(e,i){if(!e)return[];switch(e.type){case"simple-fill":return S(e,i);case"picture-fill":return function(e,t){const{outline:r}=e,{uniforms:i,schemaOptions:s}=t,{store:a}=s,n=[],l=o.CIMSymbolHelper.createPictureFillRasterizationParam(e);if(!l)return[];const{width:u,height:c,xoffset:d,yoffset:f,xscale:y,yscale:h}=e,g={color:[255,255,255,255],sprite:l,height:c,aspectRatio:u/c,offsetX:d,offsetY:f,scaleX:y,scaleY:h,angle:0,applyRandomOffset:!1,sampleAlphaOnly:!1,scaleProportionally:!1,effects:null,scaleInfo:null};if("solid"===r?.style)return[a.ensureInstance(p.Techniques.complexOutlineFill,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity,visualVariableSizeScaleStops:i.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({...g,...w(r,!!i.visualVariableSizeOutlineScaleStops)})];const m=a.ensureInstance(p.Techniques.complexFill,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity},optionalAttributes:{zoomRange:!1}});return n.push(m.createMeshInfo(g)),r&&n.push(...v(r,t,!0)),n}(e,i);case"simple-marker":return _(e,i);case"picture-marker":return function(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i,a=s.ensureInstance(p.Techniques.marker,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue,visualVariableRotation:r.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),n=o.CIMSymbolHelper.createPictureMarkerRasterizationParam(e);return n?[a.createMeshInfo({type:"picture",color:[255,255,255,255],height:e.height,width:e.width,offsetX:e.xoffset,offsetY:e.yoffset,angle:e.angle,alignment:g.hasRotationVVUniform(r)?1:0,outlineColor:null,outlineSize:0,referenceSize:e.height,sprite:n,overrideOutlineColor:!1,hasSizeVV:g.hasSizeVVUniform(r),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:y.getMaxSizeVVSize(r)})]:[]}(e,i);case"simple-line":return v(e,i,!1);case"text":return function(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i;return[s.ensureInstance(p.Techniques.text,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableRotation:r.visualVariableRotation,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1,clipAngle:!1,referenceSymbol:!1,visibility:!1}}).createMeshInfo({boxBackgroundColor:e.backgroundColor?.toArray(),boxBorderLineColor:e.borderLineColor?.toArray(),boxBorderLineSize:e.borderLineSize??0,color:e.color?.toArray()??[0,0,0,0],offsetX:e.xoffset,offsetY:e.yoffset,postAngle:e.angle,fontSize:e.font.size,decoration:e.font.decoration,haloColor:e.haloColor?.toArray()??[0,0,0,0],haloSize:e.haloSize??0,outlineColor:[0,0,0,0],outlineSize:0,lineWidth:e.lineWidth,lineHeightRatio:e.lineHeight,horizontalAlignment:e.horizontalAlignment,verticalAlignment:e.verticalAlignment,useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:e.font.toJSON(),textString:e.text,symbol:o.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(e)},overrides:[]},referenceSize:null,effects:null,placement:null,scaleInfo:null,transforms:null,scaleFactor:1,minPixelBuffer:y.getMaxSizeVVSize(r),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,labelClassId:-1})]}(e,i);case"label":return function(e,t){const{schemaOptions:i,uniforms:s}=t,{store:a}=i,n=e.symbol,{allowOverrun:l,repeatLabel:c,repeatLabelDistance:d}=e,f={maxScale:e.maxScale??0,minScale:e.minScale??0},h=a.ensureInstance(p.Techniques.label,{uniforms:{visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:s.visualVariableRotation,visualVariableSizeMinMaxValue:s.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:s.visualVariableSizeScaleStops,visualVariableSizeStops:s.visualVariableSizeStops,visualVariableSizeUnitValue:s.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!0,clipAngle:!0,referenceSymbol:!0,visibility:!0}}),g=e.labelPlacement,[m,b]=u.getAlignmentFromPlacement(g);return[h.createMeshInfo({boxBackgroundColor:n.backgroundColor?.toArray(),boxBorderLineColor:n.borderLineColor?.toArray(),boxBorderLineSize:n.borderLineSize??0,color:n.color?.toArray()??[0,0,0,0],offsetX:n.xoffset,offsetY:n.yoffset,postAngle:n.angle,fontSize:n.font.size,decoration:n.font.decoration,outlineColor:[0,0,0,0],outlineSize:0,haloColor:n.haloColor?.toArray()??[0,0,0,0],haloSize:n.haloSize??0,lineWidth:n.lineWidth,lineHeightRatio:n.lineHeight,horizontalAlignment:m,verticalAlignment:b,repeatLabel:c,repeatLabelDistance:r.pt2px(d),allowOverrun:l,labelPosition:e.labelPosition,scaleInfo:f,minPixelBuffer:y.getMaxSizeVVSize(s),useCIMAngleBehavior:!1,glyphs:{type:"text-rasterization-param",resource:{type:"text",font:n.font.toJSON(),textString:n.text,symbol:o.CIMSymbolHelper.createCIMTextSymbolfromTextSymbol(n),primitiveName:"label-override"},useLegacyLabelEvaluationRules:null==e.labelExpressionInfo?.expression,overrides:[{valueExpressionInfo:{type:"CIMExpressionInfo",expression:e.labelExpressionInfo?.expression??e.labelExpression,returnType:"String"},primitiveName:"label-override",propertyName:"textString",defaultValue:""}]},referenceSize:null,effects:null,placement:null,transforms:null,scaleFactor:1,labelClassId:t.labelClassId})]}(e,i);case"cim":return h.createComplexSymbolInstances(e.data,i);case"web-style":return m(await e.fetchSymbol({acceptedFormats:["cim","web"]}),i);case"line-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Defaulting to simple-line`),v(new a,i,!1);case"point-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Defaulting to simple-marker`),_(new n,i);case"polygon-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Defaulting to simple-fill`),S(new s,i);case"mesh-3d":case"label-3d":return t.getLogger("esri.views.layers.FeatureLayerView").warn("unsupported-symbol",`Symbol of type "${e.type}" unsupported in MapView. Ignoring`),[];case"CIMSymbolReference":throw new Error("InternalError: CIMSymbolReference should already be resolved")}}function b(e){if("path"===e.style){if(null==e.path)throw new Error("Symbol with a style of type path must define a path");return{type:"sprite-rasterization-param",overrides:[],resource:{type:"path",path:e.path,asFill:!0}}}const t=o.CIMSymbolHelper.fromSimpleMarker(e);if("outline"in e&&e.outline&&"none"!==e.outline.style&&"solid"!==e.outline.style){if(!t||!t.symbolLayers)throw new Error("Error handling marker! ");return{type:"sprite-rasterization-param",resource:t.symbolLayers[0],overrides:[]}}return{type:"sprite-rasterization-param",resource:l.getSDFInfo(t),overrides:[]}}async function _(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i;if("path"===e.style||e.outline&&"solid"!==e.outline.style&&"none"!==e.outline.style){const i=o.CIMSymbolHelper.fromSimpleMarker(e);if(!i||!i.symbolLayers)throw new Error("Error handling marker! ");if(r.visualVariableRotation&&(i.angleAlignment="Map"),"path"!==e.style){const e=i.symbolLayers[0];if(g.hasSizeVVUniform(t.uniforms)){const r=y.getMaxSizeVVSize(t.uniforms,0,1);if(r>e.size){const t=r/e.size;e.size=r;const i=e.markerGraphics?.[0].symbol;(i.symbolLayers&&i.symbolLayers[0]).width*=t}}}return h.createComplexSymbolInstances({type:"CIMSymbolReference",symbol:i},t)}const a=s.ensureInstance(p.Techniques.marker,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue,visualVariableRotation:r.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),n=b(e);let l=e.color?.toArray()??[0,0,0,0];"CIMVectorMarker"===n.resource.type&&(l=[255,255,255,255]);const u="triangle"===e.style?124/116:1,c=e.size,d=c*u,f=null!=r.visualVariableColor&&("cross"===e.style||"x"===e.style);return[a.createMeshInfo({type:"simple",color:l,height:c,width:d,offsetX:e.xoffset,offsetY:e.yoffset,angle:e.angle,alignment:g.hasRotationVVUniform(r)?1:0,outlineColor:e.outline?.color?.toArray()??[0,0,0,0],outlineSize:e.outline?.width??1,referenceSize:c,sprite:n,overrideOutlineColor:f,hasSizeVV:g.hasSizeVVUniform(r),placement:null,effects:null,transforms:null,scaleInfo:null,minPixelBuffer:y.getMaxSizeVVSize(r)})]}function w(e,t){const r=e.width;return{outlineColor:e.color?.toArray()||[0,0,0,1],width:r,referenceWidth:r,capType:e.cap??"round",joinType:e.join??"round",miterLimit:e.miterLimit,hasSizeVV:t,outlineUsesColorVV:!1}}async function S(e,t){if("cim"===e.type)return h.createComplexSymbolInstances(e.data,t);const{style:r}=e;return r&&"none"!==r&&"solid"!==r?function(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i,a=e.color?.toArray()??[0,0,0,0],n={type:"sprite-rasterization-param",resource:{type:"fill-style",style:e.style},overrides:[]};if("solid"===e.outline?.style)return[s.ensureInstance(p.Techniques.patternOutlineFill,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:a,...w(e.outline,!!r.visualVariableSizeOutlineScaleStops),sprite:n,scaleInfo:null,effects:null})];const o=[],l=s.ensureInstance(p.Techniques.patternFill,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:e.color?.toArray()??[0,0,0,0],sprite:n,scaleInfo:null,effects:null});return o.push(l),e.outline&&o.push(...v(e.outline,t,!0)),o}(e,t):function(e,t){const{uniforms:r,schemaOptions:i}=t,{store:s}=i,a=e.color?.toArray()??[0,0,0,0];if("none"!==e.style&&"solid"===e.outline?.style)return[s.ensureInstance(p.Techniques.outlineFill,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops,visualVariableSizeMinMaxValue:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:a,...w(e.outline,!!r.visualVariableSizeOutlineScaleStops),scaleInfo:null,effects:null})];const n=[];if("none"!==e.style){const e=s.ensureInstance(p.Techniques.fill,{uniforms:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity},optionalAttributes:{zoomRange:!1}}).createMeshInfo({color:a,scaleInfo:null,effects:null});n.push(e)}return e.outline&&n.push(...v(e.outline,t,!0)),n}(e,t)}function v(e,t,r){const{color:i,style:s,width:a,cap:n,join:l}=e,{schemaOptions:u}=t,{store:c}=u,d=[],f=r?{...y.noVisualVariables,visualVariableSizeScaleStops:t.uniforms.visualVariableSizeOutlineScaleStops}:t.uniforms,h={uniforms:{visualVariableColor:f.visualVariableColor,visualVariableOpacity:f.visualVariableOpacity,visualVariableSizeMinMaxValue:f.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:f.visualVariableSizeScaleStops,visualVariableSizeStops:f.visualVariableSizeStops,visualVariableSizeUnitValue:f.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!1}},m={color:i?.toArray()??[0,0,0,0],width:a,referenceWidth:a,capType:n,joinType:l,miterLimit:e.miterLimit,hasSizeVV:g.hasSizeVVUniform(f),effects:null,scaleInfo:null};if(null==s||"solid"===s){const e=c.ensureInstance(p.Techniques.line,h).createMeshInfo(m);d.push(e)}else if("none"!==s){const e=c.ensureInstance(p.Techniques.texturedLine,h).createMeshInfo({...m,offsetAlongLine:0,shouldScaleDash:!0,shouldSampleAlphaOnly:!1,isSDF:!0,sprite:{type:"sprite-rasterization-param",resource:{type:"dash",dashTemplate:o.slsDashToTemplateArray(s,n)},overrides:[]}});d.push(e)}return null!=e.marker&&d.push(...function(e,t,r){const{uniforms:i,schemaOptions:s}=r,{store:a}=s,n=a.ensureInstance(p.Techniques.marker,{uniforms:{visualVariableColor:i.visualVariableColor,visualVariableOpacity:i.visualVariableOpacity,visualVariableSizeMinMaxValue:i.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:i.visualVariableSizeScaleStops,visualVariableSizeStops:i.visualVariableSizeStops,visualVariableSizeUnitValue:i.visualVariableSizeUnitValue,visualVariableRotation:i.visualVariableRotation},optionalAttributes:{zoomRange:!1}}),o=b(e),l=6*t.width,u=l,c=e.color?.toArray()??t.color?.toArray()??[0,0,0,0],d="cross"===e.style||"x"===e.style;let f;switch(e.placement){case"begin-end":f="Both";break;case"begin":f="JustBegin";break;case"end":f="JustEnd";break;default:f="None"}const h={type:"cim-marker-placement-param",placement:{type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:f,offsetAlongLine:0},overrides:[]};return[n.createMeshInfo({type:"simple",color:c,height:u,width:l,offsetX:0,offsetY:0,angle:0,alignment:g.hasRotationVVUniform(i)?1:0,outlineColor:c,outlineSize:d?t.width:0,referenceSize:u/6,sprite:o,overrideOutlineColor:d&&null!=i.visualVariableColor,hasSizeVV:g.hasSizeVVUniform(i),placement:h,transforms:null,effects:null,scaleInfo:null,minPixelBuffer:y.getMaxSizeVVSize(i)})]}(e.marker,e,t)),d}e.createDotDensityMeshSchemas=async function(e,t){const{schemaOptions:r}=t,{store:i}=r,a=new Array(d.dotDensityMaxFields),n=new Array(d.dotDensityMaxFields/4);for(let t=0;t<d.dotDensityMaxFields;t++){const r=t<e.attributes.length?e.attributes[t].color:null;a[t]=[0,0,0,0],c.writeColor(a[t],r)}for(let t=0;t<d.dotDensityMaxFields/4;t++)n[t]=[0,0,0,0],n[t][0]=4*t<e.attributes.length?1:0,n[t][1]=4*t+1<e.attributes.length?1:0,n[t][2]=4*t+2<e.attributes.length?1:0,n[t][3]=4*t+3<e.attributes.length?1:0;const o={uniforms:{isActive:n,colors:a,dotValue:e.dotValue,dotScale:e.referenceScale,blending:e.dotBlendingEnabled,dotSize:e.dotSize,seed:e.seed},optionalAttributes:{}},l=i.ensureInstance(p.Techniques.dotDensity,o).createMeshInfo({effects:null}),u=[],f=new s({color:e.backgroundColor??[0,0,0,0],outline:null}),y=await m(f,t);if(u.push(...y),u.push(l),e.outline){const r=v(e.outline,t,!0);u.push(...r)}return u},e.createHeatmapMeshSchemas=async function(e,t){const{store:s}=t,{radius:a,minDensity:n,maxDensity:o,referenceScale:l,field:u,valueExpression:c,colorStops:d}=e,f=i.generateGradient(d);return[s.ensureInstance(p.Techniques.heatmap,{uniforms:{radius:r.pt2px(a),minDensity:n,maxDensity:o,referenceScale:l,isFieldActive:!(!u&&!c),gradient:f,gradientHash:f.join(",")},optionalAttributes:{}}).createMeshInfo({effects:null})]},e.createLineInstance=v,e.createPieChartMeshSchemas=async function(e,t){const{store:i}=t,s=e.outline?.width||0,a=y.createVisualVariableUniforms(e),n=i.ensureInstance(p.Techniques.pieChart,{uniforms:{shader:{outlineWidth:Math.round(r.pt2px(s)),defaultColor:f.premultiplyColor(e.defaultColor),outlineColor:f.premultiplyColor(e.outline?.color),othersColor:f.premultiplyColor(e.othersCategory?.color),donutRatio:e.holePercentage,sectorThreshold:e.othersCategory?.threshold||0,colors:e.attributes.map(e=>f.premultiplyColor(e.color)),visualVariableOpacity:a.visualVariableOpacity,visualVariableSizeMinMaxValue:a.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:a.visualVariableSizeScaleStops,visualVariableSizeStops:a.visualVariableSizeStops,visualVariableSizeUnitValue:a.visualVariableSizeUnitValue,hittestUniforms:null,highlightUniforms:null},numberOfFields:e.attributes.length},optionalAttributes:{}}).createMeshInfo({size:e.size,outlineWidth:s,effects:null,scaleInfo:null,minPixelBuffer:y.getMaxSizeVVSize(a)});return[...e.backgroundFillSymbol?await S(e.backgroundFillSymbol,{schemaOptions:t,uniforms:y.noVisualVariables}):[],n]},e.createSymbolMeshSchemas=m,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/MatcherSchema":function(){define(["exports","./VisualVariablesSchema","./symbols/SymbolSchema"],function(e,t,r){"use strict";e.createMatcherSchema=async function(e,i){if(!i)return{type:"simple",meshes:[]};switch(i.type){case"simple":return async function(e,i){const s=i.symbols,a=s.length?s[0]:null,n=t.createVisualVariableUniforms(i);return{type:"simple",meshes:await r.createSymbolMeshSchemas(a,{schemaOptions:e,uniforms:n})}}(e,i);case"dot-density":return async function(e,i){const s=t.createVisualVariableUniforms(i);return{type:"dot-density",meshes:await r.createDotDensityMeshSchemas(i,{schemaOptions:e,uniforms:s})}}(e,i);case"class-breaks":return async function(e,i){const s=t.createVisualVariableUniforms(i),a=i.backgroundFillSymbol,n=i.normalizationType,o="log"===n?"esriNormalizeByLog":"percent-of-total"===n?"esriNormalizeByPercentOfTotal":"field"===n?"esriNormalizeByField":null,l=i.classBreakInfos.map(async t=>({meshes:await r.createSymbolMeshSchemas(t.symbol,{path:`renderer-stop-${t.minValue}-${t.maxValue}`,schemaOptions:e,uniforms:s}),min:t.minValue,max:t.maxValue})),u=(await Promise.all(l)).sort((e,t)=>e.min-t.min),c=await r.createSymbolMeshSchemas(a,{schemaOptions:e,uniforms:{...t.noVisualVariables,visualVariableSizeOutlineScaleStops:s.visualVariableSizeOutlineScaleStops}}),d=await r.createSymbolMeshSchemas(i.defaultSymbol,{schemaOptions:e,uniforms:s});return{type:"interval",field:i.field,expression:i.valueExpression,backgroundFill:c,defaultSymbol:d,intervals:u,normalizationField:i.normalizationField,normalizationTotal:i.normalizationTotal,normalizationType:o,isMaxInclusive:i.isMaxInclusive}}(e,i);case"unique-value":return async function(e,i){const s=[],a=t.createVisualVariableUniforms(i),n=await r.createSymbolMeshSchemas(i.backgroundFillSymbol,{schemaOptions:e,uniforms:{...t.noVisualVariables,visualVariableSizeOutlineScaleStops:a.visualVariableSizeOutlineScaleStops}}),o=await r.createSymbolMeshSchemas(i.defaultSymbol,{schemaOptions:e,uniforms:a});for(const t of i.uniqueValueInfos??[]){const i=await r.createSymbolMeshSchemas(t.symbol,{path:`renderer-unique-value-${t.value}`,schemaOptions:e,uniforms:a});s.push({value:""+t.value,symbol:i})}return{type:"map",field:i.field,expression:i.valueExpression,field2:i.field2,field3:i.field3,fieldDelimiter:i.fieldDelimiter,backgroundFill:n,defaultSymbol:o,map:s}}(e,i);case"dictionary":return async function(e){const r=t.createVisualVariableUniforms(e),i=await e.getDictionaryInfo(),s=e.scaleExpression,a=null!=s&&"1"!==s?{valueExpressionInfo:{type:"CIMExpressionInfo",expression:e.scaleExpression,returnType:"Numeric"},defaultValue:1}:void 0;return{type:"dictionary",dictionaryInfo:i,userConfig:e.config??{},fieldMap:e.fieldMap??{},scaleExpression:a,visualVariableUniforms:r}}(i);case"heatmap":return async function(e,t){return{type:"heatmap",meshes:await r.createHeatmapMeshSchemas(t,e)}}(e,i);case"pie-chart":return async function(e,t){return{type:"pie-chart",meshes:await r.createPieChartMeshSchemas(t,e)}}(e,i)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/FeatureLayerAdapter":function(){define(["exports","../../../../../core/lang","../../../../../layers/support/arcgisLayerUrl","./featureReductionUtils","./featureServiceUtils","./floorFilterUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,s,a,n,o,l,u,c){"use strict";e.FeatureLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=o.getFeatureReductionDeconflictionEnabled(t,e)??o.getLayerDeconflictionEnabled(t),s=i.getEffectiveFeatureReduction(t,e),a=[...t.labelingInfo||[],...s?.labelingInfo||[]];return[{vvEvaluators:{0:o.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r,labelingInfo:a}]}async createServiceOptions(e){const i=this.layer,{capabilities:a,editingInfo:o,typeIdField:l,globalIdField:u,datesInUnknownTimezone:c,dateFieldsTimeZone:d,orderBy:p,subtypeField:f,refreshInterval:y}=i,h=i.fieldsIndex.toJSON(),g=n.getServiceGeometryType(i),m=i.timeInfo?.toJSON(),b=i.spatialReference.toJSON(),_=i.types?.map(e=>e.toJSON()),w=t.clone(this.layer.parsedUrl);this.layer.dynamicDataSource&&(w.query={layer:JSON.stringify({source:this.layer.dynamicDataSource})});let S=this.layer.objectIdField;if(p?.length){const e=!p[0].valueExpression&&p[0].field;e&&(S=e)}const v=r.isHostedAgolService(w.path),F=!(null!=o?.lastEditDate)&&y>0,I=s.createSnapshotInfo(v,F,a,g,e.extent,i.fullExtent),x=e.spatialReference.toJSON();return{type:"feature-service",source:w,isSourceHosted:v,orderByFields:S,outSpatialReference:x,metadata:{typeIdField:l??void 0,types:_,timeReferenceUnknownClient:c,dateFieldsTimeZone:d,subtypeField:f,globalIdField:u,fieldsIndex:h,geometryType:g,featureIdInfo:s.createFeatureIdInfo(i),timeInfo:m,spatialReference:b,outSpatialReference:x,subtypes:this.layer.subtypes?.map(e=>e.toJSON())},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:o?.lastEditDate?.getTime(),snapshotInfo:I}}}createSourceSchema(e,t){const{apiKey:r,definitionExpression:i,displayFilterInfo:s,customParameters:a,gdbVersion:n,historicMoment:o,subtypeCode:u,subtypeField:c,timeExtent:d}=this.layer,p={definitionExpression:i,displayFilterInfo:s,customParameters:a,gdbVersion:n,historicMoment:o,subtypeCode:u,subtypeField:c,timeExtent:d};return l.createFeatureSourceSchema(p,e,t,r)}createProcessorSchema(e,t,r){const{fields:s,renderer:a,geometryType:n,labelingInfo:o,labelsVisible:l,orderBy:c,objectIdField:d,trackInfo:p}=this.layer,f={fields:s.map(e=>e.toJSON()),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:i.getEffectiveFeatureReduction(this.layer,t),geometryType:n,labelingInfo:o,labelsVisible:l,objectIdField:d,orderBy:c??"default",trackInfo:p};return u.createSimpleProcessorSchema(e,t,f,r)}get hasRequiredSupport(){return c.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}addFilters(e,t){return a.addFloorFilter(this.layer,e,t)}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>i.getEffectiveFeatureReduction(this.layer,e),()=>a.hasFloorFilter(this.layer,e)?e.floors:null,()=>this.layer.gdbVersion,()=>this.layer.historicMoment,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy,()=>this.layer.outFields,()=>this.layer.renderer,()=>this.layer.subtypeCode,()=>this.layer.trackInfo]}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/featureServiceUtils":function(){define(["exports","../../../../../core/has"],function(e,t){"use strict";function r(e,r){return!(!e&&!t("featurelayer-snapshot-non-hosted-exceedslimit-enabled"))&&r?.operations.supportsExceedsLimitStatistics}e.createFeatureIdInfo=function(e){const{objectIdField:t,uniqueIdFields:r}=e;return r?.length?r.length>=2?{type:"unique-id-composite",fieldNames:r}:{type:"unique-id-simple",fieldName:r[0]}:{type:"object-id",fieldName:t}},e.createSnapshotInfo=function(e,i,s,a,n,o){const l=function(e){switch(e){case"esriGeometryMultipoint":return{min:t("featurelayer-snapshot-multipoint-min-threshold"),max:t("featurelayer-snapshot-multipoint-max-threshold")};case"esriGeometryPoint":return{min:t("featurelayer-snapshot-point-min-threshold"),max:t("featurelayer-snapshot-point-max-threshold")};case"esriGeometryMultiPatch":case"esriGeometryPolygon":return{min:t("featurelayer-snapshot-polygon-min-threshold"),max:t("featurelayer-snapshot-polygon-max-threshold")};case"esriGeometryPolyline":return{min:t("featurelayer-snapshot-polyline-min-threshold"),max:t("featurelayer-snapshot-polyline-max-threshold")}}}(a);if(!t("featurelayer-snapshot-enabled")||!s?.query.supportsPagination||s?.operations.supportsEditing||i)return null;const u=function(e,r){const i=r?.clone().intersection(e),s=null!=i?i.width*i.height:0,a=r?r.width*r.height:0,n=0===a?0:s/a,o=t("featurelayer-snapshot-coverage");return!isNaN(n)&&n>=o}(n,o),{min:c,max:d}=l,p=u?d:c,f=function(e){switch(e){case"esriGeometryPoint":return null;case"esriGeometryPolyline":case"esriGeometryPolygon":case"esriGeometryMultiPatch":case"esriGeometryMultipoint":return t("featurelayer-snapshot-max-vertex-count")}}(a);let y=t("featurelayer-snapshot-initial-tolerance");return"esriGeometryPoint"!==a&&"esriGeometryMultipoint"!==a||(y=null),{supportsExceedsLimit:r(e,s),initialTolerance:y,maxFeatureCount:p,maxVertexCount:f}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/floorFilterUtils":function(){define(["exports","../../../../../core/sql","../../../../../layers/support/FeatureFilter"],function(e,t,r){"use strict";e.addFloorFilter=function(e,i,s){const a=function(e,r,i){if(null==e.floorInfo||!i.floors?.length)return r;let s=i.floors;const{floorField:a,viewAllLevelIds:n}=e.floorInfo;n.length&&(s=n);const o=s.filter(e=>""!==e).map(e=>"'"+e+"'");if(o.push("''"),r?.includes(a)){let e=new RegExp("AND \\("+a+".*NULL\\)","g");r=r.replace(e,""),e=new RegExp("\\("+a+".*NULL\\)","g"),r=(r=r.replace(e,"")).replaceAll(/\s+/g," ").trim()}let l="("+a+" IN ({ids}) OR "+a+" IS NULL)";return l=l.replace("{ids}",o.join(", ")),t.sqlAnd(r,l)}(e,i?.where,s);return a?(i??=new r,i.where=a,i):i},e.hasFloorFilter=function(e,t){return null!=e.floorInfo&&(e.floorInfo.viewAllLevelIds.length>0||t.floors.length>0)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/InMemoryLayerAdapter":function(){define(["exports","../../../../../core/Error","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,s,a,n,o){"use strict";e.InMemoryLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,i=s.getFeatureReductionDeconflictionEnabled(t,e)??s.getLayerDeconflictionEnabled(t),a=r.getEffectiveFeatureReduction(t,e),n=[...t.labelingInfo||[],...a?.labelingInfo||[]];return[{vvEvaluators:{0:s.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:i,labelingInfo:n}]}async createServiceOptions(e){const r=this.layer,{capabilities:s,objectIdField:a}=r,n=r.fieldsIndex.toJSON(),o=i.getServiceGeometryType(r),l=r.timeInfo?.toJSON(),u=r.spatialReference.toJSON();!function(e){if(!("openPorts"in e))throw new t("featurelayer:source-not-supported","source is not supported")}(r.source);const c=await r.source.openPorts(),d=a,p=e.spatialReference.toJSON();return{type:"memory",source:c,orderByFields:d,outSpatialReference:p,metadata:{fieldsIndex:n,geometryType:o,featureIdInfo:{type:"object-id",fieldName:r.objectIdField},timeInfo:l,spatialReference:u,outSpatialReference:p,subtypes:null,subtypeField:null,globalIdField:null,typeIdField:null,types:null,timeReferenceUnknownClient:"datesInUnknownTimezone"in r?r.datesInUnknownTimezone:null,dateFieldsTimeZone:"dateFieldsTimeZone"in r?r.dateFieldsTimeZone:null},queryMetadata:{maxRecordCount:s.query.maxRecordCount,supportsCompactGeometry:s.query.supportsCompactGeometry,supportsDefaultSpatialReference:s.query.supportsDefaultSpatialReference,supportsFormatPBF:s.query.supportsFormatPBF,supportsMaxRecordCountFactor:s.query.supportsMaxRecordCountFactor,supportsQuantization:s.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:r,timeExtent:i,displayFilterInfo:s}=this.layer,n={customParameters:null,definitionExpression:r,displayFilterInfo:s,timeExtent:i};return a.createFeatureSourceSchema(n,e,t,null)}createProcessorSchema(e,t,i){const{fields:s,renderer:a,geometryType:o,labelingInfo:l,labelsVisible:u,orderBy:c,objectIdField:d}=this.layer,p="trackInfo"in this.layer?this.layer.trackInfo:null,f={fields:s.map(e=>e.toJSON()),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:r.getEffectiveFeatureReduction(this.layer,t),geometryType:o,labelingInfo:l,labelsVisible:u,objectIdField:d,orderBy:c??"default",trackInfo:p};return n.createSimpleProcessorSchema(e,t,f,i)}get hasRequiredSupport(){return o.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.definitionExpression,()=>this.layer.displayFilterInfo,()=>this.layer.orderBy,()=>"outFields"in this.layer?this.layer.outFields:null,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>r.getEffectiveFeatureReduction(this.layer,e),()=>"trackInfo"in this.layer?this.layer.trackInfo:null]}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/KnowledgeGraphSublayerAdapter":function(){define(["exports","../../../../../core/sql","../../../../../layers/knowledgeGraph/constants","../../../../../layers/support/FeatureFilter","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,s,a,n,o,l,u){"use strict";function c(e){return"link-chart"===e.parentCompositeLayer.type&&"hidden"===e.parentCompositeLayer.linkChart?.linkChartProperties.nonspatialDataDisplay?.mode}e.KnowledgeGraphSublayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=n.getFeatureReductionDeconflictionEnabled(t,e)??n.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:n.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const t=this.layer,{capabilities:r,objectIdField:i}=t,s=t.fieldsIndex.toJSON(),n=a.getServiceGeometryType(t),o=t.spatialReference.toJSON(),l=await t.source.openPorts(),u=i,c=e.spatialReference.toJSON();return{type:"memory",source:l,orderByFields:u,outSpatialReference:c,metadata:{fieldsIndex:s,geometryType:n,featureIdInfo:{type:"object-id",fieldName:t.objectIdField},spatialReference:o,outSpatialReference:c,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:t.timeInfo?.toJSON(),timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:r.query.maxRecordCount,supportsCompactGeometry:r.query.supportsCompactGeometry,supportsDefaultSpatialReference:r.query.supportsDefaultSpatialReference,supportsFormatPBF:r.query.supportsFormatPBF,supportsMaxRecordCountFactor:r.query.supportsMaxRecordCountFactor,supportsQuantization:r.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:i}=this.layer,s={definitionExpression:r,displayFilterInfo:i,customParameters:null};return o.createFeatureSourceSchema(s,e,t,null)}createProcessorSchema(e,t,r){const{fields:i,renderer:a,geometryType:n,labelingInfo:o,labelsVisible:u,objectIdField:c}=this.layer,d={fields:i.map(e=>e.toJSON()),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:s.getEffectiveFeatureReduction(this.layer,t),geometryType:n,labelingInfo:o,labelsVisible:u,objectIdField:c,orderBy:"default"};return l.createSimpleProcessorSchema(e,t,d,r)}get hasRequiredSupport(){return u.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>s.getEffectiveFeatureReduction(this.layer,e),()=>c(this.layer)]}hasFilters(e){return c(this.layer)}addFilters(e,s){if(c(this.layer)){const s=t.sqlAnd(e?.where,`${r.systemIsSpatialFieldName}=1`);if(!s)return e;e??=new i,e.where=s}return e}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/knowledgeGraph/constants":function(){define(["exports"],function(e){"use strict";e.systemAggregationCountFieldName="ESRI__AggregationCount",e.systemDestinationIdFieldName="ESRI__DestID",e.systemIsSpatialFieldName="LC.ESRI__IsSpatial",e.systemLayoutGeometryFieldName="ESRI__LayoutGeometry",e.systemOidFieldName="ESRI__ID",e.systemOriginIdFieldName="ESRI__OriginID",Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OGCFeatureLayerAdapter":function(){define(["exports","../../../../../core/lang","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,s,a,n,o){"use strict";e.OGCFeatureLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=s.getFeatureReductionDeconflictionEnabled(t,e)??s.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:s.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r,labelingInfo:t.labelingInfo}]}async createServiceOptions(e){const r=this.layer,{capabilities:s}=r,a=r.fieldsIndex.toJSON(),n=i.getServiceGeometryType(r),o=r.timeInfo?.toJSON(),l=r.spatialReference.toJSON(),u=r.source.getSource(),c=this.layer.objectIdField,d=t.clone(s);d.query.maxRecordCount=u.maxRecordCount;const p=e.spatialReference.toJSON();return{type:"ogc",source:u,orderByFields:c,outSpatialReference:p,metadata:{fieldsIndex:a,geometryType:n,featureIdInfo:{type:"object-id",fieldName:r.objectIdField},timeInfo:o,spatialReference:l,outSpatialReference:p,globalIdField:null,subtypeField:null,subtypes:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:d.query.maxRecordCount,supportsCompactGeometry:d.query.supportsCompactGeometry,supportsDefaultSpatialReference:d.query.supportsDefaultSpatialReference,supportsFormatPBF:d.query.supportsFormatPBF,supportsMaxRecordCountFactor:d.query.supportsMaxRecordCountFactor,supportsQuantization:d.query.supportsQuantization,lastEditDate:null,snapshotInfo:null}}}createSourceSchema(e,t){const{customParameters:r,timeExtent:i,apiKey:s}=this.layer,n={customParameters:r,timeExtent:i};return a.createFeatureSourceSchema(n,e,t,s)}createProcessorSchema(e,t,i){const{fields:s,renderer:a,geometryType:o,labelingInfo:l,labelsVisible:u,orderBy:c,objectIdField:d}=this.layer,p={fields:s.map(e=>e.toJSON()),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:r.getEffectiveFeatureReduction(this.layer,t),geometryType:o,labelingInfo:l,labelsVisible:u,objectIdField:d,orderBy:c??"default"};return n.createSimpleProcessorSchema(e,t,p,i)}get hasRequiredSupport(){return o.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>r.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>this.layer.orderBy,()=>this.layer.renderer]}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/OrientedImageryLayerAdapter":function(){define(["exports","../../../../../core/lang","../../../../../layers/support/arcgisLayerUrl","./featureReductionUtils","./featureServiceUtils","./floorFilterUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,s,a,n,o,l,u,c){"use strict";e.OrientedImageryLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer,r=o.getFeatureReductionDeconflictionEnabled(t,e)??o.getLayerDeconflictionEnabled(t);return[{vvEvaluators:{0:o.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r}]}async createServiceOptions(e){const i=this.layer,{capabilities:a,globalIdField:o,orderBy:l,refreshInterval:u}=i,c=i.fieldsIndex.toJSON(),d=n.getServiceGeometryType(i),p=i.timeInfo?.toJSON(),f=i.spatialReference.toJSON(),y=t.clone(this.layer.parsedUrl);let h=this.layer.objectIdField;if(l?.length){const e=!l[0].valueExpression&&l[0].field;e&&(h=e)}const g=u>0,m=r.isHostedAgolService(y.path),b=e.spatialReference.toJSON(),_=s.createSnapshotInfo(m,g,a,d,e.extent,i.fullExtent);return{type:"feature-service",source:y,isSourceHosted:m,orderByFields:h,outSpatialReference:b,metadata:{globalIdField:o,fieldsIndex:c,geometryType:d,featureIdInfo:{type:"object-id",fieldName:i.objectIdField},timeInfo:p,spatialReference:f,outSpatialReference:b,timeReferenceUnknownClient:i.datesInUnknownTimezone,dateFieldsTimeZone:i.dateFieldsTimeZone,subtypeField:null,subtypes:null,typeIdField:null,types:null},queryMetadata:{maxRecordCount:a.query.maxRecordCount,supportsCompactGeometry:a.query.supportsCompactGeometry,supportsDefaultSpatialReference:a.query.supportsDefaultSpatialReference,supportsFormatPBF:a.query.supportsFormatPBF,supportsMaxRecordCountFactor:a.query.supportsMaxRecordCountFactor,supportsQuantization:a.query.supportsQuantization,lastEditDate:null,snapshotInfo:_}}}createSourceSchema(e,t){const{definitionExpression:r,displayFilterInfo:i,customParameters:s,timeExtent:a}=this.layer,n={definitionExpression:r,displayFilterInfo:i,customParameters:s,timeExtent:a};return l.createFeatureSourceSchema(n,e,t,null)}createProcessorSchema(e,t,r){const{fields:s,renderer:a,geometryType:n,labelingInfo:o,labelsVisible:l,orderBy:c,objectIdField:d}=this.layer,p={fields:s.map(e=>e.toJSON()),renderer:a?.clone(),labelingInfoSource:this.layer.id,featureReduction:i.getEffectiveFeatureReduction(this.layer,t),geometryType:n,labelingInfo:o,labelsVisible:l,objectIdField:d,orderBy:c??"default"};return u.createSimpleProcessorSchema(e,t,p,r)}get hasRequiredSupport(){return c.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}addFilters(e,t){return a.addFloorFilter(this.layer,e,t)}getUpdateHashProperties(e){return[()=>this.layer.outFields,()=>this.layer.orderBy,()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>i.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>a.hasFloorFilter(this.layer,e)?e.floors:null]}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/ParquetLayerAdapter":function(){define(["exports","../../../../../core/Error","../../../../../layers/support/parquetUtils","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,s,a,n,o){"use strict";e.ParquetLayerAdapter=class{constructor(e){this.layer=e}get hasRequiredSupport(){return o.isRendererSupported(this.layer.renderer)}get timeOptions(){return null}getLabelingDeconflictionInfo(e){const t=this.layer,r=a.getFeatureReductionDeconflictionEnabled(t,e)??a.getLayerDeconflictionEnabled(t),s=i.getEffectiveFeatureReduction(t,e),n=[...t.labelingInfo||[],...s?.labelingInfo||[]];return[{vvEvaluators:{0:a.createLabelVVEvaluator(t.renderer)},deconflictionEnabled:r,labelingInfo:n}]}getUpdateHashProperties(e){return[()=>this.layer.outFields,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>i.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>this.layer.orderBy,()=>this.layer.renderer,()=>this.layer.popupTemplate]}async createServiceOptions(e){const i=s.getServiceGeometryType(this.layer),a=e.spatialReference.toJSON(),n=this.layer.encoding;if(null==n)throw new t("parquet-layer:unsupported","creating a parquet layer view requires an encoding",{layer:this.layer});return{type:"parquet",source:{urls:this.layer.urls.items},outSpatialReference:a,geometryInfo:{geometryType:r.toParquetJSONGeometryType(this.layer.geometryType),spatialReference:this.layer.spatialReference.toJSON(),encoding:n.toJSON(),displayOptimization:this.layer.displayOptimization},metadata:{spatialReference:this.layer.spatialReference.toJSON(),outSpatialReference:a,fieldsIndex:this.layer.fieldsIndex.toJSON(),featureIdInfo:{type:"object-id",fieldName:this.layer.objectIdField},geometryType:i,types:null,subtypes:null,timeInfo:null,typeIdField:null,subtypeField:null,globalIdField:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null}}}createSourceSchema(e,t){return{type:"parquet",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields.includes("*")?this.layer.fields.map(e=>e.name):e.availableFields,dataFilter:{customParameters:this.layer.customParameters??null}}}}createProcessorSchema(e,t,r){const s={fields:this.layer.fields.map(e=>e.toJSON()),renderer:this.layer.renderer?.clone(),labelingInfoSource:this.layer.id,featureReduction:i.getEffectiveFeatureReduction(this.layer,t),geometryType:this.layer.geometryType,labelingInfo:this.layer.labelingInfo,labelsVisible:this.layer.labelsVisible,objectIdField:this.layer.objectIdField,orderBy:this.layer.orderBy};return n.createSimpleProcessorSchema(e,t,s,r)}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/parquetUtils":function(){define(["exports","../../core/Collection","../../core/Error","../../core/jsonMap","../../geometry/SpatialReference","./Field","./locationUtils","./ParquetEncodingLocation","./ParquetEncodingWkb","../../libs/parquet/parquet"],function(e,t,r,i,s,a,n,o,l,u){"use strict";const c=new i.JSONMap({esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint"});async function d(e,t={}){if(e.geometryType&&e.spatialReference&&e.encoding&&e.fields)return e;if(e.urls.length<1)throw new r("parquet:bad-input","At least one url must be specified",e);const i=await u.createParquetFile(e.urls.getItemAt(0),{getCustomParameters:()=>t.customParameters}),c=u.readGeoMetadata(i),d={...e,file:i};null==d.fields&&(d.fields=i.fields().map(e=>a.fromJSON({name:e.name,type:e.type}))),null==d.encoding&&(d.encoding=function(e,t){if(null!=e){const t=e.primary_column,r=e.columns[t];return new l({primaryFieldName:t,orientation:r.orientation??null})}const r=n.inferLocationInfo(t.map(e=>e.name));return r.latitudeFieldName&&r.latitudeFieldName?new o({latitudeFieldName:r.latitudeFieldName,longitudeFieldName:r.longitudeFieldName}):null}(c,d.fields));const f=u.readEsriMetadata(i);if(f)switch(f.mode){case"z":d.displayOptimization={mode:"z"};break;case"xz":{const e=f.multiscale;if(!e)throw new r("bad-format","XZ display optimization requires multiscale geometries");d.displayOptimization={mode:"xz",multiscale:e};break}}if(!d.encoding)return d;switch(d.encoding.type){case"location":null==d.spatialReference&&(d.spatialReference=s.WGS84),null==d.geometryType&&(d.geometryType="point");break;case"wkb":{if(!c)return d;const e=c.primary_column,t=c.columns[e];if(d.geometryType||(d.geometryType=function(e){const{geometry_types:t}=e,i=new Set;for(const e of t){const t=p(e);t&&i.add(t)}if(i.size>1)throw new r("unsupported","Parquet mixed geometry types are not support",{geometryTypes:i});return 1===i.size?i.values().next().value:void 0}(t)),d.spatialReference||(d.spatialReference=function(e){const t=e.crs?.id?.code;return t&&"number"==typeof t?new s({wkid:t}):void 0}(t)),d.fields)for(const e of Object.keys(c.columns))d.fields=d.fields.filter(t=>t.name!==e)}}return d}function p(e){switch(e){case"Point":return"point";case"Polygon":case"MultiPolygon":return"polygon";case"LineString":return"polyline";case"MultiPoint":return"multipoint";default:return null}}e.completeParquetLayerInfo=d,e.getParquetLayerInfo=function(e,r={}){return d({urls:new t(e)},r)},e.parquetGeometryTypeKebabDict=c,e.toParquetJSONGeometryType=function(e){return c.toJSON(e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/locationUtils":function(){define(["exports","./fieldUtils"],function(e,t){"use strict";const r=["lat","lat83","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],i=["lon","lng","lng83","long","long83","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"];e.inferLocationInfo=function(e,s,a){s=t.normalizeFieldName(s)?.toLowerCase(),a=t.normalizeFieldName(a)?.toLowerCase();const n=e.map(e=>e.toLowerCase()),o=s?e[n.indexOf(s)]:null,l=a?e[n.indexOf(a)]:null;return{longitudeFieldName:o||e[n.indexOf(i.find(e=>n.includes(e)))],latitudeFieldName:l||e[n.indexOf(r.find(e=>n.includes(e)))]}},e.latitudeFieldNames=r,e.longitudeFieldNames=i,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ParquetEncodingLocation":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n){"use strict";let o=class extends t.JSONSupport{constructor(e){super(e),this.type="location",this.latitudeFieldName=null,this.longitudeFieldName=null}};return e.__decorate([r.property({type:["location"],readOnly:!0,json:{write:!0}})],o.prototype,"type",void 0),e.__decorate([r.property({json:{write:!0}})],o.prototype,"latitudeFieldName",void 0),e.__decorate([r.property({json:{write:!0}})],o.prototype,"longitudeFieldName",void 0),o=e.__decorate([n.subclass("esri.layers.support.ParquetEncodingLocation")],o),o})},"esri/layers/support/ParquetEncodingWkb":function(){define(["../../chunks/tslib.es6","../../core/JSONSupport","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n){"use strict";let o=class extends t.JSONSupport{constructor(e){super(e),this.type="wkb",this.primaryFieldName=null}};return e.__decorate([r.property({type:["wkb"],readOnly:!0,json:{write:!0}})],o.prototype,"type",void 0),e.__decorate([r.property({json:{write:!0}})],o.prototype,"orientation",void 0),e.__decorate([r.property({json:{write:!0}})],o.prototype,"primaryFieldName",void 0),o=e.__decorate([n.subclass("esri.layers.support.ParquetEncodingWkb")],o),o})},"esri/libs/parquet/parquet":function(){define(["exports","../../request","../../core/Error","./loadParquetModule","../../chunks/bundle"],function(e,t,r,i,s){"use strict";function a(e,t){const i=e.spatialReference.wkid,a=t.wkid;if(!i||!a)throw new r("parquet","Unable to create ParquetFile, in and out wkid must be specified");const n=function(e){switch(e){case"esriGeometryPoint":return s.GeometryType.Point;case"esriGeometryPolygon":return s.GeometryType.Polygon;case"esriGeometryPolyline":return s.GeometryType.Polyline;case"esriGeometryMultipoint":return s.GeometryType.Multipoint;default:throw new r("parquet",`Found unexpected GeometryType: ${e}`)}}(e.geometryType),o=function(e){switch(e.encoding.type){case"wkb":return s.PrimaryGeometryField.fromWkb(e.encoding.primaryFieldName);case"location":{const{latitudeFieldName:t,longitudeFieldName:r}=e.encoding;return s.PrimaryGeometryField.fromLocation(t,r)}}}(e),l=[];if("xz"===e.displayOptimization?.mode){const t=e.displayOptimization.multiscale;for(const e of t.levels??[]){const[t,r]=e.transform.translate,[i,a]=e.transform.scale,n=new Float64Array([t,r]),o=new Float64Array([i,a]);l.push(s.MultiscaleGeometryField.new(e.level,e.column,n,o))}}return s.GeometryInfo.new(n,i,a,o,l)}e.createParquetFile=async function(e,r={}){const{ParquetFile:s}=await i.loadParquetModule(),n=(o=r.getCustomParameters,async function(e,r,i,s){const a=o?.(),n=a?{...a,debug:s}:{debug:s},{data:l}=await t(e,{responseType:"array-buffer",query:n,headers:{range:`bytes=${r}-${i}`}});return l});var o;const l=(e=>async function(r){const{data:i}=await t(r,{responseType:"native",method:"head",query:e?.()}),s=i.headers.get("Content-Length");if(null==s)throw new Error("Unable to parse content length");return parseInt(s,10)})(r.getCustomParameters),u=r.geometryInfo?a(r.geometryInfo,r.outSpatialReference??r.geometryInfo.spatialReference):null;return s.fromUrl(e,n,l,u)},e.createParquetFileFromBytes=async function(e,t={}){const{ParquetFile:r}=await i.loadParquetModule(),s=t.geometryInfo?a(t.geometryInfo,t.outSpatialReference):null;return r.fromBinary(e,s)},e.readEsriMetadata=function(e){const t=e.keyValueMetadata("esri");return null!=t?JSON.parse(t):null},e.readGeoMetadata=function(e){const t=e.keyValueMetadata("geo");return null!=t?JSON.parse(t):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/libs/parquet/loadParquetModule":function(){define(["require","exports","../../assets"],function(e,t,r){"use strict";let i=null;t.loadParquetModule=async function(){return i||(i=async function(){const t=await new Promise((t,r)=>e(["../../chunks/bundle"],t,r));return await t.default({module_or_path:r.getAssetUrl("esri/libs/parquet/pkg/bundle_bg.wasm")}),t}()),i},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/bundle":function(){define(["exports"],function(e){"use strict";let t;function r(e){const r=t.__externref_table_alloc();return t.__wbindgen_export_2.set(r,e),r}function i(e,i){try{return e.apply(this,i)}catch(e){const i=r(e);t.__wbindgen_exn_store(i)}}Symbol.dispose||(Symbol.dispose=Symbol("Symbol.dispose"));const s="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&s.decode();let a=null;function n(){return null!==a&&0!==a.byteLength||(a=new Uint8Array(t.memory.buffer)),a}function o(e,t){return e>>>=0,s.decode(n().subarray(e,e+t))}let l=0;const u="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},c="function"==typeof u.encodeInto?function(e,t){return u.encodeInto(e,t)}:function(e,t){const r=u.encode(e);return t.set(r),{read:e.length,written:r.length}};function d(e,t,r){if(void 0===r){const r=u.encode(e),i=t(r.length,1)>>>0;return n().subarray(i,i+r.length).set(r),l=r.length,i}let i=e.length,s=t(i,1)>>>0;const a=n();let o=0;for(;o<i;o++){const t=e.charCodeAt(o);if(t>127)break;a[s+o]=t}if(o!==i){0!==o&&(e=e.slice(o)),s=r(s,i,i=o+3*e.length,1)>>>0;const t=n().subarray(s+o,s+i);o+=c(e,t).written,s=r(s,i,o,1)>>>0}return l=o,s}let p=null;function f(){return(null===p||!0===p.buffer.detached||void 0===p.buffer.detached&&p.buffer!==t.memory.buffer)&&(p=new DataView(t.memory.buffer)),p}function y(e){return null==e}const h="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>{t.__wbindgen_export_6.get(e.dtor)(e.a,e.b)});let g=null;function m(){return null!==g&&0!==g.byteLength||(g=new Float64Array(t.memory.buffer)),g}let b=null;function _(){return null!==b&&0!==b.byteLength||(b=new Uint32Array(t.memory.buffer)),b}function w(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}function S(e,r){e>>>=0;const i=f(),s=[];for(let a=e;a<e+4*r;a+=4)s.push(t.__wbindgen_export_2.get(i.getUint32(a,!0)));return t.__externref_drop_slice(e,r),s}function v(e,t){const r=t(8*e.length,8)>>>0;return m().set(e,r/8),l=e.length,r}function F(e,t){const r=t(4*e.length,4)>>>0;return _().set(e,r/4),l=e.length,r}function I(e,r,i){t.closure83_externref_shim(e,r,i)}const x=Object.freeze({Point:0,0:"Point",Polygon:1,1:"Polygon",Polyline:2,2:"Polyline",Multipoint:3,3:"Multipoint"}),V=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeBigInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeString","esriFieldTypeDate","esriFieldTypeOID","esriFieldTypeGeometry","esriFieldTypeBlob","esriFieldTypeRaster","esriFieldTypeGUID","esriFieldTypeGlobalID","esriFieldTypeXML","esriFieldTypeDateOnly","esriFieldTypeTimeOnly","esriFieldTypeTimestampOffset"],E="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_columndescriptor_free(e>>>0,1));class T{static __wrap(e){e>>>=0;const t=Object.create(T.prototype);return t.__wbg_ptr=e,E.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,E.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_columndescriptor_free(e,0)}[Symbol.dispose](){this.free()}name(){let e,r;try{const i=t.columndescriptor_name(this.__wbg_ptr);return e=i[0],r=i[1],o(i[0],i[1])}finally{t.__wbindgen_free(e,r,1)}}physicalType(){let e,r;try{const i=t.columndescriptor_physicalType(this.__wbg_ptr);return e=i[0],r=i[1],o(i[0],i[1])}finally{t.__wbindgen_free(e,r,1)}}logicalType(){const e=t.columndescriptor_logicalType(this.__wbg_ptr);let r;return 0!==e[0]&&(r=o(e[0],e[1]).slice(),t.__wbindgen_free(e[0],1*e[1],1)),r}encodings(){const e=t.columndescriptor_encodings(this.__wbg_ptr);var r=S(e[0],e[1]).slice();return t.__wbindgen_free(e[0],4*e[1],4),r}pageEncodings(){const e=t.columndescriptor_pageEncodings(this.__wbg_ptr);let r;return 0!==e[0]&&(r=S(e[0],e[1]).slice(),t.__wbindgen_free(e[0],4*e[1],4)),r}numValues(){return t.columndescriptor_numValues(this.__wbg_ptr)}compression(){let e,r;try{const i=t.columndescriptor_compression(this.__wbg_ptr);return e=i[0],r=i[1],o(i[0],i[1])}finally{t.__wbindgen_free(e,r,1)}}compressedSize(){return t.columndescriptor_compressedSize(this.__wbg_ptr)}uncompressedSize(){return t.columndescriptor_uncompressedSize(this.__wbg_ptr)}nullCount(){const e=t.columndescriptor_nullCount(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}distinctCount(){const e=t.columndescriptor_distinctCount(this.__wbg_ptr);return 0===e[0]?void 0:e[1]}minValue(){return t.columndescriptor_minValue(this.__wbg_ptr)}maxValue(){return t.columndescriptor_maxValue(this.__wbg_ptr)}}const R="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_fieldmetadata_free(e>>>0,1));class O{static __wrap(e){e>>>=0;const t=Object.create(O.prototype);return t.__wbg_ptr=e,R.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,R.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_fieldmetadata_free(e,0)}[Symbol.dispose](){this.free()}get column(){return t.__wbg_get_fieldmetadata_column(this.__wbg_ptr)>>>0}set column(e){t.__wbg_set_fieldmetadata_column(this.__wbg_ptr,e)}get name(){let e,r;try{const i=t.fieldmetadata_name(this.__wbg_ptr);return e=i[0],r=i[1],o(i[0],i[1])}finally{t.__wbindgen_free(e,r,1)}}get type(){const e=t.fieldmetadata_esri_type(this.__wbg_ptr);return V[e]}get physicalType(){const e=t.fieldmetadata_physical_type(this.__wbg_ptr);let r;return 0!==e[0]&&(r=o(e[0],e[1]).slice(),t.__wbindgen_free(e[0],1*e[1],1)),r}get logicalType(){const e=t.fieldmetadata_logical_type(this.__wbg_ptr);let r;return 0!==e[0]&&(r=o(e[0],e[1]).slice(),t.__wbindgen_free(e[0],1*e[1],1)),r}}const C="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_geometryinfo_free(e>>>0,1));class k{static __wrap(e){e>>>=0;const t=Object.create(k.prototype);return t.__wbg_ptr=e,C.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,C.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_geometryinfo_free(e,0)}[Symbol.dispose](){this.free()}static new(e,i,s,a,n){w(a,D);var o=a.__destroy_into_raw();const u=function(e,t){const i=t(4*e.length,4)>>>0;for(let t=0;t<e.length;t++){const s=r(e[t]);f().setUint32(i+4*t,s,!0)}return l=e.length,i}(n,t.__wbindgen_malloc),c=l,d=t.geometryinfo_new(e,i,s,o,u,c);return k.__wrap(d)}}const M="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_multiscalegeometryfield_free(e>>>0,1));class P{static __wrap(e){e>>>=0;const t=Object.create(P.prototype);return t.__wbg_ptr=e,M.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof P?e.__destroy_into_raw():0}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,M.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_multiscalegeometryfield_free(e,0)}[Symbol.dispose](){this.free()}get level(){return t.__wbg_get_multiscalegeometryfield_level(this.__wbg_ptr)}set level(e){t.__wbg_set_multiscalegeometryfield_level(this.__wbg_ptr,e)}static new(e,r,i,s){const a=d(r,t.__wbindgen_malloc,t.__wbindgen_realloc),n=l,o=v(i,t.__wbindgen_malloc),u=l,c=v(s,t.__wbindgen_malloc),p=l,f=t.multiscalegeometryfield_new(e,a,n,o,u,c,p);return P.__wrap(f)}has_field(e){const r=d(e,t.__wbindgen_malloc,t.__wbindgen_realloc),i=l;return 0!==t.multiscalegeometryfield_has_field(this.__wbg_ptr,r,i)}}const q="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_pageencodingdescriptor_free(e>>>0,1));class A{static __wrap(e){e>>>=0;const t=Object.create(A.prototype);return t.__wbg_ptr=e,q.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,q.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_pageencodingdescriptor_free(e,0)}[Symbol.dispose](){this.free()}pageType(){let e,r;try{const i=t.pageencodingdescriptor_pageType(this.__wbg_ptr);return e=i[0],r=i[1],o(i[0],i[1])}finally{t.__wbindgen_free(e,r,1)}}encoding(){let e,r;try{const i=t.pageencodingdescriptor_encoding(this.__wbg_ptr);return e=i[0],r=i[1],o(i[0],i[1])}finally{t.__wbindgen_free(e,r,1)}}count(){return t.pageencodingdescriptor_count(this.__wbg_ptr)}}const U="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_parquetchunk_free(e>>>0,1));class L{static __wrap(e){e>>>=0;const t=Object.create(L.prototype);return t.__wbg_ptr=e,U.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,U.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_parquetchunk_free(e,0)}[Symbol.dispose](){this.free()}size(){return t.parquetchunk_size(this.__wbg_ptr)>>>0}isEmpty(e){return 0!==t.parquetchunk_isEmpty(this.__wbg_ptr,e)}rowId(e){return t.parquetchunk_rowId(this.__wbg_ptr,e)}readX(e){const r=t.parquetchunk_readX(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}readY(e){const r=t.parquetchunk_readY(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}readCoords(e){const r=t.parquetchunk_readCoords(this.__wbg_ptr,e);let i;var s,a;return 0!==r[0]&&(i=(s=r[0],a=r[1],s>>>=0,m().subarray(s/8,s/8+a)).slice(),t.__wbindgen_free(r[0],8*r[1],8)),i}readLengths(e){const r=t.parquetchunk_readLengths(this.__wbg_ptr,e);let i;var s,a;return 0!==r[0]&&(i=(s=r[0],a=r[1],s>>>=0,_().subarray(s/4,s/4+a)).slice(),t.__wbindgen_free(r[0],4*r[1],4)),i}transformGeometry(e,r,i,s,a,n){w(e,G);const o=t.parquetchunk_transformGeometry(this.__wbg_ptr,e.__wbg_ptr,r,i,s,a,n);return 16777215===o?void 0:0!==o}boundsXMin(e){const r=t.parquetchunk_boundsXMin(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}boundsYMin(e){const r=t.parquetchunk_boundsYMin(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}boundsXMax(e){const r=t.parquetchunk_boundsXMax(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}boundsYMax(e){const r=t.parquetchunk_boundsYMax(this.__wbg_ptr,e);return 0===r[0]?void 0:r[1]}readAttribute(e,r){return t.parquetchunk_readAttribute(this.__wbg_ptr,e,r)}}const z="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_parquetfile_free(e>>>0,1));class N{static __wrap(e){e>>>=0;const t=Object.create(N.prototype);return t.__wbg_ptr=e,z.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,z.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_parquetfile_free(e,0)}[Symbol.dispose](){this.free()}static fromUrl(e,r,i,s){const a=d(e,t.__wbindgen_malloc,t.__wbindgen_realloc),n=l;let o=0;return y(s)||(w(s,k),o=s.__destroy_into_raw()),t.parquetfile_fromUrl(a,n,r,i,o)}static fromBinary(e,r){const i=function(e,t){const r=t(1*e.length,1)>>>0;return n().set(e,r/1),l=e.length,r}(e,t.__wbindgen_malloc),s=l;let a=0;return y(r)||(w(r,k),a=r.__destroy_into_raw()),t.parquetfile_fromBinary(i,s,a)}version(){return t.parquetfile_version(this.__wbg_ptr)}numRows(){return t.parquetfile_numRows(this.__wbg_ptr)>>>0}numFields(){return t.parquetfile_numFields(this.__wbg_ptr)>>>0}numColumns(){return t.parquetfile_numColumns(this.__wbg_ptr)>>>0}createdBy(){const e=t.parquetfile_createdBy(this.__wbg_ptr);let r;return 0!==e[0]&&(r=o(e[0],e[1]).slice(),t.__wbindgen_free(e[0],1*e[1],1)),r}keyValueMetadata(e){const r=d(e,t.__wbindgen_malloc,t.__wbindgen_realloc),i=l,s=t.parquetfile_keyValueMetadata(this.__wbg_ptr,r,i);let a;return 0!==s[0]&&(a=o(s[0],s[1]).slice(),t.__wbindgen_free(s[0],1*s[1],1)),a}keys(){const e=t.parquetfile_keys(this.__wbg_ptr);let r;return 0!==e[0]&&(r=S(e[0],e[1]).slice(),t.__wbindgen_free(e[0],4*e[1],4)),r}columnForFieldName(e){const r=d(e,t.__wbindgen_malloc,t.__wbindgen_realloc),i=l,s=t.parquetfile_columnForFieldName(this.__wbg_ptr,r,i);return 4294967297===s?void 0:s}fields(){const e=t.parquetfile_fields(this.__wbg_ptr);var r=S(e[0],e[1]).slice();return t.__wbindgen_free(e[0],4*e[1],4),r}rowGroups(){const e=t.parquetfile_rowGroups(this.__wbg_ptr);var r=S(e[0],e[1]).slice();return t.__wbindgen_free(e[0],4*e[1],4),r}ensureFields(e){const r=F(e,t.__wbindgen_malloc),i=l;return t.parquetfile_ensureFields(this.__wbg_ptr,r,i)}readFirstChunk(e){const r=F(e,t.__wbindgen_malloc),i=l;return t.parquetfile_readFirstChunk(this.__wbg_ptr,r,i)}readChunk(e,r,i,s,a){const n=F(i,t.__wbindgen_malloc),o=l;return t.parquetfile_readChunk(this.__wbg_ptr,e,r,n,o,s,a)}readAllChunks(e,r,i){const s=F(e,t.__wbindgen_malloc),a=l;return t.parquetfile_readAllChunks(this.__wbg_ptr,s,a,r,i)}queryZChunks(e,r,i,s){const a=F(r,t.__wbindgen_malloc),n=l;return t.parquetfile_queryZChunks(this.__wbg_ptr,e,a,n,i,s)}queryXZChunks(e,r,i){return t.parquetfile_queryXZChunks(this.__wbg_ptr,e,r,i)}}const j="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_primarygeometryfield_free(e>>>0,1));class D{static __wrap(e){e>>>=0;const t=Object.create(D.prototype);return t.__wbg_ptr=e,j.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,j.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_primarygeometryfield_free(e,0)}[Symbol.dispose](){this.free()}static fromNative(e){const r=d(e,t.__wbindgen_malloc,t.__wbindgen_realloc),i=l,s=t.primarygeometryfield_fromNative(r,i);return D.__wrap(s)}static fromWkb(e){const r=d(e,t.__wbindgen_malloc,t.__wbindgen_realloc),i=l,s=t.primarygeometryfield_fromWkb(r,i);return D.__wrap(s)}static fromLocation(e,r){const i=d(e,t.__wbindgen_malloc,t.__wbindgen_realloc),s=l,a=d(r,t.__wbindgen_malloc,t.__wbindgen_realloc),n=l,o=t.primarygeometryfield_fromLocation(i,s,a,n);return D.__wrap(o)}}const B="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_quantizedgeometrybuffer_free(e>>>0,1));class G{static __wrap(e){e>>>=0;const t=Object.create(G.prototype);return t.__wbg_ptr=e,B.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,B.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_quantizedgeometrybuffer_free(e,0)}[Symbol.dispose](){this.free()}static new(){const e=t.quantizedgeometrybuffer_new();return G.__wrap(e)}readCoordsUnsafe(){return t.quantizedgeometrybuffer_readCoordsUnsafe(this.__wbg_ptr)}readLengthsUnsafe(){return t.quantizedgeometrybuffer_readLengthsUnsafe(this.__wbg_ptr)}}const H="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_rangeproviderjs_free(e>>>0,1));class J{static __wrap(e){e>>>=0;const t=Object.create(J.prototype);return t.__wbg_ptr=e,H.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,H.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_rangeproviderjs_free(e,0)}[Symbol.dispose](){this.free()}static new(e,r){const i=t.rangeproviderjs_new(e,r);return J.__wrap(i)}static withFetch(){const e=t.rangeproviderjs_withFetch();return J.__wrap(e)}}const W="undefined"==typeof FinalizationRegistry?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>t.__wbg_rowgroup_free(e>>>0,1));class Q{static __wrap(e){e>>>=0;const t=Object.create(Q.prototype);return t.__wbg_ptr=e,W.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,W.unregister(this),e}free(){const e=this.__destroy_into_raw();t.__wbg_rowgroup_free(e,0)}[Symbol.dispose](){this.free()}columnDescriptorForAttribute(e){const r=t.rowgroup_columnDescriptorForAttribute(this.__wbg_ptr,e);return T.__wrap(r)}}function $(){const e={wbg:{}};return e.wbg.__wbg_aborted_c078e36031795a9a=function(e){return e.aborted},e.wbg.__wbg_apply_36be6a55257c99bf=function(){return i(function(e,t,r){return e.apply(t,r)},arguments)},e.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return e.buffer},e.wbg.__wbg_call_672a4d21634d4a24=function(){return i(function(e,t){return e.call(t)},arguments)},e.wbg.__wbg_call_7cccdd69e0791ae2=function(){return i(function(e,t,r){return e.call(t,r)},arguments)},e.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,r){let i,s;try{i=e,s=r,console.error(o(e,r))}finally{t.__wbindgen_free(i,s,1)}},e.wbg.__wbg_fieldmetadata_new=function(e){return O.__wrap(e)},e.wbg.__wbg_get_67b2ba62fc30de12=function(){return i(function(e,t){return Reflect.get(e,t)},arguments)},e.wbg.__wbg_length_6ca527665d89694d=function(e){return e.length},e.wbg.__wbg_length_a446193dc22c12f8=function(e){return e.length},e.wbg.__wbg_multiscalegeometryfield_unwrap=function(e){return P.__unwrap(e)},e.wbg.__wbg_new_23a2665fac83c611=function(e,r){try{var i={a:e,b:r};const s=new Promise((e,r)=>{const s=i.a;i.a=0;try{return function(e,r,i,s){t.closure9_externref_shim(e,r,i,s)}(s,i.b,e,r)}finally{i.a=s}});return s}finally{i.a=i.b=0}},e.wbg.__wbg_new_8a6f238a6ece86ea=function(){return new Error},e.wbg.__wbg_new_a12002a7f91c75be=function(e){return new Uint8Array(e)},e.wbg.__wbg_new_e3b321dcfef89fc7=function(e){return new Uint32Array(e)},e.wbg.__wbg_newnoargs_105ed471475aaf50=function(e,t){return new Function(o(e,t))},e.wbg.__wbg_newwithbyteoffsetandlength_f1dead44d1fc7212=function(e,t,r){return new Uint32Array(e,t>>>0,r>>>0)},e.wbg.__wbg_newwithbyteoffsetandlength_f254047f7e80e7ff=function(e,t,r){return new Int16Array(e,t>>>0,r>>>0)},e.wbg.__wbg_newwithlength_c4c419ef0bc8a1f8=function(e){return new Array(e>>>0)},e.wbg.__wbg_pageencodingdescriptor_new=function(e){return A.__wrap(e)},e.wbg.__wbg_parquetchunk_new=function(e){return L.__wrap(e)},e.wbg.__wbg_parquetfile_new=function(e){return N.__wrap(e)},e.wbg.__wbg_queueMicrotask_98e746b9f850fe3d=function(e){queueMicrotask(e)},e.wbg.__wbg_queueMicrotask_c847cc8372bec908=function(e){return e.queueMicrotask},e.wbg.__wbg_resolve_4851785c9c5f573d=function(e){return Promise.resolve(e)},e.wbg.__wbg_rowgroup_new=function(e){return Q.__wrap(e)},e.wbg.__wbg_set_37837023f3d740e8=function(e,t,r){e[t>>>0]=r},e.wbg.__wbg_set_65595bdd868b3009=function(e,t,r){e.set(t,r>>>0)},e.wbg.__wbg_set_d23661d19148b229=function(e,t,r){e.set(t,r>>>0)},e.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,r){const i=d(r.stack,t.__wbindgen_malloc,t.__wbindgen_realloc),s=l;f().setInt32(e+4,s,!0),f().setInt32(e+0,i,!0)},e.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const e="undefined"==typeof global?null:global;return y(e)?0:r(e)},e.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const e="undefined"==typeof globalThis?null:globalThis;return y(e)?0:r(e)},e.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const e="undefined"==typeof self?null:self;return y(e)?0:r(e)},e.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const e="undefined"==typeof window?null:window;return y(e)?0:r(e)},e.wbg.__wbg_then_44b73946d2fb3e7d=function(e,t){return e.then(t)},e.wbg.__wbg_then_48b406749878a531=function(e,t,r){return e.then(t,r)},e.wbg.__wbg_valueOf_fdbb54fcdfe33477=function(e){return e.valueOf()},e.wbg.__wbindgen_array_new=function(){return[]},e.wbg.__wbindgen_array_push=function(e,t){e.push(t)},e.wbg.__wbindgen_bigint_from_i64=function(e){return e},e.wbg.__wbindgen_cb_drop=function(e){const t=e.original;return 1==t.cnt--&&(t.a=0,!0)},e.wbg.__wbindgen_closure_wrapper1683=function(e,r,i){const s=function(e,r,i,s){const a={a:e,b:r,cnt:1,dtor:84},n=(...e)=>{a.cnt++;const r=a.a;a.a=0;try{return s(r,a.b,...e)}finally{0===--a.cnt?(t.__wbindgen_export_6.get(a.dtor)(r,a.b),h.unregister(a)):a.a=r}};return n.original=a,h.register(n,a,a),n}(e,r,0,I);return s},e.wbg.__wbindgen_init_externref_table=function(){const e=t.__wbindgen_export_2,r=e.grow(4);e.set(0,void 0),e.set(r+0,void 0),e.set(r+1,null),e.set(r+2,!0),e.set(r+3,!1)},e.wbg.__wbindgen_is_function=function(e){return"function"==typeof e},e.wbg.__wbindgen_is_undefined=function(e){return void 0===e},e.wbg.__wbindgen_memory=function(){return t.memory},e.wbg.__wbindgen_number_get=function(e,t){const r="number"==typeof t?t:void 0;f().setFloat64(e+8,y(r)?0:r,!0),f().setInt32(e+0,!y(r),!0)},e.wbg.__wbindgen_number_new=function(e){return e},e.wbg.__wbindgen_string_new=function(e,t){return o(e,t)},e.wbg.__wbindgen_throw=function(e,t){throw new Error(o(e,t))},e.wbg.__wbindgen_uint8_array_new=function(e,r){var i,s,a=(i=e,s=r,i>>>=0,n().subarray(i/1,i/1+s)).slice();return t.__wbindgen_free(e,1*r,1),a},e}function Z(e,r){return t=e.exports,K.__wbindgen_wasm_module=r,p=null,g=null,b=null,a=null,t.__wbindgen_start(),t}async function K(e){if(void 0!==t)return t;void 0!==e&&(Object.getPrototypeOf(e)===Object.prototype?({module_or_path:e}=e):console.warn("using deprecated parameters for the initialization function; pass a single object instead"));const r=$();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));const{instance:i,module:s}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(t){if("application/wasm"==e.headers.get("Content-Type"))throw t;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",t)}const r=await e.arrayBuffer();return await WebAssembly.instantiate(r,t)}{const r=await WebAssembly.instantiate(e,t);return r instanceof WebAssembly.Instance?{instance:r,module:e}:r}}(await e,r);return Z(i,s)}e.ColumnDescriptor=T,e.FieldMetadata=O,e.GeometryInfo=k,e.GeometryType=x,e.MultiscaleGeometryField=P,e.PageEncodingDescriptor=A,e.ParquetChunk=L,e.ParquetFile=N,e.PrimaryGeometryField=D,e.QuantizedGeometryBuffer=G,e.RangeProviderJs=J,e.RowGroup=Q,e.default=K,e.enableTracing=function(){t.enableTracing()},e.initSync=function(e){if(void 0!==t)return t;void 0!==e&&(Object.getPrototypeOf(e)===Object.prototype?({module:e}=e):console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const r=$();return e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e)),Z(new WebAssembly.Instance(e,r),e)},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/StreamLayerAdapter":function(){define(["exports","./featureReductionUtils","./geometryUtils","./labelingUtils","../schema/processor/SimpleProcessorSchema","../support/rendererUtils"],function(e,t,r,i,s,a){"use strict";e.StreamLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const r=this.layer,s=i.getFeatureReductionDeconflictionEnabled(r,e)??i.getLayerDeconflictionEnabled(r),a=t.getEffectiveFeatureReduction(r,e),n=[...r.labelingInfo||[],...a?.labelingInfo||[]];return[{vvEvaluators:{0:i.createLabelVVEvaluator(r.renderer)},deconflictionEnabled:s,labelingInfo:n}]}async createServiceOptions(e){const t=this.layer,i=r.getServiceGeometryType(t),s=t.timeInfo?.toJSON()||null,a=t.spatialReference?t.spatialReference.toJSON():null,n=e.spatialReference.toJSON();return{type:"stream",source:this.layer.parsedUrl,outSpatialReference:n,metadata:{fieldsIndex:this.layer.fieldsIndex.toJSON(),geometryType:i,featureIdInfo:{type:"object-id",fieldName:this.layer.objectIdField},timeInfo:s,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,spatialReference:a,outSpatialReference:n,subtypeField:null,subtypes:null,globalIdField:null,typeIdField:null,types:null}}}createSourceSchema(e,t){const{definitionExpression:r,geometryDefinition:i,customParameters:s}=this.layer;return{type:"stream",mutable:{sourceRefreshVersion:t,availableFields:e.availableFields,dataFilter:{geometryDefinition:i?.toJSON(),definitionExpression:r,customParameters:s??null,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,purgeOptions:this.layer.purgeOptions.toJSON()}}}}createProcessorSchema(e,r,i){const{fields:a,renderer:n,geometryType:o,labelingInfo:l,labelsVisible:u,objectIdField:c,trackInfo:d}=this.layer,p={fields:a.map(e=>e.toJSON()),renderer:n?.clone(),labelingInfoSource:this.layer.id,featureReduction:t.getEffectiveFeatureReduction(this.layer,r),geometryType:o,labelingInfo:l,labelsVisible:u,objectIdField:c,orderBy:"default",trackInfo:d};return s.createSimpleProcessorSchema(e,r,p,i)}get hasRequiredSupport(){return a.isRendererSupported(this.layer.renderer)}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.definitionExpression,()=>this.layer.renderer,()=>this.layer.labelsVisible?this.layer.labelingInfo:null,()=>t.getEffectiveFeatureReduction(this.layer,e),()=>this.layer.customParameters,()=>this.layer.geometryDefinition,()=>this.layer.definitionExpression,()=>this.layer.trackInfo]}setGraphicOrigin(e){e.origin=this.layer.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/layerAdapters/SubtypeGroupLayerAdapter":function(){define(["exports","../../../../../core/lang","../../../../../core/mathUtils","../../../../../core/sql","../../../../../layers/support/arcgisLayerUrl","../../../../../layers/support/FeatureFilter","./featureServiceUtils","./floorFilterUtils","./geometryUtils","./labelingUtils","../schema/SourceSchema","../schema/processor/SubtypeProcessorSchema"],function(e,t,r,i,s,a,n,o,l,u,c,d){"use strict";e.SubtypeGroupLayerAdapter=class{constructor(e){this.layer=e}getLabelingDeconflictionInfo(e){const t=this.layer;return[{vvEvaluators:{},deconflictionEnabled:t.sublayers.some(e=>u.getLayerDeconflictionEnabled(e)),labelingInfo:t.sublayers.toArray().filter(e=>!!e.labelingInfo).flatMap(e=>e.labelingInfo)}]}async createServiceOptions(e){const r=this.layer,{capabilities:i,datesInUnknownTimezone:a,dateFieldsTimeZone:o,editingInfo:u,globalIdField:c,objectIdField:d,refreshInterval:p,subtypeField:f}=r,y=r.fieldsIndex.toJSON(),h=l.getServiceGeometryType(r),g=r.timeInfo?.toJSON(),m=r.spatialReference.toJSON(),b=t.clone(this.layer.parsedUrl),_=d,w=!(null!=u?.lastEditDate)&&p>0,S=s.isHostedAgolService(b.path),v=e.spatialReference.toJSON(),F=n.createSnapshotInfo(S,w,i,h,e.extent,r.fullExtent);return{type:"feature-service",source:b,isSourceHosted:S,orderByFields:_,outSpatialReference:v,metadata:{timeReferenceUnknownClient:a,dateFieldsTimeZone:o,subtypeField:f,globalIdField:c,fieldsIndex:y,geometryType:h,featureIdInfo:n.createFeatureIdInfo(this.layer),timeInfo:g,spatialReference:m,outSpatialReference:v,subtypes:this.layer.subtypes?.map(e=>e.toJSON()),typeIdField:null,types:null},queryMetadata:{maxRecordCount:i.query.maxRecordCount,supportsCompactGeometry:i.query.supportsCompactGeometry,supportsDefaultSpatialReference:i.query.supportsDefaultSpatialReference,supportsFormatPBF:i.query.supportsFormatPBF,supportsMaxRecordCountFactor:i.query.supportsMaxRecordCountFactor,supportsQuantization:i.query.supportsQuantization,lastEditDate:u?.lastEditDate?.getTime(),snapshotInfo:F}}}createSourceSchema(e,t){const{definitionExpression:r,customParameters:i,gdbVersion:s,historicMoment:a,subtypeField:n,timeExtent:o,apiKey:l,displayFilterInfo:u}=this.layer,d={queryScaleRanges:this.layer.sublayers.items.map(e=>({subtypeCode:e.subtypeCode,minScale:e.minScale,maxScale:e.maxScale})),definitionExpression:r,displayFilterInfo:u,customParameters:i,gdbVersion:s,historicMoment:a,subtypeField:n,timeExtent:o};return c.createFeatureSourceSchema(d,e,t,l)}createProcessorSchema(e,t,r){const i={labelingInfoSource:this.layer.id,subtypeField:this.layer.subtypeField,sublayers:Array.from(this.layer.sublayers,(e,t)=>({featureReduction:null,geometryType:this.layer.geometryType,labelingInfoSource:this.layer.id+`-${t}`,labelingInfo:e.labelingInfo,labelsVisible:e.labelsVisible,renderer:e.renderer,subtypeCode:e.subtypeCode,orderBy:null}))};return d.createSubtypeProcessorSchema(e,t,i,r)}addFilters(e,t){e=o.addFloorFilter(this.layer,e,t);const s=this.layer.sublayers.filter(e=>!function(e,t){return e.visible&&(0===e.minScale||r.floatEqualAbsolute(t.scale,e.minScale)||t.scale<e.minScale)&&(0===e.maxScale||r.floatEqualAbsolute(t.scale,e.maxScale)||t.scale>e.maxScale)}(e,t)).map(e=>e.subtypeCode);if(!s.length)return e;e??=new a;const n=`NOT ${this.layer.subtypeField} IN (${s.join(",")})`;return e.where=i.sqlAnd(e.where,n),e}get hasRequiredSupport(){return!0}get timeOptions(){return this.layer}getUpdateHashProperties(e){return[()=>this.layer.apiKey,()=>this.layer.customParameters,()=>this.layer.definitionExpression,()=>o.hasFloorFilter(this.layer,e)?e.floors:null,()=>this.layer.outFields,()=>this.layer.gdbVersion,()=>this.layer.historicMoment,()=>this.layer.sublayers.map(({renderer:e,labelsVisible:t,labelingInfo:r,visible:i,minScale:s,maxScale:a})=>({renderer:e,labelsVisible:t,labelingInfo:r,visible:i,minScale:s,maxScale:a}))]}setGraphicOrigin(e){const t=this.layer.findSublayerForFeature(e);e.layer=e.sourceLayer=t,e.origin=t?.graphicOrigin}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/features/schema/processor/SubtypeProcessorSchema":function(){define(["exports","./LabelMatcherSchema","./MatcherSchema","./StorageSchema","./VisualVariablesSchema","../../../../../webgl/capabilities"],function(e,t,r,i,s,a){"use strict";async function n(e,{subtypeField:t,sublayers:i}){const s=await Promise.all(i.map(({renderer:t})=>r.createMatcherSchema(e,t)));return{type:"subtype",subtypeField:t,renderers:i.reduce((e,{subtypeCode:t},r)=>({...e,[t]:s[r]}),{})}}function o(e,t){const r=a.getWebGLCapabilities();return{type:"multi",filters:e.filters,capabilities:{maxTextureSize:r.maxTextureSize},keyField:t.subtypeField,target:"feature",bindings:t.sublayers.reduce((e,{renderer:t,subtypeCode:r})=>{const s=i.createVVBindings(t);return{...e,[r]:s}},{})}}async function l(e,{subtypeField:r,sublayers:i,labelingInfoSource:a}){const n=await Promise.all(i.map(r=>{const i=s.createVisualVariableUniforms(r.renderer),n={...r,geometryType:r.geometryType??null,labelingInfoSource:a};return t.createLabelMatcherSchema(e,n,i)}));return{type:"subtype",subtypeField:r,renderers:i.reduce((e,{subtypeCode:t},r)=>({...e,[t]:n[r]}),{})}}e.createSubtypeProcessorSchema=async function(e,t,r,i){return{storage:o(t,r),mesh:{properties:{timeZone:t.timeZone,displayRefreshVersion:i,returnMeshObjectId:!1,sortKey:null,currentUser:t.currentUser},strategy:{type:"feature"},factory:{symbology:await n(e,r),labels:await l(e,r)}},expressionProperties:{timeExtent:t.timeExtent?.toJSON()}}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/DebouncedFeatureOverride":function(){define(["exports"],function(e){"use strict";e.DebouncedFeatureOverride=class{constructor(){this._commands=new Map,this._historicMoment=null}add(e){switch(e.type){case"override":return this._addOverride(e);case"override-by-id":return this._addOverrideById(e)}}toMessage(){const e={historicMoment:this._historicMoment,commands:{updateByIdWeak:[],updateWeak:[],removeWeak:[],update:[],remove:[],release:[]}};for(const[t,r]of this._commands.entries())switch(r.type){case"override-update-by-id":e.commands.updateByIdWeak.push(t);break;case"override-update":r.isWeak?e.commands.updateWeak.push(r.feature):e.commands.update.push(r.feature);break;case"override-remove":r.isWeak?e.commands.removeWeak.push(t):e.commands.remove.push(t);break;case"override-release":e.commands.release.push(t)}return e}_addOverrideById(e){this._historicMoment=e.historicMoment;for(const t of e.updates)this._commands.set(t,{type:"override-update-by-id",isWeak:e.isWeak});for(const t of e.removed)this._commands.set(t,{type:"override-remove",isWeak:e.isWeak})}_addOverride(e){this._historicMoment=e.historicMoment;for(const t of e.updates)this._commands.set(t.objectId,{type:"override-update",feature:t,isWeak:e.isWeak});for(const t of e.removed)this._commands.set(t,{type:"override-remove",isWeak:e.isWeak});for(const t of e.release)this._commands.set(t,{type:"override-release"})}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/handleNoEngineError":function(){define(["exports"],function(e){"use strict";e.handleNoEngineError=async function(e,t){try{return await e}catch(e){if("no-queryEngine"!==e.name)throw e;return t}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/FeatureTileSubscriptionManager":function(){define(["exports","./TileKey"],function(e,t){"use strict";function r(e,t){const r=new Set;for(const i of e instanceof Set?e.values():e.keys())t.has(i)||r.add(i);return r}class i{constructor(e,t,r){this.target=new Map,this.previous=new Map;const i=r?e.getTileCoverage(r,0,!0,"closest"):null,s=e.getTileCoverage(t,0,!0,"closest");if(this.target.clear(),this.previous.clear(),i)for(const e of i.keys())this.previous.set(e.id,e);if(s)for(const e of s.keys())this.target.set(e.id,e)}*values(){yield*this.target.values(),yield*this.previous.values()}*keys(){yield*this.target.keys(),yield*this.previous.keys()}}class s{constructor(e){this.version=e}}e.FeatureTileSubscriptionManager=class{constructor(e){this._subscriptions=new Map,this._visible=new Set,this._version=0,this._strategy="eager",this._config=e}destroy(){}get coverage(){return this._coverage}get subscriptions(){return new Set(this._subscriptions.keys())}setVisibilityStrategy(e){this._strategy=e}suspend(){this._suspendedCoverage=this._coverage,this._coverage=null,this._updateSubscriptions()}resume(){null==this._coverage&&(this._coverage=this._suspendedCoverage,this._suspendedCoverage=null,this._updateSubscriptions())}update(e,t){return this._version=(this._version+1)%Number.MAX_SAFE_INTEGER,this._coverage=new i(this._config.tileInfoView,e,t),this._updateSubscriptions(),new Set(this._visible)}updateVisibility(){const e=this._updateVisibility();return this._visible=e,this._visible}_updateSubscriptions(){if(!this._coverage)return;const e=this._updateVisibility(),t=new Set(this._coverage.keys()),i=r(this._subscriptions,e),a=r(t,this._subscriptions),n=r(i,t);this._visible=e;for(const e of a.values())this._subscriptions.set(e,new s(this._version));for(const e of n.values())this._subscriptions.delete(e);(a.size||n.size)&&this._sendUpdateSubscriptions(a,n)}_sendUpdateSubscriptions(e,t){const r=Array.from(e.values()).map(e=>({tileId:e,version:this._subscriptions.get(e).version}));this._config.updateSubscriptions({subscribe:r,unsubscribe:Array.from(t.values())})}_updateVisibility(){if(!this._coverage)return new Set;switch(this._strategy){case"eager":return this._updateVisibilityEager(this._coverage);case"target-defer":return this._updateVisibilityTargetDefer(this._coverage)}}_updateVisibilityEager(e){const t=new Set;for(const r of e.values())this._config.isDone(r)?t.add(r.id):this._addVisibleParent(t,r)||this._addVisibleChildren(t,r)||t.add(r.id);return t}_updateVisibilityTargetDefer(e){const t=new Set,r=Array.from(e.target.values());if(!r.some(e=>!this._config.isDone(e))){for(const e of r)t.add(e.id);return t}for(const r of e.values())this._addVisibleParent(t,r)||this._addVisibleChildren(t,r)||t.add(r.id);return t}_addVisibleParent(e,r){let i=!1;for(const s of this._visible.values())new t(s).containsChild(r)&&(e.add(s),i=!0);return i}_addVisibleChildren(e,r){let i=!1;for(const s of this._visible.values()){const a=new t(s);r.containsChild(a)&&(e.add(s),i=!0)}return i}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define(["exports","../../chunks/tslib.es6","../../core/has","../../core/Logger","../../core/promiseUtils","../../core/reactiveUtils","../../core/sql","../../core/accessorSupport/decorators/property","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../graphic/graphicOriginUtils","../../layers/graphics/data/FeatureIdInfo","../../layers/knowledgeGraph/constants","../../layers/support/displayFilterUtils","../../layers/support/FeatureEffect","../../layers/support/FeatureFilter","../../layers/support/featureLayerUtils","../../layers/support/featurePopupQueryUtils","../../layers/support/fieldUtils","../../layers/support/floorFilterUtils","../../networks/support/networkFieldUtils","../../rest/support/Query","../2d/layers/features/layerAdapters/featureServiceUtils","./support/popupUtils","./support/WhereClauseVisitor"],function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g,m,b,_,w,S,v,F,I){"use strict";e.FeatureLayerView=e=>{const r=e;let l=class extends r{constructor(...e){super(...e),this._updatingRequiredPromise=null,this.filter=null,this.layer=null,this.requiresCurrentUser=!1,this.requiredFields=[],this.view=null}initialize(){this.addHandles([a.watch(()=>{const e=this.layer,t=this.view;return[e&&"elevationInfo"in e?e.elevationInfo?.featureExpressionInfo:null,e&&"displayField"in e?e.displayField:null,e&&"timeInfo"in e&&e.timeInfo,e&&"renderer"in e&&e.renderer,e&&"labelingInfo"in e&&e.labelingInfo,e&&"floorInfo"in e&&e.floorInfo,t?.requiredFieldsOptions?.featureTitleFields&&e&&"featureTitleFields"in e&&e.featureTitleFields,t?.requiredFieldsOptions?.utilityNetworkFields&&w.getUtilityNetworkFields(t,e),e.displayFilterInfo,this.displayFilterEnabled,this.filter,this.featureEffect,this.timeExtent,"knowledge-graph-sublayer"===e?.type&&"link-chart"===e.parentCompositeLayer.type&&e.parentCompositeLayer.linkChart?.linkChartProperties.nonspatialDataDisplay?.mode,"parquet"===e?.type&&e.popupTemplate]},()=>this._handleChange(),a.syncAndInitial),a.on(()=>this.view?.floors,"change",()=>this._handleChange()),a.on(()=>this.layer.displayFilterInfo?.filters,"change",()=>this._handleChange()),a.on(()=>this.layer&&"sublayers"in this.layer?this.layer.sublayers:null,"change",()=>this._handleChange())])}get availableFields(){if(!this.layer)return[];const{layer:e,layer:{fieldsIndex:t},requiredFields:r}=this;return"outFields"in e&&e.outFields?b.fixFields(t,[...b.unpackFieldNames(t,e.outFields),...r]):b.fixFields(t,r)}get displayFilterEnabled(){return(this.view?.displayFilterEnabled??!0)&&(!("displayFilterEnabled"in this.layer)||(this.layer?.displayFilterEnabled??!0))}get effectiveDisplayFilter(){const e=this.layer;return this.displayFilterEnabled&&e.displayFilterInfo?f.getEffectiveDisplayFilter(e.displayFilterInfo,this.view):null}get effectiveDisplayFilterClause(){const e=this.effectiveDisplayFilter?.where??null;return e&&this.hasHighlight?n.sqlOr(e,n.sqlIn(this.layer.objectIdField,this.highlightIds)):e}get featureEffect(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null}set featureEffect(e){this._override("featureEffect",e)}get maximumNumberOfFeatures(){return 0}set maximumNumberOfFeatures(e){i.getLogger(this).error("#maximumNumberOfFeatures=","Setting maximum number of features is not supported")}get maximumNumberOfFeaturesExceeded(){return!1}get signedInUser(){return this.layer?.url?g.getSignedInUser(this.layer.url):Promise.resolve(null)}highlight(e,t){throw new Error("missing implementation")}createQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference},t=null!=this.filter?this.filter.createQuery(e):new S(e);return"floorInfo"in this.layer&&this.layer.floorInfo&&(t.where=n.sqlAnd(t.where,_.getFloorFilterClause(this))),this.displayFilterEnabled&&(t.where=n.sqlAnd(t.where,this.effectiveDisplayFilter?.where)),null!=this.timeExtent&&(t.timeExtent=null!=t.timeExtent?t.timeExtent.intersection(this.timeExtent):this.timeExtent.clone()),t}createAggregateQuery(){const e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return new S(e)}queryFeatures(e,t){throw new Error("missing implementation")}queryObjectIds(e,t){throw new Error("missing implementation")}queryFeatureCount(e,t){throw new Error("missing implementation")}queryExtent(e,t){throw new Error("missing implementation")}async fetchPopupFeaturesFromGraphics(e,t){const r=await this._createPopupQuery(e.map(e=>c.getGraphicOriginLayer(e.origin)??e.layer),t);return await m.fetchFeaturePopupFeatures(this.layer,e,r,{getPopupTemplate:e=>F.getFetchPopupTemplate(e,{...t,checkPopupEnabled:!0}),hasRequiredFields:(e,t)=>this._popupFeatureHasRequiredFields(e,t),...t})}_handleChange(){const e=Promise.all([this._updateRequiredFields(),this._updateClientWhereClauseRequirements()]).then(()=>{});return this._set("_updatingRequiredPromise",e),e.then(()=>{this._updatingRequiredPromise===e&&this._set("_updatingRequiredPromise",null)}),e}async _updateClientWhereClauseRequirements(){if(!this.layer||!this.view)return;const{layer:e}=this,t=new I.WhereClauseVisitor(e.fieldsIndex);if(t.visitFilter(this.filter),"featureReduction"in e&&t.visitFeatureReduction(e.featureReduction),"labelingInfo"in e&&t.visitLabelingInfo(e.labelsVisible,e.labelingInfo),"trackInfo"in e&&t.visitTrackInfo(e.trackInfo),"2d"===this.view.type&&(t.visitFilter(this.featureEffect?.filter),t.visitDisplayFilter(this.displayFilterEnabled,e.displayFilterInfo),"featureReduction"in e&&t.visitFeatureReduction(e.featureReduction)),"subtype-group"===e.type)for(const r of e.sublayers)t.visitLabelingInfo(r.labelsVisible,r.labelingInfo);try{const e=await t.finish();this._set("requiresCurrentUser",e.requiresCurrentUser)}catch(e){i.getLogger(this).error(e)}}async _updateRequiredFields(){if(!this.layer||!this.view)return;const e="3d"===this.view.type,{layer:t,layer:{fieldsIndex:r}}=this,s="renderer"in t&&t.renderer,a="orderBy"in t&&t.orderBy,n="featureReduction"in t?t.featureReduction:null,o=new Set,l=[s?s.collectRequiredFields(o,r):null,b.collectLabelingFields(o,t),e&&"elevationInfo"in t?b.collectElevationFields(o,t):null,null!=this.filter?b.collectFilterFields(o,t,this.filter):null,e||null==this.featureEffect?null:b.collectFilterFields(o,t,this.featureEffect.filter),!e&&n?b.collectFeatureReductionFields(o,t,n):null,!e&&a?b.collectOrderByInfos(o,t,a):null];if("timeInfo"in t&&t.timeInfo&&this.timeExtent&&b.collectFields(o,t.fieldsIndex,[t.timeInfo.startField,t.timeInfo.endField]),"timeInfo"in t&&t.timeInfo&&"trackInfo"in t&&t.trackInfo){const{trackInfo:e}=t;b.collectFields(o,t.fieldsIndex,[t.timeInfo.trackIdField]),"feature"!==t.type&&"startTimeField"!==e.timeField||b.collectFields(o,t.fieldsIndex,[t.timeInfo.startField]),"endTimeField"===e.timeField&&b.collectFields(o,t.fieldsIndex,[t.timeInfo.endField]),await b.collectTrackInfoFields(o,t)}if("floorInfo"in t&&t.floorInfo&&b.collectFields(o,t.fieldsIndex,[t.floorInfo.floorField]),"featureTitleFields"in t&&this.view?.requiredFieldsOptions?.featureTitleFields&&t.featureTitleFields&&b.collectFields(o,t.fieldsIndex,t.featureTitleFields),"feature"===t.type&&t.globalIdField&&this.view?.requiredFieldsOptions?.globalIdField&&b.collectFields(o,t.fieldsIndex,[t.globalIdField]),this.displayFilterEnabled&&l.push(b.collectDisplayFilterFields(o,t,t.displayFilterInfo)),"feature"===t.type&&e&&null!=t.infoFor3D&&(null==t.globalIdField&&i.getLogger(this).error("globalIdField missing on 3DObjectFeatureLayer"),b.collectFields(o,t.fieldsIndex,[t.globalIdField])),"subtype-group"===t.type){b.collectField(o,r,t.subtypeField);const e=t.sublayers.map(e=>Promise.all([e.renderer?.collectRequiredFields(o,r),b.collectLabelingFields(o,e)]));l.push(Promise.all(e))}if("catalog-footprint"===t.type&&t.parent){const e=t.parent;b.collectFields(o,r,[e.itemNameField,e.itemSourceField,e.itemTypeField,e.maxScaleField,e.minScaleField])}"knowledge-graph-sublayer"===t.type&&"link-chart"===t.parentCompositeLayer.type&&b.collectField(o,r,p.systemIsSpatialFieldName),"parquet"===t.type&&l.push(F.getRequiredFields(t,t.popupTemplate).then(e=>{for(const t of e)o.add(t)}));const u=await Promise.allSettled(l);if(e)b.collectField(o,r,t.objectIdField);else for(const e of d.getFeatureIdInfoFieldNames(v.createFeatureIdInfo(t)))b.collectField(o,r,e);e&&"displayField"in t&&t.displayField&&b.collectField(o,r,t.displayField);for(const e of u)"rejected"===e.status&&i.getLogger(this).error(e.reason);const c=Array.from(o).sort();this._set("requiredFields",c)}_popupFeatureHasRequiredFields(e,t){return b.featureHasFields(e,t)}async _createPopupQuery(e,t){const r=this.layer.createQuery(),i=new Set;let a=!1;const o=e??[this.layer];for(const e of o){const r=F.getFetchPopupTemplate(e,t);if(null==r)continue;const n=await m.loadFeaturePopupArcadeModules(r);s.throwIfAborted(t);const o=n&&n.arcadeUtils.hasGeometryOperations(r);a=!("point"!==this.layer.geometryType&&!o);const l=await F.getRequiredFields(this.layer,r);s.throwIfAborted(t);for(const e of l)i.add(e)}return r.returnGeometry=a,r.returnZ=a,r.returnM=a,r.outFields=Array.from(i),r.outSpatialReference=this.view.spatialReference,"floorInfo"in this.layer&&this.layer.floorInfo&&(r.where=n.sqlAnd(r.where,_.getFloorFilterClause(this))),r}canResume(){return!(!super.canResume()||null!=this.timeExtent&&this.timeExtent.isEmpty)}getTest(){}get test(){}};return t.__decorate([o.property()],l.prototype,"_updatingRequiredPromise",void 0),t.__decorate([o.property({readOnly:!0})],l.prototype,"availableFields",null),t.__decorate([o.property({readOnly:!0})],l.prototype,"displayFilterEnabled",null),t.__decorate([o.property({readOnly:!0})],l.prototype,"effectiveDisplayFilter",null),t.__decorate([o.property({readOnly:!0})],l.prototype,"effectiveDisplayFilterClause",null),t.__decorate([o.property({type:y})],l.prototype,"featureEffect",null),t.__decorate([o.property({type:h})],l.prototype,"filter",void 0),t.__decorate([o.property()],l.prototype,"layer",void 0),t.__decorate([o.property({type:Number})],l.prototype,"maximumNumberOfFeatures",null),t.__decorate([o.property({readOnly:!0,type:Boolean})],l.prototype,"maximumNumberOfFeaturesExceeded",null),t.__decorate([o.property()],l.prototype,"requiresCurrentUser",void 0),t.__decorate([o.property({readOnly:!0})],l.prototype,"requiredFields",void 0),t.__decorate([o.property({readOnly:!0})],l.prototype,"signedInUser",null),t.__decorate([o.property()],l.prototype,"suspended",void 0),t.__decorate([o.property()],l.prototype,"view",void 0),l=t.__decorate([u.subclass("esri.views.layers.FeatureLayerView")],l),l},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/graphic/graphicOriginUtils":function(){define(["exports"],function(e){"use strict";e.getGraphicOriginLayer=function(e){return e&&"layer"in e?e.layer:void 0},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/FeatureIdInfo":function(){define(["exports"],function(e){"use strict";e.getFeatureIdInfoFieldNames=function*(e){switch(e.type){case"object-id":case"unique-id-simple":return void(yield e.fieldName);case"unique-id-composite":return void(yield*e.fieldNames)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/featurePopupQueryUtils":function(){define(["exports","../../core/promiseUtils","../../core/sql","./fieldUtils","../../support/loadArcade"],function(e,t,r,i,s){"use strict";async function a(e){if(e.expressionInfos?.length||Array.isArray(e.content)&&e.content.some(e=>"expression"===e.type))return s.loadArcade()}e.fetchFeaturePopupFeatures=async function(e,s,n,o){const l=new Array(s.length),u=new Map,c=new Map,d=i.unpackFieldNames(e.fieldsIndex,n.outFields),p=o?.hasRequiredFields??i.featureHasFields;for(let e=0;e<s.length;e++){const r=s[e];if(r.isAggregate){l[e]=r;continue}let i=!1;if(o?.getPopupTemplate){const e=(r.origin&&"object"==typeof r.origin&&"layer"in r.origin?r.origin.layer:null)??r.sourceLayer??r.layer,s=o.getPopupTemplate(e);if(null==s)continue;const n=await a(s);t.throwIfAborted(o),i=n&&n.arcadeUtils.hasGeometryOperations(s)}if(i||!p(r,d)){const t=r.getObjectId();if(null!=t){u.set(t,{graphic:r,index:e});continue}const i=r.getGlobalId();if(null!=i){c.set(i,{graphic:r,index:e});continue}}l[e]=r}if(!e.queryFeatures||0===u.size&&0===c.size)return l.filter(Boolean);const f=[],y=(e,t)=>{t&&(e.outFields??=[],e.outFields.includes(t)||e.outFields.push(t))};if(u.size>0){const t=n.clone();y(t,e.objectIdField),"uniqueIdFields"in e&&e.uniqueIdFields?.length&&(t.outFields??=[],t.outFields.push(...e.uniqueIdFields)),t.objectIds=Array.from(u.keys()),f.push({type:"object-id",query:t,map:u})}const h="globalIdField"in e?e.globalIdField:null;if(null!=h&&c.size>0){const e=n.clone();y(e,h);const t=Array.from(c.keys());e.where=r.sqlAnd(n.where,`${h} IN (${t.map(e=>`'${e}'`).join(",")})`),f.push({type:"global-id",query:e,map:c})}const g=o?.updateSourceAttributes??!1;for(const{type:t,query:r,map:i}of f)try{const s=await e.queryFeatures(r,o);for(const e of s.features){const r="object-id"===t?e.getObjectId():e.getGlobalId();if(null==r)continue;const s=i.get(r);if(!s)continue;const{graphic:a,index:n}=s;if(g&&e.attributes){a.attributes??={};for(const t of d)t in e.attributes&&(a.attributes[t]=e.attributes[t])}const{geometry:o,origin:u}=a;e.geometry||=o,e.origin=u,l[n]=e}}catch{}return l.filter(Boolean)},e.loadFeaturePopupArcadeModules=a,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(e){"use strict";function t(e,t){if(!e?.length)return null;const r=e.filter(e=>""!==e).map(e=>`'${e}'`);return r.push("''"),`${t} IN (${r.join(",")}) OR ${t} IS NULL`}e.getFloorFilterClause=function(e){const r=e.layer;return"floorInfo"in r&&r.floorInfo?.floorField&&"floors"in e.view?t(e.view.floors,r.floorInfo.floorField):null},e.getLayerFloorFilterClause=function(e,r){return"floorInfo"in r&&r.floorInfo?.floorField?t(e,r.floorInfo.floorField):null},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/networks/support/networkFieldUtils":function(){define(["exports"],function(e){"use strict";e.getAssociationsTableFields=function(e){const t=e?.fieldsIndex,r="fromnetworksourceid",i="fromglobalid",s="fromterminalid",a="tonetworksourceid",n="toglobalid",o="toterminalid",l="status",u="associationtype",c="iscontentvisible",d="percentalong",p="globalid";return{fromNetworkSourceId:t?.get(r)?.name??r,fromGlobalId:t?.get(i)?.name??i,fromTerminalId:t?.get(s)?.name??s,toNetworkSourceId:t?.get(a)?.name??a,toGlobalId:t?.get(n)?.name??n,toTerminalId:t?.get(o)?.name??o,status:t?.get(l)?.name??l,associationType:t?.get(u)?.name??u,isContentVisible:t?.get(c)?.name??c,percentAlong:t?.get(d)?.name??d,globalId:t?.get(e?.globalIdField??p)?.name??p}},e.getUtilityNetworkFields=function(e,t){if("feature"!==t.type&&"subtype-group"!==t.type)return[];if(!t.url)return[];const r="utilityNetworks"in e.map?e.map.utilityNetworks??[]:[];for(const e of r)if(e.isUtilityLayer(t)){const e=t.fieldsIndex.get("assetgroup"),r=t.fieldsIndex.get("assettype");return[e?.name,r?.name].filter(e=>null!=e)}return[]},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../layers/support/fieldUtils"],function(e,t){"use strict";function r(e,t){return e&&"object"==typeof e?t?.checkPopupEnabled&&"popupEnabled"in e&&!e.popupEnabled?null:"popupTemplate"in e&&e.popupTemplate?e.popupTemplate:null!=t&&t.defaultPopupTemplateEnabled&&"defaultPopupTemplate"in e&&e.defaultPopupTemplate?e.defaultPopupTemplate:null:null}e.getFetchPopupTemplate=r,e.getRequiredFields=async function(e,r=e.popupTemplate){if(null==r)return[];const i=await r.getRequiredFields(e.fieldsIndex),{lastEditInfoEnabled:s}=r,{objectIdField:a,typeIdField:n,globalIdField:o,relationships:l}=e;if(i.includes("*"))return["*"];const u=s?t.getFeatureEditFields(e):[],c=t.fixFields(e.fieldsIndex,[...i,...u]);return n&&c.push(n),c&&a&&e.fieldsIndex?.has(a)&&!c.includes(a)&&c.push(a),c&&o&&e.fieldsIndex?.has(o)&&!c.includes(o)&&c.push(o),l&&l.forEach(t=>{const{keyField:r}=t;c&&r&&e.fieldsIndex?.has(r)&&!c.includes(r)&&c.push(r)}),c},e.hasPopupTemplate=function(e,t){return null!=r(e,{defaultPopupTemplateEnabled:t})},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/WhereClauseVisitor":function(){define(["exports","../../../core/sql"],function(e,t){"use strict";e.WhereClauseVisitor=class{constructor(e){this._fieldsIndex=e,this._clauses=[]}async finish(){return{requiresCurrentUser:(await Promise.all(this._clauses)).some(e=>e.currentUserRequired)}}visitClientWhereClause(e){e&&this._clauses.push(t.parseWhereClause(e,this._fieldsIndex))}visitFeatureReduction(e){if(e)switch(e.type){case"binning":case"cluster":this.visitLabelingInfo(e.labelsVisible,e.labelingInfo)}}visitLabelingInfo(e,t){if(e&&null!=t)for(const e of t)this.visitClientWhereClause(e.where)}visitDisplayFilter(e,t){if(e)for(const e of t?.filters??[])this.visitClientWhereClause(e.where)}visitFilter(e){this.visitClientWhereClause(e?.where)}visitTrackInfo(e){null!=e&&(this.visitLabelingInfo(e?.latestObservations.labelsVisible,e?.latestObservations.labelingInfo),this.visitLabelingInfo(e?.previousObservations.labelsVisible,e?.previousObservations.labelingInfo),this.visitLabelingInfo(e?.trackLines.labelsVisible,e?.trackLines.labelingInfo))}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define(["exports","../../chunks/tslib.es6","../../core/Logger","../../core/promiseUtils","../../core/reactiveUtils","../../core/has","../../core/RandomLCG","../../core/Error","../../core/accessorSupport/decorators/subclass"],function(e,t,r,i,s,a,n,o,l){"use strict";e.RefreshableLayerView=e=>{const a=e;let n=class extends a{initialize(){this.addHandles(s.on(()=>this.layer,"refresh",e=>{this.doRefresh(e.dataChanged).catch(e=>{i.isAbortError(e)||r.getLogger(this).error(e)})}),"RefreshableLayerView")}};return n=t.__decorate([l.subclass("esri.views.layers.RefreshableLayerView")],n),n},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/highlightOptionsUtils":function(){define(["exports","../../core/Collection","./HighlightDefaults","./HighlightOptions"],function(e,t,r,i){"use strict";e.createInitialHighlightOptions=function(){return new t([new i({name:r.defaultHighlightName}),new i({name:r.temporaryHighlightName,color:r.temporaryHighlightColor})])},e.getHighlightName=function(e){return e?.name??r.defaultHighlightName},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})})},"*noref":1}}),define(["exports","../../../chunks/tslib.es6","../../../AggregateGraphic","../../../Graphic","../../../TrackGraphic","../../../core/arrayUtils","../../../core/Collection","../../../core/compilerUtils","../../../core/Error","../../../core/handleUtils","../../../core/has","../../../core/Logger","../../../core/maybe","../../../core/object","../../../core/promiseUtils","../../../core/reactiveUtils","../../../core/sql","../../../core/accessorSupport/decorators/property","../../../core/accessorSupport/decorators/subclass","../../../core/support/UpdatingHandles","../../../geometry/Extent","../../../layers/effects/FeatureEffectView","../../../layers/graphics/featureConversionUtils","../../../layers/support/FeatureFilter","../../../layers/support/featureLayerUtils","../../../layers/support/fieldUtils","../../../layers/support/layerUtils","../../../layers/support/timeSupport","../../../rest/support/AggregateFeatureSet","../../../rest/support/AttributeBinsFeatureSet","../../../rest/support/AttributeBinsQuery","../../../rest/support/FeatureSet","../../../rest/support/Query","./LayerView2D","./features/FeatureContainer","./features/FeaturePipelineWorkerProxy","./features/FeatureSourceEventLog","./features/layerAdapters/CatalogFootprintLayerAdapter","./features/layerAdapters/FeatureLayerAdapter","./features/layerAdapters/featureServiceUtils","./features/layerAdapters/InMemoryLayerAdapter","./features/layerAdapters/KnowledgeGraphSublayerAdapter","./features/layerAdapters/OGCFeatureLayerAdapter","./features/layerAdapters/OrientedImageryLayerAdapter","./features/layerAdapters/ParquetLayerAdapter","./features/layerAdapters/StreamLayerAdapter","./features/layerAdapters/SubtypeGroupLayerAdapter","./features/schema/processor/symbols/ComplexSymbolSchema","./support/DebouncedFeatureOverride","./support/FeatureCommandQueue","./support/handleNoEngineError","./support/util","../tiling/FeatureTileSubscriptionManager","../../layers/FeatureLayerView","../../layers/LayerView","../../layers/RefreshableLayerView","../../support/highlightOptionsUtils"],function(e,t,r,i,s,a,n,o,l,u,c,d,p,f,y,h,g,m,b,_,w,S,v,F,I,x,V,E,T,R,O,C,k,M,P,q,A,U,L,z,N,j,D,B,G,H,J,W,Q,$,Z,K,X,Y,ee,te,re){"use strict";const ie=4294967294;return e.default=class extends(Y.FeatureLayerView(te.RefreshableLayerView(M.LayerView2DMixin(ee)))){constructor(){super(...arguments),this._commandsQueue=new $.FeatureCommandQueue({process:e=>{switch(e.type){case"override-batch":return this._doOverride(e);case"update":return this._doUpdate();case"highlight":return this._updateHighlights()}}}),this._visibilityOverrides=new Set,this._lastAvailableFields=[],this._lastTargetState=null,this.eventLog=new A.FeatureSourceEventLog,this._sourceRefreshVersion=1,this._displayRefreshVersion=1,this._pipelineUpdating=!1,this._editUpdatingHandles=new _.UpdatingHandles,this._fields=null,this._sourceUpdating=!1,this.featureEffectView=new S,this._lastUpdate=0}destroy(){this._workerProxy?.destroy(),this._workerAttached.reject(y.createAbortError()),this._commandsQueue.destroy()}initialize(){this._workerAttached=y.createResolver(),y.ignoreAbortErrors(this._workerAttached.promise),this.addResolvingPromise(this._initProxy()),this.featureEffectView.featureEffect=this.featureEffect,this.featureEffectView.endTransition()}async _initProxy(){const e=this.layer;if("isTable"in e&&e.isTable)throw new l("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:e});if(("feature"===e.type||"subtype-group"===e.type)&&!1===V.getEffectiveLayerCapabilities(e)?.operations.supportsQuery)throw new l("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:e});this._workerProxy&&this._workerProxy.destroy();const t=this._createClientOptions();this._workerProxy=await q.createFeaturePipelineWorkerProxy(t)}async _attachProxy(){const e={service:await this.layerAdapter.createServiceOptions(this.view),tileInfoJSON:this.view?.featuresTilingScheme?.tileInfo?.toJSON()};let t=[];Array.isArray(e.service.source)&&(t=e.service.source);try{await this._workerProxy.pipeline.onAttach(e,{transferList:t}),this._workerAttached.resolve()}catch(e){this._workerAttached.reject(y.createAbortError()),y.throwIfNotAbortError(e)}}async _detachProxy(){return this._workerProxy.pipeline.onDetach()}async getWorker(){return await this._workerAttached.promise,this._workerProxy}get dataUpdating(){return this._sourceUpdating||this._editUpdatingHandles.updating}get hasAllFeatures(){return this.layer.visible&&!this.suspended&&this.eventLog.hasAllData&&this.eventLog.willQueryAllFeatures}get hasAllFeaturesInView(){const e=this.effectiveDisplayFilter?.where||null,t=!this.eventLog.willQueryAllFeatures&&null!=e&&"1=1"!==e;return this.layer.visible&&!this.suspended&&this.eventLog.hasAllData&&!t}get hasFullGeometries(){return this.layer.visible&&!this.suspended&&this.eventLog.hasAllData&&this.eventLog.willQueryFullResolutionGeometry}get labelingCollisionInfos(){const e=this.layerAdapter.getLabelingDeconflictionInfo(this.view),t=this.layer.geometryType,r=!this.suspended;return e.map(({vvEvaluators:e,deconflictionEnabled:i,labelingInfo:s})=>({labelingInfo:s,container:this.featureContainer,vvEvaluators:e,deconflictionEnabled:i,geometryType:t,visible:r}))}get layerAdapter(){switch(this.layer.type){case"feature":return"memory"===this.layer.source.type?new N.InMemoryLayerAdapter(this.layer):new L.FeatureLayerAdapter(this.layer);case"geojson":case"csv":case"wfs":return new N.InMemoryLayerAdapter(this.layer);case"parquet":return new G.ParquetLayerAdapter(this.layer);case"subtype-group":return new J.SubtypeGroupLayerAdapter(this.layer);case"ogc-feature":return new D.OGCFeatureLayerAdapter(this.layer);case"stream":return new H.StreamLayerAdapter(this.layer);case"oriented-imagery":return new B.OrientedImageryLayerAdapter(this.layer);case"knowledge-graph-sublayer":return new j.KnowledgeGraphSublayerAdapter(this.layer);case"catalog-footprint":return new U.CatalogFootprintLayerAdapter(this.layer);default:o.neverReached(this.layer)}return null}get timeExtent(){return E.combineTimeExtent(this.layerAdapter.timeOptions,this.view?.timeExtent,this._get("timeExtent"))}getDisplayStatistics(e,t){return this.featureContainer?.getDisplayStatistics(e,t)}async queryHeatmapStatistics(e){return(await this.getWorker()).pipeline.queryHeatmapStatistics(e)}highlight(e,t){let r;e instanceof i?r=[e.getObjectId()]:"number"==typeof e||"string"==typeof e?r=[e]:n.isCollection(e)&&e.length>0?r=e.map(e=>e?.getObjectId()).toArray():Array.isArray(e)&&e.length>0&&(r="number"==typeof e[0]||"string"==typeof e[0]?e:e.map(e=>e?.getObjectId()));const s=r?.filter(a.isSome);if(!s?.length)return u.makeHandle();const o=re.getHighlightName(t);return this._addHighlights(s,o),u.makeHandle(()=>!this.destroyed&&this._removeHighlights(s,o))}async hitTest(e,t){const a=await this.featureContainer.hitTest(t);if(0===a.length)return null;const n=await this.getWorker(),{features:o,aggregates:l,tracks:u}=await n.pipeline.getDisplayFeatures(a),c=this.featureContainer.getSortKeys(a),d=({displayId:e},{displayId:t})=>c.has(e)&&c.has(t)?c.get(e)-c.get(t):e-t;return o.sort(d).reverse(),l.sort(d).reverse(),[...l.map(t=>this._createGraphicHit(e,r.fromJSON(t))),...u.map(t=>this._createGraphicHit(e,s.fromJSON(t))),...o.map(t=>this._createGraphicHit(e,i.fromJSON(t)))]}async queryStatistics(){const e=await this.getWorker();return Z.handleNoEngineError(e.pipeline.queryStatistics(),{featureCount:0,ringCount:0,vertexCount:0})}async querySummaryStatistics(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.features.executeQueryForSummaryStatistics(this._cleanUpQuery(e),s,r);return Z.handleNoEngineError(a,{})}async queryAggregateSummaryStatistics(e,t,r){const i={...t,scale:this.view.scale},s=(await this.getWorker()).aggregates.executeQueryForSummaryStatistics(this._cleanUpAggregateQuery(e),i,r);return Z.handleNoEngineError(s,{})}async queryUniqueValues(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.features.executeQueryForUniqueValues(this._cleanUpQuery(e),s,r);return Z.handleNoEngineError(a,{uniqueValueInfos:[]})}async queryAggregateUniqueValues(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.aggregates.executeQueryForUniqueValues(this._cleanUpAggregateQuery(e),s,r);return Z.handleNoEngineError(a,{uniqueValueInfos:[]})}async queryClassBreaks(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.features.executeQueryForClassBreaks(this._cleanUpQuery(e),s,r);return Z.handleNoEngineError(a,{classBreakInfos:[]})}async queryAggregateClassBreaks(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.aggregates.executeQueryForClassBreaks(this._cleanUpAggregateQuery(e),s,r);return Z.handleNoEngineError(a,{classBreakInfos:[]})}async queryHistogram(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.features.executeQueryForHistogram(this._cleanUpQuery(e),s,r);return Z.handleNoEngineError(a,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}async queryAggregateHistogram(e,t,r){const i=await this.getWorker(),s={...t,scale:this.view.scale},a=i.aggregates.executeQueryForHistogram(this._cleanUpAggregateQuery(e),s,r);return Z.handleNoEngineError(a,{bins:[],maxValue:null,minValue:null,normalizationTotal:null})}queryFeatures(e,t){return this.queryFeaturesJSON(e,t).then(e=>{const t=C.fromJSON(e);return t.features.forEach(e=>this._setLayersForFeature(e)),t})}async queryVisibleFeatures(e,t){const r=(await this.getWorker()).pipeline.queryVisibleFeatures(this._cleanUpQuery(e),t),i=await Z.handleNoEngineError(r,{features:[]}),s=C.fromJSON(i);return s.features.forEach(e=>this._setLayersForFeature(e)),s}async queryAggregates(e,t){const r=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(e),t),i=await Z.handleNoEngineError(r,{features:[]}),s=T.fromJSON(i);return s.features.forEach(e=>this._setLayersForFeature(e)),s}async queryAggregateIds(e,t){const r=(await this.getWorker()).aggregates.executeQueryForIds(this._cleanUpAggregateQuery(e),t);return Z.handleNoEngineError(r,[])}async queryAggregateCount(e,t){const r=(await this.getWorker()).aggregates.executeQueryForCount(this._cleanUpAggregateQuery(e),t);return Z.handleNoEngineError(r,0)}async queryAggregateJSON(e,t){const r=(await this.getWorker()).aggregates.executeQuery(this._cleanUpAggregateQuery(e),t);return Z.handleNoEngineError(r,{features:[]})}async queryFeaturesJSON(e,t){const r=(await this.getWorker()).features.executeQuery(this._cleanUpQuery(e),t);return Z.handleNoEngineError(r,{features:[]})}async queryObjectIds(e,t){const r=(await this.getWorker()).features.executeQueryForIds(this._cleanUpQuery(e),t);return Z.handleNoEngineError(r,[])}async queryFeatureCount(e,t){const r=(await this.getWorker()).features.executeQueryForCount(this._cleanUpQuery(e),t);return Z.handleNoEngineError(r,0)}async queryExtent(e,t){const r=(await this.getWorker()).features.executeQueryForExtent(this._cleanUpQuery(e),t),i=await Z.handleNoEngineError(r,{count:0,extent:null});return{count:i.count,extent:w.fromJSON(i.extent)}}async queryAttributeBins(e,t){const r=(await this.getWorker()).features.executeAttributeBinsQuery(this._cleanUpAttributeBinsQuery(e),t),i=await Z.handleNoEngineError(r,{features:[]});return R.fromJSON(i)}async getSampleFeatures(e){return(await this.getWorker()).pipeline.getSampleFeatures(e)}setVisibility(e,t){t?this._visibilityOverrides.delete(e):this._visibilityOverrides.add(e),this._update()}update(e){const t=performance.now();if(t-this._lastUpdate<200)return;if(this._lastUpdate=t,!this.subscriptionManager)return;this.view.animation&&!this._lastTargetState&&(this._lastTargetState=e.state.clone()),!this.view.animation&&this._lastTargetState&&(this._lastTargetState=null);const r=this.subscriptionManager.update(e.targetState,this._lastTargetState),i=new Set(this.subscriptionManager.coverage?.target.keys());for(const e of this.featureContainer.tiles||[])e.isCoverage=i.has(e.id);this.featureContainer.setVisibleTiles(r)}attach(){var e,t;c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.attach"),y.ignoreAbortErrors(this._updatingHandles.addPromise(this._workerAttached.promise)),y.ignoreAbortErrors(this._attachProxy()),this.featureContainer=new P.FeatureContainer(this),this.container.addChild(this.featureContainer),this.view.timeline.record(`${this.layer.title} (FeatureLayer) Attach`),this.subscriptionManager=new X.FeatureTileSubscriptionManager({tileInfoView:this.view.featuresTilingScheme,updateSubscriptions:e=>{this.featureContainer.updateSubscriptions(e),y.ignoreAbortErrors(this._updatingHandles.addPromise(this.getWorker().then(t=>t.pipeline.updateSubscriptions(e))))},isDone:e=>this.featureContainer.isDone(e)}),this.requestUpdate(),this.addAttachHandles([(e=[()=>this._displayRefreshVersion,()=>this.layer.displayFilterInfo,()=>this.timeExtent,()=>this.clips,()=>this.filter,()=>this.effectiveDisplayFilterClause,()=>this.featureEffect,()=>this._sourceRefreshVersion,()=>this.view.timeZone,()=>this.view.timeExtent,...this.layerAdapter.getUpdateHashProperties(this.view)],t=()=>this._update(),u.handlesGroup(e.map(e=>h.watch(()=>{const t=e();return t&&"object"==typeof t?"getTime"in t&&"function"==typeof t.getTime?t.getTime():JSON.stringify(t):t},t)))),h.watch(()=>this.updateSuspended,e=>{e||(this.subscriptionManager.resume(),this.view.labelManager.requestUpdate())}),h.watch(()=>this.visible,e=>{this.view.labelManager.requestUpdate()})]),this._update(),"stream"!==this.layer.type&&"parquet"!==this.layer.type&&"catalog-footprint"!==this.layer.type&&this.addAttachHandles(this.layer.on("edits",e=>this._editUpdatingHandles.addPromise(this._edit(e))))}detach(){c("esri-2d-update-debug")&&console.debug("FeatureLayerView2D.detach"),this._detachProxy(),this._fields=null,this.featureContainer.destroy(),this.featureContainer=null,this._commandsQueue.clear(),this.container.removeAllChildren(),this.subscriptionManager=p.destroyMaybe(this.subscriptionManager),this._workerProxy.pipeline.onDetach(),this._workerAttached=y.createResolver(),y.ignoreAbortErrors(this._workerAttached.promise),this._lastAvailableFields=[],this._lastSchema=null}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}addOverrides(e){return this._commandsQueue.push({type:"override",options:{...e,release:[]}})}removeOverrides(e){for(const t of e)if(null==t)throw new l("featurelayerview:bad-override","Tried to remove an override for an invalid objectId",{objectId:t});const t={added:[],updated:[],removed:[],release:e,isWeak:!1,historicMoment:null};return this._commandsQueue.push({type:"override",options:t})}isUpdating(){const e="renderer"in this.layer&&null!=this.layer.renderer,t=this._commandsQueue.updateTracking.updating,r=null!=this._updatingRequiredPromise,i=this.featureContainer.updatingHandles.updating,s=this.updateRequested||e&&(t||r)||i||this._pipelineUpdating||this.dataUpdating;if(c("esri-2d-log-updating")){console.log(`Updating FLV2D (${this.layer.id}): ${s}\n  -> updateRequested ${this.updateRequested}\n  -> hasRenderer ${e}\n  -> updatingRequiredFields ${r}\n  -> hasPendingCommand ${t}\n  -> dataUpdating ${this.dataUpdating}\n  -> processing ${this._pipelineUpdating}\n  -> updatingContainer ${i}\n`);for(const e of this.featureContainer.subscriptions())console.log(`    -> Tile[${e.id}] Done: ${e.done}`)}return s}_createClientOptions(){const e=this;return{get container(){return e.featureContainer},setUpdating:e=>{this._set("_pipelineUpdating",e.pipeline),this._set("_sourceUpdating",e.source)},emitEvent:e=>{this.emit(e.name,e.event)},get eventLog(){return e.eventLog},fetch:async t=>{if(c("esri-2d-stabilize-glyphs")){const r=[];for(const i of t)r.push(await e.view.stage.painter.textureManager.rasterizeItem(i));return r}return Promise.all(t.map(t=>e.view.stage.painter.textureManager.rasterizeItem(t)))},fetchDictionary:e=>Promise.all(e.map(e=>this._fetchDictionaryRequest(e)))}}async _fetchDictionaryRequest(e){try{if("subtype-group"===this.layer.type)throw new Error("InternalError: SubtypeGroupLayer does not support dictionary renderer");const t=this.layer.renderer;if(!t||"dictionary"!==t.type)throw new Error("InternalError: Expected layer to have a DictionaryRenderer");const r=this._lastSchema.processor.mesh.factory.symbology;if("dictionary"!==r.type)throw new Error("InternalError: Expected schema to be of type 'dictionary'");const i={cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,store:this.featureContainer.instanceStore,scaleExpression:r.scaleExpression};this._fields||(this._fields=this.layer.fields.map(e=>e.toJSON()));const s=r.visualVariableUniforms,a=K.toJSONGeometryType(this.layer.geometryType),n=await t.getSymbolForControlString(e.controlString,a,!1);return n&&n.data?{type:"dictionary-response",meshes:await W.createComplexSymbolInstances({...n.data,hasTextStringTemplates:!0},{uniforms:s,path:"renderer",schemaOptions:i})}:{type:"dictionary-response",meshes:[]}}catch(e){return{type:"dictionary-response",meshes:[]}}}_cleanUpQuery(e){const t=k.from(e)||this.createQuery();return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t.toJSON()}_cleanUpAttributeBinsQuery(e){const t=O.from(e);return t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference),t.toJSON()}_cleanUpAggregateQuery(e){const t=k.from(e)||this.createAggregateQuery();t.outSpatialReference||(t.outSpatialReference=this.view.spatialReference);const r=t.objectIds??[];for(const e of t.aggregateIds??[])r.push(e);return t.objectIds=r,t.aggregateIds=[],t.toJSON()}async _update(){return this._commandsQueue.push({type:"update"})}_edit(e){return this._commandsQueue.push({type:"edit",event:e})}async doRefresh(e){this.attached&&(this.updateSuspended&&e||(e?this.incrementSourceRefreshVersion():this.incrementDisplayRefreshVersion()))}incrementSourceRefreshVersion(){this._sourceRefreshVersion=(this._sourceRefreshVersion+1)%ie+1}incrementDisplayRefreshVersion(){this._displayRefreshVersion=(this._displayRefreshVersion+1)%ie+1}async _resolveIdenifiers(e){const t=[],r=[];for(const i of e)null==i.objectId||-1===i.objectId?null==i.globalId?d.getLogger(this).warn("mapview-apply-edits","A feature identifier must contain either a GlobalId or ObjectId. Ignoring",{identifier:i}):r.push(i.globalId):t.push(i.objectId);const i="globalIdField"in this.layer&&this.layer.globalIdField,s=i&&this.availableFields.includes(i);if(r.length&&!s)return d.getLogger(this).error(new l("mapview-apply-edits",`Editing the specified service requires the layer's globalIdField, ${i} to be included the layer's outFields for updates to be reflected on the map`)),t;if(r.length){const e=await this._workerProxy.pipeline.getObjectIdsFromGlobalIds(r);for(const r of e)t.push(r)}return t}_resolveOverrides(e){const t=!1,r=!1,i=K.toJSONGeometryType(this.layer.geometryType),s=z.createFeatureIdInfo(this.layer),a=[];for(const n of e.added){const e=v.convertFromFeature(n,i,t,r,s);if(null==e.objectId)throw new l("featurelayerview:bad-override","Feature does not have an objectId",{feature:n});a.push(e)}for(const n of e.updated){const e=v.convertFromFeature(n,i,t,r,s);if(null==e.objectId)throw new l("featurelayerview:bad-override","Feature does not have an objectId",{feature:n});a.push(e)}for(const t of e.removed)if(null==t)throw new l("featurelayerview:bad-override","Tried to remove an invalid objectId",{objectId:t});return{type:"override",updates:a,removed:e.removed,release:e.release,isWeak:e.isWeak??!1,historicMoment:e.historicMoment??null}}async _resolveEdit(e){const t=this.layer,r=e.historicMoment?.getTime()??null,i="layerId"in t&&e.editedFeatures?.find(e=>e.layerId===t.layerId);if(i&&this._canEditByFeature(i)){const{adds:e,deletes:t,updates:s}=i.editedFeatures,a=this.layer.objectIdField,n=s.map(e=>e.current),o=t.map(e=>"attributes"in e?{objectId:a?e.attributes[a]:null}:e),l=await this._resolveIdenifiers(o);return this._resolveOverrides({added:e,updated:n,removed:l,historicMoment:r,isWeak:!0,release:[]})}const[s,a,n]=await Promise.all([this._resolveIdenifiers(e.addedFeatures),this._resolveIdenifiers(e.updatedFeatures),this._resolveIdenifiers(e.deletedFeatures)]);return{type:"override-by-id",updates:[...s,...a],removed:n,historicMoment:r,isWeak:!0}}_canEditByFeature(e){const{adds:t,updates:r}=e.editedFeatures;return t.every(e=>this.view.spatialReference.equals(e.geometry?.spatialReference))&&r.every(e=>this.view.spatialReference.equals(e.current.geometry?.spatialReference))}async _doUpdate(){"featureReduction"in this.layer&&this.layer.featureReduction&&this.layer.featureReduction!==this._lastFeatureReduction&&(this.layer.featureReduction=this.layer.featureReduction?.clone(),this._lastFeatureReduction=this.layer.featureReduction);try{if(await Promise.allSettled([this._handleChange(),I.checkServiceCurrentUserSupport(this.layer)]),this.destroyed||!this.layerAdapter?.hasRequiredSupport||!this.subscriptionManager)return;const e=this.featureContainer.instanceStore;this.featureContainer.attributeView.lockTextureUploads();const t=this._lastSchema?.processor.mesh.factory.symbology?.type;let r=!0;"subtype-group"!==this.layer.type&&"dictionary"===this.layer.renderer?.type&&"dictionary"===t&&(r=!1),e.updateStart(r);const i=this.featureEffect,s={store:e,cimAnalyzer:this.view.stage.cimAnalyzer,cimResourceManager:this.view.stage.painter.textureManager.resourceManager,scaleExpression:void 0},a=await this._createViewSchemaConfig(),n={source:this.layerAdapter.createSourceSchema(a,this._sourceRefreshVersion),processor:await this.layerAdapter.createProcessorSchema(s,a,this._displayRefreshVersion)},o=n.processor.mesh.factory.labels;o&&this.view.labelManager.setLabelSchemaStyles(o,this.featureContainer);const l=f.notDeepEqual(this._lastSchema?.source.mutable,n.source.mutable)||f.notDeepEqual(this._lastSchema?.processor,n.processor);if(!l)return this.featureContainer.requestRender(),this.featureContainer.attributeView.unlockTextureUploads(),e.updateEnd(r),void(this.featureEffectView.featureEffect=i);this._lastSchema=n,this._fields=null;const u=Math.round(performance.now());c("esri-2d-update-debug")&&console.debug(`Id[${this.layer.uid}] Version[${u}] FeatureLayerView2D._doUpdate`,{changes:l});const d=await this.getWorker();await d.pipeline.updateSchema(n,u),e.updateEnd(r),this.featureEffectView.featureEffect=i,this.featureEffectView.endTransition(),this.featureContainer.restartAllAnimations(),this.featureContainer.attributeView.unlockTextureUploads(),this.featureContainer.trySwapRenderState(),this.featureContainer.requestRender();const p=n.processor.mesh.strategy,y="cluster"===p.type||"binning"===p.type,h="heatmap"===n.processor.mesh.factory.symbology.type,g=y||h?"target-defer":"eager";this.subscriptionManager.setVisibilityStrategy(g),c("esri-2d-update-debug")&&console.debug(`Version[${u}] FeatureLayerView2D.updateEnd`),this.requestUpdate()}catch(e){c("esri-2d-update-debug")&&console.error("Encountered an error during update",e)}}async _doOverride(e){const t=await this.getWorker();try{for(const r of e.messages)switch(r.type){case"edit":{const e=new Q.DebouncedFeatureOverride;e.add(await this._resolveEdit(r.event)),await t.pipeline.onOverride(e.toMessage());break}case"override":{const e=new Q.DebouncedFeatureOverride;e.add(this._resolveOverrides(r.options)),await t.pipeline.onOverride(e.toMessage());break}}}catch(e){y.isAbortError(e)}}_getEffectiveAvailableFields(e){const t=function(e,t){const r=new Set;return e&&e.forEach(e=>r.add(e)),t&&t.forEach(e=>r.add(e)),r.has("*")?["*"]:Array.from(r)}(this._lastAvailableFields,e);return this._lastAvailableFields=t,x.packFields(this.layer.fieldsIndex,t)}async _createViewSchemaConfig(){const e=this.requiresCurrentUser?await this.signedInUser:null,t=[function(e,t,r,i,s,a){s&&(s=s.clone());const n=null!=s?s.timeExtent:null,o=null!=r&&null!=n?r.intersection(n):r||n;o&&(s??=new F,s.timeExtent=o),s=t.addFilters?.(s,e)??s,a&&(s??=new F,s.where=g.sqlAnd(s.where,a));let l=s?.toJSON()??null;return i.size&&(l??=(new F).toJSON(),l.hiddenIds=Array.from(i)),l}(this.view,this.layerAdapter,this.timeExtent,this._visibilityOverrides,this.filter,this.effectiveDisplayFilterClause),this.featureEffect?.filter?.toJSON()??null];return{availableFields:this._getEffectiveAvailableFields(this.availableFields),displayFilterEnabled:this.displayFilterEnabled,filters:t,scale:this.view.scale,timeZone:this.view.timeZone,timeExtent:this.view.timeExtent,currentUser:e}}_processHighlight(){this._commandsQueue.push({type:"highlight"})}async _updateHighlights(){const e=this._getHighlights(),t=await this.getWorker();if(this.destroyed)return;const r=t.pipeline.updateHighlight({highlights:e}).catch(e=>{y.isAbortError(e)||d.getLogger(this).error(e)});this._updatingHandles.addPromise(r)}_setLayersForFeature(e){e.layer=e.sourceLayer=this.layer,this.layerAdapter.setGraphicOrigin(e)}_createGraphicHit(e,t){return this._setLayersForFeature(t),null!=t.geometry&&(t.geometry.spatialReference=this.view.spatialReference),{type:"graphic",graphic:t,layer:this.layer,mapPoint:e}}},t.__decorate([m.property()],e.default.prototype,"_commandsQueue",void 0),t.__decorate([m.property()],e.default.prototype,"_sourceRefreshVersion",void 0),t.__decorate([m.property()],e.default.prototype,"_displayRefreshVersion",void 0),t.__decorate([m.property({readOnly:!0})],e.default.prototype,"_pipelineUpdating",void 0),t.__decorate([m.property()],e.default.prototype,"_sourceUpdating",void 0),t.__decorate([m.property({readOnly:!0})],e.default.prototype,"dataUpdating",null),t.__decorate([m.property({readOnly:!0})],e.default.prototype,"hasAllFeatures",null),t.__decorate([m.property({readOnly:!0})],e.default.prototype,"hasAllFeaturesInView",null),t.__decorate([m.property({readOnly:!0})],e.default.prototype,"hasFullGeometries",null),t.__decorate([m.property()],e.default.prototype,"featureEffectView",void 0),t.__decorate([m.property()],e.default.prototype,"labelingCollisionInfos",null),t.__decorate([m.property()],e.default.prototype,"layerAdapter",null),t.__decorate([m.property({readOnly:!0})],e.default.prototype,"timeExtent",null),e.default=t.__decorate([b.subclass("esri.views.2d.layers.FeatureLayerView2D")],e.default),e.default});