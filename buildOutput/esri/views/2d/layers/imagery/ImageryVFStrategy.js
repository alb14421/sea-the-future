// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../core/Accessor","../../../../core/Logger","../../../../core/promiseUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../geometry/Extent","../../engine/imagery/RasterVFDisplayObject"],function(e,t,r,i,a,s,o,n,l,c,d){"use strict";return e.default=class extends r{constructor(e){super(e),this._loading=null,this.update=a.debounce((e,t)=>this._update(e,t).catch(e=>{a.isAbortError(e)||i.getLogger(this).error(e)}))}get updating(){return!!this._loading}redraw(e){if(!this.container.children.length)return;const t=this.container.children[0];t.symbolizerParameters=e,t.invalidateVAO(),this.container.symbolTypes="wind_speed"===e.style?["scalar","triangle"]:"simple_scalar"===e.style?["scalar"]:["triangle"],this.container.requestRender()}async _update(e,t,r){if(!e.stationary)return;const{extent:i,spatialReference:a}=e.state,s=new c({xmin:i.xmin,ymin:i.ymin,xmax:i.xmax,ymax:i.ymax,spatialReference:a}),[o,n]=e.state.size;this._loading=this.fetchPixels(s,o,n,r);const l=await this._loading;this._addToDisplay(l,t,e.state),this._loading=null}_addToDisplay(e,t,r){if(null==e.pixelBlock)return this.container.children.forEach(e=>e.destroy()),void this.container.removeAllChildren();const{extent:i,pixelBlock:a}=e,s=new d.RasterVFDisplayObject(a);s.offset=[0,0],s.symbolizerParameters=t,s.rawPixelData=e,s.invalidateVAO(),s.x=i.xmin,s.y=i.ymax,s.pixelRatio=r.pixelRatio,s.rotation=r.rotation,s.resolution=r.resolution,s.width=a.width*t.symbolTileSize,s.height=a.height*t.symbolTileSize,this.container.children.forEach(e=>e.destroy()),this.container.removeAllChildren(),this.container.symbolTypes="wind_speed"===t.style?["scalar","triangle"]:"simple_scalar"===t.style?["scalar"]:["triangle"],this.container.addChild(s)}},t.__decorate([s.property()],e.default.prototype,"fetchPixels",void 0),t.__decorate([s.property()],e.default.prototype,"container",void 0),t.__decorate([s.property()],e.default.prototype,"_loading",void 0),t.__decorate([s.property()],e.default.prototype,"updating",null),e.default=t.__decorate([l.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],e.default),e.default});