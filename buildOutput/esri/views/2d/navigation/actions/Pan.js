// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../../chunks/tslib.es6","../../../../Viewpoint","../../../../core/Accessor","../../../../core/reactiveUtils","../../../../core/screenUtils","../../../../core/accessorSupport/decorators/property","../../../../core/has","../../../../core/Logger","../../../../core/RandomLCG","../../../../core/accessorSupport/decorators/subclass","../../../../chunks/vec32","../../../../core/libs/gl-matrix-2/factories/vec3f64","../../../../geometry/Point","../../viewpointUtils","../../../navigation/PanPlanarMomentumEstimator"],function(t,e,i,o,n,s,a,r,m,c,u,h,d,p,l,v){"use strict";return t.default=class extends o{constructor(t){super(t),this.animationTime=0,this.momentumEstimator=new v.PanPlanarMomentumEstimator(500,6,.92),this.momentum=null,this.tmpMomentum=d.create(),this.momentumFinished=!1,this.viewpoint=new i({targetGeometry:new p,scale:0,rotation:0}),this._previousDrag=null,n.when(()=>this.momentumFinished,()=>this.navigation.stop())}begin(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this._previousDrag=e}update(t,e){this.addToEstimator(e);let i=e.center.x,o=e.center.y;const n=this._previousDrag;i=n?n.center.x-i:-i,o=n?o-n.center.y:o,t.viewpoint=l.translateBy(this.viewpoint,t.viewpoint,[i||0,o||0]),this._previousDrag=e}end(t,e){this.addToEstimator(e);const i=t.navigation.effectiveMomentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this._previousDrag=null,this.navigation.end()}addToEstimator(t){const e=t.center.x,i=t.center.y,o=s.createScreenPointArray(-e,i),n=d.fromValues(-e,i,0);this.momentumEstimator.add(o,n,.001*t.timestamp)}onAnimationUpdate(t){this.navigation.animationManager?.animateContinuous(t.viewpoint,(e,i)=>{const{momentum:o,animationTime:n,tmpMomentum:s}=this,a=.001*i;if(!(this.momentumFinished=!o||o.isFinished(n))){const i=o.valueDelta(n,a);h.scale(s,o.direction,i),l.translateBy(e,e,s),t.constraints.constrainByGeometry(e)}this.animationTime+=a})}stopMomentumNavigation(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())}},e.__decorate([a.property()],t.default.prototype,"momentumFinished",void 0),e.__decorate([a.property()],t.default.prototype,"viewpoint",void 0),e.__decorate([a.property()],t.default.prototype,"navigation",void 0),t.default=e.__decorate([u.subclass("esri.views.2d.navigation.actions.Pan")],t.default),t.default});