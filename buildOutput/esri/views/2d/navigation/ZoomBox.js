// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/tslib.es6","../../../core/Accessor","../../../core/screenUtils","../../../core/accessorSupport/decorators/property","../../../core/has","../../../core/Logger","../../../core/RandomLCG","../../../core/accessorSupport/decorators/subclass","./duration","../../input/InputManager"],function(t,e,i,r,a,s,o,n,h,l,d){"use strict";const c="esri-zoom-box",u={container:`${c}__container`,overlay:`${c}__overlay`,background:`${c}__overlay-background`,box:`${c}__outline`},_="Shift";return t.default=class extends i{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._rafId=null,this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this.removeAllHandles(),this._destroyOverlay(),this._set("view",t),t&&this.addHandles([t.on("drag",[_],t=>this._handleDrag(t,1),d.ViewEventPriorities.INTERNAL),t.on("drag",[_,"Control"],t=>this._handleDrag(t,-1),d.ViewEventPriorities.INTERNAL)])}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,i,r){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=r,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,i,a,s){const o=this.view,n=o.toMap(r.createScreenPoint(t+.5*i,e+.5*a));let h=Math.max(i/o.width,a/o.height);-1===s&&(h=1/h),this._destroyOverlay(),this.navigation.end(),o.goTo({center:n,scale:o.scale*h},{animationMode:"always",duration:l.getGoToDuration()})}_updateBox(t,e,i,r){const a=this._boxShape;a.setAttributeNS(null,"x",""+t),a.setAttributeNS(null,"y",""+e),a.setAttributeNS(null,"width",""+i),a.setAttributeNS(null,"height",""+r),a.setAttributeNS(null,"class",u.box)}_updateBackground(t,e,i,r){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,r,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=u.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",u.background);const r=document.createElementNS("http://www.w3.org/2000/svg","rect"),a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),a.setAttributeNS(null,"class",u.overlay),a.appendChild(i),a.appendChild(r),this._container.appendChild(a),this._backgroundShape=i,this._boxShape=r,this._overlay=a}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,i,r,a,s){const o=t+i,n=e+r;return"M 0 0 L "+a+" 0 L "+a+" "+s+" L 0 "+s+" ZM "+t+" "+e+" L "+t+" "+n+" L "+o+" "+n+" L "+o+" "+e+" Z"}_handleDrag(t,e){const i=t.x,r=t.y,a=t.origin.x,s=t.origin.y;let o,n,h,l;switch(i>a?(o=a,h=i-a):(o=i,h=a-i),r>s?(n=s,l=r-s):(n=r,l=s-r),t.action){case"start":this._start();break;case"update":this._update(o,n,h,l);break;case"end":this._end(o,n,h,l,e)}t.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:i,height:r}=this._box;this._updateBox(t,e,i,r),this._updateBackground(t,e,i,r),this._rafId=requestAnimationFrame(this._redraw)}},e.__decorate([a.property()],t.default.prototype,"navigation",void 0),e.__decorate([a.property()],t.default.prototype,"view",null),t.default=e.__decorate([h.subclass("esri.views.2d.navigation.ZoomBox")],t.default),t.default});