// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/quantityUtils","../../../core/unitUtils","../../../core/accessorSupport/ensureType","../../../geometry/Point","../../../support/elevationInfoUtils","./helpMessageUtils","./helpMessageUtils3d","../../interactive/sketch/constraintUtils","../../interactive/tooltip/tooltipCommonUtils","../../interactive/tooltip/infos/DrawCircleTooltipInfo","../../interactive/tooltip/infos/DrawMeshTooltipInfo","../../interactive/tooltip/infos/DrawMultipointTooltipInfo","../../interactive/tooltip/infos/DrawPointTooltipInfo","../../interactive/tooltip/infos/DrawPolygonTooltipInfo","../../interactive/tooltip/infos/DrawPolylineTooltipInfo","../../interactive/tooltip/infos/DrawRectangleTooltipInfo","../../support/angularMeasurementUtils","../../support/euclideanLengthMeasurementUtils"],function(e,t,o,n,i,r,a,l,s,c,p,u,d,g,m,f,y,w,h){"use strict";function v({geometryType:e,graphic:t,tooltipInfos:o}){return t?.geometry?.type!==M[e]?"circle"===e||"rectangle"===e?o[e]:null:o[e]}const M={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function O(e,t,o){const{drawOperation:n,view:i,sketchOptions:r}=o,{cursorVertex:a}=n;e.sketchOptions=r,e.viewType=i.type;const l="multipoint"===t?.type?t.getPoint(t.points.length-1):t;if(e.setLocationFromPoint(l,b(o)),T(e.elevation,o),!a)return void(n.constraints=void 0);const s=a;n.constraints={context:z(s,o),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}const k=n.ensureType(i);function D(e,o){const{drawOperation:n,sketchOptions:i,view:r,automaticLengthMeasurementUtils:a}=o,{cursorVertex:l,lastVertex:s,secondToLastVertex:c}=n,p=i.values.effectiveDirectionMode;e.sketchOptions=i,e.viewType=r.type;const u=s&&l?a.autoDistanceBetweenPoints2D(k(s),k(l))??t.zeroMeters:null;if(e.distance.actual=u,e.distance.readOnly=null==s,e.direction.actual=null,e.direction.readOnly=!0,s&&l&&("absolute"===p||c)){const o=w.directionForVertices(c,s,l,p);e.direction.actual=o??t.zeroDegreesGeographic,e.direction.readOnly=!1}e.setLocationFromPoint(l,b(o)),T(e.elevation,o);const d=function(e,{sketchOptions:t}){const o=t.tooltips.xyMode;return"auto"===o?e?"direction-distance":"coordinates":o}(s,o);e.xyMode=d,e.direction.visible="direction-distance"===d,e.distance.visible="direction-distance"===d,e.effectiveX.visible="coordinates"===d,e.effectiveY.visible="coordinates"===d;const g=l??s;n.constraints=g?{context:z(g,o),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function T(e,t){const{drawOperation:o}=t,n=o?.cursorVertex??o?.lastVertex;e.actual=h.elevationFromPoint(n)??V(t),e.visible=o.hasZ,e.readOnly=!1,e.showAsZ=!0}function I(e){const o=e.createOperationGeometry?.full;return"polygon"!==o?.type?t.zeroSquareMeters:e.automaticAreaMeasurementUtils.autoArea2D(o)??t.zeroSquareMeters}function x({createOperationGeometry:e,automaticLengthMeasurementUtils:o}){const n=e?.rectangle?.midpoints;return(null!=n?o.autoDistanceBetweenPoints2D(n.left,n.right):null)??t.zeroMeters}function P({createOperationGeometry:e,automaticLengthMeasurementUtils:o}){const n=e?.rectangle?.midpoints;return(null!=n?o.autoDistanceBetweenPoints2D(n.top,n.bottom):null)??t.zeroMeters}function U(e){return e.drawOperation.elevationInfo??r.absoluteHeightElevationInfo}function b(e){return e.drawOperation.coordinateHelper.spatialReference}function V(e){const n=o.getMetersPerVerticalUnitForSR(b(e));return t.createLength(e.defaultZ*n,"meters")}function z(e,t){return s.getConstraintContext(e,t.view,b(t),U(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}e.createTooltipInfos=function(e,t){return{point:new g.DrawPointTooltipInfo({sketchOptions:t,viewType:e}),multipoint:new d.DrawMultipointTooltipInfo({sketchOptions:t,viewType:e}),polyline:new f.DrawPolylineTooltipInfo({sketchOptions:t,viewType:e}),polygon:new m.DrawPolygonTooltipInfo({sketchOptions:t,viewType:e}),mesh:new u.DrawMeshTooltipInfo({sketchOptions:t,viewType:e}),rectangle:new y.DrawRectangleTooltipInfo({sketchOptions:t}),circle:new p.DrawCircleTooltipInfo({sketchOptions:t})}},e.getActiveTooltipInfo=v,e.getConstraintZ=function(e){const{geometryType:n,tooltipInfos:i}=e;switch(n){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const r=i[n].elevation.committed;if(!r)return;return t.valueInUnit(r,"meters")/o.getMetersPerVerticalUnitForSR(b(e))}default:return}},e.initializeConstraints=function(e){const{directionOptions:t,geometryType:o,sketchOptions:n,tooltipInfos:i}=e,r=t=>{const o=U(e).mode,n=i[t].elevation;"relative-to-ground"===o||"relative-to-scene"===o||"on-the-ground"===o?n.lock(V(e)):n.unlock()};switch(o){case"polygon":case"polyline":r(o),(e=>{if(t){const o=i[e].direction;o.committed=t.angle,o.unlockOnVertexPlacement=!1,n.values.directionMode=t.mode}})(o);break;case"point":case"mesh":r(o)}},e.lockElevationOnVertexAdd=function(e,t){const{drawOperation:o,view:n}=t,i=v(t),a=U(t);if("2d"===n.type||!e||"absolute-height"!==a.mode||1!==o?.numCommittedVertices||!i||"draw-polyline"!==i.type&&"draw-polygon"!==i.type||i.elevation.locked)return;const[l,s,c]=e,p=function(e,t,o,n,i){const{view:a,drawOperation:l}=i;if("3d"!==a.type||!l)return;o??=0;const s=b(i),c=U(i),p=r.getConvertedElevationFromXYZ(a,e,t,o,s,c,n);return h.elevationFromZ(p,s)??V(i)}(l,s,c,a,t);null!=p&&i.elevation.lock(p)},e.unlockConstraintsOnVertexAddOrRemove=function(e){v(e)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})},e.updateTooltipInfo=function(e,o){switch(e?.type){case"draw-point":!function(e,t){const o=t.graphic?.geometry;"point"===o?.type&&(O(e,o,t),e.helpMessage=a.getDrawHelpMessage("point",o,t.drawOperation.drawingMode))}(e,o);break;case"draw-multipoint":!function(e,t){const o=t.graphic?.geometry;"multipoint"===o?.type&&(O(e,o,t),e.helpMessage=a.getDrawHelpMessage("multipoint",o,t.drawOperation.drawingMode))}(e,o);break;case"draw-polyline":!function(e,o){const{createOperationGeometry:n,drawOperation:i,automaticLengthMeasurementUtils:r}=o,l=null!=n?n.full:null;l&&"polyline"!==l.type||(D(e,o),e.totalLength.actual=i.lastVertex?(l?r.autoLength2D(l):null)??t.zeroMeters:null,e.helpMessage=a.getDrawHelpMessage("polyline",l,o.drawOperation.drawingMode))}(e,o);break;case"draw-polygon":!function(e,o){const{createOperationGeometry:n,drawOperation:i}=o,r=null!=n?n.full:null;r&&"polygon"!==r.type||(D(e,o),e.area.actual=i.lastVertex?(r?o.automaticAreaMeasurementUtils.autoArea2D(r):null)??t.zeroSquareMeters:null,e.helpMessage=a.getDrawHelpMessage("polygon",r,o.drawOperation.drawingMode))}(e,o);break;case"draw-rectangle":!function(e,t){e.sketchOptions=t.sketchOptions,e.xSize=x(t),e.ySize=P(t),e.area=I(t),e.helpMessage=a.getDrawHelpMessage("rectangle",t.graphic?.geometry,t.drawOperation.drawingMode)}(e,o);break;case"draw-circle":!function(e,o){const{forceUniformSize:n,sketchOptions:i}=o;e.sketchOptions=i,e.radius=n?function({createOperationGeometry:e,automaticLengthMeasurementUtils:o}){return(null!=e?.circle?.center&&null!=e.circle.edge?o.autoDistanceBetweenPoints2D(e.circle.center,e.circle.edge):null)??t.zeroMeters}(o):null,e.xSize=n?null:x(o),e.ySize=n?null:P(o),e.area=I(o),e.helpMessage=a.getDrawHelpMessage("circle",o.graphic?.geometry,o.drawOperation.drawingMode)}(e,o);break;case"draw-mesh":!function(e,t){const{graphic:o,view:n}=t,i=o?.geometry;"3d"!==n.type||i&&"mesh"!==i.type||(O(e,i?.origin,t),i&&c.updateTooltipInfoFromMeshTransform(e,i),e.helpMessage=l.getDrawMeshHelpMessage(o,n))}(e,o)}},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});