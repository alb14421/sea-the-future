// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../chunks/tslib.es6","../core/domUtils","../core/events","../core/handleUtils","../core/Logger","../core/maybe","../core/reactiveUtils","../core/scheduling","../core/accessorSupport/decorators/property","../core/has","../core/RandomLCG","../core/accessorSupport/decorators/subclass","./overlay/ViewOverlay"],function(e,t,s,i,r,o,n,a,d,h,l,c,u,p){"use strict";const _=[0,0];function y(e){const t=(e.ownerDocument||window.document).defaultView,s=e.getBoundingClientRect();return _[0]=s.left+(t?.pageXOffset??0),_[1]=s.top+(t?.pageYOffset??0),_}function g(e){e&&(e.textContent="",e.parentNode&&e.parentNode.removeChild(e))}const f=16,v=750;e.DOMContainer=e=>{const l=e;let c=class extends l{constructor(...e){super(...e),this._freqInfo={freq:f,time:v},this._overlayRenderTaskHandle=null,this.height=0,this.messagesCommon=null,this.overlay=null,this.position=null,this.resizing=!1,this.root=null,this.surface=null,this.suspended=!0,this.userContent=null,this.width=0,this.widthBreakpoint=null,this.addHandles([a.watch(()=>this.cursor,e=>{const{surface:t}=this;t&&t.setAttribute("data-cursor",e)}),a.watch(()=>this.navigating,e=>{const{surface:t}=this;t&&t.setAttribute("data-navigating",e.toString())})])}initialize(){this.addHandles([a.watch(()=>this.ui,(e,t)=>this._handleUIChange(e,t),a.initial),this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])}destroy(){this.destroyed||(this.ui?.destroy(),this.container=null)}get container(){return this._get("container")??null}set container(e){const t=this._get("container"),i=s.byId(e);if(i||"string"!=typeof e||o.getLogger(this).error("#container",`element with id '${e}' not found`),t===i)return;if(this._stopMeasuring(),t&&(t.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(g(this.root),this._set("root",null)),this.userContent&&(s.reparent(this.userContent,t),g(this.userContent),this._set("userContent",null))),!i)return this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),void this._set("container",null);i.classList.add("esri-view");const r=document.createElement("div");r.className="esri-view-user-storage",s.reparent(i,r),i.appendChild(r),this._set("userContent",r);const h=document.createElement("div");h.className="esri-view-root",i.insertBefore(h,i.firstChild),this._set("root",h);const l=document.createElement("div");l.className="esri-view-surface",l.setAttribute("role","application"),l.tabIndex=0,h.appendChild(l),this._set("surface",l);const c=new p;h.appendChild(c.surface),this._set("overlay",c),this.addHandles(a.watch(()=>c.needsRender,e=>{e&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=d.addFrameTask({render:()=>this.overlay?.render()}):this._overlayRenderTaskHandle=n.removeMaybe(this._overlayRenderTaskHandle)})),this.forceDOMReadyCycle(),this._set("container",i),this._startMeasuring()}get focused(){const e=document.activeElement===this.surface;return document.hasFocus()&&e}get size(){return[this.width,this.height]}set ui(e){const t=this._get("ui");t!==e&&t?.destroy(),this._set("ui",e)}blur(){this.surface?.blur()}focus(){this.surface?.focus()}pageToContainer(e,t,s){const i=this.position;return e-=i?i[0]:0,t-=i?i[1]:0,s?(s[0]=e,s[1]=t):s=[e,t],s}containerToPage(e,t,s){const i=this.position;return e+=i?i[0]:0,t+=i?i[1]:0,s?(s[0]=e,s[1]=t):s=[e,t],s}_handleUIChange(e,t){this.removeHandles("ui"),t&&t!==e&&t.destroy(),e&&(e.view=this,this.addHandles(a.watch(()=>this.root,t=>{e.container=t?function(e){const t=document.createElement("div");return e.appendChild(t),t}(t):null},a.initial),"ui")),this._set("ui",e)}_stopMeasuring(){this.removeHandles("measuring"),this._get("resizing")&&this._set("resizing",!1)}_startMeasuring(){const e=this._freqInfo;e.freq=f,e.time=v;const t=d.addFrameTask({prepare:e=>{const s=this._measure(),i=this._freqInfo;if(i.time+=e.deltaTime,s&&(i.freq=f,this._get("resizing")||this._set("resizing",!0)),i.time<i.freq)return;i.time=0;const r=this._position();i.freq=r||s?f:Math.min(v,2*i.freq),!s&&i.freq>=512&&(t.pause(),this._get("resizing")&&this._set("resizing",!1))}}),s=new ResizeObserver(s=>{e.freq=f,e.time=v,t.resume()});null!=this.container&&s.observe(this.container);const o=r.makeHandle(()=>s.disconnect());this.addHandles([i.on(window,"resize",()=>{e.freq=f,e.time=v,t.resume()}),o,t],"measuring"),this._measure(),this._position()}_measure(){const e=this.container,t=e?e.clientWidth:0,s=e?e.clientHeight:0;if(0===t||0===s)return this.suspended||this._set("suspended",!0),!1;const i=this.width,r=this.height;return t===i&&s===r?(this.suspended&&this._set("suspended",!1),!1):(this._set("width",t),this._set("height",s),this.suspended&&this._set("suspended",!1),this.emit("resize",{oldWidth:i,oldHeight:r,width:t,height:s}),!0)}_position(){const e=this.container,t=this.position,s=e&&y(e);return!(!s||t&&s[0]===t[0]&&s[1]===t[1]||(this._set("position",[s[0],s[1]]),0))}forceDOMReadyCycle(){}};return t.__decorate([h.property()],c.prototype,"container",null),t.__decorate([h.property({readOnly:!0})],c.prototype,"focused",null),t.__decorate([h.property({readOnly:!0})],c.prototype,"height",void 0),t.__decorate([h.property()],c.prototype,"messagesCommon",void 0),t.__decorate([h.property({type:p})],c.prototype,"overlay",void 0),t.__decorate([h.property({readOnly:!0})],c.prototype,"position",void 0),t.__decorate([h.property({readOnly:!0})],c.prototype,"resizing",void 0),t.__decorate([h.property({readOnly:!0})],c.prototype,"root",void 0),t.__decorate([h.property({value:null,readOnly:!0})],c.prototype,"size",null),t.__decorate([h.property({readOnly:!0})],c.prototype,"surface",void 0),t.__decorate([h.property({readOnly:!0})],c.prototype,"suspended",void 0),t.__decorate([h.property({nonNullable:!0})],c.prototype,"ui",null),t.__decorate([h.property({readOnly:!0})],c.prototype,"userContent",void 0),t.__decorate([h.property({readOnly:!0})],c.prototype,"width",void 0),t.__decorate([h.property()],c.prototype,"widthBreakpoint",void 0),c=t.__decorate([u.subclass("esri.views.DOMContainer")],c),c},Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});