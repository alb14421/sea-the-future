// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/has","../3d/webgl-engine/core/shaderModules/glsl","./AppleAmdDriverHelper","./BufferObject","./enums","./FramebufferObject","./TextureDescriptor","./WebGLDriverTestModule"],function(e,r,t,i,n,o,s,a,l){"use strict";class p extends l.WebGLDriverTestModule{constructor(e){super(),this._rctx=e,this._helperProgram=null,r("mac")&&r("chrome")&&(this._program=this._prepareProgram(),this._helperProgram=this._prepareHelperProgram())}dispose(){super.dispose(),this._helperProgram?.dispose(),this._helperProgram=null}_test(e){const r=this._rctx,t=r.getBoundFramebufferObject(),{x:i,y:l,width:p,height:c}=r.getViewport();r.resetState();const g=new a.TextureDescriptor(1);g.wrapMode=33071,g.samplingMode=9728;const d=new s.FramebufferObject(r,g),u=n.BufferObject.createIndex(this._rctx,35044,new Uint8Array([0]));r.bindFramebuffer(d),r.setViewport(0,0,1,1),r.useProgram(this._helperProgram),r.bindBuffer(u,34963),r.drawElements(o.PrimitiveType.POINTS,1,o.DataType.UNSIGNED_BYTE,0),r.useProgram(e),r.bindVAO(null),r.drawArrays(o.PrimitiveType.TRIANGLES,0,258);const f=new Uint8Array(4);return d.readPixels(0,0,1,1,6408,o.PixelType.UNSIGNED_BYTE,f),r.setViewport(i,l,p,c),r.bindFramebuffer(t),d.dispose(),u.dispose(),255===f[0]}_prepareProgram(){const e=`#version 300 es\n    precision highp float;\n\n    out float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${t.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,r=`#version 300 es\n    precision highp float;\n\n    in float triangleId;\n\n    out vec4 fragColor;\n\n    void main(void) {\n      fragColor = triangleId == ${t.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(e,r,new Map([]))}_prepareHelperProgram(){const e=i.AppleAmdDriverHelper.getShaderSources();return this._rctx.programCache.acquire(e.vertex,e.fragment,new Map([]))}}e.DrawArraysRequiresIndicesTypeReset=p,Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});