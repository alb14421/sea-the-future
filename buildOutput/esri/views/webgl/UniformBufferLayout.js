// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["exports","../../core/Logger","./storageLayouts"],function(t,e,a){"use strict";function r(t,e){return t+(e-t%e)%e}const n=(()=>{const t=new ArrayBuffer(2),e=new Uint8Array(t),a=new Uint16Array(t);return e[0]=170,e[1]=187,48042===a[0]})(),i=()=>e.getLogger("esri.views.webgl.UniformBufferLayout");t.UniformBufferLayout=class{constructor(t){this._layout=new Map,this.byteLength=this._buildLayout(t),this.array=new ArrayBuffer(this.byteLength),this.arrayView32=new Float32Array(this.array),this._dataView=new DataView(this.array)}setValues(t,e){t.forEach((t,a)=>this.setValue(a,t,e))}setValue(t,e,r){if(!this._layout.has(t))return void i().warn("Trying to set an unrecognized layout array member!");let n=this.byteLength/4,s=0;const{type:o,offset:h,arrayLength:u}=this._layout.get(t),{numberType:y,elementLength:l,elementCount:f,arrayStride:g}=a.STD140_LAYOUT[o],m="number"!=typeof e,c=u*f,w=c*l;if((m?"byteLength"in e?e.byteLength/4:e.length:1)!==w&&i().warn("Attempting to set layout array member value with the wrong length!"),m)for(let t=0;t<c;t++)for(let a=0;a<l;a++){const r=h+t*g+4*a,i=t*l+a;if(this._setData(r,e[i],y)){const t=r/4;n=Math.min(n,t),s=Math.max(s,t+1)}}else if(this._setData(h,e,y)){const t=h/4;n=Math.min(n,t),s=Math.max(s,t+1)}r&&(r.from=Math.min(n,r.from),r.to=Math.max(s,r.to))}_setData(t,e,a){switch(a){case"Int32":if(e!==this._dataView.getInt32(t,n))return this._dataView.setInt32(t,e,n),!0;break;case"Uint32":if(e!==this._dataView.getUint32(t,n))return this._dataView.setUint32(t,e,n),!0;break;case"Float32":if(e!==this._dataView.getFloat32(t,n))return this._dataView.setFloat32(t,e,n),!0}return!1}_buildLayout(t){let e=0;for(const{name:n,type:i,count:s}of t){const{elementLength:t,elementCount:o,elementAlignment:h,arrayStride:u,arrayAlignment:y}=a.STD140_LAYOUT[i],l=s??1,f=l*o,g=f>1,m=g?y:h,c=g?f*u:4*t;e=r(e,m),this._layout.set(n,{type:i,offset:e,arrayLength:l}),e+=c,g&&(e=r(e,m))}return r(e,16)}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});