// All material copyright Esri, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.34/esri/copyright.txt for details.
//>>built
define(["../../chunks/tslib.es6","../../core/Error","../../core/promiseUtils","../../core/accessorSupport/decorators/property","../../core/has","../../core/Logger","../../core/RandomLCG","../../core/accessorSupport/decorators/subclass","../../geometry/Point","../../layers/support/timeSupport","../../layers/support/rasterFunctions/rasterProjectionHelper","../../rest/support/Query","./support/popupUtils"],function(e,t,r,o,s,a,i,n,p,c,u,l,y){"use strict";return s=>{const a=s;let i=class extends a{constructor(...e){super(...e),this.view=null}get timeExtent(){return c.combineTimeExtent(this.layer,this.view?.timeExtent,this._get("timeExtent"))}async fetchPopupFeaturesAtLocation(e,o){const{layer:s}=this;if(!e)throw new t("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:s});const{popupEnabled:a}=s,i=y.getFetchPopupTemplate(s,o);if(!a||null==i)return[];const n=await i.getRequiredFields();r.throwIfAborted(o);const c=new l;c.timeExtent=this.timeExtent,c.geometry=e,c.outFields=n,c.outSpatialReference=e.spatialReference;const{resolution:u,spatialReference:d}=this.view,h="2d"===this.view.type?new p(u,u,d):new p(.5*u,.5*u,d),{returnTopmostRaster:m,showNoDataRecords:w}=i.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},R={returnDomainValues:!0,returnTopmostRaster:m,pixelSize:h,showNoDataRecords:w,signal:o?.signal};return s.queryVisibleRasters(c,R).then(e=>e)}async getSourceScale(){return await u.load(),await this.layer.load(),u.getSourceScale(this.layer.serviceRasterInfo,this.view.spatialReference)}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return e.__decorate([o.property()],i.prototype,"layer",void 0),e.__decorate([o.property()],i.prototype,"suspended",void 0),e.__decorate([o.property({readOnly:!0})],i.prototype,"timeExtent",null),e.__decorate([o.property()],i.prototype,"view",void 0),i=e.__decorate([n.subclass("esri.views.layers.ImageryLayerView")],i),i}});