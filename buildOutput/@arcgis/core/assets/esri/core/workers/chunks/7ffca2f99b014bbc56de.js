"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[6851],{16851:(e,t,s)=>{s.r(t),s.d(t,{default:()=>p});var i=s(32816),r=s(32773),n=s(6407),o=s(57732),a=s(67535),u=s(7969),l=s(47239),h=s(2232),c=s(79875),d=s(30011),f=s(65892),_=s(95115),m=s(83565);s(20266),s(90740),s(59121),s(84699),s(80959),s(13671),s(19247),s(41003),s(91047),s(93181),s(44945),s(58498),s(20527),s(45371),s(61532),s(7078),s(41390),s(69421),s(50704),s(40499),s(36544),s(48064),s(85176),s(36555),s(29298),s(35819),s(36172),s(99924),s(69763),s(93804),s(96221),s(18683),s(64604),s(29512),s(99063),s(1178),s(56273),s(44600),s(2160),s(49877),s(64752),s(48844),s(29208),s(48402),s(16699),s(22522),s(88321),s(2589),s(36533),s(84200),s(97827),s(18169),s(20762),s(67504),s(47387),s(46728),s(21632),s(64102),s(77037),s(83637),s(58003),s(33489),s(96153),s(34362),s(23787),s(22151),s(38896),s(26589),s(7011),s(133),s(54483),s(59192),s(17872),s(59700),s(2824),s(56764),s(70648),s(69310),s(31572),s(4734),s(50214),s(16345),s(9943),s(91276),s(18527),s(62482),s(45476),s(71044),s(17745),s(81272),s(43534),s(13226),s(47812),s(83463),s(346),s(78016),s(16641),s(88817),s(88663),s(3687),s(3952),s(339),s(79281),s(13978),s(47368),s(29403),s(40672),s(52731),s(96587),s(79747),s(14509),s(14549),s(26171),s(85842),s(75169),s(67321),s(33348),s(47334),s(56988);const y=new _.a,g=8e3;class p{constructor(){this._files=[],this._queue=new a.QueueProcessor({concurrency:1,process:(e,t)=>this._executeQuery(e,t)})}async load(e){this.setCustomParameters(e.customParameters),this._files=await Promise.all(e.urls.map(t=>(0,f.c)(t,{geometryInfo:e.geometryInfo,outSpatialReference:null,getCustomParameters:()=>this._customParameters}))),this._metadata=_.F.createFeature(e.metadata),this._queryEngineParams={fieldsIndex:this._metadata.fieldsIndex,geometryType:e.geometryInfo?.geometryType??"esriGeometryPoint",featureIdInfo:{type:"object-id",fieldName:"rowId"},hasM:!1,hasZ:!1,spatialReference:u.A.fromJSON(e.geometryInfo?.spatialReference),aggregateAdapter:null,timeInfo:null,definitionExpression:null};const t=this._files[0];if(!t)return{extent:null};const{fields:s,timeZoneByFieldName:r}=e.metadata.fieldsIndex,n=s.map(e=>({...e,column:t.columnForFieldName(e.name)})),o=c.A.fromJSON({fields:n,timeZoneByFieldName:r});if(this._fieldsIndex=o,e.metadata.spatialReference&&(this._fullExtent=function(e,t){const s=(0,l.s)((0,l.c)(),l.n);for(const t of e){const e=(0,f.r)(t);if(!e)return null;const i=e.columns[e.primary_column];if(!i.bbox)return null;const r=x(i.bbox);(0,l.b)(s,r)}return{xmin:s[0],ymin:s[1],xmax:s[3],ymax:s[4],spatialReference:t}}(this._files,e.metadata.spatialReference)),null==this._fullExtent&&"location"===e.geometryInfo?.encoding.type){const{latitudeFieldName:t,longitudeFieldName:s}=e.geometryInfo.encoding,r=this._fieldsIndex.get(t)?.column,n=this._fieldsIndex.get(s)?.column,o=(0,l.s)((0,l.c)(),l.n);for(const e of this._files)for(const t of e.rowGroups()){const e={stack:[],error:void 0,hasError:!1};try{const s=(0,i.a)(e,t.columnDescriptorForAttribute(r),!1),a=(0,i.a)(e,t.columnDescriptorForAttribute(n),!1),u=[a.minValue(),s.minValue(),a.maxValue(),s.maxValue()];(0,l.q)(o,u),t.free()}catch(t){e.error=t,e.hasError=!0}finally{(0,i.b)(e)}}this._fullExtent={xmin:o[0],ymin:o[1],xmax:o[3],ymax:o[4],spatialReference:e.metadata.spatialReference}}return{extent:this._fullExtent}}destroy(){for(const e of this._files)e.free();this._queue.destroy()}setCustomParameters(e){this._customParameters=e}async queryFeatures(e,t){return this._validateQuery(e),e.resultRecordCount=e.resultRecordCount?Math.min(e.resultRecordCount,8e3):8e3,e.resultOffset=e.resultOffset??0,(await this._enqueueQuery(e,t)).createQueryResponse()}async queryFeatureCount(e,t){return this._validateQuery(e),z(e)?(e.resultRecordCount=e.resultRecordCount??this._getFeatureCount(),e.resultOffset=e.resultOffset??0,delete e.outFields,delete e.returnGeometry,(await this._enqueueQuery(e,t)).createQueryResponseForCount()):this._getFeatureCount()}async queryObjectIds(e,t){return this._validateQuery(e),z(e)?(e.resultRecordCount=e.resultRecordCount?Math.min(e.resultRecordCount,8e3):8e3,e.resultOffset=e.resultOffset??0,delete e.returnGeometry,delete e.outFields,(await this._enqueueQuery(e,t)).items.map(e=>e.getObjectId())):Array.from({length:this._getFeatureCount()},(e,t)=>t)}async queryExtent(e,t){if(this._validateQuery(e),this._fullExtent&&!z(e))return{count:this._getFeatureCount(),extent:this._fullExtent};const s=(0,r.t)(this._metadata.spatialReference);e.resultOffset=e.resultOffset??0,e.resultRecordCount=e.resultRecordCount??this._getFeatureCount(),e.returnGeometry=!0,delete e.outFields;const i=(0,l.s)((0,l.c)(),l.n),n=(0,l.c)(),o=await this._enqueueQuery(e,t);let a=0;for(const e of o.items)e.getBounds(n)&&((0,l.b)(i,n),a+=1);return{count:a,extent:(0,h.b)(i,s,e.outSR?(0,r.t)(e.outSR):s,s,!1)}}_getFeatureCount(){return this._files.reduce((e,t)=>e+t.numRows(),0)}_validateQuery(e){if(e.outStatistics)throw new n.A("parquet:unsupported","Statistics queries are not supported",{query:e});if(e.orderByFields?.length)throw new n.A("parquet:unsupported","Queries using orderBy are not supported",{query:e})}async*_fetchChunks(e,t){const s=this._files[0].numRows(),i=Math.ceil(s/g);for(let s=0;s<i;s++){const i=s*g,r=await this._files[0].readChunk(i,g,e.fields,e.returnGeometry,t);for(const e of r){const t=new m.F(this._metadata,this._fieldsIndex,e,0),s=new m.a(t,null,0,!1),i=b(this._metadata,s,this._queryEngineParams);yield i}}}_enqueueQuery(e,t){return this._queue.push(e,t)}async _executeQuery(e,t){let s=e.resultRecordCount,i=e.resultOffset;(0,o.b)(s),(0,o.b)(i),delete e.resultRecordCount,delete e.resultOffset;const r=await this._getReadParams(e),n=[];for await(const o of this._fetchChunks(r,t)){const r=await o.executeQueryForOpaqueFeatures(e,t);if(r.length>i){const t=r.slice(i,Math.min(s,r.length));for(const e of t)n.push(e);if(i=0,s-=t.length,0===s)return new h.Q(n,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._metadata.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:y})}else i-=r.length}return new h.Q(n,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._metadata.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:y})}async _getReadParams(e){const t=new Set;if(e.where&&await(0,d.hz)(t,this._fieldsIndex,e.where),e.outStatistics)for(const s of e.outStatistics)null!=s.onStatisticField&&t.add(s.onStatisticField);if(e.outFields)for(const s of e.outFields)t.add(s);return{fields:this._getAttributeIds(Array.from(t)),returnGeometry:!!e.returnGeometry||!!e.geometry}}_getAttributeIds(e){if(null==e)return new Uint32Array;if(e.includes("*"))return new Uint32Array(this._fieldsIndex.fields.map(e=>e.column).filter(e=>null!=e));const t=[];for(const s of e){const e=this._fieldsIndex.get(s);if(null==e)throw new n.A("unknown-field",`Field ${s} does not exist`);null==e.column||t.push(e.column)}return new Uint32Array(t)}}function z(e){return Object.keys(e).some(e=>function(e){switch(e){case"resultOffset":case"resultRecordCount":case"aggregateIds":case"distance":case"gdbVersion":case"geometry":case"having":case"timeExtent":case"where":case"objectIds":case"historicMoment":return!0;default:return!1}}(e))}function b(e,t,s){const i=new m.b(e);return i.insert(t),new h.a({...s,featureStore:i})}function x(e){switch(e.length){case 4:return(0,l.g)((0,l.c)(),e);case 6:return e;default:throw new n.A("parquet:protocol-violation","Invalid Geoparquet file. BoundingBox size must be 4 or 6.",{bbox:e})}}},22151:(e,t,s)=>{s.d(t,{M:()=>r});const i=!!(0,s(32773).h)("esri-tests-disable-gpu-memory-measurements");Symbol.iterator;class r{get size(){return this._size}constructor(e=10485760){this._maxSize=e,this._db=new Map,this._size=0,this._hit=0,this._miss=0,this._users=new Map,this._sizeLimits=new Map}destroy(){this.clearAll(),this._sizeLimits.clear(),this._users.clear(),this._db=null}register(e){this._users.set(e.id.slice(0,-1),e)}deregister(e){this.clear(e),this._sizeLimits.delete(e),this._users.delete(e.id.slice(0,-1))}get maxSize(){return this._maxSize}set maxSize(e){this._maxSize=Math.max(e,-1),this._checkSize()}getSize(e,t){const s=this._db.get(e.id+t);return s?.size??0}put(e,t,s,r,o){t=e.id+t;const a=this._db.get(t);if(a&&(this._size-=a.size,e.size-=a.size,this._db.delete(t),a.entry!==s&&this._notifyRemove(t,a.entry,a.size,0)),r>this._maxSize)return void this._notifyRemove(t,s,r,0);if(void 0===s)return void console.warn("Refusing to cache undefined entry ");if(!r||r<0)return i||console.warn(`Refusing to cache entry with size ${r} for key ${t}`),void this._notifyRemove(t,s,0,0);const u=1+Math.max(o,-4)- -3;this._db.set(t,new n(s,r,u)),this._size+=r,e.size+=r,this._checkSize()}updateSize(e,t,s,i){t=e.id+t;const r=this._db.get(t);if(r&&r.entry===s){for(this._size-=r.size,e.size-=r.size;i>this._maxSize;){const e=this._notifyRemove(t,s,i,1);if(!(null!=e&&e>0))return void this._db.delete(t);i=e}r.size=i,this._size+=i,e.size+=i,this._checkSize()}}pop(e,t){t=e.id+t;const s=this._db.get(t);if(s)return this._size-=s.size,e.size-=s.size,this._db.delete(t),++this._hit,s.entry;++this._miss}get(e,t){t=e.id+t;const s=this._db.get(t);if(void 0!==s)return this._db.delete(t),s.lives=s.lifetime,this._db.set(t,s),++this._hit,s.entry;++this._miss}peek(e,t){const s=this._db.get(e.id+t);return s?++this._hit:++this._miss,s?.entry}get performanceInfo(){const e={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},t={},s=new Array;this._db.forEach((e,i)=>{const r=e.lifetime;s[r]=(s[r]||0)+e.size,this._users.forEach(s=>{const{id:r,name:n}=s;if(i.startsWith(r)){const s=t[n]||0;t[n]=s+e.size}})});const i={};this._users.forEach(e=>{const s=e.name;if("hitRate"in e&&"number"==typeof e.hitRate&&!isNaN(e.hitRate)&&e.hitRate>0){const r=t[s]||0;t[s]=r,i[s]=Math.round(100*e.hitRate)+"%"}else i[s]="0%"});const r=Object.keys(t);r.sort((e,s)=>t[s]-t[e]),r.forEach(s=>e[s]=Math.round(t[s]/2**20)+"MB / "+i[s]);for(let t=s.length-1;t>=0;--t){const i=s[t];i&&(e["Priority "+(t+-3-1)]=Math.round(i/this._size*100)+"%")}return e}resetStats(){this._hit=this._miss=0,this._users.forEach(e=>e.resetHitRate())}clear(e){const t=e.id;this._db.forEach((e,s)=>{s.startsWith(t)&&(this._size-=e.size,this._db.delete(s),this._notifyRemove(s,e.entry,e.size,0))}),e.size=0}clearAll(){this._db.forEach((e,t)=>this._notifyRemove(t,e.entry,e.size,0)),this._users.forEach(e=>e.size=0),this._size=0,this._db.clear()}*values(e){for(const[t,s]of this._db)t.startsWith(e.id)&&(yield s.entry)}_getHitRate(){return this._hit/(this._hit+this._miss)}_notifyRemove(e,t,s,i){const r=this._users.get(e.split(o)[0])?.removeFunc,n=r?.(t,i,s);return"number"==typeof n?n:null}_checkSize(){this._sizeLimits.forEach((e,t)=>this._checkSizeLimits(e,t)),this._checkSizeLimits(this.maxSize)}setMaxSize(e,t){null==t||t<=0?this._sizeLimits.delete(e):this._sizeLimits.set(e,t)}_checkSizeLimits(e,t){const s=t??this;if(s.size<=e)return;const i=t?.id;let r=!0;for(;r;){r=!1;for(const[n,a]of this._db)if(0===a.lifetime&&(!i||n.startsWith(i))){const i=t??this._users.get(n.split(o)[0]);if(this._purgeItem(n,a,i),s.size<=.9*e)return;r||=this._db.has(n)}}for(const[r,n]of this._db)if(!i||r.startsWith(i)){const i=t??this._users.get(r.split(o)[0]);if(this._purgeItem(r,n,i),s.size<=.9*e)return}}_purgeItem(e,t,s){if(this._db.delete(e),t.lives<=1){this._size-=t.size,s&&(s.size-=t.size);const i=this._notifyRemove(e,t.entry,t.size,1);null!=i&&i>0&&(this._size+=i,s&&(s.size+=i),t.lives=t.lifetime,t.size=i,this._db.set(e,t))}else--t.lives,this._db.set(e,t)}}class n{constructor(e,t,s){this.entry=e,this.size=t,this.lifetime=s,this.lives=s}}const o=":"},23787:(e,t,s)=>{s.d(t,{L:()=>r});var i=s(22151);class r{constructor(e,t){this.removeFunc=t,this._storage=new i.M,this.id="",this.name="",this.size=0,this._storage.maxSize=e,this._storage.register(this)}destroy(){this._storage.deregister(this),this._storage.destroy(),this._storage=null}put(e,t,s=1){this._storage.put(this,e,t,s,1)}pop(e){return this._storage.pop(this,e)}get(e){return this._storage.get(this,e)}clear(){this._storage.clearAll()}get maxSize(){return this._storage.maxSize}set maxSize(e){this._storage.maxSize=e}resetHitRate(){}}},52731:(e,t,s)=>{s.d(t,{O:()=>l,P:()=>h});var i=s(32816),r=s(41390),n=s(32773),o=(s(20266),s(57732)),a=s(93181),u=s(69421);s(85176),s(50704),s(40499),s(36555),s(58498),s(13671),s(91047),s(29298),s(36544),s(6407),s(59121),s(35819),s(45371),s(61532),s(80959),s(19247),s(36172),s(90740),s(84699),s(48064);const l=e=>{const t=e;let s=class extends t{clone(e){const t=(0,a.g)(this);(0,o.b)(t,"unable to clone instance of non-accessor class");const s=t.metadata,i=t.store,r={},u=new Map;for(const t in s){const o=s[t],a=i?.originOf(t),l=o.clonable;if(o.readOnly||!1===l||7!==a&&0!==a&&5!==a&&4!==a)continue;const h=this[t];let c=null;if("function"==typeof l)c=l(h,e);else if("reference"===l)c=h;else if(c=(0,n.TU)(h,e),null!=h&&null==c)continue;0===a?u.set(t,c):r[t]=c}const l=new(0,Object.getPrototypeOf(this).constructor)(r);if(u.size){const e=(0,a.g)(l)?.store;if(e)for(const[t,s]of u)e.set(t,s,0)}return l}};return s=(0,i._)([(0,u.$)("esri.core.Clonable")],s),s},h=l(r.A)}}]);