"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[2072],{15001:(e,t,n)=>{n.d(t,{i:()=>s});const i=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]];function s(e){return null!=e&&i.some(([t,n])=>e>=t&&e<=n)}},72072:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ve});var i=n(32816),s=n(72393),a=n(52731),o=n(6407),r=n(2810),l=n(80959),c=n(67321),u=n(29298),d=(n(32773),n(20266)),p=n(69421),m=n(73597),f=n(31315),g=n(4335),h=n(48562),v=n(88730),y=n(38424),b=n(81089),w=n(46935),x=n(96807),C=n(69448),I=n(65174),S=n(44864),A=n(22606),D=n(44600),T=n(15001),L=n(64604),M=n(97417),R=n(84200),P=n(55095),E=n(30291),$=(n(90740),n(59121),n(29512),n(99063),n(84699),n(1178),n(13671),n(19247),n(36544),n(85176),n(93181),n(40499),n(50704),n(91047),n(48064),n(2160),n(99924),n(41390),n(36555),n(58498),n(35819),n(45371),n(61532),n(36172),n(49877),n(7969),n(69763),n(93804),n(96221),n(18683),n(56273),n(64752),n(48844),n(29208),n(97827),n(18169),n(20762),n(48402),n(16699),n(22260),n(85673),n(75213),n(25456));function O(e){return e.endsWith("?")?e.slice(0,-1):e}function _(e){return e.filter(({coverageSubType:e})=>null==e||""===e||/^rectified(grid|dataset)/i.test(e))}function N(e){const t={};for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];if(1!==i.nodeType)continue;const s=(0,M.e)(i).toLowerCase();switch(s){case"title":case"abstract":t[s]=(0,M.a)(i);break;case"identifier":t.id=(0,M.a)(i);break;case"wgs84boundingbox":{const e=(0,M.d)(i,"LowerCorner"),n=(0,M.d)(i,"UpperCorner");t.lonLatEnvelope=new D.A({xmin:e[0],ymin:e[1],xmax:n[0],ymax:n[1],spatialReference:{wkid:4326}})}break;case"coveragesummary":t.coverageSummaries=t.coverageSummaries||[],t.coverageSummaries.push(N(i))}}return t}function k(e,t){if(e.coverageSummaries)for(let n=0;n<e.coverageSummaries.length;n++)e.coverageSummaries[n].abstract=e.coverageSummaries[n].abstract||e.abstract,e.coverageSummaries[n].lonLatEnvelope=e.coverageSummaries[n].lonLatEnvelope||e.lonLatEnvelope,e.coverageSummaries[n].title=e.coverageSummaries[n].title||e.title,k(e.coverageSummaries[n],t);null!=e.id&&t.push(e)}function V(e){const t=(0,M.g)(e.querySelector("Operation[name=GetCapabilities]"),"Get")?.getAttribute("xlink:href")||"",n=(0,M.g)(e.querySelector("Operation[name=DescribeCoverage]"),"Get")?.getAttribute("xlink:href")||"",i=(0,M.g)(e.querySelector("Operation[name=GetCoverage]"),"Get")?.getAttribute("xlink:href")||"";return{getCapabilities:O(t),describeCoverage:O(n),getCoverage:O(i)}}function F(e){e.variables.forEach(e=>e.dimensions.forEach(e=>e.values??=(0,E.j)(e)))}function G(e){return{requestResponseCRSs:(0,M.b)(e,"requestResponseCRSs").map(e=>e.split(":")[1]),nativeCRSs:(0,M.b)(e,"nativeCRSs").map(e=>e.split(":")[1])}}function W(e,t){const n=(0,M.b)(e,"1.0.0"===t?"interpolationMethod":"InterpolationMethod"),i="1.0.0"===t?e.getAttribute("default"):(0,M.a)(e,"InterpolationMethods/Default");return null!=i?[i].concat(n.filter(e=>e.toLowerCase()!==i.toLowerCase())):n}function B(e){return null==e?["nearest"]:e.map(e=>{const t=e.toLowerCase();return t.includes("nearest")?"nearest":t.includes("linear")?"bilinear":t.includes("cubic")?"cubic":null}).filter(e=>!!e)}function j(e){const t=(0,M.c)(e,"pos"),n=(0,M.d)(t[0]),i=(0,M.d)(t[1]);return new D.A({xmin:n[0],ymin:n[1],xmax:i[0],ymax:i[1],spatialReference:{wkid:4326}})}function q(e,t){const n=(0,M.b)(e,t);return n?.length&&""!==n[0]&&!isNaN(Number(n[0]))?n.map(e=>Number(e)):null}function Z(e){const t=(0,M.d)(e,"MinimumValue"),n=(0,M.d)(e,"MaximumValue");return t.length&&n.length?t.map((e,t)=>({min:e,max:n[t],avg:-1,stddev:-1})):null}function U(e){return null==e?null:e.every(t=>t===e[0])?e[0]:e}function z(e){const t=[],n=(0,M.c)(e,"RangeSet");let i=[];for(let e=0;e<n.length;e++){const s=(0,M.a)(n[e],"name"),a=(0,M.a)(n[e],"label"),o=[],r=q(n[e],"nullValues/singleValue"),l=(0,M.c)(n[e],"AxisDescription");for(let e=0;e<l.length;e++){const t=(0,M.a)(l[e],"name"),n=(0,M.a)(l[e],"label"),s=(0,M.b)(l[e],"singleValue");if(0===s.length){const t=(0,M.a)(l[e],"min"),n=(0,M.a)(l[e],"max"),i=Number((0,M.a)(l[e],"res"))||1;if(null!==t&&null!==n)for(let e=parseInt(t,10);e<=parseInt(n,10);e+=i)s.push(e.toString())}"band"===t.toLowerCase()&&(i=s),o.push({name:t,label:n,values:s})}t.push({name:s,label:a,nullValues:r,axis:o})}return{rangeSet:t,bandNames:i}}function H(e){const t=(0,M.c)(e,"timeposition");if(t.length>0){const e=[];for(let n=0;n<t.length;n++)e.push(new Date((0,M.a)(t[n])));return{begin:e[0],end:e[e.length-1],values:e}}const n=(0,M.g)(e,"timePeriod")||(0,M.g)(e,"TimePeriod");return n?{begin:new Date((0,M.a)(n,"beginPosition")||(0,M.a)(n,"BeginPosition")),end:new Date((0,M.a)(n,"endPosition")||(0,M.a)(n,"EndPosition")),...function(e=null){if(!e)return{resolution:null,units:null};let t=e.toUpperCase();const n=["Years","Months","Days","Hours","Minutes","Seconds"];let i,s,a;return t.includes("PT")?(t=t.slice(2),a=["H","M","S"].findIndex(e=>t.includes(e)),i=n[3+a],s=parseFloat(t.slice(0,-1))):(t=t.slice(1),a=["Y","M","D"].findIndex(e=>t.includes(e)),a>-1&&(i=n[a]),s=parseFloat(t.slice(0,-1))),{resolution:s,units:i}}((0,M.a)(n,"timeResolution")||(0,M.a)(n,"TimeResolution"))}:null}function Y(e){const t=(0,M.g)(e,"spatialDomain"),n=(0,M.g)(t,"Envelope")||(0,M.g)(t,"EnvelopeWithTimePeriod"),i=n.getAttribute("srsName").split(":"),s=i[i.length-1],a=(0,M.c)(n,"pos"),o=(0,M.d)(a[0]),r=(0,M.d)(a[1]),l=parseInt(s,10),c=isNaN(l)?null:{wkid:l},u=new D.A({xmin:o[0],ymin:o[1],xmax:r[0],ymax:r[1],spatialReference:c}),d=(0,M.g)(t,"RectifiedGrid"),p=(0,M.a)(d,"low").split(" "),m=(0,M.a)(d,"high").split(" "),f=parseInt(m[0],10)-parseInt(p[0],10)+1,g=parseInt(m[1],10)-parseInt(p[1],10)+1,h=(0,M.d)(t,"origin/pos"),v=(0,M.c)(t,"offsetVector"),y={envelope:u,columns:f,rows:g,offset:{x:parseFloat((0,M.a)(v[0]).split(" ")[0]),y:parseFloat((0,M.a)(v[1]).split(" ")[1])},origin:{x:h[0],y:h[1]}},b=(0,M.g)(e,"temporalDomain")||(0,M.g)(e,"TemporalDomain");return{spatialDomain:y,temporalDomain:b?H(b):null}}function J(e,t){const n=[],i=(0,M.c)(e,"Field");let s,a=[];for(let e=0;e<i.length;e++){const o=(0,M.a)(i[e],"Identifier"),r=(0,M.a)(i[e],"Description"),l=(0,M.a)(i[e],"Definition"),c=(0,M.a)(i[e],"Abstract"),u=(0,M.a)(i[e],"Title"),d=q(i[e],"NullValue"),p=(0,M.g)(i[e],"AllowedValues"),m=p?Z(p):null,f=W(i[e],"1.1.0"),g=[],h=(0,M.c)(i[e],"Axis");for(let e=0;e<h.length;e++){const n=h[e].getAttribute("identifier"),i=(0,M.a)(h[e],"UOM"),o=(0,M.a)(h[e],"DataType"),r=(0,M.b)(h[e],"Key");t&&!n.toLowerCase().includes("band")||(a=r,s=d),g.push({identifier:n,uom:i,dataType:o,values:r,bandNoDataValues:s})}n.push({identifier:o,description:r,definition:l,abstract:c,title:u,supportedInterpolations:f,axis:g,nullValues:d,statistics:m})}return{rangeSet:n,bandNames:a,bandNoDataValues:s,statistics:n[0].statistics}}function K(e){const t=(0,M.g)(e,"SpatialDomain"),n=(0,M.g)(t,"GridCRS"),i=(0,M.a)(n,"GridBaseCRS"),s=(0,M.a)(n,"GridOrigin"),a=s?.split(" ").map(e=>parseFloat(e))??[0,0],o=(0,M.d)(n,"GridOffsets"),r=(0,M.c)(t,"BoundingBox");let l,c,u,d;for(let e=0;e<r.length;e++){const t=r[e].getAttribute("crs")?.toLowerCase();if(null!=t)if(t.includes("imagecrs")){const t=(0,M.d)(r[e],"LowerCorner"),n=(0,M.d)(r[e],"UpperCorner");l=n[0]-t[0]+1,c=n[1]-t[1]+1}else if(t.indexOf("epsg")>0){const n=t.split(":");u=parseInt(n[n.length-1],10);const i=(0,M.d)(r[e],"LowerCorner"),s=(0,M.d)(r[e],"UpperCorner");d=new D.A({xmin:i[0],ymin:i[1],xmax:s[0],ymax:s[1],spatialReference:{wkid:u}})}}const p=l>c,m=d.xmax-d.xmin>d.ymax-d.ymin;let f=!1;(0,T.i)(u)&&(p===m?f=!1:(f=!0,d=new D.A({xmin:d.ymin,ymin:d.xmin,xmax:d.ymax,ymax:d.xmax,spatialReference:{wkid:u}})));const g={columns:l,rows:c,origin:{x:a[0],y:a[1]},offset:{x:o[0],y:o[o.length-1]},gridBaseCRS:i,envelope:d,useEPSGAxis:f},h=(0,M.g)(e,"temporalDomain")||(0,M.g)(e,"TemporalDomain");return{spatialDomain:g,temporalDomain:h?H(h):null}}function Q(e){const t=(0,M.g)(e,"Envelope")||(0,M.g)(e,"EnvelopeWithTimePeriod"),n=t.getAttribute("srsName"),i=n.slice(n.lastIndexOf("/")+1),s=t.getAttribute("axisLabels").split(" ").map(e=>e.trim()).filter(e=>""!==e.trim()),a=(0,M.d)(t,"lowerCorner"),o=(0,M.d)(t,"upperCorner"),r=!["y","lat","latitude","north","nor","n","b"].includes(s[0].toLowerCase());let l;const c=parseInt(i,10),u=isNaN(c)?null:{wkid:c};l=new D.A(r?{xmin:a[0],ymin:a[1],xmax:o[0],ymax:o[1],spatialReference:u}:{xmin:a[1],ymin:a[0],xmax:o[1],ymax:o[0],spatialReference:u});const d={mins:a,maxs:o},p=t.getAttribute("uomLabels").trim().split(" ");let m,f;if((0,M.i)(t,"EnvelopeWithTimePeriod")){m=new Date((0,M.a)(e,"beginPosition")||(0,M.a)(e,"BeginPosition")),f=new Date((0,M.a)(e,"endPosition")||(0,M.a)(e,"EndPosition"));const t=p?.findIndex(e=>"oledatetime"===e?.toLowerCase());t>-1&&(p[t]="ISO8601")}return{envelope:l,axisLabels:s,uomLabels:p.length?p:null,envelopeAllDims:d,beginPosition:m,endPosition:f,isEastFirst:r}}function X(e,t){const n=[],i=(0,M.c)(e,"DataRecord"),s=[];let a,o=[];for(let e=0;e<i.length;e++){const r=(0,M.c)(i[e],"field"),l=[];for(let e=0;e<r.length;e++){const n=r[e].getAttribute("name"),i=(0,M.a)(r[e],"description")||"",c=(0,M.g)(r[e],"uom")?.getAttribute("code")||"",u=(0,M.d)(r[e],"interval"),d=q(r[e],"nilValue")?.[0];t&&!n.toLowerCase().includes("band")||(s.push(n),u?.length&&(a=a||[],a.push({min:u[0],max:u[1],avg:-1,stddev:-1})),o.push(d)),l.push({name:n,description:i,uom:c,allowedValues:u,nilValue:d})}n.push(l)}return o.some(e=>null!=e)||(o=null),{rangeType:n,bandNames:s,bandStats:a,bandNoDataValues:o}}function ee(e){let t=1,n="";return Math.abs(e-1/24)<1/24*.01?n="Hours":Math.abs(e-1)<.01?n="Days":e<1?(t=Math.round(24*e),n="Hours"):e>27.99&&e<31.01||Math.round(e/30)<12?n="Months":e>364.99&&e<366.01&&(n="Years"),{interval:t,intervalUnit:n}}function te(e,t){const n=(0,M.g)(e,"RectifiedGrid"),i=(0,M.d)(n,"low"),s=(0,M.d)(n,"high"),a=[];for(let e=0;e<i.length;e++)a.push(s[e]-i[e]+1);const o=(0,M.a)(n,"axisLabels").split(" "),r=(0,M.d)(n,"origin/pos"),l=(0,M.c)(n,"offsetVector"),c=[];for(let e=0;e<l.length;e++){const t=(0,M.d)(l[e]),n=t.findIndex(e=>0!==e);c[n]=t[n]}let u,d,p,m=!1;return t?.length&&o?.length&&(m=[...t].sort((e,t)=>e<t?-1:1).join(",")===[...o].sort((e,t)=>e<t?-1:1).join(",")),["y","lat","latitude","north","nor","n","b"].includes((m?o:t)[0].toLowerCase())?(u=a[1],d=a[0],p={y:Math.abs(c[0]),x:Math.abs(c[1])}):(u=a[0],d=a[1],p={x:Math.abs(c[0]),y:Math.abs(c[1])}),{columns:u,rows:d,origin:r,offset:c,resolution:p,gridSamples:a,axisLabels:o,hasSameAxisLabelsAsBoundedBy:m}}function ne(e){const t=(0,M.g)(e,"EarthObservation");if(!t)return null;const n=(0,M.g)(t,"phenomenonTime"),i=n?H(n):null,s=(0,M.g)(t,"phenomenonTime"),a=s?H(s):null,o=(0,M.a)(t,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");let r=null;if(o){const e=o.split(" ").map(e=>e.trim()).filter(e=>null!=e&&""!==e).map(Number);if(e.length){const t=[];for(let n=0;n<e.length/2;n+=2)t.push(e[n],e[n+1]);r=new R.A({rings:[[t]]})}}return{observation:{phenomenonTime:i,resultTime:a,footprint:r,identifier:(0,M.a)(e,"metaDataProperty/EarthObservationMetaData/identifier"),acquisitionType:(0,M.a)(e,"metaDataProperty/EarthObservationMetaData/acquisitionType"),status:(0,M.a)(e,"metaDataProperty/EarthObservationMetaData/status")}}}async function ie(e,t){const{coverageIds:n,version:i,customParameters:s,signal:a}=t,r=i.slice(0,3),c="1.0"===r?"coverage":"1.1"===r?"identifiers":"coverageId",u={service:"WCS",request:"DescribeCoverage",version:i,[c]:n.join(","),...s};try{const{data:t}=await(0,L.A)(e,{query:u,responseType:"xml",signal:a});return function(e,t){let n=null;if(n="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e,"1.0.0"===t)return(0,M.c)(n,"CoverageOffering").map(e=>function(e){const t={version:"1.0"};let n,i=[];for(let s=0;s<e.childNodes.length;s++){const a=e.childNodes[s];if(1===a.nodeType)if((0,M.i)(a,"description"))t.description=(0,M.a)(a);else if((0,M.i)(a,"name"))t.name=(0,M.a)(a);else if((0,M.i)(a,"label"))t.label=(0,M.a)(a);else if((0,M.i)(a,"supportedFormats"))t.supportedFormats=(0,M.b)(a,"formats");else if((0,M.i)(a,"supportedCRSs"))t.supportedCRSs=G(a);else if((0,M.i)(a,"supportedInterpolations"))t.supportedInterpolations=W(a,"1.0.0");else if((0,M.i)(a,"lonLatEnvelope"))t.lonLatEnvelope=j(a);else if((0,M.i)(a,"rangeSet")){const e=z(a);t.rangeSet=e.rangeSet,i=e.bandNames;const s=e.rangeSet[0].nullValues;s?.length&&(n=U(s))}else(0,M.i)(a,"domainSet")&&(t.domainSet=Y(a))}const s=B(t.supportedInterpolations),{name:a,description:o,label:r,lonLatEnvelope:l,supportedFormats:c}=t,{spatialDomain:u}=t.domainSet,d={x:Math.abs(u.offset.x),y:Math.abs(u.offset.y)},p=function(e){if(!e.temporalDomain)return null;const{begin:t,end:n,values:i,units:s,resolution:a}=e.temporalDomain,o={variables:[{name:"default",description:"",dimensions:[{name:"StdTime",description:"",unit:"ISO8601",values:i?.map(e=>e.getTime()),hasRegularIntervals:!i,interval:a,intervalUnit:s,extent:[t.getTime(),n.getTime()]}]}]};return F(o),o}(t.domainSet),m=new P.A({width:u.columns,height:u.rows,pixelSize:d,pixelType:"unknown",extent:u.envelope,spatialReference:u.envelope.spatialReference,bandCount:i.length||1,noDataValue:n,multidimensionalInfo:p});return{id:a,title:t.name,description:o||r,lonLatEnvelope:l,rasterInfo:m,bandNames:i,supportedFormats:c,supportedInterpolations:s,coverageDescription:t,version:"1.0.0",useEPSGAxis:!1}}(e));const i=(0,M.c)(n,"CoverageDescription");return"1.1.0"===t||"1.1.1"===t||"1.1.2"===t?i.map(e=>function(e,t){const n=[],i=[],s={supportedFormats:n,supportedCRSs:i,version:"1.1"};let a,o,r=[];for(let t=0;t<e.childNodes.length;t++){const l=e.childNodes[t];if(1!==l.nodeType)continue;const c=(0,M.e)(l).toLowerCase();switch(c){case"title":case"abstract":case"identifier":s[c]=(0,M.a)(l);break;case"supportedformat":{const e=(0,M.a)(l);n.includes(e)||n.push(e)}break;case"supportedcrs":{const e=(0,M.a)(l);i.includes(e)||i.push(e)}break;case"range":{const e=J(l,!!s.domain?.temporalDomain);s.range=e.rangeSet,r=e.bandNames;const{bandNoDataValues:t}=e;t?.length&&(a=U(t)),o=e.statistics}break;case"domain":s.domain=K(l)}}const l=B(s.range[0].supportedInterpolations),{identifier:c,abstract:u,title:d,domain:p,range:m}=s,f={x:Math.abs(p.spatialDomain.offset.x),y:Math.abs(p.spatialDomain.offset.y)},g=function(e,t){if(!t.temporalDomain)return null;const n=e.filter(e=>!e.identifier.toLowerCase().includes("field_1")&&!e.axis.some(e=>e.identifier.includes("band"))),i=[];if(n.length&&n.forEach(e=>{const t=e.axis.map(e=>{const t=e.values.map(t=>"ISO8601"===e.uom?(t=t.trim()).toLowerCase().includes("z")?new Date(t).getTime():new Date(t+"Z").getTime():parseFloat(t.trim())),n=[Math.min.apply(null,t),Math.max.apply(null,t)];return{name:e.identifier.trim(),description:"",field:e.identifier.trim(),unit:e.uom?e.uom.trim():"",hasRegularIntervals:!1,values:t,extent:n}});i.push({name:e.identifier.trim(),description:e.description?.trim()??"",unit:"",dimensions:t,statistics:e.statistics})}),t.temporalDomain){const{begin:e,end:n,values:s,units:a,resolution:o}=t.temporalDomain;i.some(e=>e.dimensions.some(e=>"stdtime"===e.name.toLowerCase()))||i.forEach(t=>{t.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:s?.map(e=>e.getTime()),hasRegularIntervals:!s,interval:o,intervalUnit:a,extent:[e.getTime(),n.getTime()]})})}if(i.length){const e={variables:i};return F(e),e}return null}(m,p);g&&(a=m[0].nullValues,1===a?.length&&(a=a[0]));const h=new P.A({width:p.spatialDomain.columns,height:p.spatialDomain.rows,pixelSize:f,pixelType:"unknown",extent:p.spatialDomain.envelope,spatialReference:p.spatialDomain.envelope.spatialReference,bandCount:r.length||1,noDataValue:a,statistics:o,multidimensionalInfo:g});return{id:c,title:s.title,description:u||d,bandNames:r,rasterInfo:h,supportedFormats:n,supportedInterpolations:l,coverageDescription:s,version:t,useEPSGAxis:p.spatialDomain.useEPSGAxis}}(e,t)):i.map(e=>function(e){const t={version:"2.0"};let n,i,s=[];for(let a=0;a<e.childNodes.length;a++){const o=e.childNodes[a];if(1===o.nodeType)if((0,M.i)(o,"coverageId"))t.coverageId=(0,M.a)(o);else if((0,M.i)(o,"ServiceParameters"))t.serviceParameters={supportedFormats:(0,M.b)(o,"nativeFormat")};else if((0,M.i)(o,"boundedBy"))t.boundedBy=Q(o);else if((0,M.i)(o,"rangeType")){const e=X(o,t.boundedBy?.axisLabels.length>2||t.domainSet?.axisLabels.length>2);t.rangeType=e.rangeType,s=e.bandNames,n=e.bandStats;const{bandNoDataValues:a}=e;a?.length&&(i=U(a))}else if((0,M.i)(o,"domainSet"))t.domainSet=te(o,t.boundedBy?.axisLabels);else if((0,M.i)(o,"metadata")){const e=(0,M.g)(o,"EOMetadata");t.eoMetadata=e?ne(e):null}}const{coverageId:a,boundedBy:o,domainSet:r,rangeType:l,serviceParameters:c}=t,u=function(e,t,n){if(n.axisLabels.length<=2)return null;const i=[];for(let t=0;t<e.length;t++){const n=e[t];for(let e=0;e<n.length;e++)n[e].name.toLowerCase().includes("band")||i.push(n[e])}const s=[];if(i.length){const e=[];for(let i=2;i<n.axisLabels.length;i++){const s=t.uomLabels?.[i]?.trim()??"",a=n.axisLabels[i].toLowerCase().includes("time")||"iso8601"===s.toLowerCase()||"oledatetime"===s.toLowerCase();let o,r;if(a){const e=ee(n.offset[i]);o=e.interval,r=e.intervalUnit}else o=n.offset[i],r=s;const l=[];a?(l.push((0,E.e)(t.envelopeAllDims.mins[i])),l.push((0,E.e)(t.envelopeAllDims.maxs[i]))):(l.push(t.envelopeAllDims.mins[i]),l.push(t.envelopeAllDims.maxs[i])),e.push({name:n.axisLabels[i].trim(),description:n.axisLabels[i].trim(),unit:a?"ISO8601":s,hasRegularIntervals:!0,extent:l,interval:o,intervalUnit:r})}if(i.forEach(t=>{const{allowedValues:n}=t,i=2===n?.length?[{min:n[0],max:n[1],avg:-1,stddev:-1}]:null;s.push({name:t.name.trim(),description:t.description?.trim()??"",unit:t.uom.trim(),statistics:i,dimensions:[...e]})}),s.length){const e={variables:s};return F(e),e}}return null}(l,o,r);return!n&&u&&(n=u?.variables[0].statistics),null!=u&&(i=l[0][0].nilValue),{id:a,title:a,description:a,bandNames:s,rasterInfo:new P.A({width:r.columns,height:r.rows,pixelSize:r.resolution,pixelType:"unknown",extent:o.envelope,spatialReference:o.envelope.spatialReference,bandCount:s.length||1,statistics:n,noDataValue:i,multidimensionalInfo:u}),supportedFormats:c.supportedFormats,coverageDescription:t,version:"2.0.1",useEPSGAxis:!1}}(e))}(t,i)}catch(e){if(!(0,l.zf)(e))throw new o.A("wcslayer:open","wcs coverage description is not valid or supported");throw e}}var se=n(33535),ae=n(10348),oe=n(20978);function re(e,t,n=0){const i="--"+t.boundary,s=[];for(let e=0;e<i.length;e++)s.push(i.charCodeAt(e));const a=[],o="\n--"+t.boundary+"--";for(let e=0;e<o.length;e++)a.push(o.charCodeAt(e));const r=[10],l=[13,10],c=[],u=s.length,d=new Uint8Array(e,n),p=d.length-u;let m=0,f=0;for(let e=0;e<p;e++){for(f=0;f<u&&d[e+f]===s[f];f++);if(f!==u)continue;let n=!1;if(m){const i=le(d.subarray(m,e),t);c.push(i),n=!!i.isValidImage}if(e+=u-1,d[e+1]===r[0]?e+=1:d[e+1]===l[0]&&d[e+2]===l[1]&&(e+=2),m=e+1,n)break}const g=a.length;for(let e=d.length-g-10;e<d.length-g;e++){for(f=0;f<g&&d[e+f]===a[f];f++);if(f===g){c.push(le(d.subarray(m,e),t));break}}return c}function le(e,t){const n=String.fromCharCode.apply(null,e.subarray(0,Math.min(300,e.length))).split("\n"),i=Math.min(n.length,7),s={contentDisposition:"inline"};let a=0;for(let o=0;o<i;o++)if(n[o].length<4)a=a+n[o].length+1;else if("content"===n[o].slice(0,7).toLowerCase()){a=a+n[o].length+1;const e=n[o].indexOf(":");if(-1===e)continue;const t=n[o].slice(0,e).trim(),i=n[o].slice(e+1).trim();switch(t.toLowerCase()){case"content-type":s.contentType=i;break;case"content-description":s.contentDescription=i;break;case"content-transfer-encoding":s.contentTransferEncoding=i;break;case"content-id":s.contentID=i;break;case"content-disposition":s.contentDisposition=i;break;case"content-location":s.contentLocation=i}}else{if(s.contentDisposition.toLowerCase().includes("inline")&&n[o].length>=4&&s.contentType?.toLowerCase().includes("image")){let t=!0,n=e.subarray(a,e.length);if(s.contentType.toLowerCase().indexOf("tif")>0){if("base64"===s.contentTransferEncoding){let e="";const t=n;for(let n=0;n<t.length;n+=65535){const i=t.subarray(n,n+65535>t.length-1?t.length-1:n+65535);e+=String.fromCharCode.apply(null,i)}const i=atob(e);n=new Uint8Array(i.length);for(let e=0;e<n.length;e++)n[e]=i.charCodeAt(e)}t=73===n[0]&&73===n[1]||77===n[0]&&77===n[1]}if(t){let t=n.buffer;"base64"!==s.contentTransferEncoding&&(t=new ArrayBuffer(e.length-a),n=new Uint8Array(t),n.set(e.subarray(a,e.length))),s.contentData=t,s.isValidImage=!0}break}if((""===t.start||s.contentID===t.start)&&s.contentType){if(s.contentType.includes("text")||s.contentType.includes("xml")){s.contentData=String.fromCharCode.apply(null,e.subarray(a,e.length));break}s.contentData=e.subarray(a,e.length)}}return s}n(17745),n(81272),n(44945),n(30011),n(54483),n(51961),n(62399),n(64995),n(70861),n(33150),n(58173),n(66110),n(67520),n(27532),n(88663),n(48103),n(50214),n(59192),n(16345),n(65085),n(33611),n(84857),n(60373),n(20568),n(35902),n(13226),n(16794),n(52357),n(11090),n(49319),n(93546),n(29570),n(34592),n(79825),n(95101),n(67578),n(17857),n(82537),n(14896),n(95611),n(98089),n(91366),n(80473),n(43435),n(73435),n(73509),n(28276),n(58194),n(4734),n(60369),n(13201),n(43534),n(47812),n(18527),n(44158),n(77037),n(36533),n(67504),n(91272),n(92070),n(6851),n(67535),n(41003),n(20527),n(7078),n(5807),n(38226),n(88321),n(2589),n(47387),n(46728),n(21632),n(64102),n(40790),n(70959),n(89779),n(8824),n(27281),n(92517),n(91815),n(85232),n(93471),n(7182),n(47788),n(19297),n(82408),n(91658),n(70580),n(75191),n(24319),n(62092),n(53252),n(34039),n(12856),n(3495),n(97906),n(64524),n(65023),n(31424),n(74676),n(32368),n(7391),n(22529),n(70061),n(38094),n(67723),n(47239),n(22522),n(63728),n(4157),n(62401),n(89322),n(20138),n(53370),n(59858),n(46946),n(3816),n(71992),n(80167),n(4478),n(91808),n(7161),n(55586),n(92229),n(18344),n(53610),n(29447),n(78273),n(49475),n(64884),n(23351),n(35121),n(51222),n(42870),n(54512),n(53103),n(19648),n(42948),n(95637),n(59930),n(45862),n(72762),n(71613),n(17872),n(30851),n(24330),n(91276),n(62482),n(16722),n(68258),n(88614),n(1030),n(15319),n(60785),n(4789),n(79769),n(94894),n(88404),n(91381),n(60027),n(57111),n(75651),n(56487),n(6399),n(9498),n(24079),n(38149),n(19681),n(40328),n(84539),n(65299),n(38641),n(19869),n(3827),n(98238),n(78328),n(23916),n(93074),n(54616),n(25018),n(41740),n(75399),n(46341),n(79943),n(12692),n(60303),n(17813),n(3112),n(46626),n(45560),n(56303),n(85890),n(55884),n(42656),n(3952),n(339),n(79281),n(13978),n(47368),n(69033),n(73067),n(23875),n(44747),n(91524),n(56570),n(23787),n(22151),n(88817),n(99506),n(65523),n(25144),n(38903),n(21891),n(76330),n(17012),n(98203),n(54131),n(53065),n(20804),n(63834),n(87357),n(19969),n(9207),n(67138),n(43059),n(89935),n(49813),n(82454),n(11494),n(6801),n(9380),n(55270),n(95779),n(13262),n(346),n(14141),n(35619),n(31175),n(78016);const ce=["nearest neighbor","bilinear","bicubic"],ue=["nearest","linear","cubic"],de="response is not a supported multipart/related mediaType with inline tiff,  switching to compatibility mode",pe=new Set(["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"]);let me=class extends h.B{constructor(){super(...arguments),this.datasetFormat="WCSServer",this.tileType="Raster"}get rasterId(){return`${this.url}-${this.coverageId}-${this.version}`}async fetchRawTile(e,t,n,i={}){if(this.isBlockOutside(e,t,n))return null;const{nativePixelSize:s,spatialReference:a}=this.rasterInfo,r=2**e,l=s.x*r,c=s.y*r,{blockWidth:u,blockHeight:d}=this.getBlockWidthHeight(e),{origin:p}=this.rasterInfo.storageInfo.tileInfo,m=this.getTileExtent({x:l,y:c},t,n,p,a,[u,d]),f=this.rasterInfo.extent,g=m.xmax>f.xmax,h=m.ymin<f.ymin,v=g||h;let y=m,b=u,w=d;if(v&&(y=m.clone().intersection(f),null!=y&&(g&&(b=Math.floor((y.xmax-y.xmin)/l),y.xmax=y.xmin+l*b),h&&(w=Math.floor((y.ymax-y.ymin)/c),y.ymin=y.ymax-c*w))),null==y||b<=1||w<=1)return null;const x=await this._getCoverage(y,b,w,r,i);if(!x)return null;const{coverageDescription:C}=this.coverageInfo,{noDataValue:I,multidimensionalInfo:S}=this.rasterInfo,{multidimensionalDefinition:A}=i;let D;if(null!=S&&null!=A&&A.length){const e=A[0].variableName;if("2.0"===C.version){const t=C.rangeType[0].find(t=>t.name===e);D=t?.nilValue}else if("1.1"===C.version){const t=C.range.find(t=>t.identifier===e);D=t?.nullValues}}const T=D??I,L=await this.decodePixelBlock(x,{width:b,height:w,planes:null,pixelType:null,tiffNoDataValue:Array.isArray(T)?T[0]:T,matchAllNoData:!0});if(null==L)return null;if(L&&(L.width!==b||L.height!==w))throw new o.A("wcsraster-fetch",`the response has unexpected dimension width: ${L.width}, height: {pixelBlock.height}`);return v?(0,ae.k)(L,{x:0,y:0},{width:d,height:d}):L}async _open(e){const{customFetchParameters:t}=this.ioConfig,n=e?.signal,i=await async function(e,t){const{version:n,customParameters:i,signal:s}=t??{},a=n?.startsWith("1.0")?"version":"acceptVersions",r={service:"WCS",request:"GetCapabilities",[a]:n,...i};try{let{data:n}=await(0,L.A)(e,{query:r,responseType:"xml",signal:s});return t?.version||function(e){let t=null;t="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e;const n=t.documentElement.getAttribute("version"),i=n?.slice(0,3);return null!=i&&i<"2.1"}(n)||(r[a]="2.0.1",({data:n}=await(0,L.A)(e,{query:r,responseType:"xml",signal:s}))),function(e,t=null){let n=null;n="string"==typeof e?(new DOMParser).parseFromString(e,"text/xml"):e;let i=n.documentElement.getAttribute("version");"1.0"===i?i="1.0.0":"1.1"===i&&(i="1.1.0");const s=i||t||"1.0.0",a=s.slice(0,3);let r;if("2.0"===a)r=function(e){const t=(0,M.g)(e,"ServiceIdentification"),n=(0,M.a)(t,"Title"),i=(0,M.b)(t,"ServiceTypeVersion"),s=(0,M.b)(t,"Profile"),a=V((0,M.g)(e,"OperationsMetadata")),o=(0,M.c)(e,"Contents/CoverageSummary"),r=[];for(let e=0;e<o.length;e++){const t=o[e],n=(0,M.a)(t,"CoverageId"),i=(0,M.g)(t,"WGS84BoundingBox");let s;if(i){const e=(0,M.d)(i,"LowerCorner"),t=(0,M.d)(i,"UpperCorner");s=new D.A({xmin:e[0],ymin:e[1],xmax:t[0],ymax:t[1],spatialReference:{wkid:4326}})}const a=(0,M.a)(t,"CoverageSubtype")||"RectifiedGridCoverage";r.push({id:n,lonLatEnvelope:s,coverageSubType:a})}const l=(0,M.g)(e,"ServiceMetadata");return{name:n,supportedVersions:i,supportedFormats:(0,M.b)(l,"formatSupported"),supportedInterpolations:(0,M.b)(l,"interpolationSupported").concat((0,M.b)(l,"InterpolationSupported")),onlineResources:a,profiles:s,coverages:r,gridCoverages:_(r),version:"2.0.1"}}(n);else if("1.1"===a)r=function(e){const t=(0,M.a)(e,"ServiceIdentification/Title"),n=(0,M.b)(e,"ServiceIdentification/ServiceTypeVersion"),i=V((0,M.g)(e,"OperationsMetadata")),s=[],a=(0,M.g)(e,"Contents");for(let e=0;e<a.childNodes.length;e++){const t=a.childNodes[e];1===t.nodeType&&(0,M.i)(t,"CoverageSummary")&&k(N(t),s)}const o=(0,M.b)(a,"SupportedFormat");return{name:t,onlineResources:i,coverages:s,gridCoverages:_(s),supportedVersions:n,supportedFormats:o,version:"1.1.0"}}(n);else{if("1.0"!==a)throw new o.A("wcsraster:parsecapabilities","the capabilities version is not supported");r=function(e){const t=(0,M.a)(e,"Service/name"),n=(0,M.g)(e,"Capability"),i=(0,M.g)(n,"GetCapabilities/Get/OnlineResource")?.getAttribute("xlink:href")??"",s=(0,M.g)(n,"DescribeCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",a=(0,M.g)(n,"GetCoverage/Get/OnlineResource")?.getAttribute("xlink:href")??"",o={getCapabilities:O(i),describeCoverage:O(s),getCoverage:O(a)},r=(0,M.c)(e,"CoverageOfferingBrief"),l=[];for(let e=0;e<r.length;e++){const t=r[e],n=(0,M.a)(t,"name"),i=(0,M.c)(t,"pos"),s=(0,M.d)(i[0]),a=(0,M.d)(i[1]),o=new D.A({xmin:s[0],ymin:s[1],xmax:a[0],ymax:a[1],spatialReference:{wkid:4326}});l.push({id:n,lonLatEnvelope:o})}return{name:t,onlineResources:o,coverages:l,gridCoverages:_(l),supportedVersions:["1.0.0"],version:"1.0.0"}}(n)}return r.version=s,r}(n)}catch(e){if(!(0,l.zf)(e))throw new o.A("wcslayer:open","wcs capabilities is not valid or supported");throw e}}(this.url,{version:t?.version??this.version,customParameters:t,signal:n});if(this.capabilities=i,!this.version){let e=i.version.slice(0,3);"2.0"===e||"1.1"===e||"1.0"===e?this.version=i.version:(e=i.supportedVersions.find(e=>"2.0.1"===e)||i.supportedVersions.find(e=>e.startsWith("2.0"))||i.supportedVersions.find(e=>e.startsWith("1.1"))||i.supportedVersions.find(e=>e.startsWith("1.0"))||"1.0.0",this.version=e)}const{version:s}=this;if(!pe.has(s))throw new o.A("wcsraster-open",`unsupported WCS version ${s}`);const{gridCoverages:a}=i;if(!a.length)throw new o.A("wcsraster-open","cannot find rectified grid coverages");this.coverageId??=a[0].id;const{coverageId:r}=this,c=a.find(e=>e.id===r);if(null==c)throw new o.A("wcsraster-open",`the coverageId ${r} does not exist in capabilities`);const u=await ie(this.url,{coverageIds:[r],version:s,customParameters:t,signal:n});if(this.coverageInfo=u[0],s.startsWith("2.0")){const{coverageInfo:e}=this;e.lonLatEnvelope=c.lonLatEnvelope,e.supportedInterpolations=B(i.supportedInterpolations),this._patchDimensionValues201(r,n)}this.datasetName=this.coverageInfo.title;const{rasterInfo:d}=this.coverageInfo;if(this.createRemoteDatasetStorageInfo(d,512,512),this._set("rasterInfo",d),null==d.spatialReference)throw new o.A("wcsraster-open",`coverage without spatial reference is not supported: ${r}`);const{pixelType:p,bandCount:m}=await this._getPixelTypeAndBandCount(n);d.pixelType=p,1===d.bandCount&&m>1&&(d.bandCount=m),this.updateTileInfo()}async _patchDimensionValues201(e,t){const{coverageInfo:n}=this,i=n.rasterInfo.multidimensionalInfo?.variables,s=pe.has("1.1.2")?"1.1.2":pe.has("1.1.1")?"1.1.1":pe.has("1.1.0")?"1.1.0":null,{customFetchParameters:a}=this.ioConfig;if(i&&s)try{const n=this.url.includes("/ImageServer/"),o=e.length>8&&e.startsWith("Coverage")&&n?e.slice(8):e,r=await ie(this.url,{coverageIds:[o??e],version:s,customParameters:a,signal:t}).catch(()=>{if(o)return ie(this.url,{coverageIds:[e],version:s,customParameters:a,signal:t})}),l=r?.[0].rasterInfo.multidimensionalInfo?.variables;if(l)for(const e of i){const t=l.find(({name:t})=>t===e.name);if(t?.dimensions?.length)for(let i=e.dimensions.length-1;i>=0;i--){const s=e.dimensions[i],a=t.dimensions.find(({name:e})=>e===s.name);a?a.values&&a.extent?.join(",")===s.extent?.join(",")&&(e.dimensions[i]={...s,values:a.values}):n&&e.dimensions.splice(i,1)}}}catch{}}async _getPixelTypeAndBandCount(e){const{pixelSize:t,extent:n,multidimensionalInfo:i}=this.rasterInfo,s=n.center,a=new D.A({xmin:s.x-t.x,xmax:s.x+t.x,ymin:s.y-t.y,ymax:s.y+t.y,spatialReference:n.spatialReference});let r=[];if(null!=i){const e=i.variables[0];r=[],e.dimensions.forEach(t=>{r.push(new $.A({variableName:e.name,dimensionName:t.name,values:t.hasRegularIntervals?t.extent?.[0]:t.values?.[0],isSlice:!0}))})}const{coverageDescription:l}=this.coverageInfo,c={interpolation:"nearest",multidimensionalDefinition:r,signal:e},{version:u}=l,{ioConfig:p}=this,m="2.0"===u&&null==p.allowAnyMediaType||"1.1"===u&&null==p.use2GridOffsets;let f;try{f=await this._getCoverage(a,2,2,1,c,!0)}catch(e){if(!m)throw e;if("1.1"===u){if(!e.details?.isResolutionMismatch)throw e;p.use2GridOffsets=!0}}if(!f&&m&&("2.0"===u&&(p.allowAnyMediaType=!0),f=await this._getCoverage(a,2,2,1,c),f&&d.L.getLogger(this).warn("wcsraster:getcoverage",de)),!f)throw new o.A("wcsraster-open","unable to determine pixel type");const g=await this.decodePixelBlock(f,{width:2,height:2,planes:null,pixelType:null});if(null==g)throw new o.A("wcsraster-open","unable to determine pixel type");return{pixelType:g.pixelType,bandCount:g.getPlaneCount()??0}}async _getCoverage(e,t,n,i,s,a=!1){const{coverageDescription:r}=this.coverageInfo,{version:l}=r,c="2.0"===l?this._getCoverage201Parameters(e,t,n,i,s,r):"1.1"===l?this._getCoverage110Parameters(e,t,n,s,r):this._getCoverage100Parameters(e,t,n,s),u="2.0"===l?await this.request(this._constructWCS201Url(c),{signal:s.signal,responseType:"array-buffer"}):await this.request(this.url,{query:c,signal:s.signal,responseType:"array-buffer"});if("1.0"===l)return u.data;if("2.0"===l&&!1!==this.ioConfig.allowAnyMediaType&&"tiff"===(0,se.g)(u.data))return a&&(this.ioConfig.allowAnyMediaType=!0,d.L.getLogger(this).warn("wcsraster:getcoverage",de)),u.data;const p=function(e){const t=function(e){const t=e.getHeader?.("Content-Type")?.split(";");if(!t)return null;if(!(t[0].trim()??"").startsWith("multipart/"))return null;const n={boundary:"",start:"",type:""};for(let e=1;e<t.length;e++){const i=t[e].indexOf("=");if(i>0){const s=t[e].slice(0,i).trim(),a=t[e].slice(i+1).trim();n[s]=a.startsWith('"')?a.slice(1,-1):a}}return n}(e);return t?{isMultipart:!0,data:t.boundary?re(e.data,t,0):null}:{isMultipart:!1,data:null}}(u);if(p.isMultipart&&p.data){const e=p.data.find(e=>e.isValidImage);return a&&"base64"===e?.contentTransferEncoding&&d.L.getLogger(this).warn("wcsraster:getcoverage","response is base64 encoded which may impact layer display performance"),e?.contentData}const m=new Uint8Array(u.data,0,Math.min(u.data.byteLength,2e3)),f=String.fromCharCode.apply(null,m).toLowerCase().includes("exception"),g=f&&String.fromCharCode.apply(null,m).includes("A non-zero RESX/RESY or WIDTH/HEIGHT is required but neither was provided");if(f)throw new o.A("wcsraster:getcoverage","server returns an exception",{isResolutionMismatch:g});throw new o.A("wcsraster:getcoverage","response is not a supported multipart mediaType with inline tiff")}_getInterpolationIndex(e){return e&&this.coverageInfo.supportedInterpolations?.includes(e)?"nearest"===e?0:"bilinear"===e?1:"cubic"===e?2:0:0}_getCoverage100Parameters(e,t,n,i){const s=`${e.xmin},${e.ymin},${e.xmax},${e.ymax}`,a=e.spatialReference.wkid,o=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes("tiff"))||"GEOTIFF",{bandIds:r,interpolation:l}=i,c=this._getInterpolationIndex(l),u=r?r.map(e=>this.coverageInfo.bandNames[e]):null,d=ce[c],{multidimensionalDefinition:p}=i;let m;if(null!=p&&null!=this.rasterInfo.multidimensionalInfo){const e=p.find(e=>"StdTime"===e.dimensionName);let t=e?.values;t&&t.length>0&&(Array.isArray(t[0])&&(t=t[0]),m=t.map(e=>fe(e)).join(","))}return{service:"WCS",request:"GetCoverage",version:this.version,coverage:this.coverageId,format:o,crs:`EPSG:${a}`,bbox:s,width:t,height:n,time:m,interpolation:d,band:u?.join(",")}}_getCoverage110Parameters(e,t,n,i,s){const{multidimensionalDefinition:a,bandIds:o,interpolation:r}=i,l=e.spatialReference.wkid,c=`urn:ogc:def:crs:EPSG::${l}`,u=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes("tiff"))||"image/tiff",d=this._getInterpolationIndex(r),p=ue[d],m=null==r||0===this.coverageInfo.supportedInterpolations?.indexOf(r),f=s.domain.spatialDomain,g=f.origin.x<=f.envelope.xmin&&f.origin.y<=f.envelope.ymin,h=e.width/t,v=e.height/n*(g?1:-1),y=g?[e.xmin,e.ymin]:[e.xmin,e.ymax],b=f.useEPSGAxis&&(0,T.i)(l),w=b?`${y[1]},${y[0]}`:`${y[0]},${y[1]}`,x=this.ioConfig.use2GridOffsets,C=b?x?`${v},${h}`:`${v},0,0,${h}`:x?`${h},${v}`:`${h},0,0,${v}`,I=h/2,S=e.xmin+I,A=e.xmax-I,D=Math.abs(v)/2,L=e.ymin+D,M=e.ymax-D,R=b?`${L},${S},${M},${A},${c}`:`${S},${L},${A},${M},${c}`,P=s.range.find(e=>e.axis.some(e=>e.identifier.toLowerCase().includes("band")));let E,$=P&&p&&o?m?`${P.identifier}[${P.axis[0].identifier}[${o.join(",")}]]`:`${P.identifier}:${p}[${P.axis[0].identifier}[${o.join(",")}]]`:null;if(null!=a&&a.length)for(let e=0;e<a.length;e++){let t=a[e].values;const n=a[e].dimensionName?.toLowerCase(),i=a[e].variableName?.toLowerCase(),o=s.range.find(e=>e.identifier.toLowerCase()===i);if(t.length>0)if(Array.isArray(t[0])&&(t=t[0]),"stdtime"===n)E=t.map(e=>fe(e)).join(",");else if(o){const e=o.axis.find(e=>e.identifier.toLowerCase()===n);e&&($=m?o.identifier+"["+e.identifier+"["+t.join(",")+"]]":o.identifier+":"+p+"["+e.identifier+"["+t.join(",")+"]]")}e===a.length-1&&o&&!$&&($=m?o.identifier:o.identifier+":"+p)}return{service:"WCS",request:"GetCoverage",version:this.version,identifier:this.coverageId,format:u,crs:`EPSG:${l}`,boundingbox:R,gridCS:"urn:ogc:def:cs:OGC:0.0:Grid2dSquareCS",gridType:"urn:ogc:def:method:WCS:1.1:2dGridIn2dCrs",gridOrigin:w,gridOffsets:C,gridBaseCRS:c,timeSequence:E,rangeSubset:$}}_getCoverage201Parameters(e,t,n,i,s,a){const{multidimensionalDefinition:o,interpolation:r}=s,l=this._getInterpolationIndex(r);let c=null;const{supportedInterpolations:u}=this.capabilities;if(u?.length)switch(l){case 0:c=u.find(e=>e.toLowerCase().includes("nearest"));break;case 1:c=u.find(e=>e.toLowerCase().includes("linear"));break;case 2:c=u.find(e=>e.toLowerCase().includes("cubic")||e.toLowerCase().includes("quadratic"))}const d=(this.coverageInfo.supportedFormats||[]).find(e=>e.toLowerCase().includes("tiff"))||"image/tiff",{bandNames:p}=this.coverageInfo,{boundedBy:m,domainSet:f,rangeType:g}=a,h=m.isEastFirst?0:1,v=1-h,{axisLabels:y}=m,b=y[h],w=y[v],x=`http://www.opengis.net/def/crs/EPSG/0/${e.spatialReference.wkid}`,C=x,I=[];I.push(`${b}(${e.xmin},${e.xmax})`),I.push(`${w}(${e.ymin},${e.ymax})`);const S=[];if(y.length>2)for(let e=2;e<y.length;e++){const t=f.origin[e];if(y[e].toLowerCase().includes("time")){let n=t.toString();m.uomLabels?.[e].toLowerCase().includes("ole")&&(S.push(y[e]),n=fe(t,!0)),I.push(y[e]+",http://www.opengis.net("+n+")")}else I.push(y[e]+",http://www.opengis.net("+t+")")}let A=null;if(null!=o&&o.length){const e=[];g.forEach(t=>t.forEach(t=>e.push(t.name)));const t=[];for(let n=0;n<o.length;n++){const i=y.find(e=>e===o[n].dimensionName),s=e.find(e=>e===o[n].variableName);if(t.includes(s)||t.push(s),i){let e=o[n].values;if(e.length>0){Array.isArray(e[0])&&(e=e[0]);let t="";t=i.toLowerCase().includes("time")?e.map(e=>fe(e)).join(","):e.join(",");const n=I.findIndex(e=>e.startsWith(i+",http://www.opengis.net"));-1===n&&I.push(i+",http://www.opengis.net("+t+")"),-1===n||I[n].includes("("+t+")")||I.splice(n,1,i+",http://www.opengis.net("+t+")")}}}t.length&&(A=t.join(","))}else p?.length>=2&&(A=(s.bandIds?s.bandIds.map(e=>p[e]):p).join(","));const D=I.join("&subset="),T=!a.domainSet.hasSameAxisLabelsAsBoundedBy&&!1!==this.ioConfig.allowScaleFactor,L=T?null:`${b}(${t}),${w}(${n})`,M=T?1/i:null;return{service:"WCS",request:"GetCoverage",version:this.version,coverageId:this.coverageId,rangesubset:A,interpolation:c,scaleSize:L,scaleFactor:M,subset:D,format:d,mediaType:this.ioConfig.allowAnyMediaType?null:"multipart/related",outputcrs:x,subsettingcrs:C}}_constructWCS201Url(e){const t={...this.ioConfig.customFetchParameters,...e},n=[];return Object.keys(t).forEach(e=>{const i=t[e];null!=i&&("subset"===e?"string"==typeof i&&i.split("&subset=").forEach(e=>{e&&n.push(`subset=${encodeURIComponent(e)}`)}):n.push(`${e}=${encodeURIComponent(i)}`))}),`${encodeURI(this.url)}?${n.join("&")}`}};function fe(e,t=!1){return(t?new Date((0,E.e)(e)):new Date(e)).toISOString()}(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],me.prototype,"datasetFormat",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],me.prototype,"tileType",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],me.prototype,"version",void 0),(0,i._)([(0,u.MZ)({type:String,json:{write:!0}})],me.prototype,"coverageId",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],me.prototype,"rasterId",null),me=(0,i._)([(0,p.$)("esri.layers.support.rasterDatasets.WCSRaster")],me);const ge=new Set(["milliseconds","seconds","minutes","hours","days","weeks","months","years","decades","centuries"]);let he=class extends((0,f.dM)((0,x.j)((0,v.q)((0,y.A)((0,g.d)((0,h.o)((0,b.R)((0,C.e)((0,w.J)((0,r.M)((0,a.O)(m.A)))))))))))){constructor(...e){super(...e),this.coverageId=null,this.version=null,this.isReference=null,this.legendEnabled=!0,this.noData=0,this.operationalLayerType="WCS",this.type="wcs",this.popupEnabled=!0,this.popupTemplate=null,this.fields=null,this._debouncedSaveOperations=(0,l.sg)(async(e,t,i)=>{const{save:s,saveAs:a}=await n.e(2743).then(n.bind(n,42743));switch(e){case 0:return s(this,t);case 1:return a(this,i,t)}})}normalizeCtorArgs(e,t){return"string"==typeof e?{url:e,...t}:e}load(e){const t=null!=e?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WCS"]},e).catch(l.QP).then(()=>this._openRaster(t))),Promise.resolve(this)}get renderer(){return super.renderer}set renderer(e){super.renderer=e}get coverageInfo(){return this.raster.coverageInfo}get defaultPopupTemplate(){return this.createPopupTemplate()}get rasterFields(){const e=[(0,A.g)("Pixel Value")],t=this.raster?.rasterInfo??this.serviceRasterInfo,n=t?.multidimensionalInfo;if(n){const t=(0,A.d)(n);e.push(...t)}return e}createPopupTemplate(e){return(0,oe.tn)({fields:this.rasterFields,title:this.title},e)}async save(e){return this._debouncedSaveOperations(0,e)}async saveAs(e,t){return this._debouncedSaveOperations(1,t,e)}async _openRaster(e){const t=new me({url:this.url,version:this.version,coverageId:this.coverageId,ioConfig:{sampling:"closest",...this.ioConfig,customFetchParameters:this.customParameters}});if(await t.open({signal:e}),!t.rasterInfo)throw t.destroy(),new o.A("wcs-layer:load","cannot load resources on "+this.url);const{rasterInfo:n}=t;null==n.noDataValue&&(n.noDataValue=this.noData),this._set("serviceRasterInfo",n),this._set("spatialReference",n.spatialReference),null==this.title&&this.setAtOrigin("title",t.datasetName,"service"),null==this.coverageId&&this.setAtOrigin("coverageId",t.coverageInfo.id,"service"),null==this.version&&t.version&&this.setAtOrigin("version",t.version,"service"),this.setAtOrigin("tileInfo",t.rasterInfo.storageInfo.tileInfo,"service");const{multidimensionalInfo:i}=n;if(null!=i){const e=i.variables[0].dimensions.find(({name:e})=>"StdTime"===e);if(e){let t=e.extent?.[0]??e.values[0];Array.isArray(t)&&(t=t[0]);let n=e.extent?.[1]??e.values[e.values.length-1];Array.isArray(n)&&(n=n[1]);const i=ge.has(e.intervalUnit?.toLowerCase())?e.intervalUnit?.toLowerCase():null;this.set("timeInfo",{startField:"StdTime",fullTimeExtent:{start:t,end:n},timeZone:null,interval:i?{value:e.interval,unit:i}:null})}}this.raster=t,this._configDefaultSettings(),this.addHandles((0,c.wB)(()=>this.customParameters,e=>this.raster.ioConfig.customFetchParameters=e))}};(0,i._)([(0,u.MZ)({type:String,nonNullable:!0,json:{name:"wcsInfo.coverageId",write:{isRequired:!0,ignoreOrigin:!0}}})],he.prototype,"coverageId",void 0),(0,i._)([(0,u.MZ)()],he.prototype,"coverageInfo",null),(0,i._)([(0,u.MZ)({type:["1.0.0","1.1.0","1.1.1","1.1.2","2.0.1"],nonNullable:!0,json:{name:"wcsInfo.version",write:{isRequired:!0,ignoreOrigin:!0}}})],he.prototype,"version",void 0),(0,i._)([(0,u.MZ)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],he.prototype,"isReference",void 0),(0,i._)([(0,u.MZ)({json:{read:!0,write:!0}})],he.prototype,"blendMode",void 0),(0,i._)([(0,u.MZ)(I.a)],he.prototype,"legendEnabled",void 0),(0,i._)([(0,u.MZ)({type:["show","hide"]})],he.prototype,"listMode",void 0),(0,i._)([(0,u.MZ)()],he.prototype,"noData",void 0),(0,i._)([(0,u.MZ)({type:["WCS"]})],he.prototype,"operationalLayerType",void 0),(0,i._)([(0,u.MZ)()],he.prototype,"raster",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],he.prototype,"type",void 0),(0,i._)([(0,u.MZ)(I.p)],he.prototype,"popupEnabled",void 0),(0,i._)([(0,u.MZ)({type:s.A,json:{name:"popupInfo",write:!0}})],he.prototype,"popupTemplate",void 0),(0,i._)([(0,u.MZ)({readOnly:!0})],he.prototype,"defaultPopupTemplate",null),(0,i._)([(0,u.MZ)({readOnly:!0,type:[S.A]})],he.prototype,"fields",void 0),(0,i._)([(0,u.MZ)({readOnly:!0,type:[S.A]})],he.prototype,"rasterFields",null),he=(0,i._)([(0,p.$)("esri.layers.WCSLayer")],he);const ve=he}}]);