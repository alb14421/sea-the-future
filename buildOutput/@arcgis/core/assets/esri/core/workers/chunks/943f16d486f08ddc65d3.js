"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[8273],{4718:(e,t,i)=>{i.d(t,{a:()=>r});var n=i(93804);(0,n.s)()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"}),(0,n.s)()({absoluteValue:"absolute-value",multiplier:"multiplier"});const r=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]])},5370:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(32816),r=i(99924),s=i(29298),o=(i(32773),i(20266),i(69421)),a=i(89754);i(41390),i(85176),i(93181),i(13671),i(50704),i(40499),i(36555),i(58498),i(91047),i(35819),i(45371),i(61532),i(80959),i(6407),i(59121),i(19247),i(36172),i(36544),i(90740),i(84699),i(48064);let l=class extends r.o{constructor(e){super(e),this.path=[]}};(0,n._)([(0,s.MZ)({type:[a.A],json:{write:!0}})],l.prototype,"path",void 0),l=(0,n._)([(0,o.$)("esri.rest.knowledgeGraph.Path")],l)},5670:(e,t,i)=>{i.d(t,{K:()=>x,S:()=>v});var n=i(32816),r=i(41390),s=i(6407),o=i(20266),a=i(93217),l=i(80959),d=i(23381),p=i(29298),u=(i(32773),i(69421)),c=i(44600),h=i(84200),y=i(88321),m=i(69763),f=i(94531),g=i(77037),_=i(83637),b=i(58003),w=i(90426),I=i(43551),T=i(49197),M=i(73600);class v{constructor(){this._featureLookup=new Map}static getInstance(){return v.instance||(v.instance=new v),v.instance}static resetInstance(){v.instance&&(v.instance=null)}deleteFromStore(e){e.forEach(e=>{this._featureLookup.delete(e)})}readFromStoreByList(e){const t=[];return e.forEach(e=>{const i=this.readFromStoreById(e);i&&t.push(i)}),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,i){const n=[];return e.forEach(e=>{if(!e?.id)return;e.properties||(e.properties=[]);let r,s=null;if(i&&e.properties[i]&&(s=(0,_.b)(e.properties[i])),"originId"in e&&"destinationId"in e&&(e.properties[f.s]=e.originId,e.properties[f.a]=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const n=this._featureLookup.get(e.id),o=JSON.parse(JSON.stringify(Object.assign(n.attributes,e.properties)));i&&e.properties[i]&&(o[i]=(0,g.rS)(e.properties[i])),r=new b.O(s?JSON.parse(JSON.stringify(s)):n?.geometry?JSON.parse(JSON.stringify(n.geometry)):null,o,null,e.properties[t])}else r=new b.O(s?JSON.parse(JSON.stringify(s)):null,e.properties,null,e.properties[t]);this._featureLookup.set(`${e.typeName?`${e.typeName}__${e.id}`:e.id}`,r),n.push(r)}),n}}let x=class extends r.A{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach(i=>{i.name&&(t.set(i.name,"entity"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(i.name),i.properties?.forEach(e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(i.name,{name:e.name??"",geometryType:e.geometryType})}))}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(i=>{i.name&&(t.set(i.name,"relationship"),this._processingCacheUpdatesLookup.set(i.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(i.name),i.properties?.forEach(e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(i.name,{name:e.name??"",geometryType:e.geometryType})}))}),e.inclusionModeDefinition?.namedTypeDefinitions.forEach((i,n)=>{if("entity"===t.get(n))this.entityTypeNames.add(n);else{if("relationship"!==t.get(n))return o.L.getLogger(this).warn(`A named type, ${n}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(n);this.relationshipTypeNames.add(n)}const r=new Map;i.members?.forEach(e=>{(0,a.g)(this.memberIdTypeLookup,e.id,()=>new Set).add(n);const t=this.getById(e.id);t&&r.set(e.id,t)}),this.sublayerCaches.set(n,r)})}addToLayer(e){e.forEach(({typeName:e,id:t})=>{if(!this.inclusionModeDefinition)throw new s.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(e)){const i=this.inclusionModeDefinition.namedTypeDefinitions.get(e);i.members||(i.members=new Map),i.members.set(t,{id:t}),(0,a.g)(this.memberIdTypeLookup,t,()=>new Set).add(e)}}else{const i=new Map;i.set(t,{id:t}),this.inclusionModeDefinition.namedTypeDefinitions.set(e,{useAllData:!1,members:i}),(0,a.g)(this.memberIdTypeLookup,t,()=>new Set).add(e)}})}getById(e){return v.getInstance().readFromStoreById(e)}async getData(e,t,i){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let n;if(n=e||new M.A({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,i=this._processingCacheUpdatesLookup.get(t.objectType.name??""),r=n.outFields;r&&1===r.length&&r[0]===f.b&&"1=1"===n.where||await Promise.all(i??[]);const s=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],o=[];return s.forEach(i=>{if(this.relationshipTypeNames.has(t.objectType.name)){i.geometry=e.relationshipLinkChartDiagramLookup.get(i.attributes[t.objectIdField]);const n=this.memberIdTypeLookup.get(i.attributes[f.s]),r=this.memberIdTypeLookup.get(i.attributes[f.a]),s=this._isEndEntitySpatial(n,i,f.s),o=this._isEndEntitySpatial(r,i,f.a);i.attributes[f.c]=Number(s&&o)}else{i.geometry=e.entityLinkChartDiagramLookup.get(i.attributes[t.objectIdField]);const n=this.geographicLookup.get(t.objectType.name);n&&i.attributes[n.name]?i.attributes[f.c]=1:i.attributes[f.c]=0}i.attributes[f.d]=i.geometry,o.push(i)}),o}return this.retrieveDataFromService(n,t,i)}async getConnectedRecordIds(e,t,i){const n=[];let r="";const s=this._getNamedTypeIdMapFromNodeIds(e);if(t&&0!==t?.length){for(const e of t)r=r+e+"|";r=r.slice(0,-1)}const o={},a=[];for(const[e,i]of s){const n=`${e}_ids`;o[n]=i,t&&0!==t?.length?a.push(`MATCH (n:${e}) WHERE id(n) IN $${n} WITH n MATCH (n)-[r:${r}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):a.push(`MATCH (n:${e}) WHERE id(n) IN $${n} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!a.length)return n;const l=a.join(" UNION "),d=(await(0,I.executeQueryStreaming)(this.knowledgeGraph,new T.A({openCypherQuery:l,bindParameters:o}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await d.read();if(e)break;for(let e=0;e<t.length;e++){const i=t[e];n.push({id:i[0],typeName:i[1]}),n.push({id:i[2],typeName:i[3]})}}return n}async getRelationshipsBetweenNodes(e,t,i){const n=this._getNamedTypeIdMapFromNodeIds(e);if(0===n.size)return[];const r={relationshipExclusionIds:t,possibleConnectionEntityIds:e},s=[];for(const[e,t]of n.entries()){const i=`${e}_ids`;r[i]=t,s.push(`MATCH (n:${e}) WHERE id(n) IN $${i} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const o=s.join(" UNION "),a=[],l=(await(0,I.executeQueryStreaming)(this.knowledgeGraph,new T.A({openCypherQuery:o,bindParameters:r}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await l.read();if(e)break;for(let e=0;e<t.length;e++){const i=t[e];a.push({id:i[0],typeName:i[1]})}}return a}async getRelationshipsFromNodes(e,t,i,n){const r=this._getNamedTypeIdMapFromNodeIds(e);if(0===r.size||0===t.length)return[];const s={relationshipExclusionIds:i,possibleConnectionEntityIds:t},o=[];for(const[e,t]of r.entries()){const i=`${e}_ids`;s[i]=t,o.push(`MATCH (n:${e}) WHERE id(n) IN $${i} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const a=o.join(" UNION "),l=new Map,d=(await(0,I.executeQueryStreaming)(this.knowledgeGraph,new T.A({openCypherQuery:a,bindParameters:s}),{signal:n?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await d.read();if(e)break;for(let e=0;e<t.length;e++){const i=t[e];let n=l.get(i[1]);n||(n=new Set,l.set(i[1],n)),n.add(i[0])}}const p=[];for(const[e,t]of l)for(const i of t)p.push({id:i,typeName:e});return p}async refreshCacheContent(e,t,i,n=!0,r){const o=v.getInstance(),d=[],p=new Map,u=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&u.set(e.name,e)}),this.knowledgeGraph.dataModel.relationshipTypes?.forEach(e=>{e.name&&u.set(e.name,e)}),e||this.inclusionModeDefinition?e?e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e))p.has(t)?p.get(t)?.push(e):p.set(t,[e])}):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach((e,t)=>{e.useAllData?p.set(t,null):e.members&&e.members.forEach(e=>{p.has(t)&&null!==p.get(t)?p.get(t)?.push(e.id):p.set(t,[e.id])})}):(this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&p.set(e.name,null)}),this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&p.set(e.name,null)}));for(const[e,l]of p){const p=new Set(l),c=new Promise((d,c)=>{(async()=>{const d=new Set,c=[];let h,y="",m=!1;if(t||u.get(e)?.properties?.forEach(e=>{e.name&&d.add(e.name)}),i&&this.geographicLookup.has(e)){const t=this.geographicLookup.get(e)?.name;t&&d.add(t)}if(this.entityTypeNames.has(e))y=`MATCH (n:${e}) ${l?"WHERE id(n) IN $ids ":""}return ID(n)`,d.forEach(e=>{y+=`, n.${e}`,c.push(e)});else{if(!this.relationshipTypeNames.has(e))throw new s.A("knowledge-graph:layer-data-manager",`The graph type of ${e} could not be determined. Was this type set in the KG data model and inclusion definition?`);m=!0,y=`MATCH ()-[n:${e}]->() ${l?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,d.forEach(e=>{y+=`, n.${e}`,c.push(e)})}h=new T.A(l?{openCypherQuery:y,bindParameters:{ids:l}}:{openCypherQuery:y});const g=(await(0,I.executeQueryStreaming)(this.knowledgeGraph,h,{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:t,value:i}=await g.read();if(t)break;const r=[];for(let e=0;e<i.length;e++){const t=i[e];let n=0,s=0;const o={properties:{}};for(o.id=t[n],n++,s++,m&&(o.originId=t[n],n++,s++,o.destinationId=t[n],n++,s++,(0,a.g)(this.nodeConnectionsLookup,o.originId,()=>new Set).add(o.id),(0,a.g)(this.nodeConnectionsLookup,o.destinationId,()=>new Set).add(o.id),(0,a.g)(this.relationshipConnectionsLookup,o.id,()=>[o.originId,o.destinationId]));n<t.length;n++)o.properties[c[n-s]]=t[n];p.delete(o.id),r.push(o)}const s=o.writeToStore(r,f.b,this.geographicLookup.get(e)?.name);this.sublayerCaches.has(e)||this.sublayerCaches.set(e,new Map),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(e)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(e,{useAllData:!1,members:new Map}),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(e).members=new Map);const l=this.sublayerCaches.get(e);s.forEach(t=>{l?.set(t.attributes[f.b],t),n&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.has(t.attributes[f.b])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(e).members.set(t.attributes[f.b],{id:t.attributes[f.b]}),(0,a.g)(this.memberIdTypeLookup,t.attributes[f.b],()=>new Set).add(e))})}const _=this.inclusionModeDefinition?.namedTypeDefinitions.get(e);if(_)for(const e of p)_.members?.delete(e)})().then(()=>{d(null)}).catch(e=>{"AbortError"===e.name?d(null):c(e)})});d.push(c),this._processingCacheUpdatesLookup.get(e)?.push(c)}if(await Promise.all(d),r?.signal?.aborted)throw(0,l.NK)()}removeFromLayer(e){const t=new Set,i=new Set(e.map(e=>e.id));for(const i of e)t.add(i.typeName),1===this.memberIdTypeLookup.get(i.id)?.size?this.memberIdTypeLookup.delete(i.id):this.memberIdTypeLookup.get(i.id)?.delete(i.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((e,t)=>{t===i.typeName&&e.members?.has(i.id)&&e.members.delete(i.id)});t.forEach(e=>{this.sublayerCaches.get(e)?.forEach((t,n)=>{i.has(n)&&this.sublayerCaches.get(e)?.delete(n)})})}async retrieveDataFromService(e,t,i){const n=v.getInstance(),r=new Set,o=[];let a,l="",p=[];const u="relationship"===t.graphType,g=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,_=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let b=!g&&_?Array.from(_).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(b=e.objectIds);else if(null!=e.objectIds&&b&&b.length>0){const t=e.objectIds;e.objectIds=b.filter(e=>t.includes(e))}else if(null!=e.objectIds)b=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=b}if(null!=e.outFields){const i=e.outFields;i.includes("*")?t.fields.forEach(e=>{r.add(e.name)}):i.forEach(e=>{e!==f.b&&e!==t.geometryFieldName&&r.add(e)})}if(null!=e.geometry){const i=e.geometry;let n;const p=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,f=p?.spatialReference,g=p?.serviceCapabilities?.geometryCapabilities;let _=g?.geometryMaxBoundingRectangleSizeX,b=g?.geometryMaxBoundingRectangleSizeY;if("point"===i.type){let e=i;e.spatialReference?.isWGS84||(await(0,y.initializeProjection)(e.spatialReference,m.w),e=(0,y.project)(e,m.w)),n=new c.A({spatialReference:m.w,xmin:e.x-1e-4,ymin:e.y-1e-4,xmax:e.x+1e-4,ymax:e.y+1e-4})}else i?.extent?.spatialReference&&!i.spatialReference?.isWGS84?(await(0,y.initializeProjection)(i.extent.spatialReference,m.w),n=(0,y.project)(i.extent,m.w)):n=i.extent;if(_&&b&&f){if(4326!==f.wkid){const e=new c.A({spatialReference:f,xmax:_,ymax:b}),t=(0,y.project)(e,m.w);_=t.xmax,b=t.ymax}if(n.xmax-n.xmin>_)throw new s.A("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${_}° latitude, limit exceeded`);if(n.ymax-n.ymin>b)throw new s.A("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${b}° longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const i=await(0,d.GP)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(e=>{i.fieldNames.includes(e.name)&&r.add(e.name)})}l=u?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach(e=>{l+=`, n.${e}`,o.push(e)}),a=new T.A({openCypherQuery:l,bindParameters:{param_filter_geom:new h.A({rings:(0,w.u)(n)})}})}else{let i="";if(null!=e.where&&"1=1"!==e.where){const n=await(0,d.GP)(e.where,t.fieldsIndex);t.fields.forEach(e=>{n.fieldNames.includes(e.name)&&r.add(e.name)});const s=new Set(["column-reference","string","number","binary-expression"]),o=new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]);let a=!1;const l=e=>{if("column-reference"===e.type)return`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&s.has(e.left.type)&&s.has(e.right.type)&&o.has(e.operator))return`${l(e.left)} ${e.operator} ${l(e.right)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let t="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)t+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return a=!0,"";t+=`lower(n.${e.left.column})`}if(t+=" CONTAINS (","string"!==e.right.type)return a=!0,"";{let i=e.right.value;i.startsWith("%")&&(i=i.slice(1)),i.endsWith("%")&&(i=i.slice(0,-1)),t+=`'${i.toLowerCase()}')`}return t}return a=!0,""};i=l(n.parseTree),a&&(i="")}let n="";n=u?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let s=!1;b&&(s=!0,n+=" WHERE ID(n) IN $ids"),i&&(n+=s?" AND":" WHERE",n+=` ${i}`),n+=" return ID(n)",u&&(n+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&r.add(t.geometryFieldName),r.forEach(e=>{n+=`, n.${e}`,o.push(e)}),a=new T.A(b?{openCypherQuery:n,bindParameters:{ids:b}}:{openCypherQuery:n})}const M=(await(0,I.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,a,i)).resultRowsStream.getReader();for(;;){const{done:e,value:i}=await M.read();if(e)break;const r=[];for(let e=0;e<i.length;e++){const t=i[e];let n=0,s=0;const a={properties:{}};for(a.id=t[n],n++,s++,u&&(a.originId=t[n],n++,s++,a.destinationId=t[n],n++,s++);n<t.length;n++)a.properties[o[n-s]]=t[n];r.push(a)}p=p.concat(n.writeToStore(r,f.b,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return p}_isEndEntitySpatial(e,t,i){for(const n of e??[])if(this.entityTypeNames.has(n)){const e=this.geographicLookup.get(n),r=e&&this.sublayerCaches.get(n)?.get(t.attributes[i]);if(e&&r?.attributes[e.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const t=new Map;return e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(const i of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(i))return;t.has(i)?t.get(i)?.push(e):t.set(i,[e])}}),t}};(0,n._)([(0,p.MZ)()],x.prototype,"knowledgeGraph",void 0),(0,n._)([(0,p.MZ)()],x.prototype,"inclusionModeDefinition",void 0),(0,n._)([(0,p.MZ)()],x.prototype,"entityTypeNames",void 0),(0,n._)([(0,p.MZ)()],x.prototype,"relationshipTypeNames",void 0),(0,n._)([(0,p.MZ)()],x.prototype,"geographicLookup",void 0),(0,n._)([(0,p.MZ)()],x.prototype,"sublayerCaches",void 0),(0,n._)([(0,p.MZ)()],x.prototype,"nodeConnectionsLookup",void 0),(0,n._)([(0,p.MZ)()],x.prototype,"relationshipConnectionsLookup",void 0),(0,n._)([(0,p.MZ)()],x.prototype,"memberIdTypeLookup",void 0),x=(0,n._)([(0,u.$)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],x)},10043:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(32816),r=i(29298),s=(i(32773),i(20266),i(69421)),o=i(89754);i(36544),i(85176),i(93181),i(13671),i(40499),i(6407),i(59121),i(90740),i(84699),i(50704),i(91047),i(48064),i(99924),i(41390),i(36555),i(58498),i(35819),i(45371),i(61532),i(80959),i(19247),i(36172);let a=class extends o.A{constructor(e){super(e),this.typeName=null,this.id=null}};(0,n._)([(0,r.MZ)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,n._)([(0,r.MZ)({type:String,json:{write:!0}})],a.prototype,"id",void 0),a=(0,n._)([(0,s.$)("esri.rest.knowledgeGraph.GraphNamedObject")],a)},11618:(e,t,i)=>{i.d(t,{o:()=>r});var n=i(58003);const r={getObjectId:e=>e.objectId,getAttributes:e=>e.attributes,getAttribute:(e,t)=>e.attributes[t],cloneWithGeometry:(e,t)=>new n.O(t,e.attributes,null,e.objectId),getGeometry:e=>e.geometry,getCentroid:(e,t)=>e.ensureCentroid(t)}},11721:(e,t,i)=>{i.d(t,{B:()=>v,P:()=>o});var n=i(32773),r=i(61532),s=i(32159);class o{constructor(e=9,t){this._compareMinX=u,this._compareMinY=c,this._toBBox=e=>e,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&("function"==typeof t?this._toBBox=t:this._initFormat(t)),this.clear()}destroy(){this.clear(),w.prune(),I.prune(),T.prune(),M.prune()}all(e){a(this._data,e)}search(e,t){let i=this._data;const n=this._toBBox;if(_(e,i))for(w.clear();i;){for(let r=0,s=i.children.length;r<s;r++){const s=i.children[r],o=i.leaf?n(s):s;_(e,o)&&(i.leaf?t(s):g(e,o)?a(s,t):w.push(s))}i=w.pop()}}collides(e){let t=this._data;const i=this._toBBox;if(!_(e,t))return!1;for(w.clear();t;){for(let n=0,r=t.children.length;n<r;n++){const r=t.children[n],s=t.leaf?i(r):r;if(_(e,s)){if(t.leaf||g(e,s))return!0;w.push(r)}}t=w.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let t=0,i=e.length;t<i;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this._data.children.length)if(this._data.height===t.height)this._splitRoot(this._data,t);else{if(this._data.height<t.height){const e=this._data;this._data=t,t=e}this._insert(t,this._data.height-t.height-1,!0)}else this._data=t;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new E([]),this}remove(e){if(!e)return this;let t,i=this._data,r=null,s=0,o=!1;const a=this._toBBox(e);for(T.clear(),M.clear();i||T.length>0;){if(i||(i=T.pop(),r=T.data[T.length-1],s=M.pop()??0,o=!0),i.leaf&&(t=(0,n.d)(i.children,(0,n.t)(e),i.children.length,i.indexHint),-1!==t))return i.children.splice(t,1),T.push(i),this._condense(T),this;o||i.leaf||!g(i,a)?r?(s++,i=r.children[s],o=!1):i=null:(T.push(i),M.push(s),s=0,r=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_build(e,t,i,n){const r=i-t+1;let s=this._maxEntries;if(r<=s){const n=new E(e.slice(t,i+1));return l(n,this._toBBox),n}n||(n=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/s**(n-1)));const o=new S([]);o.height=n;const a=Math.ceil(r/s),d=a*Math.ceil(Math.sqrt(s));b(e,t,i,d,this._compareMinX);for(let r=t;r<=i;r+=d){const t=Math.min(r+d-1,i);b(e,r,t,a,this._compareMinY);for(let i=r;i<=t;i+=a){const r=Math.min(i+a-1,t);o.children.push(this._build(e,i,r,n-1))}}return l(o,this._toBBox),o}_insert(e,t,i){const n=this._toBBox,r=i?e:n(e);T.clear();const s=function(e,t,i,n){for(;n.push(t),!0!==t.leaf&&n.length-1!==i;){let i,n=1/0,r=1/0;for(let s=0,o=t.children.length;s<o;s++){const o=t.children[s],a=h(o),l=m(e,o)-a;l<r?(r=l,n=a<n?a:n,i=o):l===r&&a<n&&(n=a,i=o)}t=i||t.children[0]}return t}(r,this._data,t,T);for(s.children.push(e),p(s,r);t>=0&&T.data[t].children.length>this._maxEntries;)this._split(T,t),t--;!function(e,t,i){for(let n=i;n>=0;n--)p(t.data[n],e)}(r,T,t)}_split(e,t){const i=e.data[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const s=this._chooseSplitIndex(i,r,n);if(!s)return;const o=i.children.splice(s,i.children.length-s),a=i.leaf?new E(o):new S(o);a.height=i.height,l(i,this._toBBox),l(a,this._toBBox),t?e.data[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this._data=new S([e,t]),this._data.height=e.height+1,l(this._data,this._toBBox)}_chooseSplitIndex(e,t,i){let n,r,s;n=r=1/0;for(let o=t;o<=i-t;o++){const t=d(e,0,o,this._toBBox),a=d(e,o,i,this._toBBox),l=f(t,a),p=h(t)+h(a);l<n?(n=l,s=o,r=p<r?p:r):l===n&&p<r&&(r=p,s=o)}return s}_chooseSplitAxis(e,t,i){const n=e.leaf?this._compareMinX:u,r=e.leaf?this._compareMinY:c;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const r=this._toBBox,s=d(e,0,t,r),o=d(e,i-t,i,r);let a=y(s)+y(o);for(let n=t;n<i-t;n++){const t=e.children[n];p(s,e.leaf?r(t):t),a+=y(s)}for(let n=i-t-1;n>=t;n--){const t=e.children[n];p(o,e.leaf?r(t):t),a+=y(o)}return a}_condense(e){for(let t=e.length-1;t>=0;t--){const i=e.data[t];if(0===i.children.length)if(t>0){const r=e.data[t-1],s=r.children;s.splice((0,n.d)(s,i,s.length,r.indexHint),1)}else this.clear();else l(i,this._toBBox)}}_initFormat(e){const t=["return a"," - b",";"];this._compareMinX=new Function("a","b",t.join(e[0])),this._compareMinY=new Function("a","b",t.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function a(e,t){let i=e;for(I.clear();i;){if(!0===i.leaf)for(const e of i.children)t((0,n.t)(e));else I.pushArray(i.children);i=I.pop()??null}}function l(e,t){d(e,0,e.children.length,t,e)}function d(e,t,i,n,r){r||(r=new E([])),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let s,o=t;o<i;o++)s=e.children[o],p(r,e.leaf?n(s):s);return r}function p(e,t){e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY)}function u(e,t){return e.minX-t.minX}function c(e,t){return e.minY-t.minY}function h(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function y(e){return e.maxX-e.minX+(e.maxY-e.minY)}function m(e,t){return(Math.max(t.maxX,e.maxX)-Math.min(t.minX,e.minX))*(Math.max(t.maxY,e.maxY)-Math.min(t.minY,e.minY))}function f(e,t){const i=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY),r=Math.min(e.maxX,t.maxX),s=Math.min(e.maxY,t.maxY);return Math.max(0,r-i)*Math.max(0,s-n)}function g(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function _(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function b(e,t,i,n,r){const o=[t,i];for(;o.length;){const t=o.pop(),i=o.pop();if(t-i<=n)continue;const a=i+Math.ceil((t-i)/n/2)*n;(0,s.q)(e,a,i,t,r),o.push(i,a,a,t)}}const w=new r.P,I=new r.P,T=new r.P,M=new r.P({deallocator:void 0});class v{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class x extends v{constructor(){super(...arguments),this.height=1,this.indexHint=new n.P}}class E extends x{constructor(e){super(),this.children=e,this.leaf=!0}}class S extends x{constructor(e){super(),this.children=e,this.leaf=!1}}},13141:(e,t,i)=>{i.d(t,{F:()=>y});var n=i(32773),r=i(6407),s=i(81272),o=i(20266),a=i(47239),l=i(48402),d=i(83637),p=i(42614),u=i(59700),c=i(11618);const h=(0,a.c)();class y{constructor(e){this.geometryInfo=e,this._boundsStore=new p.B,this._featuresById=new Map,this._usedMemory=0,this.events=new s.bk,this.featureAdapter=c.o}get usedMemory(){return this._usedMemory}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let e=0;return this._featuresById.forEach(t=>{null!=t.geometry&&t.geometry.coords&&(e+=t.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:e/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(e){if(null==this.fullBounds)return null;const[t,i,n,r]=this.fullBounds;return{xmin:t,ymin:i,xmax:n,ymax:r,spatialReference:(0,u.c)(e)}}add(e){this._add(e),this._emitChanged()}addMany(e){for(const t of e)this._add(t);this._emitChanged()}upsertMany(e){const t=e.map(e=>this._upsert(e));return this._emitChanged(),t.filter(n.i)}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged(),this._usedMemory=0}removeById(e){const t=this._featuresById.get(e);return t?(this._remove(t),this._emitChanged(),t):null}removeManyById(e){this._boundsStore.invalidateIndex();for(const t of e){const e=this._featuresById.get(t);e&&this._remove(e)}this._emitChanged()}forEachBounds(e,t){for(const i of e){const e=this._boundsStore.get(i.objectId);e&&t((0,a.g)(h,e))}}getFeature(e){return this._featuresById.get(e)}has(e){return this._featuresById.has(e)}forEach(e){this._featuresById.forEach(t=>e(t))}forEachInBounds(e,t){this._boundsStore.forEachInBounds(e,e=>{t(this._featuresById.get(e))})}_emitChanged(){this.events.emit("changed",void 0)}_add(e){if(!e)return;const t=e.objectId;if(null==t)return void o.L.getLogger("esri.layers.graphics.data.FeatureStore").error(new r.A("featurestore:invalid-feature","feature id is missing",{feature:e}));const i=this._featuresById.get(t);let n;if(i?(e.displayId=i.displayId,n=this._boundsStore.get(t),this._boundsStore.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(i)??0):null!=this.onFeatureAdd&&this.onFeatureAdd(e),!e.geometry?.coords?.length)return this._boundsStore.set(t,null),void this._featuresById.set(t,e);n=(0,d.g)(null!=n?n:(0,l.c)(),e.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),null!=n&&this._boundsStore.set(t,n),this._featuresById.set(t,e),this._usedMemory+=this.estimateFeatureUsedMemory?.(e)??0}_upsert(e){const t=e?.objectId;if(null==t)return o.L.getLogger("esri.layers.graphics.data.FeatureStore").error(new r.A("featurestore:invalid-feature","feature id is missing",{feature:e})),null;const i=this._featuresById.get(t);if(!i)return this._add(e),e;this._usedMemory-=this.estimateFeatureUsedMemory?.(i)??0;const{geometry:n,attributes:s}=e;for(const e in s)i.attributes[e]=s[e];return n&&(i.geometry=n,this._boundsStore.set(t,(0,d.g)((0,l.c)(),n,this.geometryInfo.hasZ,this.geometryInfo.hasM)??null)),this._usedMemory+=this.estimateFeatureUsedMemory?.(i)??0,i}_remove(e){null!=this.onFeatureRemove&&this.onFeatureRemove(e);const t=e.objectId;return this._boundsStore.delete(t),this._featuresById.delete(t),this._usedMemory-=this.estimateFeatureUsedMemory?.(e)??0,e}}},14658:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(32816),r=i(29298),s=(i(32773),i(20266),i(69421)),o=i(64752),a=i(10043);i(36544),i(85176),i(93181),i(13671),i(40499),i(6407),i(59121),i(90740),i(84699),i(50704),i(91047),i(48064),i(41390),i(36555),i(58498),i(35819),i(45371),i(61532),i(80959),i(19247),i(36172),i(48844),i(49877),i(56273),i(2160),i(99924),i(7969),i(69763),i(93804),i(96221),i(18683),i(64604),i(29512),i(99063),i(1178),i(29208),i(89754);let l=class extends a.A{constructor(e){super(e),this.layoutGeometry=null}};(0,n._)([(0,r.MZ)({type:o.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n._)([(0,s.$)("esri.rest.knowledgeGraph.Entity")],l)},16702:(e,t,i)=>{i.d(t,{A:()=>de,i:()=>te});var n=i(32816),r=i(72393),s=i(32773),o=i(20266),a=i(2810),l=(i(11494),i(29298)),d=i(69421),p=i(56273),u=i(44600),c=i(64752),h=i(84200),y=i(67504),m=i(88321),f=i(7969),g=i(69763),_=i(92517),b=i(56184),w=i(73597),I=i(13141),T=i(2232),M=i(53104),v=i(94531),x=i(38093),E=i(35902),S=i(10224),A=i(43551),N=i(85232),L=i(19648),F=i(31315),k=i(74285),D=i(25643),C=i(29755),j=i(6837),O=i(46935),B=i(96807),R=i(69448),Z=i(65174),$=i(44864),G=i(30011),P=i(60408),q=i(35619),U=i(16677),Y=i(32397),Q=i(67664),z=i(8824),H=i(73600),X=i(20978),J=i(69033),W=i(9380);i(52731),i(41390),i(85176),i(93181),i(13671),i(50704),i(40499),i(36555),i(58498),i(91047),i(35819),i(45371),i(61532),i(80959),i(6407),i(59121),i(90740),i(84699),i(19247),i(36172),i(36544),i(48064),i(17745),i(81272),i(44945),i(99924),i(48844),i(49877),i(51961),i(62399),i(64995),i(70861),i(93804),i(33150),i(58173),i(66110),i(67520),i(27532),i(88663),i(48103),i(50214),i(59192),i(16345),i(54483),i(65085),i(33611),i(84857),i(60373),i(20568),i(16794),i(13226),i(16699),i(52357),i(11090),i(49319),i(93546),i(29570),i(34592),i(79825),i(95101),i(67578),i(17857),i(82537),i(14896),i(95611),i(98089),i(91366),i(80473),i(43435),i(73435),i(6801),i(41003),i(29512),i(99063),i(64604),i(1178),i(55270),i(95779),i(13262),i(346),i(18683),i(2160),i(96221),i(29208),i(97827),i(18169),i(20762),i(48402),i(2589),i(36533),i(47387),i(46728),i(21632),i(64102),i(99032),i(79022),i(73509),i(28276),i(58194),i(4734),i(47239),i(22522),i(83637),i(77037),i(58003),i(33489),i(96153),i(42614),i(11721),i(59700),i(2824),i(56764),i(11618),i(34362),i(23787),i(22151),i(38896),i(26589),i(7011),i(133),i(17872),i(70648),i(69310),i(31572),i(9943),i(91276),i(18527),i(62482),i(45476),i(71044),i(43534),i(47812),i(83463),i(78016),i(16641),i(88817),i(3687),i(3952),i(339),i(79281),i(13978),i(47368),i(29403),i(40672),i(96587),i(79747),i(14509),i(14549),i(26171),i(85842),i(79875),i(75169),i(67321),i(7078),i(33348),i(25018),i(36309),i(23916),i(93074),i(54616),i(54512),i(53610),i(29447),i(78273),i(93471),i(49475),i(53103),i(35121),i(78328),i(42948),i(82408),i(91658),i(70580),i(75191),i(24319),i(62092),i(71992),i(7182),i(47788),i(19297),i(53252),i(34039),i(12856),i(3495),i(97906),i(64524),i(65023),i(31424),i(74676),i(32368),i(7391),i(22529),i(70061),i(38094),i(67723),i(63728),i(4157),i(62401),i(89322),i(20138),i(53370),i(59858),i(46946),i(3816),i(80167),i(4478),i(91808),i(7161),i(55586),i(92229),i(23351),i(64884),i(51222),i(42870),i(91815),i(18344),i(63015),i(47765),i(53063),i(6893),i(64209),i(73574),i(13824),i(3593),i(52138),i(463),i(11538),i(95637),i(59930),i(45862),i(72762),i(71613),i(27281),i(91308),i(80153),i(77e3),i(19049),i(64724),i(63402),i(17618),i(43053),i(19548),i(92975),i(69993),i(7603),i(57335),i(94358),i(82341),i(76878),i(14339),i(99852),i(47034),i(3515),i(32408),i(52319),i(6105),i(14658),i(10043),i(89754),i(72076),i(5370),i(76999),i(76641),i(60369),i(13201),i(91028),i(71361),i(86688),i(93049),i(64035),i(56367),i(8904),i(81284),i(78860),i(26805),i(13983),i(97511),i(32264),i(68849),i(82842),i(58196),i(73067),i(86941),i(17813),i(3112),i(60027),i(57111),i(75651),i(88614),i(1030),i(15319),i(60785),i(56487),i(6399),i(9498),i(24079),i(38149),i(19681),i(40328),i(84539),i(65299),i(38641),i(19869),i(98238),i(41740),i(46626),i(45560),i(56303),i(85890),i(55884),i(1739),i(81618),i(17012),i(98203),i(54131),i(53065),i(20804),i(63834),i(87357),i(19969),i(9207),i(91381),i(3827),i(49011),i(76164),i(38632),i(44296),i(44747),i(91524),i(43682),i(85351),i(54481),i(1535),i(89253),i(62959),i(74159),i(90197),i(76636),i(11737),i(31175),i(23875),i(56570);const V=(0,x.d)(),K=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,n._)([(0,l.MZ)(V.fields)],i.prototype,"fields",void 0),(0,n._)([(0,l.MZ)(V.fieldsIndex)],i.prototype,"fieldsIndex",void 0),i=(0,n._)([(0,d.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],i),i},ee=(e,t)=>"knowledge-graph"===e.type?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function te(e,t,i){return(async(e,t,i)=>{if(t||(t=[...e.layers,...e.tables].map(e=>e.graphTypeName)),0===t?.length)return;const n=new Map;for(const i of t)n.set(i,ee(e,i));const r=await(0,A.fetchClientDataAtKeys)(e.dataManager.knowledgeGraph,Array.from(n.values()),{requestOptions:{signal:i?.signal}});for(const t of[...e.layers,...e.tables]){const i=t.objectType.name;if(null==i)continue;const n=r.get(ee(e,i));if(n){const e=JSON.parse(n);null===e||"object"!=typeof e||e.hasOwnProperty("showLabels")||(e.showLabels=!1),t.read(e,{origin:"service"})}}})(e,t,i)}const ie=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"];function ne(e){const t=e.toArray();return new N.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function re(e){if(!e.json)return e;e.json.write=se(e.json.write);const t=e.json.origins;if(!t)return e;let i;for(i in t){const e=t[i];e&&(e.write=se(e.write))}return e}function se(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){const{target:t,writer:i,overridePolicy:n,...r}=e;return function(e,t){const i=ae.call(this,e,t);return i.enabled?{...r,...i}:i}}(e)),e):!0===e?oe():e}function oe(){return{overridePolicy:ae}}function ae(e,t){const i=!!this.geometryType;let n={enabled:i};return i&&(n={...n,...le.call(this,e,t)}),n}function le(e,t){return{ignoreOrigin:this.originIdOf(t)>0}}let de=class extends(K((0,k.FJ)((0,C.J)((0,D.F)((0,F.dM)((0,j.fY)((0,R.e)((0,B.j)((0,O.J)((0,a.M)(w.A))))))))))){constructor(e){super(e),this.blendMode="normal",this.capabilities=(0,M.d)(!1,!0),this.charts=null,this.definitionExpression=null,this.displayField="",this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphicOrigin=new b.A(this),this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=v.b,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{const e=new MessageChannel;return new W.default(e.port1,{channel:e,client:{queryFeatures:(e,t={})=>{const i=H.A.fromJSON(e);return this.queryFeaturesJSON(i,t)}}}),[e.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){const e=[];return this.objectType?.properties?.forEach(t=>{const i="esriFieldTypeOID"===t.fieldType?"esriFieldTypeInteger":t.fieldType;e.push($.A.fromJSON({name:t.name,type:i,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))}),e.push($.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),$.A.fromJSON({name:v.e,type:"esriFieldTypeInteger",alias:v.e,editable:!1}),$.A.fromJSON({name:v.c,type:"esriFieldTypeInteger",alias:v.c,editable:!1})),e}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&"esriGeometryNull"!==t?_.f.fromJSON(t):null}get geometryFieldName(){if("link-chart"===this.parentCompositeLayer?.type)return v.d;const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name);return e?.name??null}get graphTypeName(){return this.objectType?.name}set graphTypeName(e){this._set("graphTypeName",e)}get hasM(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,i=t?this.objectType?.properties?.[t]:null;return i?.hasM??!1}get hasZ(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,i=t?this.objectType?.properties?.[t]:null;return i?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");if(!this.objectType||!this.parentCompositeLayer||!this.graphTypeName)return null;const e=this.objectType.properties?function(e){let t="ESRI__ID",i=4;for(const n of e)if(n.name){if("name"===n.name.toLowerCase()){t=n.name;break}n.name.toLowerCase().includes("name")?(t=n.name,i=2):"esriFieldTypeString"===n.fieldType&&i>3&&(t=n.name,i=3)}return t}(this.objectType.properties):"ESRI__ID";return"link-chart"===this.parentCompositeLayer.type?function(e,t,i){const n={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},r=new S.A({labelExpressionInfo:new S.L({expression:"ESRI__ID"===i?`${t}`:`$feature.${i}`}),labelPlacement:"above-center",symbol:new L.A(n)}),s=new S.A({labelExpressionInfo:new S.L({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new L.A({...n,yoffset:"12px"})});return"entity"===e?[r]:[s]}(this.graphType,this.graphTypeName,e):function(e,t,i){const n={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},r="ESRI__ID"===i?`${e}`:`$feature.${i}`;return"point"===t?[new S.A({labelExpressionInfo:new S.L({expression:r}),labelPlacement:"above-center",symbol:new L.A(n)})]:"polyline"===t?[new S.A({labelExpressionInfo:new S.L({expression:r}),labelPlacement:"center-along",repeatLabel:!0,symbol:new L.A(n)})]:"polygon"===t?[new S.A({labelExpressionInfo:new S.L({expression:r}),labelPlacement:"always-horizontal",symbol:new L.A(n)})]:null}(this.graphTypeName,this.geometryType,e)}set renderer(e){(0,G.yp)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");const e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map(e=>e.name).indexOf(this.graphTypeName),i=new E.A((n=t)<0||n>=ie.length?"#8f8f82":ie[n]);var n;if("link-chart"===this.parentCompositeLayer?.type){if("relationship"===this.graphType)return new U.A({type:"simple",symbol:ne(i)});const e=(0,Y.r)((0,M.c)(_.f.toJSON("point")).renderer);return(0,J.c)(e.symbol,i),e}const r=(0,Y.r)((0,M.c)(_.f.toJSON(this.geometryType)).renderer);return(0,J.c)(r.symbol,i),r}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??f.A.WGS84}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return(0,X.tn)(this,e)}createQuery(){return new H.A({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e),r=z.A.fromJSON(await n.executeQuery(i.toJSON(),t?.signal));return r.features.forEach(e=>{e.sourceLayer=this}),r}async queryFeaturesJSON(e,t){await this.load();const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e);return await n.executeQuery(i.toJSON(),t?.signal)}async queryFeatureCount(e,t){await this.load();const{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(e);return n.executeQueryForCount(i.toJSON(),t?.signal)}async queryExtent(e={},t){await this.load();const i={...e,returnGeometry:!0},{resolvedQuery:n,queryEngine:r}=await this._setupQueryObjects(i),s=await r.executeQueryForExtent(n.toJSON(),t?.signal);let o;return o=null!=s.extent?.xmin&&null!=s.extent?.xmax&&null!=s.extent?.ymin&&null!=s.extent?.ymax?new u.A(s.extent):new u.A,{count:s.count,extent:o}}async queryObjectIds(e,t){await this.load();const i=H.A.from(e);let n;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)n=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(i,this,t);n=this.loadQueryEngine(e)}return await n.executeQueryForIds(i.toJSON(),t?.signal)}loadQueryEngine(e){const t=new I.F({geometryType:_.f.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),i=new T.a({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:_.f.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,featureIdInfo:{type:"object-id",fieldName:this.objectIdField},spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return i.featureStore.addMany(e),i}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new H.A({where:"1=1",outFields:[v.b]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then(()=>(0,G.sv)(this.timeInfo,this.fieldsIndex))),Promise.resolve(this)}async _setupQueryObjects(e,t){const i=H.A.from(e),n=i.geometry;if(n&&!n.spatialReference?.isWGS84&&(await(0,m.initializeProjection)(n.spatialReference,g.w),i.geometry=(0,m.project)(n instanceof h.A||n instanceof y.A||n instanceof c.A?n:n.extent,g.w)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)return{resolvedQuery:i,queryEngine:this._cachedQueryEngine};const r=await this.parentCompositeLayer.dataManager.getData(i,this,t);return{resolvedQuery:i,queryEngine:this.loadQueryEngine(r)}}};(0,n._)([(0,l.MZ)(re((0,s.o8)(F.sU)))],de.prototype,"blendMode",void 0),(0,n._)([(0,l.MZ)()],de.prototype,"capabilities",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],de.prototype,"userHasUpdateItemPrivileges",null),(0,n._)([(0,l.MZ)({json:{origins:{"web-scene":{write:!1}},write:oe()}})],de.prototype,"charts",void 0),(0,n._)([(0,l.MZ)({readOnly:!0})],de.prototype,"defaultPopupTemplate",null),(0,n._)([(0,l.MZ)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],de.prototype,"definitionExpression",void 0),(0,n._)([(0,l.MZ)()],de.prototype,"displayField",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(k.Dp)))],de.prototype,"displayFilterEnabled",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(k.KV)))],de.prototype,"displayFilterInfo",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(F.LF)))],de.prototype,"effect",void 0),(0,n._)([(0,l.MZ)()],de.prototype,"elevationInfo",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(D.Y)))],de.prototype,"featureEffect",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(C.f)))],de.prototype,"featureReduction",null),(0,n._)([(0,l.MZ)()],de.prototype,"fields",null),(0,n._)([(0,l.MZ)()],de.prototype,"geometryType",null),(0,n._)([(0,l.MZ)()],de.prototype,"geometryFieldName",null),(0,n._)([(0,l.MZ)({readOnly:!0,clonable:!1})],de.prototype,"graphicOrigin",void 0),(0,n._)([(0,l.MZ)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],de.prototype,"graphType",void 0),(0,n._)([(0,l.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],de.prototype,"graphTypeName",null),(0,n._)([(0,l.MZ)()],de.prototype,"hasM",null),(0,n._)([(0,l.MZ)()],de.prototype,"hasZ",null),(0,n._)([(0,l.MZ)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],de.prototype,"id",void 0),(0,n._)([(0,l.MZ)({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],de.prototype,"labelsVisible",void 0),(0,n._)([(0,l.MZ)({type:[S.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:function(e,t,i){const n=[["ESRI__AGGREGATION_COUNT",v.e],["ESRI__ORIGIN_ID",v.s],["ESRI__DESTINATION_ID",v.a],["ESRI__LAYOUT_GEOMETRY",v.d]];try{for(const t of e)for(const[e,i]of n)t.labelExpression=t.labelExpression?.replaceAll(e,i),t.labelExpressionInfo?.expression&&(t.labelExpressionInfo.expression=t.labelExpressionInfo.expression.replaceAll(e,i))}catch(e){o.L.getLogger(this).warn("Error updating labelingInfo",e)}return(0,P.r)(e,t,i)},write:oe()}})],de.prototype,"labelingInfo",null),(0,n._)([(0,l.MZ)({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],de.prototype,"layerType",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(Z.a)))],de.prototype,"legendEnabled",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(Z.m)))],de.prototype,"maxScale",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(Z.c)))],de.prototype,"minScale",void 0),(0,n._)([(0,l.MZ)()],de.prototype,"objectIdField",void 0),(0,n._)([(0,l.MZ)()],de.prototype,"objectType",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(Z.o)))],de.prototype,"opacity",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(j.ne)))],de.prototype,"orderBy",void 0),(0,n._)([(0,l.MZ)({clonable:!1})],de.prototype,"parent",void 0),(0,n._)([(0,l.MZ)()],de.prototype,"parentCompositeLayer",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(Z.p)))],de.prototype,"popupEnabled",void 0),(0,n._)([(0,l.MZ)({type:r.A,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],de.prototype,"popupTemplate",void 0),(0,n._)([(0,l.MZ)({type:Number,json:{write:{overridePolicy:le}}})],de.prototype,"refreshInterval",void 0),(0,n._)([(0,l.MZ)({types:Q.r,json:{name:"layerDefinition.drawingInfo.renderer",write:oe()}})],de.prototype,"renderer",null),(0,n._)([(0,l.MZ)()],de.prototype,"source",void 0),(0,n._)([(0,l.MZ)()],de.prototype,"spatialReference",null),(0,n._)([(0,l.MZ)({type:q.A,json:{name:"layerDefinition.timeInfo",write:!0,origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:!0},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:!0}}}})],de.prototype,"timeInfo",null),(0,n._)([(0,l.MZ)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],de.prototype,"title",null),(0,n._)([(0,p.w)("title")],de.prototype,"writeTitle",null),(0,n._)([(0,l.MZ)({json:{read:!1}})],de.prototype,"type",void 0),(0,n._)([(0,l.MZ)(re((0,s.o8)(R.B)))],de.prototype,"useViewTime",void 0),(0,n._)([(0,l.MZ)({type:Boolean,json:{name:"visibility",write:oe()}})],de.prototype,"visible",void 0),de=(0,n._)([(0,d.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],de)},31175:(e,t,i)=>{i.d(t,{A:()=>c,t:()=>u});var n=i(32816),r=i(52731),s=i(99924),o=i(4734),a=i(29298),l=(i(32773),i(20266),i(88663)),d=i(69421),p=i(93804);i(41390),i(85176),i(93181),i(13671),i(50704),i(40499),i(36555),i(58498),i(91047),i(35819),i(45371),i(61532),i(80959),i(6407),i(59121),i(90740),i(84699),i(19247),i(36172),i(36544),i(48064),i(50214),i(59192),i(16345),i(54483);const u=(0,p.s)()({esriTimeUnitsMilliseconds:"milliseconds",esriTimeUnitsSeconds:"seconds",esriTimeUnitsMinutes:"minutes",esriTimeUnitsHours:"hours",esriTimeUnitsDays:"days",esriTimeUnitsWeeks:"weeks",esriTimeUnitsMonths:"months",esriTimeUnitsYears:"years",esriTimeUnitsDecades:"decades",esriTimeUnitsCenturies:"centuries",esriTimeUnitsUnknown:void 0});let c=class extends((0,r.O)(s.o)){constructor(e){super(e),this.unit="milliseconds",this.value=0}toMilliseconds(){return(0,o.c)(this.value,this.unit,"milliseconds")}};(0,n._)([(0,l.e)(u,{nonNullable:!0})],c.prototype,"unit",void 0),(0,n._)([(0,a.MZ)({type:Number,json:{write:!0},nonNullable:!0})],c.prototype,"value",void 0),c=(0,n._)([(0,d.$)("esri.time.TimeInterval")],c)},35619:(e,t,i)=>{i.d(t,{A:()=>y});var n=i(32816),r=i(52731),s=i(99924),o=i(29298),a=(i(32773),i(20266),i(49877)),l=i(69421),d=i(56273),p=i(58194),u=i(31175),c=i(78016);function h(e,t){return u.A.fromJSON({value:e,unit:t})}i(41390),i(85176),i(93181),i(13671),i(50704),i(40499),i(36555),i(58498),i(91047),i(35819),i(45371),i(61532),i(80959),i(6407),i(59121),i(19247),i(36172),i(36544),i(90740),i(84699),i(48064),i(4734),i(50214),i(93804),i(59192),i(16345),i(54483),i(88663);let y=class extends((0,r.O)(s.o)){constructor(e){super(e),this.cumulative=!1,this.endField=null,this.fullTimeExtent=null,this.hasLiveData=!1,this.interval=null,this.startField=null,this.timeZone=null,this.trackIdField=null,this.useTime=!0,this.stops=null}readFullTimeExtent(e,t){return t.timeExtent&&Array.isArray(t.timeExtent)&&2===t.timeExtent.length?p.A.fromArray(t.timeExtent):null}writeFullTimeExtent(e,t){null!=e?.start&&null!=e.end?t.timeExtent=e.toArray():t.timeExtent=null}readInterval(e,t){return t.timeInterval&&t.timeIntervalUnits?h(t.timeInterval,t.timeIntervalUnits):t.defaultTimeInterval&&t.defaultTimeIntervalUnits?h(t.defaultTimeInterval,t.defaultTimeIntervalUnits):null}writeInterval(e,t){t.timeInterval=e?.toJSON().value??null,t.timeIntervalUnits=e?.toJSON().unit??null}};(0,n._)([(0,o.MZ)({type:Boolean,json:{name:"exportOptions.timeDataCumulative",write:!0}})],y.prototype,"cumulative",void 0),(0,n._)([(0,o.MZ)({type:String,json:{name:"endTimeField",write:{enabled:!0,allowNull:!0}}})],y.prototype,"endField",void 0),(0,n._)([(0,o.MZ)({type:p.A,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"fullTimeExtent",void 0),(0,n._)([(0,a.r)("fullTimeExtent",["timeExtent"])],y.prototype,"readFullTimeExtent",null),(0,n._)([(0,d.w)("fullTimeExtent")],y.prototype,"writeFullTimeExtent",null),(0,n._)([(0,o.MZ)({type:Boolean,json:{write:!0}})],y.prototype,"hasLiveData",void 0),(0,n._)([(0,o.MZ)({type:u.A,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"interval",void 0),(0,n._)([(0,a.r)("interval",["timeInterval","timeIntervalUnits","defaultTimeInterval","defaultTimeIntervalUnits"])],y.prototype,"readInterval",null),(0,n._)([(0,d.w)("interval")],y.prototype,"writeInterval",null),(0,n._)([(0,o.MZ)({type:String,json:{name:"startTimeField",write:{enabled:!0,allowNull:!0}}})],y.prototype,"startField",void 0),(0,n._)([(0,o.MZ)((0,c.t)("timeReference",!0))],y.prototype,"timeZone",void 0),(0,n._)([(0,o.MZ)({type:String,json:{write:{enabled:!0,allowNull:!0}}})],y.prototype,"trackIdField",void 0),(0,n._)([(0,o.MZ)({type:Boolean,json:{name:"exportOptions.useTime",write:!0}})],y.prototype,"useTime",void 0),(0,n._)([(0,o.MZ)({type:[Date],json:{read:!1}})],y.prototype,"stops",void 0),y=(0,n._)([(0,l.$)("esri.layers.support.TimeInfo")],y)},38093:(e,t,i)=>{i.d(t,{d:()=>l});var n=i(32773),r=i(20266),s=i(44864),o=i(79875),a=i(30011);function l(){return{fields:{type:[s.A],value:null,set:function(e){if(e&&(0,n.h)("big-integer-warning-enabled")){const t=e.filter(e=>"big-integer"===e.type||"oid"===e.type&&(e.length||0)>=8);if(t.length){const e=t.map(e=>`'${e.name}'`).join(", ");r.L.getLogger(this).warn("#fields",`Layer (title: '${this.title??"no title"}', id: '${this.id??"no id"}') references big-integer field(s): ${e}, support for which is experimental. Only integers less than ${Number.MAX_SAFE_INTEGER} (Number.MAX_SAFE_INTEGER) are supported.`)}}this._set("fields",e)}},fieldsIndex:{readOnly:!0,get(){return o.A.fromLayer(this)}},outFields:{type:[String],json:{read:!1},set:function(e){this._userOutFields=e,this.notifyChange("outFields")},get:function(){const e=this._userOutFields;if(!e?.length)return null;if(e.includes("*"))return["*"];if(!this.fields)return e;for(const t of e){const i=this.fieldsIndex?.has(t);i||r.L.getLogger("esri.layers.support.fieldProperties").error("field-attributes-layer:invalid-field",`Invalid field ${t} found in outFields`,{layer:this,outFields:e})}return(0,a.DB)(this.fieldsIndex,e)}}}}},42614:(e,t,i)=>{i.d(t,{B:()=>a});var n=i(32773),r=i(11721),s=i(48402);const o={minX:0,minY:0,maxX:0,maxY:0};class a{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new r.P(9,(0,n.h)("esri-csp-restrictions")?e=>({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const e=new Array(this._idByBounds.size);let t=0;this._idByBounds.forEach((i,n)=>{e[t++]=n}),this._indexInvalid=!1,this._index.clear(),this._index.load(e)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(e=>this._idByBounds.has(e))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const e=(0,s.e)();for(const t of this._boundsById.values())t&&(e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),e[2]=Math.max(t[2],e[2]),e[3]=Math.max(t[3],e[3]));return e}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(e){const t=this._boundsById.get(e);this._boundsById.delete(e),t&&(this._idByBounds.delete(t),this._indexInvalid||this._index.remove(t))}forEachInBounds(e,t){this._loadIndex(),function(e,t,i){!function(e){o.minX=e[0],o.minY=e[1],o.maxX=e[2],o.maxY=e[3]}(t),e.search(o,i)}(this._index,e,e=>t(this._idByBounds.get(e)))}get(e){return this._boundsById.get(e)}has(e){return this._boundsById.has(e)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(e,t){if(!this._indexInvalid){const t=this._boundsById.get(e);t&&(this._index.remove(t),this._idByBounds.delete(t))}this._boundsById.set(e,t),t&&(this._idByBounds.set(t,e),this._indexInvalid||(this._boundsToLoad.push(t),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},49197:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(32816),r=i(29298),s=(i(32773),i(20266),i(69421)),o=i(7969),a=i(56833);i(36544),i(85176),i(93181),i(13671),i(40499),i(6407),i(59121),i(90740),i(84699),i(50704),i(91047),i(48064),i(41390),i(36555),i(58498),i(35819),i(45371),i(61532),i(80959),i(19247),i(36172),i(99924),i(69763),i(93804),i(96221),i(18683),i(64604),i(29512),i(99063),i(1178),i(56273);let l=class extends a.A{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,n._)([(0,r.MZ)()],l.prototype,"bindParameters",void 0),(0,n._)([(0,r.MZ)()],l.prototype,"bindGeometryQuantizationParameters",void 0),(0,n._)([(0,r.MZ)()],l.prototype,"outputQuantizationParameters",void 0),(0,n._)([(0,r.MZ)({type:o.A})],l.prototype,"outputSpatialReference",void 0),(0,n._)([(0,r.MZ)()],l.prototype,"provenanceBehavior",void 0),l=(0,n._)([(0,s.$)("esri.rest.knowledgeGraph.GraphQueryStreaming")],l)},53104:(e,t,i)=>{i.d(t,{a:()=>u,b:()=>d,c:()=>o,d:()=>c});var n=i(32773),r=i(70648),s=i(25018);function o(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?s.d:"esriGeometryPolyline"===e?s.a:s.b}}}const a=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let l=1;function d(e,t){if((0,n.h)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let i=`this${p(t)} = null;`;for(const t in e)i+=`this${p(t)} = ${JSON.stringify(e[t])};`;const n=new Function(`\n      return class AttributesClass$${l++} {\n        constructor() {\n          ${i};\n        }\n      }\n    `)();return()=>new n}catch(i){return()=>({[t]:null,...e})}}function p(e){return a.test(e)?`.${e}`:`["${e}"]`}function u(e={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,n.o8)(e)}}]}function c(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:r.a,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:r.q,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},56184:(e,t,i)=>{i.d(t,{A:()=>o});var n,r=i(99032),s=i(79022);i(32816),i(20266),i(90740),i(32773),i(59121),i(84699),i(6407),i(69421),i(50704),i(40499),i(93181),i(13671),i(91047),i(36544),i(48064);class o extends r.A{static{n=s.a}constructor(e){super(),this[n]=!0,this.type="knowledge-graph",this.sublayer=e}get layer(){return this.sublayer.parent}}},56833:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(32816),r=i(41390),s=i(29298),o=(i(32773),i(20266),i(69421));i(85176),i(93181),i(13671),i(50704),i(40499),i(36555),i(58498),i(91047),i(35819),i(45371),i(61532),i(80959),i(6407),i(59121),i(19247),i(36172),i(36544),i(90740),i(84699),i(48064);let a=class extends r.A{constructor(e){super(e),this.openCypherQuery=""}};(0,n._)([(0,s.MZ)()],a.prototype,"openCypherQuery",void 0),a=(0,n._)([(0,o.$)("esri.rest.knowledgeGraph.GraphQuery")],a)},69448:(e,t,i)=>{i.d(t,{B:()=>c,e:()=>h});var n=i(32816),r=i(29298),s=(i(32773),i(20266),i(49877)),o=i(69421),a=i(82530),l=i(30011),d=i(35619),p=i(31175),u=i(58194);i(36544),i(85176),i(93181),i(13671),i(40499),i(6407),i(59121),i(90740),i(84699),i(50704),i(91047),i(48064),i(54483),i(52731),i(41390),i(36555),i(58498),i(35819),i(45371),i(61532),i(80959),i(19247),i(36172),i(99924),i(56273),i(78016),i(16345),i(4734),i(50214),i(93804),i(59192),i(88663);const c={type:Boolean,json:{read:{source:"timeAnimation"},write:{target:"timeAnimation",layerContainerTypes:a.e}}},h=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.timeExtent=null,this.timeOffset=null,this.useViewTime=!0}readOffset(e,t){const i=t.timeInfo.exportOptions;if(!i)return null;const n=i.timeOffset,r=p.t.fromJSON(i.timeOffsetUnits);return n&&r?new p.A({value:n,unit:r}):null}set timeInfo(e){(0,l.sv)(e,this.fieldsIndex),this._set("timeInfo",e)}};return(0,n._)([(0,r.MZ)({type:u.A,json:{write:!1}})],i.prototype,"timeExtent",void 0),(0,n._)([(0,r.MZ)({type:p.A})],i.prototype,"timeOffset",void 0),(0,n._)([(0,s.r)("service","timeOffset",["timeInfo.exportOptions"])],i.prototype,"readOffset",null),(0,n._)([(0,r.MZ)({value:null,type:d.A,json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],i.prototype,"timeInfo",null),(0,n._)([(0,r.MZ)(c)],i.prototype,"useViewTime",void 0),i=(0,n._)([(0,o.$)("esri.layers.mixins.TemporalLayer")],i),i}},71361:(e,t,i)=>{i.d(t,{c:()=>a,g:()=>s,i:()=>o});var n=i(16699),r=i(69763);function s(e,t){const i=t||e.extent,n=e.width,s=(0,r.m)(i?.spatialReference);return i&&n?i.width/n*s*r.J*96:0}function o(e,t,i){return function(e,t){return 0===t||(0,n.f)(e,t)||e<t}(e,t)&&function(e,t){return 0===t||(0,n.f)(e,t)||e>t}(e,i)}function a(e,t){return(0,n.f)(e,t)?0:(e||Number.POSITIVE_INFINITY)>(t||Number.POSITIVE_INFINITY)?1:-1}},72076:(e,t,i)=>{i.d(t,{O:()=>o});var n=i(32816),r=(i(20266),i(32773),i(6407),i(69421)),s=i(89754);let o=class extends s.A{constructor(e){super(e)}};o=(0,n._)([(0,r.$)("esri.rest.knowledgeGraph.ObjectValue")],o)},74285:(e,t,i)=>{i.d(t,{Dp:()=>p,FJ:()=>d,KV:()=>u});var n=i(32816),r=i(59121),s=i(29298),o=(i(32773),i(20266),i(69421)),a=i(82530),l=i(91028);i(36544),i(85176),i(93181),i(13671),i(40499),i(6407),i(90740),i(84699),i(50704),i(91047),i(48064),i(52731),i(41390),i(36555),i(58498),i(35819),i(45371),i(61532),i(80959),i(19247),i(36172),i(17745),i(81272),i(44945),i(99924),i(56273),i(71361),i(16699),i(69763),i(93804),i(96221),i(18683),i(64604),i(29512),i(99063),i(1178),i(86688),i(93049),i(64035);const d=e=>{const t=e;let i=class extends t{constructor(){super(...arguments),this.displayFilterEnabled=!0,this.displayFilterInfo=null}};return(0,n._)([(0,s.MZ)(p)],i.prototype,"displayFilterEnabled",void 0),(0,n._)([(0,s.MZ)(u)],i.prototype,"displayFilterInfo",void 0),i=(0,n._)([(0,o.$)("esri.layers.mixins.DisplayFilteredLayer")],i),i},p={type:Boolean,json:{name:"layerDefinition.disableDisplayFilter",read:{reader:e=>!e},write:{layerContainerTypes:a.e,writer(e,t,i){(0,r.s)(i,!e,t)}},origins:{"web-scene":{write:!1,read:!1}}}},u={type:l.A,json:{name:"layerDefinition.displayFilterInfo",write:{enabled:!0,allowNull:!0,layerContainerTypes:a.e},origins:{"web-scene":{write:!1,read:!1}}}}},76999:(e,t,i)=>{i.d(t,{A:()=>l});var n=i(32816),r=i(29298),s=(i(32773),i(20266),i(69421)),o=i(67504),a=i(10043);i(36544),i(85176),i(93181),i(13671),i(40499),i(6407),i(59121),i(90740),i(84699),i(50704),i(91047),i(48064),i(56273),i(44600),i(2160),i(99924),i(41390),i(36555),i(58498),i(35819),i(45371),i(61532),i(80959),i(19247),i(36172),i(49877),i(7969),i(69763),i(93804),i(96221),i(18683),i(64604),i(29512),i(99063),i(1178),i(64752),i(48844),i(29208),i(18169),i(20762),i(48402),i(16699),i(89754);let l=class extends a.A{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,n._)([(0,r.MZ)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,n._)([(0,r.MZ)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,n._)([(0,r.MZ)({type:o.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,n._)([(0,s.$)("esri.rest.knowledgeGraph.Relationship")],l)},79022:(e,t,i)=>{i.d(t,{a:()=>n});const n=Symbol("isKnowledgeGraphGraphicOriginSymbol")},86688:(e,t,i)=>{i.d(t,{A:()=>p});var n=i(32816),r=i(52731),s=i(99924),o=i(93049),a=i(29298),l=(i(32773),i(20266),i(69421));i(41390),i(85176),i(93181),i(13671),i(50704),i(40499),i(36555),i(58498),i(91047),i(35819),i(45371),i(61532),i(80959),i(6407),i(59121),i(19247),i(36172),i(36544),i(90740),i(84699),i(48064);const d={write:{overridePolicy:(e,t,i)=>({enabled:!i||"scale"===i.filterMode})}};let p=class extends((0,r.O)(s.o)){constructor(e){super(e),this.id=(0,o.g)(),this.maxScale=0,this.minScale=0,this.title="",this.where=null}};(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"id",void 0),(0,n._)([(0,a.MZ)({type:Number,json:d})],p.prototype,"maxScale",void 0),(0,n._)([(0,a.MZ)({type:Number,json:d})],p.prototype,"minScale",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"title",void 0),(0,n._)([(0,a.MZ)({type:String,json:{write:!0}})],p.prototype,"where",void 0),p=(0,n._)([(0,l.$)("esri.layers.support.DisplayFilter")],p)},89754:(e,t,i)=>{i.d(t,{A:()=>a});var n=i(32816),r=i(99924),s=i(29298),o=(i(32773),i(20266),i(69421));i(41390),i(85176),i(93181),i(13671),i(50704),i(40499),i(36555),i(58498),i(91047),i(35819),i(45371),i(61532),i(80959),i(6407),i(59121),i(19247),i(36172),i(36544),i(90740),i(84699),i(48064);let a=class extends r.o{constructor(e){super(e),this.properties=null}};(0,n._)([(0,s.MZ)({json:{write:!0}})],a.prototype,"properties",void 0),a=(0,n._)([(0,o.$)("esri.rest.knowledgeGraph.GraphObject")],a)},90426:(e,t,i)=>{i.d(t,{L:()=>w,c:()=>M,d:()=>T,e:()=>f,f:()=>b,h:()=>_,i:()=>g,j:()=>m,k:()=>y,l:()=>p,u:()=>v}),i(27281);var n=i(6407),r=(i(64752),i(84200),i(67504),i(41658),i(44600),i(2160),i(36533),i(20266),i(47239),i(32773),i(16699),i(18683)),s=i(4718),o=i(43551),a=i(49197);i(85232),i(54512),i(19648);let l,d=null;function p(){return l||(l=i.e(8269).then(i.bind(i,8269)).then(e=>e.l).then(({default:e})=>e({locateFile:e=>(0,r.g)(`esri/libs/linkchartlayout/${e}`)})).then(e=>{d=e}),l)}const u={right:0,left:1,top:2,bottom:3},c={none:0,"start-only":1,"start-and-end":2};function h(e,t,i,n,r,s){const o=i.length,a=r.length,l=Float64Array.BYTES_PER_ELEMENT,p=Uint32Array.BYTES_PER_ELEMENT,u=Uint8Array.BYTES_PER_ELEMENT,c=16+o*(u+2*l)+a*(2*p),h=d._malloc(c);try{const u=h+16-h%16,c=u+o*l,y=c+o*l,m=y+a*p,f=m+a*p,g=()=>[d.HEAPF64.subarray(u>>3,(u>>3)+o),d.HEAPF64.subarray(c>>3,(c>>3)+o),d.HEAPU32.subarray(y>>2,(y>>2)+a),d.HEAPU32.subarray(m>>2,(m>>2)+a),d.HEAPU8.subarray(f,f+o)],[_,b,w,I,T]=g();_.set(i),b.set(n),w.set(r),I.set(s),T.set(t);const M=e(o,f,u,c,a,y,m);let v=null,x=null;if(0===M.value){const e=d.getLayoutLinksTypes(),t=d.getLayoutLinksVerticesEndIndices(),i=d.getLayoutLinksVertices(),n=d.countLayoutLinksVertices();!a||e&&t?n&&!i?M.value=1:(v={types:new Uint8Array(d.HEAPU8.subarray(e,e+a)),vertexEndIndex:new Uint32Array(d.HEAPU32.subarray(t>>2,(t>>2)+a)),vertices:new Float64Array(d.HEAPF64.subarray(i>>3,(i>>3)+2*n))},x=d.getAuxiliaryGraphicElements()):M.value=1}const[E,S,A,N,L]=g();return i.set(E),n.set(S),r.set(A),s.set(N),t.set(L),{status:M.value,links:v,graphics:x}}finally{d._free(h),d.cleanupLayout()}}var y,m,f,g,_,b,w,I;async function T(e,t,i){const n=[],r=function(e,t){const i=new Map;if(t.dataModel?.relationshipTypes)for(const e of t.dataModel.relationshipTypes)e.name&&i.set(e.name,[]);for(const t of e)i.has(t.typeName)&&i.get(t.typeName)?.push(t.id);return i}(e,t),s={},l=[];for(const[e,t]of r){if(t.length<1)continue;const i=`${e}_ids`;s[i]=t,l.push(`MATCH (n)-[r:${e}]->(m) WHERE id(r) in $${i} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(0===l.length)return[];const d=l.join(" UNION "),p=new a.A({openCypherQuery:d,bindParameters:s}),u=(await(0,o.executeQueryStreaming)(t,p,i?.requestOptions)).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await u.read();if(e)break;for(const e of t)n.push({id:e[0],typeName:e[1]}),n.push({id:e[2],typeName:e[3]})}return n}(I=y||(y={})).getMinIdealEdgeLength=function(){return d.getMinIdealEdgeLength()},I.apply=function(e,t,i,n,r,s,o=2,a=1,l=-1){return h((t,i,n,r,s,p,u)=>d.applyForceDirectedLayout(e,t,i,n,r,s,p,u,o,a,l),t,i,n,r,s)},function(e){e.apply=function(e,t,i,n,r,s,o=2,a=1,l=-1){return h((t,i,n,r,s,p,u)=>d.applyCommunityLayout(e,t,i,n,r,s,p,u,o,a,l),t,i,n,r,s)}}(m||(m={})),function(e){e.apply=function(e,t,i,n,r,s){return h((t,i,n,r,s,o,a)=>d.applySimpleLayout(e,t,i,n,r,s,o,a),t,i,n,r,s)}}(f||(f={})),function(e){e.apply=function(e,t,i,n,r,s){return h((t,i,n,r,s,o,a)=>d.applyHierarchicalLayout(e,t,i,n,r,s,o,a),t,i,n,r,s)}}(g||(g={})),function(e){e.apply=function(e,t,i,n,r,s){return h((t,i,n,r,s,o,a)=>d.applyRadialTreeLayout(e,t,i,n,r,s,o,a),t,i,n,r,s)}}(_||(_={})),function(e){e.apply=function(e,t,i,n,r,s){return h((t,i,n,r,s,o,a)=>d.applySmartTreeLayout(e,t,i,n,r,s,o,a),t,i,n,r,s)}}(b||(b={})),function(e){e.apply=function(e,t,i,n,r,s,o,a,l,p,y,m){return h((t,i,n,o,a,h,f)=>{if(r.length!==t)return{value:1};if(s.length!==t)return{value:1};if(l.length!==a)return{value:1};if(p.length!==a)return{value:1};const g=Float64Array.BYTES_PER_ELEMENT,_=16,b=d._malloc(_+t*g),w=d._malloc(_+t*g),I=d._malloc(_+a*g),T=d._malloc(_+a*g),M=b+_-b%_,v=w+_-w%_,x=I+_-I%_,E=T+_-T%_;try{return d.HEAPF64.subarray(M>>3,(M>>3)+t).set(r),d.HEAPF64.subarray(v>>3,(v>>3)+t).set(s),d.HEAPF64.subarray(x>>3,(x>>3)+a).set(l),d.HEAPF64.subarray(E>>3,(E>>3)+a).set(p),d.applyChronologicalLayout(e,t,i,n,o,M,v,a,h,f,x,E,y,function(e){const t={timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0,...e?.toJSON()??{},eventsTicksVisualization:e?.eventsTicksVisualization??"start-and-end"};return{...t,timeDirection:{value:u[t.timeDirection]??u.right},eventsTicksVisualization:{value:c[t.eventsTicksVisualization]??c["start-and-end"]}}}(m))}finally{d._free(b),d._free(w),d._free(I),d._free(T)}},t,i,n,o,a)}}(w||(w={}));const M=e=>s.a.get(e)??"radial-root-centric";function v(e){if(!e.spatialReference.isWGS84)throw new n.A("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}},91028:(e,t,i)=>{i.d(t,{A:()=>h});var n=i(32816),r=i(52731),s=i(17745),o=i(99924),a=i(29298),l=(i(32773),i(20266),i(69421)),d=i(56273),p=i(71361),u=i(86688),c=i(64035);i(41390),i(85176),i(93181),i(13671),i(50704),i(40499),i(36555),i(58498),i(91047),i(35819),i(45371),i(61532),i(80959),i(6407),i(59121),i(19247),i(36172),i(36544),i(90740),i(84699),i(48064),i(81272),i(44945),i(16699),i(69763),i(93804),i(96221),i(18683),i(64604),i(29512),i(99063),i(1178),i(93049);let h=class extends((0,r.O)(o.o)){constructor(e){super(e),this.activeFilterId=null,this.filters=new(s.A.ofType(u.A)),this.mode="manual"}writeFilters(e,t,i,n){const r=e.toArray();"scale"===this.mode&&r.sort((e,t)=>{const i=(0,p.c)(t.minScale,e.minScale),n=e.maxScale-t.maxScale;return 0===i?n:i}),t[i]=r.map(e=>e.toJSON(n))}write(e,t){return super.write(e,(0,c.c)(this,t))}};(0,n._)([(0,a.MZ)({type:String,json:{write:{overridePolicy:(e,t,i)=>({enabled:"manual"===i.filterMode,isRequired:!0})}}})],h.prototype,"activeFilterId",void 0),(0,n._)([(0,a.MZ)({type:s.A.ofType(u.A),nonNullable:!0,json:{write:!0}})],h.prototype,"filters",void 0),(0,n._)([(0,d.w)("filters")],h.prototype,"writeFilters",null),(0,n._)([(0,a.MZ)({type:["manual","scale"],nonNullable:!0,json:{name:"filterMode",write:!0}})],h.prototype,"mode",void 0),h=(0,n._)([(0,l.$)("esri.layers.support.DisplayFilterInfo")],h)},93787:(e,t,i)=>{i.d(t,{c:()=>F,f:()=>S,s:()=>A});var n=i(64604),r=i(6407),s=i(93217),o=(i(83637),i(96153)),a=i(7969),l=i(43551),d=i(59121);class p{constructor(){this.version="",this.queryResult=new u}}class u{constructor(){this.featureResult=new c}}class c{constructor(){this.objectIdFieldName="",this.uniqueIdField=new h,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new y,this.geometryType=null,this.spatialReference=new a.A,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new m,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}}class h{constructor(){this.name="",this.isSystemMaintained=!1}}class y{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}}class m{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new f,this.translate=new g}}class f{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}}class g{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}}class _{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}}class b{constructor(){this.attributes=[],this.compressedGeometry=new w,this.centroid=new w,this.aggregateGeometries=[]}}class w{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}}const I=["ELEMENTUID","TYPENAME"],T={upperLeft:0,lowerLeft:1},M={sqlTypeBigInt:0,sqlTypeBinary:1,sqlTypeBit:2,sqlTypeChar:3,sqlTypeDate:4,sqlTypeDecimal:5,sqlTypeDouble:6,sqlTypeFloat:7,sqlTypeGeometry:8,sqlTypeGUID:9,sqlTypeInteger:10,sqlTypeLongNVarchar:11,sqlTypeLongVarbinary:12,sqlTypeLongVarchar:13,sqlTypeNChar:14,sqlTypeNVarChar:15,sqlTypeOther:16,sqlTypeReal:17,sqlTypeSmallInt:18,sqlTypeSqlXml:19,sqlTypeTime:20,sqlTypeTimestamp:21,sqlTypeTimestamp2:22,sqlTypeTinyInt:23,sqlTypeVarbinary:24,sqlTypeVarchar:25};function v(e){const t=new w;t.geometryType=(0,d.a)(l.E,e.geometry_type.value);const i=[],n=[];for(let t=0;t<e.lengths.length;t++)i.push(e.lengths[t]);for(let t=0;t<e.coords.length;t++)n.push(e.coords[t]);return t.lengths=i,t.coords=n,t}function x(e){const t=new _;return t.name=e.name,t.alias=e.alias,t.fieldType=(0,d.a)(l.a,e.field_type.value),t.sqlType=(0,d.a)(M,e.sql_type.value),t.domain=e.domain,t.defaultValue=e.default_value,t}function E(e){const t=x(e);return t.geometryType=(0,d.a)(l.E,e.geometry_type.value),t}async function S(e,t){t??=!1;const i={generateAllSublayers:t,namedTypeDefinitions:new Map};return await async function(e){const t=await(0,n.A)(e,{responseType:"array-buffer"}),i=await t.data;return async function(e){const t=new((await(0,l.g)()).MapOfObjectIdentifierSetsDecoder),i=t.decode(new Uint8Array(e)),n=new Map;if(0!==i.error_code)throw new r.A("knowledge-graph:layer-support-utils",i.error_message);const s=t.get_map_of_identifier_sets(),o=s.keys,a=o.size();for(let e=0;e<a;e++){const t=o.get(e),i=s.query_identifier_set(t),a=[];if(1===i.id_array_type.value){const e=i.get_globalid_array(),t=e.count();for(let i=0;i<t;i++)a.push(e.get_globalid_at(i))}else if(3===i.id_array_type.value){const e=i.get_identifier_array(),t=e.count();for(let i=0;i<t;i++)a.push(e.get_identifier_at(i).toString())}else if(2===i.id_array_type.value){const e=i.get_string_array(),t=e.count();for(let i=0;i<t;i++)a.push(e.get_string_at(i))}else{if(0!==i.id_array_type.value)throw new r.A("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=i.get_oid_array(),t=e.count();for(let i=0;i<t;i++)a.push(e.get_objectid_at(i).toString())}}n.set(t,a)}return t.delete(),n}(new Uint8Array(i))}(e).then(e=>{!function(e,t){for(const[i,n]of e){const e=(0,s.g)(t.namedTypeDefinitions,i,()=>({useAllData:!1,members:new Map}));for(const t of n)e.members.has(t)||e.members.set(t,{id:t})}}(e,i)}),i}async function A(e){const t=await(0,l.g)(),i=new t.MapOfObjectIdentifierSets;!function(e,t,i){for(const[n,r]of i.namedTypeDefinitions){if(!r.members||r.useAllData)continue;const i=r.members.keys();let s=!1,o=!0;const a=new t.ObjectIdArray,l=new t.StringArray,d=new t.GlobalIdArray,p=new t.IdentifierArray,u=new t.ObjectIdentifierSet;for(const e of i)o&&(s=!isNaN(Number(e)),o=!1),s?a.add_objectid(Number(e)):(l.add_string(e),d.add_globalid(e)),p.add_identifier(e);u.set_oid_array(a),u.set_string_array(l),u.set_globalid_array(d),u.set_identifier_array(p),a.delete(),l.delete(),d.delete(),p.delete(),e.put_identifier_set(n,u),u.delete()}}(i,t,e);const n=new t.MapOfObjectIdentifierSetsEncoder;try{n.set_map_of_identifier_sets(i),n.encode();const e=n.get_encoding_result();if(0!==e.error.error_code)throw new r.A("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return n.delete(),t}finally{i.delete()}}async function N(e){const t=await(0,n.A)(e,{responseType:"array-buffer"});return async function(e){const t=new((await(0,l.g)()).FeatureCollectionDecoder),i=t.decode(new Uint8Array(e));if(0!==i.error_code)throw new r.A("knowledge-graph:layer-support-utils",i.error_message);const n=function(e){const t=new p;t.version=e.version;const i=e.get_query_result();if(0!==i.results_type.value)throw new Error("Got a non-feature collection type");const n=i.get_feature_result(),r=t.queryResult.featureResult;r.objectIdFieldName=n.objectid_field_name,r.exceededTransferLimit=n.exceeded_transfer_limit,r.hasM=n.has_m,r.hasZ=n.has_z,r.geometryType=(0,d.a)(l.E,n.geometry_type.value),r.globalIdFieldName=n.globalid_field_name,r.geohashFieldName=n.geohash_field_name;const s=r.uniqueIdField,o=n.unique_id_field;s.name=o.name,s.isSystemMaintained=o.isSystemMaintained;const a=r.geometryProperties,u=n.geometry_properties;a.shapeAreaFieldName=u.shapeAreaFieldName,a.shapeLengthFieldName=u.shapeLengthFieldName,a.units=u.units;const c=r.spatialReference,h=n.spatial_reference;c.wkid=h.wkid,c.latestWkid=h.latestWkid,c.vcsWkid=h.vcsWkid,c.latestVcsWkid=h.latestVcsWkid,c.wkt=h.wkt,r.transform=function(e){const t=new m;t.quantizeOriginPosition=(0,d.a)(T,e.quantizeOriginPosition.value);const i=t.scale,n=e.scale;i.xScale=n.xScale,i.yScale=n.yScale,i.mScale=n.mScale,i.zScale=n.zScale;const r=t.translate,s=e.translate;return r.xTranslate=s.xTranslate,r.yTranslate=s.yTranslate,r.mTranslate=s.mTranslate,r.zTranslate=s.zTranslate,t}(n.transform);const y=r.fields,f=r.fieldNameToAttributeIndexMap,g=n.fields,_=g.size();for(let e=0;e<_;e++){const t=g.get(e),i=x(t);y.push(i),f[i.name]=e,t.delete()}g.delete();const w=r.values,M=n.values_count();for(let e=0;e<M;e++)w.push(n.get_value_at(e));const S=r.features,A=n.features,N=A.size();if(N>0)for(const e of I)if(void 0===f[e])throw new Error(`Feature collection missing required attribute: ${e}`);for(let e=0;e<N;e++){const t=new b,i=A.get(e),n=t.attributes,r=i.attributes_count();for(let e=0;e<r;e++)n.push(i.get_attribute_at(e));const s=i.get_compressed_geometry();s&&(t.compressedGeometry=v(s),t.centroid=v(i.get_centroid()));const o=t.aggregateGeometries,a=i.aggregate_geometries,l=a.size();for(let e=0;e<l;e++){const t=a.get(e),i=v(t);o.push(i),t.delete()}a.delete(),S.push(t),i.delete()}A.delete();const L=r.geometryFields,F=n.geometry_fields,k=F.size();for(let e=0;e<k;e++){const t=F.get(e),i=E(t);L.push(i),t.delete()}return F.delete(),t}(t.get_feature_collection());return t.delete(),n}(await t.data)}function L(e,t){if(!e?.queryResult?.featureResult)return t;const i=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const n of e.queryResult.featureResult.features){const e=n.attributes[i.TYPENAME],r=(0,s.g)(t.namedTypeDefinitions,e,()=>({useAllData:!1,members:new Map})),a=n.attributes[i.ELEMENTUID];if(n.compressedGeometry?.coords?.length>0){let e=n.compressedGeometry.lengths;"esriGeometryPoint"===n.compressedGeometry.geometryType&&(e=[]),r.members.set(a,{id:a,linkChartLocation:new o.O(e,n.compressedGeometry.coords)})}else r.members.set(a,{id:a})}return t}const F={fetchAndConvertSerializedLinkChart:e=>async function(e){const t=[],i={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(N(e.entitiesUrl).then(e=>{L(e,i)})),e.relationshipsUrl&&t.push(N(e.relationshipsUrl).then(e=>{L(e,i)})),await Promise.all(t),i}(e)}},94531:(e,t,i)=>{i.d(t,{a:()=>s,b:()=>n,c:()=>l,d:()=>o,e:()=>a,s:()=>r});const n="ESRI__ID",r="ESRI__OriginID",s="ESRI__DestID",o="ESRI__LayoutGeometry",a="ESRI__AggregationCount",l="LC.ESRI__IsSpatial"}}]);