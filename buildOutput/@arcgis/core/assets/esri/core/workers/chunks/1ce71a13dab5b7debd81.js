"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[9268],{14141:(t,e,n)=>{n.d(e,{a:()=>i,c:()=>a,g:()=>d});var r=n(32773),l=n(20266),o=(n(16699),n(80959));n(44600),n(69763);const s=()=>l.L.getLogger("esri.views.2d.engine.flow.dataUtils");async function i(t,e,n,l){const i=performance.now(),c=a(e,n),u=performance.now(),f=d(e,c,n.width,n.height),h=performance.now(),g=function(t){const e=new r.R,n=t.reduce((t,e)=>t+e.length,0),l=new Float32Array(5*n),o=new Array(t.length);let s=0,i=0;for(const n of t){const t=s;for(const t of n)l[5*s]=t.x,l[5*s+1]=t.y,l[5*s+2]=t.t,l[5*s+3]=t.speed,l[5*s+4]=t.colorTime,s++;o[i++]={startVertex:t,numberOfVertices:n.length,totalTime:n[n.length-1].t,timeSeed:e.getFloat()}}return{lineVertices:l,lineDescriptors:o}}(f),m=performance.now(),w="Streamlines"===t?function(t){const{lineVertices:e,lineDescriptors:n}=t;let r=0,l=0;for(const t of n)r+=2*t.numberOfVertices,l+=6*(t.numberOfVertices-1);const o=new Float32Array(10*r),s=new Uint32Array(l);let i=0,a=0;function c(){s[a++]=i-2,s[a++]=i,s[a++]=i-1,s[a++]=i,s[a++]=i+1,s[a++]=i-1}function u(t,e,n,r,l,s,a,c,u){const f=10*i;let h=0;o[f+h++]=t,o[f+h++]=e,o[f+h++]=1,o[f+h++]=n,o[f+h++]=s,o[f+h++]=a,o[f+h++]=r/2,o[f+h++]=l/2,o[f+h++]=c,o[f+h++]=u,i++,o[f+h++]=t,o[f+h++]=e,o[f+h++]=-1,o[f+h++]=n,o[f+h++]=s,o[f+h++]=a,o[f+h++]=-r/2,o[f+h++]=-l/2,o[f+h++]=c,o[f+h++]=u,i++}for(const t of n){const{totalTime:n,timeSeed:r}=t;let l=null,o=null,s=null,i=null,a=null,f=null,h=null;for(let d=0;d<t.numberOfVertices;d++){const g=e[5*(t.startVertex+d)],m=e[5*(t.startVertex+d)+1],w=e[5*(t.startVertex+d)+2],M=e[5*(t.startVertex+d)+3],p=e[5*(t.startVertex+d)+4];let x=null,y=null,D=null,S=null;if(d>0){x=g-l,y=m-o;const t=Math.sqrt(x*x+y*y);if(x/=t,y/=t,d>1){let t=x+f,e=y+h;const n=Math.sqrt(t*t+e*e);t/=n,e/=n;const r=Math.min(1/(t*x+e*y),10);t*=r,e*=r,D=-e,S=t}else D=-y,S=x;null!==D&&null!==S&&(u(l,o,s,D,S,n,r,M,p),c())}l=g,o=m,s=w,f=x,h=y,i=M,a=p}u(l,o,s,-h,f,n,r,i,a)}return{vertexData:o,indexData:s}}(g):function(t){const{lineVertices:e,lineDescriptors:n}=t;let r=0,l=0;for(const t of n){const e=t.numberOfVertices-1;r+=4*e*2,l+=6*e*2}const o=new Float32Array(16*r),s=new Uint32Array(l);let i,a,c,u,f,h,d,g,m,w,M,p,x,y,D=0,S=0;function V(t,e){let n=m+M,r=w+p;const l=Math.sqrt(n*n+r*r);n/=l,r/=l;const V=m*n+w*r;n/=V,r/=V;let b=M+x,F=p+y;const v=Math.sqrt(b*b+F*F);b/=v,F/=v;const T=M*b+p*F;b/=T,F/=T,function(t,e,n,r,l,s,i,a,c,u,f,h,d,g){const m=16*D;let w=0;for(const M of[1,2])for(const p of[1,2,3,4])o[m+w++]=t,o[m+w++]=e,o[m+w++]=n,o[m+w++]=r,o[m+w++]=i,o[m+w++]=a,o[m+w++]=c,o[m+w++]=u,o[m+w++]=M,o[m+w++]=p,o[m+w++]=d,o[m+w++]=g,o[m+w++]=l/2,o[m+w++]=s/2,o[m+w++]=f/2,o[m+w++]=h/2,D++}(i,a,c,u,-r,n,f,h,d,g,-F,b,t,e),s[S++]=D-8,s[S++]=D-7,s[S++]=D-6,s[S++]=D-7,s[S++]=D-5,s[S++]=D-6,s[S++]=D-4,s[S++]=D-3,s[S++]=D-2,s[S++]=D-3,s[S++]=D-1,s[S++]=D-2}function b(t,e,n,r,l,o){if(m=M,w=p,M=x,p=y,null==m&&null==w&&(m=M,w=p),null!=f&&null!=h){x=t-f,y=e-h;const n=Math.sqrt(x*x+y*y);x/=n,y/=n}null!=m&&null!=w&&V(l,o),i=f,a=h,c=d,u=g,f=t,h=e,d=n,g=r}function F(t,e){m=M,w=p,M=x,p=y,null==m&&null==w&&(m=M,w=p),null!=m&&null!=w&&V(t,e)}for(const t of n){i=null,a=null,c=null,u=null,f=null,h=null,d=null,g=null,m=null,w=null,M=null,p=null,x=null,y=null;const{totalTime:n,timeSeed:r}=t;for(let l=0;l<t.numberOfVertices;l++)b(e[4*(t.startVertex+l)],e[4*(t.startVertex+l)+1],e[4*(t.startVertex+l)+2],e[4*(t.startVertex+l)+3],n,r);F(n,r)}return{vertexData:o,indexData:s}}(g),M=performance.now();return(0,r.h)("esri-2d-profiler")&&(s().info("I.1","_createFlowFieldFromData (ms)",Math.round(u-i)),s().info("I.2","_getStreamlines (ms)",Math.round(h-u)),s().info("I.3","createAnimatedLinesData (ms)",Math.round(m-h)),s().info("I.4","create{Streamlines|Particles}Mesh (ms)",Math.round(M-m)),s().info("I.5","createFlowMesh (ms)",Math.round(M-i)),s().info("I.6","Mesh size (bytes)",w.vertexData.buffer.byteLength+w.indexData.buffer.byteLength)),await Promise.resolve(),(0,o.Te)(l),w}function a(t,e){const n=function(t,e,n,r){if(0===r)return t;const l=Math.round(3*r),o=new Array(2*l+1);let s=0;for(let t=-l;t<=l;t++){const e=Math.exp(-t*t/(r*r));o[t+l]=e,s+=e}for(let t=-l;t<=l;t++)o[t+l]/=s;const i=new Float32Array(t.length);for(let r=0;r<n;r++)for(let n=0;n<e;n++){let s=0,a=0;for(let i=-l;i<=l;i++){if(n+i<0||n+i>=e)continue;const c=o[i+l];s+=c*t[2*(r*e+(n+i))],a+=c*t[2*(r*e+(n+i))+1]}i[2*(r*e+n)]=s,i[2*(r*e+n)+1]=a}const a=new Float32Array(t.length);for(let t=0;t<e;t++)for(let r=0;r<n;r++){let s=0,c=0;for(let a=-l;a<=l;a++){if(r+a<0||r+a>=n)continue;const u=o[a+l];s+=u*i[2*((r+a)*e+t)],c+=u*i[2*((r+a)*e+t)+1]}a[2*(r*e+t)]=s,a[2*(r*e+t)+1]=c}return a}(e.data,e.width,e.height,t.smoothing);return t.interpolate?(t,r)=>{const l=Math.floor(t),o=Math.floor(r);if(l<0||l>=e.width)return[0,0];if(o<0||o>=e.height)return[0,0];const s=t-l,i=r-o,a=l,c=o,u=l<e.width-1?l+1:l,f=o<e.height-1?o+1:o,h=n[2*(c*e.width+a)],d=n[2*(c*e.width+u)],g=n[2*(f*e.width+a)],m=n[2*(f*e.width+u)],w=n[2*(c*e.width+a)+1],M=n[2*(c*e.width+u)+1];return[(h*(1-i)+g*i)*(1-s)+(d*(1-i)+m*i)*s,(w*(1-i)+n[2*(f*e.width+a)+1]*i)*(1-s)+(M*(1-i)+n[2*(f*e.width+u)+1]*i)*s]}:(t,r)=>{const l=Math.round(t),o=Math.round(r);return l<0||l>=e.width||o<0||o>=e.height?[0,0]:[n[2*(o*e.width+l)],n[2*(o*e.width+l)+1]]}}function c(t,e,n){let r=1/0,l=1;for(let o=0;o+1<n.length;o++){const s=[n[o+1][0]-n[o][0],n[o+1][1]-n[o][1]],i=[t-n[o][0],e-n[o][1]],a=Math.min(Math.max((i[0]*s[0]+i[1]*s[1])/(s[0]*s[0]+s[1]*s[1]),0),1),c=[i[0]-s[0]*a,i[1]-s[1]*a];r=Math.min(r,c[0]*c[0]+c[1]*c[1]),(e>=n[o][1]&&e<n[o+1][1]&&s[0]*i[1]>s[1]*i[0]||e<n[o][1]&&e>=n[o+1][1]&&s[0]*i[1]<=s[1]*i[0])&&(l=-l)}return l*Math.sqrt(r)}function u(t,e,n){const{geometries:r}=t;let l=1/0;for(const[t,o]of r)l=Math.min(l,c(e,n,o));return l}function f(t,e,n){const r=u(t,e,n),l=Math.max(.001,r);return Math.min(1,10/l)}function h(t,e,n,r,l,o,s,i,a,c=null){const u=[];let h=n,d=r,g=0,[m,w]=e(h,d);m*=t.velocityScale,w*=t.velocityScale;const M=Math.sqrt(m*m+w*w);let p,x;u.push({x:h,y:d,t:g,speed:M,colorTime:c??f(t,h,d)});for(let n=0;n<t.verticesPerLine;n++){let[n,r]=e(h,d);n*=t.velocityScale,r*=t.velocityScale;const m=Math.sqrt(n*n+r*r);if(m<t.minSpeedThreshold)return u;const w=n/m,M=r/m;if(h+=w*t.segmentLength,d+=M*t.segmentLength,g+=t.segmentLength/m,Math.acos(w*p+M*x)>t.maxTurnAngle)return u;if(t.collisions){const t=Math.round(h*a),e=Math.round(d*a);if(t<0||t>s-1||e<0||e>i-1)return u;const n=o[e*s+t];if(-1!==n&&n!==l)return u;o[e*s+t]=l}const y=c??Math.max(u[u.length-1].colorTime,f(t,h,d));u.push({x:h,y:d,t:g,speed:m,colorTime:y}),p=w,x=M}return u}function d(t,e,n,l){const o=[],s=new r.R,i=1/Math.max(t.lineCollisionWidth,1),a=Math.round(n*i),c=Math.round(l*i),f=new Int32Array(a*c);for(let t=0;t<f.length;t++)f[t]=-1;const d=[];for(let e=0;e<l;e+=t.lineSpacing)for(let r=0;r<n;r+=t.lineSpacing)d.push({x:r,y:e,sort:s.getFloat()});d.sort((t,e)=>t.sort-e.sort);const{verticesPerLine:g}=t;for(let{x:n,y:r}of d)if(s.getFloat()<t.density&&u(t,n,r)<10){let l=null;for(let u=0;u<20;u++){const u=h(t,e,n,r,o.length,f,a,c,i,l);if(n=u[u.length-1].x,r=u[u.length-1].y,l=u[u.length-1].colorTime,!(u.length<2||(o.push(u),u.length<7)))for(let u=0;u<20;u++){const u=s.getFloat(),d=h(t,e,n+5*t.lineSpacing*Math.cos(2*Math.PI*u),r+5*t.lineSpacing*Math.sin(2*Math.PI*u),o.length,f,a,c,i,l);d.length>=2&&o.push(d)}}}t.verticesPerLine=g;for(const{x:n,y:r}of d)if(s.getFloat()<t.density){const l=h(t,e,n,r,o.length,f,a,c,i);if(l.length<2)continue;o.push(l)}return o}},29268:(t,e,n)=>{n.r(e),n.d(e,{default:()=>a});var r=n(32816),l=(n(20266),n(32773),n(6407),n(69421)),o=n(14141),s=n(48402);n(69763),n(90740),n(59121),n(84699),n(50704),n(40499),n(93181),n(13671),n(91047),n(36544),n(48064),n(16699),n(80959),n(19247),n(44600),n(29298),n(85176),n(2160),n(99924),n(41390),n(36555),n(58498),n(35819),n(45371),n(61532),n(36172),n(49877),n(7969),n(93804),n(96221),n(18683),n(64604),n(29512),n(99063),n(1178),n(56273),n(64752),n(48844),n(29208);let i=class{constructor(){this._tileData=new Map}async generateStreamlines(t){const{flowData:e,simulationSettings:n,size:r}=t,l=c((0,o.c)(n,e),n,r);return{result:{streamlines:l},transferList:l?.map(t=>t.buffer)}}async generateTiledStreamlines(t){const{simulationSettings:e,size:n,reset:r,flowDataTiles:l,extent:i,pixelSize:a}=t;this._updateTileData(l,r);const u=c(function(t,e,n,r,l){const[i,a]=n;let c=null;const u=new Map;e.forEach(e=>{u.set(e.lij,(0,o.c)(t,e))});const f=(t,e,n)=>(0,s.g)(t.extent,e,n);return(t,n)=>{const o=Math.round(t),h=Math.round(n);if(o<0||o>=i||h<0||h>=a)return[0,0];const d=t/i*(0,s.w)(r)+r[0],g=(a-n)/a*(0,s.k)(r)+r[1];if(null==c||!f(c,d,g)){c=null;for(const[t,n]of e)if(f(n,d,g)){c=n;break}}if(null==c?.data)return[0,0];const m=u.get(c.lij);if(null==m)return[0,0];const w=c.extent;return m((d-w[0])/(0,s.w)(w)*l,l-(g-w[1])/(0,s.k)(w)*l)}}(e,this._tileData,n,i,a),e,n);return{result:{streamlines:u},transferList:u?.map(t=>t.buffer)??[]}}_updateTileData(t,e){e&&this._tileData.forEach((e,n)=>{null==t.get(n)&&this._tileData.delete(n)}),t.forEach((t,e)=>{"delete"===t?this._tileData.delete(e):"on-worker"!==t&&this._tileData.set(e,t)})}};i=(0,r._)([(0,l.$)("esri.views.3d.support.flow.FlowWorker")],i);const a=i;function c(t,e,n){if(null==t)return;const r=(0,o.g)(e,t,n[0],n[1]),l=[];for(const t of r){const e=new Float32Array(3*t.length);for(let n=0;n<t.length;n++)e[3*n]=t[n].x,e[3*n+1]=t[n].y,e[3*n+2]=t[n].t;l.push(e)}return l}}}]);