"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[4295],{20521:(e,t,r)=>{r.d(t,{L:()=>o,a:()=>f,b:()=>y,c:()=>h,d:()=>p,e:()=>i,g:()=>c,i:()=>d,l:()=>m,p:()=>u});var a=r(30861),n=r(50472),s=r(89157),l=r(23916);class o{constructor(){this._serviceMetadatas=new Map,this._itemDatas=new Map}async fetchServiceMetadata(e,t){const r=this._serviceMetadatas.get(e);if(r)return r;const n=await(0,a.f)(e,t);return this._serviceMetadatas.set(e,n),n}async fetchItemData(e){const{id:t}=e;if(!t)return null;const{_itemDatas:r}=this;if(r.has(t))return r.get(t);const a=await e.fetchData();return r.set(t,a),a}async fetchCustomParameters(e,t){const r=await this.fetchItemData(e);return r&&"object"==typeof r&&(t?t(r):r.customParameters)||null}}function i(e){const t={id:e.id,name:e.name},r=(0,s.g)(e.type);return"FeatureLayer"!==r&&(t.layerType=r),t}async function u(e,t,r){let a;if(null==e?.layers||null==e?.tables){const n=await r.fetchServiceMetadata(t,{customParameters:c(e)?.customParameters});a=(0,l.q)(),(e=e||{}).layers=e.layers||n?.layers?.map(i),e.tables=e.tables||n?.tables?.map(i)}return{data:e,preferredHost:a}}function c(e){if(!e)return null;const{layers:t,tables:r}=e;return t?.length?t[0]:r?.length?r[0]:null}function y(e,t){return null==t?null:[...e.layers||[],...e.tables||[]].find(e=>e.id===t)}function p(e,t){return[...e.layers||[],...e.tables||[]].filter(({layerType:e})=>e?t.includes(e):t.includes("ArcGISFeatureLayer"))}function f(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function d(e){switch(e){case"catalog":return["CatalogLayer"];case"feature":return["ArcGISFeatureLayer"];case"oriented-imagery":return["OrientedImageryLayer"];case"subtype-group":return["SubtypeGroupLayer","SubtypeGroupTable"]}return null}function m(e){switch(e){case"CatalogLayer":return"CatalogLayer";case"OrientedImageryLayer":return"OrientedImageryLayer";case"SubtypeGroupLayer":case"SubtypeGroupTable":return"SubtypeGroupLayer"}return"FeatureLayer"}async function h(e,t,r){if(!e?.url)return t??{};if(t??={},!t.layers){const a=await r.fetchServiceMetadata(e.url);t.layers=a.layers?.map(i)}const{serverUrl:a,portalItem:s}=await(0,n.f)(e.url,{sceneLayerItem:e,customParameters:c(t)?.customParameters}).catch(()=>({serverUrl:null,portalItem:null}));if(null==a)return t.tables=[],t;if(!t.tables&&s){const e=await s.fetchData().catch(()=>null);if(e?.tables)t.tables=e.tables.map(i);else{const n=await r.fetchServiceMetadata(a,{customParameters:c(e)?.customParameters}).catch(()=>null);t.tables=n?.tables?.map(i)}}if(t.tables)for(const e of t.tables)e.url=`${a}/${e.id}`;return t}},24295:(e,t,r)=>{r.d(t,{load:()=>f});var a=r(6407),n=r(64604),s=r(89157),l=r(20521),o=r(23916),i=r(82408),u=r(79697),c=r(82454),y=r(58396),p=r(30861);async function f(e,t){const r=e.instance.portalItem;if(r?.id)return await r.load(t),function(e){const t=e.instance.portalItem;if(!t?.type||!e.supportedTypes.includes(t.type))throw new a.A("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:t?.type,expectedType:e.supportedTypes.join(", ")})}(e),e.validateItem&&e.validateItem(r),async function(e,t){const r=e.instance,n=r.portalItem;if(!n)return;let{url:i}=n;const{title:f}=n,m=(0,u.a)(n,"portal-item");if("group"===r.type)return async function(e,t,r){const n=e.portalItem;if(!e.sourceIsPortalItem)return;const{title:i,type:y}=n;if("Group Layer"===y){if(!(0,c.h)(n,"Map"))throw new a.A("portal:invalid-layer-item-typekeyword","'Group Layer' item without 'Map' type keyword is not supported");return async function(e,t){const r=e.portalItem,n=await r.fetchData("json");if(!n)return;if(!t.populateGroupLayer)throw new a.A("portal:missing-populate-group-layer","Missing populate group layer");const s=(0,u.a)(r,"web-map");e.read(n,s),await t.populateGroupLayer(e,n,{context:s}),e.resourceReferences={portalItem:r,paths:s.readResourcePaths??[]}}(e,r)}return e.read({title:i},t),async function(e,t){let r;const{portalItem:n}=e;if(!n)return;const i=n.type,u=t.layerModuleTypeMap;if(!u)throw new a.A("portal:missing-layer-module-type-map","Layer module type map is required to construct sub layers");switch(i){case"Feature Service":case"Feature Collection":r=u.FeatureLayer;break;case"Stream Service":r=u.StreamLayer;break;case"Scene Service":r=u.SceneLayer;break;case"Video Service":r=u.VideoLayer;break;default:throw new a.A("portal:unsupported-item-type-as-group",`The item type '${i}' is not supported as a 'GroupLayer'`)}const c="Video Service"===i,y=new l.L;let[f,{data:m}]=await Promise.all([r(),c?{data:null}:h(t,y)]),w=()=>f;if(c)return async function(e,t,r){const{portalItem:a}=e;if(!a?.url)return;const n=await(0,p.f)(a.url);n&&d(e,t,null,{layers:n.layers?.map(({id:e,name:t})=>({id:e,name:t}))},r)}(e,w,u);if("Feature Service"===i){const t=(0,l.g)(m)?.customParameters;m=n.url?(await(0,l.p)(m,n.url,y)).data:{},w=await async function(e,t){const{layers:r,tables:a}=e,n=[...r??[],...a??[]];if(!n.length)return;const s=new Set,o=[];for(const{layerType:e}of n){const r=e??"ArcGISFeatureLayer";if(s.has(r))continue;s.add(r);const a=t[(0,l.l)(r)];o.push(a())}const i=await Promise.all(o),u=new Map;return Array.from(s).forEach((e,t)=>{u.set(e,i[t])}),({layerType:e})=>{const t=e??"ArcGISFeatureLayer";return u.get(t)}}(m,u)||w;const{provider:r,preferredHost:a}=await async function(e,t){const{layersJSON:r,preferredHost:a}=await(0,s.f)(e,t);if(!r)return{provider:null,preferredHost:a};const n=[...r.layers,...r.tables];return{provider:e=>n.find(t=>t.id===e.id),preferredHost:a}}(n.url,{customParameters:t,loadContext:y});return(0,o.p)(n,a),await d(e,w,w,m,u,r)}return"Scene Service"===i&&n.url&&(m=await(0,l.c)(n,m,y)),(0,l.a)(m)>0?await d(e,w,null,m,u):await async function(e,t,r){const{portalItem:a}=e;if(!a?.url)return;const n=await(0,p.f)(a.url);n&&d(e,t,null,{layers:n.layers?.map(l.e),tables:n.tables?.map(l.e)},r)}(e,w,u)}(e,r)}(r,m,e);i&&"media"!==r.type&&r.read({url:i},m);const w=new l.L,{data:g,preferredHost:v}=await h(e,w,t);return i=n.url,"isUrlHostModified"in r&&(v?r.applyPreferredHost({preferredHost:v}):r.applyHostFromPortalItem()),g&&r.read(g,m),r.resourceReferences={portalItem:n,paths:m.readResourcePaths??[]},"subtype-group"!==r.type&&r.read({title:f},m),(0,y.l)(r,m)}(e,t)}async function d(e,t,r,a,n,s){let l=a.layers||[];const o=a.tables||[];if("Feature Collection"===e.portalItem?.type?(l.forEach((e,t)=>{e.id=t,"Table"===e?.layerDefinition?.type&&o.push(e)}),l=l.filter(e=>"Table"!==e?.layerDefinition?.type)):(l.reverse(),o.reverse()),l.forEach(r=>{const n=s?.(r);if(n||!s){const s=m(e,t(r),a,r,n);e.add(s)}}),o.length){const t=r?null:await n.FeatureLayer();o.forEach(n=>{const l=s?.(n);if(l||!s){const s=m(e,r?r(n):t,a,n,l);e.tables.add(s)}})}}function m(e,t,r,a,n){const s=e.portalItem,l={portalItem:s.clone(),layerId:a.id};null!=a.url&&(l.url=a.url);const o=new t(l);if("sourceJSON"in o&&(o.sourceJSON=n),"subtype-group"!==o.type&&"catalog"!==o.type&&(o.sublayerTitleMode="service-name"),"Feature Collection"===s.type){const e={origin:"portal-item",portal:s.portal||i.A.getDefault()};o.read(a,e);const t=r.showLegend;null!=t&&o.read({showLegend:t},e)}return o}async function h(e,t,r){if(!1===e.supportsData)return{data:void 0};const a=e.instance,s=a.portalItem;if(!s)return{data:void 0};let i=null;try{i=await s.fetchData("json",r)}catch(e){}if(function(e){return"stream"!==e.type&&"layerId"in e}(a)){let e=null;const{count:r,preferredHost:u}=await async function(e,t,r){if(t?.layers&&t?.tables)return{count:(0,l.a)(t)};const a=(0,n.p)(e.url);if(!a)return{count:1};const s=a.url.path,i=await r.fetchServiceMetadata(s,{customParameters:(0,l.g)(t)?.customParameters}).catch(()=>null);return{count:(t?.layers?.length??i?.layers?.length??0)+(t?.tables?.length??i?.tables?.length??0),preferredHost:(0,o.w)(e)?(0,o.q)():null}}(s,i,t);if((0,o.p)(s,u),(i?.layers||i?.tables)&&r>0){if(null==a.layerId){const e=(0,l.i)(a.type),t=e?.length?(0,l.d)(i,e)[0]:(0,l.g)(i);t&&(a.layerId=t.id)}e=function(e,t){const{layerId:r}=t,a=e.layers?.find(e=>e.id===r)||e.tables?.find(e=>e.id===r);return a&&function(e,t){const r="layerType"in e&&e.layerType,{type:a}=t;return!("feature"===a&&r&&"ArcGISFeatureLayer"!==e.layerType||"catalog"===a&&!r||"oriented-imagery"===a&&!r||"subtype-group"===a&&!r)}(a,t)?a:null}(i,a),"OrientedImageryLayer"===e?.layerType&&"oriented-imagery"===a.type&&a.supportedSourceTypes.add("Feature Layer"),e&&null!=i.showLegend&&(e.showLegend=i.showLegend)}return r>1&&"sublayerTitleMode"in a&&"service-name"!==a.sublayerTitleMode&&(a.sublayerTitleMode="item-title-and-service-name"),{data:e,preferredHost:u}}return{data:i}}r(32773),r(20266),r(90740),r(59121),r(84699),r(29512),r(99063),r(80959),r(13671),r(19247),r(1178),r(50472),r(43059),r(32816),r(18683),r(99924),r(41390),r(69421),r(50704),r(40499),r(93181),r(91047),r(36544),r(48064),r(85176),r(36555),r(58498),r(29298),r(35819),r(45371),r(61532),r(36172),r(73509),r(28276),r(49877),r(44600),r(2160),r(7969),r(69763),r(93804),r(96221),r(56273),r(64752),r(48844),r(29208),r(89935),r(49813),r(59192),r(91658),r(70580),r(75191),r(24319),r(62092),r(17745),r(81272),r(44945),r(93074),r(67321),r(88321),r(2589),r(36533),r(84200),r(97827),r(18169),r(20762),r(48402),r(16699),r(67504),r(47387),r(46728),r(21632),r(64102),r(73067)},30861:(e,t,r)=>{r.d(t,{f:()=>n});var a=r(64604);async function n(e,t){const{data:r}=await(0,a.A)(e,{responseType:"json",query:{f:"json",...t?.customParameters,token:t?.apiKey}});return r}},50472:(e,t,r)=>{r.d(t,{f:()=>u});var a=r(29512),n=r(64604),s=r(6407),l=r(80959),o=r(82408),i=r(43059);async function u(e,t){const r=(0,n.p)(e);if(!r)throw new s.A("invalid-url","Invalid scene service url");const u={...t,sceneServerUrl:r.url.path,layerId:r.sublayer??void 0};if(u.sceneLayerItem??=await async function(e){const t=(await c(e)).serviceItemId;if(!t)return null;const r=new i.default({id:t,apiKey:e.apiKey}),s=await async function(e){const t=a.id?.findServerInfo(e.sceneServerUrl);if(t?.owningSystemUrl)return t.owningSystemUrl;const r=e.sceneServerUrl.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const t=(await(0,n.A)(r,{query:{f:"json"},responseType:"json",signal:e.signal})).data.owningSystemUrl;if(t)return t}catch(e){(0,l.QP)(e)}return null}(e);null!=s&&(r.portal=new o.A({url:s}));try{return await r.load({signal:e.signal})}catch(e){return(0,l.QP)(e),null}}(u),null==u.sceneLayerItem)return y(u.sceneServerUrl.replace("/SceneServer","/FeatureServer"),u);const p=await async function({sceneLayerItem:e,signal:t}){if(!e)return null;try{const r=(await e.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:t})).find(e=>"Feature Service"===e.type)||null;if(!r)return null;const a=new i.default({portal:r.portal,id:r.id});return await a.load(),a}catch(e){return(0,l.QP)(e),null}}(u);if(!p?.url)throw new s.A("related-service-not-found","Could not find feature service through portal item relationship");u.featureServiceItem=p;const f=await y(p.url,u);return f.portalItem=p,f}async function c(e){if(e.rootDocument)return e.rootDocument;const t={query:{f:"json",...e.customParameters,token:e.apiKey},responseType:"json",signal:e.signal};try{const r=await(0,n.A)(e.sceneServerUrl,t);e.rootDocument=r.data}catch{e.rootDocument={}}return e.rootDocument}async function y(e,t){const r=(0,n.p)(e);if(!r)throw new s.A("invalid-feature-service-url","Invalid feature service url");const a=r.url.path,l=t.layerId;if(null==l)return{serverUrl:a};const o=c(t),i=t.featureServiceItem?await t.featureServiceItem.fetchData("json"):null,u=(i?.layers?.[0]||i?.tables?.[0])?.customParameters,y=e=>{const r={query:{f:"json",...u},responseType:"json",authMode:e,signal:t.signal};return(0,n.A)(a,r)},p=y("anonymous").catch(()=>y("no-prompt")),[f,d]=await Promise.all([p,o]),m=d?.layers,h=f.data&&f.data.layers;if(!Array.isArray(h))throw new Error("expected layers array");if(Array.isArray(m)){for(let e=0;e<Math.min(m.length,h.length);e++)if(m[e].id===l)return{serverUrl:a,layerId:h[e].id}}else if(null!=l&&l<h.length)return{serverUrl:a,layerId:h[l].id};throw new Error("could not find matching associated sublayer")}},58396:(e,t,r)=>{r.d(t,{l:()=>l});var a=r(73067),n=r(80959),s=r(48064);async function l(e,t,r){const l=e&&e.getAtOrigin&&e.getAtOrigin("renderer",t.origin);if(l&&"unique-value"===l.type&&l.styleOrigin){const o=await(0,a.r)(l.populateFromStyle());if((0,n.Te)(r),!1===o.ok){const r=o.error;t?.messages&&t.messages.push(new s.W("renderer:style-reference",`Failed to create unique value renderer from style reference: ${r.message}`,{error:r,context:t})),e.clear("renderer",t?.origin)}}}},79697:(e,t,r)=>{r.d(t,{a:()=>s,c:()=>l});var a=r(99063),n=r(82408);function s(e,t){return{...o(e,t),readResourcePaths:[]}}function l(e,t,r){const n=(0,a.An)(e.itemUrl);return{...o(e,t),messages:[],writtenProperties:[],blockedRelativeUrls:[],verifyItemRelativeUrls:n?{rootPath:n.path,writtenUrls:[]}:null,resources:r?{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}:null}}function o(e,t){return{origin:t,url:(0,a.An)(e.itemUrl),portal:e.portal||n.A.getDefault(),portalItem:e}}},89157:(e,t,r)=>{r.d(t,{f:()=>l,g:()=>f});var a=r(23916),n=r(30861);const s=new Set(["Catalog Layer","Feature Layer","Oriented Imagery Layer"]);async function l(e,t){const{loadContext:r,...s}=t||{},l=r?await r.fetchServiceMetadata(e,s):await(0,n.f)(e,s),o=(0,a.q)();p(l),u(l);const i={serviceJSON:l,preferredHost:o};if((l.currentVersion??0)<10.5)return i;const c=`${(0,a.r)()??e}/layers`,y=r?await r.fetchServiceMetadata(c,s):await(0,n.f)(c,s);return p(y),u(y),i.layersJSON={layers:y.layers,tables:y.tables},i}function o(e){const{type:t}=e;return!!t&&s.has(t)}function i(e){return"Table"===e.type}function u(e){e.layers=e.layers?.filter(o),e.tables=e.tables?.filter(i)}function c(e){e.type||="Feature Layer"}function y(e){e.type||="Table"}function p(e){e.layers?.forEach(c),e.tables?.forEach(y)}function f(e){switch(e){case"Feature Layer":case"Table":return"FeatureLayer";case"Oriented Imagery Layer":return"OrientedImageryLayer";case"Catalog Layer":return"CatalogLayer"}return"FeatureLayer"}}}]);