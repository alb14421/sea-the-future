"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[4252],{80488:(t,e,n)=>{n.d(e,{a:()=>l,b:()=>y,c:()=>m,d:()=>a,f:()=>p,g:()=>u,h:()=>f,i:()=>h,j:()=>c,k:()=>o,l:()=>s,m:()=>r});const i=[["binary","application/octet-stream","bin",""]];function r(t,e){return null!=F(e.name,t?.supportedFormats??[])}function s(t,e){if(!t)return!1;const n=u(e,t.supportedFormats??[]);return null!=n&&t.editFormats.includes(n)}function o(t,e){return g(function(t,e){const n=t.toLowerCase();return b(e).find(t=>M(t)===n)}(t,e))}function d(t,e){return g(F(t,e))}function a(t,e){return M(function(t,e){return b(e).find(e=>g(e)===t)}(t,e))}function u(t,e){return d(t.name,e)??o(t.type,e)}function l(t,e,n){return o(t,n)??d(e,n)}function c({supportedFormats:t}){return l("model/gltf-binary","glb",t)}function h(t){const e=c(t);return null!=e&&t.editFormats.includes(e)}function m(t){if(!t)return null;const e=c(t),n=function({supportedFormats:t}){return l("model/gltf+json","gltf",t)}(t);let i=null;for(const r of t.queryFormats){if(r===e)return r;r===n&&(i=r)}return i}function f({supportedFormats:t}){return l("application/esri3do-SR_world","wld",t)}function p({supportedFormats:t}){return l("application/esri3do-SR_prj","prj",t)}function b(t){return[...i,...t]}function F(t,e){const n=t.toLowerCase();return b(e).find(t=>function(t){return t?.[2].split(",").map(t=>t.toLowerCase())??[]}(t).some(t=>n.endsWith(t)))}function g(t){return t?.[0]}function M(t){return t?.[1].toLowerCase()}function y(t){return t.tables?.find(t=>"assetMaps"===t.role)}},99781:(t,e,n)=>{n.d(e,{E:()=>I,a:()=>p,b:()=>M,c:()=>l,d:()=>m,e:()=>F,i:()=>f});var i=n(32816),r=n(81272),s=n(32773),o=n(80959),d=n(29298),a=(n(20266),n(69421)),u=n(64604);const l=(0,n(93049).b)(),c=new Map,h=new Map;async function m(t,e,n){if(!t||!n)return!1;if(!e)return!0;const i=new URL(t).host;let r=c.get(i);if(!r){const e=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,"");r=(await(0,u.A)(e,{responseType:"json",query:{f:"json"}})).data.defaultVersionName}return r===e}async function f(t,e,i=!1){if(!t||!e)return!0;const r=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),s=h.get(r)?.entries();if(s)for(const[t,o]of s)if(o.name===e){const e=!o.stack?.hasForwardEdits();if(!e&&i){const[{deleteForwardEdits:e},{default:i}]=await Promise.all([n.e(7931).then(n.bind(n,87931)),n.e(951).then(n.bind(n,10951))]),s=await e(r,t,new i({sessionId:l,moment:o.moment}));return s.success&&o.stack?.clearForwardEdits(),s.success}return e}return!0}function p(t,e){if(!t)return!1;const n=t.replace(/\/FeatureServer/i,"/VersionManagementServer").replace(/\/\d*$/,""),i=h.get(n)?.entries();if(i)for(const[t,n]of i)if(n.name===e)return"edit"===n.lockType;return!1}new Map;const b=new r.bk;function F(t,e,n=null,i=!1){const r=(0,o.Tw)();return i=null==e||i,b.emit("apply-edits",{serviceUrl:t,layerId:e,gdbVersion:n,mayReceiveServiceEdits:i,result:r.promise}),r}const g=Symbol();function M(t){return null!=t&&"object"==typeof t&&g in t}function y(t){return null!=t&&"object"==typeof t&&"gdbVersion"in t}function w(t,e,n){const i=new URL(t).host,r=c.get(i),s=t=>!t||t===r;return s(e)&&s(n)||e===n}const I=t=>{var e;const n=t;let r=class extends n{static{e=g}constructor(...t){super(...t),this[e]=!0,this._applyEditsHandler=t=>{const{serviceUrl:e,layerId:n,gdbVersion:i,mayReceiveServiceEdits:r,result:o}=t,d=e===this.url,a=null!=n&&null!=this.layerId&&n===this.layerId,u=y(this),l=y(this)&&w(e,i,this.gdbVersion);if(!d||u&&!l||!a&&!r)return;const c=o.then(t=>{if(this.lastEditsEventDate=new Date,a&&(t.addedFeatures.length||t.updatedFeatures.length||t.deletedFeatures.length||t.addedAttachments.length||t.updatedAttachments.length||t.deletedAttachments.length))return this.emit("edits",(0,s.o8)(t)),t;const n=t.editedFeatures?.find(({layerId:t})=>t===this.layerId);if(n){const{adds:e,updates:i,deletes:r}=n.editedFeatures,o={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:e?e.map(({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]})):[],deletedFeatures:r?r.map(({attributes:t})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]})):[],updatedFeatures:i?i.map(({current:{attributes:t}})=>({objectId:this.objectIdField&&t[this.objectIdField],globalId:this.globalIdField&&t[this.globalIdField]})):[],editedFeatures:(0,s.o8)(t.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(t.historicMoment)};return this.emit("edits",o),o}const r={edits:null,addedAttachments:[],deletedAttachments:[],updatedAttachments:[],addedFeatures:[],deletedFeatures:[],updatedFeatures:[],editedFeatures:(0,s.o8)(t.editedFeatures),exceededTransferLimit:!1,historicMoment:(0,s.o8)(t.historicMoment)};return"historicMoment"in this&&this._shouldUpdateHistoricMoment(e,i,r.historicMoment)&&this.emit("edits",r),r}).then(t=>("historicMoment"in this&&this._shouldUpdateHistoricMoment(e,i,t.historicMoment)&&(this.historicMoment=t.historicMoment),t));this.emit("apply-edits",{result:c})},this._updateMomentHandler=t=>{const{serviceUrl:e,gdbVersion:n,moment:i}=t,r=e===this.url,s=y(this),o=y(this)&&w(e,n,this.gdbVersion),d=y(this)&&!w(e,this.gdbVersion,null);r&&s&&o&&d&&"historicMoment"in this&&this.historicMoment!==i&&(this.historicMoment=i)},this.when().then(()=>{this.addHandles(function(t){return b.on("apply-edits",new WeakRef(t))}(this._applyEditsHandler)),"historicMoment"in this&&this.addHandles(function(t){return b.on("update-moment",new WeakRef(t))}(this._updateMomentHandler))},()=>{})}_shouldUpdateHistoricMoment(t,e,n){return"historicMoment"in this&&this.historicMoment!==n&&p(t,e)}};return(0,i._)([(0,d.MZ)()],r.prototype,"lastEditsEventDate",void 0),r=(0,i._)([(0,a.$)("esri.layers.mixins.EditBusLayer")],r),r}}}]);