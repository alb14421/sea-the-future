/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import"../../core/lang.js";import{p as e,a as t}from"../../chunks/screenUtils.js";import{a as s}from"../../chunks/layerUtils.js";import{l}from"../../layers/support/fieldUtils.js";import{d as r,e as a,c as o,g as i,a as n}from"../../chunks/gfxUtils.js";import{b as c,s as u,r as m,t as p,g as h,c as f,d as y,e as b,f as d,h as k,i as j,j as g,k as w,l as L}from"../../chunks/renderUtils.js";import{i as S}from"../../chunks/typeUtils2.js";import{f as v,i as M,h as x,c as C,a as U,b as q,e as T,j as R}from"../../chunks/utils8.js";import{b as D,d as H,e as $,g as V,c as _,a as z,f as P}from"../../chunks/svgUtils.js";import{a as F,c as E}from"../../chunks/widgetUtils.js";import{t as O}from"../../chunks/jsxFactory.js";import{g as I}from"../../chunks/assets.js";import{a as A,t as W}from"../../chunks/colorUtils2.js";import B from"../../core/Error.js";import{L as G}from"../../chunks/Logger.js";import{d as X}from"../IconSymbol3DLayer.js";import{d as N}from"../ObjectSymbol3DLayer.js";import{r as Z}from"../../chunks/webStyleSymbolUtils.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../config.js";import"../../chunks/object.js";import"../../chunks/jsonUtils.js";import"../../chunks/string.js";import"../../request.js";import"../../chunks/MapUtils.js";import"../../core/promiseUtils.js";import"../../chunks/handleUtils.js";import"../../chunks/events.js";import"../../chunks/maybe.js";import"../../chunks/persistableUrlUtils.js";import"../../core/Collection.js";import"../../chunks/tslib.es6.js";import"../../chunks/watch.js";import"../../chunks/ObjectPool.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../chunks/SetUtils.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/Lifecycle.js";import"../../chunks/tracking.js";import"../../chunks/SimpleTrackingTarget.js";import"../../core/Evented.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/metadata.js";import"../../chunks/ensureType.js";import"../../chunks/Warning.js";import"../../chunks/ObservableBase.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../layers/catalog/catalogUtils.js";import"../../core/reactiveUtils.js";import"../../core/sql.js";import"../../chunks/guards.js";import"../../chunks/datetime.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../chunks/mathUtils.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"./cimSymbolUtils.js";import"../../chunks/utils6.js";import"../../chunks/defaultCIMValues.js";import"../../chunks/projector.js";import"../../chunks/sanitizerUtils.js";import"../CIMSymbol.js";import"../../chunks/enumeration.js";import"../../chunks/jsonMap.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../Symbol.js";import"../../core/JSONSupport.js";import"../LabelSymbol3D.js";import"../Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../core/accessorSupport/decorators/cast.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/pe.js";import"../../geometry/Point.js";import"../../geometry/support/webMercatorUtils.js";import"../../chunks/locale.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../ExtrudeSymbol3DLayer.js";import"../Symbol3DLayer.js";import"../../chunks/utils3.js";import"../edges/Edges3D.js";import"../../chunks/materialUtils.js";import"../../chunks/opacityUtils.js";import"../edges/SketchEdges3D.js";import"../edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../FillSymbol3DLayer.js";import"../patterns/LineStylePattern3D.js";import"../patterns/StylePattern3D.js";import"../../chunks/utils4.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/vec3f64.js";import"../../chunks/aaBoundingBox.js";import"../../chunks/aaBoundingRect.js";import"../../chunks/DoubleArray.js";import"../LineSymbol3DLayer.js";import"../LineStyleMarker3D.js";import"../../core/Clonable.js";import"../../chunks/lineMarkers.js";import"../PathSymbol3DLayer.js";import"../TextSymbol3DLayer.js";import"../Font.js";import"../WaterSymbol3DLayer.js";import"./StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../callouts/Callout3D.js";import"../callouts/LineCallout3D.js";import"./Symbol3DVerticalOffset.js";import"../LineSymbol3D.js";import"../MeshSymbol3D.js";import"../PictureFillSymbol.js";import"../FillSymbol.js";import"../SimpleLineSymbol.js";import"../LineSymbol.js";import"../LineSymbolMarker.js";import"../../chunks/urlUtils.js";import"../PictureMarkerSymbol.js";import"../MarkerSymbol.js";import"../PointSymbol3D.js";import"../PolygonSymbol3D.js";import"../SimpleFillSymbol.js";import"../SimpleMarkerSymbol.js";import"../TextSymbol.js";import"../WebStyleSymbol.js";import"../../chunks/asyncUtils.js";import"../../chunks/jsonUtils2.js";import"../../chunks/parser.js";import"../../chunks/utils5.js";import"../../chunks/mat4.js";import"../../chunks/common.js";import"../../chunks/mat2df32.js";import"../../chunks/mat2d.js";import"../../chunks/jsxWidgetSupport.js";import"../../chunks/vec4.js";import"../../chunks/vec4f64.js";import"../../chunks/devEnvironmentUtils.js";import"./jsonUtils.js";import"../../chunks/defaults.js";import"../../chunks/defaultsJSON.js";import"../../chunks/styleUtils.js";const J="esri-relationship-ramp",Q=`${J}--diamond`,Y=`${J}--square`,K={diamondContainer:`${Q}__container`,diamondLeftCol:`${Q}__left-column`,diamondRightCol:`${Q}__right-column`,diamondMidCol:`${Q}__middle-column`,diamondMidColLabel:`${Q}__middle-column--label`,diamondMidColRamp:`${Q}__middle-column--ramp`,squareTable:`${Y}__table`,squareTableRow:`${Y}__table-row`,squareTableCell:`${Y}__table-cell`,squareTableLabel:`${Y}__table-label`,squareTableLabelLeftBottom:`${Y}__table-label--left-bottom`,squareTableLabelRightBottom:`${Y}__table-label--right-bottom`,squareTableLabelLeftTop:`${Y}__table-label--left-top`,squareTableLabelRightTop:`${Y}__table-label--right-top`};function ee(e,t,s={}){const{focus:l,labels:r}=e,a=!!l,o=function(e,t,s={}){const{focus:l,numClasses:r,colors:a,rotation:o}=e,{opacity:i,effectList:n,ariaLabel:c}=s,u=s.size??60,m=!!l,p=Math.sqrt(u**2+u**2)+(m?0:5),h=[],f=[],y=[],b=(u||75)/r;for(let e=0;e<r;e++){const t=e*b;for(let s=0;s<r;s++){const l=s*b,r=D(a[e][s]),o=P(null),i={type:"rect",x:l,y:t,width:b,height:b},n=H(r);n&&h.push(n);const c=$(i,r.fill,o,null);c&&f.push(c),y.push(V(i))}}let d=null;m||(d="margin: -15px -15px -18px -15px");const k=te("left",l,t),j=te("right",l,t),g=_(y),w=z(g,p,p,0,!1,o,!1),L=z(g,p,p,0,!1,m?-45:null,!1),S={filter:v(n)??void 0,opacity:null==i?"":`${i}`};return O("div",{class:m?K.diamondMidColRamp:K.squareTableCell,styles:S},O("svg",{"aria-label":c,focusable:!1,height:p,role:"image",style:d,width:p,xmlns:"http://www.w3.org/2000/svg"},O("defs",null,O("marker",{id:`${t}_arrowStart`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"5",refY:"5"},O("polyline",{fill:"none",points:"0,0 5,5 0,10",stroke:"#555555","stroke-width":"1"})),O("marker",{id:`${t}_arrowEnd`,markerHeight:"10",markerUnits:"strokeWidth",markerWidth:"10",orient:"auto",refX:"0",refY:"5"},O("polyline",{fill:"none",points:"5,0 0,5 5,10",stroke:"#555555","stroke-width":"1"})),h),O("g",{transform:w},f),O("g",{transform:L},O("line",{fill:"none","marker-end":k.markerEnd,"marker-start":k.markerStart,stroke:"#555555","stroke-width":"1",x1:-10,x2:-10,y1:u-15,y2:15}),O("line",{fill:"none","marker-end":j.markerEnd,"marker-start":j.markerStart,stroke:"#555555","stroke-width":"1",x1:15,x2:u-15,y1:u+10,y2:u+10}))))}(e,t,s),i=F(),n=s.key??t;return a?O("div",{class:K.diamondContainer,key:`${n}-container`,styles:{justifyContent:"center"}},O("div",{class:K.diamondLeftCol},i?r.right:r.left),O("div",{class:K.diamondMidCol},O("div",{class:K.diamondMidColLabel},r.top),o,O("div",{class:K.diamondMidColLabel},r.bottom)),O("div",{class:K.diamondRightCol},i?r.left:r.right)):O("div",{class:K.squareTable,key:`${n}-container`},O("div",{class:K.squareTableRow},O("div",{class:E(K.squareTableCell,K.squareTableLabel,K.squareTableLabelRightBottom)},i?r.top:r.left),O("div",{class:K.squareTableCell}),O("div",{class:E(K.squareTableCell,K.squareTableLabel,K.squareTableLabelLeftBottom)},i?r.left:r.top)),O("div",{class:K.squareTableRow},O("div",{class:K.squareTableCell}),o,O("div",{class:K.squareTableCell})),O("div",{class:K.squareTableRow},O("div",{class:E(K.squareTableCell,K.squareTableLabel,K.squareTableLabelRightTop)},i?r.right:r.bottom),O("div",{class:K.squareTableCell}),O("div",{class:E(K.squareTableCell,K.squareTableLabel,K.squareTableLabelLeftTop)},i?r.bottom:r.right)))}function te(e,t,s){const l=`${s}_arrowStart`,r=`${s}_arrowEnd`,a="left"===e,o={markerStart:null,markerEnd:null};switch(t){case"HL":a?o.markerStart=`url(#${r})`:o.markerEnd=`url(#${l})`;break;case"LL":o.markerStart=`url(#${r})`;break;case"LH":a?o.markerEnd=`url(#${l})`:o.markerStart=`url(#${r})`;break;default:o.markerEnd=`url(#${l})`}return o}const se=22,le=120;function re(t){const s=t.outline,l=null!=t.material?t.material.color:null,r=null!=l?l.toHex():null;if(null==s||"pattern"in s&&null!=s.pattern&&"style"===s.pattern.type&&"none"===s.pattern.style)return"fill"===t.type&&"#ffffff"===r?{color:"#bdc3c7",width:.75}:null;const o=e(s.size)||0;return{color:"rgba("+(null!=s.color?s.color.toRgba():"255,255,255,1")+")",width:Math.min(o,80),style:"pattern"in s&&null!=s.pattern&&"style"===s.pattern.type?a(s.pattern.style):null,join:"butt",cap:"patternCap"in s?s.patternCap:"butt"}}function ae(e,t=1){const s=e.a,l=A(e),r=l.h,a=l.s/t,o=100-(100-l.v)/t,{r:i,g:n,b:c}=W({h:r,s:a,v:o});return[i,n,c,s]}function oe(e){return"water"===e.type?null==e.color?null:e.color:null==e.material?.color?null:e.material.color}function ie(e,t=0){const s=oe(e);if(!s){if("fill"===e.type)return null;const s=r.r,l=c(s,t);return[l,l,l,100]}const l=s.toRgba();for(let e=0;e<3;e++)l[e]=c(l[e],t);return l}async function ne(e,t){const s=e.style;return"none"===s?null:{type:"pattern",x:0,y:0,src:await o(I(`esri/symbols/patterns/${s}.png`),t.toCss(!0)),width:5,height:5}}function ce(e){return e.outline?re(e):{color:"rgba(0, 0, 0, 1)",width:1.5}}function ue(e,t){const s=oe(e);if(!s)return null;let l="rgba(";return l+=c(s.r,t)+",",l+=c(s.g,t)+",",l+=c(s.b,t)+",",l+s.a+");"}function me(t,s){const l=t.edges;return l&&l.color&&l.size?{color:l.color.toCss(!0),width:Math.min(e(l.size),s,80),join:"round"}:null}function pe(t,s){const l=ue(t,s);if(!l)return null;if("pattern"in t&&null!=t.pattern&&"style"===t.pattern.type&&"none"===t.pattern.style)return null;const r={color:l,width:Math.min(t.size?e(t.size):.75,80)};return"pattern"in t&&"style"===t.pattern?.type&&(r.style=a(t.pattern.style)),"cap"in t&&t.cap&&(r.cap=t.cap),"join"in t&&t.join&&(r.join="miter"===t.join?e(2):t.join),r}function he(e,t,s){const l=null!=s?.75*s:0;return{type:"linear",x1:l?.25*l:0,y1:l?.5*l:0,x2:l||4,y2:l?.5*l:4,colors:[{color:e,offset:0},{color:t,offset:1}]}}function fe(t){const s="number"==typeof t?.size?t?.size:null;return s?e(s):null}const ye=Object.freeze(Object.defineProperty({__proto__:null,getPatternDescriptor:ne,getSizeFromOptions:fe,getSymbolLayerFill:ie,previewSymbol3D:function(t,s){if(0===t.symbolLayers.length)return Promise.reject(new B("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(t.type){case"point-3d":return async function(t,s){const l=fe(s),r=s?.maxSize?e(s.maxSize):null,a=s?.disableUpsampling??!1,o=t.symbolLayers,i=[],n=[];let c=!1,u=0,j=0,g=0;o.forEach(o=>{if("icon"!==o.type&&"object"!==o.type)return;o&&"icon"===o.type&&(g=Math.max(o.size&&e(o.size),g));const m="icon"===o.type?o.size&&e(o.size):0,w=l||m?Math.ceil(Math.min(l||m,r||le)):se;let L="icon"===o.type?o.angle:null;if(null!=s?.rotation&&(L=(L??0)+s.rotation),n.push(L),o?.resource?.href){const e=async function(e,t){if(e.thumbnail?.url)return e.thumbnail.url;if("icon"===t.type){const e=t?.resource?.href;if(e)return x(t)}const s=I("esri/images/Legend/legend3dsymboldefault.png");if(e.styleOrigin&&(e.styleOrigin.styleName||e.styleOrigin.styleUrl)){const t=await Z(e.styleOrigin,{portal:e.styleOrigin.portal}).catch(()=>null);if(t&&"thumbnail"in t&&t.thumbnail?.url)return t.thumbnail.url}return s}(t,o).then(e=>{const t=o?.material?.color,s=function(e){return"icon"===e.type?"multiply":"tint"}(o);return p(e,w,t,s,a)}).then(e=>{const t=e.width,s=e.height;return u=Math.max(u,t),j=Math.max(j,s),L&&(c=!0),[{shape:{type:"image",x:0,y:0,width:t,height:s,src:e.url},fill:null,stroke:null}]});i.push(e)}else{let e=w;"icon"===o.type&&l&&(e=w*(m/g));const t="tall"===s?.symbolConfig||s?.symbolConfig?.isTall||"object"===o.type&&function(e){const t=e.depth,s=e.height,l=e.width;return 0!==l&&0!==t&&0!==s&&l===t&&null!=l&&null!=s&&l<s}(o);u=Math.max(u,t?20:e),j=Math.max(j,e),L&&o.resource?.primitive&&["square","triangle","x"].includes(o.resource?.primitive)&&(c=!0),i.push(Promise.resolve(function(e,t,s){const l=[];if(!e)return l;switch(e.type){case"icon":{const s=0,r=0,a=t,o=t;switch(e.resource?.primitive??X){case"circle":l.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:ie(e,0),stroke:re(e)});break;case"square":l.push({shape:{type:"path",path:[{command:"M",values:[s,o]},{command:"L",values:[s,r]},{command:"L",values:[a,r]},{command:"L",values:[a,o]},{command:"Z",values:[]}]},fill:ie(e,0),stroke:re(e)});break;case"triangle":l.push({shape:{type:"path",path:[{command:"M",values:[s,o]},{command:"L",values:[.5*a,r]},{command:"L",values:[a,o]},{command:"Z",values:[]}]},fill:ie(e,0),stroke:re(e)});break;case"cross":l.push({shape:{type:"path",path:[{command:"M",values:[.5*a,r]},{command:"L",values:[.5*a,o]},{command:"M",values:[s,.5*o]},{command:"L",values:[a,.5*o]}]},stroke:ce(e)});break;case"x":l.push({shape:{type:"path",path:[{command:"M",values:[s,r]},{command:"L",values:[a,o]},{command:"M",values:[a,r]},{command:"L",values:[s,o]}]},stroke:ce(e)});break;case"kite":l.push({shape:{type:"path",path:[{command:"M",values:[s,.5*o]},{command:"L",values:[.5*a,r]},{command:"L",values:[a,.5*o]},{command:"L",values:[.5*a,o]},{command:"Z",values:[]}]},fill:ie(e,0),stroke:re(e)})}break}case"object":switch(e.resource?.primitive??N){case"cone":{const r=he(ie(e,0),ie(e,-.6),s?20:t),a=k(t,s);l.push({shape:a[0],fill:r},{shape:a[1],fill:r});break}case"inverted-cone":{const s=ie(e,0),r=he(s,ie(e,-.6),t),a=d(t);l.push({shape:a[0],fill:r},{shape:a[1],fill:s});break}case"cube":{const r=b(t,s);l.push({shape:r[0],fill:ie(e,0)},{shape:r[1],fill:ie(e,-.3)},{shape:r[2],fill:ie(e,-.5)});break}case"cylinder":{const r=he(ie(e,0),ie(e,-.6),s?20:t),a=y(t,s);l.push({shape:a[0],fill:r},{shape:a[1],fill:r},{shape:a[2],fill:ie(e,0)});break}case"diamond":{const s=f(t);l.push({shape:s[0],fill:ie(e,-.3)},{shape:s[1],fill:ie(e,0)},{shape:s[2],fill:ie(e,-.3)},{shape:s[3],fill:ie(e,-.7)});break}case"sphere":{const s=he(ie(e,0),ie(e,-.6));s.x1=0,s.y1=0,s.x2=.25*t,s.y2=.25*t,l.push({shape:{type:"circle",cx:0,cy:0,r:.5*t},fill:s});break}case"tetrahedron":{const s=h(t);l.push({shape:s[0],fill:ie(e,-.3)},{shape:s[1],fill:ie(e,0)},{shape:s[2],fill:ie(e,-.6)});break}}}return l}(o,e,t)))}});const w=await Promise.allSettled(i),L=[];return w.forEach(e=>{"fulfilled"===e.status?L.push(e.value):e.reason&&G.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",e.reason)}),m(L,[u,j],{node:s?.node,scale:!1,opacity:s?.opacity,ariaLabel:s?.ariaLabel,rotations:n,useRotationSize:c})}(t,s);case"line-3d":return function(t,s){const l=t.symbolLayers,r=[],a=M(t),o=fe(s),i=(s?.maxSize?e(s.maxSize):null)||80;let n,c=0,p=0;return l.forEach((e,t)=>{if(!e)return;if("line"!==e.type&&"path"!==e.type)return;const s=[];switch(e.type){case"line":{const l=pe(e,0);if(null==l)break;const r=l?.width||0;0===t&&(n=r);const a=Math.min(o||r,i),u=0===t?a:o?a*(r/n):a,m=u>25?2*u:50;p=Math.max(p,u),c=Math.max(c,m),l.width=u,s.push({shape:{type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[c,.5*p]}]},stroke:l});break}case"path":{const t=Math.min(o||se,i),l=ie(e,0),r=ie(e,-.2),a=ue(e,-.4),n=a?{color:a,width:1}:{};if("quad"===e.profile){const t=e.width,a=e.height,o=j(t&&a?t/a:1,0===a,0===t),i={...n,join:"bevel"};s.push({shape:o[0],fill:r,stroke:i},{shape:o[1],fill:r,stroke:i},{shape:o[2],fill:l,stroke:i})}else s.push({shape:u.pathSymbol3DLayer[0],fill:r,stroke:n},{shape:u.pathSymbol3DLayer[1],fill:l,stroke:n});p=Math.max(p,t),c=p}}r.push(s)}),Promise.resolve(m(r,[c,p],{node:s?.node,scale:a,opacity:s?.opacity,ariaLabel:s?.ariaLabel}))}(t,s);case"polygon-3d":case"mesh-3d":return async function(t,s){const l="mesh-3d"===t.type,r=t.symbolLayers,a=fe(s),o=s?.maxSize?e(s.maxSize):null,i=a||se,n=[];let c=0,p=0,h=!1;for(let e=0;e<r.length;e++){const t=r.at(e),s=[];if(!l||"fill"===t.type){switch(t.type){case"fill":{const e=Math.min(i,o||le);if(c=Math.max(c,e),p=Math.max(p,e),h=!0,l){const l=u.meshSymbol3DFill,r=ue(t,-.4),a=me(t,.05*e)??(r?{join:"round",color:r,width:1}:null);s.push({shape:l[0],fill:ie(t,0),stroke:a},{shape:l[1],fill:ie(t,-.2),stroke:a},{shape:l[2],fill:ie(t,-.6),stroke:a})}else{let e=ie(t,0);const l="pattern"in t?t.pattern:null,r=re(t),a=oe(t);null!=l&&"style"===l.type&&"solid"!==l.style&&a&&(e=await ne(l,a)),s.push({shape:u.fill[0],fill:e,stroke:r})}break}case"line":{const e=pe(t,0);if(null==e)break;const l={stroke:e,shape:u.fill[0]};c=Math.max(c,se),p=Math.max(p,se),s.push(l);break}case"extrude":{const e=ie(t,0),l=ie(t,-.2),r=Math.min(i,o||le),a=w(r),n=se,u=15.399999999999999+.5*r,m=me(t,.1*Math.min(n,u))??{join:"round",...pe(t,-.4),width:1};s.push({shape:a[0],fill:l,stroke:m},{shape:a[1],fill:l,stroke:m},{shape:a[2],fill:e,stroke:m}),c=Math.max(c,n),p=Math.max(p,u);break}case"water":{const e=oe(t),l=ae(e),r=ae(e,2),a=ae(e,3),n=g();h=!0,s.push({shape:n[0],fill:l},{shape:n[1],fill:r},{shape:n[2],fill:a});const u=Math.min(i,o||le);c=Math.max(c,u),p=Math.max(p,u);break}}n.push(s)}}return m(n,[c,p],{node:s?.node,scale:h,opacity:s?.opacity,ariaLabel:s?.ariaLabel})}(t,s)}return Promise.reject(new B("symbolPreview: swatchInfo3D","symbol not supported."))}},Symbol.toStringTag,{value:"Module"})),be={HH:315,HL:45,LL:135,LH:225},de={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};function ke(e){if(!e)return;const{type:t}=e;if(t.includes("3d"))return ie(e.symbolLayers.at(0));if("simple-line"===t){const t=i(e);return t&&t.color}if("simple-marker"===e.type&&("x"===e.style||"cross"===e.style)){const t=i(e);return t&&t.color}return n(e)}function je(e){const{focus:t,infos:s,numClasses:l}=e,r=de[l],a={};s.forEach(e=>{a[e.value]={label:e.label,fill:ke(e.symbol)}});const o=[];for(let e=0;e<l;e++){const t=[];for(let s=0;s<l;s++){const l=a[r[e][s]];t.push(l.fill)}o.push(t)}const i=function(e,t){const s=t.HH.label,l=t.LL.label,r=t.HL.label,a=t.LH.label;switch(e){case"HH":default:return{top:s,bottom:l,left:r,right:a};case"HL":return{top:r,bottom:a,left:l,right:s};case"LL":return{top:l,bottom:s,left:a,right:r};case"LH":return{top:a,bottom:r,left:s,right:l}}}(t,a);return{type:"relationship-ramp",numClasses:l,focus:t,colors:o,labels:i,rotation:ge(t)}}function ge(e){let t=be[e];return e&&null==t&&(t=be.HH),t||0}let we=null;const Le=[255,255,255];function Se(e,t){return Math.floor(Math.random()*(t-e+1)+e)}function ve(e,t,s){const{backgroundColor:l,outline:r,dotSize:a}=e,o=s?.swatchSize||22,i=Math.round(o*o/Math.max(a,.5)**2*.8),n=window.devicePixelRatio,c=document.createElement("canvas"),u=o*n;c.width=u,c.height=u,c.style.width=c.width/n+"px",c.style.height=c.height/n+"px";const m=c.getContext("2d");if(l&&(m.fillStyle=l.toCss(!0),m.fillRect(0,0,u,u),m.fill()),m.fillStyle=t?.toCss(!0)??"",we&&we.length/2===i)for(let e=0;e<2*i;e+=2){const t=we[e],s=we[e+1];m.fillRect(t,s,a*n,a*n),m.fill()}else{we=[];for(let e=0;e<2*i;e+=2){const e=Se(0,u),t=Se(0,u);we.push(e,t),m.fillRect(e,t,a*n,a*n),m.fill()}}r&&(r.color&&(m.strokeStyle=r.color.toCss(!0)),m.lineWidth=r.width,m.strokeRect(0,0,u,u));const p=new Image(o,o);return p.src=c.toDataURL(),p.ariaLabel=s?.ariaLabel??null,p.alt=s?.ariaLabel??"",p}function Me(e,t={}){const s=t.radius||40,l=2*Math.PI*s,r=e.length,a=l/r,o=[],n=i(t.outline);null!=n?.width&&(n.width*=2),(n||t.backgroundColor)&&o.push({shape:{type:"circle",cx:s,cy:s,r:s},fill:t.backgroundColor,stroke:n,offset:[0,0]});const c=t.values,u=c&&c.length===r&&100===c.reduce((e,t)=>e+t,0),p=[0];for(let t=0;t<r;t++){let r=null;u&&(r=c[t]*l/100,p.push(r+p[t])),o.push({shape:{type:"circle",cx:s,cy:s,r:s/2},fill:[0,0,0,0],stroke:{width:s,dashArray:`${(r??a)/2} ${l}`,dashoffset:"-"+(u?p[t]/2:t*(a/2)),color:e[t]},offset:[0,0]})}let h=null;const f=2*s+(n?.width||0),y=t.holePercentage;if(y){n&&o.push({shape:{type:"circle",cx:s,cy:s,r:s*y},fill:null,stroke:n,offset:[0,0]});const e=f/2;h=[[{shape:{type:"circle",cx:e,cy:e,r:e},fill:Le,stroke:n?{...n,color:Le}:null,offset:[0,0]},{shape:{type:"circle",cx:e,cy:e,r:s*y},fill:[0,0,0],stroke:null,offset:[0,0]}]]}return m([o],[f,f],{effectView:t.effectList,ignoreStrokeWidth:!0,masking:h,rotations:[-90],ariaLabel:t.ariaLabel})}function xe(e,t={}){const s=e?.authoringInfo;if("relationship"!==s?.type||!s?.numClasses||!e.uniqueValueInfos)return null;const{focus:l,numClasses:r}=s,a=je({focus:l,numClasses:r,infos:e.uniqueValueInfos}),o=t?.node||document.createElement("div");return L(o,()=>ee(a,t.id||"relationship",{opacity:t.opacity||1,effectList:t.effectList,ariaLabel:t.ariaLabel})),o}function Ce(e,t={}){const s="horizontal"===t.align,l=s?75:24,r=s?24:75,a=t.width??l,o=t.height??r,i=t.gradient??!0,n=window.devicePixelRatio,c=a*n,u=o*n,m=document.createElement("canvas");m.width=c,m.height=u,m.ariaLabel=t.ariaLabel??null,m.style.width=`${a}px`,m.style.height=`${o}px`;const p=m.getContext("2d"),h=s?c:0,f=s?0:u;if(i){const t=p.createLinearGradient(0,0,h,f),s=e.length,l=1===s?0:1/(s-1);e.forEach((e,s)=>t.addColorStop(s*l,e.toString())),p.fillStyle=t,p.fillRect(0,0,c,u)}else{const t=s?c/e.length:c,l=s?u:u/e.length;let r=0,a=0;for(const o of e)p.fillStyle=o.toString(),p.fillRect(r,a,t,l),r=s?r+t:0,a=s?0:a+l}const y=document.createElement("div");return y.style.width=`${a}px`,y.style.height=`${o}px`,function(e,t){if(!t)return;e.style.filter=v(t);const s=t.effects;if(s)for(const t of s)if("drop-shadow"===t?.type){t.offsetX<0?e.style.marginLeft=`${Math.abs(t.offsetX)}px`:e.style.marginRight=`${t.offsetX}px`;break}}(y,t?.effectList),y.appendChild(m),y}async function Ue(e,t){switch(e.type){case"web-style":{const{previewWebStyleSymbol:s}=await import("../../chunks/previewWebStyleSymbol.js");return s(e,Ue,t)}case"label-3d":case"line-3d":case"mesh-3d":case"point-3d":case"polygon-3d":{const{previewSymbol3D:s}=await Promise.resolve().then(()=>ye);return s(e,t)}case"simple-marker":case"simple-line":case"simple-fill":case"picture-marker":case"picture-fill":case"text":{const{previewSymbol2D:s}=await import("../../chunks/previewSymbol2D.js");return s(e,t)}case"cim":{const{previewCIMSymbol:s}=await import("../../chunks/previewCIMSymbol.js");return s(e,t)}default:return}}function qe(e){return e&&"opacity"in e?e.opacity*qe(e.parent):1}async function Te(e,t){if(!e)return;const s=e.sourceLayer,r=(null!=t&&t.useSourceLayer?s:e.layer)??s,a=t?.ignoreOpacity?1:qe(r);if(null!=e.symbol&&(null==t||!0!==t.ignoreGraphicSymbol)){const s="web-style"===e.symbol.type?await e.symbol.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats,cache:t?.webStyleCache}):e.symbol.clone();return C(s,null,{add:a}),s}const o=t?.renderer??He(r);let i=o&&"getSymbolAsync"in o?await o.getSymbolAsync(e,t):null;if(!i)return;if(i="web-style"===i.type?await i.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats,cache:t?.webStyleCache}):i.clone(),!(o&&"visualVariables"in o&&o.visualVariables?.length&&De(i)))return C(i,null,{add:a}),i;if("arcadeRequiredForVisualVariables"in o&&o.arcadeRequiredForVisualVariables&&null==t?.arcade){const e={...t};e.arcade=await l(),t=e}const{getColor:n,getOpacity:c,getAllSizes:u,getRotationAngle:m}=await import("../../chunks/visualVariableUtils.js").then(e=>e.l),p=[],h=[],f=[],y=[];for(const e of o.visualVariables)switch(e.type){case"color":p.push(e);break;case"opacity":h.push(e);break;case"rotation":y.push(e);break;case"size":e.target||f.push(e)}const b=!!p.length&&p[p.length-1],d=b?n(b,e,t):null,k=!!t?.ignoreOpacity,j=!!h.length&&h[h.length-1],g=j?c(j,e,t):null;if(C(i,d,k?void 0:{override:g,add:a}),f.length&&!0!==t?.ignoreSizeVariables){const s=u(f,e,t);await U(i,s)}if(!0!==t?.ignoreRotationVariables)for(const s of y)q(i,m(s,e,t),s.axis);return i}async function Re(e,t){if(!e)return;const{layer:s,sourceLayer:r}=e,a=qe(s??r);if(null!=e.symbol&&(null==t||!0!==t.ignoreGraphicSymbol)){const s="web-style"===e.symbol.type?await e.symbol.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats}):e.symbol.clone();return T(s,a)}const o=t?.renderer??He(s)??He(r);let i=o&&"getSymbolAsync"in o?await o.getSymbolAsync(e,t):void 0;if(!i)return;i="web-style"===i.type?await i.fetchSymbol({...t,acceptedFormats:t?.webStyleAcceptedFormats}):i.clone();const n=T(i,void 0);if(!o||!("visualVariables"in o)||"visualVariables"in o&&!o.visualVariables||"visualVariables"in o&&!o.visualVariables?.length||!De(i))return n?R(n,a):void 0;if("arcadeRequiredForVisualVariables"in o&&o.arcadeRequiredForVisualVariables&&null==t?.arcade){const e={...t};e.arcade=await l(),t=e}const{getColor:c,getOpacity:u}=await import("../../chunks/visualVariableUtils.js").then(e=>e.l),m=[],p=[];if(o.visualVariables)for(const e of o.visualVariables)switch(e.type){case"color":m.push(e);break;case"opacity":p.push(e)}const h=m.length>0?m[m.length-1]:null,f=(h?c(h,e,t):void 0)??n,y=p.length>0?p[p.length-1]:null,b=y?u(y,e,t):null;return null!=f&&null!=b&&(f.a=b),f?R(f,a):null}function De(e){return!S(e)||"water"!==e.symbolLayers.at(0)?.type}function He(e){if(e)return"renderer"in e?e.renderer:void 0}async function $e(e,t,s){if(!e)return;const{layer:l,sourceLayer:r}=e,a=s?.renderer??He(l)??He(r);if(!a)return null;if("visualVariables"in a&&a.visualVariables?.length){const{getRampStops:r}=await import("../../chunks/colorRampUtils2.js"),{getRampStops:o}=await import("../../chunks/sizeRampUtils.js"),{getDateFormatOptions:i}=await import("../../chunks/utils17.js");let n=null;for(const c of a.visualVariables){const u=t?i(l,c,t.timeZone):null;let m=null;switch(c.type){case"color":m=await r(c,null,u);break;case"opacity":m=await r(c);break;case"size":c.target||(m=await o(a,c,null,s?.scale||t?.scale,t,u))}if(m?.length){const t=m.find((t,s)=>{const l=e.attributes[c.field];return 0===s?l>=t.value:s===m?.length-1?l<=t.value:t.value===l});if(t){n=t.label;break}}}if(n)return n}switch(a.type){case"class-breaks":{const t="getClassBreakInfo"in a?await a.getClassBreakInfo(e,s):null;return t?.label??(t&&a.classBreakInfos?.length>1)?`${t.minValue} - ${t.maxValue}`:null}case"unique-value":{const t="getUniqueValueInfo"in a?await a.getUniqueValueInfo(e,s):null;return t?.label}}return null}async function Ve(e,l){e?.layer&&s(e.layer)&&((e=e.cloneShallow()).layer=e.layer.findSublayerForFeature(e)??null);const r=null===e?l?.fallbackSymbol??null:await Te(e,{ignoreGraphicSymbol:!!e.layer,ignoreOpacity:l?.ignoreOpacity??!0,ignoreRotationVariables:l?.ignoreRotationVariables??!0,ignoreSizeVariables:l?.ignoreSizeVariables??!0})??l?.fallbackSymbol??null;if(!r)return null;const a=await Ue(r,{geometry:l.useGeometryForShape?e?.geometry??null:null,useMarkerSymbolSize:!1!==l.useMarkerSymbolSize,size:{width:t(l.widthInPixels??16),height:t(l.heightInPixels??16)},..."cim"===r?.type?{cimOptions:{feature:{attributes:e?.attributes??{}}}}:{}});return a?"element"===(l?.format??"element")?a:a.outerHTML:null}export{je as a,ge as g,Re as getDisplayedColor,Te as getDisplayedSymbol,$e as getLegendLabel,Ve as previewGraphic,ee as r,Ce as renderColorRampPreviewHTML,ve as renderDotDensityPreviewHTML,Me as renderPieChartPreviewHTML,Ue as renderPreviewHTML,xe as renderRelationshipRampPreviewHTML};
