/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{d as e}from"../../chunks/colorUtils2.js";import s from"../../core/Error.js";import{clone as o}from"../../core/lang.js";import{b as r}from"../../chunks/ensureType.js";import{f as i}from"../../chunks/messages.js";import t from"../../renderers/ClassBreaksRenderer.js";import n from"../../renderers/PointCloudRGBRenderer.js";import a from"../../renderers/PointCloudStretchRenderer.js";import l from"../../renderers/support/AuthoringInfo.js";import p from"../../renderers/support/AuthoringInfoVisualVariable.js";import{setLabelsForClassBreaks as m,createColorStops as u}from"../../renderers/support/utils.js";import c from"../../renderers/visualVariables/ColorVariable.js";import d from"../../renderers/visualVariables/support/ColorStop.js";import{V as y}from"../../renderers/visualVariables/VisualVariable.js";import{a as h}from"../../chunks/ageUnit.js";import{b as f,o as j,e as b,d as v,f as g,h as w,u as k,v as T,g as S,c as x,i as V,j as E,k as z,l as I,m as U,n as M,p as C,a as B}from"../../chunks/utils21.js";import O from"../heuristics/sizeRange.js";import{s as D,u as P,p as F,g as R,a as q,h as L,b as A,f as G,c as Q,d as N}from"../../chunks/regenerateUtils.js";import{verifyDates as W,supportedAgeUnits as $}from"../statistics/support/ageUtils.js";import{v as Z}from"../../chunks/binningUtils.js";import{i as H,d as J,b as X}from"../../chunks/utils7.js";import{b as Y,f as K,c as _,g as ee}from"../../chunks/layerUtils3.js";import{cloneScheme as se,createScheme as oe,getSchemes as re,getSchemeById as ie}from"../symbology/color.js";import{g as te}from"../../chunks/utils22.js";import"../../Color.js";import"../../chunks/colorUtils.js";import"../../chunks/mathUtils.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/object.js";import"../../chunks/string.js";import"../../chunks/MapUtils.js";import"../../chunks/vec4.js";import"../../chunks/common.js";import"../../chunks/vec4f64.js";import"../../chunks/handleUtils.js";import"../../core/promiseUtils.js";import"../../chunks/events.js";import"../../chunks/maybe.js";import"../../chunks/locale.js";import"../../chunks/tslib.es6.js";import"../../chunks/jsonMap.js";import"../../core/accessorSupport/decorators/property.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/metadata.js";import"../../core/accessorSupport/decorators/cast.js";import"../../chunks/enumeration.js";import"../../chunks/reader.js";import"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/Lifecycle.js";import"../../chunks/tracking.js";import"../../chunks/Warning.js";import"../../chunks/writer.js";import"../../layers/support/fieldUtils.js";import"../../chunks/SetUtils.js";import"../../core/sql.js";import"../../chunks/guards.js";import"../../chunks/datetime.js";import"../../renderers/Renderer.js";import"../../core/JSONSupport.js";import"../../core/Accessor.js";import"../../core/Handles.js";import"../../chunks/ObjectPool.js";import"../../chunks/ObservableBase.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../chunks/PooledArray.js";import"../../chunks/SimpleTrackingTarget.js";import"../../chunks/colorRamps.js";import"../../rest/support/AlgorithmicColorRamp.js";import"../../rest/support/ColorRamp.js";import"../../rest/support/MultipartColorRamp.js";import"../../renderers/mixins/VisualVariablesMixin.js";import"../../renderers/visualVariables/OpacityVariable.js";import"../../renderers/visualVariables/support/OpacityStop.js";import"../../chunks/opacityUtils.js";import"../../core/Clonable.js";import"../../renderers/visualVariables/RotationVariable.js";import"../../renderers/visualVariables/SizeVariable.js";import"../../chunks/screenUtils.js";import"../../renderers/visualVariables/support/SizeStop.js";import"../../chunks/visualVariableUtils.js";import"../../Graphic.js";import"../../PopupTemplate.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";import"../../chunks/jsonUtils.js";import"../../popup/content.js";import"../../popup/content/AttachmentsContent.js";import"../../popup/content/Content.js";import"../../popup/support/AttachmentsOrderByInfo.js";import"../../popup/content/CustomContent.js";import"../../popup/content/ExpressionContent.js";import"../../popup/ElementExpressionInfo.js";import"../../popup/content/FieldsContent.js";import"../../popup/FieldInfo.js";import"../../popup/support/FieldInfoFormat.js";import"../../chunks/date.js";import"../../chunks/constants.js";import"../../popup/content/MediaContent.js";import"../../popup/content/BarChartMediaInfo.js";import"../../popup/content/mixins/ChartMediaInfo.js";import"../../popup/content/mixins/MediaInfo.js";import"../../popup/content/support/ChartMediaInfoValue.js";import"../../popup/content/support/ChartMediaInfoValueSeries.js";import"../../chunks/chartMediaInfoUtils.js";import"../../popup/content/ColumnChartMediaInfo.js";import"../../popup/content/ImageMediaInfo.js";import"../../popup/content/support/ImageMediaInfoValue.js";import"../../popup/content/LineChartMediaInfo.js";import"../../popup/content/PieChartMediaInfo.js";import"../../popup/content/RelationshipContent.js";import"../../popup/support/RelatedRecordsInfoFieldOrder.js";import"../../popup/content/TextContent.js";import"../../popup/content/UtilityNetworkAssociationsContent.js";import"../../popup/support/UtilityNetworkAssociationType.js";import"../../popup/ExpressionInfo.js";import"../../popup/LayerOptions.js";import"../../popup/RelatedRecordsInfo.js";import"../../support/actions/ActionBase.js";import"../../core/Identifiable.js";import"../../support/actions/ActionButton.js";import"../../support/actions/ActionToggle.js";import"../../core/reactiveUtils.js";import"../../geometry/support/jsonUtils.js";import"../../geometry/Extent.js";import"../../geometry/Geometry.js";import"../../geometry/SpatialReference.js";import"../../chunks/unitUtils.js";import"../../chunks/pe.js";import"../../chunks/assets.js";import"../../request.js";import"../../kernel.js";import"../../core/urlUtils.js";import"../../chunks/persistableUrlUtils.js";import"../../geometry/Point.js";import"../../geometry/support/webMercatorUtils.js";import"../../geometry/Multipoint.js";import"../../chunks/zmUtils.js";import"../../geometry/Polygon.js";import"../../chunks/coordsUtils.js";import"../../chunks/extentUtils.js";import"../../chunks/boundsUtils.js";import"../../chunks/aaBoundingRect.js";import"../../geometry/Polyline.js";import"../../chunks/typeUtils.js";import"../../chunks/createFeatureId.js";import"../../chunks/typeUtils2.js";import"../../symbols/CIMSymbol.js";import"../../symbols/Symbol.js";import"../../symbols/LabelSymbol3D.js";import"../../symbols/Symbol3D.js";import"../../chunks/collectionUtils.js";import"../../portal/Portal.js";import"../../core/Loadable.js";import"../../core/Promise.js";import"../../portal/PortalGroup.js";import"../../portal/PortalQueryParams.js";import"../../portal/PortalQueryResult.js";import"../../portal/PortalUser.js";import"../../portal/PortalFolder.js";import"../../symbols/ExtrudeSymbol3DLayer.js";import"../../symbols/Symbol3DLayer.js";import"../../chunks/utils3.js";import"../../symbols/edges/Edges3D.js";import"../../chunks/materialUtils.js";import"../../symbols/edges/SketchEdges3D.js";import"../../symbols/edges/SolidEdges3D.js";import"../../chunks/Symbol3DMaterial.js";import"../../symbols/FillSymbol3DLayer.js";import"../../symbols/patterns/LineStylePattern3D.js";import"../../symbols/patterns/StylePattern3D.js";import"../../chunks/utils4.js";import"../../chunks/colors.js";import"../../chunks/symbolLayerUtils3D.js";import"../../chunks/vec3f64.js";import"../../chunks/aaBoundingBox.js";import"../../chunks/DoubleArray.js";import"../../symbols/IconSymbol3DLayer.js";import"../../symbols/LineSymbol3DLayer.js";import"../../symbols/LineStyleMarker3D.js";import"../../chunks/lineMarkers.js";import"../../symbols/ObjectSymbol3DLayer.js";import"../../symbols/PathSymbol3DLayer.js";import"../../symbols/TextSymbol3DLayer.js";import"../../symbols/Font.js";import"../../symbols/WaterSymbol3DLayer.js";import"../../symbols/support/StyleOrigin.js";import"../../chunks/Thumbnail.js";import"../../chunks/calloutUtils.js";import"../../symbols/callouts/Callout3D.js";import"../../symbols/callouts/LineCallout3D.js";import"../../symbols/support/Symbol3DVerticalOffset.js";import"../../symbols/LineSymbol3D.js";import"../../symbols/MeshSymbol3D.js";import"../../symbols/PictureFillSymbol.js";import"../../symbols/FillSymbol.js";import"../../symbols/SimpleLineSymbol.js";import"../../symbols/LineSymbol.js";import"../../symbols/LineSymbolMarker.js";import"../../chunks/urlUtils.js";import"../../symbols/PictureMarkerSymbol.js";import"../../symbols/MarkerSymbol.js";import"../../symbols/PointSymbol3D.js";import"../../symbols/PolygonSymbol3D.js";import"../../symbols/SimpleFillSymbol.js";import"../../symbols/SimpleMarkerSymbol.js";import"../../symbols/TextSymbol.js";import"../../symbols/WebStyleSymbol.js";import"../../chunks/lengthUtils.js";import"../../renderers/support/ClassBreakInfo.js";import"../../chunks/commonProperties2.js";import"../../symbols/support/jsonUtils.js";import"../../chunks/layerUtils.js";import"../../layers/catalog/catalogUtils.js";import"../../chunks/defaults.js";import"../../chunks/defaultsJSON.js";import"../../chunks/RendererLegendOptions.js";import"../../renderers/PointCloudRenderer.js";import"../../chunks/PointSizeSplatAlgorithm.js";import"../../chunks/fieldsMap.js";import"../../chunks/numberUtils.js";import"../../intl.js";import"../../chunks/number.js";import"../../chunks/substitute.js";import"../../chunks/utils8.js";import"../../chunks/asyncUtils.js";import"../../chunks/jsonUtils2.js";import"../../chunks/parser.js";import"../../chunks/utils5.js";import"../../chunks/mat4.js";import"../../symbols/support/cimSymbolUtils.js";import"../../chunks/utils6.js";import"../../chunks/defaultCIMValues.js";import"../../chunks/gfxUtils.js";import"../../chunks/LRUCache.js";import"../../chunks/MemCache.js";import"../../chunks/colorRampUtils2.js";import"../../chunks/utils17.js";import"../../chunks/timeUtils.js";import"../../chunks/basemapUtils.js";import"../../chunks/basemapDefinitions.js";import"../../chunks/timeZoneUtils.js";import"../../renderers/support/HeatmapColorStop.js";import"../statistics/summaryStatisticsForAge.js";import"../statistics/summaryStatistics.js";import"../../chunks/utils14.js";import"../../chunks/quantizationUtils.js";import"../../chunks/heatmapUtils.js";import"../../chunks/utils13.js";import"../../chunks/generateRendererUtils.js";import"../../core/workers/workers.js";import"../../core/workers/Connection.js";import"../../chunks/Queue.js";import"../../core/workers/RemoteClient.js";import"../../renderers/support/jsonUtils.js";import"../../chunks/typeUtils3.js";import"../../renderers/DictionaryRenderer.js";import"../../chunks/DictionaryScriptEvaluator.js";import"../../chunks/Version.js";import"../../layers/support/FieldsIndex.js";import"../../chunks/UnknownTimeZone.js";import"../../chunks/ArcadeExpression.js";import"../../chunks/TimeOnly.js";import"../../chunks/enum.js";import"../../renderers/DotDensityRenderer.js";import"../../renderers/support/AttributeColorInfo.js";import"../../renderers/HeatmapRenderer.js";import"../../renderers/PieChartRenderer.js";import"../../renderers/SimpleRenderer.js";import"../../renderers/UniqueValueRenderer.js";import"../../chunks/diffUtils.js";import"../../renderers/support/UniqueValue.js";import"../../renderers/support/UniqueValueClass.js";import"../../renderers/support/UniqueValueGroup.js";import"../../renderers/support/UniqueValueInfo.js";import"../../chunks/styleUtils.js";import"../../chunks/utils9.js";import"../../chunks/DataLayerSource.js";import"../../layers/support/Field.js";import"../../chunks/domains.js";import"../../layers/support/CodedValueDomain.js";import"../../layers/support/Domain.js";import"../../layers/support/InheritedDomain.js";import"../../layers/support/RangeDomain.js";import"../../chunks/fieldType.js";import"../../chunks/executeQueryJSON.js";import"../../chunks/query.js";import"../../geometry/support/normalizeUtils.js";import"../../chunks/normalizeUtilsCommon.js";import"../../chunks/simplify.js";import"../../chunks/utils10.js";import"../../chunks/pbfQueryUtils.js";import"../../chunks/pbf.js";import"../../chunks/memoryEstimations.js";import"../../chunks/OptimizedGeometry.js";import"../../chunks/OptimizedFeature.js";import"../../chunks/OptimizedFeatureSet.js";import"../../chunks/queryZScale.js";import"../../chunks/zscale.js";import"../../rest/support/FeatureSet.js";import"../../rest/support/Query.js";import"../../chunks/FullTextSearch.js";import"../../chunks/spatialRelationships.js";import"../../rest/support/StatisticDefinition.js";import"../../time/TimeExtent.js";import"../statistics/support/predominanceUtils.js";import"../../chunks/statsWorker.js";import"../../rest/support/AttributeBinsQuery.js";import"../../chunks/queryUtils.js";import"../../chunks/projectionUtils.js";import"../../chunks/projectBuffer.js";import"../../chunks/geodesicConstants.js";import"../../chunks/projectXYZToVector.js";import"../../geometry/support/GeographicTransformation.js";import"../../geometry/support/GeographicTransformationStep.js";import"../../chunks/projectionSupport.js";import"../../chunks/json.js";import"../../rest/support/AutoIntervalBinParameters.js";import"../../rest/support/BinParametersBase.js";import"../../rest/support/AttributeBinsGrouping.js";import"../../rest/support/NormalizationBinParametersMixin.js";import"../../rest/support/DateBinParameters.js";import"../../rest/support/DateBinTimeInterval.js";import"../../rest/support/FixedBoundariesBinParameters.js";import"../../rest/support/FixedIntervalBinParameters.js";import"../../chunks/utils18.js";import"../../chunks/viewpointUtils.js";import"../../Viewpoint.js";import"../../Camera.js";import"../../CameraLayout.js";import"../../chunks/Cyclical.js";import"../../chunks/mat2d.js";import"../../chunks/mat2df64.js";import"../../chunks/vec2.js";import"../../chunks/vec2f64.js";import"../../chunks/scaleUtils.js";import"../../chunks/spatialStatistics.js";import"../statistics/classBreaks.js";import"../../views/support/colorUtils.js";import"../heuristics/scaleRange.js";import"../../chunks/colors2.js";import"../../chunks/symbologyUtils.js";const ne=2**53-1;async function ae(e){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new s("color-visual-variable:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.sqlExpression&&!e.view)throw new s("color-visual-variable:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&Z(e,"color-visual-variable");const o={...e},r=e.forBinning?Y:K,i=_(o.layer,r,e.forBinning);if(!i)throw new s("color-visual-variable:invalid-parameters","'layer' must be one of these types: "+ee(r).join(", "));const t=null!=o.signal?{signal:o.signal}:null;if(await i.load(t),"mesh"!==i.geometryType&&o.worldScale&&(!o.view||"3d"!==o.view.type))throw new s("color-visual-variable:invalid-parameters","'view' parameter should be an instance of SceneView when 'worldScale' parameter is true");const n=await J({field:o.field,normalizationField:o.normalizationField,valueExpression:o.valueExpression}),a=T(i,n,"color-visual-variable:invalid-parameters");if(a)throw a;return{...o,layer:i}}async function le(e){if(!(e&&e.layer&&(e.field||e.valueExpression||e.sqlExpression)))throw new s("color-continuous-renderer:missing-parameters","'layer' and 'field', 'valueExpression' or 'sqlExpression' parameters are required");if(e.valueExpression&&!e.sqlExpression&&!e.view)throw new s("color-continuous-renderer:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&Z(e,"color-continuous-renderer");const o={...e};o.symbolType=o.symbolType||"2d",o.defaultSymbolEnabled??=!0;const r=e.forBinning?Y:K,i=_(o.layer,r,e.forBinning);if(!i)throw new s("color-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+ee(r).join(", "));const t=null!=o.signal?{signal:o.signal}:null;await i.load(t);const n=i.geometryType;if(o.outlineOptimizationEnabled="polygon"===n&&o.outlineOptimizationEnabled,o.sizeOptimizationEnabled=("point"===n||"multipoint"===n||"polyline"===n)&&o.sizeOptimizationEnabled,"mesh"===n)o.symbolType="3d-volumetric",o.colorMixMode=o.colorMixMode||"replace",o.edgesType=o.edgesType||"none";else{if("3d-volumetric-uniform"===o.symbolType&&"point"!==n)throw new s("color-continuous-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(o.symbolType.includes("3d-volumetric")&&(!o.view||"3d"!==o.view.type))throw new s("color-continuous-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'")}const a=await J({field:o.field,normalizationField:o.normalizationField,valueExpression:o.valueExpression}),l=T(i,a,"color-continuous-renderer:invalid-parameters");if(l)throw l;return{...o,layer:i}}async function pe(e){if(!e||!e.layer||!e.field&&!e.valueExpression)throw new s("color-class-breaks-renderer:missing-parameters","'layer' and 'field' or 'valueExpression' parameters are required");if(e.valueExpression&&!e.view)throw new s("color-class-breaks-renderer:missing-parameters","View is required when 'valueExpression' is specified");e.forBinning&&Z(e,"color-class-breaks-renderer");const o={...e};o.symbolType=o.symbolType||"2d",o.defaultSymbolEnabled??=!0,o.classificationMethod??="equal-interval",o.normalizationType=X(o);const r=e.forBinning?Y:K,i=_(o.layer,r,e.forBinning);if(!i)throw new s("color-class-breaks-renderer:invalid-parameters","'layer' must be one of these types: "+ee(r).join(", "));if(!(null!=o.minValue&&null!=o.maxValue||null==o.minValue&&null==o.maxValue))throw new s("color-class-breaks-renderer:missing-parameters","Both 'minValue' and 'maxValue' are required when specifying custom data range");const t=null!=o.signal?{signal:o.signal}:null;await i.load(t);const n=i.geometryType;if(o.outlineOptimizationEnabled="polygon"===n&&o.outlineOptimizationEnabled,"mesh"===n)o.symbolType="3d-volumetric",o.colorMixMode=o.colorMixMode||"replace",o.edgesType=o.edgesType||"none";else{if("3d-volumetric-uniform"===o.symbolType&&"point"!==n)throw new s("color-class-breaks-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(o.symbolType.includes("3d-volumetric")&&(!o.view||"3d"!==o.view.type))throw new s("color-class-breaks-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'")}const a=await J({field:o.field,normalizationField:o.normalizationField}),l=T(i,a,"color-class-breaks-renderer:invalid-parameters");if(l)throw l;return{...o,layer:i}}function me(e){const s={...e};delete s.basemap,delete s.colorScheme,delete s.legendOptions,delete s.symbolType,delete s.defaultSymbolEnabled,delete s.colorMixMode,delete s.edgesType;const o=s;return o.analyzeData=!(null!=s.minValue&&null!=s.maxValue),o}function ue(e){const s={...e},o=!!s.symbolType?.includes("3d-volumetric");delete s.symbolType,delete s.defaultSymbolEnabled,delete s.colorMixMode,delete s.edgesType;const r=s;return r.worldScale=o,r}async function ce(e){if(!(e&&e.layer&&e.view&&e.startTime&&e.endTime))throw new s("color-age-renderer:missing-parameters","'layer', 'view', startTime', 'endTime' parameters are required");const o={...e};o.symbolType=o.symbolType||"2d",o.defaultSymbolEnabled??=!0;const r=_(o.layer,K);if(!r)throw new s("color-age-renderer:invalid-parameters","'layer' must be one of these types: "+ee(K).join(", "));const i=null!=o.signal?{signal:o.signal}:null;await r.load(i);const t=r.geometryType;if(o.outlineOptimizationEnabled="polygon"===t&&o.outlineOptimizationEnabled,o.sizeOptimizationEnabled=("point"===t||"multipoint"===t||"polyline"===t)&&o.sizeOptimizationEnabled,"mesh"===t)o.symbolType="3d-volumetric",o.colorMixMode=o.colorMixMode||"replace",o.edgesType=o.edgesType||"none";else if("3d-volumetric-uniform"===o.symbolType&&"point"!==t)throw new s("color-continuous-renderer:not-supported","3d-volumetric-uniform symbols are supported for point layers only");if(o.symbolType.includes("3d-volumetric")&&(!o.view||"3d"!==o.view.type))throw new s("color-age-renderer:invalid-parameters","'view' parameter should be an instance of SceneView when 'symbolType' parameter is '3d-volumetric' or '3d-volumetric-uniform'");const n=W(r,o.startTime,o.endTime,"color-age-renderer:invalid-parameters");if(n)throw n;if(o.unit&&!$.includes(o.unit))throw new s("color-age-renderer:invalid-unit",`Supported units are: ${$.join(", ")}`);return{...o,layer:r}}async function de(e,s){let o=e.colorScheme,r=null,i=null;const{view:t}=e,n=await B(e.basemap,t);if(r=null!=n.basemapId?n.basemapId:null,i=null!=n.basemapTheme?n.basemapTheme:null,o)return{scheme:se(o),basemapId:r,basemapTheme:i};const a=e.theme||"high-to-low",l=re({theme:a,basemapTheme:i,geometryType:e.geometryType,worldScale:e.worldScale,view:t});if(l)if(r=l.basemapId,i=l.basemapTheme,e.schemeId){const s=a+"/"+r+"/"+e.schemeId;o=ie({id:s,geometryType:e.geometryType})}else o=l.primaryScheme;return{scheme:o,basemapId:r,basemapTheme:i}}function ye(e,s,o,r){const i=S(e,s,o,!0);return{values:x(i,e,s,r),defaultValuesUsed:i.defaultValuesUsed}}async function he(e,s,o,r,n,a,l){const p=await i("esri/smartMapping/t9n/smartMapping"),{field:m,defaultSymbolEnabled:u}=l,c=se(e.colorScheme),d=s?.opacity,y=[e.visualVariable.clone()];return s?.visualVariables?.length&&y.push(...s.visualVariables.map(e=>e.clone())),o?.minSize&&y.push(o.minSize),{renderer:new t({classBreakInfos:[{minValue:-ne,maxValue:ne,symbol:V(a,{type:l.symbolType,color:c.noDataColor,size:z(c,a),outline:E(c,a,d),meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}})}],defaultLabel:u?p.other:null,defaultSymbol:u?V(a,{type:l.symbolType,color:c.noDataColor,size:z(c,a),outline:E(c,a,d),meshInfo:{colorMixMode:l.colorMixMode,edgesType:l.edgesType}}):null,field:m,normalizationType:r,normalizationField:n,valueExpression:l.valueExpression,valueExpressionTitle:l.valueExpressionTitle,visualVariables:y,authoringInfo:e.authoringInfo&&e.authoringInfo.clone()}),visualVariable:e.visualVariable.clone(),statistics:e.statistics,defaultValuesUsed:e.defaultValuesUsed,colorScheme:se(e.colorScheme),basemapId:e.basemapId,basemapTheme:e.basemapTheme}}async function fe(o){const i=await ae(o),{view:t,field:n,valueExpression:a,minValue:m,maxValue:u,layer:h,normalizationField:j,signal:b,filter:v,statistics:g}=i,w=j?"field":void 0,k=await(g??f({layer:h,field:n,valueExpression:a,sqlExpression:i.sqlExpression,sqlWhere:i.sqlWhere,normalizationType:w,normalizationField:j,minValue:m,maxValue:u,filter:v,view:t,signal:b})),T=h,S=n&&"function"!=typeof n?T.getField(n):null;return async function(o,i,t,n){const{field:a,theme:m}=o,u=await de({basemap:o.basemap,theme:o.theme,geometryType:t,colorScheme:o.colorScheme,worldScale:o.worldScale,view:o.view}),h=u.scheme;if(!h)throw new s("color-visual-variable:insufficient-info","Unable to find color scheme");const f=e(h.colors,5);if(f.length<5)throw new s("color-visual-variable:insufficient-info","Color scheme does not have enough colors");const j=h.id.includes("seq-"),{values:b,defaultValuesUsed:v}=ye(i,m,n,j),g=e(f,5),w=new c({field:a??void 0,valueExpression:o.valueExpression,valueExpressionTitle:o.valueExpressionTitle,normalizationField:o.normalizationField,stops:b.map((e,s)=>new d({value:e,color:g[s]})),legendOptions:r(y,o.legendOptions)}),k=new p({type:"color",minSliderValue:null!=o.minValue?o.minValue:i.min,maxSliderValue:null!=o.maxValue?o.maxValue:i.max,theme:h.theme}),T=new l({visualVariables:[k]});return{basemapId:u.basemapId,basemapTheme:u.basemapTheme,visualVariable:w,statistics:i,defaultValuesUsed:v,colorScheme:se(h),authoringInfo:T}}(i,k,T.geometryType,H(S))}async function je(o){const{view:r,filter:i,creatorParameters:t,renderer:n,signal:a}=await async function(e){const o="regenerate-color-visual-variable";await F(e,o);const r=await R(e);if("class-breaks"!==r?.type)throw new s(`${o}:invalid-parameters`,"Renderer must be a ClassBreaksRenderer to regenerate a color visual variable");const i=r.authoringInfo,t=i?.visualVariables.find(e=>"color"===e.type),n=r.visualVariables?.find(e=>"color"===e.type);if(!n)throw new s(`${o}:invalid-parameters`,"Renderer does not have a color visual variable");const{field:a,normalizationField:l,valueExpression:p,valueExpressionTitle:m}=n,u="univariate-color-size"===i?.type?i?.univariateTheme:t?.theme,{layer:c,forBinning:d,filter:y,view:h,signal:f}=e,j=await ae({layer:c,field:a,valueExpression:p,valueExpressionTitle:m,normalizationField:l,theme:u,forBinning:d,filter:y,view:h,signal:f});return{...e,creatorParameters:j,renderer:r}}(o),l=n.authoringInfo?.clone(),p=l?.visualVariables.find(e=>"color"===e.type),m=n.visualVariables?.find(e=>"color"===e.type),{field:u,normalizationField:c,valueExpression:y,theme:h,layer:j}=t,b=await f({layer:j,field:u,valueExpression:y,normalizationField:c,filter:i,view:r,signal:a}),v=u&&"function"!=typeof u?j.getField(u):null,{values:g}=ye(b,h,H(v),"high-to-low"===h);if(g.length===m.stops.length)m.stops.forEach((e,s)=>e.value=g[s]);else{const s=m.stops.map(e=>e.color),o=e(s,5);m.stops=g.map((e,s)=>new d({value:e,color:o[s]}))}return p&&(p.minSliderValue=b.min,p.maxSliderValue=b.max),{visualVariable:m,authoringInfo:l,statistics:b}}async function be(r,n){const a=await i("esri/smartMapping/t9n/smartMapping"),p=r.layer,u=r.defaultSymbolEnabled,c=p.geometryType,d=r.classificationMethod,y="standard-deviation"===d,h=await de({basemap:r.basemap,geometryType:c,theme:y?"above-and-below":null,colorScheme:r.colorScheme,worldScale:!!r.symbolType?.includes("3d-volumetric"),view:r.view}),f=h.scheme,{result:j,outlineResult:b}=n,v=j.classBreakInfos,g=r.normalizationType;if(!f)throw new s("color-class-breaks-renderer:insufficient-info","Unable to find color scheme");const w=function(s,r){const i=s.colorsForClassBreaks;if(i?.length)for(const e of i)if(e.numClasses===r)return o(e.colors);return e(s.colors,r)}(f,v.length);if(!w||w.length!==v.length)throw new s("color-class-breaks-renderer:insufficient-info","Color scheme does not have enough colors");const k=b?.opacity,T=new t({classBreakInfos:v.map((e,s)=>({minValue:e.minValue,maxValue:e.maxValue,symbol:V(c,{type:r.symbolType,color:w[s],size:z(f,c),outline:E(f,c,k),meshInfo:{colorMixMode:r.colorMixMode,edgesType:r.edgesType}}),label:e.label})),defaultLabel:u?a.other:null,defaultSymbol:u?V(c,{type:r.symbolType,color:f.noDataColor,size:z(f,c),outline:E(f,c,k),meshInfo:{colorMixMode:r.colorMixMode,edgesType:r.edgesType}}):null,field:r.field,valueExpression:r.valueExpression,valueExpressionTitle:r.valueExpressionTitle,normalizationType:g,normalizationField:r.normalizationField,normalizationTotal:"percent-of-total"===g?j.normalizationTotal:void 0,legendOptions:r.legendOptions,authoringInfo:new l({type:"class-breaks-color",classificationMethod:d,standardDeviationInterval:r.standardDeviationInterval})});return y||m({classBreakInfos:T.classBreakInfos,classificationMethod:d,normalizationType:g,round:!0}),b?.visualVariables?.length&&(T.visualVariables=b.visualVariables.map(e=>e.clone())),{renderer:T,colorScheme:se(f),classBreaksResult:j,defaultValuesUsed:n.defaultValuesUsed,basemapId:h.basemapId,basemapTheme:h.basemapTheme}}async function ve(e){const s=await le(e),{layer:o,view:r,signal:i,filter:t}=s,[n,a,l]=await Promise.all([fe(ue(s)),s.outlineOptimizationEnabled?j({layer:o,view:r,signal:i,filter:t}).catch(b):null,s.sizeOptimizationEnabled?O({layer:o,view:r,signal:i,filter:t}).catch(b):null]),p=s.normalizationField;return he(n,a,l,p?"field":void 0,p,o.geometryType,s)}async function ge(e){const{renderer:o,view:r,signal:i,filter:t,creatorParameters:n}=await async function(e){const o="regenerate-color-continuous-renderer";await F(e,o);const r=await R(e),i=q(r);if(!i||!["color-continuous","color-size"].includes(i))throw new s(`${o}:invalid-renderer`,"Renderer is invalid");const{authoringInfo:t,field:n,normalizationField:a,valueExpression:l,valueExpressionTitle:p}=r,m=t?.visualVariables.find(e=>"color"===e.type),u=m?.theme,{layer:c,forBinning:d,filter:y,view:h,signal:f}=e,j=L(r),b=A(r),v=await le({layer:c,field:n,valueExpression:l,valueExpressionTitle:p,normalizationField:a,theme:u,outlineOptimizationEnabled:j,sizeOptimizationEnabled:b,forBinning:d,filter:y,view:h,signal:f});return{...e,creatorParameters:v,renderer:r}}(e),{layer:a,outlineOptimizationEnabled:l,sizeOptimizationEnabled:p}=n,[m,u,c]=await Promise.all([je(e),l?j({layer:a,view:r,signal:i,filter:t}).catch(b):null,p?O({layer:a,view:r,signal:i,filter:t}).catch(b):null]);return D(o,m.visualVariable,G),D(o,u?.visualVariables,Q),D(o,c?.minSize,N),P(o,m.authoringInfo,"color"),{renderer:o}}async function we(e){const s=await pe(e);return be(s,await v(me(s),s.outlineOptimizationEnabled))}async function ke(e){const{renderer:o,creatorParameters:r}=await async function(e){const o="regenerate-color-class-breaks-renderer";await F(e,o);const r=await R(e);if("color-class-breaks"!==q(r))throw new s(`${o}:invalid-parameters`,"Renderer is invalid");const{authoringInfo:i,field:t,normalizationField:n,normalizationType:a,normalizationTotal:l,valueExpression:p,valueExpressionTitle:m}=r,{classificationMethod:u,standardDeviationInterval:c}=i,d=r.classBreakInfos.length,{layer:y,forBinning:h,filter:f,view:j,signal:b}=e,v=L(r),g=await pe({layer:y,field:t,valueExpression:p,valueExpressionTitle:m,normalizationType:a,normalizationField:n,normalizationTotal:l,classificationMethod:u,standardDeviationInterval:c,numClasses:d,outlineOptimizationEnabled:v,defaultSymbolEnabled:!!r.defaultSymbol,forBinning:h,filter:f,view:j,signal:b});return{...e,creatorParameters:g,renderer:r}}(e),{normalizationType:i,outlineOptimizationEnabled:t,classificationMethod:n}=r;if("manual"===n)return{renderer:o};const a=await v(me(r),t),l=a.result.classBreakInfos;if(r.numClasses!==l.length){const e=function(e,s){const o=te(e);return oe({geometryType:s},void 0,o.commonProps,o.colorRampInfo)}(o.classBreakInfos.map(e=>e.symbol),r.layer.geometryType);return{renderer:(await be({...r,colorScheme:e},a)).renderer}}return o.classBreakInfos.forEach((e,s)=>{e.minValue=l[s].minValue,e.maxValue=l[s].maxValue,e.label=l[s].label}),o.normalizationTotal="percent-of-total"===i?a.result.normalizationTotal:void 0,"standard-deviation"!==n&&m({classBreakInfos:o.classBreakInfos,classificationMethod:n,normalizationType:i,round:!0}),D(o,a.outlineResult?.visualVariables,Q),{renderer:o}}function Te(e){return async function(e){if(!e?.layer)throw new s("color-point-cloud-true-color-renderer:missing-parameters","'layer' parameter is required");const o={...e,layer:e.layer},r=[10],i=_(o.layer,r);if(!i)throw new s("color-point-cloud-true-color-renderer:invalid-parameters","'layer' must be one of these types: "+ee(r).join(", "));if(o.layer=i,o.density=o.density||25,o.size=o.size||"100%",!I(o.size))throw new s("color-point-cloud-true-color-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");const t=null!=o.signal?{signal:o.signal}:null;return await i.load(t),o}(e).then(e=>({renderer:new n({field:"RGB",pointsPerInch:e.density??void 0,pointSizeAlgorithm:g(e.size)})}))}async function Se(o){const r=await async function(e){if(!e?.layer||!e.field)throw new s("color-point-cloud-continuous-renderer:missing-parameters","'layer' and 'field' parameters are required");const o=e.field.toLowerCase();if("intensity"!==o&&"elevation"!==o)throw new s("color-point-cloud-continuous-renderer:invalid-parameters","'field' should be either 'intensity' or 'elevation'");const r={...e,layer:e.layer,field:e.field},i=[10],t=_(r.layer,i);if(!t)throw new s("color-point-cloud-continuous-renderer:invalid-parameters","'layer' must be one of these types: "+ee(i).join(", "));if(r.layer=t,r.density=r.density||25,r.size=r.size||"100%",!I(r.size))throw new s("color-point-cloud-continuous-renderer:invalid-parameters","Invalid 'size' parameter. It should be a string of the form '100%'");const n=null!=r.signal?{signal:r.signal}:null;return await t.load(n),r}(o),i=r.statistics??await f({layer:r.layer,field:r.field,signal:r.signal}),t=await async function(o,r){const i=r.layer,t=await de({basemap:r.basemap,colorScheme:r.colorScheme,geometryType:i.geometryType,schemeId:"elevation"===r.field.toLowerCase()?"point-cloud-elevation-scheme":"point-cloud-intensity-scheme"}),n=t.scheme;if(!n)throw new s("color-point-cloud-continuous-renderer:insufficient-info","Unable to find color scheme");const a=e(n.colors,5);if(a.length<5)throw new s("color-point-cloud-continuous-renderer:insufficient-info","Color scheme does not have enough colors");const l=U(o,!1,!0),p=l?M(l[0],l[1],5):C(o);return{stops:u({values:p,isDate:!1,colors:a,labelIndexes:[0,2,4]}),basemapId:t.basemapId,basemapTheme:t.basemapTheme,statistics:o,defaultValuesUsed:!!l,colorScheme:se(n)}}(i,r);return{renderer:new a({field:r.field,pointsPerInch:r.density??void 0,pointSizeAlgorithm:g(r.size),stops:t.stops}),basemapId:t.basemapId,basemapTheme:t.basemapTheme,statistics:t.statistics,defaultValuesUsed:t.defaultValuesUsed,colorScheme:t.colorScheme}}async function xe(e){const s=await ce(e),{defaultSymbolEnabled:o,view:r,startTime:i,endTime:t,symbolType:n,colorMixMode:a,edgesType:l,minValue:p,maxValue:m,signal:u,filter:c}=s,d=s.layer,[y,f,v]=await Promise.all([s.unit?{unit:s.unit,statistics:null}:h({view:r,layer:d,startTime:i,endTime:t,minValue:p,maxValue:m,signal:u,filter:c}),s.outlineOptimizationEnabled?j({layer:d,view:r,signal:u,filter:c}).catch(b):null,s.sizeOptimizationEnabled?O({layer:d,view:r,signal:u,filter:c}).catch(b):null]),{unit:g,statistics:T}=y,{valueExpression:S,title:x}=await w(s,g),V=await fe(ue({layer:d,basemap:s.basemap,valueExpression:S,symbolType:n,statistics:T,legendOptions:{title:x},colorScheme:s.colorScheme,theme:s.theme,view:r,minValue:s.minValue,maxValue:s.maxValue,filter:c,signal:u})),E={valueExpression:S,defaultSymbolEnabled:o,symbolType:n,colorMixMode:a,edgesType:l},z=await he(V,f,v,null,null,d.geometryType,E),I=z.renderer.authoringInfo?.visualVariables;return I?.forEach(e=>k(e,i,t,g)),{...z,unit:g}}async function Ve(e){const{renderer:o,creatorParameters:r}=await async function(e){const o="regenerate-color-age-renderer";await F(e,o);const r=await R(e);if("color-age"!==q(r))throw new s(`${o}:invalid-parameters`,"Renderer is invalid");const{authoringInfo:i}=r,t=i?.visualVariables.find(e=>"color"===e.type),n=t.startTime,a=t.endTime,l=t.units,p=t.theme,{layer:m,filter:u,view:c,signal:d}=e,y=L(r),h=A(r),f=await ce({layer:m,startTime:n,endTime:a,unit:l,theme:p,outlineOptimizationEnabled:y,sizeOptimizationEnabled:h,filter:u,view:c,signal:d});return{...e,creatorParameters:f,renderer:r}}(e),{layer:i,outlineOptimizationEnabled:t,sizeOptimizationEnabled:n,startTime:a,endTime:l,theme:p,view:m,signal:u,filter:c}=r,[d,y,f]=await Promise.all([h({view:m,layer:i,startTime:a,endTime:l,signal:u,filter:c}),t?j({layer:i,view:m,signal:u,filter:c}).catch(b):null,n?O({layer:i,view:m,signal:u,filter:c}).catch(b):null]),{unit:v,statistics:g}=d,{valueExpression:T,title:S}=await w(r,v),x=await fe(ue({layer:i,valueExpression:T,statistics:g,legendOptions:{title:S},theme:p,view:m,filter:c,signal:u}));D(o,x.visualVariable,G),D(o,y?.visualVariables,Q),D(o,f?.minSize,N),o.authoringInfo=x.authoringInfo.clone();const V=o.authoringInfo?.visualVariables;return V?.forEach(e=>k(e,a,l,v)),{renderer:o}}export{xe as createAgeRenderer,we as createClassBreaksRenderer,ve as createContinuousRenderer,Se as createPCContinuousRenderer,Te as createPCTrueColorRenderer,fe as createVisualVariable,Ve as regenerateAgeRenderer,ke as regenerateClassBreaksRenderer,ge as regenerateContinuousRenderer,je as regenerateVisualVariable};
