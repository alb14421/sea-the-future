/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{h as t}from"../core/lang.js";import{i as s,p as e}from"../request.js";import{c as r}from"./infoFor3D.js";function p(t,s,e){return!!u(t,s,e)}function o(t,s,e){return u(t,s,e)}function u(t,s,e){return t&&t.hasOwnProperty(s)?t[s]:e}const n={name:"supportsName",size:"supportsSize",contentType:"supportsContentType",keywords:"supportsKeywords",exifInfo:"supportsExifInfo"};function a(t){const s=t?.supportedSpatialAggregationStatistics?.map(t=>t.toLowerCase());return{envelope:!!s?.includes("envelopeaggregate"),centroid:!!s?.includes("centroidaggregate"),convexHull:!!s?.includes("convexhullaggregate")}}function i(t,s){const e=t?.supportedOperationsWithCacheHint?.map(t=>t.toLowerCase());return!!e?.includes(s.toLowerCase())}function c(t){const s=t?.supportedStatisticTypes?.map(t=>t.toLowerCase());return{count:!!s?.includes("count"),sum:!!s?.includes("sum"),min:!!s?.includes("min"),max:!!s?.includes("max"),avg:!!s?.includes("avg"),var:!!s?.includes("var"),stddev:!!s?.includes("stddev"),percentileContinuous:!!s?.includes("percentile_cont"),percentileDiscrete:!!s?.includes("percentile_disc"),envelope:!!s?.includes("envelopeaggregate"),centroid:!!s?.includes("centroidaggregate"),convexHull:!!s?.includes("convexhullaggregate")}}function l(t){const s=t?.supportedNormalizationTypes?.map(t=>t.toLowerCase());return{field:!!s?.includes("field"),log:!!s?.includes("log"),naturalLog:!!s?.includes("naturallog"),percentOfTotal:!!s?.includes("percentoftotal"),squareRoot:!!s?.includes("squareroot")}}function d(t,s){return{analytics:y(t),attachment:m(t),data:g(t),metadata:C(t),operations:v(t.capabilities,t,s),query:h(t,s),queryAttributeBins:A(t),queryRelated:f(t),queryTopFeatures:S(t),editing:Q(t)}}function y(t){return{supportsCacheHint:i(t.advancedQueryCapabilities,"queryAnalytics")}}function m(t){const s=t.attachmentProperties,e={supportsName:!1,supportsSize:!1,supportsContentType:!1,supportsKeywords:!1,supportsExifInfo:!1,supportsCacheHint:i(t.advancedQueryCapabilities,"queryAttachments"),supportsOrderByFields:p(t.advancedQueryCapabilities,"supportsQueryAttachmentOrderByFields",!1),supportsResize:p(t,"supportsAttachmentsResizing",!1)};return s&&Array.isArray(s)&&s.forEach(t=>{const s=n[t.name];s&&(e[s]=!!t.isEnabled)}),e}function g(t){return{isVersioned:p(t,"isDataVersioned",!1),isBranchVersioned:p(t,"isDataBranchVersioned",!1),supportsAttachment:p(t,"hasAttachments",!1),supportsM:p(t,"hasM",!1),supportsZ:p(t,"hasZ",!1)}}function C(t){return{supportsAdvancedFieldProperties:p(t,"supportsFieldDescriptionProperty",!1)}}function v(t,s,r){const o=t?.toLowerCase().split(",").map(t=>t.trim())??[],u=r?e(r):null,n=o.includes("MapServer"===u?.serverType?"data":"query"),a=o.includes("editing")&&!s.datesInUnknownTimezone&&!(!0===s.uniqueIdInfo?.OIDFieldContainsHashValue);let i=a&&o.includes("create"),c=a&&o.includes("delete"),l=a&&o.includes("update");const d=o.includes("changetracking"),y=s.advancedQueryCapabilities;return a&&!(i||c||l)&&(i=c=l=!0),{supportsCalculate:p(s,"supportsCalculate",!1),supportsTruncate:p(s,"supportsTruncate",!1),supportsValidateSql:p(s,"supportsValidateSql",!1),supportsAdd:i,supportsDelete:c,supportsEditing:a,supportsChangeTracking:d,supportsQuery:n,supportsQueryAnalytics:p(y,"supportsQueryAnalytic",!1),supportsQueryAttachments:p(y,"supportsQueryAttachments",!1),supportsQueryBins:p(y,"supportsQueryBins",!1)||!!s.queryBinsCapabilities,supportsQueryTopFeatures:p(y,"supportsTopFeaturesQuery",!1),supportsResizeAttachments:p(s,"supportsAttachmentsResizing",!1),supportsSync:o.includes("sync"),supportsUpdate:l,supportsExceedsLimitStatistics:p(s,"supportsExceedsLimitStatistics",!1),supportsAsyncConvert3D:p(s,"supportsAsyncConvert3D",!1)}}function h(e,u){const n=e.advancedQueryCapabilities,c=e.ownershipBasedAccessControlForFeatures,l=e.archivingInfo,d=e.currentVersion,y=u?.includes("MapServer"),m=!y||d>=t("mapserver-pbf-version-support"),g=s(u),C=new Set((e.supportedQueryFormats??"").split(",").map(t=>t.toLowerCase().trim()));return{maxRecordCount:o(e,"maxRecordCount",void 0),maxRecordCountFactor:o(e,"maxRecordCountFactor",void 0),maxUniqueIDCount:o(e,"maxUniqueIDCount",void 0),standardMaxRecordCount:o(e,"standardMaxRecordCount",void 0),supportedSpatialAggregationStatistics:a(n),supportsCacheHint:p(n,"supportsQueryWithCacheHint",!1)||i(n,"query"),supportsCentroid:p(n,"supportsReturningGeometryCentroid",!1),supportsCompactGeometry:g,supportsCurrentUser:p(n,"supportsCurrentUserQueries",!1),supportsDefaultSpatialReference:p(n,"supportsDefaultSR",!1),supportsDisjointSpatialRelationship:p(n,"supportsDisjointSpatialRel",!1),supportsDistance:p(n,"supportsQueryWithDistance",!1),supportsDistinct:p(n,"supportsDistinct",e.supportsAdvancedQueries),supportsExtent:p(n,"supportsReturningQueryExtent",!1),supportsFormatPBF:m&&C.has("pbf"),supportsFullTextSearch:p(n,"supportsFullTextSearch",!1),supportsGeometryProperties:p(n,"supportsReturningGeometryProperties",!1),supportsHavingClause:p(n,"supportsHavingClause",!1),supportsHistoricMoment:p(l,"supportsQueryWithHistoricMoment",!1),supportsMaxRecordCountFactor:p(n,"supportsMaxRecordCountFactor",!1),supportsOrderBy:p(n,"supportsOrderBy",e.supportsAdvancedQueries),supportsPagination:p(n,"supportsPagination",!1),supportsPaginationOnAggregatedQueries:p(n,"supportsPaginationOnAggregatedQueries",!1),supportsPercentileStatistics:p(n,"supportsPercentileStatistics",!1),supportsQuantization:p(e,"supportsCoordinatesQuantization",!1),supportsQuantizationEditMode:p(e,"supportsQuantizationEditMode",!1),supportsQueryByAnonymous:p(c,"allowAnonymousToQuery",!0),supportsQueryByOthers:p(c,"allowOthersToQuery",!0),supportsQueryGeometry:p(e,"supportsReturningQueryGeometry",!1),supportsResultType:p(n,"supportsQueryWithResultType",!1),supportsReturnMesh:!!r(e.infoFor3D),supportsSpatialAggregationStatistics:p(n,"supportsSpatialAggregationStatistics",!1),supportsSqlExpression:p(n,"supportsSqlExpression",!1),supportsStandardizedQueriesOnly:p(e,"useStandardizedQueries",!1),supportsStatistics:p(n,"supportsStatistics",e.supportsStatistics),supportsTopFeaturesQuery:p(n,"supportsTopFeaturesQuery",!1),supportsTrueCurve:p(n,"supportsTrueCurve",!1),tileMaxRecordCount:o(e,"tileMaxRecordCount",void 0)}}function f(t){const s=t.advancedQueryCapabilities,e=p(s,"supportsAdvancedQueryRelated",!1);return{supportsPagination:p(s,"supportsQueryRelatedPagination",!1),supportsCount:e,supportsOrderBy:e,supportsCacheHint:i(s,"queryRelated")}}function S(t){return{supportsCacheHint:i(t.advancedQueryCapabilities,"queryTopFilter")}}function A(t){const s=t?t.queryBinsCapabilities:void 0;return{supportsDate:p(s,"supportsDateBin",!1),supportsFixedInterval:p(s,"supportsFixedIntervalBin",!1),supportsAutoInterval:p(s,"supportsAutoIntervalBin",!1),supportsFixedBoundaries:p(s,"supportsFixedBoundariesBin",!1),supportsStackBy:p(s,"supportsStackBy",!1),supportsSplitBy:p(s,"supportsSplitBy",!1),supportsSnapToData:p(s,"supportsSnapToData",!1),supportsReturnFullIntervalBin:p(s,"supportsReturnFullIntervalBin",!1),supportsFirstDayOfWeek:p(s,"supportsFirstDayOfWeek",!1),supportsNormalization:p(s,"supportsNormalization",!1),supportedStatistics:c(s),supportedNormalizationTypes:l(s)}}function Q(t){const s=t.ownershipBasedAccessControlForFeatures,e=t?t.advancedEditingCapabilities:void 0;return{supportsGeometryUpdate:p(t,"allowGeometryUpdates",!0),supportsGlobalId:p(t,"supportsApplyEditsWithGlobalIds",!1),supportsReturnServiceEditsInSourceSpatialReference:p(t,"supportsReturnServiceEditsInSourceSR",!1),supportsRollbackOnFailure:p(t,"supportsRollbackOnFailureParameter",!1),supportsUpdateWithoutM:p(t,"allowUpdateWithoutMValues",!1),supportsUploadWithItemId:p(t,"supportsAttachmentsByUploadId",!1),supportsDeleteByAnonymous:p(s,"allowAnonymousToDelete",!0),supportsDeleteByOthers:p(s,"allowOthersToDelete",!0),supportsUpdateByAnonymous:p(s,"allowAnonymousToUpdate",!0),supportsUpdateByOthers:p(s,"allowOthersToUpdate",!0),supportsAsyncApplyEdits:p(e,"supportsAsyncApplyEdits",!1),zDefault:o(t,"zDefault",void 0)}}function x(t){return{operations:{supportsAppend:p(t,"supportsAppend",!1),supportsCoverageQuery:t?.playbackInfo?.klv["0601"]??!1,supportsExportClip:p(t,"supportsExportClip",!1),supportsExportFrameset:p(t,"supportsExportFrameset",!1),supportsMensuration:p(t,"supportsMensuration",!1),supportsPreviews:p(t,"supportsPreviews",!1),supportsUpdate:p(t,"supportsUpdate",!1)}}}export{o as a,x as b,d as g,p as r};
