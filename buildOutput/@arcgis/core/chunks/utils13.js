/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{c as e,C as n}from"./generateRendererUtils.js";const l=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,t=new Set(["esriFieldTypeDate","esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong","esriFieldTypeOID","esriFieldTypeBigInteger"]),i=new Set(["esriFieldTypeTimeOnly","esriFieldTypeDateOnly"]),a=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function o(e){return null==e||"string"==typeof e&&!e?"<Null>":e}function u(e){const n=null!=e.normalizationField||null!=e.normalizationType,l=null!=e.minValue||null!=e.maxValue,t=!!e.sqlExpression&&e.supportsSQLExpression;return!n&&!l&&!t}function r(e){const{outStatisticTypes:n}=e,l=e.returnDistinct?[...new Set(e.values)]:e.values,t=l.filter(e=>null!=e).sort(),i=t.length,a={count:i,min:t[0],max:t[i-1]};return e.supportsNullCount&&(a.nullcount=l.length-i),!e.percentileParams||n?.include?.length&&!n.include.includes("median")||n?.exclude?.length&&n.exclude.includes("median")||(a.median=c(l,e.percentileParams)),a}function s(e){const{values:n,useSampleStdDev:l,supportsNullCount:t,outStatisticTypes:i}=e;let a=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,u=null,r=null,s=null,d=null,m=0;const f=null==e.minValue?-1/0:e.minValue,p=null==e.maxValue?1/0:e.maxValue;for(const e of n)Number.isFinite(e)?e>=f&&e<=p&&(u=null===u?e:u+e,a=Math.min(a,e),o=Math.max(o,e),m++):"string"==typeof e&&m++;if(m&&null!=u){r=u/m;let e=0;for(const l of n)Number.isFinite(l)&&l>=f&&l<=p&&(e+=(l-r)**2);d=l?m>1?e/(m-1):0:m>0?e/m:0,s=Math.sqrt(d)}else a=null,o=null;const v={avg:r,count:m,max:o,min:a,stddev:s,sum:u,variance:d};return t&&(v.nullcount=n.length-m),!e.percentileParams||i?.include?.length&&!i.include.includes("median")||i?.exclude?.length&&i.exclude.includes("median")||(v.median=c(n,e.percentileParams)),v}function c(e,n){const{fieldType:l,value:t,orderBy:i,isDiscrete:a}=n,o=d(l,"desc"===i);if(0===(e=[...e].filter(e=>null!=e).sort((e,n)=>o(e,n))).length)return null;if(t<=0)return e[0];if(t>=1)return e[e.length-1];const u=(e.length-1)*t,r=Math.floor(u),s=r+1,c=u%1,m=e[r],f=e[s];return s>=e.length||a||"string"==typeof m||"string"==typeof f?m:m*(1-c)+f*c}function d(e,n){if(e){if(t.has(e))return F(n);if(i.has(e))return x(n,!1);if("esriFieldTypeTimestampOffset"===e)return function(e){return e?g:v}(n);const l=x(n,!0);if("esriFieldTypeString"===e)return l;if("esriFieldTypeGUID"===e||"esriFieldTypeGlobalID"===e)return(e,n)=>l(I(e),I(n))}const l=n?1:-1,a=F(n),o=x(n,!0),u=p(n);return(e,n)=>"number"==typeof e&&"number"==typeof n?a(e,n):"string"==typeof e&&"string"==typeof n?o(e,n):u(e,n)??l}const m=(e,n)=>null==e?null==n?0:1:null==n?-1:null,f=(e,n)=>null==e?null==n?0:-1:null==n?1:null;function p(e){return e?m:f}const v=(e,n)=>f(e,n)??(e===n?0:new Date(e).getTime()-new Date(n).getTime()),g=(e,n)=>m(e,n)??(e===n?0:new Date(n).getTime()-new Date(e).getTime()),h=(e,n)=>f(e,n)??(e===n?0:e<n?-1:1),T=(e,n)=>m(e,n)??(e===n?0:e<n?1:-1);function x(e,n){if(!n)return e?T:h;const l=p(e);return e?(e,n)=>{const t=l(e,n);return null!=t?t:(e=e.toUpperCase())>(n=n.toUpperCase())?-1:e<n?1:0}:(e,n)=>{const t=l(e,n);return null!=t?t:(e=e.toUpperCase())<(n=n.toUpperCase())?-1:e>n?1:0}}const y=(e,n)=>m(e,n)??n-e,V=(e,n)=>f(e,n)??e-n;function F(e){return e?y:V}function I(e){return e.slice(24,36)+e.slice(19,23)+e.slice(16,18)+e.slice(14,16)+e.slice(11,13)+e.slice(9,11)+e.slice(6,8)+e.slice(4,6)+e.slice(2,4)+e.slice(0,2)}function b(e,n,l){let t;for(t in e)n?.include?.length&&!n.include.includes(t)||n?.exclude?.length&&n.exclude.includes(t)?delete e[t]:a.includes(t)&&(Number.isFinite(e[t])||(e[t]=null));return l?(["avg","stddev","variance"].forEach(n=>{null!=e[n]&&(e[n]=Math.ceil(e[n]??0))}),e):e}function z(e){const n={};for(let l of e)(null==l||"string"==typeof l&&""===l.trim())&&(l=null),null==n[l]?n[l]={count:1,data:l}:n[l].count++;return{count:n}}function D(e){return"coded-value"!==e?.type?[]:e.codedValues.map(e=>e.code)}function S(e,n,l,t){const i=e.count,a=[];if(l&&n){const e=[],l=D(n[0]);for(const i of l)if(n[1]){const l=D(n[1]);for(const a of l)if(n[2]){const l=D(n[2]);for(const n of l)e.push(`${o(i)}${t}${o(a)}${t}${o(n)}`)}else e.push(`${o(i)}${t}${o(a)}`)}else e.push(i);for(const n of e)i.hasOwnProperty(n)||(i[n]={data:n,count:0})}for(const e in i){const n=i[e];a.push({value:n.data,count:n.count,label:n.label})}return{uniqueValueInfos:a}}function N(e,n,l,t){let i=null;switch(n){case"log":0!==e&&(i=Math.log(e)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(t)&&0!==t&&(i=e/t*100);break;case"field":Number.isFinite(l)&&0!==l&&(i=e/l);break;case"natural-log":e>0&&(i=Math.log(e));break;case"square-root":e>0&&(i=e**.5)}return i}function M(n,l,t){const i=C({field:l.field,normalizationType:l.normalizationType,normalizationField:l.normalizationField,classificationMethod:l.classificationMethod,standardDeviationInterval:l.standardDeviationInterval,definedInterval:l.definedInterval,breakCount:l.numClasses||5});return n=function(e,n,l){const t=n??-1/0,i=l??1/0;return e.filter(e=>Number.isFinite(e)&&e>=t&&e<=i)}(n,l.minValue,l.maxValue),e({definition:i,values:n,normalizationTotal:l.normalizationTotal},t)}function C(e){const{breakCount:l,field:t,normalizationField:i,normalizationType:a}=e,o=e.classificationMethod||"equal-interval",u="standard-deviation"===o?e.standardDeviationInterval||1:void 0,r="defined-interval"===o?e.definedInterval:void 0;return new n({breakCount:l,classificationField:t,classificationMethod:o,normalizationField:"field"===a?i:void 0,normalizationType:a,standardDeviationInterval:u,definedInterval:r})}function k(e,n){let t=e.classBreaks;const i=t.length,a=t[0]?.minValue,o=t[i-1]?.maxValue,u="standard-deviation"===n,r=l;return t=t.map(e=>{const n=e.label,l={minValue:e.minValue,maxValue:e.maxValue,label:n};if(u&&n){const e=n.match(r),t=e?.map(e=>+e.trim())??[];2===t.length?(l.minStdDev=t[0],l.maxStdDev=t[1],t[0]<0&&t[1]>0&&(l.hasAvg=!0)):1===t.length&&(n.includes("<")?(l.minStdDev=null,l.maxStdDev=t[0]):n.includes(">")&&(l.minStdDev=t[0],l.maxStdDev=null))}return l}),{minValue:a,maxValue:o,classBreakInfos:t,normalizationTotal:e.normalizationTotal}}function w(e,n){const l=$(e,n);if(null==l.min&&null==l.max)return{bins:[],minValue:l.min,maxValue:l.max,normalizationTotal:n.normalizationTotal};const t=l.intervals,i=l.min??0,a=l.max??0,o=t.map((e,n)=>({minValue:t[n][0],maxValue:t[n][1],count:0}));for(const n of e)if(null!=n&&n>=i&&n<=a){const e=E(t,n);e>-1&&o[e].count++}return{bins:o,minValue:i,maxValue:a,normalizationTotal:n.normalizationTotal}}function $(e,n,l=!1){const{field:t,classificationMethod:i,standardDeviationInterval:a,definedInterval:o,normalizationType:r,normalizationField:c,normalizationTotal:d,minValue:m,maxValue:f}=n,p=n.numBins||10;let v=null,g=null,h=null;if(i&&"equal-interval"!==i||r){const{classBreaks:n}=M(e,{field:t,normalizationType:r,normalizationField:c,normalizationTotal:d,classificationMethod:i,standardDeviationInterval:a,definedInterval:o,minValue:m,maxValue:f,numClasses:p},null!=m&&null!=f?[m,f]:void 0);v=n[0]?.minValue,g=n[n.length-1]?.maxValue,h=n.map(e=>[e.minValue,e.maxValue])}else{if(null!=m&&null!=f)v=m,g=f;else{const n=s({values:e,minValue:m,maxValue:f,useSampleStdDev:!r,supportsNullCount:u({normalizationType:r,normalizationField:c,minValue:m,maxValue:f})});v=n.min??null,g=n.max??null}h=O(v??0,g??0,p)}if(l&&h.length){const e=h.at(-1)[1];h.push([e,e])}return{min:v,max:g,intervals:h}}function E(e,n){let l=-1;for(let t=e.length-1;t>=0;t--)if(n>=e[t][0]){l=t;break}return l}function O(e,n,l){const t=(n-e)/l,i=[];let a,o=e;for(let e=1;e<=l;e++)a=o+t,a=Number(a.toFixed(16)),i.push([o,e===l?n:a]),o=a;return i}export{N as a,O as b,r as c,s as d,b as e,z as f,d as g,S as h,u as i,M as j,w as k,c as l,E as m,$ as n,C as o,o as p,k as r,a as s};
