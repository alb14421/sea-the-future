/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{i as t,a as e}from"./devEnvironmentUtils.js";import o from"../core/Error.js";import{urlToObject as l,removeFile as r}from"../core/urlUtils.js";import s from"../portal/Portal.js";import{f as a}from"./persistableUrlUtils.js";import{fromJSON as n}from"../symbols/support/jsonUtils.js";import m from"../symbols/support/StyleOrigin.js";import{f as i,S as y,r as u,m as f,s as p}from"./styleUtils.js";import{T as c}from"./Thumbnail.js";import{i as b}from"./typeUtils2.js";const g=["web-gltf","web","cim"];function d(t,e,a){const m=t.name;return null==m?Promise.reject(new o("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference")):"Esri2DPointSymbolsStyle"===t.styleName?function(t,e,o){const a=y.replaceAll(/\{SymbolName\}/gi,t),m=null!=e.portal?e.portal:s.getDefault();return u(a,o).then(t=>{const e=f(t.data);return n(e,{portal:m,url:l(r(a)),origin:"portal-item"})})}(m,e,a):i(t,e,a).then(t=>j(t,m,e,p,a))}function h(t,e){return e.items.find(e=>e.name===t)}async function j(i,y,p,d,j){const S=null!=p?.portal?p.portal:s.getDefault(),w={portal:S,url:l(i.baseUrl)},U=h(y,i.data);if(!U)throw new o("symbolstyleutils:symbol-name-not-found",`The symbol name '${y}' could not be found`,{symbolName:y});const N=j?.acceptedFormats??g,v=d(U,N);if(!v)throw new o("symbolstyleutils:symbol-reference-no-accepted-format",`The symbol name '${y}' does not have an accepted format (one of ${N})`,{symbolName:y});const{url:O,format:T}=v;let D=a(O,w),P=U.thumbnail?.href??null;const $=U.thumbnail?.imageData;t()&&(D=e(D)??"",P=e(P));const _={portal:S,url:l(r(D)),origin:"portal-item"};return u(D,j).then(t=>{const e="cim"===T?f(t.data):t.data,o=n(e,_);if(o&&b(o)){if(P){const t=a(P,w);o.thumbnail=new c({url:t})}else $&&(o.thumbnail=new c({url:`data:image/png;base64,${$}`}));i.styleUrl?o.styleOrigin=new m({portal:p.portal,styleUrl:i.styleUrl,name:y}):i.styleName&&(o.styleOrigin=new m({portal:p.portal,styleName:i.styleName,name:y}))}return o})}const S=Object.freeze(Object.defineProperty({__proto__:null,fetchSymbolFromStyle:j,getStyleItemFromStyle:h,resolveWebStyleSymbol:d},Symbol.toStringTag,{value:"Module"}));export{g as d,j as f,h as g,d as r,S as w};
