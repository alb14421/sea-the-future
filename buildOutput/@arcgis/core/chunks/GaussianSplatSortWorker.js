/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{c as t}from"./vec3f64.js";import{c as r}from"./aaBoundingBox.js";import"../geometry/Extent.js";import"./tslib.es6.js";import"./string.js";import"./object.js";import"../core/lang.js";import"../core/accessorSupport/decorators/property.js";import"./Logger.js";import"../config.js";import"./ensureType.js";import"./MapUtils.js";import"./get.js";import"./utils.js";import"./handleUtils.js";import"./metadata.js";import"../core/Error.js";import"../core/accessorSupport/decorators/subclass.js";import"./Lifecycle.js";import"./tracking.js";import"./Warning.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"../core/Handles.js";import"./maybe.js";import"./ObjectPool.js";import"./ObservableBase.js";import"./watch.js";import"../core/scheduling.js";import"./nextTick.js";import"./PooledArray.js";import"../core/promiseUtils.js";import"./events.js";import"./SetUtils.js";import"./SimpleTrackingTarget.js";import"./reader.js";import"../geometry/SpatialReference.js";import"./unitUtils.js";import"./jsonMap.js";import"./pe.js";import"./assets.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"./jsonUtils.js";import"./persistableUrlUtils.js";import"./writer.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../geometry/support/webMercatorUtils.js";import"./aaBoundingRect.js";import"./mathUtils.js";import"./DoubleArray.js";class o{constructor(t){this.newSortOrder=t}}let s=t(),e=t();const i=r();let a=null,n=null;async function m(t){const{cameraPosition:r,cameraDirection:m,gaussianCenters:p,sortOrder:c}=t;if(0===p.length||0===c.length||c.length!==p.length/3)return{result:new o(c)};const l=.001;return Math.abs(r[0]-s[0])>l||Math.abs(r[1]-s[1])>l||Math.abs(r[2]-s[2])>l||Math.abs(m[0]-e[0])>l||Math.abs(m[1]-e[1])>l||Math.abs(m[2]-e[2])>l?(s=r,e=r,function(t){let r=!1;for(let o=0;o<t.length;o+=3){const s=t[o],e=t[o+1],a=t[o+2];r?(i[0]=Math.min(i[0],s),i[3]=Math.max(i[3],s),i[1]=Math.min(i[1],e),i[4]=Math.max(i[4],e),i[2]=Math.min(i[2],a),i[5]=Math.max(i[5],a)):(i[0]=i[3]=s,i[1]=i[4]=e,i[2]=i[5]=a,r=!0)}r||(i[0]=i[3]=0,i[1]=i[4]=0,i[2]=i[5]=0)}(p),function(t,r,o){const s=o[0],e=o[1],m=o[2],p=t.length/3,c=Math.max(10,Math.min(20,Math.round(Math.log2(p/.25)))),l=1+(1<<c);!function(t,r){a?.length!==t&&(a=new Uint32Array(t)),n&&n.length===1+(1<<r)?n.fill(0):n=new Uint32Array(1+(1<<r))}(p,c);let j=0,u=0;for(let t=0;t<8;++t){const r=(1&t?i[0]:i[3])*s+(2&t?i[1]:i[4])*e+(4&t?i[2]:i[5])*m;0===t?j=u=r:(j=Math.min(j,r),u=Math.max(u,r))}const h=u-j;if(h<1e-6)for(let t=0;t<p;++t)a[t]=0,n[0]++;else{const r=(1<<c)/h;for(let o=0,i=0;o<p;++o){const p=(t[i++]*s+t[i++]*e+t[i++]*m-j)*r>>>0;a[o]=p,n[p]++}}for(let t=1;t<l;t++)n[t]+=n[t-1];for(let t=0;t<p;t++){const o=a[t];r[--n[o]]=t}}(p,c,m),{result:new o(c),transferList:[c.buffer]}):{result:new o(c),transferList:[c.buffer]}}function p(){a=null,n=null}export{o as SplatSortWorkerOutput,p as destroy,m as sortCentersRelativeToCamera};
