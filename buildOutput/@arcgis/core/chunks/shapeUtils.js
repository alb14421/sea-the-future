/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{e}from"../core/lang.js";import{a as t}from"./vec3f64.js";import{g as n}from"./builderUtils.js";import s from"../geometry/Point.js";import a from"../geometry/Polyline.js";function r(e){let t=0;const s=n(e);for(let n=0;n<e.paths.length;n++){const a=e.paths[n].length;for(let r=0;r<a;r++)r>0&&(t+=e.hasZ?R(e.paths[n][r-1],e.paths[n][r],s):u(e.paths[n][r-1],e.paths[n][r]))}return t}function o(e){const t=e.geometry.clone();return t.paths.map(n=>new a({spatialReference:e.geometry.spatialReference,paths:[n],hasZ:t.hasZ,hasM:t.hasM}))}function c(e){const t=[];for(const n of e.paths)for(let s=1;s<n.length;s++){const r=[[n[s-1].slice(),n[s].slice()]];t.push(new a({paths:r,spatialReference:e.spatialReference,hasZ:e.hasZ,hasM:e.hasM}))}return t}function f(e,t,n){let s=t[0]-e[0],a=t[1]-e[1];const r=Math.sqrt(s*s+a*a);return s/=r,a/=r,s*=n,a*=n,[e[0]+s,e[1]+a]}function i(e,t,n,s){const a=function(e){const t=function(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2])}(e);return[e[0]/t,e[1]/t,e[2]/t]}([t[0]-e[0],t[1]-e[1],t[2]*s-e[2]*s]);return[e[0]+a[0]*n,e[1]+a[1]*n,e[2]+a[2]*n]}function h(e,t,n){const a=u(t[0],t[1]),r=e.x+n*((t[1][0]-t[0][0])/a),o=e.y+n*((t[1][1]-t[0][1])/a),c={};return e.hasM&&(c.m=e.m),new s({x:r,y:o,spatialReference:e.spatialReference,...c})}function l(e,t,n,a){const r=R(t[0],t[1],a),o=e.x+n*((t[1][0]-t[0][0])/r),c=e.y+n*((t[1][1]-t[0][1])/r),f=e.z+n*((t[1][2]-t[0][2])/r),i={};return e.hasM&&(i.m=e.m),new s({x:o,y:c,z:f,spatialReference:e.spatialReference,...i})}function p(e,t,n,s){return void 0===e||void 0===t||null===e||null===t?null:e+(t-e)/n*s}function u(e,t){const n=t[0]-e[0],s=t[1]-e[1];return Math.sqrt(n*n+s*s)}function R(e,t,n){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2+(void 0!==e[2]&&void 0!==t[2]?(e[2]*n-t[2]*n)**2:0))}function m(e,t,n){const s=t[0],a=t[1],r=[a[0]-s[0],a[1]-s[1]],o=Math.sqrt(r[0]**2+r[1]**2),c=[r[0]/o,r[1]/o];return e.x+=n*c[0],e.y+=n*c[1],e}function M(e,t){let n=0,a=null;const r=e.hasM,o=e.hasZ?3:2;for(const c of e.paths){if(0===t){a=new s({x:c[0][0],y:c[0][1],...r?{m:c[0][o]}:{},spatialReference:e.spatialReference,hasM:r});break}for(let i=0;i<c.length-1;i++){const h=u(c[i],c[i+1]),l=n+h;if(l===t){a=new s({x:c[i+1][0],y:c[i+1][1],...r?{m:c[i+1][o]}:{},spatialReference:e.spatialReference,hasM:r});break}if(l>t){const l=f(c[i],c[i+1],t-n);a=new s({x:l[0],y:l[1],...r?{m:p(c[i][o],c[i+1][o],h,t-n)??void 0}:{},spatialReference:e.spatialReference,hasM:r});break}n+=h}if(null!==a)break}return a}function y(e,n,a){let r=0;const o=e.hasM;for(const c of e.paths){if(0===n)return new s({x:c[0][0],y:c[0][1],z:c[0][2],...o?{m:c[0][3]}:{},hasZ:!0,hasM:o,spatialReference:e.spatialReference});for(let f=0;f<c.length-1;f++){const h=R(c[f],c[f+1],a),l=r+h;if(l===n)return new s({x:c[f+1][0],y:c[f+1][1],z:c[f+1][2],...o?{m:c[f+1][3]}:{},hasZ:!0,hasM:o,spatialReference:e.spatialReference});if(l>n){const l=i(t(c[f]),t(c[f+1]),n-r,a);return new s({x:l[0],y:l[1],z:l[2],...o?{m:p(c[f][3],c[f+1][3],h,n-r)??void 0}:{},hasZ:!0,hasM:o,spatialReference:e.spatialReference})}r+=h}}return null}function Z(e,t,n){let a=0,r=null;if(t<=0){const s=[e.paths[0][0],e.paths[0][1]];let a=w(e,0,0);return a=h(a,s,t),m(a,s,n)}const o=e.hasM?e.hasZ?3:2:-1;for(const c of e.paths)for(let i=0;i<c.length-1;i++){const h=u(c[i],c[i+1]),l=a+h;if(l===t)return r=new s({x:c[i+1][0],y:c[i+1][1],...e.hasM?{m:c[i+1][o]}:{},spatialReference:e.spatialReference}),0===n?r:m(r,[c[i],c[i+1]],n);if(l>t){const l=f(c[i],c[i+1],t-a);return r=new s({x:l[0],y:l[1],...o>-1?{m:p(c[i][o],c[i+1][o],h,t-a)??void 0}:{},spatialReference:e.spatialReference}),0===n?r:m(r,[c[i],c[i+1]],n)}a+=h}if(0===a)return null;const c=e.paths.length-1,i=e.paths[c].length-1,l=[e.paths[c][i-1],e.paths[c][i]];let R=w(e,c,i);return R=h(R,l,t-a),m(R,l,n)}function g(e,n,a,r){let o=0;if(n<=0){const t=[e.paths[0][0],e.paths[0][1]];let s=w(e,0,0);return s=l(s,t,n,r),m(s,t,a)}const c=e.hasM?e.hasZ?3:2:-1;for(const f of e.paths)for(let h=0;h<f.length-1;h++){const l=R(f[h],f[h+1],r),u=o+l;if(u===n){const t=new s({x:f[h+1][0],y:f[h+1][1],z:f[h+1][2],...e.hasM?{m:f[h+1][c]}:{},hasZ:!0,spatialReference:e.spatialReference});return 0===a?t:m(t,[f[h],f[h+1]],a)}if(u>n){const u=i(t(f[h]),t(f[h+1]),n-o,r),R=new s({x:u[0],y:u[1],z:u[2],...c>-1?{m:p(f[h][c],f[h+1][c],l,n-o)}:{},hasZ:!0,spatialReference:e.spatialReference});return 0===a?R:m(R,[f[h],f[h+1]],a)}o+=l}if(0===o)return null;const f=e.paths.length-1,h=e.paths[f].length-1,u=[e.paths[f][h-1],e.paths[f][h]];let M=w(e,f,h);return M=l(M,u,n-o,r),m(M,u,a)}function x(e,t,n){const a=e.rings[t][n];return new s({spatialReference:e.spatialReference,x:a[0],y:a[1],hasZ:e.hasZ,hasM:e.hasM,z:e.hasZ?a[2]:void 0,m:e.hasM?e.hasZ?a[3]:a[2]:void 0})}function w(e,t,n){const a=e.paths[t][n];return new s({spatialReference:e.spatialReference,x:a[0],y:a[1],hasZ:e.hasZ,hasM:e.hasM,z:e.hasZ?a[2]:void 0,m:e.hasM?e.hasZ?a[3]:a[2]:void 0})}function d(t){return e(t.at(0),t.at(-1))}export{Z as a,y as b,r as c,M as d,u as e,w as f,R as g,o as h,x as i,c as j,m as o,g as p,d as s};
