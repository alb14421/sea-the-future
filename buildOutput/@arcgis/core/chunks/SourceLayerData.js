/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{P as e}from"./GeometryUtils.js";import{t}from"./constants3.js";class s{constructor(e,t,s=0){this.values={},this._geometry=void 0,this._pbfGeometry=null,this.featureIndex=s;const r=t.keys,a=t.values,n=e.asUnsafe();for(;n.next();)switch(n.tag()){case 1:this.id=n.getUInt64();break;case 2:{const e=n.getMessage().asUnsafe(),t=this.values;for(;!e.empty();){const s=e.getUInt32(),n=e.getUInt32();t[r[s]]=a[n]}e.release();break}case 3:this.type=n.getUInt32();break;case 4:this._pbfGeometry=n.getMessage();break;default:n.skip()}}getGeometry(t){if(void 0!==this._geometry)return this._geometry;if(!this._pbfGeometry)return null;const s=this._pbfGeometry.asUnsafe();let r,a;this._pbfGeometry=null,t?t.reset(this.type):r=[];let n,o=1,i=0,c=0,u=0;for(;!s.empty();){if(0===i){const e=s.getUInt32();o=7&e,i=e>>3}switch(i--,o){case 1:c+=s.getSInt32(),u+=s.getSInt32(),t?t.moveTo(c,u):r&&(a&&r.push(a),a=[],a.push(new e(c,u)));break;case 2:c+=s.getSInt32(),u+=s.getSInt32(),t?t.lineTo(c,u):a&&a.push(new e(c,u));break;case 7:t?t.close():a&&!a[0].equals(c,u)&&a.push(a[0].clone());break;default:throw s.release(),new Error("Invalid path operation")}}return t?n=t.result():r&&(a&&r.push(a),n=r),s.release(),this._geometry=n,n}}class r{constructor(e){this.extent=t,this.keys=[],this.values=[],this._pbfLayer=e.clone();const s=e.asUnsafe();for(;s.next();)switch(s.tag()){case 1:this.name=s.getString();break;case 3:this.keys.push(s.getString());break;case 4:this.values.push(s.processMessage(r._parseValue));break;case 5:this.extent=s.getUInt32();break;default:s.skip()}}getData(){return this._pbfLayer}static _parseValue(e){for(;e.next();)switch(e.tag()){case 1:return e.getString();case 2:return e.getFloat();case 3:return e.getDouble();case 4:return e.getInt64();case 5:return e.getUInt64();case 6:return e.getSInt64();case 7:return e.getBool();default:e.skip()}return null}}export{s as F,r as S};
