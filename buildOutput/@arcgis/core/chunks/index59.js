/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import"./index.js";import"./index38.js";import"./index60.js";import"./index10.js";import{L as t,c as e,g as i,s as a,E as o,x as s,i as n,a as l}from"./componentsUtils.js";import{n as c}from"./ref.js";import{c as r}from"./repeat.js";import{a as p,u as h}from"./useT9n.js";import{e as u,r as d,c as m,b as g,F as f}from"./floating-ui.js";import{u as v,I as b}from"./interactive.js";import{o as x}from"./openCloseComponent.js";import{c as y,d as I}from"./label.js";import{c as $,a as k,d as j,s as C,H as A}from"./form.js";import{s as w}from"./dom.js";import{g as E}from"./guid.js";import{V as T}from"./Validation.js";import{c as O}from"./observers.js";import{c as z}from"./component.js";import{d as B}from"./debounce.js";import{e as V}from"./escapeRegExp.js";import"./logger2.js";import"./live.js";import"./directive-helpers.js";import"./keyed.js";import"./static.js";import"./key.js";import"./locale2.js";import"./input2.js";import"./assets.js";import"../config.js";import"../core/lang.js";import"./object.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../core/Error.js";import"./Logger.js";import"./string.js";import"./jsonUtils.js";import"./MapUtils.js";import"../core/promiseUtils.js";import"./handleUtils.js";import"./events.js";import"./maybe.js";import"./persistableUrlUtils.js";
/*! All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://github.com/Esri/calcite-design-system/blob/dev/LICENSE.md for details.
v3.2.1 */const D=n`:host([disabled]){cursor:default;-webkit-user-select:none;user-select:none;opacity:var(--calcite-opacity-disabled)}:host([disabled]) *,:host([disabled]) ::slotted(*){pointer-events:none}:host{position:relative;display:block}.input-container{position:relative;display:flex;flex:1 1 auto;flex-wrap:nowrap}.input{width:100%;--calcite-input-prefix-size: var(--calcite-autocomplete-input-prefix-size);--calcite-input-suffix-size: var(--calcite-autocomplete-input-suffix-size);--calcite-input-background-color: var(--calcite-autocomplete-input-background-color);--calcite-input-border-color: var(--calcite-autocomplete-input-border-color);--calcite-input-corner-radius: var(--calcite-autocomplete-input-corner-radius);--calcite-input-shadow: var(--calcite-autocomplete-input-shadow);--calcite-input-icon-color: var(--calcite-autocomplete-input-icon-color);--calcite-input-text-color: var(--calcite-autocomplete-input-text-color);--calcite-input-placeholder-text-color: var(--calcite-autocomplete-input-placeholder-text-color);--calcite-input-actions-background-color: var(--calcite-autocomplete-input-actions-background-color);--calcite-input-actions-background-color-hover: var(--calcite-autocomplete-input-actions-background-color-hover);--calcite-input-actions-background-color-press: var(--calcite-autocomplete-input-actions-background-color-press);--calcite-input-actions-icon-color: var(--calcite-autocomplete-input-actions-icon-color);--calcite-input-actions-icon-color-hover: var(--calcite-autocomplete-input-actions-icon-color-hover);--calcite-input-actions-icon-color-press: var(--calcite-autocomplete-input-actions-icon-color-press);--calcite-input-loading-background-color: var(--calcite-autocomplete-input-loading-background-color);--calcite-input-loading-fill-color: var(--calcite-autocomplete-input-loading-fill-color);--calcite-input-prefix-background-color: var(--calcite-autocomplete-input-prefix-background-color);--calcite-input-prefix-text-color: var(--calcite-autocomplete-input-prefix-text-color);--calcite-input-suffix-background-color: var(--calcite-autocomplete-input-suffix-background-color);--calcite-input-suffix-text-color: var(--calcite-autocomplete-input-suffix-text-color)}:host([disabled]) ::slotted([calcite-hydrated][disabled]),:host([disabled]) [calcite-hydrated][disabled]{opacity:1}.interaction-container{display:contents}.content-container{box-sizing:border-box;width:100%}.floating-ui-container{--calcite-floating-ui-z-index: var(--calcite-z-index-dropdown);inline-size:max-content;display:none;max-inline-size:100vw;max-block-size:100vh;inset-block-start:0;left:0;z-index:var(--calcite-floating-ui-z-index)}.floating-ui-container .calcite-floating-ui-anim{position:relative;transition:var(--calcite-floating-ui-transition);transition-property:inset,left,opacity;opacity:0;box-shadow:0 0 16px #00000029;z-index:var(--calcite-z-index);border-radius:.25rem}.floating-ui-container[data-placement^=bottom] .calcite-floating-ui-anim{inset-block-start:-5px}.floating-ui-container[data-placement^=top] .calcite-floating-ui-anim{inset-block-start:5px}.floating-ui-container[data-placement^=left] .calcite-floating-ui-anim{left:5px}.floating-ui-container[data-placement^=right] .calcite-floating-ui-anim{left:-5px}.floating-ui-container[data-placement] .calcite-floating-ui-anim--active{opacity:1;inset-block-start:0;left:0}.content-container .calcite-floating-ui-anim{max-height:45vh;width:100%;overflow-y:auto;color:var(--calcite-autocomplete-text-color, var(--calcite-color-text-1));background-color:var(--calcite-autocomplete-background-color, var(--calcite-color-foreground-1));border-radius:var(--calcite-autocomplete-corner-radius, var(--calcite-corner-radius-round))}.content--hidden{display:none}@media (forced-colors: active){.floating-ui-container--active{border:1px solid canvasText}}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.validation-container{display:flex;flex-direction:column;align-items:flex-start;align-self:stretch}:host([scale=m]) .validation-container,:host([scale=l]) .validation-container{padding-block-start:.5rem}:host([scale=s]) .validation-container{padding-block-start:.25rem}::slotted(input[slot=hidden-form-input]){margin:0!important;opacity:0!important;outline:none!important;padding:0!important;position:absolute!important;inset:0!important;transform:none!important;-webkit-appearance:none!important;z-index:-1!important}:host([hidden]){display:none}[hidden]{display:none}`,P="content-container",U="content-animation",F="content",L="content--hidden",S="floating-ui-container",H="floating-ui-container--active";class M extends t{constructor(){super(),this.guid=E(),this.attributeWatch=p(["autofocus","enterkeyhint","inputmode"],this.handleGlobalAttributesChanged),this.inputId=`autocomplete-input-${this.guid}`,this.listId=`autocomplete-list-${this.guid}`,this.messages=h(),this.transitionProp="opacity",this.mutationObserver=O("mutation",()=>this.getAllItemsDebounced()),this.resizeObserver=O("resize",()=>{this.setFloatingElSize()}),this.getAllItemsDebounced=B(this.getAllItems,0),this.activeDescendant="",this.activeIndex=-1,this.hasContentBottom=!1,this.hasContentTop=!1,this.items=[],this.groups=[],this.alignment="start",this.disabled=!1,this.iconFlipRtl=!1,this.loading=!1,this.open=!1,this.overlayPositioning="absolute",this.placement=u,this.readOnly=!1,this.required=!1,this.scale="m",this.status="idle",this.validity={valid:!1,badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1},this.value="",this.calciteAutocompleteBeforeClose=e({cancelable:!1}),this.calciteAutocompleteBeforeOpen=e({cancelable:!1}),this.calciteAutocompleteChange=e({cancelable:!1}),this.calciteAutocompleteClose=e({cancelable:!1}),this.calciteAutocompleteOpen=e({cancelable:!1}),this.calciteAutocompleteTextChange=e({cancelable:!1}),this.calciteAutocompleteTextInput=e({cancelable:!1}),this.listenOn(document,"click",this.documentClickHandler),this.listen("calciteInternalAutocompleteItemSelect",this.handleInternalAutocompleteItemSelect)}static{this.properties={activeDescendant:[16,{},{state:!0}],activeIndex:[16,{},{state:!0}],hasContentBottom:[16,{},{state:!0}],hasContentTop:[16,{},{state:!0}],items:[16,{},{state:!0}],groups:[16,{},{state:!0}],isOpen:[16,{},{state:!0}],enabledItems:[16,{},{state:!0}],alignment:[3,{},{reflect:!0}],autocomplete:[0,{},{attribute:!1}],disabled:[7,{},{reflect:!0,type:Boolean}],flipPlacements:[0,{},{attribute:!1}],form:[3,{},{reflect:!0}],icon:[3,{converter:i},{reflect:!0}],iconFlipRtl:[7,{},{reflect:!0,type:Boolean}],inputValue:1,label:1,loading:[7,{},{reflect:!0,type:Boolean}],maxLength:[11,{},{reflect:!0,type:Number}],messageOverrides:[0,{},{attribute:!1}],minLength:[11,{},{reflect:!0,type:Number}],name:[3,{},{reflect:!0}],open:[7,{},{reflect:!0,type:Boolean}],overlayPositioning:[3,{},{reflect:!0}],pattern:1,placeholder:1,placement:[3,{},{reflect:!0}],prefixText:1,readOnly:[7,{},{reflect:!0,type:Boolean}],required:[7,{},{reflect:!0,type:Boolean}],scale:[3,{},{reflect:!0}],status:[3,{},{reflect:!0}],suffixText:1,validationIcon:[3,{converter:i},{reflect:!0}],validationMessage:1,validity:[0,{},{attribute:!1}],value:1}}static{this.styles=D}get isOpen(){return this.open&&(this.hasContentTop||this.hasContentBottom||this.items.length>0)}get enabledItems(){return this.items.filter(t=>!t.disabled)}async reposition(t=!1){const{floatingEl:e,referenceEl:i,placement:a,overlayPositioning:o,flipPlacements:s}=this;return d(this,{floatingEl:e,referenceEl:i,overlayPositioning:o,placement:a,flipPlacements:s,type:"menu"},t)}async scrollContentTo(t){this.transitionEl?.scrollTo(t)}async selectText(){return this.referenceEl.selectText()}async setFocus(){return await z(this),this.referenceEl.setFocus()}connectedCallback(){super.connectedCallback(),this.mutationObserver?.observe(this.el,{childList:!0,subtree:!0}),y(this),$(this),this.defaultInputValue=this.inputValue||"",this.getAllItemsDebounced(),m(this)}async load(){this.getAllItemsDebounced()}willUpdate(t){t.has("disabled")&&(this.hasUpdated||!1!==this.disabled)&&this.handleDisabledChange(this.disabled),t.has("flipPlacements")&&this.reposition(!0),t.has("open")&&(this.hasUpdated||!1!==this.open)&&this.openHandler(),t.has("overlayPositioning")&&(this.hasUpdated||"absolute"!==this.overlayPositioning)&&this.reposition(!0),t.has("placement")&&(this.hasUpdated||this.placement!==u)&&this.reposition(!0);let e=!1;t.has("inputValue")&&(this.hasUpdated||this.inputValue)&&(this.inputValueMatchPattern=this.inputValue&&new RegExp(`(${V(this.inputValue)})`,"i"),this.updateItems(),this.updateGroups(),e=!0),e||!t.has("scale")||!this.hasUpdated&&"m"===this.scale||(this.updateItems(),this.updateGroups(),e=!0),e||!t.has("activeIndex")||!this.hasUpdated&&-1===this.activeIndex||this.updateItems()}updated(){v(this)}loaded(){k(this,this.value||""),this.defaultInputValue=this.inputValue||"",m(this)}disconnectedCallback(){super.disconnectedCallback(),this.mutationObserver?.disconnect(),this.resizeObserver?.disconnect(),I(this),j(this),g(this)}setFloatingElSize(){const{referenceEl:t,floatingEl:e}=this;t&&e&&(e.style.inlineSize=`${t.clientWidth}px`)}handleGlobalAttributesChanged(){this.requestUpdate()}handleDisabledChange(t){t||(this.open=!1)}openHandler(){x(this),this.open||(this.activeIndex=-1),this.disabled?this.open=!1:(this.setFloatingElSize(),this.reposition(!0))}async documentClickHandler(t){this.disabled||t.composedPath().includes(this.el)||(this.open=!1)}async handleInternalAutocompleteItemSelect(t){this.value=t.target.value,t.stopPropagation(),this.emitChange(),await this.setFocus(),this.open=!1}onLabelClick(){this.setFocus()}onFormReset(){this.inputValue=this.defaultInputValue}onBeforeOpen(){this.calciteAutocompleteBeforeOpen.emit()}onOpen(){this.calciteAutocompleteOpen.emit()}onBeforeClose(){this.calciteAutocompleteBeforeClose.emit()}onClose(){this.calciteAutocompleteClose.emit()}emitChange(){this.calciteAutocompleteChange.emit()}updateGroups(){this.groups.forEach((t,e,i)=>{t.scale=this.scale,0===e&&(t.disableSpacing=!0);const a=i[e+1];a&&(a.disableSpacing=0===t.children.length)})}updateItems(){let t=null;this.items.forEach(t=>{t.scale=this.scale,t.inputValueMatchPattern=this.inputValueMatchPattern}),this.enabledItems.forEach((e,i)=>{const a=i===this.activeIndex;a&&(t=e.guid),e.active=a}),this.activeDescendant=t}handleInputFocus(){this.open=!0}handleContentTopSlotChange(t){this.hasContentTop=w(t)}handleContentBottomSlotChange(t){this.hasContentBottom=w(t)}getAllItems(){const{el:t}=this;this.groups=Array.from(t.querySelectorAll("calcite-autocomplete-item-group")),this.items=Array.from(t.querySelectorAll("calcite-autocomplete-item")),this.updateItems(),this.updateGroups()}setReferenceEl(t){this.referenceEl=t,t&&(this.resizeObserver?.observe(t),m(this))}keyDownHandler(t){const{defaultPrevented:e,key:i}=t;if(e)return;const{open:a,activeIndex:o,enabledItems:s}=this,n=s.length&&o>-1?s[o]:null;switch(i){case"Escape":a&&(this.open=!1,t.preventDefault());break;case"Tab":this.open=!1;break;case"Enter":a&&n?(this.value=n.value,this.emitChange(),this.open=!1,t.preventDefault()):t.defaultPrevented||C(this)&&t.preventDefault();break;case"ArrowDown":s.length&&(this.open=!0,this.activeIndex=-1!==o?Math.min(o+1,s.length-1):0,this.scrollToActiveItem(),t.preventDefault());break;case"ArrowUp":s.length&&(this.open=!0,this.activeIndex=-1!==o?Math.max(o-1,0):s.length-1,this.scrollToActiveItem(),t.preventDefault());break;case"Home":s.length&&(this.open=!0,this.activeIndex=0,this.scrollToActiveItem(),t.preventDefault());break;case"End":s.length&&(this.open=!0,this.activeIndex=s.length-1,this.scrollToActiveItem(),t.preventDefault())}}scrollToActiveItem(){this.enabledItems[this.activeIndex]?.scrollIntoView({block:"nearest"})}changeHandler(t){t.stopPropagation(),this.inputValue=t.target.value,this.calciteAutocompleteTextChange.emit()}inputClickHandler(t){t.defaultPrevented||(this.open=!0)}inputHandler(t){t.stopPropagation(),this.inputValue=t.target.value,this.open=this.inputValue?.length>0,this.calciteAutocompleteTextInput.emit()}setFloatingEl(t){this.floatingEl=t,m(this)}setTransitionEl(t){t&&(this.transitionEl=t)}render(){const{disabled:t,listId:e,inputId:i,isOpen:n}=this,l=this.el.autofocus,r=this.el.enterKeyHint,p=this.el.inputMode;return b({disabled:t,children:s`<div class=${a("input-container")}><calcite-input .alignment=${this.alignment} aria-activedescendant=${this.activeDescendant??o} aria-controls=${e??o} aria-owns=${e??o} aria-autocomplete=list .ariaExpanded=${n} aria-haspopup=listbox .autocomplete=${this.autocomplete} .autofocus=${l} class=${a("input")} clearable .disabled=${t} enterkeyhint=${r??o} .form=${this.form} .icon=${this.icon??!0} .iconFlipRtl=${this.iconFlipRtl} id=${i??o} inputmode=${p??o} .label=${this.label} .loading=${this.loading} .maxLength=${this.maxLength} .messageOverrides=${this.messages} .minLength=${this.minLength} .name=${this.name} @click=${this.inputClickHandler} @keydown=${this.keyDownHandler} @calciteInputChange=${this.changeHandler} @calciteInputInput=${this.inputHandler} @calciteInternalInputFocus=${this.handleInputFocus} .pattern=${this.pattern} .placeholder=${this.placeholder} .prefixText=${this.prefixText} .readOnly=${this.readOnly} role=combobox .scale=${this.scale} .status=${this.status} .suffixText=${this.suffixText} type=search .value=${this.inputValue} ${c(this.setReferenceEl)}></calcite-input>${this.renderListBox()}<div class=${a({[P]:!0,[S]:!0,[H]:n})} ${c(this.setFloatingEl)}><div class=${a({[U]:!0,[f.animation]:!0,[f.animationActive]:n})} ${c(this.setTransitionEl)}><div class=${a({[F]:!0,[L]:!n})}><slot name=${"content-top"} @slotchange=${this.handleContentTopSlotChange}></slot><slot aria-hidden=true></slot><slot name=${"content-bottom"} @slotchange=${this.handleContentBottomSlotChange}></slot></div></div></div></div>${A({component:this})}${this.validationMessage&&"invalid"===this.status?T({icon:this.validationIcon,id:"autocompleteValidationMessage",message:this.validationMessage,scale:this.scale,status:this.status}):null}`})}renderListBox(){return s`<ul aria-labelledby=${this.inputId??o} class=${a("screen-readers-only")} id=${this.listId??o} role=listbox tabindex=-1>${this.renderListBoxOptions()}</ul>`}renderListBoxOptions(){return r(this.items.filter(t=>!(!t.label&&!t.heading)),t=>t.guid,t=>s`<li .ariaDisabled=${t.disabled} .ariaLabel=${t.label} id=${t.guid??o} role=option tabindex=-1>${t.heading}${t.description}</li>`)}}l("calcite-autocomplete",M);export{M as Autocomplete};
