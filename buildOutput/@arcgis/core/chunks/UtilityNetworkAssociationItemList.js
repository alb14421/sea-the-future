/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{_ as e}from"./tslib.es6.js";import"../intl.js";import{watch as t,initial as i,on as r}from"../core/reactiveUtils.js";import{s as o}from"./string.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import{i as l}from"../core/lang.js";import"./Logger.js";import{subclass as n}from"../core/accessorSupport/decorators/subclass.js";import{G as a,a as p}from"./layerUtils.js";import{d,t as m}from"./HighlightDefaults.js";import u from"../widgets/Widget.js";import{U as c}from"./UtilityNetworkAssociationAddAssociationViewModel.js";import{l as h}from"./componentsUtils.js";import{cast as y}from"../core/accessorSupport/decorators/cast.js";import"./widgetUtils.js";import{m as g}from"./messageBundle.js";import{t as j}from"./jsxFactory.js";import b from"../core/Accessor.js";import v from"../core/Collection.js";import{isStringField as f,isNumericField as _,isObjectIDField as w,isGlobalIDField as C,isIntegerField as F,isTimeOnlyField as S,normalizeFieldName as M}from"../layers/support/fieldUtils.js";import{g as I}from"./globalCss.js";import{H as O}from"./Heading.js";import L,{S as T}from"../widgets/support/SelectionToolbar.js";import{s as N}from"./substitute.js";import"./date.js";import"./jsonMap.js";import"./object.js";import"./locale.js";import"./handleUtils.js";import"./constants.js";import"./datetime.js";import"./number.js";import"./messages.js";import"../core/Error.js";import"../config.js";import"../core/promiseUtils.js";import"./events.js";import"./maybe.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"./jsonUtils.js";import"./MapUtils.js";import"./persistableUrlUtils.js";import"./assets.js";import"./watch.js";import"./ObjectPool.js";import"../core/scheduling.js";import"./nextTick.js";import"./PooledArray.js";import"./SetUtils.js";import"./get.js";import"./utils.js";import"./Lifecycle.js";import"./tracking.js";import"./SimpleTrackingTarget.js";import"./ensureType.js";import"./metadata.js";import"./Warning.js";import"../layers/catalog/catalogUtils.js";import"../Color.js";import"./colorUtils.js";import"./mathUtils.js";import"./domUtils.js";import"../core/Evented.js";import"../core/Handles.js";import"./ObservableBase.js";import"../core/Promise.js";import"./uuid.js";import"./projector.js";import"./sanitizerUtils.js";import"./jsxWidgetSupport.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Clonable.js";import"../core/JSONSupport.js";import"./reader.js";import"./writer.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/support/AttachmentsOrderByInfo.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"./enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"./chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/RelationshipContent.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/content/TextContent.js";import"../popup/content/UtilityNetworkAssociationsContent.js";import"../popup/support/UtilityNetworkAssociationType.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../support/actions/ActionBase.js";import"../core/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"./shared.js";import"./SimpleObservable.js";import"../core/sql.js";import"./guards.js";import"../geometry/support/jsonUtils.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"./unitUtils.js";import"./pe.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Multipoint.js";import"./zmUtils.js";import"../geometry/Polygon.js";import"./coordsUtils.js";import"./extentUtils.js";import"./boundsUtils.js";import"./aaBoundingRect.js";import"../geometry/Polyline.js";import"./typeUtils.js";import"./createFeatureId.js";import"./typeUtils2.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"./collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"./utils3.js";import"../symbols/edges/Edges3D.js";import"./screenUtils.js";import"./materialUtils.js";import"./opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"./Symbol3DMaterial.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"./utils4.js";import"./colors.js";import"./symbolLayerUtils3D.js";import"./vec3f64.js";import"./aaBoundingBox.js";import"./DoubleArray.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"./lineMarkers.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/Font.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/support/StyleOrigin.js";import"./Thumbnail.js";import"./calloutUtils.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/support/Symbol3DVerticalOffset.js";import"../symbols/LineSymbol3D.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"./urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/MarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"./asyncUtils.js";import"./UpdatingHandles.js";import"./featureUtils.js";import"./utils7.js";import"./basemapUtils.js";import"./utils5.js";import"./mat4.js";import"./common.js";import"./basemapDefinitions.js";import"./timeZoneUtils.js";import"../rest/networks/support/Association.js";import"./typeUtils4.js";import"../rest/networks/support/NetworkElement.js";import"./TelecomNetworkElement.js";import"./getFeatureTitle.js";import"../widgets/support/SelectionToolbar/SelectionToolbarViewModel.js";import"./layerUtils2.js";import"./editableLayers.js";import"./layerViewUtils.js";import"./SelectionOperation.js";import"./keybindings.js";import"./InputManager.js";import"./Queue.js";import"./signal.js";import"./automaticLengthMeasurementUtils.js";import"./geodesicLengthMeasurementUtils.js";import"./quantityUtils.js";import"./vec3.js";import"./projectVectorToVector.js";import"./projectBuffer.js";import"./geodesicConstants.js";import"./projectPointToVector.js";import"./projectionUtils.js";import"./projectXYZToVector.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"./zscale.js";import"./dehydratedPoint.js";import"./spatialReferenceEllipsoidUtils.js";import"../geometry/operators/geodeticLengthOperator.js";import"./geodeticCurveType.js";import"../geometry/support/geodesicUtils.js";import"./geodesicMeasurementUtils.js";import"../widgets/support/Selector2D/selectorUtils.js";import"./drapedUtils.js";const U={date:[],dateOnly:[],id:["is","isNot","startsWith","endsWith","contains","doesNotContain"],number:["is","isNot","startsWith","endsWith","contains","doesNotContain","isBlank","isNotBlank"],timeOnly:[],timestampOffset:[],string:["is","isNot","startsWith","endsWith","contains","doesNotContain","isBlank","isNotBlank","isEmpty","isNotEmpty"]};let x=class extends b{constructor(e){super(e),this.fieldName=null,this.layer=null,this.operator="is",this.operators=U,this.value=null}initialize(){this.addHandles(t(()=>this.layer,async e=>{e&&!e.loaded&&await e.load()},i))}get domain(){const{fieldName:e,layer:t}=this;if(e&&t)return t.getFieldDomain(e)}get field(){const{fieldName:e,layer:t}=this;if(e&&t)return t.fieldsIndex.get(e)}get fields(){return(this.layer?.fields??[]).filter(e=>!!(f(e)||_(e)||w(e)||C(e)))}get fieldLabel(){const{field:e}=this;return e&&(e.alias||e.name)||""}get isObjectIDField(){const{field:e}=this;return!!e&&w(e)}get isGlobalIDField(){const{field:e}=this;return!!e&&C(e)}get isIntegerField(){return F(this.field)}get isNumericField(){return _(this.field)}get isStringField(){return f(this.field)}get isTimeOnlyField(){return S(this.field)}get normalizedFieldName(){return M(this.field?.name)}get state(){const{layer:e}=this;return e?e.loaded?"ready":"loading":"disabled"}get valueAsString(){const{value:e}=this;return null==e||""===e?"":`${e}`}get normalizedValue(){const{value:e,isNumericField:t,isObjectIDField:i}=this;return null==e||""===e?"":t||i?`${e}`:`'${e}'`}get whereClause(){const{normalizedFieldName:e,operator:t,normalizedValue:i}=this;return e&&t?"isBlank"===t?`${e} IS NULL`:"isNotBlank"===t?`${e} IS NOT NULL`:"isEmpty"===t?`${e} = ''`:"isNotEmpty"===t?`${e} <> ''`:""===i?null:"is"===t?`${e} = ${i}`:"isNot"===t?`${e} <> ${i}`:"startsWith"===t?`${e} LIKE ${i}%`:"endsWith"===t?`${e} LIKE %${i}`:"contains"===t?`${e} LIKE %${i}%`:"doesNotContain"===t?`${e} NOT LIKE %${i}%`:null:null}};e([s()],x.prototype,"domain",null),e([s()],x.prototype,"field",null),e([s()],x.prototype,"fields",null),e([s()],x.prototype,"fieldLabel",null),e([s()],x.prototype,"fieldName",void 0),e([s()],x.prototype,"isObjectIDField",null),e([s()],x.prototype,"isIntegerField",null),e([s()],x.prototype,"isNumericField",null),e([s()],x.prototype,"isStringField",null),e([s()],x.prototype,"isTimeOnlyField",null),e([s()],x.prototype,"layer",void 0),e([s()],x.prototype,"normalizedFieldName",null),e([s()],x.prototype,"operator",void 0),e([s()],x.prototype,"operators",void 0),e([s()],x.prototype,"state",null),e([s()],x.prototype,"value",void 0),e([s()],x.prototype,"valueAsString",null),e([s()],x.prototype,"normalizedValue",null),e([s()],x.prototype,"whereClause",null),x=e([n("esri.widgets.support.FilterCondition.FilterConditionViewModel")],x);const k={},D="esri-filter-condition",E={base:D,valueInputContainer:`${D}__value-input-container`};let V=class extends u{constructor(e,t){super(e,t),this.messages=null,this.messagesCommon=null,this.viewModel=new x,this.visibleElements={...k}}loadDependencies(){return h({input:()=>import("./index10.js"),option:()=>import("./index11.js"),select:()=>import("./index12.js")})}get _defaultFieldName(){const{fields:e,fieldName:t}=this;return t||(e?.length?e[0].name:void 0)}get _valueInputType(){const{viewModel:e}=this;return e.isNumericField||e.isObjectIDField?"number":"text"}get _visibleOperators(){const{field:e,operators:t,viewModel:i}=this;return e?i.isStringField||i.isGlobalIDField?t.string:i.isNumericField?t.number:i.isObjectIDField?t.id:[]:[]}get _isValueInputHidden(){const{operator:e}=this;return!!e&&["isBlank","isNotBlank","isEmpty","isNotEmpty"].includes(e)}get domain(){return this.viewModel.domain}get field(){return this.viewModel.field}get fields(){return this.viewModel.fields}get fieldLabel(){return this.viewModel.fieldLabel}get fieldName(){return this.viewModel.fieldName}set fieldName(e){this.viewModel.fieldName=e}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get normalizedFieldName(){return this.viewModel.normalizedFieldName}get operator(){return this.viewModel.operator}set operator(e){this.viewModel.operator=e}get operators(){return this.viewModel.operators}set operators(e){this.viewModel.operators=e}get state(){return this.viewModel.state}get value(){return this.viewModel.value}set value(e){this.viewModel.value=e}get valueAsString(){return this.viewModel.valueAsString}castVisibleElements(e){return{...k,...e}}get whereClause(){return this.viewModel.whereClause}render(){return j("div",{class:E.base},this._renderFieldSelection(),this._renderOperatorSelection(),this._renderValueInput())}_renderFieldSelection(){const e=this.normalizedFieldName;return j("div",null,j("calcite-select",{afterCreate:()=>{this.fieldName||(this.fieldName=this._defaultFieldName)},bind:this,label:this.messages.chooseField,width:"full",onCalciteSelectChange:({currentTarget:e})=>{this.value=null,this.fieldName=e.value}},this.fields.map(t=>this._renderOption(t.name,t.alias,e))))}_renderOperatorSelection(){const{_visibleOperators:e,messages:t,operator:i}=this;if(e.length)return j("div",null,j("calcite-select",{afterUpdate:e=>{const t=e.value;this._visibleOperators.includes(t)||(this.operator=this._visibleOperators[0])},bind:this,label:t.operator,required:!0,width:"full",onCalciteSelectChange:e=>{this.operator=e.currentTarget.value}},e.map(e=>this._renderOption(e,t.operators[e],i))))}_renderOption(e,t,i){return j("calcite-option",{key:e,label:t??e,selected:e===i,value:e})}_renderValueInput(){const{valueAsString:e,domain:t,messages:i,operator:r}=this;if(!this._isValueInputHidden){if("coded-value"===t?.type&&t.codedValues.length&&("is"===r||"isNot"===r)){const r=t.codedValues[0].code;return j("div",{key:"value-select"},j("calcite-select",{afterCreate:()=>this._afterSelectCreateOrUpdate(r),afterUpdate:()=>this._afterSelectCreateOrUpdate(r),bind:this,label:i.value,required:!0,width:"full",onCalciteSelectChange:({currentTarget:e})=>{this._onValueChange(e.value)}},t.codedValues.map(({code:t,name:i})=>this._renderOption(`${t}`,i,e))))}return j("div",{class:E.valueInputContainer,key:"value-input"},j("calcite-input",{label:i.value,type:this._valueInputType,value:e,onCalciteInputInput:({currentTarget:e})=>{this._onValueChange(e.value)}}))}}_afterSelectCreateOrUpdate(e){null==this.value&&(this.value=e)}_onValueChange(e){const{viewModel:t}=this;e&&""!==e?t.isStringField||t.isGlobalIDField?this.value=e.toString():(t.isNumericField||t.isObjectIDField)&&(this.value=parseFloat(e)):this.value=null}};e([s()],V.prototype,"_defaultFieldName",null),e([s()],V.prototype,"_valueInputType",null),e([s()],V.prototype,"_visibleOperators",null),e([s()],V.prototype,"_isValueInputHidden",null),e([s()],V.prototype,"domain",null),e([s()],V.prototype,"field",null),e([s()],V.prototype,"fields",null),e([s()],V.prototype,"fieldLabel",null),e([s()],V.prototype,"fieldName",null),e([s()],V.prototype,"layer",null),e([s(),g("esri/widgets/support/FilterCondition/t9n/FilterCondition")],V.prototype,"messages",void 0),e([s(),g("esri/t9n/common")],V.prototype,"messagesCommon",void 0),e([s()],V.prototype,"normalizedFieldName",null),e([s()],V.prototype,"operator",null),e([s()],V.prototype,"operators",null),e([s()],V.prototype,"state",null),e([s()],V.prototype,"value",null),e([s()],V.prototype,"valueAsString",null),e([s()],V.prototype,"viewModel",void 0),e([s()],V.prototype,"visibleElements",void 0),e([y("visibleElements")],V.prototype,"castVisibleElements",null),e([s()],V.prototype,"whereClause",null),V=e([n("esri.widgets.support.FilterCondition")],V);let A=class extends b{constructor(e){super(e),this.conditionOperator="AND",this.conditionWidgets=new v,this.layer=null,this.operators=U}initialize(){this.addHandles([t(()=>this.layer,async e=>{e&&!e.loaded&&await e.load()},i)])}get count(){return this.conditionWidgets.length}get state(){const{layer:e}=this;return e?e.loaded?"ready":"loading":"disabled"}get whereClause(){const{conditionOperator:e,whereClauses:t}=this;let i="";return t.forEach((t,r)=>{i+=r>0?` ${e} (${t})`:`(${t})`}),i}get whereClauses(){return this.conditionWidgets.toArray().map(e=>e.whereClause).filter(l)}addCondition(e,t){const{layer:i,operators:r}=this;i&&this.conditionWidgets.add(new V({...e,layer:i,operators:r}),t)}duplicateCondition(e){const t=this.conditionWidgets.at(e);if(!t)return;const{fieldName:i,operator:r,value:o}=t;this.addCondition({fieldName:i,operator:r,value:o})}reset(){this.conditionWidgets.removeAll()}removeCondition(e){null==e?this.conditionWidgets.pop():this.conditionWidgets.splice(e,1)}};e([s()],A.prototype,"conditionOperator",void 0),e([s()],A.prototype,"conditionWidgets",void 0),e([s()],A.prototype,"count",null),e([s()],A.prototype,"layer",void 0),e([s()],A.prototype,"operators",void 0),e([s()],A.prototype,"state",null),e([s()],A.prototype,"whereClause",null),e([s()],A.prototype,"whereClauses",null),A=e([n("esri.widgets.support.FilterBuilder.FilterBuilderViewModel")],A);const B={fab:!0,menu:!0},$="esri-filter-builder",P={base:$,conditionContainer:`${$}__condition-container`,operatorSelect:`${$}__operator-select`};let W=class extends u{constructor(e,t){super(e,t),this.messages=null,this.messagesCommon=null,this.viewModel=new A,this.visibleElements={...B}}loadDependencies(){return h({action:()=>import("./index5.js"),"action-menu":()=>import("./index17.js").then(e=>e.i),block:()=>import("./index29.js"),fab:()=>import("./index48.js"),option:()=>import("./index11.js"),select:()=>import("./index12.js")})}get conditionOperator(){return this.viewModel.conditionOperator}set conditionOperator(e){this.viewModel.conditionOperator=e}get count(){return this.viewModel.count}get layer(){return this.viewModel.layer}set layer(e){this.viewModel.layer=e}get operators(){return this.viewModel.operators}set operators(e){this.viewModel.operators=e}get state(){return this.viewModel.state}castVisibleElements(e){return{...B,...e}}get whereClause(){return this.viewModel.whereClause}get whereClauses(){return this.viewModel.whereClauses}render(){return j("div",{class:P.base},this._renderOperatorSelect(),this._renderConditions(),this._renderFAB())}reset(){this.viewModel.reset()}_renderOperatorSelect(){if(this.count<2)return;const{conditionOperator:e,messages:t}=this,i="AND"===e;return j("div",{class:P.operatorSelect},j("calcite-select",{label:t.condition,width:"full",onCalciteSelectChange:({currentTarget:e})=>{this.conditionOperator=e.value}},j("calcite-option",{label:t.allAreTrue,selected:i,value:"AND"}),j("calcite-option",{label:t.anyAreTrue,selected:!i,value:"OR"})))}_renderConditions(){return this.viewModel.conditionWidgets.toArray().map((e,t)=>this._renderConditionContainer(e,t))}_renderConditionContainer(e,t){return j("calcite-block",{class:P.conditionContainer,expanded:!0,heading:this.messages.condition},e.render(),this._renderConditionrMenu(t))}_renderFAB(){if(!this.visibleElements.fab)return;const e="loading"===this.state;return j("calcite-fab",{appearance:"outline-fill",disabled:e,icon:"plus",kind:"neutral",loading:e,onclick:()=>this.viewModel.addCondition(),text:this.messages.addNew,textEnabled:!0})}_renderConditionrMenu(e){if(!this.visibleElements.menu)return;const{messages:t}=this;return j("calcite-action-menu",{label:t.moreOptions,overlayPositioning:"fixed",placement:"bottom-end",slot:"control"},j("calcite-action",{onclick:()=>this.viewModel.removeCondition(e),text:t.delete,textEnabled:!0}),j("calcite-action",{onclick:()=>this.viewModel.duplicateCondition(e),text:t.duplicate,textEnabled:!0}))}};e([s()],W.prototype,"conditionOperator",null),e([s()],W.prototype,"count",null),e([s()],W.prototype,"layer",null),e([s(),g("esri/widgets/support/FilterBuilder/t9n/FilterBuilder")],W.prototype,"messages",void 0),e([s(),g("esri/t9n/common")],W.prototype,"messagesCommon",void 0),e([s()],W.prototype,"operators",null),e([s()],W.prototype,"state",null),e([s()],W.prototype,"viewModel",void 0),e([s()],W.prototype,"visibleElements",void 0),e([y("visibleElements")],W.prototype,"castVisibleElements",null),e([s()],W.prototype,"whereClause",null),e([s()],W.prototype,"whereClauses",null),W=e([n("esri.widgets.support.FilterBuilder")],W);const H="esri-feature-form-utility-network-association-layers",z={base:H,header:`${H}__header`,headingContent:`${H}__heading-content`,featureObserver:`${H}__feature-observer`,filterContainer:`${H}__filter-container`,filterOptionsContainer:`${H}__filter-options-container`,filterOptionsHeader:`${H}__filter-options-header`,listContainer:`${H}__list-container`,spatialSelectContainer:`${H}__spatial-select-container`,spatialSelectToolbar:`${H}__spatial-select-toolbar`,stickySpinnerContainer:`${H}__sticky-loading-container`,loadingContainer:`${H}__loading-container`};let G=class extends u{constructor(e,t){super(e,t),this.headingLevel=5,this.messagesCommon=null,this.messagesEditor=null,this.messagesFeature=null,this.messagesFeatureForm=null,this.messagesFilterBuilder=null,this.viewModel=new c,this.view=null,this._filterBuilder=new W,this._featureFilterText="",this._layerFilterText="",this._observer=new IntersectionObserver(([e])=>{e?.isIntersecting&&this._increaseFeaturePage()},{root:window.document}),this._observerNode=null,this._selectionToolbar=new L({returnFeatureTitleFields:!0,layerViewPreferenceEnabled:!1,persistSelection:!1,visibleElements:new T({chip:!1,pan:!1})}),this._onSelectionComplete=async e=>{const{highlightHelper:t}=this.viewModel;await this.viewModel.onSelectionComplete(e),t?.removeAll(),this._featureSpatialGraphics.length>0&&t?.add(this._featureSpatialGraphics)}}initialize(){this._setupSelectionToolbar(),this.addHandles([t(()=>this.viewModel,()=>this.reset()),t(()=>[this.viewModel.state,this._observerNode],()=>this._onObserverChange()),t(()=>this.selectedLayer,e=>{this._filterBuilder.layer=e,e||(this.filterOptionsVisible=!1,this._featureFilterText="")})])}loadDependencies(){return h({action:()=>import("./index5.js"),button:()=>import("./index6.js"),icon:()=>import("./index.js"),input:()=>import("./index10.js"),list:()=>import("./index19.js"),"list-item":()=>import("./index18.js"),loader:()=>import("./index28.js")})}destroy(){this._filterBuilder.destroy(),this._selectionToolbar.destroy()}get filterOptionsVisible(){return this.viewModel.filterOptionsVisible}set filterOptionsVisible(e){this.viewModel.filterOptionsVisible=e}get isSelecting(){return"active"===this._selectionToolbar.state}get selectedLayer(){return this.viewModel.selectedLayer}set selectedLayer(e){this.viewModel.selectedLayer=e}get selectedFeature(){return this.viewModel.selectedFeature}set selectedFeature(e){this.viewModel.selectedFeature=e}get filterWhereClause(){return this.viewModel.filterWhereClause}set filterWhereClause(e){this.viewModel.filterWhereClause=e,e||this._filterBuilder.reset()}get _featureSpatialGraphics(){return this.viewModel.featureSpatialItems.toArray().map(e=>e.feature)}get _filteredFeatureItems(){const{_featureFilterText:e}=this,{featureItems:t,featureSpatialItems:i}=this.viewModel;return(i.length?i:t).map(e=>({label:e.label,graphic:e.feature,layer:e.feature.sourceLayer})).filter(t=>t.label?.toLowerCase().includes(e)??!1)}get _filteredFeatureItemsPage(){const{featurePage:e,featuresPerPage:t}=this.viewModel,i=e*t;return this._filteredFeatureItems.toArray().slice(0,i)}render(){return j("div",{class:this.classes(z.base,I.widget)},this._renderContent())}applyFilterOptions(){const{selectedLayer:e}=this;this.filterOptionsVisible=!1,e&&(this.filterWhereClause=this._filterBuilder.whereClause)}cancelSelection(){this._selectionToolbar.cancel()}reset(){this.filterWhereClause=null,this._featureFilterText="",this._layerFilterText="",this.filterOptionsVisible=!1,this._filterBuilder.reset()}startSelection(e){this._selectionToolbar.activateTool(e)}_setupSelectionToolbar(){this.addHandles([t(()=>this.view,e=>{this.viewModel.reset(),this._selectionToolbar.view="2d"===e?.type?e:null},i),t(()=>[this.viewModel,this.viewModel.layerItems.length,this.viewModel.map?.allLayers.map(e=>e.visible),this.viewModel.map?.allLayers?.filter(e=>p(e)).toArray().flatMap(e=>e.sublayers.toArray()).map(e=>e.visible)],()=>this._updateToolbarSources()),r(()=>this._selectionToolbar,"before-activate",e=>this.emit("before-selection",e)),r(()=>this._selectionToolbar,"complete",this._onSelectionComplete)])}_updateToolbarSources(){const e=this.viewModel.layerItems.toArray().filter(e=>{const{parent:t}=e;return!(t&&(a(t)||p(t))&&!t.visible)&&e.visible});this._selectionToolbar.sources=e}_onObserverChange(){this._observerNode&&this._observer.unobserve(this._observerNode);const{state:e}=this.viewModel;this._observerNode&&"ready"===e&&this._observer.observe(this._observerNode)}_increaseFeaturePage(){const{featureCount:e,featurePage:t,featureSpatialItems:i,state:r}=this.viewModel;e||i.length||1===t?"ready"===r&&this.viewModel.featurePage++:this.viewModel.featurePage=1}_renderContent(){const{state:e,filterOptionsVisible:t}=this.viewModel;return"loading"===e?this._renderLoading():t?this._renderFilterOptions():[this._renderSelectionToolbar(),this._renderListContent()]}_renderListContent(){return this._selectionToolbar.activeOperation?.processingFinalSelection?this._renderLoading():this.selectedLayer||this.viewModel.featureSpatialItems.length?this._renderFeatures():this._renderLayers()}_renderSelectionToolbar(){const{messagesCommon:e,_selectionToolbar:t}=this,{featureSpatialItems:i,selectedLayer:r}=this.viewModel;if(r||!t.sources?.length)return null;const o=j("div",{class:z.spatialSelectToolbar},t.render()),s=j("calcite-button",{appearance:"transparent",disabled:!i.length,label:e.clear,onclick:()=>this.viewModel.reset()},e.clear);return j("div",{class:z.spatialSelectContainer,key:"spatial-select-toolbar"},o,s)}_renderStickyLoading(){return"querying"===this.viewModel.state?j("div",{class:z.stickySpinnerContainer,key:"sticky-loader"},this._renderLoadingIcon()):null}_renderLoading(){return j("div",{class:z.loadingContainer,key:"loading-container"},this._renderLoadingIcon())}_renderLoadingIcon(){return j("calcite-loader",{inline:!0,label:this.messagesCommon.loading})}_renderFilterOptions(){return j("div",{class:z.filterOptionsContainer},j("div",{class:z.filterOptionsHeader},j("span",null,this.messagesFilterBuilder.widgetLabel),j("calcite-button",{appearance:"transparent",onclick:()=>this._filterBuilder.reset()},this.messagesCommon.clear)),this._filterBuilder.render())}_renderLayers(){const e=this.messagesFeatureForm.associations,t=e.availableLayers,i=e.filterLayers;return j("div",null,this._renderHeader({heading:t,placeholder:i,renderFilterOptions:!1,renderTotal:!1}),j("div",{class:z.listContainer},j("calcite-list",{label:e.associatedFeatures},this._renderLayerItems(),this._renderStickyLoading())))}_renderLayerItems(){const{_layerFilterText:e,viewModel:t,messagesCommon:i}=this,{layerItems:r,tableItems:o}=t;return r.concat(o).map(e=>({label:e.title??i.untitled,layer:e})).filter(t=>t.label?.toLowerCase().includes(e)??!1).toArray().map(e=>this._renderLayerItem(e))}_renderLayerItem(e){const{label:t,layer:i}=e;return j("calcite-list-item",{key:`layer-item-${i.id}`,label:o(t),onCalciteListItemSelect:()=>{this.selectedLayer=i,this._filterBuilder.reset()}},j("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_renderFeatures(){const{selectedLayer:e,viewModel:t}=this,i=t.featureSpatialItems.length>0,r=this.messagesFeatureForm.associations,o=i?void 0:e?.title||this.messagesCommon.untitled,s=r.filterFeatures;return j("div",null,this._renderHeader({heading:o,placeholder:s,renderFilterOptions:!i,renderTotal:!0}),j("div",{class:z.listContainer},j("calcite-list",{label:r.associatedFeatures},this._renderFeatureItems(),this._renderStickyLoading(),this._renderFeatureObserver())))}_renderFeatureItems(){return this._filteredFeatureItemsPage.map(e=>this._renderFeatureItem(e))}_renderFeatureItem(e){const{viewModel:t}=this,{highlightHelper:i}=t,{label:r,graphic:s}=e,l=t.featureSpatialItems.length>0?()=>i?.update(s,d):void 0,n=t.featureSpatialItems.length>0?()=>i?.update(s,m):void 0;return j("calcite-list-item",{key:`feature-item-${s.uid}`,label:o(r),onmouseenter:l,onmouseleave:n,onCalciteListItemSelect:()=>{this.selectedFeature={feature:s,label:r}}},j("calcite-icon",{flipRtl:!0,icon:"chevron-right",scale:"s",slot:"content-end"}))}_onObserverCreate(e){this._observerNode=e}_renderFeatureObserver(){return j("div",{afterCreate:this._onObserverCreate,bind:this,class:z.featureObserver,key:"feature-observer"})}_renderHeader(e){return j("div",{class:z.header,key:"filter"},this._renderHeading(e.heading),this._renderFilter(e.placeholder,e.renderFilterOptions),e.renderTotal?this._renderTotal():null)}_renderHeading(e){return e?j(O,{key:"title",level:this.headingLevel},j("div",{class:z.headingContent},j("calcite-icon",{icon:"layer"}),e)):null}_renderFilter(e,t){const i=!this.selectedLayer&&!this.viewModel.featureSpatialItems.length,r=i?this._layerFilterText:this._featureFilterText;return j("div",{class:z.filterContainer,key:"filter"},j("calcite-input",{icon:"search",placeholder:e,type:"search",value:r,onCalciteInputInput:e=>{i?this._layerFilterText=e.currentTarget.value.trim().toLowerCase():this._featureFilterText=e.currentTarget.value.trim().toLowerCase()}},t?this._renderFilterOptionsAction():null))}_renderFilterOptionsAction(){const e=this.messagesFeatureForm.associations.filterOptions;return j("calcite-action",{appearance:"transparent",icon:"sliders",indicator:!!this._filterBuilder.whereClause,onclick:()=>{this.viewModel.filterOptionsVisible=!this.viewModel.filterOptionsVisible},scale:"s",slot:"action",text:e,title:e})}_renderTotal(){const{messagesFeature:e,viewModel:t}=this,{featureCount:i,featureSpatialItems:r}=t,o=N(e.numberRecords,{number:r.length?r.length:i});return j("div",{key:"total"},o)}};e([s()],G.prototype,"filterOptionsVisible",null),e([s()],G.prototype,"headingLevel",void 0),e([s()],G.prototype,"isSelecting",null),e([s(),g("esri/t9n/common")],G.prototype,"messagesCommon",void 0),e([s(),g("esri/widgets/Editor/t9n/Editor")],G.prototype,"messagesEditor",void 0),e([s(),g("esri/widgets/Feature/t9n/Feature")],G.prototype,"messagesFeature",void 0),e([s(),g("esri/widgets/FeatureForm/t9n/FeatureForm")],G.prototype,"messagesFeatureForm",void 0),e([s(),g("esri/widgets/support/FilterBuilder/t9n/FilterBuilder")],G.prototype,"messagesFilterBuilder",void 0),e([s()],G.prototype,"selectedLayer",null),e([s({type:c})],G.prototype,"viewModel",void 0),e([s()],G.prototype,"selectedFeature",null),e([s()],G.prototype,"filterWhereClause",null),e([s()],G.prototype,"view",void 0),e([s()],G.prototype,"_filterBuilder",void 0),e([s()],G.prototype,"_featureFilterText",void 0),e([s()],G.prototype,"_layerFilterText",void 0),e([s()],G.prototype,"_observer",void 0),e([s()],G.prototype,"_featureSpatialGraphics",null),e([s()],G.prototype,"_filteredFeatureItems",null),e([s()],G.prototype,"_filteredFeatureItemsPage",null),e([s()],G.prototype,"_observerNode",void 0),G=e([n("esri.widgets.FeatureForm.FeatureFormUtilityNetworkAssociations.UtilityNetworkAssociationItemList")],G);const R=G;export{R as default};
