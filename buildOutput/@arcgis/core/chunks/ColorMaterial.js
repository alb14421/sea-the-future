/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{Z as t}from"./vec4f64.js";import{i as e,a as s,b as r,c as i}from"./Emissions.glsl.js";import{a as o,V as a,h as n,S as l,o as p,t as h,i as c,C as u,j as d,k as f,R as m,l as g,s as v,m as _,p as C,q as O,r as y,u as P,v as V,w as b,x as w,D,y as S,z as j,A as x}from"./Matrix4PassUniform.js";import{T,V as F,D as A}from"./VertexColor.glsl.js";import{T as q}from"./TriangleMaterial.js";import{n as I}from"./InterleavedLayout.js";import"../core/lang.js";import"./mathUtils.js";import"./lengthUtils.js";import"./debugFlags2.js";import{g as M}from"./glsl.js";import{S as z}from"./ShaderBuilder.js";import{m as B,d as N,c as W}from"./renderState.js";import{_ as E}from"./tslib.es6.js";import{a as L}from"./AlphaCutoff.js";const U=Object.freeze(Object.defineProperty({__proto__:null,build:function(t){const e=new z,{vertex:s,fragment:r,attributes:i,varyings:d}=e,{hasVVColor:f,hasVertexColors:m}=t;return o(s,t),e.include(T,t),e.include(F,t),e.include(a,t),e.include(n,t),r.include(l,t),e.include(p,t),e.include(h,t),i.add("position","vec3"),f&&i.add("colorFeatureAttribute","float"),m||d.add("vColor","vec4"),d.add("vpos","vec3",{invariant:!0}),s.uniforms.add(new c("uColor",t=>t.color)),s.main.add(M`
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();

      ${m?"vColor *= uColor;":f?"vColor = uColor * interpolateVVColor(colorFeatureAttribute);":"vColor = uColor;"}
      forwardViewPosDepth((view * vec4(vpos, 1.0)).xyz);
      gl_Position = transformPosition(proj, view, vpos);`),r.include(u),r.main.add(M`discardBySlice(vpos);
discardByTerrainDepth();
outputColorHighlightOID(vColor, vpos, vColor.rgb);`),e}},Symbol.toStringTag,{value:"Module"}));class k extends f{constructor(t,e){super(t,e,new m(U,()=>Promise.resolve().then(()=>U)),H(e).locations)}_createPipeline(t,s){const{oitPass:r,output:i,transparent:o,cullFace:a,draped:n,hasOccludees:l,polygonOffset:p}=t,h=0===r;return B({blending:e(i)&&o?V(r):null,culling:W(a),depthTest:n?null:{func:P(r)},depthWrite:y(t),drawBuffers:O(i,b(r,i)),colorWrite:N,stencilWrite:l?C:null,stencilTest:l?s?v:_:null,polygonOffset:h?p?G:null:g(t)})}initializePipeline(t){return this._occludeePipelineState=this._createPipeline(t,!0),this._createPipeline(t,!1)}getPipeline(t){return t?this._occludeePipelineState:super.getPipeline()}}const G={factor:1,units:1};function H(t){const e=I().vec3f("position");return d()&&e.vec4u8("olidColor"),t.hasVVColor?e.f32("colorFeatureAttribute"):e.vec4u8("color"),e.freeze()}class R extends D{constructor(){super(...arguments),this.cullFace=0,this.hasVertexColors=!1,this.transparent=!1,this.discardInvisibleFragments=!1,this.polygonOffset=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.terrainDepthTest=!1,this.cullAboveTerrain=!1,this.hasVVColor=!1,this.draped=!1,this.textureCoordinateType=0,this.emissionSource=0,this.occlusionPass=!1,this.olidColorInstanced=!1,this.hasVVInstancing=!1,this.hasVVSize=!1,this.hasVVOpacity=!1,this.snowCover=!1}}E([w({count:3})],R.prototype,"cullFace",void 0),E([w()],R.prototype,"hasVertexColors",void 0),E([w()],R.prototype,"transparent",void 0),E([w()],R.prototype,"discardInvisibleFragments",void 0),E([w()],R.prototype,"polygonOffset",void 0),E([w()],R.prototype,"enableOffset",void 0),E([w()],R.prototype,"writeDepth",void 0),E([w()],R.prototype,"hasOccludees",void 0),E([w()],R.prototype,"terrainDepthTest",void 0),E([w()],R.prototype,"cullAboveTerrain",void 0),E([w()],R.prototype,"hasVVColor",void 0),E([w()],R.prototype,"draped",void 0);class Z extends q{constructor(t){super(t,J),this._configuration=new R,this.supportsEdges=!0,this.produces=new Map([[2,t=>this._isOpaqueMaterialPass(t)],[3,t=>this._isOpaqueNoSSAODepthPass(t)],[4,t=>s(t)&&this._transparent&&this.parameters.writeDepth],[5,t=>r(t)&&this._transparent&&this.parameters.writeDepth],[8,t=>s(t)&&this._transparent&&!this.parameters.writeDepth],[18,t=>i(t)]])}getConfiguration(t,s){return super.getConfiguration(t,s,this._configuration),this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasVertexColors=this.parameters.hasVertexColors&&!this.parameters.vvColor,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this._transparent,this._configuration.discardInvisibleFragments=this._transparent&&!this._isOpaquePass(t)&&this.parameters.discardInvisibleFragments,this._configuration.polygonOffset=this.parameters.polygonOffset,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=s.hasOccludees,this._configuration.oitPass=s.oitPass,this._configuration.enableOffset=s.camera.relativeElevation<S,this._configuration.terrainDepthTest=s.terrainDepthTest&&e(t),this._configuration.cullAboveTerrain=s.cullAboveTerrain,this._configuration.hasVVColor=!!this.parameters.vvColor,this._configuration.draped=this.parameters.draped,this._configuration}get visible(){return this.parameters.color[3]>=L}get _transparent(){return this.parameters.color[3]<1||this.parameters.forceTransparentMode}_isOpaquePass(t){return this._isOpaqueMaterialPass(t)||this._isOpaqueNoSSAODepthPass(t)}_isOpaqueMaterialPass(t){return 8===t||s(t)&&!this._transparent}_isOpaqueNoSSAODepthPass(t){return r(t)&&this.parameters.writeDepth&&!this._transparent}createGLMaterial(t){return new $(t)}createBufferWriter(){return new A(H(this.parameters))}}class $ extends x{beginSlot(t){return this.getTechnique(k,t)}}class J extends j{constructor(){super(...arguments),this.color=t,this.forceTransparentMode=!1,this.writeDepth=!0,this.hasVertexColors=!1,this.polygonOffset=!1,this.hasSlicePlane=!1,this.cullFace=0,this.draped=!1,this.discardInvisibleFragments=!1}}export{Z as C};
