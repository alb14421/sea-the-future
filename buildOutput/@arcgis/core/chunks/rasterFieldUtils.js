/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import e from"../layers/support/Field.js";const a="Raster.",n="Raster.Dim.",i=".Max",t={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},r=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function s(a,n){return new e({name:a,alias:n,domain:null,editable:!1,length:50,type:"string"})}function l(a,n){return new e({name:a,alias:n,domain:null,editable:!1,type:"double"})}function u(e){return s(t.servicePixelValue,e??"Service Pixel Value")}function o(e){return s(t.rawServicePixelValue,e??"Raw Service Pixel Value")}function c(){return s(t.itemPixelValue,"Item Pixel Value")}function m(e){return s(`${t.servicePixelValue}.${e}`,e)}function f(e){return l(`${t.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function d(){return l(`${t.direction}`,"Direction (Â°)")}function $(e){return e.fields.filter(e=>"oid"!==e.type&&"value"!==e.name.toLowerCase()).map(e=>{const n=e.clone();return n.name=`${a}${e.name}`,n})}function p(a){const u=new Set,o=new Set,c=new Map;return a.variables.forEach(({dimensions:e})=>{e.forEach(e=>{if(e.recurring)c.set(e.name,e.unit);else{const a="ISO8601"===e.unit?.trim()?u:o;a.add(e.name),e.hasRanges&&a.add(`${e.name}${i}`)}})}),[s(t.variable,"Variable"),...[...u].map(a=>function(a,n){return new e({name:a,alias:n,domain:null,editable:!1,type:"date"})}(`${n}${a}`,v(a))),...[...o].map(e=>l(`${n}${e}`,v(e))),...[...c].map(([e,a])=>l(`${n}${e}`,function(e,a){return a=a?.toLowerCase(),a&&r.has(a)?r.get(a):v(e)}(e,a)))]}function v(e){const a=e.endsWith(i),n=a?e.slice(0,-4):e,t="StdTime"===n?"Standard Time":"StdZ"===n?"Standard Z":n;return a?`${t} Max`:t}function h(e,a){return a?new Date(e):e}function x(e,a,r){r?.length&&(a[t.variable]=r[0].variableName,r.forEach(({dimensionName:t,values:r})=>{if(t&&r?.length){const s=`${n}${t}`,l=e.find(({name:e})=>e===s);if(!l)return;const u="date"===l.type,o=r[0];if(Array.isArray(o)){if(a[`${n}${t}`]=h(o[0],u),null!=o[1]){const r=`${n}${t}${i}`;if(e.some(({name:e})=>e===r)){const e=h(o[1],u);a[r]=e}}}else a[`${n}${t}`]=h(o,u)}}))}function w(e,a){if(a.pixelType.startsWith("f")&&e.forEach(({format:e,fieldName:a})=>{e&&a&&/^raster\.(item|service)pixelvalue/i.test(a)&&(e.places=2)}),a.multidimensionalInfo){const t=a.multidimensionalInfo.variables.flatMap(({dimensions:e})=>e);e.forEach(({format:e,fieldName:a})=>{if(e&&a?.startsWith(n)){const n=a.slice(11),r=`${n}${i}`,s=t.find(({name:e})=>e===n||e===r);s?.values?.every(e=>Number.isInteger(e))&&(e.places=0)}})}}export{x as a,a as b,t as c,p as d,c as e,o as f,u as g,m as h,f as i,d as j,$ as k,n as r,w as s};
