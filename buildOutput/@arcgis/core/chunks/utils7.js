/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{f as t,c as e,a as n,b as s,d as o}from"./date.js";import{isDateField as r,isDateOnlyField as i,isTimestampOffsetField as a,l}from"../layers/support/fieldUtils.js";import{a as u}from"./basemapUtils.js";import{a as d}from"./constants.js";import{g as f}from"./timeZoneUtils.js";const m=",",c={light:["streets","gray","topo","terrain","oceans","osm","gray-vector","streets-vector","topo-vector","streets-relief-vector","streets-navigation-vector","topo-3d","navigation-3d","streets-3d","osm-3d","gray-3d"],dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector","navigation-dark-3d","streets-dark-3d","dark-gray-3d"]},g={exclude:["median"]},p={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},y=new Set(["integer","small-integer"]);let h=null;const v=["date","date-only","timestamp-offset"];function T(t){return r(t)||i(t)||a(t)}async function Z(t){const{field:e,field2:n,field3:s,normalizationField:o,valueExpression:r}=t;let i=[];if(r){if(!h){const{arcadeUtils:t}=await l();h=t}i=h.extractFieldNames(r)}return e&&i.push(e),n&&i.push(n),s&&i.push(s),o&&i.push(o),i}function $(t){let e=t.normalizationType;return e||(t.normalizationField?e="field":null!=t.normalizationTotal&&(e="percent-of-total")),e??void 0}function U(t){return String(t).padStart(2,"0")}function w(t,e,n){let s;return"date"===e||"number"===e?("number"===e&&(t=new Date(t)),s=`TIMESTAMP'${n?t.getFullYear():t.getUTCFullYear()}-${U((n?t.getMonth():t.getUTCMonth())+1)}-${U(n?t.getDate():t.getUTCDate())} ${U(n?t.getHours():t.getUTCHours())}:${U(n?t.getMinutes():t.getUTCMinutes())}:${U(n?t.getSeconds():t.getUTCSeconds())}'`):s=t,s}function b(t,e,n,s){const{hasQueryEngine:o}=t,r=`(${w(n,k(t,n),o)} - ${w(e,k(t,e),o)})`;let i=p[s],a="/";return i<1&&(i=1/i,a="*"),{sqlExpression:1===i?r:`(${r} ${a} ${i})`,sqlWhere:null}}function k(t,e){if(e instanceof Date)return"date";if("number"==typeof e)return"number";if("string"==typeof e){const n=t.getField(e);if("<now>"===e.toLowerCase())return;if(r(n))return"field"}}function S(t,e=c){for(const n in e)if(e[n].includes(t))return n}function C(t,e,n=!0){let s=null;return t&&("string"==typeof t?e.includes(t)&&(s=t):s=u(t)),n?s||"gray":s}function D(t,e){const n=e&&t.getField(e);return!!n&&y.has(n.type)}function F(t){return`cast(${t} as float)`}function j(r,i){const{format:a,timeZoneOptions:l,fieldType:u}=i??{};let m,c;if(l&&({timeZone:m,timeZoneName:c}=f(l.layerTimeZone,l.datesInUnknownTimezone,l.viewTimeZone,e(a||"short-date-short-time"),u)),"string"==typeof r&&isNaN(Date.parse("time-only"===u?`1970-01-01T${r}Z`:r)))return r;switch(u){case"date-only":{const n=e(a||"short-date");return"string"==typeof r?o(r,{...n}):t(r,{...n,timeZone:d})}case"time-only":{const n=e(a||"short-time");return"string"==typeof r?s(r,n):t(r,{...n,timeZone:d})}case"timestamp-offset":{if(!m&&"string"==typeof r&&new Date(r).toISOString()!==r)return r;const s=a||l?e(a||"short-date-short-time"):void 0,o=s?{...s,timeZone:m,timeZoneName:c}:void 0;return"string"==typeof r?n(r,o):t(r,o)}default:{const n=a||l?e(a||"short-date-short-time"):void 0;return t("string"==typeof r?new Date(r):r,n?{...n,timeZone:m,timeZoneName:c}:void 0)}}}export{D as a,$ as b,F as c,Z as d,v as e,j as f,b as g,k as h,T as i,c as j,g as k,m as l,C as m,S as n,p as u};
