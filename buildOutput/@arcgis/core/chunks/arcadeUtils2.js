/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{y as e,z as t,B as r,C as o,D as s,E as i,F as n,G as a,H as l,I as u,J as p,K as m}from"./arcade.js";export{L as arcade}from"./arcade.js";import{A as c,D as j,T as f}from"./TimeOnly.js";import{t as d}from"./arcadeEnvironment.js";import{D as y}from"./Dictionary.js";import{F as h}from"./Feature.js";import{k as g,c as v,i as b,d as x,f as S,e as w}from"./languageUtils.js";import{A as P}from"./enum.js";import{I as _}from"./ImmutableArray.js";import{i as T,b as F,c as U,e as A,a as I}from"./guards.js";import{clone as D}from"../core/lang.js";import C from"../geometry/Extent.js";import E from"../geometry/Multipoint.js";import $ from"../geometry/Point.js";import k from"../geometry/Polygon.js";import z from"../geometry/Polyline.js";import"./Logger.js";import"../config.js";import"./object.js";import"./string.js";import"./SetUtils.js";import"../core/Accessor.js";import"../core/Handles.js";import"./maybe.js";import"../core/accessorSupport/decorators/subclass.js";import"./Lifecycle.js";import"./metadata.js";import"./utils.js";import"./handleUtils.js";import"./tracking.js";import"./ensureType.js";import"./MapUtils.js";import"./Warning.js";import"../core/Error.js";import"./get.js";import"./ObjectPool.js";import"./ObservableBase.js";import"../core/accessorSupport/decorators/property.js";import"./watch.js";import"../core/scheduling.js";import"./nextTick.js";import"./PooledArray.js";import"../core/promiseUtils.js";import"./events.js";import"./SimpleTrackingTarget.js";import"./aiServices.js";import"../portal/Portal.js";import"./tslib.es6.js";import"../kernel.js";import"../core/urlUtils.js";import"./jsonUtils.js";import"../request.js";import"./persistableUrlUtils.js";import"../core/JSONSupport.js";import"../core/Loadable.js";import"../core/Promise.js";import"./reader.js";import"./locale.js";import"../portal/PortalGroup.js";import"../portal/PortalQueryParams.js";import"./jsonMap.js";import"../geometry/SpatialReference.js";import"./unitUtils.js";import"./pe.js";import"./assets.js";import"./writer.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Geometry.js";import"../core/accessorSupport/decorators/cast.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"./utils9.js";import"./commonProperties3.js";import"./deepClone.js";import"./datetime.js";import"./shared2.js";import"../layers/support/Field.js";import"./enumeration.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./fieldType.js";import"../core/sql/WhereClause.js";import"./UnknownTimeZone.js";import"./mathUtils.js";import"./streamLayerUtils.js";import"./coordsUtils.js";import"../geometry/support/jsonUtils.js";import"./zmUtils.js";import"./extentUtils.js";import"./boundsUtils.js";import"./aaBoundingRect.js";import"./unitConversion.js";import"./number2.js";import"./hash.js";import"./uuid.js";import"./featureConversionUtils.js";import"./aaBoundingBox.js";import"./DoubleArray.js";import"./OptimizedFeature.js";import"./memoryEstimations.js";import"./OptimizedGeometry.js";import"./OptimizedFeatureSet.js";import"./createFeatureId.js";import"../layers/support/FieldsIndex.js";import"../layers/support/fieldUtils.js";import"../core/sql.js";import"./constants.js";import"./timeZoneUtils.js";const O="Voxel.Position",R="Voxel.LocalTime";class M{constructor(e,t){this._graphic=e,this._timeZone=t,this.arcadeDeclaredClass="esri.arcade.Voxel",this._layer=e.sourceLayer}getPosition(){return void 0!==this._position?this._position:this._position=function(e){const t=e.getAttribute(O);if("string"!=typeof t)throw new P(null,"InvalidParameter",null);const r=JSON.parse(t);if(!Array.isArray(r)||"number"!=typeof r[0]||"number"!=typeof r[1]||"number"!=typeof r[2])throw new P(null,"InvalidParameter",null);return new _(r)}(this._graphic)}getLocalTime(){return void 0!==this._localTime?this._localTime:this._localTime=function(e,t){const r=e.getAttribute(R);if(null==r)return null;if(!T(r))throw new P(null,"InvalidParameter",null);return c.dateJSAndZoneToArcadeDate(r,t)}(this._graphic,this._timeZone??"system")}keys(){return this._layer.fields.map(e=>e.name).sort()}hasField(e){return this._layer.fieldsIndex.has(e)}field(e){const t=this._layer.fieldsIndex?.get(e)?.name;if(null==t)throw new P(null,"FieldNotFound",null,{key:e});switch(t){case O:return this.getPosition();case R:return this.getLocalTime()}return this._graphic.attributes[t]??null}castToText(e=!1){const t={...this._graphic.attributes};t[O]=this.getPosition(),R in t&&(t[R]=this.getLocalTime());for(const e of Object.keys(t))this._layer.fieldsIndex?.has(e)||delete t[e];return g(t,{useNumbersForDates:e})}}const J={vars:{$feature:"any",$view:"any"}};function Z(e){return e.replaceAll(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function G(e){return null==e?null:F(e)||v(e)?"array":b(e)?"date":U(e)?"text":A(e)?"boolean":I(e)?"number":e instanceof y?"dictionary":x(e)?"feature":e instanceof $?"point":e instanceof k?"polygon":e instanceof z?"polyline":e instanceof E?"multipoint":e instanceof C?"extent":e instanceof j?"dateOnly":e instanceof f?"time":S(e)?"featureSet":w(e)?"featureSetCollection":null}function V(t){if(!t)return null;try{return e(t)}catch(e){}return null}function B(e,r){const o="string"==typeof e?V(e):e;if(!o)return null;try{return r=r||D(J),t(o,r)}catch(e){}return null}function N(e,t,r){return{vars:{$feature:null==e?new h:h.createFromGraphic(e,r),$view:t?.view},spatialReference:t?.sr,timeZone:r??null}}function q(e,t,r){return h.createFromGraphicLikeObject(t,e,r,null)}function H(e,t){null!=e.vars&&(e.vars.$feature=t)}function Q(e,t){let o;try{o=r(e,t)}catch(e){o=null}return o}function W(e,t){let r;try{r=e?e(t):null}catch(e){r=null}return r}function K(e,t){try{return e?e(t):Promise.resolve(null)}catch(e){return Promise.resolve(null)}}const X=new Set(["$feature","$aggregatedFeatures","$voxel"].map(e=>d(e)));function Y(e,t){if(!e)return[];const r="string"==typeof e?V(e):e;if(!r)return[];const s=o(r).filter(({varId:e})=>X.has(e)).map(({memberNamePattern:e})=>e).flatMap(e=>{if(e.includes("*")){if(null==t)return[];const r=new RegExp(`^${e.split(/\*+/).map(Z).join(".*")}$`,"i");return t.filter(e=>r.test(e))}return e.toLowerCase()});return[...new Set(s.sort())]}function ee(e){return s(e,"$view")}function te(e,t){return!!e&&s(e,t)}function re(e){if(!e||null==e.spatialReference&&(null==e.scale||null==e.viewingMode))return;let t,r;const{timeProperties:o,timeZone:s}=e;if(null!=o){const{currentStart:e,currentEnd:i}=o;null!=s?(t=null!=e?c.dateJSAndZoneToArcadeDate(e,s):null,r=null!=i?c.dateJSAndZoneToArcadeDate(i,s):null):(t=null!=e?c.dateJSToArcadeDate(e):null,r=null!=i?c.dateJSToArcadeDate(i):null)}return{view:e.viewingMode&&null!=e.scale?new y({__proto__:null,viewingMode:e.viewingMode,scale:e.scale,timeProperties:null!=t||null!=r?new y({__proto__:null,currentStart:t,currentEnd:r,startIncluded:!0,endIncluded:!0}):null}):null,sr:e.spatialReference}}function oe({url:e,spatialReference:t,lrucache:r,interceptor:o}){const s=l();return s?s.createFeatureSetCollectionFromService(e,t,r,o):null}function se({layer:e,spatialReference:t,outFields:r,returnGeometry:o,lrucache:s,interceptor:i}){if(null===e)return null;const n=l();return n?n.constructFeatureSet(e,t,r,o??!0,s,i):null}function ie(e){if(null===e?.map)return null;const t=l();return t?t.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null}function ne(e,t){return y.convertJsonToArcade(e,t)}function ae(e,t,r=[]){return i(e,t,r)}function le(){return n()}function ue(){return a()}function pe(e,t){if(!e)return!1;if("string"==typeof e)return t(e);const r=e;if("type"in(o=r)&&("class-breaks"===o.type||"dictionary"===o.type||"dot-density"===o.type||"pie-chart"===o.type||"simple"===o.type||"unique-value"===o.type)){if("dot-density"===r.type){const e=r.attributes?.some(e=>t(e.valueExpression));if(e)return e}const e=r.visualVariables,o=!!e&&e.some(e=>{let r=t(e.valueExpression);return"size"===e.type&&(ye(e.minSize)&&(r=r||t(e.minSize.valueExpression)),ye(e.maxSize)&&(r=r||t(e.maxSize.valueExpression))),r});return!(!("valueExpression"in r)||!t(r.valueExpression))||o}var o;if("esri.layers.support.LabelClass"===r.declaredClass){const e=r.labelExpressionInfo?.expression;return!(!e||!t(e))||!1}return"esri.PopupTemplate"===r.declaredClass&&(!!r.expressionInfos&&r.expressionInfos.some(e=>t(e.expression))||Array.isArray(r.content)&&r.content.some(e=>"expression"===e.type&&t(e.expressionInfo?.expression)))}function me(e){const t=V(e);return!!t&&p(t)}function ce(e){return pe(e,me)}function je(e){const t=V(e);return!!t&&m(t)}function fe(e){return pe(e,je)}function de(e){return pe(e,e=>{const t=V(e);return!!t&&u(t)})}function ye(e){return e&&"esri.renderers.visualVariables.SizeVariable"===e.declaredClass}export{y as Dictionary,M as Voxel,h as arcadeFeature,se as convertFeatureLayerToFeatureSet,ne as convertJsonToArcade,ie as convertMapToFeatureSetCollection,oe as convertServiceUrlToWorkspace,N as createExecContext,q as createFeature,B as createFunction,V as createSyntaxTree,ee as dependsOnView,ue as enableFeatureSetOperations,le as enableGeometryOperations,Q as evalSyntaxTree,K as executeAsyncFunction,W as executeFunction,Y as extractFieldNames,G as getArcadeType,re as getViewInfo,ce as hasGeometryFunctions,fe as hasGeometryOperations,te as hasVariable,ae as loadScriptDependencies,de as requiresTrack,H as updateExecContext};
