/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.34/esri/copyright.txt for details.
*/
import{s as e,l as t,a as r}from"./vec3.js";import{c as n}from"./vec3f64.js";import{c as l,f as o}from"./ray.js";import{t as a,h as u,g as s}from"./intersectorUtilsConversions.js";function i(e,t){return c(e)===c(t)}function c(e){if(null==e)return null;const t=null!=e.layer?e.layer.id:"";let r=null;return r=null!=e.objectId?e.objectId:null!=e.layer&&"objectIdField"in e.layer&&null!=e.layer.objectIdField&&null!=e.attributes?e.attributes[e.layer.objectIdField]:e.uid,null==r?null:`o-${t}-${r}`}const d={json:{write:{writer:function(e,t){null!=e?.layer?.objectIdField&&null!=e.attributes&&(t.feature={layerId:e.layer.id,objectId:e.attributes[e.layer.objectIdField]})},target:{"feature.layerId":{type:[Number,String],isRequired:!0},"feature.objectId":{type:[Number,String],isRequired:!0}}},origins:{"web-scene":{read:function(e){if(null!=e.layerId&&null!=e.objectId)return{uid:null,layer:{id:e.layerId,objectIdField:"ObjectId"},attributes:{ObjectId:e.objectId}}}}}},clonable:"reference"};function f(l,u,s,i){const{sceneIntersectionHelper:d}=l,{observer:f,observerFeatureId:I,targetFeatureId:y,target:g}=s;if(null==I&&null==y)return;i||(i=e=>e),e(m,f,g);const p=t(m);r(m,f,m,1/p);const S=o(m,g,j);u.options.store=2,d.intersectToolIntersectorRay(S,u);let v=null,F=null,N=null,R=null;for(const e of u.results.all){const t=a(e,l);if(null==t||null==e.distanceInRenderSpace)continue;const r=c(t);null!=r&&(null!=I&&r===I&&(v??=i(b(e,l,p)),e.distanceInRenderSpace-1<v&&(N=e)),null!=y&&r===y&&(F??=i(b(e,l,p)),null==R&&e.distanceInRenderSpace-1<p&&p-e.distanceInRenderSpace+1<F&&(R=e)))}const{observerAdjusted:w,targetAdjusted:T}=s;N?.getIntersectionPoint(w)?s.observerSurfaceNormal=N.getTransformedNormal(n()):s.observerSurfaceNormal=null,R?.getIntersectionPoint(T)?s.targetSurfaceNormal=R.getTransformedNormal(n()):s.targetSurfaceNormal=null}function b(e,t,r){if(u(e)){const n=s(e,t);if(null!=n)return Math.min(n*I,r)}return 1e-5*r}const I=.05,j=l(),m=n();export{d as a,i as f,c as g,f as u};
